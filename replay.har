{
  "log": {
    "version": "1.2",
    "creator": {
      "name": "LoadRunner",
      "version": "12.50.0.0"
    },
    "pages": [
      {
        "startedDateTime": "2018-08-14T12:26:56.331-07:00",
        "id": "page_2",
        "title": "http://omniconv/omni/index.jsp",
        "pageTimings": {}
      },
      {
        "startedDateTime": "2018-08-14T12:26:56.903-07:00",
        "id": "page_36",
        "title": "http://omniconv/omni/HttpRequestAjaxServlet",
        "pageTimings": {}
      },
      {
        "startedDateTime": "2018-08-14T12:26:56.955-07:00",
        "id": "page_39",
        "title": "http://omniconv/omni/common/docNumberSearch.htm",
        "pageTimings": {}
      },
      {
        "startedDateTime": "2018-08-14T12:26:57.629-07:00",
        "id": "page_66",
        "title": "http://omniconv/omni/advcor/csPln/offenderCPHeader.htm?persCallback=&persCheckIsDirty=true&inctvCallback=&inctvCheckIsDirty=true&ccOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&waOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&scOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&readOnly=false&isPrint=&nrtvHstryPage=",
        "pageTimings": {}
      },
      {
        "startedDateTime": "2018-08-14T12:26:57.992-07:00",
        "id": "page_75",
        "title": "http://omniconv/omni/HttpRequestAjaxServlet",
        "pageTimings": {}
      },
      {
        "startedDateTime": "2018-08-14T12:26:58.020-07:00",
        "id": "page_76",
        "title": "http://omniconv/omni/advcor/csPln/persGoalNrtv.htm",
        "pageTimings": {}
      },
      {
        "startedDateTime": "2018-08-14T12:26:58.087-07:00",
        "id": "page_79",
        "title": "http://omniconv/omni/advcor/csPln/inctvNrtv.htm",
        "pageTimings": {}
      },
      {
        "startedDateTime": "2018-08-14T12:26:58.130-07:00",
        "id": "page_80",
        "title": "http://omniconv/omni/advcor/cntc/contacts.htm?bannerView=true&editing=false",
        "pageTimings": {}
      }
    ],
    "entries": [
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.331-07:00",
        "time": 6,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/index.jsp",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            }
          ],
          "queryString": [],
          "headersSize": 224,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "WWW-Authenticate",
              "value": "Negotiate"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1293"
            }
          ],
          "content": {
            "size": 1293,
            "compression": 0,
            "mimeType": "text/html",
            "text": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;} \r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;} \r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} \r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n <div class=\"content-container\"><fieldset>\r\n  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>\r\n  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>\r\n </fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 216,
          "bodySize": 1293
        },
        "cache": {},
        "timings": {
          "send": 1,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8631"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.344-07:00",
        "time": 5,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/index.jsp",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAABAAAAB7IIogsACwAvAAAADwAPACAAAABET0MxWlRVTTExNjg3ODFET0MxLldBLkxDTA=="
            }
          ],
          "queryString": [],
          "headersSize": 326,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html; charset=us-ascii"
            },
            {
              "name": "Server",
              "value": "Microsoft-HTTPAPI/2.0"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM TlRMTVNTUAACAAAACAAIADgAAAAFgomiMPQQbFK+HVIAAAAAAAAAAJYAlgBAAAAABgGxHQAAAA9EAE8AQwAxAAIACABEAE8AQwAxAAEAGABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAEABYARABPAEMAMQAuAHcAYQAuAGwAYwBsAAMAMABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAuAEQATwBDADEALgB3AGEALgBsAGMAbAAFAAwAdwBhAC4AbABjAGwABwAIABsCT8MENNQBAAAAAA=="
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "341"
            }
          ],
          "content": {
            "size": 341,
            "compression": 0,
            "mimeType": "text/html; charset=us-ascii",
            "text": "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\">\r\n<HTML><HEAD><TITLE>Not Authorized</TITLE>\r\n<META HTTP-EQUIV=\"Content-Type\" Content=\"text/html; charset=us-ascii\"></HEAD>\r\n<BODY><h2>Not Authorized</h2>\r\n<hr><p>HTTP Error 401. The requested resource requires user authentication.</p>\r\n</BODY></HTML>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 474,
          "bodySize": 341
        },
        "cache": {},
        "timings": {
          "send": 2,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8631"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.355-07:00",
        "time": 258,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/index.jsp",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAADAAAAGAAYAJwAAAAYABgAtAAAABYAFgBAAAAAKAAoAFYAAAAeAB4AfgAAAAAAAADMAAAABYKIokQATwBDADEALgBXAEEALgBMAEMATABzAHYAYwB3AGEAdQB0AGUAcwB0AHUAcwBlAHIAMAAxAGQAbwBjADEARABPAEMAMQBaAFQAVQBNADEAMQA2ADgANwA4ADEAwXyMBkdoiBIAAAAAAAAAAAAAAAAAAAAAVFvaStez+qWaO0iH41IleYId4kVDwlFl"
            }
          ],
          "queryString": [],
          "headersSize": 518,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache=\"set-cookie, set-cookie2\""
            },
            {
              "name": "Transfer-Encoding",
              "value": "chunked"
            },
            {
              "name": "Content-Type",
              "value": "text/html;charset=UTF-8"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Expires",
              "value": "Thu, 01 Dec 1994 16:00:00 GMT"
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Set-Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1; Path=/"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            }
          ],
          "content": {
            "size": 18800,
            "compression": 0,
            "mimeType": "text/html;charset=UTF-8",
            "text": "\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html lang=\"en-US\" xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\r\n\t<!-- Header portion: BEGIN -->\r\n\t<head>\r\n\r\n\t\t<!-- Set the meta parameters for this page -->\r\n\t\t\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html;charset=UTF-8\" />\r\n\t\t<meta http-equiv=\"Content-Style-Type\" content=\"text/css\" />\r\n\r\n\t\t<!-- Include common JSP files for OMNI -->\r\n\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\r\n\r\n\r\n\t\t\t\t<!-- Global body style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-body-styles.css\" />\r\n\r\n\t\t<!-- Global error style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-error-styles.css\" />\r\n\r\n\t\t<!-- Global hyperlink style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-link-styles.css\" />\r\n\r\n\t\t<!-- Global layer style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-layer-styles.css\" />\r\n\r\n\t\t<!-- Global layout declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-layout-styles.css\" />\r\n\r\n\t\t<!-- Global menu style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-menu-styles.css\" />\r\n\r\n\t\t<!-- Global print style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-print-styles.css\" media=\"print\" />\r\n\r\n\t\r\n\t\t<!-- Common scripts used in OMNI -->\r\n\t\t<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/common-scripts.js\"></script>\r\n\r\n\t\t<!-- Common deferred scripts used in OMNI -->\r\n        <script type=\"text/javascript\" defer=\"defer\" src=\"/OMNIStatic/scripts/common-deferred-scripts.js\"></script>\r\n        \r\n        <!-- Common jquery scripts used in OMNI -->\r\n        <script type=\"text/javascript\" src=\"/OMNIStatic/scripts/jquery/jquery-1.9.1.min.js\"></script>\r\n        <script type=\"text/javascript\" src=\"/OMNIStatic/scripts/jquery/jquery-extension-1.9.1.js\"></script>\r\n        <script type=\"text/javascript\" src=\"/OMNIStatic/scripts/jquery/jquery-ui.js\"></script>\r\n        <script type=\"text/javascript\" src=\"/OMNIStatic/scripts/jquery/jquery-ui-extension.js\"></script>\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/scripts/jquery/jquery-ui.css\" />\r\n\r\n        <!-- dwr scripts used in OMNI -->\r\n        <script type=\"text/javascript\" src=\"/omni/dwr/engine.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"/omni/dwr/util.js\"></script>    \r\n\t\t\r\n        <!-- Common session storage scripts used in OMNI -->\r\n        <script type=\"text/javascript\" src=\"/OMNIStatic/scripts/common-session-storage.js\"></script>\r\n        \r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t<!-- $layername is set to \"id-main-right\" by default: override if neccessary -->\r\n\t\t\r\n\r\n\t\t<!-- Page-specific head content: BEGIN -->\r\n\t\t\r\n\t\t<title>OMNI: Home</title>\r\n\t\t<script language=\"JavaScript\" type=\"text/javascript\">\r\n\t\t<!--\r\n\r\n\t\t\r\n\r\n\t\tfunction externalLinks() { \r\n\t\t\tif (!document.getElementsByTagName) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar anchors = document.getElementsByTagName(\"a\"); \r\n\t\t\tfor (var i = 0; i < anchors.length; i++) {\r\n\t\t\t\tvar anchor = anchors[i];\r\n\t\t\t\tif (anchor.getAttribute(\"href\") && anchor.getAttribute(\"rel\") == \"external\") {\r\n\t\t\t\t\tanchor.target = \"_blank\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\tfunction moveCursorToDocNo()\r\n\t\t{\r\n\t\t\t//set doc_no to empty since it might caried the cached doc number over from previous browser\r\n\t\t\t//it only happens when user select File->New Window within current OMNN Screen.\r\n\t\t\tif (sessionStorage.getItem(\"isNewBrowser\") != null && sessionStorage.getItem(\"isNewBrowser\") == \"Y\")\r\n\t\t\t{\r\n\t\t\t\tdocument.getElementById('doc_no').value = \"\";\r\n\t\t\t\tdocument.getElementById('selectedDocNo').innerHTML = \"Selected DOC No.:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\";\t\t\t\t\r\n\t\t\t\tsessionStorage.setItem(\"isNewBrowser\", null);\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\tdocument.getElementById('doc_no').focus();\r\n\t\t\t// Defect 16543\r\n\t\t\tdocument.getElementById('doc_no').select();\t\t\t\t\t\r\n\t\t}\r\n\r\n\r\n\t\t\r\n\r\n\t\twindow.onload = externalLinks;\r\n\r\n\t\t// -->\r\n\t\t</script>\r\n\r\n\t\t\r\n\t\t\r\n\t\t<!-- Page-specific head content: END -->\r\n\r\n\t</head>\r\n\t<!-- Header portion: END -->\r\n\r\n\t<!-- Body portion: BEGIN-->\r\n\t\r\n\t<body onload=\"moveCursorToDocNo();\">\r\n\t\r\n\r\n\t\t<!-- Header content pane: BEGIN -->\r\n\t\t<div id=\"id-main-header\">\r\n\r\n\t\t\t<!-- Application header: BEGIN -->\r\n\t\t\t\r\n<!-- Header / Global: BEGIN -->\r\n\r\n\t<!-- Global header images: BEGIN -->\r\n\t<div id=\"id-main-header-a-1\">\r\n\t\t<img src=\"/OMNIStatic/images/logo-doc.gif\" alt=\"Department Of Corrections logo\" width=\"161\" height=\"38\" />\r\n\t</div>\r\n\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t<div id=\"id-main-header-a-2\">\r\n\t\t******TEST-CONV******<br/>\r\n\t\t\t<img src=\"/OMNIStatic/images/logo-omni.gif\" alt=\"Offender Management Network Information logo\" width=\"316\" height=\"25\" />\r\n\t\t</div>\r\n\t\t\r\n\t\t\r\n\t\r\n\t<!-- Global header images: END -->\r\n\r\n\t<script type=\"text/javascript\">\r\n\t//<![CDATA[\r\n\t//  function for suppressing form submission if enter is pressed\r\n\t//  when cursor in a input type=\"text\"\r\n          function killEnterAfterFirst(evt)\r\n          {\r\n             if(evt.keyCode == 13 || evt.which == 13){\r\n          \t\t//OMNI00016279 GLOBAL - Entering a DOC Number in the DOCNO box and hitting ENTER Bypasses Screen Warning\r\n          \t\tif(!hasFormChanged(currentOmniForm)) {\r\n\t          \t\treturn true;\r\n          \t\t} else {\r\n          \t\t\tif(checkFormChanged()) {\r\n\t\t\t\t\t\tdisableSubmitButtons('docNumberSearchForm');\r\n\t\t\t\t\t\tdocument.forms['docNumberSearchForm'].submit();\r\n\t\t\t\t\t\tdocument.getElementById('doc_no').setAttribute(\"disabled\",\"disabled\");\r\n\t\t                return true;\r\n\t\t\t\t\t} else {\r\n\t\t\t      \t\treturn false;\r\n          \t\t\t}\r\n          \t\t}\r\n           \t}\r\n            return true;\r\n          }\r\n          function disableSubmitButton(formName) {\r\n        \tvar elem = null;\r\n        \tdocument.forms['docNumberSearchForm'].submit();\r\n                document.getElementById('doc_no').setAttribute(\"disabled\",\"disabled\");\r\n\r\n                for ( j=0;j< document.forms[formName].elements.length; j++ ) {\r\n                    \telem = document.forms[formName].elements[j];\r\n\r\n                        if(elem.type && (elem.type == 'submit' || elem.type == 'reset' || elem.type == 'button')) {\r\n\t    \t                elem.onclick = voidAction;\r\n\t    \t                elem.style.color='#cccc99';\r\n\t                }\r\n\t        }\r\n          }\r\n\r\n          function onSubmitHandler() {\r\n\r\n          \tif(!hasFormChanged(currentOmniForm)) {\r\n\r\n          \t\treturn true;\r\n          \t} else {\r\n          \t\tif(checkFormChanged()) {\r\n          \t\t      disableSubmitButtons('docNumberSearchForm',false);\r\n\t\t\t      return true;\r\n\t\t\t} else {\r\n\t\t\t      return false;\r\n          \t\t}\r\n          \t}\r\n\r\n          }\r\n\t//]]>\r\n\t</script>\r\n\t<!-- Global DOC number: BEGIN -->\r\n\t\r\n\t\r\n\t<div id=\"id-main-header-a-3\">\r\n\t\t<form id=\"docNumberSearchForm\" method=\"post\" action=\"/omni/common/docNumberSearch.htm\" onsubmit=\"return onSubmitHandler();\">\r\n\t\t\t<table class=\"cls-doc-quick-jump\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td class=\"cls-nowrap\">\r\n\t\t\t\t\t\t<label class=\"form-element\" for=\"doc_no\"> DOC No.:</label>\r\n\t\t\t\t\t\t<!-- fix for CQ14900 - add tab index to the doc number box -->\r\n\t\t\t\t\t\t<input class=\"form-element\" name=\"docSearchNumber\" type=\"text\" id=\"doc_no\" tabindex=\"1\" size=\"12\" maxlength=\"7\"  onkeypress=\"return killEnterAfterFirst(event);\" style=\"text-align:right\" value=\"\" />\r\n\t\t\t\t\t\t<input class=\"form-element\" name=\"go\" id=\"go\" type=\"submit\" value=\"Go\"  tabindex=\"2\"/><!-- Fix for 9746 -->\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n\t</div>\r\n\t\r\n\t<!-- Global DOC number: END -->\r\n\r\n\r\n<!-- Global selected DOC: BEGIN -->\r\n\r\n\t\r\n\t<div id=\"id-main-header-b-2\">\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<div id=\"selectedDocNo\">Selected DOC No.:\r\n\t\t\t\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n\t\t\t\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t</div>\r\n\r\n<!-- Global selected DOC: END -->\r\n\r\n\r\n\t<!-- Global top tabs: BEGIN -->\r\n\r\n\t<!-- Menu tooltips: BEGIN -->\r\n\t<div id=\"id-tooltip-offender\">Single offender specific information regarding their overall case plan.</div>\r\n\t<div id=\"id-tooltip-assignments\">View and work with caseload specific, Notifications and Check Dates. Create a Group Chrono.</div>\r\n\t<div id=\"id-tooltip-facility\">Facility maintenance functions.</div>\r\n\t<div id=\"id-tooltip-search\">Search for offenders by name or other search criteria. Search Chronos, Check Dates, and Notifications. Locate staff / position and facility information.</div>\r\n\t<div id=\"id-tooltip-administration\">Create and maintain staff and position information. Create and maintain facility information. Maintain code tables and security authorizations.</div>\r\n\t<div id=\"id-tooltip-plans\">Manage the offender's plans.</div>\r\n\t<div id=\"id-tooltip-healthServices\">View and work with health services for offenders.</div>\r\n\t<div id=\"id-tooltip-programs\">Manage the offender's programs.</div>\r\n\t<!-- Menu tooltips: END -->\r\n\r\n\t<!-- Menu tabs: BEGIN -->\r\n\t<div id=\"id-main-header-b-1\">\r\n\t\t\r\n\t\t<a href=\"/omni/index.jsp\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs-on\" onmouseover=\"MM_showHideLayers('id-tooltip-home','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-home','','hide')\">Home</a>\r\n\t\t\r\n\t\t\r\n\t\t\t<a href=\"/omni/assignments/index.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-assignments','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-assignments','','hide')\">Assignments</a>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t<a href=\"/omni/advcor/csPln/offenderCasePlan.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-offender','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-offender','','hide')\">Offender</a>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t<a href=\"/omni/med/sched/schedulerQueue.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-healthServices','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-healthServices','','hide')\">Health Services</a>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t<a href=\"/omni/menu/plans.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-plans','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-plans','','hide')\">Plans</a>\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t<a href=\"/omni/menu/programs.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-programs','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-programs','','hide')\">Programs</a>\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t<!-- For CQ# 15120 create new authority -->\r\n\t\t\r\n\t\t\t<a href=\"/omni/records/facility/facilityModifyDeleteField.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-facility','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-facility','','hide')\">Facility</a>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t<a href=\"/omni/records/offender/offenderSearchQuick.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-search','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-search','','hide')\">Search</a>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t<a href=\"/omni/menu/prea.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-prea','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-prea','','hide')\">PREA</a>\r\n\t\t\r\n\t\t\r\n\t\t<a href=\"/omni/menu/administration.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-administration','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-administration','','hide')\">Administration</a>\r\n\t</div>\r\n\t<!-- Menu tabs: END -->\r\n\r\n\t<!-- Global top tabs: END -->\r\n\r\n\r\n<!-- Header / Global: END -->\r\n\r\n\t\t\t<!-- Application header: END -->\r\n\r\n\t\t\t<!-- Breadcrumb trail area: BEGIN -->\r\n\t\t\t<div id=\"id-main-header-c-1\">&nbsp;</div>\r\n\t\t\t<div id=\"id-main-header-d-1\">\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t</div>\r\n\t\t\t<!-- Breadcrumb trail area: END -->\r\n\r\n\t\t\t<!-- Most recent search & logged-in user area: BEGIN -->\r\n\t\t\t\r\n\t\t\t<div id=\"id-main-header-d-2\">\r\n\t\t\t\t\r\n\r\n\t<!-- Global user menu: END -->\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\t<a href=\"http://helpsitesdemo/omni/\" class=\"cls-link-help\" rel=\"external\" onclick=\"window.open(this.href, 'HelpWindow'); return false;\"  onkeypress=\"window.open(this.href); return false;\">Help</a>\r\n\t\r\n\t&nbsp;\r\n\t<span id=\"id-logged-in\">Logged in as <strong>PerfOne Tester</strong></span>\r\n\t<!-- Global user menu: END -->\r\n\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<!-- Most recent search & logged-in user area: END -->\r\n\r\n\t\t</div>\r\n\t\t<!-- Header content pane: END -->\r\n\r\n\t\t<!-- Left content pane: BEGIN -->\r\n\t\t\r\n\t\t<div id=\"menu-block-expanded\" style=\"display:inline; margin:5px; position:absolute; left:155px; top:100px; z-index:1;\">\r\n\t\t<a href=\"\" onclick=\"hideElement('id-main-left');hideElement('menu-block-expanded');showElement('menu-block-collapsed');resetMarginLeft('id-main-right', '25px');return(false);\" >\r\n\t\t<img style=\"border-width: 0px;\" \r\n\t\t      height=\"15\" alt=\"Hide Menu\" \r\n\t\t      src=\"/OMNIStatic/images/buttons/button-minus.gif\" /></a>\r\n\t\t</div>\r\n\t\t<div id=\"menu-block-collapsed\" style=\"display:none; margin:5px; position:absolute; left:0px; top:100px; z-index:1;\">\r\n\t\t<a href=\"\" onclick=\"showElement('id-main-left');showElement('menu-block-expanded');hideElement('menu-block-collapsed');resetMarginLeft('id-main-right', '190px');return(false);\" >\r\n\t\t<img style=\"border-width: 0px;\" \r\n\t\t      height=\"15\" alt=\"Show Menu\" \r\n\t\t      src=\"/OMNIStatic/images/buttons/button-plus.gif\" /></a>\r\n\t\t</div>\t\t\r\n\t\t\r\n\t\t<div id=\"id-main-left\">\r\n\t\t\t<ul class=\"cls-menu-left\">\r\n\t\t\t\t<li class=\"cls-menu-left-header\">Welcome to OMNI</li>\r\n\t\t\t</ul>\r\n\t\t\t\r\n<!-- Left / Menu / Home: BEGIN -->\r\n\r\n\t\t\t\r\n\t\t\t\r\n\r\n<ul class=\"cls-menu-left\">\r\n\t<li class=\"cls-menu-left-header\">Links</li>\r\n\t\r\n\t\t<li><a target=\"_new\" href=\"/omni/fors/index.htm\" class=\"cls-link\">FORS</a></li>\r\n\t\r\n\t\r\n\t\t<li><a target=\"_new\" href=\"http://idoc/\" class=\"cls-link\">iDOC</a></li>\r\n\t\r\n\t\r\n\t<li><a target=\"_new\" href=\"http://omnireportconv/OMNI_Reports/Pages/Folder.aspx\">OMNI Reports</a></li>\r\n\r\n\t<li><a target=\"_new\" href=\"http://ceconnectconv/cefield/\">CeField</a></li>\r\n\r\n\t<li><a target=\"_new\" href=\"http://ceprisonconv/\">CePrison</a></li>\t\t\r\n\t\r\n\t<li><a target=\"_new\" href=\"http://reportwizardtest/Pages/Menu.aspx\">Report Wizard</a></li>\r\n</ul>\r\n<!-- Left / Menu / Home: END -->\r\n\r\n\t\t\t\t<!-- Left: User Information START -->\r\n\t<div id=\"id-menu-left-header\">\r\n\t\tUser Information\r\n\t</div>\r\n\t<div id=\"id-menu-left\" style=\"overflow: hidden;\">\r\n\t\t\r\n\r\n<script language=\"javascript\" type=\"text/javascript\">\r\n\r\n\r\nfunction staffAddressBookCurrentUserCallBack(paramStaffName, paramStaffId, paramPositionId, paramOpeningId) {\r\n\r\n\tif(paramStaffId != null) {\r\n\t        refreshCurrentPage();\r\n\t}\r\n}\r\n\r\n\r\n\r\nfunction showAddressBookForCurrentUser() {\r\n        showStaffAddressBook('/omni/common/dialogs/rolodex.htm', staffAddressBookCurrentUserCallBack, 'CHANGE_POSITION', '100021046', '100016965', '1');\r\n}\r\n</script>\r\n\r\n\r\n\t\t<table border=\"0\" cellpadding=\"2\" cellspacing=\"0\" >\r\n\t\t\t<tr>\r\n\t\t\t\t<td><span class=\"cls-label\">\r\n\t\t\t\t\tName</span>\r\n\t\t\t\t<br/>&nbsp;&nbsp;&nbsp;<span class=\"cls-value\">\r\n\t\t\t\t  <a href='/omni/records/staff/staffModify.htm?staffId=100021046' class='cls-link' onclick=\"return checkFormChanged();\">\r\n\t\t\t\t\tTester, PerfOne P\r\n\t\t\t\t   </a></span>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td><span class=\"cls-label\">\r\n\t\t\t\t\tPosition Title</span>\r\n\t\t\t\t<br/>&nbsp;&nbsp;&nbsp;<span class=\"cls-value\">\r\n\t\t\t\t\tPerTester01\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td><span class=\"cls-label\">\r\n\t\t\t\t\tFacility</span>\r\n\t\t\t\t<br/>&nbsp;&nbsp;&nbsp;<span class=\"cls-value\">\r\n\t\t\t\t\tHeadquarters\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td><span class=\"cls-label\">\r\n\t\t\t\t\tTelephone</span>\r\n\t\t\t\t<br/><span class=\"cls-read-only\">\r\n\t\t\t\t        \r\n\t\t\t\t\t</span>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<span class=\"cls-label\">E-Mail</span>\r\n\t\t\t\t\t<!-- Defect 11054 - email will be displayed without text-transform:capitalize -->\r\n\t\t\t\t\t<span class=\"cls-value\" style=\"text-transform:none\">\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td><span class=\"cls-label\">\r\n\t\t\t\t\tOBTS Position Number</span>\r\n\t\t\t\t<br/>&nbsp;&nbsp;&nbsp;<span class=\"cls-value\">\r\n\t\t\t\t\tZX36 \r\n\t\t\t\t\t</span>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td colspan=\"2\" class=\"cls-value\">\r\n\t\t\t\t\t<form action=\"#\" name=\"changePosition\">\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t</form>\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n\t<!-- Left: User Information END -->\r\n\r\n\t\t</div>\r\n\t\t\r\n\t\t<!-- Left content pane: END -->\r\n\r\n\t\t<!-- Right content pane: BEGIN -->\r\n\t\t<div id=\"id-main-right\">\r\n\r\n\t\t\t<!-- Autosave message area: BEGIN -->\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t<!-- Autosave message area: END -->\r\n\r\n\t\t\t<!-- Alert message area: BEGIN -->\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t<!-- Alert message area: END -->\r\n\r\n\t\t\t<!-- Main content area: BEGIN -->\r\n\t\t\t\r\n\t\t\t<div style=\"background-color: #ffffff;border:1px solid black;\">\r\n\t\t\t\t<center>\r\n\t\t\t\t\t<br />\r\n\t\t\t\t\t<br />\r\n\t\t\t\t\t<strong>\r\n\t\t\t\t\t\tWelcome to the State of Washington<br />\r\n\t\t\t\t\t\tAuthorized Use Only<br />\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tFor assistance please call your help desk.<br />\r\n\t\t\t\t\t\tPhone: 360.725.8383 or 800.858.4416 <br/>\r\n\t\t\t\t\t\tEasyVista Website: <a href=\"https://esp.doc.wa.gov\" target=\"blank\">https://esp.doc.wa.gov</a><br/>\r\n\t\t\t\t\t</strong>\r\n\t\t\t\t\t<br />\r\n\t\t\t\t\t<br />\r\n\t\t\t\t</center>\r\n\t\t\t</div>\r\n\t\t\t<br />\r\n\r\n\t\t\t\r\n\t\t\t\t<div class=\"main-right-header\">\r\n\t\t\t\t\tPolicy\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"main-contents-overview\">\r\n\t\t\t\t\t\r\n\t\t\t\t\tPolicies can be viewed <a href=\"http://insidedoc/policies/\" class=\"cls-link\" rel=\"external\">here</a>.\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style=\"font-size: 6pt\">&nbsp;</div>\r\n\t\t\t\r\n\r\n\t\t\t\r\n\t\t\t\t<div class=\"main-right-header\">\r\n\t\t\t\t\tOMNI Help\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"main-contents-overview\">\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tHelp can be viewed <a href=\"http://helpsitesdemo/omni/\" class=\"cls-link\" rel=\"external\">here</a>.\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style=\"font-size: 6pt\">&nbsp;</div>\r\n\t\t\t\r\n\r\n\t\t\t\r\n\t\t\t\t<div class=\"main-right-header\">\r\n\t\t\t\t\tSystem Bulletins\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"main-contents-overview\">\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tSystem bulletins can be viewed <a href=\"http://idoc/agency/services/it/app-info.htm#omni\" class=\"cls-link\" rel=\"external\">here</a>.\r\n\t\t\t\t</div>\r\n\t\t\t\r\n\r\n\t\t\t\r\n\t\t\t<!-- Main content area: END -->\r\n\r\n\t\t</div>\r\n\t\t<!-- Right content pane: END -->\r\n\r\n\t</body>\r\n\t<!-- Body portion: END -->\r\n\r\n</html>\r\n\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 464,
          "bodySize": 18800
        },
        "cache": {},
        "timings": {
          "send": 211,
          "wait": 39,
          "receive": 22
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8631"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.615-07:00",
        "time": 23,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/omni/global-body-styles.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 347,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Fri, 29 Jun 2018 15:21:50 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"0fbbce6bcfd41:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "3262"
            }
          ],
          "content": {
            "size": 17605,
            "compression": 0,
            "mimeType": "text/css",
            "text": "<!--\r\n\r\n/*\r\n\r\n\tDate File Created: November (20)  2006\r\n\tCreated By: Paul Cormie\r\n\tDate Last Modified: August (31) 2007\r\n\tLast Modified By: Victor Chong\r\n\tFile Summary: CSS classes used throughout the entire web application\r\n\tCSS Contents: Global Classes\r\n\tTested: IE 5.5, IE 6.0, FireFox 2.0\r\n\r\n*/\r\n\r\nform {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n}\r\n\r\n#breadCrumb {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:7pt;\r\n\tcolor:#666666;\r\n}\r\n\r\n#breadCrumbCurrent {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:7pt;\r\n\tcolor:#666666;\r\n\tfont-weight:bold;\r\n}\r\n\r\n.form-button {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#333333;\r\n}\r\n\r\n.form-button-large{\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:16pt;\r\n\tcolor:#333333;\r\n}\r\n\r\n.form-button-75 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#333333;\r\n\twidth:75px;\r\n}\r\n\r\n.form-button-150 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#333333;\r\n\twidth:150px;\r\n}\r\n\r\n.form-button-250 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#333333;\r\n\twidth:250px;\r\n}\r\n\r\n.form-button-bold {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tfont-weight:bold;\r\n\tcolor:#333333;\r\n}\r\n\r\n.form-element {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n}\r\n\r\n.form-element-10 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:10px;\r\n}\r\n\r\n.form-element-20 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:20px;\r\n}\r\n\r\n.form-element-30 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:30px;\r\n}\r\n\r\n.form-element-45 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:45px;\r\n}\r\n\r\n\r\n.form-element-60 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:60px;\r\n}\r\n\r\n.form-element-70 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:70px;\r\n}\r\n\r\n.form-element-75 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:75px;\r\n}\r\n\r\n.form-element-90 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:90px;\r\n}\r\n\r\n.form-element-105 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:105px;\r\n}\r\n\r\n\r\n.form-element-120 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:120px;\r\n}\r\n\r\n.form-element-180-large {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:16pt;\r\n\tcolor:#666666;\r\n\twidth:180px;\r\n}\r\n\r\n.form-element-210-large {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:16pt;\r\n\tcolor:#666666;\r\n\twidth:210px;\r\n}\r\n\r\n.form-element-135 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:135px;\r\n}\r\n\r\n.form-element-150 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:150px;\r\n}\r\n\r\n.form-element-180 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:180px;\r\n}\r\n\r\n.form-element-200 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:200px;\r\n}\r\n\r\n.form-element-210 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:210px;\r\n}\r\n\r\n.form-element-220 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:220px;\r\n}\r\n\r\n.form-element-240 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:240px;\r\n}\r\n\r\n.form-element-270 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:270px;\r\n}\r\n\r\n.form-element-300 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:300px;\r\n}\r\n\r\n\r\n.form-element-320 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:320px;\r\n}\r\n\r\n.form-element-330 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:330px;\r\n}\r\n\r\n.form-element-370 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:370px;\r\n}\r\n\r\n.form-element-420 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:420px;\r\n}\r\n\r\n.form-element-500 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:500px;\r\n}\r\n\r\n.form-element-550 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:550px;\r\n}\r\n\r\n.form-element-575 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:575px;\r\n}\r\n\r\n.form-element-600 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:600px;\r\n}\r\n\r\n.form-element-700 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:700px;\r\n}\r\n\r\n.form-element-770 {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:770px;\r\n}\r\n\r\n.form-element-100Percent {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:98%;\r\n\tborder-style: inset;\r\n\tpadding-left: 0;\r\n\tpadding-right: 0;\r\n\r\n}\r\n\r\n.header-text {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\ttext-align:right;\r\n\tborder-bottom:1px solid #666666;\r\n\twhite-space:nowrap;\r\n}\r\n\r\n\r\n.header-text-left {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\ttext-align:left;\r\n\tborder-bottom:1px solid #666666;\r\n\twhite-space:nowrap;\r\n}\r\n\r\np.cls-label {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\ttext-transform:capitalize;\r\n}\r\n\r\ntr.odd .gray {\r\n\tcolor: #D9D9B1;\r\n}\r\n\r\ntr.even .gray {\r\n\tcolor: #EDEDCF; \r\n}\r\n\r\ntd.cls-label {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\ttext-transform:capitalize;\r\n}\r\n\r\n.cls-label {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\ttext-transform:capitalize;\r\n}\r\n\r\n.cls-label-no-transform {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\ttext-transform:none;\r\n}\r\n\r\n.cls-label-eleven-point-bold {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#666699;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:11pt;\r\n\tfont-weight:bold;\r\n}\r\n\r\n.fineprint-cls-label {\r\n\tdisplay: none;\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\ttext-transform:none;\r\n\tfont-style:italic;\r\n}\r\n\r\n.cls-href-look-label {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#0000cd;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\ttext-transform:capitalize;\r\n\ttext-decoration:underline\r\n}\r\n.href-disabled { color: gray; text-decoration: underline; }\r\n\r\n.cls-label-bold {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:bold;\r\n\ttext-transform:capitalize;\r\n}\r\n\r\n.cls-label-bold-black {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:black;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:bold;\r\n}\r\n\r\n\r\n.cls-label-bold-black-16 {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:black;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:16pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:bold;\r\n}\r\n\r\n.cls-label-bold-black-28 {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:black;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:28pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:bold;\r\n}\r\n\r\n.cls-label-bold-black-16-underline {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:black;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:16pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:bold;\r\n\ttext-decoration:underline;\r\n}\r\n\r\n.cls-label-bold-black-36 {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:black;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:36pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:bold;\r\n}\r\n\r\n.cls-label-bold-black-80 {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:black;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:80pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:bold;\r\n}\r\n\r\n.cls-label-bold-black-diet-name {\r\n\tcolor:black;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:48pt;\r\n\tfont-weight:bold;\r\n}\r\n\r\ndiv.cls-form-error {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#660000;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:bold;\r\n\tpadding-top:5px;\r\n\tpadding-bottom:5px;\r\n\tpadding-left:10px;\r\n\tpadding-right:10px;\r\n\r\n}\r\n\r\ndiv.cls-form-message {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#000066;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:bold;\r\n\tpadding-top:5px;\r\n\tpadding-bottom:5px;\r\n\tpadding-left:10px;\r\n\tpadding-right:10px;\r\n\r\n}\r\n\r\ndiv.cls-form-success-message {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:green;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:bold;\r\n\tpadding-top:5px;\r\n\tpadding-bottom:5px;\r\n\tpadding-left:10px;\r\n\tpadding-right:10px;\r\n\r\n}\r\n\r\np.cls-value {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#000000;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\ttext-transform:capitalize;\r\n}\r\n\r\ntd.cls-value {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#000000;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\ttext-transform:capitalize;\r\n}\r\n\r\ntd.cls-value-uppercase {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#000000;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\ttext-transform:uppercase;\r\n}\r\n\r\n.cls-value {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#000000;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\ttext-transform:capitalize;\r\n}\r\n\r\n\r\np.cls-read-only {\r\n\tmargin-bottom:0px;\r\n\tmargin-top:0px;\r\n\tcolor:#333333;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n}\r\n\r\n.cls-doc-quick-jump {\r\n\tbackground-color:#ededcf;\r\n\tpadding-right:8px;\r\n\tpadding-left:8px;\r\n\tpadding-top:3px;\r\n\tpadding-bottom:3px;\r\n\tborder:1px solid #666666;\r\n\tfont-size:8pt;\r\n}\r\n\r\ntd.cls-expand-collapse-button {\r\n\tpadding-right:5px;\r\n\ttext-align:right;\r\n}\r\n\r\ntd.cls-form-descriptor {\r\n\tcolor:#000000;\r\n\tbackground-color:#cccc99;\r\n\tpadding-left:5px;\r\n\tpadding-right:5px;\r\n\tfont-weight:normal;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tpadding-bottom:2px;\r\n\tpadding-top:2px;\r\n}\r\n\r\ntd.cls-form-padding {\r\n\tpadding-left:5px;\r\n\tpadding-right:5px;\r\n}\r\n\r\ntd.cls-nopadding-right {\r\n\tpadding-right:0px;\r\n}\r\n\r\ntd.cls-nopadding-left {\r\n\tpadding-left:0px;\r\n\tpadding-right:6px;\r\n}\r\n\r\n.cls-nowrap {\r\n\twhite-space:nowrap;\r\n}\r\n\r\nlegend {\r\n\tbackground-color:#ededcf;\r\n\tpadding-right:2px;\r\n\tpadding-left:2px;\r\n\tcolor:#000000;\r\n\tfont-size:8pt;\r\n\ttext-align:left\r\n}\r\n\r\nfieldset {\r\n\tborder:1px solid #cccc99;\r\n\tbackground-color:#ededcf;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tmargin-top:0px;\r\n\tmargin-bottom:5px;\r\n\tmargin-left:5px;\r\n\tmargin-right:5px;\r\n}\r\n\r\n/* displayTag Search Results */\r\n\r\ntable.rowSupportedTag {\r\nbackground:#EDEDCF;\r\nborder-collapse:collapse;\r\nwidth:100%;\r\nwhite-space:nowrap;\r\n}\r\n\r\ntable.rowSupportedTag tbody td {\r\ntext-align:left;\r\nfont-size:7pt;\r\nborder-color:#D8D8AF;\r\nwidth:10%;\r\n}\r\n\r\ntable.rowSupportedTag thead th {\r\n\ttext-align:left;\r\n\tfont-weight:bold;\r\n\tbackground:#D8D8AF;\r\n\tfont-size:7pt;\r\n\t/*border:1px solid #EDEDCF;*/\r\n}\r\n\r\ntable.rowSupportedTag tbody tr.even {\r\n\tbackground-color:#EDEDCF;\r\n}\r\n\r\ntable.rowSupportedTagBannerPanel tbody {\r\n\tdisplay: none;\r\n}\r\n\r\ntable.displayTag {\r\n\tbackground:#F9F5D7;\r\n\tborder-spacing:0px;\r\n\tborder-collapse:collapse;\r\n\twidth:100%;\r\n\twhite-space: normal;\r\n}\r\n\r\ntable.displayTag > thead > tr > th {\r\n\ttext-align:left;\r\n\tfont-weight:bold;\r\n\tvertical-align:top;\r\n\tpadding-right:4px;\r\n\tbackground-color:#D8D8AF;\r\n\tcolor:#000000;\r\n\tfont-size:7pt;\r\n}\r\n\r\ntable.displayTag > tfoot > tr > td {\r\n\ttext-align:left;\r\n\tfont-size:7pt;\r\n}\r\n\r\ntable.displayTag > tbody > tr > td {\r\n\ttext-align:left;\r\n\tfont-size:7pt;\r\n\tpadding-right:4px;\r\n}\r\n\r\ntable.displayTag > tbody > tr.even {\r\n\tbackground-color:#D8D8AF;\r\n}\r\n\r\ntable.displayTag > tbody > tr.odd {\r\n\tbackground-color:#EDEDCF;\r\n}\r\n\r\n\r\ntable.gridList {\r\n\tborder-width: 1px;\r\n\tborder-spacing: 0;\r\n\tborder-style: none;\r\n\tborder-color: #cccc99;\r\n\tborder-collapse: collapse;\r\n\tbackground-color: #d8d8af;\r\n}\r\ntable.gridList th {\r\n\tborder-width: 1px;\r\n\tborder-style: solid;\r\n\tborder-color: #cccc99;\r\n\tbackground-color: #D8D8AF;\r\n}\r\n\r\ntable.gridList td {\r\n\tborder-width: 1px;\r\n\tborder-style: solid;\r\n\tborder-color: #cccc99;\r\n\tbackground-color: #EDEDCF;\r\n}\r\n\r\n\r\ntable.noGridList  tr{\r\n\tborder-width: 1px;\r\n\tborder-style: solid;\r\n\tborder-color: #EDEDCF;\r\n\tbackground-color: #EDEDCF;\r\n}\r\n\r\n\r\ntable.noGridList  td{\r\n\tborder-width: 1px;\r\n\tborder-style: solid;\r\n\tborder-color: #EDEDCF;\r\n\tbackground-color: #EDEDCF;\r\n}\r\n\r\ntable.removeSupportedTag {\r\n\t\t\t\tbackground:#EDEDCF;\r\n\t\t\t\tborder-collapse:collapse;\r\n\t\t\t\twidth:100%;\r\n}\r\n\r\ntable.removeSupportedTag tr.odd#false td.removable-30-link{\r\n\tbackground-color:#EDEDCF;\r\n\tdisplay: none;\r\n}\r\n\r\ntable.removeSupportedTag tr.even#false td.removable-30-link{\r\n\tbackground:#D8D8AF;\r\n\tdisplay: none;\r\n}\r\n\r\ntable.removeSupportedTag tr.odd{\r\n\tbackground-color:#EDEDCF;\r\n}\r\n\r\ntable.removeSupportedTag tr.even{\r\n\tbackground-color:#EDEDCF;\r\n}\r\n\r\n.ellipse-table {\r\n\twidth: 100%;\r\n\ttable-layout: fixed;\r\n}\r\n\t\t\r\n.ellipse-table td {\r\n\twhite-space: nowrap;\r\n\toverflow: hidden;\r\n\ttext-overflow: ellipsis;\r\n}\r\n\t\t\r\n\r\n.removable-30-link {\r\n\twidth:30px;\r\n}\r\n\r\n.table-element-30 {\r\n\twidth:30px;\r\n}\r\n\r\n.table-element-90 {\r\n\twidth:90px;\r\n}\r\n\r\n.table-element-180 {\r\n\twidth:180px;\r\n}\r\n\r\n.table-element-300 {\r\n\twidth:300px;\r\n}\r\n.table-element-360 {\r\n\twidth:360px;\r\n}\r\n\r\n.page-link {\r\n\ttext-align:center;\r\n\tfont-weight:bold;\r\n}\r\n\r\n.informational {\r\n\ttext-align:center;\r\n\tfont-weight:bold;\r\n\tcolor:#449120;\r\n}\r\n\r\n.failure {\r\n\ttext-align:center;\r\n\tfont-weight:bold;\r\n\tcolor:#ff3300;\r\n}\r\n\r\n.form-element-disable {\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n\twidth:120px;;\r\n\tbackground-color: silver\r\n}\r\n\r\n.hidden {\r\n\tdisplay: none;\r\n}\r\n\r\n.invisible {\r\n\tvisibility: hidden;\r\n}\r\n\r\ninput[type=\"checkbox\"] {\r\n\twidth: 15px;\r\n\theight: 15px;\r\n}\r\n\r\ninput[type=\"submit\"]{\r\n\twhite-space:normal;\r\n}\r\n\r\ninput[type=\"submit\"][disabled], input[type=\"button\"][disabled] {\r\n\tcolor: graytext;\r\n}\r\n\r\n.right-header {\r\n\tbackground-color: #cccc99;\r\n\tcolor: #000000;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size: 10pt;  /*change to small to allow scaling*/\r\n\tfont-weight: bold;\r\n\tpadding-left: 8px;\r\n\tpadding-bottom: 4px;\r\n\tpadding-top: 4px;\r\n\tborder-bottom: 1px solid #666666;\r\n/* these two margins affect IE 5.5 */\r\n\tmargin-right: 0px;\r\n\ttop: 95px;\r\n\tvoice-family: \"\\\"}\\\"\";\r\n\tvoice-family: inherit;\r\n/* these two margins affect IE 6 */\r\n\tmargin-right: 0px;\r\n}\r\n\r\n/* For checkboxes and radio buttons - align them inline with their label. */\r\n.vertical-align-middle {\r\n\tvertical-align: middle;\r\n\tmargin-top: 4px;\r\n\tpadding-top: 0px;\r\n}\r\n/* for not showing scroll bar when using Iframe with dialogbox */\r\n.hiddenScrollBar {\r\n\tmargin:0; \r\n\toverflow: hidden;\r\n}\r\n\r\n/* A transparent png spinner background image used with $.fn.addSpinnerPNG() that adds this class to a DOM element. */\r\n.spinner-pngicon {\r\n\tbackground: url('../../images/icons/spinner.png') no-repeat;\r\n\theight: 15px;\r\n\twidth: 11pt;\r\n}\t\r\n\r\n/* A gif spinner background image used with $.fn.addSpinner() that adds this class to a DOM element. */\r\n.spinner-icon {\r\n\tbackground-image: url('../../images/icons/wait.gif');\r\n\tbackground-size: 13px;\r\n\tbackground-repeat: no-repeat;\r\n\tpadding: 0px 7px 0px 6px;\r\n\tmargin-left: 3px;\r\n}\r\n\r\n.spinner-icon.odd {\r\n\tbackground-image: url('../../images/icons/wait-odd.gif');\r\n}\r\n.spinner-icon.even {\r\n\tbackground-image: url('../../images/icons/wait-even.gif');\r\n}\r\n-->",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 292,
          "bodySize": 17605
        },
        "cache": {},
        "timings": {
          "send": 6,
          "wait": 0,
          "receive": 3
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8632"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.615-07:00",
        "time": 28,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/omni/global-error-styles.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 348,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1244"
            }
          ],
          "content": {
            "size": 8061,
            "compression": 0,
            "mimeType": "text/css",
            "text": "<!--\r\n\r\n/*\r\n\r\n\tDate File Created: November (20)  2006\r\n\tCreated By: Paul Cormie\r\n\tDate Last Modified: January (31) 2008\r\n\tLast Modified By: Carol Carpenter\r\n\tFile Summary: CSS classes used throughout the entire web application\r\n\tCSS Contents: Global Classes\r\n\tTested: IE 5.5, IE 6.0, FireFox 2.0\r\n\r\n*/\r\n\r\n#id-main-right-header-error, .main-right-header-error {\r\n\tbackground-color: #aa0000;\r\n\tcolor: #ffffff;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size:10pt;  /*change to small to allow scaling*/\r\n\tfont-weight:bold;\r\n\tpadding-left:8px;\r\n\tpadding-bottom:4px;\r\n\tpadding-top:4px;\r\n\tborder-bottom: 1px solid #000000;\r\n\t/* these two margins affect IE 5.5 */\r\n\tmargin-right:0px;\r\n\ttop:95px;\r\n\tvoice-family: \"\\\"}\\\"\";\r\n\tvoice-family: inherit;\r\n\t/* these two margins affect IE 6 */\r\n\tmargin-right:0px;\r\n}\r\n\r\n#id-main-contents-error, .main-contents-error, #id-main_dwr_error_area {\r\n\tcolor: #000000;\r\n\tbackground-color: #ededcf;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\tpadding-left:5px;\r\n\tpadding-right:5px;\r\n\tpadding-bottom:0px;\r\n\tpadding-top:4px;\r\n\tline-height:150%;\r\n\tpadding-bottom:5px;\r\n}\r\n\r\n#id-main-right-err-msg {\r\n\tborder-bottom: 1px solid #cccc99;\r\n\tborder-top: 1px solid #cccc99;\r\n\tborder-right: 1px solid #cccc99;\r\n\tborder-left: 1px solid #cccc99;\r\n\tcolor: #990000;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size: 8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight: normal;\r\n\tbackground-color: #ffffea;\r\n\tpadding: 5px;\r\n}\r\n\r\n.form-element-error {\r\n\t/* CQ 28313 */\r\n\toutline:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n}\r\n\r\n.form-element-10-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:10px;\r\n}\r\n\r\n.form-element-20-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:20px;\r\n}\r\n\r\n.form-element-30-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:30px;\r\n}\r\n\r\n.form-element-45-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:45px;\r\n}\r\n\r\n.form-element-60-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:60px;\r\n}\r\n\r\n.form-element-70-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:70px;\r\n}\r\n\r\n.form-element-75-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:75px;\r\n}\r\n\r\n.form-element-90-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:90px;\r\n}\r\n\r\n.form-element-105-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:105px;\r\n}\r\n\r\n.form-element-120-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:120px;\r\n}\r\n\r\n.form-element-135-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:135px;\r\n}\r\n\r\n.form-element-150-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:150px;\r\n}\r\n\r\n.form-element-180-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:180px;\r\n}\r\n\r\n.form-element-200-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:200px;\r\n}\r\n\r\n.form-element-210-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:210px;\r\n}\r\n\r\n.form-element-210-large-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:16pt;\r\n\tcolor:#666666;\r\n\twidth:210px;\r\n}\r\n\r\n.form-element-220-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:220px;\r\n}\r\n\r\n.form-element-240-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:240px;\r\n}\r\n\r\n.form-element-270-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:270px;\r\n}\r\n\r\n.form-element-300-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:300px;\r\n}\r\n\r\n\r\n.form-element-320-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:320px;\r\n}\r\n\r\n.form-element-330-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:330px;\r\n}\r\n\r\n.form-element-370-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:370px;\r\n}\r\n\r\n.form-element-420-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:420px;\r\n}\r\n\r\n.form-element-500-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:500px;\r\n}\r\n\r\n.form-element-550-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:550px;\r\n}\r\n\r\n.form-element-600-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:600px;\r\n}\r\n\r\n.form-element-700-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:700px;\r\n}\r\n\r\n.form-element-770-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:770px;\r\n}\r\n\r\n.form-element-100Percent-error {\r\n\tborder:2px solid #aa0000;\r\n\tbackground-color:#ffff00;\r\n\tcolor:#666666;\r\n\tfont-family:verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;\r\n\twidth:98%;\r\n}\r\n\r\n#id-dwr-err-msg {\r\n\t/* this style is identical to id-main-contents-error */\r\n        /* Used for distiguish main error versus dwr errors */\r\n\tbackground-color: #aa0000;\r\n\tcolor: #ffffff;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size:10pt;  /*change to small to allow scaling*/\r\n\tfont-weight:bold;\r\n\tpadding-left:8px;\r\n\tpadding-bottom:4px;\r\n\tpadding-top:4px;\r\n\tborder-bottom: 1px solid #000000;\r\n\t/* these two margins affect IE 5.5 */\r\n\tmargin-right:0px;\r\n\ttop:95px;\r\n\tvoice-family: \"\\\"}\\\"\";\r\n\tvoice-family: inherit;\r\n\t/* these two margins affect IE 6 */\r\n\tmargin-right:0px;\r\n}\r\n\r\n-->",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 293,
          "bodySize": 8061
        },
        "cache": {},
        "timings": {
          "send": 11,
          "wait": 0,
          "receive": 2
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8633"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.615-07:00",
        "time": 82,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/omni/global-link-styles.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 347,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "992"
            }
          ],
          "content": {
            "size": 2727,
            "compression": 0,
            "mimeType": "text/css",
            "text": "<!--\r\n\r\n/* \r\n\r\n\tDate File Created: December (13) 2006\r\n\tCreated By: Paul Cormie\r\n\tDate Last Modified: January (8) 2007\r\n\tLast Modified By: Paul Cormie\r\n\tFile Summary: CSS classes used throughout the entire web application for Links\r\n\tCSS Contents: Hyperlinks\r\n\tTested: IE 5.5, IE 6.0, FireFox 2.0\r\n\tADD float:left; TAdd \r\n\tfloat:left;\r\n\tto \r\n\t\ta.cls-main-tabs\t\r\n\tand \r\n\ta.cls-main-tabs-on\r\n\tFOr making IE 7 compatible to Issue with space between the menu tabs  \r\n\r\n*/\r\n\r\na.cls-link\t\t\t{\r\n\t\t\t\t\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\t\t\t\t\tfont-weight: normal;\r\n\t\t\t\t\ttext-decoration: underline;\r\n\t\t\t\t\tcolor: blue;\r\n\t\t\t\t}\r\n\r\na.cls-link:hover\t\t{\r\n\t\t\t\t\tcolor: #00008A;\r\n\t\t\t\t\ttext-decoration: none;\r\n\t\t\t\t}\r\n\t\t\t\t\r\na.cls-link:active\t\t{\r\n\t\t\t\t\tcolor: blue;\r\n\t\t\t\t}\r\n\t\r\na.cls-main-tabs\t\t\t{\r\n\t\t\t\t\tpadding-left: 10px;\r\n\t\t\t\t\tpadding-right: 10px;\r\n\t\t\t\t\tpadding-top: 3px;\r\n\t\t\t\t\tpadding-bottom: 3px;\r\n\t\t\t\t\tbackground-image:url('../../images/menu-top/css-bg-off.jpg');\r\n\t\t\t\t\tbackground-position:bottom right;\r\n\t\t\t\t\tbackground-repeat:no-repeat;\r\n\t\t\t\t\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\t\t\t\t\tfont-size: 8pt;\r\n\t\t\t\t\tcolor: #666666;\r\n\t\t\t\t\tborder-bottom: 1px solid #666666;\r\n\t\t\t\t\tborder-left: 1px solid #666666;\r\n\t\t\t\t\ttext-decoration: none;\r\n\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\na.cls-main-tabs:hover\t\t{\r\n\t\t\t\t\tbackground-image:url('../../images/menu-top/css-bg-on.jpg');\r\n\t\t\t\t\tbackground-position:bottom right;\r\n\t\t\t\t\tbackground-repeat:no-repeat;\r\n\t\t\t\t\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\t\t\t\t\tfont-size: 8pt;\r\n\t\t\t\t\tcolor: #000000;\r\n\t\t\t\t\tborder-bottom: 1px solid #cccc98;\r\n\t\t\t\t\tborder-left: 1px solid #666666;\r\n\t\t\t\t\ttext-decoration: none;\r\n\t\t\t\t}\r\n\r\na.cls-main-tabs-on\t\t\t{\r\n\t\t\t\t\tpadding-left: 10px;\r\n\t\t\t\t\tpadding-right: 10px;\r\n\t\t\t\t\tpadding-top: 3px;\r\n\t\t\t\t\tpadding-bottom: 3px;\r\n\t\t\t\t\tbackground-image:url('../../images/menu-top/css-bg-on.jpg');\r\n\t\t\t\t\tbackground-position:bottom right;\r\n\t\t\t\t\tbackground-repeat:no-repeat;\r\n\t\t\t\t\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\t\t\t\t\tfont-size: 8pt;\r\n\t\t\t\t\tcolor: #000000;\r\n\t\t\t\t\tborder-bottom: 1px solid #cccc98;\r\n\t\t\t\t\tborder-left: 1px solid #666666;\r\n\t\t\t\t\ttext-decoration: none;\r\n\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n/*  Slight work-around for hyperlink placement in header */\r\n\r\na.cls-link-help\t\t\t{\r\n\t\t\t\t\tposition: relative;\r\n\t\t\t\t\ttop:1px;\r\n\t\t\t\t\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\t\t\t\t\tfont-size: 7pt;\r\n\t\t\t\t\tfont-weight: normal;\r\n\t\t\t\t\ttext-decoration: underline;\r\n\t\t\t\t\tcolor: blue;\r\n\t\t\t\t}\r\n\r\na.cls-link-help:hover\t\t{\r\n\t\t\t\t\tcolor: #00008A;\r\n\t\t\t\t}\r\n\t\t\t\t\r\na.cls-link-help:active\t\t{\r\n\t\t\t\t\tcolor: blue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\na { \r\n\tcursor: pointer; \r\n}\r\na.cls-link.disabled {\r\n\tcolor: gray;\r\n\tcursor: default;\r\n}\r\na.cls-link.disabled:hover {\r\n\tcolor: gray;\r\n\ttext-decoration: underline;\r\n}\r\n-->",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 292,
          "bodySize": 2727
        },
        "cache": {},
        "timings": {
          "send": 66,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8634"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.615-07:00",
        "time": 114,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/omni/global-layer-styles.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 348,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1460"
            }
          ],
          "content": {
            "size": 7211,
            "compression": 0,
            "mimeType": "text/css",
            "text": "<!--\r\n\r\n/*\r\n\r\n\tDate File Created: December (13) 2006\r\n\tCreated By: Paul Cormie\r\n\tDate Last Modified: February (5) 2008\r\n\tLast Modified By: Victor Chong\r\n\tFile Summary: CSS classes used throughout the entire web application for Layers\r\n\tCSS Contents: Layers\r\n\tTested: IE 5.5,IE 6.0,FireFox 2.0\r\n\r\n*/\r\n\r\n#id-logged-in {\r\n\tpadding-left:10px;\r\n\tpadding-right:5px;\r\n\tpadding-top:3px;\r\n\tpadding-bottom:3px;\r\n\tbackground-image:url('../../images/menu-top/logged-in-bg.jpg');\r\n\tbackground-position:bottom left;\r\n\tbackground-repeat:no-repeat;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:8pt;\r\n\tcolor:#666666;\r\n}\r\n\r\n#id-main-right-msg-wrapper {\r\n\tborder-bottom:5px solid #ffffff;\r\n}\r\n\r\n#id-auto-save {\r\n\tposition:absolute;\r\n\tleft:-170px;\r\n\ttop:0px;\r\n\tmargin-right:5px;\r\n\tbackground-color:#ffffea;\r\n\tpadding:50px;\r\n\tborder:1px solid #cccc99;\r\n\tcolor:#990000;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\tvisibility:hidden;\r\n}\r\n\r\n#id-white-screen {\r\n\tposition:absolute;\r\n\tleft:-200px;\r\n\ttop:-100px;\r\n\twidth:1500px;\r\n\theight:300px;\r\n\tvisibility:hidden;\r\n\tfont-size:x-large;\r\n\tbackground-color:#ffffff;\r\n\tfilter:alpha(opacity=75);\r\n}\r\n\r\n#id-menu-left {\r\n\tposition:relative;\r\n\ttop:-10px;\r\n\twidth:169px;\r\n\tmargin:0px;\r\n\tcolor:#000000;\r\n\tbackground-color:#ededcf;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\tpadding-left:3px;\r\n\tpadding-right:3px;\r\n\tpadding-top:4px;\r\n\tpadding-bottom:4px;\r\n}\r\n\r\n#id-menu-left-header {\r\n\tposition:relative;\r\n\ttop:-10px;\r\n\twidth:170px;\r\n\tmargin:0px;\r\n\tcolor:#000000;\r\n\tbackground-color:#cccc99;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:10pt;\r\n\tfont-weight:bold;\r\n\tpadding-left:5px;\r\n\tpadding-bottom:4px;\r\n\tpadding-top:4px;\r\n\tborder-bottom:1px solid #666666;\r\n}\r\n\r\n#id-main-contents, .main-contents {\r\n\tcolor:#000000;\r\n\tbackground-color:#ededcf;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\tpadding-left:5px;\r\n\tpadding-right:5px;\r\n\tpadding-bottom:0px;\r\n\tpadding-top:4px;\r\n\tline-height:150%;\r\n\tpadding-bottom:5px;\r\n\tword-wrap: break-word; \r\n}\r\n\r\n#id-main-contents-overview, .main-contents-overview {\r\n\tcolor:#000000;\r\n\tbackground-color:#ededcf;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\tpadding-left:5px;\r\n\tpadding-right:5px;\r\n\tpadding-bottom:0px;\r\n\tpadding-top:4px;\r\n\tline-height:150%;\r\n\tpadding-bottom:5px;\r\n}\r\n\r\n#id-main-right-header-overview-collapsed, .main-right-header-overview-collapsed {\r\n\tposition:relative;\r\n\tmargin:0px;\r\n\tcolor:#000000;\r\n\tbackground-color:#cccc99;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:10pt;  /*change to small to allow scaling*/\r\n\tfont-weight:bold;\r\n\tpadding-left:5px;\r\n\tpadding-bottom:4px;\r\n\tpadding-top:4px;\r\n\tborder-bottom:1px solid #666666;\r\n}\r\n\r\n#id-main-right-header-overview-expanded, .main-right-header-overview-expanded, .collapsible-header {\r\n\tposition:relative;\r\n\tmargin:0px;\r\n\tcolor:#000000;\r\n\tbackground-color:#cccc99;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:10pt;  /*change to small to allow scaling*/\r\n\tfont-weight:bold;\r\n\tpadding-left:5px;\r\n\tpadding-bottom:4px;\r\n\tpadding-top:4px;\r\n\tborder-bottom:1px solid #666666;\r\n}\r\n\r\n/* Note the background image is related to the number of lines in the layer */\r\n/* Available bg images:bubble-bg-1-line.gif to bubble-bg-6-line.gif  */\r\n\r\n#id-tooltip-assignments {\r\n\tposition:absolute;\r\n\twidth:180px;\r\n\theight:85px;\r\n\tz-index:100;\r\n\tleft:95px;\r\n\ttop:80px;\r\n\tvisibility:hidden;\r\n\tbackground-image:url('../../images/menu-top/bubble-bg-3-line.gif');\r\n\tbackground-position:top left;\r\n\tbackground-repeat:no-repeat;\r\n\tpadding-left:10px;\r\n\tpadding-right:20px;\r\n\tpadding-top:22px;\r\n\tpadding-bottom:6px;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:7pt;\r\n\tfont-weight:normal;\r\n}\r\n\r\n#id-tooltip-offender {\r\n\tposition:absolute;\r\n\twidth:180px;\r\n\theight:85px;\r\n\tz-index:100;\r\n\tleft:179px;\r\n\ttop:80px;\r\n\tvisibility:hidden;\r\n\tbackground-image:url('../../images/menu-top/bubble-bg-2-line.gif');\r\n\tbackground-position:top left;\r\n\tbackground-repeat:no-repeat;\r\n\tpadding-left:10px;\r\n\tpadding-right:20px;\r\n\tpadding-top:22px;\r\n\tpadding-bottom:6px;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:7pt;\r\n\tfont-weight:normal;\r\n}\r\n\r\n#id-tooltip-facility {\r\n\tposition:absolute;\r\n\twidth:180px;\r\n\theight:85px;\r\n\tz-index:100;\r\n\tleft:247px;\r\n\ttop:80px;\r\n\tvisibility:hidden;\r\n\tbackground-image:url('../../images/menu-top/bubble-bg-1-line.gif');\r\n\tbackground-position:top left;\r\n\tbackground-repeat:no-repeat;\r\n\tpadding-left:10px;\r\n\tpadding-right:40px;\r\n\tpadding-top:22px;\r\n\tpadding-bottom:6px;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:7pt;\r\n\tfont-weight:normal;\r\n}\r\n\r\n#id-tooltip-search {\r\n\tposition:absolute;\r\n\twidth:180px;\r\n\theight:85px;\r\n\tz-index:100;\r\n\tleft:309px;\r\n\ttop:80px;\r\n\tvisibility:hidden;\r\n\tbackground-image:url('../../images/menu-top/bubble-bg-5-line.gif');\r\n\tbackground-position:top left;\r\n\tbackground-repeat:no-repeat;\r\n\tpadding-left:10px;\r\n\tpadding-right:20px;\r\n\tpadding-top:22px;\r\n\tpadding-bottom:6px;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:7pt;\r\n\tfont-weight:normal;\r\n}\r\n\r\n#id-tooltip-plans {\r\n\tposition:absolute;\r\n\twidth:180px;\r\n\theight:85px;\r\n\tz-index:100;\r\n\tleft:247px;\r\n\ttop:80px;\r\n\tvisibility:hidden;\r\n\tbackground-image:url('../../images/menu-top/bubble-bg-1-line.gif');\r\n\tbackground-position:top left;\r\n\tbackground-repeat:no-repeat;\r\n\tpadding-left:10px;\r\n\tpadding-right:20px;\r\n\tpadding-top:22px;\r\n\tpadding-bottom:6px;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:7pt;\r\n\tfont-weight:normal;\r\n}\r\n\r\n#id-tooltip-programs {\r\n\tposition:absolute;\r\n\twidth:180px;\r\n\theight:85px;\r\n\tz-index:100;\r\n\tleft:247px;\r\n\ttop:80px;\r\n\tvisibility:hidden;\r\n\tbackground-image:url('../../images/menu-top/bubble-bg-1-line.gif');\r\n\tbackground-position:top left;\r\n\tbackground-repeat:no-repeat;\r\n\tpadding-left:10px;\r\n\tpadding-right:20px;\r\n\tpadding-top:22px;\r\n\tpadding-bottom:6px;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:7pt;\r\n\tfont-weight:normal;\r\n}\r\n\r\n#id-tooltip-administration {\r\n\tposition:absolute;\r\n\twidth:180px;\r\n\theight:85px;\r\n\tz-index:100;\r\n\tleft:392px;\r\n\ttop:80px;\r\n\tvisibility:hidden;\r\n\tbackground-image:url('../../images/menu-top/bubble-bg-5-line.gif');\r\n\tbackground-position:top left;\r\n\tbackground-repeat:no-repeat;\r\n\tpadding-left:10px;\r\n\tpadding-right:40px;\r\n\tpadding-top:22px;\r\n\tpadding-bottom:6px;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:7pt;\r\n\tfont-weight:normal;\r\n}\r\n\r\n#id-tooltip-healthServices {\r\n\tposition:absolute;\r\n\twidth:180px;\r\n\theight:85px;\r\n\tz-index:100;\r\n\tleft:392px;\r\n\ttop:80px;\r\n\tvisibility:hidden;\r\n\tbackground-image:url('../../images/menu-top/bubble-bg-2-line.gif');\r\n\tbackground-position:top left;\r\n\tbackground-repeat:no-repeat;\r\n\tpadding-left:10px;\r\n\tpadding-right:20px;\r\n\tpadding-top:22px;\r\n\tpadding-bottom:6px;\r\n\tfont-family:verdana,arial,helvetica,sans-serif;\r\n\tfont-size:7pt;\r\n\tfont-weight:normal;\r\n}\r\n\r\n.heightProp {\r\n    height:1px;\r\n  }\r\n\r\n\r\n-->",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 293,
          "bodySize": 7211
        },
        "cache": {},
        "timings": {
          "send": 97,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8635"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.615-07:00",
        "time": 115,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/omni/global-layout-styles.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 349,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "2277"
            }
          ],
          "content": {
            "size": 9659,
            "compression": 0,
            "mimeType": "text/css",
            "text": "<!--\r\n\r\n/* \r\n\r\n\tDate File Created: November (20) 2006\r\n\tCreated By: Paul Cormie\r\n\tDate Last Modified: February (23) 2007\r\n\tLast Modified By: Victor Chong\r\n\tFile Summary: CSS classes used to specify the formatting of page into header and two columns (menu / content area)\r\n\tCSS Contents: Layout Related Classes / Layers\r\n\tTested: IE 5.5, IE 6.0, FireFox 2.0\r\n\r\n\r\nid-main-header sub layer definition\r\n-----------------------------------------\r\n|\ta1\t|\ta2\t\t|\ta3\t|\r\n-----------------------------------------\r\n|\tb1\t\t\t|\tb2\t|\r\n-----------------------------------------\r\n|\t\tc1\t\t\t|\r\n-----------------------------------------\r\n|\td1\t\t|\td2\t|\r\n-----------------------------------------\r\n\r\n\r\n*/\r\n\r\nhtml, body {\r\n\tborder: 0px;\r\n\tfont-family: verdana,arial,helvetica,sans-serif;\r\n\tfont-weight: normal;\r\n\tmargin: 0px;\r\n\tpadding: 0px;\r\n}\r\n\r\n#id-body-popup {\r\n\tbackground-color: #ededcf;\r\n\tborder: 0px;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-weight: normal;\r\n\tmargin: 0px;\r\n\tpadding: 0px;\r\n}\r\n\r\n#id-main-header {\r\n\tbackground-color: transparent;\r\n\tmargin-left: 5px;\r\n\tmargin-right: 5px;\r\n\t/* IE 5.5 */\r\n\theight: 81px;\r\n\tvoice-family: \"\\\"}\\\"\";\r\n\tvoice-family: inherit;\r\n\t/* IE 6 */\r\n\theight: 99px;\r\n\t}\r\n\thtml>body #id-main-header {\r\n\t/* these affect Mozilla and Safari */ \r\n\theight: 99px;\r\n}\r\n\r\n#id-main-header-a-1 {\r\n\tbackground-color: transparent;\r\n\tposition: absolute;\r\n\tleft: 5px;\r\n\ttop: 0px;\r\n\tpadding-left: 0px;\r\n\twidth: 165px;\r\n\theight: 45px;\r\n\t}\r\n\thtml>body #id-main-header-a-2 {\r\n\theight: 45px;\r\n}\r\n\r\n#id-main-header-a-2 {\r\n\tbackground-color: transparent;\r\n\tmargin-left: 165px;\r\n\tmargin-right: 190px;\r\n\tvoice-family: \"\\\"}\\\"\";\r\n\tvoice-family: inherit;\r\n\tmargin-left: 165px;\r\n\tmargin-right: 190px;\r\n\ttext-align: center;\r\n\theight: 45px;\r\n\t}\r\n\thtml>body #id-main-header-a-2 {\r\n\tmargin-left: 165px;\r\n\tmargin-right: 208px;\r\n\theight: 45px;\r\n}\t\r\n\r\n#id-main-header-a-3 {\r\n\tbackground-color: transparent;\r\n\tposition: absolute;\r\n\tpadding-top: 5px;\r\n\tright: 5px;\r\n\ttop: 0px;\r\n\twidth: 190px;\r\n\theight: 50px;\r\n\ttext-align: right;\r\n\t}\r\n\thtml>body #id-main-header-a-3 {\r\n\twidth: 207px;\r\n\theight: 50px;\r\n\tpadding-top: 5px;\r\n\tright: 3px;\r\n}\r\n\r\n#id-main-header-b-1 {\r\n\tbackground-color: transparent;\r\n\tvoice-family: \"\\\"}\\\"\";\r\n\tvoice-family: inherit;\r\n\tmargin-left: 0px;\r\n\tmargin-right: 350px;\r\n\ttext-align: left;\r\n\tpadding-top: 2px;\r\n\theight: 17px;\r\n\tfont-family: verdana, arial, helvetica, sans-serif; \r\n\tfont-size: 4pt;\r\n\tcolor: #666666;\r\n\twhite-space: nowrap;\r\n\t}\r\n\thtml>body #id-main-header-b-1 {\r\n\tmargin-left: 0px;\r\n\tmargin-right: 350px;\r\n\theight: 17px;\r\n\twhite-space: nowrap;\r\n}\r\n\r\n#id-main-header-b-2 {\r\n\tbackground-color: transparent;\r\n/*\tposition: absolute;*/\r\n/*\tpadding-top: 5px;*/\r\n\tright: 5px;\r\n\ttop: 32px;\r\n\twidth: 100%;/*350px;*/\r\n\theight: 15px;/*25px;*/\r\n\ttext-align: right;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size: 7pt;\r\n\tcolor: #666666;\r\n\t}\r\n\thtml>body #id-main-header-b-2 {\r\n\twidth: 100%;/*350px;*/\r\n\t/*top: 35px;*/\r\n}\r\n\r\n#id-main-header-c-1 {\r\n\tbackground-color: #cccc99;\r\n\tmargin-left: 0px;\r\n\tmargin-right: 0px;\r\n\tvoice-family: \"\\\"}\\\"\";\r\n\tvoice-family: inherit;\r\n\tmargin-left: 0px;\r\n\tmargin-right: 0px;\r\n\ttext-align: left;\r\n\theight: 4px;\r\n\tborder-bottom: 1px solid #666666;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size: 2pt;\r\n\tcolor: #666666;\r\n\t}\r\n\thtml>body #id-main-header-c-1 {\r\n\tmargin-left: 0px;\r\n\tmargin-right: 0px;\r\n\theight: 4px;\r\n}\r\n\r\n#id-main-header-d-1 {\r\n\tbackground-color: transparent;\r\n\tmargin-left: 165px;\r\n\tvoice-family: \"\\\"}\\\"\";\r\n\tvoice-family: inherit;\r\n\tmargin-left: 0px;\r\n\ttext-align: left;\r\n\theight: 30px;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size: 8pt;\r\n\tcolor: #666666;\r\n\tfont-weight: normal;\r\n\tpadding-top: 3px;\r\n}\r\nhtml>body #id-main-header-d-1 {\r\n\tmargin-left: 0px;\r\n\theight: 33px;\r\n}\r\n\r\n#id-main-header-d-2 {\r\n\tbackground-color: transparent;\r\n\tposition: absolute;\r\n\tright: 5px;\r\n\ttop: 69px;\r\n\theight: 30px;\r\n\ttext-align: right;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size: 8pt;\r\n\tcolor: #e1e1e1;\r\n}\r\nhtml>body #id-main-header-d-2 {\r\n\tline-height: 1.6;\r\n\tmargin-top:12px;\r\n}\r\n\r\n/* left side menu */\r\n#id-main-left {\r\n\t\t\t\t\tbackground-color: transparent;\r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\ttop: 110px;\r\n\t\t\t\t\twidth: 180px;\r\n\t\t\t\t\tpadding: 0px 5px;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml>body #id-main-left {\r\n\t\t\t\t\t/* these affect Mozilla and Safari */ \r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\ttop: 94px;\r\n\t\t\t\t\twidth: 180px;\r\n\t\t\t\t\tpadding: 0px 5px;\r\n}\r\n\r\n#id-main-left-fors {\r\n\t\t\t\t\tbackground-color: transparent;\r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\ttop: 78px;\r\n\t\t\t\t\twidth: 180px;\r\n\t\t\t\t\tpadding: 0px 5px;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml>body #id-main-left {\r\n\t\t\t\t\t/* these affect Mozilla and Safari */ \r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\ttop: 94px;\r\n\t\t\t\t\twidth: 180px;\r\n\t\t\t\t\tpadding: 0px 5px;\r\n}\r\n\r\n#id-below-main-left {\r\n\t\t\t\t\tbackground-color: transparent;\r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\ttop: 350px;\r\n\t\t\t\t\twidth: 175px;\r\n\t\t\t\t\tpadding: 0px 0px;\r\n\t\t\t\t\tmargin-right: 0px;\r\n\t\t\t\t\tpadding-left: 2px;\r\n\t\t\t\t\tpadding-bottom: 4px;\r\n\t\t\t\t\tpadding-top: 4px;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml>body #id-below-main-left {\r\n\t\t\t\t\t/* these affect Mozilla and Safari */ \r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\ttop: 334px;\r\n\t\t\t\t\twidth: 175px;\r\n\t\t\t\t\tpadding-left: 2px;\r\n\t\t\t\t\tpadding-bottom: 4px;\r\n\t\t\t\t\tpadding-top: 4px;\r\n\t\t\t\t\t\r\n}\r\n\r\n/* left side content area */\r\n#id-main-right {\r\n\t\t\t\t\tbackground-color: transparent;\r\n\t\t\t\t\tposition: relative;\r\n\t\t\t\t\ttop: -2px;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\t/* these two margins affect IE 5.5 */ \r\n\t\t\t\t\tmargin-left: 190px;\r\n\t\t\t\t\tvoice-family: \"\\\"}\\\"\";\r\n\t\t\t\t\tvoice-family: inherit;\r\n\t\t\t\t\t/* these two margins affect IE 6 */ \r\n\t\t\t\t\tmargin-left: 190px;\r\n\t\t\t\t\tmargin-right: 5px; \r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml>body #id-main-right {\r\n\t\t\t\t\t/* these affect Mozilla and Safari */ \r\n\t\t\t\t\tposition: relative;\r\n\t\t\t\t\ttop: 1px;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\tmargin-left: 190px;\r\n\t\t\t\t\tmargin-right: 5px;\r\n}\r\n\r\n/* left side menu */\r\n#id-main-right-header, .main-right-header {\r\n\t\t\t\t\tbackground-color: #cccc99;\r\n\t\t\t\t\tcolor: #000000;\r\n\t\t\t\t\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\t\t\t\t\tfont-size: 10pt;  /*change to small to allow scaling*/\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tpadding-left: 8px;\r\n\t\t\t\t\tpadding-bottom: 4px;\r\n\t\t\t\t\tpadding-top: 4px;\r\n\t\t\t\t\tborder-bottom: 1px solid #666666;\r\n\t\t\t\t\t/* these two margins affect IE 5.5 */\r\n\t\t\t\t\tmargin-right: 0px;\r\n\t\t\t\t\ttop: 95px;\r\n\t\t\t\t\tvoice-family: \"\\\"}\\\"\";\r\n\t\t\t\t\tvoice-family: inherit;\r\n\t\t\t\t\t/* these two margins affect IE 6 */\r\n\t\t\t\t\tmargin-right: 0px;\r\n}\r\n\r\n#id-main-contents-infobox \t{\r\n\t\t\t\t\tbackground-color: #ffffcc;\r\n\t\t\t\t\tcolor: #000000;\r\n\t\t\t\t\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\t\t\t\t\tfont-size: 10pt;  /*change to small to allow scaling*/\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tpadding-left: 8px;\r\n\t\t\t\t\tpadding-bottom: 4px;\r\n\t\t\t\t\tpadding-top: 4px;\r\n\t\t\t\t\tborder-bottom: 1px solid #666666;\r\n\t\t\t\t\t/* these two margins affect IE 5.5 */\r\n\t\t\t\t\tmargin-right: 0px;\r\n\t\t\t\t\ttop: 95px;\r\n\t\t\t\t\tvoice-family: \"\\\"}\\\"\";\r\n\t\t\t\t\tvoice-family: inherit;\r\n\t\t\t\t\t/* these two margins affect IE 6 */\r\n\t\t\t\t\tmargin-right: 0px; \r\n\t\t\r\n}\r\n\r\n#id-main-contents-subtitle \t{\r\n\t\t\t\t\tbackground-color: #cac8bb;\r\n\t\t\t\t\tcolor: #000000;\r\n\t\t\t\t\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\t\t\t\t\tfont-size: 10pt;  /*change to small to allow scaling*/\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tpadding-left: 8px;\r\n\t\t\t\t\tpadding-bottom: 4px;\r\n\t\t\t\t\tpadding-top: 4px;\r\n\t\t\t\t\t\r\n\t\t\t\t\t/* these two margins affect IE 5.5 */\r\n\t\t\t\t\tmargin-right: 0px;\r\n\t\t\t\t\ttop: 95px;\r\n\t\t\t\t\tvoice-family: \"\\\"}\\\"\";\r\n\t\t\t\t\tvoice-family: inherit;\r\n\t\t\t\t\t/* these two margins affect IE 6 */\r\n\t\t\t\t\tmargin-right: 0px; \r\n\t\t\r\n}\r\n\r\n\r\n#id-main-right-header-sub, .main-right-header-sub {\r\n\t\t\t\t\tbackground-color: #d8d8af;\r\n\t\t\t\t\tcolor: #000000;\r\n\t\t\t\t\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\t\t\t\t\tfont-size: 8pt;  /*change to x-small to allow scaling*/\r\n\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\tpadding-left: 5px;\r\n\t\t\t\t\tpadding-right: 5px;\r\n\t\t\t\t\tpadding-bottom: 0px;\r\n\t\t\t\t\tpadding-top: 4px;\r\n\t\t\t\t\tline-height: 150%;\r\n\t\t\t\t\tpadding-bottom: 5px;\r\n}\r\n\r\n\r\n/* main content area (used when no need for left menu area)*/\r\n#id-main {\r\n\t\t\t\t\tbackground-color: transparent;\r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\ttop: 100px;\r\n\t\t\t\t\tpadding: 0px 5px;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml>body #id-main {\r\n\t\t\t\t\t/* these affect Mozilla and Safari */ \r\n\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\ttop: 94px;\r\n\t\t\t\t\tmargin-right: 5px; \r\n\t\t\t\t\tpadding: 0px 5px;\r\n}\r\n\r\n#id-main-print {\r\n\r\n\t\t\t\t\tbackground-color: transparent;\r\n\t\t\t\t\tposition: relative;\r\n\t\t\t\t\t/* top: -2px; */\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\t/* these two margins affect IE 5.5 */ \r\n\t\t\t\t\tmargin-left: 5px;\r\n\t\t\t\t\tvoice-family: \"\\\"}\\\"\";\r\n\t\t\t\t\tvoice-family: inherit;\r\n\t\t\t\t\t/* these two margins affect IE 6 */ \r\n\t\t\t\t\tmargin-left: 0px;\r\n\t\t\t\t\tmargin-right: 5px; \r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml>body #id-main-print            {\r\n\t\t\t\t\t/* these affect Mozilla and Safari */ \r\n\t\t\t\t\tposition: relative;\r\n\t\t\t\t\ttop: 1px;\r\n\t\t\t\t\tleft: 0px;\r\n\t\t\t\t\tmargin-left: 0px;\r\n\t\t\t\t\tmargin-right: 5px;\r\n}\r\n\r\n\r\n\r\n.dead-Small\r\n{\r\n\tfont-family:Times New Roman;\r\n\tfont-weight:bold; \r\n\tfont-size:8px; \r\n\tcolor:Red;\r\n    margin-left: 5px;\r\n\tmargin-top:-15px;\r\n}\r\n\r\n.dead-Normal\r\n{\r\n\tfont-family:Times New Roman;\r\n\tfont-weight:bold; \r\n\tfont-size:34px; \r\n\ttext-align:center; \r\n\tcolor:Red; \r\n\tmargin-top:-65px;\r\n}\r\n\r\n#single-Photo-Dead\r\n{\r\n\tfont-family:Times New Roman;\r\n\tfont-weight:bold; \r\n\tfont-size:30px; \r\n\tcolor:Red; \r\n    margin-left:15px; \r\n\tmargin-top:-40px;\t\r\n}\r\n\r\n#medium-Photo-Dead, .dead-Medium {\r\n    color: Red;\r\n    font-family: Times New Roman;\r\n    font-size: 22px;\r\n    font-weight: bold;\r\n    margin-left: 2px;\r\n    position: absolute;\r\n    top: 180px;\r\n}\r\n-->",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 293,
          "bodySize": 9659
        },
        "cache": {},
        "timings": {
          "send": 98,
          "wait": 0,
          "receive": 2
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8636"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.615-07:00",
        "time": 19,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/omni/global-menu-styles.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 347,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1013"
            }
          ],
          "content": {
            "size": 3760,
            "compression": 0,
            "mimeType": "text/css",
            "text": "<!--\r\n\r\n/* \r\n\r\n\tDate File Created: November (20) 2006\r\n\tCreated By: Paul Cormie\r\n\tDate Last Modified: August (8) 2007\r\n\tLast Modified By: Victor Chong\r\n\tFile Summary: CSS classes used throughout the entire web application for Menus on left hand side\r\n\tCSS Contents: Menus\r\n\tTested: IE 5.5, IE 6.0, FireFox 2.0\r\n\r\n*/\r\n\r\nli {\r\n\t/* lists aligned to the left */\r\n\tfloat: bottom;\r\n}\r\n\r\nul.cls-menu-left {\r\n\tposition:relative;\r\n\ttop:-10px;\r\n\tleft:-40px;\r\n\tlist-style-type: none; /* suppression of useless elements */\r\n\tpadding-bottom:0px;\r\n\twidth: 100%; /* precision for Opera */\r\n}\r\n\r\nli.cls-menu-left {\r\n\twidth: 170px; \r\n\tmargin: 0px;\r\n\tdisplay: block;\r\n\ttext-align: left;\r\n\tborder-bottom: 1px solid #ffffff;\r\n\ttext-decoration: none;\r\n\tcolor: #000000;\r\n\tbackground: #ededcf;\r\n\tpadding-left:3px;\r\n\tpadding-right:3px;\r\n\tpadding-bottom:4px;\r\n\tpadding-top:4px;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\tbackground-image:url('../../images/menu-left/img-noarrow.gif');\r\n\tbackground-position:top right;\r\n\tbackground-repeat:no-repeat;\r\n}\r\n\r\n.cls-menu-left-header {\r\n\twidth: 169px; \r\n\tmargin: 0px;\r\n\tcolor: #000000;\r\n\tbackground-color: #cccc99;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size:10pt;  /*change to small to allow scaling*/\r\n\tfont-weight:bold;\r\n\tpadding-left:5px;\r\n\tpadding-bottom:4px;\r\n\tpadding-top:4px;\r\n\tborder-bottom: 1px solid #666666;\r\n}\r\n\r\n.cls-menu-left-header-inactive {\r\n\twidth: 170px; \r\n\tmargin: 0px;\r\n\tdisplay: block;\r\n\ttext-align: left;\r\n\tborder-bottom: 1px solid #ffffff;\r\n\ttext-decoration: none;\r\n\tcolor: #000000;\r\n\tbackground: #ededcf;\r\n\tpadding-left:5px;\r\n\tpadding-right:3px;\r\n\tpadding-bottom:4px;\r\n\tpadding-top:4px;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\tbackground-image:url('../../images/menu-left/img-noarrow.gif');\r\n\tbackground-position:top right;\r\n\tbackground-repeat:no-repeat;\r\n}\r\n\r\n.cls-menu-left-selected {\r\n\twidth: 170px; \r\n\tmargin: 0px;\r\n\tdisplay: block;\r\n\ttext-align: left;\r\n\tborder-bottom: 1px solid #ffffff;\r\n\ttext-decoration: none;\r\n\tcolor: #000000;\r\n\tbackground: #cccc99;\r\n\tpadding-left:5px;\r\n\tpadding-right:3px;\r\n\tpadding-bottom:4px;\r\n\tpadding-top:4px;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\tbackground-image:url('../../images/menu-left/img-arrow.gif');\r\n\tbackground-position:top right;\r\n\tbackground-repeat:no-repeat;\r\n}\r\n\r\n.cls-menu-left-inactive {\r\n\twidth: 170px; \r\n\tmargin: 0px;\r\n\tdisplay: block;\r\n\ttext-align: left;\r\n\tborder-bottom: 1px solid #ffffff;\r\n\ttext-decoration: none;\r\n\tcolor: #000000;\r\n\tpadding-left:2px;\r\n\tpadding-right:3px;\r\n\tpadding-bottom:2px;\r\n\tpadding-top:0px;\r\n}\r\n\r\n.cls-menu-left a {\r\n\twidth: 170px; \r\n\tmargin: 0px;\r\n\tdisplay: block;\r\n\ttext-align: left;\r\n\tborder-bottom: 1px solid #ffffff;\r\n\ttext-decoration: none;\r\n\tcolor: #000000;\r\n\tbackground: #ededcf;\r\n\tpadding-left:5px;\r\n\tpadding-right:3px;\r\n\tpadding-bottom:4px;\r\n\tpadding-top:4px;\r\n\tfont-family: verdana, arial, helvetica, sans-serif;\r\n\tfont-size:8pt;  /*change to x-small to allow scaling*/\r\n\tfont-weight:normal;\r\n\tbackground-image:url('../../images/menu-left/img-noarrow.gif');\r\n\tbackground-position:top right;\r\n\tbackground-repeat:no-repeat;\r\n}\r\n\r\n.cls-menu-left a:hover {\r\n\tbackground: #cccc99;\r\n\tbackground-image:url('../../images/menu-left/img-arrow.gif');\r\n\tbackground-position:top right;\r\n\tbackground-repeat:no-repeat;\r\n}\r\n\r\n.cls-menu-left a:active {\r\n\tbackground: #9d9d4f;\r\n\tcolor: #ffffff;\r\n\tbackground-image:url('../../images/menu-left/img-arrow-onclick.gif');\r\n\tbackground-position:top right;\r\n\tbackground-repeat:no-repeat;\r\n}\r\n\r\n-->",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 293,
          "bodySize": 3760
        },
        "cache": {},
        "timings": {
          "send": 3,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8631"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.615-07:00",
        "time": 27,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/omni/global-print-styles.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 348,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "359"
            }
          ],
          "content": {
            "size": 378,
            "compression": 0,
            "mimeType": "text/css",
            "text": "<!--\r\n\r\n/*\r\n\r\n\tDate File Created: March (7) 2007\r\n\tCreated By: Victor Chong\r\n\tDate Last Modified: March (7) 2007\r\n\tLast Modified By: Victor Chong\r\n\tFile Summary: CSS classes used throughout the entire web application specific to printed output\r\n\tCSS Contents: \"No print\" tag\r\n\tTested: IE 6.0\r\n\r\n*/\r\n\r\n.noprint {\r\n\tdisplay: none;\r\n}\r\n\r\n.linksasblack a {\r\n\tcolor: black;\r\n}\r\n\r\n-->",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 292,
          "bodySize": 378
        },
        "cache": {},
        "timings": {
          "send": 4,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8631"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.615-07:00",
        "time": 32,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/common-scripts.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 338,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "28999"
            }
          ],
          "content": {
            "size": 115532,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "LyoqIFJvdW5kcyBhIGRlY2ltYWwgdG8gdGhlIHNwZWNpZmllZCBudW1iZXIgb2Ygc2lnbmlmaWNhbnQgZGlnaXRzDQoqLw0KDQpmdW5jdGlvbiBhZGRVcmxQYXJhbSh1cmwsIHBhcmFtLCB2YWx1ZSkgew0KICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsNCiAgICAgYS5ocmVmID0gdXJsOw0KICAgICBhLnNlYXJjaCArPSBhLnNlYXJjaC5zdWJzdHJpbmcoMCwxKSA9PSAiPyIgPyAiJiIgOiAiPyI7DQogICAgIGEuc2VhcmNoICs9IGVuY29kZVVSSUNvbXBvbmVudChwYXJhbSk7DQogICAgIGlmICh2YWx1ZSkNCiAgICAgICAgIGEuc2VhcmNoICs9ICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7DQogICAgcmV0dXJuIGEuaHJlZjsNCn0NCg0KDQoNCmZ1bmN0aW9uIHJvdW5kRGVjaW1hbChudW0sZGVjaW1hbFBsYWNlcykgew0KCXZhciB0b1JldHVybiA9IE1hdGgucm91bmQobnVtKk1hdGgucG93KDEwLGRlY2ltYWxQbGFjZXMpKS9NYXRoLnBvdygxMCxkZWNpbWFsUGxhY2VzKTsNCglyZXR1cm4gdG9SZXR1cm47DQp9DQoNCmZ1bmN0aW9uIE1NX2dvVG9VUkwoKSB7IC8vdjMuMA0KCXZhciBpLCBhcmdzPU1NX2dvVG9VUkwuYXJndW1lbnRzOyBkb2N1bWVudC5NTV9yZXR1cm5WYWx1ZSA9IGZhbHNlOw0KCWZvciAoaT0wOyBpPChhcmdzLmxlbmd0aC0xKTsgaSs9MikgZXZhbChhcmdzW2ldKyIubG9jYXRpb249JyIrYXJnc1tpKzFdKyInIik7DQp9DQoNCmZ1bmN0aW9uIE1NX3ByZWxvYWRJbWFnZXMoKSB7IC8vdjMuMA0KCXZhciBkPWRvY3VtZW50OyBpZihkLmltYWdlcyl7IGlmKCFkLk1NX3ApIGQuTU1fcD1uZXcgQXJyYXkoKTsNCgl2YXIgaSxqPWQuTU1fcC5sZW5ndGgsYT1NTV9wcmVsb2FkSW1hZ2VzLmFyZ3VtZW50czsgZm9yKGk9MDsgaTxhLmxlbmd0aDsgaSsrKQ0KCWlmIChhW2ldLmluZGV4T2YoIiMiKSE9MCl7IGQuTU1fcFtqXT1uZXcgSW1hZ2U7IGQuTU1fcFtqKytdLnNyYz1hW2ldO319DQp9DQoNCmZ1bmN0aW9uIE1NX3N3YXBJbWdSZXN0b3JlKCkgeyAvL3YzLjANCiAgdmFyIGkseCxhPWRvY3VtZW50Lk1NX3NyOyBmb3IoaT0wO2EmJmk8YS5sZW5ndGgmJih4PWFbaV0pJiZ4Lm9TcmM7aSsrKSB4LnNyYz14Lm9TcmM7DQp9DQoNCmZ1bmN0aW9uIE1NX2ZpbmRPYmoobiwgZCkgeyAvL3Y0LjAxDQoJdmFyIHAsaSx4OyAgaWYoIWQpIGQ9ZG9jdW1lbnQ7IGlmKChwPW4uaW5kZXhPZigiPyIpKT4wJiZwYXJlbnQuZnJhbWVzLmxlbmd0aCkgew0KCWQ9cGFyZW50LmZyYW1lc1tuLnN1YnN0cmluZyhwKzEpXS5kb2N1bWVudDsgbj1uLnN1YnN0cmluZygwLHApO30NCglpZighKHg9ZFtuXSkmJmQuYWxsKSB4PWQuYWxsW25dOyBmb3IgKGk9MDsheCYmaTxkLmZvcm1zLmxlbmd0aDtpKyspIHg9ZC5mb3Jtc1tpXVtuXTsNCglmb3IoaT0wOyF4JiZkLmxheWVycyYmaTxkLmxheWVycy5sZW5ndGg7aSsrKSB4PU1NX2ZpbmRPYmoobixkLmxheWVyc1tpXS5kb2N1bWVudCk7DQoJaWYoIXggJiYgZC5nZXRFbGVtZW50QnlJZCkgeD1kLmdldEVsZW1lbnRCeUlkKG4pOyByZXR1cm4geDsNCn0NCg0KZnVuY3Rpb24gTU1fc3dhcEltYWdlKCkgeyAvL3YzLjANCgl2YXIgaSxqPTAseCxhPU1NX3N3YXBJbWFnZS5hcmd1bWVudHM7IGRvY3VtZW50Lk1NX3NyPW5ldyBBcnJheTsgZm9yKGk9MDtpPChhLmxlbmd0aC0yKTtpKz0zKQ0KCWlmICgoeD1NTV9maW5kT2JqKGFbaV0pKSE9bnVsbCl7ZG9jdW1lbnQuTU1fc3JbaisrXT14OyBpZigheC5vU3JjKSB4Lm9TcmM9eC5zcmM7IHguc3JjPWFbaSsyXTt9DQp9DQoNCmZ1bmN0aW9uIE1NX3JlbG9hZFBhZ2UoaW5pdCkgeyAgLy9yZWxvYWRzIHRoZSB3aW5kb3cgaWYgTmF2NCByZXNpemVkDQoJaWYgKGluaXQ9PXRydWUpIHdpdGggKG5hdmlnYXRvcikge2lmICgoYXBwTmFtZT09Ik5ldHNjYXBlIikmJihwYXJzZUludChhcHBWZXJzaW9uKT09NCkpIHsNCgkJZG9jdW1lbnQuTU1fcGdXPWlubmVyV2lkdGg7IGRvY3VtZW50Lk1NX3BnSD1pbm5lckhlaWdodDsgb25yZXNpemU9TU1fcmVsb2FkUGFnZTsgfX0NCgllbHNlIGlmIChpbm5lcldpZHRoIT1kb2N1bWVudC5NTV9wZ1cgfHwgaW5uZXJIZWlnaHQhPWRvY3VtZW50Lk1NX3BnSCkgbG9jYXRpb24ucmVsb2FkKCk7DQp9DQpNTV9yZWxvYWRQYWdlKHRydWUpOw0KDQoNCg0KDQoNCmZ1bmN0aW9uIE1NX3Nob3dIaWRlTGF5ZXJzKCkgeyAvL3Y2LjANCgl2YXIgaSxwLHYsb2JqLGFyZ3M9TU1fc2hvd0hpZGVMYXllcnMuYXJndW1lbnRzOw0KCWZvciAoaT0wOyBpPChhcmdzLmxlbmd0aC0yKTsgaSs9MykgaWYgKChvYmo9TU1fZmluZE9iaihhcmdzW2ldKSkhPW51bGwpIHsNCgkJdj1hcmdzW2krMl07DQoJCWlmIChvYmouc3R5bGUpIHsNCgkJCWlmICh0eXBlb2Yod2luZG93LmV2ZW50KSAhPSAidW5kZWZpbmVkIikgey8vIElFIG9ubHkNCgkJCQlvYmouc3R5bGUubGVmdCA9IHdpbmRvdy5ldmVudC5jbGllbnRYKydweCc7DQoJCQl9DQoJCQllbHNlIHsgLy8gRkYgLSBuZWVkIHRvIHBhc3MgaW4gRXZlbnQgYXMgYSBwYXJhbWV0ZXINCg0KCQkJfQ0KCQkJb2JqPW9iai5zdHlsZTsgdj0odj09J3Nob3cnKT8ndmlzaWJsZSc6KHY9PSdoaWRlJyk/J2hpZGRlbic6djsNCg0KCQl9DQoJCW9iai52aXNpYmlsaXR5PXY7DQoJfQ0KfQ0KDQovKg0KCVBsZWFzZSBrZWVwIHRoZSBmb2xsb3dpbmcgbGluZXMgdmlzaWJsZSwgaW4gcmVjb2duaXRpb24gb2YgbXkgd29yay4uLg0KCSoqKioqKioqKioqKioqKioqKioqKioqKg0KCUF1dGhvcjogTWF4IEhvbG1hbiA8bWF4QGJsdWVyb28ubmV0Pg0KCURhdGUgIDogU3VuLCAyMSBKYW4gMjAwMQ0KCSoqKioqKioqKioqKioqKioqKioqKioqKg0KCVRoaXMgZnVuY3Rpb25zIGxldHMgdXNlcnMgdHlwZSBpbiBsZXR0ZXJzIHRvIHNlbGVjdCBhbiBvcHRpb24gaW4geW91ciBTRUxFQ1QgZm9ybSBmaWVsZHMuDQoJVXN1YWxseSB0aGUgYnJvd3NlciBvbmx5IHRha2VzIG5vdGljZSBvZiBzaW5nbGUga2V5c3Ryb2tlcyBhbmQgc3dpdGNoZXMgdG8gdGhlIGZpcnN0IE9wdGlvbiB0aGF0DQoJYmVnaW5zIHdpdGggdGhhdCBsZXR0ZXIuDQoJVGhpcyBzY3JpcHRzIGJ1ZmZlcnMgdGhlIHVzZXJzIGlucHV0IGFuZCBjb21wYXJlcyBpdCBhZ2FpbnN0IHRoZSBPUFRJT05zIGluIHRoZSBTRUxFQ1QgZmllbGQsDQoJY2hvb3NpbmcgdGhlIGNsb3Nlc3QgbWF0Y2ggYXMgeW91IHR5cGUNCglVc2FnZToJPHNlbGVjdCBvbmtleXByZXNzPSJyZXR1cm4gc2hpZnRIaWdobGlnaHQoZXZlbnQua2V5Q29kZSwgdGhpcyk7Ij4NCiovDQp2YXIgdGltZXJpZCAgICAgPSBudWxsOw0KdmFyIG1hdGNoU3RyaW5nID0gIiI7DQp2YXIgbXNlY29uZHMgICAgPSAyMDAwOwkvLyBMZW5ndGggb2YgdGltZSBiZWZvcmUgc2VhcmNoIHN0cmluZyBpcyByZXNldA0KdmFyIGN1cnJlbnRUYXJnZXQgPSBudWxsOw0KDQpmdW5jdGlvbiBzaGlmdEhpZ2hsaWdodChrZXlDb2RlLHRhcmcsIGRpc2FibGVPbkNoYW5nZUZpcmluZykgew0KCXZhciBmb3VuZE9wdGlvbiA9IGZhbHNlOw0KCWlmKGN1cnJlbnRUYXJnZXQgIT0gdGFyZykgew0KCQlpZih0aW1lcmlkICE9IG51bGwpIHsNCgkJCWNsZWFyVGltZW91dCh0aW1lcmlkKTsgLy8gQ2xlYXIgdGhlIHRpbWVvdXQNCgkJCW1hdGNoU3RyaW5nID0gIiI7DQoJCX0NCgl9DQoJY3VycmVudFRhcmdldCA9IHRhcmc7DQoNCgl2YXIga2V5VmFsICAgICAgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGtleUNvZGUpOyAvLyBDb252ZXJ0IEFTQ0lJIENvZGUgdG8gYSBzdHJpbmcNCgltYXRjaFN0cmluZyA9IG1hdGNoU3RyaW5nICsga2V5VmFsOyAvLyBBZGQgdG8gcHJldmlvdXNseSB0eXBlZCBjaGFyYWN0ZXJzDQoNCgl2YXIgZWxlbWVudENudCAgPSB0YXJnLmxlbmd0aCAtIDE7CS8vIENhbGN1bGF0ZSBsZW5ndGggb2YgYXJyYXkgLTENCg0KCWZvciAoaSA9IGVsZW1lbnRDbnQ7IGkgPiAwOyBpLS0pIHsNCgkJc2VsZWN0VGV4dCA9IHRhcmcub3B0aW9uc1tpXS50ZXh0LnRvTG93ZXJDYXNlKCk7IC8vIGNvbnZlcnQgdGV4dCBpbiBTRUxFQ1QgdG8gbG93ZXIgY2FzZQ0KDQoJCWlmIChzZWxlY3RUZXh0LnN1YnN0cigwLG1hdGNoU3RyaW5nLmxlbmd0aCkgPT0gCW1hdGNoU3RyaW5nLnRvTG93ZXJDYXNlKCkpIHsNCgkJCXRhcmcub3B0aW9uc1tpXS5zZWxlY3RlZCA9IHRydWU7IC8vIE1ha2UgdGhlIHJlbGV2YW50IE9QVElPTiBzZWxlY3RlZA0KCQkJZm91bmRPcHRpb24gPSB0cnVlOw0KCQl9DQoJfQ0KDQoJY2xlYXJUaW1lb3V0KHRpbWVyaWQpOyAvLyBDbGVhciB0aGUgdGltZW91dA0KCXRpbWVyaWQgPSBzZXRUaW1lb3V0KCdtYXRjaFN0cmluZyA9ICIiJyxtc2Vjb25kcyk7IC8vIFNldCBhIG5ldyB0aW1lb3V0IHRvIHJlc2V0IHRoZSBrZXkgcHJlc3Mgc3RyaW5nDQoNCg0KCWlmKCFkaXNhYmxlT25DaGFuZ2VGaXJpbmcpIHsNCgkJaWYoZm91bmRPcHRpb24gJiYgdGFyZy5vbmNoYW5nZSkgew0KCQkJdGFyZy5vbmNoYW5nZSgpOw0KCQl9DQoJfQ0KDQoJcmV0dXJuIGZhbHNlOyAvLyB0byBwcmV2ZW50IElFIGZyb20gZG9pbmcgaXRzIG93biBoaWdobGlnaHQgc3dpdGNoaW5nDQp9DQoNCmZ1bmN0aW9uIG11bHR5VHlwZUFoZWFkKGtleUNvZGUsdGFyZykgew0KDQoJdmFyIGtleVZhbCAgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGtleUNvZGUpOyAvLyBDb252ZXJ0IEFTQ0lJIENvZGUgdG8gYSBzdHJpbmcNCgltYXRjaFN0cmluZyA9IG1hdGNoU3RyaW5nICsga2V5VmFsOyAvLyBBZGQgdG8gcHJldmlvdXNseSB0eXBlZCBjaGFyYWN0ZXJzDQogICAgICAgIC8vYWxlcnQoIiMjI21hdGNoU3RyaW5nPVsiK21hdGNoU3RyaW5nKyJdIik7DQoJdmFyIGVsZW1lbnRDbnQgID0gdGFyZy5sZW5ndGggLSAxOwkvLyBDYWxjdWxhdGUgbGVuZ3RoIG9mIGFycmF5IC0xDQoJLy9DUTE1OTUwIC0gdHJhY2sgaWYgd2UgZm91bmQgYSByZXN1bHQgYWxyZWFkeQ0KCXZhciBmb3VuZE1hdGNoID0gZmFsc2U7DQoNCglmb3IgKGkgPSAwOyBpIDw9IGVsZW1lbnRDbnQ7IGkrKykgew0KCQlzZWxlY3RUZXh0ID0gdGFyZy5vcHRpb25zW2ldLnRleHQudG9Mb3dlckNhc2UoKTsgLy8gY29udmVydCB0ZXh0IGluIFNFTEVDVCB0byBsb3dlciBjYXNlDQoJCXRhcmcub3B0aW9uc1tpXS5zZWxlY3RlZCA9IGZhbHNlOyAvLyBNYWtlIGFub3RoZXIgT1BUSU9OIGRlc2VsZWN0ZWQNCgkJaWYgKCFmb3VuZE1hdGNoICYmIChzZWxlY3RUZXh0LnN1YnN0cigwLG1hdGNoU3RyaW5nLmxlbmd0aCkgPT0gCW1hdGNoU3RyaW5nLnRvTG93ZXJDYXNlKCkpKSB7DQoJCSAgICAgICAvLyBhbGVydCgiIyMjc2VsZWN0VGV4dFsiK2krIl09IitzZWxlY3RUZXh0KTsNCgkJCXRhcmcub3B0aW9uc1tpXS5zZWxlY3RlZCA9IHRydWU7IC8vIE1ha2UgdGhlIHJlbGV2YW50IE9QVElPTiBzZWxlY3RlZA0KCQkJdGFyZy5vcHRpb25zW2ldLmZvY3VzKCk7DQoJCQkvL0NRMTU5NTAgLSBuZWVkIHRvIGtlZXAgc2VhcmNoaW5nIHRoZSBib3gsIHNvIHdlIGtlZXAgZGVzZWxlY3RpbmcgdGhlIG90aGVyIG9wdGlvbnMNCgkJCS8vYnJlYWs7DQoJCQkvL0NRMTU5NTAgLSBhZGQgdGhhdCB3ZSBmb3VuZCBhIG1hdGNoLCBzbyB3ZSBkb24ndCBrZWVwIG1hdGNoaW5nIHRoZSBzYW1lIHBocmFzZSBvbiBtb3JlIHRoYW4gb25lIG9wdGlvbg0KCQkJZm91bmRNYXRjaCA9IHRydWU7DQoJCX0NCgl9DQoNCgljbGVhclRpbWVvdXQodGltZXJpZCk7IC8vIENsZWFyIHRoZSB0aW1lb3V0DQoJdGltZXJpZCA9IHNldFRpbWVvdXQoJ21hdGNoU3RyaW5nID0gIiInLG1zZWNvbmRzKTsgLy8gU2V0IGEgbmV3IHRpbWVvdXQgdG8gcmVzZXQgdGhlIGtleSBwcmVzcyBzdHJpbmcNCg0KCXJldHVybiBmYWxzZTsgLy8gdG8gcHJldmVudCBJRSBmcm9tIGRvaW5nIGl0cyBvd24gaGlnaGxpZ2h0IHN3aXRjaGluZw0KfQ0KDQpmdW5jdGlvbiBmb2N1c0VsZW1lbnQoZWxlbWVudElEKSB7DQoJdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SUQpOw0KDQoJaWYoZWxlbWVudCAhPSBudWxsKSB7DQoJCXRyeXsNCgkJCWVsZW1lbnQuZm9jdXMoKTsNCgkJfSBjYXRjaChlKXsNCgkJfQ0KCX0NCn0NCg0KZnVuY3Rpb24gc2hvd0VsZW1lbnQoZWxlbWVudElELCBkaXNwbGF5KSB7DQoJdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SUQpOw0KCWlmIChkaXNwbGF5ID09IG51bGwpDQoJCWRpc3BsYXk9J2lubGluZSc7DQoNCglpZihlbGVtZW50ICE9IG51bGwpIHsNCg0KCQllbGVtZW50LnN0eWxlLmRpc3BsYXk9ZGlzcGxheTsNCg0KDQoNCg0KCQkJZWxlbWVudC5zdHlsZS52aXNpYmlsaXR5PSdpbmhlcml0JzsNCg0KCX0NCn0NCg0KDQpmdW5jdGlvbiBoaWRlRWxlbWVudChlbGVtZW50SUQpIHsNCgl2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJRCk7DQoNCglpZihlbGVtZW50ICE9IG51bGwpIHsNCgkJaWYgKGVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSAhPSAnaGlkZGVuJykNCgkJew0KCQkJZWxlbWVudC5zdHlsZS5kaXNwbGF5PSdub25lJzsNCg0KCQkJZWxlbWVudC5zdHlsZS52aXNpYmlsaXR5PSdoaWRkZW4nOw0KCQl9DQoNCg0KCX0NCn0NCi8vIEJVRyBGSVggRk9SIE9NTkkwMDAwMTEyMg0KDQpmdW5jdGlvbiBjdXN0b21Db21wYXJlKGZpcnN0RWxlbWVudCwgc2Vjb25kRWxlbWVudCkNCnsNCiAgdmFyIHJldFZhbHVlID0gMDsNCiAgaWYgKGZpcnN0RWxlbWVudCA9PSBudWxsKQ0KICB7DQogICAgICByZXRWYWx1ZSA9IDA7DQogICB9DQogICBlbHNlIGlmIChzZWNvbmRFbGVtZW50ID09IG51bGwpDQogICB7DQogICAgICByZXRWYWx1ZSA9IC0xOw0KICAgfQ0KICAgZWxzZSBpZiAoZmlyc3RFbGVtZW50ID09IG51bGwgJiYgc2Vjb25kRWxlbWVudCA9PSBudWxsKQ0KICAgew0KICAgICAgcmV0VmFsdWUgPSAwOw0KICAgfQ0KDQogICBpZiAoIHR5cGVvZihmaXJzdEVsZW1lbnQpID09ICdzdHJpbmcnICYmIHR5cGVvZihzZWNvbmRFbGVtZW50KSA9PSAnc3RyaW5nJykNCiAgIHsNCiAgICAgICBpZiAoIGZpcnN0RWxlbWVudC50b0xvd2VyQ2FzZSgpIDwgc2Vjb25kRWxlbWVudC50b0xvd2VyQ2FzZSgpKQ0KICAgICAgIHsNCiAgICAgICAgIHJldFZhbHVlID0gLTE7DQogICAgICAgfQ0KICAgICAgIGVsc2UgaWYgKCBmaXJzdEVsZW1lbnQudG9Mb3dlckNhc2UoKSA+IHNlY29uZEVsZW1lbnQudG9Mb3dlckNhc2UoKSkNCiAgICAgICB7DQogICAgICAgICByZXRWYWx1ZSA9IDE7DQogICAgICAgfQ0KICAgICAgIGVsc2UgaWYgKGZpcnN0RWxlbWVudC50b0xvd2VyQ2FzZSgpID09IHNlY29uZEVsZW1lbnQudG9Mb3dlckNhc2UoKSkNCiAgICAgICB7DQogICAgICAgCSAgcmV0VmFsdWUgPSAwOw0KICAgICAgIH0NCiAgIH0NCg0KICAgcmV0dXJuIHJldFZhbHVlOw0KfQ0KZnVuY3Rpb24gdHJpbUFsbChzU3RyaW5nKQ0Kew0Kd2hpbGUgKHNTdHJpbmcuc3Vic3RyaW5nKDAsMSkgPT0gJyAnKQ0Kew0Kc1N0cmluZyA9IHNTdHJpbmcuc3Vic3RyaW5nKDEsIHNTdHJpbmcubGVuZ3RoKTsNCn0NCndoaWxlIChzU3RyaW5nLnN1YnN0cmluZyhzU3RyaW5nLmxlbmd0aC0xLCBzU3RyaW5nLmxlbmd0aCkgPT0gJyAnKQ0Kew0Kc1N0cmluZyA9IHNTdHJpbmcuc3Vic3RyaW5nKDAsc1N0cmluZy5sZW5ndGgtMSk7DQp9DQpyZXR1cm4gc1N0cmluZzsNCn0NCi8vIEVORCBGSVgNCjwhLS0gT3JpZ2luYWw6ICBQaGlsIFdlYmIgKHBoaWxAcGhpbHdlYmIuY29tKSAtLT4NCjwhLS0gV2ViIFNpdGU6ICBodHRwOi8vd3d3LnBoaWx3ZWJiLmNvbSAtLT4NCg0KPCEtLSBUaGlzIHNjcmlwdCBhbmQgbWFueSBtb3JlIGFyZSBhdmFpbGFibGUgZnJlZSBvbmxpbmUgYXQgLS0+DQo8IS0tIFRoZSBKYXZhU2NyaXB0IFNvdXJjZSEhIGh0dHA6Ly9qYXZhc2NyaXB0LmludGVybmV0LmNvbSAtLT4NCg0KZnVuY3Rpb24gbW92ZUxpc3QoZnJib3gsIHRvYm94KSB7DQoJdmFyIGZib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmcmJveCk7DQoJdmFyIHRib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0b2JveCk7DQoJdmFyIGFyckZib3ggPSBuZXcgQXJyYXkoKTsNCgl2YXIgYXJyVGJveCA9IG5ldyBBcnJheSgpOw0KCXZhciBpOw0KDQoJZm9yIChpID0gMDsgaSA8IHRib3gub3B0aW9ucy5sZW5ndGg7IGkrKykgew0KCQlhcnJUYm94W2ldID0gdGJveC5vcHRpb25zW2ldOw0KCX0NCg0KCXZhciBmTGVuZ3RoID0gMDsNCgl2YXIgdExlbmd0aCA9IGFyclRib3gubGVuZ3RoOw0KCWZvcihpID0gMDsgaSA8IGZib3gub3B0aW9ucy5sZW5ndGg7IGkrKykgew0KCQlpZiAoZmJveC5vcHRpb25zW2ldLnNlbGVjdGVkICYmIGZib3gub3B0aW9uc1tpXS52YWx1ZSAhPSAiIikgew0KCQkJYXJyVGJveFt0TGVuZ3RoXSA9IGZib3gub3B0aW9uc1tpXTsNCgkJCXRMZW5ndGgrKzsNCgkJfSBlbHNlIHsNCgkJCWFyckZib3hbZkxlbmd0aF0gPSBmYm94Lm9wdGlvbnNbaV07DQoJCQlmTGVuZ3RoKys7DQoJCX0NCgl9DQoJYXJyRmJveC5zb3J0KG9wdGlvbkNvbXBhcmUpOw0KCWFyclRib3guc29ydChvcHRpb25Db21wYXJlKTsNCg0KCWZib3gubGVuZ3RoID0gMDsNCgl0Ym94Lmxlbmd0aCA9IDA7DQoJdmFyIGM7DQoJZm9yKGMgPSAwOyBjIDwgYXJyRmJveC5sZW5ndGg7IGMrKykgew0KCQl2YXIgbm8gPSBuZXcgT3B0aW9uKCk7DQoJCW5vLnRleHQgPSBhcnJGYm94W2NdLnRleHQ7DQoJCW5vLnZhbHVlID0gYXJyRmJveFtjXS52YWx1ZTsNCgkJbm8uZGVmYXVsdFNlbGVjdGVkID0gdHJ1ZTsNCgkJbm8uc2VsZWN0ZWQgPSBmYWxzZTsNCgkJaWYobm8udmFsdWUgIT0gbnVsbCkgew0KCQkJZmJveFtjXSA9IG5vOw0KCQl9DQoJfQ0KDQoJZm9yKGMgPSAwOyBjIDwgYXJyVGJveC5sZW5ndGg7IGMrKykgew0KCQl2YXIgbm8gPSBuZXcgT3B0aW9uKCk7DQoJCW5vLnRleHQgPSBhcnJUYm94W2NdLnRleHQ7DQoJCW5vLnZhbHVlID0gYXJyVGJveFtjXS52YWx1ZTsNCgkJbm8uZGVmYXVsdFNlbGVjdGVkID0gdHJ1ZTsNCgkJbm8uc2VsZWN0ZWQgPSBmYWxzZTsNCgkJaWYobm8udmFsdWUgIT0gbnVsbCkgew0KCQkJdGJveFtjXSA9IG5vOw0KCQl9DQoJfQ0KfQ0KDQpmdW5jdGlvbiBvcHRpb25Db21wYXJlKG9wdGlvbjEsIG9wdGlvbjIpDQp7DQogIHZhciByZXRWYWx1ZSA9IDA7DQogIGlmIChvcHRpb24xID09IG51bGwgfHwgb3B0aW9uMS50ZXh0KQ0KICB7DQogICAgICByZXRWYWx1ZSA9IDA7DQogICB9DQogICBlbHNlIGlmIChvcHRpb24yID09IG51bGwgfHwgb3B0aW9uMi50ZXh0KQ0KICAgew0KICAgICAgcmV0VmFsdWUgPSAtMTsNCiAgIH0NCiAgIGVsc2UgaWYgKG9wdGlvbjEgPT0gbnVsbCAmJiBvcHRpb24yID09IG51bGwpDQogICB7DQogICAgICByZXRWYWx1ZSA9IDA7DQogICB9DQoNCiAgIGlmICggdHlwZW9mKG9wdGlvbjEudGV4dCkgPT0gJ3N0cmluZycgJiYgdHlwZW9mKG9wdGlvbjIudGV4dCkgPT0gJ3N0cmluZycpDQogICB7DQogICAgICAgaWYgKCBvcHRpb24xLnRleHQudG9Mb3dlckNhc2UoKSA8IG9wdGlvbjIudGV4dC50b0xvd2VyQ2FzZSgpKQ0KICAgICAgIHsNCiAgICAgICAgIHJldFZhbHVlID0gLTE7DQogICAgICAgfQ0KICAgICAgIGVsc2UgaWYgKCBvcHRpb24xLnRleHQudG9Mb3dlckNhc2UoKSA+IG9wdGlvbjIudGV4dC50b0xvd2VyQ2FzZSgpKQ0KICAgICAgIHsNCiAgICAgICAgIHJldFZhbHVlID0gMTsNCiAgICAgICB9DQogICAgICAgZWxzZSBpZiAob3B0aW9uMS50ZXh0LnRvTG93ZXJDYXNlKCkgPT0gb3B0aW9uMi50ZXh0LnRvTG93ZXJDYXNlKCkpDQogICAgICAgew0KICAgICAgIAkgIHJldFZhbHVlID0gMDsNCiAgICAgICB9DQogICB9DQoNCiAgIHJldHVybiByZXRWYWx1ZTsNCn0NCg0KZnVuY3Rpb24gZ2V0U2VsZWN0ZWRPcHRpb25JZEZyb21MaXN0KG9ialNlbGVjdExpc3QpIHsNCgl2YXIgbnVtID0gb2JqU2VsZWN0TGlzdC5vcHRpb25zLmxlbmd0aDsNCglmb3IgKHZhciBpID0gMDsgaSA8IG51bTsgaSsrKSB7DQoJCWlmKG9ialNlbGVjdExpc3Qub3B0aW9uc1tpXS5zZWxlY3RlZCkgew0KCQkJcmV0dXJuIG9ialNlbGVjdExpc3Qub3B0aW9uc1tpXS52YWx1ZTsNCgkJfQ0KCX0NCglyZXR1cm4gIiI7DQp9DQoNCmZ1bmN0aW9uIGdldFNlbGVjdGVkT3B0aW9uVGV4dEZyb21MaXN0KG9ialNlbGVjdExpc3QpIHsNCgl2YXIgbnVtID0gb2JqU2VsZWN0TGlzdC5vcHRpb25zLmxlbmd0aDsNCglmb3IgKHZhciBpID0gMDsgaSA8IG51bTsgaSsrKSB7DQoJCWlmKG9ialNlbGVjdExpc3Qub3B0aW9uc1tpXS5zZWxlY3RlZCkgew0KCQkJcmV0dXJuIG9ialNlbGVjdExpc3Qub3B0aW9uc1tpXS50ZXh0Ow0KCQl9DQoJfQ0KCXJldHVybiAiIjsNCn0NCg0KZnVuY3Rpb24gc2VsZWN0T3B0aW9uSW5MaXN0KG9iakxpc3QsIG5ld1NlbGVjdGVkSWQpIHsNCgl2YXIgbGVuID0gb2JqTGlzdC5vcHRpb25zLmxlbmd0aDsNCglpZiAobGVuID4gMCkgew0KCQlmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQoJCQlpZihvYmpMaXN0Lm9wdGlvbnNbaV0udmFsdWUgPT0gbmV3U2VsZWN0ZWRJZCkgew0KCQkJCW9iakxpc3Qub3B0aW9uc1tpXS5zZWxlY3RlZCA9IHRydWU7DQoJCQkJYnJlYWs7DQoJCQl9DQoJCX0NCgl9DQp9DQoNCmZ1bmN0aW9uIHNlbGVjdEFsbE9wdGlvbnMob2JqTGlzdCkgew0KCXZhciBsZW4gPSBvYmpMaXN0Lm9wdGlvbnMubGVuZ3RoOw0KCWlmIChsZW4gPiAwKSB7DQoJCWZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCgkJCW9iakxpc3Qub3B0aW9uc1tpXS5zZWxlY3RlZCA9IHRydWU7DQoJCX0NCgl9DQp9DQoNCmZ1bmN0aW9uIG1vdmVBbGxMaXN0KGZyb21MaXN0LHRvTGlzdCl7DQogICAgc2VsZWN0QWxsT3B0aW9ucyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmcm9tTGlzdCkpOw0KICAgIG1vdmVMaXN0KGZyb21MaXN0LCB0b0xpc3QpOw0KfQ0KDQoNCg0KdmFyIGN1cnJlbnRPbW5pRm9ybSA9IG51bGw7DQp2YXIgaGFzQ3VycmVudE9tbmlGb3JtU3VibWl0dGVkID0gZmFsc2U7DQp2YXIgaGFzV2FybmluZ01lc3NhZ2VGb3JGb3JtQ2hhbmdlZE9jY3VycmVkID0gZmFsc2U7DQoNCi8vQ1IgNDM5NQ0KZnVuY3Rpb24gc2V0Q3VycmVudEZvcm0ob2JqRm9ybSkgew0KCWN1cnJlbnRPbW5pRm9ybSA9IG9iakZvcm07DQp9DQoNCmZ1bmN0aW9uIG9uRm9ybUNoYW5nZUluaXQob2JqRm9ybSkgew0KCWlmKG9iakZvcm0gIT0gbnVsbCkgew0KCQljdXJyZW50T21uaUZvcm0gPSBvYmpGb3JtOw0KCQlhZGRFdmVudCh3aW5kb3csICdsb2FkJywgYWRkT25Gb3JtQ2hhbmdlTGlzdGVuZXJzLCBmYWxzZSk7DQoNCgkJLy9ESVNBQkxFRDogV29ya3Mgd2l0aCBvbmJlZm9yZXVubG9hZCBldmVudA0KCQkvL2FkZEV2ZW50KGN1cnJlbnRPbW5pRm9ybSwgJ3N1Ym1pdCcsIG9uU3VibWl0RXZlbnRIYW5kbGVyLCBmYWxzZSk7DQoJCS8vd2luZG93Lm9uYmVmb3JldW5sb2FkID0gb25CZWZvcmVVbmxvYWRFdmVudEhhbmRsZXI7DQoJfSBlbHNlIHsNCgkJY3VycmVudE9tbmlGb3JtID0gbnVsbDsNCgl9DQp9DQoNCi8qKg0KKiBOZXcgbWV0aG9kIHRvIHJlcGxhY2UgdGhlIHByZXZpb3VzIG9uZSAob25Gb3JtQ2hhbmdlSW5pdCkgd2hpY2ggZG9lcyBhIGJldHRlciBqb2Igb2YgaGFuZGxpbmcgdGhlIGNoYW5nZSBldmVudHMNCioNCiogVGhpcyBpbXBsZW1lbnRhdGlvbiB3aWxsIGFkZCBhbiBvbkNoYW5nZSBldmVudCB0byBldmVyeQ0KKiBlbGVtZW50IG9uIHRoZSBmb3JtIGluc3RlYWQgb2Ygc2ltcGx5IGFkZGluZyBhbiBvbkNsaWNrIGV2ZW50IHRvIHRoZSBmb3JtIGVsZW1lbnQgaXRzZWxmLiAgVGhlDQoqIG9yaWdpbmFsIGltcGxlbWVudGF0aW9uIGRvZXMgbm90IHByb3Blcmx5IGhhbmRsZSBjaGFuZ2UgZXZlbnRzIChpZS4gYSB1c2VyIGNoYW5nZXMgYSB0ZXh0IGZpZWxkIGFuZCBjbGlja3Mgb3V0c2lkZQ0KKiBvZiB0aGUgZm9ybSBhbmQgc3VibWl0cyB0aGUgZm9ybSkNCiovDQovLyBUaGlzIHZhcmlhYmxlIGlzIHRvIHRyYWNrIGhvdyB3ZSBpbml0aWFsaXplZCB0aGUgZm9ybS4gIEJ5IGluaXRpYWxpemluZyB1c2luZyB0aGlzIG1ldGhvZCwNCi8vIHdlIG5vIGxvbmdlciBkbyBjb21wbGV0ZSBET00gc2NhbnMgbG9va2luZyBmb3IgY2hhbmdlcywgYnV0IHJlbHkgb24gZWFjaCBlbGVtZW50cyBvbmNoYW5nZQ0KLy8gZXZlbnQgbGlzdGVuZXIgdG8gc2V0IGlzRGlydHkgYXBwcm9wcmlhdGVseS4NCnZhciB1c2VkRm9ybUVsZW1lbnRDaGFuZ2VJbml0ID0gZmFsc2U7DQpmdW5jdGlvbiBvbkZvcm1FbGVtZW50Q2hhbmdlSW5pdChmb3JtKSB7DQoJdXNlZEZvcm1FbGVtZW50Q2hhbmdlSW5pdCA9IHRydWU7DQoJY3VycmVudE9tbmlGb3JtID0gZm9ybTsNCg0KCS8vIFRoaXMgZG9lcyBub3Qgd29yayBmb3IgSUV4cGxvcmVyLiBNU0ROIC0gIlRoZSBzdWJtaXQgbWV0aG9kIGRvZXMgbm90IGludm9rZSB0aGUgb25zdWJtaXQgZXZlbnQgaGFuZGxlci4iDQoJLy9hZGRFdmVudChmb3JtLCAnc3VibWl0Jywgc3VibWl0RXZlbnQsIGZhbHNlKTsNCglpZiAodHlwZW9mIGZvcm0gIT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGZvcm0uZWxlbWVudHMgIT0gJ3VuZGVmaW5lZCcpIHsNCgkJDQoJCXZhciBlbGVtcyA9IGdldElucHV0RWxlbWVudHMoZm9ybSk7DQoJCQ0KCQlmb3IgKCBqPTA7ajwgZWxlbXMubGVuZ3RoOyBqKysgKSB7DQoJCQl2YXIgZWxlbSA9IGVsZW1zW2pdOw0KCQkJYWRkRXZlbnQoZWxlbSwgJ2NoYW5nZScsIG9uRWxlbUNoYW5nZUV2ZW50LCBmYWxzZSk7DQoJCX0NCgl9DQp9DQoNCi8vIGZpbmRzIGFsbCBlbmFibGVkIGNoaWxkIGZvcm0gZWxlbWVudHMgaW5zaWRlIHRoaXMgcGFyZW50IG9iamVjdA0KZnVuY3Rpb24gZ2V0SW5wdXRFbGVtZW50cyhwYXJlbnQpIHsNCgkvL0NRMjg0NjEgLSBtYWtlIHRoZSBmb3ItbG9vcCBtb3JlIGVmZmljaWVudCBieSBub3Qgc2VsZWN0aW5nIHR5cGVzIHdlIGRvbid0IHdhbnQgKGllLiBoaWRkZW4sIHN1Ym1pdCwgaW1hZ2UsIGV0Yy4uLikNCgl2YXIgcCA9ICQocGFyZW50KTsNCgl2YXIgZWxlbXMgPSBwLmZpbmQoJ2lucHV0OmVuYWJsZWRbdHlwZT10ZXh0XScpOw0KCWVsZW1zID0gJC5tZXJnZShlbGVtcywgcC5maW5kKCdpbnB1dDplbmFibGVkW3R5cGU9Y2hlY2tib3hdJykpOw0KCWVsZW1zID0gJC5tZXJnZShlbGVtcywgcC5maW5kKCdpbnB1dDplbmFibGVkW3R5cGU9cmFkaW9dJykpOw0KCWVsZW1zID0gJC5tZXJnZShlbGVtcywgcC5maW5kKCdpbnB1dDplbmFibGVkW3R5cGU9ZmlsZV0nKSk7DQoJZWxlbXMgPSAkLm1lcmdlKGVsZW1zLCBwLmZpbmQoJ2lucHV0OmVuYWJsZWRbdHlwZT1wYXNzd29yZF0nKSk7DQoJZWxlbXMgPSAkLm1lcmdlKGVsZW1zLCBwLmZpbmQoJ3NlbGVjdDplbmFibGVkJykpOw0KCWVsZW1zID0gJC5tZXJnZShlbGVtcywgcC5maW5kKCd0ZXh0YXJlYTplbmFibGVkJykpOw0KCXJldHVybiAkKGVsZW1zKTsNCn0NCg0KZnVuY3Rpb24gcmVtb3ZlT25Gb3JtRWxlbWVudENoYW5nZUxpc3RlbmVyKGVsZW1lbnROYW1lKXsNCgl2YXIgZWxtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudE5hbWUpOw0KCWlmIChlbG0gIT0gbnVsbCkgeyAvLyBGaXhlZCBOUEUNCgkJaWYgKGVsbS5hZGRFdmVudExpc3RlbmVyKSB7DQoJCQllbG0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25FbGVtQ2hhbmdlRXZlbnQsIGZhbHNlKTsNCgkJfQ0KCQllbHNlIGlmIChlbG0uYXR0YWNoRXZlbnQpIHsNCgkJCWVsbS5kZXRhY2hFdmVudCgnb24nICsgJ2NoYW5nZScsIG9uRWxlbUNoYW5nZUV2ZW50KTsNCgkJfQ0KCX0NCn0NCg0KLy8gQWRkIExpc3RlbmVyIGZvciBjYXB0dXJpbmcgb24gZm9ybSBjaGFuZ2VzDQpmdW5jdGlvbiBhZGRPbkZvcm1DaGFuZ2VMaXN0ZW5lcnMoZSkgew0KCWFkZEV2ZW50KGN1cnJlbnRPbW5pRm9ybSwgJ2NsaWNrJywgb25Gb3JtQ2hhbmdlQ2xpY2tFdmVudCwgZmFsc2UpOw0KfQ0KDQpmdW5jdGlvbiBvblN1Ym1pdEV2ZW50SGFuZGxlciAoZXZ0KSB7DQoJaGFzQ3VycmVudE9tbmlGb3JtU3VibWl0dGVkID0gdHJ1ZTsNCn0NCg0KZnVuY3Rpb24gb25CZWZvcmVVbmxvYWRFdmVudEhhbmRsZXIgKGV2dCkgew0KICAgaWYoaGFzQ3VycmVudE9tbmlGb3JtU3VibWl0dGVkICE9IHRydWUpIHsNCgkgIGlmKGhhc1dhcm5pbmdNZXNzYWdlRm9yRm9ybUNoYW5nZWRPY2N1cnJlZCAhPSB0cnVlKSB7DQoJCSAgaWYoaGFzRm9ybUJlZW5DaGFuZ2VkKCkpIHsNCgkJCSAgdmFyIG1lc3NhZ2UgPSAiKiogWW91ciBjaGFuZ2VzIGhhdmUgbm90IHlldCBiZWVuIHNhdmVkICoqIjsNCgkJCSAgaWYgKHR5cGVvZiBldnQgPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCSAgICBldnQgPSB3aW5kb3cuZXZlbnQ7DQoJCQkgIH0NCgkJCSAgaWYgKGV2dCkgew0KCQkJICAgIGV2dC5yZXR1cm5WYWx1ZSA9IG1lc3NhZ2U7DQoJCQkgIH0NCgkJCSAgcmV0dXJuIG1lc3NhZ2U7DQoJCSAgfQ0KCSAgfQ0KICAgfQ0KfQ0KDQoJZnVuY3Rpb24gb25XaW5kb3dDbG9zZSgpDQoJew0KCQlpZih3aW5kb3cuc2NyZWVuTGVmdCA+c2NyZWVuLndpZHRoKXsNCgkJCS8vYnJvd3NlciBpcyBjbG9zZWQNCgkJCS8vYWxlcnQoImdvb2RieWUgZ29vYmVyIik7DQoJCX0NCgkJZWxzZXsNCgkJCS8vCXJlZnJlc2gNCgkJCXdpbmRvdy5yZWZyZXNoKCk7DQoJCQl9DQoJfQ0KDQpmdW5jdGlvbiBvbkZvcm1DaGFuZ2VDbGlja0V2ZW50KCkgew0KDQoJdmFyIG9iakZvcm0gPSBjdXJyZW50T21uaUZvcm07DQoNCglpZihvYmpGb3JtICE9IG51bGwgJiYgb2JqRm9ybS5pc0RpcnR5ICE9IG51bGwpIHsNCgkJaWYob2JqRm9ybS5pc0RpcnR5LnZhbHVlICE9ICJ0cnVlIikgew0KCQkJaWYoaGFzRm9ybUNoYW5nZWQob2JqRm9ybSkpIHsNCgkJCQlvYmpGb3JtLmlzRGlydHkudmFsdWUgPSAndHJ1ZSc7DQoJCQl9DQoJCX0NCgkJLy9hbGVydCgib25Gb3JtQ2hhbmdlQ2xpY2tFdmVudC5pc0RpcnR5PSIrb2JqRm9ybS5pc0RpcnR5LnZhbHVlKTsNCgl9DQp9DQoNCi8qKiBEaXJ0eSB0aGUgZm9ybSBpZiBhIGNoYW5nZSBoYXMgb2NjdXJlZCBvbiB0aGUgZWxlbWVudCovDQpmdW5jdGlvbiBvbkVsZW1DaGFuZ2VFdmVudChldmVudCkgew0KCXZhciBlbGVtID0gZXZlbnQuc3JjRWxlbWVudDsgLy8gSUV4cGxvcmVyDQoJaWYgKGVsZW0gPT0gbnVsbCkNCgkJZWxlbSA9IGV2ZW50LnRhcmdldDsgLy8gRmlyZWZveA0KCXVwZGF0ZUlzRGlydHkoZWxlbSk7DQp9DQoNCi8qKiBVcGRhdGVzIGlzRGlydHkgb24gdGhlIGN1cnJlbnRPbW5pRm9ybSBpZiB0aGUgc3BlY2lmaWVkIGVsZW0gaGFzIGNoYW5nZWQuICovDQpmdW5jdGlvbiB1cGRhdGVJc0RpcnR5KGVsZW0pIHsNCglpZihjdXJyZW50T21uaUZvcm0gIT0gbnVsbCAmJiBjdXJyZW50T21uaUZvcm0uaXNEaXJ0eSAhPSBudWxsKSB7DQoJCWlmKGN1cnJlbnRPbW5pRm9ybS5pc0RpcnR5LnZhbHVlICE9ICJ0cnVlIikgew0KCQkJaWYoaGFzRWxlbUNoYW5nZWQoZWxlbSkpIHsNCgkJCQljdXJyZW50T21uaUZvcm0uaXNEaXJ0eS52YWx1ZSA9ICd0cnVlJzsNCgkJCQkkKGN1cnJlbnRPbW5pRm9ybS5pc0RpcnR5KS50cmlnZ2VyKCdjaGFuZ2UnKTsNCgkJCX0NCgkJfQ0KCX0NCn0NCg0KLy9BZGQgRXZlbnQgZnVuY3Rpb24NCmZ1bmN0aW9uIGFkZEV2ZW50KGVsbSwgZXZUeXBlLCBmbiwgdXNlQ2FwdHVyZSkNCnsNCgkvLyBjcm9zcyBicm93c2VyIGV2ZW50IGhhbmRsaW5nIGZvciBJRSA1KywgTlM2KyBhbmQgR2Vja28NCglpZiAoZWxtLmFkZEV2ZW50TGlzdGVuZXIpDQoJew0KCQllbG0uYWRkRXZlbnRMaXN0ZW5lcihldlR5cGUsIGZuLCB1c2VDYXB0dXJlKTsNCgkJcmV0dXJuIHRydWU7DQoJfQ0KCWVsc2UgaWYgKGVsbS5hdHRhY2hFdmVudCkNCgl7DQoJCXZhciByID0gZWxtLmF0dGFjaEV2ZW50KCdvbicgKyBldlR5cGUsIGZuKTsNCgkJcmV0dXJuIHI7DQoJfQ0KCWVsc2UNCgl7DQoJCWVsbVsnb24nICsgZXZUeXBlXSA9IGZuOw0KCX0NCn0NCg0KZnVuY3Rpb24gaGFzRm9ybUJlZW5DaGFuZ2VkKCkgew0KCXZhciBsb2NhbEZvcm0gPSBudWxsOw0KDQoJaWYoY3VycmVudE9tbmlGb3JtICE9IG51bGwpIHsNCgkJbG9jYWxGb3JtID0gY3VycmVudE9tbmlGb3JtOw0KCX0NCglpZihsb2NhbEZvcm0gIT0gbnVsbCkgew0KDQoJCWlmKChsb2NhbEZvcm0uaXNEaXJ0eSAmJiBsb2NhbEZvcm0uaXNEaXJ0eS52YWx1ZSA9PSAndHJ1ZScpIHx8IGhhc0Zvcm1DaGFuZ2VkKGxvY2FsRm9ybSkgfHwgaGFzRWxlbUNoYW5nZWQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkpIHsNCgkJCXJldHVybiB0cnVlOw0KCQl9DQoJfQ0KCXJldHVybiBmYWxzZTsNCn0NCg0KLyoqDQogKiBDaGVja3MgaWYgdGhlIGZvcm0gaGFzIGJlZW4gY2hhbmdlZCBpZiBzbywgZGlzcGxheXMgY29uZmlybSBkaWFsb2cNCiAqLw0KZnVuY3Rpb24gY2hlY2tGb3JtQ2hhbmdlZChvYmpGb3JtKSB7DQoNCgl2YXIgbG9jYWxGb3JtOw0KCXZhciBzaG93TWVzc2FnZSA9IGZhbHNlOw0KCXZhciByZWNhbGNWYXJpYWJsZURlZmluZWQgPSBmYWxzZTsNCglpZiAob2JqRm9ybSAhPSBudWxsKSB7DQoJCWxvY2FsRm9ybSA9IG9iakZvcm07DQoJfSBlbHNlIHsNCgkJbG9jYWxGb3JtID0gY3VycmVudE9tbmlGb3JtOw0KCX0NCglpZiAobG9jYWxGb3JtICE9IG51bGwpIHsNCgkJPCEtLSBCdWcgZml4OiBPTU5JMDAwMDM0NDQgLS0+DQoJCWlmIChsb2NhbEZvcm0ubmVlZHNSZWNhbGMpIHsNCgkJCWlmIChsb2NhbEZvcm0ubmVlZHNSZWNhbGMudmFsdWUgPT0gJ3RydWUnKSB7DQoJCQkJdmFyIGNvbmZpcm1NZXNzYWdlICA9ICJJZiB5b3UgaGF2ZSBlbnRlcmVkLCB1cGRhdGVkIG9yIG1vZGlmaWVkIGFueSBkYXRhIHRoYXQgd2lsbCBjYWxjdWxhdGUgb3IgY2hhbmdlIHRoZSBFUkQsIHlvdSBtdXN0IGludm9rZSB0aGUgY2FsY3VsYXRlIHByb2Nlc3MgYmVmb3JlIGxlYXZpbmcgdGhpcyBwYWdlLlxuIjsNCgkJCQljb25maXJtTWVzc2FnZSAgICAgKz0gIiAqKiBTZW50ZW5jZSBjYWxjdWxhdGlvbnMgYXJlIG5vdCB1cC10by1kYXRlICoqXG5cbiI7DQoJCQkJY29uZmlybU1lc3NhZ2UgICAgICs9ICJDbGljayBDYW5jZWwgdG8gcmV0dXJuIHRvIHRoZSBzY3JlZW4gdG8gcmVjYWxjdWxhdGUgYmVmb3JlIG5hdmlnYXRpbmcgZnJvbSB0aGlzIHBhZ2UuXG5cbiI7DQoJCQkJY29uZmlybU1lc3NhZ2UgICAgICs9ICJDbGljayBPSyB0byBwcm9jZWVkIHdpdGhvdXQgcmVjYWxjdWxhdGluZy4iOw0KCQkJCXNob3dNZXNzYWdlID0gdHJ1ZTsNCgkJCX0NCgkJCXJlY2FsY1ZhcmlhYmxlRGVmaW5lZCA9IHRydWU7DQoJCX0NCgkJaWYgKChsb2NhbEZvcm0uaXNEaXJ0eSAmJiBsb2NhbEZvcm0uaXNEaXJ0eS52YWx1ZSA9PSAndHJ1ZScpIHx8ICghcmVjYWxjVmFyaWFibGVEZWZpbmVkICYmIGhhc0Zvcm1DaGFuZ2VkKGxvY2FsRm9ybSkpKSB7DQoJCQkvL2RlYnVnIHN0dWZmDQoJCQkvL2FsZXJ0KCJsb2NhbEZvcm0uaXNEaXJ0eTogIitsb2NhbEZvcm0uaXNEaXJ0eSk7DQoJCQkvL2FsZXJ0KCJsb2NhbEZvcm0uaXNEaXJ0eS52YWx1ZTogIitsb2NhbEZvcm0uaXNEaXJ0eS52YWx1ZSk7DQoJCQkvL2FsZXJ0KCJyZWNhbGNWYXJpYWJsZURlZmluZWQ6ICIrcmVjYWxjVmFyaWFibGVEZWZpbmVkKTsNCgkJCS8vYWxlcnQoImhhc0Zvcm1DaGFuZ2VkKGxvY2FsRm9ybSk6ICIraGFzRm9ybUNoYW5nZWQobG9jYWxGb3JtKSk7DQoNCgkJCXZhciBjb25maXJtTWVzc2FnZSAgPSBnZXRJc0RpcnR5Q29uZmlybU1lc3NhZ2UoKTsNCgkJCXNob3dNZXNzYWdlID0gdHJ1ZTsNCgkJfQ0KCQlpZiAoc2hvd01lc3NhZ2UgPT0gdHJ1ZSkgew0KCQkJaGFzV2FybmluZ01lc3NhZ2VGb3JGb3JtQ2hhbmdlZE9jY3VycmVkID0gdHJ1ZTsNCgkJCWlmICh3aW5kb3cuY29uZmlybShjb25maXJtTWVzc2FnZSkpIHsNCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0gZWxzZSB7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KCQl9IGVsc2Ugew0KCQkJcmV0dXJuIHRydWU7DQoJCX0NCgl9DQoJcmV0dXJuIHRydWU7DQp9DQoNCmZ1bmN0aW9uIGdldElzRGlydHlDb25maXJtTWVzc2FnZSgpIHsNCgl2YXIgY29uZmlybU1lc3NhZ2UgID0gIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBuYXZpZ2F0ZSBhd2F5IGZyb20gdGhpcyBwYWdlP1xuIjsNCgljb25maXJtTWVzc2FnZSAgICAgKz0gIiAqKiBZb3VyIGNoYW5nZXMgaGF2ZSBub3QgeWV0IGJlZW4gc2F2ZWQgKipcblxuIjsNCgljb25maXJtTWVzc2FnZSAgICAgKz0gIkNsaWNrIENhbmNlbCB0byByZXR1cm4gdG8gdGhlIHNjcmVlbiB0byBzYXZlIGNoYW5nZXMgYmVmb3JlIG5hdmlnYXRpbmcgZnJvbSB0aGlzIHBhZ2UuXG5cbiI7DQoJY29uZmlybU1lc3NhZ2UgICAgICs9ICJDbGljayBPSyB0byBwcm9jZWVkIHdpdGhvdXQgc2F2aW5nIGNoYW5nZXMuIjsNCglyZXR1cm4gY29uZmlybU1lc3NhZ2U7DQp9DQoNCi8qKg0KKiBSZXR1cm5zIHRydWUgaWYgdGhlIGVsZW1lbnQgaGFzIGEgY2xhc3MgbmFtZWQgJ2Rpc2FibGVkJw0KKi8NCmZ1bmN0aW9uIGhhc0Rpc2FibGVkQ2xhc3MoZWxlbSkgew0KICAgICAgcmV0dXJuICQoZWxlbSkuaGFzQ2xhc3MoJ2Rpc2FibGVkJyk7ICAgICAgDQp9DQoNCiAgLyoqDQogICAqIGZ1bmN0aW9uIHJldHVybnMgdHJ1ZSBpZiBhbnkgZWRpdCBjb250cm9sIGhhcyBiZWVuIG1vZGlmaWVkIGZyb20gaXRzIG9yaWdpbmFsIChvciBsYXN0IHNhdmVkKSBzZXR0aW5ncw0KICAgKi8NCiAgZnVuY3Rpb24gaGFzRm9ybUNoYW5nZWQob2JqRm9ybSkNCiAgew0KICAJaWYob2JqRm9ybSA9PSBudWxsIHx8IHVzZWRGb3JtRWxlbWVudENoYW5nZUluaXQpIHsgLy8gRG9uJ3QgZG8gRE9NIHNjYW4gaWYgd2UgaW5pdGlhbGl6ZWQgdGhlIG5ldyB3YXkuDQogIAkJcmV0dXJuIGZhbHNlOw0KICAJfQ0KDQoJdmFyIG91dHB1dCA9ICcnOw0KCWZvciAodmFyIGk9MCwgaj1vYmpGb3JtLmxlbmd0aDsgaTxqOyBpKyspIHsNCgkgIAlpZiAoaGFzRWxlbUNoYW5nZWQob2JqRm9ybVtpXSkpIHsNCgkgIAkJcmV0dXJuKHRydWUpOw0KCSAgCX0NCgl9DQoJcmV0dXJuIChmYWxzZSk7DQp9DQoNCi8qIFNldCBERUJVR19JU0RJUlRZIHRvIHRydWUgdG8gZW5hYmxlIGlzRGlydHkgYWxlcnRzICovDQpmdW5jdGlvbiBoYXNFbGVtQ2hhbmdlZChlbGVtKSB7DQoJaWYgKGVsZW0gPT0gbnVsbCkgew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KDQoJdmFyIG15VHlwZSA9IGVsZW0udHlwZTsNCiAgCWlmIChteVR5cGUgPT0gJ2NoZWNrYm94JyB8fCBteVR5cGUgPT0gJ3JhZGlvJykgew0KCQlpZiAoZWxlbS5jaGVja2VkICE9IGVsZW0uZGVmYXVsdENoZWNrZWQpIHsNCgkJCWlmICh0eXBlb2YoREVCVUdfSVNESVJUWSkgIT0gJ3VuZGVmaW5lZCcgJiYgREVCVUdfSVNESVJUWSkgew0KCQkJCWFsZXJ0KCJlbGVtLmNoZWNrZWQ9IiArIGVsZW0uY2hlY2tlZCArICIsIGVsZW0uaWQ9IiArIGVsZW0uaWQpOw0KCQkJfQ0KCSAgCQlyZXR1cm4odHJ1ZSk7DQoJCX0NCiAgCX0NCiAgCWlmIChteVR5cGUgPT0gJ2hpZGRlbicgfHwgbXlUeXBlID09ICdwYXNzd29yZCcgfHwgbXlUeXBlID09ICd0ZXh0JyB8fCBteVR5cGUgPT0gJ3RleHRhcmVhJykgew0KICAJCS8vIERlZmVjdCAxODg2MA0KICAJCWlmIChlbGVtLnZhbHVlICE9IGVsZW0uZGVmYXVsdFZhbHVlICYmIGVsZW0udmFsdWUgIT0gJ3ByaW50V2luZG93Jykgew0KCQkJaWYgKHR5cGVvZihERUJVR19JU0RJUlRZKSAhPSAndW5kZWZpbmVkJyAmJiBERUJVR19JU0RJUlRZKSB7DQoJCQkJYWxlcnQoImVsZW0udmFsdWU9IiArIGVsZW0udmFsdWUgKyAiLCBlbGVtLmRlZmF1bHRWYWx1ZT0iICsgZWxlbS5kZWZhdWx0VmFsdWUgKyAiLCBlbGVtLmlkPSIgKyBlbGVtLmlkICsgIiwgZWxlbS5uYW1lPSIgKyBlbGVtLm5hbWUgKyAiLCBteXR5cGU9IiArIG15VHlwZSk7DQoJCQl9DQoJICAJCXJldHVybih0cnVlKTsNCgkJfQ0KICAJfQ0KICAJaWYgKG15VHlwZSA9PSAnc2VsZWN0LW9uZScgfHwgbXlUeXBlID09ICdzZWxlY3QtbXVsdGlwbGUnKSB7DQoJCWZvciAodmFyIGs9MCwgbD1lbGVtLm9wdGlvbnMubGVuZ3RoOyBrPGw7IGsrKykgew0KCSAgCQlpZiAoZWxlbS5vcHRpb25zW2tdLnNlbGVjdGVkICE9IGVsZW0ub3B0aW9uc1trXS5kZWZhdWx0U2VsZWN0ZWQpIHsNCgkJCQlpZiAodHlwZW9mKERFQlVHX0lTRElSVFkpICE9ICd1bmRlZmluZWQnICYmIERFQlVHX0lTRElSVFkpIHsNCgkJCQkJYWxlcnQoImVsZW0uaWQub3B0aW9uICE9IGRlZmF1bHRTZWxlY3RlZCAtPiAiICsgZWxlbS5pZCArICIsIG9wdGlvblRleHQ9IiArIGVsZW0ub3B0aW9uc1trXS50ZXh0ICsgIiwgZGVmYXVsdFZhbHVlPSIgKyBlbGVtLm9wdGlvbnNba10uZGVmYXVsdFNlbGVjdGVkICsgIiwgYWN0dWFsVmFsdWU9IiArIGVsZW0ub3B0aW9uc1trXS5zZWxlY3RlZCArICIsIFNlbGVjdC5EZWZhdWx0VmFsdWU9IiArIGVsZW0udmFsdWUpOw0KCQkJCX0NCgkJCQlyZXR1cm4odHJ1ZSk7DQoJICAJCX0NCgkJfQ0KICAJfQ0KICAJcmV0dXJuKGZhbHNlKTsNCn0NCg0KLy8gQ2hhbmdlIHRoZSBlbGVtZW50IHNvIGlzIGRvZXMgbm90IGFwcGVhciB0byBoYXZlIGJlZW4gY2hhbmdlZC4NCi8vIExlYXZlIHRoZSBjdXJyZW50IHZhbHVlIGludGFjdC4NCmZ1bmN0aW9uIG1hc2tFbGVtQ2hhbmdlKGVsZW0pIHsNCglpZiAoZWxlbSAhPSBudWxsKSB7DQoNCgkJdmFyIG15VHlwZSA9IGVsZW0udHlwZTsNCgkgIAlpZiAobXlUeXBlID09ICdjaGVja2JveCcgfHwgbXlUeXBlID09ICdyYWRpbycpIHsNCgkJCQllbGVtLmRlZmF1bHRDaGVja2VkID0gZWxlbS5jaGVja2VkOw0KCSAgCX0gZWxzZQ0KCSAgCWlmIChteVR5cGUgPT0gJ2hpZGRlbicgfHwgbXlUeXBlID09ICdwYXNzd29yZCcgfHwgbXlUeXBlID09ICd0ZXh0JyB8fCBteVR5cGUgPT0gJ3RleHRhcmVhJykgew0KCSAgCQkvLyBEZWZlY3QgMTg4NjANCgkgIAkJaWYgKCBlbGVtLnZhbHVlICE9ICdwcmludFdpbmRvdycpIHsNCgkgIAkJCWVsZW0uZGVmYXVsdFZhbHVlID0gZWxlbS52YWx1ZTsNCgkJCX0NCgkgIAl9IGVsc2UNCgkgIAlpZiAobXlUeXBlID09ICdzZWxlY3Qtb25lJyB8fCBteVR5cGUgPT0gJ3NlbGVjdC1tdWx0aXBsZScpIHsNCgkJCWZvciAodmFyIGs9MCwgbD1lbGVtLm9wdGlvbnMubGVuZ3RoOyBrPGw7IGsrKykgew0KCQkJCWVsZW0ub3B0aW9uc1trXS5kZWZhdWx0U2VsZWN0ZWQgPSBlbGVtLm9wdGlvbnNba10uc2VsZWN0ZWQ7DQoJCQl9DQoJICAJfQ0KCX0NCn0NCg0KZnVuY3Rpb24gaGFzRm9ybUNoYW5nZWRJZ25vcmVMaXN0KG9iakZvcm0sIGlnbm9yZUlkcykNCnsNCglpZihvYmpGb3JtID09IG51bGwpIHsNCiAgCQlyZXR1cm4gZmFsc2U7DQogIAl9DQoNCgl2YXIgb3V0cHV0ID0gJyc7DQoJZm9yICh2YXIgaT0wLCBqPW9iakZvcm0ubGVuZ3RoOyBpPGo7IGkrKykgew0KCSAgCW15VHlwZSA9IG9iakZvcm1baV0udHlwZTsNCgkgIAlpZiAobXlUeXBlID09ICdjaGVja2JveCcgfHwgbXlUeXBlID09ICdyYWRpbycpIHsNCgkJCWlmIChvYmpGb3JtW2ldLmNoZWNrZWQgIT0gb2JqRm9ybVtpXS5kZWZhdWx0Q2hlY2tlZCkgew0KCQkJCS8vYWxlcnQoIm9iakZvcm1baV0uY2hlY2tlZD0iICsgb2JqRm9ybVtpXS5jaGVja2VkICsgIiwgb2JqRm9ybVtpXS5pZD0iICsgb2JqRm9ybVtpXS5pZCk7DQoJCQkJaWYgKGlzSWRJbkxpc3Qob2JqRm9ybVtpXS5pZCxpZ25vcmVJZHMpID09IGZhbHNlKQ0KCQkJCXsNCgkJCSAgCQlyZXR1cm4odHJ1ZSk7DQoJCQkgIAl9DQoJCQkgIAllbHNlDQoJCQkgIAl7DQoJCQkgIAkJcmV0dXJuKGZhbHNlKTsNCgkJCSAgCX0NCgkJCX0NCgkgIAl9DQoJICAJaWYgKG15VHlwZSA9PSAnaGlkZGVuJyB8fCBteVR5cGUgPT0gJ3Bhc3N3b3JkJyB8fCBteVR5cGUgPT0gJ3RleHQnIHx8IG15VHlwZSA9PSAndGV4dGFyZWEnKSB7DQoJCQlpZiAob2JqRm9ybVtpXS52YWx1ZSAhPSBvYmpGb3JtW2ldLmRlZmF1bHRWYWx1ZSkgew0KCQkJCS8vYWxlcnQoIm9iakZvcm1baV0udmFsdWU9IiArIG9iakZvcm1baV0udmFsdWUgKyAiLCBvYmpGb3JtW2ldLmRlZmF1bHRWYWx1ZT0iICsgb2JqRm9ybVtpXS5kZWZhdWx0VmFsdWUgKyAiLCBvYmpGb3JtW2ldLmlkPSIgKyBvYmpGb3JtW2ldLmlkICsgIiwgb2JqRm9ybVtpXS5uYW1lPSIgKyBvYmpGb3JtW2ldLm5hbWUgKyAiLCBteXR5cGU9IiArIG15VHlwZSk7DQoJCSAgCQlpZiAoaXNJZEluTGlzdChvYmpGb3JtW2ldLmlkLGlnbm9yZUlkcykgPT0gZmFsc2UpDQoJCQkJew0KCQkJICAJCXJldHVybih0cnVlKTsNCgkJCSAgCX0NCgkJCSAgCWVsc2UNCgkJCSAgCXsNCgkJCSAgCQlyZXR1cm4oZmFsc2UpOw0KCQkJICAJfQ0KCQkJfQ0KCSAgCX0NCgkgIAlpZiAobXlUeXBlID09ICdzZWxlY3Qtb25lJyB8fCBteVR5cGUgPT0gJ3NlbGVjdC1tdWx0aXBsZScpIHsNCgkJCWZvciAodmFyIGs9MCwgbD1vYmpGb3JtW2ldLm9wdGlvbnMubGVuZ3RoOyBrPGw7IGsrKykgew0KCQkgIAkJaWYgKG9iakZvcm1baV0ub3B0aW9uc1trXS5zZWxlY3RlZCAhPSBvYmpGb3JtW2ldLm9wdGlvbnNba10uZGVmYXVsdFNlbGVjdGVkKSB7DQoJCSAgCQkJLy9hbGVydCgib2JqRm9ybVtpXS5pZC5vcHRpb24gIT0gZGVmYXVsdFNlbGVjdGVkIC0+ICIgKyBvYmpGb3JtW2ldLmlkICsgIiwgb3B0aW9uVGV4dD0iICsgb2JqRm9ybVtpXS5vcHRpb25zW2tdLnRleHQgKyAiLCBkZWZhdWx0VmFsdWU9IiArIG9iakZvcm1baV0ub3B0aW9uc1trXS5kZWZhdWx0U2VsZWN0ZWQgKyAiLCBhY3R1YWxWYWx1ZT0iICsgb2JqRm9ybVtpXS5vcHRpb25zW2tdLnNlbGVjdGVkICsgIiwgU2VsZWN0LkRlZmF1bHRWYWx1ZT0iICsgb2JqRm9ybVtpXS52YWx1ZSk7DQoJCQkJCWlmIChpc0lkSW5MaXN0KG9iakZvcm1baV0uaWQsaWdub3JlSWRzKSA9PSBmYWxzZSkNCgkJCQkJew0KCQkJICAJCXJldHVybih0cnVlKTsNCgkJCSAgCQl9DQoJCQkgIAkJZWxzZQ0KCQkJICAJCXsNCgkJCSAgCQlyZXR1cm4oZmFsc2UpOw0KCQkJICAJCX0NCgkJICAJCX0NCgkJCX0NCgkgIAl9DQoJfQ0KCXJldHVybiAoZmFsc2UpOw0KDQp9DQoNCi8qKiBmdW5jdGlvbiB0byBiZSB1c2VkIHRvIHNlZSBpZiB0aGUgaWRUb0NoZWNrIHZhbHVlIGlzIGZvdW5kIGluIHRoZSBsaXN0IG9mIGlkcyAqKi8NCmZ1bmN0aW9uIGlzSWRJbkxpc3QoaWRUb0NoZWNrLGxpc3RPZklkcykNCnsNCg0KCXZhciBpZENvdW50ZXIgPSAwOw0KDQoJaWYgKGxpc3RPZklkcyA9PSBudWxsKSB7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoNCglmb3IoaWRDb3VudGVyPTA7IGlkQ291bnRlciA8IGxpc3RPZklkcy5sZW5ndGg7aWRDb3VudGVyKyspDQoJew0KCQlpZiAobGlzdE9mSWRzW2lkQ291bnRlcl0gPT0gaWRUb0NoZWNrKQ0KCQl7DQoJCQlyZXR1cm4gKHRydWUpOw0KCQl9DQoJfQ0KCXJldHVybiBmYWxzZTsNCn0NCg0KDQoNCi8qIFJlZGlyZWN0IHRoZSBjdXJyZW50IHdpbmRvdyB0byBzcGVjaWZpZWQgdXJsICovDQpmdW5jdGlvbiByZWRpcmVjdChzdHJVcmwpew0KCXdpbmRvdy5sb2NhdGlvbj1zdHJVcmw7DQoJcmV0dXJuIHdpbmRvdzsNCn0NCg0KdmFyIGdsb2JhbFdpbmRvd05hbWUgPSBuZXcgQXJyYXkoKTsNCg0KZnVuY3Rpb24gb3Blbk5ld1ByaW50V2luZG93KHN0clVybCwgc3RyTmV3V2luZG93TmFtZSkgew0KDQoJcmV0dXJuIG9wZW5OZXdXaW5kb3coc3RyVXJsLCBzdHJOZXdXaW5kb3dOYW1lLCAxMDI0LCA3NjgsICd5ZXMnLCAneWVzJyk7DQp9DQoNCi8qIENyZWF0ZSBhIG5ldyB3aW5kb3cgKi8NCmZ1bmN0aW9uIG9wZW5OZXdXaW5kb3coc3RyVXJsLCBzdHJOZXdXaW5kb3dOYW1lLCBpbnRXaW5kb3dXaWR0aCwgaW50V2luZG93SGVpZ2h0LCBzY3JvbGwsIHJlc2l6YWJsZSkgew0KDQoJLyogY3JlYXRlIG5ldyB3aW5kb3cgYW5kIGdpdmUgaXQgZm9jdXMgKi8NCgl2YXIgbmV3V2luZG93Ow0KICAgIExlZnRQb3NpdGlvbiA9IChzY3JlZW4ud2lkdGgpID8gKHNjcmVlbi53aWR0aCAtIGludFdpbmRvd1dpZHRoKSAvIDIgOiA0MDsNCiAgICBUb3BQb3NpdGlvbiA9IChzY3JlZW4uaGVpZ2h0KSA/IChzY3JlZW4uaGVpZ2h0IC0gaW50V2luZG93SGVpZ2h0KSAvIDIgOiA0MDsNCiAgICAvL3NlbmQgc2Vzc2lvbkJyb3dzZXJJZCB0byBzZXJ2bGV0IGJlZm9yZSBvcGVuIG5ldyB3aW5kb3cNCiAgICBwcm9jZXNzQWpheFNlcnZsZXQoKTsNCiAgICAvL2RlZmVjdCAyNTgyOSBJRSBUYWJzIC0gUHJpbnQgQ0ZQIFN1bW1hcnkgLSBQb3B1cCB3aW5kb3cgZG9lcyBub3QgdXBkYXRlIHdoZW4gY2xpY2tpbmcgZnJvbSBvdGhlciB0YWJzDQogICAgLy9hZGRlZCBzZXNzaW9uIGJyb3dzZXIgaWQgdG8gdGhlIHdpbmRvdyBuYW1lIHRvIG1ha2UgaXQgdW5pcXVlDQogICAgLy9kZWZlY3QgMjU4NjcgT01OSSAtIENhbm5vdCBPcGVuIE9mZmVuZGVyIFJlcG9ydHMgZm9yIE11bHRpcGxlIERPQyBudW1iZXJzIGluc2lkZSBPTU5JIEluIE0zNCBDT05WDQoJLy9pZiBubyBuYW1lIGZvciBuZXcgd2luZG93IGRvbid0IGFkZCBzZXNzaW9uIHN0b3JhZ2UgaWQgdG8gc3RybmV3d2luZG93bmFtZQ0KICAgIC8vZGVmZWN0IDI1ODkzIGFkZGVkIG51bGwgY2hlY2sNCiAgICBpZiAoc3RyTmV3V2luZG93TmFtZSAhPSBudWxsICYmIHN0ck5ld1dpbmRvd05hbWUubGVuZ3RoID4gMCkNCiAgICB7DQogICAgCW5ld1dpbmRvdyA9IHdpbmRvdy5vcGVuKHN0clVybCwgc3RyTmV3V2luZG93TmFtZSArIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oInNlc3Npb25Ccm93c2VySWQiKSwgJ2hlaWdodD0nKyBpbnRXaW5kb3dIZWlnaHQgKycsd2lkdGg9JysgaW50V2luZG93V2lkdGggKycsdG9wPScrVG9wUG9zaXRpb24rJyxsZWZ0PScrTGVmdFBvc2l0aW9uKycsc2Nyb2xsYmFycz0nK3Njcm9sbCsnLHJlc2l6YWJsZT0nK3Jlc2l6YWJsZSsnLHRvb2xiYXI9bm8sdGl0bGViYXI9bm8sbG9jYXRpb249bm8sc3RhdHVzPXllcyxtZW51YmFyPW5vLGNvcHloaXN0b3J5PW5vLG1vZGFsPXllcycpOw0KICAgIH0gZWxzZQ0KCXsNCiAgICAJbmV3V2luZG93ID0gd2luZG93Lm9wZW4oc3RyVXJsLCBzdHJOZXdXaW5kb3dOYW1lLCAnaGVpZ2h0PScrIGludFdpbmRvd0hlaWdodCArJyx3aWR0aD0nKyBpbnRXaW5kb3dXaWR0aCArJyx0b3A9JytUb3BQb3NpdGlvbisnLGxlZnQ9JytMZWZ0UG9zaXRpb24rJyxzY3JvbGxiYXJzPScrc2Nyb2xsKycscmVzaXphYmxlPScrcmVzaXphYmxlKycsdG9vbGJhcj1ubyx0aXRsZWJhcj1ubyxsb2NhdGlvbj1ubyxzdGF0dXM9eWVzLG1lbnViYXI9bm8sY29weWhpc3Rvcnk9bm8sbW9kYWw9eWVzJyk7DQoJfQ0KDQoNCglnbG9iYWxXaW5kb3dOYW1lW2dsb2JhbFdpbmRvd05hbWUubGVuZ3RoXSA9IG5ld1dpbmRvdzsNCgkvL2FsZXJ0KCJzZXR0aW5nIGdsb2JhbCB3aW5kb3cgbmFtZSA6ICIgKyBuZXdXaW5kb3cubmFtZSk7DQoNCgluZXdXaW5kb3cuZm9jdXMoKTsNCg0KDQoNCiAgICByZXR1cm4gbmV3V2luZG93Ow0KfQ0KDQovKiBDcmVhdGUgYSBuZXcgd2luZG93IHdpdGggY3VzdG9tIGZlYXR1cmVzICovDQpmdW5jdGlvbiBvcGVuUG9wVXBXaW5kb3dXaXRoRmVhdHVyZXMoc3RyVXJsLCBzdHJOZXdXaW5kb3dOYW1lLCBzdHJGZWF0dXJlcykgew0KICAgIC8vc2VuZCBzZXNzaW9uQnJvd3NlcklkIHRvIHNlcnZsZXQgYmVmb3JlIG9wZW4gbmV3IHdpbmRvdw0KICAgIHByb2Nlc3NBamF4U2VydmxldCgpOw0KICAgIC8vZGVmZWN0IDI1ODI5IElFIFRhYnMgLSBQcmludCBDRlAgU3VtbWFyeSAtIFBvcHVwIHdpbmRvdyBkb2VzIG5vdCB1cGRhdGUgd2hlbiBjbGlja2luZyBmcm9tIG90aGVyIHRhYnMNCiAgICAvL2FkZGVkIHNlc3Npb24gYnJvd3NlciBpZCB0byB0aGUgd2luZG93IG5hbWUgdG8gbWFrZSBpdCB1bmlxdWUNCgkvL2RlZmVjdCAyNTg2NyBPTU5JIC0gQ2Fubm90IE9wZW4gT2ZmZW5kZXIgUmVwb3J0cyBmb3IgTXVsdGlwbGUgRE9DIG51bWJlcnMgaW5zaWRlIE9NTkkgSW4gTTM0IENPTlYNCgkvL2lmIG5vIG5hbWUgZm9yIG5ldyB3aW5kb3cgZG9uJ3QgYWRkIHNlc3Npb24gc3RvcmFnZSBpZCB0byBzdHJuZXd3aW5kb3duYW1lDQogICAgLy9kZWZlY3QgMjU4OTMgYWRkZWQgbnVsbCBjaGVjaw0KICAgIGlmIChzdHJOZXdXaW5kb3dOYW1lICE9IG51bGwgJiYgc3RyTmV3V2luZG93TmFtZS5sZW5ndGggPiAwKQ0KICAgIHsNCiAgICAJd2luZG93Lm9wZW4oc3RyVXJsLCBzdHJOZXdXaW5kb3dOYW1lICsgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgic2Vzc2lvbkJyb3dzZXJJZCIpLCBzdHJGZWF0dXJlcykuZm9jdXMoKTsNCiAgICB9IGVsc2UNCgl7DQogICAgCXdpbmRvdy5vcGVuKHN0clVybCwgc3RyTmV3V2luZG93TmFtZSwgc3RyRmVhdHVyZXMpLmZvY3VzKCk7DQoJfQ0KDQp9DQoNCi8qIENyZWF0ZSBhIG5ldyB3aW5kb3cgd2l0aCBjdXN0b20gZmVhdHVyZXMgKi8NCmZ1bmN0aW9uIG9wZW5Qb3BVcFJldHVybldpbmRvdyhzdHJVcmwsIHN0ck5ld1dpbmRvd05hbWUsIHN0ckZlYXR1cmVzKSB7DQogICAgLy9zZW5kIHNlc3Npb25Ccm93c2VySWQgdG8gc2VydmxldCBiZWZvcmUgb3BlbiBuZXcgd2luZG93DQogICAgcHJvY2Vzc0FqYXhTZXJ2bGV0KCk7DQogICAgLy9kZWZlY3QgMjU4MjkgSUUgVGFicyAtIFByaW50IENGUCBTdW1tYXJ5IC0gUG9wdXAgd2luZG93IGRvZXMgbm90IHVwZGF0ZSB3aGVuIGNsaWNraW5nIGZyb20gb3RoZXIgdGFicw0KICAgIC8vYWRkZWQgc2Vzc2lvbiBicm93c2VyIGlkIHRvIHRoZSB3aW5kb3cgbmFtZSB0byBtYWtlIGl0IHVuaXF1ZQ0KICAJLy9kZWZlY3QgMjU4NjcgT01OSSAtIENhbm5vdCBPcGVuIE9mZmVuZGVyIFJlcG9ydHMgZm9yIE11bHRpcGxlIERPQyBudW1iZXJzIGluc2lkZSBPTU5JIEluIE0zNCBDT05WDQoJLy9pZiBubyBuYW1lIGZvciBuZXcgd2luZG93IGRvbid0IGFkZCBzZXNzaW9uIHN0b3JhZ2UgaWQgdG8gc3RybmV3d2luZG93bmFtZQ0KICAgIC8vZGVmZWN0IDI1ODkzIGFkZGVkIG51bGwgY2hlY2sNCiAgICBpZiAoc3RyTmV3V2luZG93TmFtZSAhPSBudWxsICYmIHN0ck5ld1dpbmRvd05hbWUubGVuZ3RoID4gMCkNCiAgICB7DQogICAgCXZhciByZXR1cm5XaW5kb3cgPSB3aW5kb3cub3BlbihzdHJVcmwsIHN0ck5ld1dpbmRvd05hbWUgKyBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJzZXNzaW9uQnJvd3NlcklkIiksIHN0ckZlYXR1cmVzKTsNCiAgICB9IGVsc2UNCgl7DQogICAgCXZhciByZXR1cm5XaW5kb3cgPSB3aW5kb3cub3BlbihzdHJVcmwsIHN0ck5ld1dpbmRvd05hbWUsIHN0ckZlYXR1cmVzKTsNCgl9DQoNCg0KCXJldHVybiByZXR1cm5XaW5kb3c7DQp9DQpmdW5jdGlvbiBnbG9iYWxIYW5kbGVDbG9zZVdpbmRvdygpDQp7DQoJLy9pZih3aW5kb3cuc2NyZWVuTGVmdCA+c2NyZWVuLndpZHRoKXsNCgkJZm9yKHZhciBpID0gMCA7IGkgPD0gZ2xvYmFsV2luZG93TmFtZS5sZW5ndGg7aSsrKQ0KCQl7DQoJCQkvL2FsZXJ0KCJjbG9zaW5nIHdpbmRvdyAjOiAiICsgaSk7DQoJCQlnbG9iYWxXaW5kb3dOYW1lW2ldLmNsb3NlOw0KCQl9DQoNCgkvL30NCn0NCg0KZnVuY3Rpb24gb3Blbk1vZGFsRGlhbG9nKHdpbmRvd1VSTCx3aW5XaWR0aCx3aW5IZWlnaHQpIHsNCiAgcmV0dXJuIG9wZW5Nb2RhbERpYWxvZzIod2luZG93VVJMLHNlbGYsd2luV2lkdGgsd2luSGVpZ2h0LCcnKTsNCn0NCg0KZnVuY3Rpb24gb3Blbk1vZGFsTWVzc2FnZURpYWxvZyh3aW5kb3dVUkwsc3RyTWVzc2FnZSx3aW5XaWR0aCx3aW5IZWlnaHQpIHsNCiAgcmV0dXJuIG9wZW5Nb2RhbERpYWxvZzIod2luZG93VVJMLHN0ck1lc3NhZ2Usd2luV2lkdGgsd2luSGVpZ2h0LCc7c2Nyb2xsOjA7dW5hZG9ybmVkOjAnKTsNCn0NCg0KZnVuY3Rpb24gb3Blbk1vZGFsRGlhbG9nMih3aW5kb3dVUkwsc3RyTWVzc2FnZSx3aW5XaWR0aCx3aW5IZWlnaHQsYWRkRmxhZ3MpIHsNCiAgYWRkRmxhZ3MgPSAncmVzaXphYmxlPXllcyc7DQogIHZhciBicm93c2VyYm90ID0gMDsNCiAgdHJ5IHsgYnJvd3NlcmJvdCA9IHBhcmVudC5zZWxlbml1bS5icm93c2VyYm90OyB9IGNhdGNoKGUpIHt9DQogIGlmKHdpbmRvdy5zaG93TW9kYWxEaWFsb2cgJiYgIWJyb3dzZXJib3QpIHsNCgkgICAgLy9zZW5kIHNlc3Npb25Ccm93c2VySWQgdG8gc2VydmxldCBiZWZvcmUgb3BlbiBuZXcgd2luZG93DQoJICAgIHByb2Nlc3NBamF4U2VydmxldCgpOw0KCSAgICByZXR1cm4gd2luZG93LnNob3dNb2RhbERpYWxvZyh3aW5kb3dVUkwsIHN0ck1lc3NhZ2UsICJkaWFsb2dXaWR0aDoiICsgd2luV2lkdGggKyAiIHB4O2RpYWxvZ0hlaWdodDoiICsgd2luSGVpZ2h0ICsgInB4O2NlbnRlcjoxO2hlbHA6MDtzdGF0dXM6MDsiICsgYWRkRmxhZ3MpOw0KICB9IGVsc2UgeyAvLyBtb3ppbGxhIG1vZGFsIHdpbmRvdywgZG9lc24ndCB3b3JrIGZvciBmaXJlZm94IDIuMCBvciBTZWxlbml1bQ0KDQogIAlyZXR1cm4gb3Blbk5ld1dpbmRvdyh3aW5kb3dVUkwsJ0RpYWxvZycsd2luV2lkdGgsd2luSGVpZ2h0LCdubycsJ3llcycpOw0KICB9DQp9DQoNCi8vIENSIDUxNTggLSByZXBsYWNlbWVudCBmb3Igd2luZG93LnNob3dNb2RhbERpYWxvZyBmb3JtYWxseSB1c2VkIGZvciB3aW5JRC4NCi8vIFNpbmNlIHRoaXMgY29kZSBpcyByb2xsZWQgYmFjaywgdGhlIGNvZGUgaXMgbm90aGluZyBtb3JlIHRoYW4gYW4gaW50ZXJtZWRpYXRlIGNhbGwgdG8gdGhlIHJlYWwgd2luZG93LnNob3dNb2RhbERpYWxvZygpDQpmdW5jdGlvbiB3U2hvd01vZGFsRGlhbG9nKHdpbmRvd1VSTCwgYXJndW1lbnRzLCBmZWF0dXJlcykgew0KCS8vIENSNTE1OA0KICAgIC8vc2VuZCBzZXNzaW9uQnJvd3NlcklkIHRvIHNlcnZsZXQgYmVmb3JlIG9wZW4gbmV3IHdpbmRvdw0KICAgIHByb2Nlc3NBamF4U2VydmxldCgpOw0KCXJldHVybiB3aW5kb3cuc2hvd01vZGFsRGlhbG9nKHdpbmRvd1VSTCwgYXJndW1lbnRzLCBmZWF0dXJlcyk7DQp9DQoNCmZ1bmN0aW9uIGNsb3NlV2luZG93KCkgew0KICAJICB3aW5kb3cuY2xvc2UoKTsNCn0NCg0KLyoqDQogKiBPcGVucyBhIG1vZGFsIGRpYWxvZyB3aXRoIGEgZGlzY2xhaW1lciBmb3JtIHdoZXJlIHRoZSB1c2VyIG11c3QgZWl0aGVyIGFjY2VwdCBoYXZpbmcgcmVhZCB0aGUgZGlzY2xhaW1lciBvciBjYW5jZWwuDQogKiBUaGUgZGlzcGxheWVkIHRleHQgaXMgdW5pcXVlIHBlciBOZWVkcyBEb21haW4uIEFsc28sIGNlcnRhaW4gZG9tYWlucyAobGlrZSBTdWJzdGFuY2UgQWJ1c2UpIHJlcXVpcmUgdGhlIGFwcGxpY2F0aW9uDQogKiBsb2cgdGhlIGFjdGl2aXR5IGluIGRhdGFiYXNlIChoYW5kbGVkIGJ5IHRoZSBzZXJ2bGV0KS4NCiAqIA0KICogVGhlIGZvcm0gaXMgZHluYW1pYywgcXVlcnlpbmcgYSBEaXNjbGFpbWVyQ29udHJvbGxlciB0aGF0IHJldHVybnMgYSBqc29uIG9iamVjdCBvZiBkYXRhIHRvIGRpc3BsYXkuDQogKiANCiAqIEBwYXJhbSBzdGFmZklkIHRoZSBpZCBvZiB0aGUgY3VycmVudCB1c2VyDQogKiBAcGFyYW0gZG9jTmIgdGhlIGlkIG9mIHRoZSBvZmZlbmRlciBpbiBjb250ZXh0DQogKiBAcGFyYW0gb2ZubnR5Q2QgaWYgc3BlY2lmaWVkLCB0aGUgbmVlZCBkb21haW4gKHdoaWNoIGRldGVybWluZXMgdGhlIHRleHQgb2YgdGhlIGRpc2NsYWltZXIpDQogKiBAcGFyYW0gc2NyZWVuIGlmIHNwZWNpZmllZCwgdGhlIG9yaWdpbiBvZiB0aGlzIGNhbGwuDQogKiBAcGFyYW0gb25TdWNjZXNzQ2FsbGJhY2sgYSBqYXZhc2NyaXB0IGZ1bmN0aW9uIHRvIHJ1biBpZiB0aGUgdXNlciBwcmVzc2VzICJPSyINCiAqIEBwYXJhbSBvbkNhbmNlbENhbGxiYWNrIGEgamF2YXNjcmlwdCBmdW5jdGlvbiB0byBydW4gaWYgdGhlIHVzZXIgcHJlc3NlcyAiQ2FuY2VsIg0KICovDQpmdW5jdGlvbiBvcGVuRGlzY2xhaW1lckRpYWxvZyhkb2NOYiwgb2ZubnR5Q2QsIHNjcmVlbiwgb25TdWNjZXNzQ2FsbGJhY2ssIG9uQ2FuY2VsQ2FsbGJhY2spIHsNCgkNCgkvLyByZXRyaWV2ZSBqc29uIGRhdGEgZnJvbSBEaXNjbGFpbWVyQ29udHJvbGxlciAoR0VUIHJlcXVlc3QpIGFuZCBwb3B1bGF0ZSBhIGRpYWxvZyBib3gNCgkkLmFqYXgoeyANCgkJICAgIG1ldGhvZDogIkdFVCIsDQoJCQlkYXRhVHlwZTogImpzb24iLCANCgkJCXVybDogIi9vbW5pL2FkdmNvci9uZWVkcy9kaXNjbGFpbWVyLmpzb24iLCANCgkJCWRhdGE6IHsgImRvY05iIjogZG9jTmIsICJvZm5udHlDZCI6IG9mbm50eUNkLCAic2NyZWVuIjogc2NyZWVufSwNCgkJCWNhY2hlOiBmYWxzZQ0KCQl9KQ0KCQkuZG9uZSggZnVuY3Rpb24oIGpzb24sIHRleHRTdGF0dXMsIGpxWEhSICkgeyANCgkJCWlmIChqc29uLmVycm9yKSB7DQoJCQkJLy8gdGhlcmUgd2FzIGFuIGVycm9yIHJldHJpZXZpbmcgdGhpcyBKU09OIHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyLg0KCQkJCXZhciBkaWFsb2cgPSBvcGVuRGlhbG9nKCJFcnJvciIsICJUaGVyZSB3YXMgYW4gZXJyb3IgcmV0cmlldmluZyB0aGUgZGlzY2xhaW1lciB0ZXh0Ojxici8+IiArIGpzb24uZXJyb3IsIGZ1bmN0aW9uKCkge30pOw0KCQkJfQ0KCQkJZWxzZSB7CQkJCQ0KCQkJCS8vIHNob3cgZGlzY2xhaW1lciBwb3B1cC4gIHJ1biBjYWxsYmFjayBvbmx5IGlmIE9LIHdhcyBwcmVzc2VkLg0KCQkJCWlmIChqc29uLmRpc2NsYWltZXIpIHsNCgkJCQkJJC5kaXNjbGFpbWVyRGlhbG9nKA0KCQkJCQkJanNvbi5kaXNjbGFpbWVyLA0KCQkJCQkJb25TdWNjZXNzQ2FsbGJhY2ssIA0KCQkJCQkJb25DYW5jZWxDYWxsYmFjaw0KCQkJCQkpOw0KCQkJCX0NCgkJCQkgDQoJCQkJLy8gaWYgdGhlcmUgaXMgbm8gZGlzY2xhaW1lciwgb3IgdGhlcmUgaXMgYSBkaXNjbGFpbWVyIGJ1dCB0aGUgdXNlciBoYXMgYWxyZWFkeSBhY2tub3dsZWRnZWQgaXQsIGp1c3QgcnVuIHRoZSBjYWxsYmFjay4NCgkJCQllbHNlICB7DQoJCQkJCWlmIChvblN1Y2Nlc3NDYWxsYmFjaykgb25TdWNjZXNzQ2FsbGJhY2suY2FsbCgpOw0KCQkJCX0NCgkJCX0NCgkJfSkNCgkJLmZhaWwoIGZ1bmN0aW9uKCBqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24gKSB7IA0KCQkJY29uc29sZS5lcnJvcigiRGlzY2xhaW1lckNvbnRyb2xsZXIgaW52YWxpZCBqc29uIHJlc3BvbnNlOiIgKyBqcVhIUik7DQoJCQljb25zb2xlLmVycm9yKGVycm9yVGhyb3duKTsNCgkJfSkNCgkJLmFsd2F5cyggZnVuY3Rpb24oIGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biApIHsJCQkNCgkJfSk7DQp9DQoNCi8qKg0KICogQ3JlYXRlIGEgQ1NTIG1vZGFsIGRpYWxvZyAobm90IGEgYnJvd3NlciBwb3B1cCB3aW5kb3cpIHdpdGggT2sgYW5kIENhbmNlbCBidXR0b25zLg0KICogDQogKiBAcGFyYW0gdGl0bGUgVGhlIHRpdGxlIG9mIHRoZSBkaWFsb2cuDQogKiBAcGFyYW0gY29udGVudCBUaGUgY29udGVudCB0byBkaXNwbGF5IGluIHRoZSBtYWluIHBhcnQgb2YgdGhlIGRpYWxvZy4gTWF5IGJlIGh0bWwuIENvbnRlbnQgaXMgbm90IGV4Y2FwZWQsIG5vciBzaG91bGQNCiAqICAgICAgICAgICAgaXQgYmUgZXNjYXBlZCBzaW5jZSBpdCBpcyBub3QgdXNlci1nZW5lcmF0ZWQgZGF0YS4NCiAqIEBwYXJhbSBvbk9LUHJlc3NlZCBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIHJ1biB3aGVuICJPSyIgaXMgcHJlc3NlZC4NCiAqIEBwYXJhbSBvbkNhbmNlbFByZXNzZWQgYSBjYWxsYmFjayBmdW5jdGlvbiB0byBydW4gd2hlbiAiQ2FuY2VsIiBpcyBwcmVzc2VkLg0KICovDQpmdW5jdGlvbiBvcGVuRGlhbG9nKF90aXRsZSwgX2NvbnRlbnQsIF9vbk9LUHJlc3NlZCwgX29uQ2FuY2VsUHJlc3NlZCkgew0KCQ0KCS8vIGNyZWF0ZSBhIHRlbXBvcmFyeSA8ZGl2PiB0byBob2xkIHRoZSBwb3B1cCAoYXR0YWNoZWQgdG8gZW5kIG9mIDxib2R5PikNCgl2YXIgZGl2ID0gJCgnPGRpdiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPjwvZGl2PicpOw0KCWRpdi5odG1sKF9jb250ZW50KTsgDQoJCQ0KCS8vIHNob3cgdGhlIHBvcHVwDQoJdmFyIGRpYWxvZyA9IGRpdi5kaWFsb2coew0KCQl0aXRsZTogX3RpdGxlLA0KCQltb2RhbDogdHJ1ZSwNCgkJbWluV2lkdGg6IDQwMCwNCgkJYnV0dG9uczogWw0KCQkJew0KCQkJCXRleHQ6ICJPayIsDQoJCQkJY2xpY2s6IGZ1bmN0aW9uKCkgew0KCQkJCQkkKHRoaXMpLmRpYWxvZyggImNsb3NlIiApOw0KCQkJCQlpZiAoX29uT0tQcmVzc2VkKSBfb25PS1ByZXNzZWQuY2FsbCgpOw0KCQkJCX0NCgkJCX0sDQoJCQkNCgkJCXsNCgkJCQl0ZXh0OiAiQ2FuY2VsIiwNCgkJCQljbGljazogZnVuY3Rpb24oKSB7DQoJCQkJCSQodGhpcykuZGlhbG9nKCAiY2xvc2UiICk7DQoJCQkJCWlmIChfb25DYW5jZWxQcmVzc2VkKSBfb25DYW5jZWxQcmVzc2VkLmNhbGwoKTsNCgkJCQl9DQoJCQl9DQoJCV0sDQoJCWNsb3NlOiBmdW5jdGlvbigpIHsNCgkJCS8vIGNsZWFudXAgLSByZW1vdmVzIHRoZSBkaXNjbGFpbWVyIDxkaXY+IGZyb20gdGhlIERPTS4NCgkJCSQodGhpcykucmVtb3ZlKCk7DQoJCX0NCgl9KTsNCgkNCglyZXR1cm4gZGlhbG9nLnBhcmVudCgnZGl2LnVpLWRpYWxvZycpOw0KfQ0KDQpmdW5jdGlvbiBzZWxlY3RBbGxMaXN0Q2hlY2tib3hlcyhteUZvcm0sIG15TmFtZSkgew0KCS8vIE5QRSBmaXggLSBub3QgYWxsIGJyb3dzZXJzIGhhdmUgYSBnbG9iYWwgZXZlbnQgb2JqZWN0IC0gbW9zdCBwYXNzIHRoZSBldmVudCB0byB0aGUgaGFuZGxlci4NCglpZiAodHlwZW9mIGV2ZW50ICE9ICd1bmRlZmluZWQnICYmIGV2ZW50LnNoaWZ0S2V5KXtyZXR1cm4gZmFsc2U7fSAvL2J1ZyM3MzgNCgl2YXIgY2hlY2tCb3hTZWFyY2hSZWdFeHAgPSBuZXcgUmVnRXhwKG15TmFtZSArICJcXGQqIik7DQoJdmFyIGVsZW1lbnRzTGVuZ3RoID0gZG9jdW1lbnQuZm9ybXNbbXlGb3JtXS5lbGVtZW50cy5sZW5ndGg7DQoJaWYoZWxlbWVudHNMZW5ndGggPiAwKSB7DQoJCWZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHNMZW5ndGg7IGkrKykgew0KCQkJdmFyIGVsZW1lbnROYW1lID0gZG9jdW1lbnQuZm9ybXNbbXlGb3JtXS5lbGVtZW50c1tpXS5uYW1lOw0KCQkJaWYgKGVsZW1lbnROYW1lICE9IG51bGwgJiYgZWxlbWVudE5hbWUubWF0Y2goY2hlY2tCb3hTZWFyY2hSZWdFeHApKSB7DQoJCQkJZG9jdW1lbnQuZm9ybXNbbXlGb3JtXS5lbGVtZW50c1tpXS5jaGVja2VkID0gdHJ1ZTsNCgkJCX0NCgkJfQ0KCX0NCn0NCg0KZnVuY3Rpb24gY2xlYXJBbGxMaXN0Q2hlY2tib3hlcyhteUZvcm0sIG15TmFtZSkgew0KDQoJaWYoZXZlbnQuc2hpZnRLZXkpe3JldHVybiBmYWxzZTt9Ly9idWcjNzM4DQoNCgl2YXIgY2hlY2tCb3hTZWFyY2hSZWdFeHAgPSBuZXcgUmVnRXhwKG15TmFtZSArICJcXGQqIik7DQoJdmFyIGVsZW1lbnRzTGVuZ3RoID0gZG9jdW1lbnQuZm9ybXNbbXlGb3JtXS5lbGVtZW50cy5sZW5ndGg7DQoJaWYoZWxlbWVudHNMZW5ndGggPiAwKSB7DQoJCWZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHNMZW5ndGg7IGkrKykgew0KCQkJdmFyIGVsZW1lbnROYW1lID0gZG9jdW1lbnQuZm9ybXNbbXlGb3JtXS5lbGVtZW50c1tpXS5uYW1lOw0KCQkJaWYgKGVsZW1lbnROYW1lICE9IG51bGwgJiYgZWxlbWVudE5hbWUubWF0Y2goY2hlY2tCb3hTZWFyY2hSZWdFeHApKSB7DQoJCQkJZG9jdW1lbnQuZm9ybXNbbXlGb3JtXS5lbGVtZW50c1tpXS5jaGVja2VkID0gZmFsc2U7DQoJCQl9DQoJCX0NCgl9DQp9DQoNCi8qIHVzZWQgYnkgY2hyb25vc1NlYXJjaDsgYW5vdGhlciB2ZXJzaW9uIGlzIGluIG5vdGlmaWNhdGlvbi5qcyAqLw0KZnVuY3Rpb24gY291bnRTZWxlY3RlZENoZWNrYm94ZXMobXlGb3JtLCBteU5hbWUpIHsNCiAgICAgICAJdmFyIGVsZW1lbnRzTGVuZ3RoID0gZG9jdW1lbnQuZm9ybXNbbXlGb3JtXS5lbGVtZW50cy5sZW5ndGg7DQoJCXZhciBjb3VudCA9IDA7DQoJCXZhciBmb3VuZENoZWNrQm94ZXMgPSBmYWxzZTsNCg0KCQlpZihlbGVtZW50c0xlbmd0aCA+IDApIHsNCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHNMZW5ndGg7IGkrKykgew0KCQkJCXZhciBlbGVtZW50TmFtZSA9IGRvY3VtZW50LmZvcm1zW215Rm9ybV0uZWxlbWVudHNbaV0ubmFtZTsNCg0KCQkJCWlmKGVsZW1lbnROYW1lICE9IG51bGwgJiYgZWxlbWVudE5hbWUubWF0Y2gobXlOYW1lKSkgew0KCQkJCQlpZihkb2N1bWVudC5mb3Jtc1tteUZvcm1dLmVsZW1lbnRzW2ldLmNoZWNrZWQgPT0gdHJ1ZSkgew0KCQkJCQkJY291bnQrKzsNCgkJCQkJfQ0KCQkJCQlmb3VuZENoZWNrQm94ZXMgPSB0cnVlOw0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCWlmKGNvdW50ID09IDAgJiYgZm91bmRDaGVja0JveGVzID09IGZhbHNlKSB7DQoJCQljb3VudCA9IC0xOyAvLyBzcGVjaWFsIGNhc2UgZm9yIHdoZW4gbm8gcmVzdWx0cyBleGlzdA0KCQl9DQoNCgkJcmV0dXJuIGNvdW50Ow0KCX0NCg0KCS8qDQoJICogRnVuY3Rpb246IG9wZW5PZmZlbmRlclNlYXJjaFBvcHVwKCkNCgkgKiBQdXJwb3NlOiBTaG93cyB0aGUgc3RhZmYgYWRkcmVzcyBib29rIGZvciBzZWxlY3RpbmcgcG9zaXRpb24gaW4gTXVsdGlzZWxlY3QgTW9kZS4NCgkgKiAgICAgICAgICBSZXF1aXJlZCBzZXQgdGhlIENhbGxiYWNrIGZ1bmN0aW9uOiAgZm9yIEV4YW1wbGU6IG15Q2FsbEJhY2tGdW5jdGlvbihkYXRhQXJyYXkpDQoJICogICAgICAgICAgVGhlIGRhdGFBcnJheSBpcyBhIDIgZGltZW5zaW9uIEFycmF5LiAgRWFjaCByb3cgaXMgaW5kaXZpZHVhbCBzdGFmZiByZWNvcmQsIHRoZSBjb2x1bW5zIGFyZQ0KCSAqICAgICAgICAgIHRoZSBmaWVsZHMgZm9yIHRoYXQgcmVjb3JkIGluIHRoZSBvcmRlcjogU3RhZmZOYW1lLCBTdGFmZklkLCBQb3NpdGlvbklkLCBPcGVuaW5nSWQNCgkgKg0KCSAqIEFyZ3VtZW50czogY2FsbGJhY2tGdW5jdGlvbiA9IENhbGwgYmFjayBmdW5jdGlvbi4gIFdoZW4gdGhlIGNoaWxkIHdpbmRvdyByZXR1cm5zIGl0IHdpbGwgY2FsbCB0aGlzIGZ1bmN0aW9uLg0KCSAqIFJldHVybnM6IE5vdGhpbmcNCgkgKiovDQoJZnVuY3Rpb24gb3Blbk9mZmVuZGVyU2VhcmNoUG9wdXAoY2FsbGJhY2tGdW5jdGlvbikgew0KCSAgICB2YXIgdXJsID0gIi9vbW5pL3JlY29yZHMvb2ZmZW5kZXIvb2ZmZW5kZXJTZWFyY2hOb05hdlBvcHVwLmh0bSI7DQoJICAgIHZhciByZXN1bHQgPSBvcGVuTW9kYWxEaWFsb2codXJsLCAxMDAwLCA2MDApOw0KDQoJCWlmIChyZXN1bHQgIT0gbnVsbCkgew0KCQkJCQljYWxsYmFja0Z1bmN0aW9uKHJlc3VsdCk7DQoJCX0NCg0KCX0NCg0KDQovKg0KICogRnVuY3Rpb246IHNob3dTdGFmZkFkZHJlc3NCb29rTXVsdGlTZWxlY3QoKQ0KICogUHVycG9zZTogU2hvd3MgdGhlIHN0YWZmIGFkZHJlc3MgYm9vayBmb3Igc2VsZWN0aW5nIHBvc2l0aW9uIGluIE11bHRpc2VsZWN0IE1vZGUuDQogKiAgICAgICAgICBSZXF1aXJlZCBzZXQgdGhlIENhbGxiYWNrIGZ1bmN0aW9uOiAgZm9yIEV4YW1wbGU6IG15Q2FsbEJhY2tGdW5jdGlvbihkYXRhQXJyYXkpDQogKiAgICAgICAgICBUaGUgZGF0YUFycmF5IGlzIGEgMiBkaW1lbnNpb24gQXJyYXkuICBFYWNoIHJvdyBpcyBpbmRpdmlkdWFsIHN0YWZmIHJlY29yZCwgdGhlIGNvbHVtbnMgYXJlDQogKiAgICAgICAgICB0aGUgZmllbGRzIGZvciB0aGF0IHJlY29yZCBpbiB0aGUgb3JkZXI6IFN0YWZmTmFtZSwgU3RhZmZJZCwgUG9zaXRpb25JZCwgT3BlbmluZ0lkDQogKg0KICogQXJndW1lbnRzOiBkaWFsb2dVUkwgPSBEaWFsb2cgVVJMIHRvIHRoZSBhZGRyZXNzIGJvb2ssIGllOiAvb21uaS9jb21tb24vZGlhbG9ncy9yb2xvZGV4UG9wdXAuaHRtDQogKiAgICAgICAgICAgIGNhbGxiYWNrRnVuY3Rpb24gPSBDYWxsIGJhY2sgZnVuY3Rpb24uICBXaGVuIHRoZSBjaGlsZCB3aW5kb3cgcmV0dXJucyBpdCB3aWxsIGNhbGwgdGhpcyBmdW5jdGlvbi4NCiAqIFJldHVybnM6IE5vdGhpbmcNCiAqKi8NCmZ1bmN0aW9uIHNob3dTdGFmZkFkZHJlc3NCb29rTXVsdGlTZWxlY3QoZGlhbG9nVVJMLCBjYWxsYmFja0Z1bmN0aW9uKSB7DQogIHZhciB3aW5XaWR0aCA9IDkwMDsNCiAgdmFyIHdpbkhlaWdodCA9IDUyMDsNCg0KICBkaWFsb2dVUkwgPSBkaWFsb2dVUkwgKyAiP3R5cGU9TVVMVElTRUxFQ1QiOw0KDQogIHZhciByZXQgPSBvcGVuTW9kYWxEaWFsb2coZGlhbG9nVVJMLHdpbldpZHRoLHdpbkhlaWdodCk7DQogIGlmKHJldCAhPSBudWxsKSB7DQogIAlwYXJzZU11bHRpU2VsZWN0U3RhZmZSZXR1cm5WYWx1ZXMocmV0LCBjYWxsYmFja0Z1bmN0aW9uKTsNCiAgfQ0KDQp9DQoNCi8qDQogKiBGdW5jdGlvbjogcGFyc2VNdWx0aVNlbGVjdFN0YWZmUmV0dXJuVmFsdWVzKCkNCiAqIFB1cnBvc2U6IFBhcnNlcyBkYXRhIHJldHVybmVkIGZyb20gc2hvd1N0YWZmQWRkcmVzc0Jvb2tNdWx0aVNlbGVjdCBmdW5jdGlvbigpLiBNVUxUSVNFTEVDVCBWZXJzaW9uLg0KICoNCiAqIEFyZ3VtZW50czogcmVzdWx0cyA9IFVSSSBlbmNvZGVkIGRhdGEgaW4ga2V5L3ZhbHVlIHBhaXJzLg0KICogICAgICAgICAgICBjYWxsYmFja0Z1bmN0aW9uID0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIHBhc3NpbmcgYmFjayB0aGUgZGF0YS4NCiAqIFJldHVybnM6IE5vdGhpbmcNCiAqKi8NCiBmdW5jdGlvbiBwYXJzZU11bHRpU2VsZWN0U3RhZmZSZXR1cm5WYWx1ZXMocmVzdWx0cywgY2FsbGJhY2tGdW5jdGlvbikgew0KDQoJLy8gcmVzdWx0cyBjb21lIGFzIGEgc3RyaW5nIGFuZCB0aGVyZWZvcmUgbmVlZHMgdG8gYmUgcGFyc2VkDQoJdmFyIHN0YWZmQXJyYXkgPSBudWxsOw0KDQoJaWYocmVzdWx0cyAhPSBudWxsICYmIHJlc3VsdHMubGVuZ3RoID4gMCkgew0KCQl2YXIga2V5VmFsdWVBcnJheSA9IHJlc3VsdHMuc3BsaXQoIiYiKTsNCg0KCQlpZihrZXlWYWx1ZUFycmF5ICE9IG51bGwpIHsNCgkJCXZhciByZWNvcmRDb3VudCA9IGtleVZhbHVlQXJyYXkubGVuZ3RoIC8gNDsgIC8vIDQgZmllbGRzIHBlciByZWNvcmQNCg0KCQkJc3RhZmZBcnJheSA9IG5ldyBBcnJheShyZWNvcmRDb3VudCkNCgkJCWZvciAoaT0wOyBpIDwgc3RhZmZBcnJheS5sZW5ndGg7IGkrKykgew0KCQkJCXN0YWZmQXJyYXlbaV0gPSBuZXcgQXJyYXkoNCk7DQoJCQl9DQoNCg0KCQkJdmFyIHBhcmFtTmFtZSA9IG51bGw7DQoJCQl2YXIgcGFyYW1JZCA9IG51bGw7DQoJCQl2YXIgcGFyYW1Qb3NpdGlvbklkID0gbnVsbDsNCgkJCXZhciBwYXJhbU9wZW5pbmdJZCA9IG51bGw7DQoNCgkJCWZvcih2YXIgaSA9IDAsIGMgPSAxOyBpIDwga2V5VmFsdWVBcnJheS5sZW5ndGg7IGkrKykgew0KCQkJCXZhciBkYXRhQXJyYXkgPSBrZXlWYWx1ZUFycmF5W2ldLnNwbGl0KCI9Iik7DQoNCgkJCQlpZihkYXRhQXJyYXkubGVuZ3RoID09IDIpIHsNCgkJCQkJaWYoZGF0YUFycmF5WzBdID09ICgibiIgKyAoYyAtIDEpKSkgew0KCQkJCQkJcGFyYW1OYW1lID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0gZWxzZSBpZihkYXRhQXJyYXlbMF0gPT0gKCJpIiArIChjIC0gMSkpKSB7DQoJCQkJCQlwYXJhbUlkID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0gZWxzZSBpZihkYXRhQXJyYXlbMF0gPT0gKCJwIiArIChjIC0gMSkpKSB7DQoJCQkJCQlwYXJhbVBvc2l0aW9uSWQgPSBkZWNvZGVVUkkoZGF0YUFycmF5WzFdKTsNCgkJCQkJfSBlbHNlIGlmKGRhdGFBcnJheVswXSA9PSAoIm8iICsgKGMgLSAxKSkpIHsNCgkJCQkJCXBhcmFtT3BlbmluZ0lkID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0NCgkJCQl9DQoNCgkJCQlpZigoKGkgKyAxKSAlIDQpID09IDApIHsNCgkJCQkJc3RhZmZBcnJheVtjIC0gMV1bMF0gPSBwYXJhbU5hbWU7DQoJCQkJCXN0YWZmQXJyYXlbYyAtIDFdWzFdID0gcGFyYW1JZDsNCgkJCQkJc3RhZmZBcnJheVtjIC0gMV1bMl0gPSBwYXJhbVBvc2l0aW9uSWQ7DQoJCQkJCXN0YWZmQXJyYXlbYyAtIDFdWzNdID0gcGFyYW1PcGVuaW5nSWQ7DQoNCgkJCQkJcGFyYW1OYW1lID0gbnVsbDsNCgkJCQkJcGFyYW1JZCA9IG51bGw7DQoJCQkJCXBhcmFtUG9zaXRpb25JZCA9IG51bGw7DQoJCQkJCXBhcmFtT3BlbmluZ0lkID0gbnVsbDsNCgkJCQkJYysrOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCX0NCg0KCWlmKGNhbGxiYWNrRnVuY3Rpb24pIHsNCgkJY2FsbGJhY2tGdW5jdGlvbihzdGFmZkFycmF5KTsNCgl9DQoNCgkvLyB1cGRhdGUgaXNEaXJ0eSBpZiB0aGUgZm9ybSBjaGFuZ2VkLg0KCS8vb25Gb3JtQ2hhbmdlQ2xpY2tFdmVudCgpOw0KfQ0KDQoNCi8qDQogKiBGdW5jdGlvbjogc2hvd1N0YWZmQWRkcmVzc0Jvb2soKQ0KICogUHVycG9zZTogU2hvd3MgdGhlIHN0YWZmIGFkZHJlc3MgYm9vayBmb3Igc2VsZWN0aW5nIHBvc2l0aW9uLg0KICogICAgICAgICAgUmVxdWlyZXMgY2FsbGJhY2sgZnVuY3Rpb24gbmFtZWQ6ICBzdGFmZkFkZHJlc3NCb29rQ2FsbEJhY2socGFyYW1TdGFmZk5hbWUsIHBhcmFtUG9zaXRpb25JZCwgcGFyYW1PcGVuaW5nSWQsIGlkZW50aWZpZXIpDQogKg0KICogQXJndW1lbnRzOiBkaWFsb2dVUkwgPSBEaWFsb2cgVVJMIHRvIHRoZSBhZGRyZXNzIGJvb2ssIGllOiAvb21uaS9jb21tb24vZGlhbG9ncy9yb2xvZGV4UG9wdXAuaHRtDQogKiAgICAgICAgICAgIGlkZW50aWZpZXIgPSBBIHVuaXF1ZSBpZGVudGlmaWVyIG5hbWUgdXNlZCBpbiB0aGUgY2FsbGJhY2sgZnVuY3Rpb24gdG8gaWRlbnRpZnkgd2hpY2ggaW5zdGFuY2Ugb2YgdGhlIGRpYWxvZyBpcyBiZWluZyB1c2VkLg0KICogICAgICAgICAgICBzdGFmZkFkZHJlc3NCb29rVHlwZSA9IHR5cGUgb2YgYWRkcmVzcyBib29rLiAgT3B0aW9ucyBhcmUgIkRFRkFVTFQiLCAiU0VMRUNUX1NUQUZGIi4NCiAqICAgICAgICAgICAgc3RhZmZJZCA9IFN0YWZmIElkDQogKiAgICAgICAgICAgIHBvc2l0aW9uSWQgPSBwb3NpdGlvbiBJZA0KICogICAgICAgICAgICBvcGVuaW5nSWQgPSBPcGVuaW5nIElkDQogKiAgICAgICAgICAgIGZpZWxkcyA9IGFuIGFycmF5IG9mIGVsZW1lbnQgaWRzIHRvIHBvcHVsYXRlIG9uIGNhbGxiYWNrDQogKiAgICAgICAgICAgIGVuYWJsZUhpc3RvcmljYWxTdGFmZk9ubHkgPSBhIGJvb2xlYW4uICBJZiB0cnVlLCB3aWxsIHNob3cgYSBjaGVja2JveCBvbiB0aGUgcm9sb2RleCBwb3B1cC4NCiAqICAgICAgICAgICAgaXNTaW1wbGVDYWxsYmFjayAtIGlmIHRydWUsIHRoZSBjYWxsYmFja0Z1bmN0aW9uIHdpbGwgYWNjZXB0IGEgc2luZ2xlIGRhdGEgbWFwIHBhcmFtZXRlciAoanVzdCBsaWtlIGEgdHlwaWNhbCBEV1Igc3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbikuDQogKiBSZXR1cm5zOiBOb3RoaW5nDQogKiovDQpmdW5jdGlvbiBzaG93U3RhZmZBZGRyZXNzQm9vayhkaWFsb2dVUkwsIGNhbGxiYWNrRnVuY3Rpb24sIHN0YWZmQWRkcmVzc0Jvb2tUeXBlLCBzdGFmZklkLCBwb3NpdGlvbklkLCBvcGVuaW5nSWQsIGZpZWxkcywgZW5hYmxlSGlzdG9yaWNhbFN0YWZmT25seSwgaXNTaW1wbGVDYWxsYmFjaykgew0KICB2YXIgd2luV2lkdGggPSA5MDA7DQogIHZhciB3aW5IZWlnaHQgPSA0MDA7DQoNCg0KICBpZihzdGFmZkFkZHJlc3NCb29rVHlwZSAhPSBudWxsKSB7DQogIAlkaWFsb2dVUkwgPSBkaWFsb2dVUkwgKyAiP3R5cGU9IiArIHN0YWZmQWRkcmVzc0Jvb2tUeXBlOw0KICB9IGVsc2Ugew0KICAJZGlhbG9nVVJMID0gZGlhbG9nVVJMICsgIj90eXBlPURFRkFVTFQiOw0KICB9DQoNCiAgaWYoc3RhZmZJZCAhPSBudWxsKSB7DQogIAlkaWFsb2dVUkwgPSBkaWFsb2dVUkwgKyAiJmlkPSIgKyBzdGFmZklkOw0KICAJaWYocG9zaXRpb25JZCAhPSBudWxsKSB7DQogIAkJZGlhbG9nVVJMID0gZGlhbG9nVVJMICsgIiZwaWQ9IiArIHBvc2l0aW9uSWQ7DQogIAl9DQoNCiAgCWlmKG9wZW5pbmdJZCAhPSBudWxsKSB7DQogIAkJZGlhbG9nVVJMID0gZGlhbG9nVVJMICsgIiZvaWQ9IiArIG9wZW5pbmdJZDsNCiAgCX0NCiAgfQ0KDQogIGlmIChlbmFibGVIaXN0b3JpY2FsU3RhZmZPbmx5ICE9IG51bGwgJiYgZW5hYmxlSGlzdG9yaWNhbFN0YWZmT25seSA9PSAndHJ1ZScpIHsNCgkgIGRpYWxvZ1VSTCA9IGRpYWxvZ1VSTCArICImZW5hYmxlSGlzdD10cnVlIjsNCiAgfQ0KDQogIHZhciByZXQgPSBvcGVuTW9kYWxEaWFsb2coZGlhbG9nVVJMLHdpbldpZHRoLHdpbkhlaWdodCk7DQogIGlmKHJldCAhPSBudWxsKSB7DQogIAlwYXJzZVN0YWZmUmV0dXJuVmFsdWVzVXNpbmdDYWxsYmFjayhyZXQsIGNhbGxiYWNrRnVuY3Rpb24sIGlzU2ltcGxlQ2FsbGJhY2ssIGZpZWxkcyk7DQogIH0NCg0KfQ0KDQovKg0KICogRnVuY3Rpb246IHBhcnNlU3RhZmZSZXR1cm5WYWx1ZXMoKQ0KICogUHVycG9zZTogUGFyc2VzIGRhdGEgcmV0dXJuZWQgZnJvbSBzaG93U3RhZmZBZGRyZXNzQm9vayBmdW5jdGlvbigpLg0KICoNCiAqIEFyZ3VtZW50czogcmVzdWx0cyA9IFVSSSBlbmNvZGVkIGRhdGEgaW4ga2V5L3ZhbHVlIHBhaXJzLg0KICogICAgICAgICAgICBpZGVudGlmaWVyID0gQSB1bmlxdWUgaWRlbnRpZmllciBuYW1lIHVzZWQgaW4gdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGlkZW50aWZ5IHdoaWNoIGluc3RhbmNlIG9mIHRoZSBkaWFsb2cgaXMgYmVpbmcgdXNlZC4NCiAqIFJldHVybnM6IE5vdGhpbmcNCiAqKi8NCiBmdW5jdGlvbiBwYXJzZVN0YWZmUmV0dXJuVmFsdWVzVXNpbmdDYWxsYmFjayhyZXN1bHRzLCBjYWxsYmFja0Z1bmN0aW9uLCBpc1NpbXBsZUNhbGxiYWNrLCBmaWVsZHMpIHsNCg0KCXZhciBkYXRhID0ge307DQoNCglpZihyZXN1bHRzICE9IG51bGwgJiYgcmVzdWx0cy5sZW5ndGggPiAwKSB7DQoJCXZhciBrZXlWYWx1ZUFycmF5ID0gcmVzdWx0cy5zcGxpdCgiJiIpOw0KDQoJCWlmKGtleVZhbHVlQXJyYXkgIT0gbnVsbCkgew0KCQkJZm9yKHZhciBpID0gMDsgaSA8IGtleVZhbHVlQXJyYXkubGVuZ3RoOyBpKyspIHsNCgkJCQl2YXIgZGF0YUFycmF5ID0ga2V5VmFsdWVBcnJheVtpXS5zcGxpdCgiPSIpOw0KDQoJCQkJaWYoZGF0YUFycmF5Lmxlbmd0aCA9PSAyKSB7DQoJCQkJCWlmKGRhdGFBcnJheVswXSA9PSAic3RhZmZOYW1lIikgew0KCQkJCQkJZGF0YS5zdGFmZk5hbWUgPSBkZWNvZGVVUkkoZGF0YUFycmF5WzFdKTsNCgkJCQkJfSBlbHNlIGlmKGRhdGFBcnJheVswXSA9PSAic3RhZmZJZCIpIHsNCgkJCQkJCWRhdGEuc3RhZmZJZCA9IGRlY29kZVVSSShkYXRhQXJyYXlbMV0pOw0KCQkJCQl9IGVsc2UgaWYoZGF0YUFycmF5WzBdID09ICJwb3NpdGlvbklkIikgew0KCQkJCQkJZGF0YS5wb3NpdGlvbklkID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0gZWxzZSBpZihkYXRhQXJyYXlbMF0gPT0gIm9wZW5pbmdJZCIpIHsNCgkJCQkJCWRhdGEub3BlbmluZ0lkID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0gZWxzZSBpZihkYXRhQXJyYXlbMF0gPT0gInN0ZlNxbmNOYiIpIHsNCgkJCQkJCWRhdGEuc3RmU3FuY05iID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0gZWxzZSBpZihkYXRhQXJyYXlbMF0gPT0gInBvc2l0aW9uVGl0bGUiKSB7DQoJCQkJCQlkYXRhLnBvc2l0aW9uVGl0bGUgPSBkZWNvZGVVUkkoZGF0YUFycmF5WzFdKTsNCgkJCQkJfSBlbHNlIGlmKGRhdGFBcnJheVswXSA9PSAicG9zaXRpb25GYWNpbGl0eU5hbWUiKSB7DQoJCQkJCQlkYXRhLmZhY2lsaXR5TmFtZSA9IGRlY29kZVVSSShkYXRhQXJyYXlbMV0pOw0KCQkJCQl9IGVsc2UgaWYoZGF0YUFycmF5WzBdID09ICJwb3NpdGlvbkZhY2lsaXR5SWQiKSB7DQoJCQkJCQlkYXRhLmZhY2lsaXR5SWQgPSBkZWNvZGVVUkkoZGF0YUFycmF5WzFdKTsNCgkJCQkJfSBlbHNlIGlmKGRhdGFBcnJheVswXSA9PSAiZmFjaWxpdHlSb2xlSWQiKSB7DQoJCQkJCQlkYXRhLmZhY2lsaXR5Um9sZUlkID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0gZWxzZSBpZihkYXRhQXJyYXlbMF0gPT0gInBvc2l0aW9uT2J0c051bWJlciIpIHsNCgkJCQkJCWRhdGEucG9zaXRpb25PYnRzTnVtYmVyID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0gZWxzZSBpZihkYXRhQXJyYXlbMF0gPT0gInBvc2l0aW9uTnVtYmVyIikgew0KCQkJCQkJZGF0YS5wb3NpdGlvbk51bWJlciA9IGRlY29kZVVSSShkYXRhQXJyYXlbMV0pOw0KCQkJCQl9IGVsc2UgaWYoZGF0YUFycmF5WzBdID09ICJpc0hpc3RvcmljYWwiKSB7DQoJCQkJCQlkYXRhLmlzSGlzdG9yaWNhbCA9IGRlY29kZVVSSShkYXRhQXJyYXlbMV0pOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJaWYoY2FsbGJhY2tGdW5jdGlvbiAhPSB1bmRlZmluZWQpIHsNCgkJCWlmIChpc1NpbXBsZUNhbGxiYWNrICE9IHVuZGVmaW5lZCAmJiBpc1NpbXBsZUNhbGxiYWNrID09ICd0cnVlJykgew0KCQkJCWNhbGxiYWNrRnVuY3Rpb24oZGF0YSk7DQoJCQl9DQoJCQllbHNlIHsNCgkJCQljYWxsYmFja0Z1bmN0aW9uKGRhdGEuc3RhZmZOYW1lLCBkYXRhLnN0YWZmSWQsIGRhdGEucG9zaXRpb25JZCwgZGF0YS5vcGVuaW5nSWQsIGRhdGEucG9zaXRpb25UaXRsZSwgZGF0YS5wb3NpdGlvbk9idHNOdW1iZXIsIGRhdGEuZmFjaWxpdHlJZCwgZGF0YS5mYWNpbGl0eVJvbGVJZCwgZGF0YS5mYWNpbGl0eU5hbWUsIGRhdGEucG9zaXRpb25OdW1iZXIpOw0KCQkJfQ0KCQl9DQoNCgkJLy8gVXBkYXRlIHRoZSBmaWVsZHMgZGlyZWN0bHkgaW5zdGVhZCBvZiBoYXZpbmcgYSBjYWxsYmFja0Z1bmN0aW9uIChpZiB0aGUgZmllbGQgZWxlbSBJRHMgd2VyZSBwYXNzZWQgaW4pDQoJCWlmIChmaWVsZHMgIT0gdW5kZWZpbmVkKSB7DQoJCQlpZiAoZmllbGRzLnN0YWZmTmFtZUVsZW1JRCAhPSB1bmRlZmluZWQpIHsNCgkJCQl2YXIgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZpZWxkcy5zdGFmZk5hbWVFbGVtSUQpOw0KCQkJCWlmIChlbGVtICAhPSB1bmRlZmluZWQpIHsNCgkJCQkJZWxlbS52YWx1ZT1kYXRhLnN0YWZmTmFtZTsNCgkJCQl9DQoJCQkJdXBkYXRlSXNEaXJ0eShlbGVtKTsNCgkJCX0NCgkJCWlmIChmaWVsZHMuc3RhZmZJZEVsZW1JRCAhPSB1bmRlZmluZWQpIHsNCgkJCQl2YXIgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZpZWxkcy5zdGFmZklkRWxlbUlEKTsNCgkJCQlpZiAoZWxlbSAhPSB1bmRlZmluZWQpIHsNCgkJCQkJZWxlbS52YWx1ZT1kYXRhLnN0YWZmSWQ7DQoJCQkJfQ0KCQkJCXVwZGF0ZUlzRGlydHkoZWxlbSk7DQoJCQl9DQoJCQlpZiAoZmllbGRzLnBvc2l0aW9uSWRFbGVtSUQgIT0gdW5kZWZpbmVkKSB7DQoJCQkJdmFyIGVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmaWVsZHMucG9zaXRpb25JZEVsZW1JRCk7DQoJCQkJaWYgKGVsZW0gIT0gdW5kZWZpbmVkKSB7DQoJCQkJCWVsZW0udmFsdWU9ZGF0YS5wb3NpdGlvbklkOw0KCQkJCX0NCgkJCQl1cGRhdGVJc0RpcnR5KGVsZW0pOw0KCQkJfQ0KCQkJaWYgKGZpZWxkcy5vcGVuaW5nSWRFbGVtSUQgIT0gdW5kZWZpbmVkKSB7DQoJCQkJdmFyIGVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmaWVsZHMub3BlbmluZ0lkRWxlbUlEKTsNCgkJCQlpZiAoZWxlbSAhPSB1bmRlZmluZWQpIHsNCgkJCQkJZWxlbS52YWx1ZT1kYXRhLm9wZW5pbmdJZDsNCgkJCQl9DQoJCQkJdXBkYXRlSXNEaXJ0eShlbGVtKTsNCgkJCX0NCgkJCWlmIChmaWVsZHMuc3RmU3FuY05iRWxlbUlEICE9IHVuZGVmaW5lZCkgew0KCQkJCXZhciBlbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZmllbGRzLnN0ZlNxbmNOYkVsZW1JRCk7DQoJCQkJaWYgKGVsZW0gIT0gdW5kZWZpbmVkKSB7DQoJCQkJCWVsZW0udmFsdWU9ZGF0YS5zdGZTcW5jTmI7DQoJCQkJfQ0KCQkJCXVwZGF0ZUlzRGlydHkoZWxlbSk7DQoJCQl9DQoJCQlpZiAoZmllbGRzLmhpc3RvcmljYWxFbGVtSUQgIT0gdW5kZWZpbmVkKSB7DQoJCQkJdmFyIGVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChmaWVsZHMuaGlzdG9yaWNhbEVsZW1JRCk7DQoJCQkJaWYgKGVsZW0gIT0gdW5kZWZpbmVkKSB7DQoJCQkJCWVsZW0udmFsdWU9ZGF0YS5pc0hpc3RvcmljYWw7DQoJCQkJfQ0KCQkJCXVwZGF0ZUlzRGlydHkoZWxlbSk7DQoJCQl9DQoJCX0NCg0KCQkvLyB1cGRhdGUgaXNEaXJ0eSBpZiB0aGUgZm9ybSBjaGFuZ2VkLg0KCQkvL29uRm9ybUNoYW5nZUNsaWNrRXZlbnQoKTsNCgl9DQoNCn0NCg0KDQovKg0KICogRnVuY3Rpb246IHNob3dTZWxlY3RDYXVzZURpYWxvZygpDQogKiBQdXJwb3NlOiBTaG93cyB0aGUgc2VsZWN0IENhdXNlIERpYWxvZyBmb3Igc2VsZWN0aW5nIHRoZSBPZmZlbmRlciBDYXVzZS4NCiAqICAgICAgICAgIFJlcXVpcmVzIGNhbGxiYWNrRnVuY3Rpb24uICBFeGFtcGxlOiBteUNhbGxCYWNrRnVuY3Rpb24ocGFyYW1VaWQsIHBhcmFtUHJlZml4LCBwYXJhbUNhdXNlTnVtYmVyKTsNCiAqDQogKiBBcmd1bWVudHM6IGRpYWxvZ1VSTCA9IERpYWxvZyBVUkwgdG8gdGhlIGFkZHJlc3MgYm9vaywgaWU6IC9vbW5pL2NvbW1vbi9kaWFsb2dzL3JvbG9kZXhQb3B1cC5odG0NCiAqICAgICAgICAgICAgY2FsbGJhY2tGdW5jdGlvbiA9IHRoZSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IHRoaXMgZnVuY3Rpb24gd2UgY2FsbCB3aGVuIGNvbXBsZXRlZC4NCiAqICAgICAgICAgICAgZG9jTnVtYmVyID0gdGhlIERPQyBudW1iZXIgb2YgdGhlIG9mZmVuZGVyDQogKiBSZXR1cm5zOiBOb3RoaW5nDQogKiovDQpmdW5jdGlvbiBzaG93U2VsZWN0Q2F1c2VEaWFsb2coZGlhbG9nVVJMLCBjYWxsYmFja0Z1bmN0aW9uLCBkb2NOdW1iZXIpIHsNCiAgdmFyIHdpbldpZHRoID0gNTAwOw0KICB2YXIgd2luSGVpZ2h0ID0gMjgwOw0KDQogIGlmKGRvY051bWJlciAhPSBudWxsKSB7DQoJZGlhbG9nVVJMID0gZGlhbG9nVVJMICsgIj9pZD0iICsgZG9jTnVtYmVyOw0KICB9DQoNCiAgdmFyIHJldCA9IG9wZW5Nb2RhbERpYWxvZyhkaWFsb2dVUkwsd2luV2lkdGgsd2luSGVpZ2h0KTsNCiAgcGFyc2VTZWxlY3RDYXVzZVJldHVyblZhbHVlcyhyZXQsIGNhbGxiYWNrRnVuY3Rpb24pOw0KfQ0KDQovKg0KICogRnVuY3Rpb246IHBhcnNlU2VsZWN0Q2F1c2VSZXR1cm5WYWx1ZXMoKQ0KICogUHVycG9zZTogUGFyc2VzIGRhdGEgcmV0dXJuZWQgZnJvbSBzaG93U2VsZWN0Q2F1c2VEaWFsb2cgZnVuY3Rpb24oKS4NCiAqDQogKiBBcmd1bWVudHM6IHJlc3VsdHMgPSBVUkkgZW5jb2RlZCBkYXRhIGluIGtleS92YWx1ZSBwYWlycy4NCiAqICAgICAgICAgICAgY2FsbEJhY2tGdW5jdGlvbiA9IHRoZSBjYWxsYmFjayBmdW5jdGlvbiB1c2VkIHRvIHBhc3MgdGhlIHBhcmFtZXRlcnMgYmFjay4NCiAqIFJldHVybnM6IE5vdGhpbmcNCiAqKi8NCmZ1bmN0aW9uIHBhcnNlU2VsZWN0Q2F1c2VSZXR1cm5WYWx1ZXMocmVzdWx0cywgY2FsbEJhY2tGdW5jdGlvbikgew0KDQoJdmFyIHBhcmFtVWlkID0gbnVsbDsNCgl2YXIgcGFyYW1QcmVmaXggPSBudWxsOw0KCXZhciBwYXJhbUNhdXNlTnVtYmVyID0gbnVsbDsNCg0KCWlmKHJlc3VsdHMgIT0gbnVsbCAmJiByZXN1bHRzLmxlbmd0aCA+IDApIHsNCgkJdmFyIGtleVZhbHVlQXJyYXkgPSByZXN1bHRzLnNwbGl0KCImIik7DQoNCgkJaWYoa2V5VmFsdWVBcnJheSAhPSBudWxsKSB7DQoJCQlmb3IodmFyIGkgPSAwOyBpIDwga2V5VmFsdWVBcnJheS5sZW5ndGg7IGkrKykgew0KCQkJCXZhciBkYXRhQXJyYXkgPSBrZXlWYWx1ZUFycmF5W2ldLnNwbGl0KCI9Iik7DQoNCgkJCQlpZihkYXRhQXJyYXkubGVuZ3RoID09IDIpIHsNCgkJCQkJaWYoZGF0YUFycmF5WzBdID09ICJudW0iKSB7DQoJCQkJCQlwYXJhbUNhdXNlTnVtYmVyID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0gZWxzZSBpZihkYXRhQXJyYXlbMF0gPT0gInVpZCIpIHsNCgkJCQkJCXBhcmFtVWlkID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0gZWxzZSBpZihkYXRhQXJyYXlbMF0gPT0gInBmeCIpIHsNCgkJCQkJCXBhcmFtUHJlZml4ID0gZGVjb2RlVVJJKGRhdGFBcnJheVsxXSk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0NCgl9DQoJaWYoY2FsbEJhY2tGdW5jdGlvbikgew0KCQljYWxsQmFja0Z1bmN0aW9uKHBhcmFtVWlkLCBwYXJhbVByZWZpeCwgcGFyYW1DYXVzZU51bWJlcik7DQoJfQ0KfQ0KDQovKg0KICogUmVmcmVzaGVzIHRoZSBDdXJyZW50IFBhZ2UuDQogKi8NCmZ1bmN0aW9uIHJlZnJlc2hDdXJyZW50UGFnZSgpIHsNCg0KCWlmKHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQpIHsNCgkJd2luZG93LmxvY2F0aW9uLnJlbG9hZCggZmFsc2UgKTsNCgl9IGVsc2UgaWYod2luZG93LmxvY2F0aW9uLnJlcGxhY2UpIHsNCgkJd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoIHdpbmRvdy5sb2NhdGlvbi5ocmVmICk7DQoJfSBlbHNlIHsNCgkJd2luZG93LmxvY2F0aW9uLmhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsNCgl9DQp9DQovKg0KCXJvd0NudCwgd2hlbiBtaXNzaW5nIHdpbGwgZGVmYXVsdCB0byAxDQoNCiovDQpmdW5jdGlvbiBhZGRSb3codGJsSWQsIHJvd0NudCwga2VlcFZhbHVlKSB7ICAgIC8vIGNsb25lIGxhc3QgJ3Jvd0NudCcgcm93cyAoZGVmYXVsdD0xKSBhbmQgbW9kaWZ5IHRoZWlyIElEcw0KCXZhciB0YmxCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGJsSWQpLnRCb2RpZXNbMF07DQoJaWYgKCFyb3dDbnQpIHJvd0NudCA9IDE7CS8vIGRlZmF1bHQgdG8gJzEnDQoJaWYgKHJvd0NudCA+IHRibEJvZHkucm93cy5sZW5ndGgpIHJvd0NudCA9IHRibEJvZHkucm93cy5sZW5ndGg7CS8vIHNhbml0eSBjaGVjaw0KCXZhciBmaXJzdE5ld1JvdyA9IHRibEJvZHkucm93cy5sZW5ndGg7DQoJdmFyIGNvcHlSb3cgPSBmaXJzdE5ld1JvdyAtIHJvd0NudDsNCgl2YXIgbmV3Um93TmR4ID0gZmlyc3ROZXdSb3cgLyByb3dDbnQ7DQoJZm9yICggO2NvcHlSb3cgPCBmaXJzdE5ld1JvdzsgY29weVJvdysrICkgewkvLyBmb3IgZWFjaCByb3csIGNsb25lLCBtYXNzYWdlICYgYWRkIHRvIERPTSENCgkJdmFyIG5ld05vZGUgPSB0YmxCb2R5LnJvd3NbY29weVJvd10uY2xvbmVOb2RlKHRydWUpOyAgLy8gY2xvbmUgcm93DQoJCXZhciBjaGlsZHMgPSBuZXdOb2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIik7DQoJCXZhciByb3dTZWxlY3RCb3hJZDsNCgkJdmFyIHJvd1NlbGVjdEJveEV4aXN0cyA9IGZhbHNlOw0KCQlmb3IgKHggPSAwOyB4IDwgY2hpbGRzLmxlbmd0aDsgeCsrKSB7CS8vIGZvciBjaGlsZHMgaW4gcm93LCBtYXNzYWdlIElEIGV0Yw0KCQkJaWYgKGNoaWxkc1t4XS50YWdOYW1lID09ICdJTlBVVCcgfHwgY2hpbGRzW3hdLnRhZ05hbWUgPT0gJ1NFTEVDVCcgfHwgY2hpbGRzW3hdLnRhZ05hbWUgPT0gJ1RFWFRBUkVBJyB8fCBjaGlsZHNbeF0udGFnTmFtZSA9PSAnSU1HJyB8fCBjaGlsZHNbeF0udGFnTmFtZSA9PSAnSU1BR0UnKSB7DQoJCQkJdmFyIGNoaWxkVHlwZSA9ICIiICsgY2hpbGRzW3hdLnR5cGU7DQoJCQkJY2hpbGRUeXBlID0gY2hpbGRUeXBlLnRvVXBwZXJDYXNlKCk7DQoJCQkJaWYgKChjaGlsZFR5cGUgPT0gJ1JBRElPJykgJiYgKGNoaWxkc1t4XS5uYW1lLmluZGV4T2YoIlsiKSA9PSAtMSkpIHsNCgkJCQkJY2hpbGRzW3hdLnZhbHVlID0gIiIgKyBuZXdSb3dOZHg7DQoJCQkJCXZhciBuZXdJZCA9IGNoaWxkc1t4XS5pZC5yZXBsYWNlKC9cZCsvLCIiICsgbmV3Um93TmR4KTsNCgkJCQkJY2hpbGRzW3hdLmlkID0gbmV3SWQ7DQoJCQkJCXJvd1NlbGVjdEJveElkID0gbmV3SWQ7DQoJCQkJCXJvd1NlbGVjdEJveEV4aXN0cyA9IHRydWU7DQoJCQkJfSBlbHNlIGlmIChjaGlsZFR5cGUgPT0gJ0NIRUNLQk9YJykgew0KCQkJCQl2YXIgbmV3SWQgPSBjaGlsZHNbeF0uaWQucmVwbGFjZSgvXGQrLywiIiArIG5ld1Jvd05keCk7DQoJCQkJCXZhciBuZXdOYW1lID0gY2hpbGRzW3hdLm5hbWUucmVwbGFjZSgvXFtcZCtcXS8sIlsiICsgbmV3Um93TmR4ICsgIl0iKTsNCgkJCQkJY2hpbGRzW3hdLmlkID0gbmV3SWQ7DQoJCQkJCWNoaWxkc1t4XS5uYW1lID0gbmV3TmFtZTsNCgkJCQkJY2hpbGRzW3hdLmNoZWNrZWQgPSBmYWxzZTsNCgkJCQl9IGVsc2UgaWYoY2hpbGRzW3hdLnRhZ05hbWUgPT0gJ0lNRycgfHwgY2hpbGRzW3hdLnRhZ05hbWUgPT0gJ0lNQUdFJyB8fCBjaGlsZHNbeF0udGFnTmFtZSA9PSAnU0VMRUNUJykgew0KCQkJCQl2YXIgbmV3SWQgPSBjaGlsZHNbeF0uaWQucmVwbGFjZSgvXGQrLywiIiArIG5ld1Jvd05keCk7DQoJCQkJCXZhciBuZXdOYW1lID0gY2hpbGRzW3hdLm5hbWUucmVwbGFjZSgvXFtcZCtcXS8sIlsiICsgbmV3Um93TmR4ICsgIl0iKTsNCgkJCQkJY2hpbGRzW3hdLmlkID0gbmV3SWQ7DQoJCQkJCWNoaWxkc1t4XS5uYW1lID0gbmV3TmFtZTsNCgkJCQl9IGVsc2Ugew0KCQkJCQl2YXIgbmV3SWQgPSBjaGlsZHNbeF0uaWQucmVwbGFjZSgvXGQrLywiIiArIG5ld1Jvd05keCk7DQoJCQkJCXZhciBuZXdOYW1lID0gY2hpbGRzW3hdLm5hbWUucmVwbGFjZSgvXFtcZCtcXS8sIlsiICsgbmV3Um93TmR4ICsgIl0iKTsNCgkJCQkJY2hpbGRzW3hdLmlkID0gbmV3SWQ7DQoJCQkJCWNoaWxkc1t4XS5uYW1lID0gbmV3TmFtZTsNCgkJCQkJaWYoIWtlZXBWYWx1ZSl7DQoJCQkJCQljaGlsZHNbeF0udmFsdWUgPSAiIjsNCgkJCQkJCWNoaWxkc1t4XS50ZXh0ID0gIiI7DQoJCQkJCX0NCgkJCQl9DQoJCQl9CWVsc2UgaWYgKGNoaWxkc1t4XS5pZCkgewkvLyBtYXNzYWdlIGV4aXN0aW5nIElEcyBvbiBhbGwgb3RoZXIgdGFncw0KCQkJCQljaGlsZHNbeF0uaWQgPSBjaGlsZHNbeF0uaWQucmVwbGFjZSgvXFtcZCtcXS8sIlsiICsgbmV3Um93TmR4ICsgIl0iKTsNCgkJCX0NCgkJfQ0KCQl0YmxCb2R5LmFwcGVuZENoaWxkKG5ld05vZGUpOw0KCQlpZiAocm93U2VsZWN0Qm94RXhpc3RzKSB7DQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyb3dTZWxlY3RCb3hJZCkuY2hlY2tlZCA9IGZhbHNlOw0KCQl9DQoJCS8vcmV0dXJuIG5ld05vZGU7ICAvL3dlIGNhbid0IHJldHVybiBoZXJlLCBhcyB0aGUgbG9vcCBtYXkgbm90IGJlIGZpbmlzaGVkLg0KCX0gIC8vIGVuZCBmb3IoKQ0KfQ0KDQovLyBOT1QgVVNFRCBBTllNT1JFDQovL3ZhciBfYXNfc2h1dGRvd25UaW1lcklEID0gbnVsbDsNCi8vdmFyIF9hc190aW1lclJ1bm5pbmcgPSBmYWxzZTsNCi8vdmFyIF9hc19hdXRvU2F2ZUZvcm0gPSBudWxsOw0KLy8NCi8vdmFyIF9BU19USU1FT1VUX0RVUkFUSU9OID0gMTAwMCAqIDIwOw0KLy8NCi8vZnVuY3Rpb24gYXV0b1NhdmVJbml0KG9iakZvcm0sIHRpbWVvdXRJbk1pbnV0ZXMpIHsNCi8vCS8vYWxlcnQoIm9iakZvcm09IiArIG9iakZvcm0pOw0KLy8JaWYob2JqRm9ybSA9PSBudWxsKSB7DQovLwkJcmV0dXJuIGZhbHNlOw0KLy8JfSBlbHNlIHsNCi8vCQlfYXNfYXV0b1NhdmVGb3JtID0gb2JqRm9ybTsNCi8vCX0NCi8vDQovLwlpZih0aW1lb3V0SW5NaW51dGVzICE9IG51bGwpIHsNCi8vCQlfQVNfVElNRU9VVF9EVVJBVElPTiA9IHRpbWVvdXRJbk1pbnV0ZXMgKiA2MCAqIDEwMDA7DQovLwkJLy8gX0FTX1RJTUVPVVRfRFVSQVRJT04gPSAyMCAqIDEwMDA7DQovLwl9DQovLwkvL2FsZXJ0KCJfQVNfVElNRU9VVF9EVVJBVElPTj0iICsgX0FTX1RJTUVPVVRfRFVSQVRJT04pOw0KLy8NCi8vCS8vIFNldCB1cCByZXNldHRpbmcgb2YgdGhlICJ0aW1lb3V0IiB3aGVuIHRoZSB1c2VyIGlzIGludGVyYWN0aW5nIHdpdGggdGhlIGRvY3VtZW50Lg0KLy8JLy9hZGRFdmVudCh3aW5kb3csICdtb3VzZWRvd24nLCByZXNldEF1dG9TdWJtaXRUaW1lciwgZmFsc2UpOw0KLy8JLy9hZGRFdmVudCh3aW5kb3csICdrZXlkb3duJywgcmVzZXRBdXRvU3VibWl0VGltZXIsIGZhbHNlKTsNCi8vDQovLwlkb2N1bWVudC5vbm1vdXNlZG93biA9IHJlc2V0QXV0b1N1Ym1pdFRpbWVyOw0KLy8JZG9jdW1lbnQub25rZXlkb3duID0gcmVzZXRBdXRvU3VibWl0VGltZXI7DQovLw0KLy8JLy9hbGVydCgiZXZlbnRzIGFkZGVkLiIpOw0KLy8NCi8vCXN0YXJ0QXV0b1N1Ym1pdFRpbWVyKCk7DQovLw0KLy8NCi8vfQ0KLy8NCi8vLyoqDQovLyAqIFN0YXJ0cyB0aGUgdGltZXIgcnVubmluZyB3aGljaCBsb2dzIG91dCB0aGUgdXNlciBhZnRlciBhIHBlcmlvZCBvZiBpbmFjdGl2aXR5Lg0KLy8gKi8NCi8vZnVuY3Rpb24gc3RhcnRBdXRvU3VibWl0VGltZXIoKQ0KLy97DQovLwlpZiAoIV9hc190aW1lclJ1bm5pbmcpDQovLwl7DQovLwkJX2FzX3RpbWVyUnVubmluZyA9IHRydWU7DQovLwkJX2FzX3NodXRkb3duVGltZXJJRCA9IHNldFRpbWVvdXQoInRpbWVkT3V0KCkiLCBfQVNfVElNRU9VVF9EVVJBVElPTik7DQovLwl9DQovL30NCi8vDQovL2Z1bmN0aW9uIHRpbWVkT3V0KCkgew0KLy8JdmFyIG9iakZvcm0gPSBfYXNfYXV0b1NhdmVGb3JtOw0KLy8NCi8vCWlmKG9iakZvcm0gIT0gbnVsbCkgew0KLy8JCS8vYWxlcnQoIm9iakZvcm0uaXNEaXJ0eS52YWx1ZT0iICsgb2JqRm9ybS5pc0RpcnR5LnZhbHVlICsgIiwgaGFzRm9ybUNoYW5nZWQob2JqRm9ybSk9IiArIGhhc0Zvcm1DaGFuZ2VkKG9iakZvcm0pKTsNCi8vCQlpZigob2JqRm9ybS5pc0RpcnR5ICYmIG9iakZvcm0uaXNEaXJ0eS52YWx1ZSA9PSAndHJ1ZScpIHx8IGhhc0Zvcm1DaGFuZ2VkKG9iakZvcm0pKSB7DQovLwkJCS8vYWxlcnQoJ0Zvcm0gYWJvdXQgdG8gc3VibWl0Li4uJyk7DQovLwkJCWlmKHdpbmRvdy5mb3JtQXV0b1N1Ym1pdCkgew0KLy8JCQkJZm9ybUF1dG9TdWJtaXQoKTsNCi8vCQkJfQ0KLy8JCX0NCi8vCX0NCi8vfQ0KLy8NCi8vLyoqDQovLyAqIFJlc2V0cyB0aGUgdGltZXIuVGhpcyBpcyBjYWxsZWQgaWYgdGhlIHVzZXIgZG9lcyBzb21lIGFjdGlvbi4NCi8vICoNCi8vICogQHBhcmFtIGUgdGhlIGV2ZW50IHdoaWNoIHRyaWdnZXJzIHRoZSBtZXRob2QgY2FsbCAoa2V5cHJlc3MsIG1vdXNlZG93biwgZXRjLikNCi8vICovDQovL2Z1bmN0aW9uIHJlc2V0QXV0b1N1Ym1pdFRpbWVyKGUpIHsNCi8vCS8vYWxlcnQoInJlc2V0QXV0b1N1Ym1pdFRpbWVyKCkgY2FsbGVkLiIpOw0KLy8JaWYgKF9hc190aW1lclJ1bm5pbmcpIHsNCi8vCQljbGVhclRpbWVvdXQoX2FzX3NodXRkb3duVGltZXJJRCk7DQovLwkJX2FzX3RpbWVyUnVubmluZyA9IGZhbHNlOw0KLy8JfQ0KLy8Jc3RhcnRBdXRvU3VibWl0VGltZXIoKTsNCi8vfQ0KDQovKg0KICogRnVuY3Rpb246IHB1cmdlU2VsZWN0TGlzdChvYmpTZWxlY3RMaXN0KQ0KICogUHVycG9zZTogUmVtb3ZlIGVhY2ggb3B0aW9uIGZvciB0aGUgPFNFTEVDVD4gTGlzdA0KICogQXJndW1lbnRzOiBPYmplY3QNCiAqIFJldHVybnM6IE5vdGhpbmcNCiAqKi8NCmZ1bmN0aW9uIHB1cmdlU2VsZWN0TGlzdChvYmpTZWxlY3RMaXN0KSB7DQoJdmFyIG51bSA9IG9ialNlbGVjdExpc3Qub3B0aW9ucy5sZW5ndGg7DQoJZm9yICh2YXIgaSA9IDA7IGkgPCBudW07IGkrKykgew0KCQlvYmpTZWxlY3RMaXN0Lm9wdGlvbnMucmVtb3ZlKDApOw0KCX0NCn0NCg0KLyoNCiAqIEZ1bmN0aW9uOiBhZGRPcHRpb25Ub1NlbGVjdExpc3Qob2JqU2VsZWN0TGlzdCwgc3RyVGV4dCwgc3RyVmFsdWUsIGJsbkFkZFRvdGhlQmVnaW5uaW5nKQ0KICogUHVycG9zZTogYWRkcyBhbiA8T1BUSU9OPiB0byBhIHNlbGVjdCBsaXN0DQogKiBBcmd1bWVudHM6IE9iamVjdCwgU3RyaW5nLCBTdHJpbmcsIEJvb2xlYW4NCiAqIFJldHVybnM6IE5vdGhpbmcNCiAqKi8NCmZ1bmN0aW9uIGFkZE9wdGlvblRvU2VsZWN0TGlzdChvYmpTZWxlY3RMaXN0LCBzdHJUZXh0LCBzdHJWYWx1ZSwgYmxuQWRkVG90aGVCZWdpbm5pbmcpIHsNCg0KCS8qIENyZWF0ZSBOZXcgRWxlbWVudCAqLw0KCXZhciBuZXdFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiT1BUSU9OIik7DQoJbmV3RWxlbWVudC50ZXh0ID0gc3RyVGV4dDsNCgluZXdFbGVtZW50LnZhbHVlID0gc3RyVmFsdWU7DQoNCgkvKiBhZGQgaXQgdG8gdGhlIG9wdGlvbnMgbGlzdCAqLw0KCWlmIChibG5BZGRUb3RoZUJlZ2lubmluZykgew0KCQlvYmpTZWxlY3RMaXN0Lm9wdGlvbnMuYWRkKG5ld0VsZW1lbnQsIDApOw0KCX0gZWxzZSB7DQoJCW9ialNlbGVjdExpc3Qub3B0aW9ucy5hZGQobmV3RWxlbWVudCk7DQoJfQ0KfQ0KDQoNCjwhLS0gU29ydCBhbHBoYWJldGljYWxseSBvciBudW1lcmljYWxseSBTVEFSVCAtLT4NCi8vIFF1aXRlIEZhc3Qgd2F5IG9mIHNvcnRpbmcgYmlnIG9wdGlvbiBsaXN0cw0KLy8gSW50U29ydDogYm9vbGVhbiAtIHRydWUgPSBudW1lcmljYWwgc29ydDsgZmFsc2UgPSB0ZXh0IHNvcnQNCi8vIFVzZVZhbHM6IGJvb2xlYW4gLSB0cnVlID0gc29ydCB0aGUgb3B0aW9uIGxpc3QgYmFzZWQgb24gaXRzIHVuZGVybHlpbmcgdmFsdWUsIGFzIG9wcG9zZWQgdG8gdGhlIGRpc3BsYXllZCB2YWx1ZQ0KZnVuY3Rpb24gU29ydExpc3QoQ29tYm8sIEludFNvcnQsIFVzZVZhbHMpew0KDQogICAgdmFyIGNtYlRleHQgPSBuZXcgQXJyYXkoQ29tYm8ub3B0aW9ucy5sZW5ndGgpOw0KICAgIHZhciBjbWJJdGVtczsNCg0KICAgIC8vIGdldCBjb3B5IG9mDQogICAgZm9yICh4PTA7IHg8Y21iVGV4dC5sZW5ndGg7IHgrKyl7DQogICAgICAgIGNtYlRleHRbeF09KFVzZVZhbHMpP0NvbWJvLm9wdGlvbnNbeF0udmFsdWUgKyAieyIgKyBDb21iby5vcHRpb25zW3hdLnRleHQ6Q29tYm8ub3B0aW9uc1t4XS50ZXh0ICsgInsiICsgQ29tYm8ub3B0aW9uc1t4XS52YWx1ZTsNCiAgICAgICAgfQ0KCS8vYWxlcnQoY21iVGV4dCk7DQoJLy9jbWJUZXh0LnNvcnQoY3VzdG9tQ29tcGFyZSk7DQogICAgaWYgKEludFNvcnQpDQogICAgICAgIGNtYlRleHQuc29ydChMaXN0Q29tcGFyZU51bXMpOw0KICAgIGVsc2UNCiAgICAgICAgY21iVGV4dC5zb3J0KExpc3RDb21wYXJlVGV4dCk7DQoNCiAgICAvL3JlYnVpbGQgbWFpbiBsaXN0LCBidXQgZG9uJ3QgcmVkaW1lbnNpb24gaXQNCiAgICBmb3IgKHg9MDsgeDxjbWJUZXh0Lmxlbmd0aDsgeCsrKXsNCiAgICAgICAgY21iSXRlbXMgPSBjbWJUZXh0W3hdLnNwbGl0KCJ7Iik7DQogICAgICAgIENvbWJvLm9wdGlvbnNbeF0udGV4dD0oVXNlVmFscyk/Y21iSXRlbXNbMV06Y21iSXRlbXNbMF07DQogICAgICAgIENvbWJvLm9wdGlvbnNbeF0udmFsdWU9KFVzZVZhbHMpP2NtYkl0ZW1zWzBdOmNtYkl0ZW1zWzFdOw0KICAgIH0NCn0NCg0KLy8gQ29tcGFyZSBmdW5jdGlvbnMgdXNlZCBpbnRlcm5hbGx5IGJ5IHRoZSBTb3J0TGlzdCByb3V0aW5lDQpmdW5jdGlvbiBMaXN0Q29tcGFyZU51bXMoYSxiKQ0Kew0KCWlmIChhID09IG51bGwpDQogIAl7DQogICAgICByZXR1cm4gMDsNCiAgIAl9DQogICAJZWxzZSBpZiAoYiA9PSBudWxsKQ0KICAgCXsNCiAgICAgIHJldHVybiAtMTsNCiAgIAl9DQogICAJZWxzZSBpZiAoYSA9PSBudWxsICYmIGIgPT0gbnVsbCkNCiAgIAl7DQogICAgICAJcmV0dXJuIDA7DQogICAJfQ0KDQogICAgdmFyIGxhID0gcGFyc2VJbnQoYS5zcGxpdCgieyIpWzBdKTsNCiAgICB2YXIgbGIgPSBwYXJzZUludChiLnNwbGl0KCJ7IilbMF0pOw0KICAgIGlmIChsYSA8IGxiKSByZXR1cm4gLTE7DQogICAgaWYgKGxhID4gbGIpIHJldHVybiAxDQogICAgcmV0dXJuIDA7DQp9DQpmdW5jdGlvbiBMaXN0Q29tcGFyZVRleHQoYSxiKQ0Kew0KCWlmIChhID09IG51bGwpDQogIAl7DQogICAgICByZXR1cm4gMDsNCiAgIAl9DQogICAJZWxzZSBpZiAoYiA9PSBudWxsKQ0KICAgCXsNCiAgICAgIHJldHVybiAtMTsNCiAgIAl9DQogICAJZWxzZSBpZiAoYSA9PSBudWxsICYmIGIgPT0gbnVsbCkNCiAgIAl7DQogICAgICAJcmV0dXJuIDA7DQogICAJfQ0KDQoJdmFyIGxhID0gYS5zcGxpdCgieyIpWzFdOw0KCXZhciBsYiA9IGIuc3BsaXQoInsiKVsxXTsNCiAgICBsYSA9IHN0cmlwVG9BbHBoYU51bWVyaWMobGEudG9Mb3dlckNhc2UoKSk7DQogICAgbGIgPSBzdHJpcFRvQWxwaGFOdW1lcmljKGxiLnRvTG93ZXJDYXNlKCkpOw0KICAgIGlmIChsYSA8IGxiKSByZXR1cm4gLTE7DQogICAgaWYgKGxhID4gbGIpIHJldHVybiAxDQoNCiAgICByZXR1cm4gMDsNCn0NCg0KZnVuY3Rpb24gc3RyaXBUb0FscGhhTnVtZXJpYyh0b1N0cmlwKXsNCiAgCXZhciByZSA9IG5ldyBSZWdFeHAoIlteMC05QS1aYS16XSIsICJnIik7DQogIAl0b1N0cmlwID0gdG9TdHJpcC5yZXBsYWNlKHJlLCAiIik7DQogIAlyZXR1cm4gdG9TdHJpcDsNCn0NCg0KPCEtLSBTb3J0IGFscGhhYmV0aWNhbGx5IG9yIG51bWVyaWNhbGx5IEVORCAtLT4NCg0KZnVuY3Rpb24gYWRkU2luZ2xlQ2hyb25vRXZlbnQoZG9jTmIpew0KCWlmIChkb2NOYiAhPSB1bmRlZmluZWQpIHsNCgkJdXJsID0gIi9vbW5pL2Nocm9ub3MvY2hyb25vc0FkZFNpbmdsZS5odG0/ZG9jTmI9IiArIGRvY05iOw0KCX0gZWxzZSB7DQoJCXVybCA9ICIvb21uaS9jaHJvbm9zL2Nocm9ub3NBZGRTaW5nbGUuaHRtIjsNCgl9DQoJLy9maXggZm9yIGRlZmVjdCA5NDQ4IC0gcmVzaXplIHRoZSBhZGQgY2hyb25vIHdpbmRvdyAoYWRkIDI1IHBpeGVscyB0byBoZWlnaHQpIHNvIGJ1dHRvbnMgZGlzcGxheS4uIGNoYW5nZSB0b3AgcG9zaXRpb24gdG8gMA0KCS8vdmFyIHBvcFVwV2luZG93ID0gb3BlblBvcFVwV2luZG93V2l0aFNpemVUb3AoJ0FkZFNpbmdsZUNocm9ubycsICc5MDAnLCAnNzI1JywgJzAnKTsNCg0KCXZhciB3aWR0aCA9ICc5MDAnOw0KCXZhciBoZWlnaHQgPSAnNzI1JzsNCgl2YXIgdG9wID0gJzAnOwkNCgkNCgkvL3BvcFVwV2luZG93LmRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSB1cmw7DQoJLy9vcGVuTW9kYWxEaWFsb2codXJsLCA5MDAsIDcyNSk7CQ0KCXZhciBwb3B1cFdpZHRoID0gKHdpbmRvdy5zY3JlZW4ud2lkdGgvMikgLSAoNDAwICsgMTApOw0KCXZhciBwb3B1cEhlaWdodCA9ICh3aW5kb3cuc2NyZWVuLmhlaWdodC8yKSAtICgzMDAgKyA1MCk7DQogICAgLy9zZW5kIHNlc3Npb25Ccm93c2VySWQgdG8gc2VydmxldCBiZWZvcmUgb3BlbiBuZXcgd2luZG93DQogICAgcHJvY2Vzc0FqYXhTZXJ2bGV0KCk7DQogICAgLy9DUSAzMDQ3MyBJRTExIC0gQ2hyb25vcyAtIE9uY2UgU3BlbGwgY2hlY2sgY29tcGxldGVzLCBPTU5JIHNjcmVlbiBpcyBkaXNwbGF5ZWQgaW5zdGVhZCBvZiAnQWRkIE5ldyBDaHJvbm8nIHBvcC11cCB3aW5kb3cNCiAgICB2YXIgcG9wVXBXaW5kb3cgPSAgd2luZG93Lm9wZW4odXJsLCJBZGRTaW5nbGVDaHJvbm8iICsgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgic2Vzc2lvbkJyb3dzZXJJZCIpLCJkaXJlY3Rvcmllcz1ubyxoZWlnaHQ9IiArIGhlaWdodCArICIsbGVmdD0iICsgcG9wdXBXaWR0aCArICIsbG9jYXRpb249bm8sbWVudWJhcj0wLHJlc2l6YWJsZT0wLHNjcmVlblg9IiArIHBvcHVwV2lkdGggKyAiLHNjcmVlblk9IiArIHBvcHVwSGVpZ2h0ICsgIixzY3JvbGxiYXJzPXllcyxzdGF0dXM9MCx0b29sYmFyPTAsdG9wPSIrIHRvcCArICIsd2lkdGg9IiArIHdpZHRoKTsNCiAgICBwb3BVcFdpbmRvdy5mb2N1cygpOw0KCXJldHVybiBmYWxzZTsNCn0NCg0KIGZ1bmN0aW9uIGFkZE11bHRpQ2hyb25vRXZlbnQoKXsJIA0KCS8vb3Blbk1vZGFsRGlhbG9nKCcvb21uaS9jaHJvbm9zL2Nocm9ub3NBZGRNdWx0aXBsZS5odG0nLCA5MDAsIDcwMCk7CQ0KCXZhciBwb3BVcFdpbmRvdyA9IG9wZW5Qb3BVcFdpbmRvdygnQWRkTXVsdHlDaHJvbm8nKTsNCgkvL3BvcFVwV2luZG93LmRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSIvb21uaS9jaHJvbm9zL2Nocm9ub3NBZGRNdWx0aXBsZS5odG0iOw0KCQ0KCXZhciBwb3B1cFdpZHRoID0gKHdpbmRvdy5zY3JlZW4ud2lkdGgvMikgLSAoNDAwICsgMTApOw0KCXZhciBwb3B1cEhlaWdodCA9ICh3aW5kb3cuc2NyZWVuLmhlaWdodC8yKSAtICgzMDAgKyA1MCk7DQoJdmFyIHdpZHRoID0gJzkwMCc7DQoJdmFyIGhlaWdodCA9ICc3MDAnOw0KCQ0KICAgIC8vc2VuZCBzZXNzaW9uQnJvd3NlcklkIHRvIHNlcnZsZXQgYmVmb3JlIG9wZW4gbmV3IHdpbmRvdw0KICAgIHByb2Nlc3NBamF4U2VydmxldCgpOw0KICAgIC8vQ1EgMzA0NzMgSUUxMSAtIENocm9ub3MgLSBPbmNlIFNwZWxsIGNoZWNrIGNvbXBsZXRlcywgT01OSSBzY3JlZW4gaXMgZGlzcGxheWVkIGluc3RlYWQgb2YgJ0FkZCBOZXcgQ2hyb25vJyBwb3AtdXAgd2luZG93DQogICAgdmFyIHBvcFVwV2luZG93ID0gd2luZG93Lm9wZW4oIi9vbW5pL2Nocm9ub3MvY2hyb25vc0FkZE11bHRpcGxlLmh0bSIsIkFkZE11bHR5Q2hyb25vIiArIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oInNlc3Npb25Ccm93c2VySWQiKSwiZGlyZWN0b3JpZXM9bm8saGVpZ2h0PSIgKyBoZWlnaHQgKyAiLGxlZnQ9IiArIHBvcHVwV2lkdGggKyAiLGxvY2F0aW9uPW5vLG1lbnViYXI9MCxyZXNpemFibGU9MCxzY3JlZW5YPSIgKyBwb3B1cFdpZHRoICsgIixzY3JlZW5ZPSIgKyBwb3B1cEhlaWdodCArICIsc2Nyb2xsYmFycz15ZXMsc3RhdHVzPTAsdG9vbGJhcj0wLHRvcD0iICsgcG9wdXBIZWlnaHQgKyAiLHdpZHRoPSIgKyB3aWR0aCk7DQogICAgcG9wVXBXaW5kb3cuZm9jdXMoKTsNCglyZXR1cm4gZmFsc2U7DQogfQ0KDQogZnVuY3Rpb24gc2hvd0R5bmFtaWNEaWFsb2codXJsLCB3aW5XaWR0aCwgd2luSGVpZ2h0LCBzdHJNZXNzYWdlLCBidXR0b25PcHRpb25zKSB7DQogCSB2YXIgYXJncyA9IG5ldyBBcnJheSgpOw0KIAkgYXJnc1swXSA9IHN0ck1lc3NhZ2U7DQogCSBmb3IodmFyIGkgPSAxLCBqID0gNDsgaiA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKywgaisrKSB7DQogCSAJYXJnc1tpXSA9IGFyZ3VtZW50c1tqXTsNCiAJIH0NCiAgICAgdmFyIHJldCA9IG9wZW5Nb2RhbERpYWxvZzIoZGlhbG9nVVJMLGFyZ3Msd2luV2lkdGgsd2luSGVpZ2h0LCc7cmVzaXphYmxlOjA7Jyk7DQogCSByZXR1cm4gcmV0Ow0KIH0NCg0KICBmdW5jdGlvbiBvcGVuUG9wVXBXaW5kb3dXaXRoU2l6ZVRvcChtZXNzYWdlLCB3aWR0aCwgaGVpZ2h0LCB0b3ApIHsNCgl2YXIgcG9wdXBXaWR0aCA9ICh3aW5kb3cuc2NyZWVuLndpZHRoLzIpIC0gKDQwMCArIDEwKTsNCgl2YXIgcG9wdXBIZWlnaHQgPSAod2luZG93LnNjcmVlbi5oZWlnaHQvMikgLSAoMzAwICsgNTApOw0KICAgIC8vc2VuZCBzZXNzaW9uQnJvd3NlcklkIHRvIHNlcnZsZXQgYmVmb3JlIG9wZW4gbmV3IHdpbmRvdw0KICAgIHByb2Nlc3NBamF4U2VydmxldCgpOw0KICAgIC8vZGVmZWN0IDI1ODI5IElFIFRhYnMgLSBQcmludCBDRlAgU3VtbWFyeSAtIFBvcHVwIHdpbmRvdyBkb2VzIG5vdCB1cGRhdGUgd2hlbiBjbGlja2luZyBmcm9tIG90aGVyIHRhYnMNCiAgICAvL2FkZGVkIHNlc3Npb24gYnJvd3NlciBpZCB0byB0aGUgd2luZG93IG5hbWUgdG8gbWFrZSBpdCB1bmlxdWUNCiAgICAvL2RlZmVjdCAyNTg2NyBPTU5JIC0gQ2Fubm90IE9wZW4gT2ZmZW5kZXIgUmVwb3J0cyBmb3IgTXVsdGlwbGUgRE9DIG51bWJlcnMgaW5zaWRlIE9NTkkgSW4gTTM0IENPTlYNCgkvL2lmIG5vIG5hbWUgZm9yIG5ldyB3aW5kb3cgZG9uJ3QgYWRkIHNlc3Npb24gc3RvcmFnZSBpZCB0byBzdHJuZXd3aW5kb3duYW1lDQogICAgLy9kZWZlY3QgMjU4OTMgYWRkZWQgbnVsbCBjaGVjaw0KICAgIGlmIChtZXNzYWdlICE9IG51bGwgJiYgbWVzc2FnZS5sZW5ndGggPiAwKQ0KICAgIHsNCiAgICAJcmV0dXJuIHdpbmRvdy5vcGVuKCIiLG1lc3NhZ2UgKyBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJzZXNzaW9uQnJvd3NlcklkIiksImRpcmVjdG9yaWVzPW5vLGhlaWdodD0iICsgaGVpZ2h0ICsgIixsZWZ0PSIgKyBwb3B1cFdpZHRoICsgIixsb2NhdGlvbj1ubyxtZW51YmFyPTAscmVzaXphYmxlPTAsc2NyZWVuWD0iICsgcG9wdXBXaWR0aCArICIsc2NyZWVuWT0iICsgcG9wdXBIZWlnaHQgKyAiLHNjcm9sbGJhcnM9eWVzLHN0YXR1cz0wLHRvb2xiYXI9MCx0b3A9IisgdG9wICsgIix3aWR0aD0iICsgd2lkdGgpOw0KICAgIH0gZWxzZQ0KCXsNCiAgICAJcmV0dXJuIHdpbmRvdy5vcGVuKCIiLG1lc3NhZ2UsImRpcmVjdG9yaWVzPW5vLGhlaWdodD0iICsgaGVpZ2h0ICsgIixsZWZ0PSIgKyBwb3B1cFdpZHRoICsgIixsb2NhdGlvbj1ubyxtZW51YmFyPTAscmVzaXphYmxlPTAsc2NyZWVuWD0iICsgcG9wdXBXaWR0aCArICIsc2NyZWVuWT0iICsgcG9wdXBIZWlnaHQgKyAiLHNjcm9sbGJhcnM9eWVzLHN0YXR1cz0wLHRvb2xiYXI9MCx0b3A9IisgdG9wICsgIix3aWR0aD0iICsgd2lkdGgpOw0KCX0NCg0KDQogfQ0KDQoNCiBmdW5jdGlvbiBvcGVuUG9wVXBXaW5kb3dXaXRoU2l6ZShtZXNzYWdlLCB3aWR0aCwgaGVpZ2h0KSB7DQoJdmFyIHBvcHVwV2lkdGggPSAod2luZG93LnNjcmVlbi53aWR0aC8yKSAtICg0MDAgKyAxMCk7DQoJdmFyIHBvcHVwSGVpZ2h0ID0gKHdpbmRvdy5zY3JlZW4uaGVpZ2h0LzIpIC0gKDMwMCArIDUwKTsNCiAgICAvL3NlbmQgc2Vzc2lvbkJyb3dzZXJJZCB0byBzZXJ2bGV0IGJlZm9yZSBvcGVuIG5ldyB3aW5kb3cNCiAgICBwcm9jZXNzQWpheFNlcnZsZXQoKTsNCiAgICAvL2RlZmVjdCAyNTgyOSBJRSBUYWJzIC0gUHJpbnQgQ0ZQIFN1bW1hcnkgLSBQb3B1cCB3aW5kb3cgZG9lcyBub3QgdXBkYXRlIHdoZW4gY2xpY2tpbmcgZnJvbSBvdGhlciB0YWJzDQogICAgLy9hZGRlZCBzZXNzaW9uIGJyb3dzZXIgaWQgdG8gdGhlIHdpbmRvdyBuYW1lIHRvIG1ha2UgaXQgdW5pcXVlDQogICAgLy9kZWZlY3QgMjU4NjcgT01OSSAtIENhbm5vdCBPcGVuIE9mZmVuZGVyIFJlcG9ydHMgZm9yIE11bHRpcGxlIERPQyBudW1iZXJzIGluc2lkZSBPTU5JIEluIE0zNCBDT05WDQoJLy9pZiBubyBuYW1lIGZvciBuZXcgd2luZG93IGRvbid0IGFkZCBzZXNzaW9uIHN0b3JhZ2UgaWQgdG8gc3RybmV3d2luZG93bmFtZQ0KICAgIC8vZGVmZWN0IDI1ODkzIGFkZGVkIG51bGwgY2hlY2sNCiAgICBpZiAobWVzc2FnZSAhPSBudWxsICYmIG1lc3NhZ2UubGVuZ3RoID4gMCkNCiAgICB7DQogICAgCXJldHVybiB3aW5kb3cub3BlbigiIixtZXNzYWdlICsgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgic2Vzc2lvbkJyb3dzZXJJZCIpLCJkaXJlY3Rvcmllcz1ubyxoZWlnaHQ9IiArIGhlaWdodCArICIsbGVmdD0iICsgcG9wdXBXaWR0aCArICIsbG9jYXRpb249bm8sbWVudWJhcj0wLHJlc2l6YWJsZT0wLHNjcmVlblg9IiArIHBvcHVwV2lkdGggKyAiLHNjcmVlblk9IiArIHBvcHVwSGVpZ2h0ICsgIixzY3JvbGxiYXJzPXllcyxzdGF0dXM9MCx0b29sYmFyPTAsdG9wPSIgKyBwb3B1cEhlaWdodCArICIsd2lkdGg9IiArIHdpZHRoKTsNCiAgICB9IGVsc2UNCgl7DQogICAgCXJldHVybiB3aW5kb3cub3BlbigiIixtZXNzYWdlLCJkaXJlY3Rvcmllcz1ubyxoZWlnaHQ9IiArIGhlaWdodCArICIsbGVmdD0iICsgcG9wdXBXaWR0aCArICIsbG9jYXRpb249bm8sbWVudWJhcj0wLHJlc2l6YWJsZT0wLHNjcmVlblg9IiArIHBvcHVwV2lkdGggKyAiLHNjcmVlblk9IiArIHBvcHVwSGVpZ2h0ICsgIixzY3JvbGxiYXJzPXllcyxzdGF0dXM9MCx0b29sYmFyPTAsdG9wPSIgKyBwb3B1cEhlaWdodCArICIsd2lkdGg9IiArIHdpZHRoKTsNCgl9DQoNCiB9DQoNCiBmdW5jdGlvbiBvcGVuUG9wVXBXaW5kb3cobWVzc2FnZSkgew0KIAkvL3VzZSBkZWZhdWx0IHBvcHVwIHdpbmRvd3Mgc2l6ZSB2YWx1ZXMNCglyZXR1cm4gb3BlblBvcFVwV2luZG93V2l0aFNpemUobWVzc2FnZSwgIjkwMCIsICI3MDAiKTsNCiB9DQoNCiBmdW5jdGlvbiBkaXNhYmxlUG9wVXBDbGljaygpIHsNCiAgIGFsZXJ0KCJUaGUgbGluayBpcyBkaXNhYmxlIGluIHBvcCB1cCB3aW5kb3cuIik7DQogcmV0dXJuIGZhbHNlOw0KIH0NCg0KIGZ1bmN0aW9uIGRpc2FibGVMaW5rKHRoaXNMaW5rKSB7DQogCWlmKHRoaXNMaW5rICE9IG51bGwpIHsNCiAJCXRoaXNMaW5rLm9uY2xpY2sgPSB2b2lkQWN0aW9uOw0KIAkJdGhpc0xpbmsuc3R5bGUuY29sb3I9JyNjY2NjOTknOw0KIAl9DQogfQ0KDQoNCmZ1bmN0aW9uIGdldEVsZW1lbnRzT2ZUaGVDbGFzc05hbWUobmFtZSkgew0KCS8vYWxlcnQobmFtZSk7DQoNCgkvLyBEZWZlY3QgMTIyNzkNCgkvL2ZpeCBmb3IgMTI2NDcgLSBhbHNvIGNoZWNrIHRvIG1ha2Ugc3VyZSBpZCBpcyBub3QgZW1wdHkgc3RyaW5nDQoJZm9yKHZhciBpbmRleCA9IDA7IGluZGV4IDwgZG9jdW1lbnQuZm9ybXMubGVuZ3RoOyAgIGluZGV4KyspIHsNCgkJaWYoZG9jdW1lbnQuZm9ybXNbaW5kZXhdICE9IG51bGwgJiYgZG9jdW1lbnQuZm9ybXNbaW5kZXhdLmlkICE9IG51bGwgJiYgZG9jdW1lbnQuZm9ybXNbaW5kZXhdLmlkICE9ICcnKSB7DQoJCQkvL2FsZXJ0KCJkaXNhYmxlU3VibWl0QnV0dG9ucy0+Iitkb2N1bWVudC5mb3Jtc1tpbmRleF0uaWQpDQoJCQlkaXNhYmxlU3VibWl0QnV0dG9ucyhkb2N1bWVudC5mb3Jtc1tpbmRleF0uaWQpOw0KCQl9DQoJfQ0KDQoJdmFyIGZpbmRTdGFjayA9IFtdLCBhbGxlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzcGFuIik7DQoJICB2YXIgbGVuID0gYWxsZWwubGVuZ3RoOw0KCSAgLy9hbGVydChsZW4pOw0KCQlmb3IodmFyIGEgPSAwOyBhPGFsbGVsLmxlbmd0aDsgYSsrKSB7DQoJCQlpZihhbGxlbFthXS5jbGFzc05hbWUgPT0gbmFtZSl7DQoJCQkJLy9hbGVydCgibWF0Y2hlZCIpOw0KCQkJCWdldEFsbChhbGxlbFthXSk7DQoJCQl9DQoJCX0NCglyZXR1cm4gZmluZFN0YWNrOw0KfQ0KDQovL2ZpeCBmb3IgZGVmZWN0IDEyNzA3IC0gd2UgYXJlIHdyYXBwaW5nIHRoZSBsb2NhdGlvbiByZXNldCBpbnRvIGEgZnVuY3Rpb24gc28gd2UgY2FuIG92ZXJyaWRlIHRoZSB1cmwuDQpmdW5jdGlvbiByZXNldFVybCh1cmwpIHsNCgkvL3NldCB0aGUgdXJsDQoJLy9zZWxmLmxvY2F0aW9uPXVybDsNCg0KCS8vIENRMjE2MTggc2V0dGluZyB0aGUgbG9jYXRpb24gZG9lcyBub3Qgd29yayBmb3IgbW9kZWwgd2luZG93cyBpbiBJRSAodGhvdSBpdCBkb2VzIGluIEZGKQ0KCS8vIFRoZSBoYWNreSBmaXggZm9yIElFIGlzIHRvIGNyZWF0ZSBhbiBocmVmIGFuY2hvciB0YWcgYW5kIHByb2dyYW1hdGljYWxseSBjbGljayB0aGUgbGluaw0KCXZhciBhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ19kaXNwbGF5VGFibGVTdWJtaXQnKTsNCglpZiAoYSA9PSBudWxsKSB7DQoJCWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7DQoJCWEuaWQgPSAnX2Rpc3BsYXlUYWJsZVN1Ym1pdCc7DQoJCWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF0uYXBwZW5kQ2hpbGQoYSk7DQoJfQ0KCWlmIChhLmNsaWNrKSB7IC8vIGNsaWNrIGlzIGFuIElFIG9ubHkgbWV0aG9kDQoJCWEuaHJlZiA9IHVybDsNCgkJYS5jbGljaygpOw0KCX0NCgllbHNlIHsgLy8gb3RoZXIgYnJvd3NlcnMgKHdoaWNoIHByb3Blcmx5IHN1cHBvcnQgbW9kYWwgd2luZG93cykgY2FuIHNpbXBseSBzZXQgdGhlIGxvY2F0aW9uLg0KCQlzZWxmLmxvY2F0aW9uLmhyZWYgPSB1cmw7DQoJfQ0KfQ0KDQpmdW5jdGlvbiBnZXRBbGwobmFtZSl7DQoJdmFyIGU9bmFtZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpOw0KCSBmb3IgKHZhciBpPTA7aTxlLmxlbmd0aDtpKyspew0KCQkgZGlzYWJsZUxpbmsoZVtpXSk7DQogfQ0KfQ0KDQoNCmZ1bmN0aW9uIHByb2Nlc3NPbW5pTGlua0NsaWNrKHRoaXNMaW5rLCBmb3JtRWxlbWVudElkKSB7DQoJLy9hbGVydCh0aGlzTGluayk7DQoJLy9hbGVydChmb3JtRWxlbWVudElkLnZhbHVlKTsNCglpZihjaGVja0Zvcm1DaGFuZ2VkKGZvcm1FbGVtZW50SWQpKSB7DQoJCWRpc2FibGVMaW5rKHRoaXNMaW5rKTsNCgkJcmV0dXJuIHRydWU7DQoJfSBlbHNlIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCn0NCg0KIC8qIERpc2FibGVzIHRoZSBidXR0b24sIHVzZWQgaW4gb25zdWJtaXQoKSBldmVudCBpbiB0aGUgZm9ybS4NCiAgICBPdmVycmlkZXMgdGhlIG9uY2xpY2sgZXZlbnQuICBUaGlzIGRpc2FibGVzIHRoZSBzdWJtaXQgYnV0dG9uIGZyb20NCiAgICBzdWJtaXR0aW5nIG11bHRpcGxlIHRpbWVzIHdoZW4gdGhlIHVzZXIgaXMgaW1wYXRpZW50IGFuZCBjbGlja3MNCiAgICB0aGUgYnV0dG9uIHNldmVyYWwgdGltZXMuIEluIHRoaXMgbWV0aG9kLCB0aGUgcGFyYW1ldGVyIG9mIHRoZSBidXR0b24gZ2V0cyBzdWJtaXR0ZWQNCiAgICBpbiB0aGUgSFRUUCBQT1NULiAgQSBzaW1wbGUgIi5kaXNhYmxlZCA9IHRydWUiIGZvciBidXR0b24gZG9lc24ndCBzZW5kDQogICAgdGhlIGtleS92YWx1ZSBwYWlyIG9mIHRoZSBidXR0b24gaW4gdGhlIEhUVFAgUE9TVCBSZXF1ZXN0Lg0KDQogICAgKm5vdGUgdGhhdCB1c2VBY3Rpb25IYW5kbGVyIGlzIGFuIG9wdGlvbmFsIHBhcmFtZXRlciB3aGljaCBkZWZhdWx0cyB0byB0cnVlDQogICovDQpmdW5jdGlvbiBkaXNhYmxlU3VibWl0QnV0dG9ucyhmb3JtTmFtZSx1c2VBY3Rpb25IYW5kbGVyKSB7DQoNCiAJdmFyIGVsZW0gPSBudWxsOw0KIAl2YXIgc2V0QWN0aW9uSGFuZGxlciA9IHRydWU7DQoNCgkvLyB0byBhdm9pZCBjaGFuZ2luZyBldmVyeSBwYWdlIGluIE9NTkkgdXNlQWN0aW9uSGFuZGxlciBpcyBhbiBvcHRpb25hbCBwYXJhbWV0ZXIgd2hpY2ggZGVmYXVsdHMgdG8gdHJ1ZQ0KCWlmKHR5cGVvZiB1c2VBY3Rpb25IYW5kbGVyID09ICdib29sZWFuJyAmJiAhdXNlQWN0aW9uSGFuZGxlcikgew0KCQlzZXRBY3Rpb25IYW5kbGVyID0gZmFsc2U7DQoJfQ0KDQoJZm9yICggaj0wO2o8IGRvY3VtZW50LmZvcm1zW2Zvcm1OYW1lXS5lbGVtZW50cy5sZW5ndGg7IGorKyApIHsNCgllbGVtID0gZG9jdW1lbnQuZm9ybXNbZm9ybU5hbWVdLmVsZW1lbnRzW2pdOw0KDQoJICAgIGlmKGVsZW0udHlwZSAmJiAoZWxlbS50eXBlID09ICdzdWJtaXQnIHx8IGVsZW0udHlwZSA9PSAncmVzZXQnIHx8IGVsZW0udHlwZSA9PSAnYnV0dG9uJykpIHsNCg0KCQlpZihzZXRBY3Rpb25IYW5kbGVyKSB7DQoJCQllbGVtLm9uY2xpY2sgPSB2b2lkQWN0aW9uOw0KCQl9IGVsc2Ugew0KCQkJZWxlbS5kaXNhYmxlZCA9IHRydWU7DQoJCX0NCgkJZWxlbS5zdHlsZS5jb2xvcj0nI2NjY2M5OSc7DQoJICAgIH0NCgl9DQp9DQoNCmZ1bmN0aW9uIHZvaWRBY3Rpb24oKSB7DQoJcmV0dXJuIGZhbHNlOw0KfQ0KDQoNCg0KIC8qIEZpeCBmb3IgNTY2MC8xMDQ5My5EaXNhYmxlcyB0aGUgYnV0dG9uLCB1c2VkIGluIG9uc3VibWl0KCkgZXZlbnQgaW4gdGhlIGZvcm0uDQogICovDQpmdW5jdGlvbiBkaXNhYmxlQ291bnRTdWJtaXRCdXR0b25zKGZvcm1OYW1lKSB7DQogCXZhciBlbGVtID0gbnVsbDsNCg0KDQogICAgZm9yICggaj0wO2o8IGRvY3VtZW50LmZvcm1zW2Zvcm1OYW1lXS5lbGVtZW50cy5sZW5ndGg7IGorKyApIHsNCiAgICAJZWxlbSA9IGRvY3VtZW50LmZvcm1zW2Zvcm1OYW1lXS5lbGVtZW50c1tqXTsNCg0KCSAgICBpZihlbGVtLnR5cGUgJiYgKGVsZW0udHlwZSA9PSAnc3VibWl0JyB8fCBlbGVtLnR5cGUgPT0gJ3Jlc2V0JyB8fCBlbGVtLnR5cGUgPT0gJ2J1dHRvbicpKSB7DQoJICAgIAllbGVtLmRpc2FibGVkID0gdHJ1ZTsNCgkgICAgCWVsZW0uc3R5bGUuY29sb3I9JyNjY2NjOTknOw0KCSAgICB9DQoJfQ0KfQ0KIC8qIEZpeCBmb3IgNTY2MC8xMDQ5My5FbmFibGVzIHRoZSBidXR0b24sIHVzZWQgaW4gb25zdWJtaXQoKSBldmVudCBpbiB0aGUgZm9ybS4NCiAgKi8NCmZ1bmN0aW9uIGVuYWJsZUNvdW50U3VibWl0QnV0dG9ucyhmb3JtTmFtZSkgew0KIAl2YXIgZWxlbSA9IG51bGw7DQoNCg0KICAgIGZvciAoIGo9MDtqPCBkb2N1bWVudC5mb3Jtc1tmb3JtTmFtZV0uZWxlbWVudHMubGVuZ3RoOyBqKysgKSB7DQogICAgCWVsZW0gPSBkb2N1bWVudC5mb3Jtc1tmb3JtTmFtZV0uZWxlbWVudHNbal07DQoNCgkgICAgaWYoZWxlbS50eXBlICYmIChlbGVtLnR5cGUgPT0gJ3N1Ym1pdCcgfHwgZWxlbS50eXBlID09ICdyZXNldCcgfHwgZWxlbS50eXBlID09ICdidXR0b24nKSkgew0KCSAgICAJZWxlbS5kaXNhYmxlZCA9IGZhbHNlOw0KCSAgICAJZWxlbS5zdHlsZS5jb2xvcj0nJzsNCgkgICAgfQ0KCX0NCn0NCg0KIGZ1bmN0aW9uIGRpc2FibGVFbGVtZW50c0J5UHJlZml4TmFtZShwcmVmaXgpew0KICBmb3IgKCBqPTA7IGogPCBkb2N1bWVudC5hbGwubGVuZ3RoO2orKykgew0KICAgICBpZiAoIGRvY3VtZW50LmFsbFtqXS50aXRsZSAhPSBudWxsICYmIGRvY3VtZW50LmFsbFtqXS50aXRsZS5pbmRleE9mKHByZWZpeCkhPS0xICYmIGRvY3VtZW50LmFsbFtqXS5vbmNsaWNrICE9IG51bGwpew0KICAgICAJLy9hbGVydCgiZGlzYWJsaW5nLi4uLiIrZG9jdW1lbnQuYWxsW2pdLm9uY2xpY2spOw0KICAgICAgICBkb2N1bWVudC5hbGxbal0ub25jbGljaz1kaXNhYmxlUG9wVXBDbGljazsNCiAgICAgICAgZG9jdW1lbnQuYWxsW2pdLmhyZWY9IiMiOw0KIAlkb2N1bWVudC5hbGxbal0uZGlzYWJsZWQ9dHJ1ZTsNCiAgICAgfQ0KICB9DQogfQ0KDQoJZnVuY3Rpb24gZGlzYWJsZUdyb3VwKGZvcm1OYW1lLCBncm91cE5hbWUsIGJvb2xlYW5EaXNhYmxlZCkgew0KCQlmb3IgKHZhciBpPTA7IGkgPCBkb2N1bWVudC5mb3Jtc1tmb3JtTmFtZV0uZWxlbWVudHMubGVuZ3RoOyBpKyspIHsNCgkJCWlmIChkb2N1bWVudC5mb3Jtc1tmb3JtTmFtZV0uZWxlbWVudHNbaV0ubmFtZSA9PSBncm91cE5hbWUpIHsNCgkJCQlkb2N1bWVudC5mb3Jtc1tmb3JtTmFtZV0uZWxlbWVudHNbaV0uZGlzYWJsZWQgPSBib29sZWFuRGlzYWJsZWQ7DQoJCQl9DQoJCX0NCgl9DQoNCgkvKg0KCSAgUHJlIGNvbmRpdGlvbjoNCgkgIE1ha2Ugc3VyZSB0aGUgdmVyeSBmaXJzdCByb3cgb2YgeW91ciB0YWJsZSBjb250YWlucw0KCSAgYW4gZW1wdHkgY29sdW1uIGFzIGl0cyBsYXN0IGNvbHVtbi4NCg0KCSAgUG9zdCBjb25kaXRpb246DQoJICBFYWNoIG5ld2x5IGFkZGVkIHJvdyB3aWxsIGhhdmUgYSBkZWxldGUgbGluayBpbiBpdHMgbGFzdA0KCSAgY29sdW1uLCB3aGVuIHRoaXMgbGluayBnZXRzIGNsaWNrZWQsIHRoaXMgcm93IHdpbGwgYmUgZGVsZXRlZA0KCSAgZnJvbSB0aGUgdGFibGUuDQoJKi8NCglmdW5jdGlvbiBhcHBlbmRSb3codGFibGVJZCwga2VlcFZhbHVlKXsNCgkJdmFyIHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFibGVJZCk7DQoJCS8vIGlmIHRoZSB0YWJsZSBpcyBub3QgdmlzaWJsZSwgdHVybiBpdCB0byB2aXNpYmxlDQoJCS8vIGFuZCBub3QgYWN0dWFsbHkgYWRkIGFueSByb3cuIFRoZSByZWFzb24gaXMgdGhhdA0KCQkvLyBkdXJpbmcgdGhlIGRlbGV0ZSByb3cgZnVuY3Rpb24sIGlmIHRoZXJlIGlzIG9uZSByb3cNCgkJLy8gbGVmdCBpbiB0aGUgdGFibGUsIHRoYXQgcm93IGlzIG5vdCBhY3R1YWxseSBkZWxldGVkLA0KCQkvLyBpbnN0ZWFkIHRoZSB0YWJsZSBpcyB0dXJuZWQgdG8gaW52aXNpYmxlLCB0aHVzIGhlcmUNCgkJLy8gd2UganVzdCB0dXJuIGl0IGJhY2sgdG8gdmlzaWJsZSB3aGVuIHVzZXIgc3RhcnRzIHRvDQoJCS8vIGFkZCB0aGUgZmlyc3Qgcm93IGFnYWluLg0KCQlpZiAodGFibGUuc3R5bGUuZGlzcGxheSA9PSBudWxsIHx8IHRhYmxlLnN0eWxlLmRpc3BsYXkgPT0gJ25vbmUnKXsNCgkJCXNob3dIaWRlRWxlbWVudCh0YWJsZUlkKTsNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KCQkvLyB0YWJsZSBpcyB2aXNpYmxlDQoJCWlmICh0YWJsZS5zdHlsZS5kaXNwbGF5ICE9IG51bGwgfHwgdGFibGUuc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpew0KCQkJLy9hbGVydCgibGFzdCByb3cgZGlzcGxheSB2YWx1ZSAiICsgdGFibGUucm93c1t0YWJsZS5yb3dzLmxlbmd0aC0xXS5zdHlsZS5kaXNwbGF5KTsNCg0KCQkJLy8gbGFzdCByb3cgaXMgbm90IHZpc2libGUsIG1ha2UgaXQgdmlzaWJsZSwgbm90IGFkZGluZyBhZGRpdGlvbmFsIHJvdw0KCQkJaWYodGFibGUucm93c1t0YWJsZS5yb3dzLmxlbmd0aC0xXS5zdHlsZS5kaXNwbGF5ID09ICdub25lJyB8fCB0YWJsZS5yb3dzW3RhYmxlLnJvd3MubGVuZ3RoLTFdLnN0eWxlLmRpc3BsYXkgPT1udWxsKXsNCgkJCQl0YWJsZS5yb3dzW3RhYmxlLnJvd3MubGVuZ3RoLTFdLnN0eWxlLmRpc3BsYXkgPSAnJzsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoJCX0NCgkJLy8gYWRkIHJvdyBhcyB1c3VhbCBpZiBsYXN0IHJvdyBpcyBhbHJlYWR5IHZpc2libGUuDQoJCXZhciB0b3RhbFJvd3MgPSB0YWJsZS5yb3dzLmxlbmd0aDsNCgkJaWYoa2VlcFZhbHVlKXsNCgkJCXJldHVybiBhZGRSb3codGFibGVJZCwgMSwgJ2tlZXBWYWx1ZScpOw0KCQl9ZWxzZXsNCgkJCXJldHVybiBhZGRSb3codGFibGVJZCwgMSwgbnVsbCk7DQoJCX0NCg0KCX0NCg0KCWZ1bmN0aW9uIGFkZENvbnRlbnRUb0xhc3RDb2wocm93KXsNCgkJdmFyIGNvbCA9IHJvdy5jZWxsc1tyb3cuY2VsbHMubGVuZ3RoLTFdOw0KCQl2YXIgdXJsID0gIiA8YSBocmVmPVwiI1wiIG9uY2xpY2s9XCdkZWxldGVPbmVSb3coXCIiICsgcm93LmlkICsgIlwiIiArICIpO1wnPkRlbGV0ZTwvYT4gIjsNCgkJY29sLmlubmVySFRNTD11cmw7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoNCglmdW5jdGlvbiBkZWxldGVPbmVSb3cocm93SWQsIGlzSWQsIHRocmVzaG9sZCwgaGlkZVRhYmxlKXsNCgkJdmFyIHJvdyA9IHJvd0lkOw0KCQlpZihpc0lkPT0ndHJ1ZScpew0KCQkJdmFyIHJvdyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJvd0lkKTsNCgkJfQ0KCQkvLyBwYXJlbnQgdGFibGUNCgkJdmFyIHBhcmVudCA9IHJvdy5wYXJlbnROb2RlOw0KDQoJCS8vIHRvdGFsIHJvd3MgbGVmdCBpbiB0aGUgdGFibGUgYmVmb3JlIHN0YXJ0cw0KCQkvLyBkb2luZyBzaG93IGFuZCBoaWQgb3BlcmF0aW9uLCBkZWZhdWx0IGlzIDIgcm93cw0KCQl2YXIgbGltaXQ9MjsNCgkJaWYodGhyZXNob2xkICE9IG51bGwpew0KCQkJbGltaXQgPSB0aHJlc2hvbGQ7DQoJCX0NCgkJLy8gd2hlbiB0aGVyZSBpcyBvbmx5IHRhYmxlIGhlYWRlciByb3cgYW5kIGxpbWl0LTEgdGFibGUgcm93IGxlZnQNCgkJLy8gY2xlYXIgYWxsIHRoZSBjZWxscyBpbiB0aGlzIHNvbGUgdGFibGUgcm93DQoJCWlmKHBhcmVudC5yb3dzLmxlbmd0aD09bGltaXQpew0KCQkJaWYoaGlkZVRhYmxlKXsNCgkJCQkvLyByZWN1cnNpdmVseSBmaW5kIHRoZSB0YWJsZSBwYXJlbnQNCgkJCQl3aGlsZSghKHBhcmVudC50YWdOYW1lLnRvVXBwZXJDYXNlKCk9PSdUQUJMRScpKXsNCgkJCQkJcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGU7DQoJCQkJfQ0KDQoJCQkJcmVzZXRUYWJsZVJvd0NoaWxkcmVuKHJvdyk7DQoJCQkJc2hvd0hpZGVFbGVtZW50KHBhcmVudC5pZCk7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfWVsc2V7DQoJCQkJLy8ganVzdCBzaG93L2hpZGUgdGhlIGxhc3Qgcm93DQoJCQkJaWYocm93LnN0eWxlLmRpc3BsYXkgPT0gJ2lubGluZScgfHxyb3cuc3R5bGUuZGlzcGxheSA9PSAnJyl7DQoJCQkJCXJvdy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnDQoJCQkJfWVsc2V7DQoJCQkJCXJvdy5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7DQoJCQkJfQ0KCQkJCXJlc2V0VGFibGVSb3dDaGlsZHJlbihyb3cpOw0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCg0KCQl9DQoJCXBhcmVudC5yZW1vdmVDaGlsZChyb3cpOw0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KDQoJZnVuY3Rpb24gcmVzZXRUYWJsZVJvd0NoaWxkcmVuKHJvdyl7DQoJCWZvcih2YXIgaT0wOyBpPHJvdy5jZWxscy5sZW5ndGg7IGkrKyl7DQoJCQkvLyBlYWNoIGNoaWxkIG5vZGUgaXMgYSB0ZCBlbGVtZW50Lg0KCQkJZm9yKCB2YXIgaj0wOyBqPHJvdy5jZWxsc1tpXS5jaGlsZE5vZGVzLmxlbmd0aDsgaisrKXsNCgkJCQlpZihyb3cuY2VsbHNbaV0uY2hpbGROb2Rlc1tqXS50YWdOYW1lID09ICdJTlBVVCcpew0KCQkJCQlyb3cuY2VsbHNbaV0uY2hpbGROb2Rlc1tqXS52YWx1ZT0nJzsNCgkJCQl9DQoNCgkJCQkvLyBlYWNoIGNoaWxkIG5vZGUgaXMgYW4gb3B0aW9uIGVsZW1lbnQNCgkJCQlpZihyb3cuY2VsbHNbaV0uY2hpbGROb2Rlc1tqXS50YWdOYW1lID09ICdTRUxFQ1QnKXsNCgkJCQkJZm9yKCB2YXIgaz0wOyBrPHJvdy5jZWxsc1tpXS5jaGlsZE5vZGVzW2pdLmNoaWxkTm9kZXMubGVuZ3RoOyBrKyspew0KCQkJCQkJLy8gbmVlZCB0byBpbXBsZW1lbnQgcmVzZXR0aW5nIGRyb3AgZG93biBsaXN0IGluIElFDQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0NCgl9DQoJLyoNCgkgRmxpcCB0aGUgZGlzcGxheSBvZiB0aGUgYWxsIGVsZW1lbnRzIChzdHlsZS5kaXNwbGF5PVsnbm9uZScsICdpbmxpbmUnXSkNCgkgd2l0aCBzcGVjaWZpZWQgaWQgaW4gdGhlIGFycmF5DQoJKi8NCglmdW5jdGlvbiBzaG93SGlkZUVsZW1lbnRzKGVsZW1lbnRJZHMpew0KCQlmb3IoaT0wOyBpPCBlbGVtZW50SWRzLmxlbmd0aDsgaSsrKXsNCgkJCXNob3dIaWRlRWxlbWVudChlbGVtZW50SWRzW2ldKTsNCgkJfQ0KCX0NCg0KCS8qDQoJIEZsaXAgdGhlIHZpc2liaWxpdHkgb2YgdGhlIGVsZW1lbnQgd2l0aCBzcGVjaWZpZWQgaWQNCgkqLw0KCWZ1bmN0aW9uIHNob3dIaWRlRWxlbWVudChlbGVtZW50SWQpew0KCQl2YXIgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7DQoJCWlmIChlbGVtZW50LnN0eWxlLmRpc3BsYXkgIT0gbnVsbCAmJiBlbGVtZW50LnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKXsNCiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCgkJfQ0KCQllbHNlew0KICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZSc7DQoJCX0NCgkJcmV0dXJuIGZhbHNlOw0KCX0NCg0KCS8vIHNpbXVsYXRlIG1vdXNlIG92ZXIgaHlwZXJsaW5rIGVmZmVjdA0KCWZ1bmN0aW9uIG1vdXNlT3ZyVHh0RWZmZWN0KGVsZW1lbnQpew0KCQllbGVtZW50LnN0eWxlLmN1cnNvciA9ICdoYW5kJzsNCgkJZWxlbWVudC5zdHlsZS50ZXh0RGVjb3JhdGlvbiA9ICdub25lJzsNCgkJLy8gY2hhbmdlIHRoZSBjb2xvciB0byAiaHlwZXJsaW5rIG1vdXNlb3ZlciBjb2xvciINCgkJZWxlbWVudC5zdHlsZS5jb2xvcj0nIzAwMDA3Nyc7DQoJfQ0KDQoJLy8gc2ltdWxhdGUgbW91c2Ugb3V0IGh5cGVybGluayBlZmZlY3QNCglmdW5jdGlvbiBtb3VzZU91dFR4dEVmZmVjdChlbGVtZW50KXsNCgkJZWxlbWVudC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7DQoJCWVsZW1lbnQuc3R5bGUudGV4dERlY29yYXRpb24gPSAndW5kZXJsaW5lJzsNCgkJLy8gY2hhbmdlIHRoZSBjb2xvciB0byB1c3VhbCBoeXBlcmxpbmsgY29sb3INCgkJZWxlbWVudC5zdHlsZS5jb2xvcj0nIzAwMDBjZCc7DQoJfQ0KDQoJLy8gb2JqIGlzIG9uZSBvZiB0aGUgY2hpbGRyZW4gb2YgdGhlIHJvdw0KCS8vIHRvIGJlIGRlbGV0ZWQNCgkvLyBpc0lkLCB3aGV0aGVyIHRoZSBvYmogaXMgdGhlIHJvdyBpZCBvciByb3cgb2JqIGl0c2VsZg0KCS8vIHRocmVzaG9sZCwgbnVtYmVyIG9mIHJvd3MgbGVmdCBpbiB0aGUgdGFibGUgYmVmb3JlIHN0b3ANCgkvLyBkZWxldGluZyByb3cgYW5kIHN0YXJ0IGhpZGluZyByb3cuDQoJZnVuY3Rpb24gZGVsZXRlQ3VycmVudFJvdyhvYmosIGlzSWQsIHRocmVzaG9sZCl7DQoJCXZhciBwYXJlbnQgPSBvYmoucGFyZW50Tm9kZTsNCgkJd2hpbGUocGFyZW50LnRhZ05hbWUgIT0gJ1RSJyl7DQoJCQlwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZQ0KCQl9DQoJCWRlbGV0ZU9uZVJvdyhwYXJlbnQsaXNJZCwgdGhyZXNob2xkKTsNCgl9DQoNCgkvLyByZXR1cm4gY3VycmVudCBkYXRlIHN0cmluZyBpbiBERC9NTS9ZWVlZIGZvcm1hdA0KCWZ1bmN0aW9uIGdldEN1cnJlbnREYXRlKCl7DQoJCXZhciBjdXJyVGltZSA9IG5ldyBEYXRlKCk7DQoJCXJldHVybiBsZWFkaW5nWmVybyhjdXJyVGltZS5nZXRNb250aCgpICsgMSkgKyAiLyIgKyBsZWFkaW5nWmVybyhjdXJyVGltZS5nZXREYXRlKCkpICsgIi8iICsgY3VyclRpbWUuZ2V0RnVsbFllYXIoKTsNCgl9DQoNCgkvLyBBZGRlZCBlbmNvZGluZyBmb3IgIisiIGNoYXJhY3RlciwgZXNjYXBlKCkgZnVuY3Rpb24gaWdub3JlcyBpdA0KCWZ1bmN0aW9uIHVybEVuY29kZVN0cmluZyhzdHIpIHsNCgkJc3RyID0gZXNjYXBlKHN0cik7DQoJCXN0ciA9IHN0ci5yZXBsYWNlKC9cKy9nLCIlMmIiKTsNCgkJcmV0dXJuIHN0cjsNCgl9DQoJLy8gIGZ1bmN0aW9uIGZvciBzdXBwcmVzc2luZyBmb3JtIHN1Ym1pc3Npb24gaWYgZW50ZXIgaXMgcHJlc3NlZA0KCS8vICB3aGVuIGN1cnNvciBpbiBhIGlucHV0IHR5cGU9InRleHQiDQogICAgZnVuY3Rpb24ga2lsbEVudGVyKGV2dCkNCiAgICB7DQoNCiAgICAgICAgaWYoZXZ0LmtleUNvZGUgPT0gMTMgfHwgZXZ0LndoaWNoID09IDEzKQ0KICAgICAgICB7DQogICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgfQ0KCWZ1bmN0aW9uIGlzTnVtZXJpYyh4KSB7DQoJCXZhciBSZWdFeHAgPSAvXigtKT8oXGQqKShcLj8pKFxkKikkLzsgLy8gTm90ZTogdGhpcyBXSUxMIGFsbG93IGEgbnVtYmVyIHRoYXQgZW5kcyBpbiBhIGRlY2ltYWw6IC00NTIuDQoJCS8vIGNvbXBhcmUgdGhlIGFyZ3VtZW50IHRvIHRoZSBSZWdFeA0KCQkvLyB0aGUgJ21hdGNoJyBmdW5jdGlvbiByZXR1cm5zIDAgaWYgdGhlIHZhbHVlIGRpZG4ndCBtYXRjaA0KCQl2YXIgc3RyID0geC50b1N0cmluZygpOw0KCQl2YXIgcmVzdWx0ID0gc3RyLm1hdGNoKFJlZ0V4cCk7DQoJCXJldHVybiByZXN1bHQ7DQoJfQ0KDQoNCgkvLyBEZWZlY3QgNjEzOA0KCWZ1bmN0aW9uIGxpbWl0VGV4dChsaW1pdEZpZWxkLCBsaW1pdE51bSkgew0KICAgIAlpZiAobGltaXRGaWVsZC52YWx1ZS5sZW5ndGggPiBsaW1pdE51bSkgew0KICAgICAgICAJbGltaXRGaWVsZC52YWx1ZSA9IGxpbWl0RmllbGQudmFsdWUuc3Vic3RyaW5nKDAsIGxpbWl0TnVtKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KCS8vIERlZmVjdCA5ODIyDQoJLy8gaGFuZGxlTW91c2VvdmVyKCksIGhhbmRsZU1vdXNlb3V0KCksIGhhbmRsZUNsaWNrKCksIGhhbmRsZUJsdXIoKSBhcmUgdXNlZA0KCS8vIHRvIGR5bmFtaWNhbGx5IGV4cGFuZCBhbmQgY29udHJhY3QgZHJvcCBkb3duIGxpc3RzLiAgQSA8c3Bhbj4gdGFnIG11c3QNCgkvLyBiZSB1c2VkIHRvIGNvbnRhaW4gdGhlICJvcGVuU2V0IiBhdHRyaWJ1dGUgd2hpY2ggZGV0ZXJtaW5lcyB3aGV0aGVyIHRoZQ0KCS8vIGRyb3AgZG93biBsaXN0IGlzIG9wZW5lZCBvciBub3QgYW5kIHRoZSAiaG92ZXIiIGF0dHJpYnV0ZSB3aGljaCBkZXRlcm1pbmVzDQoJLy8gd2hldGhlciB0aGUgZHJvcCBkb3duIGxpc3QgaXMgaG92ZXJlZC4NCgkvLw0KCS8vIFVzYWdlOiAgb25tb3VzZW92ZXIsIG9ubW91c2VvdXQsIG9uYmx1ciBmb3IgdGhlIHNlbGVjdCBlbGVtZW50IGNvbnRhaW5lZA0KCS8vIGluIHRoZSBzcGFuIHRhZy4gIG9uY2xpY2sgYXR0cmlidXRlIHNob3VsZCBiZSBzZXQgb24gdGhlIHNwYW4gdGFnLg0KCS8vIFNlZSBncm91cE1vdmVTZWxlY3RBZG1pdERldGFpbHMuanNwIGZvciBzYW1wbGUgdXNhZ2UuDQoJZnVuY3Rpb24gaGFuZGxlTW91c2VvdmVyKGVsZSwgd2lkdGgpDQoJew0KCQllbGUucGFyZW50Tm9kZS5zZXRBdHRyaWJ1dGUoJ2hvdmVyJywgJ3RydWUnKTsNCgkJZWxlLnN0eWxlLndpZHRoID0gd2lkdGg7DQoJfQ0KCWZ1bmN0aW9uIGhhbmRsZU1vdXNlb3V0KGVsZSkNCgl7DQoJCWVsZS5wYXJlbnROb2RlLnNldEF0dHJpYnV0ZSgnaG92ZXInLCAnZmFsc2UnKTsNCgkJaWYoZWxlLnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCdvcGVuU2V0JykgPT0gJ2ZhbHNlJykNCgkJew0KCQkJZWxlLnN0eWxlLndpZHRoID0gJyc7DQoJCX0NCgl9DQoJZnVuY3Rpb24gaGFuZGxlQmx1cihlbGUpDQoJew0KCQllbGUuc3R5bGUud2lkdGggPSAnJzsNCgkJZWxlLnBhcmVudE5vZGUuc2V0QXR0cmlidXRlKCdvcGVuU2V0JywgJ2ZhbHNlJyk7DQoJCWVsZS5wYXJlbnROb2RlLnNldEF0dHJpYnV0ZSgnaG92ZXInLCAnZmFsc2UnKTsNCgl9DQoJZnVuY3Rpb24gaGFuZGxlQ2xpY2soZWxlKQ0KCXsNCgkJaWYoZWxlLmdldEF0dHJpYnV0ZSgnb3BlblNldCcpID09ICd0cnVlJykgew0KCQkJaWYoZWxlLmdldEF0dHJpYnV0ZSgnaG92ZXInKSA9PSAnZmFsc2UnKQ0KCQkJew0KCQkJCWVsZS5maXJzdENoaWxkLnN0eWxlLndpZHRoID0gJyc7DQoJCQl9DQoJCQllbGUuc2V0QXR0cmlidXRlKCdvcGVuU2V0JywgJ2ZhbHNlJyk7DQoJCX0gZWxzZSB7DQoJCQllbGUuc2V0QXR0cmlidXRlKCdvcGVuU2V0JywgJ3RydWUnKTsNCgkJfQ0KCX0NCgkvL25ldyBmdW5jdGlvbiBmb3IgQ1ExMTE0NiAtIHRvIGhlbHAgd2l0aCBjb2xsYXBzaW5nIHRoZSBsZWZ0IG1lbnUNCglmdW5jdGlvbiByZXNldE1hcmdpbkxlZnQoZWxlbWVudElELCBtYXJnaW5TaXplKSB7DQoJCXZhciBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElEKTsNCg0KCQlpZihlbGVtZW50ICE9IG51bGwpIHsNCgkJCWVsZW1lbnQuc3R5bGUubWFyZ2luTGVmdD1tYXJnaW5TaXplOw0KDQoJCX0NCgl9DQoNCglmdW5jdGlvbiB0b2dnbGVTZWN0aW9uKHNlY3Rpb25Db250cm9sTmFtZSkgew0KICAgIAl2YXIgc2VjdGlvbkV4cGFuZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VjdGlvbkNvbnRyb2xOYW1lKTsNCiAgICAJaWYgKHNlY3Rpb25FeHBhbmRlci52YWx1ZT09J3RydWUnKSB7DQogICAgCQkvL2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlY3Rpb25Db250cm9sTmFtZSkuc3R5bGU9Inpvb206IDE7IGZpbHRlcjogYWxwaGEob3BhY2l0eSA9IDApOyINCiAgICAgICAgCXNlY3Rpb25FeHBhbmRlci52YWx1ZT0nZmFsc2UnOw0KICAgIAl9IGVsc2Ugew0KICAgICAgICAJc2VjdGlvbkV4cGFuZGVyLnZhbHVlPSd0cnVlJzsNCiAgICAgICAgCS8vZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VjdGlvbkNvbnRyb2xOYW1lKS5zdHlsZT0iem9vbTogMTsgZmlsdGVyOiBhbHBoYShvcGFjaXR5ID0gMCk7Ig0KICAgIAl9DQoJfQ0KCS8vQ1EyMDMzNQ0KCS8vVGhpcyBmdW5jdGlvbiBpcyBpbnRlbmRlZCB0byBiZSB1c2VkIG9uIHNlbGVjdCBsaXN0IG9ua2V5RE9XTiBhY3Rpb25zDQoJLy9UaGUgcHVycG9zZSBpcyB0byBvdmVycmlkZSB0aGUgYnJvd3NlciBjb250cm9scyB3aGljaCBzZW5kcyBhICdCYWNrJyBjb21tYW5kLg0KCS8vVGhpcyB3aWxsIG5vdyBtaW1taWNrIHByZXNzaW5nIEVTQyh3aGljaCBjbG9zZXMgdGhlIHNlbGVjdCBsaXN0IG9wdGlvbnMpLCBhbmQgdGhlIHNlbGVjdCB0aGUgZGVmYXVsdCBmaXJzdCBvcHRpb24uDQoJLy9vbmtleWRvd249InJldHVybiBudWtlQmFja3NwYWNlKHRoaXMsIGV2ZW50KTsiDQoJZnVuY3Rpb24gbnVrZUJhY2tzcGFjZShlbCwgZXZlbnQpIHsNCgkJdmFyIGUgPSBldmVudCB8fCB3aW5kb3cuZXZlbnQ7DQoJCWlmKGUua2V5Q29kZT09OCl7DQoJCQllLmtleUNvZGU9Mjc7IC8vIGhhY2sgZm9yIElFIC0gcmVwbGFjZSB0aGUgZXZlbnQgY29kZQ0KCQkJaWYoZWwpew0KCQkJCWlmKGVsLnRhZ05hbWUgPT0gIlNFTEVDVCIpew0KCQkJCQlpZihlbC5vcHRpb25zWzBdKXsNCgkJCQkJCWVsLm9wdGlvbnNbMF0uc2VsZWN0ZWQgPSB0cnVlOw0KCQkJCQkJcmV0dXJuIGZhbHNlOyAgLy8gb3RoZXIgYnJvd3NlcnMsIHN0b3AgdGhlIGV2ZW50DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0NCgkJcmV0dXJuIHRydWU7DQoJfQ0KDQoNCgkvLyBTb21lIGhhbmR5IGFycmF5IGFuZCBzdHJpbmcgZnVuY3Rpb25zLg0KCUFycmF5LnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uIChlbGVtZW50KXsNCgkJLy9hbGVydCgnaW4gY29udGFpbnMgJyArIGVsZW1lbnQpOw0KCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHsNCgkJCWlmICh0aGlzW2ldID09IGVsZW1lbnQpew0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KCQl9DQoJCXJldHVybiBmYWxzZTsNCgl9DQoNCglTdHJpbmcucHJvdG90eXBlLnRyaW0gPSBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzK3xccyskL2csIiIpOw0KCX0NCg0KCVN0cmluZy5wcm90b3R5cGUubHRyaW0gPSBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzKy8sIiIpOw0KCX0NCg0KCVN0cmluZy5wcm90b3R5cGUucnRyaW0gPSBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIHRoaXMucmVwbGFjZSgvXHMrJC8sIiIpOw0KCX0NCg0KLyoqIFdpbGwgYXBwbHkgT1BUSU9OIGRhdGEgdG8gdGhlIFNFTEVDVCBIVE1MIGVsZW1lbnQgaWRlbnRpZmllZCBieSB0aGUgZm9ybUVsZW1lbnRJRC4NCiAqIElmIGVtcHR5T3B0aW9uIGlzIHNwZWNpZmllZCwgaXQgd2lsbCBiZSBwcmVwZW5kZWQgdG8gdGhlIGxpc3QuICovDQpmdW5jdGlvbiBhcHBseUR3clRvRHJvcERvd24oZm9ybUVsZW1lbnRJRCwgZGF0YSwgZW1wdHlPcHRpb24sIGNvZGVGaWVsZE5hbWUsIGRlc2NGaWVsZE5hbWUpIHsNCglpZiAoZm9ybUVsZW1lbnRJRCAhPSBudWxsKSB7DQoJCXZhciBjb2RlTmFtZSA9IChjb2RlRmllbGROYW1lICE9IG51bGwpID8gY29kZUZpZWxkTmFtZSA6ICdjb2RlJzsNCgkJdmFyIGRlc2NOYW1lID0gKGRlc2NGaWVsZE5hbWUgIT0gbnVsbCkgPyBkZXNjRmllbGROYW1lIDogJ2Rlc2MnOw0KCSAgICBEV1JVdGlsLnJlbW92ZUFsbE9wdGlvbnMoZm9ybUVsZW1lbnRJRCk7DQoJICAgIGlmIChlbXB0eU9wdGlvbiAhPSBudWxsICYmIGVtcHR5T3B0aW9uICE9ICcnKSB7DQoJICAgIAlEV1JVdGlsLmFkZE9wdGlvbnMoZm9ybUVsZW1lbnRJRCwgW3sgY29kZTonJywgZGVzYzplbXB0eU9wdGlvbiB9XSwgJ2NvZGUnLCAnZGVzYycpOw0KCSAgICB9DQoJICAgIGlmIChkYXRhICE9IG51bGwpDQoJICAgIAlEV1JVdGlsLmFkZE9wdGlvbnMoZm9ybUVsZW1lbnRJRCwgZGF0YSwgY29kZU5hbWUsIGRlc2NOYW1lKTsNCgl9DQp9DQoNCi8qKg0KICogV2lsbCBjbGVhciB0aGUgdmFsdWUgYXR0cmlidXRlIGZvciBldmVyeSBlbGVtZW50IGluIHRoZSBzcGVjaWZpZWQgYXJyYXkNCiAqDQogKiBAcGFyYW0gZWxlbWVudEFycmF5DQogKiAgICAgICAgICAgIGEgbGlzdCBvZiBlbGVtZW50IElEcw0KICovDQpmdW5jdGlvbiBjbGVhckVsZW1lbnRzKGVsZW1lbnRBcnJheSkgew0KCWZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudEFycmF5Lmxlbmd0aDsgaSsrKSB7DQoJCXZhciBlbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudEFycmF5W2ldKTsNCgkJaWYgKGVsZW0gIT0gbnVsbCAmJiBlbGVtICE9ICd1bmRlZmluZWQnKXsNCgkJCXZhciBteVR5cGUgPSBlbGVtLnR5cGU7DQoJCSAgCWlmIChteVR5cGUgPT0gJ2NoZWNrYm94JyB8fCBteVR5cGUgPT0gJ3JhZGlvJykgew0KCQkgIAkJZWxlbS5jaGVja2VkID0gZmFsc2U7DQoJCSAgCX0NCgkJICAJZWxzZSBpZiAobXlUeXBlID09ICdzZWxlY3Qtb25lJyB8fCBteVR5cGUgPT0gJ3NlbGVjdC1tdWx0aXBsZScpIHsNCgkJICAJCWVsZW0uc2VsZWN0ZWRJbmRleCA9IDA7DQoJCSAgCX0NCgkJICAJZWxzZSB7DQoJCSAgCQllbGVtLnZhbHVlID0gJyc7DQoJCSAgCX0NCgkJfQ0KCX0NCn0NCg0KLyoqDQogKiBXaWxsIGNsZWFyIHRoZSB2YWx1ZSBhdHRyaWJ1dGUgZm9yIGV2ZXJ5IGNoaWxkIGVsZW1lbnQgc3BlY2lmaWVkIGJ5IHRoZSBpZGVudGlmaWVkIGVsZW1lbnQNCiAqLw0KZnVuY3Rpb24gY2xlYXJBbGxFbGVtZW50cyhlbGVtKSB7DQoJZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsNCgkJY2xlYXJBbGxFbGVtZW50cyhlbGVtLmNoaWxkTm9kZXNbaV0pOw0KCX0NCglpZiAoZWxlbSAhPSBudWxsKSB7DQoJCXZhciBteVR5cGUgPSBlbGVtLnR5cGU7DQoJICAJaWYgKG15VHlwZSA9PSAnY2hlY2tib3gnIHx8IG15VHlwZSA9PSAncmFkaW8nKSB7DQoJICAJCWVsZW0uY2hlY2tlZCA9IGZhbHNlOw0KCSAgCX0NCgkgIAllbHNlIGlmIChteVR5cGUgPT0gJ2hpZGRlbicgfHwgbXlUeXBlID09ICdwYXNzd29yZCcgfHwgbXlUeXBlID09ICd0ZXh0JyB8fCBteVR5cGUgPT0gJ3RleHRhcmVhJykgew0KCSAgCQllbGVtLnZhbHVlID0gJyc7DQoJICAJfQ0KCSAgCWVsc2UgaWYgKG15VHlwZSA9PSAnc2VsZWN0LW9uZScgfHwgbXlUeXBlID09ICdzZWxlY3QtbXVsdGlwbGUnKSB7DQoJICAJCWVsZW0uc2VsZWN0ZWRJbmRleCA9IDA7DQoJICAJfQ0KCX0NCn0NCg0KLyoqDQogKiBTZXRzIHRoZSAnZGlzYWJsZWQnIGF0dHJpYnV0ZSBvZiBhIGZvcm0gZWxlbWVudC4gIEF0IHRoZSBzYW1lIHRpbWUsIGlmIGEgZm9ybSBlbGVtZW50IHdpdGggdGhlIHNhbWUgSUQgZXhpc3RzDQogKiAoc3VmZml4ZWQgd2l0aCAiX2hkZG4iKSwgdGhlIGRpc2FibGVkIGF0dHJpYnV0ZSBvbiB0aGUgaGlkZGVuIGZvcm0gZWxlbWVudCB3aWxsIGJlIHNldCB0byB0aGUgb3Bwb3NpdGUgYXMgdGhhdCBvZiBlbGVtZW50SUQuDQogKg0KICogQHBhcmFtIGVsZW1lbnRJZCBhbiBpZGVudGlmaWVyIG9mIGFuIEhUTUwgZm9ybSBlbGVtZW50IHRvIGRpc2FibGUvZW5hYmxlDQogKiBAcGFyYW0gZGlzYWJsZWQgYm9vbGVhbiB0byBpbmRpY2F0ZSBpZiB0aGUgZm9ybSBlbGVtZW50IGlzIHRvIGJlIGRpc2FibGVkIG9yIG5vdA0KICogQHBhcmFtIGNsZWFyIGJvb2xlYW4gdG8gaW5kaWNhdGUgaWYgdGhlIGZvcm0gZWxlbWVudCBzaG91bGQgY2xlYXIgd2hlbiBkaXNhYmxlZA0KICovDQpmdW5jdGlvbiBkaXNhYmxlRWxlbWVudChlbGVtZW50SWQsIGRpc2FibGVkLCBjbGVhcikgew0KCWlmIChlbGVtZW50SWQgIT0gbnVsbCAmJiBkaXNhYmxlZCAhPSBudWxsKSB7DQoJCXZhciBlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTsNCgkJZS5kaXNhYmxlZCA9IGRpc2FibGVkOw0KCQlpZiAoY2xlYXIgPT0gbnVsbCB8fCBjbGVhciA9PSB0cnVlKSB7DQoJCQllLnZhbHVlID0gJyc7DQoJCX0NCg0KCQkvLyB0b2dnbGUgdGhlIGhpZGRlbiBlbGVtZW50IGZvciB0aGUgc2FtZSBmaWVsZCAoZGlzYWJsZWQgZmllbGRzIGRvbid0IGJpbmQgaW4gU3ByaW5nKQ0KCQl2YXIgaCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCArICdfaGRkbicpOw0KCQlpZiAoaCAhPSBudWxsKSB7DQoJCQloLmRpc2FibGVkID0gIWRpc2FibGVkOw0KCQkJaC52YWx1ZSA9IGUudmFsdWU7DQoJCX0NCgl9DQp9DQoNCi8qKg0KICogRmlyZXMgYW4gZXZlbnQgb24gYW4gZWxlbWVudC4gIE9uZSBjYW4ndCBqdXN0IGNhbGwgZWxlbS5vbkNoYW5nZSgpIGJlY2F1c2UgdGhlcmUgbWF5IGJlIG90aGVyIGxpc3RlbmVycyAvIG1ldGhvZHMgYXR0YWNoZWQgdG8gb25DaGFuZ2UNCiAqIHRoYXQgdGhlIG9uQ2hhbmdlKCkgY2FsbCB3b3VsZCBpZ25vcmUuDQogKg0KICogQHBhcmFtIGVsZW1lbnQgRE9NIGVsZW1lbnQgdG8gY2FsbCBldmVudCBvbg0KICogQHBhcmFtIGV2ZW50IHRoZSBldmVudCB0eXBlIHRvIGZpcmUgKGllLiAnY2hhbmdlJykNCg0KICogQHNlZSBodHRwOi8vamVoaWFoLmN6L2EvZmlyaW5nLWphdmFzY3JpcHQtZXZlbnRzLXByb3Blcmx5DQogKi8NCmZ1bmN0aW9uIGZpcmVFdmVudChlbGVtZW50LGV2ZW50KXsNCglpZiAoZG9jdW1lbnQuY3JlYXRlRXZlbnRPYmplY3Qpew0KCQkvLyBkaXNwYXRjaCBmb3IgSUUNCgkJdmFyIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0KCk7DQoJCXJldHVybiBlbGVtZW50LmZpcmVFdmVudCgnb24nK2V2ZW50LGV2dCkNCgl9DQogICAgZWxzZXsNCgkgICAgLy8gZGlzcGF0Y2ggZm9yIGZpcmVmb3ggKyBvdGhlcnMNCgkgICAgdmFyIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJIVE1MRXZlbnRzIik7DQoJICAgIGV2dC5pbml0RXZlbnQoZXZlbnQsIHRydWUsIHRydWUgKTsgLy8gZXZlbnQgdHlwZSxidWJibGluZyxjYW5jZWxhYmxlDQoJICAgIHJldHVybiAhZWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2dCk7DQogICAgfQ0KfQ0KDQoNCi8vIENRMjIzNTYgLSBtYWtlIHRoZSBhZGRpdGlvbiBvZiBuZXcgTCZJIGNsYWltIHJvd3Mgc21vb3RoZXIuDQovLyBUaGlzIGZ1bmN0aW9uIHdpbGwgYXBwZW5kIGEgbmV3IFRSIGVsZW1lbnQgdG8gdGhlIGVuZCBvZiB0aGUgTCZJIENsYWltcyBibG9jaw0KLyoqDQogKiBXaWxsIGNsb25lIHRoZSBmaXJzdCBUUiBub2RlIGluIGEgdGFibGUgYW5kIGFwcGVuZCBpdCB0byB0aGUgZW5kIG9mIHRoZSB0YWJsZS4gIElmIHJlZ0V4UGF0aCBpcyBzcGVjaWZpZWQsIHdpbGwNCiAqIHVwZGF0ZSB0aGUgaWRzIGFuZCBuYW1lcyBvZiBhbnkgY2hpbGQgbm9kZXMuDQogKiAgIGkuZS4sIGlmIHJlZ0V4UGF0aCA9ICJ0Yk1lZExuaUNsYWltUm93cyIsDQogKiAgICAgInRiTWVkTG5pQ2xhaW1Sb3dzWzBdLnRiTWVkTG5pQ2xhaW0ubWVkbGNsRGVzY1R4IiB3aWxsIHVwZGF0ZSB0bw0KICogICAgICJ0Yk1lZExuaUNsYWltUm93c1sxXS50Yk1lZExuaUNsYWltLm1lZGxjbERlc2NUeCINCiAqIFRoZSBpbmRleCB3aWxsIGluY3JlbWVudCBhdXRvbWF0aWNhbGx5IGJhc2VkIG9uIHRoZSBudW1iZXIgb2Ygcm93cyBpbiB0aGUgdGFibGUuDQogKg0KICogQHJldHVybiB0aGUgaW5kZXggb2YgdGhlIG5ldyByb3cNCiAqLw0KZnVuY3Rpb24gY2xvbmVSb3codGFibGVJZCwgcmVnRXhQYXRoKSB7DQoJLy8gQ2xvbmUgZmlyc3Qgcm93IGFuZCBhcHBlbmQgdG8gZW5kIG9mIHRhYmxlDQoJdmFyIHRyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFibGVJZCkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRib2R5IilbMF0uZmlyc3RDaGlsZDsNCgl2YXIgbmV3VHIgPSB0ci5jbG9uZU5vZGUodHJ1ZSk7IC8vIGNsb25lIG5vZGUsIGR1cGxpY2F0ZSBjaGlsZCBub2Rlcw0KCXZhciBpbmRleCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYmxlSWQpLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0Ym9keSIpWzBdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ciIpLmxlbmd0aDsNCglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJsZUlkKS5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKVswXS5hcHBlbmRDaGlsZChuZXdUcik7DQoNCgkvLyBCdWcgaW4gSUU4OiBjYW4ndCBqdXN0IHJlcGxhY2UgdGhlIGlubmVySFRNTCBvbiBhIFRSLCBpdCdsbCBkcm9wIGhhbGYgdGhlIFREIG9mIHRoZSBmaXJzdCBjaGlsZCBub2RlIC4uLiBjcmF6eS4NCgkvLyAgIFNvLCB3ZSBpdGVyYXRlIGFuZCB1cGRhdGUgdGhlIGNoaWxkIHJlY29yZHMgaW5zdGVhZCBvZiB0aGUgcGFyZW50Lg0KCXZhciBub2RlcyA9IG5ld1RyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ZCIpOw0KCXZhciBuZXdQYXRoID0gcmVnRXhQYXRoICsgIlsiICsgaW5kZXggKyAiXSI7DQoJdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChyZWdFeFBhdGggKyAiXFxbMFxcXSIsICJnIik7DQoJZm9yICh2YXIgaT0wOyBpPG5vZGVzLmxlbmd0aDsgaSsrKSB7DQoJCW5vZGVzW2ldLmlubmVySFRNTCA9IG5vZGVzW2ldLmlubmVySFRNTC5yZXBsYWNlKHJlZ2V4LCBuZXdQYXRoKTsNCgl9DQoNCgkvLyByZXNldCBuZXcgcm93IHZhbHVlcy4NCgljbGVhckFsbEVsZW1lbnRzKG5ld1RyKTsNCg0KCXJldHVybiBpbmRleDsNCn0NCmZ1bmN0aW9uIGRpc2FibGVBbGxJbnB1dChmb3JtSWQpIHsNCgl2YXIgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZvcm1JZCk7DQoJZm9yICh2YXIgaT0wO2k8Zm9ybS5sZW5ndGg7aSsrKQ0KCSAgew0KCQlpZigoZm9ybS5lbGVtZW50c1tpXSAhPSBudWxsKSAmJg0KCQkJCShmb3JtLmVsZW1lbnRzW2ldICE9ICd1bmRlZmluZWQnKSAmJg0KCQkJCShmb3JtLmVsZW1lbnRzW2ldLnRhZ05hbWUgPT0gJ0lOUFVUJykgJiYNCgkJCQkoZm9ybS5lbGVtZW50c1tpXS50eXBlID09ICdyYWRpbycpICYmDQoJCQkJKGZvcm0uZWxlbWVudHNbaV0udHlwZSAhPSAnYnV0dG9uJykgJiYNCgkJCQkoZm9ybS5lbGVtZW50c1tpXS50eXBlICE9ICdzdWJtaXQnKQ0KCQkJCSkgew0KCQkJZm9ybS5lbGVtZW50c1tpXS5kaXNhYmxlZCA9IHRydWU7DQoJCX0NCg0KCSAgfQ0KfQ0KCQ0KCS8vc2V0IHRoZSByZW1haW5pbmcgY2hhcmFjdGVycw0KCWZ1bmN0aW9uIHNldFJlbWFpbmluZ1RleHQoZmxkTmFtZUlkLGxpbWl0LHJlbU5hbWVJZCl7DQoJICAgICB2YXIgcmVtbGJsPSAiUmVtYWluaW5nIENoYXJhY3RlcnM6IjsNCgkgICAgIHZhciByZW1PYmo9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocmVtTmFtZUlkKTsNCgkgICAgIGlmIChyZW1PYmogIT0gbnVsbCl7DQoJICAgICAgdmFyIGZsZE9iaj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChmbGROYW1lSWQpOw0KCSAgICAgIGlmIChmbGRPYmogIT0gbnVsbCAmJiBmbGRPYmoudmFsdWUubGVuZ3RoID4gMCl7DQoJICAgICAgICAgIHJlbU9iai5pbm5lckhUTUw9IHJlbWxibCArICgwICsgbGltaXQgIC0gKGZsZE9iai52YWx1ZS5sZW5ndGggKSk7DQoJICAgICAgfWVsc2V7DQoJICAgICAgICAgIHJlbU9iai5pbm5lckhUTUw9cmVtbGJsICsgbGltaXQ7IA0KCSAgICAgIH0NCgkgICAgIH0NCgl9DQoNCgkvL3VwZGF0ZSB0aGUgbnVtYmVyIG9mIHRoZSByZW1haW5pbmcgY2hhcmFjdGVycyBnaXZlbiBpbiB0aGUgM3JkIHBhcmFtdGVyIA0KCWZ1bmN0aW9uIGNoZWNrTGVuZ3RoUmVtYWluaW5nT25LZXlQcmVzcyhvYmosIGxpbWl0LCByZW1OYW1lSWQpIHsNCgkgICAgZG9jdW1lbnQuZm9ybXNbY3VycmVudEZvcm1dLmlzRGlydHkudmFsdWU9ICd0cnVlJzsNCgkJdmFyIHJlbWxibCA9ICJSZW1haW5pbmcgQ2hhcmFjdGVyczoiOyAgDQoJCXZhciByZW1vT2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocmVtTmFtZUlkKTsNCgkJaWYgKHJlbW9PYmogIT0gbnVsbCkgew0KCQkJaWYgKG9iai52YWx1ZS5sZW5ndGggPiBsaW1pdCkgew0KCQkJCXJlbW9PYmouaW5uZXJIVE1MID0gcmVtbGJsICsgMDsNCgkJCX0gZWxzZSB7DQoJCQkJcmVtb09iai5pbm5lckhUTUwgPSByZW1sYmwgKyAobGltaXQgLSBvYmoudmFsdWUubGVuZ3RoKTsNCgkJCX0NCgkJfQ0KCQ0KCQlyZXR1cm4gdHJ1ZTsNCgl9DQoJICAgIAkNCgkNCiAgLy9mb3JjZSB1c2VyIHRvIHJlZHVjZSBudW1iZXIgb2YgY2hhcmFjdGVyIGlmIGV4Y2VlZGVzIGEgbGltaXQgb24gaW5wdXQgdGV4dCBhcmVhDQoJZnVuY3Rpb24gY2hlY2tMZW5ndGhPbkJsdXIob2JqLGxpbWl0KXsNCgkJaWYgKG9iai52YWx1ZS5sZW5ndGggPiAgbGltaXQgKXsNCgkJCSAgb2JqLmNsYXNzTmFtZT0iZm9ybS1lbGVtZW50LWVycm9yIjsNCgkJCSAgb2JqLnN0eWxlLmJhY2tncm91bmRDb2xvcj0ieWVsbG93IjsNCgkJCSAgYWxlcnQoIllvdSBoYXZlIGV4Y2VlZGVkIHRoZSAiICsgbGltaXQgKyAiIGNoYXJhY3RlciBsaW1pdCwgcGxlYXNlIGVkaXQiKTsNCgkJCSAgb2JqLmZvY3VzKCk7DQoJCQkgIHJldHVybiBmYWxzZTsNCgkJfQ0KCQlvYmouc3R5bGUuYmFja2dyb3VuZENvbG9yPSJ3aGl0ZSI7DQoJCW9iai5jbGFzc05hbWU9ImZvcm0tZWxlbWVudCI7DQoJCXJldHVybiB0cnVlOw0KCX0NCg0KCS8vcmVzdHJpY3RzIG51bWJlciBvZiBjaGFyYWN0ZXJzIGVudGVyZWQgYW5kIGFsZXJ0IHVzZXIgd2hpbGUgdHlwaW5nIG9uIHRleHQgYXJlYQ0KCWZ1bmN0aW9uIGNoZWNrTGVuZ3RoT25LZXlQcmVzcyhvYmosbGltaXQpew0KCSAgICB2YXIga2V5UHJlc3NlZCA9IGV2ZW50LmtleUNvZGU7DQoJICAgIHN3aXRjaCAoa2V5UHJlc3NlZCl7DQoJICAgICAgIGNhc2UgODogLy9ia3Nwcw0KCSAgICAgICBjYXNlIDQ2OiAvL2RlbGV0ZQ0KCSAgICAJICAgaWYgKG9iai52YWx1ZS5sZW5ndGggPCBsaW1pdCArIDIpIHsNCgkgICAgCQkgICBvYmouY2xhc3NOYW1lPSJmb3JtLWVsZW1lbnQiOw0KCSAgICAJCSAgIG9iai5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I9IndoaXRlIjsNCgkgICAgCQkgICByZXR1cm4gdHJ1ZTsNCgkgICAgCSAgIH0NCgkgICAgCSAgIGJyZWFrOw0KCSAgICAgICAgZGVmYXVsdDoNCgkgICAgCSAgIGlmIChvYmoudmFsdWUubGVuZ3RoID4gbGltaXQgKyAxICl7DQoJCQkJCW9iai52YWx1ZSA9IG9iai52YWx1ZS5zdWJzdHIoMCxsaW1pdCk7DQoJCQkJCW9iai5jbGFzc05hbWU9ImZvcm0tZWxlbWVudC1lcnJvciI7DQoJCQkJCW9iai5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I9InllbGxvdyI7DQoJCQkJCWFsZXJ0KCJZb3UgaGF2ZSByZWFjaGVkIHRoZSAiICsgbGltaXQgKyAiIGNoYXJhY3RlciBsaW1pdC4iKTsNCgkJCQkJb2JqLmZvY3VzKCk7DQoJCQkJCXJldHVybiBmYWxzZTsNCgkJCQl9DQoJCQkgICBicmVhazsNCgkgICAgIH0NCgkJcmV0dXJuIHRydWU7DQoJfQ0KCS8vIENRIDMyNTYyDQoJLy9mb3JjZSB1c2VyIHRvIHJlZHVjZSBudW1iZXIgb2YgY2hhcmFjdGVyIGlmIGV4Y2VlZGVzIGEgbGltaXQgb24gaW5wdXQgdGV4dCBhcmVhDQoJZnVuY3Rpb24gY2hlY2tMaW1pdE9uQmx1cihvYmosIGxpbWl0LCByZXBvcnRpbmdJZCl7DQoJCWlmKHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJlcG9ydGluZ0lkKS5pbm5lclRleHQsIDEwKSA8IDAgKXsNCgkJCSAgb2JqLmNsYXNzTmFtZT0iZm9ybS1lbGVtZW50LWVycm9yIjsNCgkJCSAgb2JqLnN0eWxlLmJhY2tncm91bmRDb2xvcj0ieWVsbG93IjsNCgkJCSAgYWxlcnQoIllvdSBoYXZlIGV4Y2VlZGVkIHRoZSAiICsgbGltaXQgKyAiIGNoYXJhY3RlciBsaW1pdCwgcGxlYXNlIGVkaXQiKTsNCgkJCSAgb2JqLmZvY3VzKCk7DQoJCQkgIHJldHVybiBmYWxzZTsNCgkJfQ0KCQlvYmouc3R5bGUuYmFja2dyb3VuZENvbG9yPSJ3aGl0ZSI7DQoJCW9iai5jbGFzc05hbWU9ImZvcm0tZWxlbWVudCI7DQoJCXJldHVybiB0cnVlOw0KCX0NCgkvLyBDUSAzMjU2Mg0KCS8vcmVzdHJpY3RzIG51bWJlciBvZiBjaGFyYWN0ZXJzIGVudGVyZWQgYW5kIGFsZXJ0IHVzZXIgd2hpbGUgdHlwaW5nIG9uIHRleHQgYXJlYQ0KCWZ1bmN0aW9uIGNoZWNrTGltaXRPbktleURvd24ob2JqLCBsaW1pdCwgcmVwb3J0aW5nSWQpew0KCQl2YXIga2V5UHJlc3NlZCA9IGV2ZW50LmtleUNvZGU7DQoJCXZhciByZW1haW5pbmdDb3VudCA9IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJlcG9ydGluZ0lkKS5pbm5lclRleHQsIDEwKTsNCgkJDQoJCXN3aXRjaCAoa2V5UHJlc3NlZCl7DQoJCS8vIFNraXAga2V5IHByZXNzIHRoYXQgd291bGQgbm90IGNoYW5nZSB0aGUgY2hhcmFjdGVyIHJlbWFpbmluZyBjb3VudCBmb3IgdGhlIHRleHQgYXJlYS4NCgkJCWNhc2UgOTogLy8gVGFiDQoJCQljYXNlIDE2OiAvLyBTaGlmdA0KCQkJY2FzZSAxNzogLy8gQ3RybA0KCQkJY2FzZSAxODogLy8gQWx0DQoJCQljYXNlIDE5OiAvLyBQYXVzZS9CcmVhaw0KCQkJY2FzZSAyMDogLy8gQ2FwcyBMb2NrDQoJCQljYXNlIDI3OiAvLyBFc2MNCgkJCWNhc2UgMzM6IC8vIFBhZ2UgVXANCgkJCWNhc2UgMzQ6IC8vIFBhZ2UgRG93bg0KCQkJY2FzZSAzNTogLy8gRW5kDQoJCQljYXNlIDM2OiAvLyBIb21lDQoJCQljYXNlIDM3OiAvLyBMZWZ0IEFycm93DQoJCQljYXNlIDM4OiAvLyBVcCBBcnJvdw0KCQkJY2FzZSAzOTogLy8gUmlnaHQgQXJyb3cNCgkJCWNhc2UgNDA6IC8vIERvd24gQXJyb3cNCgkJCWNhc2UgNDQ6IC8vIFBydFNjcm4NCgkJCWNhc2UgNDU6IC8vIEluc2VydA0KCQkJY2FzZSA5MTogLy8gTGVmdCBXaW5kb3cgS2V5IFN0YXJ0DQoJCQljYXNlIDkyOiAvLyBSaWdodCBXaW5kb3cgS2V5IFN0YXJ0DQoJCQljYXNlIDkzOiAvLyBXaW5kb3cgS2V5IE1lbnUNCgkJCWNhc2UgMTEyOiAvLyBGMQ0KCQkJY2FzZSAxMTM6IC8vIEYyDQoJCQljYXNlIDExNDogLy8gRjMNCgkJCWNhc2UgMTE1OiAvLyBGNA0KCQkJY2FzZSAxMTY6IC8vIEY1DQoJCQljYXNlIDExNzogLy8gRjYNCgkJCWNhc2UgMTE4OiAvLyBGNw0KCQkJY2FzZSAxMTk6IC8vIEY4DQoJCQljYXNlIDEyMDogLy8gRjkNCgkJCWNhc2UgMTIxOiAvLyBGMTANCgkJCWNhc2UgMTIyOiAvLyBGMTENCgkJCWNhc2UgMTIzOiAvLyBGMTINCgkJCWNhc2UgMTQ0OiAvLyBOdW0gTG9jaw0KCQkJY2FzZSAxNDU6IC8vIFNjcm9sbCBMb2NrDQoJCQljYXNlIDE3MzogLy8gTXV0ZSB0b2dnbGUNCgkJCWNhc2UgMTc0OiAvLyBWb2x1bWUgRG93bg0KCQkJY2FzZSAxNzU6IC8vIFZvbHVtZSBVcA0KCQkJY2FzZSAxMjogIC8vIE51bWtleSBwYWQgJzUnIHdpdGhvdXQgbnVtbG9jaw0KCQkJY2FzZSAxNzI6IC8vIEJyb3dzZXINCgkJCWNhc2UgMTgwOiAvLyBNYWlsDQoJCQljYXNlIDE4MjogLy8gQ29tcHV0ZXINCgkJCWNhc2UgMTgzOiAvLyBDYWxjdWxhdG9yDQoJCQljYXNlIDE3NzogLy8gU2tpcCBCYWNrDQoJCQljYXNlIDE3OTogLy8gUGxheS9QYXVzZQ0KCQkJY2FzZSAxNzY6IC8vIFNraXAgRm9yd2FyZA0KCQkJY2FzZSAxODE6IC8vIE11c2ljDQoJCQkJcmV0dXJuIHRydWU7DQoJCQkJYnJlYWs7DQogICAgICAgCQljYXNlIDg6IC8vYmtzcHMNCiAgICAgICAJCWNhc2UgNDY6IC8vZGVsZXRlDQogICAgCQkgICAJcmV0dXJuIHRydWU7DQogICAgCQkgICAJYnJlYWs7DQogICAgCSAgIAlkZWZhdWx0Og0KICAgIAkgICAJCWlmKHJlbWFpbmluZ0NvdW50IDwgMCkgew0KICAgIAkJCQlyZXR1cm4gZmFsc2U7DQogICAgCQkJfQ0KICAgIAkgICAJCWJyZWFrOw0KICAgIAl9DQoJCXJldHVybiB0cnVlOw0KfQ0KCS8vIENRIDMyNTYyDQoJLy8gVmFsaWRhdGlvbiBmb3IgbnVtYmVyIG9mIGNoYXJhY3RlcnMgZW50ZXJlZCBpbiBvbTp0ZXh0YXJlYQ0KCS8vIFVzZSBpbiBvbmtleXVwIGV2ZW50IGZvciBhIG9tOnRleHRhcmVhDQoJZnVuY3Rpb24gY2hlY2tMaW1pdE9uS2V5VXAob2JqLCBsaW1pdCwgcmVwb3J0aW5nSWQpew0KCQl2YXIgcmVtYWluaW5nQ291bnQgPSBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyZXBvcnRpbmdJZCkuaW5uZXJUZXh0LCAxMCk7DQoJCXZhciB0ZXh0Ow0KCQkNCgkJdGV4dCA9IG9iai50ZXh0Q29udGVudDsNCgkJdmFyIHNvbWVBcnJheSA9IHRleHQuc3BsaXQoL1xuLyk7DQoJCS8vd2luZG93LmFsZXJ0KHNvbWVBcnJheS5sZW5ndGgpOw0KCQkvL3dpbmRvdy5hbGVydCh0ZXh0Lmxlbmd0aCk7DQoJCWlmKCh0ZXh0Lmxlbmd0aCArIHNvbWVBcnJheS5sZW5ndGggLSAxKSA+IGxpbWl0KSB7DQoNCgkJCS8vIFNob3cgZXJyb3Igb25seSBvbmNlIGFmdGVyIGl0IHdhcyBoaWdobGlnaHRlZCB5ZWxsb3cuDQoJCQlpZihvYmouc3R5bGUuYmFja2dyb3VuZENvbG9yICE9ICJ5ZWxsb3ciKSB7DQoJICAgCQkJLy8gQ2xlYXIgdGhlIHJlbWFpbmluZyBjaGFyYWN0ZXIgY291bnQgdG8gcHJldmVudCBjaGVja0xpbWl0T25CbHVyKCkgZnJvbSBzaG93aW5nDQoJICAgCQkJLy8gYW5vdGhlciBhbGVydCBib3ggcmlnaHQgYWZ0ZXIgdGhlIHVzZXIgY2xpY2tzIG9rIG9uIHRoZSBhbGVydCBib3ggaW4gdGhpcyBmdW5jdGlvbi4NCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyZXBvcnRpbmdJZCkuaW5uZXJUZXh0ID0gJzAnOw0KDQoJCQkJYWxlcnQoIllvdSBoYXZlIGV4Y2VlZGVkIHRoZSAiICsgbGltaXQgKyAiIGNoYXJhY3RlciBsaW1pdCwgcGxlYXNlIGVkaXQiKTsNCg0KCQkJCW9iai5jbGFzc05hbWU9ImZvcm0tZWxlbWVudC1lcnJvciI7DQoJCQkJb2JqLnN0eWxlLmJhY2tncm91bmRDb2xvcj0ieWVsbG93IjsNCgkJCQlvYmouZm9jdXMoKTsNCgkgICAJCQkvLyBSZXN0b3JlIHRoZSByZW1haW5pbmcgY2hhcmFjdGVyIGNvdW50IG5vdyB0aGF0IHRoZSBjaGVja0xpbWl0T25CbHVyKCkgaGFzIGFscmVhZHkgYmVlbiBjYWxsZWQNCgkgICAJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyZXBvcnRpbmdJZCkuaW5uZXJUZXh0ID0gcmVtYWluaW5nQ291bnQ7DQoJCQl9DQoJCQkNCgkJfSBlbHNlIHsNCgkJCW9iai5jbGFzc05hbWU9ImZvcm0tZWxlbWVudCI7DQoJCSAgIAlvYmouc3R5bGUuYmFja2dyb3VuZENvbG9yPSJ3aGl0ZSI7DQoJCX0NCgkJDQoJCQ0KCQlyZXR1cm4gdHJ1ZTsNCgl9DQoJDQoJLy8gQ1IgNjM2Nw0KCWZ1bmN0aW9uIGNvbmZpcm1EZWxldGUobWVzc2FnZSkgew0KCQlpZihtZXNzYWdlID09IG51bGwgfHwgbWVzc2FnZSA9PSAnJykgew0KCQkgCW1lc3NhZ2UgPSAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlbGV0ZSB0aGlzIHJlY29yZD8nOw0KCQl9DQoNCgkJaWYgKGNvbmZpcm0obWVzc2FnZSkpDQoJCXsNCgkJCXJldHVybiB0cnVlOw0KCQl9ZWxzZXsNCgkJCXJldHVybiBmYWxzZTsNCgkJCX0NCgkJfQ0KCQ0KCWZ1bmN0aW9uIG9wZW5WaXBNZXNzYWdlKG1lc3NhZ2UpDQoJew0KCQl2YXIgd2luV2lkdGggPSA0MjA7DQoJCXZhciB3aW5IZWlnaHQgPSAyNDA7DQoJCXZhciB1cmwgPSAiL09NTklTdGF0aWMvZGlhbG9ncy92aXBNZXNzYWdlRGlhbG9nLmh0bWwiOw0KCQl2YXIgcGFyYW1ldGVycyA9IG5ldyBBcnJheSgpOwkNCgkJcGFyYW1ldGVyc1swXSA9IG1lc3NhZ2U7DQoJCXdpbmRvdy5zaG93TW9kYWxEaWFsb2codXJsLHBhcmFtZXRlcnMsImRpYWxvZ1dpZHRoOiIgKyB3aW5XaWR0aCArICIgcHg7ZGlhbG9nSGVpZ2h0OiIgKyB3aW5IZWlnaHQgKyAicHg7Y2VudGVyOjE7aGVscDowO3N0YXR1czowO2xvY2F0aW9uPW5vLG1lbnViYXI9MCxyZXNpemFibGU9MCIpOw0KCX0NCg0KCS8vIENRIDM0MTk1IA0KCWZ1bmN0aW9uIEdldFVSTFBhcmFtZXRlcihzUGFyYW0pDQoJew0KCSAgICB2YXIgc1BhZ2VVUkwgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKTsNCgkgICAgdmFyIHNVUkxWYXJpYWJsZXMgPSBzUGFnZVVSTC5zcGxpdCgnJicpOw0KCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNVUkxWYXJpYWJsZXMubGVuZ3RoOyBpKyspIA0KCSAgICB7DQoJICAgICAgICB2YXIgc1BhcmFtZXRlck5hbWUgPSBzVVJMVmFyaWFibGVzW2ldLnNwbGl0KCc9Jyk7DQoJICAgICAgICBpZiAoc1BhcmFtZXRlck5hbWVbMF0gPT0gc1BhcmFtKSANCgkgICAgICAgIHsNCgkgICAgICAgICAgICByZXR1cm4gc1BhcmFtZXRlck5hbWVbMV07DQoJICAgICAgICB9DQoJICAgIH0NCgl9DQoJZnVuY3Rpb24gU2V0RmllbGRFbXB0eUJ5SWQoSWQpDQoJew0KICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoSWQpICE9IG51bGwpIA0KICAgICAgICB7CQ0KICAgICAgICAJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoSWQpLnZhbHVlID0gIiI7DQogICAgICAgIH0NCgl9DQo=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 310,
          "bodySize": 115532
        },
        "cache": {},
        "timings": {
          "send": 6,
          "wait": 0,
          "receive": 13
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8632"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.615-07:00",
        "time": 30,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/common-deferred-scripts.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 347,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1576"
            }
          ],
          "content": {
            "size": 3836,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "Ly8gY29tbW9uLWRlZmVycmVkLXNjcmlwdHMuanMNCi8vIERlZmVjdCA5NzU5DQovLyBEZWZlY3QgMTAzOTMNCi8vIGNoYW5nZWQgZm9yIGRlZmVjdCAxMTA5NSAtIG9ubHkgY2hhbmdlIHRoZSBsaW5rcyBpbiB0aGUgJ3BhZ2UtbGluaycgc3BhbiAocmVwbGFjZXMgY2hhbmdlcyBmb3IgMTAzOTMgYW5kIDk3NTkpDQoNCi8vIENRMjIyNjcgLSBkaXNwbGF5dGFibGUucHJvcGVydGllcyBub3cgaW5jbHVkZXMgYSBwcm9wZXJ0eSwgImJhc2ljLmhlYWRlciIsIHRoYXQgcGVybWl0cyBjdXN0b20gdGFibGUgaGVhZGVycw0KLy8gd2hpY2ggbWFrZXMgdGhpcyBmaXJzdCBibG9jayBvZiBzdGF0aWMgY29kZSBtb290Lg0KDQovLyBDUTIxNjE4IC0gRGlzcGxheVRhYmxlJ3Mgc29ydGFibGUgY29sdW1uIGxpbmtzIGFyZSBiZWluZyBtaXNzZWQgaW4gdGhlIGJlbG93IHBhZ2UtbGluayBsb2dpYw0KLy8gVW5mb3J0dW5hdGVseSwgdGhlcmUgaXMgbm8gZGlzcGxheXRhYmxlLnByb3BlcnRpZXMgdG8gY29uZmlndXJlIHRoZSBjb2x1bW4gc29ydGFibGUgbGlua3MNCi8vIFNvLCB3ZSBkbyBhIGxpdHRsZSBET00gbWFuaXB1bGF0aW9uIGFuZCBtb3ZlIHRoZSBhbmNob3IgdGFnIGludG8gYSBzcGFuIHRhZyB0byBtYXRjaCB0aGUgcGFnaW5hdGlvbiBsaW5rcy4NCi8vIFRoaXMgd2F5LCB0aGV5IHdpbGwgYWxzbyBnZXQgZGlzYWJsZWQgd2hlbiB0aGUgcGFnZS1saW5rIGxvZ2ljIHJ1bnMuDQovL3ZhciB0aHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGgiKTsNCi8vQ1EyMjI5NCAtIGNoYW5nZSB0aGUgdmFyaWFibGUgbmFtZSBmcm9tICdpJywgYXMgaXQgaXMgcHV0IGluIGdsb2JhbCBzY29wZSwgYW5kIG1lc3NlcyB3aXRoIHRoZSBncm91cE1vdmUgc2NyZWVuLiAod2hpY2ggYWxzbyBoYXMgYSB2YXJpYWJsZSBuYW1lZCAnaScgaW4gZ2xvYmFsIHNjb3BlKQ0KLy9mb3IgKHZhciB0aHNJbmRleD0wOyB0aHNJbmRleCA8IHRocy5sZW5ndGg7IHRoc0luZGV4KyspIHsNCi8vCXZhciBjbGFzc05hbWUgPSAiIiArIHRoc1t0aHNJbmRleF0uY2xhc3NOYW1lOw0KLy8JaWYgKGNsYXNzTmFtZS5tYXRjaCgvc29ydGFibGUvKSkgew0KLy8JCXZhciBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOw0KLy8JCXNwYW4uY2xhc3NOYW1lID0gJ3BhZ2UtbGluayc7DQovLwkJdGhzW3Roc0luZGV4XS5hcHBlbmRDaGlsZChzcGFuKTsNCi8vDQovLwkJdmFyIGFzID0gdGhzW3Roc0luZGV4XS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpOw0KLy8JCWZvciAodmFyIGo9MDsgajxhcy5sZW5ndGg7IGorKykgew0KLy8JCQlzcGFuLmFwcGVuZENoaWxkKGFzW2pdKTsNCi8vCQl9DQovLwl9DQovL30NCg0KLy9maW5kIGFsbCBvZiB0aGUgc3BhbiBlbGVtZW50cyBpbiB0aGUgZG9jdW1lbnQNCnZhciBmaW5kU3RhY2sgPSBbXSwgYWxsZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic3BhbiIpOw0KdmFyIGxlbiA9IGFsbGVsLmxlbmd0aDsNCi8vYWxlcnQobGVuKTsNCmZvcih2YXIgYSA9IDA7IGE8YWxsZWwubGVuZ3RoOyBhKyspIHsNCgkvL21hdGNoIGFsbCBvZiB0aGUgc3BhbnMgdGhhdCBhcmUgdHlwZSAncGFnZS1saW5rJyAocGFnaW5hdGlvbiBzcGFuIGZvciBkaXNwbGF5IHRhYmxlcykNCglpZihhbGxlbFthXS5jbGFzc05hbWUgPT0gJ3BhZ2UtbGluaycpew0KCQkvL2FsZXJ0KCJtYXRjaGVkIik7DQoJCXZhciBjZWxscyA9IGFsbGVsW2FdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJyk7DQoJCXZhciBvbGQ7DQoJCWZvciAodmFyIGVDb3VudCA9IDA7IGVDb3VudCA8IGNlbGxzLmxlbmd0aDsgZUNvdW50KyspIHsNCgkJCS8vbWF0Y2ggYWxsIG9mIHRoZSBocmVmIHRhZ3Mgd2l0aGluIHRoZSAncGFnZS1saW5rJyBzcGFuIGFuZCByZXBsYWNlIHRoZSBsaW5rIHdpdGggc3BlY2lhbCBqYXZhc2NyaXB0IGxpbmsgZGlzYWJsaW5nDQoJCQlvbGQgPSBjZWxsc1tlQ291bnRdLmdldEF0dHJpYnV0ZSgiaHJlZiIpOw0KCQkJLy8gQ1EyMzQxNiAtIFVSTCBoYWQgc3BlY2lhbCBjaGFyYWN0ZXJzIChpLmUuIHNpbmdsZSBxdW90ZSAnKSB0aGF0IHdhcyBicmVha2luZyB0aGUgbGluaw0KCQkJLy9KYW4gNyAyMDEyIC0gY2hhbmdlZCBmcm9tIGVuY29kZVVSSSB0byBlc2NhcGUgKGFjY29yZGluZyB0byB3MyBzY2hvb2xzIHNhbWUgZnVuY3Rpb24ganVzdCBjb3ZlcnMgbW9yZSBzcGVjaWFsIGNoYXJzKQ0KCQkJb2xkID0gZXNjYXBlKG9sZCk7DQoJCQkvL2ZpeCBmb3IgZGVmZWN0IDEyNzA3IC0gd2UgYXJlIHdyYXBwaW5nIHRoZSBsb2NhdGlvbiByZXNldCBpbnRvIGEgZnVuY3Rpb24gc28gd2UgY2FuIG92ZXJyaWRlIHRoZSB1cmwuDQoJCQkvLyBGb3IgQ1EyNjM2OCAoQ1EyMzQxNik6IERlbGltZXRlZCBVUkwgd2l0aCBkb3VibGUgcXVvdGVzIGJlY2F1c2UgZW5jb2RlZCBzaW5nbGUgcXVvdGUgaXMgZGVjb2RlZCBiZWZvcmUgYmVpbmcgcGFzc2VkDQoJCQkvLyB0byByZXNldFVybCgpIGZ1bmN0aW9uIGNhdXNpbmcgc3RyaW5nIHRvIGJlIGVuZGVkIHByZW1hdHVyZWx5IGFuZCBnZW5lcmF0aW5nIGphdmFzY2lwdCBlcnJvcjogRXhwZWN0ZWQgJyknDQoJCQljZWxsc1tlQ291bnRdLnNldEF0dHJpYnV0ZSgiaHJlZiIsICJqYXZhc2NyaXB0OmdldEVsZW1lbnRzT2ZUaGVDbGFzc05hbWUoJ3BhZ2UtbGluaycpO3Jlc2V0VXJsKFwiIiArIG9sZCArICJcIik7Iik7DQoJCQkNCgkJCW9sZCA9IGNlbGxzW2VDb3VudF0uZ2V0QXR0cmlidXRlKCJvbmNsaWNrIik7DQoJCQljZWxsc1tlQ291bnRdLnNldEF0dHJpYnV0ZSgib25jbGljayIsICJpZiAoaGFzRGlzYWJsZWRDbGFzcyh0aGlzKSkgcmV0dXJuIGZhbHNlOyAiICsgb2xkKTsNCgkJfQ0KCX0NCn0NCg0KDQoNCg==",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 309,
          "bodySize": 3836
        },
        "cache": {},
        "timings": {
          "send": 4,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8631"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.616-07:00",
        "time": 56,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/jquery/jquery-1.9.1.min.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 347,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "41444"
            }
          ],
          "content": {
            "size": 123512,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "LyohIGpRdWVyeSB2MS45LjEgfCAoYykgMjAwNSwgMjAxMiBqUXVlcnkgRm91bmRhdGlvbiwgSW5jLiB8IGpxdWVyeS5vcmcvbGljZW5zZQ0KLy9AIHNvdXJjZU1hcHBpbmdVUkw9anF1ZXJ5Lm1pbi5tYXANCiovKGZ1bmN0aW9uKGUsdCl7dmFyIG4scixpPXR5cGVvZiB0LG89ZS5kb2N1bWVudCxhPWUubG9jYXRpb24scz1lLmpRdWVyeSx1PWUuJCxsPXt9LGM9W10scD0iMS45LjEiLGY9Yy5jb25jYXQsZD1jLnB1c2gsaD1jLnNsaWNlLGc9Yy5pbmRleE9mLG09bC50b1N0cmluZyx5PWwuaGFzT3duUHJvcGVydHksdj1wLnRyaW0sYj1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcgYi5mbi5pbml0KGUsdCxyKX0seD0vWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSx3PS9cUysvZyxUPS9eW1xzXHVGRUZGXHhBMF0rfFtcc1x1RkVGRlx4QTBdKyQvZyxOPS9eKD86KDxbXHdcV10rPilbXj5dKnwjKFtcdy1dKikpJC8sQz0vXjwoXHcrKVxzKlwvPz4oPzo8XC9cMT58KSQvLGs9L15bXF0sOnt9XHNdKiQvLEU9Lyg/Ol58OnwsKSg/OlxzKlxbKSsvZyxTPS9cXCg/OlsiXFxcL2JmbnJ0XXx1W1xkYS1mQS1GXXs0fSkvZyxBPS8iW14iXFxcclxuXSoifHRydWV8ZmFsc2V8bnVsbHwtPyg/OlxkK1wufClcZCsoPzpbZUVdWystXT9cZCt8KS9nLGo9L14tbXMtLyxEPS8tKFtcZGEtel0pL2dpLEw9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdC50b1VwcGVyQ2FzZSgpfSxIPWZ1bmN0aW9uKGUpeyhvLmFkZEV2ZW50TGlzdGVuZXJ8fCJsb2FkIj09PWUudHlwZXx8ImNvbXBsZXRlIj09PW8ucmVhZHlTdGF0ZSkmJihxKCksYi5yZWFkeSgpKX0scT1mdW5jdGlvbigpe28uYWRkRXZlbnRMaXN0ZW5lcj8oby5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixILCExKSxlLnJlbW92ZUV2ZW50TGlzdGVuZXIoImxvYWQiLEgsITEpKTooby5kZXRhY2hFdmVudCgib25yZWFkeXN0YXRlY2hhbmdlIixIKSxlLmRldGFjaEV2ZW50KCJvbmxvYWQiLEgpKX07Yi5mbj1iLnByb3RvdHlwZT17anF1ZXJ5OnAsY29uc3RydWN0b3I6Yixpbml0OmZ1bmN0aW9uKGUsbixyKXt2YXIgaSxhO2lmKCFlKXJldHVybiB0aGlzO2lmKCJzdHJpbmciPT10eXBlb2YgZSl7aWYoaT0iPCI9PT1lLmNoYXJBdCgwKSYmIj4iPT09ZS5jaGFyQXQoZS5sZW5ndGgtMSkmJmUubGVuZ3RoPj0zP1tudWxsLGUsbnVsbF06Ti5leGVjKGUpLCFpfHwhaVsxXSYmbilyZXR1cm4hbnx8bi5qcXVlcnk/KG58fHIpLmZpbmQoZSk6dGhpcy5jb25zdHJ1Y3RvcihuKS5maW5kKGUpO2lmKGlbMV0pe2lmKG49biBpbnN0YW5jZW9mIGI/blswXTpuLGIubWVyZ2UodGhpcyxiLnBhcnNlSFRNTChpWzFdLG4mJm4ubm9kZVR5cGU/bi5vd25lckRvY3VtZW50fHxuOm8sITApKSxDLnRlc3QoaVsxXSkmJmIuaXNQbGFpbk9iamVjdChuKSlmb3IoaSBpbiBuKWIuaXNGdW5jdGlvbih0aGlzW2ldKT90aGlzW2ldKG5baV0pOnRoaXMuYXR0cihpLG5baV0pO3JldHVybiB0aGlzfWlmKGE9by5nZXRFbGVtZW50QnlJZChpWzJdKSxhJiZhLnBhcmVudE5vZGUpe2lmKGEuaWQhPT1pWzJdKXJldHVybiByLmZpbmQoZSk7dGhpcy5sZW5ndGg9MSx0aGlzWzBdPWF9cmV0dXJuIHRoaXMuY29udGV4dD1vLHRoaXMuc2VsZWN0b3I9ZSx0aGlzfXJldHVybiBlLm5vZGVUeXBlPyh0aGlzLmNvbnRleHQ9dGhpc1swXT1lLHRoaXMubGVuZ3RoPTEsdGhpcyk6Yi5pc0Z1bmN0aW9uKGUpP3IucmVhZHkoZSk6KGUuc2VsZWN0b3IhPT10JiYodGhpcy5zZWxlY3Rvcj1lLnNlbGVjdG9yLHRoaXMuY29udGV4dD1lLmNvbnRleHQpLGIubWFrZUFycmF5KGUsdGhpcykpfSxzZWxlY3RvcjoiIixsZW5ndGg6MCxzaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubGVuZ3RofSx0b0FycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIGguY2FsbCh0aGlzKX0sZ2V0OmZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lP3RoaXMudG9BcnJheSgpOjA+ZT90aGlzW3RoaXMubGVuZ3RoK2VdOnRoaXNbZV19LHB1c2hTdGFjazpmdW5jdGlvbihlKXt2YXIgdD1iLm1lcmdlKHRoaXMuY29uc3RydWN0b3IoKSxlKTtyZXR1cm4gdC5wcmV2T2JqZWN0PXRoaXMsdC5jb250ZXh0PXRoaXMuY29udGV4dCx0fSxlYWNoOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGIuZWFjaCh0aGlzLGUsdCl9LHJlYWR5OmZ1bmN0aW9uKGUpe3JldHVybiBiLnJlYWR5LnByb21pc2UoKS5kb25lKGUpLHRoaXN9LHNsaWNlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGguYXBwbHkodGhpcyxhcmd1bWVudHMpKX0sZmlyc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lcSgwKX0sbGFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKC0xKX0sZXE6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5sZW5ndGgsbj0rZSsoMD5lP3Q6MCk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKG4+PTAmJnQ+bj9bdGhpc1tuXV06W10pfSxtYXA6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGIubWFwKHRoaXMsZnVuY3Rpb24odCxuKXtyZXR1cm4gZS5jYWxsKHQsbix0KX0pKX0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHJldk9iamVjdHx8dGhpcy5jb25zdHJ1Y3RvcihudWxsKX0scHVzaDpkLHNvcnQ6W10uc29ydCxzcGxpY2U6W10uc3BsaWNlfSxiLmZuLmluaXQucHJvdG90eXBlPWIuZm4sYi5leHRlbmQ9Yi5mbi5leHRlbmQ9ZnVuY3Rpb24oKXt2YXIgZSxuLHIsaSxvLGEscz1hcmd1bWVudHNbMF18fHt9LHU9MSxsPWFyZ3VtZW50cy5sZW5ndGgsYz0hMTtmb3IoImJvb2xlYW4iPT10eXBlb2YgcyYmKGM9cyxzPWFyZ3VtZW50c1sxXXx8e30sdT0yKSwib2JqZWN0Ij09dHlwZW9mIHN8fGIuaXNGdW5jdGlvbihzKXx8KHM9e30pLGw9PT11JiYocz10aGlzLC0tdSk7bD51O3UrKylpZihudWxsIT0obz1hcmd1bWVudHNbdV0pKWZvcihpIGluIG8pZT1zW2ldLHI9b1tpXSxzIT09ciYmKGMmJnImJihiLmlzUGxhaW5PYmplY3Qocil8fChuPWIuaXNBcnJheShyKSkpPyhuPyhuPSExLGE9ZSYmYi5pc0FycmF5KGUpP2U6W10pOmE9ZSYmYi5pc1BsYWluT2JqZWN0KGUpP2U6e30sc1tpXT1iLmV4dGVuZChjLGEscikpOnIhPT10JiYoc1tpXT1yKSk7cmV0dXJuIHN9LGIuZXh0ZW5kKHtub0NvbmZsaWN0OmZ1bmN0aW9uKHQpe3JldHVybiBlLiQ9PT1iJiYoZS4kPXUpLHQmJmUualF1ZXJ5PT09YiYmKGUualF1ZXJ5PXMpLGJ9LGlzUmVhZHk6ITEscmVhZHlXYWl0OjEsaG9sZFJlYWR5OmZ1bmN0aW9uKGUpe2U/Yi5yZWFkeVdhaXQrKzpiLnJlYWR5KCEwKX0scmVhZHk6ZnVuY3Rpb24oZSl7aWYoZT09PSEwPyEtLWIucmVhZHlXYWl0OiFiLmlzUmVhZHkpe2lmKCFvLmJvZHkpcmV0dXJuIHNldFRpbWVvdXQoYi5yZWFkeSk7Yi5pc1JlYWR5PSEwLGUhPT0hMCYmLS1iLnJlYWR5V2FpdD4wfHwobi5yZXNvbHZlV2l0aChvLFtiXSksYi5mbi50cmlnZ2VyJiZiKG8pLnRyaWdnZXIoInJlYWR5Iikub2ZmKCJyZWFkeSIpKX19LGlzRnVuY3Rpb246ZnVuY3Rpb24oZSl7cmV0dXJuImZ1bmN0aW9uIj09PWIudHlwZShlKX0saXNBcnJheTpBcnJheS5pc0FycmF5fHxmdW5jdGlvbihlKXtyZXR1cm4iYXJyYXkiPT09Yi50eXBlKGUpfSxpc1dpbmRvdzpmdW5jdGlvbihlKXtyZXR1cm4gbnVsbCE9ZSYmZT09ZS53aW5kb3d9LGlzTnVtZXJpYzpmdW5jdGlvbihlKXtyZXR1cm4haXNOYU4ocGFyc2VGbG9hdChlKSkmJmlzRmluaXRlKGUpfSx0eXBlOmZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lP2UrIiI6Im9iamVjdCI9PXR5cGVvZiBlfHwiZnVuY3Rpb24iPT10eXBlb2YgZT9sW20uY2FsbChlKV18fCJvYmplY3QiOnR5cGVvZiBlfSxpc1BsYWluT2JqZWN0OmZ1bmN0aW9uKGUpe2lmKCFlfHwib2JqZWN0IiE9PWIudHlwZShlKXx8ZS5ub2RlVHlwZXx8Yi5pc1dpbmRvdyhlKSlyZXR1cm4hMTt0cnl7aWYoZS5jb25zdHJ1Y3RvciYmIXkuY2FsbChlLCJjb25zdHJ1Y3RvciIpJiYheS5jYWxsKGUuY29uc3RydWN0b3IucHJvdG90eXBlLCJpc1Byb3RvdHlwZU9mIikpcmV0dXJuITF9Y2F0Y2gobil7cmV0dXJuITF9dmFyIHI7Zm9yKHIgaW4gZSk7cmV0dXJuIHI9PT10fHx5LmNhbGwoZSxyKX0saXNFbXB0eU9iamVjdDpmdW5jdGlvbihlKXt2YXIgdDtmb3IodCBpbiBlKXJldHVybiExO3JldHVybiEwfSxlcnJvcjpmdW5jdGlvbihlKXt0aHJvdyBFcnJvcihlKX0scGFyc2VIVE1MOmZ1bmN0aW9uKGUsdCxuKXtpZighZXx8InN0cmluZyIhPXR5cGVvZiBlKXJldHVybiBudWxsOyJib29sZWFuIj09dHlwZW9mIHQmJihuPXQsdD0hMSksdD10fHxvO3ZhciByPUMuZXhlYyhlKSxpPSFuJiZbXTtyZXR1cm4gcj9bdC5jcmVhdGVFbGVtZW50KHJbMV0pXToocj1iLmJ1aWxkRnJhZ21lbnQoW2VdLHQsaSksaSYmYihpKS5yZW1vdmUoKSxiLm1lcmdlKFtdLHIuY2hpbGROb2RlcykpfSxwYXJzZUpTT046ZnVuY3Rpb24obil7cmV0dXJuIGUuSlNPTiYmZS5KU09OLnBhcnNlP2UuSlNPTi5wYXJzZShuKTpudWxsPT09bj9uOiJzdHJpbmciPT10eXBlb2YgbiYmKG49Yi50cmltKG4pLG4mJmsudGVzdChuLnJlcGxhY2UoUywiQCIpLnJlcGxhY2UoQSwiXSIpLnJlcGxhY2UoRSwiIikpKT9GdW5jdGlvbigicmV0dXJuICIrbikoKTooYi5lcnJvcigiSW52YWxpZCBKU09OOiAiK24pLHQpfSxwYXJzZVhNTDpmdW5jdGlvbihuKXt2YXIgcixpO2lmKCFufHwic3RyaW5nIiE9dHlwZW9mIG4pcmV0dXJuIG51bGw7dHJ5e2UuRE9NUGFyc2VyPyhpPW5ldyBET01QYXJzZXIscj1pLnBhcnNlRnJvbVN0cmluZyhuLCJ0ZXh0L3htbCIpKToocj1uZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTERPTSIpLHIuYXN5bmM9ImZhbHNlIixyLmxvYWRYTUwobikpfWNhdGNoKG8pe3I9dH1yZXR1cm4gciYmci5kb2N1bWVudEVsZW1lbnQmJiFyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJzZXJlcnJvciIpLmxlbmd0aHx8Yi5lcnJvcigiSW52YWxpZCBYTUw6ICIrbikscn0sbm9vcDpmdW5jdGlvbigpe30sZ2xvYmFsRXZhbDpmdW5jdGlvbih0KXt0JiZiLnRyaW0odCkmJihlLmV4ZWNTY3JpcHR8fGZ1bmN0aW9uKHQpe2UuZXZhbC5jYWxsKGUsdCl9KSh0KX0sY2FtZWxDYXNlOmZ1bmN0aW9uKGUpe3JldHVybiBlLnJlcGxhY2UoaiwibXMtIikucmVwbGFjZShELEwpfSxub2RlTmFtZTpmdW5jdGlvbihlLHQpe3JldHVybiBlLm5vZGVOYW1lJiZlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT10LnRvTG93ZXJDYXNlKCl9LGVhY2g6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGk9MCxvPWUubGVuZ3RoLGE9TShlKTtpZihuKXtpZihhKXtmb3IoO28+aTtpKyspaWYocj10LmFwcGx5KGVbaV0sbikscj09PSExKWJyZWFrfWVsc2UgZm9yKGkgaW4gZSlpZihyPXQuYXBwbHkoZVtpXSxuKSxyPT09ITEpYnJlYWt9ZWxzZSBpZihhKXtmb3IoO28+aTtpKyspaWYocj10LmNhbGwoZVtpXSxpLGVbaV0pLHI9PT0hMSlicmVha31lbHNlIGZvcihpIGluIGUpaWYocj10LmNhbGwoZVtpXSxpLGVbaV0pLHI9PT0hMSlicmVhaztyZXR1cm4gZX0sdHJpbTp2JiYhdi5jYWxsKCJcdWZlZmZcdTAwYTAiKT9mdW5jdGlvbihlKXtyZXR1cm4gbnVsbD09ZT8iIjp2LmNhbGwoZSl9OmZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lPyIiOihlKyIiKS5yZXBsYWNlKFQsIiIpfSxtYWtlQXJyYXk6ZnVuY3Rpb24oZSx0KXt2YXIgbj10fHxbXTtyZXR1cm4gbnVsbCE9ZSYmKE0oT2JqZWN0KGUpKT9iLm1lcmdlKG4sInN0cmluZyI9PXR5cGVvZiBlP1tlXTplKTpkLmNhbGwobixlKSksbn0saW5BcnJheTpmdW5jdGlvbihlLHQsbil7dmFyIHI7aWYodCl7aWYoZylyZXR1cm4gZy5jYWxsKHQsZSxuKTtmb3Iocj10Lmxlbmd0aCxuPW4/MD5uP01hdGgubWF4KDAscituKTpuOjA7cj5uO24rKylpZihuIGluIHQmJnRbbl09PT1lKXJldHVybiBufXJldHVybi0xfSxtZXJnZTpmdW5jdGlvbihlLG4pe3ZhciByPW4ubGVuZ3RoLGk9ZS5sZW5ndGgsbz0wO2lmKCJudW1iZXIiPT10eXBlb2Ygcilmb3IoO3I+bztvKyspZVtpKytdPW5bb107ZWxzZSB3aGlsZShuW29dIT09dCllW2krK109bltvKytdO3JldHVybiBlLmxlbmd0aD1pLGV9LGdyZXA6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGk9W10sbz0wLGE9ZS5sZW5ndGg7Zm9yKG49ISFuO2E+bztvKyspcj0hIXQoZVtvXSxvKSxuIT09ciYmaS5wdXNoKGVbb10pO3JldHVybiBpfSxtYXA6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGk9MCxvPWUubGVuZ3RoLGE9TShlKSxzPVtdO2lmKGEpZm9yKDtvPmk7aSsrKXI9dChlW2ldLGksbiksbnVsbCE9ciYmKHNbcy5sZW5ndGhdPXIpO2Vsc2UgZm9yKGkgaW4gZSlyPXQoZVtpXSxpLG4pLG51bGwhPXImJihzW3MubGVuZ3RoXT1yKTtyZXR1cm4gZi5hcHBseShbXSxzKX0sZ3VpZDoxLHByb3h5OmZ1bmN0aW9uKGUsbil7dmFyIHIsaSxvO3JldHVybiJzdHJpbmciPT10eXBlb2YgbiYmKG89ZVtuXSxuPWUsZT1vKSxiLmlzRnVuY3Rpb24oZSk/KHI9aC5jYWxsKGFyZ3VtZW50cywyKSxpPWZ1bmN0aW9uKCl7cmV0dXJuIGUuYXBwbHkobnx8dGhpcyxyLmNvbmNhdChoLmNhbGwoYXJndW1lbnRzKSkpfSxpLmd1aWQ9ZS5ndWlkPWUuZ3VpZHx8Yi5ndWlkKyssaSk6dH0sYWNjZXNzOmZ1bmN0aW9uKGUsbixyLGksbyxhLHMpe3ZhciB1PTAsbD1lLmxlbmd0aCxjPW51bGw9PXI7aWYoIm9iamVjdCI9PT1iLnR5cGUocikpe289ITA7Zm9yKHUgaW4gciliLmFjY2VzcyhlLG4sdSxyW3VdLCEwLGEscyl9ZWxzZSBpZihpIT09dCYmKG89ITAsYi5pc0Z1bmN0aW9uKGkpfHwocz0hMCksYyYmKHM/KG4uY2FsbChlLGkpLG49bnVsbCk6KGM9bixuPWZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gYy5jYWxsKGIoZSksbil9KSksbikpZm9yKDtsPnU7dSsrKW4oZVt1XSxyLHM/aTppLmNhbGwoZVt1XSx1LG4oZVt1XSxyKSkpO3JldHVybiBvP2U6Yz9uLmNhbGwoZSk6bD9uKGVbMF0scik6YX0sbm93OmZ1bmN0aW9uKCl7cmV0dXJuKG5ldyBEYXRlKS5nZXRUaW1lKCl9fSksYi5yZWFkeS5wcm9taXNlPWZ1bmN0aW9uKHQpe2lmKCFuKWlmKG49Yi5EZWZlcnJlZCgpLCJjb21wbGV0ZSI9PT1vLnJlYWR5U3RhdGUpc2V0VGltZW91dChiLnJlYWR5KTtlbHNlIGlmKG8uYWRkRXZlbnRMaXN0ZW5lcilvLmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLEgsITEpLGUuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsSCwhMSk7ZWxzZXtvLmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLEgpLGUuYXR0YWNoRXZlbnQoIm9ubG9hZCIsSCk7dmFyIHI9ITE7dHJ5e3I9bnVsbD09ZS5mcmFtZUVsZW1lbnQmJm8uZG9jdW1lbnRFbGVtZW50fWNhdGNoKGkpe31yJiZyLmRvU2Nyb2xsJiZmdW5jdGlvbiBhKCl7aWYoIWIuaXNSZWFkeSl7dHJ5e3IuZG9TY3JvbGwoImxlZnQiKX1jYXRjaChlKXtyZXR1cm4gc2V0VGltZW91dChhLDUwKX1xKCksYi5yZWFkeSgpfX0oKX1yZXR1cm4gbi5wcm9taXNlKHQpfSxiLmVhY2goIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3IiLnNwbGl0KCIgIiksZnVuY3Rpb24oZSx0KXtsWyJbb2JqZWN0ICIrdCsiXSJdPXQudG9Mb3dlckNhc2UoKX0pO2Z1bmN0aW9uIE0oZSl7dmFyIHQ9ZS5sZW5ndGgsbj1iLnR5cGUoZSk7cmV0dXJuIGIuaXNXaW5kb3coZSk/ITE6MT09PWUubm9kZVR5cGUmJnQ/ITA6ImFycmF5Ij09PW58fCJmdW5jdGlvbiIhPT1uJiYoMD09PXR8fCJudW1iZXIiPT10eXBlb2YgdCYmdD4wJiZ0LTEgaW4gZSl9cj1iKG8pO3ZhciBfPXt9O2Z1bmN0aW9uIEYoZSl7dmFyIHQ9X1tlXT17fTtyZXR1cm4gYi5lYWNoKGUubWF0Y2godyl8fFtdLGZ1bmN0aW9uKGUsbil7dFtuXT0hMH0pLHR9Yi5DYWxsYmFja3M9ZnVuY3Rpb24oZSl7ZT0ic3RyaW5nIj09dHlwZW9mIGU/X1tlXXx8RihlKTpiLmV4dGVuZCh7fSxlKTt2YXIgbixyLGksbyxhLHMsdT1bXSxsPSFlLm9uY2UmJltdLGM9ZnVuY3Rpb24odCl7Zm9yKHI9ZS5tZW1vcnkmJnQsaT0hMCxhPXN8fDAscz0wLG89dS5sZW5ndGgsbj0hMDt1JiZvPmE7YSsrKWlmKHVbYV0uYXBwbHkodFswXSx0WzFdKT09PSExJiZlLnN0b3BPbkZhbHNlKXtyPSExO2JyZWFrfW49ITEsdSYmKGw/bC5sZW5ndGgmJmMobC5zaGlmdCgpKTpyP3U9W106cC5kaXNhYmxlKCkpfSxwPXthZGQ6ZnVuY3Rpb24oKXtpZih1KXt2YXIgdD11Lmxlbmd0aDsoZnVuY3Rpb24gaSh0KXtiLmVhY2godCxmdW5jdGlvbih0LG4pe3ZhciByPWIudHlwZShuKTsiZnVuY3Rpb24iPT09cj9lLnVuaXF1ZSYmcC5oYXMobil8fHUucHVzaChuKTpuJiZuLmxlbmd0aCYmInN0cmluZyIhPT1yJiZpKG4pfSl9KShhcmd1bWVudHMpLG4/bz11Lmxlbmd0aDpyJiYocz10LGMocikpfXJldHVybiB0aGlzfSxyZW1vdmU6ZnVuY3Rpb24oKXtyZXR1cm4gdSYmYi5lYWNoKGFyZ3VtZW50cyxmdW5jdGlvbihlLHQpe3ZhciByO3doaWxlKChyPWIuaW5BcnJheSh0LHUscikpPi0xKXUuc3BsaWNlKHIsMSksbiYmKG8+PXImJm8tLSxhPj1yJiZhLS0pfSksdGhpc30saGFzOmZ1bmN0aW9uKGUpe3JldHVybiBlP2IuaW5BcnJheShlLHUpPi0xOiEoIXV8fCF1Lmxlbmd0aCl9LGVtcHR5OmZ1bmN0aW9uKCl7cmV0dXJuIHU9W10sdGhpc30sZGlzYWJsZTpmdW5jdGlvbigpe3JldHVybiB1PWw9cj10LHRoaXN9LGRpc2FibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIXV9LGxvY2s6ZnVuY3Rpb24oKXtyZXR1cm4gbD10LHJ8fHAuZGlzYWJsZSgpLHRoaXN9LGxvY2tlZDpmdW5jdGlvbigpe3JldHVybiFsfSxmaXJlV2l0aDpmdW5jdGlvbihlLHQpe3JldHVybiB0PXR8fFtdLHQ9W2UsdC5zbGljZT90LnNsaWNlKCk6dF0sIXV8fGkmJiFsfHwobj9sLnB1c2godCk6Yyh0KSksdGhpc30sZmlyZTpmdW5jdGlvbigpe3JldHVybiBwLmZpcmVXaXRoKHRoaXMsYXJndW1lbnRzKSx0aGlzfSxmaXJlZDpmdW5jdGlvbigpe3JldHVybiEhaX19O3JldHVybiBwfSxiLmV4dGVuZCh7RGVmZXJyZWQ6ZnVuY3Rpb24oZSl7dmFyIHQ9W1sicmVzb2x2ZSIsImRvbmUiLGIuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCJyZXNvbHZlZCJdLFsicmVqZWN0IiwiZmFpbCIsYi5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksInJlamVjdGVkIl0sWyJub3RpZnkiLCJwcm9ncmVzcyIsYi5DYWxsYmFja3MoIm1lbW9yeSIpXV0sbj0icGVuZGluZyIscj17c3RhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gbn0sYWx3YXlzOmZ1bmN0aW9uKCl7cmV0dXJuIGkuZG9uZShhcmd1bWVudHMpLmZhaWwoYXJndW1lbnRzKSx0aGlzfSx0aGVuOmZ1bmN0aW9uKCl7dmFyIGU9YXJndW1lbnRzO3JldHVybiBiLkRlZmVycmVkKGZ1bmN0aW9uKG4pe2IuZWFjaCh0LGZ1bmN0aW9uKHQsbyl7dmFyIGE9b1swXSxzPWIuaXNGdW5jdGlvbihlW3RdKSYmZVt0XTtpW29bMV1dKGZ1bmN0aW9uKCl7dmFyIGU9cyYmcy5hcHBseSh0aGlzLGFyZ3VtZW50cyk7ZSYmYi5pc0Z1bmN0aW9uKGUucHJvbWlzZSk/ZS5wcm9taXNlKCkuZG9uZShuLnJlc29sdmUpLmZhaWwobi5yZWplY3QpLnByb2dyZXNzKG4ubm90aWZ5KTpuW2ErIldpdGgiXSh0aGlzPT09cj9uLnByb21pc2UoKTp0aGlzLHM/W2VdOmFyZ3VtZW50cyl9KX0pLGU9bnVsbH0pLnByb21pc2UoKX0scHJvbWlzZTpmdW5jdGlvbihlKXtyZXR1cm4gbnVsbCE9ZT9iLmV4dGVuZChlLHIpOnJ9fSxpPXt9O3JldHVybiByLnBpcGU9ci50aGVuLGIuZWFjaCh0LGZ1bmN0aW9uKGUsbyl7dmFyIGE9b1syXSxzPW9bM107cltvWzFdXT1hLmFkZCxzJiZhLmFkZChmdW5jdGlvbigpe249c30sdFsxXmVdWzJdLmRpc2FibGUsdFsyXVsyXS5sb2NrKSxpW29bMF1dPWZ1bmN0aW9uKCl7cmV0dXJuIGlbb1swXSsiV2l0aCJdKHRoaXM9PT1pP3I6dGhpcyxhcmd1bWVudHMpLHRoaXN9LGlbb1swXSsiV2l0aCJdPWEuZmlyZVdpdGh9KSxyLnByb21pc2UoaSksZSYmZS5jYWxsKGksaSksaX0sd2hlbjpmdW5jdGlvbihlKXt2YXIgdD0wLG49aC5jYWxsKGFyZ3VtZW50cykscj1uLmxlbmd0aCxpPTEhPT1yfHxlJiZiLmlzRnVuY3Rpb24oZS5wcm9taXNlKT9yOjAsbz0xPT09aT9lOmIuRGVmZXJyZWQoKSxhPWZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gZnVuY3Rpb24ocil7dFtlXT10aGlzLG5bZV09YXJndW1lbnRzLmxlbmd0aD4xP2guY2FsbChhcmd1bWVudHMpOnIsbj09PXM/by5ub3RpZnlXaXRoKHQsbik6LS1pfHxvLnJlc29sdmVXaXRoKHQsbil9fSxzLHUsbDtpZihyPjEpZm9yKHM9QXJyYXkociksdT1BcnJheShyKSxsPUFycmF5KHIpO3I+dDt0Kyspblt0XSYmYi5pc0Z1bmN0aW9uKG5bdF0ucHJvbWlzZSk/blt0XS5wcm9taXNlKCkuZG9uZShhKHQsbCxuKSkuZmFpbChvLnJlamVjdCkucHJvZ3Jlc3MoYSh0LHUscykpOi0taTtyZXR1cm4gaXx8by5yZXNvbHZlV2l0aChsLG4pLG8ucHJvbWlzZSgpfX0pLGIuc3VwcG9ydD1mdW5jdGlvbigpe3ZhciB0LG4scixhLHMsdSxsLGMscCxmLGQ9by5jcmVhdGVFbGVtZW50KCJkaXYiKTtpZihkLnNldEF0dHJpYnV0ZSgiY2xhc3NOYW1lIiwidCIpLGQuaW5uZXJIVE1MPSIgIDxsaW5rLz48dGFibGU+PC90YWJsZT48YSBocmVmPScvYSc+YTwvYT48aW5wdXQgdHlwZT0nY2hlY2tib3gnLz4iLG49ZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLHI9ZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYSIpWzBdLCFufHwhcnx8IW4ubGVuZ3RoKXJldHVybnt9O3M9by5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKSxsPXMuYXBwZW5kQ2hpbGQoby5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSksYT1kLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJpbnB1dCIpWzBdLHIuc3R5bGUuY3NzVGV4dD0idG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjUiLHQ9e2dldFNldEF0dHJpYnV0ZToidCIhPT1kLmNsYXNzTmFtZSxsZWFkaW5nV2hpdGVzcGFjZTozPT09ZC5maXJzdENoaWxkLm5vZGVUeXBlLHRib2R5OiFkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0Ym9keSIpLmxlbmd0aCxodG1sU2VyaWFsaXplOiEhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgibGluayIpLmxlbmd0aCxzdHlsZTovdG9wLy50ZXN0KHIuZ2V0QXR0cmlidXRlKCJzdHlsZSIpKSxocmVmTm9ybWFsaXplZDoiL2EiPT09ci5nZXRBdHRyaWJ1dGUoImhyZWYiKSxvcGFjaXR5Oi9eMC41Ly50ZXN0KHIuc3R5bGUub3BhY2l0eSksY3NzRmxvYXQ6ISFyLnN0eWxlLmNzc0Zsb2F0LGNoZWNrT246ISFhLnZhbHVlLG9wdFNlbGVjdGVkOmwuc2VsZWN0ZWQsZW5jdHlwZTohIW8uY3JlYXRlRWxlbWVudCgiZm9ybSIpLmVuY3R5cGUsaHRtbDVDbG9uZToiPDpuYXY+PC86bmF2PiIhPT1vLmNyZWF0ZUVsZW1lbnQoIm5hdiIpLmNsb25lTm9kZSghMCkub3V0ZXJIVE1MLGJveE1vZGVsOiJDU1MxQ29tcGF0Ij09PW8uY29tcGF0TW9kZSxkZWxldGVFeHBhbmRvOiEwLG5vQ2xvbmVFdmVudDohMCxpbmxpbmVCbG9ja05lZWRzTGF5b3V0OiExLHNocmlua1dyYXBCbG9ja3M6ITEscmVsaWFibGVNYXJnaW5SaWdodDohMCxib3hTaXppbmdSZWxpYWJsZTohMCxwaXhlbFBvc2l0aW9uOiExfSxhLmNoZWNrZWQ9ITAsdC5ub0Nsb25lQ2hlY2tlZD1hLmNsb25lTm9kZSghMCkuY2hlY2tlZCxzLmRpc2FibGVkPSEwLHQub3B0RGlzYWJsZWQ9IWwuZGlzYWJsZWQ7dHJ5e2RlbGV0ZSBkLnRlc3R9Y2F0Y2goaCl7dC5kZWxldGVFeHBhbmRvPSExfWE9by5jcmVhdGVFbGVtZW50KCJpbnB1dCIpLGEuc2V0QXR0cmlidXRlKCJ2YWx1ZSIsIiIpLHQuaW5wdXQ9IiI9PT1hLmdldEF0dHJpYnV0ZSgidmFsdWUiKSxhLnZhbHVlPSJ0IixhLnNldEF0dHJpYnV0ZSgidHlwZSIsInJhZGlvIiksdC5yYWRpb1ZhbHVlPSJ0Ij09PWEudmFsdWUsYS5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCJ0IiksYS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCJ0IiksdT1vLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSx1LmFwcGVuZENoaWxkKGEpLHQuYXBwZW5kQ2hlY2tlZD1hLmNoZWNrZWQsdC5jaGVja0Nsb25lPXUuY2xvbmVOb2RlKCEwKS5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5jaGVja2VkLGQuYXR0YWNoRXZlbnQmJihkLmF0dGFjaEV2ZW50KCJvbmNsaWNrIixmdW5jdGlvbigpe3Qubm9DbG9uZUV2ZW50PSExfSksZC5jbG9uZU5vZGUoITApLmNsaWNrKCkpO2ZvcihmIGlue3N1Ym1pdDohMCxjaGFuZ2U6ITAsZm9jdXNpbjohMH0pZC5zZXRBdHRyaWJ1dGUoYz0ib24iK2YsInQiKSx0W2YrIkJ1YmJsZXMiXT1jIGluIGV8fGQuYXR0cmlidXRlc1tjXS5leHBhbmRvPT09ITE7cmV0dXJuIGQuc3R5bGUuYmFja2dyb3VuZENsaXA9ImNvbnRlbnQtYm94IixkLmNsb25lTm9kZSghMCkuc3R5bGUuYmFja2dyb3VuZENsaXA9IiIsdC5jbGVhckNsb25lU3R5bGU9ImNvbnRlbnQtYm94Ij09PWQuc3R5bGUuYmFja2dyb3VuZENsaXAsYihmdW5jdGlvbigpe3ZhciBuLHIsYSxzPSJwYWRkaW5nOjA7bWFyZ2luOjA7Ym9yZGVyOjA7ZGlzcGxheTpibG9jaztib3gtc2l6aW5nOmNvbnRlbnQtYm94Oy1tb3otYm94LXNpemluZzpjb250ZW50LWJveDstd2Via2l0LWJveC1zaXppbmc6Y29udGVudC1ib3g7Iix1PW8uZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTt1JiYobj1vLmNyZWF0ZUVsZW1lbnQoImRpdiIpLG4uc3R5bGUuY3NzVGV4dD0iYm9yZGVyOjA7d2lkdGg6MDtoZWlnaHQ6MDtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0Oi05OTk5cHg7bWFyZ2luLXRvcDoxcHgiLHUuYXBwZW5kQ2hpbGQobikuYXBwZW5kQ2hpbGQoZCksZC5pbm5lckhUTUw9Ijx0YWJsZT48dHI+PHRkPjwvdGQ+PHRkPnQ8L3RkPjwvdHI+PC90YWJsZT4iLGE9ZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGQiKSxhWzBdLnN0eWxlLmNzc1RleHQ9InBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6MDtkaXNwbGF5Om5vbmUiLHA9MD09PWFbMF0ub2Zmc2V0SGVpZ2h0LGFbMF0uc3R5bGUuZGlzcGxheT0iIixhWzFdLnN0eWxlLmRpc3BsYXk9Im5vbmUiLHQucmVsaWFibGVIaWRkZW5PZmZzZXRzPXAmJjA9PT1hWzBdLm9mZnNldEhlaWdodCxkLmlubmVySFRNTD0iIixkLnN0eWxlLmNzc1RleHQ9ImJveC1zaXppbmc6Ym9yZGVyLWJveDstbW96LWJveC1zaXppbmc6Ym9yZGVyLWJveDstd2Via2l0LWJveC1zaXppbmc6Ym9yZGVyLWJveDtwYWRkaW5nOjFweDtib3JkZXI6MXB4O2Rpc3BsYXk6YmxvY2s7d2lkdGg6NHB4O21hcmdpbi10b3A6MSU7cG9zaXRpb246YWJzb2x1dGU7dG9wOjElOyIsdC5ib3hTaXppbmc9ND09PWQub2Zmc2V0V2lkdGgsdC5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldD0xIT09dS5vZmZzZXRUb3AsZS5nZXRDb21wdXRlZFN0eWxlJiYodC5waXhlbFBvc2l0aW9uPSIxJSIhPT0oZS5nZXRDb21wdXRlZFN0eWxlKGQsbnVsbCl8fHt9KS50b3AsdC5ib3hTaXppbmdSZWxpYWJsZT0iNHB4Ij09PShlLmdldENvbXB1dGVkU3R5bGUoZCxudWxsKXx8e3dpZHRoOiI0cHgifSkud2lkdGgscj1kLmFwcGVuZENoaWxkKG8uY3JlYXRlRWxlbWVudCgiZGl2IikpLHIuc3R5bGUuY3NzVGV4dD1kLnN0eWxlLmNzc1RleHQ9cyxyLnN0eWxlLm1hcmdpblJpZ2h0PXIuc3R5bGUud2lkdGg9IjAiLGQuc3R5bGUud2lkdGg9IjFweCIsdC5yZWxpYWJsZU1hcmdpblJpZ2h0PSFwYXJzZUZsb2F0KChlLmdldENvbXB1dGVkU3R5bGUocixudWxsKXx8e30pLm1hcmdpblJpZ2h0KSksdHlwZW9mIGQuc3R5bGUuem9vbSE9PWkmJihkLmlubmVySFRNTD0iIixkLnN0eWxlLmNzc1RleHQ9cysid2lkdGg6MXB4O3BhZGRpbmc6MXB4O2Rpc3BsYXk6aW5saW5lO3pvb206MSIsdC5pbmxpbmVCbG9ja05lZWRzTGF5b3V0PTM9PT1kLm9mZnNldFdpZHRoLGQuc3R5bGUuZGlzcGxheT0iYmxvY2siLGQuaW5uZXJIVE1MPSI8ZGl2PjwvZGl2PiIsZC5maXJzdENoaWxkLnN0eWxlLndpZHRoPSI1cHgiLHQuc2hyaW5rV3JhcEJsb2Nrcz0zIT09ZC5vZmZzZXRXaWR0aCx0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQmJih1LnN0eWxlLnpvb209MSkpLHUucmVtb3ZlQ2hpbGQobiksbj1kPWE9cj1udWxsKX0pLG49cz11PWw9cj1hPW51bGwsdH0oKTt2YXIgTz0vKD86XHtbXHNcU10qXH18XFtbXHNcU10qXF0pJC8sQj0vKFtBLVpdKS9nO2Z1bmN0aW9uIFAoZSxuLHIsaSl7aWYoYi5hY2NlcHREYXRhKGUpKXt2YXIgbyxhLHM9Yi5leHBhbmRvLHU9InN0cmluZyI9PXR5cGVvZiBuLGw9ZS5ub2RlVHlwZSxwPWw/Yi5jYWNoZTplLGY9bD9lW3NdOmVbc10mJnM7aWYoZiYmcFtmXSYmKGl8fHBbZl0uZGF0YSl8fCF1fHxyIT09dClyZXR1cm4gZnx8KGw/ZVtzXT1mPWMucG9wKCl8fGIuZ3VpZCsrOmY9cykscFtmXXx8KHBbZl09e30sbHx8KHBbZl0udG9KU09OPWIubm9vcCkpLCgib2JqZWN0Ij09dHlwZW9mIG58fCJmdW5jdGlvbiI9PXR5cGVvZiBuKSYmKGk/cFtmXT1iLmV4dGVuZChwW2ZdLG4pOnBbZl0uZGF0YT1iLmV4dGVuZChwW2ZdLmRhdGEsbikpLG89cFtmXSxpfHwoby5kYXRhfHwoby5kYXRhPXt9KSxvPW8uZGF0YSksciE9PXQmJihvW2IuY2FtZWxDYXNlKG4pXT1yKSx1PyhhPW9bbl0sbnVsbD09YSYmKGE9b1tiLmNhbWVsQ2FzZShuKV0pKTphPW8sYX19ZnVuY3Rpb24gUihlLHQsbil7aWYoYi5hY2NlcHREYXRhKGUpKXt2YXIgcixpLG8sYT1lLm5vZGVUeXBlLHM9YT9iLmNhY2hlOmUsdT1hP2VbYi5leHBhbmRvXTpiLmV4cGFuZG87aWYoc1t1XSl7aWYodCYmKG89bj9zW3VdOnNbdV0uZGF0YSkpe2IuaXNBcnJheSh0KT90PXQuY29uY2F0KGIubWFwKHQsYi5jYW1lbENhc2UpKTp0IGluIG8/dD1bdF06KHQ9Yi5jYW1lbENhc2UodCksdD10IGluIG8/W3RdOnQuc3BsaXQoIiAiKSk7Zm9yKHI9MCxpPXQubGVuZ3RoO2k+cjtyKyspZGVsZXRlIG9bdFtyXV07aWYoIShuPyQ6Yi5pc0VtcHR5T2JqZWN0KShvKSlyZXR1cm59KG58fChkZWxldGUgc1t1XS5kYXRhLCQoc1t1XSkpKSYmKGE/Yi5jbGVhbkRhdGEoW2VdLCEwKTpiLnN1cHBvcnQuZGVsZXRlRXhwYW5kb3x8cyE9cy53aW5kb3c/ZGVsZXRlIHNbdV06c1t1XT1udWxsKX19fWIuZXh0ZW5kKHtjYWNoZTp7fSxleHBhbmRvOiJqUXVlcnkiKyhwK01hdGgucmFuZG9tKCkpLnJlcGxhY2UoL1xEL2csIiIpLG5vRGF0YTp7ZW1iZWQ6ITAsb2JqZWN0OiJjbHNpZDpEMjdDREI2RS1BRTZELTExY2YtOTZCOC00NDQ1NTM1NDAwMDAiLGFwcGxldDohMH0saGFzRGF0YTpmdW5jdGlvbihlKXtyZXR1cm4gZT1lLm5vZGVUeXBlP2IuY2FjaGVbZVtiLmV4cGFuZG9dXTplW2IuZXhwYW5kb10sISFlJiYhJChlKX0sZGF0YTpmdW5jdGlvbihlLHQsbil7cmV0dXJuIFAoZSx0LG4pfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIFIoZSx0KX0sX2RhdGE6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBQKGUsdCxuLCEwKX0sX3JlbW92ZURhdGE6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gUihlLHQsITApfSxhY2NlcHREYXRhOmZ1bmN0aW9uKGUpe2lmKGUubm9kZVR5cGUmJjEhPT1lLm5vZGVUeXBlJiY5IT09ZS5ub2RlVHlwZSlyZXR1cm4hMTt2YXIgdD1lLm5vZGVOYW1lJiZiLm5vRGF0YVtlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldO3JldHVybiF0fHx0IT09ITAmJmUuZ2V0QXR0cmlidXRlKCJjbGFzc2lkIik9PT10fX0pLGIuZm4uZXh0ZW5kKHtkYXRhOmZ1bmN0aW9uKGUsbil7dmFyIHIsaSxvPXRoaXNbMF0sYT0wLHM9bnVsbDtpZihlPT09dCl7aWYodGhpcy5sZW5ndGgmJihzPWIuZGF0YShvKSwxPT09by5ub2RlVHlwZSYmIWIuX2RhdGEobywicGFyc2VkQXR0cnMiKSkpe2ZvcihyPW8uYXR0cmlidXRlcztyLmxlbmd0aD5hO2ErKylpPXJbYV0ubmFtZSxpLmluZGV4T2YoImRhdGEtIil8fChpPWIuY2FtZWxDYXNlKGkuc2xpY2UoNSkpLFcobyxpLHNbaV0pKTtiLl9kYXRhKG8sInBhcnNlZEF0dHJzIiwhMCl9cmV0dXJuIHN9cmV0dXJuIm9iamVjdCI9PXR5cGVvZiBlP3RoaXMuZWFjaChmdW5jdGlvbigpe2IuZGF0YSh0aGlzLGUpfSk6Yi5hY2Nlc3ModGhpcyxmdW5jdGlvbihuKXtyZXR1cm4gbj09PXQ/bz9XKG8sZSxiLmRhdGEobyxlKSk6bnVsbDoodGhpcy5lYWNoKGZ1bmN0aW9uKCl7Yi5kYXRhKHRoaXMsZSxuKX0pLHQpfSxudWxsLG4sYXJndW1lbnRzLmxlbmd0aD4xLG51bGwsITApfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtiLnJlbW92ZURhdGEodGhpcyxlKX0pfX0pO2Z1bmN0aW9uIFcoZSxuLHIpe2lmKHI9PT10JiYxPT09ZS5ub2RlVHlwZSl7dmFyIGk9ImRhdGEtIituLnJlcGxhY2UoQiwiLSQxIikudG9Mb3dlckNhc2UoKTtpZihyPWUuZ2V0QXR0cmlidXRlKGkpLCJzdHJpbmciPT10eXBlb2Ygcil7dHJ5e3I9InRydWUiPT09cj8hMDoiZmFsc2UiPT09cj8hMToibnVsbCI9PT1yP251bGw6K3IrIiI9PT1yPytyOk8udGVzdChyKT9iLnBhcnNlSlNPTihyKTpyfWNhdGNoKG8pe31iLmRhdGEoZSxuLHIpfWVsc2Ugcj10fXJldHVybiByfWZ1bmN0aW9uICQoZSl7dmFyIHQ7Zm9yKHQgaW4gZSlpZigoImRhdGEiIT09dHx8IWIuaXNFbXB0eU9iamVjdChlW3RdKSkmJiJ0b0pTT04iIT09dClyZXR1cm4hMTtyZXR1cm4hMH1iLmV4dGVuZCh7cXVldWU6ZnVuY3Rpb24oZSxuLHIpe3ZhciBpO3JldHVybiBlPyhuPShufHwiZngiKSsicXVldWUiLGk9Yi5fZGF0YShlLG4pLHImJighaXx8Yi5pc0FycmF5KHIpP2k9Yi5fZGF0YShlLG4sYi5tYWtlQXJyYXkocikpOmkucHVzaChyKSksaXx8W10pOnR9LGRlcXVldWU6ZnVuY3Rpb24oZSx0KXt0PXR8fCJmeCI7dmFyIG49Yi5xdWV1ZShlLHQpLHI9bi5sZW5ndGgsaT1uLnNoaWZ0KCksbz1iLl9xdWV1ZUhvb2tzKGUsdCksYT1mdW5jdGlvbigpe2IuZGVxdWV1ZShlLHQpfTsiaW5wcm9ncmVzcyI9PT1pJiYoaT1uLnNoaWZ0KCksci0tKSxvLmN1cj1pLGkmJigiZngiPT09dCYmbi51bnNoaWZ0KCJpbnByb2dyZXNzIiksZGVsZXRlIG8uc3RvcCxpLmNhbGwoZSxhLG8pKSwhciYmbyYmby5lbXB0eS5maXJlKCl9LF9xdWV1ZUhvb2tzOmZ1bmN0aW9uKGUsdCl7dmFyIG49dCsicXVldWVIb29rcyI7cmV0dXJuIGIuX2RhdGEoZSxuKXx8Yi5fZGF0YShlLG4se2VtcHR5OmIuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLmFkZChmdW5jdGlvbigpe2IuX3JlbW92ZURhdGEoZSx0KyJxdWV1ZSIpLGIuX3JlbW92ZURhdGEoZSxuKX0pfSl9fSksYi5mbi5leHRlbmQoe3F1ZXVlOmZ1bmN0aW9uKGUsbil7dmFyIHI9MjtyZXR1cm4ic3RyaW5nIiE9dHlwZW9mIGUmJihuPWUsZT0iZngiLHItLSkscj5hcmd1bWVudHMubGVuZ3RoP2IucXVldWUodGhpc1swXSxlKTpuPT09dD90aGlzOnRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciB0PWIucXVldWUodGhpcyxlLG4pO2IuX3F1ZXVlSG9va3ModGhpcyxlKSwiZngiPT09ZSYmImlucHJvZ3Jlc3MiIT09dFswXSYmYi5kZXF1ZXVlKHRoaXMsZSl9KX0sZGVxdWV1ZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Yi5kZXF1ZXVlKHRoaXMsZSl9KX0sZGVsYXk6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZT1iLmZ4P2IuZnguc3BlZWRzW2VdfHxlOmUsdD10fHwiZngiLHRoaXMucXVldWUodCxmdW5jdGlvbih0LG4pe3ZhciByPXNldFRpbWVvdXQodCxlKTtuLnN0b3A9ZnVuY3Rpb24oKXtjbGVhclRpbWVvdXQocil9fSl9LGNsZWFyUXVldWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucXVldWUoZXx8ImZ4IixbXSl9LHByb21pc2U6ZnVuY3Rpb24oZSxuKXt2YXIgcixpPTEsbz1iLkRlZmVycmVkKCksYT10aGlzLHM9dGhpcy5sZW5ndGgsdT1mdW5jdGlvbigpey0taXx8by5yZXNvbHZlV2l0aChhLFthXSl9OyJzdHJpbmciIT10eXBlb2YgZSYmKG49ZSxlPXQpLGU9ZXx8ImZ4Ijt3aGlsZShzLS0pcj1iLl9kYXRhKGFbc10sZSsicXVldWVIb29rcyIpLHImJnIuZW1wdHkmJihpKyssci5lbXB0eS5hZGQodSkpO3JldHVybiB1KCksby5wcm9taXNlKG4pfX0pO3ZhciBJLHosWD0vW1x0XHJcbl0vZyxVPS9cci9nLFY9L14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdCkkL2ksWT0vXig/OmF8YXJlYSkkL2ksSj0vXig/OmNoZWNrZWR8c2VsZWN0ZWR8YXV0b2ZvY3VzfGF1dG9wbGF5fGFzeW5jfGNvbnRyb2xzfGRlZmVyfGRpc2FibGVkfGhpZGRlbnxsb29wfG11bHRpcGxlfG9wZW58cmVhZG9ubHl8cmVxdWlyZWR8c2NvcGVkKSQvaSxHPS9eKD86Y2hlY2tlZHxzZWxlY3RlZCkkL2ksUT1iLnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlLEs9Yi5zdXBwb3J0LmlucHV0O2IuZm4uZXh0ZW5kKHthdHRyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGIuYWNjZXNzKHRoaXMsYi5hdHRyLGUsdCxhcmd1bWVudHMubGVuZ3RoPjEpfSxyZW1vdmVBdHRyOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtiLnJlbW92ZUF0dHIodGhpcyxlKX0pfSxwcm9wOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGIuYWNjZXNzKHRoaXMsYi5wcm9wLGUsdCxhcmd1bWVudHMubGVuZ3RoPjEpfSxyZW1vdmVQcm9wOmZ1bmN0aW9uKGUpe3JldHVybiBlPWIucHJvcEZpeFtlXXx8ZSx0aGlzLmVhY2goZnVuY3Rpb24oKXt0cnl7dGhpc1tlXT10LGRlbGV0ZSB0aGlzW2VdfWNhdGNoKG4pe319KX0sYWRkQ2xhc3M6ZnVuY3Rpb24oZSl7dmFyIHQsbixyLGksbyxhPTAscz10aGlzLmxlbmd0aCx1PSJzdHJpbmciPT10eXBlb2YgZSYmZTtpZihiLmlzRnVuY3Rpb24oZSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbih0KXtiKHRoaXMpLmFkZENsYXNzKGUuY2FsbCh0aGlzLHQsdGhpcy5jbGFzc05hbWUpKX0pO2lmKHUpZm9yKHQ9KGV8fCIiKS5tYXRjaCh3KXx8W107cz5hO2ErKylpZihuPXRoaXNbYV0scj0xPT09bi5ub2RlVHlwZSYmKG4uY2xhc3NOYW1lPygiICIrbi5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKFgsIiAiKToiICIpKXtvPTA7d2hpbGUoaT10W28rK10pMD5yLmluZGV4T2YoIiAiK2krIiAiKSYmKHIrPWkrIiAiKTtuLmNsYXNzTmFtZT1iLnRyaW0ocil9cmV0dXJuIHRoaXN9LHJlbW92ZUNsYXNzOmZ1bmN0aW9uKGUpe3ZhciB0LG4scixpLG8sYT0wLHM9dGhpcy5sZW5ndGgsdT0wPT09YXJndW1lbnRzLmxlbmd0aHx8InN0cmluZyI9PXR5cGVvZiBlJiZlO2lmKGIuaXNGdW5jdGlvbihlKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKHQpe2IodGhpcykucmVtb3ZlQ2xhc3MoZS5jYWxsKHRoaXMsdCx0aGlzLmNsYXNzTmFtZSkpfSk7aWYodSlmb3IodD0oZXx8IiIpLm1hdGNoKHcpfHxbXTtzPmE7YSsrKWlmKG49dGhpc1thXSxyPTE9PT1uLm5vZGVUeXBlJiYobi5jbGFzc05hbWU/KCIgIituLmNsYXNzTmFtZSsiICIpLnJlcGxhY2UoWCwiICIpOiIiKSl7bz0wO3doaWxlKGk9dFtvKytdKXdoaWxlKHIuaW5kZXhPZigiICIraSsiICIpPj0wKXI9ci5yZXBsYWNlKCIgIitpKyIgIiwiICIpO24uY2xhc3NOYW1lPWU/Yi50cmltKHIpOiIifXJldHVybiB0aGlzfSx0b2dnbGVDbGFzczpmdW5jdGlvbihlLHQpe3ZhciBuPXR5cGVvZiBlLHI9ImJvb2xlYW4iPT10eXBlb2YgdDtyZXR1cm4gYi5pc0Z1bmN0aW9uKGUpP3RoaXMuZWFjaChmdW5jdGlvbihuKXtiKHRoaXMpLnRvZ2dsZUNsYXNzKGUuY2FsbCh0aGlzLG4sdGhpcy5jbGFzc05hbWUsdCksdCl9KTp0aGlzLmVhY2goZnVuY3Rpb24oKXtpZigic3RyaW5nIj09PW4pe3ZhciBvLGE9MCxzPWIodGhpcyksdT10LGw9ZS5tYXRjaCh3KXx8W107d2hpbGUobz1sW2ErK10pdT1yP3U6IXMuaGFzQ2xhc3Mobyksc1t1PyJhZGRDbGFzcyI6InJlbW92ZUNsYXNzIl0obyl9ZWxzZShuPT09aXx8ImJvb2xlYW4iPT09bikmJih0aGlzLmNsYXNzTmFtZSYmYi5fZGF0YSh0aGlzLCJfX2NsYXNzTmFtZV9fIix0aGlzLmNsYXNzTmFtZSksdGhpcy5jbGFzc05hbWU9dGhpcy5jbGFzc05hbWV8fGU9PT0hMT8iIjpiLl9kYXRhKHRoaXMsIl9fY2xhc3NOYW1lX18iKXx8IiIpfSl9LGhhc0NsYXNzOmZ1bmN0aW9uKGUpe3ZhciB0PSIgIitlKyIgIixuPTAscj10aGlzLmxlbmd0aDtmb3IoO3I+bjtuKyspaWYoMT09PXRoaXNbbl0ubm9kZVR5cGUmJigiICIrdGhpc1tuXS5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKFgsIiAiKS5pbmRleE9mKHQpPj0wKXJldHVybiEwO3JldHVybiExfSx2YWw6ZnVuY3Rpb24oZSl7dmFyIG4scixpLG89dGhpc1swXTt7aWYoYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gaT1iLmlzRnVuY3Rpb24oZSksdGhpcy5lYWNoKGZ1bmN0aW9uKG4pe3ZhciBvLGE9Yih0aGlzKTsxPT09dGhpcy5ub2RlVHlwZSYmKG89aT9lLmNhbGwodGhpcyxuLGEudmFsKCkpOmUsbnVsbD09bz9vPSIiOiJudW1iZXIiPT10eXBlb2Ygbz9vKz0iIjpiLmlzQXJyYXkobykmJihvPWIubWFwKG8sZnVuY3Rpb24oZSl7cmV0dXJuIG51bGw9PWU/IiI6ZSsiIn0pKSxyPWIudmFsSG9va3NbdGhpcy50eXBlXXx8Yi52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldLHImJiJzZXQiaW4gciYmci5zZXQodGhpcyxvLCJ2YWx1ZSIpIT09dHx8KHRoaXMudmFsdWU9bykpfSk7aWYobylyZXR1cm4gcj1iLnZhbEhvb2tzW28udHlwZV18fGIudmFsSG9va3Nbby5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSxyJiYiZ2V0ImluIHImJihuPXIuZ2V0KG8sInZhbHVlIikpIT09dD9uOihuPW8udmFsdWUsInN0cmluZyI9PXR5cGVvZiBuP24ucmVwbGFjZShVLCIiKTpudWxsPT1uPyIiOm4pfX19KSxiLmV4dGVuZCh7dmFsSG9va3M6e29wdGlvbjp7Z2V0OmZ1bmN0aW9uKGUpe3ZhciB0PWUuYXR0cmlidXRlcy52YWx1ZTtyZXR1cm4hdHx8dC5zcGVjaWZpZWQ/ZS52YWx1ZTplLnRleHR9fSxzZWxlY3Q6e2dldDpmdW5jdGlvbihlKXt2YXIgdCxuLHI9ZS5vcHRpb25zLGk9ZS5zZWxlY3RlZEluZGV4LG89InNlbGVjdC1vbmUiPT09ZS50eXBlfHwwPmksYT1vP251bGw6W10scz1vP2krMTpyLmxlbmd0aCx1PTA+aT9zOm8/aTowO2Zvcig7cz51O3UrKylpZihuPXJbdV0sISghbi5zZWxlY3RlZCYmdSE9PWl8fChiLnN1cHBvcnQub3B0RGlzYWJsZWQ/bi5kaXNhYmxlZDpudWxsIT09bi5nZXRBdHRyaWJ1dGUoImRpc2FibGVkIikpfHxuLnBhcmVudE5vZGUuZGlzYWJsZWQmJmIubm9kZU5hbWUobi5wYXJlbnROb2RlLCJvcHRncm91cCIpKSl7aWYodD1iKG4pLnZhbCgpLG8pcmV0dXJuIHQ7YS5wdXNoKHQpfXJldHVybiBhfSxzZXQ6ZnVuY3Rpb24oZSx0KXt2YXIgbj1iLm1ha2VBcnJheSh0KTtyZXR1cm4gYihlKS5maW5kKCJvcHRpb24iKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5zZWxlY3RlZD1iLmluQXJyYXkoYih0aGlzKS52YWwoKSxuKT49MH0pLG4ubGVuZ3RofHwoZS5zZWxlY3RlZEluZGV4PS0xKSxufX19LGF0dHI6ZnVuY3Rpb24oZSxuLHIpe3ZhciBvLGEscyx1PWUubm9kZVR5cGU7aWYoZSYmMyE9PXUmJjghPT11JiYyIT09dSlyZXR1cm4gdHlwZW9mIGUuZ2V0QXR0cmlidXRlPT09aT9iLnByb3AoZSxuLHIpOihhPTEhPT11fHwhYi5pc1hNTERvYyhlKSxhJiYobj1uLnRvTG93ZXJDYXNlKCksbz1iLmF0dHJIb29rc1tuXXx8KEoudGVzdChuKT96OkkpKSxyPT09dD9vJiZhJiYiZ2V0ImluIG8mJm51bGwhPT0ocz1vLmdldChlLG4pKT9zOih0eXBlb2YgZS5nZXRBdHRyaWJ1dGUhPT1pJiYocz1lLmdldEF0dHJpYnV0ZShuKSksbnVsbD09cz90OnMpOm51bGwhPT1yP28mJmEmJiJzZXQiaW4gbyYmKHM9by5zZXQoZSxyLG4pKSE9PXQ/czooZS5zZXRBdHRyaWJ1dGUobixyKyIiKSxyKTooYi5yZW1vdmVBdHRyKGUsbiksdCkpfSxyZW1vdmVBdHRyOmZ1bmN0aW9uKGUsdCl7dmFyIG4scixpPTAsbz10JiZ0Lm1hdGNoKHcpO2lmKG8mJjE9PT1lLm5vZGVUeXBlKXdoaWxlKG49b1tpKytdKXI9Yi5wcm9wRml4W25dfHxuLEoudGVzdChuKT8hUSYmRy50ZXN0KG4pP2VbYi5jYW1lbENhc2UoImRlZmF1bHQtIituKV09ZVtyXT0hMTplW3JdPSExOmIuYXR0cihlLG4sIiIpLGUucmVtb3ZlQXR0cmlidXRlKFE/bjpyKX0sYXR0ckhvb2tzOnt0eXBlOntzZXQ6ZnVuY3Rpb24oZSx0KXtpZighYi5zdXBwb3J0LnJhZGlvVmFsdWUmJiJyYWRpbyI9PT10JiZiLm5vZGVOYW1lKGUsImlucHV0Iikpe3ZhciBuPWUudmFsdWU7cmV0dXJuIGUuc2V0QXR0cmlidXRlKCJ0eXBlIix0KSxuJiYoZS52YWx1ZT1uKSx0fX19fSxwcm9wRml4Ont0YWJpbmRleDoidGFiSW5kZXgiLHJlYWRvbmx5OiJyZWFkT25seSIsImZvciI6Imh0bWxGb3IiLCJjbGFzcyI6ImNsYXNzTmFtZSIsbWF4bGVuZ3RoOiJtYXhMZW5ndGgiLGNlbGxzcGFjaW5nOiJjZWxsU3BhY2luZyIsY2VsbHBhZGRpbmc6ImNlbGxQYWRkaW5nIixyb3dzcGFuOiJyb3dTcGFuIixjb2xzcGFuOiJjb2xTcGFuIix1c2VtYXA6InVzZU1hcCIsZnJhbWVib3JkZXI6ImZyYW1lQm9yZGVyIixjb250ZW50ZWRpdGFibGU6ImNvbnRlbnRFZGl0YWJsZSJ9LHByb3A6ZnVuY3Rpb24oZSxuLHIpe3ZhciBpLG8sYSxzPWUubm9kZVR5cGU7aWYoZSYmMyE9PXMmJjghPT1zJiYyIT09cylyZXR1cm4gYT0xIT09c3x8IWIuaXNYTUxEb2MoZSksYSYmKG49Yi5wcm9wRml4W25dfHxuLG89Yi5wcm9wSG9va3Nbbl0pLHIhPT10P28mJiJzZXQiaW4gbyYmKGk9by5zZXQoZSxyLG4pKSE9PXQ/aTplW25dPXI6byYmImdldCJpbiBvJiZudWxsIT09KGk9by5nZXQoZSxuKSk/aTplW25dfSxwcm9wSG9va3M6e3RhYkluZGV4OntnZXQ6ZnVuY3Rpb24oZSl7dmFyIG49ZS5nZXRBdHRyaWJ1dGVOb2RlKCJ0YWJpbmRleCIpO3JldHVybiBuJiZuLnNwZWNpZmllZD9wYXJzZUludChuLnZhbHVlLDEwKTpWLnRlc3QoZS5ub2RlTmFtZSl8fFkudGVzdChlLm5vZGVOYW1lKSYmZS5ocmVmPzA6dH19fX0pLHo9e2dldDpmdW5jdGlvbihlLG4pe3ZhciByPWIucHJvcChlLG4pLGk9ImJvb2xlYW4iPT10eXBlb2YgciYmZS5nZXRBdHRyaWJ1dGUobiksbz0iYm9vbGVhbiI9PXR5cGVvZiByP0smJlE/bnVsbCE9aTpHLnRlc3Qobik/ZVtiLmNhbWVsQ2FzZSgiZGVmYXVsdC0iK24pXTohIWk6ZS5nZXRBdHRyaWJ1dGVOb2RlKG4pO3JldHVybiBvJiZvLnZhbHVlIT09ITE/bi50b0xvd2VyQ2FzZSgpOnR9LHNldDpmdW5jdGlvbihlLHQsbil7cmV0dXJuIHQ9PT0hMT9iLnJlbW92ZUF0dHIoZSxuKTpLJiZRfHwhRy50ZXN0KG4pP2Uuc2V0QXR0cmlidXRlKCFRJiZiLnByb3BGaXhbbl18fG4sbik6ZVtiLmNhbWVsQ2FzZSgiZGVmYXVsdC0iK24pXT1lW25dPSEwLG59fSxLJiZRfHwoYi5hdHRySG9va3MudmFsdWU9e2dldDpmdW5jdGlvbihlLG4pe3ZhciByPWUuZ2V0QXR0cmlidXRlTm9kZShuKTtyZXR1cm4gYi5ub2RlTmFtZShlLCJpbnB1dCIpP2UuZGVmYXVsdFZhbHVlOnImJnIuc3BlY2lmaWVkP3IudmFsdWU6dH0sc2V0OmZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gYi5ub2RlTmFtZShlLCJpbnB1dCIpPyhlLmRlZmF1bHRWYWx1ZT1uLHQpOkkmJkkuc2V0KGUsbixyKX19KSxRfHwoST1iLnZhbEhvb2tzLmJ1dHRvbj17Z2V0OmZ1bmN0aW9uKGUsbil7dmFyIHI9ZS5nZXRBdHRyaWJ1dGVOb2RlKG4pO3JldHVybiByJiYoImlkIj09PW58fCJuYW1lIj09PW58fCJjb29yZHMiPT09bj8iIiE9PXIudmFsdWU6ci5zcGVjaWZpZWQpP3IudmFsdWU6dH0sc2V0OmZ1bmN0aW9uKGUsbixyKXt2YXIgaT1lLmdldEF0dHJpYnV0ZU5vZGUocik7cmV0dXJuIGl8fGUuc2V0QXR0cmlidXRlTm9kZShpPWUub3duZXJEb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUocikpLGkudmFsdWU9bis9IiIsInZhbHVlIj09PXJ8fG49PT1lLmdldEF0dHJpYnV0ZShyKT9uOnR9fSxiLmF0dHJIb29rcy5jb250ZW50ZWRpdGFibGU9e2dldDpJLmdldCxzZXQ6ZnVuY3Rpb24oZSx0LG4pe0kuc2V0KGUsIiI9PT10PyExOnQsbil9fSxiLmVhY2goWyJ3aWR0aCIsImhlaWdodCJdLGZ1bmN0aW9uKGUsbil7Yi5hdHRySG9va3Nbbl09Yi5leHRlbmQoYi5hdHRySG9va3Nbbl0se3NldDpmdW5jdGlvbihlLHIpe3JldHVybiIiPT09cj8oZS5zZXRBdHRyaWJ1dGUobiwiYXV0byIpLHIpOnR9fSl9KSksYi5zdXBwb3J0LmhyZWZOb3JtYWxpemVkfHwoYi5lYWNoKFsiaHJlZiIsInNyYyIsIndpZHRoIiwiaGVpZ2h0Il0sZnVuY3Rpb24oZSxuKXtiLmF0dHJIb29rc1tuXT1iLmV4dGVuZChiLmF0dHJIb29rc1tuXSx7Z2V0OmZ1bmN0aW9uKGUpe3ZhciByPWUuZ2V0QXR0cmlidXRlKG4sMik7cmV0dXJuIG51bGw9PXI/dDpyfX0pfSksYi5lYWNoKFsiaHJlZiIsInNyYyJdLGZ1bmN0aW9uKGUsdCl7Yi5wcm9wSG9va3NbdF09e2dldDpmdW5jdGlvbihlKXtyZXR1cm4gZS5nZXRBdHRyaWJ1dGUodCw0KX19fSkpLGIuc3VwcG9ydC5zdHlsZXx8KGIuYXR0ckhvb2tzLnN0eWxlPXtnZXQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuc3R5bGUuY3NzVGV4dHx8dH0sc2V0OmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUuc3R5bGUuY3NzVGV4dD10KyIifX0pLGIuc3VwcG9ydC5vcHRTZWxlY3RlZHx8KGIucHJvcEhvb2tzLnNlbGVjdGVkPWIuZXh0ZW5kKGIucHJvcEhvb2tzLnNlbGVjdGVkLHtnZXQ6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wYXJlbnROb2RlO3JldHVybiB0JiYodC5zZWxlY3RlZEluZGV4LHQucGFyZW50Tm9kZSYmdC5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgpLG51bGx9fSkpLGIuc3VwcG9ydC5lbmN0eXBlfHwoYi5wcm9wRml4LmVuY3R5cGU9ImVuY29kaW5nIiksYi5zdXBwb3J0LmNoZWNrT258fGIuZWFjaChbInJhZGlvIiwiY2hlY2tib3giXSxmdW5jdGlvbigpe2IudmFsSG9va3NbdGhpc109e2dldDpmdW5jdGlvbihlKXtyZXR1cm4gbnVsbD09PWUuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpPyJvbiI6ZS52YWx1ZX19fSksYi5lYWNoKFsicmFkaW8iLCJjaGVja2JveCJdLGZ1bmN0aW9uKCl7Yi52YWxIb29rc1t0aGlzXT1iLmV4dGVuZChiLnZhbEhvb2tzW3RoaXNdLHtzZXQ6ZnVuY3Rpb24oZSxuKXtyZXR1cm4gYi5pc0FycmF5KG4pP2UuY2hlY2tlZD1iLmluQXJyYXkoYihlKS52YWwoKSxuKT49MDp0fX0pfSk7dmFyIFo9L14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWEpJC9pLGV0PS9ea2V5Lyx0dD0vXig/Om1vdXNlfGNvbnRleHRtZW51KXxjbGljay8sbnQ9L14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLHJ0PS9eKFteLl0qKSg/OlwuKC4rKXwpJC87ZnVuY3Rpb24gaXQoKXtyZXR1cm4hMH1mdW5jdGlvbiBvdCgpe3JldHVybiExfWIuZXZlbnQ9e2dsb2JhbDp7fSxhZGQ6ZnVuY3Rpb24oZSxuLHIsbyxhKXt2YXIgcyx1LGwsYyxwLGYsZCxoLGcsbSx5LHY9Yi5fZGF0YShlKTtpZih2KXtyLmhhbmRsZXImJihjPXIscj1jLmhhbmRsZXIsYT1jLnNlbGVjdG9yKSxyLmd1aWR8fChyLmd1aWQ9Yi5ndWlkKyspLCh1PXYuZXZlbnRzKXx8KHU9di5ldmVudHM9e30pLChmPXYuaGFuZGxlKXx8KGY9di5oYW5kbGU9ZnVuY3Rpb24oZSl7cmV0dXJuIHR5cGVvZiBiPT09aXx8ZSYmYi5ldmVudC50cmlnZ2VyZWQ9PT1lLnR5cGU/dDpiLmV2ZW50LmRpc3BhdGNoLmFwcGx5KGYuZWxlbSxhcmd1bWVudHMpfSxmLmVsZW09ZSksbj0obnx8IiIpLm1hdGNoKHcpfHxbIiJdLGw9bi5sZW5ndGg7d2hpbGUobC0tKXM9cnQuZXhlYyhuW2xdKXx8W10sZz15PXNbMV0sbT0oc1syXXx8IiIpLnNwbGl0KCIuIikuc29ydCgpLHA9Yi5ldmVudC5zcGVjaWFsW2ddfHx7fSxnPShhP3AuZGVsZWdhdGVUeXBlOnAuYmluZFR5cGUpfHxnLHA9Yi5ldmVudC5zcGVjaWFsW2ddfHx7fSxkPWIuZXh0ZW5kKHt0eXBlOmcsb3JpZ1R5cGU6eSxkYXRhOm8saGFuZGxlcjpyLGd1aWQ6ci5ndWlkLHNlbGVjdG9yOmEsbmVlZHNDb250ZXh0OmEmJmIuZXhwci5tYXRjaC5uZWVkc0NvbnRleHQudGVzdChhKSxuYW1lc3BhY2U6bS5qb2luKCIuIil9LGMpLChoPXVbZ10pfHwoaD11W2ddPVtdLGguZGVsZWdhdGVDb3VudD0wLHAuc2V0dXAmJnAuc2V0dXAuY2FsbChlLG8sbSxmKSE9PSExfHwoZS5hZGRFdmVudExpc3RlbmVyP2UuYWRkRXZlbnRMaXN0ZW5lcihnLGYsITEpOmUuYXR0YWNoRXZlbnQmJmUuYXR0YWNoRXZlbnQoIm9uIitnLGYpKSkscC5hZGQmJihwLmFkZC5jYWxsKGUsZCksZC5oYW5kbGVyLmd1aWR8fChkLmhhbmRsZXIuZ3VpZD1yLmd1aWQpKSxhP2guc3BsaWNlKGguZGVsZWdhdGVDb3VudCsrLDAsZCk6aC5wdXNoKGQpLGIuZXZlbnQuZ2xvYmFsW2ddPSEwO2U9bnVsbH19LHJlbW92ZTpmdW5jdGlvbihlLHQsbixyLGkpe3ZhciBvLGEscyx1LGwsYyxwLGYsZCxoLGcsbT1iLmhhc0RhdGEoZSkmJmIuX2RhdGEoZSk7aWYobSYmKGM9bS5ldmVudHMpKXt0PSh0fHwiIikubWF0Y2godyl8fFsiIl0sbD10Lmxlbmd0aDt3aGlsZShsLS0paWYocz1ydC5leGVjKHRbbF0pfHxbXSxkPWc9c1sxXSxoPShzWzJdfHwiIikuc3BsaXQoIi4iKS5zb3J0KCksZCl7cD1iLmV2ZW50LnNwZWNpYWxbZF18fHt9LGQ9KHI/cC5kZWxlZ2F0ZVR5cGU6cC5iaW5kVHlwZSl8fGQsZj1jW2RdfHxbXSxzPXNbMl0mJlJlZ0V4cCgiKF58XFwuKSIraC5qb2luKCJcXC4oPzouKlxcLnwpIikrIihcXC58JCkiKSx1PW89Zi5sZW5ndGg7d2hpbGUoby0tKWE9ZltvXSwhaSYmZyE9PWEub3JpZ1R5cGV8fG4mJm4uZ3VpZCE9PWEuZ3VpZHx8cyYmIXMudGVzdChhLm5hbWVzcGFjZSl8fHImJnIhPT1hLnNlbGVjdG9yJiYoIioqIiE9PXJ8fCFhLnNlbGVjdG9yKXx8KGYuc3BsaWNlKG8sMSksYS5zZWxlY3RvciYmZi5kZWxlZ2F0ZUNvdW50LS0scC5yZW1vdmUmJnAucmVtb3ZlLmNhbGwoZSxhKSk7dSYmIWYubGVuZ3RoJiYocC50ZWFyZG93biYmcC50ZWFyZG93bi5jYWxsKGUsaCxtLmhhbmRsZSkhPT0hMXx8Yi5yZW1vdmVFdmVudChlLGQsbS5oYW5kbGUpLGRlbGV0ZSBjW2RdKX1lbHNlIGZvcihkIGluIGMpYi5ldmVudC5yZW1vdmUoZSxkK3RbbF0sbixyLCEwKTtiLmlzRW1wdHlPYmplY3QoYykmJihkZWxldGUgbS5oYW5kbGUsYi5fcmVtb3ZlRGF0YShlLCJldmVudHMiKSl9fSx0cmlnZ2VyOmZ1bmN0aW9uKG4scixpLGEpe3ZhciBzLHUsbCxjLHAsZixkLGg9W2l8fG9dLGc9eS5jYWxsKG4sInR5cGUiKT9uLnR5cGU6bixtPXkuY2FsbChuLCJuYW1lc3BhY2UiKT9uLm5hbWVzcGFjZS5zcGxpdCgiLiIpOltdO2lmKGw9Zj1pPWl8fG8sMyE9PWkubm9kZVR5cGUmJjghPT1pLm5vZGVUeXBlJiYhbnQudGVzdChnK2IuZXZlbnQudHJpZ2dlcmVkKSYmKGcuaW5kZXhPZigiLiIpPj0wJiYobT1nLnNwbGl0KCIuIiksZz1tLnNoaWZ0KCksbS5zb3J0KCkpLHU9MD5nLmluZGV4T2YoIjoiKSYmIm9uIitnLG49bltiLmV4cGFuZG9dP246bmV3IGIuRXZlbnQoZywib2JqZWN0Ij09dHlwZW9mIG4mJm4pLG4uaXNUcmlnZ2VyPSEwLG4ubmFtZXNwYWNlPW0uam9pbigiLiIpLG4ubmFtZXNwYWNlX3JlPW4ubmFtZXNwYWNlP1JlZ0V4cCgiKF58XFwuKSIrbS5qb2luKCJcXC4oPzouKlxcLnwpIikrIihcXC58JCkiKTpudWxsLG4ucmVzdWx0PXQsbi50YXJnZXR8fChuLnRhcmdldD1pKSxyPW51bGw9PXI/W25dOmIubWFrZUFycmF5KHIsW25dKSxwPWIuZXZlbnQuc3BlY2lhbFtnXXx8e30sYXx8IXAudHJpZ2dlcnx8cC50cmlnZ2VyLmFwcGx5KGkscikhPT0hMSkpe2lmKCFhJiYhcC5ub0J1YmJsZSYmIWIuaXNXaW5kb3coaSkpe2ZvcihjPXAuZGVsZWdhdGVUeXBlfHxnLG50LnRlc3QoYytnKXx8KGw9bC5wYXJlbnROb2RlKTtsO2w9bC5wYXJlbnROb2RlKWgucHVzaChsKSxmPWw7Zj09PShpLm93bmVyRG9jdW1lbnR8fG8pJiZoLnB1c2goZi5kZWZhdWx0Vmlld3x8Zi5wYXJlbnRXaW5kb3d8fGUpfWQ9MDt3aGlsZSgobD1oW2QrK10pJiYhbi5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKW4udHlwZT1kPjE/YzpwLmJpbmRUeXBlfHxnLHM9KGIuX2RhdGEobCwiZXZlbnRzIil8fHt9KVtuLnR5cGVdJiZiLl9kYXRhKGwsImhhbmRsZSIpLHMmJnMuYXBwbHkobCxyKSxzPXUmJmxbdV0scyYmYi5hY2NlcHREYXRhKGwpJiZzLmFwcGx5JiZzLmFwcGx5KGwscik9PT0hMSYmbi5wcmV2ZW50RGVmYXVsdCgpO2lmKG4udHlwZT1nLCEoYXx8bi5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8cC5fZGVmYXVsdCYmcC5fZGVmYXVsdC5hcHBseShpLm93bmVyRG9jdW1lbnQscikhPT0hMXx8ImNsaWNrIj09PWcmJmIubm9kZU5hbWUoaSwiYSIpfHwhYi5hY2NlcHREYXRhKGkpfHwhdXx8IWlbZ118fGIuaXNXaW5kb3coaSkpKXtmPWlbdV0sZiYmKGlbdV09bnVsbCksYi5ldmVudC50cmlnZ2VyZWQ9Zzt0cnl7aVtnXSgpfWNhdGNoKHYpe31iLmV2ZW50LnRyaWdnZXJlZD10LGYmJihpW3VdPWYpfXJldHVybiBuLnJlc3VsdH19LGRpc3BhdGNoOmZ1bmN0aW9uKGUpe2U9Yi5ldmVudC5maXgoZSk7dmFyIG4scixpLG8sYSxzPVtdLHU9aC5jYWxsKGFyZ3VtZW50cyksbD0oYi5fZGF0YSh0aGlzLCJldmVudHMiKXx8e30pW2UudHlwZV18fFtdLGM9Yi5ldmVudC5zcGVjaWFsW2UudHlwZV18fHt9O2lmKHVbMF09ZSxlLmRlbGVnYXRlVGFyZ2V0PXRoaXMsIWMucHJlRGlzcGF0Y2h8fGMucHJlRGlzcGF0Y2guY2FsbCh0aGlzLGUpIT09ITEpe3M9Yi5ldmVudC5oYW5kbGVycy5jYWxsKHRoaXMsZSxsKSxuPTA7d2hpbGUoKG89c1tuKytdKSYmIWUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSl7ZS5jdXJyZW50VGFyZ2V0PW8uZWxlbSxhPTA7d2hpbGUoKGk9by5oYW5kbGVyc1thKytdKSYmIWUuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQoKSkoIWUubmFtZXNwYWNlX3JlfHxlLm5hbWVzcGFjZV9yZS50ZXN0KGkubmFtZXNwYWNlKSkmJihlLmhhbmRsZU9iaj1pLGUuZGF0YT1pLmRhdGEscj0oKGIuZXZlbnQuc3BlY2lhbFtpLm9yaWdUeXBlXXx8e30pLmhhbmRsZXx8aS5oYW5kbGVyKS5hcHBseShvLmVsZW0sdSksciE9PXQmJihlLnJlc3VsdD1yKT09PSExJiYoZS5wcmV2ZW50RGVmYXVsdCgpLGUuc3RvcFByb3BhZ2F0aW9uKCkpKX1yZXR1cm4gYy5wb3N0RGlzcGF0Y2gmJmMucG9zdERpc3BhdGNoLmNhbGwodGhpcyxlKSxlLnJlc3VsdH19LGhhbmRsZXJzOmZ1bmN0aW9uKGUsbil7dmFyIHIsaSxvLGEscz1bXSx1PW4uZGVsZWdhdGVDb3VudCxsPWUudGFyZ2V0O2lmKHUmJmwubm9kZVR5cGUmJighZS5idXR0b258fCJjbGljayIhPT1lLnR5cGUpKWZvcig7bCE9dGhpcztsPWwucGFyZW50Tm9kZXx8dGhpcylpZigxPT09bC5ub2RlVHlwZSYmKGwuZGlzYWJsZWQhPT0hMHx8ImNsaWNrIiE9PWUudHlwZSkpe2ZvcihvPVtdLGE9MDt1PmE7YSsrKWk9blthXSxyPWkuc2VsZWN0b3IrIiAiLG9bcl09PT10JiYob1tyXT1pLm5lZWRzQ29udGV4dD9iKHIsdGhpcykuaW5kZXgobCk+PTA6Yi5maW5kKHIsdGhpcyxudWxsLFtsXSkubGVuZ3RoKSxvW3JdJiZvLnB1c2goaSk7by5sZW5ndGgmJnMucHVzaCh7ZWxlbTpsLGhhbmRsZXJzOm99KX1yZXR1cm4gbi5sZW5ndGg+dSYmcy5wdXNoKHtlbGVtOnRoaXMsaGFuZGxlcnM6bi5zbGljZSh1KX0pLHN9LGZpeDpmdW5jdGlvbihlKXtpZihlW2IuZXhwYW5kb10pcmV0dXJuIGU7dmFyIHQsbixyLGk9ZS50eXBlLGE9ZSxzPXRoaXMuZml4SG9va3NbaV07c3x8KHRoaXMuZml4SG9va3NbaV09cz10dC50ZXN0KGkpP3RoaXMubW91c2VIb29rczpldC50ZXN0KGkpP3RoaXMua2V5SG9va3M6e30pLHI9cy5wcm9wcz90aGlzLnByb3BzLmNvbmNhdChzLnByb3BzKTp0aGlzLnByb3BzLGU9bmV3IGIuRXZlbnQoYSksdD1yLmxlbmd0aDt3aGlsZSh0LS0pbj1yW3RdLGVbbl09YVtuXTtyZXR1cm4gZS50YXJnZXR8fChlLnRhcmdldD1hLnNyY0VsZW1lbnR8fG8pLDM9PT1lLnRhcmdldC5ub2RlVHlwZSYmKGUudGFyZ2V0PWUudGFyZ2V0LnBhcmVudE5vZGUpLGUubWV0YUtleT0hIWUubWV0YUtleSxzLmZpbHRlcj9zLmZpbHRlcihlLGEpOmV9LHByb3BzOiJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2giLnNwbGl0KCIgIiksZml4SG9va3M6e30sa2V5SG9va3M6e3Byb3BzOiJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlIi5zcGxpdCgiICIpLGZpbHRlcjpmdW5jdGlvbihlLHQpe3JldHVybiBudWxsPT1lLndoaWNoJiYoZS53aGljaD1udWxsIT10LmNoYXJDb2RlP3QuY2hhckNvZGU6dC5rZXlDb2RlKSxlfX0sbW91c2VIb29rczp7cHJvcHM6ImJ1dHRvbiBidXR0b25zIGNsaWVudFggY2xpZW50WSBmcm9tRWxlbWVudCBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIuc3BsaXQoIiAiKSxmaWx0ZXI6ZnVuY3Rpb24oZSxuKXt2YXIgcixpLGEscz1uLmJ1dHRvbix1PW4uZnJvbUVsZW1lbnQ7cmV0dXJuIG51bGw9PWUucGFnZVgmJm51bGwhPW4uY2xpZW50WCYmKGk9ZS50YXJnZXQub3duZXJEb2N1bWVudHx8byxhPWkuZG9jdW1lbnRFbGVtZW50LHI9aS5ib2R5LGUucGFnZVg9bi5jbGllbnRYKyhhJiZhLnNjcm9sbExlZnR8fHImJnIuc2Nyb2xsTGVmdHx8MCktKGEmJmEuY2xpZW50TGVmdHx8ciYmci5jbGllbnRMZWZ0fHwwKSxlLnBhZ2VZPW4uY2xpZW50WSsoYSYmYS5zY3JvbGxUb3B8fHImJnIuc2Nyb2xsVG9wfHwwKS0oYSYmYS5jbGllbnRUb3B8fHImJnIuY2xpZW50VG9wfHwwKSksIWUucmVsYXRlZFRhcmdldCYmdSYmKGUucmVsYXRlZFRhcmdldD11PT09ZS50YXJnZXQ/bi50b0VsZW1lbnQ6dSksZS53aGljaHx8cz09PXR8fChlLndoaWNoPTEmcz8xOjImcz8zOjQmcz8yOjApLGV9fSxzcGVjaWFsOntsb2FkOntub0J1YmJsZTohMH0sY2xpY2s6e3RyaWdnZXI6ZnVuY3Rpb24oKXtyZXR1cm4gYi5ub2RlTmFtZSh0aGlzLCJpbnB1dCIpJiYiY2hlY2tib3giPT09dGhpcy50eXBlJiZ0aGlzLmNsaWNrPyh0aGlzLmNsaWNrKCksITEpOnR9fSxmb2N1czp7dHJpZ2dlcjpmdW5jdGlvbigpe2lmKHRoaXMhPT1vLmFjdGl2ZUVsZW1lbnQmJnRoaXMuZm9jdXMpdHJ5e3JldHVybiB0aGlzLmZvY3VzKCksITF9Y2F0Y2goZSl7fX0sZGVsZWdhdGVUeXBlOiJmb2N1c2luIn0sYmx1cjp7dHJpZ2dlcjpmdW5jdGlvbigpe3JldHVybiB0aGlzPT09by5hY3RpdmVFbGVtZW50JiZ0aGlzLmJsdXI/KHRoaXMuYmx1cigpLCExKTp0fSxkZWxlZ2F0ZVR5cGU6ImZvY3Vzb3V0In0sYmVmb3JldW5sb2FkOntwb3N0RGlzcGF0Y2g6ZnVuY3Rpb24oZSl7ZS5yZXN1bHQhPT10JiYoZS5vcmlnaW5hbEV2ZW50LnJldHVyblZhbHVlPWUucmVzdWx0KX19fSxzaW11bGF0ZTpmdW5jdGlvbihlLHQsbixyKXt2YXIgaT1iLmV4dGVuZChuZXcgYi5FdmVudCxuLHt0eXBlOmUsaXNTaW11bGF0ZWQ6ITAsb3JpZ2luYWxFdmVudDp7fX0pO3I/Yi5ldmVudC50cmlnZ2VyKGksbnVsbCx0KTpiLmV2ZW50LmRpc3BhdGNoLmNhbGwodCxpKSxpLmlzRGVmYXVsdFByZXZlbnRlZCgpJiZuLnByZXZlbnREZWZhdWx0KCl9fSxiLnJlbW92ZUV2ZW50PW8ucmVtb3ZlRXZlbnRMaXN0ZW5lcj9mdW5jdGlvbihlLHQsbil7ZS5yZW1vdmVFdmVudExpc3RlbmVyJiZlLnJlbW92ZUV2ZW50TGlzdGVuZXIodCxuLCExKX06ZnVuY3Rpb24oZSx0LG4pe3ZhciByPSJvbiIrdDtlLmRldGFjaEV2ZW50JiYodHlwZW9mIGVbcl09PT1pJiYoZVtyXT1udWxsKSxlLmRldGFjaEV2ZW50KHIsbikpfSxiLkV2ZW50PWZ1bmN0aW9uKGUsbil7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBiLkV2ZW50PyhlJiZlLnR5cGU/KHRoaXMub3JpZ2luYWxFdmVudD1lLHRoaXMudHlwZT1lLnR5cGUsdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9ZS5kZWZhdWx0UHJldmVudGVkfHxlLnJldHVyblZhbHVlPT09ITF8fGUuZ2V0UHJldmVudERlZmF1bHQmJmUuZ2V0UHJldmVudERlZmF1bHQoKT9pdDpvdCk6dGhpcy50eXBlPWUsbiYmYi5leHRlbmQodGhpcyxuKSx0aGlzLnRpbWVTdGFtcD1lJiZlLnRpbWVTdGFtcHx8Yi5ub3coKSx0aGlzW2IuZXhwYW5kb109ITAsdCk6bmV3IGIuRXZlbnQoZSxuKX0sYi5FdmVudC5wcm90b3R5cGU9e2lzRGVmYXVsdFByZXZlbnRlZDpvdCxpc1Byb3BhZ2F0aW9uU3RvcHBlZDpvdCxpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDpvdCxwcmV2ZW50RGVmYXVsdDpmdW5jdGlvbigpe3ZhciBlPXRoaXMub3JpZ2luYWxFdmVudDt0aGlzLmlzRGVmYXVsdFByZXZlbnRlZD1pdCxlJiYoZS5wcmV2ZW50RGVmYXVsdD9lLnByZXZlbnREZWZhdWx0KCk6ZS5yZXR1cm5WYWx1ZT0hMSl9LHN0b3BQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3ZhciBlPXRoaXMub3JpZ2luYWxFdmVudDt0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkPWl0LGUmJihlLnN0b3BQcm9wYWdhdGlvbiYmZS5zdG9wUHJvcGFnYXRpb24oKSxlLmNhbmNlbEJ1YmJsZT0hMCl9LHN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbjpmdW5jdGlvbigpe3RoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9aXQsdGhpcy5zdG9wUHJvcGFnYXRpb24oKX19LGIuZWFjaCh7bW91c2VlbnRlcjoibW91c2VvdmVyIixtb3VzZWxlYXZlOiJtb3VzZW91dCJ9LGZ1bmN0aW9uKGUsdCl7Yi5ldmVudC5zcGVjaWFsW2VdPXtkZWxlZ2F0ZVR5cGU6dCxiaW5kVHlwZTp0LGhhbmRsZTpmdW5jdGlvbihlKXt2YXIgbixyPXRoaXMsaT1lLnJlbGF0ZWRUYXJnZXQsbz1lLmhhbmRsZU9iajsNCnJldHVybighaXx8aSE9PXImJiFiLmNvbnRhaW5zKHIsaSkpJiYoZS50eXBlPW8ub3JpZ1R5cGUsbj1vLmhhbmRsZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpLGUudHlwZT10KSxufX19KSxiLnN1cHBvcnQuc3VibWl0QnViYmxlc3x8KGIuZXZlbnQuc3BlY2lhbC5zdWJtaXQ9e3NldHVwOmZ1bmN0aW9uKCl7cmV0dXJuIGIubm9kZU5hbWUodGhpcywiZm9ybSIpPyExOihiLmV2ZW50LmFkZCh0aGlzLCJjbGljay5fc3VibWl0IGtleXByZXNzLl9zdWJtaXQiLGZ1bmN0aW9uKGUpe3ZhciBuPWUudGFyZ2V0LHI9Yi5ub2RlTmFtZShuLCJpbnB1dCIpfHxiLm5vZGVOYW1lKG4sImJ1dHRvbiIpP24uZm9ybTp0O3ImJiFiLl9kYXRhKHIsInN1Ym1pdEJ1YmJsZXMiKSYmKGIuZXZlbnQuYWRkKHIsInN1Ym1pdC5fc3VibWl0IixmdW5jdGlvbihlKXtlLl9zdWJtaXRfYnViYmxlPSEwfSksYi5fZGF0YShyLCJzdWJtaXRCdWJibGVzIiwhMCkpfSksdCl9LHBvc3REaXNwYXRjaDpmdW5jdGlvbihlKXtlLl9zdWJtaXRfYnViYmxlJiYoZGVsZXRlIGUuX3N1Ym1pdF9idWJibGUsdGhpcy5wYXJlbnROb2RlJiYhZS5pc1RyaWdnZXImJmIuZXZlbnQuc2ltdWxhdGUoInN1Ym1pdCIsdGhpcy5wYXJlbnROb2RlLGUsITApKX0sdGVhcmRvd246ZnVuY3Rpb24oKXtyZXR1cm4gYi5ub2RlTmFtZSh0aGlzLCJmb3JtIik/ITE6KGIuZXZlbnQucmVtb3ZlKHRoaXMsIi5fc3VibWl0IiksdCl9fSksYi5zdXBwb3J0LmNoYW5nZUJ1YmJsZXN8fChiLmV2ZW50LnNwZWNpYWwuY2hhbmdlPXtzZXR1cDpmdW5jdGlvbigpe3JldHVybiBaLnRlc3QodGhpcy5ub2RlTmFtZSk/KCgiY2hlY2tib3giPT09dGhpcy50eXBlfHwicmFkaW8iPT09dGhpcy50eXBlKSYmKGIuZXZlbnQuYWRkKHRoaXMsInByb3BlcnR5Y2hhbmdlLl9jaGFuZ2UiLGZ1bmN0aW9uKGUpeyJjaGVja2VkIj09PWUub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWUmJih0aGlzLl9qdXN0X2NoYW5nZWQ9ITApfSksYi5ldmVudC5hZGQodGhpcywiY2xpY2suX2NoYW5nZSIsZnVuY3Rpb24oZSl7dGhpcy5fanVzdF9jaGFuZ2VkJiYhZS5pc1RyaWdnZXImJih0aGlzLl9qdXN0X2NoYW5nZWQ9ITEpLGIuZXZlbnQuc2ltdWxhdGUoImNoYW5nZSIsdGhpcyxlLCEwKX0pKSwhMSk6KGIuZXZlbnQuYWRkKHRoaXMsImJlZm9yZWFjdGl2YXRlLl9jaGFuZ2UiLGZ1bmN0aW9uKGUpe3ZhciB0PWUudGFyZ2V0O1oudGVzdCh0Lm5vZGVOYW1lKSYmIWIuX2RhdGEodCwiY2hhbmdlQnViYmxlcyIpJiYoYi5ldmVudC5hZGQodCwiY2hhbmdlLl9jaGFuZ2UiLGZ1bmN0aW9uKGUpeyF0aGlzLnBhcmVudE5vZGV8fGUuaXNTaW11bGF0ZWR8fGUuaXNUcmlnZ2VyfHxiLmV2ZW50LnNpbXVsYXRlKCJjaGFuZ2UiLHRoaXMucGFyZW50Tm9kZSxlLCEwKX0pLGIuX2RhdGEodCwiY2hhbmdlQnViYmxlcyIsITApKX0pLHQpfSxoYW5kbGU6ZnVuY3Rpb24oZSl7dmFyIG49ZS50YXJnZXQ7cmV0dXJuIHRoaXMhPT1ufHxlLmlzU2ltdWxhdGVkfHxlLmlzVHJpZ2dlcnx8InJhZGlvIiE9PW4udHlwZSYmImNoZWNrYm94IiE9PW4udHlwZT9lLmhhbmRsZU9iai5oYW5kbGVyLmFwcGx5KHRoaXMsYXJndW1lbnRzKTp0fSx0ZWFyZG93bjpmdW5jdGlvbigpe3JldHVybiBiLmV2ZW50LnJlbW92ZSh0aGlzLCIuX2NoYW5nZSIpLCFaLnRlc3QodGhpcy5ub2RlTmFtZSl9fSksYi5zdXBwb3J0LmZvY3VzaW5CdWJibGVzfHxiLmVhY2goe2ZvY3VzOiJmb2N1c2luIixibHVyOiJmb2N1c291dCJ9LGZ1bmN0aW9uKGUsdCl7dmFyIG49MCxyPWZ1bmN0aW9uKGUpe2IuZXZlbnQuc2ltdWxhdGUodCxlLnRhcmdldCxiLmV2ZW50LmZpeChlKSwhMCl9O2IuZXZlbnQuc3BlY2lhbFt0XT17c2V0dXA6ZnVuY3Rpb24oKXswPT09bisrJiZvLmFkZEV2ZW50TGlzdGVuZXIoZSxyLCEwKX0sdGVhcmRvd246ZnVuY3Rpb24oKXswPT09LS1uJiZvLnJlbW92ZUV2ZW50TGlzdGVuZXIoZSxyLCEwKX19fSksYi5mbi5leHRlbmQoe29uOmZ1bmN0aW9uKGUsbixyLGksbyl7dmFyIGEscztpZigib2JqZWN0Ij09dHlwZW9mIGUpeyJzdHJpbmciIT10eXBlb2YgbiYmKHI9cnx8bixuPXQpO2ZvcihhIGluIGUpdGhpcy5vbihhLG4scixlW2FdLG8pO3JldHVybiB0aGlzfWlmKG51bGw9PXImJm51bGw9PWk/KGk9bixyPW49dCk6bnVsbD09aSYmKCJzdHJpbmciPT10eXBlb2Ygbj8oaT1yLHI9dCk6KGk9cixyPW4sbj10KSksaT09PSExKWk9b3Q7ZWxzZSBpZighaSlyZXR1cm4gdGhpcztyZXR1cm4gMT09PW8mJihzPWksaT1mdW5jdGlvbihlKXtyZXR1cm4gYigpLm9mZihlKSxzLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0saS5ndWlkPXMuZ3VpZHx8KHMuZ3VpZD1iLmd1aWQrKykpLHRoaXMuZWFjaChmdW5jdGlvbigpe2IuZXZlbnQuYWRkKHRoaXMsZSxpLHIsbil9KX0sb25lOmZ1bmN0aW9uKGUsdCxuLHIpe3JldHVybiB0aGlzLm9uKGUsdCxuLHIsMSl9LG9mZjpmdW5jdGlvbihlLG4scil7dmFyIGksbztpZihlJiZlLnByZXZlbnREZWZhdWx0JiZlLmhhbmRsZU9iailyZXR1cm4gaT1lLmhhbmRsZU9iaixiKGUuZGVsZWdhdGVUYXJnZXQpLm9mZihpLm5hbWVzcGFjZT9pLm9yaWdUeXBlKyIuIitpLm5hbWVzcGFjZTppLm9yaWdUeXBlLGkuc2VsZWN0b3IsaS5oYW5kbGVyKSx0aGlzO2lmKCJvYmplY3QiPT10eXBlb2YgZSl7Zm9yKG8gaW4gZSl0aGlzLm9mZihvLG4sZVtvXSk7cmV0dXJuIHRoaXN9cmV0dXJuKG49PT0hMXx8ImZ1bmN0aW9uIj09dHlwZW9mIG4pJiYocj1uLG49dCkscj09PSExJiYocj1vdCksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Yi5ldmVudC5yZW1vdmUodGhpcyxlLHIsbil9KX0sYmluZDpmdW5jdGlvbihlLHQsbil7cmV0dXJuIHRoaXMub24oZSxudWxsLHQsbil9LHVuYmluZDpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLm9mZihlLG51bGwsdCl9LGRlbGVnYXRlOmZ1bmN0aW9uKGUsdCxuLHIpe3JldHVybiB0aGlzLm9uKHQsZSxuLHIpfSx1bmRlbGVnYXRlOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gMT09PWFyZ3VtZW50cy5sZW5ndGg/dGhpcy5vZmYoZSwiKioiKTp0aGlzLm9mZih0LGV8fCIqKiIsbil9LHRyaWdnZXI6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Yi5ldmVudC50cmlnZ2VyKGUsdCx0aGlzKX0pfSx0cmlnZ2VySGFuZGxlcjpmdW5jdGlvbihlLG4pe3ZhciByPXRoaXNbMF07cmV0dXJuIHI/Yi5ldmVudC50cmlnZ2VyKGUsbixyLCEwKTp0fX0pLGZ1bmN0aW9uKGUsdCl7dmFyIG4scixpLG8sYSxzLHUsbCxjLHAsZixkLGgsZyxtLHksdix4PSJzaXp6bGUiKy1uZXcgRGF0ZSx3PWUuZG9jdW1lbnQsVD17fSxOPTAsQz0wLGs9aXQoKSxFPWl0KCksUz1pdCgpLEE9dHlwZW9mIHQsaj0xPDwzMSxEPVtdLEw9RC5wb3AsSD1ELnB1c2gscT1ELnNsaWNlLE09RC5pbmRleE9mfHxmdW5jdGlvbihlKXt2YXIgdD0wLG49dGhpcy5sZW5ndGg7Zm9yKDtuPnQ7dCsrKWlmKHRoaXNbdF09PT1lKXJldHVybiB0O3JldHVybi0xfSxfPSJbXFx4MjBcXHRcXHJcXG5cXGZdIixGPSIoPzpcXFxcLnxbXFx3LV18W15cXHgwMC1cXHhhMF0pKyIsTz1GLnJlcGxhY2UoInciLCJ3IyIpLEI9IihbKl4kfCF+XT89KSIsUD0iXFxbIitfKyIqKCIrRisiKSIrXysiKig/OiIrQitfKyIqKD86KFsnXCJdKSgoPzpcXFxcLnxbXlxcXFxdKSo/KVxcM3woIitPKyIpfCl8KSIrXysiKlxcXSIsUj0iOigiK0YrIikoPzpcXCgoKFsnXCJdKSgoPzpcXFxcLnxbXlxcXFxdKSo/KVxcM3woKD86XFxcXC58W15cXFxcKClbXFxdXXwiK1AucmVwbGFjZSgzLDgpKyIpKil8LiopXFwpfCkiLFc9UmVnRXhwKCJeIitfKyIrfCgoPzpefFteXFxcXF0pKD86XFxcXC4pKikiK18rIiskIiwiZyIpLCQ9UmVnRXhwKCJeIitfKyIqLCIrXysiKiIpLEk9UmVnRXhwKCJeIitfKyIqKFtcXHgyMFxcdFxcclxcblxcZj4rfl0pIitfKyIqIiksej1SZWdFeHAoUiksWD1SZWdFeHAoIl4iK08rIiQiKSxVPXtJRDpSZWdFeHAoIl4jKCIrRisiKSIpLENMQVNTOlJlZ0V4cCgiXlxcLigiK0YrIikiKSxOQU1FOlJlZ0V4cCgiXlxcW25hbWU9WydcIl0/KCIrRisiKVsnXCJdP1xcXSIpLFRBRzpSZWdFeHAoIl4oIitGLnJlcGxhY2UoInciLCJ3KiIpKyIpIiksQVRUUjpSZWdFeHAoIl4iK1ApLFBTRVVETzpSZWdFeHAoIl4iK1IpLENISUxEOlJlZ0V4cCgiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFwoIitfKyIqKGV2ZW58b2RkfCgoWystXXwpKFxcZCopbnwpIitfKyIqKD86KFsrLV18KSIrXysiKihcXGQrKXwpKSIrXysiKlxcKXwpIiwiaSIpLG5lZWRzQ29udGV4dDpSZWdFeHAoIl4iK18rIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIrXysiKigoPzotXFxkKT9cXGQqKSIrXysiKlxcKXwpKD89W14tXXwkKSIsImkiKX0sVj0vW1x4MjBcdFxyXG5cZl0qWyt+XS8sWT0vXltee10rXHtccypcW25hdGl2ZSBjb2RlLyxKPS9eKD86IyhbXHctXSspfChcdyspfFwuKFtcdy1dKykpJC8sRz0vXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLFE9L15oXGQkL2ksSz0vJ3xcXC9nLFo9L1w9W1x4MjBcdFxyXG5cZl0qKFteJyJcXV0qKVtceDIwXHRcclxuXGZdKlxdL2csZXQ9L1xcKFtcZGEtZkEtRl17MSw2fVtceDIwXHRcclxuXGZdP3wuKS9nLHR0PWZ1bmN0aW9uKGUsdCl7dmFyIG49IjB4Iit0LTY1NTM2O3JldHVybiBuIT09bj90OjA+bj9TdHJpbmcuZnJvbUNoYXJDb2RlKG4rNjU1MzYpOlN0cmluZy5mcm9tQ2hhckNvZGUoNTUyOTZ8bj4+MTAsNTYzMjB8MTAyMyZuKX07dHJ5e3EuY2FsbCh3LmRvY3VtZW50RWxlbWVudC5jaGlsZE5vZGVzLDApWzBdLm5vZGVUeXBlfWNhdGNoKG50KXtxPWZ1bmN0aW9uKGUpe3ZhciB0LG49W107d2hpbGUodD10aGlzW2UrK10pbi5wdXNoKHQpO3JldHVybiBufX1mdW5jdGlvbiBydChlKXtyZXR1cm4gWS50ZXN0KGUrIiIpfWZ1bmN0aW9uIGl0KCl7dmFyIGUsdD1bXTtyZXR1cm4gZT1mdW5jdGlvbihuLHIpe3JldHVybiB0LnB1c2gobis9IiAiKT5pLmNhY2hlTGVuZ3RoJiZkZWxldGUgZVt0LnNoaWZ0KCldLGVbbl09cn19ZnVuY3Rpb24gb3QoZSl7cmV0dXJuIGVbeF09ITAsZX1mdW5jdGlvbiBhdChlKXt2YXIgdD1wLmNyZWF0ZUVsZW1lbnQoImRpdiIpO3RyeXtyZXR1cm4gZSh0KX1jYXRjaChuKXtyZXR1cm4hMX1maW5hbGx5e3Q9bnVsbH19ZnVuY3Rpb24gc3QoZSx0LG4scil7dmFyIGksbyxhLHMsdSxsLGYsZyxtLHY7aWYoKHQ/dC5vd25lckRvY3VtZW50fHx0OncpIT09cCYmYyh0KSx0PXR8fHAsbj1ufHxbXSwhZXx8InN0cmluZyIhPXR5cGVvZiBlKXJldHVybiBuO2lmKDEhPT0ocz10Lm5vZGVUeXBlKSYmOSE9PXMpcmV0dXJuW107aWYoIWQmJiFyKXtpZihpPUouZXhlYyhlKSlpZihhPWlbMV0pe2lmKDk9PT1zKXtpZihvPXQuZ2V0RWxlbWVudEJ5SWQoYSksIW98fCFvLnBhcmVudE5vZGUpcmV0dXJuIG47aWYoby5pZD09PWEpcmV0dXJuIG4ucHVzaChvKSxufWVsc2UgaWYodC5vd25lckRvY3VtZW50JiYobz10Lm93bmVyRG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYSkpJiZ5KHQsbykmJm8uaWQ9PT1hKXJldHVybiBuLnB1c2gobyksbn1lbHNle2lmKGlbMl0pcmV0dXJuIEguYXBwbHkobixxLmNhbGwodC5nZXRFbGVtZW50c0J5VGFnTmFtZShlKSwwKSksbjtpZigoYT1pWzNdKSYmVC5nZXRCeUNsYXNzTmFtZSYmdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKXJldHVybiBILmFwcGx5KG4scS5jYWxsKHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShhKSwwKSksbn1pZihULnFzYSYmIWgudGVzdChlKSl7aWYoZj0hMCxnPXgsbT10LHY9OT09PXMmJmUsMT09PXMmJiJvYmplY3QiIT09dC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKXtsPWZ0KGUpLChmPXQuZ2V0QXR0cmlidXRlKCJpZCIpKT9nPWYucmVwbGFjZShLLCJcXCQmIik6dC5zZXRBdHRyaWJ1dGUoImlkIixnKSxnPSJbaWQ9JyIrZysiJ10gIix1PWwubGVuZ3RoO3doaWxlKHUtLSlsW3VdPWcrZHQobFt1XSk7bT1WLnRlc3QoZSkmJnQucGFyZW50Tm9kZXx8dCx2PWwuam9pbigiLCIpfWlmKHYpdHJ5e3JldHVybiBILmFwcGx5KG4scS5jYWxsKG0ucXVlcnlTZWxlY3RvckFsbCh2KSwwKSksbn1jYXRjaChiKXt9ZmluYWxseXtmfHx0LnJlbW92ZUF0dHJpYnV0ZSgiaWQiKX19fXJldHVybiB3dChlLnJlcGxhY2UoVywiJDEiKSx0LG4scil9YT1zdC5pc1hNTD1mdW5jdGlvbihlKXt2YXIgdD1lJiYoZS5vd25lckRvY3VtZW50fHxlKS5kb2N1bWVudEVsZW1lbnQ7cmV0dXJuIHQ/IkhUTUwiIT09dC5ub2RlTmFtZTohMX0sYz1zdC5zZXREb2N1bWVudD1mdW5jdGlvbihlKXt2YXIgbj1lP2Uub3duZXJEb2N1bWVudHx8ZTp3O3JldHVybiBuIT09cCYmOT09PW4ubm9kZVR5cGUmJm4uZG9jdW1lbnRFbGVtZW50PyhwPW4sZj1uLmRvY3VtZW50RWxlbWVudCxkPWEobiksVC50YWdOYW1lTm9Db21tZW50cz1hdChmdW5jdGlvbihlKXtyZXR1cm4gZS5hcHBlbmRDaGlsZChuLmNyZWF0ZUNvbW1lbnQoIiIpKSwhZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aH0pLFQuYXR0cmlidXRlcz1hdChmdW5jdGlvbihlKXtlLmlubmVySFRNTD0iPHNlbGVjdD48L3NlbGVjdD4iO3ZhciB0PXR5cGVvZiBlLmxhc3RDaGlsZC5nZXRBdHRyaWJ1dGUoIm11bHRpcGxlIik7cmV0dXJuImJvb2xlYW4iIT09dCYmInN0cmluZyIhPT10fSksVC5nZXRCeUNsYXNzTmFtZT1hdChmdW5jdGlvbihlKXtyZXR1cm4gZS5pbm5lckhUTUw9IjxkaXYgY2xhc3M9J2hpZGRlbiBlJz48L2Rpdj48ZGl2IGNsYXNzPSdoaWRkZW4nPjwvZGl2PiIsZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lJiZlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImUiKS5sZW5ndGg/KGUubGFzdENoaWxkLmNsYXNzTmFtZT0iZSIsMj09PWUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aCk6ITF9KSxULmdldEJ5TmFtZT1hdChmdW5jdGlvbihlKXtlLmlkPXgrMCxlLmlubmVySFRNTD0iPGEgbmFtZT0nIit4KyInPjwvYT48ZGl2IG5hbWU9JyIreCsiJz48L2Rpdj4iLGYuaW5zZXJ0QmVmb3JlKGUsZi5maXJzdENoaWxkKTt2YXIgdD1uLmdldEVsZW1lbnRzQnlOYW1lJiZuLmdldEVsZW1lbnRzQnlOYW1lKHgpLmxlbmd0aD09PTIrbi5nZXRFbGVtZW50c0J5TmFtZSh4KzApLmxlbmd0aDtyZXR1cm4gVC5nZXRJZE5vdE5hbWU9IW4uZ2V0RWxlbWVudEJ5SWQoeCksZi5yZW1vdmVDaGlsZChlKSx0fSksaS5hdHRySGFuZGxlPWF0KGZ1bmN0aW9uKGUpe3JldHVybiBlLmlubmVySFRNTD0iPGEgaHJlZj0nIyc+PC9hPiIsZS5maXJzdENoaWxkJiZ0eXBlb2YgZS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSE9PUEmJiIjIj09PWUuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImhyZWYiKX0pP3t9OntocmVmOmZ1bmN0aW9uKGUpe3JldHVybiBlLmdldEF0dHJpYnV0ZSgiaHJlZiIsMil9LHR5cGU6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuZ2V0QXR0cmlidXRlKCJ0eXBlIil9fSxULmdldElkTm90TmFtZT8oaS5maW5kLklEPWZ1bmN0aW9uKGUsdCl7aWYodHlwZW9mIHQuZ2V0RWxlbWVudEJ5SWQhPT1BJiYhZCl7dmFyIG49dC5nZXRFbGVtZW50QnlJZChlKTtyZXR1cm4gbiYmbi5wYXJlbnROb2RlP1tuXTpbXX19LGkuZmlsdGVyLklEPWZ1bmN0aW9uKGUpe3ZhciB0PWUucmVwbGFjZShldCx0dCk7cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiBlLmdldEF0dHJpYnV0ZSgiaWQiKT09PXR9fSk6KGkuZmluZC5JRD1mdW5jdGlvbihlLG4pe2lmKHR5cGVvZiBuLmdldEVsZW1lbnRCeUlkIT09QSYmIWQpe3ZhciByPW4uZ2V0RWxlbWVudEJ5SWQoZSk7cmV0dXJuIHI/ci5pZD09PWV8fHR5cGVvZiByLmdldEF0dHJpYnV0ZU5vZGUhPT1BJiZyLmdldEF0dHJpYnV0ZU5vZGUoImlkIikudmFsdWU9PT1lP1tyXTp0OltdfX0saS5maWx0ZXIuSUQ9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5yZXBsYWNlKGV0LHR0KTtyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIG49dHlwZW9mIGUuZ2V0QXR0cmlidXRlTm9kZSE9PUEmJmUuZ2V0QXR0cmlidXRlTm9kZSgiaWQiKTtyZXR1cm4gbiYmbi52YWx1ZT09PXR9fSksaS5maW5kLlRBRz1ULnRhZ05hbWVOb0NvbW1lbnRzP2Z1bmN0aW9uKGUsbil7cmV0dXJuIHR5cGVvZiBuLmdldEVsZW1lbnRzQnlUYWdOYW1lIT09QT9uLmdldEVsZW1lbnRzQnlUYWdOYW1lKGUpOnR9OmZ1bmN0aW9uKGUsdCl7dmFyIG4scj1bXSxpPTAsbz10LmdldEVsZW1lbnRzQnlUYWdOYW1lKGUpO2lmKCIqIj09PWUpe3doaWxlKG49b1tpKytdKTE9PT1uLm5vZGVUeXBlJiZyLnB1c2gobik7cmV0dXJuIHJ9cmV0dXJuIG99LGkuZmluZC5OQU1FPVQuZ2V0QnlOYW1lJiZmdW5jdGlvbihlLG4pe3JldHVybiB0eXBlb2Ygbi5nZXRFbGVtZW50c0J5TmFtZSE9PUE/bi5nZXRFbGVtZW50c0J5TmFtZShuYW1lKTp0fSxpLmZpbmQuQ0xBU1M9VC5nZXRCeUNsYXNzTmFtZSYmZnVuY3Rpb24oZSxuKXtyZXR1cm4gdHlwZW9mIG4uZ2V0RWxlbWVudHNCeUNsYXNzTmFtZT09PUF8fGQ/dDpuLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoZSl9LGc9W10saD1bIjpmb2N1cyJdLChULnFzYT1ydChuLnF1ZXJ5U2VsZWN0b3JBbGwpKSYmKGF0KGZ1bmN0aW9uKGUpe2UuaW5uZXJIVE1MPSI8c2VsZWN0PjxvcHRpb24gc2VsZWN0ZWQ9Jyc+PC9vcHRpb24+PC9zZWxlY3Q+IixlLnF1ZXJ5U2VsZWN0b3JBbGwoIltzZWxlY3RlZF0iKS5sZW5ndGh8fGgucHVzaCgiXFxbIitfKyIqKD86Y2hlY2tlZHxkaXNhYmxlZHxpc21hcHxtdWx0aXBsZXxyZWFkb25seXxzZWxlY3RlZHx2YWx1ZSkiKSxlLnF1ZXJ5U2VsZWN0b3JBbGwoIjpjaGVja2VkIikubGVuZ3RofHxoLnB1c2goIjpjaGVja2VkIil9KSxhdChmdW5jdGlvbihlKXtlLmlubmVySFRNTD0iPGlucHV0IHR5cGU9J2hpZGRlbicgaT0nJy8+IixlLnF1ZXJ5U2VsZWN0b3JBbGwoIltpXj0nJ10iKS5sZW5ndGgmJmgucHVzaCgiWypeJF09IitfKyIqKD86XCJcInwnJykiKSxlLnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RofHxoLnB1c2goIjplbmFibGVkIiwiOmRpc2FibGVkIiksZS5xdWVyeVNlbGVjdG9yQWxsKCIqLDp4IiksaC5wdXNoKCIsLio6Iil9KSksKFQubWF0Y2hlc1NlbGVjdG9yPXJ0KG09Zi5tYXRjaGVzU2VsZWN0b3J8fGYubW96TWF0Y2hlc1NlbGVjdG9yfHxmLndlYmtpdE1hdGNoZXNTZWxlY3Rvcnx8Zi5vTWF0Y2hlc1NlbGVjdG9yfHxmLm1zTWF0Y2hlc1NlbGVjdG9yKSkmJmF0KGZ1bmN0aW9uKGUpe1QuZGlzY29ubmVjdGVkTWF0Y2g9bS5jYWxsKGUsImRpdiIpLG0uY2FsbChlLCJbcyE9JyddOngiKSxnLnB1c2goIiE9IixSKX0pLGg9UmVnRXhwKGguam9pbigifCIpKSxnPVJlZ0V4cChnLmpvaW4oInwiKSkseT1ydChmLmNvbnRhaW5zKXx8Zi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9mdW5jdGlvbihlLHQpe3ZhciBuPTk9PT1lLm5vZGVUeXBlP2UuZG9jdW1lbnRFbGVtZW50OmUscj10JiZ0LnBhcmVudE5vZGU7cmV0dXJuIGU9PT1yfHwhKCFyfHwxIT09ci5ub2RlVHlwZXx8IShuLmNvbnRhaW5zP24uY29udGFpbnMocik6ZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiYmMTYmZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihyKSkpfTpmdW5jdGlvbihlLHQpe2lmKHQpd2hpbGUodD10LnBhcmVudE5vZGUpaWYodD09PWUpcmV0dXJuITA7cmV0dXJuITF9LHY9Zi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9mdW5jdGlvbihlLHQpe3ZhciByO3JldHVybiBlPT09dD8odT0hMCwwKToocj10LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uJiZlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uJiZlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKHQpKT8xJnJ8fGUucGFyZW50Tm9kZSYmMTE9PT1lLnBhcmVudE5vZGUubm9kZVR5cGU/ZT09PW58fHkodyxlKT8tMTp0PT09bnx8eSh3LHQpPzE6MDo0JnI/LTE6MTplLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uPy0xOjF9OmZ1bmN0aW9uKGUsdCl7dmFyIHIsaT0wLG89ZS5wYXJlbnROb2RlLGE9dC5wYXJlbnROb2RlLHM9W2VdLGw9W3RdO2lmKGU9PT10KXJldHVybiB1PSEwLDA7aWYoIW98fCFhKXJldHVybiBlPT09bj8tMTp0PT09bj8xOm8/LTE6YT8xOjA7aWYobz09PWEpcmV0dXJuIHV0KGUsdCk7cj1lO3doaWxlKHI9ci5wYXJlbnROb2RlKXMudW5zaGlmdChyKTtyPXQ7d2hpbGUocj1yLnBhcmVudE5vZGUpbC51bnNoaWZ0KHIpO3doaWxlKHNbaV09PT1sW2ldKWkrKztyZXR1cm4gaT91dChzW2ldLGxbaV0pOnNbaV09PT13Py0xOmxbaV09PT13PzE6MH0sdT0hMSxbMCwwXS5zb3J0KHYpLFQuZGV0ZWN0RHVwbGljYXRlcz11LHApOnB9LHN0Lm1hdGNoZXM9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gc3QoZSxudWxsLG51bGwsdCl9LHN0Lm1hdGNoZXNTZWxlY3Rvcj1mdW5jdGlvbihlLHQpe2lmKChlLm93bmVyRG9jdW1lbnR8fGUpIT09cCYmYyhlKSx0PXQucmVwbGFjZShaLCI9JyQxJ10iKSwhKCFULm1hdGNoZXNTZWxlY3Rvcnx8ZHx8ZyYmZy50ZXN0KHQpfHxoLnRlc3QodCkpKXRyeXt2YXIgbj1tLmNhbGwoZSx0KTtpZihufHxULmRpc2Nvbm5lY3RlZE1hdGNofHxlLmRvY3VtZW50JiYxMSE9PWUuZG9jdW1lbnQubm9kZVR5cGUpcmV0dXJuIG59Y2F0Y2gocil7fXJldHVybiBzdCh0LHAsbnVsbCxbZV0pLmxlbmd0aD4wfSxzdC5jb250YWlucz1mdW5jdGlvbihlLHQpe3JldHVybihlLm93bmVyRG9jdW1lbnR8fGUpIT09cCYmYyhlKSx5KGUsdCl9LHN0LmF0dHI9ZnVuY3Rpb24oZSx0KXt2YXIgbjtyZXR1cm4oZS5vd25lckRvY3VtZW50fHxlKSE9PXAmJmMoZSksZHx8KHQ9dC50b0xvd2VyQ2FzZSgpKSwobj1pLmF0dHJIYW5kbGVbdF0pP24oZSk6ZHx8VC5hdHRyaWJ1dGVzP2UuZ2V0QXR0cmlidXRlKHQpOigobj1lLmdldEF0dHJpYnV0ZU5vZGUodCkpfHxlLmdldEF0dHJpYnV0ZSh0KSkmJmVbdF09PT0hMD90Om4mJm4uc3BlY2lmaWVkP24udmFsdWU6bnVsbH0sc3QuZXJyb3I9ZnVuY3Rpb24oZSl7dGhyb3cgRXJyb3IoIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIrZSl9LHN0LnVuaXF1ZVNvcnQ9ZnVuY3Rpb24oZSl7dmFyIHQsbj1bXSxyPTEsaT0wO2lmKHU9IVQuZGV0ZWN0RHVwbGljYXRlcyxlLnNvcnQodiksdSl7Zm9yKDt0PWVbcl07cisrKXQ9PT1lW3ItMV0mJihpPW4ucHVzaChyKSk7d2hpbGUoaS0tKWUuc3BsaWNlKG5baV0sMSl9cmV0dXJuIGV9O2Z1bmN0aW9uIHV0KGUsdCl7dmFyIG49dCYmZSxyPW4mJih+dC5zb3VyY2VJbmRleHx8aiktKH5lLnNvdXJjZUluZGV4fHxqKTtpZihyKXJldHVybiByO2lmKG4pd2hpbGUobj1uLm5leHRTaWJsaW5nKWlmKG49PT10KXJldHVybi0xO3JldHVybiBlPzE6LTF9ZnVuY3Rpb24gbHQoZSl7cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciBuPXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4iaW5wdXQiPT09biYmdC50eXBlPT09ZX19ZnVuY3Rpb24gY3QoZSl7cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciBuPXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4oImlucHV0Ij09PW58fCJidXR0b24iPT09bikmJnQudHlwZT09PWV9fWZ1bmN0aW9uIHB0KGUpe3JldHVybiBvdChmdW5jdGlvbih0KXtyZXR1cm4gdD0rdCxvdChmdW5jdGlvbihuLHIpe3ZhciBpLG89ZShbXSxuLmxlbmd0aCx0KSxhPW8ubGVuZ3RoO3doaWxlKGEtLSluW2k9b1thXV0mJihuW2ldPSEocltpXT1uW2ldKSl9KX0pfW89c3QuZ2V0VGV4dD1mdW5jdGlvbihlKXt2YXIgdCxuPSIiLHI9MCxpPWUubm9kZVR5cGU7aWYoaSl7aWYoMT09PWl8fDk9PT1pfHwxMT09PWkpe2lmKCJzdHJpbmciPT10eXBlb2YgZS50ZXh0Q29udGVudClyZXR1cm4gZS50ZXh0Q29udGVudDtmb3IoZT1lLmZpcnN0Q2hpbGQ7ZTtlPWUubmV4dFNpYmxpbmcpbis9byhlKX1lbHNlIGlmKDM9PT1pfHw0PT09aSlyZXR1cm4gZS5ub2RlVmFsdWV9ZWxzZSBmb3IoO3Q9ZVtyXTtyKyspbis9byh0KTtyZXR1cm4gbn0saT1zdC5zZWxlY3RvcnM9e2NhY2hlTGVuZ3RoOjUwLGNyZWF0ZVBzZXVkbzpvdCxtYXRjaDpVLGZpbmQ6e30scmVsYXRpdmU6eyI+Ijp7ZGlyOiJwYXJlbnROb2RlIixmaXJzdDohMH0sIiAiOntkaXI6InBhcmVudE5vZGUifSwiKyI6e2RpcjoicHJldmlvdXNTaWJsaW5nIixmaXJzdDohMH0sIn4iOntkaXI6InByZXZpb3VzU2libGluZyJ9fSxwcmVGaWx0ZXI6e0FUVFI6ZnVuY3Rpb24oZSl7cmV0dXJuIGVbMV09ZVsxXS5yZXBsYWNlKGV0LHR0KSxlWzNdPShlWzRdfHxlWzVdfHwiIikucmVwbGFjZShldCx0dCksIn49Ij09PWVbMl0mJihlWzNdPSIgIitlWzNdKyIgIiksZS5zbGljZSgwLDQpfSxDSElMRDpmdW5jdGlvbihlKXtyZXR1cm4gZVsxXT1lWzFdLnRvTG93ZXJDYXNlKCksIm50aCI9PT1lWzFdLnNsaWNlKDAsMyk/KGVbM118fHN0LmVycm9yKGVbMF0pLGVbNF09KyhlWzRdP2VbNV0rKGVbNl18fDEpOjIqKCJldmVuIj09PWVbM118fCJvZGQiPT09ZVszXSkpLGVbNV09KyhlWzddK2VbOF18fCJvZGQiPT09ZVszXSkpOmVbM10mJnN0LmVycm9yKGVbMF0pLGV9LFBTRVVETzpmdW5jdGlvbihlKXt2YXIgdCxuPSFlWzVdJiZlWzJdO3JldHVybiBVLkNISUxELnRlc3QoZVswXSk/bnVsbDooZVs0XT9lWzJdPWVbNF06biYmei50ZXN0KG4pJiYodD1mdChuLCEwKSkmJih0PW4uaW5kZXhPZigiKSIsbi5sZW5ndGgtdCktbi5sZW5ndGgpJiYoZVswXT1lWzBdLnNsaWNlKDAsdCksZVsyXT1uLnNsaWNlKDAsdCkpLGUuc2xpY2UoMCwzKSl9fSxmaWx0ZXI6e1RBRzpmdW5jdGlvbihlKXtyZXR1cm4iKiI9PT1lP2Z1bmN0aW9uKCl7cmV0dXJuITB9OihlPWUucmVwbGFjZShldCx0dCkudG9Mb3dlckNhc2UoKSxmdW5jdGlvbih0KXtyZXR1cm4gdC5ub2RlTmFtZSYmdC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ZX0pfSxDTEFTUzpmdW5jdGlvbihlKXt2YXIgdD1rW2UrIiAiXTtyZXR1cm4gdHx8KHQ9UmVnRXhwKCIoXnwiK18rIikiK2UrIigiK18rInwkKSIpKSYmayhlLGZ1bmN0aW9uKGUpe3JldHVybiB0LnRlc3QoZS5jbGFzc05hbWV8fHR5cGVvZiBlLmdldEF0dHJpYnV0ZSE9PUEmJmUuZ2V0QXR0cmlidXRlKCJjbGFzcyIpfHwiIil9KX0sQVRUUjpmdW5jdGlvbihlLHQsbil7cmV0dXJuIGZ1bmN0aW9uKHIpe3ZhciBpPXN0LmF0dHIocixlKTtyZXR1cm4gbnVsbD09aT8iIT0iPT09dDp0PyhpKz0iIiwiPSI9PT10P2k9PT1uOiIhPSI9PT10P2khPT1uOiJePSI9PT10P24mJjA9PT1pLmluZGV4T2Yobik6Iio9Ij09PXQ/biYmaS5pbmRleE9mKG4pPi0xOiIkPSI9PT10P24mJmkuc2xpY2UoLW4ubGVuZ3RoKT09PW46In49Ij09PXQ/KCIgIitpKyIgIikuaW5kZXhPZihuKT4tMToifD0iPT09dD9pPT09bnx8aS5zbGljZSgwLG4ubGVuZ3RoKzEpPT09bisiLSI6ITEpOiEwfX0sQ0hJTEQ6ZnVuY3Rpb24oZSx0LG4scixpKXt2YXIgbz0ibnRoIiE9PWUuc2xpY2UoMCwzKSxhPSJsYXN0IiE9PWUuc2xpY2UoLTQpLHM9Im9mLXR5cGUiPT09dDtyZXR1cm4gMT09PXImJjA9PT1pP2Z1bmN0aW9uKGUpe3JldHVybiEhZS5wYXJlbnROb2RlfTpmdW5jdGlvbih0LG4sdSl7dmFyIGwsYyxwLGYsZCxoLGc9byE9PWE/Im5leHRTaWJsaW5nIjoicHJldmlvdXNTaWJsaW5nIixtPXQucGFyZW50Tm9kZSx5PXMmJnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSx2PSF1JiYhcztpZihtKXtpZihvKXt3aGlsZShnKXtwPXQ7d2hpbGUocD1wW2ddKWlmKHM/cC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09eToxPT09cC5ub2RlVHlwZSlyZXR1cm4hMTtoPWc9Im9ubHkiPT09ZSYmIWgmJiJuZXh0U2libGluZyJ9cmV0dXJuITB9aWYoaD1bYT9tLmZpcnN0Q2hpbGQ6bS5sYXN0Q2hpbGRdLGEmJnYpe2M9bVt4XXx8KG1beF09e30pLGw9Y1tlXXx8W10sZD1sWzBdPT09TiYmbFsxXSxmPWxbMF09PT1OJiZsWzJdLHA9ZCYmbS5jaGlsZE5vZGVzW2RdO3doaWxlKHA9KytkJiZwJiZwW2ddfHwoZj1kPTApfHxoLnBvcCgpKWlmKDE9PT1wLm5vZGVUeXBlJiYrK2YmJnA9PT10KXtjW2VdPVtOLGQsZl07YnJlYWt9fWVsc2UgaWYodiYmKGw9KHRbeF18fCh0W3hdPXt9KSlbZV0pJiZsWzBdPT09TilmPWxbMV07ZWxzZSB3aGlsZShwPSsrZCYmcCYmcFtnXXx8KGY9ZD0wKXx8aC5wb3AoKSlpZigocz9wLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT15OjE9PT1wLm5vZGVUeXBlKSYmKytmJiYodiYmKChwW3hdfHwocFt4XT17fSkpW2VdPVtOLGZdKSxwPT09dCkpYnJlYWs7cmV0dXJuIGYtPWksZj09PXJ8fDA9PT1mJXImJmYvcj49MH19fSxQU0VVRE86ZnVuY3Rpb24oZSx0KXt2YXIgbixyPWkucHNldWRvc1tlXXx8aS5zZXRGaWx0ZXJzW2UudG9Mb3dlckNhc2UoKV18fHN0LmVycm9yKCJ1bnN1cHBvcnRlZCBwc2V1ZG86ICIrZSk7cmV0dXJuIHJbeF0/cih0KTpyLmxlbmd0aD4xPyhuPVtlLGUsIiIsdF0saS5zZXRGaWx0ZXJzLmhhc093blByb3BlcnR5KGUudG9Mb3dlckNhc2UoKSk/b3QoZnVuY3Rpb24oZSxuKXt2YXIgaSxvPXIoZSx0KSxhPW8ubGVuZ3RoO3doaWxlKGEtLSlpPU0uY2FsbChlLG9bYV0pLGVbaV09IShuW2ldPW9bYV0pfSk6ZnVuY3Rpb24oZSl7cmV0dXJuIHIoZSwwLG4pfSk6cn19LHBzZXVkb3M6e25vdDpvdChmdW5jdGlvbihlKXt2YXIgdD1bXSxuPVtdLHI9cyhlLnJlcGxhY2UoVywiJDEiKSk7cmV0dXJuIHJbeF0/b3QoZnVuY3Rpb24oZSx0LG4saSl7dmFyIG8sYT1yKGUsbnVsbCxpLFtdKSxzPWUubGVuZ3RoO3doaWxlKHMtLSkobz1hW3NdKSYmKGVbc109ISh0W3NdPW8pKX0pOmZ1bmN0aW9uKGUsaSxvKXtyZXR1cm4gdFswXT1lLHIodCxudWxsLG8sbiksIW4ucG9wKCl9fSksaGFzOm90KGZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gc3QoZSx0KS5sZW5ndGg+MH19KSxjb250YWluczpvdChmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuKHQudGV4dENvbnRlbnR8fHQuaW5uZXJUZXh0fHxvKHQpKS5pbmRleE9mKGUpPi0xfX0pLGxhbmc6b3QoZnVuY3Rpb24oZSl7cmV0dXJuIFgudGVzdChlfHwiIil8fHN0LmVycm9yKCJ1bnN1cHBvcnRlZCBsYW5nOiAiK2UpLGU9ZS5yZXBsYWNlKGV0LHR0KS50b0xvd2VyQ2FzZSgpLGZ1bmN0aW9uKHQpe3ZhciBuO2RvIGlmKG49ZD90LmdldEF0dHJpYnV0ZSgieG1sOmxhbmciKXx8dC5nZXRBdHRyaWJ1dGUoImxhbmciKTp0LmxhbmcpcmV0dXJuIG49bi50b0xvd2VyQ2FzZSgpLG49PT1lfHwwPT09bi5pbmRleE9mKGUrIi0iKTt3aGlsZSgodD10LnBhcmVudE5vZGUpJiYxPT09dC5ub2RlVHlwZSk7cmV0dXJuITF9fSksdGFyZ2V0OmZ1bmN0aW9uKHQpe3ZhciBuPWUubG9jYXRpb24mJmUubG9jYXRpb24uaGFzaDtyZXR1cm4gbiYmbi5zbGljZSgxKT09PXQuaWR9LHJvb3Q6ZnVuY3Rpb24oZSl7cmV0dXJuIGU9PT1mfSxmb2N1czpmdW5jdGlvbihlKXtyZXR1cm4gZT09PXAuYWN0aXZlRWxlbWVudCYmKCFwLmhhc0ZvY3VzfHxwLmhhc0ZvY3VzKCkpJiYhIShlLnR5cGV8fGUuaHJlZnx8fmUudGFiSW5kZXgpfSxlbmFibGVkOmZ1bmN0aW9uKGUpe3JldHVybiBlLmRpc2FibGVkPT09ITF9LGRpc2FibGVkOmZ1bmN0aW9uKGUpe3JldHVybiBlLmRpc2FibGVkPT09ITB9LGNoZWNrZWQ6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiJpbnB1dCI9PT10JiYhIWUuY2hlY2tlZHx8Im9wdGlvbiI9PT10JiYhIWUuc2VsZWN0ZWR9LHNlbGVjdGVkOmZ1bmN0aW9uKGUpe3JldHVybiBlLnBhcmVudE5vZGUmJmUucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4LGUuc2VsZWN0ZWQ9PT0hMH0sZW1wdHk6ZnVuY3Rpb24oZSl7Zm9yKGU9ZS5maXJzdENoaWxkO2U7ZT1lLm5leHRTaWJsaW5nKWlmKGUubm9kZU5hbWU+IkAifHwzPT09ZS5ub2RlVHlwZXx8ND09PWUubm9kZVR5cGUpcmV0dXJuITE7cmV0dXJuITB9LHBhcmVudDpmdW5jdGlvbihlKXtyZXR1cm4haS5wc2V1ZG9zLmVtcHR5KGUpfSxoZWFkZXI6ZnVuY3Rpb24oZSl7cmV0dXJuIFEudGVzdChlLm5vZGVOYW1lKX0saW5wdXQ6ZnVuY3Rpb24oZSl7cmV0dXJuIEcudGVzdChlLm5vZGVOYW1lKX0sYnV0dG9uOmZ1bmN0aW9uKGUpe3ZhciB0PWUubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4iaW5wdXQiPT09dCYmImJ1dHRvbiI9PT1lLnR5cGV8fCJidXR0b24iPT09dH0sdGV4dDpmdW5jdGlvbihlKXt2YXIgdDtyZXR1cm4iaW5wdXQiPT09ZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpJiYidGV4dCI9PT1lLnR5cGUmJihudWxsPT0odD1lLmdldEF0dHJpYnV0ZSgidHlwZSIpKXx8dC50b0xvd2VyQ2FzZSgpPT09ZS50eXBlKX0sZmlyc3Q6cHQoZnVuY3Rpb24oKXtyZXR1cm5bMF19KSxsYXN0OnB0KGZ1bmN0aW9uKGUsdCl7cmV0dXJuW3QtMV19KSxlcTpwdChmdW5jdGlvbihlLHQsbil7cmV0dXJuWzA+bj9uK3Q6bl19KSxldmVuOnB0KGZ1bmN0aW9uKGUsdCl7dmFyIG49MDtmb3IoO3Q+bjtuKz0yKWUucHVzaChuKTtyZXR1cm4gZX0pLG9kZDpwdChmdW5jdGlvbihlLHQpe3ZhciBuPTE7Zm9yKDt0Pm47bis9MillLnB1c2gobik7cmV0dXJuIGV9KSxsdDpwdChmdW5jdGlvbihlLHQsbil7dmFyIHI9MD5uP24rdDpuO2Zvcig7LS1yPj0wOyllLnB1c2gocik7cmV0dXJuIGV9KSxndDpwdChmdW5jdGlvbihlLHQsbil7dmFyIHI9MD5uP24rdDpuO2Zvcig7dD4rK3I7KWUucHVzaChyKTtyZXR1cm4gZX0pfX07Zm9yKG4gaW57cmFkaW86ITAsY2hlY2tib3g6ITAsZmlsZTohMCxwYXNzd29yZDohMCxpbWFnZTohMH0paS5wc2V1ZG9zW25dPWx0KG4pO2ZvcihuIGlue3N1Ym1pdDohMCxyZXNldDohMH0paS5wc2V1ZG9zW25dPWN0KG4pO2Z1bmN0aW9uIGZ0KGUsdCl7dmFyIG4scixvLGEscyx1LGwsYz1FW2UrIiAiXTtpZihjKXJldHVybiB0PzA6Yy5zbGljZSgwKTtzPWUsdT1bXSxsPWkucHJlRmlsdGVyO3doaWxlKHMpeyghbnx8KHI9JC5leGVjKHMpKSkmJihyJiYocz1zLnNsaWNlKHJbMF0ubGVuZ3RoKXx8cyksdS5wdXNoKG89W10pKSxuPSExLChyPUkuZXhlYyhzKSkmJihuPXIuc2hpZnQoKSxvLnB1c2goe3ZhbHVlOm4sdHlwZTpyWzBdLnJlcGxhY2UoVywiICIpfSkscz1zLnNsaWNlKG4ubGVuZ3RoKSk7Zm9yKGEgaW4gaS5maWx0ZXIpIShyPVVbYV0uZXhlYyhzKSl8fGxbYV0mJiEocj1sW2FdKHIpKXx8KG49ci5zaGlmdCgpLG8ucHVzaCh7dmFsdWU6bix0eXBlOmEsbWF0Y2hlczpyfSkscz1zLnNsaWNlKG4ubGVuZ3RoKSk7aWYoIW4pYnJlYWt9cmV0dXJuIHQ/cy5sZW5ndGg6cz9zdC5lcnJvcihlKTpFKGUsdSkuc2xpY2UoMCl9ZnVuY3Rpb24gZHQoZSl7dmFyIHQ9MCxuPWUubGVuZ3RoLHI9IiI7Zm9yKDtuPnQ7dCsrKXIrPWVbdF0udmFsdWU7cmV0dXJuIHJ9ZnVuY3Rpb24gaHQoZSx0LG4pe3ZhciBpPXQuZGlyLG89biYmInBhcmVudE5vZGUiPT09aSxhPUMrKztyZXR1cm4gdC5maXJzdD9mdW5jdGlvbih0LG4scil7d2hpbGUodD10W2ldKWlmKDE9PT10Lm5vZGVUeXBlfHxvKXJldHVybiBlKHQsbixyKX06ZnVuY3Rpb24odCxuLHMpe3ZhciB1LGwsYyxwPU4rIiAiK2E7aWYocyl7d2hpbGUodD10W2ldKWlmKCgxPT09dC5ub2RlVHlwZXx8bykmJmUodCxuLHMpKXJldHVybiEwfWVsc2Ugd2hpbGUodD10W2ldKWlmKDE9PT10Lm5vZGVUeXBlfHxvKWlmKGM9dFt4XXx8KHRbeF09e30pLChsPWNbaV0pJiZsWzBdPT09cCl7aWYoKHU9bFsxXSk9PT0hMHx8dT09PXIpcmV0dXJuIHU9PT0hMH1lbHNlIGlmKGw9Y1tpXT1bcF0sbFsxXT1lKHQsbixzKXx8cixsWzFdPT09ITApcmV0dXJuITB9fWZ1bmN0aW9uIGd0KGUpe3JldHVybiBlLmxlbmd0aD4xP2Z1bmN0aW9uKHQsbixyKXt2YXIgaT1lLmxlbmd0aDt3aGlsZShpLS0paWYoIWVbaV0odCxuLHIpKXJldHVybiExO3JldHVybiEwfTplWzBdfWZ1bmN0aW9uIG10KGUsdCxuLHIsaSl7dmFyIG8sYT1bXSxzPTAsdT1lLmxlbmd0aCxsPW51bGwhPXQ7Zm9yKDt1PnM7cysrKShvPWVbc10pJiYoIW58fG4obyxyLGkpKSYmKGEucHVzaChvKSxsJiZ0LnB1c2gocykpO3JldHVybiBhfWZ1bmN0aW9uIHl0KGUsdCxuLHIsaSxvKXtyZXR1cm4gciYmIXJbeF0mJihyPXl0KHIpKSxpJiYhaVt4XSYmKGk9eXQoaSxvKSksb3QoZnVuY3Rpb24obyxhLHMsdSl7dmFyIGwsYyxwLGY9W10sZD1bXSxoPWEubGVuZ3RoLGc9b3x8eHQodHx8IioiLHMubm9kZVR5cGU/W3NdOnMsW10pLG09IWV8fCFvJiZ0P2c6bXQoZyxmLGUscyx1KSx5PW4/aXx8KG8/ZTpofHxyKT9bXTphOm07aWYobiYmbihtLHkscyx1KSxyKXtsPW10KHksZCkscihsLFtdLHMsdSksYz1sLmxlbmd0aDt3aGlsZShjLS0pKHA9bFtjXSkmJih5W2RbY11dPSEobVtkW2NdXT1wKSl9aWYobyl7aWYoaXx8ZSl7aWYoaSl7bD1bXSxjPXkubGVuZ3RoO3doaWxlKGMtLSkocD15W2NdKSYmbC5wdXNoKG1bY109cCk7aShudWxsLHk9W10sbCx1KX1jPXkubGVuZ3RoO3doaWxlKGMtLSkocD15W2NdKSYmKGw9aT9NLmNhbGwobyxwKTpmW2NdKT4tMSYmKG9bbF09IShhW2xdPXApKX19ZWxzZSB5PW10KHk9PT1hP3kuc3BsaWNlKGgseS5sZW5ndGgpOnkpLGk/aShudWxsLGEseSx1KTpILmFwcGx5KGEseSl9KX1mdW5jdGlvbiB2dChlKXt2YXIgdCxuLHIsbz1lLmxlbmd0aCxhPWkucmVsYXRpdmVbZVswXS50eXBlXSxzPWF8fGkucmVsYXRpdmVbIiAiXSx1PWE/MTowLGM9aHQoZnVuY3Rpb24oZSl7cmV0dXJuIGU9PT10fSxzLCEwKSxwPWh0KGZ1bmN0aW9uKGUpe3JldHVybiBNLmNhbGwodCxlKT4tMX0scywhMCksZj1bZnVuY3Rpb24oZSxuLHIpe3JldHVybiFhJiYocnx8biE9PWwpfHwoKHQ9bikubm9kZVR5cGU/YyhlLG4scik6cChlLG4scikpfV07Zm9yKDtvPnU7dSsrKWlmKG49aS5yZWxhdGl2ZVtlW3VdLnR5cGVdKWY9W2h0KGd0KGYpLG4pXTtlbHNle2lmKG49aS5maWx0ZXJbZVt1XS50eXBlXS5hcHBseShudWxsLGVbdV0ubWF0Y2hlcyksblt4XSl7Zm9yKHI9Kyt1O28+cjtyKyspaWYoaS5yZWxhdGl2ZVtlW3JdLnR5cGVdKWJyZWFrO3JldHVybiB5dCh1PjEmJmd0KGYpLHU+MSYmZHQoZS5zbGljZSgwLHUtMSkpLnJlcGxhY2UoVywiJDEiKSxuLHI+dSYmdnQoZS5zbGljZSh1LHIpKSxvPnImJnZ0KGU9ZS5zbGljZShyKSksbz5yJiZkdChlKSl9Zi5wdXNoKG4pfXJldHVybiBndChmKX1mdW5jdGlvbiBidChlLHQpe3ZhciBuPTAsbz10Lmxlbmd0aD4wLGE9ZS5sZW5ndGg+MCxzPWZ1bmN0aW9uKHMsdSxjLGYsZCl7dmFyIGgsZyxtLHk9W10sdj0wLGI9IjAiLHg9cyYmW10sdz1udWxsIT1kLFQ9bCxDPXN8fGEmJmkuZmluZC5UQUcoIioiLGQmJnUucGFyZW50Tm9kZXx8dSksaz1OKz1udWxsPT1UPzE6TWF0aC5yYW5kb20oKXx8LjE7Zm9yKHcmJihsPXUhPT1wJiZ1LHI9bik7bnVsbCE9KGg9Q1tiXSk7YisrKXtpZihhJiZoKXtnPTA7d2hpbGUobT1lW2crK10paWYobShoLHUsYykpe2YucHVzaChoKTticmVha313JiYoTj1rLHI9KytuKX1vJiYoKGg9IW0mJmgpJiZ2LS0scyYmeC5wdXNoKGgpKX1pZih2Kz1iLG8mJmIhPT12KXtnPTA7d2hpbGUobT10W2crK10pbSh4LHksdSxjKTtpZihzKXtpZih2PjApd2hpbGUoYi0tKXhbYl18fHlbYl18fCh5W2JdPUwuY2FsbChmKSk7eT1tdCh5KX1ILmFwcGx5KGYseSksdyYmIXMmJnkubGVuZ3RoPjAmJnYrdC5sZW5ndGg+MSYmc3QudW5pcXVlU29ydChmKX1yZXR1cm4gdyYmKE49ayxsPVQpLHh9O3JldHVybiBvP290KHMpOnN9cz1zdC5jb21waWxlPWZ1bmN0aW9uKGUsdCl7dmFyIG4scj1bXSxpPVtdLG89U1tlKyIgIl07aWYoIW8pe3R8fCh0PWZ0KGUpKSxuPXQubGVuZ3RoO3doaWxlKG4tLSlvPXZ0KHRbbl0pLG9beF0/ci5wdXNoKG8pOmkucHVzaChvKTtvPVMoZSxidChpLHIpKX1yZXR1cm4gb307ZnVuY3Rpb24geHQoZSx0LG4pe3ZhciByPTAsaT10Lmxlbmd0aDtmb3IoO2k+cjtyKyspc3QoZSx0W3JdLG4pO3JldHVybiBufWZ1bmN0aW9uIHd0KGUsdCxuLHIpe3ZhciBvLGEsdSxsLGMscD1mdChlKTtpZighciYmMT09PXAubGVuZ3RoKXtpZihhPXBbMF09cFswXS5zbGljZSgwKSxhLmxlbmd0aD4yJiYiSUQiPT09KHU9YVswXSkudHlwZSYmOT09PXQubm9kZVR5cGUmJiFkJiZpLnJlbGF0aXZlW2FbMV0udHlwZV0pe2lmKHQ9aS5maW5kLklEKHUubWF0Y2hlc1swXS5yZXBsYWNlKGV0LHR0KSx0KVswXSwhdClyZXR1cm4gbjtlPWUuc2xpY2UoYS5zaGlmdCgpLnZhbHVlLmxlbmd0aCl9bz1VLm5lZWRzQ29udGV4dC50ZXN0KGUpPzA6YS5sZW5ndGg7d2hpbGUoby0tKXtpZih1PWFbb10saS5yZWxhdGl2ZVtsPXUudHlwZV0pYnJlYWs7aWYoKGM9aS5maW5kW2xdKSYmKHI9Yyh1Lm1hdGNoZXNbMF0ucmVwbGFjZShldCx0dCksVi50ZXN0KGFbMF0udHlwZSkmJnQucGFyZW50Tm9kZXx8dCkpKXtpZihhLnNwbGljZShvLDEpLGU9ci5sZW5ndGgmJmR0KGEpLCFlKXJldHVybiBILmFwcGx5KG4scS5jYWxsKHIsMCkpLG47YnJlYWt9fX1yZXR1cm4gcyhlLHApKHIsdCxkLG4sVi50ZXN0KGUpKSxufWkucHNldWRvcy5udGg9aS5wc2V1ZG9zLmVxO2Z1bmN0aW9uIFR0KCl7fWkuZmlsdGVycz1UdC5wcm90b3R5cGU9aS5wc2V1ZG9zLGkuc2V0RmlsdGVycz1uZXcgVHQsYygpLHN0LmF0dHI9Yi5hdHRyLGIuZmluZD1zdCxiLmV4cHI9c3Quc2VsZWN0b3JzLGIuZXhwclsiOiJdPWIuZXhwci5wc2V1ZG9zLGIudW5pcXVlPXN0LnVuaXF1ZVNvcnQsYi50ZXh0PXN0LmdldFRleHQsYi5pc1hNTERvYz1zdC5pc1hNTCxiLmNvbnRhaW5zPXN0LmNvbnRhaW5zfShlKTt2YXIgYXQ9L1VudGlsJC8sc3Q9L14oPzpwYXJlbnRzfHByZXYoPzpVbnRpbHxBbGwpKS8sdXQ9L14uW146I1xbXC4sXSokLyxsdD1iLmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LGN0PXtjaGlsZHJlbjohMCxjb250ZW50czohMCxuZXh0OiEwLHByZXY6ITB9O2IuZm4uZXh0ZW5kKHtmaW5kOmZ1bmN0aW9uKGUpe3ZhciB0LG4scixpPXRoaXMubGVuZ3RoO2lmKCJzdHJpbmciIT10eXBlb2YgZSlyZXR1cm4gcj10aGlzLHRoaXMucHVzaFN0YWNrKGIoZSkuZmlsdGVyKGZ1bmN0aW9uKCl7Zm9yKHQ9MDtpPnQ7dCsrKWlmKGIuY29udGFpbnMoclt0XSx0aGlzKSlyZXR1cm4hMH0pKTtmb3Iobj1bXSx0PTA7aT50O3QrKyliLmZpbmQoZSx0aGlzW3RdLG4pO3JldHVybiBuPXRoaXMucHVzaFN0YWNrKGk+MT9iLnVuaXF1ZShuKTpuKSxuLnNlbGVjdG9yPSh0aGlzLnNlbGVjdG9yP3RoaXMuc2VsZWN0b3IrIiAiOiIiKStlLG59LGhhczpmdW5jdGlvbihlKXt2YXIgdCxuPWIoZSx0aGlzKSxyPW4ubGVuZ3RoO3JldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpe2Zvcih0PTA7cj50O3QrKylpZihiLmNvbnRhaW5zKHRoaXMsblt0XSkpcmV0dXJuITB9KX0sbm90OmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnB1c2hTdGFjayhmdCh0aGlzLGUsITEpKX0sZmlsdGVyOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnB1c2hTdGFjayhmdCh0aGlzLGUsITApKX0saXM6ZnVuY3Rpb24oZSl7cmV0dXJuISFlJiYoInN0cmluZyI9PXR5cGVvZiBlP2x0LnRlc3QoZSk/YihlLHRoaXMuY29udGV4dCkuaW5kZXgodGhpc1swXSk+PTA6Yi5maWx0ZXIoZSx0aGlzKS5sZW5ndGg+MDp0aGlzLmZpbHRlcihlKS5sZW5ndGg+MCl9LGNsb3Nlc3Q6ZnVuY3Rpb24oZSx0KXt2YXIgbixyPTAsaT10aGlzLmxlbmd0aCxvPVtdLGE9bHQudGVzdChlKXx8InN0cmluZyIhPXR5cGVvZiBlP2IoZSx0fHx0aGlzLmNvbnRleHQpOjA7Zm9yKDtpPnI7cisrKXtuPXRoaXNbcl07d2hpbGUobiYmbi5vd25lckRvY3VtZW50JiZuIT09dCYmMTEhPT1uLm5vZGVUeXBlKXtpZihhP2EuaW5kZXgobik+LTE6Yi5maW5kLm1hdGNoZXNTZWxlY3RvcihuLGUpKXtvLnB1c2gobik7YnJlYWt9bj1uLnBhcmVudE5vZGV9fXJldHVybiB0aGlzLnB1c2hTdGFjayhvLmxlbmd0aD4xP2IudW5pcXVlKG8pOm8pfSxpbmRleDpmdW5jdGlvbihlKXtyZXR1cm4gZT8ic3RyaW5nIj09dHlwZW9mIGU/Yi5pbkFycmF5KHRoaXNbMF0sYihlKSk6Yi5pbkFycmF5KGUuanF1ZXJ5P2VbMF06ZSx0aGlzKTp0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGU/dGhpcy5maXJzdCgpLnByZXZBbGwoKS5sZW5ndGg6LTF9LGFkZDpmdW5jdGlvbihlLHQpe3ZhciBuPSJzdHJpbmciPT10eXBlb2YgZT9iKGUsdCk6Yi5tYWtlQXJyYXkoZSYmZS5ub2RlVHlwZT9bZV06ZSkscj1iLm1lcmdlKHRoaXMuZ2V0KCksbik7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGIudW5pcXVlKHIpKX0sYWRkQmFjazpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5hZGQobnVsbD09ZT90aGlzLnByZXZPYmplY3Q6dGhpcy5wcmV2T2JqZWN0LmZpbHRlcihlKSl9fSksYi5mbi5hbmRTZWxmPWIuZm4uYWRkQmFjaztmdW5jdGlvbiBwdChlLHQpe2RvIGU9ZVt0XTt3aGlsZShlJiYxIT09ZS5ub2RlVHlwZSk7cmV0dXJuIGV9Yi5lYWNoKHtwYXJlbnQ6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wYXJlbnROb2RlO3JldHVybiB0JiYxMSE9PXQubm9kZVR5cGU/dDpudWxsfSxwYXJlbnRzOmZ1bmN0aW9uKGUpe3JldHVybiBiLmRpcihlLCJwYXJlbnROb2RlIil9LHBhcmVudHNVbnRpbDpmdW5jdGlvbihlLHQsbil7cmV0dXJuIGIuZGlyKGUsInBhcmVudE5vZGUiLG4pfSxuZXh0OmZ1bmN0aW9uKGUpe3JldHVybiBwdChlLCJuZXh0U2libGluZyIpfSxwcmV2OmZ1bmN0aW9uKGUpe3JldHVybiBwdChlLCJwcmV2aW91c1NpYmxpbmciKX0sbmV4dEFsbDpmdW5jdGlvbihlKXtyZXR1cm4gYi5kaXIoZSwibmV4dFNpYmxpbmciKX0scHJldkFsbDpmdW5jdGlvbihlKXtyZXR1cm4gYi5kaXIoZSwicHJldmlvdXNTaWJsaW5nIil9LG5leHRVbnRpbDpmdW5jdGlvbihlLHQsbil7cmV0dXJuIGIuZGlyKGUsIm5leHRTaWJsaW5nIixuKX0scHJldlVudGlsOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gYi5kaXIoZSwicHJldmlvdXNTaWJsaW5nIixuKX0sc2libGluZ3M6ZnVuY3Rpb24oZSl7cmV0dXJuIGIuc2libGluZygoZS5wYXJlbnROb2RlfHx7fSkuZmlyc3RDaGlsZCxlKX0sY2hpbGRyZW46ZnVuY3Rpb24oZSl7cmV0dXJuIGIuc2libGluZyhlLmZpcnN0Q2hpbGQpfSxjb250ZW50czpmdW5jdGlvbihlKXtyZXR1cm4gYi5ub2RlTmFtZShlLCJpZnJhbWUiKT9lLmNvbnRlbnREb2N1bWVudHx8ZS5jb250ZW50V2luZG93LmRvY3VtZW50OmIubWVyZ2UoW10sZS5jaGlsZE5vZGVzKX19LGZ1bmN0aW9uKGUsdCl7Yi5mbltlXT1mdW5jdGlvbihuLHIpe3ZhciBpPWIubWFwKHRoaXMsdCxuKTtyZXR1cm4gYXQudGVzdChlKXx8KHI9biksciYmInN0cmluZyI9PXR5cGVvZiByJiYoaT1iLmZpbHRlcihyLGkpKSxpPXRoaXMubGVuZ3RoPjEmJiFjdFtlXT9iLnVuaXF1ZShpKTppLHRoaXMubGVuZ3RoPjEmJnN0LnRlc3QoZSkmJihpPWkucmV2ZXJzZSgpKSx0aGlzLnB1c2hTdGFjayhpKX19KSxiLmV4dGVuZCh7ZmlsdGVyOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gbiYmKGU9Ijpub3QoIitlKyIpIiksMT09PXQubGVuZ3RoP2IuZmluZC5tYXRjaGVzU2VsZWN0b3IodFswXSxlKT9bdFswXV06W106Yi5maW5kLm1hdGNoZXMoZSx0KX0sZGlyOmZ1bmN0aW9uKGUsbixyKXt2YXIgaT1bXSxvPWVbbl07d2hpbGUobyYmOSE9PW8ubm9kZVR5cGUmJihyPT09dHx8MSE9PW8ubm9kZVR5cGV8fCFiKG8pLmlzKHIpKSkxPT09by5ub2RlVHlwZSYmaS5wdXNoKG8pLG89b1tuXTtyZXR1cm4gaX0sc2libGluZzpmdW5jdGlvbihlLHQpe3ZhciBuPVtdO2Zvcig7ZTtlPWUubmV4dFNpYmxpbmcpMT09PWUubm9kZVR5cGUmJmUhPT10JiZuLnB1c2goZSk7cmV0dXJuIG59fSk7ZnVuY3Rpb24gZnQoZSx0LG4pe2lmKHQ9dHx8MCxiLmlzRnVuY3Rpb24odCkpcmV0dXJuIGIuZ3JlcChlLGZ1bmN0aW9uKGUscil7dmFyIGk9ISF0LmNhbGwoZSxyLGUpO3JldHVybiBpPT09bn0pO2lmKHQubm9kZVR5cGUpcmV0dXJuIGIuZ3JlcChlLGZ1bmN0aW9uKGUpe3JldHVybiBlPT09dD09PW59KTtpZigic3RyaW5nIj09dHlwZW9mIHQpe3ZhciByPWIuZ3JlcChlLGZ1bmN0aW9uKGUpe3JldHVybiAxPT09ZS5ub2RlVHlwZX0pO2lmKHV0LnRlc3QodCkpcmV0dXJuIGIuZmlsdGVyKHQsciwhbik7dD1iLmZpbHRlcih0LHIpfXJldHVybiBiLmdyZXAoZSxmdW5jdGlvbihlKXtyZXR1cm4gYi5pbkFycmF5KGUsdCk+PTA9PT1ufSl9ZnVuY3Rpb24gZHQoZSl7dmFyIHQ9aHQuc3BsaXQoInwiKSxuPWUuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO2lmKG4uY3JlYXRlRWxlbWVudCl3aGlsZSh0Lmxlbmd0aCluLmNyZWF0ZUVsZW1lbnQodC5wb3AoKSk7cmV0dXJuIG59dmFyIGh0PSJhYmJyfGFydGljbGV8YXNpZGV8YXVkaW98YmRpfGNhbnZhc3xkYXRhfGRhdGFsaXN0fGRldGFpbHN8ZmlnY2FwdGlvbnxmaWd1cmV8Zm9vdGVyfGhlYWRlcnxoZ3JvdXB8bWFya3xtZXRlcnxuYXZ8b3V0cHV0fHByb2dyZXNzfHNlY3Rpb258c3VtbWFyeXx0aW1lfHZpZGVvIixndD0vIGpRdWVyeVxkKz0iKD86bnVsbHxcZCspIi9nLG10PVJlZ0V4cCgiPCg/OiIraHQrIilbXFxzLz5dIiwiaSIpLHl0PS9eXHMrLyx2dD0vPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXHc6XSspW14+XSopXC8+L2dpLGJ0PS88KFtcdzpdKykvLHh0PS88dGJvZHkvaSx3dD0vPHwmIz9cdys7LyxUdD0vPCg/OnNjcmlwdHxzdHlsZXxsaW5rKS9pLE50PS9eKD86Y2hlY2tib3h8cmFkaW8pJC9pLEN0PS9jaGVja2VkXHMqKD86W149XXw9XHMqLmNoZWNrZWQuKS9pLGt0PS9eJHxcLyg/OmphdmF8ZWNtYSlzY3JpcHQvaSxFdD0vXnRydWVcLyguKikvLFN0PS9eXHMqPCEoPzpcW0NEQVRBXFt8LS0pfCg/OlxdXF18LS0pPlxzKiQvZyxBdD17b3B0aW9uOlsxLCI8c2VsZWN0IG11bHRpcGxlPSdtdWx0aXBsZSc+IiwiPC9zZWxlY3Q+Il0sbGVnZW5kOlsxLCI8ZmllbGRzZXQ+IiwiPC9maWVsZHNldD4iXSxhcmVhOlsxLCI8bWFwPiIsIjwvbWFwPiJdLHBhcmFtOlsxLCI8b2JqZWN0PiIsIjwvb2JqZWN0PiJdLHRoZWFkOlsxLCI8dGFibGU+IiwiPC90YWJsZT4iXSx0cjpbMiwiPHRhYmxlPjx0Ym9keT4iLCI8L3Rib2R5PjwvdGFibGU+Il0sY29sOlsyLCI8dGFibGU+PHRib2R5PjwvdGJvZHk+PGNvbGdyb3VwPiIsIjwvY29sZ3JvdXA+PC90YWJsZT4iXSx0ZDpbMywiPHRhYmxlPjx0Ym9keT48dHI+IiwiPC90cj48L3Rib2R5PjwvdGFibGU+Il0sX2RlZmF1bHQ6Yi5zdXBwb3J0Lmh0bWxTZXJpYWxpemU/WzAsIiIsIiJdOlsxLCJYPGRpdj4iLCI8L2Rpdj4iXX0sanQ9ZHQobyksRHQ9anQuYXBwZW5kQ2hpbGQoby5jcmVhdGVFbGVtZW50KCJkaXYiKSk7QXQub3B0Z3JvdXA9QXQub3B0aW9uLEF0LnRib2R5PUF0LnRmb290PUF0LmNvbGdyb3VwPUF0LmNhcHRpb249QXQudGhlYWQsQXQudGg9QXQudGQsYi5mbi5leHRlbmQoe3RleHQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGIuYWNjZXNzKHRoaXMsZnVuY3Rpb24oZSl7cmV0dXJuIGU9PT10P2IudGV4dCh0aGlzKTp0aGlzLmVtcHR5KCkuYXBwZW5kKCh0aGlzWzBdJiZ0aGlzWzBdLm93bmVyRG9jdW1lbnR8fG8pLmNyZWF0ZVRleHROb2RlKGUpKX0sbnVsbCxlLGFyZ3VtZW50cy5sZW5ndGgpfSx3cmFwQWxsOmZ1bmN0aW9uKGUpe2lmKGIuaXNGdW5jdGlvbihlKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKHQpe2IodGhpcykud3JhcEFsbChlLmNhbGwodGhpcyx0KSl9KTtpZih0aGlzWzBdKXt2YXIgdD1iKGUsdGhpc1swXS5vd25lckRvY3VtZW50KS5lcSgwKS5jbG9uZSghMCk7dGhpc1swXS5wYXJlbnROb2RlJiZ0Lmluc2VydEJlZm9yZSh0aGlzWzBdKSx0Lm1hcChmdW5jdGlvbigpe3ZhciBlPXRoaXM7d2hpbGUoZS5maXJzdENoaWxkJiYxPT09ZS5maXJzdENoaWxkLm5vZGVUeXBlKWU9ZS5maXJzdENoaWxkO3JldHVybiBlfSkuYXBwZW5kKHRoaXMpfXJldHVybiB0aGlzfSx3cmFwSW5uZXI6ZnVuY3Rpb24oZSl7cmV0dXJuIGIuaXNGdW5jdGlvbihlKT90aGlzLmVhY2goZnVuY3Rpb24odCl7Yih0aGlzKS53cmFwSW5uZXIoZS5jYWxsKHRoaXMsdCkpfSk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIHQ9Yih0aGlzKSxuPXQuY29udGVudHMoKTtuLmxlbmd0aD9uLndyYXBBbGwoZSk6dC5hcHBlbmQoZSl9KX0sd3JhcDpmdW5jdGlvbihlKXt2YXIgdD1iLmlzRnVuY3Rpb24oZSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihuKXtiKHRoaXMpLndyYXBBbGwodD9lLmNhbGwodGhpcyxuKTplKX0pfSx1bndyYXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCl7Yi5ub2RlTmFtZSh0aGlzLCJib2R5Iil8fGIodGhpcykucmVwbGFjZVdpdGgodGhpcy5jaGlsZE5vZGVzKX0pLmVuZCgpfSxhcHBlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITAsZnVuY3Rpb24oZSl7KDE9PT10aGlzLm5vZGVUeXBlfHwxMT09PXRoaXMubm9kZVR5cGV8fDk9PT10aGlzLm5vZGVUeXBlKSYmdGhpcy5hcHBlbmRDaGlsZChlKX0pfSxwcmVwZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCEwLGZ1bmN0aW9uKGUpeygxPT09dGhpcy5ub2RlVHlwZXx8MTE9PT10aGlzLm5vZGVUeXBlfHw5PT09dGhpcy5ub2RlVHlwZSkmJnRoaXMuaW5zZXJ0QmVmb3JlKGUsdGhpcy5maXJzdENoaWxkKX0pfSxiZWZvcmU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITEsZnVuY3Rpb24oZSl7dGhpcy5wYXJlbnROb2RlJiZ0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGUsdGhpcyl9KX0sYWZ0ZXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITEsZnVuY3Rpb24oZSl7dGhpcy5wYXJlbnROb2RlJiZ0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGUsdGhpcy5uZXh0U2libGluZyl9KX0scmVtb3ZlOmZ1bmN0aW9uKGUsdCl7dmFyIG4scj0wO2Zvcig7bnVsbCE9KG49dGhpc1tyXSk7cisrKSghZXx8Yi5maWx0ZXIoZSxbbl0pLmxlbmd0aD4wKSYmKHR8fDEhPT1uLm5vZGVUeXBlfHxiLmNsZWFuRGF0YShPdChuKSksbi5wYXJlbnROb2RlJiYodCYmYi5jb250YWlucyhuLm93bmVyRG9jdW1lbnQsbikmJk10KE90KG4sInNjcmlwdCIpKSxuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobikpKTtyZXR1cm4gdGhpc30sZW1wdHk6ZnVuY3Rpb24oKXt2YXIgZSx0PTA7Zm9yKDtudWxsIT0oZT10aGlzW3RdKTt0KyspezE9PT1lLm5vZGVUeXBlJiZiLmNsZWFuRGF0YShPdChlLCExKSk7d2hpbGUoZS5maXJzdENoaWxkKWUucmVtb3ZlQ2hpbGQoZS5maXJzdENoaWxkKTtlLm9wdGlvbnMmJmIubm9kZU5hbWUoZSwic2VsZWN0IikmJihlLm9wdGlvbnMubGVuZ3RoPTApfXJldHVybiB0aGlzfSxjbG9uZTpmdW5jdGlvbihlLHQpe3JldHVybiBlPW51bGw9PWU/ITE6ZSx0PW51bGw9PXQ/ZTp0LHRoaXMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGIuY2xvbmUodGhpcyxlLHQpfSl9LGh0bWw6ZnVuY3Rpb24oZSl7cmV0dXJuIGIuYWNjZXNzKHRoaXMsZnVuY3Rpb24oZSl7dmFyIG49dGhpc1swXXx8e30scj0wLGk9dGhpcy5sZW5ndGg7aWYoZT09PXQpcmV0dXJuIDE9PT1uLm5vZGVUeXBlP24uaW5uZXJIVE1MLnJlcGxhY2UoZ3QsIiIpOnQ7aWYoISgic3RyaW5nIiE9dHlwZW9mIGV8fFR0LnRlc3QoZSl8fCFiLnN1cHBvcnQuaHRtbFNlcmlhbGl6ZSYmbXQudGVzdChlKXx8IWIuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSYmeXQudGVzdChlKXx8QXRbKGJ0LmV4ZWMoZSl8fFsiIiwiIl0pWzFdLnRvTG93ZXJDYXNlKCldKSl7ZT1lLnJlcGxhY2UodnQsIjwkMT48LyQyPiIpO3RyeXtmb3IoO2k+cjtyKyspbj10aGlzW3JdfHx7fSwxPT09bi5ub2RlVHlwZSYmKGIuY2xlYW5EYXRhKE90KG4sITEpKSxuLmlubmVySFRNTD1lKTtuPTB9Y2F0Y2gobyl7fX1uJiZ0aGlzLmVtcHR5KCkuYXBwZW5kKGUpfSxudWxsLGUsYXJndW1lbnRzLmxlbmd0aCl9LHJlcGxhY2VXaXRoOmZ1bmN0aW9uKGUpe3ZhciB0PWIuaXNGdW5jdGlvbihlKTtyZXR1cm4gdHx8InN0cmluZyI9PXR5cGVvZiBlfHwoZT1iKGUpLm5vdCh0aGlzKS5kZXRhY2goKSksdGhpcy5kb21NYW5pcChbZV0sITAsZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5uZXh0U2libGluZyxuPXRoaXMucGFyZW50Tm9kZTtuJiYoYih0aGlzKS5yZW1vdmUoKSxuLmluc2VydEJlZm9yZShlLHQpKX0pfSxkZXRhY2g6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucmVtb3ZlKGUsITApfSxkb21NYW5pcDpmdW5jdGlvbihlLG4scil7ZT1mLmFwcGx5KFtdLGUpO3ZhciBpLG8sYSxzLHUsbCxjPTAscD10aGlzLmxlbmd0aCxkPXRoaXMsaD1wLTEsZz1lWzBdLG09Yi5pc0Z1bmN0aW9uKGcpO2lmKG18fCEoMT49cHx8InN0cmluZyIhPXR5cGVvZiBnfHxiLnN1cHBvcnQuY2hlY2tDbG9uZSkmJkN0LnRlc3QoZykpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihpKXt2YXIgbz1kLmVxKGkpO20mJihlWzBdPWcuY2FsbCh0aGlzLGksbj9vLmh0bWwoKTp0KSksby5kb21NYW5pcChlLG4scil9KTtpZihwJiYobD1iLmJ1aWxkRnJhZ21lbnQoZSx0aGlzWzBdLm93bmVyRG9jdW1lbnQsITEsdGhpcyksaT1sLmZpcnN0Q2hpbGQsMT09PWwuY2hpbGROb2Rlcy5sZW5ndGgmJihsPWkpLGkpKXtmb3Iobj1uJiZiLm5vZGVOYW1lKGksInRyIikscz1iLm1hcChPdChsLCJzY3JpcHQiKSxIdCksYT1zLmxlbmd0aDtwPmM7YysrKW89bCxjIT09aCYmKG89Yi5jbG9uZShvLCEwLCEwKSxhJiZiLm1lcmdlKHMsT3Qobywic2NyaXB0IikpKSxyLmNhbGwobiYmYi5ub2RlTmFtZSh0aGlzW2NdLCJ0YWJsZSIpP0x0KHRoaXNbY10sInRib2R5Iik6dGhpc1tjXSxvLGMpO2lmKGEpZm9yKHU9c1tzLmxlbmd0aC0xXS5vd25lckRvY3VtZW50LGIubWFwKHMscXQpLGM9MDthPmM7YysrKW89c1tjXSxrdC50ZXN0KG8udHlwZXx8IiIpJiYhYi5fZGF0YShvLCJnbG9iYWxFdmFsIikmJmIuY29udGFpbnModSxvKSYmKG8uc3JjP2IuYWpheCh7dXJsOm8uc3JjLHR5cGU6IkdFVCIsZGF0YVR5cGU6InNjcmlwdCIsYXN5bmM6ITEsZ2xvYmFsOiExLCJ0aHJvd3MiOiEwfSk6Yi5nbG9iYWxFdmFsKChvLnRleHR8fG8udGV4dENvbnRlbnR8fG8uaW5uZXJIVE1MfHwiIikucmVwbGFjZShTdCwiIikpKTtsPWk9bnVsbH1yZXR1cm4gdGhpc319KTtmdW5jdGlvbiBMdChlLHQpe3JldHVybiBlLmdldEVsZW1lbnRzQnlUYWdOYW1lKHQpWzBdfHxlLmFwcGVuZENoaWxkKGUub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KHQpKX1mdW5jdGlvbiBIdChlKXt2YXIgdD1lLmdldEF0dHJpYnV0ZU5vZGUoInR5cGUiKTtyZXR1cm4gZS50eXBlPSh0JiZ0LnNwZWNpZmllZCkrIi8iK2UudHlwZSxlfWZ1bmN0aW9uIHF0KGUpe3ZhciB0PUV0LmV4ZWMoZS50eXBlKTtyZXR1cm4gdD9lLnR5cGU9dFsxXTplLnJlbW92ZUF0dHJpYnV0ZSgidHlwZSIpLGV9ZnVuY3Rpb24gTXQoZSx0KXt2YXIgbixyPTA7Zm9yKDtudWxsIT0obj1lW3JdKTtyKyspYi5fZGF0YShuLCJnbG9iYWxFdmFsIiwhdHx8Yi5fZGF0YSh0W3JdLCJnbG9iYWxFdmFsIikpfWZ1bmN0aW9uIF90KGUsdCl7aWYoMT09PXQubm9kZVR5cGUmJmIuaGFzRGF0YShlKSl7dmFyIG4scixpLG89Yi5fZGF0YShlKSxhPWIuX2RhdGEodCxvKSxzPW8uZXZlbnRzO2lmKHMpe2RlbGV0ZSBhLmhhbmRsZSxhLmV2ZW50cz17fTtmb3IobiBpbiBzKWZvcihyPTAsaT1zW25dLmxlbmd0aDtpPnI7cisrKWIuZXZlbnQuYWRkKHQsbixzW25dW3JdKX1hLmRhdGEmJihhLmRhdGE9Yi5leHRlbmQoe30sYS5kYXRhKSl9fWZ1bmN0aW9uIEZ0KGUsdCl7dmFyIG4scixpO2lmKDE9PT10Lm5vZGVUeXBlKXtpZihuPXQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwhYi5zdXBwb3J0Lm5vQ2xvbmVFdmVudCYmdFtiLmV4cGFuZG9dKXtpPWIuX2RhdGEodCk7Zm9yKHIgaW4gaS5ldmVudHMpYi5yZW1vdmVFdmVudCh0LHIsaS5oYW5kbGUpO3QucmVtb3ZlQXR0cmlidXRlKGIuZXhwYW5kbyl9InNjcmlwdCI9PT1uJiZ0LnRleHQhPT1lLnRleHQ/KEh0KHQpLnRleHQ9ZS50ZXh0LHF0KHQpKToib2JqZWN0Ij09PW4/KHQucGFyZW50Tm9kZSYmKHQub3V0ZXJIVE1MPWUub3V0ZXJIVE1MKSxiLnN1cHBvcnQuaHRtbDVDbG9uZSYmZS5pbm5lckhUTUwmJiFiLnRyaW0odC5pbm5lckhUTUwpJiYodC5pbm5lckhUTUw9ZS5pbm5lckhUTUwpKToiaW5wdXQiPT09biYmTnQudGVzdChlLnR5cGUpPyh0LmRlZmF1bHRDaGVja2VkPXQuY2hlY2tlZD1lLmNoZWNrZWQsdC52YWx1ZSE9PWUudmFsdWUmJih0LnZhbHVlPWUudmFsdWUpKToib3B0aW9uIj09PW4/dC5kZWZhdWx0U2VsZWN0ZWQ9dC5zZWxlY3RlZD1lLmRlZmF1bHRTZWxlY3RlZDooImlucHV0Ij09PW58fCJ0ZXh0YXJlYSI9PT1uKSYmKHQuZGVmYXVsdFZhbHVlPWUuZGVmYXVsdFZhbHVlKX19Yi5lYWNoKHthcHBlbmRUbzoiYXBwZW5kIixwcmVwZW5kVG86InByZXBlbmQiLGluc2VydEJlZm9yZToiYmVmb3JlIixpbnNlcnRBZnRlcjoiYWZ0ZXIiLHJlcGxhY2VBbGw6InJlcGxhY2VXaXRoIn0sZnVuY3Rpb24oZSx0KXtiLmZuW2VdPWZ1bmN0aW9uKGUpe3ZhciBuLHI9MCxpPVtdLG89YihlKSxhPW8ubGVuZ3RoLTE7Zm9yKDthPj1yO3IrKyluPXI9PT1hP3RoaXM6dGhpcy5jbG9uZSghMCksYihvW3JdKVt0XShuKSxkLmFwcGx5KGksbi5nZXQoKSk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGkpfX0pO2Z1bmN0aW9uIE90KGUsbil7dmFyIHIsbyxhPTAscz10eXBlb2YgZS5nZXRFbGVtZW50c0J5VGFnTmFtZSE9PWk/ZS5nZXRFbGVtZW50c0J5VGFnTmFtZShufHwiKiIpOnR5cGVvZiBlLnF1ZXJ5U2VsZWN0b3JBbGwhPT1pP2UucXVlcnlTZWxlY3RvckFsbChufHwiKiIpOnQ7aWYoIXMpZm9yKHM9W10scj1lLmNoaWxkTm9kZXN8fGU7bnVsbCE9KG89clthXSk7YSsrKSFufHxiLm5vZGVOYW1lKG8sbik/cy5wdXNoKG8pOmIubWVyZ2UocyxPdChvLG4pKTtyZXR1cm4gbj09PXR8fG4mJmIubm9kZU5hbWUoZSxuKT9iLm1lcmdlKFtlXSxzKTpzfWZ1bmN0aW9uIEJ0KGUpe050LnRlc3QoZS50eXBlKSYmKGUuZGVmYXVsdENoZWNrZWQ9ZS5jaGVja2VkKX1iLmV4dGVuZCh7Y2xvbmU6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhLHMsdT1iLmNvbnRhaW5zKGUub3duZXJEb2N1bWVudCxlKTtpZihiLnN1cHBvcnQuaHRtbDVDbG9uZXx8Yi5pc1hNTERvYyhlKXx8IW10LnRlc3QoIjwiK2Uubm9kZU5hbWUrIj4iKT9vPWUuY2xvbmVOb2RlKCEwKTooRHQuaW5uZXJIVE1MPWUub3V0ZXJIVE1MLER0LnJlbW92ZUNoaWxkKG89RHQuZmlyc3RDaGlsZCkpLCEoYi5zdXBwb3J0Lm5vQ2xvbmVFdmVudCYmYi5zdXBwb3J0Lm5vQ2xvbmVDaGVja2VkfHwxIT09ZS5ub2RlVHlwZSYmMTEhPT1lLm5vZGVUeXBlfHxiLmlzWE1MRG9jKGUpKSlmb3Iocj1PdChvKSxzPU90KGUpLGE9MDtudWxsIT0oaT1zW2FdKTsrK2EpclthXSYmRnQoaSxyW2FdKTtpZih0KWlmKG4pZm9yKHM9c3x8T3QoZSkscj1yfHxPdChvKSxhPTA7bnVsbCE9KGk9c1thXSk7YSsrKV90KGksclthXSk7ZWxzZSBfdChlLG8pO3JldHVybiByPU90KG8sInNjcmlwdCIpLHIubGVuZ3RoPjAmJk10KHIsIXUmJk90KGUsInNjcmlwdCIpKSxyPXM9aT1udWxsLG99LGJ1aWxkRnJhZ21lbnQ6ZnVuY3Rpb24oZSx0LG4scil7dmFyIGksbyxhLHMsdSxsLGMscD1lLmxlbmd0aCxmPWR0KHQpLGQ9W10saD0wO2Zvcig7cD5oO2grKylpZihvPWVbaF0sb3x8MD09PW8paWYoIm9iamVjdCI9PT1iLnR5cGUobykpYi5tZXJnZShkLG8ubm9kZVR5cGU/W29dOm8pO2Vsc2UgaWYod3QudGVzdChvKSl7cz1zfHxmLmFwcGVuZENoaWxkKHQuY3JlYXRlRWxlbWVudCgiZGl2IikpLHU9KGJ0LmV4ZWMobyl8fFsiIiwiIl0pWzFdLnRvTG93ZXJDYXNlKCksYz1BdFt1XXx8QXQuX2RlZmF1bHQscy5pbm5lckhUTUw9Y1sxXStvLnJlcGxhY2UodnQsIjwkMT48LyQyPiIpK2NbMl0saT1jWzBdO3doaWxlKGktLSlzPXMubGFzdENoaWxkO2lmKCFiLnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UmJnl0LnRlc3QobykmJmQucHVzaCh0LmNyZWF0ZVRleHROb2RlKHl0LmV4ZWMobylbMF0pKSwhYi5zdXBwb3J0LnRib2R5KXtvPSJ0YWJsZSIhPT11fHx4dC50ZXN0KG8pPyI8dGFibGU+IiE9PWNbMV18fHh0LnRlc3Qobyk/MDpzOnMuZmlyc3RDaGlsZCxpPW8mJm8uY2hpbGROb2Rlcy5sZW5ndGg7d2hpbGUoaS0tKWIubm9kZU5hbWUobD1vLmNoaWxkTm9kZXNbaV0sInRib2R5IikmJiFsLmNoaWxkTm9kZXMubGVuZ3RoJiZvLnJlbW92ZUNoaWxkKGwpDQp9Yi5tZXJnZShkLHMuY2hpbGROb2Rlcykscy50ZXh0Q29udGVudD0iIjt3aGlsZShzLmZpcnN0Q2hpbGQpcy5yZW1vdmVDaGlsZChzLmZpcnN0Q2hpbGQpO3M9Zi5sYXN0Q2hpbGR9ZWxzZSBkLnB1c2godC5jcmVhdGVUZXh0Tm9kZShvKSk7cyYmZi5yZW1vdmVDaGlsZChzKSxiLnN1cHBvcnQuYXBwZW5kQ2hlY2tlZHx8Yi5ncmVwKE90KGQsImlucHV0IiksQnQpLGg9MDt3aGlsZShvPWRbaCsrXSlpZigoIXJ8fC0xPT09Yi5pbkFycmF5KG8scikpJiYoYT1iLmNvbnRhaW5zKG8ub3duZXJEb2N1bWVudCxvKSxzPU90KGYuYXBwZW5kQ2hpbGQobyksInNjcmlwdCIpLGEmJk10KHMpLG4pKXtpPTA7d2hpbGUobz1zW2krK10pa3QudGVzdChvLnR5cGV8fCIiKSYmbi5wdXNoKG8pfXJldHVybiBzPW51bGwsZn0sY2xlYW5EYXRhOmZ1bmN0aW9uKGUsdCl7dmFyIG4scixvLGEscz0wLHU9Yi5leHBhbmRvLGw9Yi5jYWNoZSxwPWIuc3VwcG9ydC5kZWxldGVFeHBhbmRvLGY9Yi5ldmVudC5zcGVjaWFsO2Zvcig7bnVsbCE9KG49ZVtzXSk7cysrKWlmKCh0fHxiLmFjY2VwdERhdGEobikpJiYobz1uW3VdLGE9byYmbFtvXSkpe2lmKGEuZXZlbnRzKWZvcihyIGluIGEuZXZlbnRzKWZbcl0/Yi5ldmVudC5yZW1vdmUobixyKTpiLnJlbW92ZUV2ZW50KG4scixhLmhhbmRsZSk7bFtvXSYmKGRlbGV0ZSBsW29dLHA/ZGVsZXRlIG5bdV06dHlwZW9mIG4ucmVtb3ZlQXR0cmlidXRlIT09aT9uLnJlbW92ZUF0dHJpYnV0ZSh1KTpuW3VdPW51bGwsYy5wdXNoKG8pKX19fSk7dmFyIFB0LFJ0LFd0LCR0PS9hbHBoYVwoW14pXSpcKS9pLEl0PS9vcGFjaXR5XHMqPVxzKihbXildKikvLHp0PS9eKHRvcHxyaWdodHxib3R0b218bGVmdCkkLyxYdD0vXihub25lfHRhYmxlKD8hLWNbZWFdKS4rKS8sVXQ9L15tYXJnaW4vLFZ0PVJlZ0V4cCgiXigiK3grIikoLiopJCIsImkiKSxZdD1SZWdFeHAoIl4oIit4KyIpKD8hcHgpW2EteiVdKyQiLCJpIiksSnQ9UmVnRXhwKCJeKFsrLV0pPSgiK3grIikiLCJpIiksR3Q9e0JPRFk6ImJsb2NrIn0sUXQ9e3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdmlzaWJpbGl0eToiaGlkZGVuIixkaXNwbGF5OiJibG9jayJ9LEt0PXtsZXR0ZXJTcGFjaW5nOjAsZm9udFdlaWdodDo0MDB9LFp0PVsiVG9wIiwiUmlnaHQiLCJCb3R0b20iLCJMZWZ0Il0sZW49WyJXZWJraXQiLCJPIiwiTW96IiwibXMiXTtmdW5jdGlvbiB0bihlLHQpe2lmKHQgaW4gZSlyZXR1cm4gdDt2YXIgbj10LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpK3Quc2xpY2UoMSkscj10LGk9ZW4ubGVuZ3RoO3doaWxlKGktLSlpZih0PWVuW2ldK24sdCBpbiBlKXJldHVybiB0O3JldHVybiByfWZ1bmN0aW9uIG5uKGUsdCl7cmV0dXJuIGU9dHx8ZSwibm9uZSI9PT1iLmNzcyhlLCJkaXNwbGF5Iil8fCFiLmNvbnRhaW5zKGUub3duZXJEb2N1bWVudCxlKX1mdW5jdGlvbiBybihlLHQpe3ZhciBuLHIsaSxvPVtdLGE9MCxzPWUubGVuZ3RoO2Zvcig7cz5hO2ErKylyPWVbYV0sci5zdHlsZSYmKG9bYV09Yi5fZGF0YShyLCJvbGRkaXNwbGF5Iiksbj1yLnN0eWxlLmRpc3BsYXksdD8ob1thXXx8Im5vbmUiIT09bnx8KHIuc3R5bGUuZGlzcGxheT0iIiksIiI9PT1yLnN0eWxlLmRpc3BsYXkmJm5uKHIpJiYob1thXT1iLl9kYXRhKHIsIm9sZGRpc3BsYXkiLHVuKHIubm9kZU5hbWUpKSkpOm9bYV18fChpPW5uKHIpLChuJiYibm9uZSIhPT1ufHwhaSkmJmIuX2RhdGEociwib2xkZGlzcGxheSIsaT9uOmIuY3NzKHIsImRpc3BsYXkiKSkpKTtmb3IoYT0wO3M+YTthKyspcj1lW2FdLHIuc3R5bGUmJih0JiYibm9uZSIhPT1yLnN0eWxlLmRpc3BsYXkmJiIiIT09ci5zdHlsZS5kaXNwbGF5fHwoci5zdHlsZS5kaXNwbGF5PXQ/b1thXXx8IiI6Im5vbmUiKSk7cmV0dXJuIGV9Yi5mbi5leHRlbmQoe2NzczpmdW5jdGlvbihlLG4pe3JldHVybiBiLmFjY2Vzcyh0aGlzLGZ1bmN0aW9uKGUsbixyKXt2YXIgaSxvLGE9e30scz0wO2lmKGIuaXNBcnJheShuKSl7Zm9yKG89UnQoZSksaT1uLmxlbmd0aDtpPnM7cysrKWFbbltzXV09Yi5jc3MoZSxuW3NdLCExLG8pO3JldHVybiBhfXJldHVybiByIT09dD9iLnN0eWxlKGUsbixyKTpiLmNzcyhlLG4pfSxlLG4sYXJndW1lbnRzLmxlbmd0aD4xKX0sc2hvdzpmdW5jdGlvbigpe3JldHVybiBybih0aGlzLCEwKX0saGlkZTpmdW5jdGlvbigpe3JldHVybiBybih0aGlzKX0sdG9nZ2xlOmZ1bmN0aW9uKGUpe3ZhciB0PSJib29sZWFuIj09dHlwZW9mIGU7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpeyh0P2U6bm4odGhpcykpP2IodGhpcykuc2hvdygpOmIodGhpcykuaGlkZSgpfSl9fSksYi5leHRlbmQoe2Nzc0hvb2tzOntvcGFjaXR5OntnZXQ6ZnVuY3Rpb24oZSx0KXtpZih0KXt2YXIgbj1XdChlLCJvcGFjaXR5Iik7cmV0dXJuIiI9PT1uPyIxIjpufX19fSxjc3NOdW1iZXI6e2NvbHVtbkNvdW50OiEwLGZpbGxPcGFjaXR5OiEwLGZvbnRXZWlnaHQ6ITAsbGluZUhlaWdodDohMCxvcGFjaXR5OiEwLG9ycGhhbnM6ITAsd2lkb3dzOiEwLHpJbmRleDohMCx6b29tOiEwfSxjc3NQcm9wczp7ImZsb2F0IjpiLnN1cHBvcnQuY3NzRmxvYXQ/ImNzc0Zsb2F0Ijoic3R5bGVGbG9hdCJ9LHN0eWxlOmZ1bmN0aW9uKGUsbixyLGkpe2lmKGUmJjMhPT1lLm5vZGVUeXBlJiY4IT09ZS5ub2RlVHlwZSYmZS5zdHlsZSl7dmFyIG8sYSxzLHU9Yi5jYW1lbENhc2UobiksbD1lLnN0eWxlO2lmKG49Yi5jc3NQcm9wc1t1XXx8KGIuY3NzUHJvcHNbdV09dG4obCx1KSkscz1iLmNzc0hvb2tzW25dfHxiLmNzc0hvb2tzW3VdLHI9PT10KXJldHVybiBzJiYiZ2V0ImluIHMmJihvPXMuZ2V0KGUsITEsaSkpIT09dD9vOmxbbl07aWYoYT10eXBlb2Ygciwic3RyaW5nIj09PWEmJihvPUp0LmV4ZWMocikpJiYocj0ob1sxXSsxKSpvWzJdK3BhcnNlRmxvYXQoYi5jc3MoZSxuKSksYT0ibnVtYmVyIiksIShudWxsPT1yfHwibnVtYmVyIj09PWEmJmlzTmFOKHIpfHwoIm51bWJlciIhPT1hfHxiLmNzc051bWJlclt1XXx8KHIrPSJweCIpLGIuc3VwcG9ydC5jbGVhckNsb25lU3R5bGV8fCIiIT09cnx8MCE9PW4uaW5kZXhPZigiYmFja2dyb3VuZCIpfHwobFtuXT0iaW5oZXJpdCIpLHMmJiJzZXQiaW4gcyYmKHI9cy5zZXQoZSxyLGkpKT09PXQpKSl0cnl7bFtuXT1yfWNhdGNoKGMpe319fSxjc3M6ZnVuY3Rpb24oZSxuLHIsaSl7dmFyIG8sYSxzLHU9Yi5jYW1lbENhc2Uobik7cmV0dXJuIG49Yi5jc3NQcm9wc1t1XXx8KGIuY3NzUHJvcHNbdV09dG4oZS5zdHlsZSx1KSkscz1iLmNzc0hvb2tzW25dfHxiLmNzc0hvb2tzW3VdLHMmJiJnZXQiaW4gcyYmKGE9cy5nZXQoZSwhMCxyKSksYT09PXQmJihhPVd0KGUsbixpKSksIm5vcm1hbCI9PT1hJiZuIGluIEt0JiYoYT1LdFtuXSksIiI9PT1yfHxyPyhvPXBhcnNlRmxvYXQoYSkscj09PSEwfHxiLmlzTnVtZXJpYyhvKT9vfHwwOmEpOmF9LHN3YXA6ZnVuY3Rpb24oZSx0LG4scil7dmFyIGksbyxhPXt9O2ZvcihvIGluIHQpYVtvXT1lLnN0eWxlW29dLGUuc3R5bGVbb109dFtvXTtpPW4uYXBwbHkoZSxyfHxbXSk7Zm9yKG8gaW4gdCllLnN0eWxlW29dPWFbb107cmV0dXJuIGl9fSksZS5nZXRDb21wdXRlZFN0eWxlPyhSdD1mdW5jdGlvbih0KXtyZXR1cm4gZS5nZXRDb21wdXRlZFN0eWxlKHQsbnVsbCl9LFd0PWZ1bmN0aW9uKGUsbixyKXt2YXIgaSxvLGEscz1yfHxSdChlKSx1PXM/cy5nZXRQcm9wZXJ0eVZhbHVlKG4pfHxzW25dOnQsbD1lLnN0eWxlO3JldHVybiBzJiYoIiIhPT11fHxiLmNvbnRhaW5zKGUub3duZXJEb2N1bWVudCxlKXx8KHU9Yi5zdHlsZShlLG4pKSxZdC50ZXN0KHUpJiZVdC50ZXN0KG4pJiYoaT1sLndpZHRoLG89bC5taW5XaWR0aCxhPWwubWF4V2lkdGgsbC5taW5XaWR0aD1sLm1heFdpZHRoPWwud2lkdGg9dSx1PXMud2lkdGgsbC53aWR0aD1pLGwubWluV2lkdGg9byxsLm1heFdpZHRoPWEpKSx1fSk6by5kb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlJiYoUnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGUuY3VycmVudFN0eWxlfSxXdD1mdW5jdGlvbihlLG4scil7dmFyIGksbyxhLHM9cnx8UnQoZSksdT1zP3Nbbl06dCxsPWUuc3R5bGU7cmV0dXJuIG51bGw9PXUmJmwmJmxbbl0mJih1PWxbbl0pLFl0LnRlc3QodSkmJiF6dC50ZXN0KG4pJiYoaT1sLmxlZnQsbz1lLnJ1bnRpbWVTdHlsZSxhPW8mJm8ubGVmdCxhJiYoby5sZWZ0PWUuY3VycmVudFN0eWxlLmxlZnQpLGwubGVmdD0iZm9udFNpemUiPT09bj8iMWVtIjp1LHU9bC5waXhlbExlZnQrInB4IixsLmxlZnQ9aSxhJiYoby5sZWZ0PWEpKSwiIj09PXU/ImF1dG8iOnV9KTtmdW5jdGlvbiBvbihlLHQsbil7dmFyIHI9VnQuZXhlYyh0KTtyZXR1cm4gcj9NYXRoLm1heCgwLHJbMV0tKG58fDApKSsoclsyXXx8InB4Iik6dH1mdW5jdGlvbiBhbihlLHQsbixyLGkpe3ZhciBvPW49PT0ocj8iYm9yZGVyIjoiY29udGVudCIpPzQ6IndpZHRoIj09PXQ/MTowLGE9MDtmb3IoOzQ+bztvKz0yKSJtYXJnaW4iPT09biYmKGErPWIuY3NzKGUsbitadFtvXSwhMCxpKSkscj8oImNvbnRlbnQiPT09biYmKGEtPWIuY3NzKGUsInBhZGRpbmciK1p0W29dLCEwLGkpKSwibWFyZ2luIiE9PW4mJihhLT1iLmNzcyhlLCJib3JkZXIiK1p0W29dKyJXaWR0aCIsITAsaSkpKTooYSs9Yi5jc3MoZSwicGFkZGluZyIrWnRbb10sITAsaSksInBhZGRpbmciIT09biYmKGErPWIuY3NzKGUsImJvcmRlciIrWnRbb10rIldpZHRoIiwhMCxpKSkpO3JldHVybiBhfWZ1bmN0aW9uIHNuKGUsdCxuKXt2YXIgcj0hMCxpPSJ3aWR0aCI9PT10P2Uub2Zmc2V0V2lkdGg6ZS5vZmZzZXRIZWlnaHQsbz1SdChlKSxhPWIuc3VwcG9ydC5ib3hTaXppbmcmJiJib3JkZXItYm94Ij09PWIuY3NzKGUsImJveFNpemluZyIsITEsbyk7aWYoMD49aXx8bnVsbD09aSl7aWYoaT1XdChlLHQsbyksKDA+aXx8bnVsbD09aSkmJihpPWUuc3R5bGVbdF0pLFl0LnRlc3QoaSkpcmV0dXJuIGk7cj1hJiYoYi5zdXBwb3J0LmJveFNpemluZ1JlbGlhYmxlfHxpPT09ZS5zdHlsZVt0XSksaT1wYXJzZUZsb2F0KGkpfHwwfXJldHVybiBpK2FuKGUsdCxufHwoYT8iYm9yZGVyIjoiY29udGVudCIpLHIsbykrInB4In1mdW5jdGlvbiB1bihlKXt2YXIgdD1vLG49R3RbZV07cmV0dXJuIG58fChuPWxuKGUsdCksIm5vbmUiIT09biYmbnx8KFB0PShQdHx8YigiPGlmcmFtZSBmcmFtZWJvcmRlcj0nMCcgd2lkdGg9JzAnIGhlaWdodD0nMCcvPiIpLmNzcygiY3NzVGV4dCIsImRpc3BsYXk6YmxvY2sgIWltcG9ydGFudCIpKS5hcHBlbmRUbyh0LmRvY3VtZW50RWxlbWVudCksdD0oUHRbMF0uY29udGVudFdpbmRvd3x8UHRbMF0uY29udGVudERvY3VtZW50KS5kb2N1bWVudCx0LndyaXRlKCI8IWRvY3R5cGUgaHRtbD48aHRtbD48Ym9keT4iKSx0LmNsb3NlKCksbj1sbihlLHQpLFB0LmRldGFjaCgpKSxHdFtlXT1uKSxufWZ1bmN0aW9uIGxuKGUsdCl7dmFyIG49Yih0LmNyZWF0ZUVsZW1lbnQoZSkpLmFwcGVuZFRvKHQuYm9keSkscj1iLmNzcyhuWzBdLCJkaXNwbGF5Iik7cmV0dXJuIG4ucmVtb3ZlKCkscn1iLmVhY2goWyJoZWlnaHQiLCJ3aWR0aCJdLGZ1bmN0aW9uKGUsbil7Yi5jc3NIb29rc1tuXT17Z2V0OmZ1bmN0aW9uKGUscixpKXtyZXR1cm4gcj8wPT09ZS5vZmZzZXRXaWR0aCYmWHQudGVzdChiLmNzcyhlLCJkaXNwbGF5IikpP2Iuc3dhcChlLFF0LGZ1bmN0aW9uKCl7cmV0dXJuIHNuKGUsbixpKX0pOnNuKGUsbixpKTp0fSxzZXQ6ZnVuY3Rpb24oZSx0LHIpe3ZhciBpPXImJlJ0KGUpO3JldHVybiBvbihlLHQscj9hbihlLG4scixiLnN1cHBvcnQuYm94U2l6aW5nJiYiYm9yZGVyLWJveCI9PT1iLmNzcyhlLCJib3hTaXppbmciLCExLGkpLGkpOjApfX19KSxiLnN1cHBvcnQub3BhY2l0eXx8KGIuY3NzSG9va3Mub3BhY2l0eT17Z2V0OmZ1bmN0aW9uKGUsdCl7cmV0dXJuIEl0LnRlc3QoKHQmJmUuY3VycmVudFN0eWxlP2UuY3VycmVudFN0eWxlLmZpbHRlcjplLnN0eWxlLmZpbHRlcil8fCIiKT8uMDEqcGFyc2VGbG9hdChSZWdFeHAuJDEpKyIiOnQ/IjEiOiIifSxzZXQ6ZnVuY3Rpb24oZSx0KXt2YXIgbj1lLnN0eWxlLHI9ZS5jdXJyZW50U3R5bGUsaT1iLmlzTnVtZXJpYyh0KT8iYWxwaGEob3BhY2l0eT0iKzEwMCp0KyIpIjoiIixvPXImJnIuZmlsdGVyfHxuLmZpbHRlcnx8IiI7bi56b29tPTEsKHQ+PTF8fCIiPT09dCkmJiIiPT09Yi50cmltKG8ucmVwbGFjZSgkdCwiIikpJiZuLnJlbW92ZUF0dHJpYnV0ZSYmKG4ucmVtb3ZlQXR0cmlidXRlKCJmaWx0ZXIiKSwiIj09PXR8fHImJiFyLmZpbHRlcil8fChuLmZpbHRlcj0kdC50ZXN0KG8pP28ucmVwbGFjZSgkdCxpKTpvKyIgIitpKX19KSxiKGZ1bmN0aW9uKCl7Yi5zdXBwb3J0LnJlbGlhYmxlTWFyZ2luUmlnaHR8fChiLmNzc0hvb2tzLm1hcmdpblJpZ2h0PXtnZXQ6ZnVuY3Rpb24oZSxuKXtyZXR1cm4gbj9iLnN3YXAoZSx7ZGlzcGxheToiaW5saW5lLWJsb2NrIn0sV3QsW2UsIm1hcmdpblJpZ2h0Il0pOnR9fSksIWIuc3VwcG9ydC5waXhlbFBvc2l0aW9uJiZiLmZuLnBvc2l0aW9uJiZiLmVhY2goWyJ0b3AiLCJsZWZ0Il0sZnVuY3Rpb24oZSxuKXtiLmNzc0hvb2tzW25dPXtnZXQ6ZnVuY3Rpb24oZSxyKXtyZXR1cm4gcj8ocj1XdChlLG4pLFl0LnRlc3Qocik/YihlKS5wb3NpdGlvbigpW25dKyJweCI6cik6dH19fSl9KSxiLmV4cHImJmIuZXhwci5maWx0ZXJzJiYoYi5leHByLmZpbHRlcnMuaGlkZGVuPWZ1bmN0aW9uKGUpe3JldHVybiAwPj1lLm9mZnNldFdpZHRoJiYwPj1lLm9mZnNldEhlaWdodHx8IWIuc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMmJiJub25lIj09PShlLnN0eWxlJiZlLnN0eWxlLmRpc3BsYXl8fGIuY3NzKGUsImRpc3BsYXkiKSl9LGIuZXhwci5maWx0ZXJzLnZpc2libGU9ZnVuY3Rpb24oZSl7cmV0dXJuIWIuZXhwci5maWx0ZXJzLmhpZGRlbihlKX0pLGIuZWFjaCh7bWFyZ2luOiIiLHBhZGRpbmc6IiIsYm9yZGVyOiJXaWR0aCJ9LGZ1bmN0aW9uKGUsdCl7Yi5jc3NIb29rc1tlK3RdPXtleHBhbmQ6ZnVuY3Rpb24obil7dmFyIHI9MCxpPXt9LG89InN0cmluZyI9PXR5cGVvZiBuP24uc3BsaXQoIiAiKTpbbl07Zm9yKDs0PnI7cisrKWlbZStadFtyXSt0XT1vW3JdfHxvW3ItMl18fG9bMF07cmV0dXJuIGl9fSxVdC50ZXN0KGUpfHwoYi5jc3NIb29rc1tlK3RdLnNldD1vbil9KTt2YXIgY249LyUyMC9nLHBuPS9cW1xdJC8sZm49L1xyP1xuL2csZG49L14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLGhuPS9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGtleWdlbikvaTtiLmZuLmV4dGVuZCh7c2VyaWFsaXplOmZ1bmN0aW9uKCl7cmV0dXJuIGIucGFyYW0odGhpcy5zZXJpYWxpemVBcnJheSgpKX0sc2VyaWFsaXplQXJyYXk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXt2YXIgZT1iLnByb3AodGhpcywiZWxlbWVudHMiKTtyZXR1cm4gZT9iLm1ha2VBcnJheShlKTp0aGlzfSkuZmlsdGVyKGZ1bmN0aW9uKCl7dmFyIGU9dGhpcy50eXBlO3JldHVybiB0aGlzLm5hbWUmJiFiKHRoaXMpLmlzKCI6ZGlzYWJsZWQiKSYmaG4udGVzdCh0aGlzLm5vZGVOYW1lKSYmIWRuLnRlc3QoZSkmJih0aGlzLmNoZWNrZWR8fCFOdC50ZXN0KGUpKX0pLm1hcChmdW5jdGlvbihlLHQpe3ZhciBuPWIodGhpcykudmFsKCk7cmV0dXJuIG51bGw9PW4/bnVsbDpiLmlzQXJyYXkobik/Yi5tYXAobixmdW5jdGlvbihlKXtyZXR1cm57bmFtZTp0Lm5hbWUsdmFsdWU6ZS5yZXBsYWNlKGZuLCJcclxuIil9fSk6e25hbWU6dC5uYW1lLHZhbHVlOm4ucmVwbGFjZShmbiwiXHJcbiIpfX0pLmdldCgpfX0pLGIucGFyYW09ZnVuY3Rpb24oZSxuKXt2YXIgcixpPVtdLG89ZnVuY3Rpb24oZSx0KXt0PWIuaXNGdW5jdGlvbih0KT90KCk6bnVsbD09dD8iIjp0LGlbaS5sZW5ndGhdPWVuY29kZVVSSUNvbXBvbmVudChlKSsiPSIrZW5jb2RlVVJJQ29tcG9uZW50KHQpfTtpZihuPT09dCYmKG49Yi5hamF4U2V0dGluZ3MmJmIuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsKSxiLmlzQXJyYXkoZSl8fGUuanF1ZXJ5JiYhYi5pc1BsYWluT2JqZWN0KGUpKWIuZWFjaChlLGZ1bmN0aW9uKCl7byh0aGlzLm5hbWUsdGhpcy52YWx1ZSl9KTtlbHNlIGZvcihyIGluIGUpZ24ocixlW3JdLG4sbyk7cmV0dXJuIGkuam9pbigiJiIpLnJlcGxhY2UoY24sIisiKX07ZnVuY3Rpb24gZ24oZSx0LG4scil7dmFyIGk7aWYoYi5pc0FycmF5KHQpKWIuZWFjaCh0LGZ1bmN0aW9uKHQsaSl7bnx8cG4udGVzdChlKT9yKGUsaSk6Z24oZSsiWyIrKCJvYmplY3QiPT10eXBlb2YgaT90OiIiKSsiXSIsaSxuLHIpfSk7ZWxzZSBpZihufHwib2JqZWN0IiE9PWIudHlwZSh0KSlyKGUsdCk7ZWxzZSBmb3IoaSBpbiB0KWduKGUrIlsiK2krIl0iLHRbaV0sbixyKX1iLmVhY2goImJsdXIgZm9jdXMgZm9jdXNpbiBmb2N1c291dCBsb2FkIHJlc2l6ZSBzY3JvbGwgdW5sb2FkIGNsaWNrIGRibGNsaWNrIG1vdXNlZG93biBtb3VzZXVwIG1vdXNlbW92ZSBtb3VzZW92ZXIgbW91c2VvdXQgbW91c2VlbnRlciBtb3VzZWxlYXZlIGNoYW5nZSBzZWxlY3Qgc3VibWl0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgZXJyb3IgY29udGV4dG1lbnUiLnNwbGl0KCIgIiksZnVuY3Rpb24oZSx0KXtiLmZuW3RdPWZ1bmN0aW9uKGUsbil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg+MD90aGlzLm9uKHQsbnVsbCxlLG4pOnRoaXMudHJpZ2dlcih0KX19KSxiLmZuLmhvdmVyPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMubW91c2VlbnRlcihlKS5tb3VzZWxlYXZlKHR8fGUpfTt2YXIgbW4seW4sdm49Yi5ub3coKSxibj0vXD8vLHhuPS8jLiokLyx3bj0vKFs/Jl0pXz1bXiZdKi8sVG49L14oLio/KTpbIFx0XSooW15cclxuXSopXHI/JC9nbSxObj0vXig/OmFib3V0fGFwcHxhcHAtc3RvcmFnZXwuKy1leHRlbnNpb258ZmlsZXxyZXN8d2lkZ2V0KTokLyxDbj0vXig/OkdFVHxIRUFEKSQvLGtuPS9eXC9cLy8sRW49L14oW1x3ListXSs6KSg/OlwvXC8oW15cLz8jOl0qKSg/OjooXGQrKXwpfCkvLFNuPWIuZm4ubG9hZCxBbj17fSxqbj17fSxEbj0iKi8iLmNvbmNhdCgiKiIpO3RyeXt5bj1hLmhyZWZ9Y2F0Y2goTG4pe3luPW8uY3JlYXRlRWxlbWVudCgiYSIpLHluLmhyZWY9IiIseW49eW4uaHJlZn1tbj1Fbi5leGVjKHluLnRvTG93ZXJDYXNlKCkpfHxbXTtmdW5jdGlvbiBIbihlKXtyZXR1cm4gZnVuY3Rpb24odCxuKXsic3RyaW5nIiE9dHlwZW9mIHQmJihuPXQsdD0iKiIpO3ZhciByLGk9MCxvPXQudG9Mb3dlckNhc2UoKS5tYXRjaCh3KXx8W107aWYoYi5pc0Z1bmN0aW9uKG4pKXdoaWxlKHI9b1tpKytdKSIrIj09PXJbMF0/KHI9ci5zbGljZSgxKXx8IioiLChlW3JdPWVbcl18fFtdKS51bnNoaWZ0KG4pKTooZVtyXT1lW3JdfHxbXSkucHVzaChuKX19ZnVuY3Rpb24gcW4oZSxuLHIsaSl7dmFyIG89e30sYT1lPT09am47ZnVuY3Rpb24gcyh1KXt2YXIgbDtyZXR1cm4gb1t1XT0hMCxiLmVhY2goZVt1XXx8W10sZnVuY3Rpb24oZSx1KXt2YXIgYz11KG4scixpKTtyZXR1cm4ic3RyaW5nIiE9dHlwZW9mIGN8fGF8fG9bY10/YT8hKGw9Yyk6dDoobi5kYXRhVHlwZXMudW5zaGlmdChjKSxzKGMpLCExKX0pLGx9cmV0dXJuIHMobi5kYXRhVHlwZXNbMF0pfHwhb1siKiJdJiZzKCIqIil9ZnVuY3Rpb24gTW4oZSxuKXt2YXIgcixpLG89Yi5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnN8fHt9O2ZvcihpIGluIG4pbltpXSE9PXQmJigob1tpXT9lOnJ8fChyPXt9KSlbaV09bltpXSk7cmV0dXJuIHImJmIuZXh0ZW5kKCEwLGUsciksZX1iLmZuLmxvYWQ9ZnVuY3Rpb24oZSxuLHIpe2lmKCJzdHJpbmciIT10eXBlb2YgZSYmU24pcmV0dXJuIFNuLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt2YXIgaSxvLGEscz10aGlzLHU9ZS5pbmRleE9mKCIgIik7cmV0dXJuIHU+PTAmJihpPWUuc2xpY2UodSxlLmxlbmd0aCksZT1lLnNsaWNlKDAsdSkpLGIuaXNGdW5jdGlvbihuKT8ocj1uLG49dCk6biYmIm9iamVjdCI9PXR5cGVvZiBuJiYoYT0iUE9TVCIpLHMubGVuZ3RoPjAmJmIuYWpheCh7dXJsOmUsdHlwZTphLGRhdGFUeXBlOiJodG1sIixkYXRhOm59KS5kb25lKGZ1bmN0aW9uKGUpe289YXJndW1lbnRzLHMuaHRtbChpP2IoIjxkaXY+IikuYXBwZW5kKGIucGFyc2VIVE1MKGUpKS5maW5kKGkpOmUpfSkuY29tcGxldGUociYmZnVuY3Rpb24oZSx0KXtzLmVhY2gocixvfHxbZS5yZXNwb25zZVRleHQsdCxlXSl9KSx0aGlzfSxiLmVhY2goWyJhamF4U3RhcnQiLCJhamF4U3RvcCIsImFqYXhDb21wbGV0ZSIsImFqYXhFcnJvciIsImFqYXhTdWNjZXNzIiwiYWpheFNlbmQiXSxmdW5jdGlvbihlLHQpe2IuZm5bdF09ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMub24odCxlKX19KSxiLmVhY2goWyJnZXQiLCJwb3N0Il0sZnVuY3Rpb24oZSxuKXtiW25dPWZ1bmN0aW9uKGUscixpLG8pe3JldHVybiBiLmlzRnVuY3Rpb24ocikmJihvPW98fGksaT1yLHI9dCksYi5hamF4KHt1cmw6ZSx0eXBlOm4sZGF0YVR5cGU6byxkYXRhOnIsc3VjY2VzczppfSl9fSksYi5leHRlbmQoe2FjdGl2ZTowLGxhc3RNb2RpZmllZDp7fSxldGFnOnt9LGFqYXhTZXR0aW5nczp7dXJsOnluLHR5cGU6IkdFVCIsaXNMb2NhbDpObi50ZXN0KG1uWzFdKSxnbG9iYWw6ITAscHJvY2Vzc0RhdGE6ITAsYXN5bmM6ITAsY29udGVudFR5cGU6ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIsYWNjZXB0czp7IioiOkRuLHRleHQ6InRleHQvcGxhaW4iLGh0bWw6InRleHQvaHRtbCIseG1sOiJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sIixqc29uOiJhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L2phdmFzY3JpcHQifSxjb250ZW50czp7eG1sOi94bWwvLGh0bWw6L2h0bWwvLGpzb246L2pzb24vfSxyZXNwb25zZUZpZWxkczp7eG1sOiJyZXNwb25zZVhNTCIsdGV4dDoicmVzcG9uc2VUZXh0In0sY29udmVydGVyczp7IiogdGV4dCI6ZS5TdHJpbmcsInRleHQgaHRtbCI6ITAsInRleHQganNvbiI6Yi5wYXJzZUpTT04sInRleHQgeG1sIjpiLnBhcnNlWE1MfSxmbGF0T3B0aW9uczp7dXJsOiEwLGNvbnRleHQ6ITB9fSxhamF4U2V0dXA6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdD9NbihNbihlLGIuYWpheFNldHRpbmdzKSx0KTpNbihiLmFqYXhTZXR0aW5ncyxlKX0sYWpheFByZWZpbHRlcjpIbihBbiksYWpheFRyYW5zcG9ydDpIbihqbiksYWpheDpmdW5jdGlvbihlLG4peyJvYmplY3QiPT10eXBlb2YgZSYmKG49ZSxlPXQpLG49bnx8e307dmFyIHIsaSxvLGEscyx1LGwsYyxwPWIuYWpheFNldHVwKHt9LG4pLGY9cC5jb250ZXh0fHxwLGQ9cC5jb250ZXh0JiYoZi5ub2RlVHlwZXx8Zi5qcXVlcnkpP2IoZik6Yi5ldmVudCxoPWIuRGVmZXJyZWQoKSxnPWIuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLG09cC5zdGF0dXNDb2RlfHx7fSx5PXt9LHY9e30seD0wLFQ9ImNhbmNlbGVkIixOPXtyZWFkeVN0YXRlOjAsZ2V0UmVzcG9uc2VIZWFkZXI6ZnVuY3Rpb24oZSl7dmFyIHQ7aWYoMj09PXgpe2lmKCFjKXtjPXt9O3doaWxlKHQ9VG4uZXhlYyhhKSljW3RbMV0udG9Mb3dlckNhc2UoKV09dFsyXX10PWNbZS50b0xvd2VyQ2FzZSgpXX1yZXR1cm4gbnVsbD09dD9udWxsOnR9LGdldEFsbFJlc3BvbnNlSGVhZGVyczpmdW5jdGlvbigpe3JldHVybiAyPT09eD9hOm51bGx9LHNldFJlcXVlc3RIZWFkZXI6ZnVuY3Rpb24oZSx0KXt2YXIgbj1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuIHh8fChlPXZbbl09dltuXXx8ZSx5W2VdPXQpLHRoaXN9LG92ZXJyaWRlTWltZVR5cGU6ZnVuY3Rpb24oZSl7cmV0dXJuIHh8fChwLm1pbWVUeXBlPWUpLHRoaXN9LHN0YXR1c0NvZGU6ZnVuY3Rpb24oZSl7dmFyIHQ7aWYoZSlpZigyPngpZm9yKHQgaW4gZSltW3RdPVttW3RdLGVbdF1dO2Vsc2UgTi5hbHdheXMoZVtOLnN0YXR1c10pO3JldHVybiB0aGlzfSxhYm9ydDpmdW5jdGlvbihlKXt2YXIgdD1lfHxUO3JldHVybiBsJiZsLmFib3J0KHQpLGsoMCx0KSx0aGlzfX07aWYoaC5wcm9taXNlKE4pLmNvbXBsZXRlPWcuYWRkLE4uc3VjY2Vzcz1OLmRvbmUsTi5lcnJvcj1OLmZhaWwscC51cmw9KChlfHxwLnVybHx8eW4pKyIiKS5yZXBsYWNlKHhuLCIiKS5yZXBsYWNlKGtuLG1uWzFdKyIvLyIpLHAudHlwZT1uLm1ldGhvZHx8bi50eXBlfHxwLm1ldGhvZHx8cC50eXBlLHAuZGF0YVR5cGVzPWIudHJpbShwLmRhdGFUeXBlfHwiKiIpLnRvTG93ZXJDYXNlKCkubWF0Y2godyl8fFsiIl0sbnVsbD09cC5jcm9zc0RvbWFpbiYmKHI9RW4uZXhlYyhwLnVybC50b0xvd2VyQ2FzZSgpKSxwLmNyb3NzRG9tYWluPSEoIXJ8fHJbMV09PT1tblsxXSYmclsyXT09PW1uWzJdJiYoclszXXx8KCJodHRwOiI9PT1yWzFdPzgwOjQ0MykpPT0obW5bM118fCgiaHR0cDoiPT09bW5bMV0/ODA6NDQzKSkpKSxwLmRhdGEmJnAucHJvY2Vzc0RhdGEmJiJzdHJpbmciIT10eXBlb2YgcC5kYXRhJiYocC5kYXRhPWIucGFyYW0ocC5kYXRhLHAudHJhZGl0aW9uYWwpKSxxbihBbixwLG4sTiksMj09PXgpcmV0dXJuIE47dT1wLmdsb2JhbCx1JiYwPT09Yi5hY3RpdmUrKyYmYi5ldmVudC50cmlnZ2VyKCJhamF4U3RhcnQiKSxwLnR5cGU9cC50eXBlLnRvVXBwZXJDYXNlKCkscC5oYXNDb250ZW50PSFDbi50ZXN0KHAudHlwZSksbz1wLnVybCxwLmhhc0NvbnRlbnR8fChwLmRhdGEmJihvPXAudXJsKz0oYm4udGVzdChvKT8iJiI6Ij8iKStwLmRhdGEsZGVsZXRlIHAuZGF0YSkscC5jYWNoZT09PSExJiYocC51cmw9d24udGVzdChvKT9vLnJlcGxhY2Uod24sIiQxXz0iK3ZuKyspOm8rKGJuLnRlc3Qobyk/IiYiOiI/IikrIl89Iit2bisrKSkscC5pZk1vZGlmaWVkJiYoYi5sYXN0TW9kaWZpZWRbb10mJk4uc2V0UmVxdWVzdEhlYWRlcigiSWYtTW9kaWZpZWQtU2luY2UiLGIubGFzdE1vZGlmaWVkW29dKSxiLmV0YWdbb10mJk4uc2V0UmVxdWVzdEhlYWRlcigiSWYtTm9uZS1NYXRjaCIsYi5ldGFnW29dKSksKHAuZGF0YSYmcC5oYXNDb250ZW50JiZwLmNvbnRlbnRUeXBlIT09ITF8fG4uY29udGVudFR5cGUpJiZOLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIscC5jb250ZW50VHlwZSksTi5zZXRSZXF1ZXN0SGVhZGVyKCJBY2NlcHQiLHAuZGF0YVR5cGVzWzBdJiZwLmFjY2VwdHNbcC5kYXRhVHlwZXNbMF1dP3AuYWNjZXB0c1twLmRhdGFUeXBlc1swXV0rKCIqIiE9PXAuZGF0YVR5cGVzWzBdPyIsICIrRG4rIjsgcT0wLjAxIjoiIik6cC5hY2NlcHRzWyIqIl0pO2ZvcihpIGluIHAuaGVhZGVycylOLnNldFJlcXVlc3RIZWFkZXIoaSxwLmhlYWRlcnNbaV0pO2lmKHAuYmVmb3JlU2VuZCYmKHAuYmVmb3JlU2VuZC5jYWxsKGYsTixwKT09PSExfHwyPT09eCkpcmV0dXJuIE4uYWJvcnQoKTtUPSJhYm9ydCI7Zm9yKGkgaW57c3VjY2VzczoxLGVycm9yOjEsY29tcGxldGU6MX0pTltpXShwW2ldKTtpZihsPXFuKGpuLHAsbixOKSl7Ti5yZWFkeVN0YXRlPTEsdSYmZC50cmlnZ2VyKCJhamF4U2VuZCIsW04scF0pLHAuYXN5bmMmJnAudGltZW91dD4wJiYocz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Ti5hYm9ydCgidGltZW91dCIpfSxwLnRpbWVvdXQpKTt0cnl7eD0xLGwuc2VuZCh5LGspfWNhdGNoKEMpe2lmKCEoMj54KSl0aHJvdyBDO2soLTEsQyl9fWVsc2UgaygtMSwiTm8gVHJhbnNwb3J0Iik7ZnVuY3Rpb24gayhlLG4scixpKXt2YXIgYyx5LHYsdyxULEM9bjsyIT09eCYmKHg9MixzJiZjbGVhclRpbWVvdXQocyksbD10LGE9aXx8IiIsTi5yZWFkeVN0YXRlPWU+MD80OjAsciYmKHc9X24ocCxOLHIpKSxlPj0yMDAmJjMwMD5lfHwzMDQ9PT1lPyhwLmlmTW9kaWZpZWQmJihUPU4uZ2V0UmVzcG9uc2VIZWFkZXIoIkxhc3QtTW9kaWZpZWQiKSxUJiYoYi5sYXN0TW9kaWZpZWRbb109VCksVD1OLmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIiksVCYmKGIuZXRhZ1tvXT1UKSksMjA0PT09ZT8oYz0hMCxDPSJub2NvbnRlbnQiKTozMDQ9PT1lPyhjPSEwLEM9Im5vdG1vZGlmaWVkIik6KGM9Rm4ocCx3KSxDPWMuc3RhdGUseT1jLmRhdGEsdj1jLmVycm9yLGM9IXYpKToodj1DLChlfHwhQykmJihDPSJlcnJvciIsMD5lJiYoZT0wKSkpLE4uc3RhdHVzPWUsTi5zdGF0dXNUZXh0PShufHxDKSsiIixjP2gucmVzb2x2ZVdpdGgoZixbeSxDLE5dKTpoLnJlamVjdFdpdGgoZixbTixDLHZdKSxOLnN0YXR1c0NvZGUobSksbT10LHUmJmQudHJpZ2dlcihjPyJhamF4U3VjY2VzcyI6ImFqYXhFcnJvciIsW04scCxjP3k6dl0pLGcuZmlyZVdpdGgoZixbTixDXSksdSYmKGQudHJpZ2dlcigiYWpheENvbXBsZXRlIixbTixwXSksLS1iLmFjdGl2ZXx8Yi5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpKSl9cmV0dXJuIE59LGdldFNjcmlwdDpmdW5jdGlvbihlLG4pe3JldHVybiBiLmdldChlLHQsbiwic2NyaXB0Iil9LGdldEpTT046ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBiLmdldChlLHQsbiwianNvbiIpfX0pO2Z1bmN0aW9uIF9uKGUsbixyKXt2YXIgaSxvLGEscyx1PWUuY29udGVudHMsbD1lLmRhdGFUeXBlcyxjPWUucmVzcG9uc2VGaWVsZHM7Zm9yKHMgaW4gYylzIGluIHImJihuW2Nbc11dPXJbc10pO3doaWxlKCIqIj09PWxbMF0pbC5zaGlmdCgpLG89PT10JiYobz1lLm1pbWVUeXBlfHxuLmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LVR5cGUiKSk7aWYobylmb3IocyBpbiB1KWlmKHVbc10mJnVbc10udGVzdChvKSl7bC51bnNoaWZ0KHMpO2JyZWFrfWlmKGxbMF1pbiByKWE9bFswXTtlbHNle2ZvcihzIGluIHIpe2lmKCFsWzBdfHxlLmNvbnZlcnRlcnNbcysiICIrbFswXV0pe2E9czticmVha31pfHwoaT1zKX1hPWF8fGl9cmV0dXJuIGE/KGEhPT1sWzBdJiZsLnVuc2hpZnQoYSksclthXSk6dH1mdW5jdGlvbiBGbihlLHQpe3ZhciBuLHIsaSxvLGE9e30scz0wLHU9ZS5kYXRhVHlwZXMuc2xpY2UoKSxsPXVbMF07aWYoZS5kYXRhRmlsdGVyJiYodD1lLmRhdGFGaWx0ZXIodCxlLmRhdGFUeXBlKSksdVsxXSlmb3IoaSBpbiBlLmNvbnZlcnRlcnMpYVtpLnRvTG93ZXJDYXNlKCldPWUuY29udmVydGVyc1tpXTtmb3IoO3I9dVsrK3NdOylpZigiKiIhPT1yKXtpZigiKiIhPT1sJiZsIT09cil7aWYoaT1hW2wrIiAiK3JdfHxhWyIqICIrcl0sIWkpZm9yKG4gaW4gYSlpZihvPW4uc3BsaXQoIiAiKSxvWzFdPT09ciYmKGk9YVtsKyIgIitvWzBdXXx8YVsiKiAiK29bMF1dKSl7aT09PSEwP2k9YVtuXTphW25dIT09ITAmJihyPW9bMF0sdS5zcGxpY2Uocy0tLDAscikpO2JyZWFrfWlmKGkhPT0hMClpZihpJiZlWyJ0aHJvd3MiXSl0PWkodCk7ZWxzZSB0cnl7dD1pKHQpfWNhdGNoKGMpe3JldHVybntzdGF0ZToicGFyc2VyZXJyb3IiLGVycm9yOmk/YzoiTm8gY29udmVyc2lvbiBmcm9tICIrbCsiIHRvICIrcn19fWw9cn1yZXR1cm57c3RhdGU6InN1Y2Nlc3MiLGRhdGE6dH19Yi5hamF4U2V0dXAoe2FjY2VwdHM6e3NjcmlwdDoidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHQifSxjb250ZW50czp7c2NyaXB0Oi8oPzpqYXZhfGVjbWEpc2NyaXB0L30sY29udmVydGVyczp7InRleHQgc2NyaXB0IjpmdW5jdGlvbihlKXtyZXR1cm4gYi5nbG9iYWxFdmFsKGUpLGV9fX0pLGIuYWpheFByZWZpbHRlcigic2NyaXB0IixmdW5jdGlvbihlKXtlLmNhY2hlPT09dCYmKGUuY2FjaGU9ITEpLGUuY3Jvc3NEb21haW4mJihlLnR5cGU9IkdFVCIsZS5nbG9iYWw9ITEpfSksYi5hamF4VHJhbnNwb3J0KCJzY3JpcHQiLGZ1bmN0aW9uKGUpe2lmKGUuY3Jvc3NEb21haW4pe3ZhciBuLHI9by5oZWFkfHxiKCJoZWFkIilbMF18fG8uZG9jdW1lbnRFbGVtZW50O3JldHVybntzZW5kOmZ1bmN0aW9uKHQsaSl7bj1vLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpLG4uYXN5bmM9ITAsZS5zY3JpcHRDaGFyc2V0JiYobi5jaGFyc2V0PWUuc2NyaXB0Q2hhcnNldCksbi5zcmM9ZS51cmwsbi5vbmxvYWQ9bi5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oZSx0KXsodHx8IW4ucmVhZHlTdGF0ZXx8L2xvYWRlZHxjb21wbGV0ZS8udGVzdChuLnJlYWR5U3RhdGUpKSYmKG4ub25sb2FkPW4ub25yZWFkeXN0YXRlY2hhbmdlPW51bGwsbi5wYXJlbnROb2RlJiZuLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobiksbj1udWxsLHR8fGkoMjAwLCJzdWNjZXNzIikpfSxyLmluc2VydEJlZm9yZShuLHIuZmlyc3RDaGlsZCl9LGFib3J0OmZ1bmN0aW9uKCl7biYmbi5vbmxvYWQodCwhMCl9fX19KTt2YXIgT249W10sQm49Lyg9KVw/KD89JnwkKXxcP1w/LztiLmFqYXhTZXR1cCh7anNvbnA6ImNhbGxiYWNrIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7dmFyIGU9T24ucG9wKCl8fGIuZXhwYW5kbysiXyIrdm4rKztyZXR1cm4gdGhpc1tlXT0hMCxlfX0pLGIuYWpheFByZWZpbHRlcigianNvbiBqc29ucCIsZnVuY3Rpb24obixyLGkpe3ZhciBvLGEscyx1PW4uanNvbnAhPT0hMSYmKEJuLnRlc3Qobi51cmwpPyJ1cmwiOiJzdHJpbmciPT10eXBlb2Ygbi5kYXRhJiYhKG4uY29udGVudFR5cGV8fCIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSYmQm4udGVzdChuLmRhdGEpJiYiZGF0YSIpO3JldHVybiB1fHwianNvbnAiPT09bi5kYXRhVHlwZXNbMF0/KG89bi5qc29ucENhbGxiYWNrPWIuaXNGdW5jdGlvbihuLmpzb25wQ2FsbGJhY2spP24uanNvbnBDYWxsYmFjaygpOm4uanNvbnBDYWxsYmFjayx1P25bdV09blt1XS5yZXBsYWNlKEJuLCIkMSIrbyk6bi5qc29ucCE9PSExJiYobi51cmwrPShibi50ZXN0KG4udXJsKT8iJiI6Ij8iKStuLmpzb25wKyI9IitvKSxuLmNvbnZlcnRlcnNbInNjcmlwdCBqc29uIl09ZnVuY3Rpb24oKXtyZXR1cm4gc3x8Yi5lcnJvcihvKyIgd2FzIG5vdCBjYWxsZWQiKSxzWzBdfSxuLmRhdGFUeXBlc1swXT0ianNvbiIsYT1lW29dLGVbb109ZnVuY3Rpb24oKXtzPWFyZ3VtZW50c30saS5hbHdheXMoZnVuY3Rpb24oKXtlW29dPWEsbltvXSYmKG4uanNvbnBDYWxsYmFjaz1yLmpzb25wQ2FsbGJhY2ssT24ucHVzaChvKSkscyYmYi5pc0Z1bmN0aW9uKGEpJiZhKHNbMF0pLHM9YT10fSksInNjcmlwdCIpOnR9KTt2YXIgUG4sUm4sV249MCwkbj1lLkFjdGl2ZVhPYmplY3QmJmZ1bmN0aW9uKCl7dmFyIGU7Zm9yKGUgaW4gUG4pUG5bZV0odCwhMCl9O2Z1bmN0aW9uIEluKCl7dHJ5e3JldHVybiBuZXcgZS5YTUxIdHRwUmVxdWVzdH1jYXRjaCh0KXt9fWZ1bmN0aW9uIHpuKCl7dHJ5e3JldHVybiBuZXcgZS5BY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpfWNhdGNoKHQpe319Yi5hamF4U2V0dGluZ3MueGhyPWUuQWN0aXZlWE9iamVjdD9mdW5jdGlvbigpe3JldHVybiF0aGlzLmlzTG9jYWwmJkluKCl8fHpuKCl9OkluLFJuPWIuYWpheFNldHRpbmdzLnhocigpLGIuc3VwcG9ydC5jb3JzPSEhUm4mJiJ3aXRoQ3JlZGVudGlhbHMiaW4gUm4sUm49Yi5zdXBwb3J0LmFqYXg9ISFSbixSbiYmYi5hamF4VHJhbnNwb3J0KGZ1bmN0aW9uKG4pe2lmKCFuLmNyb3NzRG9tYWlufHxiLnN1cHBvcnQuY29ycyl7dmFyIHI7cmV0dXJue3NlbmQ6ZnVuY3Rpb24oaSxvKXt2YXIgYSxzLHU9bi54aHIoKTtpZihuLnVzZXJuYW1lP3Uub3BlbihuLnR5cGUsbi51cmwsbi5hc3luYyxuLnVzZXJuYW1lLG4ucGFzc3dvcmQpOnUub3BlbihuLnR5cGUsbi51cmwsbi5hc3luYyksbi54aHJGaWVsZHMpZm9yKHMgaW4gbi54aHJGaWVsZHMpdVtzXT1uLnhockZpZWxkc1tzXTtuLm1pbWVUeXBlJiZ1Lm92ZXJyaWRlTWltZVR5cGUmJnUub3ZlcnJpZGVNaW1lVHlwZShuLm1pbWVUeXBlKSxuLmNyb3NzRG9tYWlufHxpWyJYLVJlcXVlc3RlZC1XaXRoIl18fChpWyJYLVJlcXVlc3RlZC1XaXRoIl09IlhNTEh0dHBSZXF1ZXN0Iik7dHJ5e2ZvcihzIGluIGkpdS5zZXRSZXF1ZXN0SGVhZGVyKHMsaVtzXSl9Y2F0Y2gobCl7fXUuc2VuZChuLmhhc0NvbnRlbnQmJm4uZGF0YXx8bnVsbCkscj1mdW5jdGlvbihlLGkpe3ZhciBzLGwsYyxwO3RyeXtpZihyJiYoaXx8ND09PXUucmVhZHlTdGF0ZSkpaWYocj10LGEmJih1Lm9ucmVhZHlzdGF0ZWNoYW5nZT1iLm5vb3AsJG4mJmRlbGV0ZSBQblthXSksaSk0IT09dS5yZWFkeVN0YXRlJiZ1LmFib3J0KCk7ZWxzZXtwPXt9LHM9dS5zdGF0dXMsbD11LmdldEFsbFJlc3BvbnNlSGVhZGVycygpLCJzdHJpbmciPT10eXBlb2YgdS5yZXNwb25zZVRleHQmJihwLnRleHQ9dS5yZXNwb25zZVRleHQpO3RyeXtjPXUuc3RhdHVzVGV4dH1jYXRjaChmKXtjPSIifXN8fCFuLmlzTG9jYWx8fG4uY3Jvc3NEb21haW4/MTIyMz09PXMmJihzPTIwNCk6cz1wLnRleHQ/MjAwOjQwNH19Y2F0Y2goZCl7aXx8bygtMSxkKX1wJiZvKHMsYyxwLGwpfSxuLmFzeW5jPzQ9PT11LnJlYWR5U3RhdGU/c2V0VGltZW91dChyKTooYT0rK1duLCRuJiYoUG58fChQbj17fSxiKGUpLnVubG9hZCgkbikpLFBuW2FdPXIpLHUub25yZWFkeXN0YXRlY2hhbmdlPXIpOnIoKX0sYWJvcnQ6ZnVuY3Rpb24oKXtyJiZyKHQsITApfX19fSk7dmFyIFhuLFVuLFZuPS9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLyxZbj1SZWdFeHAoIl4oPzooWystXSk9fCkoIit4KyIpKFthLXolXSopJCIsImkiKSxKbj0vcXVldWVIb29rcyQvLEduPVtucl0sUW49eyIqIjpbZnVuY3Rpb24oZSx0KXt2YXIgbixyLGk9dGhpcy5jcmVhdGVUd2VlbihlLHQpLG89WW4uZXhlYyh0KSxhPWkuY3VyKCkscz0rYXx8MCx1PTEsbD0yMDtpZihvKXtpZihuPStvWzJdLHI9b1szXXx8KGIuY3NzTnVtYmVyW2VdPyIiOiJweCIpLCJweCIhPT1yJiZzKXtzPWIuY3NzKGkuZWxlbSxlLCEwKXx8bnx8MTtkbyB1PXV8fCIuNSIscy89dSxiLnN0eWxlKGkuZWxlbSxlLHMrcik7d2hpbGUodSE9PSh1PWkuY3VyKCkvYSkmJjEhPT11JiYtLWwpfWkudW5pdD1yLGkuc3RhcnQ9cyxpLmVuZD1vWzFdP3MrKG9bMV0rMSkqbjpufXJldHVybiBpfV19O2Z1bmN0aW9uIEtuKCl7cmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtYbj10fSksWG49Yi5ub3coKX1mdW5jdGlvbiBabihlLHQpe2IuZWFjaCh0LGZ1bmN0aW9uKHQsbil7dmFyIHI9KFFuW3RdfHxbXSkuY29uY2F0KFFuWyIqIl0pLGk9MCxvPXIubGVuZ3RoO2Zvcig7bz5pO2krKylpZihyW2ldLmNhbGwoZSx0LG4pKXJldHVybn0pfWZ1bmN0aW9uIGVyKGUsdCxuKXt2YXIgcixpLG89MCxhPUduLmxlbmd0aCxzPWIuRGVmZXJyZWQoKS5hbHdheXMoZnVuY3Rpb24oKXtkZWxldGUgdS5lbGVtfSksdT1mdW5jdGlvbigpe2lmKGkpcmV0dXJuITE7dmFyIHQ9WG58fEtuKCksbj1NYXRoLm1heCgwLGwuc3RhcnRUaW1lK2wuZHVyYXRpb24tdCkscj1uL2wuZHVyYXRpb258fDAsbz0xLXIsYT0wLHU9bC50d2VlbnMubGVuZ3RoO2Zvcig7dT5hO2ErKylsLnR3ZWVuc1thXS5ydW4obyk7cmV0dXJuIHMubm90aWZ5V2l0aChlLFtsLG8sbl0pLDE+byYmdT9uOihzLnJlc29sdmVXaXRoKGUsW2xdKSwhMSl9LGw9cy5wcm9taXNlKHtlbGVtOmUscHJvcHM6Yi5leHRlbmQoe30sdCksb3B0czpiLmV4dGVuZCghMCx7c3BlY2lhbEVhc2luZzp7fX0sbiksb3JpZ2luYWxQcm9wZXJ0aWVzOnQsb3JpZ2luYWxPcHRpb25zOm4sc3RhcnRUaW1lOlhufHxLbigpLGR1cmF0aW9uOm4uZHVyYXRpb24sdHdlZW5zOltdLGNyZWF0ZVR3ZWVuOmZ1bmN0aW9uKHQsbil7dmFyIHI9Yi5Ud2VlbihlLGwub3B0cyx0LG4sbC5vcHRzLnNwZWNpYWxFYXNpbmdbdF18fGwub3B0cy5lYXNpbmcpO3JldHVybiBsLnR3ZWVucy5wdXNoKHIpLHJ9LHN0b3A6ZnVuY3Rpb24odCl7dmFyIG49MCxyPXQ/bC50d2VlbnMubGVuZ3RoOjA7aWYoaSlyZXR1cm4gdGhpcztmb3IoaT0hMDtyPm47bisrKWwudHdlZW5zW25dLnJ1bigxKTtyZXR1cm4gdD9zLnJlc29sdmVXaXRoKGUsW2wsdF0pOnMucmVqZWN0V2l0aChlLFtsLHRdKSx0aGlzfX0pLGM9bC5wcm9wcztmb3IodHIoYyxsLm9wdHMuc3BlY2lhbEVhc2luZyk7YT5vO28rKylpZihyPUduW29dLmNhbGwobCxlLGMsbC5vcHRzKSlyZXR1cm4gcjtyZXR1cm4gWm4obCxjKSxiLmlzRnVuY3Rpb24obC5vcHRzLnN0YXJ0KSYmbC5vcHRzLnN0YXJ0LmNhbGwoZSxsKSxiLmZ4LnRpbWVyKGIuZXh0ZW5kKHUse2VsZW06ZSxhbmltOmwscXVldWU6bC5vcHRzLnF1ZXVlfSkpLGwucHJvZ3Jlc3MobC5vcHRzLnByb2dyZXNzKS5kb25lKGwub3B0cy5kb25lLGwub3B0cy5jb21wbGV0ZSkuZmFpbChsLm9wdHMuZmFpbCkuYWx3YXlzKGwub3B0cy5hbHdheXMpfWZ1bmN0aW9uIHRyKGUsdCl7dmFyIG4scixpLG8sYTtmb3IoaSBpbiBlKWlmKHI9Yi5jYW1lbENhc2UoaSksbz10W3JdLG49ZVtpXSxiLmlzQXJyYXkobikmJihvPW5bMV0sbj1lW2ldPW5bMF0pLGkhPT1yJiYoZVtyXT1uLGRlbGV0ZSBlW2ldKSxhPWIuY3NzSG9va3Nbcl0sYSYmImV4cGFuZCJpbiBhKXtuPWEuZXhwYW5kKG4pLGRlbGV0ZSBlW3JdO2ZvcihpIGluIG4paSBpbiBlfHwoZVtpXT1uW2ldLHRbaV09byl9ZWxzZSB0W3JdPW99Yi5BbmltYXRpb249Yi5leHRlbmQoZXIse3R3ZWVuZXI6ZnVuY3Rpb24oZSx0KXtiLmlzRnVuY3Rpb24oZSk/KHQ9ZSxlPVsiKiJdKTplPWUuc3BsaXQoIiAiKTt2YXIgbixyPTAsaT1lLmxlbmd0aDtmb3IoO2k+cjtyKyspbj1lW3JdLFFuW25dPVFuW25dfHxbXSxRbltuXS51bnNoaWZ0KHQpfSxwcmVmaWx0ZXI6ZnVuY3Rpb24oZSx0KXt0P0duLnVuc2hpZnQoZSk6R24ucHVzaChlKX19KTtmdW5jdGlvbiBucihlLHQsbil7dmFyIHIsaSxvLGEscyx1LGwsYyxwLGY9dGhpcyxkPWUuc3R5bGUsaD17fSxnPVtdLG09ZS5ub2RlVHlwZSYmbm4oZSk7bi5xdWV1ZXx8KGM9Yi5fcXVldWVIb29rcyhlLCJmeCIpLG51bGw9PWMudW5xdWV1ZWQmJihjLnVucXVldWVkPTAscD1jLmVtcHR5LmZpcmUsYy5lbXB0eS5maXJlPWZ1bmN0aW9uKCl7Yy51bnF1ZXVlZHx8cCgpfSksYy51bnF1ZXVlZCsrLGYuYWx3YXlzKGZ1bmN0aW9uKCl7Zi5hbHdheXMoZnVuY3Rpb24oKXtjLnVucXVldWVkLS0sYi5xdWV1ZShlLCJmeCIpLmxlbmd0aHx8Yy5lbXB0eS5maXJlKCl9KX0pKSwxPT09ZS5ub2RlVHlwZSYmKCJoZWlnaHQiaW4gdHx8IndpZHRoImluIHQpJiYobi5vdmVyZmxvdz1bZC5vdmVyZmxvdyxkLm92ZXJmbG93WCxkLm92ZXJmbG93WV0sImlubGluZSI9PT1iLmNzcyhlLCJkaXNwbGF5IikmJiJub25lIj09PWIuY3NzKGUsImZsb2F0IikmJihiLnN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCYmImlubGluZSIhPT11bihlLm5vZGVOYW1lKT9kLnpvb209MTpkLmRpc3BsYXk9ImlubGluZS1ibG9jayIpKSxuLm92ZXJmbG93JiYoZC5vdmVyZmxvdz0iaGlkZGVuIixiLnN1cHBvcnQuc2hyaW5rV3JhcEJsb2Nrc3x8Zi5hbHdheXMoZnVuY3Rpb24oKXtkLm92ZXJmbG93PW4ub3ZlcmZsb3dbMF0sZC5vdmVyZmxvd1g9bi5vdmVyZmxvd1sxXSxkLm92ZXJmbG93WT1uLm92ZXJmbG93WzJdfSkpO2ZvcihpIGluIHQpaWYoYT10W2ldLFZuLmV4ZWMoYSkpe2lmKGRlbGV0ZSB0W2ldLHU9dXx8InRvZ2dsZSI9PT1hLGE9PT0obT8iaGlkZSI6InNob3ciKSljb250aW51ZTtnLnB1c2goaSl9aWYobz1nLmxlbmd0aCl7cz1iLl9kYXRhKGUsImZ4c2hvdyIpfHxiLl9kYXRhKGUsImZ4c2hvdyIse30pLCJoaWRkZW4iaW4gcyYmKG09cy5oaWRkZW4pLHUmJihzLmhpZGRlbj0hbSksbT9iKGUpLnNob3coKTpmLmRvbmUoZnVuY3Rpb24oKXtiKGUpLmhpZGUoKX0pLGYuZG9uZShmdW5jdGlvbigpe3ZhciB0O2IuX3JlbW92ZURhdGEoZSwiZnhzaG93Iik7Zm9yKHQgaW4gaCliLnN0eWxlKGUsdCxoW3RdKX0pO2ZvcihpPTA7bz5pO2krKylyPWdbaV0sbD1mLmNyZWF0ZVR3ZWVuKHIsbT9zW3JdOjApLGhbcl09c1tyXXx8Yi5zdHlsZShlLHIpLHIgaW4gc3x8KHNbcl09bC5zdGFydCxtJiYobC5lbmQ9bC5zdGFydCxsLnN0YXJ0PSJ3aWR0aCI9PT1yfHwiaGVpZ2h0Ij09PXI/MTowKSl9fWZ1bmN0aW9uIHJyKGUsdCxuLHIsaSl7cmV0dXJuIG5ldyByci5wcm90b3R5cGUuaW5pdChlLHQsbixyLGkpfWIuVHdlZW49cnIscnIucHJvdG90eXBlPXtjb25zdHJ1Y3Rvcjpycixpbml0OmZ1bmN0aW9uKGUsdCxuLHIsaSxvKXt0aGlzLmVsZW09ZSx0aGlzLnByb3A9bix0aGlzLmVhc2luZz1pfHwic3dpbmciLHRoaXMub3B0aW9ucz10LHRoaXMuc3RhcnQ9dGhpcy5ub3c9dGhpcy5jdXIoKSx0aGlzLmVuZD1yLHRoaXMudW5pdD1vfHwoYi5jc3NOdW1iZXJbbl0/IiI6InB4Iil9LGN1cjpmdW5jdGlvbigpe3ZhciBlPXJyLnByb3BIb29rc1t0aGlzLnByb3BdO3JldHVybiBlJiZlLmdldD9lLmdldCh0aGlzKTpyci5wcm9wSG9va3MuX2RlZmF1bHQuZ2V0KHRoaXMpfSxydW46ZnVuY3Rpb24oZSl7dmFyIHQsbj1yci5wcm9wSG9va3NbdGhpcy5wcm9wXTtyZXR1cm4gdGhpcy5wb3M9dD10aGlzLm9wdGlvbnMuZHVyYXRpb24/Yi5lYXNpbmdbdGhpcy5lYXNpbmddKGUsdGhpcy5vcHRpb25zLmR1cmF0aW9uKmUsMCwxLHRoaXMub3B0aW9ucy5kdXJhdGlvbik6ZSx0aGlzLm5vdz0odGhpcy5lbmQtdGhpcy5zdGFydCkqdCt0aGlzLnN0YXJ0LHRoaXMub3B0aW9ucy5zdGVwJiZ0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKHRoaXMuZWxlbSx0aGlzLm5vdyx0aGlzKSxuJiZuLnNldD9uLnNldCh0aGlzKTpyci5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KHRoaXMpLHRoaXN9fSxyci5wcm90b3R5cGUuaW5pdC5wcm90b3R5cGU9cnIucHJvdG90eXBlLHJyLnByb3BIb29rcz17X2RlZmF1bHQ6e2dldDpmdW5jdGlvbihlKXt2YXIgdDtyZXR1cm4gbnVsbD09ZS5lbGVtW2UucHJvcF18fGUuZWxlbS5zdHlsZSYmbnVsbCE9ZS5lbGVtLnN0eWxlW2UucHJvcF0/KHQ9Yi5jc3MoZS5lbGVtLGUucHJvcCwiIiksdCYmImF1dG8iIT09dD90OjApOmUuZWxlbVtlLnByb3BdfSxzZXQ6ZnVuY3Rpb24oZSl7Yi5meC5zdGVwW2UucHJvcF0/Yi5meC5zdGVwW2UucHJvcF0oZSk6ZS5lbGVtLnN0eWxlJiYobnVsbCE9ZS5lbGVtLnN0eWxlW2IuY3NzUHJvcHNbZS5wcm9wXV18fGIuY3NzSG9va3NbZS5wcm9wXSk/Yi5zdHlsZShlLmVsZW0sZS5wcm9wLGUubm93K2UudW5pdCk6ZS5lbGVtW2UucHJvcF09ZS5ub3d9fX0scnIucHJvcEhvb2tzLnNjcm9sbFRvcD1yci5wcm9wSG9va3Muc2Nyb2xsTGVmdD17c2V0OmZ1bmN0aW9uKGUpe2UuZWxlbS5ub2RlVHlwZSYmZS5lbGVtLnBhcmVudE5vZGUmJihlLmVsZW1bZS5wcm9wXT1lLm5vdyl9fSxiLmVhY2goWyJ0b2dnbGUiLCJzaG93IiwiaGlkZSJdLGZ1bmN0aW9uKGUsdCl7dmFyIG49Yi5mblt0XTtiLmZuW3RdPWZ1bmN0aW9uKGUscixpKXtyZXR1cm4gbnVsbD09ZXx8ImJvb2xlYW4iPT10eXBlb2YgZT9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTp0aGlzLmFuaW1hdGUoaXIodCwhMCksZSxyLGkpfX0pLGIuZm4uZXh0ZW5kKHtmYWRlVG86ZnVuY3Rpb24oZSx0LG4scil7cmV0dXJuIHRoaXMuZmlsdGVyKG5uKS5jc3MoIm9wYWNpdHkiLDApLnNob3coKS5lbmQoKS5hbmltYXRlKHtvcGFjaXR5OnR9LGUsbixyKX0sYW5pbWF0ZTpmdW5jdGlvbihlLHQsbixyKXt2YXIgaT1iLmlzRW1wdHlPYmplY3QoZSksbz1iLnNwZWVkKHQsbixyKSxhPWZ1bmN0aW9uKCl7dmFyIHQ9ZXIodGhpcyxiLmV4dGVuZCh7fSxlKSxvKTthLmZpbmlzaD1mdW5jdGlvbigpe3Quc3RvcCghMCl9LChpfHxiLl9kYXRhKHRoaXMsImZpbmlzaCIpKSYmdC5zdG9wKCEwKX07cmV0dXJuIGEuZmluaXNoPWEsaXx8by5xdWV1ZT09PSExP3RoaXMuZWFjaChhKTp0aGlzLnF1ZXVlKG8ucXVldWUsYSl9LHN0b3A6ZnVuY3Rpb24oZSxuLHIpe3ZhciBpPWZ1bmN0aW9uKGUpe3ZhciB0PWUuc3RvcDtkZWxldGUgZS5zdG9wLHQocil9O3JldHVybiJzdHJpbmciIT10eXBlb2YgZSYmKHI9bixuPWUsZT10KSxuJiZlIT09ITEmJnRoaXMucXVldWUoZXx8ImZ4IixbXSksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIHQ9ITAsbj1udWxsIT1lJiZlKyJxdWV1ZUhvb2tzIixvPWIudGltZXJzLGE9Yi5fZGF0YSh0aGlzKTtpZihuKWFbbl0mJmFbbl0uc3RvcCYmaShhW25dKTtlbHNlIGZvcihuIGluIGEpYVtuXSYmYVtuXS5zdG9wJiZKbi50ZXN0KG4pJiZpKGFbbl0pO2ZvcihuPW8ubGVuZ3RoO24tLTspb1tuXS5lbGVtIT09dGhpc3x8bnVsbCE9ZSYmb1tuXS5xdWV1ZSE9PWV8fChvW25dLmFuaW0uc3RvcChyKSx0PSExLG8uc3BsaWNlKG4sMSkpOyh0fHwhcikmJmIuZGVxdWV1ZSh0aGlzLGUpfSl9LGZpbmlzaDpmdW5jdGlvbihlKXtyZXR1cm4gZSE9PSExJiYoZT1lfHwiZngiKSx0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgdCxuPWIuX2RhdGEodGhpcykscj1uW2UrInF1ZXVlIl0saT1uW2UrInF1ZXVlSG9va3MiXSxvPWIudGltZXJzLGE9cj9yLmxlbmd0aDowO2ZvcihuLmZpbmlzaD0hMCxiLnF1ZXVlKHRoaXMsZSxbXSksaSYmaS5jdXImJmkuY3VyLmZpbmlzaCYmaS5jdXIuZmluaXNoLmNhbGwodGhpcyksdD1vLmxlbmd0aDt0LS07KW9bdF0uZWxlbT09PXRoaXMmJm9bdF0ucXVldWU9PT1lJiYob1t0XS5hbmltLnN0b3AoITApLG8uc3BsaWNlKHQsMSkpO2Zvcih0PTA7YT50O3QrKylyW3RdJiZyW3RdLmZpbmlzaCYmclt0XS5maW5pc2guY2FsbCh0aGlzKTtkZWxldGUgbi5maW5pc2h9KX19KTtmdW5jdGlvbiBpcihlLHQpe3ZhciBuLHI9e2hlaWdodDplfSxpPTA7Zm9yKHQ9dD8xOjA7ND5pO2krPTItdCluPVp0W2ldLHJbIm1hcmdpbiIrbl09clsicGFkZGluZyIrbl09ZTtyZXR1cm4gdCYmKHIub3BhY2l0eT1yLndpZHRoPWUpLHJ9Yi5lYWNoKHtzbGlkZURvd246aXIoInNob3ciKSxzbGlkZVVwOmlyKCJoaWRlIiksc2xpZGVUb2dnbGU6aXIoInRvZ2dsZSIpLGZhZGVJbjp7b3BhY2l0eToic2hvdyJ9LGZhZGVPdXQ6e29wYWNpdHk6ImhpZGUifSxmYWRlVG9nZ2xlOntvcGFjaXR5OiJ0b2dnbGUifX0sZnVuY3Rpb24oZSx0KXtiLmZuW2VdPWZ1bmN0aW9uKGUsbixyKXtyZXR1cm4gdGhpcy5hbmltYXRlKHQsZSxuLHIpfX0pLGIuc3BlZWQ9ZnVuY3Rpb24oZSx0LG4pe3ZhciByPWUmJiJvYmplY3QiPT10eXBlb2YgZT9iLmV4dGVuZCh7fSxlKTp7Y29tcGxldGU6bnx8IW4mJnR8fGIuaXNGdW5jdGlvbihlKSYmZSxkdXJhdGlvbjplLGVhc2luZzpuJiZ0fHx0JiYhYi5pc0Z1bmN0aW9uKHQpJiZ0fTtyZXR1cm4gci5kdXJhdGlvbj1iLmZ4Lm9mZj8wOiJudW1iZXIiPT10eXBlb2Ygci5kdXJhdGlvbj9yLmR1cmF0aW9uOnIuZHVyYXRpb24gaW4gYi5meC5zcGVlZHM/Yi5meC5zcGVlZHNbci5kdXJhdGlvbl06Yi5meC5zcGVlZHMuX2RlZmF1bHQsKG51bGw9PXIucXVldWV8fHIucXVldWU9PT0hMCkmJihyLnF1ZXVlPSJmeCIpLHIub2xkPXIuY29tcGxldGUsci5jb21wbGV0ZT1mdW5jdGlvbigpe2IuaXNGdW5jdGlvbihyLm9sZCkmJnIub2xkLmNhbGwodGhpcyksci5xdWV1ZSYmYi5kZXF1ZXVlKHRoaXMsci5xdWV1ZSl9LHJ9LGIuZWFzaW5nPXtsaW5lYXI6ZnVuY3Rpb24oZSl7cmV0dXJuIGV9LHN3aW5nOmZ1bmN0aW9uKGUpe3JldHVybi41LU1hdGguY29zKGUqTWF0aC5QSSkvMn19LGIudGltZXJzPVtdLGIuZng9cnIucHJvdG90eXBlLmluaXQsYi5meC50aWNrPWZ1bmN0aW9uKCl7dmFyIGUsbj1iLnRpbWVycyxyPTA7Zm9yKFhuPWIubm93KCk7bi5sZW5ndGg+cjtyKyspZT1uW3JdLGUoKXx8bltyXSE9PWV8fG4uc3BsaWNlKHItLSwxKTtuLmxlbmd0aHx8Yi5meC5zdG9wKCksWG49dH0sYi5meC50aW1lcj1mdW5jdGlvbihlKXtlKCkmJmIudGltZXJzLnB1c2goZSkmJmIuZnguc3RhcnQoKX0sYi5meC5pbnRlcnZhbD0xMyxiLmZ4LnN0YXJ0PWZ1bmN0aW9uKCl7VW58fChVbj1zZXRJbnRlcnZhbChiLmZ4LnRpY2ssYi5meC5pbnRlcnZhbCkpfSxiLmZ4LnN0b3A9ZnVuY3Rpb24oKXtjbGVhckludGVydmFsKFVuKSxVbj1udWxsfSxiLmZ4LnNwZWVkcz17c2xvdzo2MDAsZmFzdDoyMDAsX2RlZmF1bHQ6NDAwfSxiLmZ4LnN0ZXA9e30sYi5leHByJiZiLmV4cHIuZmlsdGVycyYmKGIuZXhwci5maWx0ZXJzLmFuaW1hdGVkPWZ1bmN0aW9uKGUpe3JldHVybiBiLmdyZXAoYi50aW1lcnMsZnVuY3Rpb24odCl7cmV0dXJuIGU9PT10LmVsZW19KS5sZW5ndGh9KSxiLmZuLm9mZnNldD1mdW5jdGlvbihlKXtpZihhcmd1bWVudHMubGVuZ3RoKXJldHVybiBlPT09dD90aGlzOnRoaXMuZWFjaChmdW5jdGlvbih0KXtiLm9mZnNldC5zZXRPZmZzZXQodGhpcyxlLHQpfSk7dmFyIG4scixvPXt0b3A6MCxsZWZ0OjB9LGE9dGhpc1swXSxzPWEmJmEub3duZXJEb2N1bWVudDtpZihzKXJldHVybiBuPXMuZG9jdW1lbnRFbGVtZW50LGIuY29udGFpbnMobixhKT8odHlwZW9mIGEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0IT09aSYmKG89YS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSkscj1vcihzKSx7dG9wOm8udG9wKyhyLnBhZ2VZT2Zmc2V0fHxuLnNjcm9sbFRvcCktKG4uY2xpZW50VG9wfHwwKSxsZWZ0Om8ubGVmdCsoci5wYWdlWE9mZnNldHx8bi5zY3JvbGxMZWZ0KS0obi5jbGllbnRMZWZ0fHwwKX0pOm99LGIub2Zmc2V0PXtzZXRPZmZzZXQ6ZnVuY3Rpb24oZSx0LG4pe3ZhciByPWIuY3NzKGUsInBvc2l0aW9uIik7InN0YXRpYyI9PT1yJiYoZS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiKTt2YXIgaT1iKGUpLG89aS5vZmZzZXQoKSxhPWIuY3NzKGUsInRvcCIpLHM9Yi5jc3MoZSwibGVmdCIpLHU9KCJhYnNvbHV0ZSI9PT1yfHwiZml4ZWQiPT09cikmJmIuaW5BcnJheSgiYXV0byIsW2Esc10pPi0xLGw9e30sYz17fSxwLGY7dT8oYz1pLnBvc2l0aW9uKCkscD1jLnRvcCxmPWMubGVmdCk6KHA9cGFyc2VGbG9hdChhKXx8MCxmPXBhcnNlRmxvYXQocyl8fDApLGIuaXNGdW5jdGlvbih0KSYmKHQ9dC5jYWxsKGUsbixvKSksbnVsbCE9dC50b3AmJihsLnRvcD10LnRvcC1vLnRvcCtwKSxudWxsIT10LmxlZnQmJihsLmxlZnQ9dC5sZWZ0LW8ubGVmdCtmKSwidXNpbmciaW4gdD90LnVzaW5nLmNhbGwoZSxsKTppLmNzcyhsKX19LGIuZm4uZXh0ZW5kKHtwb3NpdGlvbjpmdW5jdGlvbigpe2lmKHRoaXNbMF0pe3ZhciBlLHQsbj17dG9wOjAsbGVmdDowfSxyPXRoaXNbMF07cmV0dXJuImZpeGVkIj09PWIuY3NzKHIsInBvc2l0aW9uIik/dD1yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOihlPXRoaXMub2Zmc2V0UGFyZW50KCksdD10aGlzLm9mZnNldCgpLGIubm9kZU5hbWUoZVswXSwiaHRtbCIpfHwobj1lLm9mZnNldCgpKSxuLnRvcCs9Yi5jc3MoZVswXSwiYm9yZGVyVG9wV2lkdGgiLCEwKSxuLmxlZnQrPWIuY3NzKGVbMF0sImJvcmRlckxlZnRXaWR0aCIsITApKSx7dG9wOnQudG9wLW4udG9wLWIuY3NzKHIsIm1hcmdpblRvcCIsITApLGxlZnQ6dC5sZWZ0LW4ubGVmdC1iLmNzcyhyLCJtYXJnaW5MZWZ0IiwhMCl9fX0sb2Zmc2V0UGFyZW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5vZmZzZXRQYXJlbnR8fG8uZG9jdW1lbnRFbGVtZW50O3doaWxlKGUmJiFiLm5vZGVOYW1lKGUsImh0bWwiKSYmInN0YXRpYyI9PT1iLmNzcyhlLCJwb3NpdGlvbiIpKWU9ZS5vZmZzZXRQYXJlbnQ7cmV0dXJuIGV8fG8uZG9jdW1lbnRFbGVtZW50fSl9fSksYi5lYWNoKHtzY3JvbGxMZWZ0OiJwYWdlWE9mZnNldCIsc2Nyb2xsVG9wOiJwYWdlWU9mZnNldCJ9LGZ1bmN0aW9uKGUsbil7dmFyIHI9L1kvLnRlc3Qobik7Yi5mbltlXT1mdW5jdGlvbihpKXtyZXR1cm4gYi5hY2Nlc3ModGhpcyxmdW5jdGlvbihlLGksbyl7dmFyIGE9b3IoZSk7cmV0dXJuIG89PT10P2E/biBpbiBhP2Fbbl06YS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbaV06ZVtpXTooYT9hLnNjcm9sbFRvKHI/YihhKS5zY3JvbGxMZWZ0KCk6byxyP286YihhKS5zY3JvbGxUb3AoKSk6ZVtpXT1vLHQpfSxlLGksYXJndW1lbnRzLmxlbmd0aCxudWxsKX19KTtmdW5jdGlvbiBvcihlKXtyZXR1cm4gYi5pc1dpbmRvdyhlKT9lOjk9PT1lLm5vZGVUeXBlP2UuZGVmYXVsdFZpZXd8fGUucGFyZW50V2luZG93OiExfWIuZWFjaCh7SGVpZ2h0OiJoZWlnaHQiLFdpZHRoOiJ3aWR0aCJ9LGZ1bmN0aW9uKGUsbil7Yi5lYWNoKHtwYWRkaW5nOiJpbm5lciIrZSxjb250ZW50Om4sIiI6Im91dGVyIitlfSxmdW5jdGlvbihyLGkpe2IuZm5baV09ZnVuY3Rpb24oaSxvKXt2YXIgYT1hcmd1bWVudHMubGVuZ3RoJiYocnx8ImJvb2xlYW4iIT10eXBlb2YgaSkscz1yfHwoaT09PSEwfHxvPT09ITA/Im1hcmdpbiI6ImJvcmRlciIpO3JldHVybiBiLmFjY2Vzcyh0aGlzLGZ1bmN0aW9uKG4scixpKXt2YXIgbztyZXR1cm4gYi5pc1dpbmRvdyhuKT9uLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsiY2xpZW50IitlXTo5PT09bi5ub2RlVHlwZT8obz1uLmRvY3VtZW50RWxlbWVudCxNYXRoLm1heChuLmJvZHlbInNjcm9sbCIrZV0sb1sic2Nyb2xsIitlXSxuLmJvZHlbIm9mZnNldCIrZV0sb1sib2Zmc2V0IitlXSxvWyJjbGllbnQiK2VdKSk6aT09PXQ/Yi5jc3MobixyLHMpOmIuc3R5bGUobixyLGkscyl9LG4sYT9pOnQsYSxudWxsKX19KX0pLGUualF1ZXJ5PWUuJD1iLCJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQmJmRlZmluZS5hbWQualF1ZXJ5JiZkZWZpbmUoImpxdWVyeSIsW10sZnVuY3Rpb24oKXtyZXR1cm4gYn0pfSkod2luZG93KTs=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 310,
          "bodySize": 123512
        },
        "cache": {},
        "timings": {
          "send": 25,
          "wait": 0,
          "receive": 23
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8633"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.616-07:00",
        "time": 46,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/jquery/jquery-extension-1.9.1.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 353,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "4688"
            }
          ],
          "content": {
            "size": 14572,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "Ly8NCi8vIFRoaXMgZmlsZSBjb250YWlucyBjdXN0b20galF1ZXJ5IGZ1bmN0aW9ucyBub3QgaW4gdGhlIGJhc2ljIGpRdWVyeSBsaWJyYXJ5Lg0KLy8NCg0KLy8gZm9yIGxlZ2FjeSBicm93c2VyIGRldGVjdGlvbi4gICQuYnJvd3NlciB3YXMgcmVtb3ZlZCBpbiBqUXVlcnkgMS45DQpqUXVlcnkuYnJvd3Nlcj17fTsNCihmdW5jdGlvbigpew0KICAgalF1ZXJ5LmJyb3dzZXIubXNpZT1mYWxzZTsNCiAgIGpRdWVyeS5icm93c2VyLnZlcnNpb249MDsNCiAgIGlmKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL01TSUUgKFswLTldKylcLi8pKXsNCiAgICAgIGpRdWVyeS5icm93c2VyLm1zaWU9dHJ1ZTsNCiAgICAgIGpRdWVyeS5icm93c2VyLnZlcnNpb249UmVnRXhwLiQxOw0KICAgfQ0KfSkoKTsNCg0KLyoqDQogKiBFc2NhcGUgYW4gZWxlbWVudCBpZCBzbyB0aGF0IGl0IGNhbiBiZSB1c2VkIGluIGEgalF1ZXJ5IHNlbGVjdG9yDQogKg0KICogdXNhZ2U6ICQoIiMiICsgZXNjYXBlKCdteWlkLndpdGguc3BlYy5jaGFycycpKQ0KICovDQpmdW5jdGlvbiBlc2NhcGUoIGVsZW1JRCApIHsNCglyZXR1cm4gZWxlbUlELnJlcGxhY2UoIC8oOnxcLnxcW3xcXSkvZywgIlxcJDEiICk7DQp9DQplc2MgPSBlc2NhcGU7DQoNCi8qKg0KICogalF1ZXJ5IGN1c3RvbSBmdW5jdGlvbiB0byBzZXQgdGhlIGNzcyAndmlzaWJpbGl0eScgc3R5bGUgdG8gJ3Zpc2libGUnLg0KICogTm90ZTogVGhpcyBpcyBkaWZmZXJlbnQgdGhhbiBoaWRlKCkvc2hvdygpIHdoaWNoIHRvZ2dsZXMgdGhlIGNzcyAnZGlzcGxheScgYXR0cmlidXRlLg0KICoNCiAqIHVzYWdlOiAkKCcjbXlpZCcpLnZpc2libGUoKTsNCiAqLw0KalF1ZXJ5LmZuLnZpc2libGUgPSBmdW5jdGlvbigpIHsNCglyZXR1cm4gdGhpcy5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpOw0KfQ0KDQovKioNCiAqIGpRdWVyeSBjdXN0b20gZnVuY3Rpb24gdG8gc2V0IHRoZSBjc3MgJ3Zpc2liaWxpdHknIHN0eWxlIHRvICdoaWRkZW4nLg0KICogTm90ZTogVGhpcyBpcyBkaWZmZXJlbnQgdGhhbiBoaWRlKCkvc2hvdygpIHdoaWNoIHRvZ2dsZXMgdGhlIGNzcyAnZGlzcGxheScgYXR0cmlidXRlLg0KICoNCiAqIHVzYWdlOiAkKCcjbXlpZCcpLmludmlzaWJsZSgpOw0KICovDQpqUXVlcnkuZm4uaW52aXNpYmxlID0gZnVuY3Rpb24oKSB7DQoJcmV0dXJuIHRoaXMuY3NzKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpOw0KfQ0KDQovKioNCiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgY3VycmVudCBvYmplY3QgaXMgdmlzaWJsZS4NCiAqLw0KalF1ZXJ5LmZuLmlzVmlzaWJsZSA9IGZ1bmN0aW9uKCkgew0KCXJldHVybiB0aGlzLmNzcygndmlzaWJpbGl0eScpID09ICd2aXNpYmxlJzsNCn0NCg0KLyoqDQogKiBTZXRzIHRoZSBjc3MgJ3Zpc2liaWxpdHknIHN0eWxlIHRvICd2aXNpYmxlJyBvciAnaGlkZGVuJyBiYXNlZCBvbiB0aGUgaXNWaXNpYmxlIHBhcmFtZXRlcg0KICoNCiAqIHVzYWdlOiAkKCcjbXlpZCcpLnNldFZpc2libGUodHJ1ZSk7DQogKg0KICogQHBhcmFtIGlzVmlzaWJsZQ0KICogICAgICAgICAgICBib29sZWFuLCAndHJ1ZScgb3IgJ2ZhbHNlJw0KICovDQpqUXVlcnkuZm4uc2V0VmlzaWJsZSA9IGZ1bmN0aW9uKCBpc1Zpc2libGUgKSB7DQoJcmV0dXJuIGlzVmlzaWJsZSA/IHRoaXMudmlzaWJsZSgpIDogdGhpcy5pbnZpc2libGUoKTsNCn0NCg0KLyoqDQogKiBTaG93cyBvciBoaWRlcyAoc2V0cyB0aGUgY3NzICdkaXNwbGF5JyBzdHlsZSB0byAnaW5saW5lJyBvciAnbm9uZScpIHRoaXMgZWxlbWVudCBiYXNlZCBvbg0KICogdGhlIGlzRGlzcGxheWVkIHBhcmFtZXRlci4NCiAqDQogKiB1c2FnZTogJCgnI215aWQnKS5zZXREaXNwbGF5ZWQodHJ1ZSk7DQogKg0KICogQHBhcmFtIGlzRGlzcGxheWVkDQogKiAgICAgICAgICAgIGJvb2xlYW4sICd0cnVlJyBvciAnZmFsc2UnDQogKi8NCmpRdWVyeS5mbi5zZXREaXNwbGF5ZWQgPSBmdW5jdGlvbiggaXNEaXNwbGF5ZWQgKSB7DQoJcmV0dXJuIGlzRGlzcGxheWVkID8gdGhpcy5zaG93KCkgOiB0aGlzLmhpZGUoKTsNCn0NCg0KLyoqDQogKiBGb3JjZXMgYSByZWRyYXcuICBUaGVyZSBpcyBhIGJ1ZyB3aXRoIElFOSB3aGVyZSBzb21ldGltZXMgYSBtYW5pcHVsYXRlZCB0YWJsZSBvciBESVYgd2lsbCBub3QgcmUtcmVuZGVyIHByb3Blcmx5DQogKi8NCmpRdWVyeS5mbi5yZWRyYXcgPSBmdW5jdGlvbigpIHsNCgl0aGlzLmhpZGUoKTsNCglqUXVlcnkodGhpcykuZWFjaChmdW5jdGlvbigpew0KCQkvLyBzaW1wbHkgYWNjZXNzIHRoaXMgdmFyaWFibGUgdG8gZm9yY2UgYSBmbHVzaCBvZiB0aGUgcmVuZGVyaW5nIHF1ZXVlDQoJICAgIHZhciByZWRyYXcgPSB0aGlzLm9mZnNldEhlaWdodDsNCgkgfSk7DQoJLy8gbm93IHJlZHJhdy9yZS1sYXlvdXQNCgl0aGlzLnNob3coKTsNCn0NCg0KLyoqDQogKiBMaW1pdHMgYSB0ZXh0YXJlYSB0byB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiBjaGFyYWN0ZXJzLiAgT3B0aW9uYWxseSwgaWYgY2hhckNvdW50RWxlbSBpcyBzcGVjaWZpZWQsDQogKiB3aWxsIGRpc3BsYXkgdGhlIG51bWJlciBvZiBjaGFyYWN0ZXIgcmVtYWluaW5nLg0KICogDQogKiAoVGhpcyBmdW5jdGlvbiBkb2Vzbid0IHJlYWxseSB3b3JrIGFsbCB0aGF0IHdlbGwgLi4uIGl0IGZsYXNoZXMgYW5kIGp1bXBzIHRoZSBzY3JvbGwgb2YgdGhlIA0KICogdGV4dGFyZWEgcmFuZG9tbHkgaW4gSUU4LCB0aG91Z2ggaW4gb3RoZXIgYnJvd3NlcnMgaXMgd29ya3Mgd2VsbCkNCiAqLw0KalF1ZXJ5LmZuLm1heExlbmd0aCA9IGZ1bmN0aW9uKGxpbWl0LCBjaGFyQ291bnRFbGVtKSB7DQoJLy8gbm9ybWFsbHkgdGhpcyB3b3VsZCBiZSBhbiBvbmlucHV0IGV2ZW50LCBidXQgdGhhdCdzIG9ubHkgc3VwcG9ydGVkIGluIElFOSsNCglpZiAoalF1ZXJ5LmJyb3dzZXIubXNpZSAmJiBqUXVlcnkuYnJvd3Nlci52ZXJzaW9uIDw9IDgpIHsNCgkJalF1ZXJ5KHRoaXMpLm9uKCJrZXl1cCBwYXN0ZSIsIGZ1bmN0aW9uKCkgeyAvL2ZvY3VzIGJsdXINCgkJCXZhciBfdGhpcyA9IHRoaXM7DQoJCQkvLyBJRTggaGFjayAtIHNob3J0IHBhdXNlIHRvIHdhaXQgZm9yIHBhc3RlIHRvIGNvbXBsZXRlDQoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyANCgkJICAgICAgICBzZXRDb3VudChfdGhpcywgY2hhckNvdW50RWxlbSk7DQoJCQl9LCAxMDApOw0KCSAgICB9KTsNCgl9DQoJZWxzZSB7DQoJCWpRdWVyeSh0aGlzKS5vbigiaW5wdXQiLCBmdW5jdGlvbigpIHsNCgkgICAgICAgIHNldENvdW50KHRoaXMsIGNoYXJDb3VudEVsZW0pOw0KCSAgICB9KTsNCgl9DQogICAgZnVuY3Rpb24gc2V0Q291bnQoc3JjLCBjaGFyQ291bnRFbGVtKSB7DQogICAgCWlmIChzcmMgIT0gdW5kZWZpbmVkKSB7DQoJICAgICAgICB2YXIgY2hhcnMgPSBzcmMudmFsdWUubGVuZ3RoOw0KCSAgICAgICAgaWYgKGNoYXJzID4gbGltaXQpIHsNCgkgICAgICAgICAgICBzcmMudmFsdWUgPSBzcmMudmFsdWUuc3Vic3RyKDAsIGxpbWl0KTsNCgkgICAgICAgICAgICBjaGFycyA9IGxpbWl0Ow0KCSAgICAgICAgfSAgICAgCQ0KCSAgICAgICAgaWYgKGNoYXJDb3VudEVsZW0gIT0gbnVsbCkgeyAgIA0KCSAgICAgICAgCWNoYXJDb3VudEVsZW0uaHRtbCggbGltaXQgLSBjaGFycyApOw0KCSAgICAgICAgfQ0KICAgIAl9DQogICAgfQ0KICAgIHNldENvdW50KGpRdWVyeSh0aGlzKVswXSwgY2hhckNvdW50RWxlbSk7DQp9Ow0KDQooZnVuY3Rpb24oJCl7IA0KDQogICAgJC5mbi5leHRlbmQoeyAgDQogICAgCS8qKg0KICAgIAkgKiBTYW1lIGFzIHRoZSBtYXhMZW5ndGggZnVuY3Rpb24gZm9yIHRleHRhcmVhcywgYnV0IHRoaXMganVzdCBkaXNwbGF5cyB0aGUgY291bnQgb2YgY2hhcmFjdGVycyByZW1haW5pbmcuDQogICAgCSAqICAgIHVzYWdlOiAkKCIjbXlUZXh0QXJlYSIpLnJlcG9ydCg1MDAsICIjbXlUeHRDb3VudGVyRGl2Iik7DQogICAgCSAqLw0KICAgICAgICByZXBvcnQ6IGZ1bmN0aW9uKGxpbWl0LGVsZW1lbnQpIHsNCiAgICAgICAgCSQodGhpcykub24oJ2lucHV0JywgcmVwb3J0KTsNCiAgICAgICAgCXZhciBzZWxmID0gJCh0aGlzKTsNCgkJCWZ1bmN0aW9uIHJlcG9ydCgpIHsgDQoJCQkJdmFyIHZhbCA9ICQoc2VsZikudmFsKCk7DQoJCQkgICAgdmFyIGxlbmd0aCA9ICh2YWwgPT0gdW5kZWZpbmVkKSA/IDAgOiB2YWwubGVuZ3RoOw0KCQkJICAgIGlmKCQoZWxlbWVudCkuaHRtbCgpID09ICcnIHx8ICQoZWxlbWVudCkuaHRtbCgpICE9IGxpbWl0LWxlbmd0aCkgew0KCQkJICAgICAgICAkKGVsZW1lbnQpLmh0bWwobGltaXQtbGVuZ3RoKTsNCgkJCSAgICB9DQoJCQl9DQoJCQlyZXBvcnQoKTsNCiAgICAgICAgfQ0KCX0pOyANCiAgICANCiAgICANCiAgICAkLmV4dGVuZCh7ICANCiAgICAJLyoqDQogICAgCSAqIFRoaXMgZnVuY3Rpb24gd2lsbCBwYXJzZSBhIFVSTCBzdHJpbmcgYW5kIHJldHVybiB0aGUgcGFyYW1ldGVycyBhcyBhIGhhc2htYXAuDQogICAgCSAqIA0KICAgIAkgKiBVc2FnZTogDQogICAgCSAqIHZhciBwYXJhbXMgPSAkLnBhcnNlUGFyYW1zKCI/ZG9jTmI9ODAwNTUwJmQtMzY3MDE0OS1vPTEmZC0zNjcwMTQ5LXA9MiIpOw0KICAgIAkgKiB2YXIgZG9jTmIgPSBwYXJhbXNbJ2RvY05iJ107DQogICAgCSAqLw0KICAgICAgICBwYXJzZVBhcmFtczogZnVuY3Rpb24odXJsKSB7DQoJCQl2YXIgcGFyYW1zID0ge30sIG0sIHJlID0gLyhbXiY9XSspPShbXiZdKikvZzsNCgkJCXdoaWxlIChtID0gcmUuZXhlYyh1cmwuc2xpY2UodXJsLmluZGV4T2YoIj8iKSsxKSkpIHsNCgkJCSAgICBwYXJhbXNbbVsxXV0gPSBtWzJdOw0KCQkJfQ0KCQkJcmV0dXJuIHBhcmFtczsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogT3BlbnMgYSBDU1MgbW9kYWwgZGlhbG9nIGRpc3BsYXlpbmcgdGhlIGNvbnRlbnRzIG9mIHRoZSBkaXNjbGFpbWVyICh0aXRsZSwgYm9keSkuDQogICAgICAgICAqIFdoZW4gT0sgaXMgcHJlc3NlZCwgYW4gYWNrbm93bGVkZ21lbnQgUE9TVCByZXF1ZXN0IGlzIHNlbnQgdG8gIi9vbW5pL2FkdmNvci9uZWVkcy9kaXNjbGFpbWVyLmpzb24iIHdpdGggdGhlIGdpdmVuIG9mZmVuZGVyLCBkb21haW4sIGFuZCBzY3JlZW4NCiAgICAgICAgICogDQogICAgICAgICAqIEBwYXJhbSBvcHRpb25zIGFuIG9iamVjdCB3aXRoIGZvbGxvd2luZyBzdHJ1Y3R1cmUNCiAgICAgICAgICogCXsNCiAgICAgICAgICogCSAgdGl0bGU6ICIiLCAgICAtIHRpdGxlIG9mIHRoZSBkaWFsb2cNCiAgICAgICAgICogCSAgYm9keTogIiIsICAgICAtIGJvZHkgdGV4dCBvZiB0aGUgZGlhbG9nDQogICAgICAgICAqICAgIGRvY05iOiAiIiwgICAgLSBvZmZlbmRlciB0aGlzIGFja25vd2xlZGdtZW50IGlzIGZvcg0KICAgICAgICAgKiAgICBvZm5udHlDZDogIiIsIC0gYSByZWZlcmVuY2UgdG8gYSBUYk9mbk5kc1R5cENkIGNvZGUNCiAgICAgICAgICogICAgc2NyZWVuOiAiIiwgICAtIGEgcmVmZXJlbmNlIHRvIGEgRGlzY2xhaW1lclNjcmVlbg0KICAgICAgICAgKiAJfQ0KICAgICAgICAgKi8NCiAgICAJZGlzY2xhaW1lckRpYWxvZzogZnVuY3Rpb24gZGlzY2xhaW1lckRpYWxvZyhvcHRpb25zLCBvblN1Y2Nlc3NDYWxsYmFjaywgb25DYW5jZWxDYWxsYmFjaykgew0KCQkJLy8gYWRkIGFuIGVtcHR5IGlucHV0IGVsZW1lbnQgdG8gdHJpY2sgSUUgdG8gZ2l2aW5nIHRoaXMgcG9wdXAgZm9jdXMgKGFuZCBub3QgdGhlIERPQyBObyBmaWVsZCBhdCB0aGUgdG9wIG9mIHRoZSBtb3N0IHNjcmVlbnMpDQoJCQl2YXIgYm9keSA9ICI8aW5wdXQgYXV0b2ZvY3VzPVwiYXV0b2ZvY3VzXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCIgLz4iICsgb3B0aW9ucy5ib2R5Ow0KCQkJdmFyIGRpYWxvZyA9IG9wZW5EaWFsb2cob3B0aW9ucy50aXRsZSwgYm9keSwgZnVuY3Rpb24oKSB7DQoJCQkJCS8vIFRlbGwgdGhlIERpc2NsYWltZXJDb250cm9sbGVyIG9mIHRoZSBkZWNpc2lvbiB0byBzdG9yZSBpbiB0aGUgdXNlcidzIHNlc3Npb24uDQoJCQkJCSQucG9zdCgNCgkJCQkJCSIvb21uaS9hZHZjb3IvbmVlZHMvZGlzY2xhaW1lci5qc29uIiwgDQoJCQkJCQl7ICJkb2NOYiI6IG9wdGlvbnMuZG9jTmIsICJvZm5udHlDZCI6IG9wdGlvbnMub2ZubnR5Q2QsICJzY3JlZW4iOiBvcHRpb25zLnNjcmVlbiB9LA0KCQkJCQkJZnVuY3Rpb24oIGpzb24sIHRleHRTdGF0dXMsIGpxWEhSICkgew0KCQkJCQkJCWlmIChqc29uLmVycm9yKSB7DQoJCQkJCQkJCXdpbmRvdy5hbGVydCgiVGhlcmUgd2FzIGFuIGVycm9yIHNhdmluZyB0aGUgZGlzY2xhaW1lcjogIiArIGpzb24uZXJyb3IpOw0KCQkJCQkJCQljb25zb2xlLmVycm9yKCJUaGVyZSB3YXMgYW4gZXJyb3Igc2F2aW5nIHRoZSBkaXNjbGFpbWVyOiAiICsganNvbi5lcnJvcik7DQoJCQkJCQkJfQ0KCQkJCQkJCWVsc2Ugew0KCQkJCQkJCQlpZiAob25TdWNjZXNzQ2FsbGJhY2spIG9uU3VjY2Vzc0NhbGxiYWNrLmNhbGwoKTsNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCSk7DQoJCQkJfSwgb25DYW5jZWxDYWxsYmFjaw0KCQkJKTsNCgkJfQ0KICAgIH0pOyANCg0KICAgIA0KCS8qKg0KCSAqIE92ZXJyaWRlIHRoZSBnZXQoKSBtZXRob2Qgb24gdGV4dGFyZWFzIHNvIHRoZXkgcmV0dXJuIFxyXG4gZm9yIGNhcnJpYWdlIHJldHVybnMsIG5vdCBqdXN0IFxuLg0KCSAqIC52YWwoKSBjYWxscyB0aGlzIG1ldGhvZC4NCgkgKi8NCgkkLnZhbEhvb2tzLnRleHRhcmVhID0gew0KCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgew0KCQkJcmV0dXJuIGVsZW0udmFsdWUucmVwbGFjZSggL1xyP1xuL2csICJcclxuIiApOw0KCQl9DQoJfTsNCg0KCS8qKg0KCSAqIEFnZ3JlZ2F0ZSBmdW5jdGlvbiB1c2Ugc3VtIGFsbCBkaWdpdHMgZm91bmQgaW4gaW5wdXQgZmllbGRzDQoJICogdXNhZ2U6ICQoImlucHV0Iikuc3VtKCkNCgkgKi8NCgkkLmZuLnN1bSA9IGZ1bmN0aW9uKCkgew0KCQl2YXIgc3VtID0gMDsNCgkJdGhpcy5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJaWYgKCQodGhpcykuaXMoJzppbnB1dCcpKSB7DQoJCQkJdmFyIHZhbCA9ICQodGhpcykudmFsKCk7DQoJCQl9DQoJCQllbHNlIHsNCgkJCQl2YXIgdmFsID0gJCh0aGlzKS50ZXh0KCk7DQoJCQl9DQoJCQl2YWwgPSAnMCcgKyB2YWw7DQoJCQlpZiAodmFsLmluZGV4T2YoJy0nKSA+IC0xKSB2YWwgPSAnLScgKyB2YWwucmVwbGFjZSgvXC0vZywgJycpOw0KCQkJc3VtICs9IHBhcnNlRmxvYXQoIHZhbC5yZXBsYWNlKC9bXjAtOVwtXC5dL2csICcnKSwgMTAgKTsNCgkJfSk7DQoJCXJldHVybiBzdW07DQoJfQ0KCQ0KCS8qKiANCgkgKiBGdW5jdGlvbiB1c2VkIHRvIGFkZCBjaGFuZ2UgbGlzdGVuZXJzIG9uIGV2ZXJ5IGZvcm0gZWxlbWVudCBiZWxvdyB0aGlzIERPTSBlbGVtZW50LiAgDQoJICogQW4gaXNEaXJ0eSBoaWRkZW4gaW5wdXQgZmllbGQgaXMgdXBkYXRlZCB3aGVuIGlucHV0IGVsZW1lbnRzIGFyZSBjaGFuZ2VkLg0KCSAqICAgdXNhZ2U6ICQoIiNteUZvcm0iKS5lbmFibGVJc0RpcnR5TGlzdGVuZXJzKCk7DQoJICovICAgDQoJJC5mbi5lbmFibGVJc0RpcnR5TGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7DQoJCS8vIElkZW50aWZ5IHRoZSBpc0RpcnR5IGhpZGRlbiBmb3JtIGVsZW1lbnQgd2l0aGluIHRoaXMgZm9ybSANCgkJdmFyIGlzRGlydHkgPSB0aGlzLmZpbmQoImlucHV0W25hbWU9J2lzRGlydHknXSIpOw0KCQkNCgkJLy8gQWRkIGFuIG9uQ2hhbmdlIGxpc3RlbmVyIGZvciBldmVyeSBpbnB1dCBmaWVsZCBpbiB0aGlzIGZvcm0gdGhhdCBzZXRzIHRoZSBpc0RpcnR5IHZhbHVlIHRvIHRydWUNCgkJZ2V0SW5wdXRFbGVtZW50cyh0aGlzKS5jaGFuZ2UoZnVuY3Rpb24oKSB7DQoJCQlpc0RpcnR5LnZhbCgidHJ1ZSIpLnRyaWdnZXIoJ2NoYW5nZScpOw0KCQl9KTsNCgkJDQoJCS8vIEZvciBjaGFpbmluZyBqUXVlcnkgY29tbWFuZHMuDQoJCXJldHVybiB0aGlzOw0KCX07DQoJDQoJLyoqDQoJICogQWRkcyBhIFBORyBzcGlubmVyIChhbmltYXRlZCB3YWl0IGljb24pIHRvIGEgRE9NIGVsZW1lbnQgd2l0aCBhIHRyYW5zcGFyZW50IHBuZyBiYWNrZ3JvdW5kIGljb24uDQoJICovDQoJJC5mbi5hZGRTcGlubmVyUE5HID0gZnVuY3Rpb24oIG9wdGlvbnMgKSB7DQoJCS8vIGRlZmF1bHQgb3B0aW9ucw0KCQl2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7DQoJCQlzcGVlZDogMTAwLA0KCQkJZnJhbWVzOiAxMiwNCgkJCWZyYW1lV2lkdGg6IDE1DQoJCX0sIG9wdGlvbnMpOw0KCQkNCgkJcmV0dXJuIHRoaXMucmVtb3ZlU3Bpbm5lclBORygpLmFkZENsYXNzKCJzcGlubmVyLXBuZ2ljb24iKS5lYWNoKGZ1bmN0aW9uKCkgewkJCQkJDQoJCQkNCgkJCXZhciBlID0gJCh0aGlzKTsNCgkJCXZhciBpbmRleCA9IDA7DQoJCQkNCgkJCXZhciBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7DQoJCQkJaWYgKGluZGV4ID09IHNldHRpbmdzLmZyYW1lcykgeyBpbmRleCA9IDA7IH0NCgkJCQllLmNzcygnYmFja2dyb3VuZFBvc2l0aW9uJywgLShpbmRleCsrICogc2V0dGluZ3MuZnJhbWVXaWR0aCkgKyAncHggMHB4Jyk7DQoJCQl9LCBzZXR0aW5ncy5zcGVlZCk7DQoJCQkkLmRhdGEodGhpcywgJ2FpbWcuaW50ZXJ2YWxJZCcsIGludGVydmFsSWQpOw0KCQkJCQ0KCQl9KTsNCgl9Ow0KCQ0KCS8qKg0KCSAqIFJlbW92ZXMgYSBQTkcgc3Bpbm5lciAoYW5pbWF0ZWQgd2FpdCBpY29uKSBmcm9tIGEgRE9NIGVsZW1lbnQuDQoJICovDQoJJC5mbi5yZW1vdmVTcGlubmVyUE5HID0gZnVuY3Rpb24oKSB7DQoJCXJldHVybiB0aGlzLnJlbW92ZUNsYXNzKCJzcGlubmVyLXBuZ2ljb24iKS5lYWNoKGZ1bmN0aW9uKCkgew0KCQkJY2xlYXJJbnRlcnZhbCgkLmRhdGEodGhpcywgJ2FpbWcuaW50ZXJ2YWxJZCcpKTsNCgkJfSk7DQoJfTsNCgkNCgkvKioNCgkgKiBBZGRzIGEgLnNwaW5uZXItaWNvbiBjbGFzcyAoYW4gYW5pbWF0ZWQgZ2lmIGltYWdlKSB0byB0aGUgc3BlY2lmaWVkIGVsZW1lbnQgYWZ0ZXIgYSBkZWxheS4gIA0KCSAqIElmIHJlbW92ZVNwaW5uZXIoKSBpcyBjYWxsZWQgYmVmb3JlIHRoZSBkZWxheSBlbGFwc2VzLCB0aGlzIG1ldGhvZCBpcyBlZmZlY3RpdmVseSBjYW5jZWxsZWQuDQoJICogdXNhZ2U6ICQoIiNteXNwYW4iKS5hZGRTcGlubmVyKCk7DQoJICogICAgICAgICQoIiNteXNwYW4iKS5hZGRTcGlubmVyKCB7IGRlbGF5OiAzMDAwIH0gKTsNCgkgKiANCgkgKiBAcGFyYW0gb3B0aW9ucy5kZWxheSB0aW1lIGluIG1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSBhcHBseWluZyB0aGUgY2xhc3MuICBEZWZhdWx0cyB0byAxIHNlY29uZC4NCgkgKiANCgkgKiBAc2VlIHJlbW92ZVNwaW5uZXIoKQ0KCSAqLw0KCSQuZm4uYWRkU3Bpbm5lciA9IGZ1bmN0aW9uKCBvcHRpb25zICkgew0KCQkvLyBkZWZhdWx0IG9wdGlvbnMNCgkJdmFyIHNldHRpbmdzID0gJC5leHRlbmQoew0KCQkJZGVsYXk6IDEwMDAJLy8gYSBzaG9ydCBkZWxheSBpbiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgYWRkaW5nIHRoZSBzdHlsZQ0KCQl9LCBvcHRpb25zKTsNCgkJDQoJCXZhciBfdGhpcyA9ICQodGhpcyk7DQoJCXZhciB0aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpeyBfdGhpcy5hZGRDbGFzcygic3Bpbm5lci1pY29uIik7IH0sIHNldHRpbmdzLmRlbGF5KTsNCgkJX3RoaXMuZGF0YSgiYWltZy50aW1lb3V0SWQiLCB0aW1lb3V0KTsNCgl9DQoJDQoJLyoqDQoJICogUmVtb3ZlcyBhIHNwaW5uZXIgKGFuaW1hdGVkIHdhaXQgaWNvbikgZnJvbSBhIERPTSBlbGVtZW50Lg0KCSAqIHVzYWdlOiAkKCIjbXlzcGFuIikucmVtb3ZlU3Bpbm5lcigpOw0KCSAqLw0KCSQuZm4ucmVtb3ZlU3Bpbm5lciA9IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gdGhpcy5yZW1vdmVDbGFzcygic3Bpbm5lci1pY29uIikuZWFjaChmdW5jdGlvbigpIHsNCgkJCWNsZWFyVGltZW91dCgkLmRhdGEodGhpcywgJ2FpbWcudGltZW91dElkJykpOw0KCQl9KTsNCgl9Ow0KCQ0KCS8qKg0KCSAqIEVuYWJsZXMgYSBzdGFuZGFyZCByYWRpbyBidXR0b24gdG8gYmUgImRlc2VsZWN0ZWQiLCBsaWtlIGEgY2hlY2tib3guDQoJICogdXNhZ2U6ICQoImlucHV0W3R5cGU9J3JhZGlvJ10iKS51bmNoZWNrYWJsZVJhZGlvKCk7DQoJICovDQogICAgJC5mbi51bmNoZWNrYWJsZVJhZGlvID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciByYWRpbyA9IHRoaXM7DQogICAgICAgICAgICBpZiAoISAkKHJhZGlvKS5wcm9wKCdkaXNhYmxlZCcpKSB7ICAgICAgICAgICAgCQ0KCSAgICAgICAgICAgIHZhciBsYWJlbCA9ICQoJ2xhYmVsW2Zvcj0iJyArIHJhZGlvLmlkICsgJyJdJyk7DQoJICAgICAgICAgICAgaWYgKGxhYmVsLmxlbmd0aCA9PT0gMCkgew0KCSAgICAgICAgICAgICAgICBsYWJlbCA9ICQocmFkaW8pLmNsb3Nlc3QoImxhYmVsIik7DQoJICAgICAgICAgICAgfQ0KCSAgICAgICAgICAgIHZhciBsYWJlbF9yYWRpbyA9IGxhYmVsLmFkZChyYWRpbyk7DQoJICAgICAgICAgICAgbGFiZWxfcmFkaW8ubW91c2Vkb3duKGZ1bmN0aW9uICgpIHsNCgkgICAgICAgICAgICAgICAgJChyYWRpbykuZGF0YSgnd2FzQ2hlY2tlZCcsIHJhZGlvLmNoZWNrZWQpOw0KCSAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgCSQocmFkaW8pLmNsaWNrKGZ1bmN0aW9uICgpIHsNCgkgICAgICAgICAgICAgICAgaWYgKCQocmFkaW8pLmRhdGEoJ3dhc0NoZWNrZWQnKSkgew0KCSAgICAgICAgICAgICAgICAgICAgcmFkaW8uY2hlY2tlZCA9IGZhbHNlOw0KCSAgICAgICAgICAgICAgICAgICAgJChyYWRpbykudHJpZ2dlcignY2hhbmdlJyk7DQoJICAgICAgICAgICAgICAgIH0NCgkgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsNCgkNCn0oIGpRdWVyeSApKTsNCg0K",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 309,
          "bodySize": 14572
        },
        "cache": {},
        "timings": {
          "send": 14,
          "wait": 0,
          "receive": 9
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8631"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.616-07:00",
        "time": 177,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/jquery/jquery-ui.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 340,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Transfer-Encoding",
              "value": "chunked"
            },
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            }
          ],
          "content": {
            "size": 619204,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "LyohIGpRdWVyeSBVSSAtIHYxLjExLjEgLSAyMDE0LTA4LTEzCiogaHR0cDovL2pxdWVyeXVpLmNvbQoqIEluY2x1ZGVzOiBjb3JlLmpzLCB3aWRnZXQuanMsIG1vdXNlLmpzLCBwb3NpdGlvbi5qcywgYWNjb3JkaW9uLmpzLCBhdXRvY29tcGxldGUuanMsIGJ1dHRvbi5qcywgZGF0ZXBpY2tlci5qcywgZGlhbG9nLmpzLCBkcmFnZ2FibGUuanMsIGRyb3BwYWJsZS5qcywgZWZmZWN0LmpzLCBlZmZlY3QtYmxpbmQuanMsIGVmZmVjdC1ib3VuY2UuanMsIGVmZmVjdC1jbGlwLmpzLCBlZmZlY3QtZHJvcC5qcywgZWZmZWN0LWV4cGxvZGUuanMsIGVmZmVjdC1mYWRlLmpzLCBlZmZlY3QtZm9sZC5qcywgZWZmZWN0LWhpZ2hsaWdodC5qcywgZWZmZWN0LXB1ZmYuanMsIGVmZmVjdC1wdWxzYXRlLmpzLCBlZmZlY3Qtc2NhbGUuanMsIGVmZmVjdC1zaGFrZS5qcywgZWZmZWN0LXNpemUuanMsIGVmZmVjdC1zbGlkZS5qcywgZWZmZWN0LXRyYW5zZmVyLmpzLCBtZW51LmpzLCBwcm9ncmVzc2Jhci5qcywgcmVzaXphYmxlLmpzLCBzZWxlY3RhYmxlLmpzLCBzZWxlY3RtZW51LmpzLCBzbGlkZXIuanMsIHNvcnRhYmxlLmpzLCBzcGlubmVyLmpzLCB0YWJzLmpzLCB0b29sdGlwLmpzCiogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9yczsgTGljZW5zZWQgTUlUICovCgooZnVuY3Rpb24oIGZhY3RvcnkgKSB7CglpZiAoIHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCApIHsKCgkJLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlLgoJCWRlZmluZShbICJqcXVlcnkiIF0sIGZhY3RvcnkgKTsKCX0gZWxzZSB7CgoJCS8vIEJyb3dzZXIgZ2xvYmFscwoJCWZhY3RvcnkoIGpRdWVyeSApOwoJfQp9KGZ1bmN0aW9uKCAkICkgewovKiEKICogalF1ZXJ5IFVJIENvcmUgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vY2F0ZWdvcnkvdWktY29yZS8KICovCgoKLy8gJC51aSBtaWdodCBleGlzdCBmcm9tIGNvbXBvbmVudHMgd2l0aCBubyBkZXBlbmRlbmNpZXMsIGUuZy4sICQudWkucG9zaXRpb24KJC51aSA9ICQudWkgfHwge307CgokLmV4dGVuZCggJC51aSwgewoJdmVyc2lvbjogIjEuMTEuMSIsCgoJa2V5Q29kZTogewoJCUJBQ0tTUEFDRTogOCwKCQlDT01NQTogMTg4LAoJCURFTEVURTogNDYsCgkJRE9XTjogNDAsCgkJRU5EOiAzNSwKCQlFTlRFUjogMTMsCgkJRVNDQVBFOiAyNywKCQlIT01FOiAzNiwKCQlMRUZUOiAzNywKCQlQQUdFX0RPV046IDM0LAoJCVBBR0VfVVA6IDMzLAoJCVBFUklPRDogMTkwLAoJCVJJR0hUOiAzOSwKCQlTUEFDRTogMzIsCgkJVEFCOiA5LAoJCVVQOiAzOAoJfQp9KTsKCi8vIHBsdWdpbnMKJC5mbi5leHRlbmQoewoJc2Nyb2xsUGFyZW50OiBmdW5jdGlvbiggaW5jbHVkZUhpZGRlbiApIHsKCQl2YXIgcG9zaXRpb24gPSB0aGlzLmNzcyggInBvc2l0aW9uIiApLAoJCQlleGNsdWRlU3RhdGljUGFyZW50ID0gcG9zaXRpb24gPT09ICJhYnNvbHV0ZSIsCgkJCW92ZXJmbG93UmVnZXggPSBpbmNsdWRlSGlkZGVuID8gLyhhdXRvfHNjcm9sbHxoaWRkZW4pLyA6IC8oYXV0b3xzY3JvbGwpLywKCQkJc2Nyb2xsUGFyZW50ID0gdGhpcy5wYXJlbnRzKCkuZmlsdGVyKCBmdW5jdGlvbigpIHsKCQkJCXZhciBwYXJlbnQgPSAkKCB0aGlzICk7CgkJCQlpZiAoIGV4Y2x1ZGVTdGF0aWNQYXJlbnQgJiYgcGFyZW50LmNzcyggInBvc2l0aW9uIiApID09PSAic3RhdGljIiApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCQlyZXR1cm4gb3ZlcmZsb3dSZWdleC50ZXN0KCBwYXJlbnQuY3NzKCAib3ZlcmZsb3ciICkgKyBwYXJlbnQuY3NzKCAib3ZlcmZsb3cteSIgKSArIHBhcmVudC5jc3MoICJvdmVyZmxvdy14IiApICk7CgkJCX0pLmVxKCAwICk7CgoJCXJldHVybiBwb3NpdGlvbiA9PT0gImZpeGVkIiB8fCAhc2Nyb2xsUGFyZW50Lmxlbmd0aCA/ICQoIHRoaXNbIDAgXS5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50ICkgOiBzY3JvbGxQYXJlbnQ7Cgl9LAoKCXVuaXF1ZUlkOiAoZnVuY3Rpb24oKSB7CgkJdmFyIHV1aWQgPSAwOwoKCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlpZiAoICF0aGlzLmlkICkgewoJCQkJCXRoaXMuaWQgPSAidWktaWQtIiArICggKyt1dWlkICk7CgkJCQl9CgkJCX0pOwoJCX07Cgl9KSgpLAoKCXJlbW92ZVVuaXF1ZUlkOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoIC9edWktaWQtXGQrJC8udGVzdCggdGhpcy5pZCApICkgewoJCQkJJCggdGhpcyApLnJlbW92ZUF0dHIoICJpZCIgKTsKCQkJfQoJCX0pOwoJfQp9KTsKCi8vIHNlbGVjdG9ycwpmdW5jdGlvbiBmb2N1c2FibGUoIGVsZW1lbnQsIGlzVGFiSW5kZXhOb3ROYU4gKSB7Cgl2YXIgbWFwLCBtYXBOYW1lLCBpbWcsCgkJbm9kZU5hbWUgPSBlbGVtZW50Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CglpZiAoICJhcmVhIiA9PT0gbm9kZU5hbWUgKSB7CgkJbWFwID0gZWxlbWVudC5wYXJlbnROb2RlOwoJCW1hcE5hbWUgPSBtYXAubmFtZTsKCQlpZiAoICFlbGVtZW50LmhyZWYgfHwgIW1hcE5hbWUgfHwgbWFwLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJtYXAiICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCWltZyA9ICQoICJpbWdbdXNlbWFwPScjIiArIG1hcE5hbWUgKyAiJ10iIClbIDAgXTsKCQlyZXR1cm4gISFpbWcgJiYgdmlzaWJsZSggaW1nICk7Cgl9CglyZXR1cm4gKCAvaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QvLnRlc3QoIG5vZGVOYW1lICkgPwoJCSFlbGVtZW50LmRpc2FibGVkIDoKCQkiYSIgPT09IG5vZGVOYW1lID8KCQkJZWxlbWVudC5ocmVmIHx8IGlzVGFiSW5kZXhOb3ROYU4gOgoJCQlpc1RhYkluZGV4Tm90TmFOKSAmJgoJCS8vIHRoZSBlbGVtZW50IGFuZCBhbGwgb2YgaXRzIGFuY2VzdG9ycyBtdXN0IGJlIHZpc2libGUKCQl2aXNpYmxlKCBlbGVtZW50ICk7Cn0KCmZ1bmN0aW9uIHZpc2libGUoIGVsZW1lbnQgKSB7CglyZXR1cm4gJC5leHByLmZpbHRlcnMudmlzaWJsZSggZWxlbWVudCApICYmCgkJISQoIGVsZW1lbnQgKS5wYXJlbnRzKCkuYWRkQmFjaygpLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJcmV0dXJuICQuY3NzKCB0aGlzLCAidmlzaWJpbGl0eSIgKSA9PT0gImhpZGRlbiI7CgkJfSkubGVuZ3RoOwp9CgokLmV4dGVuZCggJC5leHByWyAiOiIgXSwgewoJZGF0YTogJC5leHByLmNyZWF0ZVBzZXVkbyA/CgkJJC5leHByLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbiggZGF0YU5hbWUgKSB7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiAhISQuZGF0YSggZWxlbSwgZGF0YU5hbWUgKTsKCQkJfTsKCQl9KSA6CgkJLy8gc3VwcG9ydDogalF1ZXJ5IDwxLjgKCQlmdW5jdGlvbiggZWxlbSwgaSwgbWF0Y2ggKSB7CgkJCXJldHVybiAhISQuZGF0YSggZWxlbSwgbWF0Y2hbIDMgXSApOwoJCX0sCgoJZm9jdXNhYmxlOiBmdW5jdGlvbiggZWxlbWVudCApIHsKCQlyZXR1cm4gZm9jdXNhYmxlKCBlbGVtZW50LCAhaXNOYU4oICQuYXR0ciggZWxlbWVudCwgInRhYmluZGV4IiApICkgKTsKCX0sCgoJdGFiYmFibGU6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCXZhciB0YWJJbmRleCA9ICQuYXR0ciggZWxlbWVudCwgInRhYmluZGV4IiApLAoJCQlpc1RhYkluZGV4TmFOID0gaXNOYU4oIHRhYkluZGV4ICk7CgkJcmV0dXJuICggaXNUYWJJbmRleE5hTiB8fCB0YWJJbmRleCA+PSAwICkgJiYgZm9jdXNhYmxlKCBlbGVtZW50LCAhaXNUYWJJbmRleE5hTiApOwoJfQp9KTsKCi8vIHN1cHBvcnQ6IGpRdWVyeSA8MS44CmlmICggISQoICI8YT4iICkub3V0ZXJXaWR0aCggMSApLmpxdWVyeSApIHsKCSQuZWFjaCggWyAiV2lkdGgiLCAiSGVpZ2h0IiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCQl2YXIgc2lkZSA9IG5hbWUgPT09ICJXaWR0aCIgPyBbICJMZWZ0IiwgIlJpZ2h0IiBdIDogWyAiVG9wIiwgIkJvdHRvbSIgXSwKCQkJdHlwZSA9IG5hbWUudG9Mb3dlckNhc2UoKSwKCQkJb3JpZyA9IHsKCQkJCWlubmVyV2lkdGg6ICQuZm4uaW5uZXJXaWR0aCwKCQkJCWlubmVySGVpZ2h0OiAkLmZuLmlubmVySGVpZ2h0LAoJCQkJb3V0ZXJXaWR0aDogJC5mbi5vdXRlcldpZHRoLAoJCQkJb3V0ZXJIZWlnaHQ6ICQuZm4ub3V0ZXJIZWlnaHQKCQkJfTsKCgkJZnVuY3Rpb24gcmVkdWNlKCBlbGVtLCBzaXplLCBib3JkZXIsIG1hcmdpbiApIHsKCQkJJC5lYWNoKCBzaWRlLCBmdW5jdGlvbigpIHsKCQkJCXNpemUgLT0gcGFyc2VGbG9hdCggJC5jc3MoIGVsZW0sICJwYWRkaW5nIiArIHRoaXMgKSApIHx8IDA7CgkJCQlpZiAoIGJvcmRlciApIHsKCQkJCQlzaXplIC09IHBhcnNlRmxvYXQoICQuY3NzKCBlbGVtLCAiYm9yZGVyIiArIHRoaXMgKyAiV2lkdGgiICkgKSB8fCAwOwoJCQkJfQoJCQkJaWYgKCBtYXJnaW4gKSB7CgkJCQkJc2l6ZSAtPSBwYXJzZUZsb2F0KCAkLmNzcyggZWxlbSwgIm1hcmdpbiIgKyB0aGlzICkgKSB8fCAwOwoJCQkJfQoJCQl9KTsKCQkJcmV0dXJuIHNpemU7CgkJfQoKCQkkLmZuWyAiaW5uZXIiICsgbmFtZSBdID0gZnVuY3Rpb24oIHNpemUgKSB7CgkJCWlmICggc2l6ZSA9PT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIG9yaWdbICJpbm5lciIgKyBuYW1lIF0uY2FsbCggdGhpcyApOwoJCQl9CgoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJJCggdGhpcyApLmNzcyggdHlwZSwgcmVkdWNlKCB0aGlzLCBzaXplICkgKyAicHgiICk7CgkJCX0pOwoJCX07CgoJCSQuZm5bICJvdXRlciIgKyBuYW1lXSA9IGZ1bmN0aW9uKCBzaXplLCBtYXJnaW4gKSB7CgkJCWlmICggdHlwZW9mIHNpemUgIT09ICJudW1iZXIiICkgewoJCQkJcmV0dXJuIG9yaWdbICJvdXRlciIgKyBuYW1lIF0uY2FsbCggdGhpcywgc2l6ZSApOwoJCQl9CgoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJJCggdGhpcykuY3NzKCB0eXBlLCByZWR1Y2UoIHRoaXMsIHNpemUsIHRydWUsIG1hcmdpbiApICsgInB4IiApOwoJCQl9KTsKCQl9OwoJfSk7Cn0KCi8vIHN1cHBvcnQ6IGpRdWVyeSA8MS44CmlmICggISQuZm4uYWRkQmFjayApIHsKCSQuZm4uYWRkQmFjayA9IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5hZGQoIHNlbGVjdG9yID09IG51bGwgPwoJCQl0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKCBzZWxlY3RvciApCgkJKTsKCX07Cn0KCi8vIHN1cHBvcnQ6IGpRdWVyeSAxLjYuMSwgMS42LjIgKGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0Lzk0MTMpCmlmICggJCggIjxhPiIgKS5kYXRhKCAiYS1iIiwgImEiICkucmVtb3ZlRGF0YSggImEtYiIgKS5kYXRhKCAiYS1iIiApICkgewoJJC5mbi5yZW1vdmVEYXRhID0gKGZ1bmN0aW9uKCByZW1vdmVEYXRhICkgewoJCXJldHVybiBmdW5jdGlvbigga2V5ICkgewoJCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCQlyZXR1cm4gcmVtb3ZlRGF0YS5jYWxsKCB0aGlzLCAkLmNhbWVsQ2FzZSgga2V5ICkgKTsKCQkJfSBlbHNlIHsKCQkJCXJldHVybiByZW1vdmVEYXRhLmNhbGwoIHRoaXMgKTsKCQkJfQoJCX07Cgl9KSggJC5mbi5yZW1vdmVEYXRhICk7Cn0KCi8vIGRlcHJlY2F0ZWQKJC51aS5pZSA9ICEhL21zaWUgW1x3Ll0rLy5leGVjKCBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkgKTsKCiQuZm4uZXh0ZW5kKHsKCWZvY3VzOiAoZnVuY3Rpb24oIG9yaWcgKSB7CgkJcmV0dXJuIGZ1bmN0aW9uKCBkZWxheSwgZm4gKSB7CgkJCXJldHVybiB0eXBlb2YgZGVsYXkgPT09ICJudW1iZXIiID8KCQkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCQl2YXIgZWxlbSA9IHRoaXM7CgkJCQkJc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQkJCQkJJCggZWxlbSApLmZvY3VzKCk7CgkJCQkJCWlmICggZm4gKSB7CgkJCQkJCQlmbi5jYWxsKCBlbGVtICk7CgkJCQkJCX0KCQkJCQl9LCBkZWxheSApOwoJCQkJfSkgOgoJCQkJb3JpZy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJfTsKCX0pKCAkLmZuLmZvY3VzICksCgoJZGlzYWJsZVNlbGVjdGlvbjogKGZ1bmN0aW9uKCkgewoJCXZhciBldmVudFR5cGUgPSAib25zZWxlY3RzdGFydCIgaW4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKSA/CgkJCSJzZWxlY3RzdGFydCIgOgoJCQkibW91c2Vkb3duIjsKCgkJcmV0dXJuIGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gdGhpcy5iaW5kKCBldmVudFR5cGUgKyAiLnVpLWRpc2FibGVTZWxlY3Rpb24iLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9KTsKCQl9OwoJfSkoKSwKCgllbmFibGVTZWxlY3Rpb246IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnVuYmluZCggIi51aS1kaXNhYmxlU2VsZWN0aW9uIiApOwoJfSwKCgl6SW5kZXg6IGZ1bmN0aW9uKCB6SW5kZXggKSB7CgkJaWYgKCB6SW5kZXggIT09IHVuZGVmaW5lZCApIHsKCQkJcmV0dXJuIHRoaXMuY3NzKCAiekluZGV4IiwgekluZGV4ICk7CgkJfQoKCQlpZiAoIHRoaXMubGVuZ3RoICkgewoJCQl2YXIgZWxlbSA9ICQoIHRoaXNbIDAgXSApLCBwb3NpdGlvbiwgdmFsdWU7CgkJCXdoaWxlICggZWxlbS5sZW5ndGggJiYgZWxlbVsgMCBdICE9PSBkb2N1bWVudCApIHsKCQkJCS8vIElnbm9yZSB6LWluZGV4IGlmIHBvc2l0aW9uIGlzIHNldCB0byBhIHZhbHVlIHdoZXJlIHotaW5kZXggaXMgaWdub3JlZCBieSB0aGUgYnJvd3NlcgoJCQkJLy8gVGhpcyBtYWtlcyBiZWhhdmlvciBvZiB0aGlzIGZ1bmN0aW9uIGNvbnNpc3RlbnQgYWNyb3NzIGJyb3dzZXJzCgkJCQkvLyBXZWJLaXQgYWx3YXlzIHJldHVybnMgYXV0byBpZiB0aGUgZWxlbWVudCBpcyBwb3NpdGlvbmVkCgkJCQlwb3NpdGlvbiA9IGVsZW0uY3NzKCAicG9zaXRpb24iICk7CgkJCQlpZiAoIHBvc2l0aW9uID09PSAiYWJzb2x1dGUiIHx8IHBvc2l0aW9uID09PSAicmVsYXRpdmUiIHx8IHBvc2l0aW9uID09PSAiZml4ZWQiICkgewoJCQkJCS8vIElFIHJldHVybnMgMCB3aGVuIHpJbmRleCBpcyBub3Qgc3BlY2lmaWVkCgkJCQkJLy8gb3RoZXIgYnJvd3NlcnMgcmV0dXJuIGEgc3RyaW5nCgkJCQkJLy8gd2UgaWdub3JlIHRoZSBjYXNlIG9mIG5lc3RlZCBlbGVtZW50cyB3aXRoIGFuIGV4cGxpY2l0IHZhbHVlIG9mIDAKCQkJCQkvLyA8ZGl2IHN0eWxlPSJ6LWluZGV4OiAtMTA7Ij48ZGl2IHN0eWxlPSJ6LWluZGV4OiAwOyI+PC9kaXY+PC9kaXY+CgkJCQkJdmFsdWUgPSBwYXJzZUludCggZWxlbS5jc3MoICJ6SW5kZXgiICksIDEwICk7CgkJCQkJaWYgKCAhaXNOYU4oIHZhbHVlICkgJiYgdmFsdWUgIT09IDAgKSB7CgkJCQkJCXJldHVybiB2YWx1ZTsKCQkJCQl9CgkJCQl9CgkJCQllbGVtID0gZWxlbS5wYXJlbnQoKTsKCQkJfQoJCX0KCgkJcmV0dXJuIDA7Cgl9Cn0pOwoKLy8gJC51aS5wbHVnaW4gaXMgZGVwcmVjYXRlZC4gVXNlICQud2lkZ2V0KCkgZXh0ZW5zaW9ucyBpbnN0ZWFkLgokLnVpLnBsdWdpbiA9IHsKCWFkZDogZnVuY3Rpb24oIG1vZHVsZSwgb3B0aW9uLCBzZXQgKSB7CgkJdmFyIGksCgkJCXByb3RvID0gJC51aVsgbW9kdWxlIF0ucHJvdG90eXBlOwoJCWZvciAoIGkgaW4gc2V0ICkgewoJCQlwcm90by5wbHVnaW5zWyBpIF0gPSBwcm90by5wbHVnaW5zWyBpIF0gfHwgW107CgkJCXByb3RvLnBsdWdpbnNbIGkgXS5wdXNoKCBbIG9wdGlvbiwgc2V0WyBpIF0gXSApOwoJCX0KCX0sCgljYWxsOiBmdW5jdGlvbiggaW5zdGFuY2UsIG5hbWUsIGFyZ3MsIGFsbG93RGlzY29ubmVjdGVkICkgewoJCXZhciBpLAoJCQlzZXQgPSBpbnN0YW5jZS5wbHVnaW5zWyBuYW1lIF07CgoJCWlmICggIXNldCApIHsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCAhYWxsb3dEaXNjb25uZWN0ZWQgJiYgKCAhaW5zdGFuY2UuZWxlbWVudFsgMCBdLnBhcmVudE5vZGUgfHwgaW5zdGFuY2UuZWxlbWVudFsgMCBdLnBhcmVudE5vZGUubm9kZVR5cGUgPT09IDExICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCWZvciAoIGkgPSAwOyBpIDwgc2V0Lmxlbmd0aDsgaSsrICkgewoJCQlpZiAoIGluc3RhbmNlLm9wdGlvbnNbIHNldFsgaSBdWyAwIF0gXSApIHsKCQkJCXNldFsgaSBdWyAxIF0uYXBwbHkoIGluc3RhbmNlLmVsZW1lbnQsIGFyZ3MgKTsKCQkJfQoJCX0KCX0KfTsKCgovKiEKICogalF1ZXJ5IFVJIFdpZGdldCAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9qUXVlcnkud2lkZ2V0LwogKi8KCgp2YXIgd2lkZ2V0X3V1aWQgPSAwLAoJd2lkZ2V0X3NsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwoKJC5jbGVhbkRhdGEgPSAoZnVuY3Rpb24oIG9yaWcgKSB7CglyZXR1cm4gZnVuY3Rpb24oIGVsZW1zICkgewoJCXZhciBldmVudHMsIGVsZW0sIGk7CgkJZm9yICggaSA9IDA7IChlbGVtID0gZWxlbXNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJdHJ5IHsKCgkJCQkvLyBPbmx5IHRyaWdnZXIgcmVtb3ZlIHdoZW4gbmVjZXNzYXJ5IHRvIHNhdmUgdGltZQoJCQkJZXZlbnRzID0gJC5fZGF0YSggZWxlbSwgImV2ZW50cyIgKTsKCQkJCWlmICggZXZlbnRzICYmIGV2ZW50cy5yZW1vdmUgKSB7CgkJCQkJJCggZWxlbSApLnRyaWdnZXJIYW5kbGVyKCAicmVtb3ZlIiApOwoJCQkJfQoKCQkJLy8gaHR0cDovL2J1Z3MuanF1ZXJ5LmNvbS90aWNrZXQvODIzNQoJCQl9IGNhdGNoKCBlICkge30KCQl9CgkJb3JpZyggZWxlbXMgKTsKCX07Cn0pKCAkLmNsZWFuRGF0YSApOwoKJC53aWRnZXQgPSBmdW5jdGlvbiggbmFtZSwgYmFzZSwgcHJvdG90eXBlICkgewoJdmFyIGZ1bGxOYW1lLCBleGlzdGluZ0NvbnN0cnVjdG9yLCBjb25zdHJ1Y3RvciwgYmFzZVByb3RvdHlwZSwKCQkvLyBwcm94aWVkUHJvdG90eXBlIGFsbG93cyB0aGUgcHJvdmlkZWQgcHJvdG90eXBlIHRvIHJlbWFpbiB1bm1vZGlmaWVkCgkJLy8gc28gdGhhdCBpdCBjYW4gYmUgdXNlZCBhcyBhIG1peGluIGZvciBtdWx0aXBsZSB3aWRnZXRzICgjODg3NikKCQlwcm94aWVkUHJvdG90eXBlID0ge30sCgkJbmFtZXNwYWNlID0gbmFtZS5zcGxpdCggIi4iIClbIDAgXTsKCgluYW1lID0gbmFtZS5zcGxpdCggIi4iIClbIDEgXTsKCWZ1bGxOYW1lID0gbmFtZXNwYWNlICsgIi0iICsgbmFtZTsKCglpZiAoICFwcm90b3R5cGUgKSB7CgkJcHJvdG90eXBlID0gYmFzZTsKCQliYXNlID0gJC5XaWRnZXQ7Cgl9CgoJLy8gY3JlYXRlIHNlbGVjdG9yIGZvciBwbHVnaW4KCSQuZXhwclsgIjoiIF1bIGZ1bGxOYW1lLnRvTG93ZXJDYXNlKCkgXSA9IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiAhISQuZGF0YSggZWxlbSwgZnVsbE5hbWUgKTsKCX07CgoJJFsgbmFtZXNwYWNlIF0gPSAkWyBuYW1lc3BhY2UgXSB8fCB7fTsKCWV4aXN0aW5nQ29uc3RydWN0b3IgPSAkWyBuYW1lc3BhY2UgXVsgbmFtZSBdOwoJY29uc3RydWN0b3IgPSAkWyBuYW1lc3BhY2UgXVsgbmFtZSBdID0gZnVuY3Rpb24oIG9wdGlvbnMsIGVsZW1lbnQgKSB7CgkJLy8gYWxsb3cgaW5zdGFudGlhdGlvbiB3aXRob3V0ICJuZXciIGtleXdvcmQKCQlpZiAoICF0aGlzLl9jcmVhdGVXaWRnZXQgKSB7CgkJCXJldHVybiBuZXcgY29uc3RydWN0b3IoIG9wdGlvbnMsIGVsZW1lbnQgKTsKCQl9CgoJCS8vIGFsbG93IGluc3RhbnRpYXRpb24gd2l0aG91dCBpbml0aWFsaXppbmcgZm9yIHNpbXBsZSBpbmhlcml0YW5jZQoJCS8vIG11c3QgdXNlICJuZXciIGtleXdvcmQgKHRoZSBjb2RlIGFib3ZlIGFsd2F5cyBwYXNzZXMgYXJncykKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCXRoaXMuX2NyZWF0ZVdpZGdldCggb3B0aW9ucywgZWxlbWVudCApOwoJCX0KCX07CgkvLyBleHRlbmQgd2l0aCB0aGUgZXhpc3RpbmcgY29uc3RydWN0b3IgdG8gY2Fycnkgb3ZlciBhbnkgc3RhdGljIHByb3BlcnRpZXMKCSQuZXh0ZW5kKCBjb25zdHJ1Y3RvciwgZXhpc3RpbmdDb25zdHJ1Y3RvciwgewoJCXZlcnNpb246IHByb3RvdHlwZS52ZXJzaW9uLAoJCS8vIGNvcHkgdGhlIG9iamVjdCB1c2VkIHRvIGNyZWF0ZSB0aGUgcHJvdG90eXBlIGluIGNhc2Ugd2UgbmVlZCB0bwoJCS8vIHJlZGVmaW5lIHRoZSB3aWRnZXQgbGF0ZXIKCQlfcHJvdG86ICQuZXh0ZW5kKCB7fSwgcHJvdG90eXBlICksCgkJLy8gdHJhY2sgd2lkZ2V0cyB0aGF0IGluaGVyaXQgZnJvbSB0aGlzIHdpZGdldCBpbiBjYXNlIHRoaXMgd2lkZ2V0IGlzCgkJLy8gcmVkZWZpbmVkIGFmdGVyIGEgd2lkZ2V0IGluaGVyaXRzIGZyb20gaXQKCQlfY2hpbGRDb25zdHJ1Y3RvcnM6IFtdCgl9KTsKCgliYXNlUHJvdG90eXBlID0gbmV3IGJhc2UoKTsKCS8vIHdlIG5lZWQgdG8gbWFrZSB0aGUgb3B0aW9ucyBoYXNoIGEgcHJvcGVydHkgZGlyZWN0bHkgb24gdGhlIG5ldyBpbnN0YW5jZQoJLy8gb3RoZXJ3aXNlIHdlJ2xsIG1vZGlmeSB0aGUgb3B0aW9ucyBoYXNoIG9uIHRoZSBwcm90b3R5cGUgdGhhdCB3ZSdyZQoJLy8gaW5oZXJpdGluZyBmcm9tCgliYXNlUHJvdG90eXBlLm9wdGlvbnMgPSAkLndpZGdldC5leHRlbmQoIHt9LCBiYXNlUHJvdG90eXBlLm9wdGlvbnMgKTsKCSQuZWFjaCggcHJvdG90eXBlLCBmdW5jdGlvbiggcHJvcCwgdmFsdWUgKSB7CgkJaWYgKCAhJC5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlwcm94aWVkUHJvdG90eXBlWyBwcm9wIF0gPSB2YWx1ZTsKCQkJcmV0dXJuOwoJCX0KCQlwcm94aWVkUHJvdG90eXBlWyBwcm9wIF0gPSAoZnVuY3Rpb24oKSB7CgkJCXZhciBfc3VwZXIgPSBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gYmFzZS5wcm90b3R5cGVbIHByb3AgXS5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQl9LAoJCQkJX3N1cGVyQXBwbHkgPSBmdW5jdGlvbiggYXJncyApIHsKCQkJCQlyZXR1cm4gYmFzZS5wcm90b3R5cGVbIHByb3AgXS5hcHBseSggdGhpcywgYXJncyApOwoJCQkJfTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCkgewoJCQkJdmFyIF9fc3VwZXIgPSB0aGlzLl9zdXBlciwKCQkJCQlfX3N1cGVyQXBwbHkgPSB0aGlzLl9zdXBlckFwcGx5LAoJCQkJCXJldHVyblZhbHVlOwoKCQkJCXRoaXMuX3N1cGVyID0gX3N1cGVyOwoJCQkJdGhpcy5fc3VwZXJBcHBseSA9IF9zdXBlckFwcGx5OwoKCQkJCXJldHVyblZhbHVlID0gdmFsdWUuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoKCQkJCXRoaXMuX3N1cGVyID0gX19zdXBlcjsKCQkJCXRoaXMuX3N1cGVyQXBwbHkgPSBfX3N1cGVyQXBwbHk7CgoJCQkJcmV0dXJuIHJldHVyblZhbHVlOwoJCQl9OwoJCX0pKCk7Cgl9KTsKCWNvbnN0cnVjdG9yLnByb3RvdHlwZSA9ICQud2lkZ2V0LmV4dGVuZCggYmFzZVByb3RvdHlwZSwgewoJCS8vIFRPRE86IHJlbW92ZSBzdXBwb3J0IGZvciB3aWRnZXRFdmVudFByZWZpeAoJCS8vIGFsd2F5cyB1c2UgdGhlIG5hbWUgKyBhIGNvbG9uIGFzIHRoZSBwcmVmaXgsIGUuZy4sIGRyYWdnYWJsZTpzdGFydAoJCS8vIGRvbid0IHByZWZpeCBmb3Igd2lkZ2V0cyB0aGF0IGFyZW4ndCBET00tYmFzZWQKCQl3aWRnZXRFdmVudFByZWZpeDogZXhpc3RpbmdDb25zdHJ1Y3RvciA/IChiYXNlUHJvdG90eXBlLndpZGdldEV2ZW50UHJlZml4IHx8IG5hbWUpIDogbmFtZQoJfSwgcHJveGllZFByb3RvdHlwZSwgewoJCWNvbnN0cnVjdG9yOiBjb25zdHJ1Y3RvciwKCQluYW1lc3BhY2U6IG5hbWVzcGFjZSwKCQl3aWRnZXROYW1lOiBuYW1lLAoJCXdpZGdldEZ1bGxOYW1lOiBmdWxsTmFtZQoJfSk7CgoJLy8gSWYgdGhpcyB3aWRnZXQgaXMgYmVpbmcgcmVkZWZpbmVkIHRoZW4gd2UgbmVlZCB0byBmaW5kIGFsbCB3aWRnZXRzIHRoYXQKCS8vIGFyZSBpbmhlcml0aW5nIGZyb20gaXQgYW5kIHJlZGVmaW5lIGFsbCBvZiB0aGVtIHNvIHRoYXQgdGhleSBpbmhlcml0IGZyb20KCS8vIHRoZSBuZXcgdmVyc2lvbiBvZiB0aGlzIHdpZGdldC4gV2UncmUgZXNzZW50aWFsbHkgdHJ5aW5nIHRvIHJlcGxhY2Ugb25lCgkvLyBsZXZlbCBpbiB0aGUgcHJvdG90eXBlIGNoYWluLgoJaWYgKCBleGlzdGluZ0NvbnN0cnVjdG9yICkgewoJCSQuZWFjaCggZXhpc3RpbmdDb25zdHJ1Y3Rvci5fY2hpbGRDb25zdHJ1Y3RvcnMsIGZ1bmN0aW9uKCBpLCBjaGlsZCApIHsKCQkJdmFyIGNoaWxkUHJvdG90eXBlID0gY2hpbGQucHJvdG90eXBlOwoKCQkJLy8gcmVkZWZpbmUgdGhlIGNoaWxkIHdpZGdldCB1c2luZyB0aGUgc2FtZSBwcm90b3R5cGUgdGhhdCB3YXMKCQkJLy8gb3JpZ2luYWxseSB1c2VkLCBidXQgaW5oZXJpdCBmcm9tIHRoZSBuZXcgdmVyc2lvbiBvZiB0aGUgYmFzZQoJCQkkLndpZGdldCggY2hpbGRQcm90b3R5cGUubmFtZXNwYWNlICsgIi4iICsgY2hpbGRQcm90b3R5cGUud2lkZ2V0TmFtZSwgY29uc3RydWN0b3IsIGNoaWxkLl9wcm90byApOwoJCX0pOwoJCS8vIHJlbW92ZSB0aGUgbGlzdCBvZiBleGlzdGluZyBjaGlsZCBjb25zdHJ1Y3RvcnMgZnJvbSB0aGUgb2xkIGNvbnN0cnVjdG9yCgkJLy8gc28gdGhlIG9sZCBjaGlsZCBjb25zdHJ1Y3RvcnMgY2FuIGJlIGdhcmJhZ2UgY29sbGVjdGVkCgkJZGVsZXRlIGV4aXN0aW5nQ29uc3RydWN0b3IuX2NoaWxkQ29uc3RydWN0b3JzOwoJfSBlbHNlIHsKCQliYXNlLl9jaGlsZENvbnN0cnVjdG9ycy5wdXNoKCBjb25zdHJ1Y3RvciApOwoJfQoKCSQud2lkZ2V0LmJyaWRnZSggbmFtZSwgY29uc3RydWN0b3IgKTsKCglyZXR1cm4gY29uc3RydWN0b3I7Cn07CgokLndpZGdldC5leHRlbmQgPSBmdW5jdGlvbiggdGFyZ2V0ICkgewoJdmFyIGlucHV0ID0gd2lkZ2V0X3NsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApLAoJCWlucHV0SW5kZXggPSAwLAoJCWlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoLAoJCWtleSwKCQl2YWx1ZTsKCWZvciAoIDsgaW5wdXRJbmRleCA8IGlucHV0TGVuZ3RoOyBpbnB1dEluZGV4KysgKSB7CgkJZm9yICgga2V5IGluIGlucHV0WyBpbnB1dEluZGV4IF0gKSB7CgkJCXZhbHVlID0gaW5wdXRbIGlucHV0SW5kZXggXVsga2V5IF07CgkJCWlmICggaW5wdXRbIGlucHV0SW5kZXggXS5oYXNPd25Qcm9wZXJ0eSgga2V5ICkgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCQkJCS8vIENsb25lIG9iamVjdHMKCQkJCWlmICggJC5pc1BsYWluT2JqZWN0KCB2YWx1ZSApICkgewoJCQkJCXRhcmdldFsga2V5IF0gPSAkLmlzUGxhaW5PYmplY3QoIHRhcmdldFsga2V5IF0gKSA/CgkJCQkJCSQud2lkZ2V0LmV4dGVuZCgge30sIHRhcmdldFsga2V5IF0sIHZhbHVlICkgOgoJCQkJCQkvLyBEb24ndCBleHRlbmQgc3RyaW5ncywgYXJyYXlzLCBldGMuIHdpdGggb2JqZWN0cwoJCQkJCQkkLndpZGdldC5leHRlbmQoIHt9LCB2YWx1ZSApOwoJCQkJLy8gQ29weSBldmVyeXRoaW5nIGVsc2UgYnkgcmVmZXJlbmNlCgkJCQl9IGVsc2UgewoJCQkJCXRhcmdldFsga2V5IF0gPSB2YWx1ZTsKCQkJCX0KCQkJfQoJCX0KCX0KCXJldHVybiB0YXJnZXQ7Cn07CgokLndpZGdldC5icmlkZ2UgPSBmdW5jdGlvbiggbmFtZSwgb2JqZWN0ICkgewoJdmFyIGZ1bGxOYW1lID0gb2JqZWN0LnByb3RvdHlwZS53aWRnZXRGdWxsTmFtZSB8fCBuYW1lOwoJJC5mblsgbmFtZSBdID0gZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgkJdmFyIGlzTWV0aG9kQ2FsbCA9IHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiwKCQkJYXJncyA9IHdpZGdldF9zbGljZS5jYWxsKCBhcmd1bWVudHMsIDEgKSwKCQkJcmV0dXJuVmFsdWUgPSB0aGlzOwoKCQkvLyBhbGxvdyBtdWx0aXBsZSBoYXNoZXMgdG8gYmUgcGFzc2VkIG9uIGluaXQKCQlvcHRpb25zID0gIWlzTWV0aG9kQ2FsbCAmJiBhcmdzLmxlbmd0aCA/CgkJCSQud2lkZ2V0LmV4dGVuZC5hcHBseSggbnVsbCwgWyBvcHRpb25zIF0uY29uY2F0KGFyZ3MpICkgOgoJCQlvcHRpb25zOwoKCQlpZiAoIGlzTWV0aG9kQ2FsbCApIHsKCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJdmFyIG1ldGhvZFZhbHVlLAoJCQkJCWluc3RhbmNlID0gJC5kYXRhKCB0aGlzLCBmdWxsTmFtZSApOwoJCQkJaWYgKCBvcHRpb25zID09PSAiaW5zdGFuY2UiICkgewoJCQkJCXJldHVyblZhbHVlID0gaW5zdGFuY2U7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQkJaWYgKCAhaW5zdGFuY2UgKSB7CgkJCQkJcmV0dXJuICQuZXJyb3IoICJjYW5ub3QgY2FsbCBtZXRob2RzIG9uICIgKyBuYW1lICsgIiBwcmlvciB0byBpbml0aWFsaXphdGlvbjsgIiArCgkJCQkJCSJhdHRlbXB0ZWQgdG8gY2FsbCBtZXRob2QgJyIgKyBvcHRpb25zICsgIiciICk7CgkJCQl9CgkJCQlpZiAoICEkLmlzRnVuY3Rpb24oIGluc3RhbmNlW29wdGlvbnNdICkgfHwgb3B0aW9ucy5jaGFyQXQoIDAgKSA9PT0gIl8iICkgewoJCQkJCXJldHVybiAkLmVycm9yKCAibm8gc3VjaCBtZXRob2QgJyIgKyBvcHRpb25zICsgIicgZm9yICIgKyBuYW1lICsgIiB3aWRnZXQgaW5zdGFuY2UiICk7CgkJCQl9CgkJCQltZXRob2RWYWx1ZSA9IGluc3RhbmNlWyBvcHRpb25zIF0uYXBwbHkoIGluc3RhbmNlLCBhcmdzICk7CgkJCQlpZiAoIG1ldGhvZFZhbHVlICE9PSBpbnN0YW5jZSAmJiBtZXRob2RWYWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVyblZhbHVlID0gbWV0aG9kVmFsdWUgJiYgbWV0aG9kVmFsdWUuanF1ZXJ5ID8KCQkJCQkJcmV0dXJuVmFsdWUucHVzaFN0YWNrKCBtZXRob2RWYWx1ZS5nZXQoKSApIDoKCQkJCQkJbWV0aG9kVmFsdWU7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9KTsKCQl9IGVsc2UgewoJCQl0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQl2YXIgaW5zdGFuY2UgPSAkLmRhdGEoIHRoaXMsIGZ1bGxOYW1lICk7CgkJCQlpZiAoIGluc3RhbmNlICkgewoJCQkJCWluc3RhbmNlLm9wdGlvbiggb3B0aW9ucyB8fCB7fSApOwoJCQkJCWlmICggaW5zdGFuY2UuX2luaXQgKSB7CgkJCQkJCWluc3RhbmNlLl9pbml0KCk7CgkJCQkJfQoJCQkJfSBlbHNlIHsKCQkJCQkkLmRhdGEoIHRoaXMsIGZ1bGxOYW1lLCBuZXcgb2JqZWN0KCBvcHRpb25zLCB0aGlzICkgKTsKCQkJCX0KCQkJfSk7CgkJfQoKCQlyZXR1cm4gcmV0dXJuVmFsdWU7Cgl9Owp9OwoKJC5XaWRnZXQgPSBmdW5jdGlvbiggLyogb3B0aW9ucywgZWxlbWVudCAqLyApIHt9OwokLldpZGdldC5fY2hpbGRDb25zdHJ1Y3RvcnMgPSBbXTsKCiQuV2lkZ2V0LnByb3RvdHlwZSA9IHsKCXdpZGdldE5hbWU6ICJ3aWRnZXQiLAoJd2lkZ2V0RXZlbnRQcmVmaXg6ICIiLAoJZGVmYXVsdEVsZW1lbnQ6ICI8ZGl2PiIsCglvcHRpb25zOiB7CgkJZGlzYWJsZWQ6IGZhbHNlLAoKCQkvLyBjYWxsYmFja3MKCQljcmVhdGU6IG51bGwKCX0sCglfY3JlYXRlV2lkZ2V0OiBmdW5jdGlvbiggb3B0aW9ucywgZWxlbWVudCApIHsKCQllbGVtZW50ID0gJCggZWxlbWVudCB8fCB0aGlzLmRlZmF1bHRFbGVtZW50IHx8IHRoaXMgKVsgMCBdOwoJCXRoaXMuZWxlbWVudCA9ICQoIGVsZW1lbnQgKTsKCQl0aGlzLnV1aWQgPSB3aWRnZXRfdXVpZCsrOwoJCXRoaXMuZXZlbnROYW1lc3BhY2UgPSAiLiIgKyB0aGlzLndpZGdldE5hbWUgKyB0aGlzLnV1aWQ7CgkJdGhpcy5vcHRpb25zID0gJC53aWRnZXQuZXh0ZW5kKCB7fSwKCQkJdGhpcy5vcHRpb25zLAoJCQl0aGlzLl9nZXRDcmVhdGVPcHRpb25zKCksCgkJCW9wdGlvbnMgKTsKCgkJdGhpcy5iaW5kaW5ncyA9ICQoKTsKCQl0aGlzLmhvdmVyYWJsZSA9ICQoKTsKCQl0aGlzLmZvY3VzYWJsZSA9ICQoKTsKCgkJaWYgKCBlbGVtZW50ICE9PSB0aGlzICkgewoJCQkkLmRhdGEoIGVsZW1lbnQsIHRoaXMud2lkZ2V0RnVsbE5hbWUsIHRoaXMgKTsKCQkJdGhpcy5fb24oIHRydWUsIHRoaXMuZWxlbWVudCwgewoJCQkJcmVtb3ZlOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJaWYgKCBldmVudC50YXJnZXQgPT09IGVsZW1lbnQgKSB7CgkJCQkJCXRoaXMuZGVzdHJveSgpOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgkJCXRoaXMuZG9jdW1lbnQgPSAkKCBlbGVtZW50LnN0eWxlID8KCQkJCS8vIGVsZW1lbnQgd2l0aGluIHRoZSBkb2N1bWVudAoJCQkJZWxlbWVudC5vd25lckRvY3VtZW50IDoKCQkJCS8vIGVsZW1lbnQgaXMgd2luZG93IG9yIGRvY3VtZW50CgkJCQllbGVtZW50LmRvY3VtZW50IHx8IGVsZW1lbnQgKTsKCQkJdGhpcy53aW5kb3cgPSAkKCB0aGlzLmRvY3VtZW50WzBdLmRlZmF1bHRWaWV3IHx8IHRoaXMuZG9jdW1lbnRbMF0ucGFyZW50V2luZG93ICk7CgkJfQoKCQl0aGlzLl9jcmVhdGUoKTsKCQl0aGlzLl90cmlnZ2VyKCAiY3JlYXRlIiwgbnVsbCwgdGhpcy5fZ2V0Q3JlYXRlRXZlbnREYXRhKCkgKTsKCQl0aGlzLl9pbml0KCk7Cgl9LAoJX2dldENyZWF0ZU9wdGlvbnM6ICQubm9vcCwKCV9nZXRDcmVhdGVFdmVudERhdGE6ICQubm9vcCwKCV9jcmVhdGU6ICQubm9vcCwKCV9pbml0OiAkLm5vb3AsCgoJZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJdGhpcy5fZGVzdHJveSgpOwoJCS8vIHdlIGNhbiBwcm9iYWJseSByZW1vdmUgdGhlIHVuYmluZCBjYWxscyBpbiAyLjAKCQkvLyBhbGwgZXZlbnQgYmluZGluZ3Mgc2hvdWxkIGdvIHRocm91Z2ggdGhpcy5fb24oKQoJCXRoaXMuZWxlbWVudAoJCQkudW5iaW5kKCB0aGlzLmV2ZW50TmFtZXNwYWNlICkKCQkJLnJlbW92ZURhdGEoIHRoaXMud2lkZ2V0RnVsbE5hbWUgKQoJCQkvLyBzdXBwb3J0OiBqcXVlcnkgPDEuNi4zCgkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0Lzk0MTMKCQkJLnJlbW92ZURhdGEoICQuY2FtZWxDYXNlKCB0aGlzLndpZGdldEZ1bGxOYW1lICkgKTsKCQl0aGlzLndpZGdldCgpCgkJCS51bmJpbmQoIHRoaXMuZXZlbnROYW1lc3BhY2UgKQoJCQkucmVtb3ZlQXR0ciggImFyaWEtZGlzYWJsZWQiICkKCQkJLnJlbW92ZUNsYXNzKAoJCQkJdGhpcy53aWRnZXRGdWxsTmFtZSArICItZGlzYWJsZWQgIiArCgkJCQkidWktc3RhdGUtZGlzYWJsZWQiICk7CgoJCS8vIGNsZWFuIHVwIGV2ZW50cyBhbmQgc3RhdGVzCgkJdGhpcy5iaW5kaW5ncy51bmJpbmQoIHRoaXMuZXZlbnROYW1lc3BhY2UgKTsKCQl0aGlzLmhvdmVyYWJsZS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWhvdmVyIiApOwoJCXRoaXMuZm9jdXNhYmxlLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtZm9jdXMiICk7Cgl9LAoJX2Rlc3Ryb3k6ICQubm9vcCwKCgl3aWRnZXQ6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmVsZW1lbnQ7Cgl9LAoKCW9wdGlvbjogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJdmFyIG9wdGlvbnMgPSBrZXksCgkJCXBhcnRzLAoJCQljdXJPcHRpb24sCgkJCWk7CgoJCWlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMCApIHsKCQkJLy8gZG9uJ3QgcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBpbnRlcm5hbCBoYXNoCgkJCXJldHVybiAkLndpZGdldC5leHRlbmQoIHt9LCB0aGlzLm9wdGlvbnMgKTsKCQl9CgoJCWlmICggdHlwZW9mIGtleSA9PT0gInN0cmluZyIgKSB7CgkJCS8vIGhhbmRsZSBuZXN0ZWQga2V5cywgZS5nLiwgImZvby5iYXIiID0+IHsgZm9vOiB7IGJhcjogX19fIH0gfQoJCQlvcHRpb25zID0ge307CgkJCXBhcnRzID0ga2V5LnNwbGl0KCAiLiIgKTsKCQkJa2V5ID0gcGFydHMuc2hpZnQoKTsKCQkJaWYgKCBwYXJ0cy5sZW5ndGggKSB7CgkJCQljdXJPcHRpb24gPSBvcHRpb25zWyBrZXkgXSA9ICQud2lkZ2V0LmV4dGVuZCgge30sIHRoaXMub3B0aW9uc1sga2V5IF0gKTsKCQkJCWZvciAoIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoIC0gMTsgaSsrICkgewoJCQkJCWN1ck9wdGlvblsgcGFydHNbIGkgXSBdID0gY3VyT3B0aW9uWyBwYXJ0c1sgaSBdIF0gfHwge307CgkJCQkJY3VyT3B0aW9uID0gY3VyT3B0aW9uWyBwYXJ0c1sgaSBdIF07CgkJCQl9CgkJCQlrZXkgPSBwYXJ0cy5wb3AoKTsKCQkJCWlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMSApIHsKCQkJCQlyZXR1cm4gY3VyT3B0aW9uWyBrZXkgXSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IGN1ck9wdGlvblsga2V5IF07CgkJCQl9CgkJCQljdXJPcHRpb25bIGtleSBdID0gdmFsdWU7CgkJCX0gZWxzZSB7CgkJCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgKSB7CgkJCQkJcmV0dXJuIHRoaXMub3B0aW9uc1sga2V5IF0gPT09IHVuZGVmaW5lZCA/IG51bGwgOiB0aGlzLm9wdGlvbnNbIGtleSBdOwoJCQkJfQoJCQkJb3B0aW9uc1sga2V5IF0gPSB2YWx1ZTsKCQkJfQoJCX0KCgkJdGhpcy5fc2V0T3B0aW9ucyggb3B0aW9ucyApOwoKCQlyZXR1cm4gdGhpczsKCX0sCglfc2V0T3B0aW9uczogZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgkJdmFyIGtleTsKCgkJZm9yICgga2V5IGluIG9wdGlvbnMgKSB7CgkJCXRoaXMuX3NldE9wdGlvbigga2V5LCBvcHRpb25zWyBrZXkgXSApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoJX3NldE9wdGlvbjogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJdGhpcy5vcHRpb25zWyBrZXkgXSA9IHZhbHVlOwoKCQlpZiAoIGtleSA9PT0gImRpc2FibGVkIiApIHsKCQkJdGhpcy53aWRnZXQoKQoJCQkJLnRvZ2dsZUNsYXNzKCB0aGlzLndpZGdldEZ1bGxOYW1lICsgIi1kaXNhYmxlZCIsICEhdmFsdWUgKTsKCgkJCS8vIElmIHRoZSB3aWRnZXQgaXMgYmVjb21pbmcgZGlzYWJsZWQsIHRoZW4gbm90aGluZyBpcyBpbnRlcmFjdGl2ZQoJCQlpZiAoIHZhbHVlICkgewoJCQkJdGhpcy5ob3ZlcmFibGUucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1ob3ZlciIgKTsKCQkJCXRoaXMuZm9jdXNhYmxlLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtZm9jdXMiICk7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCgllbmFibGU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLl9zZXRPcHRpb25zKHsgZGlzYWJsZWQ6IGZhbHNlIH0pOwoJfSwKCWRpc2FibGU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLl9zZXRPcHRpb25zKHsgZGlzYWJsZWQ6IHRydWUgfSk7Cgl9LAoKCV9vbjogZnVuY3Rpb24oIHN1cHByZXNzRGlzYWJsZWRDaGVjaywgZWxlbWVudCwgaGFuZGxlcnMgKSB7CgkJdmFyIGRlbGVnYXRlRWxlbWVudCwKCQkJaW5zdGFuY2UgPSB0aGlzOwoKCQkvLyBubyBzdXBwcmVzc0Rpc2FibGVkQ2hlY2sgZmxhZywgc2h1ZmZsZSBhcmd1bWVudHMKCQlpZiAoIHR5cGVvZiBzdXBwcmVzc0Rpc2FibGVkQ2hlY2sgIT09ICJib29sZWFuIiApIHsKCQkJaGFuZGxlcnMgPSBlbGVtZW50OwoJCQllbGVtZW50ID0gc3VwcHJlc3NEaXNhYmxlZENoZWNrOwoJCQlzdXBwcmVzc0Rpc2FibGVkQ2hlY2sgPSBmYWxzZTsKCQl9CgoJCS8vIG5vIGVsZW1lbnQgYXJndW1lbnQsIHNodWZmbGUgYW5kIHVzZSB0aGlzLmVsZW1lbnQKCQlpZiAoICFoYW5kbGVycyApIHsKCQkJaGFuZGxlcnMgPSBlbGVtZW50OwoJCQllbGVtZW50ID0gdGhpcy5lbGVtZW50OwoJCQlkZWxlZ2F0ZUVsZW1lbnQgPSB0aGlzLndpZGdldCgpOwoJCX0gZWxzZSB7CgkJCWVsZW1lbnQgPSBkZWxlZ2F0ZUVsZW1lbnQgPSAkKCBlbGVtZW50ICk7CgkJCXRoaXMuYmluZGluZ3MgPSB0aGlzLmJpbmRpbmdzLmFkZCggZWxlbWVudCApOwoJCX0KCgkJJC5lYWNoKCBoYW5kbGVycywgZnVuY3Rpb24oIGV2ZW50LCBoYW5kbGVyICkgewoJCQlmdW5jdGlvbiBoYW5kbGVyUHJveHkoKSB7CgkJCQkvLyBhbGxvdyB3aWRnZXRzIHRvIGN1c3RvbWl6ZSB0aGUgZGlzYWJsZWQgaGFuZGxpbmcKCQkJCS8vIC0gZGlzYWJsZWQgYXMgYW4gYXJyYXkgaW5zdGVhZCBvZiBib29sZWFuCgkJCQkvLyAtIGRpc2FibGVkIGNsYXNzIGFzIG1ldGhvZCBmb3IgZGlzYWJsaW5nIGluZGl2aWR1YWwgcGFydHMKCQkJCWlmICggIXN1cHByZXNzRGlzYWJsZWRDaGVjayAmJgoJCQkJCQkoIGluc3RhbmNlLm9wdGlvbnMuZGlzYWJsZWQgPT09IHRydWUgfHwKCQkJCQkJCSQoIHRoaXMgKS5oYXNDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiApICkgKSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJcmV0dXJuICggdHlwZW9mIGhhbmRsZXIgPT09ICJzdHJpbmciID8gaW5zdGFuY2VbIGhhbmRsZXIgXSA6IGhhbmRsZXIgKQoJCQkJCS5hcHBseSggaW5zdGFuY2UsIGFyZ3VtZW50cyApOwoJCQl9CgoJCQkvLyBjb3B5IHRoZSBndWlkIHNvIGRpcmVjdCB1bmJpbmRpbmcgd29ya3MKCQkJaWYgKCB0eXBlb2YgaGFuZGxlciAhPT0gInN0cmluZyIgKSB7CgkJCQloYW5kbGVyUHJveHkuZ3VpZCA9IGhhbmRsZXIuZ3VpZCA9CgkJCQkJaGFuZGxlci5ndWlkIHx8IGhhbmRsZXJQcm94eS5ndWlkIHx8ICQuZ3VpZCsrOwoJCQl9CgoJCQl2YXIgbWF0Y2ggPSBldmVudC5tYXRjaCggL14oW1x3Oi1dKilccyooLiopJC8gKSwKCQkJCWV2ZW50TmFtZSA9IG1hdGNoWzFdICsgaW5zdGFuY2UuZXZlbnROYW1lc3BhY2UsCgkJCQlzZWxlY3RvciA9IG1hdGNoWzJdOwoJCQlpZiAoIHNlbGVjdG9yICkgewoJCQkJZGVsZWdhdGVFbGVtZW50LmRlbGVnYXRlKCBzZWxlY3RvciwgZXZlbnROYW1lLCBoYW5kbGVyUHJveHkgKTsKCQkJfSBlbHNlIHsKCQkJCWVsZW1lbnQuYmluZCggZXZlbnROYW1lLCBoYW5kbGVyUHJveHkgKTsKCQkJfQoJCX0pOwoJfSwKCglfb2ZmOiBmdW5jdGlvbiggZWxlbWVudCwgZXZlbnROYW1lICkgewoJCWV2ZW50TmFtZSA9IChldmVudE5hbWUgfHwgIiIpLnNwbGl0KCAiICIgKS5qb2luKCB0aGlzLmV2ZW50TmFtZXNwYWNlICsgIiAiICkgKyB0aGlzLmV2ZW50TmFtZXNwYWNlOwoJCWVsZW1lbnQudW5iaW5kKCBldmVudE5hbWUgKS51bmRlbGVnYXRlKCBldmVudE5hbWUgKTsKCX0sCgoJX2RlbGF5OiBmdW5jdGlvbiggaGFuZGxlciwgZGVsYXkgKSB7CgkJZnVuY3Rpb24gaGFuZGxlclByb3h5KCkgewoJCQlyZXR1cm4gKCB0eXBlb2YgaGFuZGxlciA9PT0gInN0cmluZyIgPyBpbnN0YW5jZVsgaGFuZGxlciBdIDogaGFuZGxlciApCgkJCQkuYXBwbHkoIGluc3RhbmNlLCBhcmd1bWVudHMgKTsKCQl9CgkJdmFyIGluc3RhbmNlID0gdGhpczsKCQlyZXR1cm4gc2V0VGltZW91dCggaGFuZGxlclByb3h5LCBkZWxheSB8fCAwICk7Cgl9LAoKCV9ob3ZlcmFibGU6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCXRoaXMuaG92ZXJhYmxlID0gdGhpcy5ob3ZlcmFibGUuYWRkKCBlbGVtZW50ICk7CgkJdGhpcy5fb24oIGVsZW1lbnQsIHsKCQkJbW91c2VlbnRlcjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJJCggZXZlbnQuY3VycmVudFRhcmdldCApLmFkZENsYXNzKCAidWktc3RhdGUtaG92ZXIiICk7CgkJCX0sCgkJCW1vdXNlbGVhdmU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCSQoIGV2ZW50LmN1cnJlbnRUYXJnZXQgKS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWhvdmVyIiApOwoJCQl9CgkJfSk7Cgl9LAoKCV9mb2N1c2FibGU6IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCXRoaXMuZm9jdXNhYmxlID0gdGhpcy5mb2N1c2FibGUuYWRkKCBlbGVtZW50ICk7CgkJdGhpcy5fb24oIGVsZW1lbnQsIHsKCQkJZm9jdXNpbjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJJCggZXZlbnQuY3VycmVudFRhcmdldCApLmFkZENsYXNzKCAidWktc3RhdGUtZm9jdXMiICk7CgkJCX0sCgkJCWZvY3Vzb3V0OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkkKCBldmVudC5jdXJyZW50VGFyZ2V0ICkucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1mb2N1cyIgKTsKCQkJfQoJCX0pOwoJfSwKCglfdHJpZ2dlcjogZnVuY3Rpb24oIHR5cGUsIGV2ZW50LCBkYXRhICkgewoJCXZhciBwcm9wLCBvcmlnLAoJCQljYWxsYmFjayA9IHRoaXMub3B0aW9uc1sgdHlwZSBdOwoKCQlkYXRhID0gZGF0YSB8fCB7fTsKCQlldmVudCA9ICQuRXZlbnQoIGV2ZW50ICk7CgkJZXZlbnQudHlwZSA9ICggdHlwZSA9PT0gdGhpcy53aWRnZXRFdmVudFByZWZpeCA/CgkJCXR5cGUgOgoJCQl0aGlzLndpZGdldEV2ZW50UHJlZml4ICsgdHlwZSApLnRvTG93ZXJDYXNlKCk7CgkJLy8gdGhlIG9yaWdpbmFsIGV2ZW50IG1heSBjb21lIGZyb20gYW55IGVsZW1lbnQKCQkvLyBzbyB3ZSBuZWVkIHRvIHJlc2V0IHRoZSB0YXJnZXQgb24gdGhlIG5ldyBldmVudAoJCWV2ZW50LnRhcmdldCA9IHRoaXMuZWxlbWVudFsgMCBdOwoKCQkvLyBjb3B5IG9yaWdpbmFsIGV2ZW50IHByb3BlcnRpZXMgb3ZlciB0byB0aGUgbmV3IGV2ZW50CgkJb3JpZyA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQ7CgkJaWYgKCBvcmlnICkgewoJCQlmb3IgKCBwcm9wIGluIG9yaWcgKSB7CgkJCQlpZiAoICEoIHByb3AgaW4gZXZlbnQgKSApIHsKCQkJCQlldmVudFsgcHJvcCBdID0gb3JpZ1sgcHJvcCBdOwoJCQkJfQoJCQl9CgkJfQoKCQl0aGlzLmVsZW1lbnQudHJpZ2dlciggZXZlbnQsIGRhdGEgKTsKCQlyZXR1cm4gISggJC5pc0Z1bmN0aW9uKCBjYWxsYmFjayApICYmCgkJCWNhbGxiYWNrLmFwcGx5KCB0aGlzLmVsZW1lbnRbMF0sIFsgZXZlbnQgXS5jb25jYXQoIGRhdGEgKSApID09PSBmYWxzZSB8fAoJCQlldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApOwoJfQp9OwoKJC5lYWNoKCB7IHNob3c6ICJmYWRlSW4iLCBoaWRlOiAiZmFkZU91dCIgfSwgZnVuY3Rpb24oIG1ldGhvZCwgZGVmYXVsdEVmZmVjdCApIHsKCSQuV2lkZ2V0LnByb3RvdHlwZVsgIl8iICsgbWV0aG9kIF0gPSBmdW5jdGlvbiggZWxlbWVudCwgb3B0aW9ucywgY2FsbGJhY2sgKSB7CgkJaWYgKCB0eXBlb2Ygb3B0aW9ucyA9PT0gInN0cmluZyIgKSB7CgkJCW9wdGlvbnMgPSB7IGVmZmVjdDogb3B0aW9ucyB9OwoJCX0KCQl2YXIgaGFzT3B0aW9ucywKCQkJZWZmZWN0TmFtZSA9ICFvcHRpb25zID8KCQkJCW1ldGhvZCA6CgkJCQlvcHRpb25zID09PSB0cnVlIHx8IHR5cGVvZiBvcHRpb25zID09PSAibnVtYmVyIiA/CgkJCQkJZGVmYXVsdEVmZmVjdCA6CgkJCQkJb3B0aW9ucy5lZmZlY3QgfHwgZGVmYXVsdEVmZmVjdDsKCQlvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCQlpZiAoIHR5cGVvZiBvcHRpb25zID09PSAibnVtYmVyIiApIHsKCQkJb3B0aW9ucyA9IHsgZHVyYXRpb246IG9wdGlvbnMgfTsKCQl9CgkJaGFzT3B0aW9ucyA9ICEkLmlzRW1wdHlPYmplY3QoIG9wdGlvbnMgKTsKCQlvcHRpb25zLmNvbXBsZXRlID0gY2FsbGJhY2s7CgkJaWYgKCBvcHRpb25zLmRlbGF5ICkgewoJCQllbGVtZW50LmRlbGF5KCBvcHRpb25zLmRlbGF5ICk7CgkJfQoJCWlmICggaGFzT3B0aW9ucyAmJiAkLmVmZmVjdHMgJiYgJC5lZmZlY3RzLmVmZmVjdFsgZWZmZWN0TmFtZSBdICkgewoJCQllbGVtZW50WyBtZXRob2QgXSggb3B0aW9ucyApOwoJCX0gZWxzZSBpZiAoIGVmZmVjdE5hbWUgIT09IG1ldGhvZCAmJiBlbGVtZW50WyBlZmZlY3ROYW1lIF0gKSB7CgkJCWVsZW1lbnRbIGVmZmVjdE5hbWUgXSggb3B0aW9ucy5kdXJhdGlvbiwgb3B0aW9ucy5lYXNpbmcsIGNhbGxiYWNrICk7CgkJfSBlbHNlIHsKCQkJZWxlbWVudC5xdWV1ZShmdW5jdGlvbiggbmV4dCApIHsKCQkJCSQoIHRoaXMgKVsgbWV0aG9kIF0oKTsKCQkJCWlmICggY2FsbGJhY2sgKSB7CgkJCQkJY2FsbGJhY2suY2FsbCggZWxlbWVudFsgMCBdICk7CgkJCQl9CgkJCQluZXh0KCk7CgkJCX0pOwoJCX0KCX07Cn0pOwoKdmFyIHdpZGdldCA9ICQud2lkZ2V0OwoKCi8qIQogKiBqUXVlcnkgVUkgTW91c2UgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vbW91c2UvCiAqLwoKCnZhciBtb3VzZUhhbmRsZWQgPSBmYWxzZTsKJCggZG9jdW1lbnQgKS5tb3VzZXVwKCBmdW5jdGlvbigpIHsKCW1vdXNlSGFuZGxlZCA9IGZhbHNlOwp9KTsKCnZhciBtb3VzZSA9ICQud2lkZ2V0KCJ1aS5tb3VzZSIsIHsKCXZlcnNpb246ICIxLjExLjEiLAoJb3B0aW9uczogewoJCWNhbmNlbDogImlucHV0LHRleHRhcmVhLGJ1dHRvbixzZWxlY3Qsb3B0aW9uIiwKCQlkaXN0YW5jZTogMSwKCQlkZWxheTogMAoJfSwKCV9tb3VzZUluaXQ6IGZ1bmN0aW9uKCkgewoJCXZhciB0aGF0ID0gdGhpczsKCgkJdGhpcy5lbGVtZW50CgkJCS5iaW5kKCJtb3VzZWRvd24uIiArIHRoaXMud2lkZ2V0TmFtZSwgZnVuY3Rpb24oZXZlbnQpIHsKCQkJCXJldHVybiB0aGF0Ll9tb3VzZURvd24oZXZlbnQpOwoJCQl9KQoJCQkuYmluZCgiY2xpY2suIiArIHRoaXMud2lkZ2V0TmFtZSwgZnVuY3Rpb24oZXZlbnQpIHsKCQkJCWlmICh0cnVlID09PSAkLmRhdGEoZXZlbnQudGFyZ2V0LCB0aGF0LndpZGdldE5hbWUgKyAiLnByZXZlbnRDbGlja0V2ZW50IikpIHsKCQkJCQkkLnJlbW92ZURhdGEoZXZlbnQudGFyZ2V0LCB0aGF0LndpZGdldE5hbWUgKyAiLnByZXZlbnRDbGlja0V2ZW50Iik7CgkJCQkJZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9KTsKCgkJdGhpcy5zdGFydGVkID0gZmFsc2U7Cgl9LAoKCS8vIFRPRE86IG1ha2Ugc3VyZSBkZXN0cm95aW5nIG9uZSBpbnN0YW5jZSBvZiBtb3VzZSBkb2Vzbid0IG1lc3Mgd2l0aAoJLy8gb3RoZXIgaW5zdGFuY2VzIG9mIG1vdXNlCglfbW91c2VEZXN0cm95OiBmdW5jdGlvbigpIHsKCQl0aGlzLmVsZW1lbnQudW5iaW5kKCIuIiArIHRoaXMud2lkZ2V0TmFtZSk7CgkJaWYgKCB0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSApIHsKCQkJdGhpcy5kb2N1bWVudAoJCQkJLnVuYmluZCgibW91c2Vtb3ZlLiIgKyB0aGlzLndpZGdldE5hbWUsIHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKQoJCQkJLnVuYmluZCgibW91c2V1cC4iICsgdGhpcy53aWRnZXROYW1lLCB0aGlzLl9tb3VzZVVwRGVsZWdhdGUpOwoJCX0KCX0sCgoJX21vdXNlRG93bjogZnVuY3Rpb24oZXZlbnQpIHsKCQkvLyBkb24ndCBsZXQgbW9yZSB0aGFuIG9uZSB3aWRnZXQgaGFuZGxlIG1vdXNlU3RhcnQKCQlpZiAoIG1vdXNlSGFuZGxlZCApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gd2UgbWF5IGhhdmUgbWlzc2VkIG1vdXNldXAgKG91dCBvZiB3aW5kb3cpCgkJKHRoaXMuX21vdXNlU3RhcnRlZCAmJiB0aGlzLl9tb3VzZVVwKGV2ZW50KSk7CgoJCXRoaXMuX21vdXNlRG93bkV2ZW50ID0gZXZlbnQ7CgoJCXZhciB0aGF0ID0gdGhpcywKCQkJYnRuSXNMZWZ0ID0gKGV2ZW50LndoaWNoID09PSAxKSwKCQkJLy8gZXZlbnQudGFyZ2V0Lm5vZGVOYW1lIHdvcmtzIGFyb3VuZCBhIGJ1ZyBpbiBJRSA4IHdpdGgKCQkJLy8gZGlzYWJsZWQgaW5wdXRzICgjNzYyMCkKCQkJZWxJc0NhbmNlbCA9ICh0eXBlb2YgdGhpcy5vcHRpb25zLmNhbmNlbCA9PT0gInN0cmluZyIgJiYgZXZlbnQudGFyZ2V0Lm5vZGVOYW1lID8gJChldmVudC50YXJnZXQpLmNsb3Nlc3QodGhpcy5vcHRpb25zLmNhbmNlbCkubGVuZ3RoIDogZmFsc2UpOwoJCWlmICghYnRuSXNMZWZ0IHx8IGVsSXNDYW5jZWwgfHwgIXRoaXMuX21vdXNlQ2FwdHVyZShldmVudCkpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoKCQl0aGlzLm1vdXNlRGVsYXlNZXQgPSAhdGhpcy5vcHRpb25zLmRlbGF5OwoJCWlmICghdGhpcy5tb3VzZURlbGF5TWV0KSB7CgkJCXRoaXMuX21vdXNlRGVsYXlUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQl0aGF0Lm1vdXNlRGVsYXlNZXQgPSB0cnVlOwoJCQl9LCB0aGlzLm9wdGlvbnMuZGVsYXkpOwoJCX0KCgkJaWYgKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoZXZlbnQpICYmIHRoaXMuX21vdXNlRGVsYXlNZXQoZXZlbnQpKSB7CgkJCXRoaXMuX21vdXNlU3RhcnRlZCA9ICh0aGlzLl9tb3VzZVN0YXJ0KGV2ZW50KSAhPT0gZmFsc2UpOwoJCQlpZiAoIXRoaXMuX21vdXNlU3RhcnRlZCkgewoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfQoKCQkvLyBDbGljayBldmVudCBtYXkgbmV2ZXIgaGF2ZSBmaXJlZCAoR2Vja28gJiBPcGVyYSkKCQlpZiAodHJ1ZSA9PT0gJC5kYXRhKGV2ZW50LnRhcmdldCwgdGhpcy53aWRnZXROYW1lICsgIi5wcmV2ZW50Q2xpY2tFdmVudCIpKSB7CgkJCSQucmVtb3ZlRGF0YShldmVudC50YXJnZXQsIHRoaXMud2lkZ2V0TmFtZSArICIucHJldmVudENsaWNrRXZlbnQiKTsKCQl9CgoJCS8vIHRoZXNlIGRlbGVnYXRlcyBhcmUgcmVxdWlyZWQgdG8ga2VlcCBjb250ZXh0CgkJdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUgPSBmdW5jdGlvbihldmVudCkgewoJCQlyZXR1cm4gdGhhdC5fbW91c2VNb3ZlKGV2ZW50KTsKCQl9OwoJCXRoaXMuX21vdXNlVXBEZWxlZ2F0ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7CgkJCXJldHVybiB0aGF0Ll9tb3VzZVVwKGV2ZW50KTsKCQl9OwoKCQl0aGlzLmRvY3VtZW50CgkJCS5iaW5kKCAibW91c2Vtb3ZlLiIgKyB0aGlzLndpZGdldE5hbWUsIHRoaXMuX21vdXNlTW92ZURlbGVnYXRlICkKCQkJLmJpbmQoICJtb3VzZXVwLiIgKyB0aGlzLndpZGdldE5hbWUsIHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSApOwoKCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKCQltb3VzZUhhbmRsZWQgPSB0cnVlOwoJCXJldHVybiB0cnVlOwoJfSwKCglfbW91c2VNb3ZlOiBmdW5jdGlvbihldmVudCkgewoJCS8vIElFIG1vdXNldXAgY2hlY2sgLSBtb3VzZXVwIGhhcHBlbmVkIHdoZW4gbW91c2Ugd2FzIG91dCBvZiB3aW5kb3cKCQlpZiAoJC51aS5pZSAmJiAoICFkb2N1bWVudC5kb2N1bWVudE1vZGUgfHwgZG9jdW1lbnQuZG9jdW1lbnRNb2RlIDwgOSApICYmICFldmVudC5idXR0b24pIHsKCQkJcmV0dXJuIHRoaXMuX21vdXNlVXAoZXZlbnQpOwoKCQkvLyBJZnJhbWUgbW91c2V1cCBjaGVjayAtIG1vdXNldXAgb2NjdXJyZWQgaW4gYW5vdGhlciBkb2N1bWVudAoJCX0gZWxzZSBpZiAoICFldmVudC53aGljaCApIHsKCQkJcmV0dXJuIHRoaXMuX21vdXNlVXAoIGV2ZW50ICk7CgkJfQoKCQlpZiAodGhpcy5fbW91c2VTdGFydGVkKSB7CgkJCXRoaXMuX21vdXNlRHJhZyhldmVudCk7CgkJCXJldHVybiBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCX0KCgkJaWYgKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoZXZlbnQpICYmIHRoaXMuX21vdXNlRGVsYXlNZXQoZXZlbnQpKSB7CgkJCXRoaXMuX21vdXNlU3RhcnRlZCA9CgkJCQkodGhpcy5fbW91c2VTdGFydCh0aGlzLl9tb3VzZURvd25FdmVudCwgZXZlbnQpICE9PSBmYWxzZSk7CgkJCSh0aGlzLl9tb3VzZVN0YXJ0ZWQgPyB0aGlzLl9tb3VzZURyYWcoZXZlbnQpIDogdGhpcy5fbW91c2VVcChldmVudCkpOwoJCX0KCgkJcmV0dXJuICF0aGlzLl9tb3VzZVN0YXJ0ZWQ7Cgl9LAoKCV9tb3VzZVVwOiBmdW5jdGlvbihldmVudCkgewoJCXRoaXMuZG9jdW1lbnQKCQkJLnVuYmluZCggIm1vdXNlbW92ZS4iICsgdGhpcy53aWRnZXROYW1lLCB0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSApCgkJCS51bmJpbmQoICJtb3VzZXVwLiIgKyB0aGlzLndpZGdldE5hbWUsIHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSApOwoKCQlpZiAodGhpcy5fbW91c2VTdGFydGVkKSB7CgkJCXRoaXMuX21vdXNlU3RhcnRlZCA9IGZhbHNlOwoKCQkJaWYgKGV2ZW50LnRhcmdldCA9PT0gdGhpcy5fbW91c2VEb3duRXZlbnQudGFyZ2V0KSB7CgkJCQkkLmRhdGEoZXZlbnQudGFyZ2V0LCB0aGlzLndpZGdldE5hbWUgKyAiLnByZXZlbnRDbGlja0V2ZW50IiwgdHJ1ZSk7CgkJCX0KCgkJCXRoaXMuX21vdXNlU3RvcChldmVudCk7CgkJfQoKCQltb3VzZUhhbmRsZWQgPSBmYWxzZTsKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCV9tb3VzZURpc3RhbmNlTWV0OiBmdW5jdGlvbihldmVudCkgewoJCXJldHVybiAoTWF0aC5tYXgoCgkJCQlNYXRoLmFicyh0aGlzLl9tb3VzZURvd25FdmVudC5wYWdlWCAtIGV2ZW50LnBhZ2VYKSwKCQkJCU1hdGguYWJzKHRoaXMuX21vdXNlRG93bkV2ZW50LnBhZ2VZIC0gZXZlbnQucGFnZVkpCgkJCSkgPj0gdGhpcy5vcHRpb25zLmRpc3RhbmNlCgkJKTsKCX0sCgoJX21vdXNlRGVsYXlNZXQ6IGZ1bmN0aW9uKC8qIGV2ZW50ICovKSB7CgkJcmV0dXJuIHRoaXMubW91c2VEZWxheU1ldDsKCX0sCgoJLy8gVGhlc2UgYXJlIHBsYWNlaG9sZGVyIG1ldGhvZHMsIHRvIGJlIG92ZXJyaWRlbiBieSBleHRlbmRpbmcgcGx1Z2luCglfbW91c2VTdGFydDogZnVuY3Rpb24oLyogZXZlbnQgKi8pIHt9LAoJX21vdXNlRHJhZzogZnVuY3Rpb24oLyogZXZlbnQgKi8pIHt9LAoJX21vdXNlU3RvcDogZnVuY3Rpb24oLyogZXZlbnQgKi8pIHt9LAoJX21vdXNlQ2FwdHVyZTogZnVuY3Rpb24oLyogZXZlbnQgKi8pIHsgcmV0dXJuIHRydWU7IH0KfSk7CgoKLyohCiAqIGpRdWVyeSBVSSBQb3NpdGlvbiAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9wb3NpdGlvbi8KICovCgooZnVuY3Rpb24oKSB7CgokLnVpID0gJC51aSB8fCB7fTsKCnZhciBjYWNoZWRTY3JvbGxiYXJXaWR0aCwgc3VwcG9ydHNPZmZzZXRGcmFjdGlvbnMsCgltYXggPSBNYXRoLm1heCwKCWFicyA9IE1hdGguYWJzLAoJcm91bmQgPSBNYXRoLnJvdW5kLAoJcmhvcml6b250YWwgPSAvbGVmdHxjZW50ZXJ8cmlnaHQvLAoJcnZlcnRpY2FsID0gL3RvcHxjZW50ZXJ8Ym90dG9tLywKCXJvZmZzZXQgPSAvW1wrXC1dXGQrKFwuW1xkXSspPyU/LywKCXJwb3NpdGlvbiA9IC9eXHcrLywKCXJwZXJjZW50ID0gLyUkLywKCV9wb3NpdGlvbiA9ICQuZm4ucG9zaXRpb247CgpmdW5jdGlvbiBnZXRPZmZzZXRzKCBvZmZzZXRzLCB3aWR0aCwgaGVpZ2h0ICkgewoJcmV0dXJuIFsKCQlwYXJzZUZsb2F0KCBvZmZzZXRzWyAwIF0gKSAqICggcnBlcmNlbnQudGVzdCggb2Zmc2V0c1sgMCBdICkgPyB3aWR0aCAvIDEwMCA6IDEgKSwKCQlwYXJzZUZsb2F0KCBvZmZzZXRzWyAxIF0gKSAqICggcnBlcmNlbnQudGVzdCggb2Zmc2V0c1sgMSBdICkgPyBoZWlnaHQgLyAxMDAgOiAxICkKCV07Cn0KCmZ1bmN0aW9uIHBhcnNlQ3NzKCBlbGVtZW50LCBwcm9wZXJ0eSApIHsKCXJldHVybiBwYXJzZUludCggJC5jc3MoIGVsZW1lbnQsIHByb3BlcnR5ICksIDEwICkgfHwgMDsKfQoKZnVuY3Rpb24gZ2V0RGltZW5zaW9ucyggZWxlbSApIHsKCXZhciByYXcgPSBlbGVtWzBdOwoJaWYgKCByYXcubm9kZVR5cGUgPT09IDkgKSB7CgkJcmV0dXJuIHsKCQkJd2lkdGg6IGVsZW0ud2lkdGgoKSwKCQkJaGVpZ2h0OiBlbGVtLmhlaWdodCgpLAoJCQlvZmZzZXQ6IHsgdG9wOiAwLCBsZWZ0OiAwIH0KCQl9OwoJfQoJaWYgKCAkLmlzV2luZG93KCByYXcgKSApIHsKCQlyZXR1cm4gewoJCQl3aWR0aDogZWxlbS53aWR0aCgpLAoJCQloZWlnaHQ6IGVsZW0uaGVpZ2h0KCksCgkJCW9mZnNldDogeyB0b3A6IGVsZW0uc2Nyb2xsVG9wKCksIGxlZnQ6IGVsZW0uc2Nyb2xsTGVmdCgpIH0KCQl9OwoJfQoJaWYgKCByYXcucHJldmVudERlZmF1bHQgKSB7CgkJcmV0dXJuIHsKCQkJd2lkdGg6IDAsCgkJCWhlaWdodDogMCwKCQkJb2Zmc2V0OiB7IHRvcDogcmF3LnBhZ2VZLCBsZWZ0OiByYXcucGFnZVggfQoJCX07Cgl9CglyZXR1cm4gewoJCXdpZHRoOiBlbGVtLm91dGVyV2lkdGgoKSwKCQloZWlnaHQ6IGVsZW0ub3V0ZXJIZWlnaHQoKSwKCQlvZmZzZXQ6IGVsZW0ub2Zmc2V0KCkKCX07Cn0KCiQucG9zaXRpb24gPSB7CglzY3JvbGxiYXJXaWR0aDogZnVuY3Rpb24oKSB7CgkJaWYgKCBjYWNoZWRTY3JvbGxiYXJXaWR0aCAhPT0gdW5kZWZpbmVkICkgewoJCQlyZXR1cm4gY2FjaGVkU2Nyb2xsYmFyV2lkdGg7CgkJfQoJCXZhciB3MSwgdzIsCgkJCWRpdiA9ICQoICI8ZGl2IHN0eWxlPSdkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO3dpZHRoOjUwcHg7aGVpZ2h0OjUwcHg7b3ZlcmZsb3c6aGlkZGVuOyc+PGRpdiBzdHlsZT0naGVpZ2h0OjEwMHB4O3dpZHRoOmF1dG87Jz48L2Rpdj48L2Rpdj4iICksCgkJCWlubmVyRGl2ID0gZGl2LmNoaWxkcmVuKClbMF07CgoJCSQoICJib2R5IiApLmFwcGVuZCggZGl2ICk7CgkJdzEgPSBpbm5lckRpdi5vZmZzZXRXaWR0aDsKCQlkaXYuY3NzKCAib3ZlcmZsb3ciLCAic2Nyb2xsIiApOwoKCQl3MiA9IGlubmVyRGl2Lm9mZnNldFdpZHRoOwoKCQlpZiAoIHcxID09PSB3MiApIHsKCQkJdzIgPSBkaXZbMF0uY2xpZW50V2lkdGg7CgkJfQoKCQlkaXYucmVtb3ZlKCk7CgoJCXJldHVybiAoY2FjaGVkU2Nyb2xsYmFyV2lkdGggPSB3MSAtIHcyKTsKCX0sCglnZXRTY3JvbGxJbmZvOiBmdW5jdGlvbiggd2l0aGluICkgewoJCXZhciBvdmVyZmxvd1ggPSB3aXRoaW4uaXNXaW5kb3cgfHwgd2l0aGluLmlzRG9jdW1lbnQgPyAiIiA6CgkJCQl3aXRoaW4uZWxlbWVudC5jc3MoICJvdmVyZmxvdy14IiApLAoJCQlvdmVyZmxvd1kgPSB3aXRoaW4uaXNXaW5kb3cgfHwgd2l0aGluLmlzRG9jdW1lbnQgPyAiIiA6CgkJCQl3aXRoaW4uZWxlbWVudC5jc3MoICJvdmVyZmxvdy15IiApLAoJCQloYXNPdmVyZmxvd1ggPSBvdmVyZmxvd1ggPT09ICJzY3JvbGwiIHx8CgkJCQkoIG92ZXJmbG93WCA9PT0gImF1dG8iICYmIHdpdGhpbi53aWR0aCA8IHdpdGhpbi5lbGVtZW50WzBdLnNjcm9sbFdpZHRoICksCgkJCWhhc092ZXJmbG93WSA9IG92ZXJmbG93WSA9PT0gInNjcm9sbCIgfHwKCQkJCSggb3ZlcmZsb3dZID09PSAiYXV0byIgJiYgd2l0aGluLmhlaWdodCA8IHdpdGhpbi5lbGVtZW50WzBdLnNjcm9sbEhlaWdodCApOwoJCXJldHVybiB7CgkJCXdpZHRoOiBoYXNPdmVyZmxvd1kgPyAkLnBvc2l0aW9uLnNjcm9sbGJhcldpZHRoKCkgOiAwLAoJCQloZWlnaHQ6IGhhc092ZXJmbG93WCA/ICQucG9zaXRpb24uc2Nyb2xsYmFyV2lkdGgoKSA6IDAKCQl9OwoJfSwKCWdldFdpdGhpbkluZm86IGZ1bmN0aW9uKCBlbGVtZW50ICkgewoJCXZhciB3aXRoaW5FbGVtZW50ID0gJCggZWxlbWVudCB8fCB3aW5kb3cgKSwKCQkJaXNXaW5kb3cgPSAkLmlzV2luZG93KCB3aXRoaW5FbGVtZW50WzBdICksCgkJCWlzRG9jdW1lbnQgPSAhIXdpdGhpbkVsZW1lbnRbIDAgXSAmJiB3aXRoaW5FbGVtZW50WyAwIF0ubm9kZVR5cGUgPT09IDk7CgkJcmV0dXJuIHsKCQkJZWxlbWVudDogd2l0aGluRWxlbWVudCwKCQkJaXNXaW5kb3c6IGlzV2luZG93LAoJCQlpc0RvY3VtZW50OiBpc0RvY3VtZW50LAoJCQlvZmZzZXQ6IHdpdGhpbkVsZW1lbnQub2Zmc2V0KCkgfHwgeyBsZWZ0OiAwLCB0b3A6IDAgfSwKCQkJc2Nyb2xsTGVmdDogd2l0aGluRWxlbWVudC5zY3JvbGxMZWZ0KCksCgkJCXNjcm9sbFRvcDogd2l0aGluRWxlbWVudC5zY3JvbGxUb3AoKSwKCgkJCS8vIHN1cHBvcnQ6IGpRdWVyeSAxLjYueAoJCQkvLyBqUXVlcnkgMS42IGRvZXNuJ3Qgc3VwcG9ydCAub3V0ZXJXaWR0aC9IZWlnaHQoKSBvbiBkb2N1bWVudHMgb3Igd2luZG93cwoJCQl3aWR0aDogaXNXaW5kb3cgfHwgaXNEb2N1bWVudCA/IHdpdGhpbkVsZW1lbnQud2lkdGgoKSA6IHdpdGhpbkVsZW1lbnQub3V0ZXJXaWR0aCgpLAoJCQloZWlnaHQ6IGlzV2luZG93IHx8IGlzRG9jdW1lbnQgPyB3aXRoaW5FbGVtZW50LmhlaWdodCgpIDogd2l0aGluRWxlbWVudC5vdXRlckhlaWdodCgpCgkJfTsKCX0KfTsKCiQuZm4ucG9zaXRpb24gPSBmdW5jdGlvbiggb3B0aW9ucyApIHsKCWlmICggIW9wdGlvbnMgfHwgIW9wdGlvbnMub2YgKSB7CgkJcmV0dXJuIF9wb3NpdGlvbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7Cgl9CgoJLy8gbWFrZSBhIGNvcHksIHdlIGRvbid0IHdhbnQgdG8gbW9kaWZ5IGFyZ3VtZW50cwoJb3B0aW9ucyA9ICQuZXh0ZW5kKCB7fSwgb3B0aW9ucyApOwoKCXZhciBhdE9mZnNldCwgdGFyZ2V0V2lkdGgsIHRhcmdldEhlaWdodCwgdGFyZ2V0T2Zmc2V0LCBiYXNlUG9zaXRpb24sIGRpbWVuc2lvbnMsCgkJdGFyZ2V0ID0gJCggb3B0aW9ucy5vZiApLAoJCXdpdGhpbiA9ICQucG9zaXRpb24uZ2V0V2l0aGluSW5mbyggb3B0aW9ucy53aXRoaW4gKSwKCQlzY3JvbGxJbmZvID0gJC5wb3NpdGlvbi5nZXRTY3JvbGxJbmZvKCB3aXRoaW4gKSwKCQljb2xsaXNpb24gPSAoIG9wdGlvbnMuY29sbGlzaW9uIHx8ICJmbGlwIiApLnNwbGl0KCAiICIgKSwKCQlvZmZzZXRzID0ge307CgoJZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIHRhcmdldCApOwoJaWYgKCB0YXJnZXRbMF0ucHJldmVudERlZmF1bHQgKSB7CgkJLy8gZm9yY2UgbGVmdCB0b3AgdG8gYWxsb3cgZmxpcHBpbmcKCQlvcHRpb25zLmF0ID0gImxlZnQgdG9wIjsKCX0KCXRhcmdldFdpZHRoID0gZGltZW5zaW9ucy53aWR0aDsKCXRhcmdldEhlaWdodCA9IGRpbWVuc2lvbnMuaGVpZ2h0OwoJdGFyZ2V0T2Zmc2V0ID0gZGltZW5zaW9ucy5vZmZzZXQ7CgkvLyBjbG9uZSB0byByZXVzZSBvcmlnaW5hbCB0YXJnZXRPZmZzZXQgbGF0ZXIKCWJhc2VQb3NpdGlvbiA9ICQuZXh0ZW5kKCB7fSwgdGFyZ2V0T2Zmc2V0ICk7CgoJLy8gZm9yY2UgbXkgYW5kIGF0IHRvIGhhdmUgdmFsaWQgaG9yaXpvbnRhbCBhbmQgdmVydGljYWwgcG9zaXRpb25zCgkvLyBpZiBhIHZhbHVlIGlzIG1pc3Npbmcgb3IgaW52YWxpZCwgaXQgd2lsbCBiZSBjb252ZXJ0ZWQgdG8gY2VudGVyCgkkLmVhY2goIFsgIm15IiwgImF0IiBdLCBmdW5jdGlvbigpIHsKCQl2YXIgcG9zID0gKCBvcHRpb25zWyB0aGlzIF0gfHwgIiIgKS5zcGxpdCggIiAiICksCgkJCWhvcml6b250YWxPZmZzZXQsCgkJCXZlcnRpY2FsT2Zmc2V0OwoKCQlpZiAoIHBvcy5sZW5ndGggPT09IDEpIHsKCQkJcG9zID0gcmhvcml6b250YWwudGVzdCggcG9zWyAwIF0gKSA/CgkJCQlwb3MuY29uY2F0KCBbICJjZW50ZXIiIF0gKSA6CgkJCQlydmVydGljYWwudGVzdCggcG9zWyAwIF0gKSA/CgkJCQkJWyAiY2VudGVyIiBdLmNvbmNhdCggcG9zICkgOgoJCQkJCVsgImNlbnRlciIsICJjZW50ZXIiIF07CgkJfQoJCXBvc1sgMCBdID0gcmhvcml6b250YWwudGVzdCggcG9zWyAwIF0gKSA/IHBvc1sgMCBdIDogImNlbnRlciI7CgkJcG9zWyAxIF0gPSBydmVydGljYWwudGVzdCggcG9zWyAxIF0gKSA/IHBvc1sgMSBdIDogImNlbnRlciI7CgoJCS8vIGNhbGN1bGF0ZSBvZmZzZXRzCgkJaG9yaXpvbnRhbE9mZnNldCA9IHJvZmZzZXQuZXhlYyggcG9zWyAwIF0gKTsKCQl2ZXJ0aWNhbE9mZnNldCA9IHJvZmZzZXQuZXhlYyggcG9zWyAxIF0gKTsKCQlvZmZzZXRzWyB0aGlzIF0gPSBbCgkJCWhvcml6b250YWxPZmZzZXQgPyBob3Jpem9udGFsT2Zmc2V0WyAwIF0gOiAwLAoJCQl2ZXJ0aWNhbE9mZnNldCA/IHZlcnRpY2FsT2Zmc2V0WyAwIF0gOiAwCgkJXTsKCgkJLy8gcmVkdWNlIHRvIGp1c3QgdGhlIHBvc2l0aW9ucyB3aXRob3V0IHRoZSBvZmZzZXRzCgkJb3B0aW9uc1sgdGhpcyBdID0gWwoJCQlycG9zaXRpb24uZXhlYyggcG9zWyAwIF0gKVsgMCBdLAoJCQlycG9zaXRpb24uZXhlYyggcG9zWyAxIF0gKVsgMCBdCgkJXTsKCX0pOwoKCS8vIG5vcm1hbGl6ZSBjb2xsaXNpb24gb3B0aW9uCglpZiAoIGNvbGxpc2lvbi5sZW5ndGggPT09IDEgKSB7CgkJY29sbGlzaW9uWyAxIF0gPSBjb2xsaXNpb25bIDAgXTsKCX0KCglpZiAoIG9wdGlvbnMuYXRbIDAgXSA9PT0gInJpZ2h0IiApIHsKCQliYXNlUG9zaXRpb24ubGVmdCArPSB0YXJnZXRXaWR0aDsKCX0gZWxzZSBpZiAoIG9wdGlvbnMuYXRbIDAgXSA9PT0gImNlbnRlciIgKSB7CgkJYmFzZVBvc2l0aW9uLmxlZnQgKz0gdGFyZ2V0V2lkdGggLyAyOwoJfQoKCWlmICggb3B0aW9ucy5hdFsgMSBdID09PSAiYm90dG9tIiApIHsKCQliYXNlUG9zaXRpb24udG9wICs9IHRhcmdldEhlaWdodDsKCX0gZWxzZSBpZiAoIG9wdGlvbnMuYXRbIDEgXSA9PT0gImNlbnRlciIgKSB7CgkJYmFzZVBvc2l0aW9uLnRvcCArPSB0YXJnZXRIZWlnaHQgLyAyOwoJfQoKCWF0T2Zmc2V0ID0gZ2V0T2Zmc2V0cyggb2Zmc2V0cy5hdCwgdGFyZ2V0V2lkdGgsIHRhcmdldEhlaWdodCApOwoJYmFzZVBvc2l0aW9uLmxlZnQgKz0gYXRPZmZzZXRbIDAgXTsKCWJhc2VQb3NpdGlvbi50b3AgKz0gYXRPZmZzZXRbIDEgXTsKCglyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCXZhciBjb2xsaXNpb25Qb3NpdGlvbiwgdXNpbmcsCgkJCWVsZW0gPSAkKCB0aGlzICksCgkJCWVsZW1XaWR0aCA9IGVsZW0ub3V0ZXJXaWR0aCgpLAoJCQllbGVtSGVpZ2h0ID0gZWxlbS5vdXRlckhlaWdodCgpLAoJCQltYXJnaW5MZWZ0ID0gcGFyc2VDc3MoIHRoaXMsICJtYXJnaW5MZWZ0IiApLAoJCQltYXJnaW5Ub3AgPSBwYXJzZUNzcyggdGhpcywgIm1hcmdpblRvcCIgKSwKCQkJY29sbGlzaW9uV2lkdGggPSBlbGVtV2lkdGggKyBtYXJnaW5MZWZ0ICsgcGFyc2VDc3MoIHRoaXMsICJtYXJnaW5SaWdodCIgKSArIHNjcm9sbEluZm8ud2lkdGgsCgkJCWNvbGxpc2lvbkhlaWdodCA9IGVsZW1IZWlnaHQgKyBtYXJnaW5Ub3AgKyBwYXJzZUNzcyggdGhpcywgIm1hcmdpbkJvdHRvbSIgKSArIHNjcm9sbEluZm8uaGVpZ2h0LAoJCQlwb3NpdGlvbiA9ICQuZXh0ZW5kKCB7fSwgYmFzZVBvc2l0aW9uICksCgkJCW15T2Zmc2V0ID0gZ2V0T2Zmc2V0cyggb2Zmc2V0cy5teSwgZWxlbS5vdXRlcldpZHRoKCksIGVsZW0ub3V0ZXJIZWlnaHQoKSApOwoKCQlpZiAoIG9wdGlvbnMubXlbIDAgXSA9PT0gInJpZ2h0IiApIHsKCQkJcG9zaXRpb24ubGVmdCAtPSBlbGVtV2lkdGg7CgkJfSBlbHNlIGlmICggb3B0aW9ucy5teVsgMCBdID09PSAiY2VudGVyIiApIHsKCQkJcG9zaXRpb24ubGVmdCAtPSBlbGVtV2lkdGggLyAyOwoJCX0KCgkJaWYgKCBvcHRpb25zLm15WyAxIF0gPT09ICJib3R0b20iICkgewoJCQlwb3NpdGlvbi50b3AgLT0gZWxlbUhlaWdodDsKCQl9IGVsc2UgaWYgKCBvcHRpb25zLm15WyAxIF0gPT09ICJjZW50ZXIiICkgewoJCQlwb3NpdGlvbi50b3AgLT0gZWxlbUhlaWdodCAvIDI7CgkJfQoKCQlwb3NpdGlvbi5sZWZ0ICs9IG15T2Zmc2V0WyAwIF07CgkJcG9zaXRpb24udG9wICs9IG15T2Zmc2V0WyAxIF07CgoJCS8vIGlmIHRoZSBicm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBmcmFjdGlvbnMsIHRoZW4gcm91bmQgZm9yIGNvbnNpc3RlbnQgcmVzdWx0cwoJCWlmICggIXN1cHBvcnRzT2Zmc2V0RnJhY3Rpb25zICkgewoJCQlwb3NpdGlvbi5sZWZ0ID0gcm91bmQoIHBvc2l0aW9uLmxlZnQgKTsKCQkJcG9zaXRpb24udG9wID0gcm91bmQoIHBvc2l0aW9uLnRvcCApOwoJCX0KCgkJY29sbGlzaW9uUG9zaXRpb24gPSB7CgkJCW1hcmdpbkxlZnQ6IG1hcmdpbkxlZnQsCgkJCW1hcmdpblRvcDogbWFyZ2luVG9wCgkJfTsKCgkJJC5lYWNoKCBbICJsZWZ0IiwgInRvcCIgXSwgZnVuY3Rpb24oIGksIGRpciApIHsKCQkJaWYgKCAkLnVpLnBvc2l0aW9uWyBjb2xsaXNpb25bIGkgXSBdICkgewoJCQkJJC51aS5wb3NpdGlvblsgY29sbGlzaW9uWyBpIF0gXVsgZGlyIF0oIHBvc2l0aW9uLCB7CgkJCQkJdGFyZ2V0V2lkdGg6IHRhcmdldFdpZHRoLAoJCQkJCXRhcmdldEhlaWdodDogdGFyZ2V0SGVpZ2h0LAoJCQkJCWVsZW1XaWR0aDogZWxlbVdpZHRoLAoJCQkJCWVsZW1IZWlnaHQ6IGVsZW1IZWlnaHQsCgkJCQkJY29sbGlzaW9uUG9zaXRpb246IGNvbGxpc2lvblBvc2l0aW9uLAoJCQkJCWNvbGxpc2lvbldpZHRoOiBjb2xsaXNpb25XaWR0aCwKCQkJCQljb2xsaXNpb25IZWlnaHQ6IGNvbGxpc2lvbkhlaWdodCwKCQkJCQlvZmZzZXQ6IFsgYXRPZmZzZXRbIDAgXSArIG15T2Zmc2V0WyAwIF0sIGF0T2Zmc2V0IFsgMSBdICsgbXlPZmZzZXRbIDEgXSBdLAoJCQkJCW15OiBvcHRpb25zLm15LAoJCQkJCWF0OiBvcHRpb25zLmF0LAoJCQkJCXdpdGhpbjogd2l0aGluLAoJCQkJCWVsZW06IGVsZW0KCQkJCX0pOwoJCQl9CgkJfSk7CgoJCWlmICggb3B0aW9ucy51c2luZyApIHsKCQkJLy8gYWRkcyBmZWVkYmFjayBhcyBzZWNvbmQgYXJndW1lbnQgdG8gdXNpbmcgY2FsbGJhY2ssIGlmIHByZXNlbnQKCQkJdXNpbmcgPSBmdW5jdGlvbiggcHJvcHMgKSB7CgkJCQl2YXIgbGVmdCA9IHRhcmdldE9mZnNldC5sZWZ0IC0gcG9zaXRpb24ubGVmdCwKCQkJCQlyaWdodCA9IGxlZnQgKyB0YXJnZXRXaWR0aCAtIGVsZW1XaWR0aCwKCQkJCQl0b3AgPSB0YXJnZXRPZmZzZXQudG9wIC0gcG9zaXRpb24udG9wLAoJCQkJCWJvdHRvbSA9IHRvcCArIHRhcmdldEhlaWdodCAtIGVsZW1IZWlnaHQsCgkJCQkJZmVlZGJhY2sgPSB7CgkJCQkJCXRhcmdldDogewoJCQkJCQkJZWxlbWVudDogdGFyZ2V0LAoJCQkJCQkJbGVmdDogdGFyZ2V0T2Zmc2V0LmxlZnQsCgkJCQkJCQl0b3A6IHRhcmdldE9mZnNldC50b3AsCgkJCQkJCQl3aWR0aDogdGFyZ2V0V2lkdGgsCgkJCQkJCQloZWlnaHQ6IHRhcmdldEhlaWdodAoJCQkJCQl9LAoJCQkJCQllbGVtZW50OiB7CgkJCQkJCQllbGVtZW50OiBlbGVtLAoJCQkJCQkJbGVmdDogcG9zaXRpb24ubGVmdCwKCQkJCQkJCXRvcDogcG9zaXRpb24udG9wLAoJCQkJCQkJd2lkdGg6IGVsZW1XaWR0aCwKCQkJCQkJCWhlaWdodDogZWxlbUhlaWdodAoJCQkJCQl9LAoJCQkJCQlob3Jpem9udGFsOiByaWdodCA8IDAgPyAibGVmdCIgOiBsZWZ0ID4gMCA/ICJyaWdodCIgOiAiY2VudGVyIiwKCQkJCQkJdmVydGljYWw6IGJvdHRvbSA8IDAgPyAidG9wIiA6IHRvcCA+IDAgPyAiYm90dG9tIiA6ICJtaWRkbGUiCgkJCQkJfTsKCQkJCWlmICggdGFyZ2V0V2lkdGggPCBlbGVtV2lkdGggJiYgYWJzKCBsZWZ0ICsgcmlnaHQgKSA8IHRhcmdldFdpZHRoICkgewoJCQkJCWZlZWRiYWNrLmhvcml6b250YWwgPSAiY2VudGVyIjsKCQkJCX0KCQkJCWlmICggdGFyZ2V0SGVpZ2h0IDwgZWxlbUhlaWdodCAmJiBhYnMoIHRvcCArIGJvdHRvbSApIDwgdGFyZ2V0SGVpZ2h0ICkgewoJCQkJCWZlZWRiYWNrLnZlcnRpY2FsID0gIm1pZGRsZSI7CgkJCQl9CgkJCQlpZiAoIG1heCggYWJzKCBsZWZ0ICksIGFicyggcmlnaHQgKSApID4gbWF4KCBhYnMoIHRvcCApLCBhYnMoIGJvdHRvbSApICkgKSB7CgkJCQkJZmVlZGJhY2suaW1wb3J0YW50ID0gImhvcml6b250YWwiOwoJCQkJfSBlbHNlIHsKCQkJCQlmZWVkYmFjay5pbXBvcnRhbnQgPSAidmVydGljYWwiOwoJCQkJfQoJCQkJb3B0aW9ucy51c2luZy5jYWxsKCB0aGlzLCBwcm9wcywgZmVlZGJhY2sgKTsKCQkJfTsKCQl9CgoJCWVsZW0ub2Zmc2V0KCAkLmV4dGVuZCggcG9zaXRpb24sIHsgdXNpbmc6IHVzaW5nIH0gKSApOwoJfSk7Cn07CgokLnVpLnBvc2l0aW9uID0gewoJZml0OiB7CgkJbGVmdDogZnVuY3Rpb24oIHBvc2l0aW9uLCBkYXRhICkgewoJCQl2YXIgd2l0aGluID0gZGF0YS53aXRoaW4sCgkJCQl3aXRoaW5PZmZzZXQgPSB3aXRoaW4uaXNXaW5kb3cgPyB3aXRoaW4uc2Nyb2xsTGVmdCA6IHdpdGhpbi5vZmZzZXQubGVmdCwKCQkJCW91dGVyV2lkdGggPSB3aXRoaW4ud2lkdGgsCgkJCQljb2xsaXNpb25Qb3NMZWZ0ID0gcG9zaXRpb24ubGVmdCAtIGRhdGEuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luTGVmdCwKCQkJCW92ZXJMZWZ0ID0gd2l0aGluT2Zmc2V0IC0gY29sbGlzaW9uUG9zTGVmdCwKCQkJCW92ZXJSaWdodCA9IGNvbGxpc2lvblBvc0xlZnQgKyBkYXRhLmNvbGxpc2lvbldpZHRoIC0gb3V0ZXJXaWR0aCAtIHdpdGhpbk9mZnNldCwKCQkJCW5ld092ZXJSaWdodDsKCgkJCS8vIGVsZW1lbnQgaXMgd2lkZXIgdGhhbiB3aXRoaW4KCQkJaWYgKCBkYXRhLmNvbGxpc2lvbldpZHRoID4gb3V0ZXJXaWR0aCApIHsKCQkJCS8vIGVsZW1lbnQgaXMgaW5pdGlhbGx5IG92ZXIgdGhlIGxlZnQgc2lkZSBvZiB3aXRoaW4KCQkJCWlmICggb3ZlckxlZnQgPiAwICYmIG92ZXJSaWdodCA8PSAwICkgewoJCQkJCW5ld092ZXJSaWdodCA9IHBvc2l0aW9uLmxlZnQgKyBvdmVyTGVmdCArIGRhdGEuY29sbGlzaW9uV2lkdGggLSBvdXRlcldpZHRoIC0gd2l0aGluT2Zmc2V0OwoJCQkJCXBvc2l0aW9uLmxlZnQgKz0gb3ZlckxlZnQgLSBuZXdPdmVyUmlnaHQ7CgkJCQkvLyBlbGVtZW50IGlzIGluaXRpYWxseSBvdmVyIHJpZ2h0IHNpZGUgb2Ygd2l0aGluCgkJCQl9IGVsc2UgaWYgKCBvdmVyUmlnaHQgPiAwICYmIG92ZXJMZWZ0IDw9IDAgKSB7CgkJCQkJcG9zaXRpb24ubGVmdCA9IHdpdGhpbk9mZnNldDsKCQkJCS8vIGVsZW1lbnQgaXMgaW5pdGlhbGx5IG92ZXIgYm90aCBsZWZ0IGFuZCByaWdodCBzaWRlcyBvZiB3aXRoaW4KCQkJCX0gZWxzZSB7CgkJCQkJaWYgKCBvdmVyTGVmdCA+IG92ZXJSaWdodCApIHsKCQkJCQkJcG9zaXRpb24ubGVmdCA9IHdpdGhpbk9mZnNldCArIG91dGVyV2lkdGggLSBkYXRhLmNvbGxpc2lvbldpZHRoOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXBvc2l0aW9uLmxlZnQgPSB3aXRoaW5PZmZzZXQ7CgkJCQkJfQoJCQkJfQoJCQkvLyB0b28gZmFyIGxlZnQgLT4gYWxpZ24gd2l0aCBsZWZ0IGVkZ2UKCQkJfSBlbHNlIGlmICggb3ZlckxlZnQgPiAwICkgewoJCQkJcG9zaXRpb24ubGVmdCArPSBvdmVyTGVmdDsKCQkJLy8gdG9vIGZhciByaWdodCAtPiBhbGlnbiB3aXRoIHJpZ2h0IGVkZ2UKCQkJfSBlbHNlIGlmICggb3ZlclJpZ2h0ID4gMCApIHsKCQkJCXBvc2l0aW9uLmxlZnQgLT0gb3ZlclJpZ2h0OwoJCQkvLyBhZGp1c3QgYmFzZWQgb24gcG9zaXRpb24gYW5kIG1hcmdpbgoJCQl9IGVsc2UgewoJCQkJcG9zaXRpb24ubGVmdCA9IG1heCggcG9zaXRpb24ubGVmdCAtIGNvbGxpc2lvblBvc0xlZnQsIHBvc2l0aW9uLmxlZnQgKTsKCQkJfQoJCX0sCgkJdG9wOiBmdW5jdGlvbiggcG9zaXRpb24sIGRhdGEgKSB7CgkJCXZhciB3aXRoaW4gPSBkYXRhLndpdGhpbiwKCQkJCXdpdGhpbk9mZnNldCA9IHdpdGhpbi5pc1dpbmRvdyA/IHdpdGhpbi5zY3JvbGxUb3AgOiB3aXRoaW4ub2Zmc2V0LnRvcCwKCQkJCW91dGVySGVpZ2h0ID0gZGF0YS53aXRoaW4uaGVpZ2h0LAoJCQkJY29sbGlzaW9uUG9zVG9wID0gcG9zaXRpb24udG9wIC0gZGF0YS5jb2xsaXNpb25Qb3NpdGlvbi5tYXJnaW5Ub3AsCgkJCQlvdmVyVG9wID0gd2l0aGluT2Zmc2V0IC0gY29sbGlzaW9uUG9zVG9wLAoJCQkJb3ZlckJvdHRvbSA9IGNvbGxpc2lvblBvc1RvcCArIGRhdGEuY29sbGlzaW9uSGVpZ2h0IC0gb3V0ZXJIZWlnaHQgLSB3aXRoaW5PZmZzZXQsCgkJCQluZXdPdmVyQm90dG9tOwoKCQkJLy8gZWxlbWVudCBpcyB0YWxsZXIgdGhhbiB3aXRoaW4KCQkJaWYgKCBkYXRhLmNvbGxpc2lvbkhlaWdodCA+IG91dGVySGVpZ2h0ICkgewoJCQkJLy8gZWxlbWVudCBpcyBpbml0aWFsbHkgb3ZlciB0aGUgdG9wIG9mIHdpdGhpbgoJCQkJaWYgKCBvdmVyVG9wID4gMCAmJiBvdmVyQm90dG9tIDw9IDAgKSB7CgkJCQkJbmV3T3ZlckJvdHRvbSA9IHBvc2l0aW9uLnRvcCArIG92ZXJUb3AgKyBkYXRhLmNvbGxpc2lvbkhlaWdodCAtIG91dGVySGVpZ2h0IC0gd2l0aGluT2Zmc2V0OwoJCQkJCXBvc2l0aW9uLnRvcCArPSBvdmVyVG9wIC0gbmV3T3ZlckJvdHRvbTsKCQkJCS8vIGVsZW1lbnQgaXMgaW5pdGlhbGx5IG92ZXIgYm90dG9tIG9mIHdpdGhpbgoJCQkJfSBlbHNlIGlmICggb3ZlckJvdHRvbSA+IDAgJiYgb3ZlclRvcCA8PSAwICkgewoJCQkJCXBvc2l0aW9uLnRvcCA9IHdpdGhpbk9mZnNldDsKCQkJCS8vIGVsZW1lbnQgaXMgaW5pdGlhbGx5IG92ZXIgYm90aCB0b3AgYW5kIGJvdHRvbSBvZiB3aXRoaW4KCQkJCX0gZWxzZSB7CgkJCQkJaWYgKCBvdmVyVG9wID4gb3ZlckJvdHRvbSApIHsKCQkJCQkJcG9zaXRpb24udG9wID0gd2l0aGluT2Zmc2V0ICsgb3V0ZXJIZWlnaHQgLSBkYXRhLmNvbGxpc2lvbkhlaWdodDsKCQkJCQl9IGVsc2UgewoJCQkJCQlwb3NpdGlvbi50b3AgPSB3aXRoaW5PZmZzZXQ7CgkJCQkJfQoJCQkJfQoJCQkvLyB0b28gZmFyIHVwIC0+IGFsaWduIHdpdGggdG9wCgkJCX0gZWxzZSBpZiAoIG92ZXJUb3AgPiAwICkgewoJCQkJcG9zaXRpb24udG9wICs9IG92ZXJUb3A7CgkJCS8vIHRvbyBmYXIgZG93biAtPiBhbGlnbiB3aXRoIGJvdHRvbSBlZGdlCgkJCX0gZWxzZSBpZiAoIG92ZXJCb3R0b20gPiAwICkgewoJCQkJcG9zaXRpb24udG9wIC09IG92ZXJCb3R0b207CgkJCS8vIGFkanVzdCBiYXNlZCBvbiBwb3NpdGlvbiBhbmQgbWFyZ2luCgkJCX0gZWxzZSB7CgkJCQlwb3NpdGlvbi50b3AgPSBtYXgoIHBvc2l0aW9uLnRvcCAtIGNvbGxpc2lvblBvc1RvcCwgcG9zaXRpb24udG9wICk7CgkJCX0KCQl9Cgl9LAoJZmxpcDogewoJCWxlZnQ6IGZ1bmN0aW9uKCBwb3NpdGlvbiwgZGF0YSApIHsKCQkJdmFyIHdpdGhpbiA9IGRhdGEud2l0aGluLAoJCQkJd2l0aGluT2Zmc2V0ID0gd2l0aGluLm9mZnNldC5sZWZ0ICsgd2l0aGluLnNjcm9sbExlZnQsCgkJCQlvdXRlcldpZHRoID0gd2l0aGluLndpZHRoLAoJCQkJb2Zmc2V0TGVmdCA9IHdpdGhpbi5pc1dpbmRvdyA/IHdpdGhpbi5zY3JvbGxMZWZ0IDogd2l0aGluLm9mZnNldC5sZWZ0LAoJCQkJY29sbGlzaW9uUG9zTGVmdCA9IHBvc2l0aW9uLmxlZnQgLSBkYXRhLmNvbGxpc2lvblBvc2l0aW9uLm1hcmdpbkxlZnQsCgkJCQlvdmVyTGVmdCA9IGNvbGxpc2lvblBvc0xlZnQgLSBvZmZzZXRMZWZ0LAoJCQkJb3ZlclJpZ2h0ID0gY29sbGlzaW9uUG9zTGVmdCArIGRhdGEuY29sbGlzaW9uV2lkdGggLSBvdXRlcldpZHRoIC0gb2Zmc2V0TGVmdCwKCQkJCW15T2Zmc2V0ID0gZGF0YS5teVsgMCBdID09PSAibGVmdCIgPwoJCQkJCS1kYXRhLmVsZW1XaWR0aCA6CgkJCQkJZGF0YS5teVsgMCBdID09PSAicmlnaHQiID8KCQkJCQkJZGF0YS5lbGVtV2lkdGggOgoJCQkJCQkwLAoJCQkJYXRPZmZzZXQgPSBkYXRhLmF0WyAwIF0gPT09ICJsZWZ0IiA/CgkJCQkJZGF0YS50YXJnZXRXaWR0aCA6CgkJCQkJZGF0YS5hdFsgMCBdID09PSAicmlnaHQiID8KCQkJCQkJLWRhdGEudGFyZ2V0V2lkdGggOgoJCQkJCQkwLAoJCQkJb2Zmc2V0ID0gLTIgKiBkYXRhLm9mZnNldFsgMCBdLAoJCQkJbmV3T3ZlclJpZ2h0LAoJCQkJbmV3T3ZlckxlZnQ7CgoJCQlpZiAoIG92ZXJMZWZ0IDwgMCApIHsKCQkJCW5ld092ZXJSaWdodCA9IHBvc2l0aW9uLmxlZnQgKyBteU9mZnNldCArIGF0T2Zmc2V0ICsgb2Zmc2V0ICsgZGF0YS5jb2xsaXNpb25XaWR0aCAtIG91dGVyV2lkdGggLSB3aXRoaW5PZmZzZXQ7CgkJCQlpZiAoIG5ld092ZXJSaWdodCA8IDAgfHwgbmV3T3ZlclJpZ2h0IDwgYWJzKCBvdmVyTGVmdCApICkgewoJCQkJCXBvc2l0aW9uLmxlZnQgKz0gbXlPZmZzZXQgKyBhdE9mZnNldCArIG9mZnNldDsKCQkJCX0KCQkJfSBlbHNlIGlmICggb3ZlclJpZ2h0ID4gMCApIHsKCQkJCW5ld092ZXJMZWZ0ID0gcG9zaXRpb24ubGVmdCAtIGRhdGEuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luTGVmdCArIG15T2Zmc2V0ICsgYXRPZmZzZXQgKyBvZmZzZXQgLSBvZmZzZXRMZWZ0OwoJCQkJaWYgKCBuZXdPdmVyTGVmdCA+IDAgfHwgYWJzKCBuZXdPdmVyTGVmdCApIDwgb3ZlclJpZ2h0ICkgewoJCQkJCXBvc2l0aW9uLmxlZnQgKz0gbXlPZmZzZXQgKyBhdE9mZnNldCArIG9mZnNldDsKCQkJCX0KCQkJfQoJCX0sCgkJdG9wOiBmdW5jdGlvbiggcG9zaXRpb24sIGRhdGEgKSB7CgkJCXZhciB3aXRoaW4gPSBkYXRhLndpdGhpbiwKCQkJCXdpdGhpbk9mZnNldCA9IHdpdGhpbi5vZmZzZXQudG9wICsgd2l0aGluLnNjcm9sbFRvcCwKCQkJCW91dGVySGVpZ2h0ID0gd2l0aGluLmhlaWdodCwKCQkJCW9mZnNldFRvcCA9IHdpdGhpbi5pc1dpbmRvdyA/IHdpdGhpbi5zY3JvbGxUb3AgOiB3aXRoaW4ub2Zmc2V0LnRvcCwKCQkJCWNvbGxpc2lvblBvc1RvcCA9IHBvc2l0aW9uLnRvcCAtIGRhdGEuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luVG9wLAoJCQkJb3ZlclRvcCA9IGNvbGxpc2lvblBvc1RvcCAtIG9mZnNldFRvcCwKCQkJCW92ZXJCb3R0b20gPSBjb2xsaXNpb25Qb3NUb3AgKyBkYXRhLmNvbGxpc2lvbkhlaWdodCAtIG91dGVySGVpZ2h0IC0gb2Zmc2V0VG9wLAoJCQkJdG9wID0gZGF0YS5teVsgMSBdID09PSAidG9wIiwKCQkJCW15T2Zmc2V0ID0gdG9wID8KCQkJCQktZGF0YS5lbGVtSGVpZ2h0IDoKCQkJCQlkYXRhLm15WyAxIF0gPT09ICJib3R0b20iID8KCQkJCQkJZGF0YS5lbGVtSGVpZ2h0IDoKCQkJCQkJMCwKCQkJCWF0T2Zmc2V0ID0gZGF0YS5hdFsgMSBdID09PSAidG9wIiA/CgkJCQkJZGF0YS50YXJnZXRIZWlnaHQgOgoJCQkJCWRhdGEuYXRbIDEgXSA9PT0gImJvdHRvbSIgPwoJCQkJCQktZGF0YS50YXJnZXRIZWlnaHQgOgoJCQkJCQkwLAoJCQkJb2Zmc2V0ID0gLTIgKiBkYXRhLm9mZnNldFsgMSBdLAoJCQkJbmV3T3ZlclRvcCwKCQkJCW5ld092ZXJCb3R0b207CgkJCWlmICggb3ZlclRvcCA8IDAgKSB7CgkJCQluZXdPdmVyQm90dG9tID0gcG9zaXRpb24udG9wICsgbXlPZmZzZXQgKyBhdE9mZnNldCArIG9mZnNldCArIGRhdGEuY29sbGlzaW9uSGVpZ2h0IC0gb3V0ZXJIZWlnaHQgLSB3aXRoaW5PZmZzZXQ7CgkJCQlpZiAoICggcG9zaXRpb24udG9wICsgbXlPZmZzZXQgKyBhdE9mZnNldCArIG9mZnNldCkgPiBvdmVyVG9wICYmICggbmV3T3ZlckJvdHRvbSA8IDAgfHwgbmV3T3ZlckJvdHRvbSA8IGFicyggb3ZlclRvcCApICkgKSB7CgkJCQkJcG9zaXRpb24udG9wICs9IG15T2Zmc2V0ICsgYXRPZmZzZXQgKyBvZmZzZXQ7CgkJCQl9CgkJCX0gZWxzZSBpZiAoIG92ZXJCb3R0b20gPiAwICkgewoJCQkJbmV3T3ZlclRvcCA9IHBvc2l0aW9uLnRvcCAtIGRhdGEuY29sbGlzaW9uUG9zaXRpb24ubWFyZ2luVG9wICsgbXlPZmZzZXQgKyBhdE9mZnNldCArIG9mZnNldCAtIG9mZnNldFRvcDsKCQkJCWlmICggKCBwb3NpdGlvbi50b3AgKyBteU9mZnNldCArIGF0T2Zmc2V0ICsgb2Zmc2V0KSA+IG92ZXJCb3R0b20gJiYgKCBuZXdPdmVyVG9wID4gMCB8fCBhYnMoIG5ld092ZXJUb3AgKSA8IG92ZXJCb3R0b20gKSApIHsKCQkJCQlwb3NpdGlvbi50b3AgKz0gbXlPZmZzZXQgKyBhdE9mZnNldCArIG9mZnNldDsKCQkJCX0KCQkJfQoJCX0KCX0sCglmbGlwZml0OiB7CgkJbGVmdDogZnVuY3Rpb24oKSB7CgkJCSQudWkucG9zaXRpb24uZmxpcC5sZWZ0LmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJJC51aS5wb3NpdGlvbi5maXQubGVmdC5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJfSwKCQl0b3A6IGZ1bmN0aW9uKCkgewoJCQkkLnVpLnBvc2l0aW9uLmZsaXAudG9wLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJJC51aS5wb3NpdGlvbi5maXQudG9wLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQl9Cgl9Cn07CgovLyBmcmFjdGlvbiBzdXBwb3J0IHRlc3QKKGZ1bmN0aW9uKCkgewoJdmFyIHRlc3RFbGVtZW50LCB0ZXN0RWxlbWVudFBhcmVudCwgdGVzdEVsZW1lbnRTdHlsZSwgb2Zmc2V0TGVmdCwgaSwKCQlib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoICJib2R5IiApWyAwIF0sCgkJZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKTsKCgkvL0NyZWF0ZSBhICJmYWtlIGJvZHkiIGZvciB0ZXN0aW5nIGJhc2VkIG9uIG1ldGhvZCB1c2VkIGluIGpRdWVyeS5zdXBwb3J0Cgl0ZXN0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIGJvZHkgPyAiZGl2IiA6ICJib2R5IiApOwoJdGVzdEVsZW1lbnRTdHlsZSA9IHsKCQl2aXNpYmlsaXR5OiAiaGlkZGVuIiwKCQl3aWR0aDogMCwKCQloZWlnaHQ6IDAsCgkJYm9yZGVyOiAwLAoJCW1hcmdpbjogMCwKCQliYWNrZ3JvdW5kOiAibm9uZSIKCX07CglpZiAoIGJvZHkgKSB7CgkJJC5leHRlbmQoIHRlc3RFbGVtZW50U3R5bGUsIHsKCQkJcG9zaXRpb246ICJhYnNvbHV0ZSIsCgkJCWxlZnQ6ICItMTAwMHB4IiwKCQkJdG9wOiAiLTEwMDBweCIKCQl9KTsKCX0KCWZvciAoIGkgaW4gdGVzdEVsZW1lbnRTdHlsZSApIHsKCQl0ZXN0RWxlbWVudC5zdHlsZVsgaSBdID0gdGVzdEVsZW1lbnRTdHlsZVsgaSBdOwoJfQoJdGVzdEVsZW1lbnQuYXBwZW5kQ2hpbGQoIGRpdiApOwoJdGVzdEVsZW1lbnRQYXJlbnQgPSBib2R5IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCXRlc3RFbGVtZW50UGFyZW50Lmluc2VydEJlZm9yZSggdGVzdEVsZW1lbnQsIHRlc3RFbGVtZW50UGFyZW50LmZpcnN0Q2hpbGQgKTsKCglkaXYuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IDEwLjc0MzIyMjJweDsiOwoKCW9mZnNldExlZnQgPSAkKCBkaXYgKS5vZmZzZXQoKS5sZWZ0OwoJc3VwcG9ydHNPZmZzZXRGcmFjdGlvbnMgPSBvZmZzZXRMZWZ0ID4gMTAgJiYgb2Zmc2V0TGVmdCA8IDExOwoKCXRlc3RFbGVtZW50LmlubmVySFRNTCA9ICIiOwoJdGVzdEVsZW1lbnRQYXJlbnQucmVtb3ZlQ2hpbGQoIHRlc3RFbGVtZW50ICk7Cn0pKCk7Cgp9KSgpOwoKdmFyIHBvc2l0aW9uID0gJC51aS5wb3NpdGlvbjsKCgovKiEKICogalF1ZXJ5IFVJIEFjY29yZGlvbiAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9hY2NvcmRpb24vCiAqLwoKCnZhciBhY2NvcmRpb24gPSAkLndpZGdldCggInVpLmFjY29yZGlvbiIsIHsKCXZlcnNpb246ICIxLjExLjEiLAoJb3B0aW9uczogewoJCWFjdGl2ZTogMCwKCQlhbmltYXRlOiB7fSwKCQljb2xsYXBzaWJsZTogZmFsc2UsCgkJZXZlbnQ6ICJjbGljayIsCgkJaGVhZGVyOiAiPiBsaSA+IDpmaXJzdC1jaGlsZCw+IDpub3QobGkpOmV2ZW4iLAoJCWhlaWdodFN0eWxlOiAiYXV0byIsCgkJaWNvbnM6IHsKCQkJYWN0aXZlSGVhZGVyOiAidWktaWNvbi10cmlhbmdsZS0xLXMiLAoJCQloZWFkZXI6ICJ1aS1pY29uLXRyaWFuZ2xlLTEtZSIKCQl9LAoKCQkvLyBjYWxsYmFja3MKCQlhY3RpdmF0ZTogbnVsbCwKCQliZWZvcmVBY3RpdmF0ZTogbnVsbAoJfSwKCgloaWRlUHJvcHM6IHsKCQlib3JkZXJUb3BXaWR0aDogImhpZGUiLAoJCWJvcmRlckJvdHRvbVdpZHRoOiAiaGlkZSIsCgkJcGFkZGluZ1RvcDogImhpZGUiLAoJCXBhZGRpbmdCb3R0b206ICJoaWRlIiwKCQloZWlnaHQ6ICJoaWRlIgoJfSwKCglzaG93UHJvcHM6IHsKCQlib3JkZXJUb3BXaWR0aDogInNob3ciLAoJCWJvcmRlckJvdHRvbVdpZHRoOiAic2hvdyIsCgkJcGFkZGluZ1RvcDogInNob3ciLAoJCXBhZGRpbmdCb3R0b206ICJzaG93IiwKCQloZWlnaHQ6ICJzaG93IgoJfSwKCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCQl2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKCQl0aGlzLnByZXZTaG93ID0gdGhpcy5wcmV2SGlkZSA9ICQoKTsKCQl0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoICJ1aS1hY2NvcmRpb24gdWktd2lkZ2V0IHVpLWhlbHBlci1yZXNldCIgKQoJCQkvLyBBUklBCgkJCS5hdHRyKCAicm9sZSIsICJ0YWJsaXN0IiApOwoKCQkvLyBkb24ndCBhbGxvdyBjb2xsYXBzaWJsZTogZmFsc2UgYW5kIGFjdGl2ZTogZmFsc2UgLyBudWxsCgkJaWYgKCAhb3B0aW9ucy5jb2xsYXBzaWJsZSAmJiAob3B0aW9ucy5hY3RpdmUgPT09IGZhbHNlIHx8IG9wdGlvbnMuYWN0aXZlID09IG51bGwpICkgewoJCQlvcHRpb25zLmFjdGl2ZSA9IDA7CgkJfQoKCQl0aGlzLl9wcm9jZXNzUGFuZWxzKCk7CgkJLy8gaGFuZGxlIG5lZ2F0aXZlIHZhbHVlcwoJCWlmICggb3B0aW9ucy5hY3RpdmUgPCAwICkgewoJCQlvcHRpb25zLmFjdGl2ZSArPSB0aGlzLmhlYWRlcnMubGVuZ3RoOwoJCX0KCQl0aGlzLl9yZWZyZXNoKCk7Cgl9LAoKCV9nZXRDcmVhdGVFdmVudERhdGE6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB7CgkJCWhlYWRlcjogdGhpcy5hY3RpdmUsCgkJCXBhbmVsOiAhdGhpcy5hY3RpdmUubGVuZ3RoID8gJCgpIDogdGhpcy5hY3RpdmUubmV4dCgpCgkJfTsKCX0sCgoJX2NyZWF0ZUljb25zOiBmdW5jdGlvbigpIHsKCQl2YXIgaWNvbnMgPSB0aGlzLm9wdGlvbnMuaWNvbnM7CgkJaWYgKCBpY29ucyApIHsKCQkJJCggIjxzcGFuPiIgKQoJCQkJLmFkZENsYXNzKCAidWktYWNjb3JkaW9uLWhlYWRlci1pY29uIHVpLWljb24gIiArIGljb25zLmhlYWRlciApCgkJCQkucHJlcGVuZFRvKCB0aGlzLmhlYWRlcnMgKTsKCQkJdGhpcy5hY3RpdmUuY2hpbGRyZW4oICIudWktYWNjb3JkaW9uLWhlYWRlci1pY29uIiApCgkJCQkucmVtb3ZlQ2xhc3MoIGljb25zLmhlYWRlciApCgkJCQkuYWRkQ2xhc3MoIGljb25zLmFjdGl2ZUhlYWRlciApOwoJCQl0aGlzLmhlYWRlcnMuYWRkQ2xhc3MoICJ1aS1hY2NvcmRpb24taWNvbnMiICk7CgkJfQoJfSwKCglfZGVzdHJveUljb25zOiBmdW5jdGlvbigpIHsKCQl0aGlzLmhlYWRlcnMKCQkJLnJlbW92ZUNsYXNzKCAidWktYWNjb3JkaW9uLWljb25zIiApCgkJCS5jaGlsZHJlbiggIi51aS1hY2NvcmRpb24taGVhZGVyLWljb24iICkKCQkJCS5yZW1vdmUoKTsKCX0sCgoJX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCXZhciBjb250ZW50czsKCgkJLy8gY2xlYW4gdXAgbWFpbiBlbGVtZW50CgkJdGhpcy5lbGVtZW50CgkJCS5yZW1vdmVDbGFzcyggInVpLWFjY29yZGlvbiB1aS13aWRnZXQgdWktaGVscGVyLXJlc2V0IiApCgkJCS5yZW1vdmVBdHRyKCAicm9sZSIgKTsKCgkJLy8gY2xlYW4gdXAgaGVhZGVycwoJCXRoaXMuaGVhZGVycwoJCQkucmVtb3ZlQ2xhc3MoICJ1aS1hY2NvcmRpb24taGVhZGVyIHVpLWFjY29yZGlvbi1oZWFkZXItYWN0aXZlIHVpLXN0YXRlLWRlZmF1bHQgIiArCgkJCQkidWktY29ybmVyLWFsbCB1aS1zdGF0ZS1hY3RpdmUgdWktc3RhdGUtZGlzYWJsZWQgdWktY29ybmVyLXRvcCIgKQoJCQkucmVtb3ZlQXR0ciggInJvbGUiICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLWV4cGFuZGVkIiApCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS1zZWxlY3RlZCIgKQoJCQkucmVtb3ZlQXR0ciggImFyaWEtY29udHJvbHMiICkKCQkJLnJlbW92ZUF0dHIoICJ0YWJJbmRleCIgKQoJCQkucmVtb3ZlVW5pcXVlSWQoKTsKCgkJdGhpcy5fZGVzdHJveUljb25zKCk7CgoJCS8vIGNsZWFuIHVwIGNvbnRlbnQgcGFuZWxzCgkJY29udGVudHMgPSB0aGlzLmhlYWRlcnMubmV4dCgpCgkJCS5yZW1vdmVDbGFzcyggInVpLWhlbHBlci1yZXNldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tICIgKwoJCQkJInVpLWFjY29yZGlvbi1jb250ZW50IHVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSB1aS1zdGF0ZS1kaXNhYmxlZCIgKQoJCQkuY3NzKCAiZGlzcGxheSIsICIiICkKCQkJLnJlbW92ZUF0dHIoICJyb2xlIiApCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS1oaWRkZW4iICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLWxhYmVsbGVkYnkiICkKCQkJLnJlbW92ZVVuaXF1ZUlkKCk7CgoJCWlmICggdGhpcy5vcHRpb25zLmhlaWdodFN0eWxlICE9PSAiY29udGVudCIgKSB7CgkJCWNvbnRlbnRzLmNzcyggImhlaWdodCIsICIiICk7CgkJfQoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQlpZiAoIGtleSA9PT0gImFjdGl2ZSIgKSB7CgkJCS8vIF9hY3RpdmF0ZSgpIHdpbGwgaGFuZGxlIGludmFsaWQgdmFsdWVzIGFuZCB1cGRhdGUgdGhpcy5vcHRpb25zCgkJCXRoaXMuX2FjdGl2YXRlKCB2YWx1ZSApOwoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIGtleSA9PT0gImV2ZW50IiApIHsKCQkJaWYgKCB0aGlzLm9wdGlvbnMuZXZlbnQgKSB7CgkJCQl0aGlzLl9vZmYoIHRoaXMuaGVhZGVycywgdGhpcy5vcHRpb25zLmV2ZW50ICk7CgkJCX0KCQkJdGhpcy5fc2V0dXBFdmVudHMoIHZhbHVlICk7CgkJfQoKCQl0aGlzLl9zdXBlcigga2V5LCB2YWx1ZSApOwoKCQkvLyBzZXR0aW5nIGNvbGxhcHNpYmxlOiBmYWxzZSB3aGlsZSBjb2xsYXBzZWQ7IG9wZW4gZmlyc3QgcGFuZWwKCQlpZiAoIGtleSA9PT0gImNvbGxhcHNpYmxlIiAmJiAhdmFsdWUgJiYgdGhpcy5vcHRpb25zLmFjdGl2ZSA9PT0gZmFsc2UgKSB7CgkJCXRoaXMuX2FjdGl2YXRlKCAwICk7CgkJfQoKCQlpZiAoIGtleSA9PT0gImljb25zIiApIHsKCQkJdGhpcy5fZGVzdHJveUljb25zKCk7CgkJCWlmICggdmFsdWUgKSB7CgkJCQl0aGlzLl9jcmVhdGVJY29ucygpOwoJCQl9CgkJfQoKCQkvLyAjNTMzMiAtIG9wYWNpdHkgZG9lc24ndCBjYXNjYWRlIHRvIHBvc2l0aW9uZWQgZWxlbWVudHMgaW4gSUUKCQkvLyBzbyB3ZSBuZWVkIHRvIGFkZCB0aGUgZGlzYWJsZWQgY2xhc3MgdG8gdGhlIGhlYWRlcnMgYW5kIHBhbmVscwoJCWlmICgga2V5ID09PSAiZGlzYWJsZWQiICkgewoJCQl0aGlzLmVsZW1lbnQKCQkJCS50b2dnbGVDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiwgISF2YWx1ZSApCgkJCQkuYXR0ciggImFyaWEtZGlzYWJsZWQiLCB2YWx1ZSApOwoJCQl0aGlzLmhlYWRlcnMuYWRkKCB0aGlzLmhlYWRlcnMubmV4dCgpICkKCQkJCS50b2dnbGVDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiwgISF2YWx1ZSApOwoJCX0KCX0sCgoJX2tleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQlpZiAoIGV2ZW50LmFsdEtleSB8fCBldmVudC5jdHJsS2V5ICkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIga2V5Q29kZSA9ICQudWkua2V5Q29kZSwKCQkJbGVuZ3RoID0gdGhpcy5oZWFkZXJzLmxlbmd0aCwKCQkJY3VycmVudEluZGV4ID0gdGhpcy5oZWFkZXJzLmluZGV4KCBldmVudC50YXJnZXQgKSwKCQkJdG9Gb2N1cyA9IGZhbHNlOwoKCQlzd2l0Y2ggKCBldmVudC5rZXlDb2RlICkgewoJCQljYXNlIGtleUNvZGUuUklHSFQ6CgkJCWNhc2Uga2V5Q29kZS5ET1dOOgoJCQkJdG9Gb2N1cyA9IHRoaXMuaGVhZGVyc1sgKCBjdXJyZW50SW5kZXggKyAxICkgJSBsZW5ndGggXTsKCQkJCWJyZWFrOwoJCQljYXNlIGtleUNvZGUuTEVGVDoKCQkJY2FzZSBrZXlDb2RlLlVQOgoJCQkJdG9Gb2N1cyA9IHRoaXMuaGVhZGVyc1sgKCBjdXJyZW50SW5kZXggLSAxICsgbGVuZ3RoICkgJSBsZW5ndGggXTsKCQkJCWJyZWFrOwoJCQljYXNlIGtleUNvZGUuU1BBQ0U6CgkJCWNhc2Uga2V5Q29kZS5FTlRFUjoKCQkJCXRoaXMuX2V2ZW50SGFuZGxlciggZXZlbnQgKTsKCQkJCWJyZWFrOwoJCQljYXNlIGtleUNvZGUuSE9NRToKCQkJCXRvRm9jdXMgPSB0aGlzLmhlYWRlcnNbIDAgXTsKCQkJCWJyZWFrOwoJCQljYXNlIGtleUNvZGUuRU5EOgoJCQkJdG9Gb2N1cyA9IHRoaXMuaGVhZGVyc1sgbGVuZ3RoIC0gMSBdOwoJCQkJYnJlYWs7CgkJfQoKCQlpZiAoIHRvRm9jdXMgKSB7CgkJCSQoIGV2ZW50LnRhcmdldCApLmF0dHIoICJ0YWJJbmRleCIsIC0xICk7CgkJCSQoIHRvRm9jdXMgKS5hdHRyKCAidGFiSW5kZXgiLCAwICk7CgkJCXRvRm9jdXMuZm9jdXMoKTsKCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQl9Cgl9LAoKCV9wYW5lbEtleURvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQlpZiAoIGV2ZW50LmtleUNvZGUgPT09ICQudWkua2V5Q29kZS5VUCAmJiBldmVudC5jdHJsS2V5ICkgewoJCQkkKCBldmVudC5jdXJyZW50VGFyZ2V0ICkucHJldigpLmZvY3VzKCk7CgkJfQoJfSwKCglyZWZyZXNoOiBmdW5jdGlvbigpIHsKCQl2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKCQl0aGlzLl9wcm9jZXNzUGFuZWxzKCk7CgoJCS8vIHdhcyBjb2xsYXBzZWQgb3Igbm8gcGFuZWwKCQlpZiAoICggb3B0aW9ucy5hY3RpdmUgPT09IGZhbHNlICYmIG9wdGlvbnMuY29sbGFwc2libGUgPT09IHRydWUgKSB8fCAhdGhpcy5oZWFkZXJzLmxlbmd0aCApIHsKCQkJb3B0aW9ucy5hY3RpdmUgPSBmYWxzZTsKCQkJdGhpcy5hY3RpdmUgPSAkKCk7CgkJLy8gYWN0aXZlIGZhbHNlIG9ubHkgd2hlbiBjb2xsYXBzaWJsZSBpcyB0cnVlCgkJfSBlbHNlIGlmICggb3B0aW9ucy5hY3RpdmUgPT09IGZhbHNlICkgewoJCQl0aGlzLl9hY3RpdmF0ZSggMCApOwoJCS8vIHdhcyBhY3RpdmUsIGJ1dCBhY3RpdmUgcGFuZWwgaXMgZ29uZQoJCX0gZWxzZSBpZiAoIHRoaXMuYWN0aXZlLmxlbmd0aCAmJiAhJC5jb250YWlucyggdGhpcy5lbGVtZW50WyAwIF0sIHRoaXMuYWN0aXZlWyAwIF0gKSApIHsKCQkJLy8gYWxsIHJlbWFpbmluZyBwYW5lbCBhcmUgZGlzYWJsZWQKCQkJaWYgKCB0aGlzLmhlYWRlcnMubGVuZ3RoID09PSB0aGlzLmhlYWRlcnMuZmluZCgiLnVpLXN0YXRlLWRpc2FibGVkIikubGVuZ3RoICkgewoJCQkJb3B0aW9ucy5hY3RpdmUgPSBmYWxzZTsKCQkJCXRoaXMuYWN0aXZlID0gJCgpOwoJCQkvLyBhY3RpdmF0ZSBwcmV2aW91cyBwYW5lbAoJCQl9IGVsc2UgewoJCQkJdGhpcy5fYWN0aXZhdGUoIE1hdGgubWF4KCAwLCBvcHRpb25zLmFjdGl2ZSAtIDEgKSApOwoJCQl9CgkJLy8gd2FzIGFjdGl2ZSwgYWN0aXZlIHBhbmVsIHN0aWxsIGV4aXN0cwoJCX0gZWxzZSB7CgkJCS8vIG1ha2Ugc3VyZSBhY3RpdmUgaW5kZXggaXMgY29ycmVjdAoJCQlvcHRpb25zLmFjdGl2ZSA9IHRoaXMuaGVhZGVycy5pbmRleCggdGhpcy5hY3RpdmUgKTsKCQl9CgoJCXRoaXMuX2Rlc3Ryb3lJY29ucygpOwoKCQl0aGlzLl9yZWZyZXNoKCk7Cgl9LAoKCV9wcm9jZXNzUGFuZWxzOiBmdW5jdGlvbigpIHsKCQl0aGlzLmhlYWRlcnMgPSB0aGlzLmVsZW1lbnQuZmluZCggdGhpcy5vcHRpb25zLmhlYWRlciApCgkJCS5hZGRDbGFzcyggInVpLWFjY29yZGlvbi1oZWFkZXIgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIiApOwoKCQl0aGlzLmhlYWRlcnMubmV4dCgpCgkJCS5hZGRDbGFzcyggInVpLWFjY29yZGlvbi1jb250ZW50IHVpLWhlbHBlci1yZXNldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tIiApCgkJCS5maWx0ZXIoICI6bm90KC51aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUpIiApCgkJCS5oaWRlKCk7Cgl9LAoKCV9yZWZyZXNoOiBmdW5jdGlvbigpIHsKCQl2YXIgbWF4SGVpZ2h0LAoJCQlvcHRpb25zID0gdGhpcy5vcHRpb25zLAoJCQloZWlnaHRTdHlsZSA9IG9wdGlvbnMuaGVpZ2h0U3R5bGUsCgkJCXBhcmVudCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoKTsKCgkJdGhpcy5hY3RpdmUgPSB0aGlzLl9maW5kQWN0aXZlKCBvcHRpb25zLmFjdGl2ZSApCgkJCS5hZGRDbGFzcyggInVpLWFjY29yZGlvbi1oZWFkZXItYWN0aXZlIHVpLXN0YXRlLWFjdGl2ZSB1aS1jb3JuZXItdG9wIiApCgkJCS5yZW1vdmVDbGFzcyggInVpLWNvcm5lci1hbGwiICk7CgkJdGhpcy5hY3RpdmUubmV4dCgpCgkJCS5hZGRDbGFzcyggInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSIgKQoJCQkuc2hvdygpOwoKCQl0aGlzLmhlYWRlcnMKCQkJLmF0dHIoICJyb2xlIiwgInRhYiIgKQoJCQkuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBoZWFkZXIgPSAkKCB0aGlzICksCgkJCQkJaGVhZGVySWQgPSBoZWFkZXIudW5pcXVlSWQoKS5hdHRyKCAiaWQiICksCgkJCQkJcGFuZWwgPSBoZWFkZXIubmV4dCgpLAoJCQkJCXBhbmVsSWQgPSBwYW5lbC51bmlxdWVJZCgpLmF0dHIoICJpZCIgKTsKCQkJCWhlYWRlci5hdHRyKCAiYXJpYS1jb250cm9scyIsIHBhbmVsSWQgKTsKCQkJCXBhbmVsLmF0dHIoICJhcmlhLWxhYmVsbGVkYnkiLCBoZWFkZXJJZCApOwoJCQl9KQoJCQkubmV4dCgpCgkJCQkuYXR0ciggInJvbGUiLCAidGFicGFuZWwiICk7CgoJCXRoaXMuaGVhZGVycwoJCQkubm90KCB0aGlzLmFjdGl2ZSApCgkJCS5hdHRyKHsKCQkJCSJhcmlhLXNlbGVjdGVkIjogImZhbHNlIiwKCQkJCSJhcmlhLWV4cGFuZGVkIjogImZhbHNlIiwKCQkJCXRhYkluZGV4OiAtMQoJCQl9KQoJCQkubmV4dCgpCgkJCQkuYXR0cih7CgkJCQkJImFyaWEtaGlkZGVuIjogInRydWUiCgkJCQl9KQoJCQkJLmhpZGUoKTsKCgkJLy8gbWFrZSBzdXJlIGF0IGxlYXN0IG9uZSBoZWFkZXIgaXMgaW4gdGhlIHRhYiBvcmRlcgoJCWlmICggIXRoaXMuYWN0aXZlLmxlbmd0aCApIHsKCQkJdGhpcy5oZWFkZXJzLmVxKCAwICkuYXR0ciggInRhYkluZGV4IiwgMCApOwoJCX0gZWxzZSB7CgkJCXRoaXMuYWN0aXZlLmF0dHIoewoJCQkJImFyaWEtc2VsZWN0ZWQiOiAidHJ1ZSIsCgkJCQkiYXJpYS1leHBhbmRlZCI6ICJ0cnVlIiwKCQkJCXRhYkluZGV4OiAwCgkJCX0pCgkJCS5uZXh0KCkKCQkJCS5hdHRyKHsKCQkJCQkiYXJpYS1oaWRkZW4iOiAiZmFsc2UiCgkJCQl9KTsKCQl9CgoJCXRoaXMuX2NyZWF0ZUljb25zKCk7CgoJCXRoaXMuX3NldHVwRXZlbnRzKCBvcHRpb25zLmV2ZW50ICk7CgoJCWlmICggaGVpZ2h0U3R5bGUgPT09ICJmaWxsIiApIHsKCQkJbWF4SGVpZ2h0ID0gcGFyZW50LmhlaWdodCgpOwoJCQl0aGlzLmVsZW1lbnQuc2libGluZ3MoICI6dmlzaWJsZSIgKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJdmFyIGVsZW0gPSAkKCB0aGlzICksCgkJCQkJcG9zaXRpb24gPSBlbGVtLmNzcyggInBvc2l0aW9uIiApOwoKCQkJCWlmICggcG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgfHwgcG9zaXRpb24gPT09ICJmaXhlZCIgKSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJbWF4SGVpZ2h0IC09IGVsZW0ub3V0ZXJIZWlnaHQoIHRydWUgKTsKCQkJfSk7CgoJCQl0aGlzLmhlYWRlcnMuZWFjaChmdW5jdGlvbigpIHsKCQkJCW1heEhlaWdodCAtPSAkKCB0aGlzICkub3V0ZXJIZWlnaHQoIHRydWUgKTsKCQkJfSk7CgoJCQl0aGlzLmhlYWRlcnMubmV4dCgpCgkJCQkuZWFjaChmdW5jdGlvbigpIHsKCQkJCQkkKCB0aGlzICkuaGVpZ2h0KCBNYXRoLm1heCggMCwgbWF4SGVpZ2h0IC0KCQkJCQkJJCggdGhpcyApLmlubmVySGVpZ2h0KCkgKyAkKCB0aGlzICkuaGVpZ2h0KCkgKSApOwoJCQkJfSkKCQkJCS5jc3MoICJvdmVyZmxvdyIsICJhdXRvIiApOwoJCX0gZWxzZSBpZiAoIGhlaWdodFN0eWxlID09PSAiYXV0byIgKSB7CgkJCW1heEhlaWdodCA9IDA7CgkJCXRoaXMuaGVhZGVycy5uZXh0KCkKCQkJCS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJCW1heEhlaWdodCA9IE1hdGgubWF4KCBtYXhIZWlnaHQsICQoIHRoaXMgKS5jc3MoICJoZWlnaHQiLCAiIiApLmhlaWdodCgpICk7CgkJCQl9KQoJCQkJLmhlaWdodCggbWF4SGVpZ2h0ICk7CgkJfQoJfSwKCglfYWN0aXZhdGU6IGZ1bmN0aW9uKCBpbmRleCApIHsKCQl2YXIgYWN0aXZlID0gdGhpcy5fZmluZEFjdGl2ZSggaW5kZXggKVsgMCBdOwoKCQkvLyB0cnlpbmcgdG8gYWN0aXZhdGUgdGhlIGFscmVhZHkgYWN0aXZlIHBhbmVsCgkJaWYgKCBhY3RpdmUgPT09IHRoaXMuYWN0aXZlWyAwIF0gKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIHRyeWluZyB0byBjb2xsYXBzZSwgc2ltdWxhdGUgYSBjbGljayBvbiB0aGUgY3VycmVudGx5IGFjdGl2ZSBoZWFkZXIKCQlhY3RpdmUgPSBhY3RpdmUgfHwgdGhpcy5hY3RpdmVbIDAgXTsKCgkJdGhpcy5fZXZlbnRIYW5kbGVyKHsKCQkJdGFyZ2V0OiBhY3RpdmUsCgkJCWN1cnJlbnRUYXJnZXQ6IGFjdGl2ZSwKCQkJcHJldmVudERlZmF1bHQ6ICQubm9vcAoJCX0pOwoJfSwKCglfZmluZEFjdGl2ZTogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0eXBlb2Ygc2VsZWN0b3IgPT09ICJudW1iZXIiID8gdGhpcy5oZWFkZXJzLmVxKCBzZWxlY3RvciApIDogJCgpOwoJfSwKCglfc2V0dXBFdmVudHM6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgZXZlbnRzID0gewoJCQlrZXlkb3duOiAiX2tleWRvd24iCgkJfTsKCQlpZiAoIGV2ZW50ICkgewoJCQkkLmVhY2goIGV2ZW50LnNwbGl0KCAiICIgKSwgZnVuY3Rpb24oIGluZGV4LCBldmVudE5hbWUgKSB7CgkJCQlldmVudHNbIGV2ZW50TmFtZSBdID0gIl9ldmVudEhhbmRsZXIiOwoJCQl9KTsKCQl9CgoJCXRoaXMuX29mZiggdGhpcy5oZWFkZXJzLmFkZCggdGhpcy5oZWFkZXJzLm5leHQoKSApICk7CgkJdGhpcy5fb24oIHRoaXMuaGVhZGVycywgZXZlbnRzICk7CgkJdGhpcy5fb24oIHRoaXMuaGVhZGVycy5uZXh0KCksIHsga2V5ZG93bjogIl9wYW5lbEtleURvd24iIH0pOwoJCXRoaXMuX2hvdmVyYWJsZSggdGhpcy5oZWFkZXJzICk7CgkJdGhpcy5fZm9jdXNhYmxlKCB0aGlzLmhlYWRlcnMgKTsKCX0sCgoJX2V2ZW50SGFuZGxlcjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCXZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zLAoJCQlhY3RpdmUgPSB0aGlzLmFjdGl2ZSwKCQkJY2xpY2tlZCA9ICQoIGV2ZW50LmN1cnJlbnRUYXJnZXQgKSwKCQkJY2xpY2tlZElzQWN0aXZlID0gY2xpY2tlZFsgMCBdID09PSBhY3RpdmVbIDAgXSwKCQkJY29sbGFwc2luZyA9IGNsaWNrZWRJc0FjdGl2ZSAmJiBvcHRpb25zLmNvbGxhcHNpYmxlLAoJCQl0b1Nob3cgPSBjb2xsYXBzaW5nID8gJCgpIDogY2xpY2tlZC5uZXh0KCksCgkJCXRvSGlkZSA9IGFjdGl2ZS5uZXh0KCksCgkJCWV2ZW50RGF0YSA9IHsKCQkJCW9sZEhlYWRlcjogYWN0aXZlLAoJCQkJb2xkUGFuZWw6IHRvSGlkZSwKCQkJCW5ld0hlYWRlcjogY29sbGFwc2luZyA/ICQoKSA6IGNsaWNrZWQsCgkJCQluZXdQYW5lbDogdG9TaG93CgkJCX07CgoJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCWlmICgKCQkJCS8vIGNsaWNrIG9uIGFjdGl2ZSBoZWFkZXIsIGJ1dCBub3QgY29sbGFwc2libGUKCQkJCSggY2xpY2tlZElzQWN0aXZlICYmICFvcHRpb25zLmNvbGxhcHNpYmxlICkgfHwKCQkJCS8vIGFsbG93IGNhbmNlbGluZyBhY3RpdmF0aW9uCgkJCQkoIHRoaXMuX3RyaWdnZXIoICJiZWZvcmVBY3RpdmF0ZSIsIGV2ZW50LCBldmVudERhdGEgKSA9PT0gZmFsc2UgKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJb3B0aW9ucy5hY3RpdmUgPSBjb2xsYXBzaW5nID8gZmFsc2UgOiB0aGlzLmhlYWRlcnMuaW5kZXgoIGNsaWNrZWQgKTsKCgkJLy8gd2hlbiB0aGUgY2FsbCB0byAuX3RvZ2dsZSgpIGNvbWVzIGFmdGVyIHRoZSBjbGFzcyBjaGFuZ2VzCgkJLy8gaXQgY2F1c2VzIGEgdmVyeSBvZGQgYnVnIGluIElFIDggKHNlZSAjNjcyMCkKCQl0aGlzLmFjdGl2ZSA9IGNsaWNrZWRJc0FjdGl2ZSA/ICQoKSA6IGNsaWNrZWQ7CgkJdGhpcy5fdG9nZ2xlKCBldmVudERhdGEgKTsKCgkJLy8gc3dpdGNoIGNsYXNzZXMKCQkvLyBjb3JuZXIgY2xhc3NlcyBvbiB0aGUgcHJldmlvdXNseSBhY3RpdmUgaGVhZGVyIHN0YXkgYWZ0ZXIgdGhlIGFuaW1hdGlvbgoJCWFjdGl2ZS5yZW1vdmVDbGFzcyggInVpLWFjY29yZGlvbi1oZWFkZXItYWN0aXZlIHVpLXN0YXRlLWFjdGl2ZSIgKTsKCQlpZiAoIG9wdGlvbnMuaWNvbnMgKSB7CgkJCWFjdGl2ZS5jaGlsZHJlbiggIi51aS1hY2NvcmRpb24taGVhZGVyLWljb24iICkKCQkJCS5yZW1vdmVDbGFzcyggb3B0aW9ucy5pY29ucy5hY3RpdmVIZWFkZXIgKQoJCQkJLmFkZENsYXNzKCBvcHRpb25zLmljb25zLmhlYWRlciApOwoJCX0KCgkJaWYgKCAhY2xpY2tlZElzQWN0aXZlICkgewoJCQljbGlja2VkCgkJCQkucmVtb3ZlQ2xhc3MoICJ1aS1jb3JuZXItYWxsIiApCgkJCQkuYWRkQ2xhc3MoICJ1aS1hY2NvcmRpb24taGVhZGVyLWFjdGl2ZSB1aS1zdGF0ZS1hY3RpdmUgdWktY29ybmVyLXRvcCIgKTsKCQkJaWYgKCBvcHRpb25zLmljb25zICkgewoJCQkJY2xpY2tlZC5jaGlsZHJlbiggIi51aS1hY2NvcmRpb24taGVhZGVyLWljb24iICkKCQkJCQkucmVtb3ZlQ2xhc3MoIG9wdGlvbnMuaWNvbnMuaGVhZGVyICkKCQkJCQkuYWRkQ2xhc3MoIG9wdGlvbnMuaWNvbnMuYWN0aXZlSGVhZGVyICk7CgkJCX0KCgkJCWNsaWNrZWQKCQkJCS5uZXh0KCkKCQkJCS5hZGRDbGFzcyggInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSIgKTsKCQl9Cgl9LAoKCV90b2dnbGU6IGZ1bmN0aW9uKCBkYXRhICkgewoJCXZhciB0b1Nob3cgPSBkYXRhLm5ld1BhbmVsLAoJCQl0b0hpZGUgPSB0aGlzLnByZXZTaG93Lmxlbmd0aCA/IHRoaXMucHJldlNob3cgOiBkYXRhLm9sZFBhbmVsOwoKCQkvLyBoYW5kbGUgYWN0aXZhdGluZyBhIHBhbmVsIGR1cmluZyB0aGUgYW5pbWF0aW9uIGZvciBhbm90aGVyIGFjdGl2YXRpb24KCQl0aGlzLnByZXZTaG93LmFkZCggdGhpcy5wcmV2SGlkZSApLnN0b3AoIHRydWUsIHRydWUgKTsKCQl0aGlzLnByZXZTaG93ID0gdG9TaG93OwoJCXRoaXMucHJldkhpZGUgPSB0b0hpZGU7CgoJCWlmICggdGhpcy5vcHRpb25zLmFuaW1hdGUgKSB7CgkJCXRoaXMuX2FuaW1hdGUoIHRvU2hvdywgdG9IaWRlLCBkYXRhICk7CgkJfSBlbHNlIHsKCQkJdG9IaWRlLmhpZGUoKTsKCQkJdG9TaG93LnNob3coKTsKCQkJdGhpcy5fdG9nZ2xlQ29tcGxldGUoIGRhdGEgKTsKCQl9CgoJCXRvSGlkZS5hdHRyKHsKCQkJImFyaWEtaGlkZGVuIjogInRydWUiCgkJfSk7CgkJdG9IaWRlLnByZXYoKS5hdHRyKCAiYXJpYS1zZWxlY3RlZCIsICJmYWxzZSIgKTsKCQkvLyBpZiB3ZSdyZSBzd2l0Y2hpbmcgcGFuZWxzLCByZW1vdmUgdGhlIG9sZCBoZWFkZXIgZnJvbSB0aGUgdGFiIG9yZGVyCgkJLy8gaWYgd2UncmUgb3BlbmluZyBmcm9tIGNvbGxhcHNlZCBzdGF0ZSwgcmVtb3ZlIHRoZSBwcmV2aW91cyBoZWFkZXIgZnJvbSB0aGUgdGFiIG9yZGVyCgkJLy8gaWYgd2UncmUgY29sbGFwc2luZywgdGhlbiBrZWVwIHRoZSBjb2xsYXBzaW5nIGhlYWRlciBpbiB0aGUgdGFiIG9yZGVyCgkJaWYgKCB0b1Nob3cubGVuZ3RoICYmIHRvSGlkZS5sZW5ndGggKSB7CgkJCXRvSGlkZS5wcmV2KCkuYXR0cih7CgkJCQkidGFiSW5kZXgiOiAtMSwKCQkJCSJhcmlhLWV4cGFuZGVkIjogImZhbHNlIgoJCQl9KTsKCQl9IGVsc2UgaWYgKCB0b1Nob3cubGVuZ3RoICkgewoJCQl0aGlzLmhlYWRlcnMuZmlsdGVyKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICQoIHRoaXMgKS5hdHRyKCAidGFiSW5kZXgiICkgPT09IDA7CgkJCX0pCgkJCS5hdHRyKCAidGFiSW5kZXgiLCAtMSApOwoJCX0KCgkJdG9TaG93CgkJCS5hdHRyKCAiYXJpYS1oaWRkZW4iLCAiZmFsc2UiICkKCQkJLnByZXYoKQoJCQkJLmF0dHIoewoJCQkJCSJhcmlhLXNlbGVjdGVkIjogInRydWUiLAoJCQkJCXRhYkluZGV4OiAwLAoJCQkJCSJhcmlhLWV4cGFuZGVkIjogInRydWUiCgkJCQl9KTsKCX0sCgoJX2FuaW1hdGU6IGZ1bmN0aW9uKCB0b1Nob3csIHRvSGlkZSwgZGF0YSApIHsKCQl2YXIgdG90YWwsIGVhc2luZywgZHVyYXRpb24sCgkJCXRoYXQgPSB0aGlzLAoJCQlhZGp1c3QgPSAwLAoJCQlkb3duID0gdG9TaG93Lmxlbmd0aCAmJgoJCQkJKCAhdG9IaWRlLmxlbmd0aCB8fCAoIHRvU2hvdy5pbmRleCgpIDwgdG9IaWRlLmluZGV4KCkgKSApLAoJCQlhbmltYXRlID0gdGhpcy5vcHRpb25zLmFuaW1hdGUgfHwge30sCgkJCW9wdGlvbnMgPSBkb3duICYmIGFuaW1hdGUuZG93biB8fCBhbmltYXRlLAoJCQljb21wbGV0ZSA9IGZ1bmN0aW9uKCkgewoJCQkJdGhhdC5fdG9nZ2xlQ29tcGxldGUoIGRhdGEgKTsKCQkJfTsKCgkJaWYgKCB0eXBlb2Ygb3B0aW9ucyA9PT0gIm51bWJlciIgKSB7CgkJCWR1cmF0aW9uID0gb3B0aW9uczsKCQl9CgkJaWYgKCB0eXBlb2Ygb3B0aW9ucyA9PT0gInN0cmluZyIgKSB7CgkJCWVhc2luZyA9IG9wdGlvbnM7CgkJfQoJCS8vIGZhbGwgYmFjayBmcm9tIG9wdGlvbnMgdG8gYW5pbWF0aW9uIGluIGNhc2Ugb2YgcGFydGlhbCBkb3duIHNldHRpbmdzCgkJZWFzaW5nID0gZWFzaW5nIHx8IG9wdGlvbnMuZWFzaW5nIHx8IGFuaW1hdGUuZWFzaW5nOwoJCWR1cmF0aW9uID0gZHVyYXRpb24gfHwgb3B0aW9ucy5kdXJhdGlvbiB8fCBhbmltYXRlLmR1cmF0aW9uOwoKCQlpZiAoICF0b0hpZGUubGVuZ3RoICkgewoJCQlyZXR1cm4gdG9TaG93LmFuaW1hdGUoIHRoaXMuc2hvd1Byb3BzLCBkdXJhdGlvbiwgZWFzaW5nLCBjb21wbGV0ZSApOwoJCX0KCQlpZiAoICF0b1Nob3cubGVuZ3RoICkgewoJCQlyZXR1cm4gdG9IaWRlLmFuaW1hdGUoIHRoaXMuaGlkZVByb3BzLCBkdXJhdGlvbiwgZWFzaW5nLCBjb21wbGV0ZSApOwoJCX0KCgkJdG90YWwgPSB0b1Nob3cuc2hvdygpLm91dGVySGVpZ2h0KCk7CgkJdG9IaWRlLmFuaW1hdGUoIHRoaXMuaGlkZVByb3BzLCB7CgkJCWR1cmF0aW9uOiBkdXJhdGlvbiwKCQkJZWFzaW5nOiBlYXNpbmcsCgkJCXN0ZXA6IGZ1bmN0aW9uKCBub3csIGZ4ICkgewoJCQkJZngubm93ID0gTWF0aC5yb3VuZCggbm93ICk7CgkJCX0KCQl9KTsKCQl0b1Nob3cKCQkJLmhpZGUoKQoJCQkuYW5pbWF0ZSggdGhpcy5zaG93UHJvcHMsIHsKCQkJCWR1cmF0aW9uOiBkdXJhdGlvbiwKCQkJCWVhc2luZzogZWFzaW5nLAoJCQkJY29tcGxldGU6IGNvbXBsZXRlLAoJCQkJc3RlcDogZnVuY3Rpb24oIG5vdywgZnggKSB7CgkJCQkJZngubm93ID0gTWF0aC5yb3VuZCggbm93ICk7CgkJCQkJaWYgKCBmeC5wcm9wICE9PSAiaGVpZ2h0IiApIHsKCQkJCQkJYWRqdXN0ICs9IGZ4Lm5vdzsKCQkJCQl9IGVsc2UgaWYgKCB0aGF0Lm9wdGlvbnMuaGVpZ2h0U3R5bGUgIT09ICJjb250ZW50IiApIHsKCQkJCQkJZngubm93ID0gTWF0aC5yb3VuZCggdG90YWwgLSB0b0hpZGUub3V0ZXJIZWlnaHQoKSAtIGFkanVzdCApOwoJCQkJCQlhZGp1c3QgPSAwOwoJCQkJCX0KCQkJCX0KCQkJfSk7Cgl9LAoKCV90b2dnbGVDb21wbGV0ZTogZnVuY3Rpb24oIGRhdGEgKSB7CgkJdmFyIHRvSGlkZSA9IGRhdGEub2xkUGFuZWw7CgoJCXRvSGlkZQoJCQkucmVtb3ZlQ2xhc3MoICJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUiICkKCQkJLnByZXYoKQoJCQkJLnJlbW92ZUNsYXNzKCAidWktY29ybmVyLXRvcCIgKQoJCQkJLmFkZENsYXNzKCAidWktY29ybmVyLWFsbCIgKTsKCgkJLy8gV29yayBhcm91bmQgZm9yIHJlbmRlcmluZyBidWcgaW4gSUUgKCM1NDIxKQoJCWlmICggdG9IaWRlLmxlbmd0aCApIHsKCQkJdG9IaWRlLnBhcmVudCgpWyAwIF0uY2xhc3NOYW1lID0gdG9IaWRlLnBhcmVudCgpWyAwIF0uY2xhc3NOYW1lOwoJCX0KCQl0aGlzLl90cmlnZ2VyKCAiYWN0aXZhdGUiLCBudWxsLCBkYXRhICk7Cgl9Cn0pOwoKCi8qIQogKiBqUXVlcnkgVUkgTWVudSAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9tZW51LwogKi8KCgp2YXIgbWVudSA9ICQud2lkZ2V0KCAidWkubWVudSIsIHsKCXZlcnNpb246ICIxLjExLjEiLAoJZGVmYXVsdEVsZW1lbnQ6ICI8dWw+IiwKCWRlbGF5OiAzMDAsCglvcHRpb25zOiB7CgkJaWNvbnM6IHsKCQkJc3VibWVudTogInVpLWljb24tY2FyYXQtMS1lIgoJCX0sCgkJaXRlbXM6ICI+ICoiLAoJCW1lbnVzOiAidWwiLAoJCXBvc2l0aW9uOiB7CgkJCW15OiAibGVmdC0xIHRvcCIsCgkJCWF0OiAicmlnaHQgdG9wIgoJCX0sCgkJcm9sZTogIm1lbnUiLAoKCQkvLyBjYWxsYmFja3MKCQlibHVyOiBudWxsLAoJCWZvY3VzOiBudWxsLAoJCXNlbGVjdDogbnVsbAoJfSwKCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCQl0aGlzLmFjdGl2ZU1lbnUgPSB0aGlzLmVsZW1lbnQ7CgoJCS8vIEZsYWcgdXNlZCB0byBwcmV2ZW50IGZpcmluZyBvZiB0aGUgY2xpY2sgaGFuZGxlcgoJCS8vIGFzIHRoZSBldmVudCBidWJibGVzIHVwIHRocm91Z2ggbmVzdGVkIG1lbnVzCgkJdGhpcy5tb3VzZUhhbmRsZWQgPSBmYWxzZTsKCQl0aGlzLmVsZW1lbnQKCQkJLnVuaXF1ZUlkKCkKCQkJLmFkZENsYXNzKCAidWktbWVudSB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQiICkKCQkJLnRvZ2dsZUNsYXNzKCAidWktbWVudS1pY29ucyIsICEhdGhpcy5lbGVtZW50LmZpbmQoICIudWktaWNvbiIgKS5sZW5ndGggKQoJCQkuYXR0cih7CgkJCQlyb2xlOiB0aGlzLm9wdGlvbnMucm9sZSwKCQkJCXRhYkluZGV4OiAwCgkJCX0pOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJdGhpcy5lbGVtZW50CgkJCQkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1kaXNhYmxlZCIgKQoJCQkJLmF0dHIoICJhcmlhLWRpc2FibGVkIiwgInRydWUiICk7CgkJfQoKCQl0aGlzLl9vbih7CgkJCS8vIFByZXZlbnQgZm9jdXMgZnJvbSBzdGlja2luZyB0byBsaW5rcyBpbnNpZGUgbWVudSBhZnRlciBjbGlja2luZwoJCQkvLyB0aGVtIChmb2N1cyBzaG91bGQgYWx3YXlzIHN0YXkgb24gVUwgZHVyaW5nIG5hdmlnYXRpb24pLgoJCQkibW91c2Vkb3duIC51aS1tZW51LWl0ZW0iOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9LAoJCQkiY2xpY2sgLnVpLW1lbnUtaXRlbSI6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCXZhciB0YXJnZXQgPSAkKCBldmVudC50YXJnZXQgKTsKCQkJCWlmICggIXRoaXMubW91c2VIYW5kbGVkICYmIHRhcmdldC5ub3QoICIudWktc3RhdGUtZGlzYWJsZWQiICkubGVuZ3RoICkgewoJCQkJCXRoaXMuc2VsZWN0KCBldmVudCApOwoKCQkJCQkvLyBPbmx5IHNldCB0aGUgbW91c2VIYW5kbGVkIGZsYWcgaWYgdGhlIGV2ZW50IHdpbGwgYnViYmxlLCBzZWUgIzk0NjkuCgkJCQkJaWYgKCAhZXZlbnQuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSApIHsKCQkJCQkJdGhpcy5tb3VzZUhhbmRsZWQgPSB0cnVlOwoJCQkJCX0KCgkJCQkJLy8gT3BlbiBzdWJtZW51IG9uIGNsaWNrCgkJCQkJaWYgKCB0YXJnZXQuaGFzKCAiLnVpLW1lbnUiICkubGVuZ3RoICkgewoJCQkJCQl0aGlzLmV4cGFuZCggZXZlbnQgKTsKCQkJCQl9IGVsc2UgaWYgKCAhdGhpcy5lbGVtZW50LmlzKCAiOmZvY3VzIiApICYmICQoIHRoaXMuZG9jdW1lbnRbIDAgXS5hY3RpdmVFbGVtZW50ICkuY2xvc2VzdCggIi51aS1tZW51IiApLmxlbmd0aCApIHsKCgkJCQkJCS8vIFJlZGlyZWN0IGZvY3VzIHRvIHRoZSBtZW51CgkJCQkJCXRoaXMuZWxlbWVudC50cmlnZ2VyKCAiZm9jdXMiLCBbIHRydWUgXSApOwoKCQkJCQkJLy8gSWYgdGhlIGFjdGl2ZSBpdGVtIGlzIG9uIHRoZSB0b3AgbGV2ZWwsIGxldCBpdCBzdGF5IGFjdGl2ZS4KCQkJCQkJLy8gT3RoZXJ3aXNlLCBibHVyIHRoZSBhY3RpdmUgaXRlbSBzaW5jZSBpdCBpcyBubyBsb25nZXIgdmlzaWJsZS4KCQkJCQkJaWYgKCB0aGlzLmFjdGl2ZSAmJiB0aGlzLmFjdGl2ZS5wYXJlbnRzKCAiLnVpLW1lbnUiICkubGVuZ3RoID09PSAxICkgewoJCQkJCQkJY2xlYXJUaW1lb3V0KCB0aGlzLnRpbWVyICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0sCgkJCSJtb3VzZWVudGVyIC51aS1tZW51LWl0ZW0iOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQl2YXIgdGFyZ2V0ID0gJCggZXZlbnQuY3VycmVudFRhcmdldCApOwoJCQkJLy8gUmVtb3ZlIHVpLXN0YXRlLWFjdGl2ZSBjbGFzcyBmcm9tIHNpYmxpbmdzIG9mIHRoZSBuZXdseSBmb2N1c2VkIG1lbnUgaXRlbQoJCQkJLy8gdG8gYXZvaWQgYSBqdW1wIGNhdXNlZCBieSBhZGphY2VudCBlbGVtZW50cyBib3RoIGhhdmluZyBhIGNsYXNzIHdpdGggYSBib3JkZXIKCQkJCXRhcmdldC5zaWJsaW5ncyggIi51aS1zdGF0ZS1hY3RpdmUiICkucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgkJCQl0aGlzLmZvY3VzKCBldmVudCwgdGFyZ2V0ICk7CgkJCX0sCgkJCW1vdXNlbGVhdmU6ICJjb2xsYXBzZUFsbCIsCgkJCSJtb3VzZWxlYXZlIC51aS1tZW51IjogImNvbGxhcHNlQWxsIiwKCQkJZm9jdXM6IGZ1bmN0aW9uKCBldmVudCwga2VlcEFjdGl2ZUl0ZW0gKSB7CgkJCQkvLyBJZiB0aGVyZSdzIGFscmVhZHkgYW4gYWN0aXZlIGl0ZW0sIGtlZXAgaXQgYWN0aXZlCgkJCQkvLyBJZiBub3QsIGFjdGl2YXRlIHRoZSBmaXJzdCBpdGVtCgkJCQl2YXIgaXRlbSA9IHRoaXMuYWN0aXZlIHx8IHRoaXMuZWxlbWVudC5maW5kKCB0aGlzLm9wdGlvbnMuaXRlbXMgKS5lcSggMCApOwoKCQkJCWlmICggIWtlZXBBY3RpdmVJdGVtICkgewoJCQkJCXRoaXMuZm9jdXMoIGV2ZW50LCBpdGVtICk7CgkJCQl9CgkJCX0sCgkJCWJsdXI6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCXRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJCWlmICggISQuY29udGFpbnMoIHRoaXMuZWxlbWVudFswXSwgdGhpcy5kb2N1bWVudFswXS5hY3RpdmVFbGVtZW50ICkgKSB7CgkJCQkJCXRoaXMuY29sbGFwc2VBbGwoIGV2ZW50ICk7CgkJCQkJfQoJCQkJfSk7CgkJCX0sCgkJCWtleWRvd246ICJfa2V5ZG93biIKCQl9KTsKCgkJdGhpcy5yZWZyZXNoKCk7CgoJCS8vIENsaWNrcyBvdXRzaWRlIG9mIGEgbWVudSBjb2xsYXBzZSBhbnkgb3BlbiBtZW51cwoJCXRoaXMuX29uKCB0aGlzLmRvY3VtZW50LCB7CgkJCWNsaWNrOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlpZiAoIHRoaXMuX2Nsb3NlT25Eb2N1bWVudENsaWNrKCBldmVudCApICkgewoJCQkJCXRoaXMuY29sbGFwc2VBbGwoIGV2ZW50ICk7CgkJCQl9CgoJCQkJLy8gUmVzZXQgdGhlIG1vdXNlSGFuZGxlZCBmbGFnCgkJCQl0aGlzLm1vdXNlSGFuZGxlZCA9IGZhbHNlOwoJCQl9CgkJfSk7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQkvLyBEZXN0cm95IChzdWIpbWVudXMKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUF0dHIoICJhcmlhLWFjdGl2ZWRlc2NlbmRhbnQiICkKCQkJLmZpbmQoICIudWktbWVudSIgKS5hZGRCYWNrKCkKCQkJCS5yZW1vdmVDbGFzcyggInVpLW1lbnUgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLW1lbnUtaWNvbnMgdWktZnJvbnQiICkKCQkJCS5yZW1vdmVBdHRyKCAicm9sZSIgKQoJCQkJLnJlbW92ZUF0dHIoICJ0YWJJbmRleCIgKQoJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWxhYmVsbGVkYnkiICkKCQkJCS5yZW1vdmVBdHRyKCAiYXJpYS1leHBhbmRlZCIgKQoJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWhpZGRlbiIgKQoJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWRpc2FibGVkIiApCgkJCQkucmVtb3ZlVW5pcXVlSWQoKQoJCQkJLnNob3coKTsKCgkJLy8gRGVzdHJveSBtZW51IGl0ZW1zCgkJdGhpcy5lbGVtZW50LmZpbmQoICIudWktbWVudS1pdGVtIiApCgkJCS5yZW1vdmVDbGFzcyggInVpLW1lbnUtaXRlbSIgKQoJCQkucmVtb3ZlQXR0ciggInJvbGUiICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLWRpc2FibGVkIiApCgkJCS5yZW1vdmVVbmlxdWVJZCgpCgkJCS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWhvdmVyIiApCgkJCS5yZW1vdmVBdHRyKCAidGFiSW5kZXgiICkKCQkJLnJlbW92ZUF0dHIoICJyb2xlIiApCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS1oYXNwb3B1cCIgKQoJCQkuY2hpbGRyZW4oKS5lYWNoKCBmdW5jdGlvbigpIHsKCQkJCXZhciBlbGVtID0gJCggdGhpcyApOwoJCQkJaWYgKCBlbGVtLmRhdGEoICJ1aS1tZW51LXN1Ym1lbnUtY2FyYXQiICkgKSB7CgkJCQkJZWxlbS5yZW1vdmUoKTsKCQkJCX0KCQkJfSk7CgoJCS8vIERlc3Ryb3kgbWVudSBkaXZpZGVycwoJCXRoaXMuZWxlbWVudC5maW5kKCAiLnVpLW1lbnUtZGl2aWRlciIgKS5yZW1vdmVDbGFzcyggInVpLW1lbnUtZGl2aWRlciB1aS13aWRnZXQtY29udGVudCIgKTsKCX0sCgoJX2tleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgbWF0Y2gsIHByZXYsIGNoYXJhY3Rlciwgc2tpcCwgcmVnZXgsCgkJCXByZXZlbnREZWZhdWx0ID0gdHJ1ZTsKCgkJZnVuY3Rpb24gZXNjYXBlKCB2YWx1ZSApIHsKCQkJcmV0dXJuIHZhbHVlLnJlcGxhY2UoIC9bXC1cW1xde30oKSorPy4sXFxcXiR8I1xzXS9nLCAiXFwkJiIgKTsKCQl9CgoJCXN3aXRjaCAoIGV2ZW50LmtleUNvZGUgKSB7CgkJY2FzZSAkLnVpLmtleUNvZGUuUEFHRV9VUDoKCQkJdGhpcy5wcmV2aW91c1BhZ2UoIGV2ZW50ICk7CgkJCWJyZWFrOwoJCWNhc2UgJC51aS5rZXlDb2RlLlBBR0VfRE9XTjoKCQkJdGhpcy5uZXh0UGFnZSggZXZlbnQgKTsKCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuSE9NRToKCQkJdGhpcy5fbW92ZSggImZpcnN0IiwgImZpcnN0IiwgZXZlbnQgKTsKCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuRU5EOgoJCQl0aGlzLl9tb3ZlKCAibGFzdCIsICJsYXN0IiwgZXZlbnQgKTsKCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuVVA6CgkJCXRoaXMucHJldmlvdXMoIGV2ZW50ICk7CgkJCWJyZWFrOwoJCWNhc2UgJC51aS5rZXlDb2RlLkRPV046CgkJCXRoaXMubmV4dCggZXZlbnQgKTsKCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuTEVGVDoKCQkJdGhpcy5jb2xsYXBzZSggZXZlbnQgKTsKCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuUklHSFQ6CgkJCWlmICggdGhpcy5hY3RpdmUgJiYgIXRoaXMuYWN0aXZlLmlzKCAiLnVpLXN0YXRlLWRpc2FibGVkIiApICkgewoJCQkJdGhpcy5leHBhbmQoIGV2ZW50ICk7CgkJCX0KCQkJYnJlYWs7CgkJY2FzZSAkLnVpLmtleUNvZGUuRU5URVI6CgkJY2FzZSAkLnVpLmtleUNvZGUuU1BBQ0U6CgkJCXRoaXMuX2FjdGl2YXRlKCBldmVudCApOwoJCQlicmVhazsKCQljYXNlICQudWkua2V5Q29kZS5FU0NBUEU6CgkJCXRoaXMuY29sbGFwc2UoIGV2ZW50ICk7CgkJCWJyZWFrOwoJCWRlZmF1bHQ6CgkJCXByZXZlbnREZWZhdWx0ID0gZmFsc2U7CgkJCXByZXYgPSB0aGlzLnByZXZpb3VzRmlsdGVyIHx8ICIiOwoJCQljaGFyYWN0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCBldmVudC5rZXlDb2RlICk7CgkJCXNraXAgPSBmYWxzZTsKCgkJCWNsZWFyVGltZW91dCggdGhpcy5maWx0ZXJUaW1lciApOwoKCQkJaWYgKCBjaGFyYWN0ZXIgPT09IHByZXYgKSB7CgkJCQlza2lwID0gdHJ1ZTsKCQkJfSBlbHNlIHsKCQkJCWNoYXJhY3RlciA9IHByZXYgKyBjaGFyYWN0ZXI7CgkJCX0KCgkJCXJlZ2V4ID0gbmV3IFJlZ0V4cCggIl4iICsgZXNjYXBlKCBjaGFyYWN0ZXIgKSwgImkiICk7CgkJCW1hdGNoID0gdGhpcy5hY3RpdmVNZW51LmZpbmQoIHRoaXMub3B0aW9ucy5pdGVtcyApLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJCXJldHVybiByZWdleC50ZXN0KCAkKCB0aGlzICkudGV4dCgpICk7CgkJCX0pOwoJCQltYXRjaCA9IHNraXAgJiYgbWF0Y2guaW5kZXgoIHRoaXMuYWN0aXZlLm5leHQoKSApICE9PSAtMSA/CgkJCQl0aGlzLmFjdGl2ZS5uZXh0QWxsKCAiLnVpLW1lbnUtaXRlbSIgKSA6CgkJCQltYXRjaDsKCgkJCS8vIElmIG5vIG1hdGNoZXMgb24gdGhlIGN1cnJlbnQgZmlsdGVyLCByZXNldCB0byB0aGUgbGFzdCBjaGFyYWN0ZXIgcHJlc3NlZAoJCQkvLyB0byBtb3ZlIGRvd24gdGhlIG1lbnUgdG8gdGhlIGZpcnN0IGl0ZW0gdGhhdCBzdGFydHMgd2l0aCB0aGF0IGNoYXJhY3RlcgoJCQlpZiAoICFtYXRjaC5sZW5ndGggKSB7CgkJCQljaGFyYWN0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCBldmVudC5rZXlDb2RlICk7CgkJCQlyZWdleCA9IG5ldyBSZWdFeHAoICJeIiArIGVzY2FwZSggY2hhcmFjdGVyICksICJpIiApOwoJCQkJbWF0Y2ggPSB0aGlzLmFjdGl2ZU1lbnUuZmluZCggdGhpcy5vcHRpb25zLml0ZW1zICkuZmlsdGVyKGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiByZWdleC50ZXN0KCAkKCB0aGlzICkudGV4dCgpICk7CgkJCQl9KTsKCQkJfQoKCQkJaWYgKCBtYXRjaC5sZW5ndGggKSB7CgkJCQl0aGlzLmZvY3VzKCBldmVudCwgbWF0Y2ggKTsKCQkJCWlmICggbWF0Y2gubGVuZ3RoID4gMSApIHsKCQkJCQl0aGlzLnByZXZpb3VzRmlsdGVyID0gY2hhcmFjdGVyOwoJCQkJCXRoaXMuZmlsdGVyVGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJCQkJZGVsZXRlIHRoaXMucHJldmlvdXNGaWx0ZXI7CgkJCQkJfSwgMTAwMCApOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWxldGUgdGhpcy5wcmV2aW91c0ZpbHRlcjsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCWRlbGV0ZSB0aGlzLnByZXZpb3VzRmlsdGVyOwoJCQl9CgkJfQoKCQlpZiAoIHByZXZlbnREZWZhdWx0ICkgewoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCX0KCX0sCgoJX2FjdGl2YXRlOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCAhdGhpcy5hY3RpdmUuaXMoICIudWktc3RhdGUtZGlzYWJsZWQiICkgKSB7CgkJCWlmICggdGhpcy5hY3RpdmUuaXMoICJbYXJpYS1oYXNwb3B1cD0ndHJ1ZSddIiApICkgewoJCQkJdGhpcy5leHBhbmQoIGV2ZW50ICk7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLnNlbGVjdCggZXZlbnQgKTsKCQkJfQoJCX0KCX0sCgoJcmVmcmVzaDogZnVuY3Rpb24oKSB7CgkJdmFyIG1lbnVzLCBpdGVtcywKCQkJdGhhdCA9IHRoaXMsCgkJCWljb24gPSB0aGlzLm9wdGlvbnMuaWNvbnMuc3VibWVudSwKCQkJc3VibWVudXMgPSB0aGlzLmVsZW1lbnQuZmluZCggdGhpcy5vcHRpb25zLm1lbnVzICk7CgoJCXRoaXMuZWxlbWVudC50b2dnbGVDbGFzcyggInVpLW1lbnUtaWNvbnMiLCAhIXRoaXMuZWxlbWVudC5maW5kKCAiLnVpLWljb24iICkubGVuZ3RoICk7CgoJCS8vIEluaXRpYWxpemUgbmVzdGVkIG1lbnVzCgkJc3VibWVudXMuZmlsdGVyKCAiOm5vdCgudWktbWVudSkiICkKCQkJLmFkZENsYXNzKCAidWktbWVudSB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktZnJvbnQiICkKCQkJLmhpZGUoKQoJCQkuYXR0cih7CgkJCQlyb2xlOiB0aGlzLm9wdGlvbnMucm9sZSwKCQkJCSJhcmlhLWhpZGRlbiI6ICJ0cnVlIiwKCQkJCSJhcmlhLWV4cGFuZGVkIjogImZhbHNlIgoJCQl9KQoJCQkuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBtZW51ID0gJCggdGhpcyApLAoJCQkJCWl0ZW0gPSBtZW51LnBhcmVudCgpLAoJCQkJCXN1Ym1lbnVDYXJhdCA9ICQoICI8c3Bhbj4iICkKCQkJCQkJLmFkZENsYXNzKCAidWktbWVudS1pY29uIHVpLWljb24gIiArIGljb24gKQoJCQkJCQkuZGF0YSggInVpLW1lbnUtc3VibWVudS1jYXJhdCIsIHRydWUgKTsKCgkJCQlpdGVtCgkJCQkJLmF0dHIoICJhcmlhLWhhc3BvcHVwIiwgInRydWUiICkKCQkJCQkucHJlcGVuZCggc3VibWVudUNhcmF0ICk7CgkJCQltZW51LmF0dHIoICJhcmlhLWxhYmVsbGVkYnkiLCBpdGVtLmF0dHIoICJpZCIgKSApOwoJCQl9KTsKCgkJbWVudXMgPSBzdWJtZW51cy5hZGQoIHRoaXMuZWxlbWVudCApOwoJCWl0ZW1zID0gbWVudXMuZmluZCggdGhpcy5vcHRpb25zLml0ZW1zICk7CgoJCS8vIEluaXRpYWxpemUgbWVudS1pdGVtcyBjb250YWluaW5nIHNwYWNlcyBhbmQvb3IgZGFzaGVzIG9ubHkgYXMgZGl2aWRlcnMKCQlpdGVtcy5ub3QoICIudWktbWVudS1pdGVtIiApLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBpdGVtID0gJCggdGhpcyApOwoJCQlpZiAoIHRoYXQuX2lzRGl2aWRlciggaXRlbSApICkgewoJCQkJaXRlbS5hZGRDbGFzcyggInVpLXdpZGdldC1jb250ZW50IHVpLW1lbnUtZGl2aWRlciIgKTsKCQkJfQoJCX0pOwoKCQkvLyBEb24ndCByZWZyZXNoIGxpc3QgaXRlbXMgdGhhdCBhcmUgYWxyZWFkeSBhZGFwdGVkCgkJaXRlbXMubm90KCAiLnVpLW1lbnUtaXRlbSwgLnVpLW1lbnUtZGl2aWRlciIgKQoJCQkuYWRkQ2xhc3MoICJ1aS1tZW51LWl0ZW0iICkKCQkJLnVuaXF1ZUlkKCkKCQkJLmF0dHIoewoJCQkJdGFiSW5kZXg6IC0xLAoJCQkJcm9sZTogdGhpcy5faXRlbVJvbGUoKQoJCQl9KTsKCgkJLy8gQWRkIGFyaWEtZGlzYWJsZWQgYXR0cmlidXRlIHRvIGFueSBkaXNhYmxlZCBtZW51IGl0ZW0KCQlpdGVtcy5maWx0ZXIoICIudWktc3RhdGUtZGlzYWJsZWQiICkuYXR0ciggImFyaWEtZGlzYWJsZWQiLCAidHJ1ZSIgKTsKCgkJLy8gSWYgdGhlIGFjdGl2ZSBpdGVtIGhhcyBiZWVuIHJlbW92ZWQsIGJsdXIgdGhlIG1lbnUKCQlpZiAoIHRoaXMuYWN0aXZlICYmICEkLmNvbnRhaW5zKCB0aGlzLmVsZW1lbnRbIDAgXSwgdGhpcy5hY3RpdmVbIDAgXSApICkgewoJCQl0aGlzLmJsdXIoKTsKCQl9Cgl9LAoKCV9pdGVtUm9sZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHsKCQkJbWVudTogIm1lbnVpdGVtIiwKCQkJbGlzdGJveDogIm9wdGlvbiIKCQl9WyB0aGlzLm9wdGlvbnMucm9sZSBdOwoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQlpZiAoIGtleSA9PT0gImljb25zIiApIHsKCQkJdGhpcy5lbGVtZW50LmZpbmQoICIudWktbWVudS1pY29uIiApCgkJCQkucmVtb3ZlQ2xhc3MoIHRoaXMub3B0aW9ucy5pY29ucy5zdWJtZW51ICkKCQkJCS5hZGRDbGFzcyggdmFsdWUuc3VibWVudSApOwoJCX0KCQlpZiAoIGtleSA9PT0gImRpc2FibGVkIiApIHsKCQkJdGhpcy5lbGVtZW50CgkJCQkudG9nZ2xlQ2xhc3MoICJ1aS1zdGF0ZS1kaXNhYmxlZCIsICEhdmFsdWUgKQoJCQkJLmF0dHIoICJhcmlhLWRpc2FibGVkIiwgdmFsdWUgKTsKCQl9CgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCX0sCgoJZm9jdXM6IGZ1bmN0aW9uKCBldmVudCwgaXRlbSApIHsKCQl2YXIgbmVzdGVkLCBmb2N1c2VkOwoJCXRoaXMuYmx1ciggZXZlbnQsIGV2ZW50ICYmIGV2ZW50LnR5cGUgPT09ICJmb2N1cyIgKTsKCgkJdGhpcy5fc2Nyb2xsSW50b1ZpZXcoIGl0ZW0gKTsKCgkJdGhpcy5hY3RpdmUgPSBpdGVtLmZpcnN0KCk7CgkJZm9jdXNlZCA9IHRoaXMuYWN0aXZlLmFkZENsYXNzKCAidWktc3RhdGUtZm9jdXMiICkucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgkJLy8gT25seSB1cGRhdGUgYXJpYS1hY3RpdmVkZXNjZW5kYW50IGlmIHRoZXJlJ3MgYSByb2xlCgkJLy8gb3RoZXJ3aXNlIHdlIGFzc3VtZSBmb2N1cyBpcyBtYW5hZ2VkIGVsc2V3aGVyZQoJCWlmICggdGhpcy5vcHRpb25zLnJvbGUgKSB7CgkJCXRoaXMuZWxlbWVudC5hdHRyKCAiYXJpYS1hY3RpdmVkZXNjZW5kYW50IiwgZm9jdXNlZC5hdHRyKCAiaWQiICkgKTsKCQl9CgoJCS8vIEhpZ2hsaWdodCBhY3RpdmUgcGFyZW50IG1lbnUgaXRlbSwgaWYgYW55CgkJdGhpcy5hY3RpdmUKCQkJLnBhcmVudCgpCgkJCS5jbG9zZXN0KCAiLnVpLW1lbnUtaXRlbSIgKQoJCQkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgoJCWlmICggZXZlbnQgJiYgZXZlbnQudHlwZSA9PT0gImtleWRvd24iICkgewoJCQl0aGlzLl9jbG9zZSgpOwoJCX0gZWxzZSB7CgkJCXRoaXMudGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJCXRoaXMuX2Nsb3NlKCk7CgkJCX0sIHRoaXMuZGVsYXkgKTsKCQl9CgoJCW5lc3RlZCA9IGl0ZW0uY2hpbGRyZW4oICIudWktbWVudSIgKTsKCQlpZiAoIG5lc3RlZC5sZW5ndGggJiYgZXZlbnQgJiYgKCAvXm1vdXNlLy50ZXN0KCBldmVudC50eXBlICkgKSApIHsKCQkJdGhpcy5fc3RhcnRPcGVuaW5nKG5lc3RlZCk7CgkJfQoJCXRoaXMuYWN0aXZlTWVudSA9IGl0ZW0ucGFyZW50KCk7CgoJCXRoaXMuX3RyaWdnZXIoICJmb2N1cyIsIGV2ZW50LCB7IGl0ZW06IGl0ZW0gfSApOwoJfSwKCglfc2Nyb2xsSW50b1ZpZXc6IGZ1bmN0aW9uKCBpdGVtICkgewoJCXZhciBib3JkZXJUb3AsIHBhZGRpbmdUb3AsIG9mZnNldCwgc2Nyb2xsLCBlbGVtZW50SGVpZ2h0LCBpdGVtSGVpZ2h0OwoJCWlmICggdGhpcy5faGFzU2Nyb2xsKCkgKSB7CgkJCWJvcmRlclRvcCA9IHBhcnNlRmxvYXQoICQuY3NzKCB0aGlzLmFjdGl2ZU1lbnVbMF0sICJib3JkZXJUb3BXaWR0aCIgKSApIHx8IDA7CgkJCXBhZGRpbmdUb3AgPSBwYXJzZUZsb2F0KCAkLmNzcyggdGhpcy5hY3RpdmVNZW51WzBdLCAicGFkZGluZ1RvcCIgKSApIHx8IDA7CgkJCW9mZnNldCA9IGl0ZW0ub2Zmc2V0KCkudG9wIC0gdGhpcy5hY3RpdmVNZW51Lm9mZnNldCgpLnRvcCAtIGJvcmRlclRvcCAtIHBhZGRpbmdUb3A7CgkJCXNjcm9sbCA9IHRoaXMuYWN0aXZlTWVudS5zY3JvbGxUb3AoKTsKCQkJZWxlbWVudEhlaWdodCA9IHRoaXMuYWN0aXZlTWVudS5oZWlnaHQoKTsKCQkJaXRlbUhlaWdodCA9IGl0ZW0ub3V0ZXJIZWlnaHQoKTsKCgkJCWlmICggb2Zmc2V0IDwgMCApIHsKCQkJCXRoaXMuYWN0aXZlTWVudS5zY3JvbGxUb3AoIHNjcm9sbCArIG9mZnNldCApOwoJCQl9IGVsc2UgaWYgKCBvZmZzZXQgKyBpdGVtSGVpZ2h0ID4gZWxlbWVudEhlaWdodCApIHsKCQkJCXRoaXMuYWN0aXZlTWVudS5zY3JvbGxUb3AoIHNjcm9sbCArIG9mZnNldCAtIGVsZW1lbnRIZWlnaHQgKyBpdGVtSGVpZ2h0ICk7CgkJCX0KCQl9Cgl9LAoKCWJsdXI6IGZ1bmN0aW9uKCBldmVudCwgZnJvbUZvY3VzICkgewoJCWlmICggIWZyb21Gb2N1cyApIHsKCQkJY2xlYXJUaW1lb3V0KCB0aGlzLnRpbWVyICk7CgkJfQoKCQlpZiAoICF0aGlzLmFjdGl2ZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5hY3RpdmUucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1mb2N1cyIgKTsKCQl0aGlzLmFjdGl2ZSA9IG51bGw7CgoJCXRoaXMuX3RyaWdnZXIoICJibHVyIiwgZXZlbnQsIHsgaXRlbTogdGhpcy5hY3RpdmUgfSApOwoJfSwKCglfc3RhcnRPcGVuaW5nOiBmdW5jdGlvbiggc3VibWVudSApIHsKCQljbGVhclRpbWVvdXQoIHRoaXMudGltZXIgKTsKCgkJLy8gRG9uJ3Qgb3BlbiBpZiBhbHJlYWR5IG9wZW4gZml4ZXMgYSBGaXJlZm94IGJ1ZyB0aGF0IGNhdXNlZCBhIC41IHBpeGVsCgkJLy8gc2hpZnQgaW4gdGhlIHN1Ym1lbnUgcG9zaXRpb24gd2hlbiBtb3VzaW5nIG92ZXIgdGhlIGNhcmF0IGljb24KCQlpZiAoIHN1Ym1lbnUuYXR0ciggImFyaWEtaGlkZGVuIiApICE9PSAidHJ1ZSIgKSB7CgkJCXJldHVybjsKCQl9CgoJCXRoaXMudGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJdGhpcy5fY2xvc2UoKTsKCQkJdGhpcy5fb3Blbiggc3VibWVudSApOwoJCX0sIHRoaXMuZGVsYXkgKTsKCX0sCgoJX29wZW46IGZ1bmN0aW9uKCBzdWJtZW51ICkgewoJCXZhciBwb3NpdGlvbiA9ICQuZXh0ZW5kKHsKCQkJb2Y6IHRoaXMuYWN0aXZlCgkJfSwgdGhpcy5vcHRpb25zLnBvc2l0aW9uICk7CgoJCWNsZWFyVGltZW91dCggdGhpcy50aW1lciApOwoJCXRoaXMuZWxlbWVudC5maW5kKCAiLnVpLW1lbnUiICkubm90KCBzdWJtZW51LnBhcmVudHMoICIudWktbWVudSIgKSApCgkJCS5oaWRlKCkKCQkJLmF0dHIoICJhcmlhLWhpZGRlbiIsICJ0cnVlIiApOwoKCQlzdWJtZW51CgkJCS5zaG93KCkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLWhpZGRlbiIgKQoJCQkuYXR0ciggImFyaWEtZXhwYW5kZWQiLCAidHJ1ZSIgKQoJCQkucG9zaXRpb24oIHBvc2l0aW9uICk7Cgl9LAoKCWNvbGxhcHNlQWxsOiBmdW5jdGlvbiggZXZlbnQsIGFsbCApIHsKCQljbGVhclRpbWVvdXQoIHRoaXMudGltZXIgKTsKCQl0aGlzLnRpbWVyID0gdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CgkJCS8vIElmIHdlIHdlcmUgcGFzc2VkIGFuIGV2ZW50LCBsb29rIGZvciB0aGUgc3VibWVudSB0aGF0IGNvbnRhaW5zIHRoZSBldmVudAoJCQl2YXIgY3VycmVudE1lbnUgPSBhbGwgPyB0aGlzLmVsZW1lbnQgOgoJCQkJJCggZXZlbnQgJiYgZXZlbnQudGFyZ2V0ICkuY2xvc2VzdCggdGhpcy5lbGVtZW50LmZpbmQoICIudWktbWVudSIgKSApOwoKCQkJLy8gSWYgd2UgZm91bmQgbm8gdmFsaWQgc3VibWVudSBhbmNlc3RvciwgdXNlIHRoZSBtYWluIG1lbnUgdG8gY2xvc2UgYWxsIHN1YiBtZW51cyBhbnl3YXkKCQkJaWYgKCAhY3VycmVudE1lbnUubGVuZ3RoICkgewoJCQkJY3VycmVudE1lbnUgPSB0aGlzLmVsZW1lbnQ7CgkJCX0KCgkJCXRoaXMuX2Nsb3NlKCBjdXJyZW50TWVudSApOwoKCQkJdGhpcy5ibHVyKCBldmVudCApOwoJCQl0aGlzLmFjdGl2ZU1lbnUgPSBjdXJyZW50TWVudTsKCQl9LCB0aGlzLmRlbGF5ICk7Cgl9LAoKCS8vIFdpdGggbm8gYXJndW1lbnRzLCBjbG9zZXMgdGhlIGN1cnJlbnRseSBhY3RpdmUgbWVudSAtIGlmIG5vdGhpbmcgaXMgYWN0aXZlCgkvLyBpdCBjbG9zZXMgYWxsIG1lbnVzLiAgSWYgcGFzc2VkIGFuIGFyZ3VtZW50LCBpdCB3aWxsIHNlYXJjaCBmb3IgbWVudXMgQkVMT1cKCV9jbG9zZTogZnVuY3Rpb24oIHN0YXJ0TWVudSApIHsKCQlpZiAoICFzdGFydE1lbnUgKSB7CgkJCXN0YXJ0TWVudSA9IHRoaXMuYWN0aXZlID8gdGhpcy5hY3RpdmUucGFyZW50KCkgOiB0aGlzLmVsZW1lbnQ7CgkJfQoKCQlzdGFydE1lbnUKCQkJLmZpbmQoICIudWktbWVudSIgKQoJCQkJLmhpZGUoKQoJCQkJLmF0dHIoICJhcmlhLWhpZGRlbiIsICJ0cnVlIiApCgkJCQkuYXR0ciggImFyaWEtZXhwYW5kZWQiLCAiZmFsc2UiICkKCQkJLmVuZCgpCgkJCS5maW5kKCAiLnVpLXN0YXRlLWFjdGl2ZSIgKS5ub3QoICIudWktc3RhdGUtZm9jdXMiICkKCQkJCS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKTsKCX0sCgoJX2Nsb3NlT25Eb2N1bWVudENsaWNrOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJcmV0dXJuICEkKCBldmVudC50YXJnZXQgKS5jbG9zZXN0KCAiLnVpLW1lbnUiICkubGVuZ3RoOwoJfSwKCglfaXNEaXZpZGVyOiBmdW5jdGlvbiggaXRlbSApIHsKCgkJLy8gTWF0Y2ggaHlwaGVuLCBlbSBkYXNoLCBlbiBkYXNoCgkJcmV0dXJuICEvW15cLVx1MjAxNFx1MjAxM1xzXS8udGVzdCggaXRlbS50ZXh0KCkgKTsKCX0sCgoJY29sbGFwc2U6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgbmV3SXRlbSA9IHRoaXMuYWN0aXZlICYmCgkJCXRoaXMuYWN0aXZlLnBhcmVudCgpLmNsb3Nlc3QoICIudWktbWVudS1pdGVtIiwgdGhpcy5lbGVtZW50ICk7CgkJaWYgKCBuZXdJdGVtICYmIG5ld0l0ZW0ubGVuZ3RoICkgewoJCQl0aGlzLl9jbG9zZSgpOwoJCQl0aGlzLmZvY3VzKCBldmVudCwgbmV3SXRlbSApOwoJCX0KCX0sCgoJZXhwYW5kOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdmFyIG5ld0l0ZW0gPSB0aGlzLmFjdGl2ZSAmJgoJCQl0aGlzLmFjdGl2ZQoJCQkJLmNoaWxkcmVuKCAiLnVpLW1lbnUgIiApCgkJCQkuZmluZCggdGhpcy5vcHRpb25zLml0ZW1zICkKCQkJCS5maXJzdCgpOwoKCQlpZiAoIG5ld0l0ZW0gJiYgbmV3SXRlbS5sZW5ndGggKSB7CgkJCXRoaXMuX29wZW4oIG5ld0l0ZW0ucGFyZW50KCkgKTsKCgkJCS8vIERlbGF5IHNvIEZpcmVmb3ggd2lsbCBub3QgaGlkZSBhY3RpdmVkZXNjZW5kYW50IGNoYW5nZSBpbiBleHBhbmRpbmcgc3VibWVudSBmcm9tIEFUCgkJCXRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5mb2N1cyggZXZlbnQsIG5ld0l0ZW0gKTsKCQkJfSk7CgkJfQoJfSwKCgluZXh0OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdGhpcy5fbW92ZSggIm5leHQiLCAiZmlyc3QiLCBldmVudCApOwoJfSwKCglwcmV2aW91czogZnVuY3Rpb24oIGV2ZW50ICkgewoJCXRoaXMuX21vdmUoICJwcmV2IiwgImxhc3QiLCBldmVudCApOwoJfSwKCglpc0ZpcnN0SXRlbTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuYWN0aXZlICYmICF0aGlzLmFjdGl2ZS5wcmV2QWxsKCAiLnVpLW1lbnUtaXRlbSIgKS5sZW5ndGg7Cgl9LAoKCWlzTGFzdEl0ZW06IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmFjdGl2ZSAmJiAhdGhpcy5hY3RpdmUubmV4dEFsbCggIi51aS1tZW51LWl0ZW0iICkubGVuZ3RoOwoJfSwKCglfbW92ZTogZnVuY3Rpb24oIGRpcmVjdGlvbiwgZmlsdGVyLCBldmVudCApIHsKCQl2YXIgbmV4dDsKCQlpZiAoIHRoaXMuYWN0aXZlICkgewoJCQlpZiAoIGRpcmVjdGlvbiA9PT0gImZpcnN0IiB8fCBkaXJlY3Rpb24gPT09ICJsYXN0IiApIHsKCQkJCW5leHQgPSB0aGlzLmFjdGl2ZQoJCQkJCVsgZGlyZWN0aW9uID09PSAiZmlyc3QiID8gInByZXZBbGwiIDogIm5leHRBbGwiIF0oICIudWktbWVudS1pdGVtIiApCgkJCQkJLmVxKCAtMSApOwoJCQl9IGVsc2UgewoJCQkJbmV4dCA9IHRoaXMuYWN0aXZlCgkJCQkJWyBkaXJlY3Rpb24gKyAiQWxsIiBdKCAiLnVpLW1lbnUtaXRlbSIgKQoJCQkJCS5lcSggMCApOwoJCQl9CgkJfQoJCWlmICggIW5leHQgfHwgIW5leHQubGVuZ3RoIHx8ICF0aGlzLmFjdGl2ZSApIHsKCQkJbmV4dCA9IHRoaXMuYWN0aXZlTWVudS5maW5kKCB0aGlzLm9wdGlvbnMuaXRlbXMgKVsgZmlsdGVyIF0oKTsKCQl9CgoJCXRoaXMuZm9jdXMoIGV2ZW50LCBuZXh0ICk7Cgl9LAoKCW5leHRQYWdlOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdmFyIGl0ZW0sIGJhc2UsIGhlaWdodDsKCgkJaWYgKCAhdGhpcy5hY3RpdmUgKSB7CgkJCXRoaXMubmV4dCggZXZlbnQgKTsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoIHRoaXMuaXNMYXN0SXRlbSgpICkgewoJCQlyZXR1cm47CgkJfQoJCWlmICggdGhpcy5faGFzU2Nyb2xsKCkgKSB7CgkJCWJhc2UgPSB0aGlzLmFjdGl2ZS5vZmZzZXQoKS50b3A7CgkJCWhlaWdodCA9IHRoaXMuZWxlbWVudC5oZWlnaHQoKTsKCQkJdGhpcy5hY3RpdmUubmV4dEFsbCggIi51aS1tZW51LWl0ZW0iICkuZWFjaChmdW5jdGlvbigpIHsKCQkJCWl0ZW0gPSAkKCB0aGlzICk7CgkJCQlyZXR1cm4gaXRlbS5vZmZzZXQoKS50b3AgLSBiYXNlIC0gaGVpZ2h0IDwgMDsKCQkJfSk7CgoJCQl0aGlzLmZvY3VzKCBldmVudCwgaXRlbSApOwoJCX0gZWxzZSB7CgkJCXRoaXMuZm9jdXMoIGV2ZW50LCB0aGlzLmFjdGl2ZU1lbnUuZmluZCggdGhpcy5vcHRpb25zLml0ZW1zICkKCQkJCVsgIXRoaXMuYWN0aXZlID8gImZpcnN0IiA6ICJsYXN0IiBdKCkgKTsKCQl9Cgl9LAoKCXByZXZpb3VzUGFnZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCXZhciBpdGVtLCBiYXNlLCBoZWlnaHQ7CgkJaWYgKCAhdGhpcy5hY3RpdmUgKSB7CgkJCXRoaXMubmV4dCggZXZlbnQgKTsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoIHRoaXMuaXNGaXJzdEl0ZW0oKSApIHsKCQkJcmV0dXJuOwoJCX0KCQlpZiAoIHRoaXMuX2hhc1Njcm9sbCgpICkgewoJCQliYXNlID0gdGhpcy5hY3RpdmUub2Zmc2V0KCkudG9wOwoJCQloZWlnaHQgPSB0aGlzLmVsZW1lbnQuaGVpZ2h0KCk7CgkJCXRoaXMuYWN0aXZlLnByZXZBbGwoICIudWktbWVudS1pdGVtIiApLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlpdGVtID0gJCggdGhpcyApOwoJCQkJcmV0dXJuIGl0ZW0ub2Zmc2V0KCkudG9wIC0gYmFzZSArIGhlaWdodCA+IDA7CgkJCX0pOwoKCQkJdGhpcy5mb2N1cyggZXZlbnQsIGl0ZW0gKTsKCQl9IGVsc2UgewoJCQl0aGlzLmZvY3VzKCBldmVudCwgdGhpcy5hY3RpdmVNZW51LmZpbmQoIHRoaXMub3B0aW9ucy5pdGVtcyApLmZpcnN0KCkgKTsKCQl9Cgl9LAoKCV9oYXNTY3JvbGw6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSA8IHRoaXMuZWxlbWVudC5wcm9wKCAic2Nyb2xsSGVpZ2h0IiApOwoJfSwKCglzZWxlY3Q6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkvLyBUT0RPOiBJdCBzaG91bGQgbmV2ZXIgYmUgcG9zc2libGUgdG8gbm90IGhhdmUgYW4gYWN0aXZlIGl0ZW0gYXQgdGhpcwoJCS8vIHBvaW50LCBidXQgdGhlIHRlc3RzIGRvbid0IHRyaWdnZXIgbW91c2VlbnRlciBiZWZvcmUgY2xpY2suCgkJdGhpcy5hY3RpdmUgPSB0aGlzLmFjdGl2ZSB8fCAkKCBldmVudC50YXJnZXQgKS5jbG9zZXN0KCAiLnVpLW1lbnUtaXRlbSIgKTsKCQl2YXIgdWkgPSB7IGl0ZW06IHRoaXMuYWN0aXZlIH07CgkJaWYgKCAhdGhpcy5hY3RpdmUuaGFzKCAiLnVpLW1lbnUiICkubGVuZ3RoICkgewoJCQl0aGlzLmNvbGxhcHNlQWxsKCBldmVudCwgdHJ1ZSApOwoJCX0KCQl0aGlzLl90cmlnZ2VyKCAic2VsZWN0IiwgZXZlbnQsIHVpICk7Cgl9Cn0pOwoKCi8qIQogKiBqUXVlcnkgVUkgQXV0b2NvbXBsZXRlIDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL2F1dG9jb21wbGV0ZS8KICovCgoKJC53aWRnZXQoICJ1aS5hdXRvY29tcGxldGUiLCB7Cgl2ZXJzaW9uOiAiMS4xMS4xIiwKCWRlZmF1bHRFbGVtZW50OiAiPGlucHV0PiIsCglvcHRpb25zOiB7CgkJYXBwZW5kVG86IG51bGwsCgkJYXV0b0ZvY3VzOiBmYWxzZSwKCQlkZWxheTogMzAwLAoJCW1pbkxlbmd0aDogMSwKCQlwb3NpdGlvbjogewoJCQlteTogImxlZnQgdG9wIiwKCQkJYXQ6ICJsZWZ0IGJvdHRvbSIsCgkJCWNvbGxpc2lvbjogIm5vbmUiCgkJfSwKCQlzb3VyY2U6IG51bGwsCgoJCS8vIGNhbGxiYWNrcwoJCWNoYW5nZTogbnVsbCwKCQljbG9zZTogbnVsbCwKCQlmb2N1czogbnVsbCwKCQlvcGVuOiBudWxsLAoJCXJlc3BvbnNlOiBudWxsLAoJCXNlYXJjaDogbnVsbCwKCQlzZWxlY3Q6IG51bGwKCX0sCgoJcmVxdWVzdEluZGV4OiAwLAoJcGVuZGluZzogMCwKCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCQkvLyBTb21lIGJyb3dzZXJzIG9ubHkgcmVwZWF0IGtleWRvd24gZXZlbnRzLCBub3Qga2V5cHJlc3MgZXZlbnRzLAoJCS8vIHNvIHdlIHVzZSB0aGUgc3VwcHJlc3NLZXlQcmVzcyBmbGFnIHRvIGRldGVybWluZSBpZiB3ZSd2ZSBhbHJlYWR5CgkJLy8gaGFuZGxlZCB0aGUga2V5ZG93biBldmVudC4gIzcyNjkKCQkvLyBVbmZvcnR1bmF0ZWx5IHRoZSBjb2RlIGZvciAmIGluIGtleXByZXNzIGlzIHRoZSBzYW1lIGFzIHRoZSB1cCBhcnJvdywKCQkvLyBzbyB3ZSB1c2UgdGhlIHN1cHByZXNzS2V5UHJlc3NSZXBlYXQgZmxhZyB0byBhdm9pZCBoYW5kbGluZyBrZXlwcmVzcwoJCS8vIGV2ZW50cyB3aGVuIHdlIGtub3cgdGhlIGtleWRvd24gZXZlbnQgd2FzIHVzZWQgdG8gbW9kaWZ5IHRoZQoJCS8vIHNlYXJjaCB0ZXJtLiAjNzc5OQoJCXZhciBzdXBwcmVzc0tleVByZXNzLCBzdXBwcmVzc0tleVByZXNzUmVwZWF0LCBzdXBwcmVzc0lucHV0LAoJCQlub2RlTmFtZSA9IHRoaXMuZWxlbWVudFsgMCBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksCgkJCWlzVGV4dGFyZWEgPSBub2RlTmFtZSA9PT0gInRleHRhcmVhIiwKCQkJaXNJbnB1dCA9IG5vZGVOYW1lID09PSAiaW5wdXQiOwoKCQl0aGlzLmlzTXVsdGlMaW5lID0KCQkJLy8gVGV4dGFyZWFzIGFyZSBhbHdheXMgbXVsdGktbGluZQoJCQlpc1RleHRhcmVhID8gdHJ1ZSA6CgkJCS8vIElucHV0cyBhcmUgYWx3YXlzIHNpbmdsZS1saW5lLCBldmVuIGlmIGluc2lkZSBhIGNvbnRlbnRFZGl0YWJsZSBlbGVtZW50CgkJCS8vIElFIGFsc28gdHJlYXRzIGlucHV0cyBhcyBjb250ZW50RWRpdGFibGUKCQkJaXNJbnB1dCA/IGZhbHNlIDoKCQkJLy8gQWxsIG90aGVyIGVsZW1lbnQgdHlwZXMgYXJlIGRldGVybWluZWQgYnkgd2hldGhlciBvciBub3QgdGhleSdyZSBjb250ZW50RWRpdGFibGUKCQkJdGhpcy5lbGVtZW50LnByb3AoICJpc0NvbnRlbnRFZGl0YWJsZSIgKTsKCgkJdGhpcy52YWx1ZU1ldGhvZCA9IHRoaXMuZWxlbWVudFsgaXNUZXh0YXJlYSB8fCBpc0lucHV0ID8gInZhbCIgOiAidGV4dCIgXTsKCQl0aGlzLmlzTmV3TWVudSA9IHRydWU7CgoJCXRoaXMuZWxlbWVudAoJCQkuYWRkQ2xhc3MoICJ1aS1hdXRvY29tcGxldGUtaW5wdXQiICkKCQkJLmF0dHIoICJhdXRvY29tcGxldGUiLCAib2ZmIiApOwoKCQl0aGlzLl9vbiggdGhpcy5lbGVtZW50LCB7CgkJCWtleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWlmICggdGhpcy5lbGVtZW50LnByb3AoICJyZWFkT25seSIgKSApIHsKCQkJCQlzdXBwcmVzc0tleVByZXNzID0gdHJ1ZTsKCQkJCQlzdXBwcmVzc0lucHV0ID0gdHJ1ZTsKCQkJCQlzdXBwcmVzc0tleVByZXNzUmVwZWF0ID0gdHJ1ZTsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJc3VwcHJlc3NLZXlQcmVzcyA9IGZhbHNlOwoJCQkJc3VwcHJlc3NJbnB1dCA9IGZhbHNlOwoJCQkJc3VwcHJlc3NLZXlQcmVzc1JlcGVhdCA9IGZhbHNlOwoJCQkJdmFyIGtleUNvZGUgPSAkLnVpLmtleUNvZGU7CgkJCQlzd2l0Y2ggKCBldmVudC5rZXlDb2RlICkgewoJCQkJY2FzZSBrZXlDb2RlLlBBR0VfVVA6CgkJCQkJc3VwcHJlc3NLZXlQcmVzcyA9IHRydWU7CgkJCQkJdGhpcy5fbW92ZSggInByZXZpb3VzUGFnZSIsIGV2ZW50ICk7CgkJCQkJYnJlYWs7CgkJCQljYXNlIGtleUNvZGUuUEFHRV9ET1dOOgoJCQkJCXN1cHByZXNzS2V5UHJlc3MgPSB0cnVlOwoJCQkJCXRoaXMuX21vdmUoICJuZXh0UGFnZSIsIGV2ZW50ICk7CgkJCQkJYnJlYWs7CgkJCQljYXNlIGtleUNvZGUuVVA6CgkJCQkJc3VwcHJlc3NLZXlQcmVzcyA9IHRydWU7CgkJCQkJdGhpcy5fa2V5RXZlbnQoICJwcmV2aW91cyIsIGV2ZW50ICk7CgkJCQkJYnJlYWs7CgkJCQljYXNlIGtleUNvZGUuRE9XTjoKCQkJCQlzdXBwcmVzc0tleVByZXNzID0gdHJ1ZTsKCQkJCQl0aGlzLl9rZXlFdmVudCggIm5leHQiLCBldmVudCApOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSBrZXlDb2RlLkVOVEVSOgoJCQkJCS8vIHdoZW4gbWVudSBpcyBvcGVuIGFuZCBoYXMgZm9jdXMKCQkJCQlpZiAoIHRoaXMubWVudS5hY3RpdmUgKSB7CgkJCQkJCS8vICM2MDU1IC0gT3BlcmEgc3RpbGwgYWxsb3dzIHRoZSBrZXlwcmVzcyB0byBvY2N1cgoJCQkJCQkvLyB3aGljaCBjYXVzZXMgZm9ybXMgdG8gc3VibWl0CgkJCQkJCXN1cHByZXNzS2V5UHJlc3MgPSB0cnVlOwoJCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCQl0aGlzLm1lbnUuc2VsZWN0KCBldmVudCApOwoJCQkJCX0KCQkJCQlicmVhazsKCQkJCWNhc2Uga2V5Q29kZS5UQUI6CgkJCQkJaWYgKCB0aGlzLm1lbnUuYWN0aXZlICkgewoJCQkJCQl0aGlzLm1lbnUuc2VsZWN0KCBldmVudCApOwoJCQkJCX0KCQkJCQlicmVhazsKCQkJCWNhc2Uga2V5Q29kZS5FU0NBUEU6CgkJCQkJaWYgKCB0aGlzLm1lbnUuZWxlbWVudC5pcyggIjp2aXNpYmxlIiApICkgewoJCQkJCQlpZiAoICF0aGlzLmlzTXVsdGlMaW5lICkgewoJCQkJCQkJdGhpcy5fdmFsdWUoIHRoaXMudGVybSApOwoJCQkJCQl9CgkJCQkJCXRoaXMuY2xvc2UoIGV2ZW50ICk7CgkJCQkJCS8vIERpZmZlcmVudCBicm93c2VycyBoYXZlIGRpZmZlcmVudCBkZWZhdWx0IGJlaGF2aW9yIGZvciBlc2NhcGUKCQkJCQkJLy8gU2luZ2xlIHByZXNzIGNhbiBtZWFuIHVuZG8gb3IgY2xlYXIKCQkJCQkJLy8gRG91YmxlIHByZXNzIGluIElFIG1lYW5zIGNsZWFyIHRoZSB3aG9sZSBmb3JtCgkJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQkJfQoJCQkJCWJyZWFrOwoJCQkJZGVmYXVsdDoKCQkJCQlzdXBwcmVzc0tleVByZXNzUmVwZWF0ID0gdHJ1ZTsKCQkJCQkvLyBzZWFyY2ggdGltZW91dCBzaG91bGQgYmUgdHJpZ2dlcmVkIGJlZm9yZSB0aGUgaW5wdXQgdmFsdWUgaXMgY2hhbmdlZAoJCQkJCXRoaXMuX3NlYXJjaFRpbWVvdXQoIGV2ZW50ICk7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0sCgkJCWtleXByZXNzOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlpZiAoIHN1cHByZXNzS2V5UHJlc3MgKSB7CgkJCQkJc3VwcHJlc3NLZXlQcmVzcyA9IGZhbHNlOwoJCQkJCWlmICggIXRoaXMuaXNNdWx0aUxpbmUgfHwgdGhpcy5tZW51LmVsZW1lbnQuaXMoICI6dmlzaWJsZSIgKSApIHsKCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQl9CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJaWYgKCBzdXBwcmVzc0tleVByZXNzUmVwZWF0ICkgewoJCQkJCXJldHVybjsKCQkJCX0KCgkJCQkvLyByZXBsaWNhdGUgc29tZSBrZXkgaGFuZGxlcnMgdG8gYWxsb3cgdGhlbSB0byByZXBlYXQgaW4gRmlyZWZveCBhbmQgT3BlcmEKCQkJCXZhciBrZXlDb2RlID0gJC51aS5rZXlDb2RlOwoJCQkJc3dpdGNoICggZXZlbnQua2V5Q29kZSApIHsKCQkJCWNhc2Uga2V5Q29kZS5QQUdFX1VQOgoJCQkJCXRoaXMuX21vdmUoICJwcmV2aW91c1BhZ2UiLCBldmVudCApOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSBrZXlDb2RlLlBBR0VfRE9XTjoKCQkJCQl0aGlzLl9tb3ZlKCAibmV4dFBhZ2UiLCBldmVudCApOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSBrZXlDb2RlLlVQOgoJCQkJCXRoaXMuX2tleUV2ZW50KCAicHJldmlvdXMiLCBldmVudCApOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSBrZXlDb2RlLkRPV046CgkJCQkJdGhpcy5fa2V5RXZlbnQoICJuZXh0IiwgZXZlbnQgKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfSwKCQkJaW5wdXQ6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWlmICggc3VwcHJlc3NJbnB1dCApIHsKCQkJCQlzdXBwcmVzc0lucHV0ID0gZmFsc2U7CgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQl0aGlzLl9zZWFyY2hUaW1lb3V0KCBldmVudCApOwoJCQl9LAoJCQlmb2N1czogZnVuY3Rpb24oKSB7CgkJCQl0aGlzLnNlbGVjdGVkSXRlbSA9IG51bGw7CgkJCQl0aGlzLnByZXZpb3VzID0gdGhpcy5fdmFsdWUoKTsKCQkJfSwKCQkJYmx1cjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJaWYgKCB0aGlzLmNhbmNlbEJsdXIgKSB7CgkJCQkJZGVsZXRlIHRoaXMuY2FuY2VsQmx1cjsKCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJY2xlYXJUaW1lb3V0KCB0aGlzLnNlYXJjaGluZyApOwoJCQkJdGhpcy5jbG9zZSggZXZlbnQgKTsKCQkJCXRoaXMuX2NoYW5nZSggZXZlbnQgKTsKCQkJfQoJCX0pOwoKCQl0aGlzLl9pbml0U291cmNlKCk7CgkJdGhpcy5tZW51ID0gJCggIjx1bD4iICkKCQkJLmFkZENsYXNzKCAidWktYXV0b2NvbXBsZXRlIHVpLWZyb250IiApCgkJCS5hcHBlbmRUbyggdGhpcy5fYXBwZW5kVG8oKSApCgkJCS5tZW51KHsKCQkJCS8vIGRpc2FibGUgQVJJQSBzdXBwb3J0LCB0aGUgbGl2ZSByZWdpb24gdGFrZXMgY2FyZSBvZiB0aGF0CgkJCQlyb2xlOiBudWxsCgkJCX0pCgkJCS5oaWRlKCkKCQkJLm1lbnUoICJpbnN0YW5jZSIgKTsKCgkJdGhpcy5fb24oIHRoaXMubWVudS5lbGVtZW50LCB7CgkJCW1vdXNlZG93bjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJLy8gcHJldmVudCBtb3ZpbmcgZm9jdXMgb3V0IG9mIHRoZSB0ZXh0IGZpZWxkCgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKCQkJCS8vIElFIGRvZXNuJ3QgcHJldmVudCBtb3ZpbmcgZm9jdXMgZXZlbiB3aXRoIGV2ZW50LnByZXZlbnREZWZhdWx0KCkKCQkJCS8vIHNvIHdlIHNldCBhIGZsYWcgdG8ga25vdyB3aGVuIHdlIHNob3VsZCBpZ25vcmUgdGhlIGJsdXIgZXZlbnQKCQkJCXRoaXMuY2FuY2VsQmx1ciA9IHRydWU7CgkJCQl0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJCQlkZWxldGUgdGhpcy5jYW5jZWxCbHVyOwoJCQkJfSk7CgoJCQkJLy8gY2xpY2tpbmcgb24gdGhlIHNjcm9sbGJhciBjYXVzZXMgZm9jdXMgdG8gc2hpZnQgdG8gdGhlIGJvZHkKCQkJCS8vIGJ1dCB3ZSBjYW4ndCBkZXRlY3QgYSBtb3VzZXVwIG9yIGEgY2xpY2sgaW1tZWRpYXRlbHkgYWZ0ZXJ3YXJkCgkJCQkvLyBzbyB3ZSBoYXZlIHRvIHRyYWNrIHRoZSBuZXh0IG1vdXNlZG93biBhbmQgY2xvc2UgdGhlIG1lbnUgaWYKCQkJCS8vIHRoZSB1c2VyIGNsaWNrcyBzb21ld2hlcmUgb3V0c2lkZSBvZiB0aGUgYXV0b2NvbXBsZXRlCgkJCQl2YXIgbWVudUVsZW1lbnQgPSB0aGlzLm1lbnUuZWxlbWVudFsgMCBdOwoJCQkJaWYgKCAhJCggZXZlbnQudGFyZ2V0ICkuY2xvc2VzdCggIi51aS1tZW51LWl0ZW0iICkubGVuZ3RoICkgewoJCQkJCXRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgdGhhdCA9IHRoaXM7CgkJCQkJCXRoaXMuZG9jdW1lbnQub25lKCAibW91c2Vkb3duIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQkJaWYgKCBldmVudC50YXJnZXQgIT09IHRoYXQuZWxlbWVudFsgMCBdICYmCgkJCQkJCQkJCWV2ZW50LnRhcmdldCAhPT0gbWVudUVsZW1lbnQgJiYKCQkJCQkJCQkJISQuY29udGFpbnMoIG1lbnVFbGVtZW50LCBldmVudC50YXJnZXQgKSApIHsKCQkJCQkJCQl0aGF0LmNsb3NlKCk7CgkJCQkJCQl9CgkJCQkJCX0pOwoJCQkJCX0pOwoJCQkJfQoJCQl9LAoJCQltZW51Zm9jdXM6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7CgkJCQl2YXIgbGFiZWwsIGl0ZW07CgkJCQkvLyBzdXBwb3J0OiBGaXJlZm94CgkJCQkvLyBQcmV2ZW50IGFjY2lkZW50YWwgYWN0aXZhdGlvbiBvZiBtZW51IGl0ZW1zIGluIEZpcmVmb3ggKCM3MDI0ICM5MTE4KQoJCQkJaWYgKCB0aGlzLmlzTmV3TWVudSApIHsKCQkJCQl0aGlzLmlzTmV3TWVudSA9IGZhbHNlOwoJCQkJCWlmICggZXZlbnQub3JpZ2luYWxFdmVudCAmJiAvXm1vdXNlLy50ZXN0KCBldmVudC5vcmlnaW5hbEV2ZW50LnR5cGUgKSApIHsKCQkJCQkJdGhpcy5tZW51LmJsdXIoKTsKCgkJCQkJCXRoaXMuZG9jdW1lbnQub25lKCAibW91c2Vtb3ZlIiwgZnVuY3Rpb24oKSB7CgkJCQkJCQkkKCBldmVudC50YXJnZXQgKS50cmlnZ2VyKCBldmVudC5vcmlnaW5hbEV2ZW50ICk7CgkJCQkJCX0pOwoKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCX0KCgkJCQlpdGVtID0gdWkuaXRlbS5kYXRhKCAidWktYXV0b2NvbXBsZXRlLWl0ZW0iICk7CgkJCQlpZiAoIGZhbHNlICE9PSB0aGlzLl90cmlnZ2VyKCAiZm9jdXMiLCBldmVudCwgeyBpdGVtOiBpdGVtIH0gKSApIHsKCQkJCQkvLyB1c2UgdmFsdWUgdG8gbWF0Y2ggd2hhdCB3aWxsIGVuZCB1cCBpbiB0aGUgaW5wdXQsIGlmIGl0IHdhcyBhIGtleSBldmVudAoJCQkJCWlmICggZXZlbnQub3JpZ2luYWxFdmVudCAmJiAvXmtleS8udGVzdCggZXZlbnQub3JpZ2luYWxFdmVudC50eXBlICkgKSB7CgkJCQkJCXRoaXMuX3ZhbHVlKCBpdGVtLnZhbHVlICk7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIEFubm91bmNlIHRoZSB2YWx1ZSBpbiB0aGUgbGl2ZVJlZ2lvbgoJCQkJbGFiZWwgPSB1aS5pdGVtLmF0dHIoICJhcmlhLWxhYmVsIiApIHx8IGl0ZW0udmFsdWU7CgkJCQlpZiAoIGxhYmVsICYmICQudHJpbSggbGFiZWwgKS5sZW5ndGggKSB7CgkJCQkJdGhpcy5saXZlUmVnaW9uLmNoaWxkcmVuKCkuaGlkZSgpOwoJCQkJCSQoICI8ZGl2PiIgKS50ZXh0KCBsYWJlbCApLmFwcGVuZFRvKCB0aGlzLmxpdmVSZWdpb24gKTsKCQkJCX0KCQkJfSwKCQkJbWVudXNlbGVjdDogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHsKCQkJCXZhciBpdGVtID0gdWkuaXRlbS5kYXRhKCAidWktYXV0b2NvbXBsZXRlLWl0ZW0iICksCgkJCQkJcHJldmlvdXMgPSB0aGlzLnByZXZpb3VzOwoKCQkJCS8vIG9ubHkgdHJpZ2dlciB3aGVuIGZvY3VzIHdhcyBsb3N0IChjbGljayBvbiBtZW51KQoJCQkJaWYgKCB0aGlzLmVsZW1lbnRbIDAgXSAhPT0gdGhpcy5kb2N1bWVudFsgMCBdLmFjdGl2ZUVsZW1lbnQgKSB7CgkJCQkJdGhpcy5lbGVtZW50LmZvY3VzKCk7CgkJCQkJdGhpcy5wcmV2aW91cyA9IHByZXZpb3VzOwoJCQkJCS8vICM2MTA5IC0gSUUgdHJpZ2dlcnMgdHdvIGZvY3VzIGV2ZW50cyBhbmQgdGhlIHNlY29uZAoJCQkJCS8vIGlzIGFzeW5jaHJvbm91cywgc28gd2UgbmVlZCB0byByZXNldCB0aGUgcHJldmlvdXMKCQkJCQkvLyB0ZXJtIHN5bmNocm9ub3VzbHkgYW5kIGFzeW5jaHJvbm91c2x5IDotKAoJCQkJCXRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJCQl0aGlzLnByZXZpb3VzID0gcHJldmlvdXM7CgkJCQkJCXRoaXMuc2VsZWN0ZWRJdGVtID0gaXRlbTsKCQkJCQl9KTsKCQkJCX0KCgkJCQlpZiAoIGZhbHNlICE9PSB0aGlzLl90cmlnZ2VyKCAic2VsZWN0IiwgZXZlbnQsIHsgaXRlbTogaXRlbSB9ICkgKSB7CgkJCQkJdGhpcy5fdmFsdWUoIGl0ZW0udmFsdWUgKTsKCQkJCX0KCQkJCS8vIHJlc2V0IHRoZSB0ZXJtIGFmdGVyIHRoZSBzZWxlY3QgZXZlbnQKCQkJCS8vIHRoaXMgYWxsb3dzIGN1c3RvbSBzZWxlY3QgaGFuZGxpbmcgdG8gd29yayBwcm9wZXJseQoJCQkJdGhpcy50ZXJtID0gdGhpcy5fdmFsdWUoKTsKCgkJCQl0aGlzLmNsb3NlKCBldmVudCApOwoJCQkJdGhpcy5zZWxlY3RlZEl0ZW0gPSBpdGVtOwoJCQl9CgkJfSk7CgoJCXRoaXMubGl2ZVJlZ2lvbiA9ICQoICI8c3Bhbj4iLCB7CgkJCQlyb2xlOiAic3RhdHVzIiwKCQkJCSJhcmlhLWxpdmUiOiAiYXNzZXJ0aXZlIiwKCQkJCSJhcmlhLXJlbGV2YW50IjogImFkZGl0aW9ucyIKCQkJfSkKCQkJLmFkZENsYXNzKCAidWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIiApCgkJCS5hcHBlbmRUbyggdGhpcy5kb2N1bWVudFsgMCBdLmJvZHkgKTsKCgkJLy8gdHVybmluZyBvZmYgYXV0b2NvbXBsZXRlIHByZXZlbnRzIHRoZSBicm93c2VyIGZyb20gcmVtZW1iZXJpbmcgdGhlCgkJLy8gdmFsdWUgd2hlbiBuYXZpZ2F0aW5nIHRocm91Z2ggaGlzdG9yeSwgc28gd2UgcmUtZW5hYmxlIGF1dG9jb21wbGV0ZQoJCS8vIGlmIHRoZSBwYWdlIGlzIHVubG9hZGVkIGJlZm9yZSB0aGUgd2lkZ2V0IGlzIGRlc3Ryb3llZC4gIzc3OTAKCQl0aGlzLl9vbiggdGhpcy53aW5kb3csIHsKCQkJYmVmb3JldW5sb2FkOiBmdW5jdGlvbigpIHsKCQkJCXRoaXMuZWxlbWVudC5yZW1vdmVBdHRyKCAiYXV0b2NvbXBsZXRlIiApOwoJCQl9CgkJfSk7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQljbGVhclRpbWVvdXQoIHRoaXMuc2VhcmNoaW5nICk7CgkJdGhpcy5lbGVtZW50CgkJCS5yZW1vdmVDbGFzcyggInVpLWF1dG9jb21wbGV0ZS1pbnB1dCIgKQoJCQkucmVtb3ZlQXR0ciggImF1dG9jb21wbGV0ZSIgKTsKCQl0aGlzLm1lbnUuZWxlbWVudC5yZW1vdmUoKTsKCQl0aGlzLmxpdmVSZWdpb24ucmVtb3ZlKCk7Cgl9LAoKCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCXRoaXMuX3N1cGVyKCBrZXksIHZhbHVlICk7CgkJaWYgKCBrZXkgPT09ICJzb3VyY2UiICkgewoJCQl0aGlzLl9pbml0U291cmNlKCk7CgkJfQoJCWlmICgga2V5ID09PSAiYXBwZW5kVG8iICkgewoJCQl0aGlzLm1lbnUuZWxlbWVudC5hcHBlbmRUbyggdGhpcy5fYXBwZW5kVG8oKSApOwoJCX0KCQlpZiAoIGtleSA9PT0gImRpc2FibGVkIiAmJiB2YWx1ZSAmJiB0aGlzLnhociApIHsKCQkJdGhpcy54aHIuYWJvcnQoKTsKCQl9Cgl9LAoKCV9hcHBlbmRUbzogZnVuY3Rpb24oKSB7CgkJdmFyIGVsZW1lbnQgPSB0aGlzLm9wdGlvbnMuYXBwZW5kVG87CgoJCWlmICggZWxlbWVudCApIHsKCQkJZWxlbWVudCA9IGVsZW1lbnQuanF1ZXJ5IHx8IGVsZW1lbnQubm9kZVR5cGUgPwoJCQkJJCggZWxlbWVudCApIDoKCQkJCXRoaXMuZG9jdW1lbnQuZmluZCggZWxlbWVudCApLmVxKCAwICk7CgkJfQoKCQlpZiAoICFlbGVtZW50IHx8ICFlbGVtZW50WyAwIF0gKSB7CgkJCWVsZW1lbnQgPSB0aGlzLmVsZW1lbnQuY2xvc2VzdCggIi51aS1mcm9udCIgKTsKCQl9CgoJCWlmICggIWVsZW1lbnQubGVuZ3RoICkgewoJCQllbGVtZW50ID0gdGhpcy5kb2N1bWVudFsgMCBdLmJvZHk7CgkJfQoKCQlyZXR1cm4gZWxlbWVudDsKCX0sCgoJX2luaXRTb3VyY2U6IGZ1bmN0aW9uKCkgewoJCXZhciBhcnJheSwgdXJsLAoJCQl0aGF0ID0gdGhpczsKCQlpZiAoICQuaXNBcnJheSggdGhpcy5vcHRpb25zLnNvdXJjZSApICkgewoJCQlhcnJheSA9IHRoaXMub3B0aW9ucy5zb3VyY2U7CgkJCXRoaXMuc291cmNlID0gZnVuY3Rpb24oIHJlcXVlc3QsIHJlc3BvbnNlICkgewoJCQkJcmVzcG9uc2UoICQudWkuYXV0b2NvbXBsZXRlLmZpbHRlciggYXJyYXksIHJlcXVlc3QudGVybSApICk7CgkJCX07CgkJfSBlbHNlIGlmICggdHlwZW9mIHRoaXMub3B0aW9ucy5zb3VyY2UgPT09ICJzdHJpbmciICkgewoJCQl1cmwgPSB0aGlzLm9wdGlvbnMuc291cmNlOwoJCQl0aGlzLnNvdXJjZSA9IGZ1bmN0aW9uKCByZXF1ZXN0LCByZXNwb25zZSApIHsKCQkJCWlmICggdGhhdC54aHIgKSB7CgkJCQkJdGhhdC54aHIuYWJvcnQoKTsKCQkJCX0KCQkJCXRoYXQueGhyID0gJC5hamF4KHsKCQkJCQl1cmw6IHVybCwKCQkJCQlkYXRhOiByZXF1ZXN0LAoJCQkJCWRhdGFUeXBlOiAianNvbiIsCgkJCQkJc3VjY2VzczogZnVuY3Rpb24oIGRhdGEgKSB7CgkJCQkJCXJlc3BvbnNlKCBkYXRhICk7CgkJCQkJfSwKCQkJCQllcnJvcjogZnVuY3Rpb24oKSB7CgkJCQkJCXJlc3BvbnNlKFtdKTsKCQkJCQl9CgkJCQl9KTsKCQkJfTsKCQl9IGVsc2UgewoJCQl0aGlzLnNvdXJjZSA9IHRoaXMub3B0aW9ucy5zb3VyY2U7CgkJfQoJfSwKCglfc2VhcmNoVGltZW91dDogZnVuY3Rpb24oIGV2ZW50ICkgewoJCWNsZWFyVGltZW91dCggdGhpcy5zZWFyY2hpbmcgKTsKCQl0aGlzLnNlYXJjaGluZyA9IHRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoKCQkJLy8gU2VhcmNoIGlmIHRoZSB2YWx1ZSBoYXMgY2hhbmdlZCwgb3IgaWYgdGhlIHVzZXIgcmV0eXBlcyB0aGUgc2FtZSB2YWx1ZSAoc2VlICM3NDM0KQoJCQl2YXIgZXF1YWxWYWx1ZXMgPSB0aGlzLnRlcm0gPT09IHRoaXMuX3ZhbHVlKCksCgkJCQltZW51VmlzaWJsZSA9IHRoaXMubWVudS5lbGVtZW50LmlzKCAiOnZpc2libGUiICksCgkJCQltb2RpZmllcktleSA9IGV2ZW50LmFsdEtleSB8fCBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuc2hpZnRLZXk7CgoJCQlpZiAoICFlcXVhbFZhbHVlcyB8fCAoIGVxdWFsVmFsdWVzICYmICFtZW51VmlzaWJsZSAmJiAhbW9kaWZpZXJLZXkgKSApIHsKCQkJCXRoaXMuc2VsZWN0ZWRJdGVtID0gbnVsbDsKCQkJCXRoaXMuc2VhcmNoKCBudWxsLCBldmVudCApOwoJCQl9CgkJfSwgdGhpcy5vcHRpb25zLmRlbGF5ICk7Cgl9LAoKCXNlYXJjaDogZnVuY3Rpb24oIHZhbHVlLCBldmVudCApIHsKCQl2YWx1ZSA9IHZhbHVlICE9IG51bGwgPyB2YWx1ZSA6IHRoaXMuX3ZhbHVlKCk7CgoJCS8vIGFsd2F5cyBzYXZlIHRoZSBhY3R1YWwgdmFsdWUsIG5vdCB0aGUgb25lIHBhc3NlZCBhcyBhbiBhcmd1bWVudAoJCXRoaXMudGVybSA9IHRoaXMuX3ZhbHVlKCk7CgoJCWlmICggdmFsdWUubGVuZ3RoIDwgdGhpcy5vcHRpb25zLm1pbkxlbmd0aCApIHsKCQkJcmV0dXJuIHRoaXMuY2xvc2UoIGV2ZW50ICk7CgkJfQoKCQlpZiAoIHRoaXMuX3RyaWdnZXIoICJzZWFyY2giLCBldmVudCApID09PSBmYWxzZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJcmV0dXJuIHRoaXMuX3NlYXJjaCggdmFsdWUgKTsKCX0sCgoJX3NlYXJjaDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXRoaXMucGVuZGluZysrOwoJCXRoaXMuZWxlbWVudC5hZGRDbGFzcyggInVpLWF1dG9jb21wbGV0ZS1sb2FkaW5nIiApOwoJCXRoaXMuY2FuY2VsU2VhcmNoID0gZmFsc2U7CgoJCXRoaXMuc291cmNlKCB7IHRlcm06IHZhbHVlIH0sIHRoaXMuX3Jlc3BvbnNlKCkgKTsKCX0sCgoJX3Jlc3BvbnNlOiBmdW5jdGlvbigpIHsKCQl2YXIgaW5kZXggPSArK3RoaXMucmVxdWVzdEluZGV4OwoKCQlyZXR1cm4gJC5wcm94eShmdW5jdGlvbiggY29udGVudCApIHsKCQkJaWYgKCBpbmRleCA9PT0gdGhpcy5yZXF1ZXN0SW5kZXggKSB7CgkJCQl0aGlzLl9fcmVzcG9uc2UoIGNvbnRlbnQgKTsKCQkJfQoKCQkJdGhpcy5wZW5kaW5nLS07CgkJCWlmICggIXRoaXMucGVuZGluZyApIHsKCQkJCXRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyggInVpLWF1dG9jb21wbGV0ZS1sb2FkaW5nIiApOwoJCQl9CgkJfSwgdGhpcyApOwoJfSwKCglfX3Jlc3BvbnNlOiBmdW5jdGlvbiggY29udGVudCApIHsKCQlpZiAoIGNvbnRlbnQgKSB7CgkJCWNvbnRlbnQgPSB0aGlzLl9ub3JtYWxpemUoIGNvbnRlbnQgKTsKCQl9CgkJdGhpcy5fdHJpZ2dlciggInJlc3BvbnNlIiwgbnVsbCwgeyBjb250ZW50OiBjb250ZW50IH0gKTsKCQlpZiAoICF0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgY29udGVudCAmJiBjb250ZW50Lmxlbmd0aCAmJiAhdGhpcy5jYW5jZWxTZWFyY2ggKSB7CgkJCXRoaXMuX3N1Z2dlc3QoIGNvbnRlbnQgKTsKCQkJdGhpcy5fdHJpZ2dlciggIm9wZW4iICk7CgkJfSBlbHNlIHsKCQkJLy8gdXNlIC5fY2xvc2UoKSBpbnN0ZWFkIG9mIC5jbG9zZSgpIHNvIHdlIGRvbid0IGNhbmNlbCBmdXR1cmUgc2VhcmNoZXMKCQkJdGhpcy5fY2xvc2UoKTsKCQl9Cgl9LAoKCWNsb3NlOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdGhpcy5jYW5jZWxTZWFyY2ggPSB0cnVlOwoJCXRoaXMuX2Nsb3NlKCBldmVudCApOwoJfSwKCglfY2xvc2U6IGZ1bmN0aW9uKCBldmVudCApIHsKCQlpZiAoIHRoaXMubWVudS5lbGVtZW50LmlzKCAiOnZpc2libGUiICkgKSB7CgkJCXRoaXMubWVudS5lbGVtZW50LmhpZGUoKTsKCQkJdGhpcy5tZW51LmJsdXIoKTsKCQkJdGhpcy5pc05ld01lbnUgPSB0cnVlOwoJCQl0aGlzLl90cmlnZ2VyKCAiY2xvc2UiLCBldmVudCApOwoJCX0KCX0sCgoJX2NoYW5nZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCWlmICggdGhpcy5wcmV2aW91cyAhPT0gdGhpcy5fdmFsdWUoKSApIHsKCQkJdGhpcy5fdHJpZ2dlciggImNoYW5nZSIsIGV2ZW50LCB7IGl0ZW06IHRoaXMuc2VsZWN0ZWRJdGVtIH0gKTsKCQl9Cgl9LAoKCV9ub3JtYWxpemU6IGZ1bmN0aW9uKCBpdGVtcyApIHsKCQkvLyBhc3N1bWUgYWxsIGl0ZW1zIGhhdmUgdGhlIHJpZ2h0IGZvcm1hdCB3aGVuIHRoZSBmaXJzdCBpdGVtIGlzIGNvbXBsZXRlCgkJaWYgKCBpdGVtcy5sZW5ndGggJiYgaXRlbXNbIDAgXS5sYWJlbCAmJiBpdGVtc1sgMCBdLnZhbHVlICkgewoJCQlyZXR1cm4gaXRlbXM7CgkJfQoJCXJldHVybiAkLm1hcCggaXRlbXMsIGZ1bmN0aW9uKCBpdGVtICkgewoJCQlpZiAoIHR5cGVvZiBpdGVtID09PSAic3RyaW5nIiApIHsKCQkJCXJldHVybiB7CgkJCQkJbGFiZWw6IGl0ZW0sCgkJCQkJdmFsdWU6IGl0ZW0KCQkJCX07CgkJCX0KCQkJcmV0dXJuICQuZXh0ZW5kKCB7fSwgaXRlbSwgewoJCQkJbGFiZWw6IGl0ZW0ubGFiZWwgfHwgaXRlbS52YWx1ZSwKCQkJCXZhbHVlOiBpdGVtLnZhbHVlIHx8IGl0ZW0ubGFiZWwKCQkJfSk7CgkJfSk7Cgl9LAoKCV9zdWdnZXN0OiBmdW5jdGlvbiggaXRlbXMgKSB7CgkJdmFyIHVsID0gdGhpcy5tZW51LmVsZW1lbnQuZW1wdHkoKTsKCQl0aGlzLl9yZW5kZXJNZW51KCB1bCwgaXRlbXMgKTsKCQl0aGlzLmlzTmV3TWVudSA9IHRydWU7CgkJdGhpcy5tZW51LnJlZnJlc2goKTsKCgkJLy8gc2l6ZSBhbmQgcG9zaXRpb24gbWVudQoJCXVsLnNob3coKTsKCQl0aGlzLl9yZXNpemVNZW51KCk7CgkJdWwucG9zaXRpb24oICQuZXh0ZW5kKHsKCQkJb2Y6IHRoaXMuZWxlbWVudAoJCX0sIHRoaXMub3B0aW9ucy5wb3NpdGlvbiApICk7CgoJCWlmICggdGhpcy5vcHRpb25zLmF1dG9Gb2N1cyApIHsKCQkJdGhpcy5tZW51Lm5leHQoKTsKCQl9Cgl9LAoKCV9yZXNpemVNZW51OiBmdW5jdGlvbigpIHsKCQl2YXIgdWwgPSB0aGlzLm1lbnUuZWxlbWVudDsKCQl1bC5vdXRlcldpZHRoKCBNYXRoLm1heCgKCQkJLy8gRmlyZWZveCB3cmFwcyBsb25nIHRleHQgKHBvc3NpYmx5IGEgcm91bmRpbmcgYnVnKQoJCQkvLyBzbyB3ZSBhZGQgMXB4IHRvIGF2b2lkIHRoZSB3cmFwcGluZyAoIzc1MTMpCgkJCXVsLndpZHRoKCAiIiApLm91dGVyV2lkdGgoKSArIDEsCgkJCXRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCkKCQkpICk7Cgl9LAoKCV9yZW5kZXJNZW51OiBmdW5jdGlvbiggdWwsIGl0ZW1zICkgewoJCXZhciB0aGF0ID0gdGhpczsKCQkkLmVhY2goIGl0ZW1zLCBmdW5jdGlvbiggaW5kZXgsIGl0ZW0gKSB7CgkJCXRoYXQuX3JlbmRlckl0ZW1EYXRhKCB1bCwgaXRlbSApOwoJCX0pOwoJfSwKCglfcmVuZGVySXRlbURhdGE6IGZ1bmN0aW9uKCB1bCwgaXRlbSApIHsKCQlyZXR1cm4gdGhpcy5fcmVuZGVySXRlbSggdWwsIGl0ZW0gKS5kYXRhKCAidWktYXV0b2NvbXBsZXRlLWl0ZW0iLCBpdGVtICk7Cgl9LAoKCV9yZW5kZXJJdGVtOiBmdW5jdGlvbiggdWwsIGl0ZW0gKSB7CgkJcmV0dXJuICQoICI8bGk+IiApLnRleHQoIGl0ZW0ubGFiZWwgKS5hcHBlbmRUbyggdWwgKTsKCX0sCgoJX21vdmU6IGZ1bmN0aW9uKCBkaXJlY3Rpb24sIGV2ZW50ICkgewoJCWlmICggIXRoaXMubWVudS5lbGVtZW50LmlzKCAiOnZpc2libGUiICkgKSB7CgkJCXRoaXMuc2VhcmNoKCBudWxsLCBldmVudCApOwoJCQlyZXR1cm47CgkJfQoJCWlmICggdGhpcy5tZW51LmlzRmlyc3RJdGVtKCkgJiYgL15wcmV2aW91cy8udGVzdCggZGlyZWN0aW9uICkgfHwKCQkJCXRoaXMubWVudS5pc0xhc3RJdGVtKCkgJiYgL15uZXh0Ly50ZXN0KCBkaXJlY3Rpb24gKSApIHsKCgkJCWlmICggIXRoaXMuaXNNdWx0aUxpbmUgKSB7CgkJCQl0aGlzLl92YWx1ZSggdGhpcy50ZXJtICk7CgkJCX0KCgkJCXRoaXMubWVudS5ibHVyKCk7CgkJCXJldHVybjsKCQl9CgkJdGhpcy5tZW51WyBkaXJlY3Rpb24gXSggZXZlbnQgKTsKCX0sCgoJd2lkZ2V0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5tZW51LmVsZW1lbnQ7Cgl9LAoKCV92YWx1ZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMudmFsdWVNZXRob2QuYXBwbHkoIHRoaXMuZWxlbWVudCwgYXJndW1lbnRzICk7Cgl9LAoKCV9rZXlFdmVudDogZnVuY3Rpb24oIGtleUV2ZW50LCBldmVudCApIHsKCQlpZiAoICF0aGlzLmlzTXVsdGlMaW5lIHx8IHRoaXMubWVudS5lbGVtZW50LmlzKCAiOnZpc2libGUiICkgKSB7CgkJCXRoaXMuX21vdmUoIGtleUV2ZW50LCBldmVudCApOwoKCQkJLy8gcHJldmVudHMgbW92aW5nIGN1cnNvciB0byBiZWdpbm5pbmcvZW5kIG9mIHRoZSB0ZXh0IGZpZWxkIGluIHNvbWUgYnJvd3NlcnMKCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQl9Cgl9Cn0pOwoKJC5leHRlbmQoICQudWkuYXV0b2NvbXBsZXRlLCB7Cgllc2NhcGVSZWdleDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXJldHVybiB2YWx1ZS5yZXBsYWNlKCAvW1wtXFtcXXt9KCkqKz8uLFxcXF4kfCNcc10vZywgIlxcJCYiICk7Cgl9LAoJZmlsdGVyOiBmdW5jdGlvbiggYXJyYXksIHRlcm0gKSB7CgkJdmFyIG1hdGNoZXIgPSBuZXcgUmVnRXhwKCAkLnVpLmF1dG9jb21wbGV0ZS5lc2NhcGVSZWdleCggdGVybSApLCAiaSIgKTsKCQlyZXR1cm4gJC5ncmVwKCBhcnJheSwgZnVuY3Rpb24oIHZhbHVlICkgewoJCQlyZXR1cm4gbWF0Y2hlci50ZXN0KCB2YWx1ZS5sYWJlbCB8fCB2YWx1ZS52YWx1ZSB8fCB2YWx1ZSApOwoJCX0pOwoJfQp9KTsKCi8vIGxpdmUgcmVnaW9uIGV4dGVuc2lvbiwgYWRkaW5nIGEgYG1lc3NhZ2VzYCBvcHRpb24KLy8gTk9URTogVGhpcyBpcyBhbiBleHBlcmltZW50YWwgQVBJLiBXZSBhcmUgc3RpbGwgaW52ZXN0aWdhdGluZwovLyBhIGZ1bGwgc29sdXRpb24gZm9yIHN0cmluZyBtYW5pcHVsYXRpb24gYW5kIGludGVybmF0aW9uYWxpemF0aW9uLgokLndpZGdldCggInVpLmF1dG9jb21wbGV0ZSIsICQudWkuYXV0b2NvbXBsZXRlLCB7CglvcHRpb25zOiB7CgkJbWVzc2FnZXM6IHsKCQkJbm9SZXN1bHRzOiAiTm8gc2VhcmNoIHJlc3VsdHMuIiwKCQkJcmVzdWx0czogZnVuY3Rpb24oIGFtb3VudCApIHsKCQkJCXJldHVybiBhbW91bnQgKyAoIGFtb3VudCA+IDEgPyAiIHJlc3VsdHMgYXJlIiA6ICIgcmVzdWx0IGlzIiApICsKCQkJCQkiIGF2YWlsYWJsZSwgdXNlIHVwIGFuZCBkb3duIGFycm93IGtleXMgdG8gbmF2aWdhdGUuIjsKCQkJfQoJCX0KCX0sCgoJX19yZXNwb25zZTogZnVuY3Rpb24oIGNvbnRlbnQgKSB7CgkJdmFyIG1lc3NhZ2U7CgkJdGhpcy5fc3VwZXJBcHBseSggYXJndW1lbnRzICk7CgkJaWYgKCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgfHwgdGhpcy5jYW5jZWxTZWFyY2ggKSB7CgkJCXJldHVybjsKCQl9CgkJaWYgKCBjb250ZW50ICYmIGNvbnRlbnQubGVuZ3RoICkgewoJCQltZXNzYWdlID0gdGhpcy5vcHRpb25zLm1lc3NhZ2VzLnJlc3VsdHMoIGNvbnRlbnQubGVuZ3RoICk7CgkJfSBlbHNlIHsKCQkJbWVzc2FnZSA9IHRoaXMub3B0aW9ucy5tZXNzYWdlcy5ub1Jlc3VsdHM7CgkJfQoJCXRoaXMubGl2ZVJlZ2lvbi5jaGlsZHJlbigpLmhpZGUoKTsKCQkkKCAiPGRpdj4iICkudGV4dCggbWVzc2FnZSApLmFwcGVuZFRvKCB0aGlzLmxpdmVSZWdpb24gKTsKCX0KfSk7Cgp2YXIgYXV0b2NvbXBsZXRlID0gJC51aS5hdXRvY29tcGxldGU7CgoKLyohCiAqIGpRdWVyeSBVSSBCdXR0b24gMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vYnV0dG9uLwogKi8KCgp2YXIgbGFzdEFjdGl2ZSwKCWJhc2VDbGFzc2VzID0gInVpLWJ1dHRvbiB1aS13aWRnZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIiwKCXR5cGVDbGFzc2VzID0gInVpLWJ1dHRvbi1pY29ucy1vbmx5IHVpLWJ1dHRvbi1pY29uLW9ubHkgdWktYnV0dG9uLXRleHQtaWNvbnMgdWktYnV0dG9uLXRleHQtaWNvbi1wcmltYXJ5IHVpLWJ1dHRvbi10ZXh0LWljb24tc2Vjb25kYXJ5IHVpLWJ1dHRvbi10ZXh0LW9ubHkiLAoJZm9ybVJlc2V0SGFuZGxlciA9IGZ1bmN0aW9uKCkgewoJCXZhciBmb3JtID0gJCggdGhpcyApOwoJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCWZvcm0uZmluZCggIjp1aS1idXR0b24iICkuYnV0dG9uKCAicmVmcmVzaCIgKTsKCQl9LCAxICk7Cgl9LAoJcmFkaW9Hcm91cCA9IGZ1bmN0aW9uKCByYWRpbyApIHsKCQl2YXIgbmFtZSA9IHJhZGlvLm5hbWUsCgkJCWZvcm0gPSByYWRpby5mb3JtLAoJCQlyYWRpb3MgPSAkKCBbXSApOwoJCWlmICggbmFtZSApIHsKCQkJbmFtZSA9IG5hbWUucmVwbGFjZSggLycvZywgIlxcJyIgKTsKCQkJaWYgKCBmb3JtICkgewoJCQkJcmFkaW9zID0gJCggZm9ybSApLmZpbmQoICJbbmFtZT0nIiArIG5hbWUgKyAiJ11bdHlwZT1yYWRpb10iICk7CgkJCX0gZWxzZSB7CgkJCQlyYWRpb3MgPSAkKCAiW25hbWU9JyIgKyBuYW1lICsgIiddW3R5cGU9cmFkaW9dIiwgcmFkaW8ub3duZXJEb2N1bWVudCApCgkJCQkJLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuICF0aGlzLmZvcm07CgkJCQkJfSk7CgkJCX0KCQl9CgkJcmV0dXJuIHJhZGlvczsKCX07CgokLndpZGdldCggInVpLmJ1dHRvbiIsIHsKCXZlcnNpb246ICIxLjExLjEiLAoJZGVmYXVsdEVsZW1lbnQ6ICI8YnV0dG9uPiIsCglvcHRpb25zOiB7CgkJZGlzYWJsZWQ6IG51bGwsCgkJdGV4dDogdHJ1ZSwKCQlsYWJlbDogbnVsbCwKCQlpY29uczogewoJCQlwcmltYXJ5OiBudWxsLAoJCQlzZWNvbmRhcnk6IG51bGwKCQl9Cgl9LAoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgkJdGhpcy5lbGVtZW50LmNsb3Nlc3QoICJmb3JtIiApCgkJCS51bmJpbmQoICJyZXNldCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlICkKCQkJLmJpbmQoICJyZXNldCIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmb3JtUmVzZXRIYW5kbGVyICk7CgoJCWlmICggdHlwZW9mIHRoaXMub3B0aW9ucy5kaXNhYmxlZCAhPT0gImJvb2xlYW4iICkgewoJCQl0aGlzLm9wdGlvbnMuZGlzYWJsZWQgPSAhIXRoaXMuZWxlbWVudC5wcm9wKCAiZGlzYWJsZWQiICk7CgkJfSBlbHNlIHsKCQkJdGhpcy5lbGVtZW50LnByb3AoICJkaXNhYmxlZCIsIHRoaXMub3B0aW9ucy5kaXNhYmxlZCApOwoJCX0KCgkJdGhpcy5fZGV0ZXJtaW5lQnV0dG9uVHlwZSgpOwoJCXRoaXMuaGFzVGl0bGUgPSAhIXRoaXMuYnV0dG9uRWxlbWVudC5hdHRyKCAidGl0bGUiICk7CgoJCXZhciB0aGF0ID0gdGhpcywKCQkJb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKCQkJdG9nZ2xlQnV0dG9uID0gdGhpcy50eXBlID09PSAiY2hlY2tib3giIHx8IHRoaXMudHlwZSA9PT0gInJhZGlvIiwKCQkJYWN0aXZlQ2xhc3MgPSAhdG9nZ2xlQnV0dG9uID8gInVpLXN0YXRlLWFjdGl2ZSIgOiAiIjsKCgkJaWYgKCBvcHRpb25zLmxhYmVsID09PSBudWxsICkgewoJCQlvcHRpb25zLmxhYmVsID0gKHRoaXMudHlwZSA9PT0gImlucHV0IiA/IHRoaXMuYnV0dG9uRWxlbWVudC52YWwoKSA6IHRoaXMuYnV0dG9uRWxlbWVudC5odG1sKCkpOwoJCX0KCgkJdGhpcy5faG92ZXJhYmxlKCB0aGlzLmJ1dHRvbkVsZW1lbnQgKTsKCgkJdGhpcy5idXR0b25FbGVtZW50CgkJCS5hZGRDbGFzcyggYmFzZUNsYXNzZXMgKQoJCQkuYXR0ciggInJvbGUiLCAiYnV0dG9uIiApCgkJCS5iaW5kKCAibW91c2VlbnRlciIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbigpIHsKCQkJCWlmICggb3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQlpZiAoIHRoaXMgPT09IGxhc3RBY3RpdmUgKSB7CgkJCQkJJCggdGhpcyApLmFkZENsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApOwoJCQkJfQoJCQl9KQoJCQkuYmluZCggIm1vdXNlbGVhdmUiICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oKSB7CgkJCQlpZiAoIG9wdGlvbnMuZGlzYWJsZWQgKSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJJCggdGhpcyApLnJlbW92ZUNsYXNzKCBhY3RpdmVDbGFzcyApOwoJCQl9KQoJCQkuYmluZCggImNsaWNrIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWlmICggb3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCWV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwoJCQkJfQoJCQl9KTsKCgkJLy8gQ2FuJ3QgdXNlIF9mb2N1c2FibGUoKSBiZWNhdXNlIHRoZSBlbGVtZW50IHRoYXQgcmVjZWl2ZXMgZm9jdXMKCQkvLyBhbmQgdGhlIGVsZW1lbnQgdGhhdCBnZXRzIHRoZSB1aS1zdGF0ZS1mb2N1cyBjbGFzcyBhcmUgZGlmZmVyZW50CgkJdGhpcy5fb24oewoJCQlmb2N1czogZnVuY3Rpb24oKSB7CgkJCQl0aGlzLmJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1mb2N1cyIgKTsKCQkJfSwKCQkJYmx1cjogZnVuY3Rpb24oKSB7CgkJCQl0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1mb2N1cyIgKTsKCQkJfQoJCX0pOwoKCQlpZiAoIHRvZ2dsZUJ1dHRvbiApIHsKCQkJdGhpcy5lbGVtZW50LmJpbmQoICJjaGFuZ2UiICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oKSB7CgkJCQl0aGF0LnJlZnJlc2goKTsKCQkJfSk7CgkJfQoKCQlpZiAoIHRoaXMudHlwZSA9PT0gImNoZWNrYm94IiApIHsKCQkJdGhpcy5idXR0b25FbGVtZW50LmJpbmQoICJjbGljayIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbigpIHsKCQkJCWlmICggb3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0pOwoJCX0gZWxzZSBpZiAoIHRoaXMudHlwZSA9PT0gInJhZGlvIiApIHsKCQkJdGhpcy5idXR0b25FbGVtZW50LmJpbmQoICJjbGljayIgKyB0aGlzLmV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbigpIHsKCQkJCWlmICggb3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCQkkKCB0aGlzICkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgkJCQl0aGF0LmJ1dHRvbkVsZW1lbnQuYXR0ciggImFyaWEtcHJlc3NlZCIsICJ0cnVlIiApOwoKCQkJCXZhciByYWRpbyA9IHRoYXQuZWxlbWVudFsgMCBdOwoJCQkJcmFkaW9Hcm91cCggcmFkaW8gKQoJCQkJCS5ub3QoIHJhZGlvICkKCQkJCQkubWFwKGZ1bmN0aW9uKCkgewoJCQkJCQlyZXR1cm4gJCggdGhpcyApLmJ1dHRvbiggIndpZGdldCIgKVsgMCBdOwoJCQkJCX0pCgkJCQkJLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApCgkJCQkJLmF0dHIoICJhcmlhLXByZXNzZWQiLCAiZmFsc2UiICk7CgkJCX0pOwoJCX0gZWxzZSB7CgkJCXRoaXMuYnV0dG9uRWxlbWVudAoJCQkJLmJpbmQoICJtb3VzZWRvd24iICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oKSB7CgkJCQkJaWYgKCBvcHRpb25zLmRpc2FibGVkICkgewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJCSQoIHRoaXMgKS5hZGRDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKTsKCQkJCQlsYXN0QWN0aXZlID0gdGhpczsKCQkJCQl0aGF0LmRvY3VtZW50Lm9uZSggIm1vdXNldXAiLCBmdW5jdGlvbigpIHsKCQkJCQkJbGFzdEFjdGl2ZSA9IG51bGw7CgkJCQkJfSk7CgkJCQl9KQoJCQkJLmJpbmQoICJtb3VzZXVwIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCkgewoJCQkJCWlmICggb3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCQkkKCB0aGlzICkucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgkJCQl9KQoJCQkJLmJpbmQoICJrZXlkb3duIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKGV2ZW50KSB7CgkJCQkJaWYgKCBvcHRpb25zLmRpc2FibGVkICkgewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJCWlmICggZXZlbnQua2V5Q29kZSA9PT0gJC51aS5rZXlDb2RlLlNQQUNFIHx8IGV2ZW50LmtleUNvZGUgPT09ICQudWkua2V5Q29kZS5FTlRFUiApIHsKCQkJCQkJJCggdGhpcyApLmFkZENsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApOwoJCQkJCX0KCQkJCX0pCgkJCQkvLyBzZWUgIzg1NTksIHdlIGJpbmQgdG8gYmx1ciBoZXJlIGluIGNhc2UgdGhlIGJ1dHRvbiBlbGVtZW50IGxvc2VzCgkJCQkvLyBmb2N1cyBiZXR3ZWVuIGtleWRvd24gYW5kIGtleXVwLCBpdCB3b3VsZCBiZSBsZWZ0IGluIGFuICJhY3RpdmUiIHN0YXRlCgkJCQkuYmluZCggImtleXVwIiArIHRoaXMuZXZlbnROYW1lc3BhY2UgKyAiIGJsdXIiICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oKSB7CgkJCQkJJCggdGhpcyApLnJlbW92ZUNsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApOwoJCQkJfSk7CgoJCQlpZiAoIHRoaXMuYnV0dG9uRWxlbWVudC5pcygiYSIpICkgewoJCQkJdGhpcy5idXR0b25FbGVtZW50LmtleXVwKGZ1bmN0aW9uKGV2ZW50KSB7CgkJCQkJaWYgKCBldmVudC5rZXlDb2RlID09PSAkLnVpLmtleUNvZGUuU1BBQ0UgKSB7CgkJCQkJCS8vIFRPRE8gcGFzcyB0aHJvdWdoIG9yaWdpbmFsIGV2ZW50IGNvcnJlY3RseSAoanVzdCBhcyAybmQgYXJndW1lbnQgZG9lc24ndCB3b3JrKQoJCQkJCQkkKCB0aGlzICkuY2xpY2soKTsKCQkJCQl9CgkJCQl9KTsKCQkJfQoJCX0KCgkJdGhpcy5fc2V0T3B0aW9uKCAiZGlzYWJsZWQiLCBvcHRpb25zLmRpc2FibGVkICk7CgkJdGhpcy5fcmVzZXRCdXR0b24oKTsKCX0sCgoJX2RldGVybWluZUJ1dHRvblR5cGU6IGZ1bmN0aW9uKCkgewoJCXZhciBhbmNlc3RvciwgbGFiZWxTZWxlY3RvciwgY2hlY2tlZDsKCgkJaWYgKCB0aGlzLmVsZW1lbnQuaXMoIlt0eXBlPWNoZWNrYm94XSIpICkgewoJCQl0aGlzLnR5cGUgPSAiY2hlY2tib3giOwoJCX0gZWxzZSBpZiAoIHRoaXMuZWxlbWVudC5pcygiW3R5cGU9cmFkaW9dIikgKSB7CgkJCXRoaXMudHlwZSA9ICJyYWRpbyI7CgkJfSBlbHNlIGlmICggdGhpcy5lbGVtZW50LmlzKCJpbnB1dCIpICkgewoJCQl0aGlzLnR5cGUgPSAiaW5wdXQiOwoJCX0gZWxzZSB7CgkJCXRoaXMudHlwZSA9ICJidXR0b24iOwoJCX0KCgkJaWYgKCB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgfHwgdGhpcy50eXBlID09PSAicmFkaW8iICkgewoJCQkvLyB3ZSBkb24ndCBzZWFyY2ggYWdhaW5zdCB0aGUgZG9jdW1lbnQgaW4gY2FzZSB0aGUgZWxlbWVudAoJCQkvLyBpcyBkaXNjb25uZWN0ZWQgZnJvbSB0aGUgRE9NCgkJCWFuY2VzdG9yID0gdGhpcy5lbGVtZW50LnBhcmVudHMoKS5sYXN0KCk7CgkJCWxhYmVsU2VsZWN0b3IgPSAibGFiZWxbZm9yPSciICsgdGhpcy5lbGVtZW50LmF0dHIoImlkIikgKyAiJ10iOwoJCQl0aGlzLmJ1dHRvbkVsZW1lbnQgPSBhbmNlc3Rvci5maW5kKCBsYWJlbFNlbGVjdG9yICk7CgkJCWlmICggIXRoaXMuYnV0dG9uRWxlbWVudC5sZW5ndGggKSB7CgkJCQlhbmNlc3RvciA9IGFuY2VzdG9yLmxlbmd0aCA/IGFuY2VzdG9yLnNpYmxpbmdzKCkgOiB0aGlzLmVsZW1lbnQuc2libGluZ3MoKTsKCQkJCXRoaXMuYnV0dG9uRWxlbWVudCA9IGFuY2VzdG9yLmZpbHRlciggbGFiZWxTZWxlY3RvciApOwoJCQkJaWYgKCAhdGhpcy5idXR0b25FbGVtZW50Lmxlbmd0aCApIHsKCQkJCQl0aGlzLmJ1dHRvbkVsZW1lbnQgPSBhbmNlc3Rvci5maW5kKCBsYWJlbFNlbGVjdG9yICk7CgkJCQl9CgkJCX0KCQkJdGhpcy5lbGVtZW50LmFkZENsYXNzKCAidWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIiApOwoKCQkJY2hlY2tlZCA9IHRoaXMuZWxlbWVudC5pcyggIjpjaGVja2VkIiApOwoJCQlpZiAoIGNoZWNrZWQgKSB7CgkJCQl0aGlzLmJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgkJCX0KCQkJdGhpcy5idXR0b25FbGVtZW50LnByb3AoICJhcmlhLXByZXNzZWQiLCBjaGVja2VkICk7CgkJfSBlbHNlIHsKCQkJdGhpcy5idXR0b25FbGVtZW50ID0gdGhpcy5lbGVtZW50OwoJCX0KCX0sCgoJd2lkZ2V0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5idXR0b25FbGVtZW50OwoJfSwKCglfZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJdGhpcy5lbGVtZW50CgkJCS5yZW1vdmVDbGFzcyggInVpLWhlbHBlci1oaWRkZW4tYWNjZXNzaWJsZSIgKTsKCQl0aGlzLmJ1dHRvbkVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCBiYXNlQ2xhc3NlcyArICIgdWktc3RhdGUtYWN0aXZlICIgKyB0eXBlQ2xhc3NlcyApCgkJCS5yZW1vdmVBdHRyKCAicm9sZSIgKQoJCQkucmVtb3ZlQXR0ciggImFyaWEtcHJlc3NlZCIgKQoJCQkuaHRtbCggdGhpcy5idXR0b25FbGVtZW50LmZpbmQoIi51aS1idXR0b24tdGV4dCIpLmh0bWwoKSApOwoKCQlpZiAoICF0aGlzLmhhc1RpdGxlICkgewoJCQl0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQXR0ciggInRpdGxlIiApOwoJCX0KCX0sCgoJX3NldE9wdGlvbjogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCQlpZiAoIGtleSA9PT0gImRpc2FibGVkIiApIHsKCQkJdGhpcy53aWRnZXQoKS50b2dnbGVDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiwgISF2YWx1ZSApOwoJCQl0aGlzLmVsZW1lbnQucHJvcCggImRpc2FibGVkIiwgISF2YWx1ZSApOwoJCQlpZiAoIHZhbHVlICkgewoJCQkJaWYgKCB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgfHwgdGhpcy50eXBlID09PSAicmFkaW8iICkgewoJCQkJCXRoaXMuYnV0dG9uRWxlbWVudC5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWZvY3VzIiApOwoJCQkJfSBlbHNlIHsKCQkJCQl0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1mb2N1cyB1aS1zdGF0ZS1hY3RpdmUiICk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuOwoJCX0KCQl0aGlzLl9yZXNldEJ1dHRvbigpOwoJfSwKCglyZWZyZXNoOiBmdW5jdGlvbigpIHsKCQkvL1NlZSAjODIzNyAmICM4ODI4CgkJdmFyIGlzRGlzYWJsZWQgPSB0aGlzLmVsZW1lbnQuaXMoICJpbnB1dCwgYnV0dG9uIiApID8gdGhpcy5lbGVtZW50LmlzKCAiOmRpc2FibGVkIiApIDogdGhpcy5lbGVtZW50Lmhhc0NsYXNzKCAidWktYnV0dG9uLWRpc2FibGVkIiApOwoKCQlpZiAoIGlzRGlzYWJsZWQgIT09IHRoaXMub3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJdGhpcy5fc2V0T3B0aW9uKCAiZGlzYWJsZWQiLCBpc0Rpc2FibGVkICk7CgkJfQoJCWlmICggdGhpcy50eXBlID09PSAicmFkaW8iICkgewoJCQlyYWRpb0dyb3VwKCB0aGlzLmVsZW1lbnRbMF0gKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJaWYgKCAkKCB0aGlzICkuaXMoICI6Y2hlY2tlZCIgKSApIHsKCQkJCQkkKCB0aGlzICkuYnV0dG9uKCAid2lkZ2V0IiApCgkJCQkJCS5hZGRDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKQoJCQkJCQkuYXR0ciggImFyaWEtcHJlc3NlZCIsICJ0cnVlIiApOwoJCQkJfSBlbHNlIHsKCQkJCQkkKCB0aGlzICkuYnV0dG9uKCAid2lkZ2V0IiApCgkJCQkJCS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKQoJCQkJCQkuYXR0ciggImFyaWEtcHJlc3NlZCIsICJmYWxzZSIgKTsKCQkJCX0KCQkJfSk7CgkJfSBlbHNlIGlmICggdGhpcy50eXBlID09PSAiY2hlY2tib3giICkgewoJCQlpZiAoIHRoaXMuZWxlbWVudC5pcyggIjpjaGVja2VkIiApICkgewoJCQkJdGhpcy5idXR0b25FbGVtZW50CgkJCQkJLmFkZENsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApCgkJCQkJLmF0dHIoICJhcmlhLXByZXNzZWQiLCAidHJ1ZSIgKTsKCQkJfSBlbHNlIHsKCQkJCXRoaXMuYnV0dG9uRWxlbWVudAoJCQkJCS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKQoJCQkJCS5hdHRyKCAiYXJpYS1wcmVzc2VkIiwgImZhbHNlIiApOwoJCQl9CgkJfQoJfSwKCglfcmVzZXRCdXR0b246IGZ1bmN0aW9uKCkgewoJCWlmICggdGhpcy50eXBlID09PSAiaW5wdXQiICkgewoJCQlpZiAoIHRoaXMub3B0aW9ucy5sYWJlbCApIHsKCQkJCXRoaXMuZWxlbWVudC52YWwoIHRoaXMub3B0aW9ucy5sYWJlbCApOwoJCQl9CgkJCXJldHVybjsKCQl9CgkJdmFyIGJ1dHRvbkVsZW1lbnQgPSB0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoIHR5cGVDbGFzc2VzICksCgkJCWJ1dHRvblRleHQgPSAkKCAiPHNwYW4+PC9zcGFuPiIsIHRoaXMuZG9jdW1lbnRbMF0gKQoJCQkJLmFkZENsYXNzKCAidWktYnV0dG9uLXRleHQiICkKCQkJCS5odG1sKCB0aGlzLm9wdGlvbnMubGFiZWwgKQoJCQkJLmFwcGVuZFRvKCBidXR0b25FbGVtZW50LmVtcHR5KCkgKQoJCQkJLnRleHQoKSwKCQkJaWNvbnMgPSB0aGlzLm9wdGlvbnMuaWNvbnMsCgkJCW11bHRpcGxlSWNvbnMgPSBpY29ucy5wcmltYXJ5ICYmIGljb25zLnNlY29uZGFyeSwKCQkJYnV0dG9uQ2xhc3NlcyA9IFtdOwoKCQlpZiAoIGljb25zLnByaW1hcnkgfHwgaWNvbnMuc2Vjb25kYXJ5ICkgewoJCQlpZiAoIHRoaXMub3B0aW9ucy50ZXh0ICkgewoJCQkJYnV0dG9uQ2xhc3Nlcy5wdXNoKCAidWktYnV0dG9uLXRleHQtaWNvbiIgKyAoIG11bHRpcGxlSWNvbnMgPyAicyIgOiAoIGljb25zLnByaW1hcnkgPyAiLXByaW1hcnkiIDogIi1zZWNvbmRhcnkiICkgKSApOwoJCQl9CgoJCQlpZiAoIGljb25zLnByaW1hcnkgKSB7CgkJCQlidXR0b25FbGVtZW50LnByZXBlbmQoICI8c3BhbiBjbGFzcz0ndWktYnV0dG9uLWljb24tcHJpbWFyeSB1aS1pY29uICIgKyBpY29ucy5wcmltYXJ5ICsgIic+PC9zcGFuPiIgKTsKCQkJfQoKCQkJaWYgKCBpY29ucy5zZWNvbmRhcnkgKSB7CgkJCQlidXR0b25FbGVtZW50LmFwcGVuZCggIjxzcGFuIGNsYXNzPSd1aS1idXR0b24taWNvbi1zZWNvbmRhcnkgdWktaWNvbiAiICsgaWNvbnMuc2Vjb25kYXJ5ICsgIic+PC9zcGFuPiIgKTsKCQkJfQoKCQkJaWYgKCAhdGhpcy5vcHRpb25zLnRleHQgKSB7CgkJCQlidXR0b25DbGFzc2VzLnB1c2goIG11bHRpcGxlSWNvbnMgPyAidWktYnV0dG9uLWljb25zLW9ubHkiIDogInVpLWJ1dHRvbi1pY29uLW9ubHkiICk7CgoJCQkJaWYgKCAhdGhpcy5oYXNUaXRsZSApIHsKCQkJCQlidXR0b25FbGVtZW50LmF0dHIoICJ0aXRsZSIsICQudHJpbSggYnV0dG9uVGV4dCApICk7CgkJCQl9CgkJCX0KCQl9IGVsc2UgewoJCQlidXR0b25DbGFzc2VzLnB1c2goICJ1aS1idXR0b24tdGV4dC1vbmx5IiApOwoJCX0KCQlidXR0b25FbGVtZW50LmFkZENsYXNzKCBidXR0b25DbGFzc2VzLmpvaW4oICIgIiApICk7Cgl9Cn0pOwoKJC53aWRnZXQoICJ1aS5idXR0b25zZXQiLCB7Cgl2ZXJzaW9uOiAiMS4xMS4xIiwKCW9wdGlvbnM6IHsKCQlpdGVtczogImJ1dHRvbiwgaW5wdXRbdHlwZT1idXR0b25dLCBpbnB1dFt0eXBlPXN1Ym1pdF0sIGlucHV0W3R5cGU9cmVzZXRdLCBpbnB1dFt0eXBlPWNoZWNrYm94XSwgaW5wdXRbdHlwZT1yYWRpb10sIGEsIDpkYXRhKHVpLWJ1dHRvbikiCgl9LAoKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoJCXRoaXMuZWxlbWVudC5hZGRDbGFzcyggInVpLWJ1dHRvbnNldCIgKTsKCX0sCgoJX2luaXQ6IGZ1bmN0aW9uKCkgewoJCXRoaXMucmVmcmVzaCgpOwoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQlpZiAoIGtleSA9PT0gImRpc2FibGVkIiApIHsKCQkJdGhpcy5idXR0b25zLmJ1dHRvbiggIm9wdGlvbiIsIGtleSwgdmFsdWUgKTsKCQl9CgoJCXRoaXMuX3N1cGVyKCBrZXksIHZhbHVlICk7Cgl9LAoKCXJlZnJlc2g6IGZ1bmN0aW9uKCkgewoJCXZhciBydGwgPSB0aGlzLmVsZW1lbnQuY3NzKCAiZGlyZWN0aW9uIiApID09PSAicnRsIiwKCQkJYWxsQnV0dG9ucyA9IHRoaXMuZWxlbWVudC5maW5kKCB0aGlzLm9wdGlvbnMuaXRlbXMgKSwKCQkJZXhpc3RpbmdCdXR0b25zID0gYWxsQnV0dG9ucy5maWx0ZXIoICI6dWktYnV0dG9uIiApOwoKCQkvLyBJbml0aWFsaXplIG5ldyBidXR0b25zCgkJYWxsQnV0dG9ucy5ub3QoICI6dWktYnV0dG9uIiApLmJ1dHRvbigpOwoKCQkvLyBSZWZyZXNoIGV4aXN0aW5nIGJ1dHRvbnMKCQlleGlzdGluZ0J1dHRvbnMuYnV0dG9uKCAicmVmcmVzaCIgKTsKCgkJdGhpcy5idXR0b25zID0gYWxsQnV0dG9ucwoJCQkubWFwKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICQoIHRoaXMgKS5idXR0b24oICJ3aWRnZXQiIClbIDAgXTsKCQkJfSkKCQkJCS5yZW1vdmVDbGFzcyggInVpLWNvcm5lci1hbGwgdWktY29ybmVyLWxlZnQgdWktY29ybmVyLXJpZ2h0IiApCgkJCQkuZmlsdGVyKCAiOmZpcnN0IiApCgkJCQkJLmFkZENsYXNzKCBydGwgPyAidWktY29ybmVyLXJpZ2h0IiA6ICJ1aS1jb3JuZXItbGVmdCIgKQoJCQkJLmVuZCgpCgkJCQkuZmlsdGVyKCAiOmxhc3QiICkKCQkJCQkuYWRkQ2xhc3MoIHJ0bCA/ICJ1aS1jb3JuZXItbGVmdCIgOiAidWktY29ybmVyLXJpZ2h0IiApCgkJCQkuZW5kKCkKCQkJLmVuZCgpOwoJfSwKCglfZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCAidWktYnV0dG9uc2V0IiApOwoJCXRoaXMuYnV0dG9ucwoJCQkubWFwKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICQoIHRoaXMgKS5idXR0b24oICJ3aWRnZXQiIClbIDAgXTsKCQkJfSkKCQkJCS5yZW1vdmVDbGFzcyggInVpLWNvcm5lci1sZWZ0IHVpLWNvcm5lci1yaWdodCIgKQoJCQkuZW5kKCkKCQkJLmJ1dHRvbiggImRlc3Ryb3kiICk7Cgl9Cn0pOwoKdmFyIGJ1dHRvbiA9ICQudWkuYnV0dG9uOwoKCi8qIQogKiBqUXVlcnkgVUkgRGF0ZXBpY2tlciAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9kYXRlcGlja2VyLwogKi8KCgokLmV4dGVuZCgkLnVpLCB7IGRhdGVwaWNrZXI6IHsgdmVyc2lvbjogIjEuMTEuMSIgfSB9KTsKCnZhciBkYXRlcGlja2VyX2luc3RBY3RpdmU7CgpmdW5jdGlvbiBkYXRlcGlja2VyX2dldFppbmRleCggZWxlbSApIHsKCXZhciBwb3NpdGlvbiwgdmFsdWU7Cgl3aGlsZSAoIGVsZW0ubGVuZ3RoICYmIGVsZW1bIDAgXSAhPT0gZG9jdW1lbnQgKSB7CgkJLy8gSWdub3JlIHotaW5kZXggaWYgcG9zaXRpb24gaXMgc2V0IHRvIGEgdmFsdWUgd2hlcmUgei1pbmRleCBpcyBpZ25vcmVkIGJ5IHRoZSBicm93c2VyCgkJLy8gVGhpcyBtYWtlcyBiZWhhdmlvciBvZiB0aGlzIGZ1bmN0aW9uIGNvbnNpc3RlbnQgYWNyb3NzIGJyb3dzZXJzCgkJLy8gV2ViS2l0IGFsd2F5cyByZXR1cm5zIGF1dG8gaWYgdGhlIGVsZW1lbnQgaXMgcG9zaXRpb25lZAoJCXBvc2l0aW9uID0gZWxlbS5jc3MoICJwb3NpdGlvbiIgKTsKCQlpZiAoIHBvc2l0aW9uID09PSAiYWJzb2x1dGUiIHx8IHBvc2l0aW9uID09PSAicmVsYXRpdmUiIHx8IHBvc2l0aW9uID09PSAiZml4ZWQiICkgewoJCQkvLyBJRSByZXR1cm5zIDAgd2hlbiB6SW5kZXggaXMgbm90IHNwZWNpZmllZAoJCQkvLyBvdGhlciBicm93c2VycyByZXR1cm4gYSBzdHJpbmcKCQkJLy8gd2UgaWdub3JlIHRoZSBjYXNlIG9mIG5lc3RlZCBlbGVtZW50cyB3aXRoIGFuIGV4cGxpY2l0IHZhbHVlIG9mIDAKCQkJLy8gPGRpdiBzdHlsZT0iei1pbmRleDogLTEwOyI+PGRpdiBzdHlsZT0iei1pbmRleDogMDsiPjwvZGl2PjwvZGl2PgoJCQl2YWx1ZSA9IHBhcnNlSW50KCBlbGVtLmNzcyggInpJbmRleCIgKSwgMTAgKTsKCQkJaWYgKCAhaXNOYU4oIHZhbHVlICkgJiYgdmFsdWUgIT09IDAgKSB7CgkJCQlyZXR1cm4gdmFsdWU7CgkJCX0KCQl9CgkJZWxlbSA9IGVsZW0ucGFyZW50KCk7Cgl9CgoJcmV0dXJuIDA7Cn0KLyogRGF0ZSBwaWNrZXIgbWFuYWdlci4KICAgVXNlIHRoZSBzaW5nbGV0b24gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcywgJC5kYXRlcGlja2VyLCB0byBpbnRlcmFjdCB3aXRoIHRoZSBkYXRlIHBpY2tlci4KICAgU2V0dGluZ3MgZm9yIChncm91cHMgb2YpIGRhdGUgcGlja2VycyBhcmUgbWFpbnRhaW5lZCBpbiBhbiBpbnN0YW5jZSBvYmplY3QsCiAgIGFsbG93aW5nIG11bHRpcGxlIGRpZmZlcmVudCBzZXR0aW5ncyBvbiB0aGUgc2FtZSBwYWdlLiAqLwoKZnVuY3Rpb24gRGF0ZXBpY2tlcigpIHsKCXRoaXMuX2N1ckluc3QgPSBudWxsOyAvLyBUaGUgY3VycmVudCBpbnN0YW5jZSBpbiB1c2UKCXRoaXMuX2tleUV2ZW50ID0gZmFsc2U7IC8vIElmIHRoZSBsYXN0IGV2ZW50IHdhcyBhIGtleSBldmVudAoJdGhpcy5fZGlzYWJsZWRJbnB1dHMgPSBbXTsgLy8gTGlzdCBvZiBkYXRlIHBpY2tlciBpbnB1dHMgdGhhdCBoYXZlIGJlZW4gZGlzYWJsZWQKCXRoaXMuX2RhdGVwaWNrZXJTaG93aW5nID0gZmFsc2U7IC8vIFRydWUgaWYgdGhlIHBvcHVwIHBpY2tlciBpcyBzaG93aW5nICwgZmFsc2UgaWYgbm90Cgl0aGlzLl9pbkRpYWxvZyA9IGZhbHNlOyAvLyBUcnVlIGlmIHNob3dpbmcgd2l0aGluIGEgImRpYWxvZyIsIGZhbHNlIGlmIG5vdAoJdGhpcy5fbWFpbkRpdklkID0gInVpLWRhdGVwaWNrZXItZGl2IjsgLy8gVGhlIElEIG9mIHRoZSBtYWluIGRhdGVwaWNrZXIgZGl2aXNpb24KCXRoaXMuX2lubGluZUNsYXNzID0gInVpLWRhdGVwaWNrZXItaW5saW5lIjsgLy8gVGhlIG5hbWUgb2YgdGhlIGlubGluZSBtYXJrZXIgY2xhc3MKCXRoaXMuX2FwcGVuZENsYXNzID0gInVpLWRhdGVwaWNrZXItYXBwZW5kIjsgLy8gVGhlIG5hbWUgb2YgdGhlIGFwcGVuZCBtYXJrZXIgY2xhc3MKCXRoaXMuX3RyaWdnZXJDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLXRyaWdnZXIiOyAvLyBUaGUgbmFtZSBvZiB0aGUgdHJpZ2dlciBtYXJrZXIgY2xhc3MKCXRoaXMuX2RpYWxvZ0NsYXNzID0gInVpLWRhdGVwaWNrZXItZGlhbG9nIjsgLy8gVGhlIG5hbWUgb2YgdGhlIGRpYWxvZyBtYXJrZXIgY2xhc3MKCXRoaXMuX2Rpc2FibGVDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLWRpc2FibGVkIjsgLy8gVGhlIG5hbWUgb2YgdGhlIGRpc2FibGVkIGNvdmVyaW5nIG1hcmtlciBjbGFzcwoJdGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3MgPSAidWktZGF0ZXBpY2tlci11bnNlbGVjdGFibGUiOyAvLyBUaGUgbmFtZSBvZiB0aGUgdW5zZWxlY3RhYmxlIGNlbGwgbWFya2VyIGNsYXNzCgl0aGlzLl9jdXJyZW50Q2xhc3MgPSAidWktZGF0ZXBpY2tlci1jdXJyZW50LWRheSI7IC8vIFRoZSBuYW1lIG9mIHRoZSBjdXJyZW50IGRheSBtYXJrZXIgY2xhc3MKCXRoaXMuX2RheU92ZXJDbGFzcyA9ICJ1aS1kYXRlcGlja2VyLWRheXMtY2VsbC1vdmVyIjsgLy8gVGhlIG5hbWUgb2YgdGhlIGRheSBob3ZlciBtYXJrZXIgY2xhc3MKCXRoaXMucmVnaW9uYWwgPSBbXTsgLy8gQXZhaWxhYmxlIHJlZ2lvbmFsIHNldHRpbmdzLCBpbmRleGVkIGJ5IGxhbmd1YWdlIGNvZGUKCXRoaXMucmVnaW9uYWxbIiJdID0geyAvLyBEZWZhdWx0IHJlZ2lvbmFsIHNldHRpbmdzCgkJY2xvc2VUZXh0OiAiRG9uZSIsIC8vIERpc3BsYXkgdGV4dCBmb3IgY2xvc2UgbGluawoJCXByZXZUZXh0OiAiUHJldiIsIC8vIERpc3BsYXkgdGV4dCBmb3IgcHJldmlvdXMgbW9udGggbGluawoJCW5leHRUZXh0OiAiTmV4dCIsIC8vIERpc3BsYXkgdGV4dCBmb3IgbmV4dCBtb250aCBsaW5rCgkJY3VycmVudFRleHQ6ICJUb2RheSIsIC8vIERpc3BsYXkgdGV4dCBmb3IgY3VycmVudCBtb250aCBsaW5rCgkJbW9udGhOYW1lczogWyJKYW51YXJ5IiwiRmVicnVhcnkiLCJNYXJjaCIsIkFwcmlsIiwiTWF5IiwiSnVuZSIsCgkJCSJKdWx5IiwiQXVndXN0IiwiU2VwdGVtYmVyIiwiT2N0b2JlciIsIk5vdmVtYmVyIiwiRGVjZW1iZXIiXSwgLy8gTmFtZXMgb2YgbW9udGhzIGZvciBkcm9wLWRvd24gYW5kIGZvcm1hdHRpbmcKCQltb250aE5hbWVzU2hvcnQ6IFsiSmFuIiwgIkZlYiIsICJNYXIiLCAiQXByIiwgIk1heSIsICJKdW4iLCAiSnVsIiwgIkF1ZyIsICJTZXAiLCAiT2N0IiwgIk5vdiIsICJEZWMiXSwgLy8gRm9yIGZvcm1hdHRpbmcKCQlkYXlOYW1lczogWyJTdW5kYXkiLCAiTW9uZGF5IiwgIlR1ZXNkYXkiLCAiV2VkbmVzZGF5IiwgIlRodXJzZGF5IiwgIkZyaWRheSIsICJTYXR1cmRheSJdLCAvLyBGb3IgZm9ybWF0dGluZwoJCWRheU5hbWVzU2hvcnQ6IFsiU3VuIiwgIk1vbiIsICJUdWUiLCAiV2VkIiwgIlRodSIsICJGcmkiLCAiU2F0Il0sIC8vIEZvciBmb3JtYXR0aW5nCgkJZGF5TmFtZXNNaW46IFsiU3UiLCJNbyIsIlR1IiwiV2UiLCJUaCIsIkZyIiwiU2EiXSwgLy8gQ29sdW1uIGhlYWRpbmdzIGZvciBkYXlzIHN0YXJ0aW5nIGF0IFN1bmRheQoJCXdlZWtIZWFkZXI6ICJXayIsIC8vIENvbHVtbiBoZWFkZXIgZm9yIHdlZWsgb2YgdGhlIHllYXIKCQlkYXRlRm9ybWF0OiAibW0vZGQveXkiLCAvLyBTZWUgZm9ybWF0IG9wdGlvbnMgb24gcGFyc2VEYXRlCgkJZmlyc3REYXk6IDAsIC8vIFRoZSBmaXJzdCBkYXkgb2YgdGhlIHdlZWssIFN1biA9IDAsIE1vbiA9IDEsIC4uLgoJCWlzUlRMOiBmYWxzZSwgLy8gVHJ1ZSBpZiByaWdodC10by1sZWZ0IGxhbmd1YWdlLCBmYWxzZSBpZiBsZWZ0LXRvLXJpZ2h0CgkJc2hvd01vbnRoQWZ0ZXJZZWFyOiBmYWxzZSwgLy8gVHJ1ZSBpZiB0aGUgeWVhciBzZWxlY3QgcHJlY2VkZXMgbW9udGgsIGZhbHNlIGZvciBtb250aCB0aGVuIHllYXIKCQl5ZWFyU3VmZml4OiAiIiAvLyBBZGRpdGlvbmFsIHRleHQgdG8gYXBwZW5kIHRvIHRoZSB5ZWFyIGluIHRoZSBtb250aCBoZWFkZXJzCgl9OwoJdGhpcy5fZGVmYXVsdHMgPSB7IC8vIEdsb2JhbCBkZWZhdWx0cyBmb3IgYWxsIHRoZSBkYXRlIHBpY2tlciBpbnN0YW5jZXMKCQlzaG93T246ICJmb2N1cyIsIC8vICJmb2N1cyIgZm9yIHBvcHVwIG9uIGZvY3VzLAoJCQkvLyAiYnV0dG9uIiBmb3IgdHJpZ2dlciBidXR0b24sIG9yICJib3RoIiBmb3IgZWl0aGVyCgkJc2hvd0FuaW06ICJmYWRlSW4iLCAvLyBOYW1lIG9mIGpRdWVyeSBhbmltYXRpb24gZm9yIHBvcHVwCgkJc2hvd09wdGlvbnM6IHt9LCAvLyBPcHRpb25zIGZvciBlbmhhbmNlZCBhbmltYXRpb25zCgkJZGVmYXVsdERhdGU6IG51bGwsIC8vIFVzZWQgd2hlbiBmaWVsZCBpcyBibGFuazogYWN0dWFsIGRhdGUsCgkJCS8vICsvLW51bWJlciBmb3Igb2Zmc2V0IGZyb20gdG9kYXksIG51bGwgZm9yIHRvZGF5CgkJYXBwZW5kVGV4dDogIiIsIC8vIERpc3BsYXkgdGV4dCBmb2xsb3dpbmcgdGhlIGlucHV0IGJveCwgZS5nLiBzaG93aW5nIHRoZSBmb3JtYXQKCQlidXR0b25UZXh0OiAiLi4uIiwgLy8gVGV4dCBmb3IgdHJpZ2dlciBidXR0b24KCQlidXR0b25JbWFnZTogIiIsIC8vIFVSTCBmb3IgdHJpZ2dlciBidXR0b24gaW1hZ2UKCQlidXR0b25JbWFnZU9ubHk6IGZhbHNlLCAvLyBUcnVlIGlmIHRoZSBpbWFnZSBhcHBlYXJzIGFsb25lLCBmYWxzZSBpZiBpdCBhcHBlYXJzIG9uIGEgYnV0dG9uCgkJaGlkZUlmTm9QcmV2TmV4dDogZmFsc2UsIC8vIFRydWUgdG8gaGlkZSBuZXh0L3ByZXZpb3VzIG1vbnRoIGxpbmtzCgkJCS8vIGlmIG5vdCBhcHBsaWNhYmxlLCBmYWxzZSB0byBqdXN0IGRpc2FibGUgdGhlbQoJCW5hdmlnYXRpb25Bc0RhdGVGb3JtYXQ6IGZhbHNlLCAvLyBUcnVlIGlmIGRhdGUgZm9ybWF0dGluZyBhcHBsaWVkIHRvIHByZXYvdG9kYXkvbmV4dCBsaW5rcwoJCWdvdG9DdXJyZW50OiBmYWxzZSwgLy8gVHJ1ZSBpZiB0b2RheSBsaW5rIGdvZXMgYmFjayB0byBjdXJyZW50IHNlbGVjdGlvbiBpbnN0ZWFkCgkJY2hhbmdlTW9udGg6IGZhbHNlLCAvLyBUcnVlIGlmIG1vbnRoIGNhbiBiZSBzZWxlY3RlZCBkaXJlY3RseSwgZmFsc2UgaWYgb25seSBwcmV2L25leHQKCQljaGFuZ2VZZWFyOiBmYWxzZSwgLy8gVHJ1ZSBpZiB5ZWFyIGNhbiBiZSBzZWxlY3RlZCBkaXJlY3RseSwgZmFsc2UgaWYgb25seSBwcmV2L25leHQKCQl5ZWFyUmFuZ2U6ICJjLTEwOmMrMTAiLCAvLyBSYW5nZSBvZiB5ZWFycyB0byBkaXNwbGF5IGluIGRyb3AtZG93biwKCQkJLy8gZWl0aGVyIHJlbGF0aXZlIHRvIHRvZGF5J3MgeWVhciAoLW5uOitubiksIHJlbGF0aXZlIHRvIGN1cnJlbnRseSBkaXNwbGF5ZWQgeWVhcgoJCQkvLyAoYy1ubjpjK25uKSwgYWJzb2x1dGUgKG5ubm46bm5ubiksIG9yIGEgY29tYmluYXRpb24gb2YgdGhlIGFib3ZlIChubm5uOi1uKQoJCXNob3dPdGhlck1vbnRoczogZmFsc2UsIC8vIFRydWUgdG8gc2hvdyBkYXRlcyBpbiBvdGhlciBtb250aHMsIGZhbHNlIHRvIGxlYXZlIGJsYW5rCgkJc2VsZWN0T3RoZXJNb250aHM6IGZhbHNlLCAvLyBUcnVlIHRvIGFsbG93IHNlbGVjdGlvbiBvZiBkYXRlcyBpbiBvdGhlciBtb250aHMsIGZhbHNlIGZvciB1bnNlbGVjdGFibGUKCQlzaG93V2VlazogZmFsc2UsIC8vIFRydWUgdG8gc2hvdyB3ZWVrIG9mIHRoZSB5ZWFyLCBmYWxzZSB0byBub3Qgc2hvdyBpdAoJCWNhbGN1bGF0ZVdlZWs6IHRoaXMuaXNvODYwMVdlZWssIC8vIEhvdyB0byBjYWxjdWxhdGUgdGhlIHdlZWsgb2YgdGhlIHllYXIsCgkJCS8vIHRha2VzIGEgRGF0ZSBhbmQgcmV0dXJucyB0aGUgbnVtYmVyIG9mIHRoZSB3ZWVrIGZvciBpdAoJCXNob3J0WWVhckN1dG9mZjogIisxMCIsIC8vIFNob3J0IHllYXIgdmFsdWVzIDwgdGhpcyBhcmUgaW4gdGhlIGN1cnJlbnQgY2VudHVyeSwKCQkJLy8gPiB0aGlzIGFyZSBpbiB0aGUgcHJldmlvdXMgY2VudHVyeSwKCQkJLy8gc3RyaW5nIHZhbHVlIHN0YXJ0aW5nIHdpdGggIisiIGZvciBjdXJyZW50IHllYXIgKyB2YWx1ZQoJCW1pbkRhdGU6IG51bGwsIC8vIFRoZSBlYXJsaWVzdCBzZWxlY3RhYmxlIGRhdGUsIG9yIG51bGwgZm9yIG5vIGxpbWl0CgkJbWF4RGF0ZTogbnVsbCwgLy8gVGhlIGxhdGVzdCBzZWxlY3RhYmxlIGRhdGUsIG9yIG51bGwgZm9yIG5vIGxpbWl0CgkJZHVyYXRpb246ICJmYXN0IiwgLy8gRHVyYXRpb24gb2YgZGlzcGxheS9jbG9zdXJlCgkJYmVmb3JlU2hvd0RheTogbnVsbCwgLy8gRnVuY3Rpb24gdGhhdCB0YWtlcyBhIGRhdGUgYW5kIHJldHVybnMgYW4gYXJyYXkgd2l0aAoJCQkvLyBbMF0gPSB0cnVlIGlmIHNlbGVjdGFibGUsIGZhbHNlIGlmIG5vdCwgWzFdID0gY3VzdG9tIENTUyBjbGFzcyBuYW1lKHMpIG9yICIiLAoJCQkvLyBbMl0gPSBjZWxsIHRpdGxlIChvcHRpb25hbCksIGUuZy4gJC5kYXRlcGlja2VyLm5vV2Vla2VuZHMKCQliZWZvcmVTaG93OiBudWxsLCAvLyBGdW5jdGlvbiB0aGF0IHRha2VzIGFuIGlucHV0IGZpZWxkIGFuZAoJCQkvLyByZXR1cm5zIGEgc2V0IG9mIGN1c3RvbSBzZXR0aW5ncyBmb3IgdGhlIGRhdGUgcGlja2VyCgkJb25TZWxlY3Q6IG51bGwsIC8vIERlZmluZSBhIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gYSBkYXRlIGlzIHNlbGVjdGVkCgkJb25DaGFuZ2VNb250aFllYXI6IG51bGwsIC8vIERlZmluZSBhIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gdGhlIG1vbnRoIG9yIHllYXIgaXMgY2hhbmdlZAoJCW9uQ2xvc2U6IG51bGwsIC8vIERlZmluZSBhIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gdGhlIGRhdGVwaWNrZXIgaXMgY2xvc2VkCgkJbnVtYmVyT2ZNb250aHM6IDEsIC8vIE51bWJlciBvZiBtb250aHMgdG8gc2hvdyBhdCBhIHRpbWUKCQlzaG93Q3VycmVudEF0UG9zOiAwLCAvLyBUaGUgcG9zaXRpb24gaW4gbXVsdGlwZSBtb250aHMgYXQgd2hpY2ggdG8gc2hvdyB0aGUgY3VycmVudCBtb250aCAoc3RhcnRpbmcgYXQgMCkKCQlzdGVwTW9udGhzOiAxLCAvLyBOdW1iZXIgb2YgbW9udGhzIHRvIHN0ZXAgYmFjay9mb3J3YXJkCgkJc3RlcEJpZ01vbnRoczogMTIsIC8vIE51bWJlciBvZiBtb250aHMgdG8gc3RlcCBiYWNrL2ZvcndhcmQgZm9yIHRoZSBiaWcgbGlua3MKCQlhbHRGaWVsZDogIiIsIC8vIFNlbGVjdG9yIGZvciBhbiBhbHRlcm5hdGUgZmllbGQgdG8gc3RvcmUgc2VsZWN0ZWQgZGF0ZXMgaW50bwoJCWFsdEZvcm1hdDogIiIsIC8vIFRoZSBkYXRlIGZvcm1hdCB0byB1c2UgZm9yIHRoZSBhbHRlcm5hdGUgZmllbGQKCQljb25zdHJhaW5JbnB1dDogdHJ1ZSwgLy8gVGhlIGlucHV0IGlzIGNvbnN0cmFpbmVkIGJ5IHRoZSBjdXJyZW50IGRhdGUgZm9ybWF0CgkJc2hvd0J1dHRvblBhbmVsOiBmYWxzZSwgLy8gVHJ1ZSB0byBzaG93IGJ1dHRvbiBwYW5lbCwgZmFsc2UgdG8gbm90IHNob3cgaXQKCQlhdXRvU2l6ZTogZmFsc2UsIC8vIFRydWUgdG8gc2l6ZSB0aGUgaW5wdXQgZm9yIHRoZSBkYXRlIGZvcm1hdCwgZmFsc2UgdG8gbGVhdmUgYXMgaXMKCQlkaXNhYmxlZDogZmFsc2UgLy8gVGhlIGluaXRpYWwgZGlzYWJsZWQgc3RhdGUKCX07CgkkLmV4dGVuZCh0aGlzLl9kZWZhdWx0cywgdGhpcy5yZWdpb25hbFsiIl0pOwoJdGhpcy5yZWdpb25hbC5lbiA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgdGhpcy5yZWdpb25hbFsgIiIgXSk7Cgl0aGlzLnJlZ2lvbmFsWyAiZW4tVVMiIF0gPSAkLmV4dGVuZCggdHJ1ZSwge30sIHRoaXMucmVnaW9uYWwuZW4gKTsKCXRoaXMuZHBEaXYgPSBkYXRlcGlja2VyX2JpbmRIb3ZlcigkKCI8ZGl2IGlkPSciICsgdGhpcy5fbWFpbkRpdklkICsgIicgY2xhc3M9J3VpLWRhdGVwaWNrZXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWhlbHBlci1jbGVhcmZpeCB1aS1jb3JuZXItYWxsJz48L2Rpdj4iKSk7Cn0KCiQuZXh0ZW5kKERhdGVwaWNrZXIucHJvdG90eXBlLCB7CgkvKiBDbGFzcyBuYW1lIGFkZGVkIHRvIGVsZW1lbnRzIHRvIGluZGljYXRlIGFscmVhZHkgY29uZmlndXJlZCB3aXRoIGEgZGF0ZSBwaWNrZXIuICovCgltYXJrZXJDbGFzc05hbWU6ICJoYXNEYXRlcGlja2VyIiwKCgkvL0tlZXAgdHJhY2sgb2YgdGhlIG1heGltdW0gbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIChzZWUgIzcwNDMpCgltYXhSb3dzOiA0LAoKCS8vIFRPRE8gcmVuYW1lIHRvICJ3aWRnZXQiIHdoZW4gc3dpdGNoaW5nIHRvIHdpZGdldCBmYWN0b3J5Cglfd2lkZ2V0RGF0ZXBpY2tlcjogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZHBEaXY7Cgl9LAoKCS8qIE92ZXJyaWRlIHRoZSBkZWZhdWx0IHNldHRpbmdzIGZvciBhbGwgaW5zdGFuY2VzIG9mIHRoZSBkYXRlIHBpY2tlci4KCSAqIEBwYXJhbSAgc2V0dGluZ3MgIG9iamVjdCAtIHRoZSBuZXcgc2V0dGluZ3MgdG8gdXNlIGFzIGRlZmF1bHRzIChhbm9ueW1vdXMgb2JqZWN0KQoJICogQHJldHVybiB0aGUgbWFuYWdlciBvYmplY3QKCSAqLwoJc2V0RGVmYXVsdHM6IGZ1bmN0aW9uKHNldHRpbmdzKSB7CgkJZGF0ZXBpY2tlcl9leHRlbmRSZW1vdmUodGhpcy5fZGVmYXVsdHMsIHNldHRpbmdzIHx8IHt9KTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJLyogQXR0YWNoIHRoZSBkYXRlIHBpY2tlciB0byBhIGpRdWVyeSBzZWxlY3Rpb24uCgkgKiBAcGFyYW0gIHRhcmdldAllbGVtZW50IC0gdGhlIHRhcmdldCBpbnB1dCBmaWVsZCBvciBkaXZpc2lvbiBvciBzcGFuCgkgKiBAcGFyYW0gIHNldHRpbmdzICBvYmplY3QgLSB0aGUgbmV3IHNldHRpbmdzIHRvIHVzZSBmb3IgdGhpcyBkYXRlIHBpY2tlciBpbnN0YW5jZSAoYW5vbnltb3VzKQoJICovCglfYXR0YWNoRGF0ZXBpY2tlcjogZnVuY3Rpb24odGFyZ2V0LCBzZXR0aW5ncykgewoJCXZhciBub2RlTmFtZSwgaW5saW5lLCBpbnN0OwoJCW5vZGVOYW1lID0gdGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJaW5saW5lID0gKG5vZGVOYW1lID09PSAiZGl2IiB8fCBub2RlTmFtZSA9PT0gInNwYW4iKTsKCQlpZiAoIXRhcmdldC5pZCkgewoJCQl0aGlzLnV1aWQgKz0gMTsKCQkJdGFyZ2V0LmlkID0gImRwIiArIHRoaXMudXVpZDsKCQl9CgkJaW5zdCA9IHRoaXMuX25ld0luc3QoJCh0YXJnZXQpLCBpbmxpbmUpOwoJCWluc3Quc2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgc2V0dGluZ3MgfHwge30pOwoJCWlmIChub2RlTmFtZSA9PT0gImlucHV0IikgewoJCQl0aGlzLl9jb25uZWN0RGF0ZXBpY2tlcih0YXJnZXQsIGluc3QpOwoJCX0gZWxzZSBpZiAoaW5saW5lKSB7CgkJCXRoaXMuX2lubGluZURhdGVwaWNrZXIodGFyZ2V0LCBpbnN0KTsKCQl9Cgl9LAoKCS8qIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvYmplY3QuICovCglfbmV3SW5zdDogZnVuY3Rpb24odGFyZ2V0LCBpbmxpbmUpIHsKCQl2YXIgaWQgPSB0YXJnZXRbMF0uaWQucmVwbGFjZSgvKFteQS1aYS16MC05X1wtXSkvZywgIlxcXFwkMSIpOyAvLyBlc2NhcGUgalF1ZXJ5IG1ldGEgY2hhcnMKCQlyZXR1cm4ge2lkOiBpZCwgaW5wdXQ6IHRhcmdldCwgLy8gYXNzb2NpYXRlZCB0YXJnZXQKCQkJc2VsZWN0ZWREYXk6IDAsIHNlbGVjdGVkTW9udGg6IDAsIHNlbGVjdGVkWWVhcjogMCwgLy8gY3VycmVudCBzZWxlY3Rpb24KCQkJZHJhd01vbnRoOiAwLCBkcmF3WWVhcjogMCwgLy8gbW9udGggYmVpbmcgZHJhd24KCQkJaW5saW5lOiBpbmxpbmUsIC8vIGlzIGRhdGVwaWNrZXIgaW5saW5lIG9yIG5vdAoJCQlkcERpdjogKCFpbmxpbmUgPyB0aGlzLmRwRGl2IDogLy8gcHJlc2VudGF0aW9uIGRpdgoJCQlkYXRlcGlja2VyX2JpbmRIb3ZlcigkKCI8ZGl2IGNsYXNzPSciICsgdGhpcy5faW5saW5lQ2xhc3MgKyAiIHVpLWRhdGVwaWNrZXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWhlbHBlci1jbGVhcmZpeCB1aS1jb3JuZXItYWxsJz48L2Rpdj4iKSkpfTsKCX0sCgoJLyogQXR0YWNoIHRoZSBkYXRlIHBpY2tlciB0byBhbiBpbnB1dCBmaWVsZC4gKi8KCV9jb25uZWN0RGF0ZXBpY2tlcjogZnVuY3Rpb24odGFyZ2V0LCBpbnN0KSB7CgkJdmFyIGlucHV0ID0gJCh0YXJnZXQpOwoJCWluc3QuYXBwZW5kID0gJChbXSk7CgkJaW5zdC50cmlnZ2VyID0gJChbXSk7CgkJaWYgKGlucHV0Lmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSkgewoJCQlyZXR1cm47CgkJfQoJCXRoaXMuX2F0dGFjaG1lbnRzKGlucHV0LCBpbnN0KTsKCQlpbnB1dC5hZGRDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkua2V5ZG93bih0aGlzLl9kb0tleURvd24pLgoJCQlrZXlwcmVzcyh0aGlzLl9kb0tleVByZXNzKS5rZXl1cCh0aGlzLl9kb0tleVVwKTsKCQl0aGlzLl9hdXRvU2l6ZShpbnN0KTsKCQkkLmRhdGEodGFyZ2V0LCAiZGF0ZXBpY2tlciIsIGluc3QpOwoJCS8vSWYgZGlzYWJsZWQgb3B0aW9uIGlzIHRydWUsIGRpc2FibGUgdGhlIGRhdGVwaWNrZXIgb25jZSBpdCBoYXMgYmVlbiBhdHRhY2hlZCB0byB0aGUgaW5wdXQgKHNlZSB0aWNrZXQgIzU2NjUpCgkJaWYoIGluc3Quc2V0dGluZ3MuZGlzYWJsZWQgKSB7CgkJCXRoaXMuX2Rpc2FibGVEYXRlcGlja2VyKCB0YXJnZXQgKTsKCQl9Cgl9LAoKCS8qIE1ha2UgYXR0YWNobWVudHMgYmFzZWQgb24gc2V0dGluZ3MuICovCglfYXR0YWNobWVudHM6IGZ1bmN0aW9uKGlucHV0LCBpbnN0KSB7CgkJdmFyIHNob3dPbiwgYnV0dG9uVGV4dCwgYnV0dG9uSW1hZ2UsCgkJCWFwcGVuZFRleHQgPSB0aGlzLl9nZXQoaW5zdCwgImFwcGVuZFRleHQiKSwKCQkJaXNSVEwgPSB0aGlzLl9nZXQoaW5zdCwgImlzUlRMIik7CgoJCWlmIChpbnN0LmFwcGVuZCkgewoJCQlpbnN0LmFwcGVuZC5yZW1vdmUoKTsKCQl9CgkJaWYgKGFwcGVuZFRleHQpIHsKCQkJaW5zdC5hcHBlbmQgPSAkKCI8c3BhbiBjbGFzcz0nIiArIHRoaXMuX2FwcGVuZENsYXNzICsgIic+IiArIGFwcGVuZFRleHQgKyAiPC9zcGFuPiIpOwoJCQlpbnB1dFtpc1JUTCA/ICJiZWZvcmUiIDogImFmdGVyIl0oaW5zdC5hcHBlbmQpOwoJCX0KCgkJaW5wdXQudW5iaW5kKCJmb2N1cyIsIHRoaXMuX3Nob3dEYXRlcGlja2VyKTsKCgkJaWYgKGluc3QudHJpZ2dlcikgewoJCQlpbnN0LnRyaWdnZXIucmVtb3ZlKCk7CgkJfQoKCQlzaG93T24gPSB0aGlzLl9nZXQoaW5zdCwgInNob3dPbiIpOwoJCWlmIChzaG93T24gPT09ICJmb2N1cyIgfHwgc2hvd09uID09PSAiYm90aCIpIHsgLy8gcG9wLXVwIGRhdGUgcGlja2VyIHdoZW4gaW4gdGhlIG1hcmtlZCBmaWVsZAoJCQlpbnB1dC5mb2N1cyh0aGlzLl9zaG93RGF0ZXBpY2tlcik7CgkJfQoJCWlmIChzaG93T24gPT09ICJidXR0b24iIHx8IHNob3dPbiA9PT0gImJvdGgiKSB7IC8vIHBvcC11cCBkYXRlIHBpY2tlciB3aGVuIGJ1dHRvbiBjbGlja2VkCgkJCWJ1dHRvblRleHQgPSB0aGlzLl9nZXQoaW5zdCwgImJ1dHRvblRleHQiKTsKCQkJYnV0dG9uSW1hZ2UgPSB0aGlzLl9nZXQoaW5zdCwgImJ1dHRvbkltYWdlIik7CgkJCWluc3QudHJpZ2dlciA9ICQodGhpcy5fZ2V0KGluc3QsICJidXR0b25JbWFnZU9ubHkiKSA/CgkJCQkkKCI8aW1nLz4iKS5hZGRDbGFzcyh0aGlzLl90cmlnZ2VyQ2xhc3MpLgoJCQkJCWF0dHIoeyBzcmM6IGJ1dHRvbkltYWdlLCBhbHQ6IGJ1dHRvblRleHQsIHRpdGxlOiBidXR0b25UZXh0IH0pIDoKCQkJCSQoIjxidXR0b24gdHlwZT0nYnV0dG9uJz48L2J1dHRvbj4iKS5hZGRDbGFzcyh0aGlzLl90cmlnZ2VyQ2xhc3MpLgoJCQkJCWh0bWwoIWJ1dHRvbkltYWdlID8gYnV0dG9uVGV4dCA6ICQoIjxpbWcvPiIpLmF0dHIoCgkJCQkJeyBzcmM6YnV0dG9uSW1hZ2UsIGFsdDpidXR0b25UZXh0LCB0aXRsZTpidXR0b25UZXh0IH0pKSk7CgkJCWlucHV0W2lzUlRMID8gImJlZm9yZSIgOiAiYWZ0ZXIiXShpbnN0LnRyaWdnZXIpOwoJCQlpbnN0LnRyaWdnZXIuY2xpY2soZnVuY3Rpb24oKSB7CgkJCQlpZiAoJC5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyAmJiAkLmRhdGVwaWNrZXIuX2xhc3RJbnB1dCA9PT0gaW5wdXRbMF0pIHsKCQkJCQkkLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7CgkJCQl9IGVsc2UgaWYgKCQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcgJiYgJC5kYXRlcGlja2VyLl9sYXN0SW5wdXQgIT09IGlucHV0WzBdKSB7CgkJCQkJJC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpOwoJCQkJCSQuZGF0ZXBpY2tlci5fc2hvd0RhdGVwaWNrZXIoaW5wdXRbMF0pOwoJCQkJfSBlbHNlIHsKCQkJCQkkLmRhdGVwaWNrZXIuX3Nob3dEYXRlcGlja2VyKGlucHV0WzBdKTsKCQkJCX0KCQkJCXJldHVybiBmYWxzZTsKCQkJfSk7CgkJfQoJfSwKCgkvKiBBcHBseSB0aGUgbWF4aW11bSBsZW5ndGggZm9yIHRoZSBkYXRlIGZvcm1hdC4gKi8KCV9hdXRvU2l6ZTogZnVuY3Rpb24oaW5zdCkgewoJCWlmICh0aGlzLl9nZXQoaW5zdCwgImF1dG9TaXplIikgJiYgIWluc3QuaW5saW5lKSB7CgkJCXZhciBmaW5kTWF4LCBtYXgsIG1heEksIGksCgkJCQlkYXRlID0gbmV3IERhdGUoMjAwOSwgMTIgLSAxLCAyMCksIC8vIEVuc3VyZSBkb3VibGUgZGlnaXRzCgkJCQlkYXRlRm9ybWF0ID0gdGhpcy5fZ2V0KGluc3QsICJkYXRlRm9ybWF0Iik7CgoJCQlpZiAoZGF0ZUZvcm1hdC5tYXRjaCgvW0RNXS8pKSB7CgkJCQlmaW5kTWF4ID0gZnVuY3Rpb24obmFtZXMpIHsKCQkJCQltYXggPSAwOwoJCQkJCW1heEkgPSAwOwoJCQkJCWZvciAoaSA9IDA7IGkgPCBuYW1lcy5sZW5ndGg7IGkrKykgewoJCQkJCQlpZiAobmFtZXNbaV0ubGVuZ3RoID4gbWF4KSB7CgkJCQkJCQltYXggPSBuYW1lc1tpXS5sZW5ndGg7CgkJCQkJCQltYXhJID0gaTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXR1cm4gbWF4STsKCQkJCX07CgkJCQlkYXRlLnNldE1vbnRoKGZpbmRNYXgodGhpcy5fZ2V0KGluc3QsIChkYXRlRm9ybWF0Lm1hdGNoKC9NTS8pID8KCQkJCQkibW9udGhOYW1lcyIgOiAibW9udGhOYW1lc1Nob3J0IikpKSk7CgkJCQlkYXRlLnNldERhdGUoZmluZE1heCh0aGlzLl9nZXQoaW5zdCwgKGRhdGVGb3JtYXQubWF0Y2goL0RELykgPwoJCQkJCSJkYXlOYW1lcyIgOiAiZGF5TmFtZXNTaG9ydCIpKSkgKyAyMCAtIGRhdGUuZ2V0RGF5KCkpOwoJCQl9CgkJCWluc3QuaW5wdXQuYXR0cigic2l6ZSIsIHRoaXMuX2Zvcm1hdERhdGUoaW5zdCwgZGF0ZSkubGVuZ3RoKTsKCQl9Cgl9LAoKCS8qIEF0dGFjaCBhbiBpbmxpbmUgZGF0ZSBwaWNrZXIgdG8gYSBkaXYuICovCglfaW5saW5lRGF0ZXBpY2tlcjogZnVuY3Rpb24odGFyZ2V0LCBpbnN0KSB7CgkJdmFyIGRpdlNwYW4gPSAkKHRhcmdldCk7CgkJaWYgKGRpdlNwYW4uaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKSB7CgkJCXJldHVybjsKCQl9CgkJZGl2U3Bhbi5hZGRDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkuYXBwZW5kKGluc3QuZHBEaXYpOwoJCSQuZGF0YSh0YXJnZXQsICJkYXRlcGlja2VyIiwgaW5zdCk7CgkJdGhpcy5fc2V0RGF0ZShpbnN0LCB0aGlzLl9nZXREZWZhdWx0RGF0ZShpbnN0KSwgdHJ1ZSk7CgkJdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihpbnN0KTsKCQl0aGlzLl91cGRhdGVBbHRlcm5hdGUoaW5zdCk7CgkJLy9JZiBkaXNhYmxlZCBvcHRpb24gaXMgdHJ1ZSwgZGlzYWJsZSB0aGUgZGF0ZXBpY2tlciBiZWZvcmUgc2hvd2luZyBpdCAoc2VlIHRpY2tldCAjNTY2NSkKCQlpZiggaW5zdC5zZXR0aW5ncy5kaXNhYmxlZCApIHsKCQkJdGhpcy5fZGlzYWJsZURhdGVwaWNrZXIoIHRhcmdldCApOwoJCX0KCQkvLyBTZXQgZGlzcGxheTpibG9jayBpbiBwbGFjZSBvZiBpbnN0LmRwRGl2LnNob3coKSB3aGljaCB3b24ndCB3b3JrIG9uIGRpc2Nvbm5lY3RlZCBlbGVtZW50cwoJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeXVpLmNvbS90aWNrZXQvNzU1MiAtIEEgRGF0ZXBpY2tlciBjcmVhdGVkIG9uIGEgZGV0YWNoZWQgZGl2IGhhcyB6ZXJvIGhlaWdodAoJCWluc3QuZHBEaXYuY3NzKCAiZGlzcGxheSIsICJibG9jayIgKTsKCX0sCgoJLyogUG9wLXVwIHRoZSBkYXRlIHBpY2tlciBpbiBhICJkaWFsb2ciIGJveC4KCSAqIEBwYXJhbSAgaW5wdXQgZWxlbWVudCAtIGlnbm9yZWQKCSAqIEBwYXJhbSAgZGF0ZQlzdHJpbmcgb3IgRGF0ZSAtIHRoZSBpbml0aWFsIGRhdGUgdG8gZGlzcGxheQoJICogQHBhcmFtICBvblNlbGVjdCAgZnVuY3Rpb24gLSB0aGUgZnVuY3Rpb24gdG8gY2FsbCB3aGVuIGEgZGF0ZSBpcyBzZWxlY3RlZAoJICogQHBhcmFtICBzZXR0aW5ncyAgb2JqZWN0IC0gdXBkYXRlIHRoZSBkaWFsb2cgZGF0ZSBwaWNrZXIgaW5zdGFuY2UncyBzZXR0aW5ncyAoYW5vbnltb3VzIG9iamVjdCkKCSAqIEBwYXJhbSAgcG9zIGludFsyXSAtIGNvb3JkaW5hdGVzIGZvciB0aGUgZGlhbG9nJ3MgcG9zaXRpb24gd2l0aGluIHRoZSBzY3JlZW4gb3IKCSAqCQkJCQlldmVudCAtIHdpdGggeC95IGNvb3JkaW5hdGVzIG9yCgkgKgkJCQkJbGVhdmUgZW1wdHkgZm9yIGRlZmF1bHQgKHNjcmVlbiBjZW50cmUpCgkgKiBAcmV0dXJuIHRoZSBtYW5hZ2VyIG9iamVjdAoJICovCglfZGlhbG9nRGF0ZXBpY2tlcjogZnVuY3Rpb24oaW5wdXQsIGRhdGUsIG9uU2VsZWN0LCBzZXR0aW5ncywgcG9zKSB7CgkJdmFyIGlkLCBicm93c2VyV2lkdGgsIGJyb3dzZXJIZWlnaHQsIHNjcm9sbFgsIHNjcm9sbFksCgkJCWluc3QgPSB0aGlzLl9kaWFsb2dJbnN0OyAvLyBpbnRlcm5hbCBpbnN0YW5jZQoKCQlpZiAoIWluc3QpIHsKCQkJdGhpcy51dWlkICs9IDE7CgkJCWlkID0gImRwIiArIHRoaXMudXVpZDsKCQkJdGhpcy5fZGlhbG9nSW5wdXQgPSAkKCI8aW5wdXQgdHlwZT0ndGV4dCcgaWQ9JyIgKyBpZCArCgkJCQkiJyBzdHlsZT0ncG9zaXRpb246IGFic29sdXRlOyB0b3A6IC0xMDBweDsgd2lkdGg6IDBweDsnLz4iKTsKCQkJdGhpcy5fZGlhbG9nSW5wdXQua2V5ZG93bih0aGlzLl9kb0tleURvd24pOwoJCQkkKCJib2R5IikuYXBwZW5kKHRoaXMuX2RpYWxvZ0lucHV0KTsKCQkJaW5zdCA9IHRoaXMuX2RpYWxvZ0luc3QgPSB0aGlzLl9uZXdJbnN0KHRoaXMuX2RpYWxvZ0lucHV0LCBmYWxzZSk7CgkJCWluc3Quc2V0dGluZ3MgPSB7fTsKCQkJJC5kYXRhKHRoaXMuX2RpYWxvZ0lucHV0WzBdLCAiZGF0ZXBpY2tlciIsIGluc3QpOwoJCX0KCQlkYXRlcGlja2VyX2V4dGVuZFJlbW92ZShpbnN0LnNldHRpbmdzLCBzZXR0aW5ncyB8fCB7fSk7CgkJZGF0ZSA9IChkYXRlICYmIGRhdGUuY29uc3RydWN0b3IgPT09IERhdGUgPyB0aGlzLl9mb3JtYXREYXRlKGluc3QsIGRhdGUpIDogZGF0ZSk7CgkJdGhpcy5fZGlhbG9nSW5wdXQudmFsKGRhdGUpOwoKCQl0aGlzLl9wb3MgPSAocG9zID8gKHBvcy5sZW5ndGggPyBwb3MgOiBbcG9zLnBhZ2VYLCBwb3MucGFnZVldKSA6IG51bGwpOwoJCWlmICghdGhpcy5fcG9zKSB7CgkJCWJyb3dzZXJXaWR0aCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDsKCQkJYnJvd3NlckhlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7CgkJCXNjcm9sbFggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQ7CgkJCXNjcm9sbFkgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wOwoJCQl0aGlzLl9wb3MgPSAvLyBzaG91bGQgdXNlIGFjdHVhbCB3aWR0aC9oZWlnaHQgYmVsb3cKCQkJCVsoYnJvd3NlcldpZHRoIC8gMikgLSAxMDAgKyBzY3JvbGxYLCAoYnJvd3NlckhlaWdodCAvIDIpIC0gMTUwICsgc2Nyb2xsWV07CgkJfQoKCQkvLyBtb3ZlIGlucHV0IG9uIHNjcmVlbiBmb3IgZm9jdXMsIGJ1dCBoaWRkZW4gYmVoaW5kIGRpYWxvZwoJCXRoaXMuX2RpYWxvZ0lucHV0LmNzcygibGVmdCIsICh0aGlzLl9wb3NbMF0gKyAyMCkgKyAicHgiKS5jc3MoInRvcCIsIHRoaXMuX3Bvc1sxXSArICJweCIpOwoJCWluc3Quc2V0dGluZ3Mub25TZWxlY3QgPSBvblNlbGVjdDsKCQl0aGlzLl9pbkRpYWxvZyA9IHRydWU7CgkJdGhpcy5kcERpdi5hZGRDbGFzcyh0aGlzLl9kaWFsb2dDbGFzcyk7CgkJdGhpcy5fc2hvd0RhdGVwaWNrZXIodGhpcy5fZGlhbG9nSW5wdXRbMF0pOwoJCWlmICgkLmJsb2NrVUkpIHsKCQkJJC5ibG9ja1VJKHRoaXMuZHBEaXYpOwoJCX0KCQkkLmRhdGEodGhpcy5fZGlhbG9nSW5wdXRbMF0sICJkYXRlcGlja2VyIiwgaW5zdCk7CgkJcmV0dXJuIHRoaXM7Cgl9LAoKCS8qIERldGFjaCBhIGRhdGVwaWNrZXIgZnJvbSBpdHMgY29udHJvbC4KCSAqIEBwYXJhbSAgdGFyZ2V0CWVsZW1lbnQgLSB0aGUgdGFyZ2V0IGlucHV0IGZpZWxkIG9yIGRpdmlzaW9uIG9yIHNwYW4KCSAqLwoJX2Rlc3Ryb3lEYXRlcGlja2VyOiBmdW5jdGlvbih0YXJnZXQpIHsKCQl2YXIgbm9kZU5hbWUsCgkJCSR0YXJnZXQgPSAkKHRhcmdldCksCgkJCWluc3QgPSAkLmRhdGEodGFyZ2V0LCAiZGF0ZXBpY2tlciIpOwoKCQlpZiAoISR0YXJnZXQuaGFzQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpKSB7CgkJCXJldHVybjsKCQl9CgoJCW5vZGVOYW1lID0gdGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJJC5yZW1vdmVEYXRhKHRhcmdldCwgImRhdGVwaWNrZXIiKTsKCQlpZiAobm9kZU5hbWUgPT09ICJpbnB1dCIpIHsKCQkJaW5zdC5hcHBlbmQucmVtb3ZlKCk7CgkJCWluc3QudHJpZ2dlci5yZW1vdmUoKTsKCQkJJHRhcmdldC5yZW1vdmVDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkuCgkJCQl1bmJpbmQoImZvY3VzIiwgdGhpcy5fc2hvd0RhdGVwaWNrZXIpLgoJCQkJdW5iaW5kKCJrZXlkb3duIiwgdGhpcy5fZG9LZXlEb3duKS4KCQkJCXVuYmluZCgia2V5cHJlc3MiLCB0aGlzLl9kb0tleVByZXNzKS4KCQkJCXVuYmluZCgia2V5dXAiLCB0aGlzLl9kb0tleVVwKTsKCQl9IGVsc2UgaWYgKG5vZGVOYW1lID09PSAiZGl2IiB8fCBub2RlTmFtZSA9PT0gInNwYW4iKSB7CgkJCSR0YXJnZXQucmVtb3ZlQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpLmVtcHR5KCk7CgkJfQoJfSwKCgkvKiBFbmFibGUgdGhlIGRhdGUgcGlja2VyIHRvIGEgalF1ZXJ5IHNlbGVjdGlvbi4KCSAqIEBwYXJhbSAgdGFyZ2V0CWVsZW1lbnQgLSB0aGUgdGFyZ2V0IGlucHV0IGZpZWxkIG9yIGRpdmlzaW9uIG9yIHNwYW4KCSAqLwoJX2VuYWJsZURhdGVwaWNrZXI6IGZ1bmN0aW9uKHRhcmdldCkgewoJCXZhciBub2RlTmFtZSwgaW5saW5lLAoJCQkkdGFyZ2V0ID0gJCh0YXJnZXQpLAoJCQlpbnN0ID0gJC5kYXRhKHRhcmdldCwgImRhdGVwaWNrZXIiKTsKCgkJaWYgKCEkdGFyZ2V0Lmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSkgewoJCQlyZXR1cm47CgkJfQoKCQlub2RlTmFtZSA9IHRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCWlmIChub2RlTmFtZSA9PT0gImlucHV0IikgewoJCQl0YXJnZXQuZGlzYWJsZWQgPSBmYWxzZTsKCQkJaW5zdC50cmlnZ2VyLmZpbHRlcigiYnV0dG9uIikuCgkJCQllYWNoKGZ1bmN0aW9uKCkgeyB0aGlzLmRpc2FibGVkID0gZmFsc2U7IH0pLmVuZCgpLgoJCQkJZmlsdGVyKCJpbWciKS5jc3Moe29wYWNpdHk6ICIxLjAiLCBjdXJzb3I6ICIifSk7CgkJfSBlbHNlIGlmIChub2RlTmFtZSA9PT0gImRpdiIgfHwgbm9kZU5hbWUgPT09ICJzcGFuIikgewoJCQlpbmxpbmUgPSAkdGFyZ2V0LmNoaWxkcmVuKCIuIiArIHRoaXMuX2lubGluZUNsYXNzKTsKCQkJaW5saW5lLmNoaWxkcmVuKCkucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIik7CgkJCWlubGluZS5maW5kKCJzZWxlY3QudWktZGF0ZXBpY2tlci1tb250aCwgc2VsZWN0LnVpLWRhdGVwaWNrZXIteWVhciIpLgoJCQkJcHJvcCgiZGlzYWJsZWQiLCBmYWxzZSk7CgkJfQoJCXRoaXMuX2Rpc2FibGVkSW5wdXRzID0gJC5tYXAodGhpcy5fZGlzYWJsZWRJbnB1dHMsCgkJCWZ1bmN0aW9uKHZhbHVlKSB7IHJldHVybiAodmFsdWUgPT09IHRhcmdldCA/IG51bGwgOiB2YWx1ZSk7IH0pOyAvLyBkZWxldGUgZW50cnkKCX0sCgoJLyogRGlzYWJsZSB0aGUgZGF0ZSBwaWNrZXIgdG8gYSBqUXVlcnkgc2VsZWN0aW9uLgoJICogQHBhcmFtICB0YXJnZXQJZWxlbWVudCAtIHRoZSB0YXJnZXQgaW5wdXQgZmllbGQgb3IgZGl2aXNpb24gb3Igc3BhbgoJICovCglfZGlzYWJsZURhdGVwaWNrZXI6IGZ1bmN0aW9uKHRhcmdldCkgewoJCXZhciBub2RlTmFtZSwgaW5saW5lLAoJCQkkdGFyZ2V0ID0gJCh0YXJnZXQpLAoJCQlpbnN0ID0gJC5kYXRhKHRhcmdldCwgImRhdGVwaWNrZXIiKTsKCgkJaWYgKCEkdGFyZ2V0Lmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSkgewoJCQlyZXR1cm47CgkJfQoKCQlub2RlTmFtZSA9IHRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCWlmIChub2RlTmFtZSA9PT0gImlucHV0IikgewoJCQl0YXJnZXQuZGlzYWJsZWQgPSB0cnVlOwoJCQlpbnN0LnRyaWdnZXIuZmlsdGVyKCJidXR0b24iKS4KCQkJCWVhY2goZnVuY3Rpb24oKSB7IHRoaXMuZGlzYWJsZWQgPSB0cnVlOyB9KS5lbmQoKS4KCQkJCWZpbHRlcigiaW1nIikuY3NzKHtvcGFjaXR5OiAiMC41IiwgY3Vyc29yOiAiZGVmYXVsdCJ9KTsKCQl9IGVsc2UgaWYgKG5vZGVOYW1lID09PSAiZGl2IiB8fCBub2RlTmFtZSA9PT0gInNwYW4iKSB7CgkJCWlubGluZSA9ICR0YXJnZXQuY2hpbGRyZW4oIi4iICsgdGhpcy5faW5saW5lQ2xhc3MpOwoJCQlpbmxpbmUuY2hpbGRyZW4oKS5hZGRDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKTsKCQkJaW5saW5lLmZpbmQoInNlbGVjdC51aS1kYXRlcGlja2VyLW1vbnRoLCBzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyIikuCgkJCQlwcm9wKCJkaXNhYmxlZCIsIHRydWUpOwoJCX0KCQl0aGlzLl9kaXNhYmxlZElucHV0cyA9ICQubWFwKHRoaXMuX2Rpc2FibGVkSW5wdXRzLAoJCQlmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gKHZhbHVlID09PSB0YXJnZXQgPyBudWxsIDogdmFsdWUpOyB9KTsgLy8gZGVsZXRlIGVudHJ5CgkJdGhpcy5fZGlzYWJsZWRJbnB1dHNbdGhpcy5fZGlzYWJsZWRJbnB1dHMubGVuZ3RoXSA9IHRhcmdldDsKCX0sCgoJLyogSXMgdGhlIGZpcnN0IGZpZWxkIGluIGEgalF1ZXJ5IGNvbGxlY3Rpb24gZGlzYWJsZWQgYXMgYSBkYXRlcGlja2VyPwoJICogQHBhcmFtICB0YXJnZXQJZWxlbWVudCAtIHRoZSB0YXJnZXQgaW5wdXQgZmllbGQgb3IgZGl2aXNpb24gb3Igc3BhbgoJICogQHJldHVybiBib29sZWFuIC0gdHJ1ZSBpZiBkaXNhYmxlZCwgZmFsc2UgaWYgZW5hYmxlZAoJICovCglfaXNEaXNhYmxlZERhdGVwaWNrZXI6IGZ1bmN0aW9uKHRhcmdldCkgewoJCWlmICghdGFyZ2V0KSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9kaXNhYmxlZElucHV0cy5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5fZGlzYWJsZWRJbnB1dHNbaV0gPT09IHRhcmdldCkgewoJCQkJcmV0dXJuIHRydWU7CgkJCX0KCQl9CgkJcmV0dXJuIGZhbHNlOwoJfSwKCgkvKiBSZXRyaWV2ZSB0aGUgaW5zdGFuY2UgZGF0YSBmb3IgdGhlIHRhcmdldCBjb250cm9sLgoJICogQHBhcmFtICB0YXJnZXQgIGVsZW1lbnQgLSB0aGUgdGFyZ2V0IGlucHV0IGZpZWxkIG9yIGRpdmlzaW9uIG9yIHNwYW4KCSAqIEByZXR1cm4gIG9iamVjdCAtIHRoZSBhc3NvY2lhdGVkIGluc3RhbmNlIGRhdGEKCSAqIEB0aHJvd3MgIGVycm9yIGlmIGEgalF1ZXJ5IHByb2JsZW0gZ2V0dGluZyBkYXRhCgkgKi8KCV9nZXRJbnN0OiBmdW5jdGlvbih0YXJnZXQpIHsKCQl0cnkgewoJCQlyZXR1cm4gJC5kYXRhKHRhcmdldCwgImRhdGVwaWNrZXIiKTsKCQl9CgkJY2F0Y2ggKGVycikgewoJCQl0aHJvdyAiTWlzc2luZyBpbnN0YW5jZSBkYXRhIGZvciB0aGlzIGRhdGVwaWNrZXIiOwoJCX0KCX0sCgoJLyogVXBkYXRlIG9yIHJldHJpZXZlIHRoZSBzZXR0aW5ncyBmb3IgYSBkYXRlIHBpY2tlciBhdHRhY2hlZCB0byBhbiBpbnB1dCBmaWVsZCBvciBkaXZpc2lvbi4KCSAqIEBwYXJhbSAgdGFyZ2V0ICBlbGVtZW50IC0gdGhlIHRhcmdldCBpbnB1dCBmaWVsZCBvciBkaXZpc2lvbiBvciBzcGFuCgkgKiBAcGFyYW0gIG5hbWUJb2JqZWN0IC0gdGhlIG5ldyBzZXR0aW5ncyB0byB1cGRhdGUgb3IKCSAqCQkJCXN0cmluZyAtIHRoZSBuYW1lIG9mIHRoZSBzZXR0aW5nIHRvIGNoYW5nZSBvciByZXRyaWV2ZSwKCSAqCQkJCXdoZW4gcmV0cmlldmluZyBhbHNvICJhbGwiIGZvciBhbGwgaW5zdGFuY2Ugc2V0dGluZ3Mgb3IKCSAqCQkJCSJkZWZhdWx0cyIgZm9yIGFsbCBnbG9iYWwgZGVmYXVsdHMKCSAqIEBwYXJhbSAgdmFsdWUgICBhbnkgLSB0aGUgbmV3IHZhbHVlIGZvciB0aGUgc2V0dGluZwoJICoJCQkJKG9taXQgaWYgYWJvdmUgaXMgYW4gb2JqZWN0IG9yIHRvIHJldHJpZXZlIGEgdmFsdWUpCgkgKi8KCV9vcHRpb25EYXRlcGlja2VyOiBmdW5jdGlvbih0YXJnZXQsIG5hbWUsIHZhbHVlKSB7CgkJdmFyIHNldHRpbmdzLCBkYXRlLCBtaW5EYXRlLCBtYXhEYXRlLAoJCQlpbnN0ID0gdGhpcy5fZ2V0SW5zdCh0YXJnZXQpOwoKCQlpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiB0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIpIHsKCQkJcmV0dXJuIChuYW1lID09PSAiZGVmYXVsdHMiID8gJC5leHRlbmQoe30sICQuZGF0ZXBpY2tlci5fZGVmYXVsdHMpIDoKCQkJCShpbnN0ID8gKG5hbWUgPT09ICJhbGwiID8gJC5leHRlbmQoe30sIGluc3Quc2V0dGluZ3MpIDoKCQkJCXRoaXMuX2dldChpbnN0LCBuYW1lKSkgOiBudWxsKSk7CgkJfQoKCQlzZXR0aW5ncyA9IG5hbWUgfHwge307CgkJaWYgKHR5cGVvZiBuYW1lID09PSAic3RyaW5nIikgewoJCQlzZXR0aW5ncyA9IHt9OwoJCQlzZXR0aW5nc1tuYW1lXSA9IHZhbHVlOwoJCX0KCgkJaWYgKGluc3QpIHsKCQkJaWYgKHRoaXMuX2N1ckluc3QgPT09IGluc3QpIHsKCQkJCXRoaXMuX2hpZGVEYXRlcGlja2VyKCk7CgkJCX0KCgkJCWRhdGUgPSB0aGlzLl9nZXREYXRlRGF0ZXBpY2tlcih0YXJnZXQsIHRydWUpOwoJCQltaW5EYXRlID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShpbnN0LCAibWluIik7CgkJCW1heERhdGUgPSB0aGlzLl9nZXRNaW5NYXhEYXRlKGluc3QsICJtYXgiKTsKCQkJZGF0ZXBpY2tlcl9leHRlbmRSZW1vdmUoaW5zdC5zZXR0aW5ncywgc2V0dGluZ3MpOwoJCQkvLyByZWZvcm1hdCB0aGUgb2xkIG1pbkRhdGUvbWF4RGF0ZSB2YWx1ZXMgaWYgZGF0ZUZvcm1hdCBjaGFuZ2VzIGFuZCBhIG5ldyBtaW5EYXRlL21heERhdGUgaXNuJ3QgcHJvdmlkZWQKCQkJaWYgKG1pbkRhdGUgIT09IG51bGwgJiYgc2V0dGluZ3MuZGF0ZUZvcm1hdCAhPT0gdW5kZWZpbmVkICYmIHNldHRpbmdzLm1pbkRhdGUgPT09IHVuZGVmaW5lZCkgewoJCQkJaW5zdC5zZXR0aW5ncy5taW5EYXRlID0gdGhpcy5fZm9ybWF0RGF0ZShpbnN0LCBtaW5EYXRlKTsKCQkJfQoJCQlpZiAobWF4RGF0ZSAhPT0gbnVsbCAmJiBzZXR0aW5ncy5kYXRlRm9ybWF0ICE9PSB1bmRlZmluZWQgJiYgc2V0dGluZ3MubWF4RGF0ZSA9PT0gdW5kZWZpbmVkKSB7CgkJCQlpbnN0LnNldHRpbmdzLm1heERhdGUgPSB0aGlzLl9mb3JtYXREYXRlKGluc3QsIG1heERhdGUpOwoJCQl9CgkJCWlmICggImRpc2FibGVkIiBpbiBzZXR0aW5ncyApIHsKCQkJCWlmICggc2V0dGluZ3MuZGlzYWJsZWQgKSB7CgkJCQkJdGhpcy5fZGlzYWJsZURhdGVwaWNrZXIodGFyZ2V0KTsKCQkJCX0gZWxzZSB7CgkJCQkJdGhpcy5fZW5hYmxlRGF0ZXBpY2tlcih0YXJnZXQpOwoJCQkJfQoJCQl9CgkJCXRoaXMuX2F0dGFjaG1lbnRzKCQodGFyZ2V0KSwgaW5zdCk7CgkJCXRoaXMuX2F1dG9TaXplKGluc3QpOwoJCQl0aGlzLl9zZXREYXRlKGluc3QsIGRhdGUpOwoJCQl0aGlzLl91cGRhdGVBbHRlcm5hdGUoaW5zdCk7CgkJCXRoaXMuX3VwZGF0ZURhdGVwaWNrZXIoaW5zdCk7CgkJfQoJfSwKCgkvLyBjaGFuZ2UgbWV0aG9kIGRlcHJlY2F0ZWQKCV9jaGFuZ2VEYXRlcGlja2VyOiBmdW5jdGlvbih0YXJnZXQsIG5hbWUsIHZhbHVlKSB7CgkJdGhpcy5fb3B0aW9uRGF0ZXBpY2tlcih0YXJnZXQsIG5hbWUsIHZhbHVlKTsKCX0sCgoJLyogUmVkcmF3IHRoZSBkYXRlIHBpY2tlciBhdHRhY2hlZCB0byBhbiBpbnB1dCBmaWVsZCBvciBkaXZpc2lvbi4KCSAqIEBwYXJhbSAgdGFyZ2V0ICBlbGVtZW50IC0gdGhlIHRhcmdldCBpbnB1dCBmaWVsZCBvciBkaXZpc2lvbiBvciBzcGFuCgkgKi8KCV9yZWZyZXNoRGF0ZXBpY2tlcjogZnVuY3Rpb24odGFyZ2V0KSB7CgkJdmFyIGluc3QgPSB0aGlzLl9nZXRJbnN0KHRhcmdldCk7CgkJaWYgKGluc3QpIHsKCQkJdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihpbnN0KTsKCQl9Cgl9LAoKCS8qIFNldCB0aGUgZGF0ZXMgZm9yIGEgalF1ZXJ5IHNlbGVjdGlvbi4KCSAqIEBwYXJhbSAgdGFyZ2V0IGVsZW1lbnQgLSB0aGUgdGFyZ2V0IGlucHV0IGZpZWxkIG9yIGRpdmlzaW9uIG9yIHNwYW4KCSAqIEBwYXJhbSAgZGF0ZQlEYXRlIC0gdGhlIG5ldyBkYXRlCgkgKi8KCV9zZXREYXRlRGF0ZXBpY2tlcjogZnVuY3Rpb24odGFyZ2V0LCBkYXRlKSB7CgkJdmFyIGluc3QgPSB0aGlzLl9nZXRJbnN0KHRhcmdldCk7CgkJaWYgKGluc3QpIHsKCQkJdGhpcy5fc2V0RGF0ZShpbnN0LCBkYXRlKTsKCQkJdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihpbnN0KTsKCQkJdGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGluc3QpOwoJCX0KCX0sCgoJLyogR2V0IHRoZSBkYXRlKHMpIGZvciB0aGUgZmlyc3QgZW50cnkgaW4gYSBqUXVlcnkgc2VsZWN0aW9uLgoJICogQHBhcmFtICB0YXJnZXQgZWxlbWVudCAtIHRoZSB0YXJnZXQgaW5wdXQgZmllbGQgb3IgZGl2aXNpb24gb3Igc3BhbgoJICogQHBhcmFtICBub0RlZmF1bHQgYm9vbGVhbiAtIHRydWUgaWYgbm8gZGVmYXVsdCBkYXRlIGlzIHRvIGJlIHVzZWQKCSAqIEByZXR1cm4gRGF0ZSAtIHRoZSBjdXJyZW50IGRhdGUKCSAqLwoJX2dldERhdGVEYXRlcGlja2VyOiBmdW5jdGlvbih0YXJnZXQsIG5vRGVmYXVsdCkgewoJCXZhciBpbnN0ID0gdGhpcy5fZ2V0SW5zdCh0YXJnZXQpOwoJCWlmIChpbnN0ICYmICFpbnN0LmlubGluZSkgewoJCQl0aGlzLl9zZXREYXRlRnJvbUZpZWxkKGluc3QsIG5vRGVmYXVsdCk7CgkJfQoJCXJldHVybiAoaW5zdCA/IHRoaXMuX2dldERhdGUoaW5zdCkgOiBudWxsKTsKCX0sCgoJLyogSGFuZGxlIGtleXN0cm9rZXMuICovCglfZG9LZXlEb3duOiBmdW5jdGlvbihldmVudCkgewoJCXZhciBvblNlbGVjdCwgZGF0ZVN0ciwgc2VsLAoJCQlpbnN0ID0gJC5kYXRlcGlja2VyLl9nZXRJbnN0KGV2ZW50LnRhcmdldCksCgkJCWhhbmRsZWQgPSB0cnVlLAoJCQlpc1JUTCA9IGluc3QuZHBEaXYuaXMoIi51aS1kYXRlcGlja2VyLXJ0bCIpOwoKCQlpbnN0Ll9rZXlFdmVudCA9IHRydWU7CgkJaWYgKCQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcpIHsKCQkJc3dpdGNoIChldmVudC5rZXlDb2RlKSB7CgkJCQljYXNlIDk6ICQuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKTsKCQkJCQkJaGFuZGxlZCA9IGZhbHNlOwoJCQkJCQlicmVhazsgLy8gaGlkZSBvbiB0YWIgb3V0CgkJCQljYXNlIDEzOiBzZWwgPSAkKCJ0ZC4iICsgJC5kYXRlcGlja2VyLl9kYXlPdmVyQ2xhc3MgKyAiOm5vdCguIiArCgkJCQkJCQkJCSQuZGF0ZXBpY2tlci5fY3VycmVudENsYXNzICsgIikiLCBpbnN0LmRwRGl2KTsKCQkJCQkJaWYgKHNlbFswXSkgewoJCQkJCQkJJC5kYXRlcGlja2VyLl9zZWxlY3REYXkoZXZlbnQudGFyZ2V0LCBpbnN0LnNlbGVjdGVkTW9udGgsIGluc3Quc2VsZWN0ZWRZZWFyLCBzZWxbMF0pOwoJCQkJCQl9CgoJCQkJCQlvblNlbGVjdCA9ICQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJvblNlbGVjdCIpOwoJCQkJCQlpZiAob25TZWxlY3QpIHsKCQkJCQkJCWRhdGVTdHIgPSAkLmRhdGVwaWNrZXIuX2Zvcm1hdERhdGUoaW5zdCk7CgoJCQkJCQkJLy8gdHJpZ2dlciBjdXN0b20gY2FsbGJhY2sKCQkJCQkJCW9uU2VsZWN0LmFwcGx5KChpbnN0LmlucHV0ID8gaW5zdC5pbnB1dFswXSA6IG51bGwpLCBbZGF0ZVN0ciwgaW5zdF0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJJC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gZmFsc2U7IC8vIGRvbid0IHN1Ym1pdCB0aGUgZm9ybQoJCQkJY2FzZSAyNzogJC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpOwoJCQkJCQlicmVhazsgLy8gaGlkZSBvbiBlc2NhcGUKCQkJCWNhc2UgMzM6ICQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShldmVudC50YXJnZXQsIChldmVudC5jdHJsS2V5ID8KCQkJCQkJCS0kLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic3RlcEJpZ01vbnRocyIpIDoKCQkJCQkJCS0kLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic3RlcE1vbnRocyIpKSwgIk0iKTsKCQkJCQkJYnJlYWs7IC8vIHByZXZpb3VzIG1vbnRoL3llYXIgb24gcGFnZSB1cC8rIGN0cmwKCQkJCWNhc2UgMzQ6ICQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShldmVudC50YXJnZXQsIChldmVudC5jdHJsS2V5ID8KCQkJCQkJCSskLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic3RlcEJpZ01vbnRocyIpIDoKCQkJCQkJCSskLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic3RlcE1vbnRocyIpKSwgIk0iKTsKCQkJCQkJYnJlYWs7IC8vIG5leHQgbW9udGgveWVhciBvbiBwYWdlIGRvd24vKyBjdHJsCgkJCQljYXNlIDM1OiBpZiAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSB7CgkJCQkJCQkkLmRhdGVwaWNrZXIuX2NsZWFyRGF0ZShldmVudC50YXJnZXQpOwoJCQkJCQl9CgkJCQkJCWhhbmRsZWQgPSBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXk7CgkJCQkJCWJyZWFrOyAvLyBjbGVhciBvbiBjdHJsIG9yIGNvbW1hbmQgK2VuZAoJCQkJY2FzZSAzNjogaWYgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkgewoJCQkJCQkJJC5kYXRlcGlja2VyLl9nb3RvVG9kYXkoZXZlbnQudGFyZ2V0KTsKCQkJCQkJfQoJCQkJCQloYW5kbGVkID0gZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5OwoJCQkJCQlicmVhazsgLy8gY3VycmVudCBvbiBjdHJsIG9yIGNvbW1hbmQgK2hvbWUKCQkJCWNhc2UgMzc6IGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpIHsKCQkJCQkJCSQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShldmVudC50YXJnZXQsIChpc1JUTCA/ICsxIDogLTEpLCAiRCIpOwoJCQkJCQl9CgkJCQkJCWhhbmRsZWQgPSBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXk7CgkJCQkJCS8vIC0xIGRheSBvbiBjdHJsIG9yIGNvbW1hbmQgK2xlZnQKCQkJCQkJaWYgKGV2ZW50Lm9yaWdpbmFsRXZlbnQuYWx0S2V5KSB7CgkJCQkJCQkkLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoZXZlbnQudGFyZ2V0LCAoZXZlbnQuY3RybEtleSA/CgkJCQkJCQkJLSQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJzdGVwQmlnTW9udGhzIikgOgoJCQkJCQkJCS0kLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic3RlcE1vbnRocyIpKSwgIk0iKTsKCQkJCQkJfQoJCQkJCQkvLyBuZXh0IG1vbnRoL3llYXIgb24gYWx0ICtsZWZ0IG9uIE1hYwoJCQkJCQlicmVhazsKCQkJCWNhc2UgMzg6IGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpIHsKCQkJCQkJCSQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShldmVudC50YXJnZXQsIC03LCAiRCIpOwoJCQkJCQl9CgkJCQkJCWhhbmRsZWQgPSBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXk7CgkJCQkJCWJyZWFrOyAvLyAtMSB3ZWVrIG9uIGN0cmwgb3IgY29tbWFuZCArdXAKCQkJCWNhc2UgMzk6IGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpIHsKCQkJCQkJCSQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShldmVudC50YXJnZXQsIChpc1JUTCA/IC0xIDogKzEpLCAiRCIpOwoJCQkJCQl9CgkJCQkJCWhhbmRsZWQgPSBldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXk7CgkJCQkJCS8vICsxIGRheSBvbiBjdHJsIG9yIGNvbW1hbmQgK3JpZ2h0CgkJCQkJCWlmIChldmVudC5vcmlnaW5hbEV2ZW50LmFsdEtleSkgewoJCQkJCQkJJC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGV2ZW50LnRhcmdldCwgKGV2ZW50LmN0cmxLZXkgPwoJCQkJCQkJCSskLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic3RlcEJpZ01vbnRocyIpIDoKCQkJCQkJCQkrJC5kYXRlcGlja2VyLl9nZXQoaW5zdCwgInN0ZXBNb250aHMiKSksICJNIik7CgkJCQkJCX0KCQkJCQkJLy8gbmV4dCBtb250aC95ZWFyIG9uIGFsdCArcmlnaHQKCQkJCQkJYnJlYWs7CgkJCQljYXNlIDQwOiBpZiAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSB7CgkJCQkJCQkkLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoZXZlbnQudGFyZ2V0LCArNywgIkQiKTsKCQkJCQkJfQoJCQkJCQloYW5kbGVkID0gZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5OwoJCQkJCQlicmVhazsgLy8gKzEgd2VlayBvbiBjdHJsIG9yIGNvbW1hbmQgK2Rvd24KCQkJCWRlZmF1bHQ6IGhhbmRsZWQgPSBmYWxzZTsKCQkJfQoJCX0gZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzYgJiYgZXZlbnQuY3RybEtleSkgeyAvLyBkaXNwbGF5IHRoZSBkYXRlIHBpY2tlciBvbiBjdHJsK2hvbWUKCQkJJC5kYXRlcGlja2VyLl9zaG93RGF0ZXBpY2tlcih0aGlzKTsKCQl9IGVsc2UgewoJCQloYW5kbGVkID0gZmFsc2U7CgkJfQoKCQlpZiAoaGFuZGxlZCkgewoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQlldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCQl9Cgl9LAoKCS8qIEZpbHRlciBlbnRlcmVkIGNoYXJhY3RlcnMgLSBiYXNlZCBvbiBkYXRlIGZvcm1hdC4gKi8KCV9kb0tleVByZXNzOiBmdW5jdGlvbihldmVudCkgewoJCXZhciBjaGFycywgY2hyLAoJCQlpbnN0ID0gJC5kYXRlcGlja2VyLl9nZXRJbnN0KGV2ZW50LnRhcmdldCk7CgoJCWlmICgkLmRhdGVwaWNrZXIuX2dldChpbnN0LCAiY29uc3RyYWluSW5wdXQiKSkgewoJCQljaGFycyA9ICQuZGF0ZXBpY2tlci5fcG9zc2libGVDaGFycygkLmRhdGVwaWNrZXIuX2dldChpbnN0LCAiZGF0ZUZvcm1hdCIpKTsKCQkJY2hyID0gU3RyaW5nLmZyb21DaGFyQ29kZShldmVudC5jaGFyQ29kZSA9PSBudWxsID8gZXZlbnQua2V5Q29kZSA6IGV2ZW50LmNoYXJDb2RlKTsKCQkJcmV0dXJuIGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSB8fCAoY2hyIDwgIiAiIHx8ICFjaGFycyB8fCBjaGFycy5pbmRleE9mKGNocikgPiAtMSk7CgkJfQoJfSwKCgkvKiBTeW5jaHJvbmlzZSBtYW51YWwgZW50cnkgYW5kIGZpZWxkL2FsdGVybmF0ZSBmaWVsZC4gKi8KCV9kb0tleVVwOiBmdW5jdGlvbihldmVudCkgewoJCXZhciBkYXRlLAoJCQlpbnN0ID0gJC5kYXRlcGlja2VyLl9nZXRJbnN0KGV2ZW50LnRhcmdldCk7CgoJCWlmIChpbnN0LmlucHV0LnZhbCgpICE9PSBpbnN0Lmxhc3RWYWwpIHsKCQkJdHJ5IHsKCQkJCWRhdGUgPSAkLmRhdGVwaWNrZXIucGFyc2VEYXRlKCQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJkYXRlRm9ybWF0IiksCgkJCQkJKGluc3QuaW5wdXQgPyBpbnN0LmlucHV0LnZhbCgpIDogbnVsbCksCgkJCQkJJC5kYXRlcGlja2VyLl9nZXRGb3JtYXRDb25maWcoaW5zdCkpOwoKCQkJCWlmIChkYXRlKSB7IC8vIG9ubHkgaWYgdmFsaWQKCQkJCQkkLmRhdGVwaWNrZXIuX3NldERhdGVGcm9tRmllbGQoaW5zdCk7CgkJCQkJJC5kYXRlcGlja2VyLl91cGRhdGVBbHRlcm5hdGUoaW5zdCk7CgkJCQkJJC5kYXRlcGlja2VyLl91cGRhdGVEYXRlcGlja2VyKGluc3QpOwoJCQkJfQoJCQl9CgkJCWNhdGNoIChlcnIpIHsKCQkJfQoJCX0KCQlyZXR1cm4gdHJ1ZTsKCX0sCgoJLyogUG9wLXVwIHRoZSBkYXRlIHBpY2tlciBmb3IgYSBnaXZlbiBpbnB1dCBmaWVsZC4KCSAqIElmIGZhbHNlIHJldHVybmVkIGZyb20gYmVmb3JlU2hvdyBldmVudCBoYW5kbGVyIGRvIG5vdCBzaG93LgoJICogQHBhcmFtICBpbnB1dCAgZWxlbWVudCAtIHRoZSBpbnB1dCBmaWVsZCBhdHRhY2hlZCB0byB0aGUgZGF0ZSBwaWNrZXIgb3IKCSAqCQkJCQlldmVudCAtIGlmIHRyaWdnZXJlZCBieSBmb2N1cwoJICovCglfc2hvd0RhdGVwaWNrZXI6IGZ1bmN0aW9uKGlucHV0KSB7CgkJaW5wdXQgPSBpbnB1dC50YXJnZXQgfHwgaW5wdXQ7CgkJaWYgKGlucHV0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJpbnB1dCIpIHsgLy8gZmluZCBmcm9tIGJ1dHRvbi9pbWFnZSB0cmlnZ2VyCgkJCWlucHV0ID0gJCgiaW5wdXQiLCBpbnB1dC5wYXJlbnROb2RlKVswXTsKCQl9CgoJCWlmICgkLmRhdGVwaWNrZXIuX2lzRGlzYWJsZWREYXRlcGlja2VyKGlucHV0KSB8fCAkLmRhdGVwaWNrZXIuX2xhc3RJbnB1dCA9PT0gaW5wdXQpIHsgLy8gYWxyZWFkeSBoZXJlCgkJCXJldHVybjsKCQl9CgoJCXZhciBpbnN0LCBiZWZvcmVTaG93LCBiZWZvcmVTaG93U2V0dGluZ3MsIGlzRml4ZWQsCgkJCW9mZnNldCwgc2hvd0FuaW0sIGR1cmF0aW9uOwoKCQlpbnN0ID0gJC5kYXRlcGlja2VyLl9nZXRJbnN0KGlucHV0KTsKCQlpZiAoJC5kYXRlcGlja2VyLl9jdXJJbnN0ICYmICQuZGF0ZXBpY2tlci5fY3VySW5zdCAhPT0gaW5zdCkgewoJCQkkLmRhdGVwaWNrZXIuX2N1ckluc3QuZHBEaXYuc3RvcCh0cnVlLCB0cnVlKTsKCQkJaWYgKCBpbnN0ICYmICQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcgKSB7CgkJCQkkLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCAkLmRhdGVwaWNrZXIuX2N1ckluc3QuaW5wdXRbMF0gKTsKCQkJfQoJCX0KCgkJYmVmb3JlU2hvdyA9ICQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJiZWZvcmVTaG93Iik7CgkJYmVmb3JlU2hvd1NldHRpbmdzID0gYmVmb3JlU2hvdyA/IGJlZm9yZVNob3cuYXBwbHkoaW5wdXQsIFtpbnB1dCwgaW5zdF0pIDoge307CgkJaWYoYmVmb3JlU2hvd1NldHRpbmdzID09PSBmYWxzZSl7CgkJCXJldHVybjsKCQl9CgkJZGF0ZXBpY2tlcl9leHRlbmRSZW1vdmUoaW5zdC5zZXR0aW5ncywgYmVmb3JlU2hvd1NldHRpbmdzKTsKCgkJaW5zdC5sYXN0VmFsID0gbnVsbDsKCQkkLmRhdGVwaWNrZXIuX2xhc3RJbnB1dCA9IGlucHV0OwoJCSQuZGF0ZXBpY2tlci5fc2V0RGF0ZUZyb21GaWVsZChpbnN0KTsKCgkJaWYgKCQuZGF0ZXBpY2tlci5faW5EaWFsb2cpIHsgLy8gaGlkZSBjdXJzb3IKCQkJaW5wdXQudmFsdWUgPSAiIjsKCQl9CgkJaWYgKCEkLmRhdGVwaWNrZXIuX3BvcykgeyAvLyBwb3NpdGlvbiBiZWxvdyBpbnB1dAoJCQkkLmRhdGVwaWNrZXIuX3BvcyA9ICQuZGF0ZXBpY2tlci5fZmluZFBvcyhpbnB1dCk7CgkJCSQuZGF0ZXBpY2tlci5fcG9zWzFdICs9IGlucHV0Lm9mZnNldEhlaWdodDsgLy8gYWRkIHRoZSBoZWlnaHQKCQl9CgoJCWlzRml4ZWQgPSBmYWxzZTsKCQkkKGlucHV0KS5wYXJlbnRzKCkuZWFjaChmdW5jdGlvbigpIHsKCQkJaXNGaXhlZCB8PSAkKHRoaXMpLmNzcygicG9zaXRpb24iKSA9PT0gImZpeGVkIjsKCQkJcmV0dXJuICFpc0ZpeGVkOwoJCX0pOwoKCQlvZmZzZXQgPSB7bGVmdDogJC5kYXRlcGlja2VyLl9wb3NbMF0sIHRvcDogJC5kYXRlcGlja2VyLl9wb3NbMV19OwoJCSQuZGF0ZXBpY2tlci5fcG9zID0gbnVsbDsKCQkvL3RvIGF2b2lkIGZsYXNoZXMgb24gRmlyZWZveAoJCWluc3QuZHBEaXYuZW1wdHkoKTsKCQkvLyBkZXRlcm1pbmUgc2l6aW5nIG9mZnNjcmVlbgoJCWluc3QuZHBEaXYuY3NzKHtwb3NpdGlvbjogImFic29sdXRlIiwgZGlzcGxheTogImJsb2NrIiwgdG9wOiAiLTEwMDBweCJ9KTsKCQkkLmRhdGVwaWNrZXIuX3VwZGF0ZURhdGVwaWNrZXIoaW5zdCk7CgkJLy8gZml4IHdpZHRoIGZvciBkeW5hbWljIG51bWJlciBvZiBkYXRlIHBpY2tlcnMKCQkvLyBhbmQgYWRqdXN0IHBvc2l0aW9uIGJlZm9yZSBzaG93aW5nCgkJb2Zmc2V0ID0gJC5kYXRlcGlja2VyLl9jaGVja09mZnNldChpbnN0LCBvZmZzZXQsIGlzRml4ZWQpOwoJCWluc3QuZHBEaXYuY3NzKHtwb3NpdGlvbjogKCQuZGF0ZXBpY2tlci5faW5EaWFsb2cgJiYgJC5ibG9ja1VJID8KCQkJInN0YXRpYyIgOiAoaXNGaXhlZCA/ICJmaXhlZCIgOiAiYWJzb2x1dGUiKSksIGRpc3BsYXk6ICJub25lIiwKCQkJbGVmdDogb2Zmc2V0LmxlZnQgKyAicHgiLCB0b3A6IG9mZnNldC50b3AgKyAicHgifSk7CgoJCWlmICghaW5zdC5pbmxpbmUpIHsKCQkJc2hvd0FuaW0gPSAkLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic2hvd0FuaW0iKTsKCQkJZHVyYXRpb24gPSAkLmRhdGVwaWNrZXIuX2dldChpbnN0LCAiZHVyYXRpb24iKTsKCQkJaW5zdC5kcERpdi5jc3MoICJ6LWluZGV4IiwgZGF0ZXBpY2tlcl9nZXRaaW5kZXgoICQoIGlucHV0ICkgKSArIDEgKTsKCQkJJC5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyA9IHRydWU7CgoJCQlpZiAoICQuZWZmZWN0cyAmJiAkLmVmZmVjdHMuZWZmZWN0WyBzaG93QW5pbSBdICkgewoJCQkJaW5zdC5kcERpdi5zaG93KHNob3dBbmltLCAkLmRhdGVwaWNrZXIuX2dldChpbnN0LCAic2hvd09wdGlvbnMiKSwgZHVyYXRpb24pOwoJCQl9IGVsc2UgewoJCQkJaW5zdC5kcERpdltzaG93QW5pbSB8fCAic2hvdyJdKHNob3dBbmltID8gZHVyYXRpb24gOiBudWxsKTsKCQkJfQoKCQkJaWYgKCAkLmRhdGVwaWNrZXIuX3Nob3VsZEZvY3VzSW5wdXQoIGluc3QgKSApIHsKCQkJCWluc3QuaW5wdXQuZm9jdXMoKTsKCQkJfQoKCQkJJC5kYXRlcGlja2VyLl9jdXJJbnN0ID0gaW5zdDsKCQl9Cgl9LAoKCS8qIEdlbmVyYXRlIHRoZSBkYXRlIHBpY2tlciBjb250ZW50LiAqLwoJX3VwZGF0ZURhdGVwaWNrZXI6IGZ1bmN0aW9uKGluc3QpIHsKCQl0aGlzLm1heFJvd3MgPSA0OyAvL1Jlc2V0IHRoZSBtYXggbnVtYmVyIG9mIHJvd3MgYmVpbmcgZGlzcGxheWVkIChzZWUgIzcwNDMpCgkJZGF0ZXBpY2tlcl9pbnN0QWN0aXZlID0gaW5zdDsgLy8gZm9yIGRlbGVnYXRlIGhvdmVyIGV2ZW50cwoJCWluc3QuZHBEaXYuZW1wdHkoKS5hcHBlbmQodGhpcy5fZ2VuZXJhdGVIVE1MKGluc3QpKTsKCQl0aGlzLl9hdHRhY2hIYW5kbGVycyhpbnN0KTsKCgkJdmFyIG9yaWd5ZWFyc2h0bWwsCgkJCW51bU1vbnRocyA9IHRoaXMuX2dldE51bWJlck9mTW9udGhzKGluc3QpLAoJCQljb2xzID0gbnVtTW9udGhzWzFdLAoJCQl3aWR0aCA9IDE3LAoJCQlhY3RpdmVDZWxsID0gaW5zdC5kcERpdi5maW5kKCAiLiIgKyB0aGlzLl9kYXlPdmVyQ2xhc3MgKyAiIGEiICk7CgoJCWlmICggYWN0aXZlQ2VsbC5sZW5ndGggPiAwICkgewoJCQlkYXRlcGlja2VyX2hhbmRsZU1vdXNlb3Zlci5hcHBseSggYWN0aXZlQ2VsbC5nZXQoIDAgKSApOwoJCX0KCgkJaW5zdC5kcERpdi5yZW1vdmVDbGFzcygidWktZGF0ZXBpY2tlci1tdWx0aS0yIHVpLWRhdGVwaWNrZXItbXVsdGktMyB1aS1kYXRlcGlja2VyLW11bHRpLTQiKS53aWR0aCgiIik7CgkJaWYgKGNvbHMgPiAxKSB7CgkJCWluc3QuZHBEaXYuYWRkQ2xhc3MoInVpLWRhdGVwaWNrZXItbXVsdGktIiArIGNvbHMpLmNzcygid2lkdGgiLCAod2lkdGggKiBjb2xzKSArICJlbSIpOwoJCX0KCQlpbnN0LmRwRGl2WyhudW1Nb250aHNbMF0gIT09IDEgfHwgbnVtTW9udGhzWzFdICE9PSAxID8gImFkZCIgOiAicmVtb3ZlIikgKwoJCQkiQ2xhc3MiXSgidWktZGF0ZXBpY2tlci1tdWx0aSIpOwoJCWluc3QuZHBEaXZbKHRoaXMuX2dldChpbnN0LCAiaXNSVEwiKSA/ICJhZGQiIDogInJlbW92ZSIpICsKCQkJIkNsYXNzIl0oInVpLWRhdGVwaWNrZXItcnRsIik7CgoJCWlmIChpbnN0ID09PSAkLmRhdGVwaWNrZXIuX2N1ckluc3QgJiYgJC5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyAmJiAkLmRhdGVwaWNrZXIuX3Nob3VsZEZvY3VzSW5wdXQoIGluc3QgKSApIHsKCQkJaW5zdC5pbnB1dC5mb2N1cygpOwoJCX0KCgkJLy8gZGVmZmVyZWQgcmVuZGVyIG9mIHRoZSB5ZWFycyBzZWxlY3QgKHRvIGF2b2lkIGZsYXNoZXMgb24gRmlyZWZveCkKCQlpZiggaW5zdC55ZWFyc2h0bWwgKXsKCQkJb3JpZ3llYXJzaHRtbCA9IGluc3QueWVhcnNodG1sOwoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CgkJCQkvL2Fzc3VyZSB0aGF0IGluc3QueWVhcnNodG1sIGRpZG4ndCBjaGFuZ2UuCgkJCQlpZiggb3JpZ3llYXJzaHRtbCA9PT0gaW5zdC55ZWFyc2h0bWwgJiYgaW5zdC55ZWFyc2h0bWwgKXsKCQkJCQlpbnN0LmRwRGl2LmZpbmQoInNlbGVjdC51aS1kYXRlcGlja2VyLXllYXI6Zmlyc3QiKS5yZXBsYWNlV2l0aChpbnN0LnllYXJzaHRtbCk7CgkJCQl9CgkJCQlvcmlneWVhcnNodG1sID0gaW5zdC55ZWFyc2h0bWwgPSBudWxsOwoJCQl9LCAwKTsKCQl9Cgl9LAoKCS8vICM2Njk0IC0gZG9uJ3QgZm9jdXMgdGhlIGlucHV0IGlmIGl0J3MgYWxyZWFkeSBmb2N1c2VkCgkvLyB0aGlzIGJyZWFrcyB0aGUgY2hhbmdlIGV2ZW50IGluIElFCgkvLyBTdXBwb3J0OiBJRSBhbmQgalF1ZXJ5IDwxLjkKCV9zaG91bGRGb2N1c0lucHV0OiBmdW5jdGlvbiggaW5zdCApIHsKCQlyZXR1cm4gaW5zdC5pbnB1dCAmJiBpbnN0LmlucHV0LmlzKCAiOnZpc2libGUiICkgJiYgIWluc3QuaW5wdXQuaXMoICI6ZGlzYWJsZWQiICkgJiYgIWluc3QuaW5wdXQuaXMoICI6Zm9jdXMiICk7Cgl9LAoKCS8qIENoZWNrIHBvc2l0aW9uaW5nIHRvIHJlbWFpbiBvbiBzY3JlZW4uICovCglfY2hlY2tPZmZzZXQ6IGZ1bmN0aW9uKGluc3QsIG9mZnNldCwgaXNGaXhlZCkgewoJCXZhciBkcFdpZHRoID0gaW5zdC5kcERpdi5vdXRlcldpZHRoKCksCgkJCWRwSGVpZ2h0ID0gaW5zdC5kcERpdi5vdXRlckhlaWdodCgpLAoJCQlpbnB1dFdpZHRoID0gaW5zdC5pbnB1dCA/IGluc3QuaW5wdXQub3V0ZXJXaWR0aCgpIDogMCwKCQkJaW5wdXRIZWlnaHQgPSBpbnN0LmlucHV0ID8gaW5zdC5pbnB1dC5vdXRlckhlaWdodCgpIDogMCwKCQkJdmlld1dpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoICsgKGlzRml4ZWQgPyAwIDogJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKSwKCQkJdmlld0hlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgKyAoaXNGaXhlZCA/IDAgOiAkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSk7CgoJCW9mZnNldC5sZWZ0IC09ICh0aGlzLl9nZXQoaW5zdCwgImlzUlRMIikgPyAoZHBXaWR0aCAtIGlucHV0V2lkdGgpIDogMCk7CgkJb2Zmc2V0LmxlZnQgLT0gKGlzRml4ZWQgJiYgb2Zmc2V0LmxlZnQgPT09IGluc3QuaW5wdXQub2Zmc2V0KCkubGVmdCkgPyAkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkgOiAwOwoJCW9mZnNldC50b3AgLT0gKGlzRml4ZWQgJiYgb2Zmc2V0LnRvcCA9PT0gKGluc3QuaW5wdXQub2Zmc2V0KCkudG9wICsgaW5wdXRIZWlnaHQpKSA/ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpIDogMDsKCgkJLy8gbm93IGNoZWNrIGlmIGRhdGVwaWNrZXIgaXMgc2hvd2luZyBvdXRzaWRlIHdpbmRvdyB2aWV3cG9ydCAtIG1vdmUgdG8gYSBiZXR0ZXIgcGxhY2UgaWYgc28uCgkJb2Zmc2V0LmxlZnQgLT0gTWF0aC5taW4ob2Zmc2V0LmxlZnQsIChvZmZzZXQubGVmdCArIGRwV2lkdGggPiB2aWV3V2lkdGggJiYgdmlld1dpZHRoID4gZHBXaWR0aCkgPwoJCQlNYXRoLmFicyhvZmZzZXQubGVmdCArIGRwV2lkdGggLSB2aWV3V2lkdGgpIDogMCk7CgkJb2Zmc2V0LnRvcCAtPSBNYXRoLm1pbihvZmZzZXQudG9wLCAob2Zmc2V0LnRvcCArIGRwSGVpZ2h0ID4gdmlld0hlaWdodCAmJiB2aWV3SGVpZ2h0ID4gZHBIZWlnaHQpID8KCQkJTWF0aC5hYnMoZHBIZWlnaHQgKyBpbnB1dEhlaWdodCkgOiAwKTsKCgkJcmV0dXJuIG9mZnNldDsKCX0sCgoJLyogRmluZCBhbiBvYmplY3QncyBwb3NpdGlvbiBvbiB0aGUgc2NyZWVuLiAqLwoJX2ZpbmRQb3M6IGZ1bmN0aW9uKG9iaikgewoJCXZhciBwb3NpdGlvbiwKCQkJaW5zdCA9IHRoaXMuX2dldEluc3Qob2JqKSwKCQkJaXNSVEwgPSB0aGlzLl9nZXQoaW5zdCwgImlzUlRMIik7CgoJCXdoaWxlIChvYmogJiYgKG9iai50eXBlID09PSAiaGlkZGVuIiB8fCBvYmoubm9kZVR5cGUgIT09IDEgfHwgJC5leHByLmZpbHRlcnMuaGlkZGVuKG9iaikpKSB7CgkJCW9iaiA9IG9ialtpc1JUTCA/ICJwcmV2aW91c1NpYmxpbmciIDogIm5leHRTaWJsaW5nIl07CgkJfQoKCQlwb3NpdGlvbiA9ICQob2JqKS5vZmZzZXQoKTsKCQlyZXR1cm4gW3Bvc2l0aW9uLmxlZnQsIHBvc2l0aW9uLnRvcF07Cgl9LAoKCS8qIEhpZGUgdGhlIGRhdGUgcGlja2VyIGZyb20gdmlldy4KCSAqIEBwYXJhbSAgaW5wdXQgIGVsZW1lbnQgLSB0aGUgaW5wdXQgZmllbGQgYXR0YWNoZWQgdG8gdGhlIGRhdGUgcGlja2VyCgkgKi8KCV9oaWRlRGF0ZXBpY2tlcjogZnVuY3Rpb24oaW5wdXQpIHsKCQl2YXIgc2hvd0FuaW0sIGR1cmF0aW9uLCBwb3N0UHJvY2Vzcywgb25DbG9zZSwKCQkJaW5zdCA9IHRoaXMuX2N1ckluc3Q7CgoJCWlmICghaW5zdCB8fCAoaW5wdXQgJiYgaW5zdCAhPT0gJC5kYXRhKGlucHV0LCAiZGF0ZXBpY2tlciIpKSkgewoJCQlyZXR1cm47CgkJfQoKCQlpZiAodGhpcy5fZGF0ZXBpY2tlclNob3dpbmcpIHsKCQkJc2hvd0FuaW0gPSB0aGlzLl9nZXQoaW5zdCwgInNob3dBbmltIik7CgkJCWR1cmF0aW9uID0gdGhpcy5fZ2V0KGluc3QsICJkdXJhdGlvbiIpOwoJCQlwb3N0UHJvY2VzcyA9IGZ1bmN0aW9uKCkgewoJCQkJJC5kYXRlcGlja2VyLl90aWR5RGlhbG9nKGluc3QpOwoJCQl9OwoKCQkJLy8gREVQUkVDQVRFRDogYWZ0ZXIgQkMgZm9yIDEuOC54ICQuZWZmZWN0c1sgc2hvd0FuaW0gXSBpcyBub3QgbmVlZGVkCgkJCWlmICggJC5lZmZlY3RzICYmICggJC5lZmZlY3RzLmVmZmVjdFsgc2hvd0FuaW0gXSB8fCAkLmVmZmVjdHNbIHNob3dBbmltIF0gKSApIHsKCQkJCWluc3QuZHBEaXYuaGlkZShzaG93QW5pbSwgJC5kYXRlcGlja2VyLl9nZXQoaW5zdCwgInNob3dPcHRpb25zIiksIGR1cmF0aW9uLCBwb3N0UHJvY2Vzcyk7CgkJCX0gZWxzZSB7CgkJCQlpbnN0LmRwRGl2WyhzaG93QW5pbSA9PT0gInNsaWRlRG93biIgPyAic2xpZGVVcCIgOgoJCQkJCShzaG93QW5pbSA9PT0gImZhZGVJbiIgPyAiZmFkZU91dCIgOiAiaGlkZSIpKV0oKHNob3dBbmltID8gZHVyYXRpb24gOiBudWxsKSwgcG9zdFByb2Nlc3MpOwoJCQl9CgoJCQlpZiAoIXNob3dBbmltKSB7CgkJCQlwb3N0UHJvY2VzcygpOwoJCQl9CgkJCXRoaXMuX2RhdGVwaWNrZXJTaG93aW5nID0gZmFsc2U7CgoJCQlvbkNsb3NlID0gdGhpcy5fZ2V0KGluc3QsICJvbkNsb3NlIik7CgkJCWlmIChvbkNsb3NlKSB7CgkJCQlvbkNsb3NlLmFwcGx5KChpbnN0LmlucHV0ID8gaW5zdC5pbnB1dFswXSA6IG51bGwpLCBbKGluc3QuaW5wdXQgPyBpbnN0LmlucHV0LnZhbCgpIDogIiIpLCBpbnN0XSk7CgkJCX0KCgkJCXRoaXMuX2xhc3RJbnB1dCA9IG51bGw7CgkJCWlmICh0aGlzLl9pbkRpYWxvZykgewoJCQkJdGhpcy5fZGlhbG9nSW5wdXQuY3NzKHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIGxlZnQ6ICIwIiwgdG9wOiAiLTEwMHB4IiB9KTsKCQkJCWlmICgkLmJsb2NrVUkpIHsKCQkJCQkkLnVuYmxvY2tVSSgpOwoJCQkJCSQoImJvZHkiKS5hcHBlbmQodGhpcy5kcERpdik7CgkJCQl9CgkJCX0KCQkJdGhpcy5faW5EaWFsb2cgPSBmYWxzZTsKCQl9Cgl9LAoKCS8qIFRpZHkgdXAgYWZ0ZXIgYSBkaWFsb2cgZGlzcGxheS4gKi8KCV90aWR5RGlhbG9nOiBmdW5jdGlvbihpbnN0KSB7CgkJaW5zdC5kcERpdi5yZW1vdmVDbGFzcyh0aGlzLl9kaWFsb2dDbGFzcykudW5iaW5kKCIudWktZGF0ZXBpY2tlci1jYWxlbmRhciIpOwoJfSwKCgkvKiBDbG9zZSBkYXRlIHBpY2tlciBpZiBjbGlja2VkIGVsc2V3aGVyZS4gKi8KCV9jaGVja0V4dGVybmFsQ2xpY2s6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJaWYgKCEkLmRhdGVwaWNrZXIuX2N1ckluc3QpIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyICR0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCksCgkJCWluc3QgPSAkLmRhdGVwaWNrZXIuX2dldEluc3QoJHRhcmdldFswXSk7CgoJCWlmICggKCAoICR0YXJnZXRbMF0uaWQgIT09ICQuZGF0ZXBpY2tlci5fbWFpbkRpdklkICYmCgkJCQkkdGFyZ2V0LnBhcmVudHMoIiMiICsgJC5kYXRlcGlja2VyLl9tYWluRGl2SWQpLmxlbmd0aCA9PT0gMCAmJgoJCQkJISR0YXJnZXQuaGFzQ2xhc3MoJC5kYXRlcGlja2VyLm1hcmtlckNsYXNzTmFtZSkgJiYKCQkJCSEkdGFyZ2V0LmNsb3Nlc3QoIi4iICsgJC5kYXRlcGlja2VyLl90cmlnZ2VyQ2xhc3MpLmxlbmd0aCAmJgoJCQkJJC5kYXRlcGlja2VyLl9kYXRlcGlja2VyU2hvd2luZyAmJiAhKCQuZGF0ZXBpY2tlci5faW5EaWFsb2cgJiYgJC5ibG9ja1VJKSApICkgfHwKCQkJKCAkdGFyZ2V0Lmhhc0NsYXNzKCQuZGF0ZXBpY2tlci5tYXJrZXJDbGFzc05hbWUpICYmICQuZGF0ZXBpY2tlci5fY3VySW5zdCAhPT0gaW5zdCApICkgewoJCQkJJC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpOwoJCX0KCX0sCgoJLyogQWRqdXN0IG9uZSBvZiB0aGUgZGF0ZSBzdWItZmllbGRzLiAqLwoJX2FkanVzdERhdGU6IGZ1bmN0aW9uKGlkLCBvZmZzZXQsIHBlcmlvZCkgewoJCXZhciB0YXJnZXQgPSAkKGlkKSwKCQkJaW5zdCA9IHRoaXMuX2dldEluc3QodGFyZ2V0WzBdKTsKCgkJaWYgKHRoaXMuX2lzRGlzYWJsZWREYXRlcGlja2VyKHRhcmdldFswXSkpIHsKCQkJcmV0dXJuOwoJCX0KCQl0aGlzLl9hZGp1c3RJbnN0RGF0ZShpbnN0LCBvZmZzZXQgKwoJCQkocGVyaW9kID09PSAiTSIgPyB0aGlzLl9nZXQoaW5zdCwgInNob3dDdXJyZW50QXRQb3MiKSA6IDApLCAvLyB1bmRvIHBvc2l0aW9uaW5nCgkJCXBlcmlvZCk7CgkJdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihpbnN0KTsKCX0sCgoJLyogQWN0aW9uIGZvciBjdXJyZW50IGxpbmsuICovCglfZ290b1RvZGF5OiBmdW5jdGlvbihpZCkgewoJCXZhciBkYXRlLAoJCQl0YXJnZXQgPSAkKGlkKSwKCQkJaW5zdCA9IHRoaXMuX2dldEluc3QodGFyZ2V0WzBdKTsKCgkJaWYgKHRoaXMuX2dldChpbnN0LCAiZ290b0N1cnJlbnQiKSAmJiBpbnN0LmN1cnJlbnREYXkpIHsKCQkJaW5zdC5zZWxlY3RlZERheSA9IGluc3QuY3VycmVudERheTsKCQkJaW5zdC5kcmF3TW9udGggPSBpbnN0LnNlbGVjdGVkTW9udGggPSBpbnN0LmN1cnJlbnRNb250aDsKCQkJaW5zdC5kcmF3WWVhciA9IGluc3Quc2VsZWN0ZWRZZWFyID0gaW5zdC5jdXJyZW50WWVhcjsKCQl9IGVsc2UgewoJCQlkYXRlID0gbmV3IERhdGUoKTsKCQkJaW5zdC5zZWxlY3RlZERheSA9IGRhdGUuZ2V0RGF0ZSgpOwoJCQlpbnN0LmRyYXdNb250aCA9IGluc3Quc2VsZWN0ZWRNb250aCA9IGRhdGUuZ2V0TW9udGgoKTsKCQkJaW5zdC5kcmF3WWVhciA9IGluc3Quc2VsZWN0ZWRZZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOwoJCX0KCQl0aGlzLl9ub3RpZnlDaGFuZ2UoaW5zdCk7CgkJdGhpcy5fYWRqdXN0RGF0ZSh0YXJnZXQpOwoJfSwKCgkvKiBBY3Rpb24gZm9yIHNlbGVjdGluZyBhIG5ldyBtb250aC95ZWFyLiAqLwoJX3NlbGVjdE1vbnRoWWVhcjogZnVuY3Rpb24oaWQsIHNlbGVjdCwgcGVyaW9kKSB7CgkJdmFyIHRhcmdldCA9ICQoaWQpLAoJCQlpbnN0ID0gdGhpcy5fZ2V0SW5zdCh0YXJnZXRbMF0pOwoKCQlpbnN0WyJzZWxlY3RlZCIgKyAocGVyaW9kID09PSAiTSIgPyAiTW9udGgiIDogIlllYXIiKV0gPQoJCWluc3RbImRyYXciICsgKHBlcmlvZCA9PT0gIk0iID8gIk1vbnRoIiA6ICJZZWFyIildID0KCQkJcGFyc2VJbnQoc2VsZWN0Lm9wdGlvbnNbc2VsZWN0LnNlbGVjdGVkSW5kZXhdLnZhbHVlLDEwKTsKCgkJdGhpcy5fbm90aWZ5Q2hhbmdlKGluc3QpOwoJCXRoaXMuX2FkanVzdERhdGUodGFyZ2V0KTsKCX0sCgoJLyogQWN0aW9uIGZvciBzZWxlY3RpbmcgYSBkYXkuICovCglfc2VsZWN0RGF5OiBmdW5jdGlvbihpZCwgbW9udGgsIHllYXIsIHRkKSB7CgkJdmFyIGluc3QsCgkJCXRhcmdldCA9ICQoaWQpOwoKCQlpZiAoJCh0ZCkuaGFzQ2xhc3ModGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3MpIHx8IHRoaXMuX2lzRGlzYWJsZWREYXRlcGlja2VyKHRhcmdldFswXSkpIHsKCQkJcmV0dXJuOwoJCX0KCgkJaW5zdCA9IHRoaXMuX2dldEluc3QodGFyZ2V0WzBdKTsKCQlpbnN0LnNlbGVjdGVkRGF5ID0gaW5zdC5jdXJyZW50RGF5ID0gJCgiYSIsIHRkKS5odG1sKCk7CgkJaW5zdC5zZWxlY3RlZE1vbnRoID0gaW5zdC5jdXJyZW50TW9udGggPSBtb250aDsKCQlpbnN0LnNlbGVjdGVkWWVhciA9IGluc3QuY3VycmVudFllYXIgPSB5ZWFyOwoJCXRoaXMuX3NlbGVjdERhdGUoaWQsIHRoaXMuX2Zvcm1hdERhdGUoaW5zdCwKCQkJaW5zdC5jdXJyZW50RGF5LCBpbnN0LmN1cnJlbnRNb250aCwgaW5zdC5jdXJyZW50WWVhcikpOwoJfSwKCgkvKiBFcmFzZSB0aGUgaW5wdXQgZmllbGQgYW5kIGhpZGUgdGhlIGRhdGUgcGlja2VyLiAqLwoJX2NsZWFyRGF0ZTogZnVuY3Rpb24oaWQpIHsKCQl2YXIgdGFyZ2V0ID0gJChpZCk7CgkJdGhpcy5fc2VsZWN0RGF0ZSh0YXJnZXQsICIiKTsKCX0sCgoJLyogVXBkYXRlIHRoZSBpbnB1dCBmaWVsZCB3aXRoIHRoZSBzZWxlY3RlZCBkYXRlLiAqLwoJX3NlbGVjdERhdGU6IGZ1bmN0aW9uKGlkLCBkYXRlU3RyKSB7CgkJdmFyIG9uU2VsZWN0LAoJCQl0YXJnZXQgPSAkKGlkKSwKCQkJaW5zdCA9IHRoaXMuX2dldEluc3QodGFyZ2V0WzBdKTsKCgkJZGF0ZVN0ciA9IChkYXRlU3RyICE9IG51bGwgPyBkYXRlU3RyIDogdGhpcy5fZm9ybWF0RGF0ZShpbnN0KSk7CgkJaWYgKGluc3QuaW5wdXQpIHsKCQkJaW5zdC5pbnB1dC52YWwoZGF0ZVN0cik7CgkJfQoJCXRoaXMuX3VwZGF0ZUFsdGVybmF0ZShpbnN0KTsKCgkJb25TZWxlY3QgPSB0aGlzLl9nZXQoaW5zdCwgIm9uU2VsZWN0Iik7CgkJaWYgKG9uU2VsZWN0KSB7CgkJCW9uU2VsZWN0LmFwcGx5KChpbnN0LmlucHV0ID8gaW5zdC5pbnB1dFswXSA6IG51bGwpLCBbZGF0ZVN0ciwgaW5zdF0pOyAgLy8gdHJpZ2dlciBjdXN0b20gY2FsbGJhY2sKCQl9IGVsc2UgaWYgKGluc3QuaW5wdXQpIHsKCQkJaW5zdC5pbnB1dC50cmlnZ2VyKCJjaGFuZ2UiKTsgLy8gZmlyZSB0aGUgY2hhbmdlIGV2ZW50CgkJfQoKCQlpZiAoaW5zdC5pbmxpbmUpewoJCQl0aGlzLl91cGRhdGVEYXRlcGlja2VyKGluc3QpOwoJCX0gZWxzZSB7CgkJCXRoaXMuX2hpZGVEYXRlcGlja2VyKCk7CgkJCXRoaXMuX2xhc3RJbnB1dCA9IGluc3QuaW5wdXRbMF07CgkJCWlmICh0eXBlb2YoaW5zdC5pbnB1dFswXSkgIT09ICJvYmplY3QiKSB7CgkJCQlpbnN0LmlucHV0LmZvY3VzKCk7IC8vIHJlc3RvcmUgZm9jdXMKCQkJfQoJCQl0aGlzLl9sYXN0SW5wdXQgPSBudWxsOwoJCX0KCX0sCgoJLyogVXBkYXRlIGFueSBhbHRlcm5hdGUgZmllbGQgdG8gc3luY2hyb25pc2Ugd2l0aCB0aGUgbWFpbiBmaWVsZC4gKi8KCV91cGRhdGVBbHRlcm5hdGU6IGZ1bmN0aW9uKGluc3QpIHsKCQl2YXIgYWx0Rm9ybWF0LCBkYXRlLCBkYXRlU3RyLAoJCQlhbHRGaWVsZCA9IHRoaXMuX2dldChpbnN0LCAiYWx0RmllbGQiKTsKCgkJaWYgKGFsdEZpZWxkKSB7IC8vIHVwZGF0ZSBhbHRlcm5hdGUgZmllbGQgdG9vCgkJCWFsdEZvcm1hdCA9IHRoaXMuX2dldChpbnN0LCAiYWx0Rm9ybWF0IikgfHwgdGhpcy5fZ2V0KGluc3QsICJkYXRlRm9ybWF0Iik7CgkJCWRhdGUgPSB0aGlzLl9nZXREYXRlKGluc3QpOwoJCQlkYXRlU3RyID0gdGhpcy5mb3JtYXREYXRlKGFsdEZvcm1hdCwgZGF0ZSwgdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGluc3QpKTsKCQkJJChhbHRGaWVsZCkuZWFjaChmdW5jdGlvbigpIHsgJCh0aGlzKS52YWwoZGF0ZVN0cik7IH0pOwoJCX0KCX0sCgoJLyogU2V0IGFzIGJlZm9yZVNob3dEYXkgZnVuY3Rpb24gdG8gcHJldmVudCBzZWxlY3Rpb24gb2Ygd2Vla2VuZHMuCgkgKiBAcGFyYW0gIGRhdGUgIERhdGUgLSB0aGUgZGF0ZSB0byBjdXN0b21pc2UKCSAqIEByZXR1cm4gW2Jvb2xlYW4sIHN0cmluZ10gLSBpcyB0aGlzIGRhdGUgc2VsZWN0YWJsZT8sIHdoYXQgaXMgaXRzIENTUyBjbGFzcz8KCSAqLwoJbm9XZWVrZW5kczogZnVuY3Rpb24oZGF0ZSkgewoJCXZhciBkYXkgPSBkYXRlLmdldERheSgpOwoJCXJldHVybiBbKGRheSA+IDAgJiYgZGF5IDwgNiksICIiXTsKCX0sCgoJLyogU2V0IGFzIGNhbGN1bGF0ZVdlZWsgdG8gZGV0ZXJtaW5lIHRoZSB3ZWVrIG9mIHRoZSB5ZWFyIGJhc2VkIG9uIHRoZSBJU08gODYwMSBkZWZpbml0aW9uLgoJICogQHBhcmFtICBkYXRlICBEYXRlIC0gdGhlIGRhdGUgdG8gZ2V0IHRoZSB3ZWVrIGZvcgoJICogQHJldHVybiAgbnVtYmVyIC0gdGhlIG51bWJlciBvZiB0aGUgd2VlayB3aXRoaW4gdGhlIHllYXIgdGhhdCBjb250YWlucyB0aGlzIGRhdGUKCSAqLwoJaXNvODYwMVdlZWs6IGZ1bmN0aW9uKGRhdGUpIHsKCQl2YXIgdGltZSwKCQkJY2hlY2tEYXRlID0gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpOwoKCQkvLyBGaW5kIFRodXJzZGF5IG9mIHRoaXMgd2VlayBzdGFydGluZyBvbiBNb25kYXkKCQljaGVja0RhdGUuc2V0RGF0ZShjaGVja0RhdGUuZ2V0RGF0ZSgpICsgNCAtIChjaGVja0RhdGUuZ2V0RGF5KCkgfHwgNykpOwoKCQl0aW1lID0gY2hlY2tEYXRlLmdldFRpbWUoKTsKCQljaGVja0RhdGUuc2V0TW9udGgoMCk7IC8vIENvbXBhcmUgd2l0aCBKYW4gMQoJCWNoZWNrRGF0ZS5zZXREYXRlKDEpOwoJCXJldHVybiBNYXRoLmZsb29yKE1hdGgucm91bmQoKHRpbWUgLSBjaGVja0RhdGUpIC8gODY0MDAwMDApIC8gNykgKyAxOwoJfSwKCgkvKiBQYXJzZSBhIHN0cmluZyB2YWx1ZSBpbnRvIGEgZGF0ZSBvYmplY3QuCgkgKiBTZWUgZm9ybWF0RGF0ZSBiZWxvdyBmb3IgdGhlIHBvc3NpYmxlIGZvcm1hdHMuCgkgKgoJICogQHBhcmFtICBmb3JtYXQgc3RyaW5nIC0gdGhlIGV4cGVjdGVkIGZvcm1hdCBvZiB0aGUgZGF0ZQoJICogQHBhcmFtICB2YWx1ZSBzdHJpbmcgLSB0aGUgZGF0ZSBpbiB0aGUgYWJvdmUgZm9ybWF0CgkgKiBAcGFyYW0gIHNldHRpbmdzIE9iamVjdCAtIGF0dHJpYnV0ZXMgaW5jbHVkZToKCSAqCQkJCQlzaG9ydFllYXJDdXRvZmYgIG51bWJlciAtIHRoZSBjdXRvZmYgeWVhciBmb3IgZGV0ZXJtaW5pbmcgdGhlIGNlbnR1cnkgKG9wdGlvbmFsKQoJICoJCQkJCWRheU5hbWVzU2hvcnQJc3RyaW5nWzddIC0gYWJicmV2aWF0ZWQgbmFtZXMgb2YgdGhlIGRheXMgZnJvbSBTdW5kYXkgKG9wdGlvbmFsKQoJICoJCQkJCWRheU5hbWVzCQlzdHJpbmdbN10gLSBuYW1lcyBvZiB0aGUgZGF5cyBmcm9tIFN1bmRheSAob3B0aW9uYWwpCgkgKgkJCQkJbW9udGhOYW1lc1Nob3J0IHN0cmluZ1sxMl0gLSBhYmJyZXZpYXRlZCBuYW1lcyBvZiB0aGUgbW9udGhzIChvcHRpb25hbCkKCSAqCQkJCQltb250aE5hbWVzCQlzdHJpbmdbMTJdIC0gbmFtZXMgb2YgdGhlIG1vbnRocyAob3B0aW9uYWwpCgkgKiBAcmV0dXJuICBEYXRlIC0gdGhlIGV4dHJhY3RlZCBkYXRlIHZhbHVlIG9yIG51bGwgaWYgdmFsdWUgaXMgYmxhbmsKCSAqLwoJcGFyc2VEYXRlOiBmdW5jdGlvbiAoZm9ybWF0LCB2YWx1ZSwgc2V0dGluZ3MpIHsKCQlpZiAoZm9ybWF0ID09IG51bGwgfHwgdmFsdWUgPT0gbnVsbCkgewoJCQl0aHJvdyAiSW52YWxpZCBhcmd1bWVudHMiOwoJCX0KCgkJdmFsdWUgPSAodHlwZW9mIHZhbHVlID09PSAib2JqZWN0IiA/IHZhbHVlLnRvU3RyaW5nKCkgOiB2YWx1ZSArICIiKTsKCQlpZiAodmFsdWUgPT09ICIiKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCgkJdmFyIGlGb3JtYXQsIGRpbSwgZXh0cmEsCgkJCWlWYWx1ZSA9IDAsCgkJCXNob3J0WWVhckN1dG9mZlRlbXAgPSAoc2V0dGluZ3MgPyBzZXR0aW5ncy5zaG9ydFllYXJDdXRvZmYgOiBudWxsKSB8fCB0aGlzLl9kZWZhdWx0cy5zaG9ydFllYXJDdXRvZmYsCgkJCXNob3J0WWVhckN1dG9mZiA9ICh0eXBlb2Ygc2hvcnRZZWFyQ3V0b2ZmVGVtcCAhPT0gInN0cmluZyIgPyBzaG9ydFllYXJDdXRvZmZUZW1wIDoKCQkJCW5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSAlIDEwMCArIHBhcnNlSW50KHNob3J0WWVhckN1dG9mZlRlbXAsIDEwKSksCgkJCWRheU5hbWVzU2hvcnQgPSAoc2V0dGluZ3MgPyBzZXR0aW5ncy5kYXlOYW1lc1Nob3J0IDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMuZGF5TmFtZXNTaG9ydCwKCQkJZGF5TmFtZXMgPSAoc2V0dGluZ3MgPyBzZXR0aW5ncy5kYXlOYW1lcyA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzLAoJCQltb250aE5hbWVzU2hvcnQgPSAoc2V0dGluZ3MgPyBzZXR0aW5ncy5tb250aE5hbWVzU2hvcnQgOiBudWxsKSB8fCB0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzU2hvcnQsCgkJCW1vbnRoTmFtZXMgPSAoc2V0dGluZ3MgPyBzZXR0aW5ncy5tb250aE5hbWVzIDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMubW9udGhOYW1lcywKCQkJeWVhciA9IC0xLAoJCQltb250aCA9IC0xLAoJCQlkYXkgPSAtMSwKCQkJZG95ID0gLTEsCgkJCWxpdGVyYWwgPSBmYWxzZSwKCQkJZGF0ZSwKCQkJLy8gQ2hlY2sgd2hldGhlciBhIGZvcm1hdCBjaGFyYWN0ZXIgaXMgZG91YmxlZAoJCQlsb29rQWhlYWQgPSBmdW5jdGlvbihtYXRjaCkgewoJCQkJdmFyIG1hdGNoZXMgPSAoaUZvcm1hdCArIDEgPCBmb3JtYXQubGVuZ3RoICYmIGZvcm1hdC5jaGFyQXQoaUZvcm1hdCArIDEpID09PSBtYXRjaCk7CgkJCQlpZiAobWF0Y2hlcykgewoJCQkJCWlGb3JtYXQrKzsKCQkJCX0KCQkJCXJldHVybiBtYXRjaGVzOwoJCQl9LAoJCQkvLyBFeHRyYWN0IGEgbnVtYmVyIGZyb20gdGhlIHN0cmluZyB2YWx1ZQoJCQlnZXROdW1iZXIgPSBmdW5jdGlvbihtYXRjaCkgewoJCQkJdmFyIGlzRG91YmxlZCA9IGxvb2tBaGVhZChtYXRjaCksCgkJCQkJc2l6ZSA9IChtYXRjaCA9PT0gIkAiID8gMTQgOiAobWF0Y2ggPT09ICIhIiA/IDIwIDoKCQkJCQkobWF0Y2ggPT09ICJ5IiAmJiBpc0RvdWJsZWQgPyA0IDogKG1hdGNoID09PSAibyIgPyAzIDogMikpKSksCgkJCQkJbWluU2l6ZSA9IChtYXRjaCA9PT0gInkiID8gc2l6ZSA6IDEpLAoJCQkJCWRpZ2l0cyA9IG5ldyBSZWdFeHAoIl5cXGR7IiArIG1pblNpemUgKyAiLCIgKyBzaXplICsgIn0iKSwKCQkJCQludW0gPSB2YWx1ZS5zdWJzdHJpbmcoaVZhbHVlKS5tYXRjaChkaWdpdHMpOwoJCQkJaWYgKCFudW0pIHsKCQkJCQl0aHJvdyAiTWlzc2luZyBudW1iZXIgYXQgcG9zaXRpb24gIiArIGlWYWx1ZTsKCQkJCX0KCQkJCWlWYWx1ZSArPSBudW1bMF0ubGVuZ3RoOwoJCQkJcmV0dXJuIHBhcnNlSW50KG51bVswXSwgMTApOwoJCQl9LAoJCQkvLyBFeHRyYWN0IGEgbmFtZSBmcm9tIHRoZSBzdHJpbmcgdmFsdWUgYW5kIGNvbnZlcnQgdG8gYW4gaW5kZXgKCQkJZ2V0TmFtZSA9IGZ1bmN0aW9uKG1hdGNoLCBzaG9ydE5hbWVzLCBsb25nTmFtZXMpIHsKCQkJCXZhciBpbmRleCA9IC0xLAoJCQkJCW5hbWVzID0gJC5tYXAobG9va0FoZWFkKG1hdGNoKSA/IGxvbmdOYW1lcyA6IHNob3J0TmFtZXMsIGZ1bmN0aW9uICh2LCBrKSB7CgkJCQkJCXJldHVybiBbIFtrLCB2XSBdOwoJCQkJCX0pLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKCQkJCQkJcmV0dXJuIC0oYVsxXS5sZW5ndGggLSBiWzFdLmxlbmd0aCk7CgkJCQkJfSk7CgoJCQkJJC5lYWNoKG5hbWVzLCBmdW5jdGlvbiAoaSwgcGFpcikgewoJCQkJCXZhciBuYW1lID0gcGFpclsxXTsKCQkJCQlpZiAodmFsdWUuc3Vic3RyKGlWYWx1ZSwgbmFtZS5sZW5ndGgpLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUudG9Mb3dlckNhc2UoKSkgewoJCQkJCQlpbmRleCA9IHBhaXJbMF07CgkJCQkJCWlWYWx1ZSArPSBuYW1lLmxlbmd0aDsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCX0pOwoJCQkJaWYgKGluZGV4ICE9PSAtMSkgewoJCQkJCXJldHVybiBpbmRleCArIDE7CgkJCQl9IGVsc2UgewoJCQkJCXRocm93ICJVbmtub3duIG5hbWUgYXQgcG9zaXRpb24gIiArIGlWYWx1ZTsKCQkJCX0KCQkJfSwKCQkJLy8gQ29uZmlybSB0aGF0IGEgbGl0ZXJhbCBjaGFyYWN0ZXIgbWF0Y2hlcyB0aGUgc3RyaW5nIHZhbHVlCgkJCWNoZWNrTGl0ZXJhbCA9IGZ1bmN0aW9uKCkgewoJCQkJaWYgKHZhbHVlLmNoYXJBdChpVmFsdWUpICE9PSBmb3JtYXQuY2hhckF0KGlGb3JtYXQpKSB7CgkJCQkJdGhyb3cgIlVuZXhwZWN0ZWQgbGl0ZXJhbCBhdCBwb3NpdGlvbiAiICsgaVZhbHVlOwoJCQkJfQoJCQkJaVZhbHVlKys7CgkJCX07CgoJCWZvciAoaUZvcm1hdCA9IDA7IGlGb3JtYXQgPCBmb3JtYXQubGVuZ3RoOyBpRm9ybWF0KyspIHsKCQkJaWYgKGxpdGVyYWwpIHsKCQkJCWlmIChmb3JtYXQuY2hhckF0KGlGb3JtYXQpID09PSAiJyIgJiYgIWxvb2tBaGVhZCgiJyIpKSB7CgkJCQkJbGl0ZXJhbCA9IGZhbHNlOwoJCQkJfSBlbHNlIHsKCQkJCQljaGVja0xpdGVyYWwoKTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCXN3aXRjaCAoZm9ybWF0LmNoYXJBdChpRm9ybWF0KSkgewoJCQkJCWNhc2UgImQiOgoJCQkJCQlkYXkgPSBnZXROdW1iZXIoImQiKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiRCI6CgkJCQkJCWdldE5hbWUoIkQiLCBkYXlOYW1lc1Nob3J0LCBkYXlOYW1lcyk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIm8iOgoJCQkJCQlkb3kgPSBnZXROdW1iZXIoIm8iKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAibSI6CgkJCQkJCW1vbnRoID0gZ2V0TnVtYmVyKCJtIik7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIk0iOgoJCQkJCQltb250aCA9IGdldE5hbWUoIk0iLCBtb250aE5hbWVzU2hvcnQsIG1vbnRoTmFtZXMpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJ5IjoKCQkJCQkJeWVhciA9IGdldE51bWJlcigieSIpOwoJCQkJCQlicmVhazsKCQkJCQljYXNlICJAIjoKCQkJCQkJZGF0ZSA9IG5ldyBEYXRlKGdldE51bWJlcigiQCIpKTsKCQkJCQkJeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCQkJCQkJbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxOwoJCQkJCQlkYXkgPSBkYXRlLmdldERhdGUoKTsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiISI6CgkJCQkJCWRhdGUgPSBuZXcgRGF0ZSgoZ2V0TnVtYmVyKCIhIikgLSB0aGlzLl90aWNrc1RvMTk3MCkgLyAxMDAwMCk7CgkJCQkJCXllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CgkJCQkJCW1vbnRoID0gZGF0ZS5nZXRNb250aCgpICsgMTsKCQkJCQkJZGF5ID0gZGF0ZS5nZXREYXRlKCk7CgkJCQkJCWJyZWFrOwoJCQkJCWNhc2UgIiciOgoJCQkJCQlpZiAobG9va0FoZWFkKCInIikpewoJCQkJCQkJY2hlY2tMaXRlcmFsKCk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlsaXRlcmFsID0gdHJ1ZTsKCQkJCQkJfQoJCQkJCQlicmVhazsKCQkJCQlkZWZhdWx0OgoJCQkJCQljaGVja0xpdGVyYWwoKTsKCQkJCX0KCQkJfQoJCX0KCgkJaWYgKGlWYWx1ZSA8IHZhbHVlLmxlbmd0aCl7CgkJCWV4dHJhID0gdmFsdWUuc3Vic3RyKGlWYWx1ZSk7CgkJCWlmICghL15ccysvLnRlc3QoZXh0cmEpKSB7CgkJCQl0aHJvdyAiRXh0cmEvdW5wYXJzZWQgY2hhcmFjdGVycyBmb3VuZCBpbiBkYXRlOiAiICsgZXh0cmE7CgkJCX0KCQl9CgoJCWlmICh5ZWFyID09PSAtMSkgewoJCQl5ZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOwoJCX0gZWxzZSBpZiAoeWVhciA8IDEwMCkgewoJCQl5ZWFyICs9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSAtIG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKSAlIDEwMCArCgkJCQkoeWVhciA8PSBzaG9ydFllYXJDdXRvZmYgPyAwIDogLTEwMCk7CgkJfQoKCQlpZiAoZG95ID4gLTEpIHsKCQkJbW9udGggPSAxOwoJCQlkYXkgPSBkb3k7CgkJCWRvIHsKCQkJCWRpbSA9IHRoaXMuX2dldERheXNJbk1vbnRoKHllYXIsIG1vbnRoIC0gMSk7CgkJCQlpZiAoZGF5IDw9IGRpbSkgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJbW9udGgrKzsKCQkJCWRheSAtPSBkaW07CgkJCX0gd2hpbGUgKHRydWUpOwoJCX0KCgkJZGF0ZSA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKHllYXIsIG1vbnRoIC0gMSwgZGF5KSk7CgkJaWYgKGRhdGUuZ2V0RnVsbFllYXIoKSAhPT0geWVhciB8fCBkYXRlLmdldE1vbnRoKCkgKyAxICE9PSBtb250aCB8fCBkYXRlLmdldERhdGUoKSAhPT0gZGF5KSB7CgkJCXRocm93ICJJbnZhbGlkIGRhdGUiOyAvLyBFLmcuIDMxLzAyLzAwCgkJfQoJCXJldHVybiBkYXRlOwoJfSwKCgkvKiBTdGFuZGFyZCBkYXRlIGZvcm1hdHMuICovCglBVE9NOiAieXktbW0tZGQiLCAvLyBSRkMgMzMzOSAoSVNPIDg2MDEpCglDT09LSUU6ICJELCBkZCBNIHl5IiwKCUlTT184NjAxOiAieXktbW0tZGQiLAoJUkZDXzgyMjogIkQsIGQgTSB5IiwKCVJGQ184NTA6ICJERCwgZGQtTS15IiwKCVJGQ18xMDM2OiAiRCwgZCBNIHkiLAoJUkZDXzExMjM6ICJELCBkIE0geXkiLAoJUkZDXzI4MjI6ICJELCBkIE0geXkiLAoJUlNTOiAiRCwgZCBNIHkiLCAvLyBSRkMgODIyCglUSUNLUzogIiEiLAoJVElNRVNUQU1QOiAiQCIsCglXM0M6ICJ5eS1tbS1kZCIsIC8vIElTTyA4NjAxCgoJX3RpY2tzVG8xOTcwOiAoKCgxOTcwIC0gMSkgKiAzNjUgKyBNYXRoLmZsb29yKDE5NzAgLyA0KSAtIE1hdGguZmxvb3IoMTk3MCAvIDEwMCkgKwoJCU1hdGguZmxvb3IoMTk3MCAvIDQwMCkpICogMjQgKiA2MCAqIDYwICogMTAwMDAwMDApLAoKCS8qIEZvcm1hdCBhIGRhdGUgb2JqZWN0IGludG8gYSBzdHJpbmcgdmFsdWUuCgkgKiBUaGUgZm9ybWF0IGNhbiBiZSBjb21iaW5hdGlvbnMgb2YgdGhlIGZvbGxvd2luZzoKCSAqIGQgIC0gZGF5IG9mIG1vbnRoIChubyBsZWFkaW5nIHplcm8pCgkgKiBkZCAtIGRheSBvZiBtb250aCAodHdvIGRpZ2l0KQoJICogbyAgLSBkYXkgb2YgeWVhciAobm8gbGVhZGluZyB6ZXJvcykKCSAqIG9vIC0gZGF5IG9mIHllYXIgKHRocmVlIGRpZ2l0KQoJICogRCAgLSBkYXkgbmFtZSBzaG9ydAoJICogREQgLSBkYXkgbmFtZSBsb25nCgkgKiBtICAtIG1vbnRoIG9mIHllYXIgKG5vIGxlYWRpbmcgemVybykKCSAqIG1tIC0gbW9udGggb2YgeWVhciAodHdvIGRpZ2l0KQoJICogTSAgLSBtb250aCBuYW1lIHNob3J0CgkgKiBNTSAtIG1vbnRoIG5hbWUgbG9uZwoJICogeSAgLSB5ZWFyICh0d28gZGlnaXQpCgkgKiB5eSAtIHllYXIgKGZvdXIgZGlnaXQpCgkgKiBAIC0gVW5peCB0aW1lc3RhbXAgKG1zIHNpbmNlIDAxLzAxLzE5NzApCgkgKiAhIC0gV2luZG93cyB0aWNrcyAoMTAwbnMgc2luY2UgMDEvMDEvMDAwMSkKCSAqICIuLi4iIC0gbGl0ZXJhbCB0ZXh0CgkgKiAnJyAtIHNpbmdsZSBxdW90ZQoJICoKCSAqIEBwYXJhbSAgZm9ybWF0IHN0cmluZyAtIHRoZSBkZXNpcmVkIGZvcm1hdCBvZiB0aGUgZGF0ZQoJICogQHBhcmFtICBkYXRlIERhdGUgLSB0aGUgZGF0ZSB2YWx1ZSB0byBmb3JtYXQKCSAqIEBwYXJhbSAgc2V0dGluZ3MgT2JqZWN0IC0gYXR0cmlidXRlcyBpbmNsdWRlOgoJICoJCQkJCWRheU5hbWVzU2hvcnQJc3RyaW5nWzddIC0gYWJicmV2aWF0ZWQgbmFtZXMgb2YgdGhlIGRheXMgZnJvbSBTdW5kYXkgKG9wdGlvbmFsKQoJICoJCQkJCWRheU5hbWVzCQlzdHJpbmdbN10gLSBuYW1lcyBvZiB0aGUgZGF5cyBmcm9tIFN1bmRheSAob3B0aW9uYWwpCgkgKgkJCQkJbW9udGhOYW1lc1Nob3J0IHN0cmluZ1sxMl0gLSBhYmJyZXZpYXRlZCBuYW1lcyBvZiB0aGUgbW9udGhzIChvcHRpb25hbCkKCSAqCQkJCQltb250aE5hbWVzCQlzdHJpbmdbMTJdIC0gbmFtZXMgb2YgdGhlIG1vbnRocyAob3B0aW9uYWwpCgkgKiBAcmV0dXJuICBzdHJpbmcgLSB0aGUgZGF0ZSBpbiB0aGUgYWJvdmUgZm9ybWF0CgkgKi8KCWZvcm1hdERhdGU6IGZ1bmN0aW9uIChmb3JtYXQsIGRhdGUsIHNldHRpbmdzKSB7CgkJaWYgKCFkYXRlKSB7CgkJCXJldHVybiAiIjsKCQl9CgoJCXZhciBpRm9ybWF0LAoJCQlkYXlOYW1lc1Nob3J0ID0gKHNldHRpbmdzID8gc2V0dGluZ3MuZGF5TmFtZXNTaG9ydCA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLmRheU5hbWVzU2hvcnQsCgkJCWRheU5hbWVzID0gKHNldHRpbmdzID8gc2V0dGluZ3MuZGF5TmFtZXMgOiBudWxsKSB8fCB0aGlzLl9kZWZhdWx0cy5kYXlOYW1lcywKCQkJbW9udGhOYW1lc1Nob3J0ID0gKHNldHRpbmdzID8gc2V0dGluZ3MubW9udGhOYW1lc1Nob3J0IDogbnVsbCkgfHwgdGhpcy5fZGVmYXVsdHMubW9udGhOYW1lc1Nob3J0LAoJCQltb250aE5hbWVzID0gKHNldHRpbmdzID8gc2V0dGluZ3MubW9udGhOYW1lcyA6IG51bGwpIHx8IHRoaXMuX2RlZmF1bHRzLm1vbnRoTmFtZXMsCgkJCS8vIENoZWNrIHdoZXRoZXIgYSBmb3JtYXQgY2hhcmFjdGVyIGlzIGRvdWJsZWQKCQkJbG9va0FoZWFkID0gZnVuY3Rpb24obWF0Y2gpIHsKCQkJCXZhciBtYXRjaGVzID0gKGlGb3JtYXQgKyAxIDwgZm9ybWF0Lmxlbmd0aCAmJiBmb3JtYXQuY2hhckF0KGlGb3JtYXQgKyAxKSA9PT0gbWF0Y2gpOwoJCQkJaWYgKG1hdGNoZXMpIHsKCQkJCQlpRm9ybWF0Kys7CgkJCQl9CgkJCQlyZXR1cm4gbWF0Y2hlczsKCQkJfSwKCQkJLy8gRm9ybWF0IGEgbnVtYmVyLCB3aXRoIGxlYWRpbmcgemVybyBpZiBuZWNlc3NhcnkKCQkJZm9ybWF0TnVtYmVyID0gZnVuY3Rpb24obWF0Y2gsIHZhbHVlLCBsZW4pIHsKCQkJCXZhciBudW0gPSAiIiArIHZhbHVlOwoJCQkJaWYgKGxvb2tBaGVhZChtYXRjaCkpIHsKCQkJCQl3aGlsZSAobnVtLmxlbmd0aCA8IGxlbikgewoJCQkJCQludW0gPSAiMCIgKyBudW07CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIG51bTsKCQkJfSwKCQkJLy8gRm9ybWF0IGEgbmFtZSwgc2hvcnQgb3IgbG9uZyBhcyByZXF1ZXN0ZWQKCQkJZm9ybWF0TmFtZSA9IGZ1bmN0aW9uKG1hdGNoLCB2YWx1ZSwgc2hvcnROYW1lcywgbG9uZ05hbWVzKSB7CgkJCQlyZXR1cm4gKGxvb2tBaGVhZChtYXRjaCkgPyBsb25nTmFtZXNbdmFsdWVdIDogc2hvcnROYW1lc1t2YWx1ZV0pOwoJCQl9LAoJCQlvdXRwdXQgPSAiIiwKCQkJbGl0ZXJhbCA9IGZhbHNlOwoKCQlpZiAoZGF0ZSkgewoJCQlmb3IgKGlGb3JtYXQgPSAwOyBpRm9ybWF0IDwgZm9ybWF0Lmxlbmd0aDsgaUZvcm1hdCsrKSB7CgkJCQlpZiAobGl0ZXJhbCkgewoJCQkJCWlmIChmb3JtYXQuY2hhckF0KGlGb3JtYXQpID09PSAiJyIgJiYgIWxvb2tBaGVhZCgiJyIpKSB7CgkJCQkJCWxpdGVyYWwgPSBmYWxzZTsKCQkJCQl9IGVsc2UgewoJCQkJCQlvdXRwdXQgKz0gZm9ybWF0LmNoYXJBdChpRm9ybWF0KTsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCXN3aXRjaCAoZm9ybWF0LmNoYXJBdChpRm9ybWF0KSkgewoJCQkJCQljYXNlICJkIjoKCQkJCQkJCW91dHB1dCArPSBmb3JtYXROdW1iZXIoImQiLCBkYXRlLmdldERhdGUoKSwgMik7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAiRCI6CgkJCQkJCQlvdXRwdXQgKz0gZm9ybWF0TmFtZSgiRCIsIGRhdGUuZ2V0RGF5KCksIGRheU5hbWVzU2hvcnQsIGRheU5hbWVzKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICJvIjoKCQkJCQkJCW91dHB1dCArPSBmb3JtYXROdW1iZXIoIm8iLAoJCQkJCQkJCU1hdGgucm91bmQoKG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpLCBkYXRlLmdldERhdGUoKSkuZ2V0VGltZSgpIC0gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCAwLCAwKS5nZXRUaW1lKCkpIC8gODY0MDAwMDApLCAzKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICJtIjoKCQkJCQkJCW91dHB1dCArPSBmb3JtYXROdW1iZXIoIm0iLCBkYXRlLmdldE1vbnRoKCkgKyAxLCAyKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQljYXNlICJNIjoKCQkJCQkJCW91dHB1dCArPSBmb3JtYXROYW1lKCJNIiwgZGF0ZS5nZXRNb250aCgpLCBtb250aE5hbWVzU2hvcnQsIG1vbnRoTmFtZXMpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgInkiOgoJCQkJCQkJb3V0cHV0ICs9IChsb29rQWhlYWQoInkiKSA/IGRhdGUuZ2V0RnVsbFllYXIoKSA6CgkJCQkJCQkJKGRhdGUuZ2V0WWVhcigpICUgMTAwIDwgMTAgPyAiMCIgOiAiIikgKyBkYXRlLmdldFllYXIoKSAlIDEwMCk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAiQCI6CgkJCQkJCQlvdXRwdXQgKz0gZGF0ZS5nZXRUaW1lKCk7CgkJCQkJCQlicmVhazsKCQkJCQkJY2FzZSAiISI6CgkJCQkJCQlvdXRwdXQgKz0gZGF0ZS5nZXRUaW1lKCkgKiAxMDAwMCArIHRoaXMuX3RpY2tzVG8xOTcwOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgIiciOgoJCQkJCQkJaWYgKGxvb2tBaGVhZCgiJyIpKSB7CgkJCQkJCQkJb3V0cHV0ICs9ICInIjsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJbGl0ZXJhbCA9IHRydWU7CgkJCQkJCQl9CgkJCQkJCQlicmVhazsKCQkJCQkJZGVmYXVsdDoKCQkJCQkJCW91dHB1dCArPSBmb3JtYXQuY2hhckF0KGlGb3JtYXQpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQlyZXR1cm4gb3V0cHV0OwoJfSwKCgkvKiBFeHRyYWN0IGFsbCBwb3NzaWJsZSBjaGFyYWN0ZXJzIGZyb20gdGhlIGRhdGUgZm9ybWF0LiAqLwoJX3Bvc3NpYmxlQ2hhcnM6IGZ1bmN0aW9uIChmb3JtYXQpIHsKCQl2YXIgaUZvcm1hdCwKCQkJY2hhcnMgPSAiIiwKCQkJbGl0ZXJhbCA9IGZhbHNlLAoJCQkvLyBDaGVjayB3aGV0aGVyIGEgZm9ybWF0IGNoYXJhY3RlciBpcyBkb3VibGVkCgkJCWxvb2tBaGVhZCA9IGZ1bmN0aW9uKG1hdGNoKSB7CgkJCQl2YXIgbWF0Y2hlcyA9IChpRm9ybWF0ICsgMSA8IGZvcm1hdC5sZW5ndGggJiYgZm9ybWF0LmNoYXJBdChpRm9ybWF0ICsgMSkgPT09IG1hdGNoKTsKCQkJCWlmIChtYXRjaGVzKSB7CgkJCQkJaUZvcm1hdCsrOwoJCQkJfQoJCQkJcmV0dXJuIG1hdGNoZXM7CgkJCX07CgoJCWZvciAoaUZvcm1hdCA9IDA7IGlGb3JtYXQgPCBmb3JtYXQubGVuZ3RoOyBpRm9ybWF0KyspIHsKCQkJaWYgKGxpdGVyYWwpIHsKCQkJCWlmIChmb3JtYXQuY2hhckF0KGlGb3JtYXQpID09PSAiJyIgJiYgIWxvb2tBaGVhZCgiJyIpKSB7CgkJCQkJbGl0ZXJhbCA9IGZhbHNlOwoJCQkJfSBlbHNlIHsKCQkJCQljaGFycyArPSBmb3JtYXQuY2hhckF0KGlGb3JtYXQpOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJc3dpdGNoIChmb3JtYXQuY2hhckF0KGlGb3JtYXQpKSB7CgkJCQkJY2FzZSAiZCI6IGNhc2UgIm0iOiBjYXNlICJ5IjogY2FzZSAiQCI6CgkJCQkJCWNoYXJzICs9ICIwMTIzNDU2Nzg5IjsKCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSAiRCI6IGNhc2UgIk0iOgoJCQkJCQlyZXR1cm4gbnVsbDsgLy8gQWNjZXB0IGFueXRoaW5nCgkJCQkJY2FzZSAiJyI6CgkJCQkJCWlmIChsb29rQWhlYWQoIiciKSkgewoJCQkJCQkJY2hhcnMgKz0gIiciOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJbGl0ZXJhbCA9IHRydWU7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJZGVmYXVsdDoKCQkJCQkJY2hhcnMgKz0gZm9ybWF0LmNoYXJBdChpRm9ybWF0KTsKCQkJCX0KCQkJfQoJCX0KCQlyZXR1cm4gY2hhcnM7Cgl9LAoKCS8qIEdldCBhIHNldHRpbmcgdmFsdWUsIGRlZmF1bHRpbmcgaWYgbmVjZXNzYXJ5LiAqLwoJX2dldDogZnVuY3Rpb24oaW5zdCwgbmFtZSkgewoJCXJldHVybiBpbnN0LnNldHRpbmdzW25hbWVdICE9PSB1bmRlZmluZWQgPwoJCQlpbnN0LnNldHRpbmdzW25hbWVdIDogdGhpcy5fZGVmYXVsdHNbbmFtZV07Cgl9LAoKCS8qIFBhcnNlIGV4aXN0aW5nIGRhdGUgYW5kIGluaXRpYWxpc2UgZGF0ZSBwaWNrZXIuICovCglfc2V0RGF0ZUZyb21GaWVsZDogZnVuY3Rpb24oaW5zdCwgbm9EZWZhdWx0KSB7CgkJaWYgKGluc3QuaW5wdXQudmFsKCkgPT09IGluc3QubGFzdFZhbCkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgZGF0ZUZvcm1hdCA9IHRoaXMuX2dldChpbnN0LCAiZGF0ZUZvcm1hdCIpLAoJCQlkYXRlcyA9IGluc3QubGFzdFZhbCA9IGluc3QuaW5wdXQgPyBpbnN0LmlucHV0LnZhbCgpIDogbnVsbCwKCQkJZGVmYXVsdERhdGUgPSB0aGlzLl9nZXREZWZhdWx0RGF0ZShpbnN0KSwKCQkJZGF0ZSA9IGRlZmF1bHREYXRlLAoJCQlzZXR0aW5ncyA9IHRoaXMuX2dldEZvcm1hdENvbmZpZyhpbnN0KTsKCgkJdHJ5IHsKCQkJZGF0ZSA9IHRoaXMucGFyc2VEYXRlKGRhdGVGb3JtYXQsIGRhdGVzLCBzZXR0aW5ncykgfHwgZGVmYXVsdERhdGU7CgkJfSBjYXRjaCAoZXZlbnQpIHsKCQkJZGF0ZXMgPSAobm9EZWZhdWx0ID8gIiIgOiBkYXRlcyk7CgkJfQoJCWluc3Quc2VsZWN0ZWREYXkgPSBkYXRlLmdldERhdGUoKTsKCQlpbnN0LmRyYXdNb250aCA9IGluc3Quc2VsZWN0ZWRNb250aCA9IGRhdGUuZ2V0TW9udGgoKTsKCQlpbnN0LmRyYXdZZWFyID0gaW5zdC5zZWxlY3RlZFllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CgkJaW5zdC5jdXJyZW50RGF5ID0gKGRhdGVzID8gZGF0ZS5nZXREYXRlKCkgOiAwKTsKCQlpbnN0LmN1cnJlbnRNb250aCA9IChkYXRlcyA/IGRhdGUuZ2V0TW9udGgoKSA6IDApOwoJCWluc3QuY3VycmVudFllYXIgPSAoZGF0ZXMgPyBkYXRlLmdldEZ1bGxZZWFyKCkgOiAwKTsKCQl0aGlzLl9hZGp1c3RJbnN0RGF0ZShpbnN0KTsKCX0sCgoJLyogUmV0cmlldmUgdGhlIGRlZmF1bHQgZGF0ZSBzaG93biBvbiBvcGVuaW5nLiAqLwoJX2dldERlZmF1bHREYXRlOiBmdW5jdGlvbihpbnN0KSB7CgkJcmV0dXJuIHRoaXMuX3Jlc3RyaWN0TWluTWF4KGluc3QsCgkJCXRoaXMuX2RldGVybWluZURhdGUoaW5zdCwgdGhpcy5fZ2V0KGluc3QsICJkZWZhdWx0RGF0ZSIpLCBuZXcgRGF0ZSgpKSk7Cgl9LAoKCS8qIEEgZGF0ZSBtYXkgYmUgc3BlY2lmaWVkIGFzIGFuIGV4YWN0IHZhbHVlIG9yIGEgcmVsYXRpdmUgb25lLiAqLwoJX2RldGVybWluZURhdGU6IGZ1bmN0aW9uKGluc3QsIGRhdGUsIGRlZmF1bHREYXRlKSB7CgkJdmFyIG9mZnNldE51bWVyaWMgPSBmdW5jdGlvbihvZmZzZXQpIHsKCQkJCXZhciBkYXRlID0gbmV3IERhdGUoKTsKCQkJCWRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIG9mZnNldCk7CgkJCQlyZXR1cm4gZGF0ZTsKCQkJfSwKCQkJb2Zmc2V0U3RyaW5nID0gZnVuY3Rpb24ob2Zmc2V0KSB7CgkJCQl0cnkgewoJCQkJCXJldHVybiAkLmRhdGVwaWNrZXIucGFyc2VEYXRlKCQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICJkYXRlRm9ybWF0IiksCgkJCQkJCW9mZnNldCwgJC5kYXRlcGlja2VyLl9nZXRGb3JtYXRDb25maWcoaW5zdCkpOwoJCQkJfQoJCQkJY2F0Y2ggKGUpIHsKCQkJCQkvLyBJZ25vcmUKCQkJCX0KCgkJCQl2YXIgZGF0ZSA9IChvZmZzZXQudG9Mb3dlckNhc2UoKS5tYXRjaCgvXmMvKSA/CgkJCQkJJC5kYXRlcGlja2VyLl9nZXREYXRlKGluc3QpIDogbnVsbCkgfHwgbmV3IERhdGUoKSwKCQkJCQl5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpLAoJCQkJCW1vbnRoID0gZGF0ZS5nZXRNb250aCgpLAoJCQkJCWRheSA9IGRhdGUuZ2V0RGF0ZSgpLAoJCQkJCXBhdHRlcm4gPSAvKFsrXC1dP1swLTldKylccyooZHxEfHd8V3xtfE18eXxZKT8vZywKCQkJCQltYXRjaGVzID0gcGF0dGVybi5leGVjKG9mZnNldCk7CgoJCQkJd2hpbGUgKG1hdGNoZXMpIHsKCQkJCQlzd2l0Y2ggKG1hdGNoZXNbMl0gfHwgImQiKSB7CgkJCQkJCWNhc2UgImQiIDogY2FzZSAiRCIgOgoJCQkJCQkJZGF5ICs9IHBhcnNlSW50KG1hdGNoZXNbMV0sMTApOyBicmVhazsKCQkJCQkJY2FzZSAidyIgOiBjYXNlICJXIiA6CgkJCQkJCQlkYXkgKz0gcGFyc2VJbnQobWF0Y2hlc1sxXSwxMCkgKiA3OyBicmVhazsKCQkJCQkJY2FzZSAibSIgOiBjYXNlICJNIiA6CgkJCQkJCQltb250aCArPSBwYXJzZUludChtYXRjaGVzWzFdLDEwKTsKCQkJCQkJCWRheSA9IE1hdGgubWluKGRheSwgJC5kYXRlcGlja2VyLl9nZXREYXlzSW5Nb250aCh5ZWFyLCBtb250aCkpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCWNhc2UgInkiOiBjYXNlICJZIiA6CgkJCQkJCQl5ZWFyICs9IHBhcnNlSW50KG1hdGNoZXNbMV0sMTApOwoJCQkJCQkJZGF5ID0gTWF0aC5taW4oZGF5LCAkLmRhdGVwaWNrZXIuX2dldERheXNJbk1vbnRoKHllYXIsIG1vbnRoKSk7CgkJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJbWF0Y2hlcyA9IHBhdHRlcm4uZXhlYyhvZmZzZXQpOwoJCQkJfQoJCQkJcmV0dXJuIG5ldyBEYXRlKHllYXIsIG1vbnRoLCBkYXkpOwoJCQl9LAoJCQluZXdEYXRlID0gKGRhdGUgPT0gbnVsbCB8fCBkYXRlID09PSAiIiA/IGRlZmF1bHREYXRlIDogKHR5cGVvZiBkYXRlID09PSAic3RyaW5nIiA/IG9mZnNldFN0cmluZyhkYXRlKSA6CgkJCQkodHlwZW9mIGRhdGUgPT09ICJudW1iZXIiID8gKGlzTmFOKGRhdGUpID8gZGVmYXVsdERhdGUgOiBvZmZzZXROdW1lcmljKGRhdGUpKSA6IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKSkpKTsKCgkJbmV3RGF0ZSA9IChuZXdEYXRlICYmIG5ld0RhdGUudG9TdHJpbmcoKSA9PT0gIkludmFsaWQgRGF0ZSIgPyBkZWZhdWx0RGF0ZSA6IG5ld0RhdGUpOwoJCWlmIChuZXdEYXRlKSB7CgkJCW5ld0RhdGUuc2V0SG91cnMoMCk7CgkJCW5ld0RhdGUuc2V0TWludXRlcygwKTsKCQkJbmV3RGF0ZS5zZXRTZWNvbmRzKDApOwoJCQluZXdEYXRlLnNldE1pbGxpc2Vjb25kcygwKTsKCQl9CgkJcmV0dXJuIHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ld0RhdGUpOwoJfSwKCgkvKiBIYW5kbGUgc3dpdGNoIHRvL2Zyb20gZGF5bGlnaHQgc2F2aW5nLgoJICogSG91cnMgbWF5IGJlIG5vbi16ZXJvIG9uIGRheWxpZ2h0IHNhdmluZyBjdXQtb3ZlcjoKCSAqID4gMTIgd2hlbiBtaWRuaWdodCBjaGFuZ2VvdmVyLCBidXQgdGhlbiBjYW5ub3QgZ2VuZXJhdGUKCSAqIG1pZG5pZ2h0IGRhdGV0aW1lLCBzbyBqdW1wIHRvIDFBTSwgb3RoZXJ3aXNlIHJlc2V0LgoJICogQHBhcmFtICBkYXRlICAoRGF0ZSkgdGhlIGRhdGUgdG8gY2hlY2sKCSAqIEByZXR1cm4gIChEYXRlKSB0aGUgY29ycmVjdGVkIGRhdGUKCSAqLwoJX2RheWxpZ2h0U2F2aW5nQWRqdXN0OiBmdW5jdGlvbihkYXRlKSB7CgkJaWYgKCFkYXRlKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCQlkYXRlLnNldEhvdXJzKGRhdGUuZ2V0SG91cnMoKSA+IDEyID8gZGF0ZS5nZXRIb3VycygpICsgMiA6IDApOwoJCXJldHVybiBkYXRlOwoJfSwKCgkvKiBTZXQgdGhlIGRhdGUocykgZGlyZWN0bHkuICovCglfc2V0RGF0ZTogZnVuY3Rpb24oaW5zdCwgZGF0ZSwgbm9DaGFuZ2UpIHsKCQl2YXIgY2xlYXIgPSAhZGF0ZSwKCQkJb3JpZ01vbnRoID0gaW5zdC5zZWxlY3RlZE1vbnRoLAoJCQlvcmlnWWVhciA9IGluc3Quc2VsZWN0ZWRZZWFyLAoJCQluZXdEYXRlID0gdGhpcy5fcmVzdHJpY3RNaW5NYXgoaW5zdCwgdGhpcy5fZGV0ZXJtaW5lRGF0ZShpbnN0LCBkYXRlLCBuZXcgRGF0ZSgpKSk7CgoJCWluc3Quc2VsZWN0ZWREYXkgPSBpbnN0LmN1cnJlbnREYXkgPSBuZXdEYXRlLmdldERhdGUoKTsKCQlpbnN0LmRyYXdNb250aCA9IGluc3Quc2VsZWN0ZWRNb250aCA9IGluc3QuY3VycmVudE1vbnRoID0gbmV3RGF0ZS5nZXRNb250aCgpOwoJCWluc3QuZHJhd1llYXIgPSBpbnN0LnNlbGVjdGVkWWVhciA9IGluc3QuY3VycmVudFllYXIgPSBuZXdEYXRlLmdldEZ1bGxZZWFyKCk7CgkJaWYgKChvcmlnTW9udGggIT09IGluc3Quc2VsZWN0ZWRNb250aCB8fCBvcmlnWWVhciAhPT0gaW5zdC5zZWxlY3RlZFllYXIpICYmICFub0NoYW5nZSkgewoJCQl0aGlzLl9ub3RpZnlDaGFuZ2UoaW5zdCk7CgkJfQoJCXRoaXMuX2FkanVzdEluc3REYXRlKGluc3QpOwoJCWlmIChpbnN0LmlucHV0KSB7CgkJCWluc3QuaW5wdXQudmFsKGNsZWFyID8gIiIgOiB0aGlzLl9mb3JtYXREYXRlKGluc3QpKTsKCQl9Cgl9LAoKCS8qIFJldHJpZXZlIHRoZSBkYXRlKHMpIGRpcmVjdGx5LiAqLwoJX2dldERhdGU6IGZ1bmN0aW9uKGluc3QpIHsKCQl2YXIgc3RhcnREYXRlID0gKCFpbnN0LmN1cnJlbnRZZWFyIHx8IChpbnN0LmlucHV0ICYmIGluc3QuaW5wdXQudmFsKCkgPT09ICIiKSA/IG51bGwgOgoJCQl0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZSgKCQkJaW5zdC5jdXJyZW50WWVhciwgaW5zdC5jdXJyZW50TW9udGgsIGluc3QuY3VycmVudERheSkpKTsKCQkJcmV0dXJuIHN0YXJ0RGF0ZTsKCX0sCgoJLyogQXR0YWNoIHRoZSBvbnh4eCBoYW5kbGVycy4gIFRoZXNlIGFyZSBkZWNsYXJlZCBzdGF0aWNhbGx5IHNvCgkgKiB0aGV5IHdvcmsgd2l0aCBzdGF0aWMgY29kZSB0cmFuc2Zvcm1lcnMgbGlrZSBDYWphLgoJICovCglfYXR0YWNoSGFuZGxlcnM6IGZ1bmN0aW9uKGluc3QpIHsKCQl2YXIgc3RlcE1vbnRocyA9IHRoaXMuX2dldChpbnN0LCAic3RlcE1vbnRocyIpLAoJCQlpZCA9ICIjIiArIGluc3QuaWQucmVwbGFjZSggL1xcXFwvZywgIlxcIiApOwoJCWluc3QuZHBEaXYuZmluZCgiW2RhdGEtaGFuZGxlcl0iKS5tYXAoZnVuY3Rpb24gKCkgewoJCQl2YXIgaGFuZGxlciA9IHsKCQkJCXByZXY6IGZ1bmN0aW9uICgpIHsKCQkJCQkkLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoaWQsIC1zdGVwTW9udGhzLCAiTSIpOwoJCQkJfSwKCQkJCW5leHQ6IGZ1bmN0aW9uICgpIHsKCQkJCQkkLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoaWQsICtzdGVwTW9udGhzLCAiTSIpOwoJCQkJfSwKCQkJCWhpZGU6IGZ1bmN0aW9uICgpIHsKCQkJCQkkLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7CgkJCQl9LAoJCQkJdG9kYXk6IGZ1bmN0aW9uICgpIHsKCQkJCQkkLmRhdGVwaWNrZXIuX2dvdG9Ub2RheShpZCk7CgkJCQl9LAoJCQkJc2VsZWN0RGF5OiBmdW5jdGlvbiAoKSB7CgkJCQkJJC5kYXRlcGlja2VyLl9zZWxlY3REYXkoaWQsICt0aGlzLmdldEF0dHJpYnV0ZSgiZGF0YS1tb250aCIpLCArdGhpcy5nZXRBdHRyaWJ1dGUoImRhdGEteWVhciIpLCB0aGlzKTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9LAoJCQkJc2VsZWN0TW9udGg6IGZ1bmN0aW9uICgpIHsKCQkJCQkkLmRhdGVwaWNrZXIuX3NlbGVjdE1vbnRoWWVhcihpZCwgdGhpcywgIk0iKTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9LAoJCQkJc2VsZWN0WWVhcjogZnVuY3Rpb24gKCkgewoJCQkJCSQuZGF0ZXBpY2tlci5fc2VsZWN0TW9udGhZZWFyKGlkLCB0aGlzLCAiWSIpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfTsKCQkJJCh0aGlzKS5iaW5kKHRoaXMuZ2V0QXR0cmlidXRlKCJkYXRhLWV2ZW50IiksIGhhbmRsZXJbdGhpcy5nZXRBdHRyaWJ1dGUoImRhdGEtaGFuZGxlciIpXSk7CgkJfSk7Cgl9LAoKCS8qIEdlbmVyYXRlIHRoZSBIVE1MIGZvciB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgZGF0ZSBwaWNrZXIuICovCglfZ2VuZXJhdGVIVE1MOiBmdW5jdGlvbihpbnN0KSB7CgkJdmFyIG1heERyYXcsIHByZXZUZXh0LCBwcmV2LCBuZXh0VGV4dCwgbmV4dCwgY3VycmVudFRleHQsIGdvdG9EYXRlLAoJCQljb250cm9scywgYnV0dG9uUGFuZWwsIGZpcnN0RGF5LCBzaG93V2VlaywgZGF5TmFtZXMsIGRheU5hbWVzTWluLAoJCQltb250aE5hbWVzLCBtb250aE5hbWVzU2hvcnQsIGJlZm9yZVNob3dEYXksIHNob3dPdGhlck1vbnRocywKCQkJc2VsZWN0T3RoZXJNb250aHMsIGRlZmF1bHREYXRlLCBodG1sLCBkb3csIHJvdywgZ3JvdXAsIGNvbCwgc2VsZWN0ZWREYXRlLAoJCQljb3JuZXJDbGFzcywgY2FsZW5kZXIsIHRoZWFkLCBkYXksIGRheXNJbk1vbnRoLCBsZWFkRGF5cywgY3VyUm93cywgbnVtUm93cywKCQkJcHJpbnREYXRlLCBkUm93LCB0Ym9keSwgZGF5U2V0dGluZ3MsIG90aGVyTW9udGgsIHVuc2VsZWN0YWJsZSwKCQkJdGVtcERhdGUgPSBuZXcgRGF0ZSgpLAoJCQl0b2RheSA9IHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KAoJCQkJbmV3IERhdGUodGVtcERhdGUuZ2V0RnVsbFllYXIoKSwgdGVtcERhdGUuZ2V0TW9udGgoKSwgdGVtcERhdGUuZ2V0RGF0ZSgpKSksIC8vIGNsZWFyIHRpbWUKCQkJaXNSVEwgPSB0aGlzLl9nZXQoaW5zdCwgImlzUlRMIiksCgkJCXNob3dCdXR0b25QYW5lbCA9IHRoaXMuX2dldChpbnN0LCAic2hvd0J1dHRvblBhbmVsIiksCgkJCWhpZGVJZk5vUHJldk5leHQgPSB0aGlzLl9nZXQoaW5zdCwgImhpZGVJZk5vUHJldk5leHQiKSwKCQkJbmF2aWdhdGlvbkFzRGF0ZUZvcm1hdCA9IHRoaXMuX2dldChpbnN0LCAibmF2aWdhdGlvbkFzRGF0ZUZvcm1hdCIpLAoJCQludW1Nb250aHMgPSB0aGlzLl9nZXROdW1iZXJPZk1vbnRocyhpbnN0KSwKCQkJc2hvd0N1cnJlbnRBdFBvcyA9IHRoaXMuX2dldChpbnN0LCAic2hvd0N1cnJlbnRBdFBvcyIpLAoJCQlzdGVwTW9udGhzID0gdGhpcy5fZ2V0KGluc3QsICJzdGVwTW9udGhzIiksCgkJCWlzTXVsdGlNb250aCA9IChudW1Nb250aHNbMF0gIT09IDEgfHwgbnVtTW9udGhzWzFdICE9PSAxKSwKCQkJY3VycmVudERhdGUgPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdCgoIWluc3QuY3VycmVudERheSA/IG5ldyBEYXRlKDk5OTksIDksIDkpIDoKCQkJCW5ldyBEYXRlKGluc3QuY3VycmVudFllYXIsIGluc3QuY3VycmVudE1vbnRoLCBpbnN0LmN1cnJlbnREYXkpKSksCgkJCW1pbkRhdGUgPSB0aGlzLl9nZXRNaW5NYXhEYXRlKGluc3QsICJtaW4iKSwKCQkJbWF4RGF0ZSA9IHRoaXMuX2dldE1pbk1heERhdGUoaW5zdCwgIm1heCIpLAoJCQlkcmF3TW9udGggPSBpbnN0LmRyYXdNb250aCAtIHNob3dDdXJyZW50QXRQb3MsCgkJCWRyYXdZZWFyID0gaW5zdC5kcmF3WWVhcjsKCgkJaWYgKGRyYXdNb250aCA8IDApIHsKCQkJZHJhd01vbnRoICs9IDEyOwoJCQlkcmF3WWVhci0tOwoJCX0KCQlpZiAobWF4RGF0ZSkgewoJCQltYXhEcmF3ID0gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUobWF4RGF0ZS5nZXRGdWxsWWVhcigpLAoJCQkJbWF4RGF0ZS5nZXRNb250aCgpIC0gKG51bU1vbnRoc1swXSAqIG51bU1vbnRoc1sxXSkgKyAxLCBtYXhEYXRlLmdldERhdGUoKSkpOwoJCQltYXhEcmF3ID0gKG1pbkRhdGUgJiYgbWF4RHJhdyA8IG1pbkRhdGUgPyBtaW5EYXRlIDogbWF4RHJhdyk7CgkJCXdoaWxlICh0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShkcmF3WWVhciwgZHJhd01vbnRoLCAxKSkgPiBtYXhEcmF3KSB7CgkJCQlkcmF3TW9udGgtLTsKCQkJCWlmIChkcmF3TW9udGggPCAwKSB7CgkJCQkJZHJhd01vbnRoID0gMTE7CgkJCQkJZHJhd1llYXItLTsKCQkJCX0KCQkJfQoJCX0KCQlpbnN0LmRyYXdNb250aCA9IGRyYXdNb250aDsKCQlpbnN0LmRyYXdZZWFyID0gZHJhd1llYXI7CgoJCXByZXZUZXh0ID0gdGhpcy5fZ2V0KGluc3QsICJwcmV2VGV4dCIpOwoJCXByZXZUZXh0ID0gKCFuYXZpZ2F0aW9uQXNEYXRlRm9ybWF0ID8gcHJldlRleHQgOiB0aGlzLmZvcm1hdERhdGUocHJldlRleHQsCgkJCXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGRyYXdZZWFyLCBkcmF3TW9udGggLSBzdGVwTW9udGhzLCAxKSksCgkJCXRoaXMuX2dldEZvcm1hdENvbmZpZyhpbnN0KSkpOwoKCQlwcmV2ID0gKHRoaXMuX2NhbkFkanVzdE1vbnRoKGluc3QsIC0xLCBkcmF3WWVhciwgZHJhd01vbnRoKSA/CgkJCSI8YSBjbGFzcz0ndWktZGF0ZXBpY2tlci1wcmV2IHVpLWNvcm5lci1hbGwnIGRhdGEtaGFuZGxlcj0ncHJldicgZGF0YS1ldmVudD0nY2xpY2snIiArCgkJCSIgdGl0bGU9JyIgKyBwcmV2VGV4dCArICInPjxzcGFuIGNsYXNzPSd1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLSIgKyAoIGlzUlRMID8gImUiIDogInciKSArICInPiIgKyBwcmV2VGV4dCArICI8L3NwYW4+PC9hPiIgOgoJCQkoaGlkZUlmTm9QcmV2TmV4dCA/ICIiIDogIjxhIGNsYXNzPSd1aS1kYXRlcGlja2VyLXByZXYgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1kaXNhYmxlZCcgdGl0bGU9JyIrIHByZXZUZXh0ICsiJz48c3BhbiBjbGFzcz0ndWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0iICsgKCBpc1JUTCA/ICJlIiA6ICJ3IikgKyAiJz4iICsgcHJldlRleHQgKyAiPC9zcGFuPjwvYT4iKSk7CgoJCW5leHRUZXh0ID0gdGhpcy5fZ2V0KGluc3QsICJuZXh0VGV4dCIpOwoJCW5leHRUZXh0ID0gKCFuYXZpZ2F0aW9uQXNEYXRlRm9ybWF0ID8gbmV4dFRleHQgOiB0aGlzLmZvcm1hdERhdGUobmV4dFRleHQsCgkJCXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGRyYXdZZWFyLCBkcmF3TW9udGggKyBzdGVwTW9udGhzLCAxKSksCgkJCXRoaXMuX2dldEZvcm1hdENvbmZpZyhpbnN0KSkpOwoKCQluZXh0ID0gKHRoaXMuX2NhbkFkanVzdE1vbnRoKGluc3QsICsxLCBkcmF3WWVhciwgZHJhd01vbnRoKSA/CgkJCSI8YSBjbGFzcz0ndWktZGF0ZXBpY2tlci1uZXh0IHVpLWNvcm5lci1hbGwnIGRhdGEtaGFuZGxlcj0nbmV4dCcgZGF0YS1ldmVudD0nY2xpY2snIiArCgkJCSIgdGl0bGU9JyIgKyBuZXh0VGV4dCArICInPjxzcGFuIGNsYXNzPSd1aS1pY29uIHVpLWljb24tY2lyY2xlLXRyaWFuZ2xlLSIgKyAoIGlzUlRMID8gInciIDogImUiKSArICInPiIgKyBuZXh0VGV4dCArICI8L3NwYW4+PC9hPiIgOgoJCQkoaGlkZUlmTm9QcmV2TmV4dCA/ICIiIDogIjxhIGNsYXNzPSd1aS1kYXRlcGlja2VyLW5leHQgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1kaXNhYmxlZCcgdGl0bGU9JyIrIG5leHRUZXh0ICsgIic+PHNwYW4gY2xhc3M9J3VpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtIiArICggaXNSVEwgPyAidyIgOiAiZSIpICsgIic+IiArIG5leHRUZXh0ICsgIjwvc3Bhbj48L2E+IikpOwoKCQljdXJyZW50VGV4dCA9IHRoaXMuX2dldChpbnN0LCAiY3VycmVudFRleHQiKTsKCQlnb3RvRGF0ZSA9ICh0aGlzLl9nZXQoaW5zdCwgImdvdG9DdXJyZW50IikgJiYgaW5zdC5jdXJyZW50RGF5ID8gY3VycmVudERhdGUgOiB0b2RheSk7CgkJY3VycmVudFRleHQgPSAoIW5hdmlnYXRpb25Bc0RhdGVGb3JtYXQgPyBjdXJyZW50VGV4dCA6CgkJCXRoaXMuZm9ybWF0RGF0ZShjdXJyZW50VGV4dCwgZ290b0RhdGUsIHRoaXMuX2dldEZvcm1hdENvbmZpZyhpbnN0KSkpOwoKCQljb250cm9scyA9ICghaW5zdC5pbmxpbmUgPyAiPGJ1dHRvbiB0eXBlPSdidXR0b24nIGNsYXNzPSd1aS1kYXRlcGlja2VyLWNsb3NlIHVpLXN0YXRlLWRlZmF1bHQgdWktcHJpb3JpdHktcHJpbWFyeSB1aS1jb3JuZXItYWxsJyBkYXRhLWhhbmRsZXI9J2hpZGUnIGRhdGEtZXZlbnQ9J2NsaWNrJz4iICsKCQkJdGhpcy5fZ2V0KGluc3QsICJjbG9zZVRleHQiKSArICI8L2J1dHRvbj4iIDogIiIpOwoKCQlidXR0b25QYW5lbCA9IChzaG93QnV0dG9uUGFuZWwpID8gIjxkaXYgY2xhc3M9J3VpLWRhdGVwaWNrZXItYnV0dG9ucGFuZSB1aS13aWRnZXQtY29udGVudCc+IiArIChpc1JUTCA/IGNvbnRyb2xzIDogIiIpICsKCQkJKHRoaXMuX2lzSW5SYW5nZShpbnN0LCBnb3RvRGF0ZSkgPyAiPGJ1dHRvbiB0eXBlPSdidXR0b24nIGNsYXNzPSd1aS1kYXRlcGlja2VyLWN1cnJlbnQgdWktc3RhdGUtZGVmYXVsdCB1aS1wcmlvcml0eS1zZWNvbmRhcnkgdWktY29ybmVyLWFsbCcgZGF0YS1oYW5kbGVyPSd0b2RheScgZGF0YS1ldmVudD0nY2xpY2snIiArCgkJCSI+IiArIGN1cnJlbnRUZXh0ICsgIjwvYnV0dG9uPiIgOiAiIikgKyAoaXNSVEwgPyAiIiA6IGNvbnRyb2xzKSArICI8L2Rpdj4iIDogIiI7CgoJCWZpcnN0RGF5ID0gcGFyc2VJbnQodGhpcy5fZ2V0KGluc3QsICJmaXJzdERheSIpLDEwKTsKCQlmaXJzdERheSA9IChpc05hTihmaXJzdERheSkgPyAwIDogZmlyc3REYXkpOwoKCQlzaG93V2VlayA9IHRoaXMuX2dldChpbnN0LCAic2hvd1dlZWsiKTsKCQlkYXlOYW1lcyA9IHRoaXMuX2dldChpbnN0LCAiZGF5TmFtZXMiKTsKCQlkYXlOYW1lc01pbiA9IHRoaXMuX2dldChpbnN0LCAiZGF5TmFtZXNNaW4iKTsKCQltb250aE5hbWVzID0gdGhpcy5fZ2V0KGluc3QsICJtb250aE5hbWVzIik7CgkJbW9udGhOYW1lc1Nob3J0ID0gdGhpcy5fZ2V0KGluc3QsICJtb250aE5hbWVzU2hvcnQiKTsKCQliZWZvcmVTaG93RGF5ID0gdGhpcy5fZ2V0KGluc3QsICJiZWZvcmVTaG93RGF5Iik7CgkJc2hvd090aGVyTW9udGhzID0gdGhpcy5fZ2V0KGluc3QsICJzaG93T3RoZXJNb250aHMiKTsKCQlzZWxlY3RPdGhlck1vbnRocyA9IHRoaXMuX2dldChpbnN0LCAic2VsZWN0T3RoZXJNb250aHMiKTsKCQlkZWZhdWx0RGF0ZSA9IHRoaXMuX2dldERlZmF1bHREYXRlKGluc3QpOwoJCWh0bWwgPSAiIjsKCQlkb3c7CgkJZm9yIChyb3cgPSAwOyByb3cgPCBudW1Nb250aHNbMF07IHJvdysrKSB7CgkJCWdyb3VwID0gIiI7CgkJCXRoaXMubWF4Um93cyA9IDQ7CgkJCWZvciAoY29sID0gMDsgY29sIDwgbnVtTW9udGhzWzFdOyBjb2wrKykgewoJCQkJc2VsZWN0ZWREYXRlID0gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoZHJhd1llYXIsIGRyYXdNb250aCwgaW5zdC5zZWxlY3RlZERheSkpOwoJCQkJY29ybmVyQ2xhc3MgPSAiIHVpLWNvcm5lci1hbGwiOwoJCQkJY2FsZW5kZXIgPSAiIjsKCQkJCWlmIChpc011bHRpTW9udGgpIHsKCQkJCQljYWxlbmRlciArPSAiPGRpdiBjbGFzcz0ndWktZGF0ZXBpY2tlci1ncm91cCI7CgkJCQkJaWYgKG51bU1vbnRoc1sxXSA+IDEpIHsKCQkJCQkJc3dpdGNoIChjb2wpIHsKCQkJCQkJCWNhc2UgMDogY2FsZW5kZXIgKz0gIiB1aS1kYXRlcGlja2VyLWdyb3VwLWZpcnN0IjsKCQkJCQkJCQljb3JuZXJDbGFzcyA9ICIgdWktY29ybmVyLSIgKyAoaXNSVEwgPyAicmlnaHQiIDogImxlZnQiKTsgYnJlYWs7CgkJCQkJCQljYXNlIG51bU1vbnRoc1sxXS0xOiBjYWxlbmRlciArPSAiIHVpLWRhdGVwaWNrZXItZ3JvdXAtbGFzdCI7CgkJCQkJCQkJY29ybmVyQ2xhc3MgPSAiIHVpLWNvcm5lci0iICsgKGlzUlRMID8gImxlZnQiIDogInJpZ2h0Iik7IGJyZWFrOwoJCQkJCQkJZGVmYXVsdDogY2FsZW5kZXIgKz0gIiB1aS1kYXRlcGlja2VyLWdyb3VwLW1pZGRsZSI7IGNvcm5lckNsYXNzID0gIiI7IGJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWNhbGVuZGVyICs9ICInPiI7CgkJCQl9CgkJCQljYWxlbmRlciArPSAiPGRpdiBjbGFzcz0ndWktZGF0ZXBpY2tlci1oZWFkZXIgdWktd2lkZ2V0LWhlYWRlciB1aS1oZWxwZXItY2xlYXJmaXgiICsgY29ybmVyQ2xhc3MgKyAiJz4iICsKCQkJCQkoL2FsbHxsZWZ0Ly50ZXN0KGNvcm5lckNsYXNzKSAmJiByb3cgPT09IDAgPyAoaXNSVEwgPyBuZXh0IDogcHJldikgOiAiIikgKwoJCQkJCSgvYWxsfHJpZ2h0Ly50ZXN0KGNvcm5lckNsYXNzKSAmJiByb3cgPT09IDAgPyAoaXNSVEwgPyBwcmV2IDogbmV4dCkgOiAiIikgKwoJCQkJCXRoaXMuX2dlbmVyYXRlTW9udGhZZWFySGVhZGVyKGluc3QsIGRyYXdNb250aCwgZHJhd1llYXIsIG1pbkRhdGUsIG1heERhdGUsCgkJCQkJcm93ID4gMCB8fCBjb2wgPiAwLCBtb250aE5hbWVzLCBtb250aE5hbWVzU2hvcnQpICsgLy8gZHJhdyBtb250aCBoZWFkZXJzCgkJCQkJIjwvZGl2Pjx0YWJsZSBjbGFzcz0ndWktZGF0ZXBpY2tlci1jYWxlbmRhcic+PHRoZWFkPiIgKwoJCQkJCSI8dHI+IjsKCQkJCXRoZWFkID0gKHNob3dXZWVrID8gIjx0aCBjbGFzcz0ndWktZGF0ZXBpY2tlci13ZWVrLWNvbCc+IiArIHRoaXMuX2dldChpbnN0LCAid2Vla0hlYWRlciIpICsgIjwvdGg+IiA6ICIiKTsKCQkJCWZvciAoZG93ID0gMDsgZG93IDwgNzsgZG93KyspIHsgLy8gZGF5cyBvZiB0aGUgd2VlawoJCQkJCWRheSA9IChkb3cgKyBmaXJzdERheSkgJSA3OwoJCQkJCXRoZWFkICs9ICI8dGggc2NvcGU9J2NvbCciICsgKChkb3cgKyBmaXJzdERheSArIDYpICUgNyA+PSA1ID8gIiBjbGFzcz0ndWktZGF0ZXBpY2tlci13ZWVrLWVuZCciIDogIiIpICsgIj4iICsKCQkJCQkJIjxzcGFuIHRpdGxlPSciICsgZGF5TmFtZXNbZGF5XSArICInPiIgKyBkYXlOYW1lc01pbltkYXldICsgIjwvc3Bhbj48L3RoPiI7CgkJCQl9CgkJCQljYWxlbmRlciArPSB0aGVhZCArICI8L3RyPjwvdGhlYWQ+PHRib2R5PiI7CgkJCQlkYXlzSW5Nb250aCA9IHRoaXMuX2dldERheXNJbk1vbnRoKGRyYXdZZWFyLCBkcmF3TW9udGgpOwoJCQkJaWYgKGRyYXdZZWFyID09PSBpbnN0LnNlbGVjdGVkWWVhciAmJiBkcmF3TW9udGggPT09IGluc3Quc2VsZWN0ZWRNb250aCkgewoJCQkJCWluc3Quc2VsZWN0ZWREYXkgPSBNYXRoLm1pbihpbnN0LnNlbGVjdGVkRGF5LCBkYXlzSW5Nb250aCk7CgkJCQl9CgkJCQlsZWFkRGF5cyA9ICh0aGlzLl9nZXRGaXJzdERheU9mTW9udGgoZHJhd1llYXIsIGRyYXdNb250aCkgLSBmaXJzdERheSArIDcpICUgNzsKCQkJCWN1clJvd3MgPSBNYXRoLmNlaWwoKGxlYWREYXlzICsgZGF5c0luTW9udGgpIC8gNyk7IC8vIGNhbGN1bGF0ZSB0aGUgbnVtYmVyIG9mIHJvd3MgdG8gZ2VuZXJhdGUKCQkJCW51bVJvd3MgPSAoaXNNdWx0aU1vbnRoID8gdGhpcy5tYXhSb3dzID4gY3VyUm93cyA/IHRoaXMubWF4Um93cyA6IGN1clJvd3MgOiBjdXJSb3dzKTsgLy9JZiBtdWx0aXBsZSBtb250aHMsIHVzZSB0aGUgaGlnaGVyIG51bWJlciBvZiByb3dzIChzZWUgIzcwNDMpCgkJCQl0aGlzLm1heFJvd3MgPSBudW1Sb3dzOwoJCQkJcHJpbnREYXRlID0gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoZHJhd1llYXIsIGRyYXdNb250aCwgMSAtIGxlYWREYXlzKSk7CgkJCQlmb3IgKGRSb3cgPSAwOyBkUm93IDwgbnVtUm93czsgZFJvdysrKSB7IC8vIGNyZWF0ZSBkYXRlIHBpY2tlciByb3dzCgkJCQkJY2FsZW5kZXIgKz0gIjx0cj4iOwoJCQkJCXRib2R5ID0gKCFzaG93V2VlayA/ICIiIDogIjx0ZCBjbGFzcz0ndWktZGF0ZXBpY2tlci13ZWVrLWNvbCc+IiArCgkJCQkJCXRoaXMuX2dldChpbnN0LCAiY2FsY3VsYXRlV2VlayIpKHByaW50RGF0ZSkgKyAiPC90ZD4iKTsKCQkJCQlmb3IgKGRvdyA9IDA7IGRvdyA8IDc7IGRvdysrKSB7IC8vIGNyZWF0ZSBkYXRlIHBpY2tlciBkYXlzCgkJCQkJCWRheVNldHRpbmdzID0gKGJlZm9yZVNob3dEYXkgPwoJCQkJCQkJYmVmb3JlU2hvd0RheS5hcHBseSgoaW5zdC5pbnB1dCA/IGluc3QuaW5wdXRbMF0gOiBudWxsKSwgW3ByaW50RGF0ZV0pIDogW3RydWUsICIiXSk7CgkJCQkJCW90aGVyTW9udGggPSAocHJpbnREYXRlLmdldE1vbnRoKCkgIT09IGRyYXdNb250aCk7CgkJCQkJCXVuc2VsZWN0YWJsZSA9IChvdGhlck1vbnRoICYmICFzZWxlY3RPdGhlck1vbnRocykgfHwgIWRheVNldHRpbmdzWzBdIHx8CgkJCQkJCQkobWluRGF0ZSAmJiBwcmludERhdGUgPCBtaW5EYXRlKSB8fCAobWF4RGF0ZSAmJiBwcmludERhdGUgPiBtYXhEYXRlKTsKCQkJCQkJdGJvZHkgKz0gIjx0ZCBjbGFzcz0nIiArCgkJCQkJCQkoKGRvdyArIGZpcnN0RGF5ICsgNikgJSA3ID49IDUgPyAiIHVpLWRhdGVwaWNrZXItd2Vlay1lbmQiIDogIiIpICsgLy8gaGlnaGxpZ2h0IHdlZWtlbmRzCgkJCQkJCQkob3RoZXJNb250aCA/ICIgdWktZGF0ZXBpY2tlci1vdGhlci1tb250aCIgOiAiIikgKyAvLyBoaWdobGlnaHQgZGF5cyBmcm9tIG90aGVyIG1vbnRocwoJCQkJCQkJKChwcmludERhdGUuZ2V0VGltZSgpID09PSBzZWxlY3RlZERhdGUuZ2V0VGltZSgpICYmIGRyYXdNb250aCA9PT0gaW5zdC5zZWxlY3RlZE1vbnRoICYmIGluc3QuX2tleUV2ZW50KSB8fCAvLyB1c2VyIHByZXNzZWQga2V5CgkJCQkJCQkoZGVmYXVsdERhdGUuZ2V0VGltZSgpID09PSBwcmludERhdGUuZ2V0VGltZSgpICYmIGRlZmF1bHREYXRlLmdldFRpbWUoKSA9PT0gc2VsZWN0ZWREYXRlLmdldFRpbWUoKSkgPwoJCQkJCQkJLy8gb3IgZGVmYXVsdERhdGUgaXMgY3VycmVudCBwcmludGVkRGF0ZSBhbmQgZGVmYXVsdERhdGUgaXMgc2VsZWN0ZWREYXRlCgkJCQkJCQkiICIgKyB0aGlzLl9kYXlPdmVyQ2xhc3MgOiAiIikgKyAvLyBoaWdobGlnaHQgc2VsZWN0ZWQgZGF5CgkJCQkJCQkodW5zZWxlY3RhYmxlID8gIiAiICsgdGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3MgKyAiIHVpLXN0YXRlLWRpc2FibGVkIjogIiIpICsgIC8vIGhpZ2hsaWdodCB1bnNlbGVjdGFibGUgZGF5cwoJCQkJCQkJKG90aGVyTW9udGggJiYgIXNob3dPdGhlck1vbnRocyA/ICIiIDogIiAiICsgZGF5U2V0dGluZ3NbMV0gKyAvLyBoaWdobGlnaHQgY3VzdG9tIGRhdGVzCgkJCQkJCQkocHJpbnREYXRlLmdldFRpbWUoKSA9PT0gY3VycmVudERhdGUuZ2V0VGltZSgpID8gIiAiICsgdGhpcy5fY3VycmVudENsYXNzIDogIiIpICsgLy8gaGlnaGxpZ2h0IHNlbGVjdGVkIGRheQoJCQkJCQkJKHByaW50RGF0ZS5nZXRUaW1lKCkgPT09IHRvZGF5LmdldFRpbWUoKSA/ICIgdWktZGF0ZXBpY2tlci10b2RheSIgOiAiIikpICsgIiciICsgLy8gaGlnaGxpZ2h0IHRvZGF5IChpZiBkaWZmZXJlbnQpCgkJCQkJCQkoKCFvdGhlck1vbnRoIHx8IHNob3dPdGhlck1vbnRocykgJiYgZGF5U2V0dGluZ3NbMl0gPyAiIHRpdGxlPSciICsgZGF5U2V0dGluZ3NbMl0ucmVwbGFjZSgvJy9nLCAiJiMzOTsiKSArICInIiA6ICIiKSArIC8vIGNlbGwgdGl0bGUKCQkJCQkJCSh1bnNlbGVjdGFibGUgPyAiIiA6ICIgZGF0YS1oYW5kbGVyPSdzZWxlY3REYXknIGRhdGEtZXZlbnQ9J2NsaWNrJyBkYXRhLW1vbnRoPSciICsgcHJpbnREYXRlLmdldE1vbnRoKCkgKyAiJyBkYXRhLXllYXI9JyIgKyBwcmludERhdGUuZ2V0RnVsbFllYXIoKSArICInIikgKyAiPiIgKyAvLyBhY3Rpb25zCgkJCQkJCQkob3RoZXJNb250aCAmJiAhc2hvd090aGVyTW9udGhzID8gIiYjeGEwOyIgOiAvLyBkaXNwbGF5IGZvciBvdGhlciBtb250aHMKCQkJCQkJCSh1bnNlbGVjdGFibGUgPyAiPHNwYW4gY2xhc3M9J3VpLXN0YXRlLWRlZmF1bHQnPiIgKyBwcmludERhdGUuZ2V0RGF0ZSgpICsgIjwvc3Bhbj4iIDogIjxhIGNsYXNzPSd1aS1zdGF0ZS1kZWZhdWx0IiArCgkJCQkJCQkocHJpbnREYXRlLmdldFRpbWUoKSA9PT0gdG9kYXkuZ2V0VGltZSgpID8gIiB1aS1zdGF0ZS1oaWdobGlnaHQiIDogIiIpICsKCQkJCQkJCShwcmludERhdGUuZ2V0VGltZSgpID09PSBjdXJyZW50RGF0ZS5nZXRUaW1lKCkgPyAiIHVpLXN0YXRlLWFjdGl2ZSIgOiAiIikgKyAvLyBoaWdobGlnaHQgc2VsZWN0ZWQgZGF5CgkJCQkJCQkob3RoZXJNb250aCA/ICIgdWktcHJpb3JpdHktc2Vjb25kYXJ5IiA6ICIiKSArIC8vIGRpc3Rpbmd1aXNoIGRhdGVzIGZyb20gb3RoZXIgbW9udGhzCgkJCQkJCQkiJyBocmVmPScjJz4iICsgcHJpbnREYXRlLmdldERhdGUoKSArICI8L2E+IikpICsgIjwvdGQ+IjsgLy8gZGlzcGxheSBzZWxlY3RhYmxlIGRhdGUKCQkJCQkJcHJpbnREYXRlLnNldERhdGUocHJpbnREYXRlLmdldERhdGUoKSArIDEpOwoJCQkJCQlwcmludERhdGUgPSB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChwcmludERhdGUpOwoJCQkJCX0KCQkJCQljYWxlbmRlciArPSB0Ym9keSArICI8L3RyPiI7CgkJCQl9CgkJCQlkcmF3TW9udGgrKzsKCQkJCWlmIChkcmF3TW9udGggPiAxMSkgewoJCQkJCWRyYXdNb250aCA9IDA7CgkJCQkJZHJhd1llYXIrKzsKCQkJCX0KCQkJCWNhbGVuZGVyICs9ICI8L3Rib2R5PjwvdGFibGU+IiArIChpc011bHRpTW9udGggPyAiPC9kaXY+IiArCgkJCQkJCQkoKG51bU1vbnRoc1swXSA+IDAgJiYgY29sID09PSBudW1Nb250aHNbMV0tMSkgPyAiPGRpdiBjbGFzcz0ndWktZGF0ZXBpY2tlci1yb3ctYnJlYWsnPjwvZGl2PiIgOiAiIikgOiAiIik7CgkJCQlncm91cCArPSBjYWxlbmRlcjsKCQkJfQoJCQlodG1sICs9IGdyb3VwOwoJCX0KCQlodG1sICs9IGJ1dHRvblBhbmVsOwoJCWluc3QuX2tleUV2ZW50ID0gZmFsc2U7CgkJcmV0dXJuIGh0bWw7Cgl9LAoKCS8qIEdlbmVyYXRlIHRoZSBtb250aCBhbmQgeWVhciBoZWFkZXIuICovCglfZ2VuZXJhdGVNb250aFllYXJIZWFkZXI6IGZ1bmN0aW9uKGluc3QsIGRyYXdNb250aCwgZHJhd1llYXIsIG1pbkRhdGUsIG1heERhdGUsCgkJCXNlY29uZGFyeSwgbW9udGhOYW1lcywgbW9udGhOYW1lc1Nob3J0KSB7CgoJCXZhciBpbk1pblllYXIsIGluTWF4WWVhciwgbW9udGgsIHllYXJzLCB0aGlzWWVhciwgZGV0ZXJtaW5lWWVhciwgeWVhciwgZW5kWWVhciwKCQkJY2hhbmdlTW9udGggPSB0aGlzLl9nZXQoaW5zdCwgImNoYW5nZU1vbnRoIiksCgkJCWNoYW5nZVllYXIgPSB0aGlzLl9nZXQoaW5zdCwgImNoYW5nZVllYXIiKSwKCQkJc2hvd01vbnRoQWZ0ZXJZZWFyID0gdGhpcy5fZ2V0KGluc3QsICJzaG93TW9udGhBZnRlclllYXIiKSwKCQkJaHRtbCA9ICI8ZGl2IGNsYXNzPSd1aS1kYXRlcGlja2VyLXRpdGxlJz4iLAoJCQltb250aEh0bWwgPSAiIjsKCgkJLy8gbW9udGggc2VsZWN0aW9uCgkJaWYgKHNlY29uZGFyeSB8fCAhY2hhbmdlTW9udGgpIHsKCQkJbW9udGhIdG1sICs9ICI8c3BhbiBjbGFzcz0ndWktZGF0ZXBpY2tlci1tb250aCc+IiArIG1vbnRoTmFtZXNbZHJhd01vbnRoXSArICI8L3NwYW4+IjsKCQl9IGVsc2UgewoJCQlpbk1pblllYXIgPSAobWluRGF0ZSAmJiBtaW5EYXRlLmdldEZ1bGxZZWFyKCkgPT09IGRyYXdZZWFyKTsKCQkJaW5NYXhZZWFyID0gKG1heERhdGUgJiYgbWF4RGF0ZS5nZXRGdWxsWWVhcigpID09PSBkcmF3WWVhcik7CgkJCW1vbnRoSHRtbCArPSAiPHNlbGVjdCBjbGFzcz0ndWktZGF0ZXBpY2tlci1tb250aCcgZGF0YS1oYW5kbGVyPSdzZWxlY3RNb250aCcgZGF0YS1ldmVudD0nY2hhbmdlJz4iOwoJCQlmb3IgKCBtb250aCA9IDA7IG1vbnRoIDwgMTI7IG1vbnRoKyspIHsKCQkJCWlmICgoIWluTWluWWVhciB8fCBtb250aCA+PSBtaW5EYXRlLmdldE1vbnRoKCkpICYmICghaW5NYXhZZWFyIHx8IG1vbnRoIDw9IG1heERhdGUuZ2V0TW9udGgoKSkpIHsKCQkJCQltb250aEh0bWwgKz0gIjxvcHRpb24gdmFsdWU9JyIgKyBtb250aCArICInIiArCgkJCQkJCShtb250aCA9PT0gZHJhd01vbnRoID8gIiBzZWxlY3RlZD0nc2VsZWN0ZWQnIiA6ICIiKSArCgkJCQkJCSI+IiArIG1vbnRoTmFtZXNTaG9ydFttb250aF0gKyAiPC9vcHRpb24+IjsKCQkJCX0KCQkJfQoJCQltb250aEh0bWwgKz0gIjwvc2VsZWN0PiI7CgkJfQoKCQlpZiAoIXNob3dNb250aEFmdGVyWWVhcikgewoJCQlodG1sICs9IG1vbnRoSHRtbCArIChzZWNvbmRhcnkgfHwgIShjaGFuZ2VNb250aCAmJiBjaGFuZ2VZZWFyKSA/ICImI3hhMDsiIDogIiIpOwoJCX0KCgkJLy8geWVhciBzZWxlY3Rpb24KCQlpZiAoICFpbnN0LnllYXJzaHRtbCApIHsKCQkJaW5zdC55ZWFyc2h0bWwgPSAiIjsKCQkJaWYgKHNlY29uZGFyeSB8fCAhY2hhbmdlWWVhcikgewoJCQkJaHRtbCArPSAiPHNwYW4gY2xhc3M9J3VpLWRhdGVwaWNrZXIteWVhcic+IiArIGRyYXdZZWFyICsgIjwvc3Bhbj4iOwoJCQl9IGVsc2UgewoJCQkJLy8gZGV0ZXJtaW5lIHJhbmdlIG9mIHllYXJzIHRvIGRpc3BsYXkKCQkJCXllYXJzID0gdGhpcy5fZ2V0KGluc3QsICJ5ZWFyUmFuZ2UiKS5zcGxpdCgiOiIpOwoJCQkJdGhpc1llYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7CgkJCQlkZXRlcm1pbmVZZWFyID0gZnVuY3Rpb24odmFsdWUpIHsKCQkJCQl2YXIgeWVhciA9ICh2YWx1ZS5tYXRjaCgvY1srXC1dLiovKSA/IGRyYXdZZWFyICsgcGFyc2VJbnQodmFsdWUuc3Vic3RyaW5nKDEpLCAxMCkgOgoJCQkJCQkodmFsdWUubWF0Y2goL1srXC1dLiovKSA/IHRoaXNZZWFyICsgcGFyc2VJbnQodmFsdWUsIDEwKSA6CgkJCQkJCXBhcnNlSW50KHZhbHVlLCAxMCkpKTsKCQkJCQlyZXR1cm4gKGlzTmFOKHllYXIpID8gdGhpc1llYXIgOiB5ZWFyKTsKCQkJCX07CgkJCQl5ZWFyID0gZGV0ZXJtaW5lWWVhcih5ZWFyc1swXSk7CgkJCQllbmRZZWFyID0gTWF0aC5tYXgoeWVhciwgZGV0ZXJtaW5lWWVhcih5ZWFyc1sxXSB8fCAiIikpOwoJCQkJeWVhciA9IChtaW5EYXRlID8gTWF0aC5tYXgoeWVhciwgbWluRGF0ZS5nZXRGdWxsWWVhcigpKSA6IHllYXIpOwoJCQkJZW5kWWVhciA9IChtYXhEYXRlID8gTWF0aC5taW4oZW5kWWVhciwgbWF4RGF0ZS5nZXRGdWxsWWVhcigpKSA6IGVuZFllYXIpOwoJCQkJaW5zdC55ZWFyc2h0bWwgKz0gIjxzZWxlY3QgY2xhc3M9J3VpLWRhdGVwaWNrZXIteWVhcicgZGF0YS1oYW5kbGVyPSdzZWxlY3RZZWFyJyBkYXRhLWV2ZW50PSdjaGFuZ2UnPiI7CgkJCQlmb3IgKDsgeWVhciA8PSBlbmRZZWFyOyB5ZWFyKyspIHsKCQkJCQlpbnN0LnllYXJzaHRtbCArPSAiPG9wdGlvbiB2YWx1ZT0nIiArIHllYXIgKyAiJyIgKwoJCQkJCQkoeWVhciA9PT0gZHJhd1llYXIgPyAiIHNlbGVjdGVkPSdzZWxlY3RlZCciIDogIiIpICsKCQkJCQkJIj4iICsgeWVhciArICI8L29wdGlvbj4iOwoJCQkJfQoJCQkJaW5zdC55ZWFyc2h0bWwgKz0gIjwvc2VsZWN0PiI7CgoJCQkJaHRtbCArPSBpbnN0LnllYXJzaHRtbDsKCQkJCWluc3QueWVhcnNodG1sID0gbnVsbDsKCQkJfQoJCX0KCgkJaHRtbCArPSB0aGlzLl9nZXQoaW5zdCwgInllYXJTdWZmaXgiKTsKCQlpZiAoc2hvd01vbnRoQWZ0ZXJZZWFyKSB7CgkJCWh0bWwgKz0gKHNlY29uZGFyeSB8fCAhKGNoYW5nZU1vbnRoICYmIGNoYW5nZVllYXIpID8gIiYjeGEwOyIgOiAiIikgKyBtb250aEh0bWw7CgkJfQoJCWh0bWwgKz0gIjwvZGl2PiI7IC8vIENsb3NlIGRhdGVwaWNrZXJfaGVhZGVyCgkJcmV0dXJuIGh0bWw7Cgl9LAoKCS8qIEFkanVzdCBvbmUgb2YgdGhlIGRhdGUgc3ViLWZpZWxkcy4gKi8KCV9hZGp1c3RJbnN0RGF0ZTogZnVuY3Rpb24oaW5zdCwgb2Zmc2V0LCBwZXJpb2QpIHsKCQl2YXIgeWVhciA9IGluc3QuZHJhd1llYXIgKyAocGVyaW9kID09PSAiWSIgPyBvZmZzZXQgOiAwKSwKCQkJbW9udGggPSBpbnN0LmRyYXdNb250aCArIChwZXJpb2QgPT09ICJNIiA/IG9mZnNldCA6IDApLAoJCQlkYXkgPSBNYXRoLm1pbihpbnN0LnNlbGVjdGVkRGF5LCB0aGlzLl9nZXREYXlzSW5Nb250aCh5ZWFyLCBtb250aCkpICsgKHBlcmlvZCA9PT0gIkQiID8gb2Zmc2V0IDogMCksCgkJCWRhdGUgPSB0aGlzLl9yZXN0cmljdE1pbk1heChpbnN0LCB0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF5KSkpOwoKCQlpbnN0LnNlbGVjdGVkRGF5ID0gZGF0ZS5nZXREYXRlKCk7CgkJaW5zdC5kcmF3TW9udGggPSBpbnN0LnNlbGVjdGVkTW9udGggPSBkYXRlLmdldE1vbnRoKCk7CgkJaW5zdC5kcmF3WWVhciA9IGluc3Quc2VsZWN0ZWRZZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpOwoJCWlmIChwZXJpb2QgPT09ICJNIiB8fCBwZXJpb2QgPT09ICJZIikgewoJCQl0aGlzLl9ub3RpZnlDaGFuZ2UoaW5zdCk7CgkJfQoJfSwKCgkvKiBFbnN1cmUgYSBkYXRlIGlzIHdpdGhpbiBhbnkgbWluL21heCBib3VuZHMuICovCglfcmVzdHJpY3RNaW5NYXg6IGZ1bmN0aW9uKGluc3QsIGRhdGUpIHsKCQl2YXIgbWluRGF0ZSA9IHRoaXMuX2dldE1pbk1heERhdGUoaW5zdCwgIm1pbiIpLAoJCQltYXhEYXRlID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShpbnN0LCAibWF4IiksCgkJCW5ld0RhdGUgPSAobWluRGF0ZSAmJiBkYXRlIDwgbWluRGF0ZSA/IG1pbkRhdGUgOiBkYXRlKTsKCQlyZXR1cm4gKG1heERhdGUgJiYgbmV3RGF0ZSA+IG1heERhdGUgPyBtYXhEYXRlIDogbmV3RGF0ZSk7Cgl9LAoKCS8qIE5vdGlmeSBjaGFuZ2Ugb2YgbW9udGgveWVhci4gKi8KCV9ub3RpZnlDaGFuZ2U6IGZ1bmN0aW9uKGluc3QpIHsKCQl2YXIgb25DaGFuZ2UgPSB0aGlzLl9nZXQoaW5zdCwgIm9uQ2hhbmdlTW9udGhZZWFyIik7CgkJaWYgKG9uQ2hhbmdlKSB7CgkJCW9uQ2hhbmdlLmFwcGx5KChpbnN0LmlucHV0ID8gaW5zdC5pbnB1dFswXSA6IG51bGwpLAoJCQkJW2luc3Quc2VsZWN0ZWRZZWFyLCBpbnN0LnNlbGVjdGVkTW9udGggKyAxLCBpbnN0XSk7CgkJfQoJfSwKCgkvKiBEZXRlcm1pbmUgdGhlIG51bWJlciBvZiBtb250aHMgdG8gc2hvdy4gKi8KCV9nZXROdW1iZXJPZk1vbnRoczogZnVuY3Rpb24oaW5zdCkgewoJCXZhciBudW1Nb250aHMgPSB0aGlzLl9nZXQoaW5zdCwgIm51bWJlck9mTW9udGhzIik7CgkJcmV0dXJuIChudW1Nb250aHMgPT0gbnVsbCA/IFsxLCAxXSA6ICh0eXBlb2YgbnVtTW9udGhzID09PSAibnVtYmVyIiA/IFsxLCBudW1Nb250aHNdIDogbnVtTW9udGhzKSk7Cgl9LAoKCS8qIERldGVybWluZSB0aGUgY3VycmVudCBtYXhpbXVtIGRhdGUgLSBlbnN1cmUgbm8gdGltZSBjb21wb25lbnRzIGFyZSBzZXQuICovCglfZ2V0TWluTWF4RGF0ZTogZnVuY3Rpb24oaW5zdCwgbWluTWF4KSB7CgkJcmV0dXJuIHRoaXMuX2RldGVybWluZURhdGUoaW5zdCwgdGhpcy5fZ2V0KGluc3QsIG1pbk1heCArICJEYXRlIiksIG51bGwpOwoJfSwKCgkvKiBGaW5kIHRoZSBudW1iZXIgb2YgZGF5cyBpbiBhIGdpdmVuIG1vbnRoLiAqLwoJX2dldERheXNJbk1vbnRoOiBmdW5jdGlvbih5ZWFyLCBtb250aCkgewoJCXJldHVybiAzMiAtIHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKHllYXIsIG1vbnRoLCAzMikpLmdldERhdGUoKTsKCX0sCgoJLyogRmluZCB0aGUgZGF5IG9mIHRoZSB3ZWVrIG9mIHRoZSBmaXJzdCBvZiBhIG1vbnRoLiAqLwoJX2dldEZpcnN0RGF5T2ZNb250aDogZnVuY3Rpb24oeWVhciwgbW9udGgpIHsKCQlyZXR1cm4gbmV3IERhdGUoeWVhciwgbW9udGgsIDEpLmdldERheSgpOwoJfSwKCgkvKiBEZXRlcm1pbmVzIGlmIHdlIHNob3VsZCBhbGxvdyBhICJuZXh0L3ByZXYiIG1vbnRoIGRpc3BsYXkgY2hhbmdlLiAqLwoJX2NhbkFkanVzdE1vbnRoOiBmdW5jdGlvbihpbnN0LCBvZmZzZXQsIGN1clllYXIsIGN1ck1vbnRoKSB7CgkJdmFyIG51bU1vbnRocyA9IHRoaXMuX2dldE51bWJlck9mTW9udGhzKGluc3QpLAoJCQlkYXRlID0gdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoY3VyWWVhciwKCQkJY3VyTW9udGggKyAob2Zmc2V0IDwgMCA/IG9mZnNldCA6IG51bU1vbnRoc1swXSAqIG51bU1vbnRoc1sxXSksIDEpKTsKCgkJaWYgKG9mZnNldCA8IDApIHsKCQkJZGF0ZS5zZXREYXRlKHRoaXMuX2dldERheXNJbk1vbnRoKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpKSk7CgkJfQoJCXJldHVybiB0aGlzLl9pc0luUmFuZ2UoaW5zdCwgZGF0ZSk7Cgl9LAoKCS8qIElzIHRoZSBnaXZlbiBkYXRlIGluIHRoZSBhY2NlcHRlZCByYW5nZT8gKi8KCV9pc0luUmFuZ2U6IGZ1bmN0aW9uKGluc3QsIGRhdGUpIHsKCQl2YXIgeWVhclNwbGl0LCBjdXJyZW50WWVhciwKCQkJbWluRGF0ZSA9IHRoaXMuX2dldE1pbk1heERhdGUoaW5zdCwgIm1pbiIpLAoJCQltYXhEYXRlID0gdGhpcy5fZ2V0TWluTWF4RGF0ZShpbnN0LCAibWF4IiksCgkJCW1pblllYXIgPSBudWxsLAoJCQltYXhZZWFyID0gbnVsbCwKCQkJeWVhcnMgPSB0aGlzLl9nZXQoaW5zdCwgInllYXJSYW5nZSIpOwoJCQlpZiAoeWVhcnMpewoJCQkJeWVhclNwbGl0ID0geWVhcnMuc3BsaXQoIjoiKTsKCQkJCWN1cnJlbnRZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpOwoJCQkJbWluWWVhciA9IHBhcnNlSW50KHllYXJTcGxpdFswXSwgMTApOwoJCQkJbWF4WWVhciA9IHBhcnNlSW50KHllYXJTcGxpdFsxXSwgMTApOwoJCQkJaWYgKCB5ZWFyU3BsaXRbMF0ubWF0Y2goL1srXC1dLiovKSApIHsKCQkJCQltaW5ZZWFyICs9IGN1cnJlbnRZZWFyOwoJCQkJfQoJCQkJaWYgKCB5ZWFyU3BsaXRbMV0ubWF0Y2goL1srXC1dLiovKSApIHsKCQkJCQltYXhZZWFyICs9IGN1cnJlbnRZZWFyOwoJCQkJfQoJCQl9CgoJCXJldHVybiAoKCFtaW5EYXRlIHx8IGRhdGUuZ2V0VGltZSgpID49IG1pbkRhdGUuZ2V0VGltZSgpKSAmJgoJCQkoIW1heERhdGUgfHwgZGF0ZS5nZXRUaW1lKCkgPD0gbWF4RGF0ZS5nZXRUaW1lKCkpICYmCgkJCSghbWluWWVhciB8fCBkYXRlLmdldEZ1bGxZZWFyKCkgPj0gbWluWWVhcikgJiYKCQkJKCFtYXhZZWFyIHx8IGRhdGUuZ2V0RnVsbFllYXIoKSA8PSBtYXhZZWFyKSk7Cgl9LAoKCS8qIFByb3ZpZGUgdGhlIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3MgZm9yIGZvcm1hdHRpbmcvcGFyc2luZy4gKi8KCV9nZXRGb3JtYXRDb25maWc6IGZ1bmN0aW9uKGluc3QpIHsKCQl2YXIgc2hvcnRZZWFyQ3V0b2ZmID0gdGhpcy5fZ2V0KGluc3QsICJzaG9ydFllYXJDdXRvZmYiKTsKCQlzaG9ydFllYXJDdXRvZmYgPSAodHlwZW9mIHNob3J0WWVhckN1dG9mZiAhPT0gInN0cmluZyIgPyBzaG9ydFllYXJDdXRvZmYgOgoJCQluZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCkgJSAxMDAgKyBwYXJzZUludChzaG9ydFllYXJDdXRvZmYsIDEwKSk7CgkJcmV0dXJuIHtzaG9ydFllYXJDdXRvZmY6IHNob3J0WWVhckN1dG9mZiwKCQkJZGF5TmFtZXNTaG9ydDogdGhpcy5fZ2V0KGluc3QsICJkYXlOYW1lc1Nob3J0IiksIGRheU5hbWVzOiB0aGlzLl9nZXQoaW5zdCwgImRheU5hbWVzIiksCgkJCW1vbnRoTmFtZXNTaG9ydDogdGhpcy5fZ2V0KGluc3QsICJtb250aE5hbWVzU2hvcnQiKSwgbW9udGhOYW1lczogdGhpcy5fZ2V0KGluc3QsICJtb250aE5hbWVzIil9OwoJfSwKCgkvKiBGb3JtYXQgdGhlIGdpdmVuIGRhdGUgZm9yIGRpc3BsYXkuICovCglfZm9ybWF0RGF0ZTogZnVuY3Rpb24oaW5zdCwgZGF5LCBtb250aCwgeWVhcikgewoJCWlmICghZGF5KSB7CgkJCWluc3QuY3VycmVudERheSA9IGluc3Quc2VsZWN0ZWREYXk7CgkJCWluc3QuY3VycmVudE1vbnRoID0gaW5zdC5zZWxlY3RlZE1vbnRoOwoJCQlpbnN0LmN1cnJlbnRZZWFyID0gaW5zdC5zZWxlY3RlZFllYXI7CgkJfQoJCXZhciBkYXRlID0gKGRheSA/ICh0eXBlb2YgZGF5ID09PSAib2JqZWN0IiA/IGRheSA6CgkJCXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKHllYXIsIG1vbnRoLCBkYXkpKSkgOgoJCQl0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShpbnN0LmN1cnJlbnRZZWFyLCBpbnN0LmN1cnJlbnRNb250aCwgaW5zdC5jdXJyZW50RGF5KSkpOwoJCXJldHVybiB0aGlzLmZvcm1hdERhdGUodGhpcy5fZ2V0KGluc3QsICJkYXRlRm9ybWF0IiksIGRhdGUsIHRoaXMuX2dldEZvcm1hdENvbmZpZyhpbnN0KSk7Cgl9Cn0pOwoKLyoKICogQmluZCBob3ZlciBldmVudHMgZm9yIGRhdGVwaWNrZXIgZWxlbWVudHMuCiAqIERvbmUgdmlhIGRlbGVnYXRlIHNvIHRoZSBiaW5kaW5nIG9ubHkgb2NjdXJzIG9uY2UgaW4gdGhlIGxpZmV0aW1lIG9mIHRoZSBwYXJlbnQgZGl2LgogKiBHbG9iYWwgZGF0ZXBpY2tlcl9pbnN0QWN0aXZlLCBzZXQgYnkgX3VwZGF0ZURhdGVwaWNrZXIgYWxsb3dzIHRoZSBoYW5kbGVycyB0byBmaW5kIHRoZWlyIHdheSBiYWNrIHRvIHRoZSBhY3RpdmUgcGlja2VyLgogKi8KZnVuY3Rpb24gZGF0ZXBpY2tlcl9iaW5kSG92ZXIoZHBEaXYpIHsKCXZhciBzZWxlY3RvciA9ICJidXR0b24sIC51aS1kYXRlcGlja2VyLXByZXYsIC51aS1kYXRlcGlja2VyLW5leHQsIC51aS1kYXRlcGlja2VyLWNhbGVuZGFyIHRkIGEiOwoJcmV0dXJuIGRwRGl2LmRlbGVnYXRlKHNlbGVjdG9yLCAibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKCQkJJCh0aGlzKS5yZW1vdmVDbGFzcygidWktc3RhdGUtaG92ZXIiKTsKCQkJaWYgKHRoaXMuY2xhc3NOYW1lLmluZGV4T2YoInVpLWRhdGVwaWNrZXItcHJldiIpICE9PSAtMSkgewoJCQkJJCh0aGlzKS5yZW1vdmVDbGFzcygidWktZGF0ZXBpY2tlci1wcmV2LWhvdmVyIik7CgkJCX0KCQkJaWYgKHRoaXMuY2xhc3NOYW1lLmluZGV4T2YoInVpLWRhdGVwaWNrZXItbmV4dCIpICE9PSAtMSkgewoJCQkJJCh0aGlzKS5yZW1vdmVDbGFzcygidWktZGF0ZXBpY2tlci1uZXh0LWhvdmVyIik7CgkJCX0KCQl9KQoJCS5kZWxlZ2F0ZSggc2VsZWN0b3IsICJtb3VzZW92ZXIiLCBkYXRlcGlja2VyX2hhbmRsZU1vdXNlb3ZlciApOwp9CgpmdW5jdGlvbiBkYXRlcGlja2VyX2hhbmRsZU1vdXNlb3ZlcigpIHsKCWlmICghJC5kYXRlcGlja2VyLl9pc0Rpc2FibGVkRGF0ZXBpY2tlciggZGF0ZXBpY2tlcl9pbnN0QWN0aXZlLmlubGluZT8gZGF0ZXBpY2tlcl9pbnN0QWN0aXZlLmRwRGl2LnBhcmVudCgpWzBdIDogZGF0ZXBpY2tlcl9pbnN0QWN0aXZlLmlucHV0WzBdKSkgewoJCSQodGhpcykucGFyZW50cygiLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIiKS5maW5kKCJhIikucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIik7CgkJJCh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtaG92ZXIiKTsKCQlpZiAodGhpcy5jbGFzc05hbWUuaW5kZXhPZigidWktZGF0ZXBpY2tlci1wcmV2IikgIT09IC0xKSB7CgkJCSQodGhpcykuYWRkQ2xhc3MoInVpLWRhdGVwaWNrZXItcHJldi1ob3ZlciIpOwoJCX0KCQlpZiAodGhpcy5jbGFzc05hbWUuaW5kZXhPZigidWktZGF0ZXBpY2tlci1uZXh0IikgIT09IC0xKSB7CgkJCSQodGhpcykuYWRkQ2xhc3MoInVpLWRhdGVwaWNrZXItbmV4dC1ob3ZlciIpOwoJCX0KCX0KfQoKLyogalF1ZXJ5IGV4dGVuZCBub3cgaWdub3JlcyBudWxscyEgKi8KZnVuY3Rpb24gZGF0ZXBpY2tlcl9leHRlbmRSZW1vdmUodGFyZ2V0LCBwcm9wcykgewoJJC5leHRlbmQodGFyZ2V0LCBwcm9wcyk7Cglmb3IgKHZhciBuYW1lIGluIHByb3BzKSB7CgkJaWYgKHByb3BzW25hbWVdID09IG51bGwpIHsKCQkJdGFyZ2V0W25hbWVdID0gcHJvcHNbbmFtZV07CgkJfQoJfQoJcmV0dXJuIHRhcmdldDsKfQoKLyogSW52b2tlIHRoZSBkYXRlcGlja2VyIGZ1bmN0aW9uYWxpdHkuCiAgIEBwYXJhbSAgb3B0aW9ucyAgc3RyaW5nIC0gYSBjb21tYW5kLCBvcHRpb25hbGx5IGZvbGxvd2VkIGJ5IGFkZGl0aW9uYWwgcGFyYW1ldGVycyBvcgoJCQkJCU9iamVjdCAtIHNldHRpbmdzIGZvciBhdHRhY2hpbmcgbmV3IGRhdGVwaWNrZXIgZnVuY3Rpb25hbGl0eQogICBAcmV0dXJuICBqUXVlcnkgb2JqZWN0ICovCiQuZm4uZGF0ZXBpY2tlciA9IGZ1bmN0aW9uKG9wdGlvbnMpewoKCS8qIFZlcmlmeSBhbiBlbXB0eSBjb2xsZWN0aW9uIHdhc24ndCBwYXNzZWQgLSBGaXhlcyAjNjk3NiAqLwoJaWYgKCAhdGhpcy5sZW5ndGggKSB7CgkJcmV0dXJuIHRoaXM7Cgl9CgoJLyogSW5pdGlhbGlzZSB0aGUgZGF0ZSBwaWNrZXIuICovCglpZiAoISQuZGF0ZXBpY2tlci5pbml0aWFsaXplZCkgewoJCSQoZG9jdW1lbnQpLm1vdXNlZG93bigkLmRhdGVwaWNrZXIuX2NoZWNrRXh0ZXJuYWxDbGljayk7CgkJJC5kYXRlcGlja2VyLmluaXRpYWxpemVkID0gdHJ1ZTsKCX0KCgkvKiBBcHBlbmQgZGF0ZXBpY2tlciBtYWluIGNvbnRhaW5lciB0byBib2R5IGlmIG5vdCBleGlzdC4gKi8KCWlmICgkKCIjIiskLmRhdGVwaWNrZXIuX21haW5EaXZJZCkubGVuZ3RoID09PSAwKSB7CgkJJCgiYm9keSIpLmFwcGVuZCgkLmRhdGVwaWNrZXIuZHBEaXYpOwoJfQoKCXZhciBvdGhlckFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoJaWYgKHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiAmJiAob3B0aW9ucyA9PT0gImlzRGlzYWJsZWQiIHx8IG9wdGlvbnMgPT09ICJnZXREYXRlIiB8fCBvcHRpb25zID09PSAid2lkZ2V0IikpIHsKCQlyZXR1cm4gJC5kYXRlcGlja2VyWyJfIiArIG9wdGlvbnMgKyAiRGF0ZXBpY2tlciJdLgoJCQlhcHBseSgkLmRhdGVwaWNrZXIsIFt0aGlzWzBdXS5jb25jYXQob3RoZXJBcmdzKSk7Cgl9CglpZiAob3B0aW9ucyA9PT0gIm9wdGlvbiIgJiYgYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJiB0eXBlb2YgYXJndW1lbnRzWzFdID09PSAic3RyaW5nIikgewoJCXJldHVybiAkLmRhdGVwaWNrZXJbIl8iICsgb3B0aW9ucyArICJEYXRlcGlja2VyIl0uCgkJCWFwcGx5KCQuZGF0ZXBpY2tlciwgW3RoaXNbMF1dLmNvbmNhdChvdGhlckFyZ3MpKTsKCX0KCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJdHlwZW9mIG9wdGlvbnMgPT09ICJzdHJpbmciID8KCQkJJC5kYXRlcGlja2VyWyJfIiArIG9wdGlvbnMgKyAiRGF0ZXBpY2tlciJdLgoJCQkJYXBwbHkoJC5kYXRlcGlja2VyLCBbdGhpc10uY29uY2F0KG90aGVyQXJncykpIDoKCQkJJC5kYXRlcGlja2VyLl9hdHRhY2hEYXRlcGlja2VyKHRoaXMsIG9wdGlvbnMpOwoJfSk7Cn07CgokLmRhdGVwaWNrZXIgPSBuZXcgRGF0ZXBpY2tlcigpOyAvLyBzaW5nbGV0b24gaW5zdGFuY2UKJC5kYXRlcGlja2VyLmluaXRpYWxpemVkID0gZmFsc2U7CiQuZGF0ZXBpY2tlci51dWlkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiQuZGF0ZXBpY2tlci52ZXJzaW9uID0gIjEuMTEuMSI7Cgp2YXIgZGF0ZXBpY2tlciA9ICQuZGF0ZXBpY2tlcjsKCgovKiEKICogalF1ZXJ5IFVJIERyYWdnYWJsZSAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9kcmFnZ2FibGUvCiAqLwoKCiQud2lkZ2V0KCJ1aS5kcmFnZ2FibGUiLCAkLnVpLm1vdXNlLCB7Cgl2ZXJzaW9uOiAiMS4xMS4xIiwKCXdpZGdldEV2ZW50UHJlZml4OiAiZHJhZyIsCglvcHRpb25zOiB7CgkJYWRkQ2xhc3NlczogdHJ1ZSwKCQlhcHBlbmRUbzogInBhcmVudCIsCgkJYXhpczogZmFsc2UsCgkJY29ubmVjdFRvU29ydGFibGU6IGZhbHNlLAoJCWNvbnRhaW5tZW50OiBmYWxzZSwKCQljdXJzb3I6ICJhdXRvIiwKCQljdXJzb3JBdDogZmFsc2UsCgkJZ3JpZDogZmFsc2UsCgkJaGFuZGxlOiBmYWxzZSwKCQloZWxwZXI6ICJvcmlnaW5hbCIsCgkJaWZyYW1lRml4OiBmYWxzZSwKCQlvcGFjaXR5OiBmYWxzZSwKCQlyZWZyZXNoUG9zaXRpb25zOiBmYWxzZSwKCQlyZXZlcnQ6IGZhbHNlLAoJCXJldmVydER1cmF0aW9uOiA1MDAsCgkJc2NvcGU6ICJkZWZhdWx0IiwKCQlzY3JvbGw6IHRydWUsCgkJc2Nyb2xsU2Vuc2l0aXZpdHk6IDIwLAoJCXNjcm9sbFNwZWVkOiAyMCwKCQlzbmFwOiBmYWxzZSwKCQlzbmFwTW9kZTogImJvdGgiLAoJCXNuYXBUb2xlcmFuY2U6IDIwLAoJCXN0YWNrOiBmYWxzZSwKCQl6SW5kZXg6IGZhbHNlLAoKCQkvLyBjYWxsYmFja3MKCQlkcmFnOiBudWxsLAoJCXN0YXJ0OiBudWxsLAoJCXN0b3A6IG51bGwKCX0sCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCgkJaWYgKHRoaXMub3B0aW9ucy5oZWxwZXIgPT09ICJvcmlnaW5hbCIgJiYgISgvXig/OnJ8YXxmKS8pLnRlc3QodGhpcy5lbGVtZW50LmNzcygicG9zaXRpb24iKSkpIHsKCQkJdGhpcy5lbGVtZW50WzBdLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKCQl9CgkJaWYgKHRoaXMub3B0aW9ucy5hZGRDbGFzc2VzKXsKCQkJdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1kcmFnZ2FibGUiKTsKCQl9CgkJaWYgKHRoaXMub3B0aW9ucy5kaXNhYmxlZCl7CgkJCXRoaXMuZWxlbWVudC5hZGRDbGFzcygidWktZHJhZ2dhYmxlLWRpc2FibGVkIik7CgkJfQoJCXRoaXMuX3NldEhhbmRsZUNsYXNzTmFtZSgpOwoKCQl0aGlzLl9tb3VzZUluaXQoKTsKCX0sCgoJX3NldE9wdGlvbjogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCQlpZiAoIGtleSA9PT0gImhhbmRsZSIgKSB7CgkJCXRoaXMuX3JlbW92ZUhhbmRsZUNsYXNzTmFtZSgpOwoJCQl0aGlzLl9zZXRIYW5kbGVDbGFzc05hbWUoKTsKCQl9Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQlpZiAoICggdGhpcy5oZWxwZXIgfHwgdGhpcy5lbGVtZW50ICkuaXMoICIudWktZHJhZ2dhYmxlLWRyYWdnaW5nIiApICkgewoJCQl0aGlzLmRlc3Ryb3lPbkNsZWFyID0gdHJ1ZTsKCQkJcmV0dXJuOwoJCX0KCQl0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoICJ1aS1kcmFnZ2FibGUgdWktZHJhZ2dhYmxlLWRyYWdnaW5nIHVpLWRyYWdnYWJsZS1kaXNhYmxlZCIgKTsKCQl0aGlzLl9yZW1vdmVIYW5kbGVDbGFzc05hbWUoKTsKCQl0aGlzLl9tb3VzZURlc3Ryb3koKTsKCX0sCgoJX21vdXNlQ2FwdHVyZTogZnVuY3Rpb24oZXZlbnQpIHsKCgkJdmFyIGRvY3VtZW50ID0gdGhpcy5kb2N1bWVudFsgMCBdLAoJCQlvID0gdGhpcy5vcHRpb25zOwoKCQkvLyBzdXBwb3J0OiBJRTkKCQkvLyBJRTkgdGhyb3dzIGFuICJVbnNwZWNpZmllZCBlcnJvciIgYWNjZXNzaW5nIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgZnJvbSBhbiA8aWZyYW1lPgoJCXRyeSB7CgkJCS8vIFN1cHBvcnQ6IElFOSsKCQkJLy8gSWYgdGhlIDxib2R5PiBpcyBibHVycmVkLCBJRSB3aWxsIHN3aXRjaCB3aW5kb3dzLCBzZWUgIzk1MjAKCQkJaWYgKCBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPT0gImJvZHkiICkgewoJCQkJLy8gQmx1ciBhbnkgZWxlbWVudCB0aGF0IGN1cnJlbnRseSBoYXMgZm9jdXMsIHNlZSAjNDI2MQoJCQkJJCggZG9jdW1lbnQuYWN0aXZlRWxlbWVudCApLmJsdXIoKTsKCQkJfQoJCX0gY2F0Y2ggKCBlcnJvciApIHt9CgoJCS8vIGFtb25nIG90aGVycywgcHJldmVudCBhIGRyYWcgb24gYSByZXNpemFibGUtaGFuZGxlCgkJaWYgKHRoaXMuaGVscGVyIHx8IG8uZGlzYWJsZWQgfHwgJChldmVudC50YXJnZXQpLmNsb3Nlc3QoIi51aS1yZXNpemFibGUtaGFuZGxlIikubGVuZ3RoID4gMCkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvL1F1aXQgaWYgd2UncmUgbm90IG9uIGEgdmFsaWQgaGFuZGxlCgkJdGhpcy5oYW5kbGUgPSB0aGlzLl9nZXRIYW5kbGUoZXZlbnQpOwoJCWlmICghdGhpcy5oYW5kbGUpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJJChvLmlmcmFtZUZpeCA9PT0gdHJ1ZSA/ICJpZnJhbWUiIDogby5pZnJhbWVGaXgpLmVhY2goZnVuY3Rpb24oKSB7CgkJCSQoIjxkaXYgY2xhc3M9J3VpLWRyYWdnYWJsZS1pZnJhbWVGaXgnIHN0eWxlPSdiYWNrZ3JvdW5kOiAjZmZmOyc+PC9kaXY+IikKCQkJLmNzcyh7CgkJCQl3aWR0aDogdGhpcy5vZmZzZXRXaWR0aCArICJweCIsIGhlaWdodDogdGhpcy5vZmZzZXRIZWlnaHQgKyAicHgiLAoJCQkJcG9zaXRpb246ICJhYnNvbHV0ZSIsIG9wYWNpdHk6ICIwLjAwMSIsIHpJbmRleDogMTAwMAoJCQl9KQoJCQkuY3NzKCQodGhpcykub2Zmc2V0KCkpCgkJCS5hcHBlbmRUbygiYm9keSIpOwoJCX0pOwoKCQlyZXR1cm4gdHJ1ZTsKCgl9LAoKCV9tb3VzZVN0YXJ0OiBmdW5jdGlvbihldmVudCkgewoKCQl2YXIgbyA9IHRoaXMub3B0aW9uczsKCgkJLy9DcmVhdGUgYW5kIGFwcGVuZCB0aGUgdmlzaWJsZSBoZWxwZXIKCQl0aGlzLmhlbHBlciA9IHRoaXMuX2NyZWF0ZUhlbHBlcihldmVudCk7CgoJCXRoaXMuaGVscGVyLmFkZENsYXNzKCJ1aS1kcmFnZ2FibGUtZHJhZ2dpbmciKTsKCgkJLy9DYWNoZSB0aGUgaGVscGVyIHNpemUKCQl0aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCk7CgoJCS8vSWYgZGRtYW5hZ2VyIGlzIHVzZWQgZm9yIGRyb3BwYWJsZXMsIHNldCB0aGUgZ2xvYmFsIGRyYWdnYWJsZQoJCWlmICgkLnVpLmRkbWFuYWdlcikgewoJCQkkLnVpLmRkbWFuYWdlci5jdXJyZW50ID0gdGhpczsKCQl9CgoJCS8qCgkJICogLSBQb3NpdGlvbiBnZW5lcmF0aW9uIC0KCQkgKiBUaGlzIGJsb2NrIGdlbmVyYXRlcyBldmVyeXRoaW5nIHBvc2l0aW9uIHJlbGF0ZWQgLSBpdCdzIHRoZSBjb3JlIG9mIGRyYWdnYWJsZXMuCgkJICovCgoJCS8vQ2FjaGUgdGhlIG1hcmdpbnMgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnQKCQl0aGlzLl9jYWNoZU1hcmdpbnMoKTsKCgkJLy9TdG9yZSB0aGUgaGVscGVyJ3MgY3NzIHBvc2l0aW9uCgkJdGhpcy5jc3NQb3NpdGlvbiA9IHRoaXMuaGVscGVyLmNzcyggInBvc2l0aW9uIiApOwoJCXRoaXMuc2Nyb2xsUGFyZW50ID0gdGhpcy5oZWxwZXIuc2Nyb2xsUGFyZW50KCB0cnVlICk7CgkJdGhpcy5vZmZzZXRQYXJlbnQgPSB0aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTsKCQl0aGlzLm9mZnNldFBhcmVudENzc1Bvc2l0aW9uID0gdGhpcy5vZmZzZXRQYXJlbnQuY3NzKCAicG9zaXRpb24iICk7CgoJCS8vVGhlIGVsZW1lbnQncyBhYnNvbHV0ZSBwb3NpdGlvbiBvbiB0aGUgcGFnZSBtaW51cyBtYXJnaW5zCgkJdGhpcy5vZmZzZXQgPSB0aGlzLnBvc2l0aW9uQWJzID0gdGhpcy5lbGVtZW50Lm9mZnNldCgpOwoJCXRoaXMub2Zmc2V0ID0gewoJCQl0b3A6IHRoaXMub2Zmc2V0LnRvcCAtIHRoaXMubWFyZ2lucy50b3AsCgkJCWxlZnQ6IHRoaXMub2Zmc2V0LmxlZnQgLSB0aGlzLm1hcmdpbnMubGVmdAoJCX07CgoJCS8vUmVzZXQgc2Nyb2xsIGNhY2hlCgkJdGhpcy5vZmZzZXQuc2Nyb2xsID0gZmFsc2U7CgoJCSQuZXh0ZW5kKHRoaXMub2Zmc2V0LCB7CgkJCWNsaWNrOiB7IC8vV2hlcmUgdGhlIGNsaWNrIGhhcHBlbmVkLCByZWxhdGl2ZSB0byB0aGUgZWxlbWVudAoJCQkJbGVmdDogZXZlbnQucGFnZVggLSB0aGlzLm9mZnNldC5sZWZ0LAoJCQkJdG9wOiBldmVudC5wYWdlWSAtIHRoaXMub2Zmc2V0LnRvcAoJCQl9LAoJCQlwYXJlbnQ6IHRoaXMuX2dldFBhcmVudE9mZnNldCgpLAoJCQlyZWxhdGl2ZTogdGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKSAvL1RoaXMgaXMgYSByZWxhdGl2ZSB0byBhYnNvbHV0ZSBwb3NpdGlvbiBtaW51cyB0aGUgYWN0dWFsIHBvc2l0aW9uIGNhbGN1bGF0aW9uIC0gb25seSB1c2VkIGZvciByZWxhdGl2ZSBwb3NpdGlvbmVkIGhlbHBlcgoJCX0pOwoKCQkvL0dlbmVyYXRlIHRoZSBvcmlnaW5hbCBwb3NpdGlvbgoJCXRoaXMub3JpZ2luYWxQb3NpdGlvbiA9IHRoaXMucG9zaXRpb24gPSB0aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKCBldmVudCwgZmFsc2UgKTsKCQl0aGlzLm9yaWdpbmFsUGFnZVggPSBldmVudC5wYWdlWDsKCQl0aGlzLm9yaWdpbmFsUGFnZVkgPSBldmVudC5wYWdlWTsKCgkJLy9BZGp1c3QgdGhlIG1vdXNlIG9mZnNldCByZWxhdGl2ZSB0byB0aGUgaGVscGVyIGlmICJjdXJzb3JBdCIgaXMgc3VwcGxpZWQKCQkoby5jdXJzb3JBdCAmJiB0aGlzLl9hZGp1c3RPZmZzZXRGcm9tSGVscGVyKG8uY3Vyc29yQXQpKTsKCgkJLy9TZXQgYSBjb250YWlubWVudCBpZiBnaXZlbiBpbiB0aGUgb3B0aW9ucwoJCXRoaXMuX3NldENvbnRhaW5tZW50KCk7CgoJCS8vVHJpZ2dlciBldmVudCArIGNhbGxiYWNrcwoJCWlmICh0aGlzLl90cmlnZ2VyKCJzdGFydCIsIGV2ZW50KSA9PT0gZmFsc2UpIHsKCQkJdGhpcy5fY2xlYXIoKTsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy9SZWNhY2hlIHRoZSBoZWxwZXIgc2l6ZQoJCXRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKTsKCgkJLy9QcmVwYXJlIHRoZSBkcm9wcGFibGUgb2Zmc2V0cwoJCWlmICgkLnVpLmRkbWFuYWdlciAmJiAhby5kcm9wQmVoYXZpb3VyKSB7CgkJCSQudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsIGV2ZW50KTsKCQl9CgoJCXRoaXMuX21vdXNlRHJhZyhldmVudCwgdHJ1ZSk7IC8vRXhlY3V0ZSB0aGUgZHJhZyBvbmNlIC0gdGhpcyBjYXVzZXMgdGhlIGhlbHBlciBub3QgdG8gYmUgdmlzaWJsZSBiZWZvcmUgZ2V0dGluZyBpdHMgY29ycmVjdCBwb3NpdGlvbgoKCQkvL0lmIHRoZSBkZG1hbmFnZXIgaXMgdXNlZCBmb3IgZHJvcHBhYmxlcywgaW5mb3JtIHRoZSBtYW5hZ2VyIHRoYXQgZHJhZ2dpbmcgaGFzIHN0YXJ0ZWQgKHNlZSAjNTAwMykKCQlpZiAoICQudWkuZGRtYW5hZ2VyICkgewoJCQkkLnVpLmRkbWFuYWdlci5kcmFnU3RhcnQodGhpcywgZXZlbnQpOwoJCX0KCgkJcmV0dXJuIHRydWU7Cgl9LAoKCV9tb3VzZURyYWc6IGZ1bmN0aW9uKGV2ZW50LCBub1Byb3BhZ2F0aW9uKSB7CgkJLy8gcmVzZXQgYW55IG5lY2Vzc2FyeSBjYWNoZWQgcHJvcGVydGllcyAoc2VlICM1MDA5KQoJCWlmICggdGhpcy5vZmZzZXRQYXJlbnRDc3NQb3NpdGlvbiA9PT0gImZpeGVkIiApIHsKCQkJdGhpcy5vZmZzZXQucGFyZW50ID0gdGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCk7CgkJfQoKCQkvL0NvbXB1dGUgdGhlIGhlbHBlcnMgcG9zaXRpb24KCQl0aGlzLnBvc2l0aW9uID0gdGhpcy5fZ2VuZXJhdGVQb3NpdGlvbiggZXZlbnQsIHRydWUgKTsKCQl0aGlzLnBvc2l0aW9uQWJzID0gdGhpcy5fY29udmVydFBvc2l0aW9uVG8oImFic29sdXRlIik7CgoJCS8vQ2FsbCBwbHVnaW5zIGFuZCBjYWxsYmFja3MgYW5kIHVzZSB0aGUgcmVzdWx0aW5nIHBvc2l0aW9uIGlmIHNvbWV0aGluZyBpcyByZXR1cm5lZAoJCWlmICghbm9Qcm9wYWdhdGlvbikgewoJCQl2YXIgdWkgPSB0aGlzLl91aUhhc2goKTsKCQkJaWYgKHRoaXMuX3RyaWdnZXIoImRyYWciLCBldmVudCwgdWkpID09PSBmYWxzZSkgewoJCQkJdGhpcy5fbW91c2VVcCh7fSk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJdGhpcy5wb3NpdGlvbiA9IHVpLnBvc2l0aW9uOwoJCX0KCgkJdGhpcy5oZWxwZXJbIDAgXS5zdHlsZS5sZWZ0ID0gdGhpcy5wb3NpdGlvbi5sZWZ0ICsgInB4IjsKCQl0aGlzLmhlbHBlclsgMCBdLnN0eWxlLnRvcCA9IHRoaXMucG9zaXRpb24udG9wICsgInB4IjsKCgkJaWYgKCQudWkuZGRtYW5hZ2VyKSB7CgkJCSQudWkuZGRtYW5hZ2VyLmRyYWcodGhpcywgZXZlbnQpOwoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfSwKCglfbW91c2VTdG9wOiBmdW5jdGlvbihldmVudCkgewoKCQkvL0lmIHdlIGFyZSB1c2luZyBkcm9wcGFibGVzLCBpbmZvcm0gdGhlIG1hbmFnZXIgYWJvdXQgdGhlIGRyb3AKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCWRyb3BwZWQgPSBmYWxzZTsKCQlpZiAoJC51aS5kZG1hbmFnZXIgJiYgIXRoaXMub3B0aW9ucy5kcm9wQmVoYXZpb3VyKSB7CgkJCWRyb3BwZWQgPSAkLnVpLmRkbWFuYWdlci5kcm9wKHRoaXMsIGV2ZW50KTsKCQl9CgoJCS8vaWYgYSBkcm9wIGNvbWVzIGZyb20gb3V0c2lkZSAoYSBzb3J0YWJsZSkKCQlpZiAodGhpcy5kcm9wcGVkKSB7CgkJCWRyb3BwZWQgPSB0aGlzLmRyb3BwZWQ7CgkJCXRoaXMuZHJvcHBlZCA9IGZhbHNlOwoJCX0KCgkJaWYgKCh0aGlzLm9wdGlvbnMucmV2ZXJ0ID09PSAiaW52YWxpZCIgJiYgIWRyb3BwZWQpIHx8ICh0aGlzLm9wdGlvbnMucmV2ZXJ0ID09PSAidmFsaWQiICYmIGRyb3BwZWQpIHx8IHRoaXMub3B0aW9ucy5yZXZlcnQgPT09IHRydWUgfHwgKCQuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMucmV2ZXJ0KSAmJiB0aGlzLm9wdGlvbnMucmV2ZXJ0LmNhbGwodGhpcy5lbGVtZW50LCBkcm9wcGVkKSkpIHsKCQkJJCh0aGlzLmhlbHBlcikuYW5pbWF0ZSh0aGlzLm9yaWdpbmFsUG9zaXRpb24sIHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnREdXJhdGlvbiwgMTApLCBmdW5jdGlvbigpIHsKCQkJCWlmICh0aGF0Ll90cmlnZ2VyKCJzdG9wIiwgZXZlbnQpICE9PSBmYWxzZSkgewoJCQkJCXRoYXQuX2NsZWFyKCk7CgkJCQl9CgkJCX0pOwoJCX0gZWxzZSB7CgkJCWlmICh0aGlzLl90cmlnZ2VyKCJzdG9wIiwgZXZlbnQpICE9PSBmYWxzZSkgewoJCQkJdGhpcy5fY2xlYXIoKTsKCQkJfQoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfSwKCglfbW91c2VVcDogZnVuY3Rpb24oZXZlbnQpIHsKCQkvL1JlbW92ZSBmcmFtZSBoZWxwZXJzCgkJJCgiZGl2LnVpLWRyYWdnYWJsZS1pZnJhbWVGaXgiKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQl0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcyk7CgkJfSk7CgoJCS8vSWYgdGhlIGRkbWFuYWdlciBpcyB1c2VkIGZvciBkcm9wcGFibGVzLCBpbmZvcm0gdGhlIG1hbmFnZXIgdGhhdCBkcmFnZ2luZyBoYXMgc3RvcHBlZCAoc2VlICM1MDAzKQoJCWlmICggJC51aS5kZG1hbmFnZXIgKSB7CgkJCSQudWkuZGRtYW5hZ2VyLmRyYWdTdG9wKHRoaXMsIGV2ZW50KTsKCQl9CgoJCS8vIFRoZSBpbnRlcmFjdGlvbiBpcyBvdmVyOyB3aGV0aGVyIG9yIG5vdCB0aGUgY2xpY2sgcmVzdWx0ZWQgaW4gYSBkcmFnLCBmb2N1cyB0aGUgZWxlbWVudAoJCXRoaXMuZWxlbWVudC5mb2N1cygpOwoKCQlyZXR1cm4gJC51aS5tb3VzZS5wcm90b3R5cGUuX21vdXNlVXAuY2FsbCh0aGlzLCBldmVudCk7Cgl9LAoKCWNhbmNlbDogZnVuY3Rpb24oKSB7CgoJCWlmICh0aGlzLmhlbHBlci5pcygiLnVpLWRyYWdnYWJsZS1kcmFnZ2luZyIpKSB7CgkJCXRoaXMuX21vdXNlVXAoe30pOwoJCX0gZWxzZSB7CgkJCXRoaXMuX2NsZWFyKCk7CgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9LAoKCV9nZXRIYW5kbGU6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJcmV0dXJuIHRoaXMub3B0aW9ucy5oYW5kbGUgPwoJCQkhISQoIGV2ZW50LnRhcmdldCApLmNsb3Nlc3QoIHRoaXMuZWxlbWVudC5maW5kKCB0aGlzLm9wdGlvbnMuaGFuZGxlICkgKS5sZW5ndGggOgoJCQl0cnVlOwoJfSwKCglfc2V0SGFuZGxlQ2xhc3NOYW1lOiBmdW5jdGlvbigpIHsKCQl0aGlzLmhhbmRsZUVsZW1lbnQgPSB0aGlzLm9wdGlvbnMuaGFuZGxlID8KCQkJdGhpcy5lbGVtZW50LmZpbmQoIHRoaXMub3B0aW9ucy5oYW5kbGUgKSA6IHRoaXMuZWxlbWVudDsKCQl0aGlzLmhhbmRsZUVsZW1lbnQuYWRkQ2xhc3MoICJ1aS1kcmFnZ2FibGUtaGFuZGxlIiApOwoJfSwKCglfcmVtb3ZlSGFuZGxlQ2xhc3NOYW1lOiBmdW5jdGlvbigpIHsKCQl0aGlzLmhhbmRsZUVsZW1lbnQucmVtb3ZlQ2xhc3MoICJ1aS1kcmFnZ2FibGUtaGFuZGxlIiApOwoJfSwKCglfY3JlYXRlSGVscGVyOiBmdW5jdGlvbihldmVudCkgewoKCQl2YXIgbyA9IHRoaXMub3B0aW9ucywKCQkJaGVscGVyID0gJC5pc0Z1bmN0aW9uKG8uaGVscGVyKSA/ICQoby5oZWxwZXIuYXBwbHkodGhpcy5lbGVtZW50WyAwIF0sIFsgZXZlbnQgXSkpIDogKG8uaGVscGVyID09PSAiY2xvbmUiID8gdGhpcy5lbGVtZW50LmNsb25lKCkucmVtb3ZlQXR0cigiaWQiKSA6IHRoaXMuZWxlbWVudCk7CgoJCWlmICghaGVscGVyLnBhcmVudHMoImJvZHkiKS5sZW5ndGgpIHsKCQkJaGVscGVyLmFwcGVuZFRvKChvLmFwcGVuZFRvID09PSAicGFyZW50IiA/IHRoaXMuZWxlbWVudFswXS5wYXJlbnROb2RlIDogby5hcHBlbmRUbykpOwoJCX0KCgkJaWYgKGhlbHBlclswXSAhPT0gdGhpcy5lbGVtZW50WzBdICYmICEoLyhmaXhlZHxhYnNvbHV0ZSkvKS50ZXN0KGhlbHBlci5jc3MoInBvc2l0aW9uIikpKSB7CgkJCWhlbHBlci5jc3MoInBvc2l0aW9uIiwgImFic29sdXRlIik7CgkJfQoKCQlyZXR1cm4gaGVscGVyOwoKCX0sCgoJX2FkanVzdE9mZnNldEZyb21IZWxwZXI6IGZ1bmN0aW9uKG9iaikgewoJCWlmICh0eXBlb2Ygb2JqID09PSAic3RyaW5nIikgewoJCQlvYmogPSBvYmouc3BsaXQoIiAiKTsKCQl9CgkJaWYgKCQuaXNBcnJheShvYmopKSB7CgkJCW9iaiA9IHsgbGVmdDogK29ialswXSwgdG9wOiArb2JqWzFdIHx8IDAgfTsKCQl9CgkJaWYgKCJsZWZ0IiBpbiBvYmopIHsKCQkJdGhpcy5vZmZzZXQuY2xpY2subGVmdCA9IG9iai5sZWZ0ICsgdGhpcy5tYXJnaW5zLmxlZnQ7CgkJfQoJCWlmICgicmlnaHQiIGluIG9iaikgewoJCQl0aGlzLm9mZnNldC5jbGljay5sZWZ0ID0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAtIG9iai5yaWdodCArIHRoaXMubWFyZ2lucy5sZWZ0OwoJCX0KCQlpZiAoInRvcCIgaW4gb2JqKSB7CgkJCXRoaXMub2Zmc2V0LmNsaWNrLnRvcCA9IG9iai50b3AgKyB0aGlzLm1hcmdpbnMudG9wOwoJCX0KCQlpZiAoImJvdHRvbSIgaW4gb2JqKSB7CgkJCXRoaXMub2Zmc2V0LmNsaWNrLnRvcCA9IHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gb2JqLmJvdHRvbSArIHRoaXMubWFyZ2lucy50b3A7CgkJfQoJfSwKCglfaXNSb290Tm9kZTogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJcmV0dXJuICggLyhodG1sfGJvZHkpL2kgKS50ZXN0KCBlbGVtZW50LnRhZ05hbWUgKSB8fCBlbGVtZW50ID09PSB0aGlzLmRvY3VtZW50WyAwIF07Cgl9LAoKCV9nZXRQYXJlbnRPZmZzZXQ6IGZ1bmN0aW9uKCkgewoKCQkvL0dldCB0aGUgb2Zmc2V0UGFyZW50IGFuZCBjYWNoZSBpdHMgcG9zaXRpb24KCQl2YXIgcG8gPSB0aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKSwKCQkJZG9jdW1lbnQgPSB0aGlzLmRvY3VtZW50WyAwIF07CgoJCS8vIFRoaXMgaXMgYSBzcGVjaWFsIGNhc2Ugd2hlcmUgd2UgbmVlZCB0byBtb2RpZnkgYSBvZmZzZXQgY2FsY3VsYXRlZCBvbiBzdGFydCwgc2luY2UgdGhlIGZvbGxvd2luZyBoYXBwZW5lZDoKCQkvLyAxLiBUaGUgcG9zaXRpb24gb2YgdGhlIGhlbHBlciBpcyBhYnNvbHV0ZSwgc28gaXQncyBwb3NpdGlvbiBpcyBjYWxjdWxhdGVkIGJhc2VkIG9uIHRoZSBuZXh0IHBvc2l0aW9uZWQgcGFyZW50CgkJLy8gMi4gVGhlIGFjdHVhbCBvZmZzZXQgcGFyZW50IGlzIGEgY2hpbGQgb2YgdGhlIHNjcm9sbCBwYXJlbnQsIGFuZCB0aGUgc2Nyb2xsIHBhcmVudCBpc24ndCB0aGUgZG9jdW1lbnQsIHdoaWNoIG1lYW5zIHRoYXQKCQkvLyAgICB0aGUgc2Nyb2xsIGlzIGluY2x1ZGVkIGluIHRoZSBpbml0aWFsIGNhbGN1bGF0aW9uIG9mIHRoZSBvZmZzZXQgb2YgdGhlIHBhcmVudCwgYW5kIG5ldmVyIHJlY2FsY3VsYXRlZCB1cG9uIGRyYWcKCQlpZiAodGhpcy5jc3NQb3NpdGlvbiA9PT0gImFic29sdXRlIiAmJiB0aGlzLnNjcm9sbFBhcmVudFswXSAhPT0gZG9jdW1lbnQgJiYgJC5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSwgdGhpcy5vZmZzZXRQYXJlbnRbMF0pKSB7CgkJCXBvLmxlZnQgKz0gdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOwoJCQlwby50b3AgKz0gdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCk7CgkJfQoKCQlpZiAoIHRoaXMuX2lzUm9vdE5vZGUoIHRoaXMub2Zmc2V0UGFyZW50WyAwIF0gKSApIHsKCQkJcG8gPSB7IHRvcDogMCwgbGVmdDogMCB9OwoJCX0KCgkJcmV0dXJuIHsKCQkJdG9wOiBwby50b3AgKyAocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKCJib3JkZXJUb3BXaWR0aCIpLCAxMCkgfHwgMCksCgkJCWxlZnQ6IHBvLmxlZnQgKyAocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwgMTApIHx8IDApCgkJfTsKCgl9LAoKCV9nZXRSZWxhdGl2ZU9mZnNldDogZnVuY3Rpb24oKSB7CgkJaWYgKCB0aGlzLmNzc1Bvc2l0aW9uICE9PSAicmVsYXRpdmUiICkgewoJCQlyZXR1cm4geyB0b3A6IDAsIGxlZnQ6IDAgfTsKCQl9CgoJCXZhciBwID0gdGhpcy5lbGVtZW50LnBvc2l0aW9uKCksCgkJCXNjcm9sbElzUm9vdE5vZGUgPSB0aGlzLl9pc1Jvb3ROb2RlKCB0aGlzLnNjcm9sbFBhcmVudFsgMCBdICk7CgoJCXJldHVybiB7CgkJCXRvcDogcC50b3AgLSAoIHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcyggInRvcCIgKSwgMTApIHx8IDAgKSArICggIXNjcm9sbElzUm9vdE5vZGUgPyB0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSA6IDAgKSwKCQkJbGVmdDogcC5sZWZ0IC0gKCBwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoICJsZWZ0IiApLCAxMCkgfHwgMCApICsgKCAhc2Nyb2xsSXNSb290Tm9kZSA/IHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKSA6IDAgKQoJCX07CgoJfSwKCglfY2FjaGVNYXJnaW5zOiBmdW5jdGlvbigpIHsKCQl0aGlzLm1hcmdpbnMgPSB7CgkJCWxlZnQ6IChwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKCJtYXJnaW5MZWZ0IiksIDEwKSB8fCAwKSwKCQkJdG9wOiAocGFyc2VJbnQodGhpcy5lbGVtZW50LmNzcygibWFyZ2luVG9wIiksIDEwKSB8fCAwKSwKCQkJcmlnaHQ6IChwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKCJtYXJnaW5SaWdodCIpLCAxMCkgfHwgMCksCgkJCWJvdHRvbTogKHBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpbkJvdHRvbSIpLCAxMCkgfHwgMCkKCQl9OwoJfSwKCglfY2FjaGVIZWxwZXJQcm9wb3J0aW9uczogZnVuY3Rpb24oKSB7CgkJdGhpcy5oZWxwZXJQcm9wb3J0aW9ucyA9IHsKCQkJd2lkdGg6IHRoaXMuaGVscGVyLm91dGVyV2lkdGgoKSwKCQkJaGVpZ2h0OiB0aGlzLmhlbHBlci5vdXRlckhlaWdodCgpCgkJfTsKCX0sCgoJX3NldENvbnRhaW5tZW50OiBmdW5jdGlvbigpIHsKCgkJdmFyIG92ZXIsIGMsIGNlLAoJCQlvID0gdGhpcy5vcHRpb25zLAoJCQlkb2N1bWVudCA9IHRoaXMuZG9jdW1lbnRbIDAgXTsKCgkJdGhpcy5yZWxhdGl2ZUNvbnRhaW5lciA9IG51bGw7CgoJCWlmICggIW8uY29udGFpbm1lbnQgKSB7CgkJCXRoaXMuY29udGFpbm1lbnQgPSBudWxsOwoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIG8uY29udGFpbm1lbnQgPT09ICJ3aW5kb3ciICkgewoJCQl0aGlzLmNvbnRhaW5tZW50ID0gWwoJCQkJJCggd2luZG93ICkuc2Nyb2xsTGVmdCgpIC0gdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCAtIHRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LAoJCQkJJCggd2luZG93ICkuc2Nyb2xsVG9wKCkgLSB0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AgLSB0aGlzLm9mZnNldC5wYXJlbnQudG9wLAoJCQkJJCggd2luZG93ICkuc2Nyb2xsTGVmdCgpICsgJCggd2luZG93ICkud2lkdGgoKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLSB0aGlzLm1hcmdpbnMubGVmdCwKCQkJCSQoIHdpbmRvdyApLnNjcm9sbFRvcCgpICsgKCAkKCB3aW5kb3cgKS5oZWlnaHQoKSB8fCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0ICkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAtIHRoaXMubWFyZ2lucy50b3AKCQkJXTsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCBvLmNvbnRhaW5tZW50ID09PSAiZG9jdW1lbnQiKSB7CgkJCXRoaXMuY29udGFpbm1lbnQgPSBbCgkJCQkwLAoJCQkJMCwKCQkJCSQoIGRvY3VtZW50ICkud2lkdGgoKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLSB0aGlzLm1hcmdpbnMubGVmdCwKCQkJCSggJCggZG9jdW1lbnQgKS5oZWlnaHQoKSB8fCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0ICkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAtIHRoaXMubWFyZ2lucy50b3AKCQkJXTsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCBvLmNvbnRhaW5tZW50LmNvbnN0cnVjdG9yID09PSBBcnJheSApIHsKCQkJdGhpcy5jb250YWlubWVudCA9IG8uY29udGFpbm1lbnQ7CgkJCXJldHVybjsKCQl9CgoJCWlmICggby5jb250YWlubWVudCA9PT0gInBhcmVudCIgKSB7CgkJCW8uY29udGFpbm1lbnQgPSB0aGlzLmhlbHBlclsgMCBdLnBhcmVudE5vZGU7CgkJfQoKCQljID0gJCggby5jb250YWlubWVudCApOwoJCWNlID0gY1sgMCBdOwoKCQlpZiAoICFjZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJb3ZlciA9IGMuY3NzKCAib3ZlcmZsb3ciICkgIT09ICJoaWRkZW4iOwoKCQl0aGlzLmNvbnRhaW5tZW50ID0gWwoJCQkoIHBhcnNlSW50KCBjLmNzcyggImJvcmRlckxlZnRXaWR0aCIgKSwgMTAgKSB8fCAwICkgKyAoIHBhcnNlSW50KCBjLmNzcyggInBhZGRpbmdMZWZ0IiApLCAxMCApIHx8IDAgKSwKCQkJKCBwYXJzZUludCggYy5jc3MoICJib3JkZXJUb3BXaWR0aCIgKSwgMTAgKSB8fCAwICkgKyAoIHBhcnNlSW50KCBjLmNzcyggInBhZGRpbmdUb3AiICksIDEwICkgfHwgMCApLAoJCQkoIG92ZXIgPyBNYXRoLm1heCggY2Uuc2Nyb2xsV2lkdGgsIGNlLm9mZnNldFdpZHRoICkgOiBjZS5vZmZzZXRXaWR0aCApIC0gKCBwYXJzZUludCggYy5jc3MoICJib3JkZXJSaWdodFdpZHRoIiApLCAxMCApIHx8IDAgKSAtICggcGFyc2VJbnQoIGMuY3NzKCAicGFkZGluZ1JpZ2h0IiApLCAxMCApIHx8IDAgKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLSB0aGlzLm1hcmdpbnMubGVmdCAtIHRoaXMubWFyZ2lucy5yaWdodCwKCQkJKCBvdmVyID8gTWF0aC5tYXgoIGNlLnNjcm9sbEhlaWdodCwgY2Uub2Zmc2V0SGVpZ2h0ICkgOiBjZS5vZmZzZXRIZWlnaHQgKSAtICggcGFyc2VJbnQoIGMuY3NzKCAiYm9yZGVyQm90dG9tV2lkdGgiICksIDEwICkgfHwgMCApIC0gKCBwYXJzZUludCggYy5jc3MoICJwYWRkaW5nQm90dG9tIiApLCAxMCApIHx8IDAgKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0IC0gdGhpcy5tYXJnaW5zLnRvcCAgLSB0aGlzLm1hcmdpbnMuYm90dG9tCgkJXTsKCQl0aGlzLnJlbGF0aXZlQ29udGFpbmVyID0gYzsKCX0sCgoJX2NvbnZlcnRQb3NpdGlvblRvOiBmdW5jdGlvbihkLCBwb3MpIHsKCgkJaWYgKCFwb3MpIHsKCQkJcG9zID0gdGhpcy5wb3NpdGlvbjsKCQl9CgoJCXZhciBtb2QgPSBkID09PSAiYWJzb2x1dGUiID8gMSA6IC0xLAoJCQlzY3JvbGxJc1Jvb3ROb2RlID0gdGhpcy5faXNSb290Tm9kZSggdGhpcy5zY3JvbGxQYXJlbnRbIDAgXSApOwoKCQlyZXR1cm4gewoJCQl0b3A6ICgKCQkJCXBvcy50b3AJKwkJCQkJCQkJCQkJCQkJCQkvLyBUaGUgYWJzb2x1dGUgbW91c2UgcG9zaXRpb24KCQkJCXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCAqIG1vZCArCQkJCQkJCQkJCS8vIE9ubHkgZm9yIHJlbGF0aXZlIHBvc2l0aW9uZWQgbm9kZXM6IFJlbGF0aXZlIG9mZnNldCBmcm9tIGVsZW1lbnQgdG8gb2Zmc2V0IHBhcmVudAoJCQkJdGhpcy5vZmZzZXQucGFyZW50LnRvcCAqIG1vZCAtCQkJCQkJCQkJCS8vIFRoZSBvZmZzZXRQYXJlbnQncyBvZmZzZXQgd2l0aG91dCBib3JkZXJzIChvZmZzZXQgKyBib3JkZXIpCgkJCQkoICggdGhpcy5jc3NQb3NpdGlvbiA9PT0gImZpeGVkIiA/IC10aGlzLm9mZnNldC5zY3JvbGwudG9wIDogKCBzY3JvbGxJc1Jvb3ROb2RlID8gMCA6IHRoaXMub2Zmc2V0LnNjcm9sbC50b3AgKSApICogbW9kKQoJCQkpLAoJCQlsZWZ0OiAoCgkJCQlwb3MubGVmdCArCQkJCQkJCQkJCQkJCQkJCS8vIFRoZSBhYnNvbHV0ZSBtb3VzZSBwb3NpdGlvbgoJCQkJdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCAqIG1vZCArCQkJCQkJCQkJCS8vIE9ubHkgZm9yIHJlbGF0aXZlIHBvc2l0aW9uZWQgbm9kZXM6IFJlbGF0aXZlIG9mZnNldCBmcm9tIGVsZW1lbnQgdG8gb2Zmc2V0IHBhcmVudAoJCQkJdGhpcy5vZmZzZXQucGFyZW50LmxlZnQgKiBtb2QJLQkJCQkJCQkJCQkvLyBUaGUgb2Zmc2V0UGFyZW50J3Mgb2Zmc2V0IHdpdGhvdXQgYm9yZGVycyAob2Zmc2V0ICsgYm9yZGVyKQoJCQkJKCAoIHRoaXMuY3NzUG9zaXRpb24gPT09ICJmaXhlZCIgPyAtdGhpcy5vZmZzZXQuc2Nyb2xsLmxlZnQgOiAoIHNjcm9sbElzUm9vdE5vZGUgPyAwIDogdGhpcy5vZmZzZXQuc2Nyb2xsLmxlZnQgKSApICogbW9kKQoJCQkpCgkJfTsKCgl9LAoKCV9nZW5lcmF0ZVBvc2l0aW9uOiBmdW5jdGlvbiggZXZlbnQsIGNvbnN0cmFpblBvc2l0aW9uICkgewoKCQl2YXIgY29udGFpbm1lbnQsIGNvLCB0b3AsIGxlZnQsCgkJCW8gPSB0aGlzLm9wdGlvbnMsCgkJCXNjcm9sbElzUm9vdE5vZGUgPSB0aGlzLl9pc1Jvb3ROb2RlKCB0aGlzLnNjcm9sbFBhcmVudFsgMCBdICksCgkJCXBhZ2VYID0gZXZlbnQucGFnZVgsCgkJCXBhZ2VZID0gZXZlbnQucGFnZVk7CgoJCS8vIENhY2hlIHRoZSBzY3JvbGwKCQlpZiAoICFzY3JvbGxJc1Jvb3ROb2RlIHx8ICF0aGlzLm9mZnNldC5zY3JvbGwgKSB7CgkJCXRoaXMub2Zmc2V0LnNjcm9sbCA9IHsKCQkJCXRvcDogdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCksCgkJCQlsZWZ0OiB0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCkKCQkJfTsKCQl9CgoJCS8qCgkJICogLSBQb3NpdGlvbiBjb25zdHJhaW5pbmcgLQoJCSAqIENvbnN0cmFpbiB0aGUgcG9zaXRpb24gdG8gYSBtaXggb2YgZ3JpZCwgY29udGFpbm1lbnQuCgkJICovCgoJCS8vIElmIHdlIGFyZSBub3QgZHJhZ2dpbmcgeWV0LCB3ZSB3b24ndCBjaGVjayBmb3Igb3B0aW9ucwoJCWlmICggY29uc3RyYWluUG9zaXRpb24gKSB7CgkJCWlmICggdGhpcy5jb250YWlubWVudCApIHsKCQkJCWlmICggdGhpcy5yZWxhdGl2ZUNvbnRhaW5lciApewoJCQkJCWNvID0gdGhpcy5yZWxhdGl2ZUNvbnRhaW5lci5vZmZzZXQoKTsKCQkJCQljb250YWlubWVudCA9IFsKCQkJCQkJdGhpcy5jb250YWlubWVudFsgMCBdICsgY28ubGVmdCwKCQkJCQkJdGhpcy5jb250YWlubWVudFsgMSBdICsgY28udG9wLAoJCQkJCQl0aGlzLmNvbnRhaW5tZW50WyAyIF0gKyBjby5sZWZ0LAoJCQkJCQl0aGlzLmNvbnRhaW5tZW50WyAzIF0gKyBjby50b3AKCQkJCQldOwoJCQkJfSBlbHNlIHsKCQkJCQljb250YWlubWVudCA9IHRoaXMuY29udGFpbm1lbnQ7CgkJCQl9CgoJCQkJaWYgKGV2ZW50LnBhZ2VYIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA8IGNvbnRhaW5tZW50WzBdKSB7CgkJCQkJcGFnZVggPSBjb250YWlubWVudFswXSArIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ7CgkJCQl9CgkJCQlpZiAoZXZlbnQucGFnZVkgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPCBjb250YWlubWVudFsxXSkgewoJCQkJCXBhZ2VZID0gY29udGFpbm1lbnRbMV0gKyB0aGlzLm9mZnNldC5jbGljay50b3A7CgkJCQl9CgkJCQlpZiAoZXZlbnQucGFnZVggLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID4gY29udGFpbm1lbnRbMl0pIHsKCQkJCQlwYWdlWCA9IGNvbnRhaW5tZW50WzJdICsgdGhpcy5vZmZzZXQuY2xpY2subGVmdDsKCQkJCX0KCQkJCWlmIChldmVudC5wYWdlWSAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+IGNvbnRhaW5tZW50WzNdKSB7CgkJCQkJcGFnZVkgPSBjb250YWlubWVudFszXSArIHRoaXMub2Zmc2V0LmNsaWNrLnRvcDsKCQkJCX0KCQkJfQoKCQkJaWYgKG8uZ3JpZCkgewoJCQkJLy9DaGVjayBmb3IgZ3JpZCBlbGVtZW50cyBzZXQgdG8gMCB0byBwcmV2ZW50IGRpdmlkZSBieSAwIGVycm9yIGNhdXNpbmcgaW52YWxpZCBhcmd1bWVudCBlcnJvcnMgaW4gSUUgKHNlZSB0aWNrZXQgIzY5NTApCgkJCQl0b3AgPSBvLmdyaWRbMV0gPyB0aGlzLm9yaWdpbmFsUGFnZVkgKyBNYXRoLnJvdW5kKChwYWdlWSAtIHRoaXMub3JpZ2luYWxQYWdlWSkgLyBvLmdyaWRbMV0pICogby5ncmlkWzFdIDogdGhpcy5vcmlnaW5hbFBhZ2VZOwoJCQkJcGFnZVkgPSBjb250YWlubWVudCA/ICgodG9wIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wID49IGNvbnRhaW5tZW50WzFdIHx8IHRvcCAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+IGNvbnRhaW5tZW50WzNdKSA/IHRvcCA6ICgodG9wIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wID49IGNvbnRhaW5tZW50WzFdKSA/IHRvcCAtIG8uZ3JpZFsxXSA6IHRvcCArIG8uZ3JpZFsxXSkpIDogdG9wOwoKCQkJCWxlZnQgPSBvLmdyaWRbMF0gPyB0aGlzLm9yaWdpbmFsUGFnZVggKyBNYXRoLnJvdW5kKChwYWdlWCAtIHRoaXMub3JpZ2luYWxQYWdlWCkgLyBvLmdyaWRbMF0pICogby5ncmlkWzBdIDogdGhpcy5vcmlnaW5hbFBhZ2VYOwoJCQkJcGFnZVggPSBjb250YWlubWVudCA/ICgobGVmdCAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPj0gY29udGFpbm1lbnRbMF0gfHwgbGVmdCAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPiBjb250YWlubWVudFsyXSkgPyBsZWZ0IDogKChsZWZ0IC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA+PSBjb250YWlubWVudFswXSkgPyBsZWZ0IC0gby5ncmlkWzBdIDogbGVmdCArIG8uZ3JpZFswXSkpIDogbGVmdDsKCQkJfQoKCQkJaWYgKCBvLmF4aXMgPT09ICJ5IiApIHsKCQkJCXBhZ2VYID0gdGhpcy5vcmlnaW5hbFBhZ2VYOwoJCQl9CgoJCQlpZiAoIG8uYXhpcyA9PT0gIngiICkgewoJCQkJcGFnZVkgPSB0aGlzLm9yaWdpbmFsUGFnZVk7CgkJCX0KCQl9CgoJCXJldHVybiB7CgkJCXRvcDogKAoJCQkJcGFnZVkgLQkJCQkJCQkJCQkJCQkJCQkJLy8gVGhlIGFic29sdXRlIG1vdXNlIHBvc2l0aW9uCgkJCQl0aGlzLm9mZnNldC5jbGljay50b3AJLQkJCQkJCQkJCQkJCS8vIENsaWNrIG9mZnNldCAocmVsYXRpdmUgdG8gdGhlIGVsZW1lbnQpCgkJCQl0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AgLQkJCQkJCQkJCQkJCS8vIE9ubHkgZm9yIHJlbGF0aXZlIHBvc2l0aW9uZWQgbm9kZXM6IFJlbGF0aXZlIG9mZnNldCBmcm9tIGVsZW1lbnQgdG8gb2Zmc2V0IHBhcmVudAoJCQkJdGhpcy5vZmZzZXQucGFyZW50LnRvcCArCQkJCQkJCQkJCQkJLy8gVGhlIG9mZnNldFBhcmVudCdzIG9mZnNldCB3aXRob3V0IGJvcmRlcnMgKG9mZnNldCArIGJvcmRlcikKCQkJCSggdGhpcy5jc3NQb3NpdGlvbiA9PT0gImZpeGVkIiA/IC10aGlzLm9mZnNldC5zY3JvbGwudG9wIDogKCBzY3JvbGxJc1Jvb3ROb2RlID8gMCA6IHRoaXMub2Zmc2V0LnNjcm9sbC50b3AgKSApCgkJCSksCgkJCWxlZnQ6ICgKCQkJCXBhZ2VYIC0JCQkJCQkJCQkJCQkJCQkJCS8vIFRoZSBhYnNvbHV0ZSBtb3VzZSBwb3NpdGlvbgoJCQkJdGhpcy5vZmZzZXQuY2xpY2subGVmdCAtCQkJCQkJCQkJCQkJLy8gQ2xpY2sgb2Zmc2V0IChyZWxhdGl2ZSB0byB0aGUgZWxlbWVudCkKCQkJCXRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQgLQkJCQkJCQkJCQkJCS8vIE9ubHkgZm9yIHJlbGF0aXZlIHBvc2l0aW9uZWQgbm9kZXM6IFJlbGF0aXZlIG9mZnNldCBmcm9tIGVsZW1lbnQgdG8gb2Zmc2V0IHBhcmVudAoJCQkJdGhpcy5vZmZzZXQucGFyZW50LmxlZnQgKwkJCQkJCQkJCQkJCS8vIFRoZSBvZmZzZXRQYXJlbnQncyBvZmZzZXQgd2l0aG91dCBib3JkZXJzIChvZmZzZXQgKyBib3JkZXIpCgkJCQkoIHRoaXMuY3NzUG9zaXRpb24gPT09ICJmaXhlZCIgPyAtdGhpcy5vZmZzZXQuc2Nyb2xsLmxlZnQgOiAoIHNjcm9sbElzUm9vdE5vZGUgPyAwIDogdGhpcy5vZmZzZXQuc2Nyb2xsLmxlZnQgKSApCgkJCSkKCQl9OwoKCX0sCgoJX2NsZWFyOiBmdW5jdGlvbigpIHsKCQl0aGlzLmhlbHBlci5yZW1vdmVDbGFzcygidWktZHJhZ2dhYmxlLWRyYWdnaW5nIik7CgkJaWYgKHRoaXMuaGVscGVyWzBdICE9PSB0aGlzLmVsZW1lbnRbMF0gJiYgIXRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbCkgewoJCQl0aGlzLmhlbHBlci5yZW1vdmUoKTsKCQl9CgkJdGhpcy5oZWxwZXIgPSBudWxsOwoJCXRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbCA9IGZhbHNlOwoJCWlmICggdGhpcy5kZXN0cm95T25DbGVhciApIHsKCQkJdGhpcy5kZXN0cm95KCk7CgkJfQoJfSwKCgkvLyBGcm9tIG5vdyBvbiBidWxrIHN0dWZmIC0gbWFpbmx5IGhlbHBlcnMKCglfdHJpZ2dlcjogZnVuY3Rpb24odHlwZSwgZXZlbnQsIHVpKSB7CgkJdWkgPSB1aSB8fCB0aGlzLl91aUhhc2goKTsKCQkkLnVpLnBsdWdpbi5jYWxsKCB0aGlzLCB0eXBlLCBbIGV2ZW50LCB1aSwgdGhpcyBdLCB0cnVlICk7CgkJLy9UaGUgYWJzb2x1dGUgcG9zaXRpb24gaGFzIHRvIGJlIHJlY2FsY3VsYXRlZCBhZnRlciBwbHVnaW5zCgkJaWYgKHR5cGUgPT09ICJkcmFnIikgewoJCQl0aGlzLnBvc2l0aW9uQWJzID0gdGhpcy5fY29udmVydFBvc2l0aW9uVG8oImFic29sdXRlIik7CgkJfQoJCXJldHVybiAkLldpZGdldC5wcm90b3R5cGUuX3RyaWdnZXIuY2FsbCh0aGlzLCB0eXBlLCBldmVudCwgdWkpOwoJfSwKCglwbHVnaW5zOiB7fSwKCglfdWlIYXNoOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gewoJCQloZWxwZXI6IHRoaXMuaGVscGVyLAoJCQlwb3NpdGlvbjogdGhpcy5wb3NpdGlvbiwKCQkJb3JpZ2luYWxQb3NpdGlvbjogdGhpcy5vcmlnaW5hbFBvc2l0aW9uLAoJCQlvZmZzZXQ6IHRoaXMucG9zaXRpb25BYnMKCQl9OwoJfQoKfSk7CgokLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsICJjb25uZWN0VG9Tb3J0YWJsZSIsIHsKCXN0YXJ0OiBmdW5jdGlvbiggZXZlbnQsIHVpLCBpbnN0ICkgewoKCQl2YXIgbyA9IGluc3Qub3B0aW9ucywKCQkJdWlTb3J0YWJsZSA9ICQuZXh0ZW5kKHt9LCB1aSwgeyBpdGVtOiBpbnN0LmVsZW1lbnQgfSk7CgkJaW5zdC5zb3J0YWJsZXMgPSBbXTsKCQkkKG8uY29ubmVjdFRvU29ydGFibGUpLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBzb3J0YWJsZSA9ICQoIHRoaXMgKS5zb3J0YWJsZSggImluc3RhbmNlIiApOwoJCQlpZiAoc29ydGFibGUgJiYgIXNvcnRhYmxlLm9wdGlvbnMuZGlzYWJsZWQpIHsKCQkJCWluc3Quc29ydGFibGVzLnB1c2goewoJCQkJCWluc3RhbmNlOiBzb3J0YWJsZSwKCQkJCQlzaG91bGRSZXZlcnQ6IHNvcnRhYmxlLm9wdGlvbnMucmV2ZXJ0CgkJCQl9KTsKCQkJCXNvcnRhYmxlLnJlZnJlc2hQb3NpdGlvbnMoKTsJLy8gQ2FsbCB0aGUgc29ydGFibGUncyByZWZyZXNoUG9zaXRpb25zIGF0IGRyYWcgc3RhcnQgdG8gcmVmcmVzaCB0aGUgY29udGFpbmVyQ2FjaGUgc2luY2UgdGhlIHNvcnRhYmxlIGNvbnRhaW5lciBjYWNoZSBpcyB1c2VkIGluIGRyYWcgYW5kIG5lZWRzIHRvIGJlIHVwIHRvIGRhdGUgKHRoaXMgd2lsbCBlbnN1cmUgaXQncyBpbml0aWFsaXNlZCBhcyB3ZWxsIGFzIGJlaW5nIGtlcHQgaW4gc3RlcCB3aXRoIGFueSBjaGFuZ2VzIHRoYXQgbWlnaHQgaGF2ZSBoYXBwZW5lZCBvbiB0aGUgcGFnZSkuCgkJCQlzb3J0YWJsZS5fdHJpZ2dlcigiYWN0aXZhdGUiLCBldmVudCwgdWlTb3J0YWJsZSk7CgkJCX0KCQl9KTsKCgl9LAoJc3RvcDogZnVuY3Rpb24oIGV2ZW50LCB1aSwgaW5zdCApIHsKCgkJLy9JZiB3ZSBhcmUgc3RpbGwgb3ZlciB0aGUgc29ydGFibGUsIHdlIGZha2UgdGhlIHN0b3AgZXZlbnQgb2YgdGhlIHNvcnRhYmxlLCBidXQgYWxzbyByZW1vdmUgaGVscGVyCgkJdmFyIHVpU29ydGFibGUgPSAkLmV4dGVuZCgge30sIHVpLCB7CgkJCWl0ZW06IGluc3QuZWxlbWVudAoJCX0pOwoKCQkkLmVhY2goaW5zdC5zb3J0YWJsZXMsIGZ1bmN0aW9uKCkgewoJCQlpZiAodGhpcy5pbnN0YW5jZS5pc092ZXIpIHsKCgkJCQl0aGlzLmluc3RhbmNlLmlzT3ZlciA9IDA7CgoJCQkJaW5zdC5jYW5jZWxIZWxwZXJSZW1vdmFsID0gdHJ1ZTsgLy9Eb24ndCByZW1vdmUgdGhlIGhlbHBlciBpbiB0aGUgZHJhZ2dhYmxlIGluc3RhbmNlCgkJCQl0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWwgPSBmYWxzZTsgLy9SZW1vdmUgaXQgaW4gdGhlIHNvcnRhYmxlIGluc3RhbmNlIChzbyBzb3J0YWJsZSBwbHVnaW5zIGxpa2UgcmV2ZXJ0IHN0aWxsIHdvcmspCgoJCQkJLy9UaGUgc29ydGFibGUgcmV2ZXJ0IGlzIHN1cHBvcnRlZCwgYW5kIHdlIGhhdmUgdG8gc2V0IGEgdGVtcG9yYXJ5IGRyb3BwZWQgdmFyaWFibGUgb24gdGhlIGRyYWdnYWJsZSB0byBzdXBwb3J0IHJldmVydDogInZhbGlkL2ludmFsaWQiCgkJCQlpZiAodGhpcy5zaG91bGRSZXZlcnQpIHsKCQkJCQl0aGlzLmluc3RhbmNlLm9wdGlvbnMucmV2ZXJ0ID0gdGhpcy5zaG91bGRSZXZlcnQ7CgkJCQl9CgoJCQkJLy9UcmlnZ2VyIHRoZSBzdG9wIG9mIHRoZSBzb3J0YWJsZQoJCQkJdGhpcy5pbnN0YW5jZS5fbW91c2VTdG9wKGV2ZW50KTsKCgkJCQl0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyID0gdGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXI7CgoJCQkJLy9JZiB0aGUgaGVscGVyIGhhcyBiZWVuIHRoZSBvcmlnaW5hbCBpdGVtLCByZXN0b3JlIHByb3BlcnRpZXMgaW4gdGhlIHNvcnRhYmxlCgkJCQlpZiAoaW5zdC5vcHRpb25zLmhlbHBlciA9PT0gIm9yaWdpbmFsIikgewoJCQkJCXRoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0uY3NzKHsgdG9wOiAiYXV0byIsIGxlZnQ6ICJhdXRvIiB9KTsKCQkJCX0KCgkJCX0gZWxzZSB7CgkJCQl0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWwgPSBmYWxzZTsgLy9SZW1vdmUgdGhlIGhlbHBlciBpbiB0aGUgc29ydGFibGUgaW5zdGFuY2UKCQkJCXRoaXMuaW5zdGFuY2UuX3RyaWdnZXIoImRlYWN0aXZhdGUiLCBldmVudCwgdWlTb3J0YWJsZSk7CgkJCX0KCgkJfSk7CgoJfSwKCWRyYWc6IGZ1bmN0aW9uKCBldmVudCwgdWksIGluc3QgKSB7CgoJCXZhciB0aGF0ID0gdGhpczsKCgkJJC5lYWNoKGluc3Quc29ydGFibGVzLCBmdW5jdGlvbigpIHsKCgkJCXZhciBpbm5lcm1vc3RJbnRlcnNlY3RpbmcgPSBmYWxzZSwKCQkJCXRoaXNTb3J0YWJsZSA9IHRoaXM7CgoJCQkvL0NvcHkgb3ZlciBzb21lIHZhcmlhYmxlcyB0byBhbGxvdyBjYWxsaW5nIHRoZSBzb3J0YWJsZSdzIG5hdGl2ZSBfaW50ZXJzZWN0c1dpdGgKCQkJdGhpcy5pbnN0YW5jZS5wb3NpdGlvbkFicyA9IGluc3QucG9zaXRpb25BYnM7CgkJCXRoaXMuaW5zdGFuY2UuaGVscGVyUHJvcG9ydGlvbnMgPSBpbnN0LmhlbHBlclByb3BvcnRpb25zOwoJCQl0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljayA9IGluc3Qub2Zmc2V0LmNsaWNrOwoKCQkJaWYgKHRoaXMuaW5zdGFuY2UuX2ludGVyc2VjdHNXaXRoKHRoaXMuaW5zdGFuY2UuY29udGFpbmVyQ2FjaGUpKSB7CgkJCQlpbm5lcm1vc3RJbnRlcnNlY3RpbmcgPSB0cnVlOwoJCQkJJC5lYWNoKGluc3Quc29ydGFibGVzLCBmdW5jdGlvbigpIHsKCQkJCQl0aGlzLmluc3RhbmNlLnBvc2l0aW9uQWJzID0gaW5zdC5wb3NpdGlvbkFiczsKCQkJCQl0aGlzLmluc3RhbmNlLmhlbHBlclByb3BvcnRpb25zID0gaW5zdC5oZWxwZXJQcm9wb3J0aW9uczsKCQkJCQl0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljayA9IGluc3Qub2Zmc2V0LmNsaWNrOwoJCQkJCWlmICh0aGlzICE9PSB0aGlzU29ydGFibGUgJiYKCQkJCQkJdGhpcy5pbnN0YW5jZS5faW50ZXJzZWN0c1dpdGgodGhpcy5pbnN0YW5jZS5jb250YWluZXJDYWNoZSkgJiYKCQkJCQkJJC5jb250YWlucyh0aGlzU29ydGFibGUuaW5zdGFuY2UuZWxlbWVudFswXSwgdGhpcy5pbnN0YW5jZS5lbGVtZW50WzBdKQoJCQkJCSkgewoJCQkJCQlpbm5lcm1vc3RJbnRlcnNlY3RpbmcgPSBmYWxzZTsKCQkJCQl9CgkJCQkJcmV0dXJuIGlubmVybW9zdEludGVyc2VjdGluZzsKCQkJCX0pOwoJCQl9CgoJCQlpZiAoaW5uZXJtb3N0SW50ZXJzZWN0aW5nKSB7CgkJCQkvL0lmIGl0IGludGVyc2VjdHMsIHdlIHVzZSBhIGxpdHRsZSBpc092ZXIgdmFyaWFibGUgYW5kIHNldCBpdCBvbmNlLCBzbyBvdXIgbW92ZS1pbiBzdHVmZiBnZXRzIGZpcmVkIG9ubHkgb25jZQoJCQkJaWYgKCF0aGlzLmluc3RhbmNlLmlzT3ZlcikgewoKCQkJCQl0aGlzLmluc3RhbmNlLmlzT3ZlciA9IDE7CgkJCQkJLy9Ob3cgd2UgZmFrZSB0aGUgc3RhcnQgb2YgZHJhZ2dpbmcgZm9yIHRoZSBzb3J0YWJsZSBpbnN0YW5jZSwKCQkJCQkvL2J5IGNsb25pbmcgdGhlIGxpc3QgZ3JvdXAgaXRlbSwgYXBwZW5kaW5nIGl0IHRvIHRoZSBzb3J0YWJsZSBhbmQgdXNpbmcgaXQgYXMgaW5zdC5jdXJyZW50SXRlbQoJCQkJCS8vV2UgY2FuIHRoZW4gZmlyZSB0aGUgc3RhcnQgZXZlbnQgb2YgdGhlIHNvcnRhYmxlIHdpdGggb3VyIHBhc3NlZCBicm93c2VyIGV2ZW50LCBhbmQgb3VyIG93biBoZWxwZXIgKHNvIGl0IGRvZXNuJ3QgY3JlYXRlIGEgbmV3IG9uZSkKCQkJCQl0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtID0gJCh0aGF0KS5jbG9uZSgpLnJlbW92ZUF0dHIoImlkIikuYXBwZW5kVG8odGhpcy5pbnN0YW5jZS5lbGVtZW50KS5kYXRhKCJ1aS1zb3J0YWJsZS1pdGVtIiwgdHJ1ZSk7CgkJCQkJdGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXIgPSB0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyOyAvL1N0b3JlIGhlbHBlciBvcHRpb24gdG8gbGF0ZXIgcmVzdG9yZSBpdAoJCQkJCXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oZWxwZXIgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHVpLmhlbHBlclswXTsgfTsKCgkJCQkJZXZlbnQudGFyZ2V0ID0gdGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbVswXTsKCQkJCQl0aGlzLmluc3RhbmNlLl9tb3VzZUNhcHR1cmUoZXZlbnQsIHRydWUpOwoJCQkJCXRoaXMuaW5zdGFuY2UuX21vdXNlU3RhcnQoZXZlbnQsIHRydWUsIHRydWUpOwoKCQkJCQkvL0JlY2F1c2UgdGhlIGJyb3dzZXIgZXZlbnQgaXMgd2F5IG9mZiB0aGUgbmV3IGFwcGVuZGVkIHBvcnRsZXQsIHdlIG1vZGlmeSBhIGNvdXBsZSBvZiB2YXJpYWJsZXMgdG8gcmVmbGVjdCB0aGUgY2hhbmdlcwoJCQkJCXRoaXMuaW5zdGFuY2Uub2Zmc2V0LmNsaWNrLnRvcCA9IGluc3Qub2Zmc2V0LmNsaWNrLnRvcDsKCQkJCQl0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljay5sZWZ0ID0gaW5zdC5vZmZzZXQuY2xpY2subGVmdDsKCQkJCQl0aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQubGVmdCAtPSBpbnN0Lm9mZnNldC5wYXJlbnQubGVmdCAtIHRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC5sZWZ0OwoJCQkJCXRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3AgLT0gaW5zdC5vZmZzZXQucGFyZW50LnRvcCAtIHRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3A7CgoJCQkJCWluc3QuX3RyaWdnZXIoInRvU29ydGFibGUiLCBldmVudCk7CgkJCQkJaW5zdC5kcm9wcGVkID0gdGhpcy5pbnN0YW5jZS5lbGVtZW50OyAvL2RyYWdnYWJsZSByZXZlcnQgbmVlZHMgdGhhdAoJCQkJCS8vaGFjayBzbyByZWNlaXZlL3VwZGF0ZSBjYWxsYmFja3Mgd29yayAobW9zdGx5KQoJCQkJCWluc3QuY3VycmVudEl0ZW0gPSBpbnN0LmVsZW1lbnQ7CgkJCQkJdGhpcy5pbnN0YW5jZS5mcm9tT3V0c2lkZSA9IGluc3Q7CgoJCQkJfQoKCQkJCS8vUHJvdmlkZWQgd2UgZGlkIGFsbCB0aGUgcHJldmlvdXMgc3RlcHMsIHdlIGNhbiBmaXJlIHRoZSBkcmFnIGV2ZW50IG9mIHRoZSBzb3J0YWJsZSBvbiBldmVyeSBkcmFnZ2FibGUgZHJhZywgd2hlbiBpdCBpbnRlcnNlY3RzIHdpdGggdGhlIHNvcnRhYmxlCgkJCQlpZiAodGhpcy5pbnN0YW5jZS5jdXJyZW50SXRlbSkgewoJCQkJCXRoaXMuaW5zdGFuY2UuX21vdXNlRHJhZyhldmVudCk7CgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCS8vSWYgaXQgZG9lc24ndCBpbnRlcnNlY3Qgd2l0aCB0aGUgc29ydGFibGUsIGFuZCBpdCBpbnRlcnNlY3RlZCBiZWZvcmUsCgkJCQkvL3dlIGZha2UgdGhlIGRyYWcgc3RvcCBvZiB0aGUgc29ydGFibGUsIGJ1dCBtYWtlIHN1cmUgaXQgZG9lc24ndCByZW1vdmUgdGhlIGhlbHBlciBieSB1c2luZyBjYW5jZWxIZWxwZXJSZW1vdmFsCgkJCQlpZiAodGhpcy5pbnN0YW5jZS5pc092ZXIpIHsKCgkJCQkJdGhpcy5pbnN0YW5jZS5pc092ZXIgPSAwOwoJCQkJCXRoaXMuaW5zdGFuY2UuY2FuY2VsSGVscGVyUmVtb3ZhbCA9IHRydWU7CgoJCQkJCS8vUHJldmVudCByZXZlcnRpbmcgb24gdGhpcyBmb3JjZWQgc3RvcAoJCQkJCXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5yZXZlcnQgPSBmYWxzZTsKCgkJCQkJLy8gVGhlIG91dCBldmVudCBuZWVkcyB0byBiZSB0cmlnZ2VyZWQgaW5kZXBlbmRlbnRseQoJCQkJCXRoaXMuaW5zdGFuY2UuX3RyaWdnZXIoIm91dCIsIGV2ZW50LCB0aGlzLmluc3RhbmNlLl91aUhhc2godGhpcy5pbnN0YW5jZSkpOwoKCQkJCQl0aGlzLmluc3RhbmNlLl9tb3VzZVN0b3AoZXZlbnQsIHRydWUpOwoJCQkJCXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oZWxwZXIgPSB0aGlzLmluc3RhbmNlLm9wdGlvbnMuX2hlbHBlcjsKCgkJCQkJLy9Ob3cgd2UgcmVtb3ZlIG91ciBjdXJyZW50SXRlbSwgdGhlIGxpc3QgZ3JvdXAgY2xvbmUgYWdhaW4sIGFuZCB0aGUgcGxhY2Vob2xkZXIsIGFuZCBhbmltYXRlIHRoZSBoZWxwZXIgYmFjayB0byBpdCdzIG9yaWdpbmFsIHNpemUKCQkJCQl0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtLnJlbW92ZSgpOwoJCQkJCWlmICh0aGlzLmluc3RhbmNlLnBsYWNlaG9sZGVyKSB7CgkJCQkJCXRoaXMuaW5zdGFuY2UucGxhY2Vob2xkZXIucmVtb3ZlKCk7CgkJCQkJfQoKCQkJCQlpbnN0Ll90cmlnZ2VyKCJmcm9tU29ydGFibGUiLCBldmVudCk7CgkJCQkJaW5zdC5kcm9wcGVkID0gZmFsc2U7IC8vZHJhZ2dhYmxlIHJldmVydCBuZWVkcyB0aGF0CgkJCQl9CgoJCQl9CgoJCX0pOwoKCX0KfSk7CgokLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsICJjdXJzb3IiLCB7CglzdGFydDogZnVuY3Rpb24oIGV2ZW50LCB1aSwgaW5zdGFuY2UgKSB7CgkJdmFyIHQgPSAkKCAiYm9keSIgKSwKCQkJbyA9IGluc3RhbmNlLm9wdGlvbnM7CgoJCWlmICh0LmNzcygiY3Vyc29yIikpIHsKCQkJby5fY3Vyc29yID0gdC5jc3MoImN1cnNvciIpOwoJCX0KCQl0LmNzcygiY3Vyc29yIiwgby5jdXJzb3IpOwoJfSwKCXN0b3A6IGZ1bmN0aW9uKCBldmVudCwgdWksIGluc3RhbmNlICkgewoJCXZhciBvID0gaW5zdGFuY2Uub3B0aW9uczsKCQlpZiAoby5fY3Vyc29yKSB7CgkJCSQoImJvZHkiKS5jc3MoImN1cnNvciIsIG8uX2N1cnNvcik7CgkJfQoJfQp9KTsKCiQudWkucGx1Z2luLmFkZCgiZHJhZ2dhYmxlIiwgIm9wYWNpdHkiLCB7CglzdGFydDogZnVuY3Rpb24oIGV2ZW50LCB1aSwgaW5zdGFuY2UgKSB7CgkJdmFyIHQgPSAkKCB1aS5oZWxwZXIgKSwKCQkJbyA9IGluc3RhbmNlLm9wdGlvbnM7CgkJaWYgKHQuY3NzKCJvcGFjaXR5IikpIHsKCQkJby5fb3BhY2l0eSA9IHQuY3NzKCJvcGFjaXR5Iik7CgkJfQoJCXQuY3NzKCJvcGFjaXR5Iiwgby5vcGFjaXR5KTsKCX0sCglzdG9wOiBmdW5jdGlvbiggZXZlbnQsIHVpLCBpbnN0YW5jZSApIHsKCQl2YXIgbyA9IGluc3RhbmNlLm9wdGlvbnM7CgkJaWYgKG8uX29wYWNpdHkpIHsKCQkJJCh1aS5oZWxwZXIpLmNzcygib3BhY2l0eSIsIG8uX29wYWNpdHkpOwoJCX0KCX0KfSk7CgokLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsICJzY3JvbGwiLCB7CglzdGFydDogZnVuY3Rpb24oIGV2ZW50LCB1aSwgaSApIHsKCQlpZiAoICFpLnNjcm9sbFBhcmVudE5vdEhpZGRlbiApIHsKCQkJaS5zY3JvbGxQYXJlbnROb3RIaWRkZW4gPSBpLmhlbHBlci5zY3JvbGxQYXJlbnQoIGZhbHNlICk7CgkJfQoKCQlpZiAoIGkuc2Nyb2xsUGFyZW50Tm90SGlkZGVuWyAwIF0gIT09IGkuZG9jdW1lbnRbIDAgXSAmJiBpLnNjcm9sbFBhcmVudE5vdEhpZGRlblsgMCBdLnRhZ05hbWUgIT09ICJIVE1MIiApIHsKCQkJaS5vdmVyZmxvd09mZnNldCA9IGkuc2Nyb2xsUGFyZW50Tm90SGlkZGVuLm9mZnNldCgpOwoJCX0KCX0sCglkcmFnOiBmdW5jdGlvbiggZXZlbnQsIHVpLCBpICApIHsKCgkJdmFyIG8gPSBpLm9wdGlvbnMsCgkJCXNjcm9sbGVkID0gZmFsc2UsCgkJCXNjcm9sbFBhcmVudCA9IGkuc2Nyb2xsUGFyZW50Tm90SGlkZGVuWyAwIF0sCgkJCWRvY3VtZW50ID0gaS5kb2N1bWVudFsgMCBdOwoKCQlpZiAoIHNjcm9sbFBhcmVudCAhPT0gZG9jdW1lbnQgJiYgc2Nyb2xsUGFyZW50LnRhZ05hbWUgIT09ICJIVE1MIiApIHsKCQkJaWYgKCAhby5heGlzIHx8IG8uYXhpcyAhPT0gIngiICkgewoJCQkJaWYgKCAoIGkub3ZlcmZsb3dPZmZzZXQudG9wICsgc2Nyb2xsUGFyZW50Lm9mZnNldEhlaWdodCApIC0gZXZlbnQucGFnZVkgPCBvLnNjcm9sbFNlbnNpdGl2aXR5ICkgewoJCQkJCXNjcm9sbFBhcmVudC5zY3JvbGxUb3AgPSBzY3JvbGxlZCA9IHNjcm9sbFBhcmVudC5zY3JvbGxUb3AgKyBvLnNjcm9sbFNwZWVkOwoJCQkJfSBlbHNlIGlmICggZXZlbnQucGFnZVkgLSBpLm92ZXJmbG93T2Zmc2V0LnRvcCA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkgKSB7CgkJCQkJc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCA9IHNjcm9sbGVkID0gc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCAtIG8uc2Nyb2xsU3BlZWQ7CgkJCQl9CgkJCX0KCgkJCWlmICggIW8uYXhpcyB8fCBvLmF4aXMgIT09ICJ5IiApIHsKCQkJCWlmICggKCBpLm92ZXJmbG93T2Zmc2V0LmxlZnQgKyBzY3JvbGxQYXJlbnQub2Zmc2V0V2lkdGggKSAtIGV2ZW50LnBhZ2VYIDwgby5zY3JvbGxTZW5zaXRpdml0eSApIHsKCQkJCQlzY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCA9IHNjcm9sbGVkID0gc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQgKyBvLnNjcm9sbFNwZWVkOwoJCQkJfSBlbHNlIGlmICggZXZlbnQucGFnZVggLSBpLm92ZXJmbG93T2Zmc2V0LmxlZnQgPCBvLnNjcm9sbFNlbnNpdGl2aXR5ICkgewoJCQkJCXNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0ID0gc2Nyb2xsZWQgPSBzY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCAtIG8uc2Nyb2xsU3BlZWQ7CgkJCQl9CgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICghby5heGlzIHx8IG8uYXhpcyAhPT0gIngiKSB7CgkJCQlpZiAoZXZlbnQucGFnZVkgLSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSAtIG8uc2Nyb2xsU3BlZWQpOwoJCQkJfSBlbHNlIGlmICgkKHdpbmRvdykuaGVpZ2h0KCkgLSAoZXZlbnQucGFnZVkgLSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSkgPCBvLnNjcm9sbFNlbnNpdGl2aXR5KSB7CgkJCQkJc2Nyb2xsZWQgPSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkgKyBvLnNjcm9sbFNwZWVkKTsKCQkJCX0KCQkJfQoKCQkJaWYgKCFvLmF4aXMgfHwgby5heGlzICE9PSAieSIpIHsKCQkJCWlmIChldmVudC5wYWdlWCAtICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpIC0gby5zY3JvbGxTcGVlZCk7CgkJCQl9IGVsc2UgaWYgKCQod2luZG93KS53aWR0aCgpIC0gKGV2ZW50LnBhZ2VYIC0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpICsgby5zY3JvbGxTcGVlZCk7CgkJCQl9CgkJCX0KCgkJfQoKCQlpZiAoc2Nyb2xsZWQgIT09IGZhbHNlICYmICQudWkuZGRtYW5hZ2VyICYmICFvLmRyb3BCZWhhdmlvdXIpIHsKCQkJJC51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoaSwgZXZlbnQpOwoJCX0KCgl9Cn0pOwoKJC51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCAic25hcCIsIHsKCXN0YXJ0OiBmdW5jdGlvbiggZXZlbnQsIHVpLCBpICkgewoKCQl2YXIgbyA9IGkub3B0aW9uczsKCgkJaS5zbmFwRWxlbWVudHMgPSBbXTsKCgkJJChvLnNuYXAuY29uc3RydWN0b3IgIT09IFN0cmluZyA/ICggby5zbmFwLml0ZW1zIHx8ICI6ZGF0YSh1aS1kcmFnZ2FibGUpIiApIDogby5zbmFwKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgJHQgPSAkKHRoaXMpLAoJCQkJJG8gPSAkdC5vZmZzZXQoKTsKCQkJaWYgKHRoaXMgIT09IGkuZWxlbWVudFswXSkgewoJCQkJaS5zbmFwRWxlbWVudHMucHVzaCh7CgkJCQkJaXRlbTogdGhpcywKCQkJCQl3aWR0aDogJHQub3V0ZXJXaWR0aCgpLCBoZWlnaHQ6ICR0Lm91dGVySGVpZ2h0KCksCgkJCQkJdG9wOiAkby50b3AsIGxlZnQ6ICRvLmxlZnQKCQkJCX0pOwoJCQl9CgkJfSk7CgoJfSwKCWRyYWc6IGZ1bmN0aW9uKCBldmVudCwgdWksIGluc3QgKSB7CgoJCXZhciB0cywgYnMsIGxzLCBycywgbCwgciwgdCwgYiwgaSwgZmlyc3QsCgkJCW8gPSBpbnN0Lm9wdGlvbnMsCgkJCWQgPSBvLnNuYXBUb2xlcmFuY2UsCgkJCXgxID0gdWkub2Zmc2V0LmxlZnQsIHgyID0geDEgKyBpbnN0LmhlbHBlclByb3BvcnRpb25zLndpZHRoLAoJCQl5MSA9IHVpLm9mZnNldC50b3AsIHkyID0geTEgKyBpbnN0LmhlbHBlclByb3BvcnRpb25zLmhlaWdodDsKCgkJZm9yIChpID0gaW5zdC5zbmFwRWxlbWVudHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pewoKCQkJbCA9IGluc3Quc25hcEVsZW1lbnRzW2ldLmxlZnQ7CgkJCXIgPSBsICsgaW5zdC5zbmFwRWxlbWVudHNbaV0ud2lkdGg7CgkJCXQgPSBpbnN0LnNuYXBFbGVtZW50c1tpXS50b3A7CgkJCWIgPSB0ICsgaW5zdC5zbmFwRWxlbWVudHNbaV0uaGVpZ2h0OwoKCQkJaWYgKCB4MiA8IGwgLSBkIHx8IHgxID4gciArIGQgfHwgeTIgPCB0IC0gZCB8fCB5MSA+IGIgKyBkIHx8ICEkLmNvbnRhaW5zKCBpbnN0LnNuYXBFbGVtZW50c1sgaSBdLml0ZW0ub3duZXJEb2N1bWVudCwgaW5zdC5zbmFwRWxlbWVudHNbIGkgXS5pdGVtICkgKSB7CgkJCQlpZiAoaW5zdC5zbmFwRWxlbWVudHNbaV0uc25hcHBpbmcpIHsKCQkJCQkoaW5zdC5vcHRpb25zLnNuYXAucmVsZWFzZSAmJiBpbnN0Lm9wdGlvbnMuc25hcC5yZWxlYXNlLmNhbGwoaW5zdC5lbGVtZW50LCBldmVudCwgJC5leHRlbmQoaW5zdC5fdWlIYXNoKCksIHsgc25hcEl0ZW06IGluc3Quc25hcEVsZW1lbnRzW2ldLml0ZW0gfSkpKTsKCQkJCX0KCQkJCWluc3Quc25hcEVsZW1lbnRzW2ldLnNuYXBwaW5nID0gZmFsc2U7CgkJCQljb250aW51ZTsKCQkJfQoKCQkJaWYgKG8uc25hcE1vZGUgIT09ICJpbm5lciIpIHsKCQkJCXRzID0gTWF0aC5hYnModCAtIHkyKSA8PSBkOwoJCQkJYnMgPSBNYXRoLmFicyhiIC0geTEpIDw9IGQ7CgkJCQlscyA9IE1hdGguYWJzKGwgLSB4MikgPD0gZDsKCQkJCXJzID0gTWF0aC5hYnMociAtIHgxKSA8PSBkOwoJCQkJaWYgKHRzKSB7CgkJCQkJdWkucG9zaXRpb24udG9wID0gaW5zdC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgeyB0b3A6IHQgLSBpbnN0LmhlbHBlclByb3BvcnRpb25zLmhlaWdodCwgbGVmdDogMCB9KS50b3AgLSBpbnN0Lm1hcmdpbnMudG9wOwoJCQkJfQoJCQkJaWYgKGJzKSB7CgkJCQkJdWkucG9zaXRpb24udG9wID0gaW5zdC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgeyB0b3A6IGIsIGxlZnQ6IDAgfSkudG9wIC0gaW5zdC5tYXJnaW5zLnRvcDsKCQkJCX0KCQkJCWlmIChscykgewoJCQkJCXVpLnBvc2l0aW9uLmxlZnQgPSBpbnN0Ll9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7IHRvcDogMCwgbGVmdDogbCAtIGluc3QuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggfSkubGVmdCAtIGluc3QubWFyZ2lucy5sZWZ0OwoJCQkJfQoJCQkJaWYgKHJzKSB7CgkJCQkJdWkucG9zaXRpb24ubGVmdCA9IGluc3QuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIsIHsgdG9wOiAwLCBsZWZ0OiByIH0pLmxlZnQgLSBpbnN0Lm1hcmdpbnMubGVmdDsKCQkJCX0KCQkJfQoKCQkJZmlyc3QgPSAodHMgfHwgYnMgfHwgbHMgfHwgcnMpOwoKCQkJaWYgKG8uc25hcE1vZGUgIT09ICJvdXRlciIpIHsKCQkJCXRzID0gTWF0aC5hYnModCAtIHkxKSA8PSBkOwoJCQkJYnMgPSBNYXRoLmFicyhiIC0geTIpIDw9IGQ7CgkJCQlscyA9IE1hdGguYWJzKGwgLSB4MSkgPD0gZDsKCQkJCXJzID0gTWF0aC5hYnMociAtIHgyKSA8PSBkOwoJCQkJaWYgKHRzKSB7CgkJCQkJdWkucG9zaXRpb24udG9wID0gaW5zdC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgeyB0b3A6IHQsIGxlZnQ6IDAgfSkudG9wIC0gaW5zdC5tYXJnaW5zLnRvcDsKCQkJCX0KCQkJCWlmIChicykgewoJCQkJCXVpLnBvc2l0aW9uLnRvcCA9IGluc3QuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIsIHsgdG9wOiBiIC0gaW5zdC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsIGxlZnQ6IDAgfSkudG9wIC0gaW5zdC5tYXJnaW5zLnRvcDsKCQkJCX0KCQkJCWlmIChscykgewoJCQkJCXVpLnBvc2l0aW9uLmxlZnQgPSBpbnN0Ll9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLCB7IHRvcDogMCwgbGVmdDogbCB9KS5sZWZ0IC0gaW5zdC5tYXJnaW5zLmxlZnQ7CgkJCQl9CgkJCQlpZiAocnMpIHsKCQkJCQl1aS5wb3NpdGlvbi5sZWZ0ID0gaW5zdC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIiwgeyB0b3A6IDAsIGxlZnQ6IHIgLSBpbnN0LmhlbHBlclByb3BvcnRpb25zLndpZHRoIH0pLmxlZnQgLSBpbnN0Lm1hcmdpbnMubGVmdDsKCQkJCX0KCQkJfQoKCQkJaWYgKCFpbnN0LnNuYXBFbGVtZW50c1tpXS5zbmFwcGluZyAmJiAodHMgfHwgYnMgfHwgbHMgfHwgcnMgfHwgZmlyc3QpKSB7CgkJCQkoaW5zdC5vcHRpb25zLnNuYXAuc25hcCAmJiBpbnN0Lm9wdGlvbnMuc25hcC5zbmFwLmNhbGwoaW5zdC5lbGVtZW50LCBldmVudCwgJC5leHRlbmQoaW5zdC5fdWlIYXNoKCksIHsgc25hcEl0ZW06IGluc3Quc25hcEVsZW1lbnRzW2ldLml0ZW0gfSkpKTsKCQkJfQoJCQlpbnN0LnNuYXBFbGVtZW50c1tpXS5zbmFwcGluZyA9ICh0cyB8fCBicyB8fCBscyB8fCBycyB8fCBmaXJzdCk7CgoJCX0KCgl9Cn0pOwoKJC51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCAic3RhY2siLCB7CglzdGFydDogZnVuY3Rpb24oIGV2ZW50LCB1aSwgaW5zdGFuY2UgKSB7CgkJdmFyIG1pbiwKCQkJbyA9IGluc3RhbmNlLm9wdGlvbnMsCgkJCWdyb3VwID0gJC5tYWtlQXJyYXkoJChvLnN0YWNrKSkuc29ydChmdW5jdGlvbihhLCBiKSB7CgkJCQlyZXR1cm4gKHBhcnNlSW50KCQoYSkuY3NzKCJ6SW5kZXgiKSwgMTApIHx8IDApIC0gKHBhcnNlSW50KCQoYikuY3NzKCJ6SW5kZXgiKSwgMTApIHx8IDApOwoJCQl9KTsKCgkJaWYgKCFncm91cC5sZW5ndGgpIHsgcmV0dXJuOyB9CgoJCW1pbiA9IHBhcnNlSW50KCQoZ3JvdXBbMF0pLmNzcygiekluZGV4IiksIDEwKSB8fCAwOwoJCSQoZ3JvdXApLmVhY2goZnVuY3Rpb24oaSkgewoJCQkkKHRoaXMpLmNzcygiekluZGV4IiwgbWluICsgaSk7CgkJfSk7CgkJdGhpcy5jc3MoInpJbmRleCIsIChtaW4gKyBncm91cC5sZW5ndGgpKTsKCX0KfSk7CgokLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsICJ6SW5kZXgiLCB7CglzdGFydDogZnVuY3Rpb24oIGV2ZW50LCB1aSwgaW5zdGFuY2UgKSB7CgkJdmFyIHQgPSAkKCB1aS5oZWxwZXIgKSwKCQkJbyA9IGluc3RhbmNlLm9wdGlvbnM7CgoJCWlmICh0LmNzcygiekluZGV4IikpIHsKCQkJby5fekluZGV4ID0gdC5jc3MoInpJbmRleCIpOwoJCX0KCQl0LmNzcygiekluZGV4Iiwgby56SW5kZXgpOwoJfSwKCXN0b3A6IGZ1bmN0aW9uKCBldmVudCwgdWksIGluc3RhbmNlICkgewoJCXZhciBvID0gaW5zdGFuY2Uub3B0aW9uczsKCgkJaWYgKG8uX3pJbmRleCkgewoJCQkkKHVpLmhlbHBlcikuY3NzKCJ6SW5kZXgiLCBvLl96SW5kZXgpOwoJCX0KCX0KfSk7Cgp2YXIgZHJhZ2dhYmxlID0gJC51aS5kcmFnZ2FibGU7CgoKLyohCiAqIGpRdWVyeSBVSSBSZXNpemFibGUgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vcmVzaXphYmxlLwogKi8KCgokLndpZGdldCgidWkucmVzaXphYmxlIiwgJC51aS5tb3VzZSwgewoJdmVyc2lvbjogIjEuMTEuMSIsCgl3aWRnZXRFdmVudFByZWZpeDogInJlc2l6ZSIsCglvcHRpb25zOiB7CgkJYWxzb1Jlc2l6ZTogZmFsc2UsCgkJYW5pbWF0ZTogZmFsc2UsCgkJYW5pbWF0ZUR1cmF0aW9uOiAic2xvdyIsCgkJYW5pbWF0ZUVhc2luZzogInN3aW5nIiwKCQlhc3BlY3RSYXRpbzogZmFsc2UsCgkJYXV0b0hpZGU6IGZhbHNlLAoJCWNvbnRhaW5tZW50OiBmYWxzZSwKCQlnaG9zdDogZmFsc2UsCgkJZ3JpZDogZmFsc2UsCgkJaGFuZGxlczogImUscyxzZSIsCgkJaGVscGVyOiBmYWxzZSwKCQltYXhIZWlnaHQ6IG51bGwsCgkJbWF4V2lkdGg6IG51bGwsCgkJbWluSGVpZ2h0OiAxMCwKCQltaW5XaWR0aDogMTAsCgkJLy8gU2VlICM3OTYwCgkJekluZGV4OiA5MCwKCgkJLy8gY2FsbGJhY2tzCgkJcmVzaXplOiBudWxsLAoJCXN0YXJ0OiBudWxsLAoJCXN0b3A6IG51bGwKCX0sCgoJX251bTogZnVuY3Rpb24oIHZhbHVlICkgewoJCXJldHVybiBwYXJzZUludCggdmFsdWUsIDEwICkgfHwgMDsKCX0sCgoJX2lzTnVtYmVyOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJcmV0dXJuICFpc05hTiggcGFyc2VJbnQoIHZhbHVlLCAxMCApICk7Cgl9LAoKCV9oYXNTY3JvbGw6IGZ1bmN0aW9uKCBlbCwgYSApIHsKCgkJaWYgKCAkKCBlbCApLmNzcyggIm92ZXJmbG93IiApID09PSAiaGlkZGVuIikgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQl2YXIgc2Nyb2xsID0gKCBhICYmIGEgPT09ICJsZWZ0IiApID8gInNjcm9sbExlZnQiIDogInNjcm9sbFRvcCIsCgkJCWhhcyA9IGZhbHNlOwoKCQlpZiAoIGVsWyBzY3JvbGwgXSA+IDAgKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCgkJLy8gVE9ETzogZGV0ZXJtaW5lIHdoaWNoIGNhc2VzIGFjdHVhbGx5IGNhdXNlIHRoaXMgdG8gaGFwcGVuCgkJLy8gaWYgdGhlIGVsZW1lbnQgZG9lc24ndCBoYXZlIHRoZSBzY3JvbGwgc2V0LCBzZWUgaWYgaXQncyBwb3NzaWJsZSB0bwoJCS8vIHNldCB0aGUgc2Nyb2xsCgkJZWxbIHNjcm9sbCBdID0gMTsKCQloYXMgPSAoIGVsWyBzY3JvbGwgXSA+IDAgKTsKCQllbFsgc2Nyb2xsIF0gPSAwOwoJCXJldHVybiBoYXM7Cgl9LAoKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoKCQl2YXIgbiwgaSwgaGFuZGxlLCBheGlzLCBobmFtZSwKCQkJdGhhdCA9IHRoaXMsCgkJCW8gPSB0aGlzLm9wdGlvbnM7CgkJdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1yZXNpemFibGUiKTsKCgkJJC5leHRlbmQodGhpcywgewoJCQlfYXNwZWN0UmF0aW86ICEhKG8uYXNwZWN0UmF0aW8pLAoJCQlhc3BlY3RSYXRpbzogby5hc3BlY3RSYXRpbywKCQkJb3JpZ2luYWxFbGVtZW50OiB0aGlzLmVsZW1lbnQsCgkJCV9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzOiBbXSwKCQkJX2hlbHBlcjogby5oZWxwZXIgfHwgby5naG9zdCB8fCBvLmFuaW1hdGUgPyBvLmhlbHBlciB8fCAidWktcmVzaXphYmxlLWhlbHBlciIgOiBudWxsCgkJfSk7CgoJCS8vIFdyYXAgdGhlIGVsZW1lbnQgaWYgaXQgY2Fubm90IGhvbGQgY2hpbGQgbm9kZXMKCQlpZiAodGhpcy5lbGVtZW50WzBdLm5vZGVOYW1lLm1hdGNoKC9jYW52YXN8dGV4dGFyZWF8aW5wdXR8c2VsZWN0fGJ1dHRvbnxpbWcvaSkpIHsKCgkJCXRoaXMuZWxlbWVudC53cmFwKAoJCQkJJCgiPGRpdiBjbGFzcz0ndWktd3JhcHBlcicgc3R5bGU9J292ZXJmbG93OiBoaWRkZW47Jz48L2Rpdj4iKS5jc3MoewoJCQkJCXBvc2l0aW9uOiB0aGlzLmVsZW1lbnQuY3NzKCJwb3NpdGlvbiIpLAoJCQkJCXdpZHRoOiB0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpLAoJCQkJCWhlaWdodDogdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCksCgkJCQkJdG9wOiB0aGlzLmVsZW1lbnQuY3NzKCJ0b3AiKSwKCQkJCQlsZWZ0OiB0aGlzLmVsZW1lbnQuY3NzKCJsZWZ0IikKCQkJCX0pCgkJCSk7CgoJCQl0aGlzLmVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucGFyZW50KCkuZGF0YSgKCQkJCSJ1aS1yZXNpemFibGUiLCB0aGlzLmVsZW1lbnQucmVzaXphYmxlKCAiaW5zdGFuY2UiICkKCQkJKTsKCgkJCXRoaXMuZWxlbWVudElzV3JhcHBlciA9IHRydWU7CgoJCQl0aGlzLmVsZW1lbnQuY3NzKHsKCQkJCW1hcmdpbkxlZnQ6IHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygibWFyZ2luTGVmdCIpLAoJCQkJbWFyZ2luVG9wOiB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpblRvcCIpLAoJCQkJbWFyZ2luUmlnaHQ6IHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygibWFyZ2luUmlnaHQiKSwKCQkJCW1hcmdpbkJvdHRvbTogdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJtYXJnaW5Cb3R0b20iKQoJCQl9KTsKCQkJdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKHsKCQkJCW1hcmdpbkxlZnQ6IDAsCgkJCQltYXJnaW5Ub3A6IDAsCgkJCQltYXJnaW5SaWdodDogMCwKCQkJCW1hcmdpbkJvdHRvbTogMAoJCQl9KTsKCQkJLy8gc3VwcG9ydDogU2FmYXJpCgkJCS8vIFByZXZlbnQgU2FmYXJpIHRleHRhcmVhIHJlc2l6ZQoJCQl0aGlzLm9yaWdpbmFsUmVzaXplU3R5bGUgPSB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoInJlc2l6ZSIpOwoJCQl0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoInJlc2l6ZSIsICJub25lIik7CgoJCQl0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLnB1c2goIHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7CgkJCQlwb3NpdGlvbjogInN0YXRpYyIsCgkJCQl6b29tOiAxLAoJCQkJZGlzcGxheTogImJsb2NrIgoJCQl9KSApOwoKCQkJLy8gc3VwcG9ydDogSUU5CgkJCS8vIGF2b2lkIElFIGp1bXAgKGhhcmQgc2V0IHRoZSBtYXJnaW4pCgkJCXRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7IG1hcmdpbjogdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJtYXJnaW4iKSB9KTsKCgkJCXRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCk7CgkJfQoKCQl0aGlzLmhhbmRsZXMgPSBvLmhhbmRsZXMgfHwKCQkJKCAhJCgiLnVpLXJlc2l6YWJsZS1oYW5kbGUiLCB0aGlzLmVsZW1lbnQpLmxlbmd0aCA/CgkJCQkiZSxzLHNlIiA6IHsKCQkJCQluOiAiLnVpLXJlc2l6YWJsZS1uIiwKCQkJCQllOiAiLnVpLXJlc2l6YWJsZS1lIiwKCQkJCQlzOiAiLnVpLXJlc2l6YWJsZS1zIiwKCQkJCQl3OiAiLnVpLXJlc2l6YWJsZS13IiwKCQkJCQlzZTogIi51aS1yZXNpemFibGUtc2UiLAoJCQkJCXN3OiAiLnVpLXJlc2l6YWJsZS1zdyIsCgkJCQkJbmU6ICIudWktcmVzaXphYmxlLW5lIiwKCQkJCQludzogIi51aS1yZXNpemFibGUtbnciCgkJCQl9ICk7CgoJCWlmICh0aGlzLmhhbmRsZXMuY29uc3RydWN0b3IgPT09IFN0cmluZykgewoKCQkJaWYgKCB0aGlzLmhhbmRsZXMgPT09ICJhbGwiKSB7CgkJCQl0aGlzLmhhbmRsZXMgPSAibixlLHMsdyxzZSxzdyxuZSxudyI7CgkJCX0KCgkJCW4gPSB0aGlzLmhhbmRsZXMuc3BsaXQoIiwiKTsKCQkJdGhpcy5oYW5kbGVzID0ge307CgoJCQlmb3IgKGkgPSAwOyBpIDwgbi5sZW5ndGg7IGkrKykgewoKCQkJCWhhbmRsZSA9ICQudHJpbShuW2ldKTsKCQkJCWhuYW1lID0gInVpLXJlc2l6YWJsZS0iICsgaGFuZGxlOwoJCQkJYXhpcyA9ICQoIjxkaXYgY2xhc3M9J3VpLXJlc2l6YWJsZS1oYW5kbGUgIiArIGhuYW1lICsgIic+PC9kaXY+Iik7CgoJCQkJYXhpcy5jc3MoeyB6SW5kZXg6IG8uekluZGV4IH0pOwoKCQkJCS8vIFRPRE8gOiBXaGF0J3MgZ29pbmcgb24gaGVyZT8KCQkJCWlmICgic2UiID09PSBoYW5kbGUpIHsKCQkJCQlheGlzLmFkZENsYXNzKCJ1aS1pY29uIHVpLWljb24tZ3JpcHNtYWxsLWRpYWdvbmFsLXNlIik7CgkJCQl9CgoJCQkJdGhpcy5oYW5kbGVzW2hhbmRsZV0gPSAiLnVpLXJlc2l6YWJsZS0iICsgaGFuZGxlOwoJCQkJdGhpcy5lbGVtZW50LmFwcGVuZChheGlzKTsKCQkJfQoKCQl9CgoJCXRoaXMuX3JlbmRlckF4aXMgPSBmdW5jdGlvbih0YXJnZXQpIHsKCgkJCXZhciBpLCBheGlzLCBwYWRQb3MsIHBhZFdyYXBwZXI7CgoJCQl0YXJnZXQgPSB0YXJnZXQgfHwgdGhpcy5lbGVtZW50OwoKCQkJZm9yIChpIGluIHRoaXMuaGFuZGxlcykgewoKCQkJCWlmICh0aGlzLmhhbmRsZXNbaV0uY29uc3RydWN0b3IgPT09IFN0cmluZykgewoJCQkJCXRoaXMuaGFuZGxlc1tpXSA9IHRoaXMuZWxlbWVudC5jaGlsZHJlbiggdGhpcy5oYW5kbGVzWyBpIF0gKS5maXJzdCgpLnNob3coKTsKCQkJCX0KCgkJCQlpZiAodGhpcy5lbGVtZW50SXNXcmFwcGVyICYmIHRoaXMub3JpZ2luYWxFbGVtZW50WzBdLm5vZGVOYW1lLm1hdGNoKC90ZXh0YXJlYXxpbnB1dHxzZWxlY3R8YnV0dG9uL2kpKSB7CgoJCQkJCWF4aXMgPSAkKHRoaXMuaGFuZGxlc1tpXSwgdGhpcy5lbGVtZW50KTsKCgkJCQkJcGFkV3JhcHBlciA9IC9zd3xuZXxud3xzZXxufHMvLnRlc3QoaSkgPyBheGlzLm91dGVySGVpZ2h0KCkgOiBheGlzLm91dGVyV2lkdGgoKTsKCgkJCQkJcGFkUG9zID0gWyAicGFkZGluZyIsCgkJCQkJCS9uZXxud3xuLy50ZXN0KGkpID8gIlRvcCIgOgoJCQkJCQkvc2V8c3d8cy8udGVzdChpKSA/ICJCb3R0b20iIDoKCQkJCQkJL15lJC8udGVzdChpKSA/ICJSaWdodCIgOiAiTGVmdCIgXS5qb2luKCIiKTsKCgkJCQkJdGFyZ2V0LmNzcyhwYWRQb3MsIHBhZFdyYXBwZXIpOwoKCQkJCQl0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpOwoKCQkJCX0KCgkJCQkvLyBUT0RPOiBXaGF0J3MgdGhhdCBnb29kIGZvcj8gVGhlcmUncyBub3QgYW55dGhpbmcgdG8gYmUgZXhlY3V0ZWQgbGVmdAoJCQkJaWYgKCEkKHRoaXMuaGFuZGxlc1tpXSkubGVuZ3RoKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgkJCX0KCQl9OwoKCQkvLyBUT0RPOiBtYWtlIHJlbmRlckF4aXMgYSBwcm90b3R5cGUgZnVuY3Rpb24KCQl0aGlzLl9yZW5kZXJBeGlzKHRoaXMuZWxlbWVudCk7CgoJCXRoaXMuX2hhbmRsZXMgPSAkKCIudWktcmVzaXphYmxlLWhhbmRsZSIsIHRoaXMuZWxlbWVudCkKCQkJLmRpc2FibGVTZWxlY3Rpb24oKTsKCgkJdGhpcy5faGFuZGxlcy5tb3VzZW92ZXIoZnVuY3Rpb24oKSB7CgkJCWlmICghdGhhdC5yZXNpemluZykgewoJCQkJaWYgKHRoaXMuY2xhc3NOYW1lKSB7CgkJCQkJYXhpcyA9IHRoaXMuY2xhc3NOYW1lLm1hdGNoKC91aS1yZXNpemFibGUtKHNlfHN3fG5lfG53fG58ZXxzfHcpL2kpOwoJCQkJfQoJCQkJdGhhdC5heGlzID0gYXhpcyAmJiBheGlzWzFdID8gYXhpc1sxXSA6ICJzZSI7CgkJCX0KCQl9KTsKCgkJaWYgKG8uYXV0b0hpZGUpIHsKCQkJdGhpcy5faGFuZGxlcy5oaWRlKCk7CgkJCSQodGhpcy5lbGVtZW50KQoJCQkJLmFkZENsYXNzKCJ1aS1yZXNpemFibGUtYXV0b2hpZGUiKQoJCQkJLm1vdXNlZW50ZXIoZnVuY3Rpb24oKSB7CgkJCQkJaWYgKG8uZGlzYWJsZWQpIHsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCQkkKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1yZXNpemFibGUtYXV0b2hpZGUiKTsKCQkJCQl0aGF0Ll9oYW5kbGVzLnNob3coKTsKCQkJCX0pCgkJCQkubW91c2VsZWF2ZShmdW5jdGlvbigpIHsKCQkJCQlpZiAoby5kaXNhYmxlZCkgewoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJCWlmICghdGhhdC5yZXNpemluZykgewoJCQkJCQkkKHRoaXMpLmFkZENsYXNzKCJ1aS1yZXNpemFibGUtYXV0b2hpZGUiKTsKCQkJCQkJdGhhdC5faGFuZGxlcy5oaWRlKCk7CgkJCQkJfQoJCQkJfSk7CgkJfQoKCQl0aGlzLl9tb3VzZUluaXQoKTsKCgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCgkJdGhpcy5fbW91c2VEZXN0cm95KCk7CgoJCXZhciB3cmFwcGVyLAoJCQlfZGVzdHJveSA9IGZ1bmN0aW9uKGV4cCkgewoJCQkJJChleHApCgkJCQkJLnJlbW92ZUNsYXNzKCJ1aS1yZXNpemFibGUgdWktcmVzaXphYmxlLWRpc2FibGVkIHVpLXJlc2l6YWJsZS1yZXNpemluZyIpCgkJCQkJLnJlbW92ZURhdGEoInJlc2l6YWJsZSIpCgkJCQkJLnJlbW92ZURhdGEoInVpLXJlc2l6YWJsZSIpCgkJCQkJLnVuYmluZCgiLnJlc2l6YWJsZSIpCgkJCQkJLmZpbmQoIi51aS1yZXNpemFibGUtaGFuZGxlIikKCQkJCQkJLnJlbW92ZSgpOwoJCQl9OwoKCQkvLyBUT0RPOiBVbndyYXAgYXQgc2FtZSBET00gcG9zaXRpb24KCQlpZiAodGhpcy5lbGVtZW50SXNXcmFwcGVyKSB7CgkJCV9kZXN0cm95KHRoaXMuZWxlbWVudCk7CgkJCXdyYXBwZXIgPSB0aGlzLmVsZW1lbnQ7CgkJCXRoaXMub3JpZ2luYWxFbGVtZW50LmNzcyh7CgkJCQlwb3NpdGlvbjogd3JhcHBlci5jc3MoInBvc2l0aW9uIiksCgkJCQl3aWR0aDogd3JhcHBlci5vdXRlcldpZHRoKCksCgkJCQloZWlnaHQ6IHdyYXBwZXIub3V0ZXJIZWlnaHQoKSwKCQkJCXRvcDogd3JhcHBlci5jc3MoInRvcCIpLAoJCQkJbGVmdDogd3JhcHBlci5jc3MoImxlZnQiKQoJCQl9KS5pbnNlcnRBZnRlciggd3JhcHBlciApOwoJCQl3cmFwcGVyLnJlbW92ZSgpOwoJCX0KCgkJdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJyZXNpemUiLCB0aGlzLm9yaWdpbmFsUmVzaXplU3R5bGUpOwoJCV9kZXN0cm95KHRoaXMub3JpZ2luYWxFbGVtZW50KTsKCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCV9tb3VzZUNhcHR1cmU6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdmFyIGksIGhhbmRsZSwKCQkJY2FwdHVyZSA9IGZhbHNlOwoKCQlmb3IgKGkgaW4gdGhpcy5oYW5kbGVzKSB7CgkJCWhhbmRsZSA9ICQodGhpcy5oYW5kbGVzW2ldKVswXTsKCQkJaWYgKGhhbmRsZSA9PT0gZXZlbnQudGFyZ2V0IHx8ICQuY29udGFpbnMoaGFuZGxlLCBldmVudC50YXJnZXQpKSB7CgkJCQljYXB0dXJlID0gdHJ1ZTsKCQkJfQoJCX0KCgkJcmV0dXJuICF0aGlzLm9wdGlvbnMuZGlzYWJsZWQgJiYgY2FwdHVyZTsKCX0sCgoJX21vdXNlU3RhcnQ6IGZ1bmN0aW9uKGV2ZW50KSB7CgoJCXZhciBjdXJsZWZ0LCBjdXJ0b3AsIGN1cnNvciwKCQkJbyA9IHRoaXMub3B0aW9ucywKCQkJZWwgPSB0aGlzLmVsZW1lbnQ7CgoJCXRoaXMucmVzaXppbmcgPSB0cnVlOwoKCQl0aGlzLl9yZW5kZXJQcm94eSgpOwoKCQljdXJsZWZ0ID0gdGhpcy5fbnVtKHRoaXMuaGVscGVyLmNzcygibGVmdCIpKTsKCQljdXJ0b3AgPSB0aGlzLl9udW0odGhpcy5oZWxwZXIuY3NzKCJ0b3AiKSk7CgoJCWlmIChvLmNvbnRhaW5tZW50KSB7CgkJCWN1cmxlZnQgKz0gJChvLmNvbnRhaW5tZW50KS5zY3JvbGxMZWZ0KCkgfHwgMDsKCQkJY3VydG9wICs9ICQoby5jb250YWlubWVudCkuc2Nyb2xsVG9wKCkgfHwgMDsKCQl9CgoJCXRoaXMub2Zmc2V0ID0gdGhpcy5oZWxwZXIub2Zmc2V0KCk7CgkJdGhpcy5wb3NpdGlvbiA9IHsgbGVmdDogY3VybGVmdCwgdG9wOiBjdXJ0b3AgfTsKCgkJdGhpcy5zaXplID0gdGhpcy5faGVscGVyID8gewoJCQkJd2lkdGg6IHRoaXMuaGVscGVyLndpZHRoKCksCgkJCQloZWlnaHQ6IHRoaXMuaGVscGVyLmhlaWdodCgpCgkJCX0gOiB7CgkJCQl3aWR0aDogZWwud2lkdGgoKSwKCQkJCWhlaWdodDogZWwuaGVpZ2h0KCkKCQkJfTsKCgkJdGhpcy5vcmlnaW5hbFNpemUgPSB0aGlzLl9oZWxwZXIgPyB7CgkJCQl3aWR0aDogZWwub3V0ZXJXaWR0aCgpLAoJCQkJaGVpZ2h0OiBlbC5vdXRlckhlaWdodCgpCgkJCX0gOiB7CgkJCQl3aWR0aDogZWwud2lkdGgoKSwKCQkJCWhlaWdodDogZWwuaGVpZ2h0KCkKCQkJfTsKCgkJdGhpcy5zaXplRGlmZiA9IHsKCQkJd2lkdGg6IGVsLm91dGVyV2lkdGgoKSAtIGVsLndpZHRoKCksCgkJCWhlaWdodDogZWwub3V0ZXJIZWlnaHQoKSAtIGVsLmhlaWdodCgpCgkJfTsKCgkJdGhpcy5vcmlnaW5hbFBvc2l0aW9uID0geyBsZWZ0OiBjdXJsZWZ0LCB0b3A6IGN1cnRvcCB9OwoJCXRoaXMub3JpZ2luYWxNb3VzZVBvc2l0aW9uID0geyBsZWZ0OiBldmVudC5wYWdlWCwgdG9wOiBldmVudC5wYWdlWSB9OwoKCQl0aGlzLmFzcGVjdFJhdGlvID0gKHR5cGVvZiBvLmFzcGVjdFJhdGlvID09PSAibnVtYmVyIikgPwoJCQlvLmFzcGVjdFJhdGlvIDoKCQkJKCh0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCAvIHRoaXMub3JpZ2luYWxTaXplLmhlaWdodCkgfHwgMSk7CgoJCWN1cnNvciA9ICQoIi51aS1yZXNpemFibGUtIiArIHRoaXMuYXhpcykuY3NzKCJjdXJzb3IiKTsKCQkkKCJib2R5IikuY3NzKCJjdXJzb3IiLCBjdXJzb3IgPT09ICJhdXRvIiA/IHRoaXMuYXhpcyArICItcmVzaXplIiA6IGN1cnNvcik7CgoJCWVsLmFkZENsYXNzKCJ1aS1yZXNpemFibGUtcmVzaXppbmciKTsKCQl0aGlzLl9wcm9wYWdhdGUoInN0YXJ0IiwgZXZlbnQpOwoJCXJldHVybiB0cnVlOwoJfSwKCglfbW91c2VEcmFnOiBmdW5jdGlvbihldmVudCkgewoKCQl2YXIgZGF0YSwgcHJvcHMsCgkJCXNtcCA9IHRoaXMub3JpZ2luYWxNb3VzZVBvc2l0aW9uLAoJCQlhID0gdGhpcy5heGlzLAoJCQlkeCA9IChldmVudC5wYWdlWCAtIHNtcC5sZWZ0KSB8fCAwLAoJCQlkeSA9IChldmVudC5wYWdlWSAtIHNtcC50b3ApIHx8IDAsCgkJCXRyaWdnZXIgPSB0aGlzLl9jaGFuZ2VbYV07CgoJCXRoaXMuX3VwZGF0ZVByZXZQcm9wZXJ0aWVzKCk7CgoJCWlmICghdHJpZ2dlcikgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlkYXRhID0gdHJpZ2dlci5hcHBseSh0aGlzLCBbIGV2ZW50LCBkeCwgZHkgXSk7CgoJCXRoaXMuX3VwZGF0ZVZpcnR1YWxCb3VuZGFyaWVzKGV2ZW50LnNoaWZ0S2V5KTsKCQlpZiAodGhpcy5fYXNwZWN0UmF0aW8gfHwgZXZlbnQuc2hpZnRLZXkpIHsKCQkJZGF0YSA9IHRoaXMuX3VwZGF0ZVJhdGlvKGRhdGEsIGV2ZW50KTsKCQl9CgoJCWRhdGEgPSB0aGlzLl9yZXNwZWN0U2l6ZShkYXRhLCBldmVudCk7CgoJCXRoaXMuX3VwZGF0ZUNhY2hlKGRhdGEpOwoKCQl0aGlzLl9wcm9wYWdhdGUoInJlc2l6ZSIsIGV2ZW50KTsKCgkJcHJvcHMgPSB0aGlzLl9hcHBseUNoYW5nZXMoKTsKCgkJaWYgKCAhdGhpcy5faGVscGVyICYmIHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoICkgewoJCQl0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpOwoJCX0KCgkJaWYgKCAhJC5pc0VtcHR5T2JqZWN0KCBwcm9wcyApICkgewoJCQl0aGlzLl91cGRhdGVQcmV2UHJvcGVydGllcygpOwoJCQl0aGlzLl90cmlnZ2VyKCAicmVzaXplIiwgZXZlbnQsIHRoaXMudWkoKSApOwoJCQl0aGlzLl9hcHBseUNoYW5nZXMoKTsKCQl9CgoJCXJldHVybiBmYWxzZTsKCX0sCgoJX21vdXNlU3RvcDogZnVuY3Rpb24oZXZlbnQpIHsKCgkJdGhpcy5yZXNpemluZyA9IGZhbHNlOwoJCXZhciBwciwgaXN0YSwgc29mZnNldGgsIHNvZmZzZXR3LCBzLCBsZWZ0LCB0b3AsCgkJCW8gPSB0aGlzLm9wdGlvbnMsIHRoYXQgPSB0aGlzOwoKCQlpZiAodGhpcy5faGVscGVyKSB7CgoJCQlwciA9IHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHM7CgkJCWlzdGEgPSBwci5sZW5ndGggJiYgKC90ZXh0YXJlYS9pKS50ZXN0KHByWzBdLm5vZGVOYW1lKTsKCQkJc29mZnNldGggPSBpc3RhICYmIHRoaXMuX2hhc1Njcm9sbChwclswXSwgImxlZnQiKSA/IDAgOiB0aGF0LnNpemVEaWZmLmhlaWdodDsKCQkJc29mZnNldHcgPSBpc3RhID8gMCA6IHRoYXQuc2l6ZURpZmYud2lkdGg7CgoJCQlzID0gewoJCQkJd2lkdGg6ICh0aGF0LmhlbHBlci53aWR0aCgpICAtIHNvZmZzZXR3KSwKCQkJCWhlaWdodDogKHRoYXQuaGVscGVyLmhlaWdodCgpIC0gc29mZnNldGgpCgkJCX07CgkJCWxlZnQgPSAocGFyc2VJbnQodGhhdC5lbGVtZW50LmNzcygibGVmdCIpLCAxMCkgKwoJCQkJKHRoYXQucG9zaXRpb24ubGVmdCAtIHRoYXQub3JpZ2luYWxQb3NpdGlvbi5sZWZ0KSkgfHwgbnVsbDsKCQkJdG9wID0gKHBhcnNlSW50KHRoYXQuZWxlbWVudC5jc3MoInRvcCIpLCAxMCkgKwoJCQkJKHRoYXQucG9zaXRpb24udG9wIC0gdGhhdC5vcmlnaW5hbFBvc2l0aW9uLnRvcCkpIHx8IG51bGw7CgoJCQlpZiAoIW8uYW5pbWF0ZSkgewoJCQkJdGhpcy5lbGVtZW50LmNzcygkLmV4dGVuZChzLCB7IHRvcDogdG9wLCBsZWZ0OiBsZWZ0IH0pKTsKCQkJfQoKCQkJdGhhdC5oZWxwZXIuaGVpZ2h0KHRoYXQuc2l6ZS5oZWlnaHQpOwoJCQl0aGF0LmhlbHBlci53aWR0aCh0aGF0LnNpemUud2lkdGgpOwoKCQkJaWYgKHRoaXMuX2hlbHBlciAmJiAhby5hbmltYXRlKSB7CgkJCQl0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpOwoJCQl9CgkJfQoKCQkkKCJib2R5IikuY3NzKCJjdXJzb3IiLCAiYXV0byIpOwoKCQl0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXJlc2l6YWJsZS1yZXNpemluZyIpOwoKCQl0aGlzLl9wcm9wYWdhdGUoInN0b3AiLCBldmVudCk7CgoJCWlmICh0aGlzLl9oZWxwZXIpIHsKCQkJdGhpcy5oZWxwZXIucmVtb3ZlKCk7CgkJfQoKCQlyZXR1cm4gZmFsc2U7CgoJfSwKCglfdXBkYXRlUHJldlByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewoJCXRoaXMucHJldlBvc2l0aW9uID0gewoJCQl0b3A6IHRoaXMucG9zaXRpb24udG9wLAoJCQlsZWZ0OiB0aGlzLnBvc2l0aW9uLmxlZnQKCQl9OwoJCXRoaXMucHJldlNpemUgPSB7CgkJCXdpZHRoOiB0aGlzLnNpemUud2lkdGgsCgkJCWhlaWdodDogdGhpcy5zaXplLmhlaWdodAoJCX07Cgl9LAoKCV9hcHBseUNoYW5nZXM6IGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wcyA9IHt9OwoKCQlpZiAoIHRoaXMucG9zaXRpb24udG9wICE9PSB0aGlzLnByZXZQb3NpdGlvbi50b3AgKSB7CgkJCXByb3BzLnRvcCA9IHRoaXMucG9zaXRpb24udG9wICsgInB4IjsKCQl9CgkJaWYgKCB0aGlzLnBvc2l0aW9uLmxlZnQgIT09IHRoaXMucHJldlBvc2l0aW9uLmxlZnQgKSB7CgkJCXByb3BzLmxlZnQgPSB0aGlzLnBvc2l0aW9uLmxlZnQgKyAicHgiOwoJCX0KCQlpZiAoIHRoaXMuc2l6ZS53aWR0aCAhPT0gdGhpcy5wcmV2U2l6ZS53aWR0aCApIHsKCQkJcHJvcHMud2lkdGggPSB0aGlzLnNpemUud2lkdGggKyAicHgiOwoJCX0KCQlpZiAoIHRoaXMuc2l6ZS5oZWlnaHQgIT09IHRoaXMucHJldlNpemUuaGVpZ2h0ICkgewoJCQlwcm9wcy5oZWlnaHQgPSB0aGlzLnNpemUuaGVpZ2h0ICsgInB4IjsKCQl9CgoJCXRoaXMuaGVscGVyLmNzcyggcHJvcHMgKTsKCgkJcmV0dXJuIHByb3BzOwoJfSwKCglfdXBkYXRlVmlydHVhbEJvdW5kYXJpZXM6IGZ1bmN0aW9uKGZvcmNlQXNwZWN0UmF0aW8pIHsKCQl2YXIgcE1pbldpZHRoLCBwTWF4V2lkdGgsIHBNaW5IZWlnaHQsIHBNYXhIZWlnaHQsIGIsCgkJCW8gPSB0aGlzLm9wdGlvbnM7CgoJCWIgPSB7CgkJCW1pbldpZHRoOiB0aGlzLl9pc051bWJlcihvLm1pbldpZHRoKSA/IG8ubWluV2lkdGggOiAwLAoJCQltYXhXaWR0aDogdGhpcy5faXNOdW1iZXIoby5tYXhXaWR0aCkgPyBvLm1heFdpZHRoIDogSW5maW5pdHksCgkJCW1pbkhlaWdodDogdGhpcy5faXNOdW1iZXIoby5taW5IZWlnaHQpID8gby5taW5IZWlnaHQgOiAwLAoJCQltYXhIZWlnaHQ6IHRoaXMuX2lzTnVtYmVyKG8ubWF4SGVpZ2h0KSA/IG8ubWF4SGVpZ2h0IDogSW5maW5pdHkKCQl9OwoKCQlpZiAodGhpcy5fYXNwZWN0UmF0aW8gfHwgZm9yY2VBc3BlY3RSYXRpbykgewoJCQlwTWluV2lkdGggPSBiLm1pbkhlaWdodCAqIHRoaXMuYXNwZWN0UmF0aW87CgkJCXBNaW5IZWlnaHQgPSBiLm1pbldpZHRoIC8gdGhpcy5hc3BlY3RSYXRpbzsKCQkJcE1heFdpZHRoID0gYi5tYXhIZWlnaHQgKiB0aGlzLmFzcGVjdFJhdGlvOwoJCQlwTWF4SGVpZ2h0ID0gYi5tYXhXaWR0aCAvIHRoaXMuYXNwZWN0UmF0aW87CgoJCQlpZiAocE1pbldpZHRoID4gYi5taW5XaWR0aCkgewoJCQkJYi5taW5XaWR0aCA9IHBNaW5XaWR0aDsKCQkJfQoJCQlpZiAocE1pbkhlaWdodCA+IGIubWluSGVpZ2h0KSB7CgkJCQliLm1pbkhlaWdodCA9IHBNaW5IZWlnaHQ7CgkJCX0KCQkJaWYgKHBNYXhXaWR0aCA8IGIubWF4V2lkdGgpIHsKCQkJCWIubWF4V2lkdGggPSBwTWF4V2lkdGg7CgkJCX0KCQkJaWYgKHBNYXhIZWlnaHQgPCBiLm1heEhlaWdodCkgewoJCQkJYi5tYXhIZWlnaHQgPSBwTWF4SGVpZ2h0OwoJCQl9CgkJfQoJCXRoaXMuX3ZCb3VuZGFyaWVzID0gYjsKCX0sCgoJX3VwZGF0ZUNhY2hlOiBmdW5jdGlvbihkYXRhKSB7CgkJdGhpcy5vZmZzZXQgPSB0aGlzLmhlbHBlci5vZmZzZXQoKTsKCQlpZiAodGhpcy5faXNOdW1iZXIoZGF0YS5sZWZ0KSkgewoJCQl0aGlzLnBvc2l0aW9uLmxlZnQgPSBkYXRhLmxlZnQ7CgkJfQoJCWlmICh0aGlzLl9pc051bWJlcihkYXRhLnRvcCkpIHsKCQkJdGhpcy5wb3NpdGlvbi50b3AgPSBkYXRhLnRvcDsKCQl9CgkJaWYgKHRoaXMuX2lzTnVtYmVyKGRhdGEuaGVpZ2h0KSkgewoJCQl0aGlzLnNpemUuaGVpZ2h0ID0gZGF0YS5oZWlnaHQ7CgkJfQoJCWlmICh0aGlzLl9pc051bWJlcihkYXRhLndpZHRoKSkgewoJCQl0aGlzLnNpemUud2lkdGggPSBkYXRhLndpZHRoOwoJCX0KCX0sCgoJX3VwZGF0ZVJhdGlvOiBmdW5jdGlvbiggZGF0YSApIHsKCgkJdmFyIGNwb3MgPSB0aGlzLnBvc2l0aW9uLAoJCQljc2l6ZSA9IHRoaXMuc2l6ZSwKCQkJYSA9IHRoaXMuYXhpczsKCgkJaWYgKHRoaXMuX2lzTnVtYmVyKGRhdGEuaGVpZ2h0KSkgewoJCQlkYXRhLndpZHRoID0gKGRhdGEuaGVpZ2h0ICogdGhpcy5hc3BlY3RSYXRpbyk7CgkJfSBlbHNlIGlmICh0aGlzLl9pc051bWJlcihkYXRhLndpZHRoKSkgewoJCQlkYXRhLmhlaWdodCA9IChkYXRhLndpZHRoIC8gdGhpcy5hc3BlY3RSYXRpbyk7CgkJfQoKCQlpZiAoYSA9PT0gInN3IikgewoJCQlkYXRhLmxlZnQgPSBjcG9zLmxlZnQgKyAoY3NpemUud2lkdGggLSBkYXRhLndpZHRoKTsKCQkJZGF0YS50b3AgPSBudWxsOwoJCX0KCQlpZiAoYSA9PT0gIm53IikgewoJCQlkYXRhLnRvcCA9IGNwb3MudG9wICsgKGNzaXplLmhlaWdodCAtIGRhdGEuaGVpZ2h0KTsKCQkJZGF0YS5sZWZ0ID0gY3Bvcy5sZWZ0ICsgKGNzaXplLndpZHRoIC0gZGF0YS53aWR0aCk7CgkJfQoKCQlyZXR1cm4gZGF0YTsKCX0sCgoJX3Jlc3BlY3RTaXplOiBmdW5jdGlvbiggZGF0YSApIHsKCgkJdmFyIG8gPSB0aGlzLl92Qm91bmRhcmllcywKCQkJYSA9IHRoaXMuYXhpcywKCQkJaXNtYXh3ID0gdGhpcy5faXNOdW1iZXIoZGF0YS53aWR0aCkgJiYgby5tYXhXaWR0aCAmJiAoby5tYXhXaWR0aCA8IGRhdGEud2lkdGgpLAoJCQlpc21heGggPSB0aGlzLl9pc051bWJlcihkYXRhLmhlaWdodCkgJiYgby5tYXhIZWlnaHQgJiYgKG8ubWF4SGVpZ2h0IDwgZGF0YS5oZWlnaHQpLAoJCQlpc21pbncgPSB0aGlzLl9pc051bWJlcihkYXRhLndpZHRoKSAmJiBvLm1pbldpZHRoICYmIChvLm1pbldpZHRoID4gZGF0YS53aWR0aCksCgkJCWlzbWluaCA9IHRoaXMuX2lzTnVtYmVyKGRhdGEuaGVpZ2h0KSAmJiBvLm1pbkhlaWdodCAmJiAoby5taW5IZWlnaHQgPiBkYXRhLmhlaWdodCksCgkJCWR3ID0gdGhpcy5vcmlnaW5hbFBvc2l0aW9uLmxlZnQgKyB0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCwKCQkJZGggPSB0aGlzLnBvc2l0aW9uLnRvcCArIHRoaXMuc2l6ZS5oZWlnaHQsCgkJCWN3ID0gL3N3fG53fHcvLnRlc3QoYSksIGNoID0gL253fG5lfG4vLnRlc3QoYSk7CgkJaWYgKGlzbWludykgewoJCQlkYXRhLndpZHRoID0gby5taW5XaWR0aDsKCQl9CgkJaWYgKGlzbWluaCkgewoJCQlkYXRhLmhlaWdodCA9IG8ubWluSGVpZ2h0OwoJCX0KCQlpZiAoaXNtYXh3KSB7CgkJCWRhdGEud2lkdGggPSBvLm1heFdpZHRoOwoJCX0KCQlpZiAoaXNtYXhoKSB7CgkJCWRhdGEuaGVpZ2h0ID0gby5tYXhIZWlnaHQ7CgkJfQoKCQlpZiAoaXNtaW53ICYmIGN3KSB7CgkJCWRhdGEubGVmdCA9IGR3IC0gby5taW5XaWR0aDsKCQl9CgkJaWYgKGlzbWF4dyAmJiBjdykgewoJCQlkYXRhLmxlZnQgPSBkdyAtIG8ubWF4V2lkdGg7CgkJfQoJCWlmIChpc21pbmggJiYgY2gpIHsKCQkJZGF0YS50b3AgPSBkaCAtIG8ubWluSGVpZ2h0OwoJCX0KCQlpZiAoaXNtYXhoICYmIGNoKSB7CgkJCWRhdGEudG9wID0gZGggLSBvLm1heEhlaWdodDsKCQl9CgoJCS8vIEZpeGluZyBqdW1wIGVycm9yIG9uIHRvcC9sZWZ0IC0gYnVnICMyMzMwCgkJaWYgKCFkYXRhLndpZHRoICYmICFkYXRhLmhlaWdodCAmJiAhZGF0YS5sZWZ0ICYmIGRhdGEudG9wKSB7CgkJCWRhdGEudG9wID0gbnVsbDsKCQl9IGVsc2UgaWYgKCFkYXRhLndpZHRoICYmICFkYXRhLmhlaWdodCAmJiAhZGF0YS50b3AgJiYgZGF0YS5sZWZ0KSB7CgkJCWRhdGEubGVmdCA9IG51bGw7CgkJfQoKCQlyZXR1cm4gZGF0YTsKCX0sCgoJX2dldFBhZGRpbmdQbHVzQm9yZGVyRGltZW5zaW9uczogZnVuY3Rpb24oIGVsZW1lbnQgKSB7CgkJdmFyIGkgPSAwLAoJCQl3aWR0aHMgPSBbXSwKCQkJYm9yZGVycyA9IFsKCQkJCWVsZW1lbnQuY3NzKCAiYm9yZGVyVG9wV2lkdGgiICksCgkJCQllbGVtZW50LmNzcyggImJvcmRlclJpZ2h0V2lkdGgiICksCgkJCQllbGVtZW50LmNzcyggImJvcmRlckJvdHRvbVdpZHRoIiApLAoJCQkJZWxlbWVudC5jc3MoICJib3JkZXJMZWZ0V2lkdGgiICkKCQkJXSwKCQkJcGFkZGluZ3MgPSBbCgkJCQllbGVtZW50LmNzcyggInBhZGRpbmdUb3AiICksCgkJCQllbGVtZW50LmNzcyggInBhZGRpbmdSaWdodCIgKSwKCQkJCWVsZW1lbnQuY3NzKCAicGFkZGluZ0JvdHRvbSIgKSwKCQkJCWVsZW1lbnQuY3NzKCAicGFkZGluZ0xlZnQiICkKCQkJXTsKCgkJZm9yICggOyBpIDwgNDsgaSsrICkgewoJCQl3aWR0aHNbIGkgXSA9ICggcGFyc2VJbnQoIGJvcmRlcnNbIGkgXSwgMTAgKSB8fCAwICk7CgkJCXdpZHRoc1sgaSBdICs9ICggcGFyc2VJbnQoIHBhZGRpbmdzWyBpIF0sIDEwICkgfHwgMCApOwoJCX0KCgkJcmV0dXJuIHsKCQkJaGVpZ2h0OiB3aWR0aHNbIDAgXSArIHdpZHRoc1sgMiBdLAoJCQl3aWR0aDogd2lkdGhzWyAxIF0gKyB3aWR0aHNbIDMgXQoJCX07Cgl9LAoKCV9wcm9wb3J0aW9uYWxseVJlc2l6ZTogZnVuY3Rpb24oKSB7CgoJCWlmICghdGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cy5sZW5ndGgpIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIHByZWwsCgkJCWkgPSAwLAoJCQllbGVtZW50ID0gdGhpcy5oZWxwZXIgfHwgdGhpcy5lbGVtZW50OwoKCQlmb3IgKCA7IGkgPCB0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgoJCQlwcmVsID0gdGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50c1tpXTsKCgkJCS8vIFRPRE86IFNlZW1zIGxpa2UgYSBidWcgdG8gY2FjaGUgdGhpcy5vdXRlckRpbWVuc2lvbnMKCQkJLy8gY29uc2lkZXJpbmcgdGhhdCB3ZSBhcmUgaW4gYSBsb29wLgoJCQlpZiAoIXRoaXMub3V0ZXJEaW1lbnNpb25zKSB7CgkJCQl0aGlzLm91dGVyRGltZW5zaW9ucyA9IHRoaXMuX2dldFBhZGRpbmdQbHVzQm9yZGVyRGltZW5zaW9ucyggcHJlbCApOwoJCQl9CgoJCQlwcmVsLmNzcyh7CgkJCQloZWlnaHQ6IChlbGVtZW50LmhlaWdodCgpIC0gdGhpcy5vdXRlckRpbWVuc2lvbnMuaGVpZ2h0KSB8fCAwLAoJCQkJd2lkdGg6IChlbGVtZW50LndpZHRoKCkgLSB0aGlzLm91dGVyRGltZW5zaW9ucy53aWR0aCkgfHwgMAoJCQl9KTsKCgkJfQoKCX0sCgoJX3JlbmRlclByb3h5OiBmdW5jdGlvbigpIHsKCgkJdmFyIGVsID0gdGhpcy5lbGVtZW50LCBvID0gdGhpcy5vcHRpb25zOwoJCXRoaXMuZWxlbWVudE9mZnNldCA9IGVsLm9mZnNldCgpOwoKCQlpZiAodGhpcy5faGVscGVyKSB7CgoJCQl0aGlzLmhlbHBlciA9IHRoaXMuaGVscGVyIHx8ICQoIjxkaXYgc3R5bGU9J292ZXJmbG93OmhpZGRlbjsnPjwvZGl2PiIpOwoKCQkJdGhpcy5oZWxwZXIuYWRkQ2xhc3ModGhpcy5faGVscGVyKS5jc3MoewoJCQkJd2lkdGg6IHRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCkgLSAxLAoJCQkJaGVpZ2h0OiB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSAtIDEsCgkJCQlwb3NpdGlvbjogImFic29sdXRlIiwKCQkJCWxlZnQ6IHRoaXMuZWxlbWVudE9mZnNldC5sZWZ0ICsgInB4IiwKCQkJCXRvcDogdGhpcy5lbGVtZW50T2Zmc2V0LnRvcCArICJweCIsCgkJCQl6SW5kZXg6ICsrby56SW5kZXggLy9UT0RPOiBEb24ndCBtb2RpZnkgb3B0aW9uCgkJCX0pOwoKCQkJdGhpcy5oZWxwZXIKCQkJCS5hcHBlbmRUbygiYm9keSIpCgkJCQkuZGlzYWJsZVNlbGVjdGlvbigpOwoKCQl9IGVsc2UgewoJCQl0aGlzLmhlbHBlciA9IHRoaXMuZWxlbWVudDsKCQl9CgoJfSwKCglfY2hhbmdlOiB7CgkJZTogZnVuY3Rpb24oZXZlbnQsIGR4KSB7CgkJCXJldHVybiB7IHdpZHRoOiB0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aCArIGR4IH07CgkJfSwKCQl3OiBmdW5jdGlvbihldmVudCwgZHgpIHsKCQkJdmFyIGNzID0gdGhpcy5vcmlnaW5hbFNpemUsIHNwID0gdGhpcy5vcmlnaW5hbFBvc2l0aW9uOwoJCQlyZXR1cm4geyBsZWZ0OiBzcC5sZWZ0ICsgZHgsIHdpZHRoOiBjcy53aWR0aCAtIGR4IH07CgkJfSwKCQluOiBmdW5jdGlvbihldmVudCwgZHgsIGR5KSB7CgkJCXZhciBjcyA9IHRoaXMub3JpZ2luYWxTaXplLCBzcCA9IHRoaXMub3JpZ2luYWxQb3NpdGlvbjsKCQkJcmV0dXJuIHsgdG9wOiBzcC50b3AgKyBkeSwgaGVpZ2h0OiBjcy5oZWlnaHQgLSBkeSB9OwoJCX0sCgkJczogZnVuY3Rpb24oZXZlbnQsIGR4LCBkeSkgewoJCQlyZXR1cm4geyBoZWlnaHQ6IHRoaXMub3JpZ2luYWxTaXplLmhlaWdodCArIGR5IH07CgkJfSwKCQlzZTogZnVuY3Rpb24oZXZlbnQsIGR4LCBkeSkgewoJCQlyZXR1cm4gJC5leHRlbmQodGhpcy5fY2hhbmdlLnMuYXBwbHkodGhpcywgYXJndW1lbnRzKSwKCQkJCXRoaXMuX2NoYW5nZS5lLmFwcGx5KHRoaXMsIFsgZXZlbnQsIGR4LCBkeSBdKSk7CgkJfSwKCQlzdzogZnVuY3Rpb24oZXZlbnQsIGR4LCBkeSkgewoJCQlyZXR1cm4gJC5leHRlbmQodGhpcy5fY2hhbmdlLnMuYXBwbHkodGhpcywgYXJndW1lbnRzKSwKCQkJCXRoaXMuX2NoYW5nZS53LmFwcGx5KHRoaXMsIFsgZXZlbnQsIGR4LCBkeSBdKSk7CgkJfSwKCQluZTogZnVuY3Rpb24oZXZlbnQsIGR4LCBkeSkgewoJCQlyZXR1cm4gJC5leHRlbmQodGhpcy5fY2hhbmdlLm4uYXBwbHkodGhpcywgYXJndW1lbnRzKSwKCQkJCXRoaXMuX2NoYW5nZS5lLmFwcGx5KHRoaXMsIFsgZXZlbnQsIGR4LCBkeSBdKSk7CgkJfSwKCQludzogZnVuY3Rpb24oZXZlbnQsIGR4LCBkeSkgewoJCQlyZXR1cm4gJC5leHRlbmQodGhpcy5fY2hhbmdlLm4uYXBwbHkodGhpcywgYXJndW1lbnRzKSwKCQkJCXRoaXMuX2NoYW5nZS53LmFwcGx5KHRoaXMsIFsgZXZlbnQsIGR4LCBkeSBdKSk7CgkJfQoJfSwKCglfcHJvcGFnYXRlOiBmdW5jdGlvbihuLCBldmVudCkgewoJCSQudWkucGx1Z2luLmNhbGwodGhpcywgbiwgWyBldmVudCwgdGhpcy51aSgpIF0pOwoJCShuICE9PSAicmVzaXplIiAmJiB0aGlzLl90cmlnZ2VyKG4sIGV2ZW50LCB0aGlzLnVpKCkpKTsKCX0sCgoJcGx1Z2luczoge30sCgoJdWk6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB7CgkJCW9yaWdpbmFsRWxlbWVudDogdGhpcy5vcmlnaW5hbEVsZW1lbnQsCgkJCWVsZW1lbnQ6IHRoaXMuZWxlbWVudCwKCQkJaGVscGVyOiB0aGlzLmhlbHBlciwKCQkJcG9zaXRpb246IHRoaXMucG9zaXRpb24sCgkJCXNpemU6IHRoaXMuc2l6ZSwKCQkJb3JpZ2luYWxTaXplOiB0aGlzLm9yaWdpbmFsU2l6ZSwKCQkJb3JpZ2luYWxQb3NpdGlvbjogdGhpcy5vcmlnaW5hbFBvc2l0aW9uCgkJfTsKCX0KCn0pOwoKLyoKICogUmVzaXphYmxlIEV4dGVuc2lvbnMKICovCgokLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsICJhbmltYXRlIiwgewoKCXN0b3A6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgdGhhdCA9ICQodGhpcykucmVzaXphYmxlKCAiaW5zdGFuY2UiICksCgkJCW8gPSB0aGF0Lm9wdGlvbnMsCgkJCXByID0gdGhhdC5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cywKCQkJaXN0YSA9IHByLmxlbmd0aCAmJiAoL3RleHRhcmVhL2kpLnRlc3QocHJbMF0ubm9kZU5hbWUpLAoJCQlzb2Zmc2V0aCA9IGlzdGEgJiYgdGhhdC5faGFzU2Nyb2xsKHByWzBdLCAibGVmdCIpID8gMCA6IHRoYXQuc2l6ZURpZmYuaGVpZ2h0LAoJCQlzb2Zmc2V0dyA9IGlzdGEgPyAwIDogdGhhdC5zaXplRGlmZi53aWR0aCwKCQkJc3R5bGUgPSB7IHdpZHRoOiAodGhhdC5zaXplLndpZHRoIC0gc29mZnNldHcpLCBoZWlnaHQ6ICh0aGF0LnNpemUuaGVpZ2h0IC0gc29mZnNldGgpIH0sCgkJCWxlZnQgPSAocGFyc2VJbnQodGhhdC5lbGVtZW50LmNzcygibGVmdCIpLCAxMCkgKwoJCQkJKHRoYXQucG9zaXRpb24ubGVmdCAtIHRoYXQub3JpZ2luYWxQb3NpdGlvbi5sZWZ0KSkgfHwgbnVsbCwKCQkJdG9wID0gKHBhcnNlSW50KHRoYXQuZWxlbWVudC5jc3MoInRvcCIpLCAxMCkgKwoJCQkJKHRoYXQucG9zaXRpb24udG9wIC0gdGhhdC5vcmlnaW5hbFBvc2l0aW9uLnRvcCkpIHx8IG51bGw7CgoJCXRoYXQuZWxlbWVudC5hbmltYXRlKAoJCQkkLmV4dGVuZChzdHlsZSwgdG9wICYmIGxlZnQgPyB7IHRvcDogdG9wLCBsZWZ0OiBsZWZ0IH0gOiB7fSksIHsKCQkJCWR1cmF0aW9uOiBvLmFuaW1hdGVEdXJhdGlvbiwKCQkJCWVhc2luZzogby5hbmltYXRlRWFzaW5nLAoJCQkJc3RlcDogZnVuY3Rpb24oKSB7CgoJCQkJCXZhciBkYXRhID0gewoJCQkJCQl3aWR0aDogcGFyc2VJbnQodGhhdC5lbGVtZW50LmNzcygid2lkdGgiKSwgMTApLAoJCQkJCQloZWlnaHQ6IHBhcnNlSW50KHRoYXQuZWxlbWVudC5jc3MoImhlaWdodCIpLCAxMCksCgkJCQkJCXRvcDogcGFyc2VJbnQodGhhdC5lbGVtZW50LmNzcygidG9wIiksIDEwKSwKCQkJCQkJbGVmdDogcGFyc2VJbnQodGhhdC5lbGVtZW50LmNzcygibGVmdCIpLCAxMCkKCQkJCQl9OwoKCQkJCQlpZiAocHIgJiYgcHIubGVuZ3RoKSB7CgkJCQkJCSQocHJbMF0pLmNzcyh7IHdpZHRoOiBkYXRhLndpZHRoLCBoZWlnaHQ6IGRhdGEuaGVpZ2h0IH0pOwoJCQkJCX0KCgkJCQkJLy8gcHJvcGFnYXRpbmcgcmVzaXplLCBhbmQgdXBkYXRpbmcgdmFsdWVzIGZvciBlYWNoIGFuaW1hdGlvbiBzdGVwCgkJCQkJdGhhdC5fdXBkYXRlQ2FjaGUoZGF0YSk7CgkJCQkJdGhhdC5fcHJvcGFnYXRlKCJyZXNpemUiLCBldmVudCk7CgoJCQkJfQoJCQl9CgkJKTsKCX0KCn0pOwoKJC51aS5wbHVnaW4uYWRkKCAicmVzaXphYmxlIiwgImNvbnRhaW5tZW50IiwgewoKCXN0YXJ0OiBmdW5jdGlvbigpIHsKCQl2YXIgZWxlbWVudCwgcCwgY28sIGNoLCBjdywgd2lkdGgsIGhlaWdodCwKCQkJdGhhdCA9ICQoIHRoaXMgKS5yZXNpemFibGUoICJpbnN0YW5jZSIgKSwKCQkJbyA9IHRoYXQub3B0aW9ucywKCQkJZWwgPSB0aGF0LmVsZW1lbnQsCgkJCW9jID0gby5jb250YWlubWVudCwKCQkJY2UgPSAoIG9jIGluc3RhbmNlb2YgJCApID8gb2MuZ2V0KCAwICkgOiAoIC9wYXJlbnQvLnRlc3QoIG9jICkgKSA/IGVsLnBhcmVudCgpLmdldCggMCApIDogb2M7CgoJCWlmICggIWNlICkgewoJCQlyZXR1cm47CgkJfQoKCQl0aGF0LmNvbnRhaW5lckVsZW1lbnQgPSAkKCBjZSApOwoKCQlpZiAoIC9kb2N1bWVudC8udGVzdCggb2MgKSB8fCBvYyA9PT0gZG9jdW1lbnQgKSB7CgkJCXRoYXQuY29udGFpbmVyT2Zmc2V0ID0gewoJCQkJbGVmdDogMCwKCQkJCXRvcDogMAoJCQl9OwoJCQl0aGF0LmNvbnRhaW5lclBvc2l0aW9uID0gewoJCQkJbGVmdDogMCwKCQkJCXRvcDogMAoJCQl9OwoKCQkJdGhhdC5wYXJlbnREYXRhID0gewoJCQkJZWxlbWVudDogJCggZG9jdW1lbnQgKSwKCQkJCWxlZnQ6IDAsCgkJCQl0b3A6IDAsCgkJCQl3aWR0aDogJCggZG9jdW1lbnQgKS53aWR0aCgpLAoJCQkJaGVpZ2h0OiAkKCBkb2N1bWVudCApLmhlaWdodCgpIHx8IGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZS5zY3JvbGxIZWlnaHQKCQkJfTsKCQl9IGVsc2UgewoJCQllbGVtZW50ID0gJCggY2UgKTsKCQkJcCA9IFtdOwoJCQkkKFsgIlRvcCIsICJSaWdodCIsICJMZWZ0IiwgIkJvdHRvbSIgXSkuZWFjaChmdW5jdGlvbiggaSwgbmFtZSApIHsKCQkJCXBbIGkgXSA9IHRoYXQuX251bSggZWxlbWVudC5jc3MoICJwYWRkaW5nIiArIG5hbWUgKSApOwoJCQl9KTsKCgkJCXRoYXQuY29udGFpbmVyT2Zmc2V0ID0gZWxlbWVudC5vZmZzZXQoKTsKCQkJdGhhdC5jb250YWluZXJQb3NpdGlvbiA9IGVsZW1lbnQucG9zaXRpb24oKTsKCQkJdGhhdC5jb250YWluZXJTaXplID0gewoJCQkJaGVpZ2h0OiAoIGVsZW1lbnQuaW5uZXJIZWlnaHQoKSAtIHBbIDMgXSApLAoJCQkJd2lkdGg6ICggZWxlbWVudC5pbm5lcldpZHRoKCkgLSBwWyAxIF0gKQoJCQl9OwoKCQkJY28gPSB0aGF0LmNvbnRhaW5lck9mZnNldDsKCQkJY2ggPSB0aGF0LmNvbnRhaW5lclNpemUuaGVpZ2h0OwoJCQljdyA9IHRoYXQuY29udGFpbmVyU2l6ZS53aWR0aDsKCQkJd2lkdGggPSAoIHRoYXQuX2hhc1Njcm9sbCAoIGNlLCAibGVmdCIgKSA/IGNlLnNjcm9sbFdpZHRoIDogY3cgKTsKCQkJaGVpZ2h0ID0gKCB0aGF0Ll9oYXNTY3JvbGwgKCBjZSApID8gY2Uuc2Nyb2xsSGVpZ2h0IDogY2ggKSA7CgoJCQl0aGF0LnBhcmVudERhdGEgPSB7CgkJCQllbGVtZW50OiBjZSwKCQkJCWxlZnQ6IGNvLmxlZnQsCgkJCQl0b3A6IGNvLnRvcCwKCQkJCXdpZHRoOiB3aWR0aCwKCQkJCWhlaWdodDogaGVpZ2h0CgkJCX07CgkJfQoJfSwKCglyZXNpemU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgd29zZXQsIGhvc2V0LCBpc1BhcmVudCwgaXNPZmZzZXRSZWxhdGl2ZSwKCQkJdGhhdCA9ICQoIHRoaXMgKS5yZXNpemFibGUoICJpbnN0YW5jZSIgKSwKCQkJbyA9IHRoYXQub3B0aW9ucywKCQkJY28gPSB0aGF0LmNvbnRhaW5lck9mZnNldCwKCQkJY3AgPSB0aGF0LnBvc2l0aW9uLAoJCQlwUmF0aW8gPSB0aGF0Ll9hc3BlY3RSYXRpbyB8fCBldmVudC5zaGlmdEtleSwKCQkJY29wID0gewoJCQkJdG9wOiAwLAoJCQkJbGVmdDogMAoJCQl9LAoJCQljZSA9IHRoYXQuY29udGFpbmVyRWxlbWVudCwKCQkJY29udGludWVSZXNpemUgPSB0cnVlOwoKCQlpZiAoIGNlWyAwIF0gIT09IGRvY3VtZW50ICYmICggL3N0YXRpYy8gKS50ZXN0KCBjZS5jc3MoICJwb3NpdGlvbiIgKSApICkgewoJCQljb3AgPSBjbzsKCQl9CgoJCWlmICggY3AubGVmdCA8ICggdGhhdC5faGVscGVyID8gY28ubGVmdCA6IDAgKSApIHsKCQkJdGhhdC5zaXplLndpZHRoID0gdGhhdC5zaXplLndpZHRoICsKCQkJCSggdGhhdC5faGVscGVyID8KCQkJCQkoIHRoYXQucG9zaXRpb24ubGVmdCAtIGNvLmxlZnQgKSA6CgkJCQkJKCB0aGF0LnBvc2l0aW9uLmxlZnQgLSBjb3AubGVmdCApICk7CgoJCQlpZiAoIHBSYXRpbyApIHsKCQkJCXRoYXQuc2l6ZS5oZWlnaHQgPSB0aGF0LnNpemUud2lkdGggLyB0aGF0LmFzcGVjdFJhdGlvOwoJCQkJY29udGludWVSZXNpemUgPSBmYWxzZTsKCQkJfQoJCQl0aGF0LnBvc2l0aW9uLmxlZnQgPSBvLmhlbHBlciA/IGNvLmxlZnQgOiAwOwoJCX0KCgkJaWYgKCBjcC50b3AgPCAoIHRoYXQuX2hlbHBlciA/IGNvLnRvcCA6IDAgKSApIHsKCQkJdGhhdC5zaXplLmhlaWdodCA9IHRoYXQuc2l6ZS5oZWlnaHQgKwoJCQkJKCB0aGF0Ll9oZWxwZXIgPwoJCQkJCSggdGhhdC5wb3NpdGlvbi50b3AgLSBjby50b3AgKSA6CgkJCQkJdGhhdC5wb3NpdGlvbi50b3AgKTsKCgkJCWlmICggcFJhdGlvICkgewoJCQkJdGhhdC5zaXplLndpZHRoID0gdGhhdC5zaXplLmhlaWdodCAqIHRoYXQuYXNwZWN0UmF0aW87CgkJCQljb250aW51ZVJlc2l6ZSA9IGZhbHNlOwoJCQl9CgkJCXRoYXQucG9zaXRpb24udG9wID0gdGhhdC5faGVscGVyID8gY28udG9wIDogMDsKCQl9CgoJCWlzUGFyZW50ID0gdGhhdC5jb250YWluZXJFbGVtZW50LmdldCggMCApID09PSB0aGF0LmVsZW1lbnQucGFyZW50KCkuZ2V0KCAwICk7CgkJaXNPZmZzZXRSZWxhdGl2ZSA9IC9yZWxhdGl2ZXxhYnNvbHV0ZS8udGVzdCggdGhhdC5jb250YWluZXJFbGVtZW50LmNzcyggInBvc2l0aW9uIiApICk7CgoJCWlmICggaXNQYXJlbnQgJiYgaXNPZmZzZXRSZWxhdGl2ZSApIHsKCQkJdGhhdC5vZmZzZXQubGVmdCA9IHRoYXQucGFyZW50RGF0YS5sZWZ0ICsgdGhhdC5wb3NpdGlvbi5sZWZ0OwoJCQl0aGF0Lm9mZnNldC50b3AgPSB0aGF0LnBhcmVudERhdGEudG9wICsgdGhhdC5wb3NpdGlvbi50b3A7CgkJfSBlbHNlIHsKCQkJdGhhdC5vZmZzZXQubGVmdCA9IHRoYXQuZWxlbWVudC5vZmZzZXQoKS5sZWZ0OwoJCQl0aGF0Lm9mZnNldC50b3AgPSB0aGF0LmVsZW1lbnQub2Zmc2V0KCkudG9wOwoJCX0KCgkJd29zZXQgPSBNYXRoLmFicyggdGhhdC5zaXplRGlmZi53aWR0aCArCgkJCSh0aGF0Ll9oZWxwZXIgPwoJCQkJdGhhdC5vZmZzZXQubGVmdCAtIGNvcC5sZWZ0IDoKCQkJCSh0aGF0Lm9mZnNldC5sZWZ0IC0gY28ubGVmdCkpICk7CgoJCWhvc2V0ID0gTWF0aC5hYnMoIHRoYXQuc2l6ZURpZmYuaGVpZ2h0ICsKCQkJKHRoYXQuX2hlbHBlciA/CgkJCQl0aGF0Lm9mZnNldC50b3AgLSBjb3AudG9wIDoKCQkJCSh0aGF0Lm9mZnNldC50b3AgLSBjby50b3ApKSApOwoKCQlpZiAoIHdvc2V0ICsgdGhhdC5zaXplLndpZHRoID49IHRoYXQucGFyZW50RGF0YS53aWR0aCApIHsKCQkJdGhhdC5zaXplLndpZHRoID0gdGhhdC5wYXJlbnREYXRhLndpZHRoIC0gd29zZXQ7CgkJCWlmICggcFJhdGlvICkgewoJCQkJdGhhdC5zaXplLmhlaWdodCA9IHRoYXQuc2l6ZS53aWR0aCAvIHRoYXQuYXNwZWN0UmF0aW87CgkJCQljb250aW51ZVJlc2l6ZSA9IGZhbHNlOwoJCQl9CgkJfQoKCQlpZiAoIGhvc2V0ICsgdGhhdC5zaXplLmhlaWdodCA+PSB0aGF0LnBhcmVudERhdGEuaGVpZ2h0ICkgewoJCQl0aGF0LnNpemUuaGVpZ2h0ID0gdGhhdC5wYXJlbnREYXRhLmhlaWdodCAtIGhvc2V0OwoJCQlpZiAoIHBSYXRpbyApIHsKCQkJCXRoYXQuc2l6ZS53aWR0aCA9IHRoYXQuc2l6ZS5oZWlnaHQgKiB0aGF0LmFzcGVjdFJhdGlvOwoJCQkJY29udGludWVSZXNpemUgPSBmYWxzZTsKCQkJfQoJCX0KCgkJaWYgKCAhY29udGludWVSZXNpemUgKXsKCQkJdGhhdC5wb3NpdGlvbi5sZWZ0ID0gdGhhdC5wcmV2UG9zaXRpb24ubGVmdDsKCQkJdGhhdC5wb3NpdGlvbi50b3AgPSB0aGF0LnByZXZQb3NpdGlvbi50b3A7CgkJCXRoYXQuc2l6ZS53aWR0aCA9IHRoYXQucHJldlNpemUud2lkdGg7CgkJCXRoYXQuc2l6ZS5oZWlnaHQgPSB0aGF0LnByZXZTaXplLmhlaWdodDsKCQl9Cgl9LAoKCXN0b3A6IGZ1bmN0aW9uKCkgewoJCXZhciB0aGF0ID0gJCggdGhpcyApLnJlc2l6YWJsZSggImluc3RhbmNlIiApLAoJCQlvID0gdGhhdC5vcHRpb25zLAoJCQljbyA9IHRoYXQuY29udGFpbmVyT2Zmc2V0LAoJCQljb3AgPSB0aGF0LmNvbnRhaW5lclBvc2l0aW9uLAoJCQljZSA9IHRoYXQuY29udGFpbmVyRWxlbWVudCwKCQkJaGVscGVyID0gJCggdGhhdC5oZWxwZXIgKSwKCQkJaG8gPSBoZWxwZXIub2Zmc2V0KCksCgkJCXcgPSBoZWxwZXIub3V0ZXJXaWR0aCgpIC0gdGhhdC5zaXplRGlmZi53aWR0aCwKCQkJaCA9IGhlbHBlci5vdXRlckhlaWdodCgpIC0gdGhhdC5zaXplRGlmZi5oZWlnaHQ7CgoJCWlmICggdGhhdC5faGVscGVyICYmICFvLmFuaW1hdGUgJiYgKCAvcmVsYXRpdmUvICkudGVzdCggY2UuY3NzKCAicG9zaXRpb24iICkgKSApIHsKCQkJJCggdGhpcyApLmNzcyh7CgkJCQlsZWZ0OiBoby5sZWZ0IC0gY29wLmxlZnQgLSBjby5sZWZ0LAoJCQkJd2lkdGg6IHcsCgkJCQloZWlnaHQ6IGgKCQkJfSk7CgkJfQoKCQlpZiAoIHRoYXQuX2hlbHBlciAmJiAhby5hbmltYXRlICYmICggL3N0YXRpYy8gKS50ZXN0KCBjZS5jc3MoICJwb3NpdGlvbiIgKSApICkgewoJCQkkKCB0aGlzICkuY3NzKHsKCQkJCWxlZnQ6IGhvLmxlZnQgLSBjb3AubGVmdCAtIGNvLmxlZnQsCgkJCQl3aWR0aDogdywKCQkJCWhlaWdodDogaAoJCQl9KTsKCQl9Cgl9Cn0pOwoKJC51aS5wbHVnaW4uYWRkKCJyZXNpemFibGUiLCAiYWxzb1Jlc2l6ZSIsIHsKCglzdGFydDogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSAkKHRoaXMpLnJlc2l6YWJsZSggImluc3RhbmNlIiApLAoJCQlvID0gdGhhdC5vcHRpb25zLAoJCQlfc3RvcmUgPSBmdW5jdGlvbihleHApIHsKCQkJCSQoZXhwKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJCXZhciBlbCA9ICQodGhpcyk7CgkJCQkJZWwuZGF0YSgidWktcmVzaXphYmxlLWFsc29yZXNpemUiLCB7CgkJCQkJCXdpZHRoOiBwYXJzZUludChlbC53aWR0aCgpLCAxMCksIGhlaWdodDogcGFyc2VJbnQoZWwuaGVpZ2h0KCksIDEwKSwKCQkJCQkJbGVmdDogcGFyc2VJbnQoZWwuY3NzKCJsZWZ0IiksIDEwKSwgdG9wOiBwYXJzZUludChlbC5jc3MoInRvcCIpLCAxMCkKCQkJCQl9KTsKCQkJCX0pOwoJCQl9OwoKCQlpZiAodHlwZW9mKG8uYWxzb1Jlc2l6ZSkgPT09ICJvYmplY3QiICYmICFvLmFsc29SZXNpemUucGFyZW50Tm9kZSkgewoJCQlpZiAoby5hbHNvUmVzaXplLmxlbmd0aCkgewoJCQkJby5hbHNvUmVzaXplID0gby5hbHNvUmVzaXplWzBdOwoJCQkJX3N0b3JlKG8uYWxzb1Jlc2l6ZSk7CgkJCX0gZWxzZSB7CgkJCQkkLmVhY2goby5hbHNvUmVzaXplLCBmdW5jdGlvbihleHApIHsKCQkJCQlfc3RvcmUoZXhwKTsKCQkJCX0pOwoJCQl9CgkJfSBlbHNlIHsKCQkJX3N0b3JlKG8uYWxzb1Jlc2l6ZSk7CgkJfQoJfSwKCglyZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCB1aSkgewoJCXZhciB0aGF0ID0gJCh0aGlzKS5yZXNpemFibGUoICJpbnN0YW5jZSIgKSwKCQkJbyA9IHRoYXQub3B0aW9ucywKCQkJb3MgPSB0aGF0Lm9yaWdpbmFsU2l6ZSwKCQkJb3AgPSB0aGF0Lm9yaWdpbmFsUG9zaXRpb24sCgkJCWRlbHRhID0gewoJCQkJaGVpZ2h0OiAodGhhdC5zaXplLmhlaWdodCAtIG9zLmhlaWdodCkgfHwgMCwKCQkJCXdpZHRoOiAodGhhdC5zaXplLndpZHRoIC0gb3Mud2lkdGgpIHx8IDAsCgkJCQl0b3A6ICh0aGF0LnBvc2l0aW9uLnRvcCAtIG9wLnRvcCkgfHwgMCwKCQkJCWxlZnQ6ICh0aGF0LnBvc2l0aW9uLmxlZnQgLSBvcC5sZWZ0KSB8fCAwCgkJCX0sCgoJCQlfYWxzb1Jlc2l6ZSA9IGZ1bmN0aW9uKGV4cCwgYykgewoJCQkJJChleHApLmVhY2goZnVuY3Rpb24oKSB7CgkJCQkJdmFyIGVsID0gJCh0aGlzKSwgc3RhcnQgPSAkKHRoaXMpLmRhdGEoInVpLXJlc2l6YWJsZS1hbHNvcmVzaXplIiksIHN0eWxlID0ge30sCgkJCQkJCWNzcyA9IGMgJiYgYy5sZW5ndGggPwoJCQkJCQkJYyA6CgkJCQkJCQllbC5wYXJlbnRzKHVpLm9yaWdpbmFsRWxlbWVudFswXSkubGVuZ3RoID8KCQkJCQkJCQlbICJ3aWR0aCIsICJoZWlnaHQiIF0gOgoJCQkJCQkJCVsgIndpZHRoIiwgImhlaWdodCIsICJ0b3AiLCAibGVmdCIgXTsKCgkJCQkJJC5lYWNoKGNzcywgZnVuY3Rpb24oaSwgcHJvcCkgewoJCQkJCQl2YXIgc3VtID0gKHN0YXJ0W3Byb3BdIHx8IDApICsgKGRlbHRhW3Byb3BdIHx8IDApOwoJCQkJCQlpZiAoc3VtICYmIHN1bSA+PSAwKSB7CgkJCQkJCQlzdHlsZVtwcm9wXSA9IHN1bSB8fCBudWxsOwoJCQkJCQl9CgkJCQkJfSk7CgoJCQkJCWVsLmNzcyhzdHlsZSk7CgkJCQl9KTsKCQkJfTsKCgkJaWYgKHR5cGVvZihvLmFsc29SZXNpemUpID09PSAib2JqZWN0IiAmJiAhby5hbHNvUmVzaXplLm5vZGVUeXBlKSB7CgkJCSQuZWFjaChvLmFsc29SZXNpemUsIGZ1bmN0aW9uKGV4cCwgYykgewoJCQkJX2Fsc29SZXNpemUoZXhwLCBjKTsKCQkJfSk7CgkJfSBlbHNlIHsKCQkJX2Fsc29SZXNpemUoby5hbHNvUmVzaXplKTsKCQl9Cgl9LAoKCXN0b3A6IGZ1bmN0aW9uKCkgewoJCSQodGhpcykucmVtb3ZlRGF0YSgicmVzaXphYmxlLWFsc29yZXNpemUiKTsKCX0KfSk7CgokLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsICJnaG9zdCIsIHsKCglzdGFydDogZnVuY3Rpb24oKSB7CgoJCXZhciB0aGF0ID0gJCh0aGlzKS5yZXNpemFibGUoICJpbnN0YW5jZSIgKSwgbyA9IHRoYXQub3B0aW9ucywgY3MgPSB0aGF0LnNpemU7CgoJCXRoYXQuZ2hvc3QgPSB0aGF0Lm9yaWdpbmFsRWxlbWVudC5jbG9uZSgpOwoJCXRoYXQuZ2hvc3QKCQkJLmNzcyh7CgkJCQlvcGFjaXR5OiAwLjI1LAoJCQkJZGlzcGxheTogImJsb2NrIiwKCQkJCXBvc2l0aW9uOiAicmVsYXRpdmUiLAoJCQkJaGVpZ2h0OiBjcy5oZWlnaHQsCgkJCQl3aWR0aDogY3Mud2lkdGgsCgkJCQltYXJnaW46IDAsCgkJCQlsZWZ0OiAwLAoJCQkJdG9wOiAwCgkJCX0pCgkJCS5hZGRDbGFzcygidWktcmVzaXphYmxlLWdob3N0IikKCQkJLmFkZENsYXNzKHR5cGVvZiBvLmdob3N0ID09PSAic3RyaW5nIiA/IG8uZ2hvc3QgOiAiIik7CgoJCXRoYXQuZ2hvc3QuYXBwZW5kVG8odGhhdC5oZWxwZXIpOwoKCX0sCgoJcmVzaXplOiBmdW5jdGlvbigpIHsKCQl2YXIgdGhhdCA9ICQodGhpcykucmVzaXphYmxlKCAiaW5zdGFuY2UiICk7CgkJaWYgKHRoYXQuZ2hvc3QpIHsKCQkJdGhhdC5naG9zdC5jc3MoewoJCQkJcG9zaXRpb246ICJyZWxhdGl2ZSIsCgkJCQloZWlnaHQ6IHRoYXQuc2l6ZS5oZWlnaHQsCgkJCQl3aWR0aDogdGhhdC5zaXplLndpZHRoCgkJCX0pOwoJCX0KCX0sCgoJc3RvcDogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSAkKHRoaXMpLnJlc2l6YWJsZSggImluc3RhbmNlIiApOwoJCWlmICh0aGF0Lmdob3N0ICYmIHRoYXQuaGVscGVyKSB7CgkJCXRoYXQuaGVscGVyLmdldCgwKS5yZW1vdmVDaGlsZCh0aGF0Lmdob3N0LmdldCgwKSk7CgkJfQoJfQoKfSk7CgokLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsICJncmlkIiwgewoKCXJlc2l6ZTogZnVuY3Rpb24oKSB7CgkJdmFyIG91dGVyRGltZW5zaW9ucywKCQkJdGhhdCA9ICQodGhpcykucmVzaXphYmxlKCAiaW5zdGFuY2UiICksCgkJCW8gPSB0aGF0Lm9wdGlvbnMsCgkJCWNzID0gdGhhdC5zaXplLAoJCQlvcyA9IHRoYXQub3JpZ2luYWxTaXplLAoJCQlvcCA9IHRoYXQub3JpZ2luYWxQb3NpdGlvbiwKCQkJYSA9IHRoYXQuYXhpcywKCQkJZ3JpZCA9IHR5cGVvZiBvLmdyaWQgPT09ICJudW1iZXIiID8gWyBvLmdyaWQsIG8uZ3JpZCBdIDogby5ncmlkLAoJCQlncmlkWCA9IChncmlkWzBdIHx8IDEpLAoJCQlncmlkWSA9IChncmlkWzFdIHx8IDEpLAoJCQlveCA9IE1hdGgucm91bmQoKGNzLndpZHRoIC0gb3Mud2lkdGgpIC8gZ3JpZFgpICogZ3JpZFgsCgkJCW95ID0gTWF0aC5yb3VuZCgoY3MuaGVpZ2h0IC0gb3MuaGVpZ2h0KSAvIGdyaWRZKSAqIGdyaWRZLAoJCQluZXdXaWR0aCA9IG9zLndpZHRoICsgb3gsCgkJCW5ld0hlaWdodCA9IG9zLmhlaWdodCArIG95LAoJCQlpc01heFdpZHRoID0gby5tYXhXaWR0aCAmJiAoby5tYXhXaWR0aCA8IG5ld1dpZHRoKSwKCQkJaXNNYXhIZWlnaHQgPSBvLm1heEhlaWdodCAmJiAoby5tYXhIZWlnaHQgPCBuZXdIZWlnaHQpLAoJCQlpc01pbldpZHRoID0gby5taW5XaWR0aCAmJiAoby5taW5XaWR0aCA+IG5ld1dpZHRoKSwKCQkJaXNNaW5IZWlnaHQgPSBvLm1pbkhlaWdodCAmJiAoby5taW5IZWlnaHQgPiBuZXdIZWlnaHQpOwoKCQlvLmdyaWQgPSBncmlkOwoKCQlpZiAoaXNNaW5XaWR0aCkgewoJCQluZXdXaWR0aCArPSBncmlkWDsKCQl9CgkJaWYgKGlzTWluSGVpZ2h0KSB7CgkJCW5ld0hlaWdodCArPSBncmlkWTsKCQl9CgkJaWYgKGlzTWF4V2lkdGgpIHsKCQkJbmV3V2lkdGggLT0gZ3JpZFg7CgkJfQoJCWlmIChpc01heEhlaWdodCkgewoJCQluZXdIZWlnaHQgLT0gZ3JpZFk7CgkJfQoKCQlpZiAoL14oc2V8c3xlKSQvLnRlc3QoYSkpIHsKCQkJdGhhdC5zaXplLndpZHRoID0gbmV3V2lkdGg7CgkJCXRoYXQuc2l6ZS5oZWlnaHQgPSBuZXdIZWlnaHQ7CgkJfSBlbHNlIGlmICgvXihuZSkkLy50ZXN0KGEpKSB7CgkJCXRoYXQuc2l6ZS53aWR0aCA9IG5ld1dpZHRoOwoJCQl0aGF0LnNpemUuaGVpZ2h0ID0gbmV3SGVpZ2h0OwoJCQl0aGF0LnBvc2l0aW9uLnRvcCA9IG9wLnRvcCAtIG95OwoJCX0gZWxzZSBpZiAoL14oc3cpJC8udGVzdChhKSkgewoJCQl0aGF0LnNpemUud2lkdGggPSBuZXdXaWR0aDsKCQkJdGhhdC5zaXplLmhlaWdodCA9IG5ld0hlaWdodDsKCQkJdGhhdC5wb3NpdGlvbi5sZWZ0ID0gb3AubGVmdCAtIG94OwoJCX0gZWxzZSB7CgkJCWlmICggbmV3SGVpZ2h0IC0gZ3JpZFkgPD0gMCB8fCBuZXdXaWR0aCAtIGdyaWRYIDw9IDApIHsKCQkJCW91dGVyRGltZW5zaW9ucyA9IHRoYXQuX2dldFBhZGRpbmdQbHVzQm9yZGVyRGltZW5zaW9ucyggdGhpcyApOwoJCQl9CgoJCQlpZiAoIG5ld0hlaWdodCAtIGdyaWRZID4gMCApIHsKCQkJCXRoYXQuc2l6ZS5oZWlnaHQgPSBuZXdIZWlnaHQ7CgkJCQl0aGF0LnBvc2l0aW9uLnRvcCA9IG9wLnRvcCAtIG95OwoJCQl9IGVsc2UgewoJCQkJbmV3SGVpZ2h0ID0gZ3JpZFkgLSBvdXRlckRpbWVuc2lvbnMuaGVpZ2h0OwoJCQkJdGhhdC5zaXplLmhlaWdodCA9IG5ld0hlaWdodDsKCQkJCXRoYXQucG9zaXRpb24udG9wID0gb3AudG9wICsgb3MuaGVpZ2h0IC0gbmV3SGVpZ2h0OwoJCQl9CgkJCWlmICggbmV3V2lkdGggLSBncmlkWCA+IDAgKSB7CgkJCQl0aGF0LnNpemUud2lkdGggPSBuZXdXaWR0aDsKCQkJCXRoYXQucG9zaXRpb24ubGVmdCA9IG9wLmxlZnQgLSBveDsKCQkJfSBlbHNlIHsKCQkJCW5ld1dpZHRoID0gZ3JpZFkgLSBvdXRlckRpbWVuc2lvbnMuaGVpZ2h0OwoJCQkJdGhhdC5zaXplLndpZHRoID0gbmV3V2lkdGg7CgkJCQl0aGF0LnBvc2l0aW9uLmxlZnQgPSBvcC5sZWZ0ICsgb3Mud2lkdGggLSBuZXdXaWR0aDsKCQkJfQoJCX0KCX0KCn0pOwoKdmFyIHJlc2l6YWJsZSA9ICQudWkucmVzaXphYmxlOwoKCi8qIQogKiBqUXVlcnkgVUkgRGlhbG9nIDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL2RpYWxvZy8KICovCgoKdmFyIGRpYWxvZyA9ICQud2lkZ2V0KCAidWkuZGlhbG9nIiwgewoJdmVyc2lvbjogIjEuMTEuMSIsCglvcHRpb25zOiB7CgkJYXBwZW5kVG86ICJib2R5IiwKCQlhdXRvT3BlbjogdHJ1ZSwKCQlidXR0b25zOiBbXSwKCQljbG9zZU9uRXNjYXBlOiB0cnVlLAoJCWNsb3NlVGV4dDogIkNsb3NlIiwKCQlkaWFsb2dDbGFzczogIiIsCgkJZHJhZ2dhYmxlOiB0cnVlLAoJCWhpZGU6IG51bGwsCgkJaGVpZ2h0OiAiYXV0byIsCgkJbWF4SGVpZ2h0OiBudWxsLAoJCW1heFdpZHRoOiBudWxsLAoJCW1pbkhlaWdodDogMTUwLAoJCW1pbldpZHRoOiAxNTAsCgkJbW9kYWw6IGZhbHNlLAoJCXBvc2l0aW9uOiB7CgkJCW15OiAiY2VudGVyIiwKCQkJYXQ6ICJjZW50ZXIiLAoJCQlvZjogd2luZG93LAoJCQljb2xsaXNpb246ICJmaXQiLAoJCQkvLyBFbnN1cmUgdGhlIHRpdGxlYmFyIGlzIGFsd2F5cyB2aXNpYmxlCgkJCXVzaW5nOiBmdW5jdGlvbiggcG9zICkgewoJCQkJdmFyIHRvcE9mZnNldCA9ICQoIHRoaXMgKS5jc3MoIHBvcyApLm9mZnNldCgpLnRvcDsKCQkJCWlmICggdG9wT2Zmc2V0IDwgMCApIHsKCQkJCQkkKCB0aGlzICkuY3NzKCAidG9wIiwgcG9zLnRvcCAtIHRvcE9mZnNldCApOwoJCQkJfQoJCQl9CgkJfSwKCQlyZXNpemFibGU6IHRydWUsCgkJc2hvdzogbnVsbCwKCQl0aXRsZTogbnVsbCwKCQl3aWR0aDogMzAwLAoKCQkvLyBjYWxsYmFja3MKCQliZWZvcmVDbG9zZTogbnVsbCwKCQljbG9zZTogbnVsbCwKCQlkcmFnOiBudWxsLAoJCWRyYWdTdGFydDogbnVsbCwKCQlkcmFnU3RvcDogbnVsbCwKCQlmb2N1czogbnVsbCwKCQlvcGVuOiBudWxsLAoJCXJlc2l6ZTogbnVsbCwKCQlyZXNpemVTdGFydDogbnVsbCwKCQlyZXNpemVTdG9wOiBudWxsCgl9LAoKCXNpemVSZWxhdGVkT3B0aW9uczogewoJCWJ1dHRvbnM6IHRydWUsCgkJaGVpZ2h0OiB0cnVlLAoJCW1heEhlaWdodDogdHJ1ZSwKCQltYXhXaWR0aDogdHJ1ZSwKCQltaW5IZWlnaHQ6IHRydWUsCgkJbWluV2lkdGg6IHRydWUsCgkJd2lkdGg6IHRydWUKCX0sCgoJcmVzaXphYmxlUmVsYXRlZE9wdGlvbnM6IHsKCQltYXhIZWlnaHQ6IHRydWUsCgkJbWF4V2lkdGg6IHRydWUsCgkJbWluSGVpZ2h0OiB0cnVlLAoJCW1pbldpZHRoOiB0cnVlCgl9LAoKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoJCXRoaXMub3JpZ2luYWxDc3MgPSB7CgkJCWRpc3BsYXk6IHRoaXMuZWxlbWVudFsgMCBdLnN0eWxlLmRpc3BsYXksCgkJCXdpZHRoOiB0aGlzLmVsZW1lbnRbIDAgXS5zdHlsZS53aWR0aCwKCQkJbWluSGVpZ2h0OiB0aGlzLmVsZW1lbnRbIDAgXS5zdHlsZS5taW5IZWlnaHQsCgkJCW1heEhlaWdodDogdGhpcy5lbGVtZW50WyAwIF0uc3R5bGUubWF4SGVpZ2h0LAoJCQloZWlnaHQ6IHRoaXMuZWxlbWVudFsgMCBdLnN0eWxlLmhlaWdodAoJCX07CgkJdGhpcy5vcmlnaW5hbFBvc2l0aW9uID0gewoJCQlwYXJlbnQ6IHRoaXMuZWxlbWVudC5wYXJlbnQoKSwKCQkJaW5kZXg6IHRoaXMuZWxlbWVudC5wYXJlbnQoKS5jaGlsZHJlbigpLmluZGV4KCB0aGlzLmVsZW1lbnQgKQoJCX07CgkJdGhpcy5vcmlnaW5hbFRpdGxlID0gdGhpcy5lbGVtZW50LmF0dHIoICJ0aXRsZSIgKTsKCQl0aGlzLm9wdGlvbnMudGl0bGUgPSB0aGlzLm9wdGlvbnMudGl0bGUgfHwgdGhpcy5vcmlnaW5hbFRpdGxlOwoKCQl0aGlzLl9jcmVhdGVXcmFwcGVyKCk7CgoJCXRoaXMuZWxlbWVudAoJCQkuc2hvdygpCgkJCS5yZW1vdmVBdHRyKCAidGl0bGUiICkKCQkJLmFkZENsYXNzKCAidWktZGlhbG9nLWNvbnRlbnQgdWktd2lkZ2V0LWNvbnRlbnQiICkKCQkJLmFwcGVuZFRvKCB0aGlzLnVpRGlhbG9nICk7CgoJCXRoaXMuX2NyZWF0ZVRpdGxlYmFyKCk7CgkJdGhpcy5fY3JlYXRlQnV0dG9uUGFuZSgpOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5kcmFnZ2FibGUgJiYgJC5mbi5kcmFnZ2FibGUgKSB7CgkJCXRoaXMuX21ha2VEcmFnZ2FibGUoKTsKCQl9CgkJaWYgKCB0aGlzLm9wdGlvbnMucmVzaXphYmxlICYmICQuZm4ucmVzaXphYmxlICkgewoJCQl0aGlzLl9tYWtlUmVzaXphYmxlKCk7CgkJfQoKCQl0aGlzLl9pc09wZW4gPSBmYWxzZTsKCgkJdGhpcy5fdHJhY2tGb2N1cygpOwoJfSwKCglfaW5pdDogZnVuY3Rpb24oKSB7CgkJaWYgKCB0aGlzLm9wdGlvbnMuYXV0b09wZW4gKSB7CgkJCXRoaXMub3BlbigpOwoJCX0KCX0sCgoJX2FwcGVuZFRvOiBmdW5jdGlvbigpIHsKCQl2YXIgZWxlbWVudCA9IHRoaXMub3B0aW9ucy5hcHBlbmRUbzsKCQlpZiAoIGVsZW1lbnQgJiYgKGVsZW1lbnQuanF1ZXJ5IHx8IGVsZW1lbnQubm9kZVR5cGUpICkgewoJCQlyZXR1cm4gJCggZWxlbWVudCApOwoJCX0KCQlyZXR1cm4gdGhpcy5kb2N1bWVudC5maW5kKCBlbGVtZW50IHx8ICJib2R5IiApLmVxKCAwICk7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQl2YXIgbmV4dCwKCQkJb3JpZ2luYWxQb3NpdGlvbiA9IHRoaXMub3JpZ2luYWxQb3NpdGlvbjsKCgkJdGhpcy5fZGVzdHJveU92ZXJsYXkoKTsKCgkJdGhpcy5lbGVtZW50CgkJCS5yZW1vdmVVbmlxdWVJZCgpCgkJCS5yZW1vdmVDbGFzcyggInVpLWRpYWxvZy1jb250ZW50IHVpLXdpZGdldC1jb250ZW50IiApCgkJCS5jc3MoIHRoaXMub3JpZ2luYWxDc3MgKQoJCQkvLyBXaXRob3V0IGRldGFjaGluZyBmaXJzdCwgdGhlIGZvbGxvd2luZyBiZWNvbWVzIHJlYWxseSBzbG93CgkJCS5kZXRhY2goKTsKCgkJdGhpcy51aURpYWxvZy5zdG9wKCB0cnVlLCB0cnVlICkucmVtb3ZlKCk7CgoJCWlmICggdGhpcy5vcmlnaW5hbFRpdGxlICkgewoJCQl0aGlzLmVsZW1lbnQuYXR0ciggInRpdGxlIiwgdGhpcy5vcmlnaW5hbFRpdGxlICk7CgkJfQoKCQluZXh0ID0gb3JpZ2luYWxQb3NpdGlvbi5wYXJlbnQuY2hpbGRyZW4oKS5lcSggb3JpZ2luYWxQb3NpdGlvbi5pbmRleCApOwoJCS8vIERvbid0IHRyeSB0byBwbGFjZSB0aGUgZGlhbG9nIG5leHQgdG8gaXRzZWxmICgjODYxMykKCQlpZiAoIG5leHQubGVuZ3RoICYmIG5leHRbIDAgXSAhPT0gdGhpcy5lbGVtZW50WyAwIF0gKSB7CgkJCW5leHQuYmVmb3JlKCB0aGlzLmVsZW1lbnQgKTsKCQl9IGVsc2UgewoJCQlvcmlnaW5hbFBvc2l0aW9uLnBhcmVudC5hcHBlbmQoIHRoaXMuZWxlbWVudCApOwoJCX0KCX0sCgoJd2lkZ2V0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy51aURpYWxvZzsKCX0sCgoJZGlzYWJsZTogJC5ub29wLAoJZW5hYmxlOiAkLm5vb3AsCgoJY2xvc2U6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgYWN0aXZlRWxlbWVudCwKCQkJdGhhdCA9IHRoaXM7CgoJCWlmICggIXRoaXMuX2lzT3BlbiB8fCB0aGlzLl90cmlnZ2VyKCAiYmVmb3JlQ2xvc2UiLCBldmVudCApID09PSBmYWxzZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5faXNPcGVuID0gZmFsc2U7CgkJdGhpcy5fZm9jdXNlZEVsZW1lbnQgPSBudWxsOwoJCXRoaXMuX2Rlc3Ryb3lPdmVybGF5KCk7CgkJdGhpcy5fdW50cmFja0luc3RhbmNlKCk7CgoJCWlmICggIXRoaXMub3BlbmVyLmZpbHRlciggIjpmb2N1c2FibGUiICkuZm9jdXMoKS5sZW5ndGggKSB7CgoJCQkvLyBzdXBwb3J0OiBJRTkKCQkJLy8gSUU5IHRocm93cyBhbiAiVW5zcGVjaWZpZWQgZXJyb3IiIGFjY2Vzc2luZyBkb2N1bWVudC5hY3RpdmVFbGVtZW50IGZyb20gYW4gPGlmcmFtZT4KCQkJdHJ5IHsKCQkJCWFjdGl2ZUVsZW1lbnQgPSB0aGlzLmRvY3VtZW50WyAwIF0uYWN0aXZlRWxlbWVudDsKCgkJCQkvLyBTdXBwb3J0OiBJRTksIElFMTAKCQkJCS8vIElmIHRoZSA8Ym9keT4gaXMgYmx1cnJlZCwgSUUgd2lsbCBzd2l0Y2ggd2luZG93cywgc2VlICM0NTIwCgkJCQlpZiAoIGFjdGl2ZUVsZW1lbnQgJiYgYWN0aXZlRWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAiYm9keSIgKSB7CgoJCQkJCS8vIEhpZGluZyBhIGZvY3VzZWQgZWxlbWVudCBkb2Vzbid0IHRyaWdnZXIgYmx1ciBpbiBXZWJLaXQKCQkJCQkvLyBzbyBpbiBjYXNlIHdlIGhhdmUgbm90aGluZyB0byBmb2N1cyBvbiwgZXhwbGljaXRseSBibHVyIHRoZSBhY3RpdmUgZWxlbWVudAoJCQkJCS8vIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD00NzE4MgoJCQkJCSQoIGFjdGl2ZUVsZW1lbnQgKS5ibHVyKCk7CgkJCQl9CgkJCX0gY2F0Y2ggKCBlcnJvciApIHt9CgkJfQoKCQl0aGlzLl9oaWRlKCB0aGlzLnVpRGlhbG9nLCB0aGlzLm9wdGlvbnMuaGlkZSwgZnVuY3Rpb24oKSB7CgkJCXRoYXQuX3RyaWdnZXIoICJjbG9zZSIsIGV2ZW50ICk7CgkJfSk7Cgl9LAoKCWlzT3BlbjogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuX2lzT3BlbjsKCX0sCgoJbW92ZVRvVG9wOiBmdW5jdGlvbigpIHsKCQl0aGlzLl9tb3ZlVG9Ub3AoKTsKCX0sCgoJX21vdmVUb1RvcDogZnVuY3Rpb24oIGV2ZW50LCBzaWxlbnQgKSB7CgkJdmFyIG1vdmVkID0gZmFsc2UsCgkJCXpJbmRpY2llcyA9IHRoaXMudWlEaWFsb2cuc2libGluZ3MoICIudWktZnJvbnQ6dmlzaWJsZSIgKS5tYXAoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gKyQoIHRoaXMgKS5jc3MoICJ6LWluZGV4IiApOwoJCQl9KS5nZXQoKSwKCQkJekluZGV4TWF4ID0gTWF0aC5tYXguYXBwbHkoIG51bGwsIHpJbmRpY2llcyApOwoKCQlpZiAoIHpJbmRleE1heCA+PSArdGhpcy51aURpYWxvZy5jc3MoICJ6LWluZGV4IiApICkgewoJCQl0aGlzLnVpRGlhbG9nLmNzcyggInotaW5kZXgiLCB6SW5kZXhNYXggKyAxICk7CgkJCW1vdmVkID0gdHJ1ZTsKCQl9CgoJCWlmICggbW92ZWQgJiYgIXNpbGVudCApIHsKCQkJdGhpcy5fdHJpZ2dlciggImZvY3VzIiwgZXZlbnQgKTsKCQl9CgkJcmV0dXJuIG1vdmVkOwoJfSwKCglvcGVuOiBmdW5jdGlvbigpIHsKCQl2YXIgdGhhdCA9IHRoaXM7CgkJaWYgKCB0aGlzLl9pc09wZW4gKSB7CgkJCWlmICggdGhpcy5fbW92ZVRvVG9wKCkgKSB7CgkJCQl0aGlzLl9mb2N1c1RhYmJhYmxlKCk7CgkJCX0KCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5faXNPcGVuID0gdHJ1ZTsKCQl0aGlzLm9wZW5lciA9ICQoIHRoaXMuZG9jdW1lbnRbIDAgXS5hY3RpdmVFbGVtZW50ICk7CgoJCXRoaXMuX3NpemUoKTsKCQl0aGlzLl9wb3NpdGlvbigpOwoJCXRoaXMuX2NyZWF0ZU92ZXJsYXkoKTsKCQl0aGlzLl9tb3ZlVG9Ub3AoIG51bGwsIHRydWUgKTsKCgkJLy8gRW5zdXJlIHRoZSBvdmVybGF5IGlzIG1vdmVkIHRvIHRoZSB0b3Agd2l0aCB0aGUgZGlhbG9nLCBidXQgb25seSB3aGVuCgkJLy8gb3BlbmluZy4gVGhlIG92ZXJsYXkgc2hvdWxkbid0IG1vdmUgYWZ0ZXIgdGhlIGRpYWxvZyBpcyBvcGVuIHNvIHRoYXQKCQkvLyBtb2RlbGVzcyBkaWFsb2dzIG9wZW5lZCBhZnRlciB0aGUgbW9kYWwgZGlhbG9nIHN0YWNrIHByb3Blcmx5LgoJCWlmICggdGhpcy5vdmVybGF5ICkgewoJCQl0aGlzLm92ZXJsYXkuY3NzKCAiei1pbmRleCIsIHRoaXMudWlEaWFsb2cuY3NzKCAiei1pbmRleCIgKSAtIDEgKTsKCQl9CgoJCXRoaXMuX3Nob3coIHRoaXMudWlEaWFsb2csIHRoaXMub3B0aW9ucy5zaG93LCBmdW5jdGlvbigpIHsKCQkJdGhhdC5fZm9jdXNUYWJiYWJsZSgpOwoJCQl0aGF0Ll90cmlnZ2VyKCAiZm9jdXMiICk7CgkJfSk7CgoJCS8vIFRyYWNrIHRoZSBkaWFsb2cgaW1tZWRpYXRlbHkgdXBvbiBvcGVuZW5pbmcgaW4gY2FzZSBhIGZvY3VzIGV2ZW50CgkJLy8gc29tZWhvdyBvY2N1cnMgb3V0c2lkZSBvZiB0aGUgZGlhbG9nIGJlZm9yZSBhbiBlbGVtZW50IGluc2lkZSB0aGUKCQkvLyBkaWFsb2cgaXMgZm9jdXNlZCAoIzEwMTUyKQoJCXRoaXMuX21ha2VGb2N1c1RhcmdldCgpOwoKCQl0aGlzLl90cmlnZ2VyKCAib3BlbiIgKTsKCX0sCgoJX2ZvY3VzVGFiYmFibGU6IGZ1bmN0aW9uKCkgewoJCS8vIFNldCBmb2N1cyB0byB0aGUgZmlyc3QgbWF0Y2g6CgkJLy8gMS4gQW4gZWxlbWVudCB0aGF0IHdhcyBmb2N1c2VkIHByZXZpb3VzbHkKCQkvLyAyLiBGaXJzdCBlbGVtZW50IGluc2lkZSB0aGUgZGlhbG9nIG1hdGNoaW5nIFthdXRvZm9jdXNdCgkJLy8gMy4gVGFiYmFibGUgZWxlbWVudCBpbnNpZGUgdGhlIGNvbnRlbnQgZWxlbWVudAoJCS8vIDQuIFRhYmJhYmxlIGVsZW1lbnQgaW5zaWRlIHRoZSBidXR0b25wYW5lCgkJLy8gNS4gVGhlIGNsb3NlIGJ1dHRvbgoJCS8vIDYuIFRoZSBkaWFsb2cgaXRzZWxmCgkJdmFyIGhhc0ZvY3VzID0gdGhpcy5fZm9jdXNlZEVsZW1lbnQ7CgkJaWYgKCAhaGFzRm9jdXMgKSB7CgkJCWhhc0ZvY3VzID0gdGhpcy5lbGVtZW50LmZpbmQoICJbYXV0b2ZvY3VzXSIgKTsKCQl9CgkJaWYgKCAhaGFzRm9jdXMubGVuZ3RoICkgewoJCQloYXNGb2N1cyA9IHRoaXMuZWxlbWVudC5maW5kKCAiOnRhYmJhYmxlIiApOwoJCX0KCQlpZiAoICFoYXNGb2N1cy5sZW5ndGggKSB7CgkJCWhhc0ZvY3VzID0gdGhpcy51aURpYWxvZ0J1dHRvblBhbmUuZmluZCggIjp0YWJiYWJsZSIgKTsKCQl9CgkJaWYgKCAhaGFzRm9jdXMubGVuZ3RoICkgewoJCQloYXNGb2N1cyA9IHRoaXMudWlEaWFsb2dUaXRsZWJhckNsb3NlLmZpbHRlciggIjp0YWJiYWJsZSIgKTsKCQl9CgkJaWYgKCAhaGFzRm9jdXMubGVuZ3RoICkgewoJCQloYXNGb2N1cyA9IHRoaXMudWlEaWFsb2c7CgkJfQoJCWhhc0ZvY3VzLmVxKCAwICkuZm9jdXMoKTsKCX0sCgoJX2tlZXBGb2N1czogZnVuY3Rpb24oIGV2ZW50ICkgewoJCWZ1bmN0aW9uIGNoZWNrRm9jdXMoKSB7CgkJCXZhciBhY3RpdmVFbGVtZW50ID0gdGhpcy5kb2N1bWVudFswXS5hY3RpdmVFbGVtZW50LAoJCQkJaXNBY3RpdmUgPSB0aGlzLnVpRGlhbG9nWzBdID09PSBhY3RpdmVFbGVtZW50IHx8CgkJCQkJJC5jb250YWlucyggdGhpcy51aURpYWxvZ1swXSwgYWN0aXZlRWxlbWVudCApOwoJCQlpZiAoICFpc0FjdGl2ZSApIHsKCQkJCXRoaXMuX2ZvY3VzVGFiYmFibGUoKTsKCQkJfQoJCX0KCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCWNoZWNrRm9jdXMuY2FsbCggdGhpcyApOwoJCS8vIHN1cHBvcnQ6IElFCgkJLy8gSUUgPD0gOCBkb2Vzbid0IHByZXZlbnQgbW92aW5nIGZvY3VzIGV2ZW4gd2l0aCBldmVudC5wcmV2ZW50RGVmYXVsdCgpCgkJLy8gc28gd2UgY2hlY2sgYWdhaW4gbGF0ZXIKCQl0aGlzLl9kZWxheSggY2hlY2tGb2N1cyApOwoJfSwKCglfY3JlYXRlV3JhcHBlcjogZnVuY3Rpb24oKSB7CgkJdGhpcy51aURpYWxvZyA9ICQoIjxkaXY+IikKCQkJLmFkZENsYXNzKCAidWktZGlhbG9nIHVpLXdpZGdldCB1aS1mcm9udCAiICsKCQkJCXRoaXMub3B0aW9ucy5kaWFsb2dDbGFzcyApCgkJCS5oaWRlKCkKCQkJLmF0dHIoewoJCQkJLy8gU2V0dGluZyB0YWJJbmRleCBtYWtlcyB0aGUgZGl2IGZvY3VzYWJsZQoJCQkJdGFiSW5kZXg6IC0xLAoJCQkJcm9sZTogImRpYWxvZyIKCQkJfSkKCQkJLmFwcGVuZFRvKCB0aGlzLl9hcHBlbmRUbygpICk7CgoJCXRoaXMuX29uKCB0aGlzLnVpRGlhbG9nLCB7CgkJCWtleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWlmICggdGhpcy5vcHRpb25zLmNsb3NlT25Fc2NhcGUgJiYgIWV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpICYmIGV2ZW50LmtleUNvZGUgJiYKCQkJCQkJZXZlbnQua2V5Q29kZSA9PT0gJC51aS5rZXlDb2RlLkVTQ0FQRSApIHsKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCXRoaXMuY2xvc2UoIGV2ZW50ICk7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCS8vIHByZXZlbnQgdGFiYmluZyBvdXQgb2YgZGlhbG9ncwoJCQkJaWYgKCBldmVudC5rZXlDb2RlICE9PSAkLnVpLmtleUNvZGUuVEFCIHx8IGV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpICkgewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCXZhciB0YWJiYWJsZXMgPSB0aGlzLnVpRGlhbG9nLmZpbmQoICI6dGFiYmFibGUiICksCgkJCQkJZmlyc3QgPSB0YWJiYWJsZXMuZmlsdGVyKCAiOmZpcnN0IiApLAoJCQkJCWxhc3QgPSB0YWJiYWJsZXMuZmlsdGVyKCAiOmxhc3QiICk7CgoJCQkJaWYgKCAoIGV2ZW50LnRhcmdldCA9PT0gbGFzdFswXSB8fCBldmVudC50YXJnZXQgPT09IHRoaXMudWlEaWFsb2dbMF0gKSAmJiAhZXZlbnQuc2hpZnRLZXkgKSB7CgkJCQkJdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CgkJCQkJCWZpcnN0LmZvY3VzKCk7CgkJCQkJfSk7CgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCX0gZWxzZSBpZiAoICggZXZlbnQudGFyZ2V0ID09PSBmaXJzdFswXSB8fCBldmVudC50YXJnZXQgPT09IHRoaXMudWlEaWFsb2dbMF0gKSAmJiBldmVudC5zaGlmdEtleSApIHsKCQkJCQl0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJCQkJbGFzdC5mb2N1cygpOwoJCQkJCX0pOwoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQl9CgkJCX0sCgkJCW1vdXNlZG93bjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJaWYgKCB0aGlzLl9tb3ZlVG9Ub3AoIGV2ZW50ICkgKSB7CgkJCQkJdGhpcy5fZm9jdXNUYWJiYWJsZSgpOwoJCQkJfQoJCQl9CgkJfSk7CgoJCS8vIFdlIGFzc3VtZSB0aGF0IGFueSBleGlzdGluZyBhcmlhLWRlc2NyaWJlZGJ5IGF0dHJpYnV0ZSBtZWFucwoJCS8vIHRoYXQgdGhlIGRpYWxvZyBjb250ZW50IGlzIG1hcmtlZCB1cCBwcm9wZXJseQoJCS8vIG90aGVyd2lzZSB3ZSBicnV0ZSBmb3JjZSB0aGUgY29udGVudCBhcyB0aGUgZGVzY3JpcHRpb24KCQlpZiAoICF0aGlzLmVsZW1lbnQuZmluZCggIlthcmlhLWRlc2NyaWJlZGJ5XSIgKS5sZW5ndGggKSB7CgkJCXRoaXMudWlEaWFsb2cuYXR0cih7CgkJCQkiYXJpYS1kZXNjcmliZWRieSI6IHRoaXMuZWxlbWVudC51bmlxdWVJZCgpLmF0dHIoICJpZCIgKQoJCQl9KTsKCQl9Cgl9LAoKCV9jcmVhdGVUaXRsZWJhcjogZnVuY3Rpb24oKSB7CgkJdmFyIHVpRGlhbG9nVGl0bGU7CgoJCXRoaXMudWlEaWFsb2dUaXRsZWJhciA9ICQoICI8ZGl2PiIgKQoJCQkuYWRkQ2xhc3MoICJ1aS1kaWFsb2ctdGl0bGViYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYWxsIHVpLWhlbHBlci1jbGVhcmZpeCIgKQoJCQkucHJlcGVuZFRvKCB0aGlzLnVpRGlhbG9nICk7CgkJdGhpcy5fb24oIHRoaXMudWlEaWFsb2dUaXRsZWJhciwgewoJCQltb3VzZWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCS8vIERvbid0IHByZXZlbnQgY2xpY2sgb24gY2xvc2UgYnV0dG9uICgjODgzOCkKCQkJCS8vIEZvY3VzaW5nIGEgZGlhbG9nIHRoYXQgaXMgcGFydGlhbGx5IHNjcm9sbGVkIG91dCBvZiB2aWV3CgkJCQkvLyBjYXVzZXMgdGhlIGJyb3dzZXIgdG8gc2Nyb2xsIGl0IGludG8gdmlldywgcHJldmVudGluZyB0aGUgY2xpY2sgZXZlbnQKCQkJCWlmICggISQoIGV2ZW50LnRhcmdldCApLmNsb3Nlc3QoICIudWktZGlhbG9nLXRpdGxlYmFyLWNsb3NlIiApICkgewoJCQkJCS8vIERpYWxvZyBpc24ndCBnZXR0aW5nIGZvY3VzIHdoZW4gZHJhZ2dpbmcgKCM4MDYzKQoJCQkJCXRoaXMudWlEaWFsb2cuZm9jdXMoKTsKCQkJCX0KCQkJfQoJCX0pOwoKCQkvLyBzdXBwb3J0OiBJRQoJCS8vIFVzZSB0eXBlPSJidXR0b24iIHRvIHByZXZlbnQgZW50ZXIga2V5cHJlc3NlcyBpbiB0ZXh0Ym94ZXMgZnJvbSBjbG9zaW5nIHRoZQoJCS8vIGRpYWxvZyBpbiBJRSAoIzkzMTIpCgkJdGhpcy51aURpYWxvZ1RpdGxlYmFyQ2xvc2UgPSAkKCAiPGJ1dHRvbiB0eXBlPSdidXR0b24nPjwvYnV0dG9uPiIgKQoJCQkuYnV0dG9uKHsKCQkJCWxhYmVsOiB0aGlzLm9wdGlvbnMuY2xvc2VUZXh0LAoJCQkJaWNvbnM6IHsKCQkJCQlwcmltYXJ5OiAidWktaWNvbi1jbG9zZXRoaWNrIgoJCQkJfSwKCQkJCXRleHQ6IGZhbHNlCgkJCX0pCgkJCS5hZGRDbGFzcyggInVpLWRpYWxvZy10aXRsZWJhci1jbG9zZSIgKQoJCQkuYXBwZW5kVG8oIHRoaXMudWlEaWFsb2dUaXRsZWJhciApOwoJCXRoaXMuX29uKCB0aGlzLnVpRGlhbG9nVGl0bGViYXJDbG9zZSwgewoJCQljbGljazogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCXRoaXMuY2xvc2UoIGV2ZW50ICk7CgkJCX0KCQl9KTsKCgkJdWlEaWFsb2dUaXRsZSA9ICQoICI8c3Bhbj4iICkKCQkJLnVuaXF1ZUlkKCkKCQkJLmFkZENsYXNzKCAidWktZGlhbG9nLXRpdGxlIiApCgkJCS5wcmVwZW5kVG8oIHRoaXMudWlEaWFsb2dUaXRsZWJhciApOwoJCXRoaXMuX3RpdGxlKCB1aURpYWxvZ1RpdGxlICk7CgoJCXRoaXMudWlEaWFsb2cuYXR0cih7CgkJCSJhcmlhLWxhYmVsbGVkYnkiOiB1aURpYWxvZ1RpdGxlLmF0dHIoICJpZCIgKQoJCX0pOwoJfSwKCglfdGl0bGU6IGZ1bmN0aW9uKCB0aXRsZSApIHsKCQlpZiAoICF0aGlzLm9wdGlvbnMudGl0bGUgKSB7CgkJCXRpdGxlLmh0bWwoICImIzE2MDsiICk7CgkJfQoJCXRpdGxlLnRleHQoIHRoaXMub3B0aW9ucy50aXRsZSApOwoJfSwKCglfY3JlYXRlQnV0dG9uUGFuZTogZnVuY3Rpb24oKSB7CgkJdGhpcy51aURpYWxvZ0J1dHRvblBhbmUgPSAkKCAiPGRpdj4iICkKCQkJLmFkZENsYXNzKCAidWktZGlhbG9nLWJ1dHRvbnBhbmUgdWktd2lkZ2V0LWNvbnRlbnQgdWktaGVscGVyLWNsZWFyZml4IiApOwoKCQl0aGlzLnVpQnV0dG9uU2V0ID0gJCggIjxkaXY+IiApCgkJCS5hZGRDbGFzcyggInVpLWRpYWxvZy1idXR0b25zZXQiICkKCQkJLmFwcGVuZFRvKCB0aGlzLnVpRGlhbG9nQnV0dG9uUGFuZSApOwoKCQl0aGlzLl9jcmVhdGVCdXR0b25zKCk7Cgl9LAoKCV9jcmVhdGVCdXR0b25zOiBmdW5jdGlvbigpIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCWJ1dHRvbnMgPSB0aGlzLm9wdGlvbnMuYnV0dG9uczsKCgkJLy8gaWYgd2UgYWxyZWFkeSBoYXZlIGEgYnV0dG9uIHBhbmUsIHJlbW92ZSBpdAoJCXRoaXMudWlEaWFsb2dCdXR0b25QYW5lLnJlbW92ZSgpOwoJCXRoaXMudWlCdXR0b25TZXQuZW1wdHkoKTsKCgkJaWYgKCAkLmlzRW1wdHlPYmplY3QoIGJ1dHRvbnMgKSB8fCAoJC5pc0FycmF5KCBidXR0b25zICkgJiYgIWJ1dHRvbnMubGVuZ3RoKSApIHsKCQkJdGhpcy51aURpYWxvZy5yZW1vdmVDbGFzcyggInVpLWRpYWxvZy1idXR0b25zIiApOwoJCQlyZXR1cm47CgkJfQoKCQkkLmVhY2goIGJ1dHRvbnMsIGZ1bmN0aW9uKCBuYW1lLCBwcm9wcyApIHsKCQkJdmFyIGNsaWNrLCBidXR0b25PcHRpb25zOwoJCQlwcm9wcyA9ICQuaXNGdW5jdGlvbiggcHJvcHMgKSA/CgkJCQl7IGNsaWNrOiBwcm9wcywgdGV4dDogbmFtZSB9IDoKCQkJCXByb3BzOwoJCQkvLyBEZWZhdWx0IHRvIGEgbm9uLXN1Ym1pdHRpbmcgYnV0dG9uCgkJCXByb3BzID0gJC5leHRlbmQoIHsgdHlwZTogImJ1dHRvbiIgfSwgcHJvcHMgKTsKCQkJLy8gQ2hhbmdlIHRoZSBjb250ZXh0IGZvciB0aGUgY2xpY2sgY2FsbGJhY2sgdG8gYmUgdGhlIG1haW4gZWxlbWVudAoJCQljbGljayA9IHByb3BzLmNsaWNrOwoJCQlwcm9wcy5jbGljayA9IGZ1bmN0aW9uKCkgewoJCQkJY2xpY2suYXBwbHkoIHRoYXQuZWxlbWVudFsgMCBdLCBhcmd1bWVudHMgKTsKCQkJfTsKCQkJYnV0dG9uT3B0aW9ucyA9IHsKCQkJCWljb25zOiBwcm9wcy5pY29ucywKCQkJCXRleHQ6IHByb3BzLnNob3dUZXh0CgkJCX07CgkJCWRlbGV0ZSBwcm9wcy5pY29uczsKCQkJZGVsZXRlIHByb3BzLnNob3dUZXh0OwoJCQkkKCAiPGJ1dHRvbj48L2J1dHRvbj4iLCBwcm9wcyApCgkJCQkuYnV0dG9uKCBidXR0b25PcHRpb25zICkKCQkJCS5hcHBlbmRUbyggdGhhdC51aUJ1dHRvblNldCApOwoJCX0pOwoJCXRoaXMudWlEaWFsb2cuYWRkQ2xhc3MoICJ1aS1kaWFsb2ctYnV0dG9ucyIgKTsKCQl0aGlzLnVpRGlhbG9nQnV0dG9uUGFuZS5hcHBlbmRUbyggdGhpcy51aURpYWxvZyApOwoJfSwKCglfbWFrZURyYWdnYWJsZTogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlvcHRpb25zID0gdGhpcy5vcHRpb25zOwoKCQlmdW5jdGlvbiBmaWx0ZXJlZFVpKCB1aSApIHsKCQkJcmV0dXJuIHsKCQkJCXBvc2l0aW9uOiB1aS5wb3NpdGlvbiwKCQkJCW9mZnNldDogdWkub2Zmc2V0CgkJCX07CgkJfQoKCQl0aGlzLnVpRGlhbG9nLmRyYWdnYWJsZSh7CgkJCWNhbmNlbDogIi51aS1kaWFsb2ctY29udGVudCwgLnVpLWRpYWxvZy10aXRsZWJhci1jbG9zZSIsCgkJCWhhbmRsZTogIi51aS1kaWFsb2ctdGl0bGViYXIiLAoJCQljb250YWlubWVudDogImRvY3VtZW50IiwKCQkJc3RhcnQ6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7CgkJCQkkKCB0aGlzICkuYWRkQ2xhc3MoICJ1aS1kaWFsb2ctZHJhZ2dpbmciICk7CgkJCQl0aGF0Ll9ibG9ja0ZyYW1lcygpOwoJCQkJdGhhdC5fdHJpZ2dlciggImRyYWdTdGFydCIsIGV2ZW50LCBmaWx0ZXJlZFVpKCB1aSApICk7CgkJCX0sCgkJCWRyYWc6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7CgkJCQl0aGF0Ll90cmlnZ2VyKCAiZHJhZyIsIGV2ZW50LCBmaWx0ZXJlZFVpKCB1aSApICk7CgkJCX0sCgkJCXN0b3A6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7CgkJCQl2YXIgbGVmdCA9IHVpLm9mZnNldC5sZWZ0IC0gdGhhdC5kb2N1bWVudC5zY3JvbGxMZWZ0KCksCgkJCQkJdG9wID0gdWkub2Zmc2V0LnRvcCAtIHRoYXQuZG9jdW1lbnQuc2Nyb2xsVG9wKCk7CgoJCQkJb3B0aW9ucy5wb3NpdGlvbiA9IHsKCQkJCQlteTogImxlZnQgdG9wIiwKCQkJCQlhdDogImxlZnQiICsgKGxlZnQgPj0gMCA/ICIrIiA6ICIiKSArIGxlZnQgKyAiICIgKwoJCQkJCQkidG9wIiArICh0b3AgPj0gMCA/ICIrIiA6ICIiKSArIHRvcCwKCQkJCQlvZjogdGhhdC53aW5kb3cKCQkJCX07CgkJCQkkKCB0aGlzICkucmVtb3ZlQ2xhc3MoICJ1aS1kaWFsb2ctZHJhZ2dpbmciICk7CgkJCQl0aGF0Ll91bmJsb2NrRnJhbWVzKCk7CgkJCQl0aGF0Ll90cmlnZ2VyKCAiZHJhZ1N0b3AiLCBldmVudCwgZmlsdGVyZWRVaSggdWkgKSApOwoJCQl9CgkJfSk7Cgl9LAoKCV9tYWtlUmVzaXphYmxlOiBmdW5jdGlvbigpIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCW9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCgkJCWhhbmRsZXMgPSBvcHRpb25zLnJlc2l6YWJsZSwKCQkJLy8gLnVpLXJlc2l6YWJsZSBoYXMgcG9zaXRpb246IHJlbGF0aXZlIGRlZmluZWQgaW4gdGhlIHN0eWxlc2hlZXQKCQkJLy8gYnV0IGRpYWxvZ3MgaGF2ZSB0byB1c2UgYWJzb2x1dGUgb3IgZml4ZWQgcG9zaXRpb25pbmcKCQkJcG9zaXRpb24gPSB0aGlzLnVpRGlhbG9nLmNzcygicG9zaXRpb24iKSwKCQkJcmVzaXplSGFuZGxlcyA9IHR5cGVvZiBoYW5kbGVzID09PSAic3RyaW5nIiA/CgkJCQloYW5kbGVzCToKCQkJCSJuLGUscyx3LHNlLHN3LG5lLG53IjsKCgkJZnVuY3Rpb24gZmlsdGVyZWRVaSggdWkgKSB7CgkJCXJldHVybiB7CgkJCQlvcmlnaW5hbFBvc2l0aW9uOiB1aS5vcmlnaW5hbFBvc2l0aW9uLAoJCQkJb3JpZ2luYWxTaXplOiB1aS5vcmlnaW5hbFNpemUsCgkJCQlwb3NpdGlvbjogdWkucG9zaXRpb24sCgkJCQlzaXplOiB1aS5zaXplCgkJCX07CgkJfQoKCQl0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZSh7CgkJCWNhbmNlbDogIi51aS1kaWFsb2ctY29udGVudCIsCgkJCWNvbnRhaW5tZW50OiAiZG9jdW1lbnQiLAoJCQlhbHNvUmVzaXplOiB0aGlzLmVsZW1lbnQsCgkJCW1heFdpZHRoOiBvcHRpb25zLm1heFdpZHRoLAoJCQltYXhIZWlnaHQ6IG9wdGlvbnMubWF4SGVpZ2h0LAoJCQltaW5XaWR0aDogb3B0aW9ucy5taW5XaWR0aCwKCQkJbWluSGVpZ2h0OiB0aGlzLl9taW5IZWlnaHQoKSwKCQkJaGFuZGxlczogcmVzaXplSGFuZGxlcywKCQkJc3RhcnQ6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7CgkJCQkkKCB0aGlzICkuYWRkQ2xhc3MoICJ1aS1kaWFsb2ctcmVzaXppbmciICk7CgkJCQl0aGF0Ll9ibG9ja0ZyYW1lcygpOwoJCQkJdGhhdC5fdHJpZ2dlciggInJlc2l6ZVN0YXJ0IiwgZXZlbnQsIGZpbHRlcmVkVWkoIHVpICkgKTsKCQkJfSwKCQkJcmVzaXplOiBmdW5jdGlvbiggZXZlbnQsIHVpICkgewoJCQkJdGhhdC5fdHJpZ2dlciggInJlc2l6ZSIsIGV2ZW50LCBmaWx0ZXJlZFVpKCB1aSApICk7CgkJCX0sCgkJCXN0b3A6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7CgkJCQl2YXIgb2Zmc2V0ID0gdGhhdC51aURpYWxvZy5vZmZzZXQoKSwKCQkJCQlsZWZ0ID0gb2Zmc2V0LmxlZnQgLSB0aGF0LmRvY3VtZW50LnNjcm9sbExlZnQoKSwKCQkJCQl0b3AgPSBvZmZzZXQudG9wIC0gdGhhdC5kb2N1bWVudC5zY3JvbGxUb3AoKTsKCgkJCQlvcHRpb25zLmhlaWdodCA9IHRoYXQudWlEaWFsb2cuaGVpZ2h0KCk7CgkJCQlvcHRpb25zLndpZHRoID0gdGhhdC51aURpYWxvZy53aWR0aCgpOwoJCQkJb3B0aW9ucy5wb3NpdGlvbiA9IHsKCQkJCQlteTogImxlZnQgdG9wIiwKCQkJCQlhdDogImxlZnQiICsgKGxlZnQgPj0gMCA/ICIrIiA6ICIiKSArIGxlZnQgKyAiICIgKwoJCQkJCQkidG9wIiArICh0b3AgPj0gMCA/ICIrIiA6ICIiKSArIHRvcCwKCQkJCQlvZjogdGhhdC53aW5kb3cKCQkJCX07CgkJCQkkKCB0aGlzICkucmVtb3ZlQ2xhc3MoICJ1aS1kaWFsb2ctcmVzaXppbmciICk7CgkJCQl0aGF0Ll91bmJsb2NrRnJhbWVzKCk7CgkJCQl0aGF0Ll90cmlnZ2VyKCAicmVzaXplU3RvcCIsIGV2ZW50LCBmaWx0ZXJlZFVpKCB1aSApICk7CgkJCX0KCQl9KQoJCS5jc3MoICJwb3NpdGlvbiIsIHBvc2l0aW9uICk7Cgl9LAoKCV90cmFja0ZvY3VzOiBmdW5jdGlvbigpIHsKCQl0aGlzLl9vbiggdGhpcy53aWRnZXQoKSwgewoJCQlmb2N1c2luOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQl0aGlzLl9tYWtlRm9jdXNUYXJnZXQoKTsKCQkJCXRoaXMuX2ZvY3VzZWRFbGVtZW50ID0gJCggZXZlbnQudGFyZ2V0ICk7CgkJCX0KCQl9KTsKCX0sCgoJX21ha2VGb2N1c1RhcmdldDogZnVuY3Rpb24oKSB7CgkJdGhpcy5fdW50cmFja0luc3RhbmNlKCk7CgkJdGhpcy5fdHJhY2tpbmdJbnN0YW5jZXMoKS51bnNoaWZ0KCB0aGlzICk7Cgl9LAoKCV91bnRyYWNrSW5zdGFuY2U6IGZ1bmN0aW9uKCkgewoJCXZhciBpbnN0YW5jZXMgPSB0aGlzLl90cmFja2luZ0luc3RhbmNlcygpLAoJCQlleGlzdHMgPSAkLmluQXJyYXkoIHRoaXMsIGluc3RhbmNlcyApOwoJCWlmICggZXhpc3RzICE9PSAtMSApIHsKCQkJaW5zdGFuY2VzLnNwbGljZSggZXhpc3RzLCAxICk7CgkJfQoJfSwKCglfdHJhY2tpbmdJbnN0YW5jZXM6IGZ1bmN0aW9uKCkgewoJCXZhciBpbnN0YW5jZXMgPSB0aGlzLmRvY3VtZW50LmRhdGEoICJ1aS1kaWFsb2ctaW5zdGFuY2VzIiApOwoJCWlmICggIWluc3RhbmNlcyApIHsKCQkJaW5zdGFuY2VzID0gW107CgkJCXRoaXMuZG9jdW1lbnQuZGF0YSggInVpLWRpYWxvZy1pbnN0YW5jZXMiLCBpbnN0YW5jZXMgKTsKCQl9CgkJcmV0dXJuIGluc3RhbmNlczsKCX0sCgoJX21pbkhlaWdodDogZnVuY3Rpb24oKSB7CgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCXJldHVybiBvcHRpb25zLmhlaWdodCA9PT0gImF1dG8iID8KCQkJb3B0aW9ucy5taW5IZWlnaHQgOgoJCQlNYXRoLm1pbiggb3B0aW9ucy5taW5IZWlnaHQsIG9wdGlvbnMuaGVpZ2h0ICk7Cgl9LAoKCV9wb3NpdGlvbjogZnVuY3Rpb24oKSB7CgkJLy8gTmVlZCB0byBzaG93IHRoZSBkaWFsb2cgdG8gZ2V0IHRoZSBhY3R1YWwgb2Zmc2V0IGluIHRoZSBwb3NpdGlvbiBwbHVnaW4KCQl2YXIgaXNWaXNpYmxlID0gdGhpcy51aURpYWxvZy5pcyggIjp2aXNpYmxlIiApOwoJCWlmICggIWlzVmlzaWJsZSApIHsKCQkJdGhpcy51aURpYWxvZy5zaG93KCk7CgkJfQoJCXRoaXMudWlEaWFsb2cucG9zaXRpb24oIHRoaXMub3B0aW9ucy5wb3NpdGlvbiApOwoJCWlmICggIWlzVmlzaWJsZSApIHsKCQkJdGhpcy51aURpYWxvZy5oaWRlKCk7CgkJfQoJfSwKCglfc2V0T3B0aW9uczogZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlyZXNpemUgPSBmYWxzZSwKCQkJcmVzaXphYmxlT3B0aW9ucyA9IHt9OwoKCQkkLmVhY2goIG9wdGlvbnMsIGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCQl0aGF0Ll9zZXRPcHRpb24oIGtleSwgdmFsdWUgKTsKCgkJCWlmICgga2V5IGluIHRoYXQuc2l6ZVJlbGF0ZWRPcHRpb25zICkgewoJCQkJcmVzaXplID0gdHJ1ZTsKCQkJfQoJCQlpZiAoIGtleSBpbiB0aGF0LnJlc2l6YWJsZVJlbGF0ZWRPcHRpb25zICkgewoJCQkJcmVzaXphYmxlT3B0aW9uc1sga2V5IF0gPSB2YWx1ZTsKCQkJfQoJCX0pOwoKCQlpZiAoIHJlc2l6ZSApIHsKCQkJdGhpcy5fc2l6ZSgpOwoJCQl0aGlzLl9wb3NpdGlvbigpOwoJCX0KCQlpZiAoIHRoaXMudWlEaWFsb2cuaXMoICI6ZGF0YSh1aS1yZXNpemFibGUpIiApICkgewoJCQl0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZSggIm9wdGlvbiIsIHJlc2l6YWJsZU9wdGlvbnMgKTsKCQl9Cgl9LAoKCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCXZhciBpc0RyYWdnYWJsZSwgaXNSZXNpemFibGUsCgkJCXVpRGlhbG9nID0gdGhpcy51aURpYWxvZzsKCgkJaWYgKCBrZXkgPT09ICJkaWFsb2dDbGFzcyIgKSB7CgkJCXVpRGlhbG9nCgkJCQkucmVtb3ZlQ2xhc3MoIHRoaXMub3B0aW9ucy5kaWFsb2dDbGFzcyApCgkJCQkuYWRkQ2xhc3MoIHZhbHVlICk7CgkJfQoKCQlpZiAoIGtleSA9PT0gImRpc2FibGVkIiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCgkJaWYgKCBrZXkgPT09ICJhcHBlbmRUbyIgKSB7CgkJCXRoaXMudWlEaWFsb2cuYXBwZW5kVG8oIHRoaXMuX2FwcGVuZFRvKCkgKTsKCQl9CgoJCWlmICgga2V5ID09PSAiYnV0dG9ucyIgKSB7CgkJCXRoaXMuX2NyZWF0ZUJ1dHRvbnMoKTsKCQl9CgoJCWlmICgga2V5ID09PSAiY2xvc2VUZXh0IiApIHsKCQkJdGhpcy51aURpYWxvZ1RpdGxlYmFyQ2xvc2UuYnV0dG9uKHsKCQkJCS8vIEVuc3VyZSB0aGF0IHdlIGFsd2F5cyBwYXNzIGEgc3RyaW5nCgkJCQlsYWJlbDogIiIgKyB2YWx1ZQoJCQl9KTsKCQl9CgoJCWlmICgga2V5ID09PSAiZHJhZ2dhYmxlIiApIHsKCQkJaXNEcmFnZ2FibGUgPSB1aURpYWxvZy5pcyggIjpkYXRhKHVpLWRyYWdnYWJsZSkiICk7CgkJCWlmICggaXNEcmFnZ2FibGUgJiYgIXZhbHVlICkgewoJCQkJdWlEaWFsb2cuZHJhZ2dhYmxlKCAiZGVzdHJveSIgKTsKCQkJfQoKCQkJaWYgKCAhaXNEcmFnZ2FibGUgJiYgdmFsdWUgKSB7CgkJCQl0aGlzLl9tYWtlRHJhZ2dhYmxlKCk7CgkJCX0KCQl9CgoJCWlmICgga2V5ID09PSAicG9zaXRpb24iICkgewoJCQl0aGlzLl9wb3NpdGlvbigpOwoJCX0KCgkJaWYgKCBrZXkgPT09ICJyZXNpemFibGUiICkgewoJCQkvLyBjdXJyZW50bHkgcmVzaXphYmxlLCBiZWNvbWluZyBub24tcmVzaXphYmxlCgkJCWlzUmVzaXphYmxlID0gdWlEaWFsb2cuaXMoICI6ZGF0YSh1aS1yZXNpemFibGUpIiApOwoJCQlpZiAoIGlzUmVzaXphYmxlICYmICF2YWx1ZSApIHsKCQkJCXVpRGlhbG9nLnJlc2l6YWJsZSggImRlc3Ryb3kiICk7CgkJCX0KCgkJCS8vIGN1cnJlbnRseSByZXNpemFibGUsIGNoYW5naW5nIGhhbmRsZXMKCQkJaWYgKCBpc1Jlc2l6YWJsZSAmJiB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICkgewoJCQkJdWlEaWFsb2cucmVzaXphYmxlKCAib3B0aW9uIiwgImhhbmRsZXMiLCB2YWx1ZSApOwoJCQl9CgoJCQkvLyBjdXJyZW50bHkgbm9uLXJlc2l6YWJsZSwgYmVjb21pbmcgcmVzaXphYmxlCgkJCWlmICggIWlzUmVzaXphYmxlICYmIHZhbHVlICE9PSBmYWxzZSApIHsKCQkJCXRoaXMuX21ha2VSZXNpemFibGUoKTsKCQkJfQoJCX0KCgkJaWYgKCBrZXkgPT09ICJ0aXRsZSIgKSB7CgkJCXRoaXMuX3RpdGxlKCB0aGlzLnVpRGlhbG9nVGl0bGViYXIuZmluZCggIi51aS1kaWFsb2ctdGl0bGUiICkgKTsKCQl9Cgl9LAoKCV9zaXplOiBmdW5jdGlvbigpIHsKCQkvLyBJZiB0aGUgdXNlciBoYXMgcmVzaXplZCB0aGUgZGlhbG9nLCB0aGUgLnVpLWRpYWxvZyBhbmQgLnVpLWRpYWxvZy1jb250ZW50CgkJLy8gZGl2cyB3aWxsIGJvdGggaGF2ZSB3aWR0aCBhbmQgaGVpZ2h0IHNldCwgc28gd2UgbmVlZCB0byByZXNldCB0aGVtCgkJdmFyIG5vbkNvbnRlbnRIZWlnaHQsIG1pbkNvbnRlbnRIZWlnaHQsIG1heENvbnRlbnRIZWlnaHQsCgkJCW9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCS8vIFJlc2V0IGNvbnRlbnQgc2l6aW5nCgkJdGhpcy5lbGVtZW50LnNob3coKS5jc3MoewoJCQl3aWR0aDogImF1dG8iLAoJCQltaW5IZWlnaHQ6IDAsCgkJCW1heEhlaWdodDogIm5vbmUiLAoJCQloZWlnaHQ6IDAKCQl9KTsKCgkJaWYgKCBvcHRpb25zLm1pbldpZHRoID4gb3B0aW9ucy53aWR0aCApIHsKCQkJb3B0aW9ucy53aWR0aCA9IG9wdGlvbnMubWluV2lkdGg7CgkJfQoKCQkvLyByZXNldCB3cmFwcGVyIHNpemluZwoJCS8vIGRldGVybWluZSB0aGUgaGVpZ2h0IG9mIGFsbCB0aGUgbm9uLWNvbnRlbnQgZWxlbWVudHMKCQlub25Db250ZW50SGVpZ2h0ID0gdGhpcy51aURpYWxvZy5jc3MoewoJCQkJaGVpZ2h0OiAiYXV0byIsCgkJCQl3aWR0aDogb3B0aW9ucy53aWR0aAoJCQl9KQoJCQkub3V0ZXJIZWlnaHQoKTsKCQltaW5Db250ZW50SGVpZ2h0ID0gTWF0aC5tYXgoIDAsIG9wdGlvbnMubWluSGVpZ2h0IC0gbm9uQ29udGVudEhlaWdodCApOwoJCW1heENvbnRlbnRIZWlnaHQgPSB0eXBlb2Ygb3B0aW9ucy5tYXhIZWlnaHQgPT09ICJudW1iZXIiID8KCQkJTWF0aC5tYXgoIDAsIG9wdGlvbnMubWF4SGVpZ2h0IC0gbm9uQ29udGVudEhlaWdodCApIDoKCQkJIm5vbmUiOwoKCQlpZiAoIG9wdGlvbnMuaGVpZ2h0ID09PSAiYXV0byIgKSB7CgkJCXRoaXMuZWxlbWVudC5jc3MoewoJCQkJbWluSGVpZ2h0OiBtaW5Db250ZW50SGVpZ2h0LAoJCQkJbWF4SGVpZ2h0OiBtYXhDb250ZW50SGVpZ2h0LAoJCQkJaGVpZ2h0OiAiYXV0byIKCQkJfSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5lbGVtZW50LmhlaWdodCggTWF0aC5tYXgoIDAsIG9wdGlvbnMuaGVpZ2h0IC0gbm9uQ29udGVudEhlaWdodCApICk7CgkJfQoKCQlpZiAoIHRoaXMudWlEaWFsb2cuaXMoICI6ZGF0YSh1aS1yZXNpemFibGUpIiApICkgewoJCQl0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZSggIm9wdGlvbiIsICJtaW5IZWlnaHQiLCB0aGlzLl9taW5IZWlnaHQoKSApOwoJCX0KCX0sCgoJX2Jsb2NrRnJhbWVzOiBmdW5jdGlvbigpIHsKCQl0aGlzLmlmcmFtZUJsb2NrcyA9IHRoaXMuZG9jdW1lbnQuZmluZCggImlmcmFtZSIgKS5tYXAoZnVuY3Rpb24oKSB7CgkJCXZhciBpZnJhbWUgPSAkKCB0aGlzICk7CgoJCQlyZXR1cm4gJCggIjxkaXY+IiApCgkJCQkuY3NzKHsKCQkJCQlwb3NpdGlvbjogImFic29sdXRlIiwKCQkJCQl3aWR0aDogaWZyYW1lLm91dGVyV2lkdGgoKSwKCQkJCQloZWlnaHQ6IGlmcmFtZS5vdXRlckhlaWdodCgpCgkJCQl9KQoJCQkJLmFwcGVuZFRvKCBpZnJhbWUucGFyZW50KCkgKQoJCQkJLm9mZnNldCggaWZyYW1lLm9mZnNldCgpIClbMF07CgkJfSk7Cgl9LAoKCV91bmJsb2NrRnJhbWVzOiBmdW5jdGlvbigpIHsKCQlpZiAoIHRoaXMuaWZyYW1lQmxvY2tzICkgewoJCQl0aGlzLmlmcmFtZUJsb2Nrcy5yZW1vdmUoKTsKCQkJZGVsZXRlIHRoaXMuaWZyYW1lQmxvY2tzOwoJCX0KCX0sCgoJX2FsbG93SW50ZXJhY3Rpb246IGZ1bmN0aW9uKCBldmVudCApIHsKCQlpZiAoICQoIGV2ZW50LnRhcmdldCApLmNsb3Nlc3QoICIudWktZGlhbG9nIiApLmxlbmd0aCApIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoKCQkvLyBUT0RPOiBSZW1vdmUgaGFjayB3aGVuIGRhdGVwaWNrZXIgaW1wbGVtZW50cwoJCS8vIHRoZSAudWktZnJvbnQgbG9naWMgKCM4OTg5KQoJCXJldHVybiAhISQoIGV2ZW50LnRhcmdldCApLmNsb3Nlc3QoICIudWktZGF0ZXBpY2tlciIgKS5sZW5ndGg7Cgl9LAoKCV9jcmVhdGVPdmVybGF5OiBmdW5jdGlvbigpIHsKCQlpZiAoICF0aGlzLm9wdGlvbnMubW9kYWwgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIFdlIHVzZSBhIGRlbGF5IGluIGNhc2UgdGhlIG92ZXJsYXkgaXMgY3JlYXRlZCBmcm9tIGFuCgkJLy8gZXZlbnQgdGhhdCB3ZSdyZSBnb2luZyB0byBiZSBjYW5jZWxsaW5nICgjMjgwNCkKCQl2YXIgaXNPcGVuaW5nID0gdHJ1ZTsKCQl0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJaXNPcGVuaW5nID0gZmFsc2U7CgkJfSk7CgoJCWlmICggIXRoaXMuZG9jdW1lbnQuZGF0YSggInVpLWRpYWxvZy1vdmVybGF5cyIgKSApIHsKCgkJCS8vIFByZXZlbnQgdXNlIG9mIGFuY2hvcnMgYW5kIGlucHV0cwoJCQkvLyBVc2luZyBfb24oKSBmb3IgYW4gZXZlbnQgaGFuZGxlciBzaGFyZWQgYWNyb3NzIG1hbnkgaW5zdGFuY2VzIGlzCgkJCS8vIHNhZmUgYmVjYXVzZSB0aGUgZGlhbG9ncyBzdGFjayBhbmQgbXVzdCBiZSBjbG9zZWQgaW4gcmV2ZXJzZSBvcmRlcgoJCQl0aGlzLl9vbiggdGhpcy5kb2N1bWVudCwgewoJCQkJZm9jdXNpbjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCWlmICggaXNPcGVuaW5nICkgewoJCQkJCQlyZXR1cm47CgkJCQkJfQoKCQkJCQlpZiAoICF0aGlzLl9hbGxvd0ludGVyYWN0aW9uKCBldmVudCApICkgewoJCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCQl0aGlzLl90cmFja2luZ0luc3RhbmNlcygpWyAwIF0uX2ZvY3VzVGFiYmFibGUoKTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCX0KCgkJdGhpcy5vdmVybGF5ID0gJCggIjxkaXY+IiApCgkJCS5hZGRDbGFzcyggInVpLXdpZGdldC1vdmVybGF5IHVpLWZyb250IiApCgkJCS5hcHBlbmRUbyggdGhpcy5fYXBwZW5kVG8oKSApOwoJCXRoaXMuX29uKCB0aGlzLm92ZXJsYXksIHsKCQkJbW91c2Vkb3duOiAiX2tlZXBGb2N1cyIKCQl9KTsKCQl0aGlzLmRvY3VtZW50LmRhdGEoICJ1aS1kaWFsb2ctb3ZlcmxheXMiLAoJCQkodGhpcy5kb2N1bWVudC5kYXRhKCAidWktZGlhbG9nLW92ZXJsYXlzIiApIHx8IDApICsgMSApOwoJfSwKCglfZGVzdHJveU92ZXJsYXk6IGZ1bmN0aW9uKCkgewoJCWlmICggIXRoaXMub3B0aW9ucy5tb2RhbCApIHsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCB0aGlzLm92ZXJsYXkgKSB7CgkJCXZhciBvdmVybGF5cyA9IHRoaXMuZG9jdW1lbnQuZGF0YSggInVpLWRpYWxvZy1vdmVybGF5cyIgKSAtIDE7CgoJCQlpZiAoICFvdmVybGF5cyApIHsKCQkJCXRoaXMuZG9jdW1lbnQKCQkJCQkudW5iaW5kKCAiZm9jdXNpbiIgKQoJCQkJCS5yZW1vdmVEYXRhKCAidWktZGlhbG9nLW92ZXJsYXlzIiApOwoJCQl9IGVsc2UgewoJCQkJdGhpcy5kb2N1bWVudC5kYXRhKCAidWktZGlhbG9nLW92ZXJsYXlzIiwgb3ZlcmxheXMgKTsKCQkJfQoKCQkJdGhpcy5vdmVybGF5LnJlbW92ZSgpOwoJCQl0aGlzLm92ZXJsYXkgPSBudWxsOwoJCX0KCX0KfSk7CgoKLyohCiAqIGpRdWVyeSBVSSBEcm9wcGFibGUgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vZHJvcHBhYmxlLwogKi8KCgokLndpZGdldCggInVpLmRyb3BwYWJsZSIsIHsKCXZlcnNpb246ICIxLjExLjEiLAoJd2lkZ2V0RXZlbnRQcmVmaXg6ICJkcm9wIiwKCW9wdGlvbnM6IHsKCQlhY2NlcHQ6ICIqIiwKCQlhY3RpdmVDbGFzczogZmFsc2UsCgkJYWRkQ2xhc3NlczogdHJ1ZSwKCQlncmVlZHk6IGZhbHNlLAoJCWhvdmVyQ2xhc3M6IGZhbHNlLAoJCXNjb3BlOiAiZGVmYXVsdCIsCgkJdG9sZXJhbmNlOiAiaW50ZXJzZWN0IiwKCgkJLy8gY2FsbGJhY2tzCgkJYWN0aXZhdGU6IG51bGwsCgkJZGVhY3RpdmF0ZTogbnVsbCwKCQlkcm9wOiBudWxsLAoJCW91dDogbnVsbCwKCQlvdmVyOiBudWxsCgl9LAoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgoJCXZhciBwcm9wb3J0aW9ucywKCQkJbyA9IHRoaXMub3B0aW9ucywKCQkJYWNjZXB0ID0gby5hY2NlcHQ7CgoJCXRoaXMuaXNvdmVyID0gZmFsc2U7CgkJdGhpcy5pc291dCA9IHRydWU7CgoJCXRoaXMuYWNjZXB0ID0gJC5pc0Z1bmN0aW9uKCBhY2NlcHQgKSA/IGFjY2VwdCA6IGZ1bmN0aW9uKCBkICkgewoJCQlyZXR1cm4gZC5pcyggYWNjZXB0ICk7CgkJfTsKCgkJdGhpcy5wcm9wb3J0aW9ucyA9IGZ1bmN0aW9uKCAvKiB2YWx1ZVRvV3JpdGUgKi8gKSB7CgkJCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJCS8vIFN0b3JlIHRoZSBkcm9wcGFibGUncyBwcm9wb3J0aW9ucwoJCQkJcHJvcG9ydGlvbnMgPSBhcmd1bWVudHNbIDAgXTsKCQkJfSBlbHNlIHsKCQkJCS8vIFJldHJpZXZlIG9yIGRlcml2ZSB0aGUgZHJvcHBhYmxlJ3MgcHJvcG9ydGlvbnMKCQkJCXJldHVybiBwcm9wb3J0aW9ucyA/CgkJCQkJcHJvcG9ydGlvbnMgOgoJCQkJCXByb3BvcnRpb25zID0gewoJCQkJCQl3aWR0aDogdGhpcy5lbGVtZW50WyAwIF0ub2Zmc2V0V2lkdGgsCgkJCQkJCWhlaWdodDogdGhpcy5lbGVtZW50WyAwIF0ub2Zmc2V0SGVpZ2h0CgkJCQkJfTsKCQkJfQoJCX07CgoJCXRoaXMuX2FkZFRvTWFuYWdlciggby5zY29wZSApOwoKCQlvLmFkZENsYXNzZXMgJiYgdGhpcy5lbGVtZW50LmFkZENsYXNzKCAidWktZHJvcHBhYmxlIiApOwoKCX0sCgoJX2FkZFRvTWFuYWdlcjogZnVuY3Rpb24oIHNjb3BlICkgewoJCS8vIEFkZCB0aGUgcmVmZXJlbmNlIGFuZCBwb3NpdGlvbnMgdG8gdGhlIG1hbmFnZXIKCQkkLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzWyBzY29wZSBdID0gJC51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1sgc2NvcGUgXSB8fCBbXTsKCQkkLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzWyBzY29wZSBdLnB1c2goIHRoaXMgKTsKCX0sCgoJX3NwbGljZTogZnVuY3Rpb24oIGRyb3AgKSB7CgkJdmFyIGkgPSAwOwoJCWZvciAoIDsgaSA8IGRyb3AubGVuZ3RoOyBpKysgKSB7CgkJCWlmICggZHJvcFsgaSBdID09PSB0aGlzICkgewoJCQkJZHJvcC5zcGxpY2UoIGksIDEgKTsKCQkJfQoJCX0KCX0sCgoJX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCXZhciBkcm9wID0gJC51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1sgdGhpcy5vcHRpb25zLnNjb3BlIF07CgoJCXRoaXMuX3NwbGljZSggZHJvcCApOwoKCQl0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoICJ1aS1kcm9wcGFibGUgdWktZHJvcHBhYmxlLWRpc2FibGVkIiApOwoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCgkJaWYgKCBrZXkgPT09ICJhY2NlcHQiICkgewoJCQl0aGlzLmFjY2VwdCA9ICQuaXNGdW5jdGlvbiggdmFsdWUgKSA/IHZhbHVlIDogZnVuY3Rpb24oIGQgKSB7CgkJCQlyZXR1cm4gZC5pcyggdmFsdWUgKTsKCQkJfTsKCQl9IGVsc2UgaWYgKCBrZXkgPT09ICJzY29wZSIgKSB7CgkJCXZhciBkcm9wID0gJC51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1sgdGhpcy5vcHRpb25zLnNjb3BlIF07CgoJCQl0aGlzLl9zcGxpY2UoIGRyb3AgKTsKCQkJdGhpcy5fYWRkVG9NYW5hZ2VyKCB2YWx1ZSApOwoJCX0KCgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCX0sCgoJX2FjdGl2YXRlOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdmFyIGRyYWdnYWJsZSA9ICQudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7CgkJaWYgKCB0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MgKSB7CgkJCXRoaXMuZWxlbWVudC5hZGRDbGFzcyggdGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzICk7CgkJfQoJCWlmICggZHJhZ2dhYmxlICl7CgkJCXRoaXMuX3RyaWdnZXIoICJhY3RpdmF0ZSIsIGV2ZW50LCB0aGlzLnVpKCBkcmFnZ2FibGUgKSApOwoJCX0KCX0sCgoJX2RlYWN0aXZhdGU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgZHJhZ2dhYmxlID0gJC51aS5kZG1hbmFnZXIuY3VycmVudDsKCQlpZiAoIHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyApIHsKCQkJdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCB0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MgKTsKCQl9CgkJaWYgKCBkcmFnZ2FibGUgKXsKCQkJdGhpcy5fdHJpZ2dlciggImRlYWN0aXZhdGUiLCBldmVudCwgdGhpcy51aSggZHJhZ2dhYmxlICkgKTsKCQl9Cgl9LAoKCV9vdmVyOiBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCXZhciBkcmFnZ2FibGUgPSAkLnVpLmRkbWFuYWdlci5jdXJyZW50OwoKCQkvLyBCYWlsIGlmIGRyYWdnYWJsZSBhbmQgZHJvcHBhYmxlIGFyZSBzYW1lIGVsZW1lbnQKCQlpZiAoICFkcmFnZ2FibGUgfHwgKCBkcmFnZ2FibGUuY3VycmVudEl0ZW0gfHwgZHJhZ2dhYmxlLmVsZW1lbnQgKVsgMCBdID09PSB0aGlzLmVsZW1lbnRbIDAgXSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCB0aGlzLmFjY2VwdC5jYWxsKCB0aGlzLmVsZW1lbnRbIDAgXSwgKCBkcmFnZ2FibGUuY3VycmVudEl0ZW0gfHwgZHJhZ2dhYmxlLmVsZW1lbnQgKSApICkgewoJCQlpZiAoIHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzICkgewoJCQkJdGhpcy5lbGVtZW50LmFkZENsYXNzKCB0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyApOwoJCQl9CgkJCXRoaXMuX3RyaWdnZXIoICJvdmVyIiwgZXZlbnQsIHRoaXMudWkoIGRyYWdnYWJsZSApICk7CgkJfQoKCX0sCgoJX291dDogZnVuY3Rpb24oIGV2ZW50ICkgewoKCQl2YXIgZHJhZ2dhYmxlID0gJC51aS5kZG1hbmFnZXIuY3VycmVudDsKCgkJLy8gQmFpbCBpZiBkcmFnZ2FibGUgYW5kIGRyb3BwYWJsZSBhcmUgc2FtZSBlbGVtZW50CgkJaWYgKCAhZHJhZ2dhYmxlIHx8ICggZHJhZ2dhYmxlLmN1cnJlbnRJdGVtIHx8IGRyYWdnYWJsZS5lbGVtZW50IClbIDAgXSA9PT0gdGhpcy5lbGVtZW50WyAwIF0gKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdGhpcy5hY2NlcHQuY2FsbCggdGhpcy5lbGVtZW50WyAwIF0sICggZHJhZ2dhYmxlLmN1cnJlbnRJdGVtIHx8IGRyYWdnYWJsZS5lbGVtZW50ICkgKSApIHsKCQkJaWYgKCB0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyApIHsKCQkJCXRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyggdGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MgKTsKCQkJfQoJCQl0aGlzLl90cmlnZ2VyKCAib3V0IiwgZXZlbnQsIHRoaXMudWkoIGRyYWdnYWJsZSApICk7CgkJfQoKCX0sCgoJX2Ryb3A6IGZ1bmN0aW9uKCBldmVudCwgY3VzdG9tICkgewoKCQl2YXIgZHJhZ2dhYmxlID0gY3VzdG9tIHx8ICQudWkuZGRtYW5hZ2VyLmN1cnJlbnQsCgkJCWNoaWxkcmVuSW50ZXJzZWN0aW9uID0gZmFsc2U7CgoJCS8vIEJhaWwgaWYgZHJhZ2dhYmxlIGFuZCBkcm9wcGFibGUgYXJlIHNhbWUgZWxlbWVudAoJCWlmICggIWRyYWdnYWJsZSB8fCAoIGRyYWdnYWJsZS5jdXJyZW50SXRlbSB8fCBkcmFnZ2FibGUuZWxlbWVudCApWyAwIF0gPT09IHRoaXMuZWxlbWVudFsgMCBdICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQl0aGlzLmVsZW1lbnQuZmluZCggIjpkYXRhKHVpLWRyb3BwYWJsZSkiICkubm90KCAiLnVpLWRyYWdnYWJsZS1kcmFnZ2luZyIgKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgaW5zdCA9ICQoIHRoaXMgKS5kcm9wcGFibGUoICJpbnN0YW5jZSIgKTsKCQkJaWYgKAoJCQkJaW5zdC5vcHRpb25zLmdyZWVkeSAmJgoJCQkJIWluc3Qub3B0aW9ucy5kaXNhYmxlZCAmJgoJCQkJaW5zdC5vcHRpb25zLnNjb3BlID09PSBkcmFnZ2FibGUub3B0aW9ucy5zY29wZSAmJgoJCQkJaW5zdC5hY2NlcHQuY2FsbCggaW5zdC5lbGVtZW50WyAwIF0sICggZHJhZ2dhYmxlLmN1cnJlbnRJdGVtIHx8IGRyYWdnYWJsZS5lbGVtZW50ICkgKSAmJgoJCQkJJC51aS5pbnRlcnNlY3QoIGRyYWdnYWJsZSwgJC5leHRlbmQoIGluc3QsIHsgb2Zmc2V0OiBpbnN0LmVsZW1lbnQub2Zmc2V0KCkgfSApLCBpbnN0Lm9wdGlvbnMudG9sZXJhbmNlLCBldmVudCApCgkJCSkgeyBjaGlsZHJlbkludGVyc2VjdGlvbiA9IHRydWU7IHJldHVybiBmYWxzZTsgfQoJCX0pOwoJCWlmICggY2hpbGRyZW5JbnRlcnNlY3Rpb24gKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmICggdGhpcy5hY2NlcHQuY2FsbCggdGhpcy5lbGVtZW50WyAwIF0sICggZHJhZ2dhYmxlLmN1cnJlbnRJdGVtIHx8IGRyYWdnYWJsZS5lbGVtZW50ICkgKSApIHsKCQkJaWYgKCB0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MgKSB7CgkJCQl0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoIHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyApOwoJCQl9CgkJCWlmICggdGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MgKSB7CgkJCQl0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoIHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzICk7CgkJCX0KCQkJdGhpcy5fdHJpZ2dlciggImRyb3AiLCBldmVudCwgdGhpcy51aSggZHJhZ2dhYmxlICkgKTsKCQkJcmV0dXJuIHRoaXMuZWxlbWVudDsKCQl9CgoJCXJldHVybiBmYWxzZTsKCgl9LAoKCXVpOiBmdW5jdGlvbiggYyApIHsKCQlyZXR1cm4gewoJCQlkcmFnZ2FibGU6ICggYy5jdXJyZW50SXRlbSB8fCBjLmVsZW1lbnQgKSwKCQkJaGVscGVyOiBjLmhlbHBlciwKCQkJcG9zaXRpb246IGMucG9zaXRpb24sCgkJCW9mZnNldDogYy5wb3NpdGlvbkFicwoJCX07Cgl9Cgp9KTsKCiQudWkuaW50ZXJzZWN0ID0gKGZ1bmN0aW9uKCkgewoJZnVuY3Rpb24gaXNPdmVyQXhpcyggeCwgcmVmZXJlbmNlLCBzaXplICkgewoJCXJldHVybiAoIHggPj0gcmVmZXJlbmNlICkgJiYgKCB4IDwgKCByZWZlcmVuY2UgKyBzaXplICkgKTsKCX0KCglyZXR1cm4gZnVuY3Rpb24oIGRyYWdnYWJsZSwgZHJvcHBhYmxlLCB0b2xlcmFuY2VNb2RlLCBldmVudCApIHsKCgkJaWYgKCAhZHJvcHBhYmxlLm9mZnNldCApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJdmFyIHgxID0gKCBkcmFnZ2FibGUucG9zaXRpb25BYnMgfHwgZHJhZ2dhYmxlLnBvc2l0aW9uLmFic29sdXRlICkubGVmdCwKCQkJeTEgPSAoIGRyYWdnYWJsZS5wb3NpdGlvbkFicyB8fCBkcmFnZ2FibGUucG9zaXRpb24uYWJzb2x1dGUgKS50b3AsCgkJCXgyID0geDEgKyBkcmFnZ2FibGUuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsCgkJCXkyID0geTEgKyBkcmFnZ2FibGUuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LAoJCQlsID0gZHJvcHBhYmxlLm9mZnNldC5sZWZ0LAoJCQl0ID0gZHJvcHBhYmxlLm9mZnNldC50b3AsCgkJCXIgPSBsICsgZHJvcHBhYmxlLnByb3BvcnRpb25zKCkud2lkdGgsCgkJCWIgPSB0ICsgZHJvcHBhYmxlLnByb3BvcnRpb25zKCkuaGVpZ2h0OwoKCQlzd2l0Y2ggKCB0b2xlcmFuY2VNb2RlICkgewoJCWNhc2UgImZpdCI6CgkJCXJldHVybiAoIGwgPD0geDEgJiYgeDIgPD0gciAmJiB0IDw9IHkxICYmIHkyIDw9IGIgKTsKCQljYXNlICJpbnRlcnNlY3QiOgoJCQlyZXR1cm4gKCBsIDwgeDEgKyAoIGRyYWdnYWJsZS5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAvIDIgKSAmJiAvLyBSaWdodCBIYWxmCgkJCQl4MiAtICggZHJhZ2dhYmxlLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC8gMiApIDwgciAmJiAvLyBMZWZ0IEhhbGYKCQkJCXQgPCB5MSArICggZHJhZ2dhYmxlLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAvIDIgKSAmJiAvLyBCb3R0b20gSGFsZgoJCQkJeTIgLSAoIGRyYWdnYWJsZS5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLyAyICkgPCBiICk7IC8vIFRvcCBIYWxmCgkJY2FzZSAicG9pbnRlciI6CgkJCXJldHVybiBpc092ZXJBeGlzKCBldmVudC5wYWdlWSwgdCwgZHJvcHBhYmxlLnByb3BvcnRpb25zKCkuaGVpZ2h0ICkgJiYgaXNPdmVyQXhpcyggZXZlbnQucGFnZVgsIGwsIGRyb3BwYWJsZS5wcm9wb3J0aW9ucygpLndpZHRoICk7CgkJY2FzZSAidG91Y2giOgoJCQlyZXR1cm4gKAoJCQkJKCB5MSA+PSB0ICYmIHkxIDw9IGIgKSB8fCAvLyBUb3AgZWRnZSB0b3VjaGluZwoJCQkJKCB5MiA+PSB0ICYmIHkyIDw9IGIgKSB8fCAvLyBCb3R0b20gZWRnZSB0b3VjaGluZwoJCQkJKCB5MSA8IHQgJiYgeTIgPiBiICkgLy8gU3Vycm91bmRlZCB2ZXJ0aWNhbGx5CgkJCSkgJiYgKAoJCQkJKCB4MSA+PSBsICYmIHgxIDw9IHIgKSB8fCAvLyBMZWZ0IGVkZ2UgdG91Y2hpbmcKCQkJCSggeDIgPj0gbCAmJiB4MiA8PSByICkgfHwgLy8gUmlnaHQgZWRnZSB0b3VjaGluZwoJCQkJKCB4MSA8IGwgJiYgeDIgPiByICkgLy8gU3Vycm91bmRlZCBob3Jpem9udGFsbHkKCQkJKTsKCQlkZWZhdWx0OgoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfTsKfSkoKTsKCi8qCglUaGlzIG1hbmFnZXIgdHJhY2tzIG9mZnNldHMgb2YgZHJhZ2dhYmxlcyBhbmQgZHJvcHBhYmxlcwoqLwokLnVpLmRkbWFuYWdlciA9IHsKCWN1cnJlbnQ6IG51bGwsCglkcm9wcGFibGVzOiB7ICJkZWZhdWx0IjogW10gfSwKCXByZXBhcmVPZmZzZXRzOiBmdW5jdGlvbiggdCwgZXZlbnQgKSB7CgoJCXZhciBpLCBqLAoJCQltID0gJC51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1sgdC5vcHRpb25zLnNjb3BlIF0gfHwgW10sCgkJCXR5cGUgPSBldmVudCA/IGV2ZW50LnR5cGUgOiBudWxsLCAvLyB3b3JrYXJvdW5kIGZvciAjMjMxNwoJCQlsaXN0ID0gKCB0LmN1cnJlbnRJdGVtIHx8IHQuZWxlbWVudCApLmZpbmQoICI6ZGF0YSh1aS1kcm9wcGFibGUpIiApLmFkZEJhY2soKTsKCgkJZHJvcHBhYmxlc0xvb3A6IGZvciAoIGkgPSAwOyBpIDwgbS5sZW5ndGg7IGkrKyApIHsKCgkJCS8vIE5vIGRpc2FibGVkIGFuZCBub24tYWNjZXB0ZWQKCQkJaWYgKCBtWyBpIF0ub3B0aW9ucy5kaXNhYmxlZCB8fCAoIHQgJiYgIW1bIGkgXS5hY2NlcHQuY2FsbCggbVsgaSBdLmVsZW1lbnRbIDAgXSwgKCB0LmN1cnJlbnRJdGVtIHx8IHQuZWxlbWVudCApICkgKSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQkvLyBGaWx0ZXIgb3V0IGVsZW1lbnRzIGluIHRoZSBjdXJyZW50IGRyYWdnZWQgaXRlbQoJCQlmb3IgKCBqID0gMDsgaiA8IGxpc3QubGVuZ3RoOyBqKysgKSB7CgkJCQlpZiAoIGxpc3RbIGogXSA9PT0gbVsgaSBdLmVsZW1lbnRbIDAgXSApIHsKCQkJCQltWyBpIF0ucHJvcG9ydGlvbnMoKS5oZWlnaHQgPSAwOwoJCQkJCWNvbnRpbnVlIGRyb3BwYWJsZXNMb29wOwoJCQkJfQoJCQl9CgoJCQltWyBpIF0udmlzaWJsZSA9IG1bIGkgXS5lbGVtZW50LmNzcyggImRpc3BsYXkiICkgIT09ICJub25lIjsKCQkJaWYgKCAhbVsgaSBdLnZpc2libGUgKSB7CgkJCQljb250aW51ZTsKCQkJfQoKCQkJLy8gQWN0aXZhdGUgdGhlIGRyb3BwYWJsZSBpZiB1c2VkIGRpcmVjdGx5IGZyb20gZHJhZ2dhYmxlcwoJCQlpZiAoIHR5cGUgPT09ICJtb3VzZWRvd24iICkgewoJCQkJbVsgaSBdLl9hY3RpdmF0ZS5jYWxsKCBtWyBpIF0sIGV2ZW50ICk7CgkJCX0KCgkJCW1bIGkgXS5vZmZzZXQgPSBtWyBpIF0uZWxlbWVudC5vZmZzZXQoKTsKCQkJbVsgaSBdLnByb3BvcnRpb25zKHsgd2lkdGg6IG1bIGkgXS5lbGVtZW50WyAwIF0ub2Zmc2V0V2lkdGgsIGhlaWdodDogbVsgaSBdLmVsZW1lbnRbIDAgXS5vZmZzZXRIZWlnaHQgfSk7CgoJCX0KCgl9LAoJZHJvcDogZnVuY3Rpb24oIGRyYWdnYWJsZSwgZXZlbnQgKSB7CgoJCXZhciBkcm9wcGVkID0gZmFsc2U7CgkJLy8gQ3JlYXRlIGEgY29weSBvZiB0aGUgZHJvcHBhYmxlcyBpbiBjYXNlIHRoZSBsaXN0IGNoYW5nZXMgZHVyaW5nIHRoZSBkcm9wICgjOTExNikKCQkkLmVhY2goICggJC51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1sgZHJhZ2dhYmxlLm9wdGlvbnMuc2NvcGUgXSB8fCBbXSApLnNsaWNlKCksIGZ1bmN0aW9uKCkgewoKCQkJaWYgKCAhdGhpcy5vcHRpb25zICkgewoJCQkJcmV0dXJuOwoJCQl9CgkJCWlmICggIXRoaXMub3B0aW9ucy5kaXNhYmxlZCAmJiB0aGlzLnZpc2libGUgJiYgJC51aS5pbnRlcnNlY3QoIGRyYWdnYWJsZSwgdGhpcywgdGhpcy5vcHRpb25zLnRvbGVyYW5jZSwgZXZlbnQgKSApIHsKCQkJCWRyb3BwZWQgPSB0aGlzLl9kcm9wLmNhbGwoIHRoaXMsIGV2ZW50ICkgfHwgZHJvcHBlZDsKCQkJfQoKCQkJaWYgKCAhdGhpcy5vcHRpb25zLmRpc2FibGVkICYmIHRoaXMudmlzaWJsZSAmJiB0aGlzLmFjY2VwdC5jYWxsKCB0aGlzLmVsZW1lbnRbIDAgXSwgKCBkcmFnZ2FibGUuY3VycmVudEl0ZW0gfHwgZHJhZ2dhYmxlLmVsZW1lbnQgKSApICkgewoJCQkJdGhpcy5pc291dCA9IHRydWU7CgkJCQl0aGlzLmlzb3ZlciA9IGZhbHNlOwoJCQkJdGhpcy5fZGVhY3RpdmF0ZS5jYWxsKCB0aGlzLCBldmVudCApOwoJCQl9CgoJCX0pOwoJCXJldHVybiBkcm9wcGVkOwoKCX0sCglkcmFnU3RhcnQ6IGZ1bmN0aW9uKCBkcmFnZ2FibGUsIGV2ZW50ICkgewoJCS8vIExpc3RlbiBmb3Igc2Nyb2xsaW5nIHNvIHRoYXQgaWYgdGhlIGRyYWdnaW5nIGNhdXNlcyBzY3JvbGxpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBkcm9wcGFibGVzIGNhbiBiZSByZWNhbGN1bGF0ZWQgKHNlZSAjNTAwMykKCQlkcmFnZ2FibGUuZWxlbWVudC5wYXJlbnRzVW50aWwoICJib2R5IiApLmJpbmQoICJzY3JvbGwuZHJvcHBhYmxlIiwgZnVuY3Rpb24oKSB7CgkJCWlmICggIWRyYWdnYWJsZS5vcHRpb25zLnJlZnJlc2hQb3NpdGlvbnMgKSB7CgkJCQkkLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyggZHJhZ2dhYmxlLCBldmVudCApOwoJCQl9CgkJfSk7Cgl9LAoJZHJhZzogZnVuY3Rpb24oIGRyYWdnYWJsZSwgZXZlbnQgKSB7CgoJCS8vIElmIHlvdSBoYXZlIGEgaGlnaGx5IGR5bmFtaWMgcGFnZSwgeW91IG1pZ2h0IHRyeSB0aGlzIG9wdGlvbi4gSXQgcmVuZGVycyBwb3NpdGlvbnMgZXZlcnkgdGltZSB5b3UgbW92ZSB0aGUgbW91c2UuCgkJaWYgKCBkcmFnZ2FibGUub3B0aW9ucy5yZWZyZXNoUG9zaXRpb25zICkgewoJCQkkLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyggZHJhZ2dhYmxlLCBldmVudCApOwoJCX0KCgkJLy8gUnVuIHRocm91Z2ggYWxsIGRyb3BwYWJsZXMgYW5kIGNoZWNrIHRoZWlyIHBvc2l0aW9ucyBiYXNlZCBvbiBzcGVjaWZpYyB0b2xlcmFuY2Ugb3B0aW9ucwoJCSQuZWFjaCggJC51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1sgZHJhZ2dhYmxlLm9wdGlvbnMuc2NvcGUgXSB8fCBbXSwgZnVuY3Rpb24oKSB7CgoJCQlpZiAoIHRoaXMub3B0aW9ucy5kaXNhYmxlZCB8fCB0aGlzLmdyZWVkeUNoaWxkIHx8ICF0aGlzLnZpc2libGUgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCXZhciBwYXJlbnRJbnN0YW5jZSwgc2NvcGUsIHBhcmVudCwKCQkJCWludGVyc2VjdHMgPSAkLnVpLmludGVyc2VjdCggZHJhZ2dhYmxlLCB0aGlzLCB0aGlzLm9wdGlvbnMudG9sZXJhbmNlLCBldmVudCApLAoJCQkJYyA9ICFpbnRlcnNlY3RzICYmIHRoaXMuaXNvdmVyID8gImlzb3V0IiA6ICggaW50ZXJzZWN0cyAmJiAhdGhpcy5pc292ZXIgPyAiaXNvdmVyIiA6IG51bGwgKTsKCQkJaWYgKCAhYyApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYgKCB0aGlzLm9wdGlvbnMuZ3JlZWR5ICkgewoJCQkJLy8gZmluZCBkcm9wcGFibGUgcGFyZW50cyB3aXRoIHNhbWUgc2NvcGUKCQkJCXNjb3BlID0gdGhpcy5vcHRpb25zLnNjb3BlOwoJCQkJcGFyZW50ID0gdGhpcy5lbGVtZW50LnBhcmVudHMoICI6ZGF0YSh1aS1kcm9wcGFibGUpIiApLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gJCggdGhpcyApLmRyb3BwYWJsZSggImluc3RhbmNlIiApLm9wdGlvbnMuc2NvcGUgPT09IHNjb3BlOwoJCQkJfSk7CgoJCQkJaWYgKCBwYXJlbnQubGVuZ3RoICkgewoJCQkJCXBhcmVudEluc3RhbmNlID0gJCggcGFyZW50WyAwIF0gKS5kcm9wcGFibGUoICJpbnN0YW5jZSIgKTsKCQkJCQlwYXJlbnRJbnN0YW5jZS5ncmVlZHlDaGlsZCA9ICggYyA9PT0gImlzb3ZlciIgKTsKCQkJCX0KCQkJfQoKCQkJLy8gd2UganVzdCBtb3ZlZCBpbnRvIGEgZ3JlZWR5IGNoaWxkCgkJCWlmICggcGFyZW50SW5zdGFuY2UgJiYgYyA9PT0gImlzb3ZlciIgKSB7CgkJCQlwYXJlbnRJbnN0YW5jZS5pc292ZXIgPSBmYWxzZTsKCQkJCXBhcmVudEluc3RhbmNlLmlzb3V0ID0gdHJ1ZTsKCQkJCXBhcmVudEluc3RhbmNlLl9vdXQuY2FsbCggcGFyZW50SW5zdGFuY2UsIGV2ZW50ICk7CgkJCX0KCgkJCXRoaXNbIGMgXSA9IHRydWU7CgkJCXRoaXNbYyA9PT0gImlzb3V0IiA/ICJpc292ZXIiIDogImlzb3V0Il0gPSBmYWxzZTsKCQkJdGhpc1tjID09PSAiaXNvdmVyIiA/ICJfb3ZlciIgOiAiX291dCJdLmNhbGwoIHRoaXMsIGV2ZW50ICk7CgoJCQkvLyB3ZSBqdXN0IG1vdmVkIG91dCBvZiBhIGdyZWVkeSBjaGlsZAoJCQlpZiAoIHBhcmVudEluc3RhbmNlICYmIGMgPT09ICJpc291dCIgKSB7CgkJCQlwYXJlbnRJbnN0YW5jZS5pc291dCA9IGZhbHNlOwoJCQkJcGFyZW50SW5zdGFuY2UuaXNvdmVyID0gdHJ1ZTsKCQkJCXBhcmVudEluc3RhbmNlLl9vdmVyLmNhbGwoIHBhcmVudEluc3RhbmNlLCBldmVudCApOwoJCQl9CgkJfSk7CgoJfSwKCWRyYWdTdG9wOiBmdW5jdGlvbiggZHJhZ2dhYmxlLCBldmVudCApIHsKCQlkcmFnZ2FibGUuZWxlbWVudC5wYXJlbnRzVW50aWwoICJib2R5IiApLnVuYmluZCggInNjcm9sbC5kcm9wcGFibGUiICk7CgkJLy8gQ2FsbCBwcmVwYXJlT2Zmc2V0cyBvbmUgZmluYWwgdGltZSBzaW5jZSBJRSBkb2VzIG5vdCBmaXJlIHJldHVybiBzY3JvbGwgZXZlbnRzIHdoZW4gb3ZlcmZsb3cgd2FzIGNhdXNlZCBieSBkcmFnIChzZWUgIzUwMDMpCgkJaWYgKCAhZHJhZ2dhYmxlLm9wdGlvbnMucmVmcmVzaFBvc2l0aW9ucyApIHsKCQkJJC51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoIGRyYWdnYWJsZSwgZXZlbnQgKTsKCQl9Cgl9Cn07Cgp2YXIgZHJvcHBhYmxlID0gJC51aS5kcm9wcGFibGU7CgoKLyohCiAqIGpRdWVyeSBVSSBFZmZlY3RzIDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL2NhdGVnb3J5L2VmZmVjdHMtY29yZS8KICovCgoKdmFyIGRhdGFTcGFjZSA9ICJ1aS1lZmZlY3RzLSIsCgoJLy8gQ3JlYXRlIGEgbG9jYWwgalF1ZXJ5IGJlY2F1c2UgalF1ZXJ5IENvbG9yIHJlbGllcyBvbiBpdCBhbmQgdGhlCgkvLyBnbG9iYWwgbWF5IG5vdCBleGlzdCB3aXRoIEFNRCBhbmQgYSBjdXN0b20gYnVpbGQgKCMxMDE5OSkKCWpRdWVyeSA9ICQ7CgokLmVmZmVjdHMgPSB7CgllZmZlY3Q6IHt9Cn07CgovKiEKICogalF1ZXJ5IENvbG9yIEFuaW1hdGlvbnMgdjIuMS4yCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LWNvbG9yCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIERhdGU6IFdlZCBKYW4gMTYgMDg6NDc6MDkgMjAxMyAtMDYwMAogKi8KKGZ1bmN0aW9uKCBqUXVlcnksIHVuZGVmaW5lZCApIHsKCgl2YXIgc3RlcEhvb2tzID0gImJhY2tncm91bmRDb2xvciBib3JkZXJCb3R0b21Db2xvciBib3JkZXJMZWZ0Q29sb3IgYm9yZGVyUmlnaHRDb2xvciBib3JkZXJUb3BDb2xvciBjb2xvciBjb2x1bW5SdWxlQ29sb3Igb3V0bGluZUNvbG9yIHRleHREZWNvcmF0aW9uQ29sb3IgdGV4dEVtcGhhc2lzQ29sb3IiLAoKCS8vIHBsdXNlcXVhbHMgdGVzdCBmb3IgKz0gMTAwIC09IDEwMAoJcnBsdXNlcXVhbHMgPSAvXihbXC0rXSk9XHMqKFxkK1wuP1xkKikvLAoJLy8gYSBzZXQgb2YgUkUncyB0aGF0IGNhbiBtYXRjaCBzdHJpbmdzIGFuZCBnZW5lcmF0ZSBjb2xvciB0dXBsZXMuCglzdHJpbmdQYXJzZXJzID0gWyB7CgkJCXJlOiAvcmdiYT9cKFxzKihcZHsxLDN9KVxzKixccyooXGR7MSwzfSlccyosXHMqKFxkezEsM30pXHMqKD86LFxzKihcZD8oPzpcLlxkKyk/KVxzKik/XCkvLAoJCQlwYXJzZTogZnVuY3Rpb24oIGV4ZWNSZXN1bHQgKSB7CgkJCQlyZXR1cm4gWwoJCQkJCWV4ZWNSZXN1bHRbIDEgXSwKCQkJCQlleGVjUmVzdWx0WyAyIF0sCgkJCQkJZXhlY1Jlc3VsdFsgMyBdLAoJCQkJCWV4ZWNSZXN1bHRbIDQgXQoJCQkJXTsKCQkJfQoJCX0sIHsKCQkJcmU6IC9yZ2JhP1woXHMqKFxkKyg/OlwuXGQrKT8pXCVccyosXHMqKFxkKyg/OlwuXGQrKT8pXCVccyosXHMqKFxkKyg/OlwuXGQrKT8pXCVccyooPzosXHMqKFxkPyg/OlwuXGQrKT8pXHMqKT9cKS8sCgkJCXBhcnNlOiBmdW5jdGlvbiggZXhlY1Jlc3VsdCApIHsKCQkJCXJldHVybiBbCgkJCQkJZXhlY1Jlc3VsdFsgMSBdICogMi41NSwKCQkJCQlleGVjUmVzdWx0WyAyIF0gKiAyLjU1LAoJCQkJCWV4ZWNSZXN1bHRbIDMgXSAqIDIuNTUsCgkJCQkJZXhlY1Jlc3VsdFsgNCBdCgkJCQldOwoJCQl9CgkJfSwgewoJCQkvLyB0aGlzIHJlZ2V4IGlnbm9yZXMgQS1GIGJlY2F1c2UgaXQncyBjb21wYXJlZCBhZ2FpbnN0IGFuIGFscmVhZHkgbG93ZXJjYXNlZCBzdHJpbmcKCQkJcmU6IC8jKFthLWYwLTldezJ9KShbYS1mMC05XXsyfSkoW2EtZjAtOV17Mn0pLywKCQkJcGFyc2U6IGZ1bmN0aW9uKCBleGVjUmVzdWx0ICkgewoJCQkJcmV0dXJuIFsKCQkJCQlwYXJzZUludCggZXhlY1Jlc3VsdFsgMSBdLCAxNiApLAoJCQkJCXBhcnNlSW50KCBleGVjUmVzdWx0WyAyIF0sIDE2ICksCgkJCQkJcGFyc2VJbnQoIGV4ZWNSZXN1bHRbIDMgXSwgMTYgKQoJCQkJXTsKCQkJfQoJCX0sIHsKCQkJLy8gdGhpcyByZWdleCBpZ25vcmVzIEEtRiBiZWNhdXNlIGl0J3MgY29tcGFyZWQgYWdhaW5zdCBhbiBhbHJlYWR5IGxvd2VyY2FzZWQgc3RyaW5nCgkJCXJlOiAvIyhbYS1mMC05XSkoW2EtZjAtOV0pKFthLWYwLTldKS8sCgkJCXBhcnNlOiBmdW5jdGlvbiggZXhlY1Jlc3VsdCApIHsKCQkJCXJldHVybiBbCgkJCQkJcGFyc2VJbnQoIGV4ZWNSZXN1bHRbIDEgXSArIGV4ZWNSZXN1bHRbIDEgXSwgMTYgKSwKCQkJCQlwYXJzZUludCggZXhlY1Jlc3VsdFsgMiBdICsgZXhlY1Jlc3VsdFsgMiBdLCAxNiApLAoJCQkJCXBhcnNlSW50KCBleGVjUmVzdWx0WyAzIF0gKyBleGVjUmVzdWx0WyAzIF0sIDE2ICkKCQkJCV07CgkJCX0KCQl9LCB7CgkJCXJlOiAvaHNsYT9cKFxzKihcZCsoPzpcLlxkKyk/KVxzKixccyooXGQrKD86XC5cZCspPylcJVxzKixccyooXGQrKD86XC5cZCspPylcJVxzKig/OixccyooXGQ/KD86XC5cZCspPylccyopP1wpLywKCQkJc3BhY2U6ICJoc2xhIiwKCQkJcGFyc2U6IGZ1bmN0aW9uKCBleGVjUmVzdWx0ICkgewoJCQkJcmV0dXJuIFsKCQkJCQlleGVjUmVzdWx0WyAxIF0sCgkJCQkJZXhlY1Jlc3VsdFsgMiBdIC8gMTAwLAoJCQkJCWV4ZWNSZXN1bHRbIDMgXSAvIDEwMCwKCQkJCQlleGVjUmVzdWx0WyA0IF0KCQkJCV07CgkJCX0KCQl9IF0sCgoJLy8galF1ZXJ5LkNvbG9yKCApCgljb2xvciA9IGpRdWVyeS5Db2xvciA9IGZ1bmN0aW9uKCBjb2xvciwgZ3JlZW4sIGJsdWUsIGFscGhhICkgewoJCXJldHVybiBuZXcgalF1ZXJ5LkNvbG9yLmZuLnBhcnNlKCBjb2xvciwgZ3JlZW4sIGJsdWUsIGFscGhhICk7Cgl9LAoJc3BhY2VzID0gewoJCXJnYmE6IHsKCQkJcHJvcHM6IHsKCQkJCXJlZDogewoJCQkJCWlkeDogMCwKCQkJCQl0eXBlOiAiYnl0ZSIKCQkJCX0sCgkJCQlncmVlbjogewoJCQkJCWlkeDogMSwKCQkJCQl0eXBlOiAiYnl0ZSIKCQkJCX0sCgkJCQlibHVlOiB7CgkJCQkJaWR4OiAyLAoJCQkJCXR5cGU6ICJieXRlIgoJCQkJfQoJCQl9CgkJfSwKCgkJaHNsYTogewoJCQlwcm9wczogewoJCQkJaHVlOiB7CgkJCQkJaWR4OiAwLAoJCQkJCXR5cGU6ICJkZWdyZWVzIgoJCQkJfSwKCQkJCXNhdHVyYXRpb246IHsKCQkJCQlpZHg6IDEsCgkJCQkJdHlwZTogInBlcmNlbnQiCgkJCQl9LAoJCQkJbGlnaHRuZXNzOiB7CgkJCQkJaWR4OiAyLAoJCQkJCXR5cGU6ICJwZXJjZW50IgoJCQkJfQoJCQl9CgkJfQoJfSwKCXByb3BUeXBlcyA9IHsKCQkiYnl0ZSI6IHsKCQkJZmxvb3I6IHRydWUsCgkJCW1heDogMjU1CgkJfSwKCQkicGVyY2VudCI6IHsKCQkJbWF4OiAxCgkJfSwKCQkiZGVncmVlcyI6IHsKCQkJbW9kOiAzNjAsCgkJCWZsb29yOiB0cnVlCgkJfQoJfSwKCXN1cHBvcnQgPSBjb2xvci5zdXBwb3J0ID0ge30sCgoJLy8gZWxlbWVudCBmb3Igc3VwcG9ydCB0ZXN0cwoJc3VwcG9ydEVsZW0gPSBqUXVlcnkoICI8cD4iIClbIDAgXSwKCgkvLyBjb2xvcnMgPSBqUXVlcnkuQ29sb3IubmFtZXMKCWNvbG9ycywKCgkvLyBsb2NhbCBhbGlhc2VzIG9mIGZ1bmN0aW9ucyBjYWxsZWQgb2Z0ZW4KCWVhY2ggPSBqUXVlcnkuZWFjaDsKCi8vIGRldGVybWluZSByZ2JhIHN1cHBvcnQgaW1tZWRpYXRlbHkKc3VwcG9ydEVsZW0uc3R5bGUuY3NzVGV4dCA9ICJiYWNrZ3JvdW5kLWNvbG9yOnJnYmEoMSwxLDEsLjUpIjsKc3VwcG9ydC5yZ2JhID0gc3VwcG9ydEVsZW0uc3R5bGUuYmFja2dyb3VuZENvbG9yLmluZGV4T2YoICJyZ2JhIiApID4gLTE7CgovLyBkZWZpbmUgY2FjaGUgbmFtZSBhbmQgYWxwaGEgcHJvcGVydGllcwovLyBmb3IgcmdiYSBhbmQgaHNsYSBzcGFjZXMKZWFjaCggc3BhY2VzLCBmdW5jdGlvbiggc3BhY2VOYW1lLCBzcGFjZSApIHsKCXNwYWNlLmNhY2hlID0gIl8iICsgc3BhY2VOYW1lOwoJc3BhY2UucHJvcHMuYWxwaGEgPSB7CgkJaWR4OiAzLAoJCXR5cGU6ICJwZXJjZW50IiwKCQlkZWY6IDEKCX07Cn0pOwoKZnVuY3Rpb24gY2xhbXAoIHZhbHVlLCBwcm9wLCBhbGxvd0VtcHR5ICkgewoJdmFyIHR5cGUgPSBwcm9wVHlwZXNbIHByb3AudHlwZSBdIHx8IHt9OwoKCWlmICggdmFsdWUgPT0gbnVsbCApIHsKCQlyZXR1cm4gKGFsbG93RW1wdHkgfHwgIXByb3AuZGVmKSA/IG51bGwgOiBwcm9wLmRlZjsKCX0KCgkvLyB+fiBpcyBhbiBzaG9ydCB3YXkgb2YgZG9pbmcgZmxvb3IgZm9yIHBvc2l0aXZlIG51bWJlcnMKCXZhbHVlID0gdHlwZS5mbG9vciA/IH5+dmFsdWUgOiBwYXJzZUZsb2F0KCB2YWx1ZSApOwoKCS8vIElFIHdpbGwgcGFzcyBpbiBlbXB0eSBzdHJpbmdzIGFzIHZhbHVlIGZvciBhbHBoYSwKCS8vIHdoaWNoIHdpbGwgaGl0IHRoaXMgY2FzZQoJaWYgKCBpc05hTiggdmFsdWUgKSApIHsKCQlyZXR1cm4gcHJvcC5kZWY7Cgl9CgoJaWYgKCB0eXBlLm1vZCApIHsKCQkvLyB3ZSBhZGQgbW9kIGJlZm9yZSBtb2RkaW5nIHRvIG1ha2Ugc3VyZSB0aGF0IG5lZ2F0aXZlcyB2YWx1ZXMKCQkvLyBnZXQgY29udmVydGVkIHByb3Blcmx5OiAtMTAgLT4gMzUwCgkJcmV0dXJuICh2YWx1ZSArIHR5cGUubW9kKSAlIHR5cGUubW9kOwoJfQoKCS8vIGZvciBub3cgYWxsIHByb3BlcnR5IHR5cGVzIHdpdGhvdXQgbW9kIGhhdmUgbWluIGFuZCBtYXgKCXJldHVybiAwID4gdmFsdWUgPyAwIDogdHlwZS5tYXggPCB2YWx1ZSA/IHR5cGUubWF4IDogdmFsdWU7Cn0KCmZ1bmN0aW9uIHN0cmluZ1BhcnNlKCBzdHJpbmcgKSB7Cgl2YXIgaW5zdCA9IGNvbG9yKCksCgkJcmdiYSA9IGluc3QuX3JnYmEgPSBbXTsKCglzdHJpbmcgPSBzdHJpbmcudG9Mb3dlckNhc2UoKTsKCgllYWNoKCBzdHJpbmdQYXJzZXJzLCBmdW5jdGlvbiggaSwgcGFyc2VyICkgewoJCXZhciBwYXJzZWQsCgkJCW1hdGNoID0gcGFyc2VyLnJlLmV4ZWMoIHN0cmluZyApLAoJCQl2YWx1ZXMgPSBtYXRjaCAmJiBwYXJzZXIucGFyc2UoIG1hdGNoICksCgkJCXNwYWNlTmFtZSA9IHBhcnNlci5zcGFjZSB8fCAicmdiYSI7CgoJCWlmICggdmFsdWVzICkgewoJCQlwYXJzZWQgPSBpbnN0WyBzcGFjZU5hbWUgXSggdmFsdWVzICk7CgoJCQkvLyBpZiB0aGlzIHdhcyBhbiByZ2JhIHBhcnNlIHRoZSBhc3NpZ25tZW50IG1pZ2h0IGhhcHBlbiB0d2ljZQoJCQkvLyBvaCB3ZWxsLi4uLgoJCQlpbnN0WyBzcGFjZXNbIHNwYWNlTmFtZSBdLmNhY2hlIF0gPSBwYXJzZWRbIHNwYWNlc1sgc3BhY2VOYW1lIF0uY2FjaGUgXTsKCQkJcmdiYSA9IGluc3QuX3JnYmEgPSBwYXJzZWQuX3JnYmE7CgoJCQkvLyBleGl0IGVhY2goIHN0cmluZ1BhcnNlcnMgKSBoZXJlIGJlY2F1c2Ugd2UgbWF0Y2hlZAoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfSk7CgoJLy8gRm91bmQgYSBzdHJpbmdQYXJzZXIgdGhhdCBoYW5kbGVkIGl0CglpZiAoIHJnYmEubGVuZ3RoICkgewoKCQkvLyBpZiB0aGlzIGNhbWUgZnJvbSBhIHBhcnNlZCBzdHJpbmcsIGZvcmNlICJ0cmFuc3BhcmVudCIgd2hlbiBhbHBoYSBpcyAwCgkJLy8gY2hyb21lLCAoYW5kIG1heWJlIG90aGVycykgcmV0dXJuICJ0cmFuc3BhcmVudCIgYXMgcmdiYSgwLDAsMCwwKQoJCWlmICggcmdiYS5qb2luKCkgPT09ICIwLDAsMCwwIiApIHsKCQkJalF1ZXJ5LmV4dGVuZCggcmdiYSwgY29sb3JzLnRyYW5zcGFyZW50ICk7CgkJfQoJCXJldHVybiBpbnN0OwoJfQoKCS8vIG5hbWVkIGNvbG9ycwoJcmV0dXJuIGNvbG9yc1sgc3RyaW5nIF07Cn0KCmNvbG9yLmZuID0galF1ZXJ5LmV4dGVuZCggY29sb3IucHJvdG90eXBlLCB7CglwYXJzZTogZnVuY3Rpb24oIHJlZCwgZ3JlZW4sIGJsdWUsIGFscGhhICkgewoJCWlmICggcmVkID09PSB1bmRlZmluZWQgKSB7CgkJCXRoaXMuX3JnYmEgPSBbIG51bGwsIG51bGwsIG51bGwsIG51bGwgXTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoJCWlmICggcmVkLmpxdWVyeSB8fCByZWQubm9kZVR5cGUgKSB7CgkJCXJlZCA9IGpRdWVyeSggcmVkICkuY3NzKCBncmVlbiApOwoJCQlncmVlbiA9IHVuZGVmaW5lZDsKCQl9CgoJCXZhciBpbnN0ID0gdGhpcywKCQkJdHlwZSA9IGpRdWVyeS50eXBlKCByZWQgKSwKCQkJcmdiYSA9IHRoaXMuX3JnYmEgPSBbXTsKCgkJLy8gbW9yZSB0aGFuIDEgYXJndW1lbnQgc3BlY2lmaWVkIC0gYXNzdW1lICggcmVkLCBncmVlbiwgYmx1ZSwgYWxwaGEgKQoJCWlmICggZ3JlZW4gIT09IHVuZGVmaW5lZCApIHsKCQkJcmVkID0gWyByZWQsIGdyZWVuLCBibHVlLCBhbHBoYSBdOwoJCQl0eXBlID0gImFycmF5IjsKCQl9CgoJCWlmICggdHlwZSA9PT0gInN0cmluZyIgKSB7CgkJCXJldHVybiB0aGlzLnBhcnNlKCBzdHJpbmdQYXJzZSggcmVkICkgfHwgY29sb3JzLl9kZWZhdWx0ICk7CgkJfQoKCQlpZiAoIHR5cGUgPT09ICJhcnJheSIgKSB7CgkJCWVhY2goIHNwYWNlcy5yZ2JhLnByb3BzLCBmdW5jdGlvbigga2V5LCBwcm9wICkgewoJCQkJcmdiYVsgcHJvcC5pZHggXSA9IGNsYW1wKCByZWRbIHByb3AuaWR4IF0sIHByb3AgKTsKCQkJfSk7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJaWYgKCB0eXBlID09PSAib2JqZWN0IiApIHsKCQkJaWYgKCByZWQgaW5zdGFuY2VvZiBjb2xvciApIHsKCQkJCWVhY2goIHNwYWNlcywgZnVuY3Rpb24oIHNwYWNlTmFtZSwgc3BhY2UgKSB7CgkJCQkJaWYgKCByZWRbIHNwYWNlLmNhY2hlIF0gKSB7CgkJCQkJCWluc3RbIHNwYWNlLmNhY2hlIF0gPSByZWRbIHNwYWNlLmNhY2hlIF0uc2xpY2UoKTsKCQkJCQl9CgkJCQl9KTsKCQkJfSBlbHNlIHsKCQkJCWVhY2goIHNwYWNlcywgZnVuY3Rpb24oIHNwYWNlTmFtZSwgc3BhY2UgKSB7CgkJCQkJdmFyIGNhY2hlID0gc3BhY2UuY2FjaGU7CgkJCQkJZWFjaCggc3BhY2UucHJvcHMsIGZ1bmN0aW9uKCBrZXksIHByb3AgKSB7CgoJCQkJCQkvLyBpZiB0aGUgY2FjaGUgZG9lc24ndCBleGlzdCwgYW5kIHdlIGtub3cgaG93IHRvIGNvbnZlcnQKCQkJCQkJaWYgKCAhaW5zdFsgY2FjaGUgXSAmJiBzcGFjZS50byApIHsKCgkJCQkJCQkvLyBpZiB0aGUgdmFsdWUgd2FzIG51bGwsIHdlIGRvbid0IG5lZWQgdG8gY29weSBpdAoJCQkJCQkJLy8gaWYgdGhlIGtleSB3YXMgYWxwaGEsIHdlIGRvbid0IG5lZWQgdG8gY29weSBpdCBlaXRoZXIKCQkJCQkJCWlmICgga2V5ID09PSAiYWxwaGEiIHx8IHJlZFsga2V5IF0gPT0gbnVsbCApIHsKCQkJCQkJCQlyZXR1cm47CgkJCQkJCQl9CgkJCQkJCQlpbnN0WyBjYWNoZSBdID0gc3BhY2UudG8oIGluc3QuX3JnYmEgKTsKCQkJCQkJfQoKCQkJCQkJLy8gdGhpcyBpcyB0aGUgb25seSBjYXNlIHdoZXJlIHdlIGFsbG93IG51bGxzIGZvciBBTEwgcHJvcGVydGllcy4KCQkJCQkJLy8gY2FsbCBjbGFtcCB3aXRoIGFsd2F5c0FsbG93RW1wdHkKCQkJCQkJaW5zdFsgY2FjaGUgXVsgcHJvcC5pZHggXSA9IGNsYW1wKCByZWRbIGtleSBdLCBwcm9wLCB0cnVlICk7CgkJCQkJfSk7CgoJCQkJCS8vIGV2ZXJ5dGhpbmcgZGVmaW5lZCBidXQgYWxwaGE/CgkJCQkJaWYgKCBpbnN0WyBjYWNoZSBdICYmIGpRdWVyeS5pbkFycmF5KCBudWxsLCBpbnN0WyBjYWNoZSBdLnNsaWNlKCAwLCAzICkgKSA8IDAgKSB7CgkJCQkJCS8vIHVzZSB0aGUgZGVmYXVsdCBvZiAxCgkJCQkJCWluc3RbIGNhY2hlIF1bIDMgXSA9IDE7CgkJCQkJCWlmICggc3BhY2UuZnJvbSApIHsKCQkJCQkJCWluc3QuX3JnYmEgPSBzcGFjZS5mcm9tKCBpbnN0WyBjYWNoZSBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9KTsKCQkJfQoJCQlyZXR1cm4gdGhpczsKCQl9Cgl9LAoJaXM6IGZ1bmN0aW9uKCBjb21wYXJlICkgewoJCXZhciBpcyA9IGNvbG9yKCBjb21wYXJlICksCgkJCXNhbWUgPSB0cnVlLAoJCQlpbnN0ID0gdGhpczsKCgkJZWFjaCggc3BhY2VzLCBmdW5jdGlvbiggXywgc3BhY2UgKSB7CgkJCXZhciBsb2NhbENhY2hlLAoJCQkJaXNDYWNoZSA9IGlzWyBzcGFjZS5jYWNoZSBdOwoJCQlpZiAoaXNDYWNoZSkgewoJCQkJbG9jYWxDYWNoZSA9IGluc3RbIHNwYWNlLmNhY2hlIF0gfHwgc3BhY2UudG8gJiYgc3BhY2UudG8oIGluc3QuX3JnYmEgKSB8fCBbXTsKCQkJCWVhY2goIHNwYWNlLnByb3BzLCBmdW5jdGlvbiggXywgcHJvcCApIHsKCQkJCQlpZiAoIGlzQ2FjaGVbIHByb3AuaWR4IF0gIT0gbnVsbCApIHsKCQkJCQkJc2FtZSA9ICggaXNDYWNoZVsgcHJvcC5pZHggXSA9PT0gbG9jYWxDYWNoZVsgcHJvcC5pZHggXSApOwoJCQkJCQlyZXR1cm4gc2FtZTsKCQkJCQl9CgkJCQl9KTsKCQkJfQoJCQlyZXR1cm4gc2FtZTsKCQl9KTsKCQlyZXR1cm4gc2FtZTsKCX0sCglfc3BhY2U6IGZ1bmN0aW9uKCkgewoJCXZhciB1c2VkID0gW10sCgkJCWluc3QgPSB0aGlzOwoJCWVhY2goIHNwYWNlcywgZnVuY3Rpb24oIHNwYWNlTmFtZSwgc3BhY2UgKSB7CgkJCWlmICggaW5zdFsgc3BhY2UuY2FjaGUgXSApIHsKCQkJCXVzZWQucHVzaCggc3BhY2VOYW1lICk7CgkJCX0KCQl9KTsKCQlyZXR1cm4gdXNlZC5wb3AoKTsKCX0sCgl0cmFuc2l0aW9uOiBmdW5jdGlvbiggb3RoZXIsIGRpc3RhbmNlICkgewoJCXZhciBlbmQgPSBjb2xvciggb3RoZXIgKSwKCQkJc3BhY2VOYW1lID0gZW5kLl9zcGFjZSgpLAoJCQlzcGFjZSA9IHNwYWNlc1sgc3BhY2VOYW1lIF0sCgkJCXN0YXJ0Q29sb3IgPSB0aGlzLmFscGhhKCkgPT09IDAgPyBjb2xvciggInRyYW5zcGFyZW50IiApIDogdGhpcywKCQkJc3RhcnQgPSBzdGFydENvbG9yWyBzcGFjZS5jYWNoZSBdIHx8IHNwYWNlLnRvKCBzdGFydENvbG9yLl9yZ2JhICksCgkJCXJlc3VsdCA9IHN0YXJ0LnNsaWNlKCk7CgoJCWVuZCA9IGVuZFsgc3BhY2UuY2FjaGUgXTsKCQllYWNoKCBzcGFjZS5wcm9wcywgZnVuY3Rpb24oIGtleSwgcHJvcCApIHsKCQkJdmFyIGluZGV4ID0gcHJvcC5pZHgsCgkJCQlzdGFydFZhbHVlID0gc3RhcnRbIGluZGV4IF0sCgkJCQllbmRWYWx1ZSA9IGVuZFsgaW5kZXggXSwKCQkJCXR5cGUgPSBwcm9wVHlwZXNbIHByb3AudHlwZSBdIHx8IHt9OwoKCQkJLy8gaWYgbnVsbCwgZG9uJ3Qgb3ZlcnJpZGUgc3RhcnQgdmFsdWUKCQkJaWYgKCBlbmRWYWx1ZSA9PT0gbnVsbCApIHsKCQkJCXJldHVybjsKCQkJfQoJCQkvLyBpZiBudWxsIC0gdXNlIGVuZAoJCQlpZiAoIHN0YXJ0VmFsdWUgPT09IG51bGwgKSB7CgkJCQlyZXN1bHRbIGluZGV4IF0gPSBlbmRWYWx1ZTsKCQkJfSBlbHNlIHsKCQkJCWlmICggdHlwZS5tb2QgKSB7CgkJCQkJaWYgKCBlbmRWYWx1ZSAtIHN0YXJ0VmFsdWUgPiB0eXBlLm1vZCAvIDIgKSB7CgkJCQkJCXN0YXJ0VmFsdWUgKz0gdHlwZS5tb2Q7CgkJCQkJfSBlbHNlIGlmICggc3RhcnRWYWx1ZSAtIGVuZFZhbHVlID4gdHlwZS5tb2QgLyAyICkgewoJCQkJCQlzdGFydFZhbHVlIC09IHR5cGUubW9kOwoJCQkJCX0KCQkJCX0KCQkJCXJlc3VsdFsgaW5kZXggXSA9IGNsYW1wKCAoIGVuZFZhbHVlIC0gc3RhcnRWYWx1ZSApICogZGlzdGFuY2UgKyBzdGFydFZhbHVlLCBwcm9wICk7CgkJCX0KCQl9KTsKCQlyZXR1cm4gdGhpc1sgc3BhY2VOYW1lIF0oIHJlc3VsdCApOwoJfSwKCWJsZW5kOiBmdW5jdGlvbiggb3BhcXVlICkgewoJCS8vIGlmIHdlIGFyZSBhbHJlYWR5IG9wYXF1ZSAtIHJldHVybiBvdXJzZWxmCgkJaWYgKCB0aGlzLl9yZ2JhWyAzIF0gPT09IDEgKSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJdmFyIHJnYiA9IHRoaXMuX3JnYmEuc2xpY2UoKSwKCQkJYSA9IHJnYi5wb3AoKSwKCQkJYmxlbmQgPSBjb2xvciggb3BhcXVlICkuX3JnYmE7CgoJCXJldHVybiBjb2xvciggalF1ZXJ5Lm1hcCggcmdiLCBmdW5jdGlvbiggdiwgaSApIHsKCQkJcmV0dXJuICggMSAtIGEgKSAqIGJsZW5kWyBpIF0gKyBhICogdjsKCQl9KSk7Cgl9LAoJdG9SZ2JhU3RyaW5nOiBmdW5jdGlvbigpIHsKCQl2YXIgcHJlZml4ID0gInJnYmEoIiwKCQkJcmdiYSA9IGpRdWVyeS5tYXAoIHRoaXMuX3JnYmEsIGZ1bmN0aW9uKCB2LCBpICkgewoJCQkJcmV0dXJuIHYgPT0gbnVsbCA/ICggaSA+IDIgPyAxIDogMCApIDogdjsKCQkJfSk7CgoJCWlmICggcmdiYVsgMyBdID09PSAxICkgewoJCQlyZ2JhLnBvcCgpOwoJCQlwcmVmaXggPSAicmdiKCI7CgkJfQoKCQlyZXR1cm4gcHJlZml4ICsgcmdiYS5qb2luKCkgKyAiKSI7Cgl9LAoJdG9Ic2xhU3RyaW5nOiBmdW5jdGlvbigpIHsKCQl2YXIgcHJlZml4ID0gImhzbGEoIiwKCQkJaHNsYSA9IGpRdWVyeS5tYXAoIHRoaXMuaHNsYSgpLCBmdW5jdGlvbiggdiwgaSApIHsKCQkJCWlmICggdiA9PSBudWxsICkgewoJCQkJCXYgPSBpID4gMiA/IDEgOiAwOwoJCQkJfQoKCQkJCS8vIGNhdGNoIDEgYW5kIDIKCQkJCWlmICggaSAmJiBpIDwgMyApIHsKCQkJCQl2ID0gTWF0aC5yb3VuZCggdiAqIDEwMCApICsgIiUiOwoJCQkJfQoJCQkJcmV0dXJuIHY7CgkJCX0pOwoKCQlpZiAoIGhzbGFbIDMgXSA9PT0gMSApIHsKCQkJaHNsYS5wb3AoKTsKCQkJcHJlZml4ID0gImhzbCgiOwoJCX0KCQlyZXR1cm4gcHJlZml4ICsgaHNsYS5qb2luKCkgKyAiKSI7Cgl9LAoJdG9IZXhTdHJpbmc6IGZ1bmN0aW9uKCBpbmNsdWRlQWxwaGEgKSB7CgkJdmFyIHJnYmEgPSB0aGlzLl9yZ2JhLnNsaWNlKCksCgkJCWFscGhhID0gcmdiYS5wb3AoKTsKCgkJaWYgKCBpbmNsdWRlQWxwaGEgKSB7CgkJCXJnYmEucHVzaCggfn4oIGFscGhhICogMjU1ICkgKTsKCQl9CgoJCXJldHVybiAiIyIgKyBqUXVlcnkubWFwKCByZ2JhLCBmdW5jdGlvbiggdiApIHsKCgkJCS8vIGRlZmF1bHQgdG8gMCB3aGVuIG51bGxzIGV4aXN0CgkJCXYgPSAoIHYgfHwgMCApLnRvU3RyaW5nKCAxNiApOwoJCQlyZXR1cm4gdi5sZW5ndGggPT09IDEgPyAiMCIgKyB2IDogdjsKCQl9KS5qb2luKCIiKTsKCX0sCgl0b1N0cmluZzogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuX3JnYmFbIDMgXSA9PT0gMCA/ICJ0cmFuc3BhcmVudCIgOiB0aGlzLnRvUmdiYVN0cmluZygpOwoJfQp9KTsKY29sb3IuZm4ucGFyc2UucHJvdG90eXBlID0gY29sb3IuZm47CgovLyBoc2xhIGNvbnZlcnNpb25zIGFkYXB0ZWQgZnJvbToKLy8gaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9tYWFzaGFhY2svc291cmNlL2Jyb3dzZS9wYWNrYWdlcy9ncmFwaGljcy90cnVuay9zcmMvZ3JhcGhpY3MvY29sb3JzL0hVRTJSR0IuYXM/cj01MDIxCgpmdW5jdGlvbiBodWUycmdiKCBwLCBxLCBoICkgewoJaCA9ICggaCArIDEgKSAlIDE7CglpZiAoIGggKiA2IDwgMSApIHsKCQlyZXR1cm4gcCArICggcSAtIHAgKSAqIGggKiA2OwoJfQoJaWYgKCBoICogMiA8IDEpIHsKCQlyZXR1cm4gcTsKCX0KCWlmICggaCAqIDMgPCAyICkgewoJCXJldHVybiBwICsgKCBxIC0gcCApICogKCAoIDIgLyAzICkgLSBoICkgKiA2OwoJfQoJcmV0dXJuIHA7Cn0KCnNwYWNlcy5oc2xhLnRvID0gZnVuY3Rpb24oIHJnYmEgKSB7CglpZiAoIHJnYmFbIDAgXSA9PSBudWxsIHx8IHJnYmFbIDEgXSA9PSBudWxsIHx8IHJnYmFbIDIgXSA9PSBudWxsICkgewoJCXJldHVybiBbIG51bGwsIG51bGwsIG51bGwsIHJnYmFbIDMgXSBdOwoJfQoJdmFyIHIgPSByZ2JhWyAwIF0gLyAyNTUsCgkJZyA9IHJnYmFbIDEgXSAvIDI1NSwKCQliID0gcmdiYVsgMiBdIC8gMjU1LAoJCWEgPSByZ2JhWyAzIF0sCgkJbWF4ID0gTWF0aC5tYXgoIHIsIGcsIGIgKSwKCQltaW4gPSBNYXRoLm1pbiggciwgZywgYiApLAoJCWRpZmYgPSBtYXggLSBtaW4sCgkJYWRkID0gbWF4ICsgbWluLAoJCWwgPSBhZGQgKiAwLjUsCgkJaCwgczsKCglpZiAoIG1pbiA9PT0gbWF4ICkgewoJCWggPSAwOwoJfSBlbHNlIGlmICggciA9PT0gbWF4ICkgewoJCWggPSAoIDYwICogKCBnIC0gYiApIC8gZGlmZiApICsgMzYwOwoJfSBlbHNlIGlmICggZyA9PT0gbWF4ICkgewoJCWggPSAoIDYwICogKCBiIC0gciApIC8gZGlmZiApICsgMTIwOwoJfSBlbHNlIHsKCQloID0gKCA2MCAqICggciAtIGcgKSAvIGRpZmYgKSArIDI0MDsKCX0KCgkvLyBjaHJvbWEgKGRpZmYpID09IDAgbWVhbnMgZ3JleXNjYWxlIHdoaWNoLCBieSBkZWZpbml0aW9uLCBzYXR1cmF0aW9uID0gMCUKCS8vIG90aGVyd2lzZSwgc2F0dXJhdGlvbiBpcyBiYXNlZCBvbiB0aGUgcmF0aW8gb2YgY2hyb21hIChkaWZmKSB0byBsaWdodG5lc3MgKGFkZCkKCWlmICggZGlmZiA9PT0gMCApIHsKCQlzID0gMDsKCX0gZWxzZSBpZiAoIGwgPD0gMC41ICkgewoJCXMgPSBkaWZmIC8gYWRkOwoJfSBlbHNlIHsKCQlzID0gZGlmZiAvICggMiAtIGFkZCApOwoJfQoJcmV0dXJuIFsgTWF0aC5yb3VuZChoKSAlIDM2MCwgcywgbCwgYSA9PSBudWxsID8gMSA6IGEgXTsKfTsKCnNwYWNlcy5oc2xhLmZyb20gPSBmdW5jdGlvbiggaHNsYSApIHsKCWlmICggaHNsYVsgMCBdID09IG51bGwgfHwgaHNsYVsgMSBdID09IG51bGwgfHwgaHNsYVsgMiBdID09IG51bGwgKSB7CgkJcmV0dXJuIFsgbnVsbCwgbnVsbCwgbnVsbCwgaHNsYVsgMyBdIF07Cgl9Cgl2YXIgaCA9IGhzbGFbIDAgXSAvIDM2MCwKCQlzID0gaHNsYVsgMSBdLAoJCWwgPSBoc2xhWyAyIF0sCgkJYSA9IGhzbGFbIDMgXSwKCQlxID0gbCA8PSAwLjUgPyBsICogKCAxICsgcyApIDogbCArIHMgLSBsICogcywKCQlwID0gMiAqIGwgLSBxOwoKCXJldHVybiBbCgkJTWF0aC5yb3VuZCggaHVlMnJnYiggcCwgcSwgaCArICggMSAvIDMgKSApICogMjU1ICksCgkJTWF0aC5yb3VuZCggaHVlMnJnYiggcCwgcSwgaCApICogMjU1ICksCgkJTWF0aC5yb3VuZCggaHVlMnJnYiggcCwgcSwgaCAtICggMSAvIDMgKSApICogMjU1ICksCgkJYQoJXTsKfTsKCmVhY2goIHNwYWNlcywgZnVuY3Rpb24oIHNwYWNlTmFtZSwgc3BhY2UgKSB7Cgl2YXIgcHJvcHMgPSBzcGFjZS5wcm9wcywKCQljYWNoZSA9IHNwYWNlLmNhY2hlLAoJCXRvID0gc3BhY2UudG8sCgkJZnJvbSA9IHNwYWNlLmZyb207CgoJLy8gbWFrZXMgcmdiYSgpIGFuZCBoc2xhKCkKCWNvbG9yLmZuWyBzcGFjZU5hbWUgXSA9IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCgkJLy8gZ2VuZXJhdGUgYSBjYWNoZSBmb3IgdGhpcyBzcGFjZSBpZiBpdCBkb2Vzbid0IGV4aXN0CgkJaWYgKCB0byAmJiAhdGhpc1sgY2FjaGUgXSApIHsKCQkJdGhpc1sgY2FjaGUgXSA9IHRvKCB0aGlzLl9yZ2JhICk7CgkJfQoJCWlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCQkJcmV0dXJuIHRoaXNbIGNhY2hlIF0uc2xpY2UoKTsKCQl9CgoJCXZhciByZXQsCgkJCXR5cGUgPSBqUXVlcnkudHlwZSggdmFsdWUgKSwKCQkJYXJyID0gKCB0eXBlID09PSAiYXJyYXkiIHx8IHR5cGUgPT09ICJvYmplY3QiICkgPyB2YWx1ZSA6IGFyZ3VtZW50cywKCQkJbG9jYWwgPSB0aGlzWyBjYWNoZSBdLnNsaWNlKCk7CgoJCWVhY2goIHByb3BzLCBmdW5jdGlvbigga2V5LCBwcm9wICkgewoJCQl2YXIgdmFsID0gYXJyWyB0eXBlID09PSAib2JqZWN0IiA/IGtleSA6IHByb3AuaWR4IF07CgkJCWlmICggdmFsID09IG51bGwgKSB7CgkJCQl2YWwgPSBsb2NhbFsgcHJvcC5pZHggXTsKCQkJfQoJCQlsb2NhbFsgcHJvcC5pZHggXSA9IGNsYW1wKCB2YWwsIHByb3AgKTsKCQl9KTsKCgkJaWYgKCBmcm9tICkgewoJCQlyZXQgPSBjb2xvciggZnJvbSggbG9jYWwgKSApOwoJCQlyZXRbIGNhY2hlIF0gPSBsb2NhbDsKCQkJcmV0dXJuIHJldDsKCQl9IGVsc2UgewoJCQlyZXR1cm4gY29sb3IoIGxvY2FsICk7CgkJfQoJfTsKCgkvLyBtYWtlcyByZWQoKSBncmVlbigpIGJsdWUoKSBhbHBoYSgpIGh1ZSgpIHNhdHVyYXRpb24oKSBsaWdodG5lc3MoKQoJZWFjaCggcHJvcHMsIGZ1bmN0aW9uKCBrZXksIHByb3AgKSB7CgkJLy8gYWxwaGEgaXMgaW5jbHVkZWQgaW4gbW9yZSB0aGFuIG9uZSBzcGFjZQoJCWlmICggY29sb3IuZm5bIGtleSBdICkgewoJCQlyZXR1cm47CgkJfQoJCWNvbG9yLmZuWyBrZXkgXSA9IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJdmFyIHZ0eXBlID0galF1ZXJ5LnR5cGUoIHZhbHVlICksCgkJCQlmbiA9ICgga2V5ID09PSAiYWxwaGEiID8gKCB0aGlzLl9oc2xhID8gImhzbGEiIDogInJnYmEiICkgOiBzcGFjZU5hbWUgKSwKCQkJCWxvY2FsID0gdGhpc1sgZm4gXSgpLAoJCQkJY3VyID0gbG9jYWxbIHByb3AuaWR4IF0sCgkJCQltYXRjaDsKCgkJCWlmICggdnR5cGUgPT09ICJ1bmRlZmluZWQiICkgewoJCQkJcmV0dXJuIGN1cjsKCQkJfQoKCQkJaWYgKCB2dHlwZSA9PT0gImZ1bmN0aW9uIiApIHsKCQkJCXZhbHVlID0gdmFsdWUuY2FsbCggdGhpcywgY3VyICk7CgkJCQl2dHlwZSA9IGpRdWVyeS50eXBlKCB2YWx1ZSApOwoJCQl9CgkJCWlmICggdmFsdWUgPT0gbnVsbCAmJiBwcm9wLmVtcHR5ICkgewoJCQkJcmV0dXJuIHRoaXM7CgkJCX0KCQkJaWYgKCB2dHlwZSA9PT0gInN0cmluZyIgKSB7CgkJCQltYXRjaCA9IHJwbHVzZXF1YWxzLmV4ZWMoIHZhbHVlICk7CgkJCQlpZiAoIG1hdGNoICkgewoJCQkJCXZhbHVlID0gY3VyICsgcGFyc2VGbG9hdCggbWF0Y2hbIDIgXSApICogKCBtYXRjaFsgMSBdID09PSAiKyIgPyAxIDogLTEgKTsKCQkJCX0KCQkJfQoJCQlsb2NhbFsgcHJvcC5pZHggXSA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpc1sgZm4gXSggbG9jYWwgKTsKCQl9OwoJfSk7Cn0pOwoKLy8gYWRkIGNzc0hvb2sgYW5kIC5meC5zdGVwIGZ1bmN0aW9uIGZvciBlYWNoIG5hbWVkIGhvb2suCi8vIGFjY2VwdCBhIHNwYWNlIHNlcGFyYXRlZCBzdHJpbmcgb2YgcHJvcGVydGllcwpjb2xvci5ob29rID0gZnVuY3Rpb24oIGhvb2sgKSB7Cgl2YXIgaG9va3MgPSBob29rLnNwbGl0KCAiICIgKTsKCWVhY2goIGhvb2tzLCBmdW5jdGlvbiggaSwgaG9vayApIHsKCQlqUXVlcnkuY3NzSG9va3NbIGhvb2sgXSA9IHsKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQl2YXIgcGFyc2VkLCBjdXJFbGVtLAoJCQkJCWJhY2tncm91bmRDb2xvciA9ICIiOwoKCQkJCWlmICggdmFsdWUgIT09ICJ0cmFuc3BhcmVudCIgJiYgKCBqUXVlcnkudHlwZSggdmFsdWUgKSAhPT0gInN0cmluZyIgfHwgKCBwYXJzZWQgPSBzdHJpbmdQYXJzZSggdmFsdWUgKSApICkgKSB7CgkJCQkJdmFsdWUgPSBjb2xvciggcGFyc2VkIHx8IHZhbHVlICk7CgkJCQkJaWYgKCAhc3VwcG9ydC5yZ2JhICYmIHZhbHVlLl9yZ2JhWyAzIF0gIT09IDEgKSB7CgkJCQkJCWN1ckVsZW0gPSBob29rID09PSAiYmFja2dyb3VuZENvbG9yIiA/IGVsZW0ucGFyZW50Tm9kZSA6IGVsZW07CgkJCQkJCXdoaWxlICgKCQkJCQkJCShiYWNrZ3JvdW5kQ29sb3IgPT09ICIiIHx8IGJhY2tncm91bmRDb2xvciA9PT0gInRyYW5zcGFyZW50IikgJiYKCQkJCQkJCWN1ckVsZW0gJiYgY3VyRWxlbS5zdHlsZQoJCQkJCQkpIHsKCQkJCQkJCXRyeSB7CgkJCQkJCQkJYmFja2dyb3VuZENvbG9yID0galF1ZXJ5LmNzcyggY3VyRWxlbSwgImJhY2tncm91bmRDb2xvciIgKTsKCQkJCQkJCQljdXJFbGVtID0gY3VyRWxlbS5wYXJlbnROb2RlOwoJCQkJCQkJfSBjYXRjaCAoIGUgKSB7CgkJCQkJCQl9CgkJCQkJCX0KCgkJCQkJCXZhbHVlID0gdmFsdWUuYmxlbmQoIGJhY2tncm91bmRDb2xvciAmJiBiYWNrZ3JvdW5kQ29sb3IgIT09ICJ0cmFuc3BhcmVudCIgPwoJCQkJCQkJYmFja2dyb3VuZENvbG9yIDoKCQkJCQkJCSJfZGVmYXVsdCIgKTsKCQkJCQl9CgoJCQkJCXZhbHVlID0gdmFsdWUudG9SZ2JhU3RyaW5nKCk7CgkJCQl9CgkJCQl0cnkgewoJCQkJCWVsZW0uc3R5bGVbIGhvb2sgXSA9IHZhbHVlOwoJCQkJfSBjYXRjaCggZSApIHsKCQkJCQkvLyB3cmFwcGVkIHRvIHByZXZlbnQgSUUgZnJvbSB0aHJvd2luZyBlcnJvcnMgb24gImludmFsaWQiIHZhbHVlcyBsaWtlICdhdXRvJyBvciAnaW5oZXJpdCcKCQkJCX0KCQkJfQoJCX07CgkJalF1ZXJ5LmZ4LnN0ZXBbIGhvb2sgXSA9IGZ1bmN0aW9uKCBmeCApIHsKCQkJaWYgKCAhZnguY29sb3JJbml0ICkgewoJCQkJZnguc3RhcnQgPSBjb2xvciggZnguZWxlbSwgaG9vayApOwoJCQkJZnguZW5kID0gY29sb3IoIGZ4LmVuZCApOwoJCQkJZnguY29sb3JJbml0ID0gdHJ1ZTsKCQkJfQoJCQlqUXVlcnkuY3NzSG9va3NbIGhvb2sgXS5zZXQoIGZ4LmVsZW0sIGZ4LnN0YXJ0LnRyYW5zaXRpb24oIGZ4LmVuZCwgZngucG9zICkgKTsKCQl9OwoJfSk7Cgp9OwoKY29sb3IuaG9vayggc3RlcEhvb2tzICk7CgpqUXVlcnkuY3NzSG9va3MuYm9yZGVyQ29sb3IgPSB7CglleHBhbmQ6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgZXhwYW5kZWQgPSB7fTsKCgkJZWFjaCggWyAiVG9wIiwgIlJpZ2h0IiwgIkJvdHRvbSIsICJMZWZ0IiBdLCBmdW5jdGlvbiggaSwgcGFydCApIHsKCQkJZXhwYW5kZWRbICJib3JkZXIiICsgcGFydCArICJDb2xvciIgXSA9IHZhbHVlOwoJCX0pOwoJCXJldHVybiBleHBhbmRlZDsKCX0KfTsKCi8vIEJhc2ljIGNvbG9yIG5hbWVzIG9ubHkuCi8vIFVzYWdlIG9mIGFueSBvZiB0aGUgb3RoZXIgY29sb3IgbmFtZXMgcmVxdWlyZXMgYWRkaW5nIHlvdXJzZWxmIG9yIGluY2x1ZGluZwovLyBqcXVlcnkuY29sb3Iuc3ZnLW5hbWVzLmpzLgpjb2xvcnMgPSBqUXVlcnkuQ29sb3IubmFtZXMgPSB7CgkvLyA0LjEuIEJhc2ljIGNvbG9yIGtleXdvcmRzCglhcXVhOiAiIzAwZmZmZiIsCglibGFjazogIiMwMDAwMDAiLAoJYmx1ZTogIiMwMDAwZmYiLAoJZnVjaHNpYTogIiNmZjAwZmYiLAoJZ3JheTogIiM4MDgwODAiLAoJZ3JlZW46ICIjMDA4MDAwIiwKCWxpbWU6ICIjMDBmZjAwIiwKCW1hcm9vbjogIiM4MDAwMDAiLAoJbmF2eTogIiMwMDAwODAiLAoJb2xpdmU6ICIjODA4MDAwIiwKCXB1cnBsZTogIiM4MDAwODAiLAoJcmVkOiAiI2ZmMDAwMCIsCglzaWx2ZXI6ICIjYzBjMGMwIiwKCXRlYWw6ICIjMDA4MDgwIiwKCXdoaXRlOiAiI2ZmZmZmZiIsCgl5ZWxsb3c6ICIjZmZmZjAwIiwKCgkvLyA0LjIuMy4gInRyYW5zcGFyZW50IiBjb2xvciBrZXl3b3JkCgl0cmFuc3BhcmVudDogWyBudWxsLCBudWxsLCBudWxsLCAwIF0sCgoJX2RlZmF1bHQ6ICIjZmZmZmZmIgp9OwoKfSkoIGpRdWVyeSApOwoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBDTEFTUyBBTklNQVRJT05TICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KKGZ1bmN0aW9uKCkgewoKdmFyIGNsYXNzQW5pbWF0aW9uQWN0aW9ucyA9IFsgImFkZCIsICJyZW1vdmUiLCAidG9nZ2xlIiBdLAoJc2hvcnRoYW5kU3R5bGVzID0gewoJCWJvcmRlcjogMSwKCQlib3JkZXJCb3R0b206IDEsCgkJYm9yZGVyQ29sb3I6IDEsCgkJYm9yZGVyTGVmdDogMSwKCQlib3JkZXJSaWdodDogMSwKCQlib3JkZXJUb3A6IDEsCgkJYm9yZGVyV2lkdGg6IDEsCgkJbWFyZ2luOiAxLAoJCXBhZGRpbmc6IDEKCX07CgokLmVhY2goWyAiYm9yZGVyTGVmdFN0eWxlIiwgImJvcmRlclJpZ2h0U3R5bGUiLCAiYm9yZGVyQm90dG9tU3R5bGUiLCAiYm9yZGVyVG9wU3R5bGUiIF0sIGZ1bmN0aW9uKCBfLCBwcm9wICkgewoJJC5meC5zdGVwWyBwcm9wIF0gPSBmdW5jdGlvbiggZnggKSB7CgkJaWYgKCBmeC5lbmQgIT09ICJub25lIiAmJiAhZnguc2V0QXR0ciB8fCBmeC5wb3MgPT09IDEgJiYgIWZ4LnNldEF0dHIgKSB7CgkJCWpRdWVyeS5zdHlsZSggZnguZWxlbSwgcHJvcCwgZnguZW5kICk7CgkJCWZ4LnNldEF0dHIgPSB0cnVlOwoJCX0KCX07Cn0pOwoKZnVuY3Rpb24gZ2V0RWxlbWVudFN0eWxlcyggZWxlbSApIHsKCXZhciBrZXksIGxlbiwKCQlzdHlsZSA9IGVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldyA/CgkJCWVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtLCBudWxsICkgOgoJCQllbGVtLmN1cnJlbnRTdHlsZSwKCQlzdHlsZXMgPSB7fTsKCglpZiAoIHN0eWxlICYmIHN0eWxlLmxlbmd0aCAmJiBzdHlsZVsgMCBdICYmIHN0eWxlWyBzdHlsZVsgMCBdIF0gKSB7CgkJbGVuID0gc3R5bGUubGVuZ3RoOwoJCXdoaWxlICggbGVuLS0gKSB7CgkJCWtleSA9IHN0eWxlWyBsZW4gXTsKCQkJaWYgKCB0eXBlb2Ygc3R5bGVbIGtleSBdID09PSAic3RyaW5nIiApIHsKCQkJCXN0eWxlc1sgJC5jYW1lbENhc2UoIGtleSApIF0gPSBzdHlsZVsga2V5IF07CgkJCX0KCQl9CgkvLyBzdXBwb3J0OiBPcGVyYSwgSUUgPDkKCX0gZWxzZSB7CgkJZm9yICgga2V5IGluIHN0eWxlICkgewoJCQlpZiAoIHR5cGVvZiBzdHlsZVsga2V5IF0gPT09ICJzdHJpbmciICkgewoJCQkJc3R5bGVzWyBrZXkgXSA9IHN0eWxlWyBrZXkgXTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gc3R5bGVzOwp9CgpmdW5jdGlvbiBzdHlsZURpZmZlcmVuY2UoIG9sZFN0eWxlLCBuZXdTdHlsZSApIHsKCXZhciBkaWZmID0ge30sCgkJbmFtZSwgdmFsdWU7CgoJZm9yICggbmFtZSBpbiBuZXdTdHlsZSApIHsKCQl2YWx1ZSA9IG5ld1N0eWxlWyBuYW1lIF07CgkJaWYgKCBvbGRTdHlsZVsgbmFtZSBdICE9PSB2YWx1ZSApIHsKCQkJaWYgKCAhc2hvcnRoYW5kU3R5bGVzWyBuYW1lIF0gKSB7CgkJCQlpZiAoICQuZnguc3RlcFsgbmFtZSBdIHx8ICFpc05hTiggcGFyc2VGbG9hdCggdmFsdWUgKSApICkgewoJCQkJCWRpZmZbIG5hbWUgXSA9IHZhbHVlOwoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiBkaWZmOwp9CgovLyBzdXBwb3J0OiBqUXVlcnkgPDEuOAppZiAoICEkLmZuLmFkZEJhY2sgKSB7CgkkLmZuLmFkZEJhY2sgPSBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMuYWRkKCBzZWxlY3RvciA9PSBudWxsID8KCQkJdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlciggc2VsZWN0b3IgKQoJCSk7Cgl9Owp9CgokLmVmZmVjdHMuYW5pbWF0ZUNsYXNzID0gZnVuY3Rpb24oIHZhbHVlLCBkdXJhdGlvbiwgZWFzaW5nLCBjYWxsYmFjayApIHsKCXZhciBvID0gJC5zcGVlZCggZHVyYXRpb24sIGVhc2luZywgY2FsbGJhY2sgKTsKCglyZXR1cm4gdGhpcy5xdWV1ZSggZnVuY3Rpb24oKSB7CgkJdmFyIGFuaW1hdGVkID0gJCggdGhpcyApLAoJCQliYXNlQ2xhc3MgPSBhbmltYXRlZC5hdHRyKCAiY2xhc3MiICkgfHwgIiIsCgkJCWFwcGx5Q2xhc3NDaGFuZ2UsCgkJCWFsbEFuaW1hdGlvbnMgPSBvLmNoaWxkcmVuID8gYW5pbWF0ZWQuZmluZCggIioiICkuYWRkQmFjaygpIDogYW5pbWF0ZWQ7CgoJCS8vIG1hcCB0aGUgYW5pbWF0ZWQgb2JqZWN0cyB0byBzdG9yZSB0aGUgb3JpZ2luYWwgc3R5bGVzLgoJCWFsbEFuaW1hdGlvbnMgPSBhbGxBbmltYXRpb25zLm1hcChmdW5jdGlvbigpIHsKCQkJdmFyIGVsID0gJCggdGhpcyApOwoJCQlyZXR1cm4gewoJCQkJZWw6IGVsLAoJCQkJc3RhcnQ6IGdldEVsZW1lbnRTdHlsZXMoIHRoaXMgKQoJCQl9OwoJCX0pOwoKCQkvLyBhcHBseSBjbGFzcyBjaGFuZ2UKCQlhcHBseUNsYXNzQ2hhbmdlID0gZnVuY3Rpb24oKSB7CgkJCSQuZWFjaCggY2xhc3NBbmltYXRpb25BY3Rpb25zLCBmdW5jdGlvbihpLCBhY3Rpb24pIHsKCQkJCWlmICggdmFsdWVbIGFjdGlvbiBdICkgewoJCQkJCWFuaW1hdGVkWyBhY3Rpb24gKyAiQ2xhc3MiIF0oIHZhbHVlWyBhY3Rpb24gXSApOwoJCQkJfQoJCQl9KTsKCQl9OwoJCWFwcGx5Q2xhc3NDaGFuZ2UoKTsKCgkJLy8gbWFwIGFsbCBhbmltYXRlZCBvYmplY3RzIGFnYWluIC0gY2FsY3VsYXRlIG5ldyBzdHlsZXMgYW5kIGRpZmYKCQlhbGxBbmltYXRpb25zID0gYWxsQW5pbWF0aW9ucy5tYXAoZnVuY3Rpb24oKSB7CgkJCXRoaXMuZW5kID0gZ2V0RWxlbWVudFN0eWxlcyggdGhpcy5lbFsgMCBdICk7CgkJCXRoaXMuZGlmZiA9IHN0eWxlRGlmZmVyZW5jZSggdGhpcy5zdGFydCwgdGhpcy5lbmQgKTsKCQkJcmV0dXJuIHRoaXM7CgkJfSk7CgoJCS8vIGFwcGx5IG9yaWdpbmFsIGNsYXNzCgkJYW5pbWF0ZWQuYXR0ciggImNsYXNzIiwgYmFzZUNsYXNzICk7CgoJCS8vIG1hcCBhbGwgYW5pbWF0ZWQgb2JqZWN0cyBhZ2FpbiAtIHRoaXMgdGltZSBjb2xsZWN0aW5nIGEgcHJvbWlzZQoJCWFsbEFuaW1hdGlvbnMgPSBhbGxBbmltYXRpb25zLm1hcChmdW5jdGlvbigpIHsKCQkJdmFyIHN0eWxlSW5mbyA9IHRoaXMsCgkJCQlkZmQgPSAkLkRlZmVycmVkKCksCgkJCQlvcHRzID0gJC5leHRlbmQoe30sIG8sIHsKCQkJCQlxdWV1ZTogZmFsc2UsCgkJCQkJY29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQkJCQlkZmQucmVzb2x2ZSggc3R5bGVJbmZvICk7CgkJCQkJfQoJCQkJfSk7CgoJCQl0aGlzLmVsLmFuaW1hdGUoIHRoaXMuZGlmZiwgb3B0cyApOwoJCQlyZXR1cm4gZGZkLnByb21pc2UoKTsKCQl9KTsKCgkJLy8gb25jZSBhbGwgYW5pbWF0aW9ucyBoYXZlIGNvbXBsZXRlZDoKCQkkLndoZW4uYXBwbHkoICQsIGFsbEFuaW1hdGlvbnMuZ2V0KCkgKS5kb25lKGZ1bmN0aW9uKCkgewoKCQkJLy8gc2V0IHRoZSBmaW5hbCBjbGFzcwoJCQlhcHBseUNsYXNzQ2hhbmdlKCk7CgoJCQkvLyBmb3IgZWFjaCBhbmltYXRlZCBlbGVtZW50LAoJCQkvLyBjbGVhciBhbGwgY3NzIHByb3BlcnRpZXMgdGhhdCB3ZXJlIGFuaW1hdGVkCgkJCSQuZWFjaCggYXJndW1lbnRzLCBmdW5jdGlvbigpIHsKCQkJCXZhciBlbCA9IHRoaXMuZWw7CgkJCQkkLmVhY2goIHRoaXMuZGlmZiwgZnVuY3Rpb24oa2V5KSB7CgkJCQkJZWwuY3NzKCBrZXksICIiICk7CgkJCQl9KTsKCQkJfSk7CgoJCQkvLyB0aGlzIGlzIGd1YXJudGVlZCB0byBiZSB0aGVyZSBpZiB5b3UgdXNlIGpRdWVyeS5zcGVlZCgpCgkJCS8vIGl0IGFsc28gaGFuZGxlcyBkZXF1ZXVpbmcgdGhlIG5leHQgYW5pbS4uLgoJCQlvLmNvbXBsZXRlLmNhbGwoIGFuaW1hdGVkWyAwIF0gKTsKCQl9KTsKCX0pOwp9OwoKJC5mbi5leHRlbmQoewoJYWRkQ2xhc3M6IChmdW5jdGlvbiggb3JpZyApIHsKCQlyZXR1cm4gZnVuY3Rpb24oIGNsYXNzTmFtZXMsIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgewoJCQlyZXR1cm4gc3BlZWQgPwoJCQkJJC5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKCB0aGlzLAoJCQkJCXsgYWRkOiBjbGFzc05hbWVzIH0sIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgOgoJCQkJb3JpZy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJfTsKCX0pKCAkLmZuLmFkZENsYXNzICksCgoJcmVtb3ZlQ2xhc3M6IChmdW5jdGlvbiggb3JpZyApIHsKCQlyZXR1cm4gZnVuY3Rpb24oIGNsYXNzTmFtZXMsIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgewoJCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDEgPwoJCQkJJC5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKCB0aGlzLAoJCQkJCXsgcmVtb3ZlOiBjbGFzc05hbWVzIH0sIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgOgoJCQkJb3JpZy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJfTsKCX0pKCAkLmZuLnJlbW92ZUNsYXNzICksCgoJdG9nZ2xlQ2xhc3M6IChmdW5jdGlvbiggb3JpZyApIHsKCQlyZXR1cm4gZnVuY3Rpb24oIGNsYXNzTmFtZXMsIGZvcmNlLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQkJaWYgKCB0eXBlb2YgZm9yY2UgPT09ICJib29sZWFuIiB8fCBmb3JjZSA9PT0gdW5kZWZpbmVkICkgewoJCQkJaWYgKCAhc3BlZWQgKSB7CgkJCQkJLy8gd2l0aG91dCBzcGVlZCBwYXJhbWV0ZXIKCQkJCQlyZXR1cm4gb3JpZy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiAkLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwoIHRoaXMsCgkJCQkJCShmb3JjZSA/IHsgYWRkOiBjbGFzc05hbWVzIH0gOiB7IHJlbW92ZTogY2xhc3NOYW1lcyB9KSwKCQkJCQkJc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIHdpdGhvdXQgZm9yY2UgcGFyYW1ldGVyCgkJCQlyZXR1cm4gJC5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKCB0aGlzLAoJCQkJCXsgdG9nZ2xlOiBjbGFzc05hbWVzIH0sIGZvcmNlLCBzcGVlZCwgZWFzaW5nICk7CgkJCX0KCQl9OwoJfSkoICQuZm4udG9nZ2xlQ2xhc3MgKSwKCglzd2l0Y2hDbGFzczogZnVuY3Rpb24oIHJlbW92ZSwgYWRkLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjaykgewoJCXJldHVybiAkLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwoIHRoaXMsIHsKCQkJYWRkOiBhZGQsCgkJCXJlbW92ZTogcmVtb3ZlCgkJfSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX0KfSk7Cgp9KSgpOwoKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIEVGRkVDVFMgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCihmdW5jdGlvbigpIHsKCiQuZXh0ZW5kKCAkLmVmZmVjdHMsIHsKCXZlcnNpb246ICIxLjExLjEiLAoKCS8vIFNhdmVzIGEgc2V0IG9mIHByb3BlcnRpZXMgaW4gYSBkYXRhIHN0b3JhZ2UKCXNhdmU6IGZ1bmN0aW9uKCBlbGVtZW50LCBzZXQgKSB7CgkJZm9yICggdmFyIGkgPSAwOyBpIDwgc2V0Lmxlbmd0aDsgaSsrICkgewoJCQlpZiAoIHNldFsgaSBdICE9PSBudWxsICkgewoJCQkJZWxlbWVudC5kYXRhKCBkYXRhU3BhY2UgKyBzZXRbIGkgXSwgZWxlbWVudFsgMCBdLnN0eWxlWyBzZXRbIGkgXSBdICk7CgkJCX0KCQl9Cgl9LAoKCS8vIFJlc3RvcmVzIGEgc2V0IG9mIHByZXZpb3VzbHkgc2F2ZWQgcHJvcGVydGllcyBmcm9tIGEgZGF0YSBzdG9yYWdlCglyZXN0b3JlOiBmdW5jdGlvbiggZWxlbWVudCwgc2V0ICkgewoJCXZhciB2YWwsIGk7CgkJZm9yICggaSA9IDA7IGkgPCBzZXQubGVuZ3RoOyBpKysgKSB7CgkJCWlmICggc2V0WyBpIF0gIT09IG51bGwgKSB7CgkJCQl2YWwgPSBlbGVtZW50LmRhdGEoIGRhdGFTcGFjZSArIHNldFsgaSBdICk7CgkJCQkvLyBzdXBwb3J0OiBqUXVlcnkgMS42LjIKCQkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0Lzk5MTcKCQkJCS8vIGpRdWVyeSAxLjYuMiBpbmNvcnJlY3RseSByZXR1cm5zIHVuZGVmaW5lZCBmb3IgYW55IGZhbHN5IHZhbHVlLgoJCQkJLy8gV2UgY2FuJ3QgZGlmZmVyZW50aWF0ZSBiZXR3ZWVuICIiIGFuZCAwIGhlcmUsIHNvIHdlIGp1c3QgYXNzdW1lCgkJCQkvLyBlbXB0eSBzdHJpbmcgc2luY2UgaXQncyBsaWtlbHkgdG8gYmUgYSBtb3JlIGNvbW1vbiB2YWx1ZS4uLgoJCQkJaWYgKCB2YWwgPT09IHVuZGVmaW5lZCApIHsKCQkJCQl2YWwgPSAiIjsKCQkJCX0KCQkJCWVsZW1lbnQuY3NzKCBzZXRbIGkgXSwgdmFsICk7CgkJCX0KCQl9Cgl9LAoKCXNldE1vZGU6IGZ1bmN0aW9uKCBlbCwgbW9kZSApIHsKCQlpZiAobW9kZSA9PT0gInRvZ2dsZSIpIHsKCQkJbW9kZSA9IGVsLmlzKCAiOmhpZGRlbiIgKSA/ICJzaG93IiA6ICJoaWRlIjsKCQl9CgkJcmV0dXJuIG1vZGU7Cgl9LAoKCS8vIFRyYW5zbGF0ZXMgYSBbdG9wLGxlZnRdIGFycmF5IGludG8gYSBiYXNlbGluZSB2YWx1ZQoJLy8gdGhpcyBzaG91bGQgYmUgYSBsaXR0bGUgbW9yZSBmbGV4aWJsZSBpbiB0aGUgZnV0dXJlIHRvIGhhbmRsZSBhIHN0cmluZyAmIGhhc2gKCWdldEJhc2VsaW5lOiBmdW5jdGlvbiggb3JpZ2luLCBvcmlnaW5hbCApIHsKCQl2YXIgeSwgeDsKCQlzd2l0Y2ggKCBvcmlnaW5bIDAgXSApIHsKCQkJY2FzZSAidG9wIjogeSA9IDA7IGJyZWFrOwoJCQljYXNlICJtaWRkbGUiOiB5ID0gMC41OyBicmVhazsKCQkJY2FzZSAiYm90dG9tIjogeSA9IDE7IGJyZWFrOwoJCQlkZWZhdWx0OiB5ID0gb3JpZ2luWyAwIF0gLyBvcmlnaW5hbC5oZWlnaHQ7CgkJfQoJCXN3aXRjaCAoIG9yaWdpblsgMSBdICkgewoJCQljYXNlICJsZWZ0IjogeCA9IDA7IGJyZWFrOwoJCQljYXNlICJjZW50ZXIiOiB4ID0gMC41OyBicmVhazsKCQkJY2FzZSAicmlnaHQiOiB4ID0gMTsgYnJlYWs7CgkJCWRlZmF1bHQ6IHggPSBvcmlnaW5bIDEgXSAvIG9yaWdpbmFsLndpZHRoOwoJCX0KCQlyZXR1cm4gewoJCQl4OiB4LAoJCQl5OiB5CgkJfTsKCX0sCgoJLy8gV3JhcHMgdGhlIGVsZW1lbnQgYXJvdW5kIGEgd3JhcHBlciB0aGF0IGNvcGllcyBwb3NpdGlvbiBwcm9wZXJ0aWVzCgljcmVhdGVXcmFwcGVyOiBmdW5jdGlvbiggZWxlbWVudCApIHsKCgkJLy8gaWYgdGhlIGVsZW1lbnQgaXMgYWxyZWFkeSB3cmFwcGVkLCByZXR1cm4gaXQKCQlpZiAoIGVsZW1lbnQucGFyZW50KCkuaXMoICIudWktZWZmZWN0cy13cmFwcGVyIiApKSB7CgkJCXJldHVybiBlbGVtZW50LnBhcmVudCgpOwoJCX0KCgkJLy8gd3JhcCB0aGUgZWxlbWVudAoJCXZhciBwcm9wcyA9IHsKCQkJCXdpZHRoOiBlbGVtZW50Lm91dGVyV2lkdGgodHJ1ZSksCgkJCQloZWlnaHQ6IGVsZW1lbnQub3V0ZXJIZWlnaHQodHJ1ZSksCgkJCQkiZmxvYXQiOiBlbGVtZW50LmNzcyggImZsb2F0IiApCgkJCX0sCgkJCXdyYXBwZXIgPSAkKCAiPGRpdj48L2Rpdj4iICkKCQkJCS5hZGRDbGFzcyggInVpLWVmZmVjdHMtd3JhcHBlciIgKQoJCQkJLmNzcyh7CgkJCQkJZm9udFNpemU6ICIxMDAlIiwKCQkJCQliYWNrZ3JvdW5kOiAidHJhbnNwYXJlbnQiLAoJCQkJCWJvcmRlcjogIm5vbmUiLAoJCQkJCW1hcmdpbjogMCwKCQkJCQlwYWRkaW5nOiAwCgkJCQl9KSwKCQkJLy8gU3RvcmUgdGhlIHNpemUgaW4gY2FzZSB3aWR0aC9oZWlnaHQgYXJlIGRlZmluZWQgaW4gJSAtIEZpeGVzICM1MjQ1CgkJCXNpemUgPSB7CgkJCQl3aWR0aDogZWxlbWVudC53aWR0aCgpLAoJCQkJaGVpZ2h0OiBlbGVtZW50LmhlaWdodCgpCgkJCX0sCgkJCWFjdGl2ZSA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7CgoJCS8vIHN1cHBvcnQ6IEZpcmVmb3gKCQkvLyBGaXJlZm94IGluY29ycmVjdGx5IGV4cG9zZXMgYW5vbnltb3VzIGNvbnRlbnQKCQkvLyBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD01NjE2NjQKCQl0cnkgewoJCQlhY3RpdmUuaWQ7CgkJfSBjYXRjaCggZSApIHsKCQkJYWN0aXZlID0gZG9jdW1lbnQuYm9keTsKCQl9CgoJCWVsZW1lbnQud3JhcCggd3JhcHBlciApOwoKCQkvLyBGaXhlcyAjNzU5NSAtIEVsZW1lbnRzIGxvc2UgZm9jdXMgd2hlbiB3cmFwcGVkLgoJCWlmICggZWxlbWVudFsgMCBdID09PSBhY3RpdmUgfHwgJC5jb250YWlucyggZWxlbWVudFsgMCBdLCBhY3RpdmUgKSApIHsKCQkJJCggYWN0aXZlICkuZm9jdXMoKTsKCQl9CgoJCXdyYXBwZXIgPSBlbGVtZW50LnBhcmVudCgpOyAvL0hvdGZpeCBmb3IgalF1ZXJ5IDEuNCBzaW5jZSBzb21lIGNoYW5nZSBpbiB3cmFwKCkgc2VlbXMgdG8gYWN0dWFsbHkgbG9zZSB0aGUgcmVmZXJlbmNlIHRvIHRoZSB3cmFwcGVkIGVsZW1lbnQKCgkJLy8gdHJhbnNmZXIgcG9zaXRpb25pbmcgcHJvcGVydGllcyB0byB0aGUgd3JhcHBlcgoJCWlmICggZWxlbWVudC5jc3MoICJwb3NpdGlvbiIgKSA9PT0gInN0YXRpYyIgKSB7CgkJCXdyYXBwZXIuY3NzKHsgcG9zaXRpb246ICJyZWxhdGl2ZSIgfSk7CgkJCWVsZW1lbnQuY3NzKHsgcG9zaXRpb246ICJyZWxhdGl2ZSIgfSk7CgkJfSBlbHNlIHsKCQkJJC5leHRlbmQoIHByb3BzLCB7CgkJCQlwb3NpdGlvbjogZWxlbWVudC5jc3MoICJwb3NpdGlvbiIgKSwKCQkJCXpJbmRleDogZWxlbWVudC5jc3MoICJ6LWluZGV4IiApCgkJCX0pOwoJCQkkLmVhY2goWyAidG9wIiwgImxlZnQiLCAiYm90dG9tIiwgInJpZ2h0IiBdLCBmdW5jdGlvbihpLCBwb3MpIHsKCQkJCXByb3BzWyBwb3MgXSA9IGVsZW1lbnQuY3NzKCBwb3MgKTsKCQkJCWlmICggaXNOYU4oIHBhcnNlSW50KCBwcm9wc1sgcG9zIF0sIDEwICkgKSApIHsKCQkJCQlwcm9wc1sgcG9zIF0gPSAiYXV0byI7CgkJCQl9CgkJCX0pOwoJCQllbGVtZW50LmNzcyh7CgkJCQlwb3NpdGlvbjogInJlbGF0aXZlIiwKCQkJCXRvcDogMCwKCQkJCWxlZnQ6IDAsCgkJCQlyaWdodDogImF1dG8iLAoJCQkJYm90dG9tOiAiYXV0byIKCQkJfSk7CgkJfQoJCWVsZW1lbnQuY3NzKHNpemUpOwoKCQlyZXR1cm4gd3JhcHBlci5jc3MoIHByb3BzICkuc2hvdygpOwoJfSwKCglyZW1vdmVXcmFwcGVyOiBmdW5jdGlvbiggZWxlbWVudCApIHsKCQl2YXIgYWN0aXZlID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKCgkJaWYgKCBlbGVtZW50LnBhcmVudCgpLmlzKCAiLnVpLWVmZmVjdHMtd3JhcHBlciIgKSApIHsKCQkJZWxlbWVudC5wYXJlbnQoKS5yZXBsYWNlV2l0aCggZWxlbWVudCApOwoKCQkJLy8gRml4ZXMgIzc1OTUgLSBFbGVtZW50cyBsb3NlIGZvY3VzIHdoZW4gd3JhcHBlZC4KCQkJaWYgKCBlbGVtZW50WyAwIF0gPT09IGFjdGl2ZSB8fCAkLmNvbnRhaW5zKCBlbGVtZW50WyAwIF0sIGFjdGl2ZSApICkgewoJCQkJJCggYWN0aXZlICkuZm9jdXMoKTsKCQkJfQoJCX0KCgkJcmV0dXJuIGVsZW1lbnQ7Cgl9LAoKCXNldFRyYW5zaXRpb246IGZ1bmN0aW9uKCBlbGVtZW50LCBsaXN0LCBmYWN0b3IsIHZhbHVlICkgewoJCXZhbHVlID0gdmFsdWUgfHwge307CgkJJC5lYWNoKCBsaXN0LCBmdW5jdGlvbiggaSwgeCApIHsKCQkJdmFyIHVuaXQgPSBlbGVtZW50LmNzc1VuaXQoIHggKTsKCQkJaWYgKCB1bml0WyAwIF0gPiAwICkgewoJCQkJdmFsdWVbIHggXSA9IHVuaXRbIDAgXSAqIGZhY3RvciArIHVuaXRbIDEgXTsKCQkJfQoJCX0pOwoJCXJldHVybiB2YWx1ZTsKCX0KfSk7CgovLyByZXR1cm4gYW4gZWZmZWN0IG9wdGlvbnMgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gcGFyYW1ldGVyczoKZnVuY3Rpb24gX25vcm1hbGl6ZUFyZ3VtZW50cyggZWZmZWN0LCBvcHRpb25zLCBzcGVlZCwgY2FsbGJhY2sgKSB7CgoJLy8gYWxsb3cgcGFzc2luZyBhbGwgb3B0aW9ucyBhcyB0aGUgZmlyc3QgcGFyYW1ldGVyCglpZiAoICQuaXNQbGFpbk9iamVjdCggZWZmZWN0ICkgKSB7CgkJb3B0aW9ucyA9IGVmZmVjdDsKCQllZmZlY3QgPSBlZmZlY3QuZWZmZWN0OwoJfQoKCS8vIGNvbnZlcnQgdG8gYW4gb2JqZWN0CgllZmZlY3QgPSB7IGVmZmVjdDogZWZmZWN0IH07CgoJLy8gY2F0Y2ggKGVmZmVjdCwgbnVsbCwgLi4uKQoJaWYgKCBvcHRpb25zID09IG51bGwgKSB7CgkJb3B0aW9ucyA9IHt9OwoJfQoKCS8vIGNhdGNoIChlZmZlY3QsIGNhbGxiYWNrKQoJaWYgKCAkLmlzRnVuY3Rpb24oIG9wdGlvbnMgKSApIHsKCQljYWxsYmFjayA9IG9wdGlvbnM7CgkJc3BlZWQgPSBudWxsOwoJCW9wdGlvbnMgPSB7fTsKCX0KCgkvLyBjYXRjaCAoZWZmZWN0LCBzcGVlZCwgPykKCWlmICggdHlwZW9mIG9wdGlvbnMgPT09ICJudW1iZXIiIHx8ICQuZnguc3BlZWRzWyBvcHRpb25zIF0gKSB7CgkJY2FsbGJhY2sgPSBzcGVlZDsKCQlzcGVlZCA9IG9wdGlvbnM7CgkJb3B0aW9ucyA9IHt9OwoJfQoKCS8vIGNhdGNoIChlZmZlY3QsIG9wdGlvbnMsIGNhbGxiYWNrKQoJaWYgKCAkLmlzRnVuY3Rpb24oIHNwZWVkICkgKSB7CgkJY2FsbGJhY2sgPSBzcGVlZDsKCQlzcGVlZCA9IG51bGw7Cgl9CgoJLy8gYWRkIG9wdGlvbnMgdG8gZWZmZWN0CglpZiAoIG9wdGlvbnMgKSB7CgkJJC5leHRlbmQoIGVmZmVjdCwgb3B0aW9ucyApOwoJfQoKCXNwZWVkID0gc3BlZWQgfHwgb3B0aW9ucy5kdXJhdGlvbjsKCWVmZmVjdC5kdXJhdGlvbiA9ICQuZngub2ZmID8gMCA6CgkJdHlwZW9mIHNwZWVkID09PSAibnVtYmVyIiA/IHNwZWVkIDoKCQlzcGVlZCBpbiAkLmZ4LnNwZWVkcyA/ICQuZnguc3BlZWRzWyBzcGVlZCBdIDoKCQkkLmZ4LnNwZWVkcy5fZGVmYXVsdDsKCgllZmZlY3QuY29tcGxldGUgPSBjYWxsYmFjayB8fCBvcHRpb25zLmNvbXBsZXRlOwoKCXJldHVybiBlZmZlY3Q7Cn0KCmZ1bmN0aW9uIHN0YW5kYXJkQW5pbWF0aW9uT3B0aW9uKCBvcHRpb24gKSB7CgkvLyBWYWxpZCBzdGFuZGFyZCBzcGVlZHMgKG5vdGhpbmcsIG51bWJlciwgbmFtZWQgc3BlZWQpCglpZiAoICFvcHRpb24gfHwgdHlwZW9mIG9wdGlvbiA9PT0gIm51bWJlciIgfHwgJC5meC5zcGVlZHNbIG9wdGlvbiBdICkgewoJCXJldHVybiB0cnVlOwoJfQoKCS8vIEludmFsaWQgc3RyaW5ncyAtIHRyZWF0IGFzICJub3JtYWwiIHNwZWVkCglpZiAoIHR5cGVvZiBvcHRpb24gPT09ICJzdHJpbmciICYmICEkLmVmZmVjdHMuZWZmZWN0WyBvcHRpb24gXSApIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvLyBDb21wbGV0ZSBjYWxsYmFjawoJaWYgKCAkLmlzRnVuY3Rpb24oIG9wdGlvbiApICkgewoJCXJldHVybiB0cnVlOwoJfQoKCS8vIE9wdGlvbnMgaGFzaCAoYnV0IG5vdCBuYW1pbmcgYW4gZWZmZWN0KQoJaWYgKCB0eXBlb2Ygb3B0aW9uID09PSAib2JqZWN0IiAmJiAhb3B0aW9uLmVmZmVjdCApIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgkvLyBEaWRuJ3QgbWF0Y2ggYW55IHN0YW5kYXJkIEFQSQoJcmV0dXJuIGZhbHNlOwp9CgokLmZuLmV4dGVuZCh7CgllZmZlY3Q6IGZ1bmN0aW9uKCAvKiBlZmZlY3QsIG9wdGlvbnMsIHNwZWVkLCBjYWxsYmFjayAqLyApIHsKCQl2YXIgYXJncyA9IF9ub3JtYWxpemVBcmd1bWVudHMuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApLAoJCQltb2RlID0gYXJncy5tb2RlLAoJCQlxdWV1ZSA9IGFyZ3MucXVldWUsCgkJCWVmZmVjdE1ldGhvZCA9ICQuZWZmZWN0cy5lZmZlY3RbIGFyZ3MuZWZmZWN0IF07CgoJCWlmICggJC5meC5vZmYgfHwgIWVmZmVjdE1ldGhvZCApIHsKCQkJLy8gZGVsZWdhdGUgdG8gdGhlIG9yaWdpbmFsIG1ldGhvZCAoZS5nLiwgLnNob3coKSkgaWYgcG9zc2libGUKCQkJaWYgKCBtb2RlICkgewoJCQkJcmV0dXJuIHRoaXNbIG1vZGUgXSggYXJncy5kdXJhdGlvbiwgYXJncy5jb21wbGV0ZSApOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCQkJaWYgKCBhcmdzLmNvbXBsZXRlICkgewoJCQkJCQlhcmdzLmNvbXBsZXRlLmNhbGwoIHRoaXMgKTsKCQkJCQl9CgkJCQl9KTsKCQkJfQoJCX0KCgkJZnVuY3Rpb24gcnVuKCBuZXh0ICkgewoJCQl2YXIgZWxlbSA9ICQoIHRoaXMgKSwKCQkJCWNvbXBsZXRlID0gYXJncy5jb21wbGV0ZSwKCQkJCW1vZGUgPSBhcmdzLm1vZGU7CgoJCQlmdW5jdGlvbiBkb25lKCkgewoJCQkJaWYgKCAkLmlzRnVuY3Rpb24oIGNvbXBsZXRlICkgKSB7CgkJCQkJY29tcGxldGUuY2FsbCggZWxlbVswXSApOwoJCQkJfQoJCQkJaWYgKCAkLmlzRnVuY3Rpb24oIG5leHQgKSApIHsKCQkJCQluZXh0KCk7CgkJCQl9CgkJCX0KCgkJCS8vIElmIHRoZSBlbGVtZW50IGFscmVhZHkgaGFzIHRoZSBjb3JyZWN0IGZpbmFsIHN0YXRlLCBkZWxlZ2F0ZSB0bwoJCQkvLyB0aGUgY29yZSBtZXRob2RzIHNvIHRoZSBpbnRlcm5hbCB0cmFja2luZyBvZiAib2xkZGlzcGxheSIgd29ya3MuCgkJCWlmICggZWxlbS5pcyggIjpoaWRkZW4iICkgPyBtb2RlID09PSAiaGlkZSIgOiBtb2RlID09PSAic2hvdyIgKSB7CgkJCQllbGVtWyBtb2RlIF0oKTsKCQkJCWRvbmUoKTsKCQkJfSBlbHNlIHsKCQkJCWVmZmVjdE1ldGhvZC5jYWxsKCBlbGVtWzBdLCBhcmdzLCBkb25lICk7CgkJCX0KCQl9CgoJCXJldHVybiBxdWV1ZSA9PT0gZmFsc2UgPyB0aGlzLmVhY2goIHJ1biApIDogdGhpcy5xdWV1ZSggcXVldWUgfHwgImZ4IiwgcnVuICk7Cgl9LAoKCXNob3c6IChmdW5jdGlvbiggb3JpZyApIHsKCQlyZXR1cm4gZnVuY3Rpb24oIG9wdGlvbiApIHsKCQkJaWYgKCBzdGFuZGFyZEFuaW1hdGlvbk9wdGlvbiggb3B0aW9uICkgKSB7CgkJCQlyZXR1cm4gb3JpZy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCX0gZWxzZSB7CgkJCQl2YXIgYXJncyA9IF9ub3JtYWxpemVBcmd1bWVudHMuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJYXJncy5tb2RlID0gInNob3ciOwoJCQkJcmV0dXJuIHRoaXMuZWZmZWN0LmNhbGwoIHRoaXMsIGFyZ3MgKTsKCQkJfQoJCX07Cgl9KSggJC5mbi5zaG93ICksCgoJaGlkZTogKGZ1bmN0aW9uKCBvcmlnICkgewoJCXJldHVybiBmdW5jdGlvbiggb3B0aW9uICkgewoJCQlpZiAoIHN0YW5kYXJkQW5pbWF0aW9uT3B0aW9uKCBvcHRpb24gKSApIHsKCQkJCXJldHVybiBvcmlnLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJfSBlbHNlIHsKCQkJCXZhciBhcmdzID0gX25vcm1hbGl6ZUFyZ3VtZW50cy5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQlhcmdzLm1vZGUgPSAiaGlkZSI7CgkJCQlyZXR1cm4gdGhpcy5lZmZlY3QuY2FsbCggdGhpcywgYXJncyApOwoJCQl9CgkJfTsKCX0pKCAkLmZuLmhpZGUgKSwKCgl0b2dnbGU6IChmdW5jdGlvbiggb3JpZyApIHsKCQlyZXR1cm4gZnVuY3Rpb24oIG9wdGlvbiApIHsKCQkJaWYgKCBzdGFuZGFyZEFuaW1hdGlvbk9wdGlvbiggb3B0aW9uICkgfHwgdHlwZW9mIG9wdGlvbiA9PT0gImJvb2xlYW4iICkgewoJCQkJcmV0dXJuIG9yaWcuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9IGVsc2UgewoJCQkJdmFyIGFyZ3MgPSBfbm9ybWFsaXplQXJndW1lbnRzLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCWFyZ3MubW9kZSA9ICJ0b2dnbGUiOwoJCQkJcmV0dXJuIHRoaXMuZWZmZWN0LmNhbGwoIHRoaXMsIGFyZ3MgKTsKCQkJfQoJCX07Cgl9KSggJC5mbi50b2dnbGUgKSwKCgkvLyBoZWxwZXIgZnVuY3Rpb25zCgljc3NVbml0OiBmdW5jdGlvbihrZXkpIHsKCQl2YXIgc3R5bGUgPSB0aGlzLmNzcygga2V5ICksCgkJCXZhbCA9IFtdOwoKCQkkLmVhY2goIFsgImVtIiwgInB4IiwgIiUiLCAicHQiIF0sIGZ1bmN0aW9uKCBpLCB1bml0ICkgewoJCQlpZiAoIHN0eWxlLmluZGV4T2YoIHVuaXQgKSA+IDAgKSB7CgkJCQl2YWwgPSBbIHBhcnNlRmxvYXQoIHN0eWxlICksIHVuaXQgXTsKCQkJfQoJCX0pOwoJCXJldHVybiB2YWw7Cgl9Cn0pOwoKfSkoKTsKCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBFQVNJTkcgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgooZnVuY3Rpb24oKSB7CgovLyBiYXNlZCBvbiBlYXNpbmcgZXF1YXRpb25zIGZyb20gUm9iZXJ0IFBlbm5lciAoaHR0cDovL3d3dy5yb2JlcnRwZW5uZXIuY29tL2Vhc2luZykKCnZhciBiYXNlRWFzaW5ncyA9IHt9OwoKJC5lYWNoKCBbICJRdWFkIiwgIkN1YmljIiwgIlF1YXJ0IiwgIlF1aW50IiwgIkV4cG8iIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJYmFzZUVhc2luZ3NbIG5hbWUgXSA9IGZ1bmN0aW9uKCBwICkgewoJCXJldHVybiBNYXRoLnBvdyggcCwgaSArIDIgKTsKCX07Cn0pOwoKJC5leHRlbmQoIGJhc2VFYXNpbmdzLCB7CglTaW5lOiBmdW5jdGlvbiggcCApIHsKCQlyZXR1cm4gMSAtIE1hdGguY29zKCBwICogTWF0aC5QSSAvIDIgKTsKCX0sCglDaXJjOiBmdW5jdGlvbiggcCApIHsKCQlyZXR1cm4gMSAtIE1hdGguc3FydCggMSAtIHAgKiBwICk7Cgl9LAoJRWxhc3RpYzogZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIHAgPT09IDAgfHwgcCA9PT0gMSA/IHAgOgoJCQktTWF0aC5wb3coIDIsIDggKiAocCAtIDEpICkgKiBNYXRoLnNpbiggKCAocCAtIDEpICogODAgLSA3LjUgKSAqIE1hdGguUEkgLyAxNSApOwoJfSwKCUJhY2s6IGZ1bmN0aW9uKCBwICkgewoJCXJldHVybiBwICogcCAqICggMyAqIHAgLSAyICk7Cgl9LAoJQm91bmNlOiBmdW5jdGlvbiggcCApIHsKCQl2YXIgcG93MiwKCQkJYm91bmNlID0gNDsKCgkJd2hpbGUgKCBwIDwgKCAoIHBvdzIgPSBNYXRoLnBvdyggMiwgLS1ib3VuY2UgKSApIC0gMSApIC8gMTEgKSB7fQoJCXJldHVybiAxIC8gTWF0aC5wb3coIDQsIDMgLSBib3VuY2UgKSAtIDcuNTYyNSAqIE1hdGgucG93KCAoIHBvdzIgKiAzIC0gMiApIC8gMjIgLSBwLCAyICk7Cgl9Cn0pOwoKJC5lYWNoKCBiYXNlRWFzaW5ncywgZnVuY3Rpb24oIG5hbWUsIGVhc2VJbiApIHsKCSQuZWFzaW5nWyAiZWFzZUluIiArIG5hbWUgXSA9IGVhc2VJbjsKCSQuZWFzaW5nWyAiZWFzZU91dCIgKyBuYW1lIF0gPSBmdW5jdGlvbiggcCApIHsKCQlyZXR1cm4gMSAtIGVhc2VJbiggMSAtIHAgKTsKCX07CgkkLmVhc2luZ1sgImVhc2VJbk91dCIgKyBuYW1lIF0gPSBmdW5jdGlvbiggcCApIHsKCQlyZXR1cm4gcCA8IDAuNSA/CgkJCWVhc2VJbiggcCAqIDIgKSAvIDIgOgoJCQkxIC0gZWFzZUluKCBwICogLTIgKyAyICkgLyAyOwoJfTsKfSk7Cgp9KSgpOwoKdmFyIGVmZmVjdCA9ICQuZWZmZWN0czsKCgovKiEKICogalF1ZXJ5IFVJIEVmZmVjdHMgQmxpbmQgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vYmxpbmQtZWZmZWN0LwogKi8KCgp2YXIgZWZmZWN0QmxpbmQgPSAkLmVmZmVjdHMuZWZmZWN0LmJsaW5kID0gZnVuY3Rpb24oIG8sIGRvbmUgKSB7CgkvLyBDcmVhdGUgZWxlbWVudAoJdmFyIGVsID0gJCggdGhpcyApLAoJCXJ2ZXJ0aWNhbCA9IC91cHxkb3dufHZlcnRpY2FsLywKCQlycG9zaXRpdmVtb3Rpb24gPSAvdXB8bGVmdHx2ZXJ0aWNhbHxob3Jpem9udGFsLywKCQlwcm9wcyA9IFsgInBvc2l0aW9uIiwgInRvcCIsICJib3R0b20iLCAibGVmdCIsICJyaWdodCIsICJoZWlnaHQiLCAid2lkdGgiIF0sCgkJbW9kZSA9ICQuZWZmZWN0cy5zZXRNb2RlKCBlbCwgby5tb2RlIHx8ICJoaWRlIiApLAoJCWRpcmVjdGlvbiA9IG8uZGlyZWN0aW9uIHx8ICJ1cCIsCgkJdmVydGljYWwgPSBydmVydGljYWwudGVzdCggZGlyZWN0aW9uICksCgkJcmVmID0gdmVydGljYWwgPyAiaGVpZ2h0IiA6ICJ3aWR0aCIsCgkJcmVmMiA9IHZlcnRpY2FsID8gInRvcCIgOiAibGVmdCIsCgkJbW90aW9uID0gcnBvc2l0aXZlbW90aW9uLnRlc3QoIGRpcmVjdGlvbiApLAoJCWFuaW1hdGlvbiA9IHt9LAoJCXNob3cgPSBtb2RlID09PSAic2hvdyIsCgkJd3JhcHBlciwgZGlzdGFuY2UsIG1hcmdpbjsKCgkvLyBpZiBhbHJlYWR5IHdyYXBwZWQsIHRoZSB3cmFwcGVyJ3MgcHJvcGVydGllcyBhcmUgbXkgcHJvcGVydHkuICM2MjQ1CglpZiAoIGVsLnBhcmVudCgpLmlzKCAiLnVpLWVmZmVjdHMtd3JhcHBlciIgKSApIHsKCQkkLmVmZmVjdHMuc2F2ZSggZWwucGFyZW50KCksIHByb3BzICk7Cgl9IGVsc2UgewoJCSQuZWZmZWN0cy5zYXZlKCBlbCwgcHJvcHMgKTsKCX0KCWVsLnNob3coKTsKCXdyYXBwZXIgPSAkLmVmZmVjdHMuY3JlYXRlV3JhcHBlciggZWwgKS5jc3MoewoJCW92ZXJmbG93OiAiaGlkZGVuIgoJfSk7CgoJZGlzdGFuY2UgPSB3cmFwcGVyWyByZWYgXSgpOwoJbWFyZ2luID0gcGFyc2VGbG9hdCggd3JhcHBlci5jc3MoIHJlZjIgKSApIHx8IDA7CgoJYW5pbWF0aW9uWyByZWYgXSA9IHNob3cgPyBkaXN0YW5jZSA6IDA7CglpZiAoICFtb3Rpb24gKSB7CgkJZWwKCQkJLmNzcyggdmVydGljYWwgPyAiYm90dG9tIiA6ICJyaWdodCIsIDAgKQoJCQkuY3NzKCB2ZXJ0aWNhbCA/ICJ0b3AiIDogImxlZnQiLCAiYXV0byIgKQoJCQkuY3NzKHsgcG9zaXRpb246ICJhYnNvbHV0ZSIgfSk7CgoJCWFuaW1hdGlvblsgcmVmMiBdID0gc2hvdyA/IG1hcmdpbiA6IGRpc3RhbmNlICsgbWFyZ2luOwoJfQoKCS8vIHN0YXJ0IGF0IDAgaWYgd2UgYXJlIHNob3dpbmcKCWlmICggc2hvdyApIHsKCQl3cmFwcGVyLmNzcyggcmVmLCAwICk7CgkJaWYgKCAhbW90aW9uICkgewoJCQl3cmFwcGVyLmNzcyggcmVmMiwgbWFyZ2luICsgZGlzdGFuY2UgKTsKCQl9Cgl9CgoJLy8gQW5pbWF0ZQoJd3JhcHBlci5hbmltYXRlKCBhbmltYXRpb24sIHsKCQlkdXJhdGlvbjogby5kdXJhdGlvbiwKCQllYXNpbmc6IG8uZWFzaW5nLAoJCXF1ZXVlOiBmYWxzZSwKCQljb21wbGV0ZTogZnVuY3Rpb24oKSB7CgkJCWlmICggbW9kZSA9PT0gImhpZGUiICkgewoJCQkJZWwuaGlkZSgpOwoJCQl9CgkJCSQuZWZmZWN0cy5yZXN0b3JlKCBlbCwgcHJvcHMgKTsKCQkJJC5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoIGVsICk7CgkJCWRvbmUoKTsKCQl9Cgl9KTsKfTsKCgovKiEKICogalF1ZXJ5IFVJIEVmZmVjdHMgQm91bmNlIDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL2JvdW5jZS1lZmZlY3QvCiAqLwoKCnZhciBlZmZlY3RCb3VuY2UgPSAkLmVmZmVjdHMuZWZmZWN0LmJvdW5jZSA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoJdmFyIGVsID0gJCggdGhpcyApLAoJCXByb3BzID0gWyAicG9zaXRpb24iLCAidG9wIiwgImJvdHRvbSIsICJsZWZ0IiwgInJpZ2h0IiwgImhlaWdodCIsICJ3aWR0aCIgXSwKCgkJLy8gZGVmYXVsdHM6CgkJbW9kZSA9ICQuZWZmZWN0cy5zZXRNb2RlKCBlbCwgby5tb2RlIHx8ICJlZmZlY3QiICksCgkJaGlkZSA9IG1vZGUgPT09ICJoaWRlIiwKCQlzaG93ID0gbW9kZSA9PT0gInNob3ciLAoJCWRpcmVjdGlvbiA9IG8uZGlyZWN0aW9uIHx8ICJ1cCIsCgkJZGlzdGFuY2UgPSBvLmRpc3RhbmNlLAoJCXRpbWVzID0gby50aW1lcyB8fCA1LAoKCQkvLyBudW1iZXIgb2YgaW50ZXJuYWwgYW5pbWF0aW9ucwoJCWFuaW1zID0gdGltZXMgKiAyICsgKCBzaG93IHx8IGhpZGUgPyAxIDogMCApLAoJCXNwZWVkID0gby5kdXJhdGlvbiAvIGFuaW1zLAoJCWVhc2luZyA9IG8uZWFzaW5nLAoKCQkvLyB1dGlsaXR5OgoJCXJlZiA9ICggZGlyZWN0aW9uID09PSAidXAiIHx8IGRpcmVjdGlvbiA9PT0gImRvd24iICkgPyAidG9wIiA6ICJsZWZ0IiwKCQltb3Rpb24gPSAoIGRpcmVjdGlvbiA9PT0gInVwIiB8fCBkaXJlY3Rpb24gPT09ICJsZWZ0IiApLAoJCWksCgkJdXBBbmltLAoJCWRvd25BbmltLAoKCQkvLyB3ZSB3aWxsIG5lZWQgdG8gcmUtYXNzZW1ibGUgdGhlIHF1ZXVlIHRvIHN0YWNrIG91ciBhbmltYXRpb25zIGluIHBsYWNlCgkJcXVldWUgPSBlbC5xdWV1ZSgpLAoJCXF1ZXVlbGVuID0gcXVldWUubGVuZ3RoOwoKCS8vIEF2b2lkIHRvdWNoaW5nIG9wYWNpdHkgdG8gcHJldmVudCBjbGVhclR5cGUgYW5kIFBORyBpc3N1ZXMgaW4gSUUKCWlmICggc2hvdyB8fCBoaWRlICkgewoJCXByb3BzLnB1c2goICJvcGFjaXR5IiApOwoJfQoKCSQuZWZmZWN0cy5zYXZlKCBlbCwgcHJvcHMgKTsKCWVsLnNob3coKTsKCSQuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKCBlbCApOyAvLyBDcmVhdGUgV3JhcHBlcgoKCS8vIGRlZmF1bHQgZGlzdGFuY2UgZm9yIHRoZSBCSUdHRVNUIGJvdW5jZSBpcyB0aGUgb3V0ZXIgRGlzdGFuY2UgLyAzCglpZiAoICFkaXN0YW5jZSApIHsKCQlkaXN0YW5jZSA9IGVsWyByZWYgPT09ICJ0b3AiID8gIm91dGVySGVpZ2h0IiA6ICJvdXRlcldpZHRoIiBdKCkgLyAzOwoJfQoKCWlmICggc2hvdyApIHsKCQlkb3duQW5pbSA9IHsgb3BhY2l0eTogMSB9OwoJCWRvd25BbmltWyByZWYgXSA9IDA7CgoJCS8vIGlmIHdlIGFyZSBzaG93aW5nLCBmb3JjZSBvcGFjaXR5IDAgYW5kIHNldCB0aGUgaW5pdGlhbCBwb3NpdGlvbgoJCS8vIHRoZW4gZG8gdGhlICJmaXJzdCIgYW5pbWF0aW9uCgkJZWwuY3NzKCAib3BhY2l0eSIsIDAgKQoJCQkuY3NzKCByZWYsIG1vdGlvbiA/IC1kaXN0YW5jZSAqIDIgOiBkaXN0YW5jZSAqIDIgKQoJCQkuYW5pbWF0ZSggZG93bkFuaW0sIHNwZWVkLCBlYXNpbmcgKTsKCX0KCgkvLyBzdGFydCBhdCB0aGUgc21hbGxlc3QgZGlzdGFuY2UgaWYgd2UgYXJlIGhpZGluZwoJaWYgKCBoaWRlICkgewoJCWRpc3RhbmNlID0gZGlzdGFuY2UgLyBNYXRoLnBvdyggMiwgdGltZXMgLSAxICk7Cgl9CgoJZG93bkFuaW0gPSB7fTsKCWRvd25BbmltWyByZWYgXSA9IDA7CgkvLyBCb3VuY2VzIHVwL2Rvd24vbGVmdC9yaWdodCB0aGVuIGJhY2sgdG8gMCAtLSB0aW1lcyAqIDIgYW5pbWF0aW9ucyBoYXBwZW4gaGVyZQoJZm9yICggaSA9IDA7IGkgPCB0aW1lczsgaSsrICkgewoJCXVwQW5pbSA9IHt9OwoJCXVwQW5pbVsgcmVmIF0gPSAoIG1vdGlvbiA/ICItPSIgOiAiKz0iICkgKyBkaXN0YW5jZTsKCgkJZWwuYW5pbWF0ZSggdXBBbmltLCBzcGVlZCwgZWFzaW5nICkKCQkJLmFuaW1hdGUoIGRvd25BbmltLCBzcGVlZCwgZWFzaW5nICk7CgoJCWRpc3RhbmNlID0gaGlkZSA/IGRpc3RhbmNlICogMiA6IGRpc3RhbmNlIC8gMjsKCX0KCgkvLyBMYXN0IEJvdW5jZSB3aGVuIEhpZGluZwoJaWYgKCBoaWRlICkgewoJCXVwQW5pbSA9IHsgb3BhY2l0eTogMCB9OwoJCXVwQW5pbVsgcmVmIF0gPSAoIG1vdGlvbiA/ICItPSIgOiAiKz0iICkgKyBkaXN0YW5jZTsKCgkJZWwuYW5pbWF0ZSggdXBBbmltLCBzcGVlZCwgZWFzaW5nICk7Cgl9CgoJZWwucXVldWUoZnVuY3Rpb24oKSB7CgkJaWYgKCBoaWRlICkgewoJCQllbC5oaWRlKCk7CgkJfQoJCSQuZWZmZWN0cy5yZXN0b3JlKCBlbCwgcHJvcHMgKTsKCQkkLmVmZmVjdHMucmVtb3ZlV3JhcHBlciggZWwgKTsKCQlkb25lKCk7Cgl9KTsKCgkvLyBpbmplY3QgYWxsIHRoZSBhbmltYXRpb25zIHdlIGp1c3QgcXVldWVkIHRvIGJlIGZpcnN0IGluIGxpbmUgKGFmdGVyICJpbnByb2dyZXNzIikKCWlmICggcXVldWVsZW4gPiAxKSB7CgkJcXVldWUuc3BsaWNlLmFwcGx5KCBxdWV1ZSwKCQkJWyAxLCAwIF0uY29uY2F0KCBxdWV1ZS5zcGxpY2UoIHF1ZXVlbGVuLCBhbmltcyArIDEgKSApICk7Cgl9CgllbC5kZXF1ZXVlKCk7Cgp9OwoKCi8qIQogKiBqUXVlcnkgVUkgRWZmZWN0cyBDbGlwIDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL2NsaXAtZWZmZWN0LwogKi8KCgp2YXIgZWZmZWN0Q2xpcCA9ICQuZWZmZWN0cy5lZmZlY3QuY2xpcCA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoJLy8gQ3JlYXRlIGVsZW1lbnQKCXZhciBlbCA9ICQoIHRoaXMgKSwKCQlwcm9wcyA9IFsgInBvc2l0aW9uIiwgInRvcCIsICJib3R0b20iLCAibGVmdCIsICJyaWdodCIsICJoZWlnaHQiLCAid2lkdGgiIF0sCgkJbW9kZSA9ICQuZWZmZWN0cy5zZXRNb2RlKCBlbCwgby5tb2RlIHx8ICJoaWRlIiApLAoJCXNob3cgPSBtb2RlID09PSAic2hvdyIsCgkJZGlyZWN0aW9uID0gby5kaXJlY3Rpb24gfHwgInZlcnRpY2FsIiwKCQl2ZXJ0ID0gZGlyZWN0aW9uID09PSAidmVydGljYWwiLAoJCXNpemUgPSB2ZXJ0ID8gImhlaWdodCIgOiAid2lkdGgiLAoJCXBvc2l0aW9uID0gdmVydCA/ICJ0b3AiIDogImxlZnQiLAoJCWFuaW1hdGlvbiA9IHt9LAoJCXdyYXBwZXIsIGFuaW1hdGUsIGRpc3RhbmNlOwoKCS8vIFNhdmUgJiBTaG93CgkkLmVmZmVjdHMuc2F2ZSggZWwsIHByb3BzICk7CgllbC5zaG93KCk7CgoJLy8gQ3JlYXRlIFdyYXBwZXIKCXdyYXBwZXIgPSAkLmVmZmVjdHMuY3JlYXRlV3JhcHBlciggZWwgKS5jc3MoewoJCW92ZXJmbG93OiAiaGlkZGVuIgoJfSk7CglhbmltYXRlID0gKCBlbFswXS50YWdOYW1lID09PSAiSU1HIiApID8gd3JhcHBlciA6IGVsOwoJZGlzdGFuY2UgPSBhbmltYXRlWyBzaXplIF0oKTsKCgkvLyBTaGlmdAoJaWYgKCBzaG93ICkgewoJCWFuaW1hdGUuY3NzKCBzaXplLCAwICk7CgkJYW5pbWF0ZS5jc3MoIHBvc2l0aW9uLCBkaXN0YW5jZSAvIDIgKTsKCX0KCgkvLyBDcmVhdGUgQW5pbWF0aW9uIE9iamVjdDoKCWFuaW1hdGlvblsgc2l6ZSBdID0gc2hvdyA/IGRpc3RhbmNlIDogMDsKCWFuaW1hdGlvblsgcG9zaXRpb24gXSA9IHNob3cgPyAwIDogZGlzdGFuY2UgLyAyOwoKCS8vIEFuaW1hdGUKCWFuaW1hdGUuYW5pbWF0ZSggYW5pbWF0aW9uLCB7CgkJcXVldWU6IGZhbHNlLAoJCWR1cmF0aW9uOiBvLmR1cmF0aW9uLAoJCWVhc2luZzogby5lYXNpbmcsCgkJY29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQlpZiAoICFzaG93ICkgewoJCQkJZWwuaGlkZSgpOwoJCQl9CgkJCSQuZWZmZWN0cy5yZXN0b3JlKCBlbCwgcHJvcHMgKTsKCQkJJC5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoIGVsICk7CgkJCWRvbmUoKTsKCQl9Cgl9KTsKCn07CgoKLyohCiAqIGpRdWVyeSBVSSBFZmZlY3RzIERyb3AgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vZHJvcC1lZmZlY3QvCiAqLwoKCnZhciBlZmZlY3REcm9wID0gJC5lZmZlY3RzLmVmZmVjdC5kcm9wID0gZnVuY3Rpb24oIG8sIGRvbmUgKSB7CgoJdmFyIGVsID0gJCggdGhpcyApLAoJCXByb3BzID0gWyAicG9zaXRpb24iLCAidG9wIiwgImJvdHRvbSIsICJsZWZ0IiwgInJpZ2h0IiwgIm9wYWNpdHkiLCAiaGVpZ2h0IiwgIndpZHRoIiBdLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAiaGlkZSIgKSwKCQlzaG93ID0gbW9kZSA9PT0gInNob3ciLAoJCWRpcmVjdGlvbiA9IG8uZGlyZWN0aW9uIHx8ICJsZWZ0IiwKCQlyZWYgPSAoIGRpcmVjdGlvbiA9PT0gInVwIiB8fCBkaXJlY3Rpb24gPT09ICJkb3duIiApID8gInRvcCIgOiAibGVmdCIsCgkJbW90aW9uID0gKCBkaXJlY3Rpb24gPT09ICJ1cCIgfHwgZGlyZWN0aW9uID09PSAibGVmdCIgKSA/ICJwb3MiIDogIm5lZyIsCgkJYW5pbWF0aW9uID0gewoJCQlvcGFjaXR5OiBzaG93ID8gMSA6IDAKCQl9LAoJCWRpc3RhbmNlOwoKCS8vIEFkanVzdAoJJC5lZmZlY3RzLnNhdmUoIGVsLCBwcm9wcyApOwoJZWwuc2hvdygpOwoJJC5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoIGVsICk7CgoJZGlzdGFuY2UgPSBvLmRpc3RhbmNlIHx8IGVsWyByZWYgPT09ICJ0b3AiID8gIm91dGVySGVpZ2h0IjogIm91dGVyV2lkdGgiIF0oIHRydWUgKSAvIDI7CgoJaWYgKCBzaG93ICkgewoJCWVsCgkJCS5jc3MoICJvcGFjaXR5IiwgMCApCgkJCS5jc3MoIHJlZiwgbW90aW9uID09PSAicG9zIiA/IC1kaXN0YW5jZSA6IGRpc3RhbmNlICk7Cgl9CgoJLy8gQW5pbWF0aW9uCglhbmltYXRpb25bIHJlZiBdID0gKCBzaG93ID8KCQkoIG1vdGlvbiA9PT0gInBvcyIgPyAiKz0iIDogIi09IiApIDoKCQkoIG1vdGlvbiA9PT0gInBvcyIgPyAiLT0iIDogIis9IiApICkgKwoJCWRpc3RhbmNlOwoKCS8vIEFuaW1hdGUKCWVsLmFuaW1hdGUoIGFuaW1hdGlvbiwgewoJCXF1ZXVlOiBmYWxzZSwKCQlkdXJhdGlvbjogby5kdXJhdGlvbiwKCQllYXNpbmc6IG8uZWFzaW5nLAoJCWNvbXBsZXRlOiBmdW5jdGlvbigpIHsKCQkJaWYgKCBtb2RlID09PSAiaGlkZSIgKSB7CgkJCQllbC5oaWRlKCk7CgkJCX0KCQkJJC5lZmZlY3RzLnJlc3RvcmUoIGVsLCBwcm9wcyApOwoJCQkkLmVmZmVjdHMucmVtb3ZlV3JhcHBlciggZWwgKTsKCQkJZG9uZSgpOwoJCX0KCX0pOwp9OwoKCi8qIQogKiBqUXVlcnkgVUkgRWZmZWN0cyBFeHBsb2RlIDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL2V4cGxvZGUtZWZmZWN0LwogKi8KCgp2YXIgZWZmZWN0RXhwbG9kZSA9ICQuZWZmZWN0cy5lZmZlY3QuZXhwbG9kZSA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoKCXZhciByb3dzID0gby5waWVjZXMgPyBNYXRoLnJvdW5kKCBNYXRoLnNxcnQoIG8ucGllY2VzICkgKSA6IDMsCgkJY2VsbHMgPSByb3dzLAoJCWVsID0gJCggdGhpcyApLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAiaGlkZSIgKSwKCQlzaG93ID0gbW9kZSA9PT0gInNob3ciLAoKCQkvLyBzaG93IGFuZCB0aGVuIHZpc2liaWxpdHk6aGlkZGVuIHRoZSBlbGVtZW50IGJlZm9yZSBjYWxjdWxhdGluZyBvZmZzZXQKCQlvZmZzZXQgPSBlbC5zaG93KCkuY3NzKCAidmlzaWJpbGl0eSIsICJoaWRkZW4iICkub2Zmc2V0KCksCgoJCS8vIHdpZHRoIGFuZCBoZWlnaHQgb2YgYSBwaWVjZQoJCXdpZHRoID0gTWF0aC5jZWlsKCBlbC5vdXRlcldpZHRoKCkgLyBjZWxscyApLAoJCWhlaWdodCA9IE1hdGguY2VpbCggZWwub3V0ZXJIZWlnaHQoKSAvIHJvd3MgKSwKCQlwaWVjZXMgPSBbXSwKCgkJLy8gbG9vcAoJCWksIGosIGxlZnQsIHRvcCwgbXgsIG15OwoKCS8vIGNoaWxkcmVuIGFuaW1hdGUgY29tcGxldGU6CglmdW5jdGlvbiBjaGlsZENvbXBsZXRlKCkgewoJCXBpZWNlcy5wdXNoKCB0aGlzICk7CgkJaWYgKCBwaWVjZXMubGVuZ3RoID09PSByb3dzICogY2VsbHMgKSB7CgkJCWFuaW1Db21wbGV0ZSgpOwoJCX0KCX0KCgkvLyBjbG9uZSB0aGUgZWxlbWVudCBmb3IgZWFjaCByb3cgYW5kIGNlbGwuCglmb3IgKCBpID0gMDsgaSA8IHJvd3MgOyBpKysgKSB7IC8vID09PT4KCQl0b3AgPSBvZmZzZXQudG9wICsgaSAqIGhlaWdodDsKCQlteSA9IGkgLSAoIHJvd3MgLSAxICkgLyAyIDsKCgkJZm9yICggaiA9IDA7IGogPCBjZWxscyA7IGorKyApIHsgLy8gfHx8CgkJCWxlZnQgPSBvZmZzZXQubGVmdCArIGogKiB3aWR0aDsKCQkJbXggPSBqIC0gKCBjZWxscyAtIDEgKSAvIDIgOwoKCQkJLy8gQ3JlYXRlIGEgY2xvbmUgb2YgdGhlIG5vdyBoaWRkZW4gbWFpbiBlbGVtZW50IHRoYXQgd2lsbCBiZSBhYnNvbHV0ZSBwb3NpdGlvbmVkCgkJCS8vIHdpdGhpbiBhIHdyYXBwZXIgZGl2IG9mZiB0aGUgLWxlZnQgYW5kIC10b3AgZXF1YWwgdG8gc2l6ZSBvZiBvdXIgcGllY2VzCgkJCWVsCgkJCQkuY2xvbmUoKQoJCQkJLmFwcGVuZFRvKCAiYm9keSIgKQoJCQkJLndyYXAoICI8ZGl2PjwvZGl2PiIgKQoJCQkJLmNzcyh7CgkJCQkJcG9zaXRpb246ICJhYnNvbHV0ZSIsCgkJCQkJdmlzaWJpbGl0eTogInZpc2libGUiLAoJCQkJCWxlZnQ6IC1qICogd2lkdGgsCgkJCQkJdG9wOiAtaSAqIGhlaWdodAoJCQkJfSkKCgkJCS8vIHNlbGVjdCB0aGUgd3JhcHBlciAtIG1ha2UgaXQgb3ZlcmZsb3c6IGhpZGRlbiBhbmQgYWJzb2x1dGUgcG9zaXRpb25lZCBiYXNlZCBvbgoJCQkvLyB3aGVyZSB0aGUgb3JpZ2luYWwgd2FzIGxvY2F0ZWQgK2xlZnQgYW5kICt0b3AgZXF1YWwgdG8gdGhlIHNpemUgb2YgcGllY2VzCgkJCQkucGFyZW50KCkKCQkJCS5hZGRDbGFzcyggInVpLWVmZmVjdHMtZXhwbG9kZSIgKQoJCQkJLmNzcyh7CgkJCQkJcG9zaXRpb246ICJhYnNvbHV0ZSIsCgkJCQkJb3ZlcmZsb3c6ICJoaWRkZW4iLAoJCQkJCXdpZHRoOiB3aWR0aCwKCQkJCQloZWlnaHQ6IGhlaWdodCwKCQkJCQlsZWZ0OiBsZWZ0ICsgKCBzaG93ID8gbXggKiB3aWR0aCA6IDAgKSwKCQkJCQl0b3A6IHRvcCArICggc2hvdyA/IG15ICogaGVpZ2h0IDogMCApLAoJCQkJCW9wYWNpdHk6IHNob3cgPyAwIDogMQoJCQkJfSkuYW5pbWF0ZSh7CgkJCQkJbGVmdDogbGVmdCArICggc2hvdyA/IDAgOiBteCAqIHdpZHRoICksCgkJCQkJdG9wOiB0b3AgKyAoIHNob3cgPyAwIDogbXkgKiBoZWlnaHQgKSwKCQkJCQlvcGFjaXR5OiBzaG93ID8gMSA6IDAKCQkJCX0sIG8uZHVyYXRpb24gfHwgNTAwLCBvLmVhc2luZywgY2hpbGRDb21wbGV0ZSApOwoJCX0KCX0KCglmdW5jdGlvbiBhbmltQ29tcGxldGUoKSB7CgkJZWwuY3NzKHsKCQkJdmlzaWJpbGl0eTogInZpc2libGUiCgkJfSk7CgkJJCggcGllY2VzICkucmVtb3ZlKCk7CgkJaWYgKCAhc2hvdyApIHsKCQkJZWwuaGlkZSgpOwoJCX0KCQlkb25lKCk7Cgl9Cn07CgoKLyohCiAqIGpRdWVyeSBVSSBFZmZlY3RzIEZhZGUgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vZmFkZS1lZmZlY3QvCiAqLwoKCnZhciBlZmZlY3RGYWRlID0gJC5lZmZlY3RzLmVmZmVjdC5mYWRlID0gZnVuY3Rpb24oIG8sIGRvbmUgKSB7Cgl2YXIgZWwgPSAkKCB0aGlzICksCgkJbW9kZSA9ICQuZWZmZWN0cy5zZXRNb2RlKCBlbCwgby5tb2RlIHx8ICJ0b2dnbGUiICk7CgoJZWwuYW5pbWF0ZSh7CgkJb3BhY2l0eTogbW9kZQoJfSwgewoJCXF1ZXVlOiBmYWxzZSwKCQlkdXJhdGlvbjogby5kdXJhdGlvbiwKCQllYXNpbmc6IG8uZWFzaW5nLAoJCWNvbXBsZXRlOiBkb25lCgl9KTsKfTsKCgovKiEKICogalF1ZXJ5IFVJIEVmZmVjdHMgRm9sZCAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9mb2xkLWVmZmVjdC8KICovCgoKdmFyIGVmZmVjdEZvbGQgPSAkLmVmZmVjdHMuZWZmZWN0LmZvbGQgPSBmdW5jdGlvbiggbywgZG9uZSApIHsKCgkvLyBDcmVhdGUgZWxlbWVudAoJdmFyIGVsID0gJCggdGhpcyApLAoJCXByb3BzID0gWyAicG9zaXRpb24iLCAidG9wIiwgImJvdHRvbSIsICJsZWZ0IiwgInJpZ2h0IiwgImhlaWdodCIsICJ3aWR0aCIgXSwKCQltb2RlID0gJC5lZmZlY3RzLnNldE1vZGUoIGVsLCBvLm1vZGUgfHwgImhpZGUiICksCgkJc2hvdyA9IG1vZGUgPT09ICJzaG93IiwKCQloaWRlID0gbW9kZSA9PT0gImhpZGUiLAoJCXNpemUgPSBvLnNpemUgfHwgMTUsCgkJcGVyY2VudCA9IC8oWzAtOV0rKSUvLmV4ZWMoIHNpemUgKSwKCQlob3JpekZpcnN0ID0gISFvLmhvcml6Rmlyc3QsCgkJd2lkdGhGaXJzdCA9IHNob3cgIT09IGhvcml6Rmlyc3QsCgkJcmVmID0gd2lkdGhGaXJzdCA/IFsgIndpZHRoIiwgImhlaWdodCIgXSA6IFsgImhlaWdodCIsICJ3aWR0aCIgXSwKCQlkdXJhdGlvbiA9IG8uZHVyYXRpb24gLyAyLAoJCXdyYXBwZXIsIGRpc3RhbmNlLAoJCWFuaW1hdGlvbjEgPSB7fSwKCQlhbmltYXRpb24yID0ge307CgoJJC5lZmZlY3RzLnNhdmUoIGVsLCBwcm9wcyApOwoJZWwuc2hvdygpOwoKCS8vIENyZWF0ZSBXcmFwcGVyCgl3cmFwcGVyID0gJC5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoIGVsICkuY3NzKHsKCQlvdmVyZmxvdzogImhpZGRlbiIKCX0pOwoJZGlzdGFuY2UgPSB3aWR0aEZpcnN0ID8KCQlbIHdyYXBwZXIud2lkdGgoKSwgd3JhcHBlci5oZWlnaHQoKSBdIDoKCQlbIHdyYXBwZXIuaGVpZ2h0KCksIHdyYXBwZXIud2lkdGgoKSBdOwoKCWlmICggcGVyY2VudCApIHsKCQlzaXplID0gcGFyc2VJbnQoIHBlcmNlbnRbIDEgXSwgMTAgKSAvIDEwMCAqIGRpc3RhbmNlWyBoaWRlID8gMCA6IDEgXTsKCX0KCWlmICggc2hvdyApIHsKCQl3cmFwcGVyLmNzcyggaG9yaXpGaXJzdCA/IHsKCQkJaGVpZ2h0OiAwLAoJCQl3aWR0aDogc2l6ZQoJCX0gOiB7CgkJCWhlaWdodDogc2l6ZSwKCQkJd2lkdGg6IDAKCQl9KTsKCX0KCgkvLyBBbmltYXRpb24KCWFuaW1hdGlvbjFbIHJlZlsgMCBdIF0gPSBzaG93ID8gZGlzdGFuY2VbIDAgXSA6IHNpemU7CglhbmltYXRpb24yWyByZWZbIDEgXSBdID0gc2hvdyA/IGRpc3RhbmNlWyAxIF0gOiAwOwoKCS8vIEFuaW1hdGUKCXdyYXBwZXIKCQkuYW5pbWF0ZSggYW5pbWF0aW9uMSwgZHVyYXRpb24sIG8uZWFzaW5nICkKCQkuYW5pbWF0ZSggYW5pbWF0aW9uMiwgZHVyYXRpb24sIG8uZWFzaW5nLCBmdW5jdGlvbigpIHsKCQkJaWYgKCBoaWRlICkgewoJCQkJZWwuaGlkZSgpOwoJCQl9CgkJCSQuZWZmZWN0cy5yZXN0b3JlKCBlbCwgcHJvcHMgKTsKCQkJJC5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoIGVsICk7CgkJCWRvbmUoKTsKCQl9KTsKCn07CgoKLyohCiAqIGpRdWVyeSBVSSBFZmZlY3RzIEhpZ2hsaWdodCAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9oaWdobGlnaHQtZWZmZWN0LwogKi8KCgp2YXIgZWZmZWN0SGlnaGxpZ2h0ID0gJC5lZmZlY3RzLmVmZmVjdC5oaWdobGlnaHQgPSBmdW5jdGlvbiggbywgZG9uZSApIHsKCXZhciBlbGVtID0gJCggdGhpcyApLAoJCXByb3BzID0gWyAiYmFja2dyb3VuZEltYWdlIiwgImJhY2tncm91bmRDb2xvciIsICJvcGFjaXR5IiBdLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWxlbSwgby5tb2RlIHx8ICJzaG93IiApLAoJCWFuaW1hdGlvbiA9IHsKCQkJYmFja2dyb3VuZENvbG9yOiBlbGVtLmNzcyggImJhY2tncm91bmRDb2xvciIgKQoJCX07CgoJaWYgKG1vZGUgPT09ICJoaWRlIikgewoJCWFuaW1hdGlvbi5vcGFjaXR5ID0gMDsKCX0KCgkkLmVmZmVjdHMuc2F2ZSggZWxlbSwgcHJvcHMgKTsKCgllbGVtCgkJLnNob3coKQoJCS5jc3MoewoJCQliYWNrZ3JvdW5kSW1hZ2U6ICJub25lIiwKCQkJYmFja2dyb3VuZENvbG9yOiBvLmNvbG9yIHx8ICIjZmZmZjk5IgoJCX0pCgkJLmFuaW1hdGUoIGFuaW1hdGlvbiwgewoJCQlxdWV1ZTogZmFsc2UsCgkJCWR1cmF0aW9uOiBvLmR1cmF0aW9uLAoJCQllYXNpbmc6IG8uZWFzaW5nLAoJCQljb21wbGV0ZTogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIG1vZGUgPT09ICJoaWRlIiApIHsKCQkJCQllbGVtLmhpZGUoKTsKCQkJCX0KCQkJCSQuZWZmZWN0cy5yZXN0b3JlKCBlbGVtLCBwcm9wcyApOwoJCQkJZG9uZSgpOwoJCQl9CgkJfSk7Cn07CgoKLyohCiAqIGpRdWVyeSBVSSBFZmZlY3RzIFNpemUgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vc2l6ZS1lZmZlY3QvCiAqLwoKCnZhciBlZmZlY3RTaXplID0gJC5lZmZlY3RzLmVmZmVjdC5zaXplID0gZnVuY3Rpb24oIG8sIGRvbmUgKSB7CgoJLy8gQ3JlYXRlIGVsZW1lbnQKCXZhciBvcmlnaW5hbCwgYmFzZWxpbmUsIGZhY3RvciwKCQllbCA9ICQoIHRoaXMgKSwKCQlwcm9wczAgPSBbICJwb3NpdGlvbiIsICJ0b3AiLCAiYm90dG9tIiwgImxlZnQiLCAicmlnaHQiLCAid2lkdGgiLCAiaGVpZ2h0IiwgIm92ZXJmbG93IiwgIm9wYWNpdHkiIF0sCgoJCS8vIEFsd2F5cyByZXN0b3JlCgkJcHJvcHMxID0gWyAicG9zaXRpb24iLCAidG9wIiwgImJvdHRvbSIsICJsZWZ0IiwgInJpZ2h0IiwgIm92ZXJmbG93IiwgIm9wYWNpdHkiIF0sCgoJCS8vIENvcHkgZm9yIGNoaWxkcmVuCgkJcHJvcHMyID0gWyAid2lkdGgiLCAiaGVpZ2h0IiwgIm92ZXJmbG93IiBdLAoJCWNQcm9wcyA9IFsgImZvbnRTaXplIiBdLAoJCXZQcm9wcyA9IFsgImJvcmRlclRvcFdpZHRoIiwgImJvcmRlckJvdHRvbVdpZHRoIiwgInBhZGRpbmdUb3AiLCAicGFkZGluZ0JvdHRvbSIgXSwKCQloUHJvcHMgPSBbICJib3JkZXJMZWZ0V2lkdGgiLCAiYm9yZGVyUmlnaHRXaWR0aCIsICJwYWRkaW5nTGVmdCIsICJwYWRkaW5nUmlnaHQiIF0sCgoJCS8vIFNldCBvcHRpb25zCgkJbW9kZSA9ICQuZWZmZWN0cy5zZXRNb2RlKCBlbCwgby5tb2RlIHx8ICJlZmZlY3QiICksCgkJcmVzdG9yZSA9IG8ucmVzdG9yZSB8fCBtb2RlICE9PSAiZWZmZWN0IiwKCQlzY2FsZSA9IG8uc2NhbGUgfHwgImJvdGgiLAoJCW9yaWdpbiA9IG8ub3JpZ2luIHx8IFsgIm1pZGRsZSIsICJjZW50ZXIiIF0sCgkJcG9zaXRpb24gPSBlbC5jc3MoICJwb3NpdGlvbiIgKSwKCQlwcm9wcyA9IHJlc3RvcmUgPyBwcm9wczAgOiBwcm9wczEsCgkJemVybyA9IHsKCQkJaGVpZ2h0OiAwLAoJCQl3aWR0aDogMCwKCQkJb3V0ZXJIZWlnaHQ6IDAsCgkJCW91dGVyV2lkdGg6IDAKCQl9OwoKCWlmICggbW9kZSA9PT0gInNob3ciICkgewoJCWVsLnNob3coKTsKCX0KCW9yaWdpbmFsID0gewoJCWhlaWdodDogZWwuaGVpZ2h0KCksCgkJd2lkdGg6IGVsLndpZHRoKCksCgkJb3V0ZXJIZWlnaHQ6IGVsLm91dGVySGVpZ2h0KCksCgkJb3V0ZXJXaWR0aDogZWwub3V0ZXJXaWR0aCgpCgl9OwoKCWlmICggby5tb2RlID09PSAidG9nZ2xlIiAmJiBtb2RlID09PSAic2hvdyIgKSB7CgkJZWwuZnJvbSA9IG8udG8gfHwgemVybzsKCQllbC50byA9IG8uZnJvbSB8fCBvcmlnaW5hbDsKCX0gZWxzZSB7CgkJZWwuZnJvbSA9IG8uZnJvbSB8fCAoIG1vZGUgPT09ICJzaG93IiA/IHplcm8gOiBvcmlnaW5hbCApOwoJCWVsLnRvID0gby50byB8fCAoIG1vZGUgPT09ICJoaWRlIiA/IHplcm8gOiBvcmlnaW5hbCApOwoJfQoKCS8vIFNldCBzY2FsaW5nIGZhY3RvcgoJZmFjdG9yID0gewoJCWZyb206IHsKCQkJeTogZWwuZnJvbS5oZWlnaHQgLyBvcmlnaW5hbC5oZWlnaHQsCgkJCXg6IGVsLmZyb20ud2lkdGggLyBvcmlnaW5hbC53aWR0aAoJCX0sCgkJdG86IHsKCQkJeTogZWwudG8uaGVpZ2h0IC8gb3JpZ2luYWwuaGVpZ2h0LAoJCQl4OiBlbC50by53aWR0aCAvIG9yaWdpbmFsLndpZHRoCgkJfQoJfTsKCgkvLyBTY2FsZSB0aGUgY3NzIGJveAoJaWYgKCBzY2FsZSA9PT0gImJveCIgfHwgc2NhbGUgPT09ICJib3RoIiApIHsKCgkJLy8gVmVydGljYWwgcHJvcHMgc2NhbGluZwoJCWlmICggZmFjdG9yLmZyb20ueSAhPT0gZmFjdG9yLnRvLnkgKSB7CgkJCXByb3BzID0gcHJvcHMuY29uY2F0KCB2UHJvcHMgKTsKCQkJZWwuZnJvbSA9ICQuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKCBlbCwgdlByb3BzLCBmYWN0b3IuZnJvbS55LCBlbC5mcm9tICk7CgkJCWVsLnRvID0gJC5lZmZlY3RzLnNldFRyYW5zaXRpb24oIGVsLCB2UHJvcHMsIGZhY3Rvci50by55LCBlbC50byApOwoJCX0KCgkJLy8gSG9yaXpvbnRhbCBwcm9wcyBzY2FsaW5nCgkJaWYgKCBmYWN0b3IuZnJvbS54ICE9PSBmYWN0b3IudG8ueCApIHsKCQkJcHJvcHMgPSBwcm9wcy5jb25jYXQoIGhQcm9wcyApOwoJCQllbC5mcm9tID0gJC5lZmZlY3RzLnNldFRyYW5zaXRpb24oIGVsLCBoUHJvcHMsIGZhY3Rvci5mcm9tLngsIGVsLmZyb20gKTsKCQkJZWwudG8gPSAkLmVmZmVjdHMuc2V0VHJhbnNpdGlvbiggZWwsIGhQcm9wcywgZmFjdG9yLnRvLngsIGVsLnRvICk7CgkJfQoJfQoKCS8vIFNjYWxlIHRoZSBjb250ZW50CglpZiAoIHNjYWxlID09PSAiY29udGVudCIgfHwgc2NhbGUgPT09ICJib3RoIiApIHsKCgkJLy8gVmVydGljYWwgcHJvcHMgc2NhbGluZwoJCWlmICggZmFjdG9yLmZyb20ueSAhPT0gZmFjdG9yLnRvLnkgKSB7CgkJCXByb3BzID0gcHJvcHMuY29uY2F0KCBjUHJvcHMgKS5jb25jYXQoIHByb3BzMiApOwoJCQllbC5mcm9tID0gJC5lZmZlY3RzLnNldFRyYW5zaXRpb24oIGVsLCBjUHJvcHMsIGZhY3Rvci5mcm9tLnksIGVsLmZyb20gKTsKCQkJZWwudG8gPSAkLmVmZmVjdHMuc2V0VHJhbnNpdGlvbiggZWwsIGNQcm9wcywgZmFjdG9yLnRvLnksIGVsLnRvICk7CgkJfQoJfQoKCSQuZWZmZWN0cy5zYXZlKCBlbCwgcHJvcHMgKTsKCWVsLnNob3coKTsKCSQuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKCBlbCApOwoJZWwuY3NzKCAib3ZlcmZsb3ciLCAiaGlkZGVuIiApLmNzcyggZWwuZnJvbSApOwoKCS8vIEFkanVzdAoJaWYgKG9yaWdpbikgeyAvLyBDYWxjdWxhdGUgYmFzZWxpbmUgc2hpZnRzCgkJYmFzZWxpbmUgPSAkLmVmZmVjdHMuZ2V0QmFzZWxpbmUoIG9yaWdpbiwgb3JpZ2luYWwgKTsKCQllbC5mcm9tLnRvcCA9ICggb3JpZ2luYWwub3V0ZXJIZWlnaHQgLSBlbC5vdXRlckhlaWdodCgpICkgKiBiYXNlbGluZS55OwoJCWVsLmZyb20ubGVmdCA9ICggb3JpZ2luYWwub3V0ZXJXaWR0aCAtIGVsLm91dGVyV2lkdGgoKSApICogYmFzZWxpbmUueDsKCQllbC50by50b3AgPSAoIG9yaWdpbmFsLm91dGVySGVpZ2h0IC0gZWwudG8ub3V0ZXJIZWlnaHQgKSAqIGJhc2VsaW5lLnk7CgkJZWwudG8ubGVmdCA9ICggb3JpZ2luYWwub3V0ZXJXaWR0aCAtIGVsLnRvLm91dGVyV2lkdGggKSAqIGJhc2VsaW5lLng7Cgl9CgllbC5jc3MoIGVsLmZyb20gKTsgLy8gc2V0IHRvcCAmIGxlZnQKCgkvLyBBbmltYXRlCglpZiAoIHNjYWxlID09PSAiY29udGVudCIgfHwgc2NhbGUgPT09ICJib3RoIiApIHsgLy8gU2NhbGUgdGhlIGNoaWxkcmVuCgoJCS8vIEFkZCBtYXJnaW5zL2ZvbnQtc2l6ZQoJCXZQcm9wcyA9IHZQcm9wcy5jb25jYXQoWyAibWFyZ2luVG9wIiwgIm1hcmdpbkJvdHRvbSIgXSkuY29uY2F0KGNQcm9wcyk7CgkJaFByb3BzID0gaFByb3BzLmNvbmNhdChbICJtYXJnaW5MZWZ0IiwgIm1hcmdpblJpZ2h0IiBdKTsKCQlwcm9wczIgPSBwcm9wczAuY29uY2F0KHZQcm9wcykuY29uY2F0KGhQcm9wcyk7CgoJCWVsLmZpbmQoICIqW3dpZHRoXSIgKS5lYWNoKCBmdW5jdGlvbigpIHsKCQkJdmFyIGNoaWxkID0gJCggdGhpcyApLAoJCQkJY19vcmlnaW5hbCA9IHsKCQkJCQloZWlnaHQ6IGNoaWxkLmhlaWdodCgpLAoJCQkJCXdpZHRoOiBjaGlsZC53aWR0aCgpLAoJCQkJCW91dGVySGVpZ2h0OiBjaGlsZC5vdXRlckhlaWdodCgpLAoJCQkJCW91dGVyV2lkdGg6IGNoaWxkLm91dGVyV2lkdGgoKQoJCQkJfTsKCQkJaWYgKHJlc3RvcmUpIHsKCQkJCSQuZWZmZWN0cy5zYXZlKGNoaWxkLCBwcm9wczIpOwoJCQl9CgoJCQljaGlsZC5mcm9tID0gewoJCQkJaGVpZ2h0OiBjX29yaWdpbmFsLmhlaWdodCAqIGZhY3Rvci5mcm9tLnksCgkJCQl3aWR0aDogY19vcmlnaW5hbC53aWR0aCAqIGZhY3Rvci5mcm9tLngsCgkJCQlvdXRlckhlaWdodDogY19vcmlnaW5hbC5vdXRlckhlaWdodCAqIGZhY3Rvci5mcm9tLnksCgkJCQlvdXRlcldpZHRoOiBjX29yaWdpbmFsLm91dGVyV2lkdGggKiBmYWN0b3IuZnJvbS54CgkJCX07CgkJCWNoaWxkLnRvID0gewoJCQkJaGVpZ2h0OiBjX29yaWdpbmFsLmhlaWdodCAqIGZhY3Rvci50by55LAoJCQkJd2lkdGg6IGNfb3JpZ2luYWwud2lkdGggKiBmYWN0b3IudG8ueCwKCQkJCW91dGVySGVpZ2h0OiBjX29yaWdpbmFsLmhlaWdodCAqIGZhY3Rvci50by55LAoJCQkJb3V0ZXJXaWR0aDogY19vcmlnaW5hbC53aWR0aCAqIGZhY3Rvci50by54CgkJCX07CgoJCQkvLyBWZXJ0aWNhbCBwcm9wcyBzY2FsaW5nCgkJCWlmICggZmFjdG9yLmZyb20ueSAhPT0gZmFjdG9yLnRvLnkgKSB7CgkJCQljaGlsZC5mcm9tID0gJC5lZmZlY3RzLnNldFRyYW5zaXRpb24oIGNoaWxkLCB2UHJvcHMsIGZhY3Rvci5mcm9tLnksIGNoaWxkLmZyb20gKTsKCQkJCWNoaWxkLnRvID0gJC5lZmZlY3RzLnNldFRyYW5zaXRpb24oIGNoaWxkLCB2UHJvcHMsIGZhY3Rvci50by55LCBjaGlsZC50byApOwoJCQl9CgoJCQkvLyBIb3Jpem9udGFsIHByb3BzIHNjYWxpbmcKCQkJaWYgKCBmYWN0b3IuZnJvbS54ICE9PSBmYWN0b3IudG8ueCApIHsKCQkJCWNoaWxkLmZyb20gPSAkLmVmZmVjdHMuc2V0VHJhbnNpdGlvbiggY2hpbGQsIGhQcm9wcywgZmFjdG9yLmZyb20ueCwgY2hpbGQuZnJvbSApOwoJCQkJY2hpbGQudG8gPSAkLmVmZmVjdHMuc2V0VHJhbnNpdGlvbiggY2hpbGQsIGhQcm9wcywgZmFjdG9yLnRvLngsIGNoaWxkLnRvICk7CgkJCX0KCgkJCS8vIEFuaW1hdGUgY2hpbGRyZW4KCQkJY2hpbGQuY3NzKCBjaGlsZC5mcm9tICk7CgkJCWNoaWxkLmFuaW1hdGUoIGNoaWxkLnRvLCBvLmR1cmF0aW9uLCBvLmVhc2luZywgZnVuY3Rpb24oKSB7CgoJCQkJLy8gUmVzdG9yZSBjaGlsZHJlbgoJCQkJaWYgKCByZXN0b3JlICkgewoJCQkJCSQuZWZmZWN0cy5yZXN0b3JlKCBjaGlsZCwgcHJvcHMyICk7CgkJCQl9CgkJCX0pOwoJCX0pOwoJfQoKCS8vIEFuaW1hdGUKCWVsLmFuaW1hdGUoIGVsLnRvLCB7CgkJcXVldWU6IGZhbHNlLAoJCWR1cmF0aW9uOiBvLmR1cmF0aW9uLAoJCWVhc2luZzogby5lYXNpbmcsCgkJY29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQlpZiAoIGVsLnRvLm9wYWNpdHkgPT09IDAgKSB7CgkJCQllbC5jc3MoICJvcGFjaXR5IiwgZWwuZnJvbS5vcGFjaXR5ICk7CgkJCX0KCQkJaWYgKCBtb2RlID09PSAiaGlkZSIgKSB7CgkJCQllbC5oaWRlKCk7CgkJCX0KCQkJJC5lZmZlY3RzLnJlc3RvcmUoIGVsLCBwcm9wcyApOwoJCQlpZiAoICFyZXN0b3JlICkgewoKCQkJCS8vIHdlIG5lZWQgdG8gY2FsY3VsYXRlIG91ciBuZXcgcG9zaXRpb25pbmcgYmFzZWQgb24gdGhlIHNjYWxpbmcKCQkJCWlmICggcG9zaXRpb24gPT09ICJzdGF0aWMiICkgewoJCQkJCWVsLmNzcyh7CgkJCQkJCXBvc2l0aW9uOiAicmVsYXRpdmUiLAoJCQkJCQl0b3A6IGVsLnRvLnRvcCwKCQkJCQkJbGVmdDogZWwudG8ubGVmdAoJCQkJCX0pOwoJCQkJfSBlbHNlIHsKCQkJCQkkLmVhY2goWyAidG9wIiwgImxlZnQiIF0sIGZ1bmN0aW9uKCBpZHgsIHBvcyApIHsKCQkJCQkJZWwuY3NzKCBwb3MsIGZ1bmN0aW9uKCBfLCBzdHIgKSB7CgkJCQkJCQl2YXIgdmFsID0gcGFyc2VJbnQoIHN0ciwgMTAgKSwKCQkJCQkJCQl0b1JlZiA9IGlkeCA/IGVsLnRvLmxlZnQgOiBlbC50by50b3A7CgoJCQkJCQkJLy8gaWYgb3JpZ2luYWwgd2FzICJhdXRvIiwgcmVjYWxjdWxhdGUgdGhlIG5ldyB2YWx1ZSBmcm9tIHdyYXBwZXIKCQkJCQkJCWlmICggc3RyID09PSAiYXV0byIgKSB7CgkJCQkJCQkJcmV0dXJuIHRvUmVmICsgInB4IjsKCQkJCQkJCX0KCgkJCQkJCQlyZXR1cm4gdmFsICsgdG9SZWYgKyAicHgiOwoJCQkJCQl9KTsKCQkJCQl9KTsKCQkJCX0KCQkJfQoKCQkJJC5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoIGVsICk7CgkJCWRvbmUoKTsKCQl9Cgl9KTsKCn07CgoKLyohCiAqIGpRdWVyeSBVSSBFZmZlY3RzIFNjYWxlIDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL3NjYWxlLWVmZmVjdC8KICovCgoKdmFyIGVmZmVjdFNjYWxlID0gJC5lZmZlY3RzLmVmZmVjdC5zY2FsZSA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoKCS8vIENyZWF0ZSBlbGVtZW50Cgl2YXIgZWwgPSAkKCB0aGlzICksCgkJb3B0aW9ucyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgbyApLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAiZWZmZWN0IiApLAoJCXBlcmNlbnQgPSBwYXJzZUludCggby5wZXJjZW50LCAxMCApIHx8CgkJCSggcGFyc2VJbnQoIG8ucGVyY2VudCwgMTAgKSA9PT0gMCA/IDAgOiAoIG1vZGUgPT09ICJoaWRlIiA/IDAgOiAxMDAgKSApLAoJCWRpcmVjdGlvbiA9IG8uZGlyZWN0aW9uIHx8ICJib3RoIiwKCQlvcmlnaW4gPSBvLm9yaWdpbiwKCQlvcmlnaW5hbCA9IHsKCQkJaGVpZ2h0OiBlbC5oZWlnaHQoKSwKCQkJd2lkdGg6IGVsLndpZHRoKCksCgkJCW91dGVySGVpZ2h0OiBlbC5vdXRlckhlaWdodCgpLAoJCQlvdXRlcldpZHRoOiBlbC5vdXRlcldpZHRoKCkKCQl9LAoJCWZhY3RvciA9IHsKCQkJeTogZGlyZWN0aW9uICE9PSAiaG9yaXpvbnRhbCIgPyAocGVyY2VudCAvIDEwMCkgOiAxLAoJCQl4OiBkaXJlY3Rpb24gIT09ICJ2ZXJ0aWNhbCIgPyAocGVyY2VudCAvIDEwMCkgOiAxCgkJfTsKCgkvLyBXZSBhcmUgZ29pbmcgdG8gcGFzcyB0aGlzIGVmZmVjdCB0byB0aGUgc2l6ZSBlZmZlY3Q6CglvcHRpb25zLmVmZmVjdCA9ICJzaXplIjsKCW9wdGlvbnMucXVldWUgPSBmYWxzZTsKCW9wdGlvbnMuY29tcGxldGUgPSBkb25lOwoKCS8vIFNldCBkZWZhdWx0IG9yaWdpbiBhbmQgcmVzdG9yZSBmb3Igc2hvdy9oaWRlCglpZiAoIG1vZGUgIT09ICJlZmZlY3QiICkgewoJCW9wdGlvbnMub3JpZ2luID0gb3JpZ2luIHx8IFsgIm1pZGRsZSIsICJjZW50ZXIiIF07CgkJb3B0aW9ucy5yZXN0b3JlID0gdHJ1ZTsKCX0KCglvcHRpb25zLmZyb20gPSBvLmZyb20gfHwgKCBtb2RlID09PSAic2hvdyIgPyB7CgkJaGVpZ2h0OiAwLAoJCXdpZHRoOiAwLAoJCW91dGVySGVpZ2h0OiAwLAoJCW91dGVyV2lkdGg6IDAKCX0gOiBvcmlnaW5hbCApOwoJb3B0aW9ucy50byA9IHsKCQloZWlnaHQ6IG9yaWdpbmFsLmhlaWdodCAqIGZhY3Rvci55LAoJCXdpZHRoOiBvcmlnaW5hbC53aWR0aCAqIGZhY3Rvci54LAoJCW91dGVySGVpZ2h0OiBvcmlnaW5hbC5vdXRlckhlaWdodCAqIGZhY3Rvci55LAoJCW91dGVyV2lkdGg6IG9yaWdpbmFsLm91dGVyV2lkdGggKiBmYWN0b3IueAoJfTsKCgkvLyBGYWRlIG9wdGlvbiB0byBzdXBwb3J0IHB1ZmYKCWlmICggb3B0aW9ucy5mYWRlICkgewoJCWlmICggbW9kZSA9PT0gInNob3ciICkgewoJCQlvcHRpb25zLmZyb20ub3BhY2l0eSA9IDA7CgkJCW9wdGlvbnMudG8ub3BhY2l0eSA9IDE7CgkJfQoJCWlmICggbW9kZSA9PT0gImhpZGUiICkgewoJCQlvcHRpb25zLmZyb20ub3BhY2l0eSA9IDE7CgkJCW9wdGlvbnMudG8ub3BhY2l0eSA9IDA7CgkJfQoJfQoKCS8vIEFuaW1hdGUKCWVsLmVmZmVjdCggb3B0aW9ucyApOwoKfTsKCgovKiEKICogalF1ZXJ5IFVJIEVmZmVjdHMgUHVmZiAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9wdWZmLWVmZmVjdC8KICovCgoKdmFyIGVmZmVjdFB1ZmYgPSAkLmVmZmVjdHMuZWZmZWN0LnB1ZmYgPSBmdW5jdGlvbiggbywgZG9uZSApIHsKCXZhciBlbGVtID0gJCggdGhpcyApLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWxlbSwgby5tb2RlIHx8ICJoaWRlIiApLAoJCWhpZGUgPSBtb2RlID09PSAiaGlkZSIsCgkJcGVyY2VudCA9IHBhcnNlSW50KCBvLnBlcmNlbnQsIDEwICkgfHwgMTUwLAoJCWZhY3RvciA9IHBlcmNlbnQgLyAxMDAsCgkJb3JpZ2luYWwgPSB7CgkJCWhlaWdodDogZWxlbS5oZWlnaHQoKSwKCQkJd2lkdGg6IGVsZW0ud2lkdGgoKSwKCQkJb3V0ZXJIZWlnaHQ6IGVsZW0ub3V0ZXJIZWlnaHQoKSwKCQkJb3V0ZXJXaWR0aDogZWxlbS5vdXRlcldpZHRoKCkKCQl9OwoKCSQuZXh0ZW5kKCBvLCB7CgkJZWZmZWN0OiAic2NhbGUiLAoJCXF1ZXVlOiBmYWxzZSwKCQlmYWRlOiB0cnVlLAoJCW1vZGU6IG1vZGUsCgkJY29tcGxldGU6IGRvbmUsCgkJcGVyY2VudDogaGlkZSA/IHBlcmNlbnQgOiAxMDAsCgkJZnJvbTogaGlkZSA/CgkJCW9yaWdpbmFsIDoKCQkJewoJCQkJaGVpZ2h0OiBvcmlnaW5hbC5oZWlnaHQgKiBmYWN0b3IsCgkJCQl3aWR0aDogb3JpZ2luYWwud2lkdGggKiBmYWN0b3IsCgkJCQlvdXRlckhlaWdodDogb3JpZ2luYWwub3V0ZXJIZWlnaHQgKiBmYWN0b3IsCgkJCQlvdXRlcldpZHRoOiBvcmlnaW5hbC5vdXRlcldpZHRoICogZmFjdG9yCgkJCX0KCX0pOwoKCWVsZW0uZWZmZWN0KCBvICk7Cn07CgoKLyohCiAqIGpRdWVyeSBVSSBFZmZlY3RzIFB1bHNhdGUgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vcHVsc2F0ZS1lZmZlY3QvCiAqLwoKCnZhciBlZmZlY3RQdWxzYXRlID0gJC5lZmZlY3RzLmVmZmVjdC5wdWxzYXRlID0gZnVuY3Rpb24oIG8sIGRvbmUgKSB7Cgl2YXIgZWxlbSA9ICQoIHRoaXMgKSwKCQltb2RlID0gJC5lZmZlY3RzLnNldE1vZGUoIGVsZW0sIG8ubW9kZSB8fCAic2hvdyIgKSwKCQlzaG93ID0gbW9kZSA9PT0gInNob3ciLAoJCWhpZGUgPSBtb2RlID09PSAiaGlkZSIsCgkJc2hvd2hpZGUgPSAoIHNob3cgfHwgbW9kZSA9PT0gImhpZGUiICksCgoJCS8vIHNob3dpbmcgb3IgaGlkaW5nIGxlYXZlcyBvZiB0aGUgImxhc3QiIGFuaW1hdGlvbgoJCWFuaW1zID0gKCAoIG8udGltZXMgfHwgNSApICogMiApICsgKCBzaG93aGlkZSA/IDEgOiAwICksCgkJZHVyYXRpb24gPSBvLmR1cmF0aW9uIC8gYW5pbXMsCgkJYW5pbWF0ZVRvID0gMCwKCQlxdWV1ZSA9IGVsZW0ucXVldWUoKSwKCQlxdWV1ZWxlbiA9IHF1ZXVlLmxlbmd0aCwKCQlpOwoKCWlmICggc2hvdyB8fCAhZWxlbS5pcygiOnZpc2libGUiKSkgewoJCWVsZW0uY3NzKCAib3BhY2l0eSIsIDAgKS5zaG93KCk7CgkJYW5pbWF0ZVRvID0gMTsKCX0KCgkvLyBhbmltcyAtIDEgb3BhY2l0eSAidG9nZ2xlcyIKCWZvciAoIGkgPSAxOyBpIDwgYW5pbXM7IGkrKyApIHsKCQllbGVtLmFuaW1hdGUoewoJCQlvcGFjaXR5OiBhbmltYXRlVG8KCQl9LCBkdXJhdGlvbiwgby5lYXNpbmcgKTsKCQlhbmltYXRlVG8gPSAxIC0gYW5pbWF0ZVRvOwoJfQoKCWVsZW0uYW5pbWF0ZSh7CgkJb3BhY2l0eTogYW5pbWF0ZVRvCgl9LCBkdXJhdGlvbiwgby5lYXNpbmcpOwoKCWVsZW0ucXVldWUoZnVuY3Rpb24oKSB7CgkJaWYgKCBoaWRlICkgewoJCQllbGVtLmhpZGUoKTsKCQl9CgkJZG9uZSgpOwoJfSk7CgoJLy8gV2UganVzdCBxdWV1ZWQgdXAgImFuaW1zIiBhbmltYXRpb25zLCB3ZSBuZWVkIHRvIHB1dCB0aGVtIG5leHQgaW4gdGhlIHF1ZXVlCglpZiAoIHF1ZXVlbGVuID4gMSApIHsKCQlxdWV1ZS5zcGxpY2UuYXBwbHkoIHF1ZXVlLAoJCQlbIDEsIDAgXS5jb25jYXQoIHF1ZXVlLnNwbGljZSggcXVldWVsZW4sIGFuaW1zICsgMSApICkgKTsKCX0KCWVsZW0uZGVxdWV1ZSgpOwp9OwoKCi8qIQogKiBqUXVlcnkgVUkgRWZmZWN0cyBTaGFrZSAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9zaGFrZS1lZmZlY3QvCiAqLwoKCnZhciBlZmZlY3RTaGFrZSA9ICQuZWZmZWN0cy5lZmZlY3Quc2hha2UgPSBmdW5jdGlvbiggbywgZG9uZSApIHsKCgl2YXIgZWwgPSAkKCB0aGlzICksCgkJcHJvcHMgPSBbICJwb3NpdGlvbiIsICJ0b3AiLCAiYm90dG9tIiwgImxlZnQiLCAicmlnaHQiLCAiaGVpZ2h0IiwgIndpZHRoIiBdLAoJCW1vZGUgPSAkLmVmZmVjdHMuc2V0TW9kZSggZWwsIG8ubW9kZSB8fCAiZWZmZWN0IiApLAoJCWRpcmVjdGlvbiA9IG8uZGlyZWN0aW9uIHx8ICJsZWZ0IiwKCQlkaXN0YW5jZSA9IG8uZGlzdGFuY2UgfHwgMjAsCgkJdGltZXMgPSBvLnRpbWVzIHx8IDMsCgkJYW5pbXMgPSB0aW1lcyAqIDIgKyAxLAoJCXNwZWVkID0gTWF0aC5yb3VuZCggby5kdXJhdGlvbiAvIGFuaW1zICksCgkJcmVmID0gKGRpcmVjdGlvbiA9PT0gInVwIiB8fCBkaXJlY3Rpb24gPT09ICJkb3duIikgPyAidG9wIiA6ICJsZWZ0IiwKCQlwb3NpdGl2ZU1vdGlvbiA9IChkaXJlY3Rpb24gPT09ICJ1cCIgfHwgZGlyZWN0aW9uID09PSAibGVmdCIpLAoJCWFuaW1hdGlvbiA9IHt9LAoJCWFuaW1hdGlvbjEgPSB7fSwKCQlhbmltYXRpb24yID0ge30sCgkJaSwKCgkJLy8gd2Ugd2lsbCBuZWVkIHRvIHJlLWFzc2VtYmxlIHRoZSBxdWV1ZSB0byBzdGFjayBvdXIgYW5pbWF0aW9ucyBpbiBwbGFjZQoJCXF1ZXVlID0gZWwucXVldWUoKSwKCQlxdWV1ZWxlbiA9IHF1ZXVlLmxlbmd0aDsKCgkkLmVmZmVjdHMuc2F2ZSggZWwsIHByb3BzICk7CgllbC5zaG93KCk7CgkkLmVmZmVjdHMuY3JlYXRlV3JhcHBlciggZWwgKTsKCgkvLyBBbmltYXRpb24KCWFuaW1hdGlvblsgcmVmIF0gPSAoIHBvc2l0aXZlTW90aW9uID8gIi09IiA6ICIrPSIgKSArIGRpc3RhbmNlOwoJYW5pbWF0aW9uMVsgcmVmIF0gPSAoIHBvc2l0aXZlTW90aW9uID8gIis9IiA6ICItPSIgKSArIGRpc3RhbmNlICogMjsKCWFuaW1hdGlvbjJbIHJlZiBdID0gKCBwb3NpdGl2ZU1vdGlvbiA/ICItPSIgOiAiKz0iICkgKyBkaXN0YW5jZSAqIDI7CgoJLy8gQW5pbWF0ZQoJZWwuYW5pbWF0ZSggYW5pbWF0aW9uLCBzcGVlZCwgby5lYXNpbmcgKTsKCgkvLyBTaGFrZXMKCWZvciAoIGkgPSAxOyBpIDwgdGltZXM7IGkrKyApIHsKCQllbC5hbmltYXRlKCBhbmltYXRpb24xLCBzcGVlZCwgby5lYXNpbmcgKS5hbmltYXRlKCBhbmltYXRpb24yLCBzcGVlZCwgby5lYXNpbmcgKTsKCX0KCWVsCgkJLmFuaW1hdGUoIGFuaW1hdGlvbjEsIHNwZWVkLCBvLmVhc2luZyApCgkJLmFuaW1hdGUoIGFuaW1hdGlvbiwgc3BlZWQgLyAyLCBvLmVhc2luZyApCgkJLnF1ZXVlKGZ1bmN0aW9uKCkgewoJCQlpZiAoIG1vZGUgPT09ICJoaWRlIiApIHsKCQkJCWVsLmhpZGUoKTsKCQkJfQoJCQkkLmVmZmVjdHMucmVzdG9yZSggZWwsIHByb3BzICk7CgkJCSQuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKCBlbCApOwoJCQlkb25lKCk7CgkJfSk7CgoJLy8gaW5qZWN0IGFsbCB0aGUgYW5pbWF0aW9ucyB3ZSBqdXN0IHF1ZXVlZCB0byBiZSBmaXJzdCBpbiBsaW5lIChhZnRlciAiaW5wcm9ncmVzcyIpCglpZiAoIHF1ZXVlbGVuID4gMSkgewoJCXF1ZXVlLnNwbGljZS5hcHBseSggcXVldWUsCgkJCVsgMSwgMCBdLmNvbmNhdCggcXVldWUuc3BsaWNlKCBxdWV1ZWxlbiwgYW5pbXMgKyAxICkgKSApOwoJfQoJZWwuZGVxdWV1ZSgpOwoKfTsKCgovKiEKICogalF1ZXJ5IFVJIEVmZmVjdHMgU2xpZGUgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vc2xpZGUtZWZmZWN0LwogKi8KCgp2YXIgZWZmZWN0U2xpZGUgPSAkLmVmZmVjdHMuZWZmZWN0LnNsaWRlID0gZnVuY3Rpb24oIG8sIGRvbmUgKSB7CgoJLy8gQ3JlYXRlIGVsZW1lbnQKCXZhciBlbCA9ICQoIHRoaXMgKSwKCQlwcm9wcyA9IFsgInBvc2l0aW9uIiwgInRvcCIsICJib3R0b20iLCAibGVmdCIsICJyaWdodCIsICJ3aWR0aCIsICJoZWlnaHQiIF0sCgkJbW9kZSA9ICQuZWZmZWN0cy5zZXRNb2RlKCBlbCwgby5tb2RlIHx8ICJzaG93IiApLAoJCXNob3cgPSBtb2RlID09PSAic2hvdyIsCgkJZGlyZWN0aW9uID0gby5kaXJlY3Rpb24gfHwgImxlZnQiLAoJCXJlZiA9IChkaXJlY3Rpb24gPT09ICJ1cCIgfHwgZGlyZWN0aW9uID09PSAiZG93biIpID8gInRvcCIgOiAibGVmdCIsCgkJcG9zaXRpdmVNb3Rpb24gPSAoZGlyZWN0aW9uID09PSAidXAiIHx8IGRpcmVjdGlvbiA9PT0gImxlZnQiKSwKCQlkaXN0YW5jZSwKCQlhbmltYXRpb24gPSB7fTsKCgkvLyBBZGp1c3QKCSQuZWZmZWN0cy5zYXZlKCBlbCwgcHJvcHMgKTsKCWVsLnNob3coKTsKCWRpc3RhbmNlID0gby5kaXN0YW5jZSB8fCBlbFsgcmVmID09PSAidG9wIiA/ICJvdXRlckhlaWdodCIgOiAib3V0ZXJXaWR0aCIgXSggdHJ1ZSApOwoKCSQuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKCBlbCApLmNzcyh7CgkJb3ZlcmZsb3c6ICJoaWRkZW4iCgl9KTsKCglpZiAoIHNob3cgKSB7CgkJZWwuY3NzKCByZWYsIHBvc2l0aXZlTW90aW9uID8gKGlzTmFOKGRpc3RhbmNlKSA/ICItIiArIGRpc3RhbmNlIDogLWRpc3RhbmNlKSA6IGRpc3RhbmNlICk7Cgl9CgoJLy8gQW5pbWF0aW9uCglhbmltYXRpb25bIHJlZiBdID0gKCBzaG93ID8KCQkoIHBvc2l0aXZlTW90aW9uID8gIis9IiA6ICItPSIpIDoKCQkoIHBvc2l0aXZlTW90aW9uID8gIi09IiA6ICIrPSIpKSArCgkJZGlzdGFuY2U7CgoJLy8gQW5pbWF0ZQoJZWwuYW5pbWF0ZSggYW5pbWF0aW9uLCB7CgkJcXVldWU6IGZhbHNlLAoJCWR1cmF0aW9uOiBvLmR1cmF0aW9uLAoJCWVhc2luZzogby5lYXNpbmcsCgkJY29tcGxldGU6IGZ1bmN0aW9uKCkgewoJCQlpZiAoIG1vZGUgPT09ICJoaWRlIiApIHsKCQkJCWVsLmhpZGUoKTsKCQkJfQoJCQkkLmVmZmVjdHMucmVzdG9yZSggZWwsIHByb3BzICk7CgkJCSQuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKCBlbCApOwoJCQlkb25lKCk7CgkJfQoJfSk7Cn07CgoKLyohCiAqIGpRdWVyeSBVSSBFZmZlY3RzIFRyYW5zZmVyIDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL3RyYW5zZmVyLWVmZmVjdC8KICovCgoKdmFyIGVmZmVjdFRyYW5zZmVyID0gJC5lZmZlY3RzLmVmZmVjdC50cmFuc2ZlciA9IGZ1bmN0aW9uKCBvLCBkb25lICkgewoJdmFyIGVsZW0gPSAkKCB0aGlzICksCgkJdGFyZ2V0ID0gJCggby50byApLAoJCXRhcmdldEZpeGVkID0gdGFyZ2V0LmNzcyggInBvc2l0aW9uIiApID09PSAiZml4ZWQiLAoJCWJvZHkgPSAkKCJib2R5IiksCgkJZml4VG9wID0gdGFyZ2V0Rml4ZWQgPyBib2R5LnNjcm9sbFRvcCgpIDogMCwKCQlmaXhMZWZ0ID0gdGFyZ2V0Rml4ZWQgPyBib2R5LnNjcm9sbExlZnQoKSA6IDAsCgkJZW5kUG9zaXRpb24gPSB0YXJnZXQub2Zmc2V0KCksCgkJYW5pbWF0aW9uID0gewoJCQl0b3A6IGVuZFBvc2l0aW9uLnRvcCAtIGZpeFRvcCwKCQkJbGVmdDogZW5kUG9zaXRpb24ubGVmdCAtIGZpeExlZnQsCgkJCWhlaWdodDogdGFyZ2V0LmlubmVySGVpZ2h0KCksCgkJCXdpZHRoOiB0YXJnZXQuaW5uZXJXaWR0aCgpCgkJfSwKCQlzdGFydFBvc2l0aW9uID0gZWxlbS5vZmZzZXQoKSwKCQl0cmFuc2ZlciA9ICQoICI8ZGl2IGNsYXNzPSd1aS1lZmZlY3RzLXRyYW5zZmVyJz48L2Rpdj4iICkKCQkJLmFwcGVuZFRvKCBkb2N1bWVudC5ib2R5ICkKCQkJLmFkZENsYXNzKCBvLmNsYXNzTmFtZSApCgkJCS5jc3MoewoJCQkJdG9wOiBzdGFydFBvc2l0aW9uLnRvcCAtIGZpeFRvcCwKCQkJCWxlZnQ6IHN0YXJ0UG9zaXRpb24ubGVmdCAtIGZpeExlZnQsCgkJCQloZWlnaHQ6IGVsZW0uaW5uZXJIZWlnaHQoKSwKCQkJCXdpZHRoOiBlbGVtLmlubmVyV2lkdGgoKSwKCQkJCXBvc2l0aW9uOiB0YXJnZXRGaXhlZCA/ICJmaXhlZCIgOiAiYWJzb2x1dGUiCgkJCX0pCgkJCS5hbmltYXRlKCBhbmltYXRpb24sIG8uZHVyYXRpb24sIG8uZWFzaW5nLCBmdW5jdGlvbigpIHsKCQkJCXRyYW5zZmVyLnJlbW92ZSgpOwoJCQkJZG9uZSgpOwoJCQl9KTsKfTsKCgovKiEKICogalF1ZXJ5IFVJIFByb2dyZXNzYmFyIDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL3Byb2dyZXNzYmFyLwogKi8KCgp2YXIgcHJvZ3Jlc3NiYXIgPSAkLndpZGdldCggInVpLnByb2dyZXNzYmFyIiwgewoJdmVyc2lvbjogIjEuMTEuMSIsCglvcHRpb25zOiB7CgkJbWF4OiAxMDAsCgkJdmFsdWU6IDAsCgoJCWNoYW5nZTogbnVsbCwKCQljb21wbGV0ZTogbnVsbAoJfSwKCgltaW46IDAsCgoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgkJLy8gQ29uc3RyYWluIGluaXRpYWwgdmFsdWUKCQl0aGlzLm9sZFZhbHVlID0gdGhpcy5vcHRpb25zLnZhbHVlID0gdGhpcy5fY29uc3RyYWluZWRWYWx1ZSgpOwoKCQl0aGlzLmVsZW1lbnQKCQkJLmFkZENsYXNzKCAidWktcHJvZ3Jlc3NiYXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiICkKCQkJLmF0dHIoewoJCQkJLy8gT25seSBzZXQgc3RhdGljIHZhbHVlcywgYXJpYS12YWx1ZW5vdyBhbmQgYXJpYS12YWx1ZW1heCBhcmUKCQkJCS8vIHNldCBpbnNpZGUgX3JlZnJlc2hWYWx1ZSgpCgkJCQlyb2xlOiAicHJvZ3Jlc3NiYXIiLAoJCQkJImFyaWEtdmFsdWVtaW4iOiB0aGlzLm1pbgoJCQl9KTsKCgkJdGhpcy52YWx1ZURpdiA9ICQoICI8ZGl2IGNsYXNzPSd1aS1wcm9ncmVzc2Jhci12YWx1ZSB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1sZWZ0Jz48L2Rpdj4iICkKCQkJLmFwcGVuZFRvKCB0aGlzLmVsZW1lbnQgKTsKCgkJdGhpcy5fcmVmcmVzaFZhbHVlKCk7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCAidWktcHJvZ3Jlc3NiYXIgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiICkKCQkJLnJlbW92ZUF0dHIoICJyb2xlIiApCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS12YWx1ZW1pbiIgKQoJCQkucmVtb3ZlQXR0ciggImFyaWEtdmFsdWVtYXgiICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLXZhbHVlbm93IiApOwoKCQl0aGlzLnZhbHVlRGl2LnJlbW92ZSgpOwoJfSwKCgl2YWx1ZTogZnVuY3Rpb24oIG5ld1ZhbHVlICkgewoJCWlmICggbmV3VmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCQkJcmV0dXJuIHRoaXMub3B0aW9ucy52YWx1ZTsKCQl9CgoJCXRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX2NvbnN0cmFpbmVkVmFsdWUoIG5ld1ZhbHVlICk7CgkJdGhpcy5fcmVmcmVzaFZhbHVlKCk7Cgl9LAoKCV9jb25zdHJhaW5lZFZhbHVlOiBmdW5jdGlvbiggbmV3VmFsdWUgKSB7CgkJaWYgKCBuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoJCQluZXdWYWx1ZSA9IHRoaXMub3B0aW9ucy52YWx1ZTsKCQl9CgoJCXRoaXMuaW5kZXRlcm1pbmF0ZSA9IG5ld1ZhbHVlID09PSBmYWxzZTsKCgkJLy8gc2FuaXRpemUgdmFsdWUKCQlpZiAoIHR5cGVvZiBuZXdWYWx1ZSAhPT0gIm51bWJlciIgKSB7CgkJCW5ld1ZhbHVlID0gMDsKCQl9CgoJCXJldHVybiB0aGlzLmluZGV0ZXJtaW5hdGUgPyBmYWxzZSA6CgkJCU1hdGgubWluKCB0aGlzLm9wdGlvbnMubWF4LCBNYXRoLm1heCggdGhpcy5taW4sIG5ld1ZhbHVlICkgKTsKCX0sCgoJX3NldE9wdGlvbnM6IGZ1bmN0aW9uKCBvcHRpb25zICkgewoJCS8vIEVuc3VyZSAidmFsdWUiIG9wdGlvbiBpcyBzZXQgYWZ0ZXIgb3RoZXIgdmFsdWVzIChsaWtlIG1heCkKCQl2YXIgdmFsdWUgPSBvcHRpb25zLnZhbHVlOwoJCWRlbGV0ZSBvcHRpb25zLnZhbHVlOwoKCQl0aGlzLl9zdXBlciggb3B0aW9ucyApOwoKCQl0aGlzLm9wdGlvbnMudmFsdWUgPSB0aGlzLl9jb25zdHJhaW5lZFZhbHVlKCB2YWx1ZSApOwoJCXRoaXMuX3JlZnJlc2hWYWx1ZSgpOwoJfSwKCglfc2V0T3B0aW9uOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQlpZiAoIGtleSA9PT0gIm1heCIgKSB7CgkJCS8vIERvbid0IGFsbG93IGEgbWF4IGxlc3MgdGhhbiBtaW4KCQkJdmFsdWUgPSBNYXRoLm1heCggdGhpcy5taW4sIHZhbHVlICk7CgkJfQoJCWlmICgga2V5ID09PSAiZGlzYWJsZWQiICkgewoJCQl0aGlzLmVsZW1lbnQKCQkJCS50b2dnbGVDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiwgISF2YWx1ZSApCgkJCQkuYXR0ciggImFyaWEtZGlzYWJsZWQiLCB2YWx1ZSApOwoJCX0KCQl0aGlzLl9zdXBlcigga2V5LCB2YWx1ZSApOwoJfSwKCglfcGVyY2VudGFnZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuaW5kZXRlcm1pbmF0ZSA/IDEwMCA6IDEwMCAqICggdGhpcy5vcHRpb25zLnZhbHVlIC0gdGhpcy5taW4gKSAvICggdGhpcy5vcHRpb25zLm1heCAtIHRoaXMubWluICk7Cgl9LAoKCV9yZWZyZXNoVmFsdWU6IGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZSA9IHRoaXMub3B0aW9ucy52YWx1ZSwKCQkJcGVyY2VudGFnZSA9IHRoaXMuX3BlcmNlbnRhZ2UoKTsKCgkJdGhpcy52YWx1ZURpdgoJCQkudG9nZ2xlKCB0aGlzLmluZGV0ZXJtaW5hdGUgfHwgdmFsdWUgPiB0aGlzLm1pbiApCgkJCS50b2dnbGVDbGFzcyggInVpLWNvcm5lci1yaWdodCIsIHZhbHVlID09PSB0aGlzLm9wdGlvbnMubWF4ICkKCQkJLndpZHRoKCBwZXJjZW50YWdlLnRvRml4ZWQoMCkgKyAiJSIgKTsKCgkJdGhpcy5lbGVtZW50LnRvZ2dsZUNsYXNzKCAidWktcHJvZ3Jlc3NiYXItaW5kZXRlcm1pbmF0ZSIsIHRoaXMuaW5kZXRlcm1pbmF0ZSApOwoKCQlpZiAoIHRoaXMuaW5kZXRlcm1pbmF0ZSApIHsKCQkJdGhpcy5lbGVtZW50LnJlbW92ZUF0dHIoICJhcmlhLXZhbHVlbm93IiApOwoJCQlpZiAoICF0aGlzLm92ZXJsYXlEaXYgKSB7CgkJCQl0aGlzLm92ZXJsYXlEaXYgPSAkKCAiPGRpdiBjbGFzcz0ndWktcHJvZ3Jlc3NiYXItb3ZlcmxheSc+PC9kaXY+IiApLmFwcGVuZFRvKCB0aGlzLnZhbHVlRGl2ICk7CgkJCX0KCQl9IGVsc2UgewoJCQl0aGlzLmVsZW1lbnQuYXR0cih7CgkJCQkiYXJpYS12YWx1ZW1heCI6IHRoaXMub3B0aW9ucy5tYXgsCgkJCQkiYXJpYS12YWx1ZW5vdyI6IHZhbHVlCgkJCX0pOwoJCQlpZiAoIHRoaXMub3ZlcmxheURpdiApIHsKCQkJCXRoaXMub3ZlcmxheURpdi5yZW1vdmUoKTsKCQkJCXRoaXMub3ZlcmxheURpdiA9IG51bGw7CgkJCX0KCQl9CgoJCWlmICggdGhpcy5vbGRWYWx1ZSAhPT0gdmFsdWUgKSB7CgkJCXRoaXMub2xkVmFsdWUgPSB2YWx1ZTsKCQkJdGhpcy5fdHJpZ2dlciggImNoYW5nZSIgKTsKCQl9CgkJaWYgKCB2YWx1ZSA9PT0gdGhpcy5vcHRpb25zLm1heCApIHsKCQkJdGhpcy5fdHJpZ2dlciggImNvbXBsZXRlIiApOwoJCX0KCX0KfSk7CgoKLyohCiAqIGpRdWVyeSBVSSBTZWxlY3RhYmxlIDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL3NlbGVjdGFibGUvCiAqLwoKCnZhciBzZWxlY3RhYmxlID0gJC53aWRnZXQoInVpLnNlbGVjdGFibGUiLCAkLnVpLm1vdXNlLCB7Cgl2ZXJzaW9uOiAiMS4xMS4xIiwKCW9wdGlvbnM6IHsKCQlhcHBlbmRUbzogImJvZHkiLAoJCWF1dG9SZWZyZXNoOiB0cnVlLAoJCWRpc3RhbmNlOiAwLAoJCWZpbHRlcjogIioiLAoJCXRvbGVyYW5jZTogInRvdWNoIiwKCgkJLy8gY2FsbGJhY2tzCgkJc2VsZWN0ZWQ6IG51bGwsCgkJc2VsZWN0aW5nOiBudWxsLAoJCXN0YXJ0OiBudWxsLAoJCXN0b3A6IG51bGwsCgkJdW5zZWxlY3RlZDogbnVsbCwKCQl1bnNlbGVjdGluZzogbnVsbAoJfSwKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoJCXZhciBzZWxlY3RlZXMsCgkJCXRoYXQgPSB0aGlzOwoKCQl0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLXNlbGVjdGFibGUiKTsKCgkJdGhpcy5kcmFnZ2VkID0gZmFsc2U7CgoJCS8vIGNhY2hlIHNlbGVjdGVlIGNoaWxkcmVuIGJhc2VkIG9uIGZpbHRlcgoJCXRoaXMucmVmcmVzaCA9IGZ1bmN0aW9uKCkgewoJCQlzZWxlY3RlZXMgPSAkKHRoYXQub3B0aW9ucy5maWx0ZXIsIHRoYXQuZWxlbWVudFswXSk7CgkJCXNlbGVjdGVlcy5hZGRDbGFzcygidWktc2VsZWN0ZWUiKTsKCQkJc2VsZWN0ZWVzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQl2YXIgJHRoaXMgPSAkKHRoaXMpLAoJCQkJCXBvcyA9ICR0aGlzLm9mZnNldCgpOwoJCQkJJC5kYXRhKHRoaXMsICJzZWxlY3RhYmxlLWl0ZW0iLCB7CgkJCQkJZWxlbWVudDogdGhpcywKCQkJCQkkZWxlbWVudDogJHRoaXMsCgkJCQkJbGVmdDogcG9zLmxlZnQsCgkJCQkJdG9wOiBwb3MudG9wLAoJCQkJCXJpZ2h0OiBwb3MubGVmdCArICR0aGlzLm91dGVyV2lkdGgoKSwKCQkJCQlib3R0b206IHBvcy50b3AgKyAkdGhpcy5vdXRlckhlaWdodCgpLAoJCQkJCXN0YXJ0c2VsZWN0ZWQ6IGZhbHNlLAoJCQkJCXNlbGVjdGVkOiAkdGhpcy5oYXNDbGFzcygidWktc2VsZWN0ZWQiKSwKCQkJCQlzZWxlY3Rpbmc6ICR0aGlzLmhhc0NsYXNzKCJ1aS1zZWxlY3RpbmciKSwKCQkJCQl1bnNlbGVjdGluZzogJHRoaXMuaGFzQ2xhc3MoInVpLXVuc2VsZWN0aW5nIikKCQkJCX0pOwoJCQl9KTsKCQl9OwoJCXRoaXMucmVmcmVzaCgpOwoKCQl0aGlzLnNlbGVjdGVlcyA9IHNlbGVjdGVlcy5hZGRDbGFzcygidWktc2VsZWN0ZWUiKTsKCgkJdGhpcy5fbW91c2VJbml0KCk7CgoJCXRoaXMuaGVscGVyID0gJCgiPGRpdiBjbGFzcz0ndWktc2VsZWN0YWJsZS1oZWxwZXInPjwvZGl2PiIpOwoJfSwKCglfZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJdGhpcy5zZWxlY3RlZXMKCQkJLnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RlZSIpCgkJCS5yZW1vdmVEYXRhKCJzZWxlY3RhYmxlLWl0ZW0iKTsKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RhYmxlIHVpLXNlbGVjdGFibGUtZGlzYWJsZWQiKTsKCQl0aGlzLl9tb3VzZURlc3Ryb3koKTsKCX0sCgoJX21vdXNlU3RhcnQ6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlvcHRpb25zID0gdGhpcy5vcHRpb25zOwoKCQl0aGlzLm9wb3MgPSBbIGV2ZW50LnBhZ2VYLCBldmVudC5wYWdlWSBdOwoKCQlpZiAodGhpcy5vcHRpb25zLmRpc2FibGVkKSB7CgkJCXJldHVybjsKCQl9CgoJCXRoaXMuc2VsZWN0ZWVzID0gJChvcHRpb25zLmZpbHRlciwgdGhpcy5lbGVtZW50WzBdKTsKCgkJdGhpcy5fdHJpZ2dlcigic3RhcnQiLCBldmVudCk7CgoJCSQob3B0aW9ucy5hcHBlbmRUbykuYXBwZW5kKHRoaXMuaGVscGVyKTsKCQkvLyBwb3NpdGlvbiBoZWxwZXIgKGxhc3NvKQoJCXRoaXMuaGVscGVyLmNzcyh7CgkJCSJsZWZ0IjogZXZlbnQucGFnZVgsCgkJCSJ0b3AiOiBldmVudC5wYWdlWSwKCQkJIndpZHRoIjogMCwKCQkJImhlaWdodCI6IDAKCQl9KTsKCgkJaWYgKG9wdGlvbnMuYXV0b1JlZnJlc2gpIHsKCQkJdGhpcy5yZWZyZXNoKCk7CgkJfQoKCQl0aGlzLnNlbGVjdGVlcy5maWx0ZXIoIi51aS1zZWxlY3RlZCIpLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBzZWxlY3RlZSA9ICQuZGF0YSh0aGlzLCAic2VsZWN0YWJsZS1pdGVtIik7CgkJCXNlbGVjdGVlLnN0YXJ0c2VsZWN0ZWQgPSB0cnVlOwoJCQlpZiAoIWV2ZW50Lm1ldGFLZXkgJiYgIWV2ZW50LmN0cmxLZXkpIHsKCQkJCXNlbGVjdGVlLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RlZCIpOwoJCQkJc2VsZWN0ZWUuc2VsZWN0ZWQgPSBmYWxzZTsKCQkJCXNlbGVjdGVlLiRlbGVtZW50LmFkZENsYXNzKCJ1aS11bnNlbGVjdGluZyIpOwoJCQkJc2VsZWN0ZWUudW5zZWxlY3RpbmcgPSB0cnVlOwoJCQkJLy8gc2VsZWN0YWJsZSBVTlNFTEVDVElORyBjYWxsYmFjawoJCQkJdGhhdC5fdHJpZ2dlcigidW5zZWxlY3RpbmciLCBldmVudCwgewoJCQkJCXVuc2VsZWN0aW5nOiBzZWxlY3RlZS5lbGVtZW50CgkJCQl9KTsKCQkJfQoJCX0pOwoKCQkkKGV2ZW50LnRhcmdldCkucGFyZW50cygpLmFkZEJhY2soKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgZG9TZWxlY3QsCgkJCQlzZWxlY3RlZSA9ICQuZGF0YSh0aGlzLCAic2VsZWN0YWJsZS1pdGVtIik7CgkJCWlmIChzZWxlY3RlZSkgewoJCQkJZG9TZWxlY3QgPSAoIWV2ZW50Lm1ldGFLZXkgJiYgIWV2ZW50LmN0cmxLZXkpIHx8ICFzZWxlY3RlZS4kZWxlbWVudC5oYXNDbGFzcygidWktc2VsZWN0ZWQiKTsKCQkJCXNlbGVjdGVlLiRlbGVtZW50CgkJCQkJLnJlbW92ZUNsYXNzKGRvU2VsZWN0ID8gInVpLXVuc2VsZWN0aW5nIiA6ICJ1aS1zZWxlY3RlZCIpCgkJCQkJLmFkZENsYXNzKGRvU2VsZWN0ID8gInVpLXNlbGVjdGluZyIgOiAidWktdW5zZWxlY3RpbmciKTsKCQkJCXNlbGVjdGVlLnVuc2VsZWN0aW5nID0gIWRvU2VsZWN0OwoJCQkJc2VsZWN0ZWUuc2VsZWN0aW5nID0gZG9TZWxlY3Q7CgkJCQlzZWxlY3RlZS5zZWxlY3RlZCA9IGRvU2VsZWN0OwoJCQkJLy8gc2VsZWN0YWJsZSAoVU4pU0VMRUNUSU5HIGNhbGxiYWNrCgkJCQlpZiAoZG9TZWxlY3QpIHsKCQkJCQl0aGF0Ll90cmlnZ2VyKCJzZWxlY3RpbmciLCBldmVudCwgewoJCQkJCQlzZWxlY3Rpbmc6IHNlbGVjdGVlLmVsZW1lbnQKCQkJCQl9KTsKCQkJCX0gZWxzZSB7CgkJCQkJdGhhdC5fdHJpZ2dlcigidW5zZWxlY3RpbmciLCBldmVudCwgewoJCQkJCQl1bnNlbGVjdGluZzogc2VsZWN0ZWUuZWxlbWVudAoJCQkJCX0pOwoJCQkJfQoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSk7CgoJfSwKCglfbW91c2VEcmFnOiBmdW5jdGlvbihldmVudCkgewoKCQl0aGlzLmRyYWdnZWQgPSB0cnVlOwoKCQlpZiAodGhpcy5vcHRpb25zLmRpc2FibGVkKSB7CgkJCXJldHVybjsKCQl9CgoJCXZhciB0bXAsCgkJCXRoYXQgPSB0aGlzLAoJCQlvcHRpb25zID0gdGhpcy5vcHRpb25zLAoJCQl4MSA9IHRoaXMub3Bvc1swXSwKCQkJeTEgPSB0aGlzLm9wb3NbMV0sCgkJCXgyID0gZXZlbnQucGFnZVgsCgkJCXkyID0gZXZlbnQucGFnZVk7CgoJCWlmICh4MSA+IHgyKSB7IHRtcCA9IHgyOyB4MiA9IHgxOyB4MSA9IHRtcDsgfQoJCWlmICh5MSA+IHkyKSB7IHRtcCA9IHkyOyB5MiA9IHkxOyB5MSA9IHRtcDsgfQoJCXRoaXMuaGVscGVyLmNzcyh7IGxlZnQ6IHgxLCB0b3A6IHkxLCB3aWR0aDogeDIgLSB4MSwgaGVpZ2h0OiB5MiAtIHkxIH0pOwoKCQl0aGlzLnNlbGVjdGVlcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgc2VsZWN0ZWUgPSAkLmRhdGEodGhpcywgInNlbGVjdGFibGUtaXRlbSIpLAoJCQkJaGl0ID0gZmFsc2U7CgoJCQkvL3ByZXZlbnQgaGVscGVyIGZyb20gYmVpbmcgc2VsZWN0ZWQgaWYgYXBwZW5kVG86IHNlbGVjdGFibGUKCQkJaWYgKCFzZWxlY3RlZSB8fCBzZWxlY3RlZS5lbGVtZW50ID09PSB0aGF0LmVsZW1lbnRbMF0pIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYgKG9wdGlvbnMudG9sZXJhbmNlID09PSAidG91Y2giKSB7CgkJCQloaXQgPSAoICEoc2VsZWN0ZWUubGVmdCA+IHgyIHx8IHNlbGVjdGVlLnJpZ2h0IDwgeDEgfHwgc2VsZWN0ZWUudG9wID4geTIgfHwgc2VsZWN0ZWUuYm90dG9tIDwgeTEpICk7CgkJCX0gZWxzZSBpZiAob3B0aW9ucy50b2xlcmFuY2UgPT09ICJmaXQiKSB7CgkJCQloaXQgPSAoc2VsZWN0ZWUubGVmdCA+IHgxICYmIHNlbGVjdGVlLnJpZ2h0IDwgeDIgJiYgc2VsZWN0ZWUudG9wID4geTEgJiYgc2VsZWN0ZWUuYm90dG9tIDwgeTIpOwoJCQl9CgoJCQlpZiAoaGl0KSB7CgkJCQkvLyBTRUxFQ1QKCQkJCWlmIChzZWxlY3RlZS5zZWxlY3RlZCkgewoJCQkJCXNlbGVjdGVlLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RlZCIpOwoJCQkJCXNlbGVjdGVlLnNlbGVjdGVkID0gZmFsc2U7CgkJCQl9CgkJCQlpZiAoc2VsZWN0ZWUudW5zZWxlY3RpbmcpIHsKCQkJCQlzZWxlY3RlZS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktdW5zZWxlY3RpbmciKTsKCQkJCQlzZWxlY3RlZS51bnNlbGVjdGluZyA9IGZhbHNlOwoJCQkJfQoJCQkJaWYgKCFzZWxlY3RlZS5zZWxlY3RpbmcpIHsKCQkJCQlzZWxlY3RlZS4kZWxlbWVudC5hZGRDbGFzcygidWktc2VsZWN0aW5nIik7CgkJCQkJc2VsZWN0ZWUuc2VsZWN0aW5nID0gdHJ1ZTsKCQkJCQkvLyBzZWxlY3RhYmxlIFNFTEVDVElORyBjYWxsYmFjawoJCQkJCXRoYXQuX3RyaWdnZXIoInNlbGVjdGluZyIsIGV2ZW50LCB7CgkJCQkJCXNlbGVjdGluZzogc2VsZWN0ZWUuZWxlbWVudAoJCQkJCX0pOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJLy8gVU5TRUxFQ1QKCQkJCWlmIChzZWxlY3RlZS5zZWxlY3RpbmcpIHsKCQkJCQlpZiAoKGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuY3RybEtleSkgJiYgc2VsZWN0ZWUuc3RhcnRzZWxlY3RlZCkgewoJCQkJCQlzZWxlY3RlZS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0aW5nIik7CgkJCQkJCXNlbGVjdGVlLnNlbGVjdGluZyA9IGZhbHNlOwoJCQkJCQlzZWxlY3RlZS4kZWxlbWVudC5hZGRDbGFzcygidWktc2VsZWN0ZWQiKTsKCQkJCQkJc2VsZWN0ZWUuc2VsZWN0ZWQgPSB0cnVlOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXNlbGVjdGVlLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RpbmciKTsKCQkJCQkJc2VsZWN0ZWUuc2VsZWN0aW5nID0gZmFsc2U7CgkJCQkJCWlmIChzZWxlY3RlZS5zdGFydHNlbGVjdGVkKSB7CgkJCQkJCQlzZWxlY3RlZS4kZWxlbWVudC5hZGRDbGFzcygidWktdW5zZWxlY3RpbmciKTsKCQkJCQkJCXNlbGVjdGVlLnVuc2VsZWN0aW5nID0gdHJ1ZTsKCQkJCQkJfQoJCQkJCQkvLyBzZWxlY3RhYmxlIFVOU0VMRUNUSU5HIGNhbGxiYWNrCgkJCQkJCXRoYXQuX3RyaWdnZXIoInVuc2VsZWN0aW5nIiwgZXZlbnQsIHsKCQkJCQkJCXVuc2VsZWN0aW5nOiBzZWxlY3RlZS5lbGVtZW50CgkJCQkJCX0pOwoJCQkJCX0KCQkJCX0KCQkJCWlmIChzZWxlY3RlZS5zZWxlY3RlZCkgewoJCQkJCWlmICghZXZlbnQubWV0YUtleSAmJiAhZXZlbnQuY3RybEtleSAmJiAhc2VsZWN0ZWUuc3RhcnRzZWxlY3RlZCkgewoJCQkJCQlzZWxlY3RlZS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0ZWQiKTsKCQkJCQkJc2VsZWN0ZWUuc2VsZWN0ZWQgPSBmYWxzZTsKCgkJCQkJCXNlbGVjdGVlLiRlbGVtZW50LmFkZENsYXNzKCJ1aS11bnNlbGVjdGluZyIpOwoJCQkJCQlzZWxlY3RlZS51bnNlbGVjdGluZyA9IHRydWU7CgkJCQkJCS8vIHNlbGVjdGFibGUgVU5TRUxFQ1RJTkcgY2FsbGJhY2sKCQkJCQkJdGhhdC5fdHJpZ2dlcigidW5zZWxlY3RpbmciLCBldmVudCwgewoJCQkJCQkJdW5zZWxlY3Rpbmc6IHNlbGVjdGVlLmVsZW1lbnQKCQkJCQkJfSk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfSk7CgoJCXJldHVybiBmYWxzZTsKCX0sCgoJX21vdXNlU3RvcDogZnVuY3Rpb24oZXZlbnQpIHsKCQl2YXIgdGhhdCA9IHRoaXM7CgoJCXRoaXMuZHJhZ2dlZCA9IGZhbHNlOwoKCQkkKCIudWktdW5zZWxlY3RpbmciLCB0aGlzLmVsZW1lbnRbMF0pLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBzZWxlY3RlZSA9ICQuZGF0YSh0aGlzLCAic2VsZWN0YWJsZS1pdGVtIik7CgkJCXNlbGVjdGVlLiRlbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS11bnNlbGVjdGluZyIpOwoJCQlzZWxlY3RlZS51bnNlbGVjdGluZyA9IGZhbHNlOwoJCQlzZWxlY3RlZS5zdGFydHNlbGVjdGVkID0gZmFsc2U7CgkJCXRoYXQuX3RyaWdnZXIoInVuc2VsZWN0ZWQiLCBldmVudCwgewoJCQkJdW5zZWxlY3RlZDogc2VsZWN0ZWUuZWxlbWVudAoJCQl9KTsKCQl9KTsKCQkkKCIudWktc2VsZWN0aW5nIiwgdGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgc2VsZWN0ZWUgPSAkLmRhdGEodGhpcywgInNlbGVjdGFibGUtaXRlbSIpOwoJCQlzZWxlY3RlZS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0aW5nIikuYWRkQ2xhc3MoInVpLXNlbGVjdGVkIik7CgkJCXNlbGVjdGVlLnNlbGVjdGluZyA9IGZhbHNlOwoJCQlzZWxlY3RlZS5zZWxlY3RlZCA9IHRydWU7CgkJCXNlbGVjdGVlLnN0YXJ0c2VsZWN0ZWQgPSB0cnVlOwoJCQl0aGF0Ll90cmlnZ2VyKCJzZWxlY3RlZCIsIGV2ZW50LCB7CgkJCQlzZWxlY3RlZDogc2VsZWN0ZWUuZWxlbWVudAoJCQl9KTsKCQl9KTsKCQl0aGlzLl90cmlnZ2VyKCJzdG9wIiwgZXZlbnQpOwoKCQl0aGlzLmhlbHBlci5yZW1vdmUoKTsKCgkJcmV0dXJuIGZhbHNlOwoJfQoKfSk7CgoKLyohCiAqIGpRdWVyeSBVSSBTZWxlY3RtZW51IDEuMTEuMQogKiBodHRwOi8vanF1ZXJ5dWkuY29tCiAqCiAqIENvcHlyaWdodCAyMDE0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIGh0dHA6Ly9hcGkuanF1ZXJ5dWkuY29tL3NlbGVjdG1lbnUKICovCgoKdmFyIHNlbGVjdG1lbnUgPSAkLndpZGdldCggInVpLnNlbGVjdG1lbnUiLCB7Cgl2ZXJzaW9uOiAiMS4xMS4xIiwKCWRlZmF1bHRFbGVtZW50OiAiPHNlbGVjdD4iLAoJb3B0aW9uczogewoJCWFwcGVuZFRvOiBudWxsLAoJCWRpc2FibGVkOiBudWxsLAoJCWljb25zOiB7CgkJCWJ1dHRvbjogInVpLWljb24tdHJpYW5nbGUtMS1zIgoJCX0sCgkJcG9zaXRpb246IHsKCQkJbXk6ICJsZWZ0IHRvcCIsCgkJCWF0OiAibGVmdCBib3R0b20iLAoJCQljb2xsaXNpb246ICJub25lIgoJCX0sCgkJd2lkdGg6IG51bGwsCgoJCS8vIGNhbGxiYWNrcwoJCWNoYW5nZTogbnVsbCwKCQljbG9zZTogbnVsbCwKCQlmb2N1czogbnVsbCwKCQlvcGVuOiBudWxsLAoJCXNlbGVjdDogbnVsbAoJfSwKCglfY3JlYXRlOiBmdW5jdGlvbigpIHsKCQl2YXIgc2VsZWN0bWVudUlkID0gdGhpcy5lbGVtZW50LnVuaXF1ZUlkKCkuYXR0ciggImlkIiApOwoJCXRoaXMuaWRzID0gewoJCQllbGVtZW50OiBzZWxlY3RtZW51SWQsCgkJCWJ1dHRvbjogc2VsZWN0bWVudUlkICsgIi1idXR0b24iLAoJCQltZW51OiBzZWxlY3RtZW51SWQgKyAiLW1lbnUiCgkJfTsKCgkJdGhpcy5fZHJhd0J1dHRvbigpOwoJCXRoaXMuX2RyYXdNZW51KCk7CgoJCWlmICggdGhpcy5vcHRpb25zLmRpc2FibGVkICkgewoJCQl0aGlzLmRpc2FibGUoKTsKCQl9Cgl9LAoKCV9kcmF3QnV0dG9uOiBmdW5jdGlvbigpIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCXRhYmluZGV4ID0gdGhpcy5lbGVtZW50LmF0dHIoICJ0YWJpbmRleCIgKTsKCgkJLy8gQXNzb2NpYXRlIGV4aXN0aW5nIGxhYmVsIHdpdGggdGhlIG5ldyBidXR0b24KCQl0aGlzLmxhYmVsID0gJCggImxhYmVsW2Zvcj0nIiArIHRoaXMuaWRzLmVsZW1lbnQgKyAiJ10iICkuYXR0ciggImZvciIsIHRoaXMuaWRzLmJ1dHRvbiApOwoJCXRoaXMuX29uKCB0aGlzLmxhYmVsLCB7CgkJCWNsaWNrOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQl0aGlzLmJ1dHRvbi5mb2N1cygpOwoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJfQoJCX0pOwoKCQkvLyBIaWRlIG9yaWdpbmFsIHNlbGVjdCBlbGVtZW50CgkJdGhpcy5lbGVtZW50LmhpZGUoKTsKCgkJLy8gQ3JlYXRlIGJ1dHRvbgoJCXRoaXMuYnV0dG9uID0gJCggIjxzcGFuPiIsIHsKCQkJImNsYXNzIjogInVpLXNlbGVjdG1lbnUtYnV0dG9uIHVpLXdpZGdldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiLAoJCQl0YWJpbmRleDogdGFiaW5kZXggfHwgdGhpcy5vcHRpb25zLmRpc2FibGVkID8gLTEgOiAwLAoJCQlpZDogdGhpcy5pZHMuYnV0dG9uLAoJCQlyb2xlOiAiY29tYm9ib3giLAoJCQkiYXJpYS1leHBhbmRlZCI6ICJmYWxzZSIsCgkJCSJhcmlhLWF1dG9jb21wbGV0ZSI6ICJsaXN0IiwKCQkJImFyaWEtb3ducyI6IHRoaXMuaWRzLm1lbnUsCgkJCSJhcmlhLWhhc3BvcHVwIjogInRydWUiCgkJfSkKCQkJLmluc2VydEFmdGVyKCB0aGlzLmVsZW1lbnQgKTsKCgkJJCggIjxzcGFuPiIsIHsKCQkJImNsYXNzIjogInVpLWljb24gIiArIHRoaXMub3B0aW9ucy5pY29ucy5idXR0b24KCQl9KQoJCQkucHJlcGVuZFRvKCB0aGlzLmJ1dHRvbiApOwoKCQl0aGlzLmJ1dHRvblRleHQgPSAkKCAiPHNwYW4+IiwgewoJCQkiY2xhc3MiOiAidWktc2VsZWN0bWVudS10ZXh0IgoJCX0pCgkJCS5hcHBlbmRUbyggdGhpcy5idXR0b24gKTsKCgkJdGhpcy5fc2V0VGV4dCggdGhpcy5idXR0b25UZXh0LCB0aGlzLmVsZW1lbnQuZmluZCggIm9wdGlvbjpzZWxlY3RlZCIgKS50ZXh0KCkgKTsKCQl0aGlzLl9yZXNpemVCdXR0b24oKTsKCgkJdGhpcy5fb24oIHRoaXMuYnV0dG9uLCB0aGlzLl9idXR0b25FdmVudHMgKTsKCQl0aGlzLmJ1dHRvbi5vbmUoICJmb2N1c2luIiwgZnVuY3Rpb24oKSB7CgoJCQkvLyBEZWxheSByZW5kZXJpbmcgdGhlIG1lbnUgaXRlbXMgdW50aWwgdGhlIGJ1dHRvbiByZWNlaXZlcyBmb2N1cy4KCQkJLy8gVGhlIG1lbnUgbWF5IGhhdmUgYWxyZWFkeSBiZWVuIHJlbmRlcmVkIHZpYSBhIHByb2dyYW1tYXRpYyBvcGVuLgoJCQlpZiAoICF0aGF0Lm1lbnVJdGVtcyApIHsKCQkJCXRoYXQuX3JlZnJlc2hNZW51KCk7CgkJCX0KCQl9KTsKCQl0aGlzLl9ob3ZlcmFibGUoIHRoaXMuYnV0dG9uICk7CgkJdGhpcy5fZm9jdXNhYmxlKCB0aGlzLmJ1dHRvbiApOwoJfSwKCglfZHJhd01lbnU6IGZ1bmN0aW9uKCkgewoJCXZhciB0aGF0ID0gdGhpczsKCgkJLy8gQ3JlYXRlIG1lbnUKCQl0aGlzLm1lbnUgPSAkKCAiPHVsPiIsIHsKCQkJImFyaWEtaGlkZGVuIjogInRydWUiLAoJCQkiYXJpYS1sYWJlbGxlZGJ5IjogdGhpcy5pZHMuYnV0dG9uLAoJCQlpZDogdGhpcy5pZHMubWVudQoJCX0pOwoKCQkvLyBXcmFwIG1lbnUKCQl0aGlzLm1lbnVXcmFwID0gJCggIjxkaXY+IiwgewoJCQkiY2xhc3MiOiAidWktc2VsZWN0bWVudS1tZW51IHVpLWZyb250IgoJCX0pCgkJCS5hcHBlbmQoIHRoaXMubWVudSApCgkJCS5hcHBlbmRUbyggdGhpcy5fYXBwZW5kVG8oKSApOwoKCQkvLyBJbml0aWFsaXplIG1lbnUgd2lkZ2V0CgkJdGhpcy5tZW51SW5zdGFuY2UgPSB0aGlzLm1lbnUKCQkJLm1lbnUoewoJCQkJcm9sZTogImxpc3Rib3giLAoJCQkJc2VsZWN0OiBmdW5jdGlvbiggZXZlbnQsIHVpICkgewoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQkJdGhhdC5fc2VsZWN0KCB1aS5pdGVtLmRhdGEoICJ1aS1zZWxlY3RtZW51LWl0ZW0iICksIGV2ZW50ICk7CgkJCQl9LAoJCQkJZm9jdXM6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7CgkJCQkJdmFyIGl0ZW0gPSB1aS5pdGVtLmRhdGEoICJ1aS1zZWxlY3RtZW51LWl0ZW0iICk7CgoJCQkJCS8vIFByZXZlbnQgaW5pdGFsIGZvY3VzIGZyb20gZmlyaW5nIGFuZCBjaGVjayBpZiBpdHMgYSBuZXdseSBmb2N1c2VkIGl0ZW0KCQkJCQlpZiAoIHRoYXQuZm9jdXNJbmRleCAhPSBudWxsICYmIGl0ZW0uaW5kZXggIT09IHRoYXQuZm9jdXNJbmRleCApIHsKCQkJCQkJdGhhdC5fdHJpZ2dlciggImZvY3VzIiwgZXZlbnQsIHsgaXRlbTogaXRlbSB9ICk7CgkJCQkJCWlmICggIXRoYXQuaXNPcGVuICkgewoJCQkJCQkJdGhhdC5fc2VsZWN0KCBpdGVtLCBldmVudCApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXRoYXQuZm9jdXNJbmRleCA9IGl0ZW0uaW5kZXg7CgoJCQkJCXRoYXQuYnV0dG9uLmF0dHIoICJhcmlhLWFjdGl2ZWRlc2NlbmRhbnQiLAoJCQkJCQl0aGF0Lm1lbnVJdGVtcy5lcSggaXRlbS5pbmRleCApLmF0dHIoICJpZCIgKSApOwoJCQkJfQoJCQl9KQoJCQkubWVudSggImluc3RhbmNlIiApOwoKCQkvLyBBZGp1c3QgbWVudSBzdHlsZXMgdG8gZHJvcGRvd24KCQl0aGlzLm1lbnUKCQkJLmFkZENsYXNzKCAidWktY29ybmVyLWJvdHRvbSIgKQoJCQkucmVtb3ZlQ2xhc3MoICJ1aS1jb3JuZXItYWxsIiApOwoKCQkvLyBEb24ndCBjbG9zZSB0aGUgbWVudSBvbiBtb3VzZWxlYXZlCgkJdGhpcy5tZW51SW5zdGFuY2UuX29mZiggdGhpcy5tZW51LCAibW91c2VsZWF2ZSIgKTsKCgkJLy8gQ2FuY2VsIHRoZSBtZW51J3MgY29sbGFwc2VBbGwgb24gZG9jdW1lbnQgY2xpY2sKCQl0aGlzLm1lbnVJbnN0YW5jZS5fY2xvc2VPbkRvY3VtZW50Q2xpY2sgPSBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX07CgoJCS8vIFNlbGVjdHMgb2Z0ZW4gY29udGFpbiBlbXB0eSBpdGVtcywgYnV0IG5ldmVyIGNvbnRhaW4gZGl2aWRlcnMKCQl0aGlzLm1lbnVJbnN0YW5jZS5faXNEaXZpZGVyID0gZnVuY3Rpb24oKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9OwoJfSwKCglyZWZyZXNoOiBmdW5jdGlvbigpIHsKCQl0aGlzLl9yZWZyZXNoTWVudSgpOwoJCXRoaXMuX3NldFRleHQoIHRoaXMuYnV0dG9uVGV4dCwgdGhpcy5fZ2V0U2VsZWN0ZWRJdGVtKCkudGV4dCgpICk7CgkJaWYgKCAhdGhpcy5vcHRpb25zLndpZHRoICkgewoJCQl0aGlzLl9yZXNpemVCdXR0b24oKTsKCQl9Cgl9LAoKCV9yZWZyZXNoTWVudTogZnVuY3Rpb24oKSB7CgkJdGhpcy5tZW51LmVtcHR5KCk7CgoJCXZhciBpdGVtLAoJCQlvcHRpb25zID0gdGhpcy5lbGVtZW50LmZpbmQoICJvcHRpb24iICk7CgoJCWlmICggIW9wdGlvbnMubGVuZ3RoICkgewoJCQlyZXR1cm47CgkJfQoKCQl0aGlzLl9wYXJzZU9wdGlvbnMoIG9wdGlvbnMgKTsKCQl0aGlzLl9yZW5kZXJNZW51KCB0aGlzLm1lbnUsIHRoaXMuaXRlbXMgKTsKCgkJdGhpcy5tZW51SW5zdGFuY2UucmVmcmVzaCgpOwoJCXRoaXMubWVudUl0ZW1zID0gdGhpcy5tZW51LmZpbmQoICJsaSIgKS5ub3QoICIudWktc2VsZWN0bWVudS1vcHRncm91cCIgKTsKCgkJaXRlbSA9IHRoaXMuX2dldFNlbGVjdGVkSXRlbSgpOwoKCQkvLyBVcGRhdGUgdGhlIG1lbnUgdG8gaGF2ZSB0aGUgY29ycmVjdCBpdGVtIGZvY3VzZWQKCQl0aGlzLm1lbnVJbnN0YW5jZS5mb2N1cyggbnVsbCwgaXRlbSApOwoJCXRoaXMuX3NldEFyaWEoIGl0ZW0uZGF0YSggInVpLXNlbGVjdG1lbnUtaXRlbSIgKSApOwoKCQkvLyBTZXQgZGlzYWJsZWQgc3RhdGUKCQl0aGlzLl9zZXRPcHRpb24oICJkaXNhYmxlZCIsIHRoaXMuZWxlbWVudC5wcm9wKCAiZGlzYWJsZWQiICkgKTsKCX0sCgoJb3BlbjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCWlmICggdGhpcy5vcHRpb25zLmRpc2FibGVkICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBJZiB0aGlzIGlzIHRoZSBmaXJzdCB0aW1lIHRoZSBtZW51IGlzIGJlaW5nIG9wZW5lZCwgcmVuZGVyIHRoZSBpdGVtcwoJCWlmICggIXRoaXMubWVudUl0ZW1zICkgewoJCQl0aGlzLl9yZWZyZXNoTWVudSgpOwoJCX0gZWxzZSB7CgoJCQkvLyBNZW51IGNsZWFycyBmb2N1cyBvbiBjbG9zZSwgcmVzZXQgZm9jdXMgdG8gc2VsZWN0ZWQgaXRlbQoJCQl0aGlzLm1lbnUuZmluZCggIi51aS1zdGF0ZS1mb2N1cyIgKS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWZvY3VzIiApOwoJCQl0aGlzLm1lbnVJbnN0YW5jZS5mb2N1cyggbnVsbCwgdGhpcy5fZ2V0U2VsZWN0ZWRJdGVtKCkgKTsKCQl9CgoJCXRoaXMuaXNPcGVuID0gdHJ1ZTsKCQl0aGlzLl90b2dnbGVBdHRyKCk7CgkJdGhpcy5fcmVzaXplTWVudSgpOwoJCXRoaXMuX3Bvc2l0aW9uKCk7CgoJCXRoaXMuX29uKCB0aGlzLmRvY3VtZW50LCB0aGlzLl9kb2N1bWVudENsaWNrICk7CgoJCXRoaXMuX3RyaWdnZXIoICJvcGVuIiwgZXZlbnQgKTsKCX0sCgoJX3Bvc2l0aW9uOiBmdW5jdGlvbigpIHsKCQl0aGlzLm1lbnVXcmFwLnBvc2l0aW9uKCAkLmV4dGVuZCggeyBvZjogdGhpcy5idXR0b24gfSwgdGhpcy5vcHRpb25zLnBvc2l0aW9uICkgKTsKCX0sCgoJY2xvc2U6IGZ1bmN0aW9uKCBldmVudCApIHsKCQlpZiAoICF0aGlzLmlzT3BlbiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5pc09wZW4gPSBmYWxzZTsKCQl0aGlzLl90b2dnbGVBdHRyKCk7CgoJCXRoaXMuX29mZiggdGhpcy5kb2N1bWVudCApOwoKCQl0aGlzLl90cmlnZ2VyKCAiY2xvc2UiLCBldmVudCApOwoJfSwKCgl3aWRnZXQ6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmJ1dHRvbjsKCX0sCgoJbWVudVdpZGdldDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWVudTsKCX0sCgoJX3JlbmRlck1lbnU6IGZ1bmN0aW9uKCB1bCwgaXRlbXMgKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQljdXJyZW50T3B0Z3JvdXAgPSAiIjsKCgkJJC5lYWNoKCBpdGVtcywgZnVuY3Rpb24oIGluZGV4LCBpdGVtICkgewoJCQlpZiAoIGl0ZW0ub3B0Z3JvdXAgIT09IGN1cnJlbnRPcHRncm91cCApIHsKCQkJCSQoICI8bGk+IiwgewoJCQkJCSJjbGFzcyI6ICJ1aS1zZWxlY3RtZW51LW9wdGdyb3VwIHVpLW1lbnUtZGl2aWRlciIgKwoJCQkJCQkoIGl0ZW0uZWxlbWVudC5wYXJlbnQoICJvcHRncm91cCIgKS5wcm9wKCAiZGlzYWJsZWQiICkgPwoJCQkJCQkJIiB1aS1zdGF0ZS1kaXNhYmxlZCIgOgoJCQkJCQkJIiIgKSwKCQkJCQl0ZXh0OiBpdGVtLm9wdGdyb3VwCgkJCQl9KQoJCQkJCS5hcHBlbmRUbyggdWwgKTsKCgkJCQljdXJyZW50T3B0Z3JvdXAgPSBpdGVtLm9wdGdyb3VwOwoJCQl9CgoJCQl0aGF0Ll9yZW5kZXJJdGVtRGF0YSggdWwsIGl0ZW0gKTsKCQl9KTsKCX0sCgoJX3JlbmRlckl0ZW1EYXRhOiBmdW5jdGlvbiggdWwsIGl0ZW0gKSB7CgkJcmV0dXJuIHRoaXMuX3JlbmRlckl0ZW0oIHVsLCBpdGVtICkuZGF0YSggInVpLXNlbGVjdG1lbnUtaXRlbSIsIGl0ZW0gKTsKCX0sCgoJX3JlbmRlckl0ZW06IGZ1bmN0aW9uKCB1bCwgaXRlbSApIHsKCQl2YXIgbGkgPSAkKCAiPGxpPiIgKTsKCgkJaWYgKCBpdGVtLmRpc2FibGVkICkgewoJCQlsaS5hZGRDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiApOwoJCX0KCQl0aGlzLl9zZXRUZXh0KCBsaSwgaXRlbS5sYWJlbCApOwoKCQlyZXR1cm4gbGkuYXBwZW5kVG8oIHVsICk7Cgl9LAoKCV9zZXRUZXh0OiBmdW5jdGlvbiggZWxlbWVudCwgdmFsdWUgKSB7CgkJaWYgKCB2YWx1ZSApIHsKCQkJZWxlbWVudC50ZXh0KCB2YWx1ZSApOwoJCX0gZWxzZSB7CgkJCWVsZW1lbnQuaHRtbCggIiYjMTYwOyIgKTsKCQl9Cgl9LAoKCV9tb3ZlOiBmdW5jdGlvbiggZGlyZWN0aW9uLCBldmVudCApIHsKCQl2YXIgaXRlbSwgbmV4dCwKCQkJZmlsdGVyID0gIi51aS1tZW51LWl0ZW0iOwoKCQlpZiAoIHRoaXMuaXNPcGVuICkgewoJCQlpdGVtID0gdGhpcy5tZW51SXRlbXMuZXEoIHRoaXMuZm9jdXNJbmRleCApOwoJCX0gZWxzZSB7CgkJCWl0ZW0gPSB0aGlzLm1lbnVJdGVtcy5lcSggdGhpcy5lbGVtZW50WyAwIF0uc2VsZWN0ZWRJbmRleCApOwoJCQlmaWx0ZXIgKz0gIjpub3QoLnVpLXN0YXRlLWRpc2FibGVkKSI7CgkJfQoKCQlpZiAoIGRpcmVjdGlvbiA9PT0gImZpcnN0IiB8fCBkaXJlY3Rpb24gPT09ICJsYXN0IiApIHsKCQkJbmV4dCA9IGl0ZW1bIGRpcmVjdGlvbiA9PT0gImZpcnN0IiA/ICJwcmV2QWxsIiA6ICJuZXh0QWxsIiBdKCBmaWx0ZXIgKS5lcSggLTEgKTsKCQl9IGVsc2UgewoJCQluZXh0ID0gaXRlbVsgZGlyZWN0aW9uICsgIkFsbCIgXSggZmlsdGVyICkuZXEoIDAgKTsKCQl9CgoJCWlmICggbmV4dC5sZW5ndGggKSB7CgkJCXRoaXMubWVudUluc3RhbmNlLmZvY3VzKCBldmVudCwgbmV4dCApOwoJCX0KCX0sCgoJX2dldFNlbGVjdGVkSXRlbTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWVudUl0ZW1zLmVxKCB0aGlzLmVsZW1lbnRbIDAgXS5zZWxlY3RlZEluZGV4ICk7Cgl9LAoKCV90b2dnbGU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl0aGlzWyB0aGlzLmlzT3BlbiA/ICJjbG9zZSIgOiAib3BlbiIgXSggZXZlbnQgKTsKCX0sCgoJX2RvY3VtZW50Q2xpY2s6IHsKCQltb3VzZWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJaWYgKCAhdGhpcy5pc09wZW4gKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmICggISQoIGV2ZW50LnRhcmdldCApLmNsb3Nlc3QoICIudWktc2VsZWN0bWVudS1tZW51LCAjIiArIHRoaXMuaWRzLmJ1dHRvbiApLmxlbmd0aCApIHsKCQkJCXRoaXMuY2xvc2UoIGV2ZW50ICk7CgkJCX0KCQl9Cgl9LAoKCV9idXR0b25FdmVudHM6IHsKCgkJLy8gUHJldmVudCB0ZXh0IHNlbGVjdGlvbiBmcm9tIGJlaW5nIHJlc2V0IHdoZW4gaW50ZXJhY3Rpbmcgd2l0aCB0aGUgc2VsZWN0bWVudSAoIzEwMTQ0KQoJCW1vdXNlZG93bjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCX0sCgoJCWNsaWNrOiAiX3RvZ2dsZSIsCgoJCWtleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJdmFyIHByZXZlbnREZWZhdWx0ID0gdHJ1ZTsKCQkJc3dpdGNoICggZXZlbnQua2V5Q29kZSApIHsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLlRBQjoKCQkJCWNhc2UgJC51aS5rZXlDb2RlLkVTQ0FQRToKCQkJCQl0aGlzLmNsb3NlKCBldmVudCApOwoJCQkJCXByZXZlbnREZWZhdWx0ID0gZmFsc2U7CgkJCQkJYnJlYWs7CgkJCQljYXNlICQudWkua2V5Q29kZS5FTlRFUjoKCQkJCQlpZiAoIHRoaXMuaXNPcGVuICkgewoJCQkJCQl0aGlzLl9zZWxlY3RGb2N1c2VkSXRlbSggZXZlbnQgKTsKCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQljYXNlICQudWkua2V5Q29kZS5VUDoKCQkJCQlpZiAoIGV2ZW50LmFsdEtleSApIHsKCQkJCQkJdGhpcy5fdG9nZ2xlKCBldmVudCApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXRoaXMuX21vdmUoICJwcmV2IiwgZXZlbnQgKTsKCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQljYXNlICQudWkua2V5Q29kZS5ET1dOOgoJCQkJCWlmICggZXZlbnQuYWx0S2V5ICkgewoJCQkJCQl0aGlzLl90b2dnbGUoIGV2ZW50ICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdGhpcy5fbW92ZSggIm5leHQiLCBldmVudCApOwoJCQkJCX0KCQkJCQlicmVhazsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLlNQQUNFOgoJCQkJCWlmICggdGhpcy5pc09wZW4gKSB7CgkJCQkJCXRoaXMuX3NlbGVjdEZvY3VzZWRJdGVtKCBldmVudCApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXRoaXMuX3RvZ2dsZSggZXZlbnQgKTsKCQkJCQl9CgkJCQkJYnJlYWs7CgkJCQljYXNlICQudWkua2V5Q29kZS5MRUZUOgoJCQkJCXRoaXMuX21vdmUoICJwcmV2IiwgZXZlbnQgKTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLlJJR0hUOgoJCQkJCXRoaXMuX21vdmUoICJuZXh0IiwgZXZlbnQgKTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLkhPTUU6CgkJCQljYXNlICQudWkua2V5Q29kZS5QQUdFX1VQOgoJCQkJCXRoaXMuX21vdmUoICJmaXJzdCIsIGV2ZW50ICk7CgkJCQkJYnJlYWs7CgkJCQljYXNlICQudWkua2V5Q29kZS5FTkQ6CgkJCQljYXNlICQudWkua2V5Q29kZS5QQUdFX0RPV046CgkJCQkJdGhpcy5fbW92ZSggImxhc3QiLCBldmVudCApOwoJCQkJCWJyZWFrOwoJCQkJZGVmYXVsdDoKCQkJCQl0aGlzLm1lbnUudHJpZ2dlciggZXZlbnQgKTsKCQkJCQlwcmV2ZW50RGVmYXVsdCA9IGZhbHNlOwoJCQl9CgoJCQlpZiAoIHByZXZlbnREZWZhdWx0ICkgewoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJfQoJCX0KCX0sCgoJX3NlbGVjdEZvY3VzZWRJdGVtOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdmFyIGl0ZW0gPSB0aGlzLm1lbnVJdGVtcy5lcSggdGhpcy5mb2N1c0luZGV4ICk7CgkJaWYgKCAhaXRlbS5oYXNDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiApICkgewoJCQl0aGlzLl9zZWxlY3QoIGl0ZW0uZGF0YSggInVpLXNlbGVjdG1lbnUtaXRlbSIgKSwgZXZlbnQgKTsKCQl9Cgl9LAoKCV9zZWxlY3Q6IGZ1bmN0aW9uKCBpdGVtLCBldmVudCApIHsKCQl2YXIgb2xkSW5kZXggPSB0aGlzLmVsZW1lbnRbIDAgXS5zZWxlY3RlZEluZGV4OwoKCQkvLyBDaGFuZ2UgbmF0aXZlIHNlbGVjdCBlbGVtZW50CgkJdGhpcy5lbGVtZW50WyAwIF0uc2VsZWN0ZWRJbmRleCA9IGl0ZW0uaW5kZXg7CgkJdGhpcy5fc2V0VGV4dCggdGhpcy5idXR0b25UZXh0LCBpdGVtLmxhYmVsICk7CgkJdGhpcy5fc2V0QXJpYSggaXRlbSApOwoJCXRoaXMuX3RyaWdnZXIoICJzZWxlY3QiLCBldmVudCwgeyBpdGVtOiBpdGVtIH0gKTsKCgkJaWYgKCBpdGVtLmluZGV4ICE9PSBvbGRJbmRleCApIHsKCQkJdGhpcy5fdHJpZ2dlciggImNoYW5nZSIsIGV2ZW50LCB7IGl0ZW06IGl0ZW0gfSApOwoJCX0KCgkJdGhpcy5jbG9zZSggZXZlbnQgKTsKCX0sCgoJX3NldEFyaWE6IGZ1bmN0aW9uKCBpdGVtICkgewoJCXZhciBpZCA9IHRoaXMubWVudUl0ZW1zLmVxKCBpdGVtLmluZGV4ICkuYXR0ciggImlkIiApOwoKCQl0aGlzLmJ1dHRvbi5hdHRyKHsKCQkJImFyaWEtbGFiZWxsZWRieSI6IGlkLAoJCQkiYXJpYS1hY3RpdmVkZXNjZW5kYW50IjogaWQKCQl9KTsKCQl0aGlzLm1lbnUuYXR0ciggImFyaWEtYWN0aXZlZGVzY2VuZGFudCIsIGlkICk7Cgl9LAoKCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCWlmICgga2V5ID09PSAiaWNvbnMiICkgewoJCQl0aGlzLmJ1dHRvbi5maW5kKCAic3Bhbi51aS1pY29uIiApCgkJCQkucmVtb3ZlQ2xhc3MoIHRoaXMub3B0aW9ucy5pY29ucy5idXR0b24gKQoJCQkJLmFkZENsYXNzKCB2YWx1ZS5idXR0b24gKTsKCQl9CgoJCXRoaXMuX3N1cGVyKCBrZXksIHZhbHVlICk7CgoJCWlmICgga2V5ID09PSAiYXBwZW5kVG8iICkgewoJCQl0aGlzLm1lbnVXcmFwLmFwcGVuZFRvKCB0aGlzLl9hcHBlbmRUbygpICk7CgkJfQoKCQlpZiAoIGtleSA9PT0gImRpc2FibGVkIiApIHsKCQkJdGhpcy5tZW51SW5zdGFuY2Uub3B0aW9uKCAiZGlzYWJsZWQiLCB2YWx1ZSApOwoJCQl0aGlzLmJ1dHRvbgoJCQkJLnRvZ2dsZUNsYXNzKCAidWktc3RhdGUtZGlzYWJsZWQiLCB2YWx1ZSApCgkJCQkuYXR0ciggImFyaWEtZGlzYWJsZWQiLCB2YWx1ZSApOwoKCQkJdGhpcy5lbGVtZW50LnByb3AoICJkaXNhYmxlZCIsIHZhbHVlICk7CgkJCWlmICggdmFsdWUgKSB7CgkJCQl0aGlzLmJ1dHRvbi5hdHRyKCAidGFiaW5kZXgiLCAtMSApOwoJCQkJdGhpcy5jbG9zZSgpOwoJCQl9IGVsc2UgewoJCQkJdGhpcy5idXR0b24uYXR0ciggInRhYmluZGV4IiwgMCApOwoJCQl9CgkJfQoKCQlpZiAoIGtleSA9PT0gIndpZHRoIiApIHsKCQkJdGhpcy5fcmVzaXplQnV0dG9uKCk7CgkJfQoJfSwKCglfYXBwZW5kVG86IGZ1bmN0aW9uKCkgewoJCXZhciBlbGVtZW50ID0gdGhpcy5vcHRpb25zLmFwcGVuZFRvOwoKCQlpZiAoIGVsZW1lbnQgKSB7CgkJCWVsZW1lbnQgPSBlbGVtZW50LmpxdWVyeSB8fCBlbGVtZW50Lm5vZGVUeXBlID8KCQkJCSQoIGVsZW1lbnQgKSA6CgkJCQl0aGlzLmRvY3VtZW50LmZpbmQoIGVsZW1lbnQgKS5lcSggMCApOwoJCX0KCgkJaWYgKCAhZWxlbWVudCB8fCAhZWxlbWVudFsgMCBdICkgewoJCQllbGVtZW50ID0gdGhpcy5lbGVtZW50LmNsb3Nlc3QoICIudWktZnJvbnQiICk7CgkJfQoKCQlpZiAoICFlbGVtZW50Lmxlbmd0aCApIHsKCQkJZWxlbWVudCA9IHRoaXMuZG9jdW1lbnRbIDAgXS5ib2R5OwoJCX0KCgkJcmV0dXJuIGVsZW1lbnQ7Cgl9LAoKCV90b2dnbGVBdHRyOiBmdW5jdGlvbigpIHsKCQl0aGlzLmJ1dHRvbgoJCQkudG9nZ2xlQ2xhc3MoICJ1aS1jb3JuZXItdG9wIiwgdGhpcy5pc09wZW4gKQoJCQkudG9nZ2xlQ2xhc3MoICJ1aS1jb3JuZXItYWxsIiwgIXRoaXMuaXNPcGVuICkKCQkJLmF0dHIoICJhcmlhLWV4cGFuZGVkIiwgdGhpcy5pc09wZW4gKTsKCQl0aGlzLm1lbnVXcmFwLnRvZ2dsZUNsYXNzKCAidWktc2VsZWN0bWVudS1vcGVuIiwgdGhpcy5pc09wZW4gKTsKCQl0aGlzLm1lbnUuYXR0ciggImFyaWEtaGlkZGVuIiwgIXRoaXMuaXNPcGVuICk7Cgl9LAoKCV9yZXNpemVCdXR0b246IGZ1bmN0aW9uKCkgewoJCXZhciB3aWR0aCA9IHRoaXMub3B0aW9ucy53aWR0aDsKCgkJaWYgKCAhd2lkdGggKSB7CgkJCXdpZHRoID0gdGhpcy5lbGVtZW50LnNob3coKS5vdXRlcldpZHRoKCk7CgkJCXRoaXMuZWxlbWVudC5oaWRlKCk7CgkJfQoKCQl0aGlzLmJ1dHRvbi5vdXRlcldpZHRoKCB3aWR0aCApOwoJfSwKCglfcmVzaXplTWVudTogZnVuY3Rpb24oKSB7CgkJdGhpcy5tZW51Lm91dGVyV2lkdGgoIE1hdGgubWF4KAoJCQl0aGlzLmJ1dHRvbi5vdXRlcldpZHRoKCksCgoJCQkvLyBzdXBwb3J0OiBJRTEwCgkJCS8vIElFMTAgd3JhcHMgbG9uZyB0ZXh0IChwb3NzaWJseSBhIHJvdW5kaW5nIGJ1ZykKCQkJLy8gc28gd2UgYWRkIDFweCB0byBhdm9pZCB0aGUgd3JhcHBpbmcKCQkJdGhpcy5tZW51LndpZHRoKCAiIiApLm91dGVyV2lkdGgoKSArIDEKCQkpICk7Cgl9LAoKCV9nZXRDcmVhdGVPcHRpb25zOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4geyBkaXNhYmxlZDogdGhpcy5lbGVtZW50LnByb3AoICJkaXNhYmxlZCIgKSB9OwoJfSwKCglfcGFyc2VPcHRpb25zOiBmdW5jdGlvbiggb3B0aW9ucyApIHsKCQl2YXIgZGF0YSA9IFtdOwoJCW9wdGlvbnMuZWFjaChmdW5jdGlvbiggaW5kZXgsIGl0ZW0gKSB7CgkJCXZhciBvcHRpb24gPSAkKCBpdGVtICksCgkJCQlvcHRncm91cCA9IG9wdGlvbi5wYXJlbnQoICJvcHRncm91cCIgKTsKCQkJZGF0YS5wdXNoKHsKCQkJCWVsZW1lbnQ6IG9wdGlvbiwKCQkJCWluZGV4OiBpbmRleCwKCQkJCXZhbHVlOiBvcHRpb24uYXR0ciggInZhbHVlIiApLAoJCQkJbGFiZWw6IG9wdGlvbi50ZXh0KCksCgkJCQlvcHRncm91cDogb3B0Z3JvdXAuYXR0ciggImxhYmVsIiApIHx8ICIiLAoJCQkJZGlzYWJsZWQ6IG9wdGdyb3VwLnByb3AoICJkaXNhYmxlZCIgKSB8fCBvcHRpb24ucHJvcCggImRpc2FibGVkIiApCgkJCX0pOwoJCX0pOwoJCXRoaXMuaXRlbXMgPSBkYXRhOwoJfSwKCglfZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJdGhpcy5tZW51V3JhcC5yZW1vdmUoKTsKCQl0aGlzLmJ1dHRvbi5yZW1vdmUoKTsKCQl0aGlzLmVsZW1lbnQuc2hvdygpOwoJCXRoaXMuZWxlbWVudC5yZW1vdmVVbmlxdWVJZCgpOwoJCXRoaXMubGFiZWwuYXR0ciggImZvciIsIHRoaXMuaWRzLmVsZW1lbnQgKTsKCX0KfSk7CgoKLyohCiAqIGpRdWVyeSBVSSBTbGlkZXIgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vc2xpZGVyLwogKi8KCgp2YXIgc2xpZGVyID0gJC53aWRnZXQoICJ1aS5zbGlkZXIiLCAkLnVpLm1vdXNlLCB7Cgl2ZXJzaW9uOiAiMS4xMS4xIiwKCXdpZGdldEV2ZW50UHJlZml4OiAic2xpZGUiLAoKCW9wdGlvbnM6IHsKCQlhbmltYXRlOiBmYWxzZSwKCQlkaXN0YW5jZTogMCwKCQltYXg6IDEwMCwKCQltaW46IDAsCgkJb3JpZW50YXRpb246ICJob3Jpem9udGFsIiwKCQlyYW5nZTogZmFsc2UsCgkJc3RlcDogMSwKCQl2YWx1ZTogMCwKCQl2YWx1ZXM6IG51bGwsCgoJCS8vIGNhbGxiYWNrcwoJCWNoYW5nZTogbnVsbCwKCQlzbGlkZTogbnVsbCwKCQlzdGFydDogbnVsbCwKCQlzdG9wOiBudWxsCgl9LAoKCS8vIG51bWJlciBvZiBwYWdlcyBpbiBhIHNsaWRlcgoJLy8gKGhvdyBtYW55IHRpbWVzIGNhbiB5b3UgcGFnZSB1cC9kb3duIHRvIGdvIHRocm91Z2ggdGhlIHdob2xlIHJhbmdlKQoJbnVtUGFnZXM6IDUsCgoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgkJdGhpcy5fa2V5U2xpZGluZyA9IGZhbHNlOwoJCXRoaXMuX21vdXNlU2xpZGluZyA9IGZhbHNlOwoJCXRoaXMuX2FuaW1hdGVPZmYgPSB0cnVlOwoJCXRoaXMuX2hhbmRsZUluZGV4ID0gbnVsbDsKCQl0aGlzLl9kZXRlY3RPcmllbnRhdGlvbigpOwoJCXRoaXMuX21vdXNlSW5pdCgpOwoKCQl0aGlzLmVsZW1lbnQKCQkJLmFkZENsYXNzKCAidWktc2xpZGVyIiArCgkJCQkiIHVpLXNsaWRlci0iICsgdGhpcy5vcmllbnRhdGlvbiArCgkJCQkiIHVpLXdpZGdldCIgKwoJCQkJIiB1aS13aWRnZXQtY29udGVudCIgKwoJCQkJIiB1aS1jb3JuZXItYWxsIik7CgoJCXRoaXMuX3JlZnJlc2goKTsKCQl0aGlzLl9zZXRPcHRpb24oICJkaXNhYmxlZCIsIHRoaXMub3B0aW9ucy5kaXNhYmxlZCApOwoKCQl0aGlzLl9hbmltYXRlT2ZmID0gZmFsc2U7Cgl9LAoKCV9yZWZyZXNoOiBmdW5jdGlvbigpIHsKCQl0aGlzLl9jcmVhdGVSYW5nZSgpOwoJCXRoaXMuX2NyZWF0ZUhhbmRsZXMoKTsKCQl0aGlzLl9zZXR1cEV2ZW50cygpOwoJCXRoaXMuX3JlZnJlc2hWYWx1ZSgpOwoJfSwKCglfY3JlYXRlSGFuZGxlczogZnVuY3Rpb24oKSB7CgkJdmFyIGksIGhhbmRsZUNvdW50LAoJCQlvcHRpb25zID0gdGhpcy5vcHRpb25zLAoJCQlleGlzdGluZ0hhbmRsZXMgPSB0aGlzLmVsZW1lbnQuZmluZCggIi51aS1zbGlkZXItaGFuZGxlIiApLmFkZENsYXNzKCAidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIiApLAoJCQloYW5kbGUgPSAiPHNwYW4gY2xhc3M9J3VpLXNsaWRlci1oYW5kbGUgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsJyB0YWJpbmRleD0nMCc+PC9zcGFuPiIsCgkJCWhhbmRsZXMgPSBbXTsKCgkJaGFuZGxlQ291bnQgPSAoIG9wdGlvbnMudmFsdWVzICYmIG9wdGlvbnMudmFsdWVzLmxlbmd0aCApIHx8IDE7CgoJCWlmICggZXhpc3RpbmdIYW5kbGVzLmxlbmd0aCA+IGhhbmRsZUNvdW50ICkgewoJCQlleGlzdGluZ0hhbmRsZXMuc2xpY2UoIGhhbmRsZUNvdW50ICkucmVtb3ZlKCk7CgkJCWV4aXN0aW5nSGFuZGxlcyA9IGV4aXN0aW5nSGFuZGxlcy5zbGljZSggMCwgaGFuZGxlQ291bnQgKTsKCQl9CgoJCWZvciAoIGkgPSBleGlzdGluZ0hhbmRsZXMubGVuZ3RoOyBpIDwgaGFuZGxlQ291bnQ7IGkrKyApIHsKCQkJaGFuZGxlcy5wdXNoKCBoYW5kbGUgKTsKCQl9CgoJCXRoaXMuaGFuZGxlcyA9IGV4aXN0aW5nSGFuZGxlcy5hZGQoICQoIGhhbmRsZXMuam9pbiggIiIgKSApLmFwcGVuZFRvKCB0aGlzLmVsZW1lbnQgKSApOwoKCQl0aGlzLmhhbmRsZSA9IHRoaXMuaGFuZGxlcy5lcSggMCApOwoKCQl0aGlzLmhhbmRsZXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJJCggdGhpcyApLmRhdGEoICJ1aS1zbGlkZXItaGFuZGxlLWluZGV4IiwgaSApOwoJCX0pOwoJfSwKCglfY3JlYXRlUmFuZ2U6IGZ1bmN0aW9uKCkgewoJCXZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zLAoJCQljbGFzc2VzID0gIiI7CgoJCWlmICggb3B0aW9ucy5yYW5nZSApIHsKCQkJaWYgKCBvcHRpb25zLnJhbmdlID09PSB0cnVlICkgewoJCQkJaWYgKCAhb3B0aW9ucy52YWx1ZXMgKSB7CgkJCQkJb3B0aW9ucy52YWx1ZXMgPSBbIHRoaXMuX3ZhbHVlTWluKCksIHRoaXMuX3ZhbHVlTWluKCkgXTsKCQkJCX0gZWxzZSBpZiAoIG9wdGlvbnMudmFsdWVzLmxlbmd0aCAmJiBvcHRpb25zLnZhbHVlcy5sZW5ndGggIT09IDIgKSB7CgkJCQkJb3B0aW9ucy52YWx1ZXMgPSBbIG9wdGlvbnMudmFsdWVzWzBdLCBvcHRpb25zLnZhbHVlc1swXSBdOwoJCQkJfSBlbHNlIGlmICggJC5pc0FycmF5KCBvcHRpb25zLnZhbHVlcyApICkgewoJCQkJCW9wdGlvbnMudmFsdWVzID0gb3B0aW9ucy52YWx1ZXMuc2xpY2UoMCk7CgkJCQl9CgkJCX0KCgkJCWlmICggIXRoaXMucmFuZ2UgfHwgIXRoaXMucmFuZ2UubGVuZ3RoICkgewoJCQkJdGhpcy5yYW5nZSA9ICQoICI8ZGl2PjwvZGl2PiIgKQoJCQkJCS5hcHBlbmRUbyggdGhpcy5lbGVtZW50ICk7CgoJCQkJY2xhc3NlcyA9ICJ1aS1zbGlkZXItcmFuZ2UiICsKCQkJCS8vIG5vdGU6IHRoaXMgaXNuJ3QgdGhlIG1vc3QgZml0dGluZ2x5IHNlbWFudGljIGZyYW1ld29yayBjbGFzcyBmb3IgdGhpcyBlbGVtZW50LAoJCQkJLy8gYnV0IHdvcmtlZCBiZXN0IHZpc3VhbGx5IHdpdGggYSB2YXJpZXR5IG9mIHRoZW1lcwoJCQkJIiB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGwiOwoJCQl9IGVsc2UgewoJCQkJdGhpcy5yYW5nZS5yZW1vdmVDbGFzcyggInVpLXNsaWRlci1yYW5nZS1taW4gdWktc2xpZGVyLXJhbmdlLW1heCIgKQoJCQkJCS8vIEhhbmRsZSByYW5nZSBzd2l0Y2hpbmcgZnJvbSB0cnVlIHRvIG1pbi9tYXgKCQkJCQkuY3NzKHsKCQkJCQkJImxlZnQiOiAiIiwKCQkJCQkJImJvdHRvbSI6ICIiCgkJCQkJfSk7CgkJCX0KCgkJCXRoaXMucmFuZ2UuYWRkQ2xhc3MoIGNsYXNzZXMgKwoJCQkJKCAoIG9wdGlvbnMucmFuZ2UgPT09ICJtaW4iIHx8IG9wdGlvbnMucmFuZ2UgPT09ICJtYXgiICkgPyAiIHVpLXNsaWRlci1yYW5nZS0iICsgb3B0aW9ucy5yYW5nZSA6ICIiICkgKTsKCQl9IGVsc2UgewoJCQlpZiAoIHRoaXMucmFuZ2UgKSB7CgkJCQl0aGlzLnJhbmdlLnJlbW92ZSgpOwoJCQl9CgkJCXRoaXMucmFuZ2UgPSBudWxsOwoJCX0KCX0sCgoJX3NldHVwRXZlbnRzOiBmdW5jdGlvbigpIHsKCQl0aGlzLl9vZmYoIHRoaXMuaGFuZGxlcyApOwoJCXRoaXMuX29uKCB0aGlzLmhhbmRsZXMsIHRoaXMuX2hhbmRsZUV2ZW50cyApOwoJCXRoaXMuX2hvdmVyYWJsZSggdGhpcy5oYW5kbGVzICk7CgkJdGhpcy5fZm9jdXNhYmxlKCB0aGlzLmhhbmRsZXMgKTsKCX0sCgoJX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkgewoJCXRoaXMuaGFuZGxlcy5yZW1vdmUoKTsKCQlpZiAoIHRoaXMucmFuZ2UgKSB7CgkJCXRoaXMucmFuZ2UucmVtb3ZlKCk7CgkJfQoKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCAidWktc2xpZGVyIiArCgkJCQkiIHVpLXNsaWRlci1ob3Jpem9udGFsIiArCgkJCQkiIHVpLXNsaWRlci12ZXJ0aWNhbCIgKwoJCQkJIiB1aS13aWRnZXQiICsKCQkJCSIgdWktd2lkZ2V0LWNvbnRlbnQiICsKCQkJCSIgdWktY29ybmVyLWFsbCIgKTsKCgkJdGhpcy5fbW91c2VEZXN0cm95KCk7Cgl9LAoKCV9tb3VzZUNhcHR1cmU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgcG9zaXRpb24sIG5vcm1WYWx1ZSwgZGlzdGFuY2UsIGNsb3Nlc3RIYW5kbGUsIGluZGV4LCBhbGxvd2VkLCBvZmZzZXQsIG1vdXNlT3ZlckhhbmRsZSwKCQkJdGhhdCA9IHRoaXMsCgkJCW8gPSB0aGlzLm9wdGlvbnM7CgoJCWlmICggby5kaXNhYmxlZCApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJdGhpcy5lbGVtZW50U2l6ZSA9IHsKCQkJd2lkdGg6IHRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCksCgkJCWhlaWdodDogdGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCkKCQl9OwoJCXRoaXMuZWxlbWVudE9mZnNldCA9IHRoaXMuZWxlbWVudC5vZmZzZXQoKTsKCgkJcG9zaXRpb24gPSB7IHg6IGV2ZW50LnBhZ2VYLCB5OiBldmVudC5wYWdlWSB9OwoJCW5vcm1WYWx1ZSA9IHRoaXMuX25vcm1WYWx1ZUZyb21Nb3VzZSggcG9zaXRpb24gKTsKCQlkaXN0YW5jZSA9IHRoaXMuX3ZhbHVlTWF4KCkgLSB0aGlzLl92YWx1ZU1pbigpICsgMTsKCQl0aGlzLmhhbmRsZXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJdmFyIHRoaXNEaXN0YW5jZSA9IE1hdGguYWJzKCBub3JtVmFsdWUgLSB0aGF0LnZhbHVlcyhpKSApOwoJCQlpZiAoKCBkaXN0YW5jZSA+IHRoaXNEaXN0YW5jZSApIHx8CgkJCQkoIGRpc3RhbmNlID09PSB0aGlzRGlzdGFuY2UgJiYKCQkJCQkoaSA9PT0gdGhhdC5fbGFzdENoYW5nZWRWYWx1ZSB8fCB0aGF0LnZhbHVlcyhpKSA9PT0gby5taW4gKSkpIHsKCQkJCWRpc3RhbmNlID0gdGhpc0Rpc3RhbmNlOwoJCQkJY2xvc2VzdEhhbmRsZSA9ICQoIHRoaXMgKTsKCQkJCWluZGV4ID0gaTsKCQkJfQoJCX0pOwoKCQlhbGxvd2VkID0gdGhpcy5fc3RhcnQoIGV2ZW50LCBpbmRleCApOwoJCWlmICggYWxsb3dlZCA9PT0gZmFsc2UgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJdGhpcy5fbW91c2VTbGlkaW5nID0gdHJ1ZTsKCgkJdGhpcy5faGFuZGxlSW5kZXggPSBpbmRleDsKCgkJY2xvc2VzdEhhbmRsZQoJCQkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICkKCQkJLmZvY3VzKCk7CgoJCW9mZnNldCA9IGNsb3Nlc3RIYW5kbGUub2Zmc2V0KCk7CgkJbW91c2VPdmVySGFuZGxlID0gISQoIGV2ZW50LnRhcmdldCApLnBhcmVudHMoKS5hZGRCYWNrKCkuaXMoICIudWktc2xpZGVyLWhhbmRsZSIgKTsKCQl0aGlzLl9jbGlja09mZnNldCA9IG1vdXNlT3ZlckhhbmRsZSA/IHsgbGVmdDogMCwgdG9wOiAwIH0gOiB7CgkJCWxlZnQ6IGV2ZW50LnBhZ2VYIC0gb2Zmc2V0LmxlZnQgLSAoIGNsb3Nlc3RIYW5kbGUud2lkdGgoKSAvIDIgKSwKCQkJdG9wOiBldmVudC5wYWdlWSAtIG9mZnNldC50b3AgLQoJCQkJKCBjbG9zZXN0SGFuZGxlLmhlaWdodCgpIC8gMiApIC0KCQkJCSggcGFyc2VJbnQoIGNsb3Nlc3RIYW5kbGUuY3NzKCJib3JkZXJUb3BXaWR0aCIpLCAxMCApIHx8IDAgKSAtCgkJCQkoIHBhcnNlSW50KCBjbG9zZXN0SGFuZGxlLmNzcygiYm9yZGVyQm90dG9tV2lkdGgiKSwgMTAgKSB8fCAwKSArCgkJCQkoIHBhcnNlSW50KCBjbG9zZXN0SGFuZGxlLmNzcygibWFyZ2luVG9wIiksIDEwICkgfHwgMCkKCQl9OwoKCQlpZiAoICF0aGlzLmhhbmRsZXMuaGFzQ2xhc3MoICJ1aS1zdGF0ZS1ob3ZlciIgKSApIHsKCQkJdGhpcy5fc2xpZGUoIGV2ZW50LCBpbmRleCwgbm9ybVZhbHVlICk7CgkJfQoJCXRoaXMuX2FuaW1hdGVPZmYgPSB0cnVlOwoJCXJldHVybiB0cnVlOwoJfSwKCglfbW91c2VTdGFydDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRydWU7Cgl9LAoKCV9tb3VzZURyYWc6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgcG9zaXRpb24gPSB7IHg6IGV2ZW50LnBhZ2VYLCB5OiBldmVudC5wYWdlWSB9LAoJCQlub3JtVmFsdWUgPSB0aGlzLl9ub3JtVmFsdWVGcm9tTW91c2UoIHBvc2l0aW9uICk7CgoJCXRoaXMuX3NsaWRlKCBldmVudCwgdGhpcy5faGFuZGxlSW5kZXgsIG5vcm1WYWx1ZSApOwoKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCV9tb3VzZVN0b3A6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl0aGlzLmhhbmRsZXMucmVtb3ZlQ2xhc3MoICJ1aS1zdGF0ZS1hY3RpdmUiICk7CgkJdGhpcy5fbW91c2VTbGlkaW5nID0gZmFsc2U7CgoJCXRoaXMuX3N0b3AoIGV2ZW50LCB0aGlzLl9oYW5kbGVJbmRleCApOwoJCXRoaXMuX2NoYW5nZSggZXZlbnQsIHRoaXMuX2hhbmRsZUluZGV4ICk7CgoJCXRoaXMuX2hhbmRsZUluZGV4ID0gbnVsbDsKCQl0aGlzLl9jbGlja09mZnNldCA9IG51bGw7CgkJdGhpcy5fYW5pbWF0ZU9mZiA9IGZhbHNlOwoKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCV9kZXRlY3RPcmllbnRhdGlvbjogZnVuY3Rpb24oKSB7CgkJdGhpcy5vcmllbnRhdGlvbiA9ICggdGhpcy5vcHRpb25zLm9yaWVudGF0aW9uID09PSAidmVydGljYWwiICkgPyAidmVydGljYWwiIDogImhvcml6b250YWwiOwoJfSwKCglfbm9ybVZhbHVlRnJvbU1vdXNlOiBmdW5jdGlvbiggcG9zaXRpb24gKSB7CgkJdmFyIHBpeGVsVG90YWwsCgkJCXBpeGVsTW91c2UsCgkJCXBlcmNlbnRNb3VzZSwKCQkJdmFsdWVUb3RhbCwKCQkJdmFsdWVNb3VzZTsKCgkJaWYgKCB0aGlzLm9yaWVudGF0aW9uID09PSAiaG9yaXpvbnRhbCIgKSB7CgkJCXBpeGVsVG90YWwgPSB0aGlzLmVsZW1lbnRTaXplLndpZHRoOwoJCQlwaXhlbE1vdXNlID0gcG9zaXRpb24ueCAtIHRoaXMuZWxlbWVudE9mZnNldC5sZWZ0IC0gKCB0aGlzLl9jbGlja09mZnNldCA/IHRoaXMuX2NsaWNrT2Zmc2V0LmxlZnQgOiAwICk7CgkJfSBlbHNlIHsKCQkJcGl4ZWxUb3RhbCA9IHRoaXMuZWxlbWVudFNpemUuaGVpZ2h0OwoJCQlwaXhlbE1vdXNlID0gcG9zaXRpb24ueSAtIHRoaXMuZWxlbWVudE9mZnNldC50b3AgLSAoIHRoaXMuX2NsaWNrT2Zmc2V0ID8gdGhpcy5fY2xpY2tPZmZzZXQudG9wIDogMCApOwoJCX0KCgkJcGVyY2VudE1vdXNlID0gKCBwaXhlbE1vdXNlIC8gcGl4ZWxUb3RhbCApOwoJCWlmICggcGVyY2VudE1vdXNlID4gMSApIHsKCQkJcGVyY2VudE1vdXNlID0gMTsKCQl9CgkJaWYgKCBwZXJjZW50TW91c2UgPCAwICkgewoJCQlwZXJjZW50TW91c2UgPSAwOwoJCX0KCQlpZiAoIHRoaXMub3JpZW50YXRpb24gPT09ICJ2ZXJ0aWNhbCIgKSB7CgkJCXBlcmNlbnRNb3VzZSA9IDEgLSBwZXJjZW50TW91c2U7CgkJfQoKCQl2YWx1ZVRvdGFsID0gdGhpcy5fdmFsdWVNYXgoKSAtIHRoaXMuX3ZhbHVlTWluKCk7CgkJdmFsdWVNb3VzZSA9IHRoaXMuX3ZhbHVlTWluKCkgKyBwZXJjZW50TW91c2UgKiB2YWx1ZVRvdGFsOwoKCQlyZXR1cm4gdGhpcy5fdHJpbUFsaWduVmFsdWUoIHZhbHVlTW91c2UgKTsKCX0sCgoJX3N0YXJ0OiBmdW5jdGlvbiggZXZlbnQsIGluZGV4ICkgewoJCXZhciB1aUhhc2ggPSB7CgkJCWhhbmRsZTogdGhpcy5oYW5kbGVzWyBpbmRleCBdLAoJCQl2YWx1ZTogdGhpcy52YWx1ZSgpCgkJfTsKCQlpZiAoIHRoaXMub3B0aW9ucy52YWx1ZXMgJiYgdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggKSB7CgkJCXVpSGFzaC52YWx1ZSA9IHRoaXMudmFsdWVzKCBpbmRleCApOwoJCQl1aUhhc2gudmFsdWVzID0gdGhpcy52YWx1ZXMoKTsKCQl9CgkJcmV0dXJuIHRoaXMuX3RyaWdnZXIoICJzdGFydCIsIGV2ZW50LCB1aUhhc2ggKTsKCX0sCgoJX3NsaWRlOiBmdW5jdGlvbiggZXZlbnQsIGluZGV4LCBuZXdWYWwgKSB7CgkJdmFyIG90aGVyVmFsLAoJCQluZXdWYWx1ZXMsCgkJCWFsbG93ZWQ7CgoJCWlmICggdGhpcy5vcHRpb25zLnZhbHVlcyAmJiB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCApIHsKCQkJb3RoZXJWYWwgPSB0aGlzLnZhbHVlcyggaW5kZXggPyAwIDogMSApOwoKCQkJaWYgKCAoIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoID09PSAyICYmIHRoaXMub3B0aW9ucy5yYW5nZSA9PT0gdHJ1ZSApICYmCgkJCQkJKCAoIGluZGV4ID09PSAwICYmIG5ld1ZhbCA+IG90aGVyVmFsKSB8fCAoIGluZGV4ID09PSAxICYmIG5ld1ZhbCA8IG90aGVyVmFsICkgKQoJCQkJKSB7CgkJCQluZXdWYWwgPSBvdGhlclZhbDsKCQkJfQoKCQkJaWYgKCBuZXdWYWwgIT09IHRoaXMudmFsdWVzKCBpbmRleCApICkgewoJCQkJbmV3VmFsdWVzID0gdGhpcy52YWx1ZXMoKTsKCQkJCW5ld1ZhbHVlc1sgaW5kZXggXSA9IG5ld1ZhbDsKCQkJCS8vIEEgc2xpZGUgY2FuIGJlIGNhbmNlbGVkIGJ5IHJldHVybmluZyBmYWxzZSBmcm9tIHRoZSBzbGlkZSBjYWxsYmFjawoJCQkJYWxsb3dlZCA9IHRoaXMuX3RyaWdnZXIoICJzbGlkZSIsIGV2ZW50LCB7CgkJCQkJaGFuZGxlOiB0aGlzLmhhbmRsZXNbIGluZGV4IF0sCgkJCQkJdmFsdWU6IG5ld1ZhbCwKCQkJCQl2YWx1ZXM6IG5ld1ZhbHVlcwoJCQkJfSApOwoJCQkJb3RoZXJWYWwgPSB0aGlzLnZhbHVlcyggaW5kZXggPyAwIDogMSApOwoJCQkJaWYgKCBhbGxvd2VkICE9PSBmYWxzZSApIHsKCQkJCQl0aGlzLnZhbHVlcyggaW5kZXgsIG5ld1ZhbCApOwoJCQkJfQoJCQl9CgkJfSBlbHNlIHsKCQkJaWYgKCBuZXdWYWwgIT09IHRoaXMudmFsdWUoKSApIHsKCQkJCS8vIEEgc2xpZGUgY2FuIGJlIGNhbmNlbGVkIGJ5IHJldHVybmluZyBmYWxzZSBmcm9tIHRoZSBzbGlkZSBjYWxsYmFjawoJCQkJYWxsb3dlZCA9IHRoaXMuX3RyaWdnZXIoICJzbGlkZSIsIGV2ZW50LCB7CgkJCQkJaGFuZGxlOiB0aGlzLmhhbmRsZXNbIGluZGV4IF0sCgkJCQkJdmFsdWU6IG5ld1ZhbAoJCQkJfSApOwoJCQkJaWYgKCBhbGxvd2VkICE9PSBmYWxzZSApIHsKCQkJCQl0aGlzLnZhbHVlKCBuZXdWYWwgKTsKCQkJCX0KCQkJfQoJCX0KCX0sCgoJX3N0b3A6IGZ1bmN0aW9uKCBldmVudCwgaW5kZXggKSB7CgkJdmFyIHVpSGFzaCA9IHsKCQkJaGFuZGxlOiB0aGlzLmhhbmRsZXNbIGluZGV4IF0sCgkJCXZhbHVlOiB0aGlzLnZhbHVlKCkKCQl9OwoJCWlmICggdGhpcy5vcHRpb25zLnZhbHVlcyAmJiB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCApIHsKCQkJdWlIYXNoLnZhbHVlID0gdGhpcy52YWx1ZXMoIGluZGV4ICk7CgkJCXVpSGFzaC52YWx1ZXMgPSB0aGlzLnZhbHVlcygpOwoJCX0KCgkJdGhpcy5fdHJpZ2dlciggInN0b3AiLCBldmVudCwgdWlIYXNoICk7Cgl9LAoKCV9jaGFuZ2U6IGZ1bmN0aW9uKCBldmVudCwgaW5kZXggKSB7CgkJaWYgKCAhdGhpcy5fa2V5U2xpZGluZyAmJiAhdGhpcy5fbW91c2VTbGlkaW5nICkgewoJCQl2YXIgdWlIYXNoID0gewoJCQkJaGFuZGxlOiB0aGlzLmhhbmRsZXNbIGluZGV4IF0sCgkJCQl2YWx1ZTogdGhpcy52YWx1ZSgpCgkJCX07CgkJCWlmICggdGhpcy5vcHRpb25zLnZhbHVlcyAmJiB0aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCApIHsKCQkJCXVpSGFzaC52YWx1ZSA9IHRoaXMudmFsdWVzKCBpbmRleCApOwoJCQkJdWlIYXNoLnZhbHVlcyA9IHRoaXMudmFsdWVzKCk7CgkJCX0KCgkJCS8vc3RvcmUgdGhlIGxhc3QgY2hhbmdlZCB2YWx1ZSBpbmRleCBmb3IgcmVmZXJlbmNlIHdoZW4gaGFuZGxlcyBvdmVybGFwCgkJCXRoaXMuX2xhc3RDaGFuZ2VkVmFsdWUgPSBpbmRleDsKCgkJCXRoaXMuX3RyaWdnZXIoICJjaGFuZ2UiLCBldmVudCwgdWlIYXNoICk7CgkJfQoJfSwKCgl2YWx1ZTogZnVuY3Rpb24oIG5ld1ZhbHVlICkgewoJCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJdGhpcy5vcHRpb25zLnZhbHVlID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoIG5ld1ZhbHVlICk7CgkJCXRoaXMuX3JlZnJlc2hWYWx1ZSgpOwoJCQl0aGlzLl9jaGFuZ2UoIG51bGwsIDAgKTsKCQkJcmV0dXJuOwoJCX0KCgkJcmV0dXJuIHRoaXMuX3ZhbHVlKCk7Cgl9LAoKCXZhbHVlczogZnVuY3Rpb24oIGluZGV4LCBuZXdWYWx1ZSApIHsKCQl2YXIgdmFscywKCQkJbmV3VmFsdWVzLAoJCQlpOwoKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAxICkgewoJCQl0aGlzLm9wdGlvbnMudmFsdWVzWyBpbmRleCBdID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoIG5ld1ZhbHVlICk7CgkJCXRoaXMuX3JlZnJlc2hWYWx1ZSgpOwoJCQl0aGlzLl9jaGFuZ2UoIG51bGwsIGluZGV4ICk7CgkJCXJldHVybjsKCQl9CgoJCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJaWYgKCAkLmlzQXJyYXkoIGFyZ3VtZW50c1sgMCBdICkgKSB7CgkJCQl2YWxzID0gdGhpcy5vcHRpb25zLnZhbHVlczsKCQkJCW5ld1ZhbHVlcyA9IGFyZ3VtZW50c1sgMCBdOwoJCQkJZm9yICggaSA9IDA7IGkgPCB2YWxzLmxlbmd0aDsgaSArPSAxICkgewoJCQkJCXZhbHNbIGkgXSA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKCBuZXdWYWx1ZXNbIGkgXSApOwoJCQkJCXRoaXMuX2NoYW5nZSggbnVsbCwgaSApOwoJCQkJfQoJCQkJdGhpcy5fcmVmcmVzaFZhbHVlKCk7CgkJCX0gZWxzZSB7CgkJCQlpZiAoIHRoaXMub3B0aW9ucy52YWx1ZXMgJiYgdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggKSB7CgkJCQkJcmV0dXJuIHRoaXMuX3ZhbHVlcyggaW5kZXggKTsKCQkJCX0gZWxzZSB7CgkJCQkJcmV0dXJuIHRoaXMudmFsdWUoKTsKCQkJCX0KCQkJfQoJCX0gZWxzZSB7CgkJCXJldHVybiB0aGlzLl92YWx1ZXMoKTsKCQl9Cgl9LAoKCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCXZhciBpLAoJCQl2YWxzTGVuZ3RoID0gMDsKCgkJaWYgKCBrZXkgPT09ICJyYW5nZSIgJiYgdGhpcy5vcHRpb25zLnJhbmdlID09PSB0cnVlICkgewoJCQlpZiAoIHZhbHVlID09PSAibWluIiApIHsKCQkJCXRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX3ZhbHVlcyggMCApOwoJCQkJdGhpcy5vcHRpb25zLnZhbHVlcyA9IG51bGw7CgkJCX0gZWxzZSBpZiAoIHZhbHVlID09PSAibWF4IiApIHsKCQkJCXRoaXMub3B0aW9ucy52YWx1ZSA9IHRoaXMuX3ZhbHVlcyggdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggLSAxICk7CgkJCQl0aGlzLm9wdGlvbnMudmFsdWVzID0gbnVsbDsKCQkJfQoJCX0KCgkJaWYgKCAkLmlzQXJyYXkoIHRoaXMub3B0aW9ucy52YWx1ZXMgKSApIHsKCQkJdmFsc0xlbmd0aCA9IHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoOwoJCX0KCgkJaWYgKCBrZXkgPT09ICJkaXNhYmxlZCIgKSB7CgkJCXRoaXMuZWxlbWVudC50b2dnbGVDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiwgISF2YWx1ZSApOwoJCX0KCgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCgkJc3dpdGNoICgga2V5ICkgewoJCQljYXNlICJvcmllbnRhdGlvbiI6CgkJCQl0aGlzLl9kZXRlY3RPcmllbnRhdGlvbigpOwoJCQkJdGhpcy5lbGVtZW50CgkJCQkJLnJlbW92ZUNsYXNzKCAidWktc2xpZGVyLWhvcml6b250YWwgdWktc2xpZGVyLXZlcnRpY2FsIiApCgkJCQkJLmFkZENsYXNzKCAidWktc2xpZGVyLSIgKyB0aGlzLm9yaWVudGF0aW9uICk7CgkJCQl0aGlzLl9yZWZyZXNoVmFsdWUoKTsKCgkJCQkvLyBSZXNldCBwb3NpdGlvbmluZyBmcm9tIHByZXZpb3VzIG9yaWVudGF0aW9uCgkJCQl0aGlzLmhhbmRsZXMuY3NzKCB2YWx1ZSA9PT0gImhvcml6b250YWwiID8gImJvdHRvbSIgOiAibGVmdCIsICIiICk7CgkJCQlicmVhazsKCQkJY2FzZSAidmFsdWUiOgoJCQkJdGhpcy5fYW5pbWF0ZU9mZiA9IHRydWU7CgkJCQl0aGlzLl9yZWZyZXNoVmFsdWUoKTsKCQkJCXRoaXMuX2NoYW5nZSggbnVsbCwgMCApOwoJCQkJdGhpcy5fYW5pbWF0ZU9mZiA9IGZhbHNlOwoJCQkJYnJlYWs7CgkJCWNhc2UgInZhbHVlcyI6CgkJCQl0aGlzLl9hbmltYXRlT2ZmID0gdHJ1ZTsKCQkJCXRoaXMuX3JlZnJlc2hWYWx1ZSgpOwoJCQkJZm9yICggaSA9IDA7IGkgPCB2YWxzTGVuZ3RoOyBpICs9IDEgKSB7CgkJCQkJdGhpcy5fY2hhbmdlKCBudWxsLCBpICk7CgkJCQl9CgkJCQl0aGlzLl9hbmltYXRlT2ZmID0gZmFsc2U7CgkJCQlicmVhazsKCQkJY2FzZSAibWluIjoKCQkJY2FzZSAibWF4IjoKCQkJCXRoaXMuX2FuaW1hdGVPZmYgPSB0cnVlOwoJCQkJdGhpcy5fcmVmcmVzaFZhbHVlKCk7CgkJCQl0aGlzLl9hbmltYXRlT2ZmID0gZmFsc2U7CgkJCQlicmVhazsKCQkJY2FzZSAicmFuZ2UiOgoJCQkJdGhpcy5fYW5pbWF0ZU9mZiA9IHRydWU7CgkJCQl0aGlzLl9yZWZyZXNoKCk7CgkJCQl0aGlzLl9hbmltYXRlT2ZmID0gZmFsc2U7CgkJCQlicmVhazsKCQl9Cgl9LAoKCS8vaW50ZXJuYWwgdmFsdWUgZ2V0dGVyCgkvLyBfdmFsdWUoKSByZXR1cm5zIHZhbHVlIHRyaW1tZWQgYnkgbWluIGFuZCBtYXgsIGFsaWduZWQgYnkgc3RlcAoJX3ZhbHVlOiBmdW5jdGlvbigpIHsKCQl2YXIgdmFsID0gdGhpcy5vcHRpb25zLnZhbHVlOwoJCXZhbCA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKCB2YWwgKTsKCgkJcmV0dXJuIHZhbDsKCX0sCgoJLy9pbnRlcm5hbCB2YWx1ZXMgZ2V0dGVyCgkvLyBfdmFsdWVzKCkgcmV0dXJucyBhcnJheSBvZiB2YWx1ZXMgdHJpbW1lZCBieSBtaW4gYW5kIG1heCwgYWxpZ25lZCBieSBzdGVwCgkvLyBfdmFsdWVzKCBpbmRleCApIHJldHVybnMgc2luZ2xlIHZhbHVlIHRyaW1tZWQgYnkgbWluIGFuZCBtYXgsIGFsaWduZWQgYnkgc3RlcAoJX3ZhbHVlczogZnVuY3Rpb24oIGluZGV4ICkgewoJCXZhciB2YWwsCgkJCXZhbHMsCgkJCWk7CgoJCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQkJdmFsID0gdGhpcy5vcHRpb25zLnZhbHVlc1sgaW5kZXggXTsKCQkJdmFsID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoIHZhbCApOwoKCQkJcmV0dXJuIHZhbDsKCQl9IGVsc2UgaWYgKCB0aGlzLm9wdGlvbnMudmFsdWVzICYmIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoICkgewoJCQkvLyAuc2xpY2UoKSBjcmVhdGVzIGEgY29weSBvZiB0aGUgYXJyYXkKCQkJLy8gdGhpcyBjb3B5IGdldHMgdHJpbW1lZCBieSBtaW4gYW5kIG1heCBhbmQgdGhlbiByZXR1cm5lZAoJCQl2YWxzID0gdGhpcy5vcHRpb25zLnZhbHVlcy5zbGljZSgpOwoJCQlmb3IgKCBpID0gMDsgaSA8IHZhbHMubGVuZ3RoOyBpKz0gMSkgewoJCQkJdmFsc1sgaSBdID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoIHZhbHNbIGkgXSApOwoJCQl9CgoJCQlyZXR1cm4gdmFsczsKCQl9IGVsc2UgewoJCQlyZXR1cm4gW107CgkJfQoJfSwKCgkvLyByZXR1cm5zIHRoZSBzdGVwLWFsaWduZWQgdmFsdWUgdGhhdCB2YWwgaXMgY2xvc2VzdCB0bywgYmV0d2VlbiAoaW5jbHVzaXZlKSBtaW4gYW5kIG1heAoJX3RyaW1BbGlnblZhbHVlOiBmdW5jdGlvbiggdmFsICkgewoJCWlmICggdmFsIDw9IHRoaXMuX3ZhbHVlTWluKCkgKSB7CgkJCXJldHVybiB0aGlzLl92YWx1ZU1pbigpOwoJCX0KCQlpZiAoIHZhbCA+PSB0aGlzLl92YWx1ZU1heCgpICkgewoJCQlyZXR1cm4gdGhpcy5fdmFsdWVNYXgoKTsKCQl9CgkJdmFyIHN0ZXAgPSAoIHRoaXMub3B0aW9ucy5zdGVwID4gMCApID8gdGhpcy5vcHRpb25zLnN0ZXAgOiAxLAoJCQl2YWxNb2RTdGVwID0gKHZhbCAtIHRoaXMuX3ZhbHVlTWluKCkpICUgc3RlcCwKCQkJYWxpZ25WYWx1ZSA9IHZhbCAtIHZhbE1vZFN0ZXA7CgoJCWlmICggTWF0aC5hYnModmFsTW9kU3RlcCkgKiAyID49IHN0ZXAgKSB7CgkJCWFsaWduVmFsdWUgKz0gKCB2YWxNb2RTdGVwID4gMCApID8gc3RlcCA6ICggLXN0ZXAgKTsKCQl9CgoJCS8vIFNpbmNlIEphdmFTY3JpcHQgaGFzIHByb2JsZW1zIHdpdGggbGFyZ2UgZmxvYXRzLCByb3VuZAoJCS8vIHRoZSBmaW5hbCB2YWx1ZSB0byA1IGRpZ2l0cyBhZnRlciB0aGUgZGVjaW1hbCBwb2ludCAoc2VlICM0MTI0KQoJCXJldHVybiBwYXJzZUZsb2F0KCBhbGlnblZhbHVlLnRvRml4ZWQoNSkgKTsKCX0sCgoJX3ZhbHVlTWluOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5vcHRpb25zLm1pbjsKCX0sCgoJX3ZhbHVlTWF4OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5vcHRpb25zLm1heDsKCX0sCgoJX3JlZnJlc2hWYWx1ZTogZnVuY3Rpb24oKSB7CgkJdmFyIGxhc3RWYWxQZXJjZW50LCB2YWxQZXJjZW50LCB2YWx1ZSwgdmFsdWVNaW4sIHZhbHVlTWF4LAoJCQlvUmFuZ2UgPSB0aGlzLm9wdGlvbnMucmFuZ2UsCgkJCW8gPSB0aGlzLm9wdGlvbnMsCgkJCXRoYXQgPSB0aGlzLAoJCQlhbmltYXRlID0gKCAhdGhpcy5fYW5pbWF0ZU9mZiApID8gby5hbmltYXRlIDogZmFsc2UsCgkJCV9zZXQgPSB7fTsKCgkJaWYgKCB0aGlzLm9wdGlvbnMudmFsdWVzICYmIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoICkgewoJCQl0aGlzLmhhbmRsZXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJCXZhbFBlcmNlbnQgPSAoIHRoYXQudmFsdWVzKGkpIC0gdGhhdC5fdmFsdWVNaW4oKSApIC8gKCB0aGF0Ll92YWx1ZU1heCgpIC0gdGhhdC5fdmFsdWVNaW4oKSApICogMTAwOwoJCQkJX3NldFsgdGhhdC5vcmllbnRhdGlvbiA9PT0gImhvcml6b250YWwiID8gImxlZnQiIDogImJvdHRvbSIgXSA9IHZhbFBlcmNlbnQgKyAiJSI7CgkJCQkkKCB0aGlzICkuc3RvcCggMSwgMSApWyBhbmltYXRlID8gImFuaW1hdGUiIDogImNzcyIgXSggX3NldCwgby5hbmltYXRlICk7CgkJCQlpZiAoIHRoYXQub3B0aW9ucy5yYW5nZSA9PT0gdHJ1ZSApIHsKCQkJCQlpZiAoIHRoYXQub3JpZW50YXRpb24gPT09ICJob3Jpem9udGFsIiApIHsKCQkJCQkJaWYgKCBpID09PSAwICkgewoJCQkJCQkJdGhhdC5yYW5nZS5zdG9wKCAxLCAxIClbIGFuaW1hdGUgPyAiYW5pbWF0ZSIgOiAiY3NzIiBdKCB7IGxlZnQ6IHZhbFBlcmNlbnQgKyAiJSIgfSwgby5hbmltYXRlICk7CgkJCQkJCX0KCQkJCQkJaWYgKCBpID09PSAxICkgewoJCQkJCQkJdGhhdC5yYW5nZVsgYW5pbWF0ZSA/ICJhbmltYXRlIiA6ICJjc3MiIF0oIHsgd2lkdGg6ICggdmFsUGVyY2VudCAtIGxhc3RWYWxQZXJjZW50ICkgKyAiJSIgfSwgeyBxdWV1ZTogZmFsc2UsIGR1cmF0aW9uOiBvLmFuaW1hdGUgfSApOwoJCQkJCQl9CgkJCQkJfSBlbHNlIHsKCQkJCQkJaWYgKCBpID09PSAwICkgewoJCQkJCQkJdGhhdC5yYW5nZS5zdG9wKCAxLCAxIClbIGFuaW1hdGUgPyAiYW5pbWF0ZSIgOiAiY3NzIiBdKCB7IGJvdHRvbTogKCB2YWxQZXJjZW50ICkgKyAiJSIgfSwgby5hbmltYXRlICk7CgkJCQkJCX0KCQkJCQkJaWYgKCBpID09PSAxICkgewoJCQkJCQkJdGhhdC5yYW5nZVsgYW5pbWF0ZSA/ICJhbmltYXRlIiA6ICJjc3MiIF0oIHsgaGVpZ2h0OiAoIHZhbFBlcmNlbnQgLSBsYXN0VmFsUGVyY2VudCApICsgIiUiIH0sIHsgcXVldWU6IGZhbHNlLCBkdXJhdGlvbjogby5hbmltYXRlIH0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCWxhc3RWYWxQZXJjZW50ID0gdmFsUGVyY2VudDsKCQkJfSk7CgkJfSBlbHNlIHsKCQkJdmFsdWUgPSB0aGlzLnZhbHVlKCk7CgkJCXZhbHVlTWluID0gdGhpcy5fdmFsdWVNaW4oKTsKCQkJdmFsdWVNYXggPSB0aGlzLl92YWx1ZU1heCgpOwoJCQl2YWxQZXJjZW50ID0gKCB2YWx1ZU1heCAhPT0gdmFsdWVNaW4gKSA/CgkJCQkJKCB2YWx1ZSAtIHZhbHVlTWluICkgLyAoIHZhbHVlTWF4IC0gdmFsdWVNaW4gKSAqIDEwMCA6CgkJCQkJMDsKCQkJX3NldFsgdGhpcy5vcmllbnRhdGlvbiA9PT0gImhvcml6b250YWwiID8gImxlZnQiIDogImJvdHRvbSIgXSA9IHZhbFBlcmNlbnQgKyAiJSI7CgkJCXRoaXMuaGFuZGxlLnN0b3AoIDEsIDEgKVsgYW5pbWF0ZSA/ICJhbmltYXRlIiA6ICJjc3MiIF0oIF9zZXQsIG8uYW5pbWF0ZSApOwoKCQkJaWYgKCBvUmFuZ2UgPT09ICJtaW4iICYmIHRoaXMub3JpZW50YXRpb24gPT09ICJob3Jpem9udGFsIiApIHsKCQkJCXRoaXMucmFuZ2Uuc3RvcCggMSwgMSApWyBhbmltYXRlID8gImFuaW1hdGUiIDogImNzcyIgXSggeyB3aWR0aDogdmFsUGVyY2VudCArICIlIiB9LCBvLmFuaW1hdGUgKTsKCQkJfQoJCQlpZiAoIG9SYW5nZSA9PT0gIm1heCIgJiYgdGhpcy5vcmllbnRhdGlvbiA9PT0gImhvcml6b250YWwiICkgewoJCQkJdGhpcy5yYW5nZVsgYW5pbWF0ZSA/ICJhbmltYXRlIiA6ICJjc3MiIF0oIHsgd2lkdGg6ICggMTAwIC0gdmFsUGVyY2VudCApICsgIiUiIH0sIHsgcXVldWU6IGZhbHNlLCBkdXJhdGlvbjogby5hbmltYXRlIH0gKTsKCQkJfQoJCQlpZiAoIG9SYW5nZSA9PT0gIm1pbiIgJiYgdGhpcy5vcmllbnRhdGlvbiA9PT0gInZlcnRpY2FsIiApIHsKCQkJCXRoaXMucmFuZ2Uuc3RvcCggMSwgMSApWyBhbmltYXRlID8gImFuaW1hdGUiIDogImNzcyIgXSggeyBoZWlnaHQ6IHZhbFBlcmNlbnQgKyAiJSIgfSwgby5hbmltYXRlICk7CgkJCX0KCQkJaWYgKCBvUmFuZ2UgPT09ICJtYXgiICYmIHRoaXMub3JpZW50YXRpb24gPT09ICJ2ZXJ0aWNhbCIgKSB7CgkJCQl0aGlzLnJhbmdlWyBhbmltYXRlID8gImFuaW1hdGUiIDogImNzcyIgXSggeyBoZWlnaHQ6ICggMTAwIC0gdmFsUGVyY2VudCApICsgIiUiIH0sIHsgcXVldWU6IGZhbHNlLCBkdXJhdGlvbjogby5hbmltYXRlIH0gKTsKCQkJfQoJCX0KCX0sCgoJX2hhbmRsZUV2ZW50czogewoJCWtleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJdmFyIGFsbG93ZWQsIGN1clZhbCwgbmV3VmFsLCBzdGVwLAoJCQkJaW5kZXggPSAkKCBldmVudC50YXJnZXQgKS5kYXRhKCAidWktc2xpZGVyLWhhbmRsZS1pbmRleCIgKTsKCgkJCXN3aXRjaCAoIGV2ZW50LmtleUNvZGUgKSB7CgkJCQljYXNlICQudWkua2V5Q29kZS5IT01FOgoJCQkJY2FzZSAkLnVpLmtleUNvZGUuRU5EOgoJCQkJY2FzZSAkLnVpLmtleUNvZGUuUEFHRV9VUDoKCQkJCWNhc2UgJC51aS5rZXlDb2RlLlBBR0VfRE9XTjoKCQkJCWNhc2UgJC51aS5rZXlDb2RlLlVQOgoJCQkJY2FzZSAkLnVpLmtleUNvZGUuUklHSFQ6CgkJCQljYXNlICQudWkua2V5Q29kZS5ET1dOOgoJCQkJY2FzZSAkLnVpLmtleUNvZGUuTEVGVDoKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJCWlmICggIXRoaXMuX2tleVNsaWRpbmcgKSB7CgkJCQkJCXRoaXMuX2tleVNsaWRpbmcgPSB0cnVlOwoJCQkJCQkkKCBldmVudC50YXJnZXQgKS5hZGRDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKTsKCQkJCQkJYWxsb3dlZCA9IHRoaXMuX3N0YXJ0KCBldmVudCwgaW5kZXggKTsKCQkJCQkJaWYgKCBhbGxvd2VkID09PSBmYWxzZSApIHsKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQkJCX0KCQkJCQlicmVhazsKCQkJfQoKCQkJc3RlcCA9IHRoaXMub3B0aW9ucy5zdGVwOwoJCQlpZiAoIHRoaXMub3B0aW9ucy52YWx1ZXMgJiYgdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGggKSB7CgkJCQljdXJWYWwgPSBuZXdWYWwgPSB0aGlzLnZhbHVlcyggaW5kZXggKTsKCQkJfSBlbHNlIHsKCQkJCWN1clZhbCA9IG5ld1ZhbCA9IHRoaXMudmFsdWUoKTsKCQkJfQoKCQkJc3dpdGNoICggZXZlbnQua2V5Q29kZSApIHsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLkhPTUU6CgkJCQkJbmV3VmFsID0gdGhpcy5fdmFsdWVNaW4oKTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLkVORDoKCQkJCQluZXdWYWwgPSB0aGlzLl92YWx1ZU1heCgpOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAkLnVpLmtleUNvZGUuUEFHRV9VUDoKCQkJCQluZXdWYWwgPSB0aGlzLl90cmltQWxpZ25WYWx1ZSgKCQkJCQkJY3VyVmFsICsgKCAoIHRoaXMuX3ZhbHVlTWF4KCkgLSB0aGlzLl92YWx1ZU1pbigpICkgLyB0aGlzLm51bVBhZ2VzICkKCQkJCQkpOwoJCQkJCWJyZWFrOwoJCQkJY2FzZSAkLnVpLmtleUNvZGUuUEFHRV9ET1dOOgoJCQkJCW5ld1ZhbCA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKAoJCQkJCQljdXJWYWwgLSAoICh0aGlzLl92YWx1ZU1heCgpIC0gdGhpcy5fdmFsdWVNaW4oKSkgLyB0aGlzLm51bVBhZ2VzICkgKTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLlVQOgoJCQkJY2FzZSAkLnVpLmtleUNvZGUuUklHSFQ6CgkJCQkJaWYgKCBjdXJWYWwgPT09IHRoaXMuX3ZhbHVlTWF4KCkgKSB7CgkJCQkJCXJldHVybjsKCQkJCQl9CgkJCQkJbmV3VmFsID0gdGhpcy5fdHJpbUFsaWduVmFsdWUoIGN1clZhbCArIHN0ZXAgKTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJC51aS5rZXlDb2RlLkRPV046CgkJCQljYXNlICQudWkua2V5Q29kZS5MRUZUOgoJCQkJCWlmICggY3VyVmFsID09PSB0aGlzLl92YWx1ZU1pbigpICkgewoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJCW5ld1ZhbCA9IHRoaXMuX3RyaW1BbGlnblZhbHVlKCBjdXJWYWwgLSBzdGVwICk7CgkJCQkJYnJlYWs7CgkJCX0KCgkJCXRoaXMuX3NsaWRlKCBldmVudCwgaW5kZXgsIG5ld1ZhbCApOwoJCX0sCgkJa2V5dXA6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJdmFyIGluZGV4ID0gJCggZXZlbnQudGFyZ2V0ICkuZGF0YSggInVpLXNsaWRlci1oYW5kbGUtaW5kZXgiICk7CgoJCQlpZiAoIHRoaXMuX2tleVNsaWRpbmcgKSB7CgkJCQl0aGlzLl9rZXlTbGlkaW5nID0gZmFsc2U7CgkJCQl0aGlzLl9zdG9wKCBldmVudCwgaW5kZXggKTsKCQkJCXRoaXMuX2NoYW5nZSggZXZlbnQsIGluZGV4ICk7CgkJCQkkKCBldmVudC50YXJnZXQgKS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWFjdGl2ZSIgKTsKCQkJfQoJCX0KCX0KfSk7CgoKLyohCiAqIGpRdWVyeSBVSSBTb3J0YWJsZSAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS9zb3J0YWJsZS8KICovCgoKdmFyIHNvcnRhYmxlID0gJC53aWRnZXQoInVpLnNvcnRhYmxlIiwgJC51aS5tb3VzZSwgewoJdmVyc2lvbjogIjEuMTEuMSIsCgl3aWRnZXRFdmVudFByZWZpeDogInNvcnQiLAoJcmVhZHk6IGZhbHNlLAoJb3B0aW9uczogewoJCWFwcGVuZFRvOiAicGFyZW50IiwKCQlheGlzOiBmYWxzZSwKCQljb25uZWN0V2l0aDogZmFsc2UsCgkJY29udGFpbm1lbnQ6IGZhbHNlLAoJCWN1cnNvcjogImF1dG8iLAoJCWN1cnNvckF0OiBmYWxzZSwKCQlkcm9wT25FbXB0eTogdHJ1ZSwKCQlmb3JjZVBsYWNlaG9sZGVyU2l6ZTogZmFsc2UsCgkJZm9yY2VIZWxwZXJTaXplOiBmYWxzZSwKCQlncmlkOiBmYWxzZSwKCQloYW5kbGU6IGZhbHNlLAoJCWhlbHBlcjogIm9yaWdpbmFsIiwKCQlpdGVtczogIj4gKiIsCgkJb3BhY2l0eTogZmFsc2UsCgkJcGxhY2Vob2xkZXI6IGZhbHNlLAoJCXJldmVydDogZmFsc2UsCgkJc2Nyb2xsOiB0cnVlLAoJCXNjcm9sbFNlbnNpdGl2aXR5OiAyMCwKCQlzY3JvbGxTcGVlZDogMjAsCgkJc2NvcGU6ICJkZWZhdWx0IiwKCQl0b2xlcmFuY2U6ICJpbnRlcnNlY3QiLAoJCXpJbmRleDogMTAwMCwKCgkJLy8gY2FsbGJhY2tzCgkJYWN0aXZhdGU6IG51bGwsCgkJYmVmb3JlU3RvcDogbnVsbCwKCQljaGFuZ2U6IG51bGwsCgkJZGVhY3RpdmF0ZTogbnVsbCwKCQlvdXQ6IG51bGwsCgkJb3ZlcjogbnVsbCwKCQlyZWNlaXZlOiBudWxsLAoJCXJlbW92ZTogbnVsbCwKCQlzb3J0OiBudWxsLAoJCXN0YXJ0OiBudWxsLAoJCXN0b3A6IG51bGwsCgkJdXBkYXRlOiBudWxsCgl9LAoKCV9pc092ZXJBeGlzOiBmdW5jdGlvbiggeCwgcmVmZXJlbmNlLCBzaXplICkgewoJCXJldHVybiAoIHggPj0gcmVmZXJlbmNlICkgJiYgKCB4IDwgKCByZWZlcmVuY2UgKyBzaXplICkgKTsKCX0sCgoJX2lzRmxvYXRpbmc6IGZ1bmN0aW9uKCBpdGVtICkgewoJCXJldHVybiAoL2xlZnR8cmlnaHQvKS50ZXN0KGl0ZW0uY3NzKCJmbG9hdCIpKSB8fCAoL2lubGluZXx0YWJsZS1jZWxsLykudGVzdChpdGVtLmNzcygiZGlzcGxheSIpKTsKCX0sCgoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgoJCXZhciBvID0gdGhpcy5vcHRpb25zOwoJCXRoaXMuY29udGFpbmVyQ2FjaGUgPSB7fTsKCQl0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLXNvcnRhYmxlIik7CgoJCS8vR2V0IHRoZSBpdGVtcwoJCXRoaXMucmVmcmVzaCgpOwoKCQkvL0xldCdzIGRldGVybWluZSBpZiB0aGUgaXRlbXMgYXJlIGJlaW5nIGRpc3BsYXllZCBob3Jpem9udGFsbHkKCQl0aGlzLmZsb2F0aW5nID0gdGhpcy5pdGVtcy5sZW5ndGggPyBvLmF4aXMgPT09ICJ4IiB8fCB0aGlzLl9pc0Zsb2F0aW5nKHRoaXMuaXRlbXNbMF0uaXRlbSkgOiBmYWxzZTsKCgkJLy9MZXQncyBkZXRlcm1pbmUgdGhlIHBhcmVudCdzIG9mZnNldAoJCXRoaXMub2Zmc2V0ID0gdGhpcy5lbGVtZW50Lm9mZnNldCgpOwoKCQkvL0luaXRpYWxpemUgbW91c2UgZXZlbnRzIGZvciBpbnRlcmFjdGlvbgoJCXRoaXMuX21vdXNlSW5pdCgpOwoKCQl0aGlzLl9zZXRIYW5kbGVDbGFzc05hbWUoKTsKCgkJLy9XZSdyZSByZWFkeSB0byBnbwoJCXRoaXMucmVhZHkgPSB0cnVlOwoKCX0sCgoJX3NldE9wdGlvbjogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUgKTsKCgkJaWYgKCBrZXkgPT09ICJoYW5kbGUiICkgewoJCQl0aGlzLl9zZXRIYW5kbGVDbGFzc05hbWUoKTsKCQl9Cgl9LAoKCV9zZXRIYW5kbGVDbGFzc05hbWU6IGZ1bmN0aW9uKCkgewoJCXRoaXMuZWxlbWVudC5maW5kKCAiLnVpLXNvcnRhYmxlLWhhbmRsZSIgKS5yZW1vdmVDbGFzcyggInVpLXNvcnRhYmxlLWhhbmRsZSIgKTsKCQkkLmVhY2goIHRoaXMuaXRlbXMsIGZ1bmN0aW9uKCkgewoJCQkoIHRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oYW5kbGUgPwoJCQkJdGhpcy5pdGVtLmZpbmQoIHRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oYW5kbGUgKSA6IHRoaXMuaXRlbSApCgkJCQkuYWRkQ2xhc3MoICJ1aS1zb3J0YWJsZS1oYW5kbGUiICk7CgkJfSk7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCAidWktc29ydGFibGUgdWktc29ydGFibGUtZGlzYWJsZWQiICkKCQkJLmZpbmQoICIudWktc29ydGFibGUtaGFuZGxlIiApCgkJCQkucmVtb3ZlQ2xhc3MoICJ1aS1zb3J0YWJsZS1oYW5kbGUiICk7CgkJdGhpcy5fbW91c2VEZXN0cm95KCk7CgoJCWZvciAoIHZhciBpID0gdGhpcy5pdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSApIHsKCQkJdGhpcy5pdGVtc1tpXS5pdGVtLnJlbW92ZURhdGEodGhpcy53aWRnZXROYW1lICsgIi1pdGVtIik7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJX21vdXNlQ2FwdHVyZTogZnVuY3Rpb24oZXZlbnQsIG92ZXJyaWRlSGFuZGxlKSB7CgkJdmFyIGN1cnJlbnRJdGVtID0gbnVsbCwKCQkJdmFsaWRIYW5kbGUgPSBmYWxzZSwKCQkJdGhhdCA9IHRoaXM7CgoJCWlmICh0aGlzLnJldmVydGluZykgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlpZih0aGlzLm9wdGlvbnMuZGlzYWJsZWQgfHwgdGhpcy5vcHRpb25zLnR5cGUgPT09ICJzdGF0aWMiKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCS8vV2UgaGF2ZSB0byByZWZyZXNoIHRoZSBpdGVtcyBkYXRhIG9uY2UgZmlyc3QKCQl0aGlzLl9yZWZyZXNoSXRlbXMoZXZlbnQpOwoKCQkvL0ZpbmQgb3V0IGlmIHRoZSBjbGlja2VkIG5vZGUgKG9yIG9uZSBvZiBpdHMgcGFyZW50cykgaXMgYSBhY3R1YWwgaXRlbSBpbiB0aGlzLml0ZW1zCgkJJChldmVudC50YXJnZXQpLnBhcmVudHMoKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZigkLmRhdGEodGhpcywgdGhhdC53aWRnZXROYW1lICsgIi1pdGVtIikgPT09IHRoYXQpIHsKCQkJCWN1cnJlbnRJdGVtID0gJCh0aGlzKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0pOwoJCWlmKCQuZGF0YShldmVudC50YXJnZXQsIHRoYXQud2lkZ2V0TmFtZSArICItaXRlbSIpID09PSB0aGF0KSB7CgkJCWN1cnJlbnRJdGVtID0gJChldmVudC50YXJnZXQpOwoJCX0KCgkJaWYoIWN1cnJlbnRJdGVtKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJaWYodGhpcy5vcHRpb25zLmhhbmRsZSAmJiAhb3ZlcnJpZGVIYW5kbGUpIHsKCQkJJCh0aGlzLm9wdGlvbnMuaGFuZGxlLCBjdXJyZW50SXRlbSkuZmluZCgiKiIpLmFkZEJhY2soKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJaWYodGhpcyA9PT0gZXZlbnQudGFyZ2V0KSB7CgkJCQkJdmFsaWRIYW5kbGUgPSB0cnVlOwoJCQkJfQoJCQl9KTsKCQkJaWYoIXZhbGlkSGFuZGxlKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9CgoJCXRoaXMuY3VycmVudEl0ZW0gPSBjdXJyZW50SXRlbTsKCQl0aGlzLl9yZW1vdmVDdXJyZW50c0Zyb21JdGVtcygpOwoJCXJldHVybiB0cnVlOwoKCX0sCgoJX21vdXNlU3RhcnQ6IGZ1bmN0aW9uKGV2ZW50LCBvdmVycmlkZUhhbmRsZSwgbm9BY3RpdmF0aW9uKSB7CgoJCXZhciBpLCBib2R5LAoJCQlvID0gdGhpcy5vcHRpb25zOwoKCQl0aGlzLmN1cnJlbnRDb250YWluZXIgPSB0aGlzOwoKCQkvL1dlIG9ubHkgbmVlZCB0byBjYWxsIHJlZnJlc2hQb3NpdGlvbnMsIGJlY2F1c2UgdGhlIHJlZnJlc2hJdGVtcyBjYWxsIGhhcyBiZWVuIG1vdmVkIHRvIG1vdXNlQ2FwdHVyZQoJCXRoaXMucmVmcmVzaFBvc2l0aW9ucygpOwoKCQkvL0NyZWF0ZSBhbmQgYXBwZW5kIHRoZSB2aXNpYmxlIGhlbHBlcgoJCXRoaXMuaGVscGVyID0gdGhpcy5fY3JlYXRlSGVscGVyKGV2ZW50KTsKCgkJLy9DYWNoZSB0aGUgaGVscGVyIHNpemUKCQl0aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCk7CgoJCS8qCgkJICogLSBQb3NpdGlvbiBnZW5lcmF0aW9uIC0KCQkgKiBUaGlzIGJsb2NrIGdlbmVyYXRlcyBldmVyeXRoaW5nIHBvc2l0aW9uIHJlbGF0ZWQgLSBpdCdzIHRoZSBjb3JlIG9mIGRyYWdnYWJsZXMuCgkJICovCgoJCS8vQ2FjaGUgdGhlIG1hcmdpbnMgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnQKCQl0aGlzLl9jYWNoZU1hcmdpbnMoKTsKCgkJLy9HZXQgdGhlIG5leHQgc2Nyb2xsaW5nIHBhcmVudAoJCXRoaXMuc2Nyb2xsUGFyZW50ID0gdGhpcy5oZWxwZXIuc2Nyb2xsUGFyZW50KCk7CgoJCS8vVGhlIGVsZW1lbnQncyBhYnNvbHV0ZSBwb3NpdGlvbiBvbiB0aGUgcGFnZSBtaW51cyBtYXJnaW5zCgkJdGhpcy5vZmZzZXQgPSB0aGlzLmN1cnJlbnRJdGVtLm9mZnNldCgpOwoJCXRoaXMub2Zmc2V0ID0gewoJCQl0b3A6IHRoaXMub2Zmc2V0LnRvcCAtIHRoaXMubWFyZ2lucy50b3AsCgkJCWxlZnQ6IHRoaXMub2Zmc2V0LmxlZnQgLSB0aGlzLm1hcmdpbnMubGVmdAoJCX07CgoJCSQuZXh0ZW5kKHRoaXMub2Zmc2V0LCB7CgkJCWNsaWNrOiB7IC8vV2hlcmUgdGhlIGNsaWNrIGhhcHBlbmVkLCByZWxhdGl2ZSB0byB0aGUgZWxlbWVudAoJCQkJbGVmdDogZXZlbnQucGFnZVggLSB0aGlzLm9mZnNldC5sZWZ0LAoJCQkJdG9wOiBldmVudC5wYWdlWSAtIHRoaXMub2Zmc2V0LnRvcAoJCQl9LAoJCQlwYXJlbnQ6IHRoaXMuX2dldFBhcmVudE9mZnNldCgpLAoJCQlyZWxhdGl2ZTogdGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKSAvL1RoaXMgaXMgYSByZWxhdGl2ZSB0byBhYnNvbHV0ZSBwb3NpdGlvbiBtaW51cyB0aGUgYWN0dWFsIHBvc2l0aW9uIGNhbGN1bGF0aW9uIC0gb25seSB1c2VkIGZvciByZWxhdGl2ZSBwb3NpdGlvbmVkIGhlbHBlcgoJCX0pOwoKCQkvLyBPbmx5IGFmdGVyIHdlIGdvdCB0aGUgb2Zmc2V0LCB3ZSBjYW4gY2hhbmdlIHRoZSBoZWxwZXIncyBwb3NpdGlvbiB0byBhYnNvbHV0ZQoJCS8vIFRPRE86IFN0aWxsIG5lZWQgdG8gZmlndXJlIG91dCBhIHdheSB0byBtYWtlIHJlbGF0aXZlIHNvcnRpbmcgcG9zc2libGUKCQl0aGlzLmhlbHBlci5jc3MoInBvc2l0aW9uIiwgImFic29sdXRlIik7CgkJdGhpcy5jc3NQb3NpdGlvbiA9IHRoaXMuaGVscGVyLmNzcygicG9zaXRpb24iKTsKCgkJLy9HZW5lcmF0ZSB0aGUgb3JpZ2luYWwgcG9zaXRpb24KCQl0aGlzLm9yaWdpbmFsUG9zaXRpb24gPSB0aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKGV2ZW50KTsKCQl0aGlzLm9yaWdpbmFsUGFnZVggPSBldmVudC5wYWdlWDsKCQl0aGlzLm9yaWdpbmFsUGFnZVkgPSBldmVudC5wYWdlWTsKCgkJLy9BZGp1c3QgdGhlIG1vdXNlIG9mZnNldCByZWxhdGl2ZSB0byB0aGUgaGVscGVyIGlmICJjdXJzb3JBdCIgaXMgc3VwcGxpZWQKCQkoby5jdXJzb3JBdCAmJiB0aGlzLl9hZGp1c3RPZmZzZXRGcm9tSGVscGVyKG8uY3Vyc29yQXQpKTsKCgkJLy9DYWNoZSB0aGUgZm9ybWVyIERPTSBwb3NpdGlvbgoJCXRoaXMuZG9tUG9zaXRpb24gPSB7IHByZXY6IHRoaXMuY3VycmVudEl0ZW0ucHJldigpWzBdLCBwYXJlbnQ6IHRoaXMuY3VycmVudEl0ZW0ucGFyZW50KClbMF0gfTsKCgkJLy9JZiB0aGUgaGVscGVyIGlzIG5vdCB0aGUgb3JpZ2luYWwsIGhpZGUgdGhlIG9yaWdpbmFsIHNvIGl0J3Mgbm90IHBsYXlpbmcgYW55IHJvbGUgZHVyaW5nIHRoZSBkcmFnLCB3b24ndCBjYXVzZSBhbnl0aGluZyBiYWQgdGhpcyB3YXkKCQlpZih0aGlzLmhlbHBlclswXSAhPT0gdGhpcy5jdXJyZW50SXRlbVswXSkgewoJCQl0aGlzLmN1cnJlbnRJdGVtLmhpZGUoKTsKCQl9CgoJCS8vQ3JlYXRlIHRoZSBwbGFjZWhvbGRlcgoJCXRoaXMuX2NyZWF0ZVBsYWNlaG9sZGVyKCk7CgoJCS8vU2V0IGEgY29udGFpbm1lbnQgaWYgZ2l2ZW4gaW4gdGhlIG9wdGlvbnMKCQlpZihvLmNvbnRhaW5tZW50KSB7CgkJCXRoaXMuX3NldENvbnRhaW5tZW50KCk7CgkJfQoKCQlpZiggby5jdXJzb3IgJiYgby5jdXJzb3IgIT09ICJhdXRvIiApIHsgLy8gY3Vyc29yIG9wdGlvbgoJCQlib2R5ID0gdGhpcy5kb2N1bWVudC5maW5kKCAiYm9keSIgKTsKCgkJCS8vIHN1cHBvcnQ6IElFCgkJCXRoaXMuc3RvcmVkQ3Vyc29yID0gYm9keS5jc3MoICJjdXJzb3IiICk7CgkJCWJvZHkuY3NzKCAiY3Vyc29yIiwgby5jdXJzb3IgKTsKCgkJCXRoaXMuc3RvcmVkU3R5bGVzaGVldCA9ICQoICI8c3R5bGU+KnsgY3Vyc29yOiAiK28uY3Vyc29yKyIgIWltcG9ydGFudDsgfTwvc3R5bGU+IiApLmFwcGVuZFRvKCBib2R5ICk7CgkJfQoKCQlpZihvLm9wYWNpdHkpIHsgLy8gb3BhY2l0eSBvcHRpb24KCQkJaWYgKHRoaXMuaGVscGVyLmNzcygib3BhY2l0eSIpKSB7CgkJCQl0aGlzLl9zdG9yZWRPcGFjaXR5ID0gdGhpcy5oZWxwZXIuY3NzKCJvcGFjaXR5Iik7CgkJCX0KCQkJdGhpcy5oZWxwZXIuY3NzKCJvcGFjaXR5Iiwgby5vcGFjaXR5KTsKCQl9CgoJCWlmKG8uekluZGV4KSB7IC8vIHpJbmRleCBvcHRpb24KCQkJaWYgKHRoaXMuaGVscGVyLmNzcygiekluZGV4IikpIHsKCQkJCXRoaXMuX3N0b3JlZFpJbmRleCA9IHRoaXMuaGVscGVyLmNzcygiekluZGV4Iik7CgkJCX0KCQkJdGhpcy5oZWxwZXIuY3NzKCJ6SW5kZXgiLCBvLnpJbmRleCk7CgkJfQoKCQkvL1ByZXBhcmUgc2Nyb2xsaW5nCgkJaWYodGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IGRvY3VtZW50ICYmIHRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUgIT09ICJIVE1MIikgewoJCQl0aGlzLm92ZXJmbG93T2Zmc2V0ID0gdGhpcy5zY3JvbGxQYXJlbnQub2Zmc2V0KCk7CgkJfQoKCQkvL0NhbGwgY2FsbGJhY2tzCgkJdGhpcy5fdHJpZ2dlcigic3RhcnQiLCBldmVudCwgdGhpcy5fdWlIYXNoKCkpOwoKCQkvL1JlY2FjaGUgdGhlIGhlbHBlciBzaXplCgkJaWYoIXRoaXMuX3ByZXNlcnZlSGVscGVyUHJvcG9ydGlvbnMpIHsKCQkJdGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpOwoJCX0KCgoJCS8vUG9zdCAiYWN0aXZhdGUiIGV2ZW50cyB0byBwb3NzaWJsZSBjb250YWluZXJzCgkJaWYoICFub0FjdGl2YXRpb24gKSB7CgkJCWZvciAoIGkgPSB0aGlzLmNvbnRhaW5lcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0gKSB7CgkJCQl0aGlzLmNvbnRhaW5lcnNbIGkgXS5fdHJpZ2dlciggImFjdGl2YXRlIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCggdGhpcyApICk7CgkJCX0KCQl9CgoJCS8vUHJlcGFyZSBwb3NzaWJsZSBkcm9wcGFibGVzCgkJaWYoJC51aS5kZG1hbmFnZXIpIHsKCQkJJC51aS5kZG1hbmFnZXIuY3VycmVudCA9IHRoaXM7CgkJfQoKCQlpZiAoJC51aS5kZG1hbmFnZXIgJiYgIW8uZHJvcEJlaGF2aW91cikgewoJCQkkLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLCBldmVudCk7CgkJfQoKCQl0aGlzLmRyYWdnaW5nID0gdHJ1ZTsKCgkJdGhpcy5oZWxwZXIuYWRkQ2xhc3MoInVpLXNvcnRhYmxlLWhlbHBlciIpOwoJCXRoaXMuX21vdXNlRHJhZyhldmVudCk7IC8vRXhlY3V0ZSB0aGUgZHJhZyBvbmNlIC0gdGhpcyBjYXVzZXMgdGhlIGhlbHBlciBub3QgdG8gYmUgdmlzaWJsZSBiZWZvcmUgZ2V0dGluZyBpdHMgY29ycmVjdCBwb3NpdGlvbgoJCXJldHVybiB0cnVlOwoKCX0sCgoJX21vdXNlRHJhZzogZnVuY3Rpb24oZXZlbnQpIHsKCQl2YXIgaSwgaXRlbSwgaXRlbUVsZW1lbnQsIGludGVyc2VjdGlvbiwKCQkJbyA9IHRoaXMub3B0aW9ucywKCQkJc2Nyb2xsZWQgPSBmYWxzZTsKCgkJLy9Db21wdXRlIHRoZSBoZWxwZXJzIHBvc2l0aW9uCgkJdGhpcy5wb3NpdGlvbiA9IHRoaXMuX2dlbmVyYXRlUG9zaXRpb24oZXZlbnQpOwoJCXRoaXMucG9zaXRpb25BYnMgPSB0aGlzLl9jb252ZXJ0UG9zaXRpb25UbygiYWJzb2x1dGUiKTsKCgkJaWYgKCF0aGlzLmxhc3RQb3NpdGlvbkFicykgewoJCQl0aGlzLmxhc3RQb3NpdGlvbkFicyA9IHRoaXMucG9zaXRpb25BYnM7CgkJfQoKCQkvL0RvIHNjcm9sbGluZwoJCWlmKHRoaXMub3B0aW9ucy5zY3JvbGwpIHsKCQkJaWYodGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IGRvY3VtZW50ICYmIHRoaXMuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUgIT09ICJIVE1MIikgewoKCQkJCWlmKCh0aGlzLm92ZXJmbG93T2Zmc2V0LnRvcCArIHRoaXMuc2Nyb2xsUGFyZW50WzBdLm9mZnNldEhlaWdodCkgLSBldmVudC5wYWdlWSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AgPSBzY3JvbGxlZCA9IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCArIG8uc2Nyb2xsU3BlZWQ7CgkJCQl9IGVsc2UgaWYoZXZlbnQucGFnZVkgLSB0aGlzLm92ZXJmbG93T2Zmc2V0LnRvcCA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQl0aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AgPSBzY3JvbGxlZCA9IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCAtIG8uc2Nyb2xsU3BlZWQ7CgkJCQl9CgoJCQkJaWYoKHRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdCArIHRoaXMuc2Nyb2xsUGFyZW50WzBdLm9mZnNldFdpZHRoKSAtIGV2ZW50LnBhZ2VYIDwgby5zY3JvbGxTZW5zaXRpdml0eSkgewoJCQkJCXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQgPSBzY3JvbGxlZCA9IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQgKyBvLnNjcm9sbFNwZWVkOwoJCQkJfSBlbHNlIGlmKGV2ZW50LnBhZ2VYIC0gdGhpcy5vdmVyZmxvd09mZnNldC5sZWZ0IDwgby5zY3JvbGxTZW5zaXRpdml0eSkgewoJCQkJCXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQgPSBzY3JvbGxlZCA9IHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQgLSBvLnNjcm9sbFNwZWVkOwoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZihldmVudC5wYWdlWSAtICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpIDwgby5zY3JvbGxTZW5zaXRpdml0eSkgewoJCQkJCXNjcm9sbGVkID0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpIC0gby5zY3JvbGxTcGVlZCk7CgkJCQl9IGVsc2UgaWYoJCh3aW5kb3cpLmhlaWdodCgpIC0gKGV2ZW50LnBhZ2VZIC0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkpIDwgby5zY3JvbGxTZW5zaXRpdml0eSkgewoJCQkJCXNjcm9sbGVkID0gJChkb2N1bWVudCkuc2Nyb2xsVG9wKCQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpICsgby5zY3JvbGxTcGVlZCk7CgkJCQl9CgoJCQkJaWYoZXZlbnQucGFnZVggLSAkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkgPCBvLnNjcm9sbFNlbnNpdGl2aXR5KSB7CgkJCQkJc2Nyb2xsZWQgPSAkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSAtIG8uc2Nyb2xsU3BlZWQpOwoJCQkJfSBlbHNlIGlmKCQod2luZG93KS53aWR0aCgpIC0gKGV2ZW50LnBhZ2VYIC0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKSA8IG8uc2Nyb2xsU2Vuc2l0aXZpdHkpIHsKCQkJCQlzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpICsgby5zY3JvbGxTcGVlZCk7CgkJCQl9CgoJCQl9CgoJCQlpZihzY3JvbGxlZCAhPT0gZmFsc2UgJiYgJC51aS5kZG1hbmFnZXIgJiYgIW8uZHJvcEJlaGF2aW91cikgewoJCQkJJC51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModGhpcywgZXZlbnQpOwoJCQl9CgkJfQoKCQkvL1JlZ2VuZXJhdGUgdGhlIGFic29sdXRlIHBvc2l0aW9uIHVzZWQgZm9yIHBvc2l0aW9uIGNoZWNrcwoJCXRoaXMucG9zaXRpb25BYnMgPSB0aGlzLl9jb252ZXJ0UG9zaXRpb25UbygiYWJzb2x1dGUiKTsKCgkJLy9TZXQgdGhlIGhlbHBlciBwb3NpdGlvbgoJCWlmKCF0aGlzLm9wdGlvbnMuYXhpcyB8fCB0aGlzLm9wdGlvbnMuYXhpcyAhPT0gInkiKSB7CgkJCXRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQgPSB0aGlzLnBvc2l0aW9uLmxlZnQrInB4IjsKCQl9CgkJaWYoIXRoaXMub3B0aW9ucy5heGlzIHx8IHRoaXMub3B0aW9ucy5heGlzICE9PSAieCIpIHsKCQkJdGhpcy5oZWxwZXJbMF0uc3R5bGUudG9wID0gdGhpcy5wb3NpdGlvbi50b3ArInB4IjsKCQl9CgoJCS8vUmVhcnJhbmdlCgkJZm9yIChpID0gdGhpcy5pdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewoKCQkJLy9DYWNoZSB2YXJpYWJsZXMgYW5kIGludGVyc2VjdGlvbiwgY29udGludWUgaWYgbm8gaW50ZXJzZWN0aW9uCgkJCWl0ZW0gPSB0aGlzLml0ZW1zW2ldOwoJCQlpdGVtRWxlbWVudCA9IGl0ZW0uaXRlbVswXTsKCQkJaW50ZXJzZWN0aW9uID0gdGhpcy5faW50ZXJzZWN0c1dpdGhQb2ludGVyKGl0ZW0pOwoJCQlpZiAoIWludGVyc2VjdGlvbikgewoJCQkJY29udGludWU7CgkJCX0KCgkJCS8vIE9ubHkgcHV0IHRoZSBwbGFjZWhvbGRlciBpbnNpZGUgdGhlIGN1cnJlbnQgQ29udGFpbmVyLCBza2lwIGFsbAoJCQkvLyBpdGVtcyBmcm9tIG90aGVyIGNvbnRhaW5lcnMuIFRoaXMgd29ya3MgYmVjYXVzZSB3aGVuIG1vdmluZwoJCQkvLyBhbiBpdGVtIGZyb20gb25lIGNvbnRhaW5lciB0byBhbm90aGVyIHRoZQoJCQkvLyBjdXJyZW50Q29udGFpbmVyIGlzIHN3aXRjaGVkIGJlZm9yZSB0aGUgcGxhY2Vob2xkZXIgaXMgbW92ZWQuCgkJCS8vCgkJCS8vIFdpdGhvdXQgdGhpcywgbW92aW5nIGl0ZW1zIGluICJzdWItc29ydGFibGVzIiBjYW4gY2F1c2UKCQkJLy8gdGhlIHBsYWNlaG9sZGVyIHRvIGppdHRlciBiZXR3ZWVuIHRoZSBvdXRlciBhbmQgaW5uZXIgY29udGFpbmVyLgoJCQlpZiAoaXRlbS5pbnN0YW5jZSAhPT0gdGhpcy5jdXJyZW50Q29udGFpbmVyKSB7CgkJCQljb250aW51ZTsKCQkJfQoKCQkJLy8gY2Fubm90IGludGVyc2VjdCB3aXRoIGl0c2VsZgoJCQkvLyBubyB1c2VsZXNzIGFjdGlvbnMgdGhhdCBoYXZlIGJlZW4gZG9uZSBiZWZvcmUKCQkJLy8gbm8gYWN0aW9uIGlmIHRoZSBpdGVtIG1vdmVkIGlzIHRoZSBwYXJlbnQgb2YgdGhlIGl0ZW0gY2hlY2tlZAoJCQlpZiAoaXRlbUVsZW1lbnQgIT09IHRoaXMuY3VycmVudEl0ZW1bMF0gJiYKCQkJCXRoaXMucGxhY2Vob2xkZXJbaW50ZXJzZWN0aW9uID09PSAxID8gIm5leHQiIDogInByZXYiXSgpWzBdICE9PSBpdGVtRWxlbWVudCAmJgoJCQkJISQuY29udGFpbnModGhpcy5wbGFjZWhvbGRlclswXSwgaXRlbUVsZW1lbnQpICYmCgkJCQkodGhpcy5vcHRpb25zLnR5cGUgPT09ICJzZW1pLWR5bmFtaWMiID8gISQuY29udGFpbnModGhpcy5lbGVtZW50WzBdLCBpdGVtRWxlbWVudCkgOiB0cnVlKQoJCQkpIHsKCgkJCQl0aGlzLmRpcmVjdGlvbiA9IGludGVyc2VjdGlvbiA9PT0gMSA/ICJkb3duIiA6ICJ1cCI7CgoJCQkJaWYgKHRoaXMub3B0aW9ucy50b2xlcmFuY2UgPT09ICJwb2ludGVyIiB8fCB0aGlzLl9pbnRlcnNlY3RzV2l0aFNpZGVzKGl0ZW0pKSB7CgkJCQkJdGhpcy5fcmVhcnJhbmdlKGV2ZW50LCBpdGVtKTsKCQkJCX0gZWxzZSB7CgkJCQkJYnJlYWs7CgkJCQl9CgoJCQkJdGhpcy5fdHJpZ2dlcigiY2hhbmdlIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCgpKTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoKCQkvL1Bvc3QgZXZlbnRzIHRvIGNvbnRhaW5lcnMKCQl0aGlzLl9jb250YWN0Q29udGFpbmVycyhldmVudCk7CgoJCS8vSW50ZXJjb25uZWN0IHdpdGggZHJvcHBhYmxlcwoJCWlmKCQudWkuZGRtYW5hZ2VyKSB7CgkJCSQudWkuZGRtYW5hZ2VyLmRyYWcodGhpcywgZXZlbnQpOwoJCX0KCgkJLy9DYWxsIGNhbGxiYWNrcwoJCXRoaXMuX3RyaWdnZXIoInNvcnQiLCBldmVudCwgdGhpcy5fdWlIYXNoKCkpOwoKCQl0aGlzLmxhc3RQb3NpdGlvbkFicyA9IHRoaXMucG9zaXRpb25BYnM7CgkJcmV0dXJuIGZhbHNlOwoKCX0sCgoJX21vdXNlU3RvcDogZnVuY3Rpb24oZXZlbnQsIG5vUHJvcGFnYXRpb24pIHsKCgkJaWYoIWV2ZW50KSB7CgkJCXJldHVybjsKCQl9CgoJCS8vSWYgd2UgYXJlIHVzaW5nIGRyb3BwYWJsZXMsIGluZm9ybSB0aGUgbWFuYWdlciBhYm91dCB0aGUgZHJvcAoJCWlmICgkLnVpLmRkbWFuYWdlciAmJiAhdGhpcy5vcHRpb25zLmRyb3BCZWhhdmlvdXIpIHsKCQkJJC51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLCBldmVudCk7CgkJfQoKCQlpZih0aGlzLm9wdGlvbnMucmV2ZXJ0KSB7CgkJCXZhciB0aGF0ID0gdGhpcywKCQkJCWN1ciA9IHRoaXMucGxhY2Vob2xkZXIub2Zmc2V0KCksCgkJCQlheGlzID0gdGhpcy5vcHRpb25zLmF4aXMsCgkJCQlhbmltYXRpb24gPSB7fTsKCgkJCWlmICggIWF4aXMgfHwgYXhpcyA9PT0gIngiICkgewoJCQkJYW5pbWF0aW9uLmxlZnQgPSBjdXIubGVmdCAtIHRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0IC0gdGhpcy5tYXJnaW5zLmxlZnQgKyAodGhpcy5vZmZzZXRQYXJlbnRbMF0gPT09IGRvY3VtZW50LmJvZHkgPyAwIDogdGhpcy5vZmZzZXRQYXJlbnRbMF0uc2Nyb2xsTGVmdCk7CgkJCX0KCQkJaWYgKCAhYXhpcyB8fCBheGlzID09PSAieSIgKSB7CgkJCQlhbmltYXRpb24udG9wID0gY3VyLnRvcCAtIHRoaXMub2Zmc2V0LnBhcmVudC50b3AgLSB0aGlzLm1hcmdpbnMudG9wICsgKHRoaXMub2Zmc2V0UGFyZW50WzBdID09PSBkb2N1bWVudC5ib2R5ID8gMCA6IHRoaXMub2Zmc2V0UGFyZW50WzBdLnNjcm9sbFRvcCk7CgkJCX0KCQkJdGhpcy5yZXZlcnRpbmcgPSB0cnVlOwoJCQkkKHRoaXMuaGVscGVyKS5hbmltYXRlKCBhbmltYXRpb24sIHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnQsIDEwKSB8fCA1MDAsIGZ1bmN0aW9uKCkgewoJCQkJdGhhdC5fY2xlYXIoZXZlbnQpOwoJCQl9KTsKCQl9IGVsc2UgewoJCQl0aGlzLl9jbGVhcihldmVudCwgbm9Qcm9wYWdhdGlvbik7CgkJfQoKCQlyZXR1cm4gZmFsc2U7CgoJfSwKCgljYW5jZWw6IGZ1bmN0aW9uKCkgewoKCQlpZih0aGlzLmRyYWdnaW5nKSB7CgoJCQl0aGlzLl9tb3VzZVVwKHsgdGFyZ2V0OiBudWxsIH0pOwoKCQkJaWYodGhpcy5vcHRpb25zLmhlbHBlciA9PT0gIm9yaWdpbmFsIikgewoJCQkJdGhpcy5jdXJyZW50SXRlbS5jc3ModGhpcy5fc3RvcmVkQ1NTKS5yZW1vdmVDbGFzcygidWktc29ydGFibGUtaGVscGVyIik7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLmN1cnJlbnRJdGVtLnNob3coKTsKCQkJfQoKCQkJLy9Qb3N0IGRlYWN0aXZhdGluZyBldmVudHMgdG8gY29udGFpbmVycwoJCQlmb3IgKHZhciBpID0gdGhpcy5jb250YWluZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKXsKCQkJCXRoaXMuY29udGFpbmVyc1tpXS5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsIG51bGwsIHRoaXMuX3VpSGFzaCh0aGlzKSk7CgkJCQlpZih0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUub3ZlcikgewoJCQkJCXRoaXMuY29udGFpbmVyc1tpXS5fdHJpZ2dlcigib3V0IiwgbnVsbCwgdGhpcy5fdWlIYXNoKHRoaXMpKTsKCQkJCQl0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUub3ZlciA9IDA7CgkJCQl9CgkJCX0KCgkJfQoKCQlpZiAodGhpcy5wbGFjZWhvbGRlcikgewoJCQkvLyQodGhpcy5wbGFjZWhvbGRlclswXSkucmVtb3ZlKCk7IHdvdWxkIGhhdmUgYmVlbiB0aGUgalF1ZXJ5IHdheSAtIHVuZm9ydHVuYXRlbHksIGl0IHVuYmluZHMgQUxMIGV2ZW50cyBmcm9tIHRoZSBvcmlnaW5hbCBub2RlIQoJCQlpZih0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUpIHsKCQkJCXRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKTsKCQkJfQoJCQlpZih0aGlzLm9wdGlvbnMuaGVscGVyICE9PSAib3JpZ2luYWwiICYmIHRoaXMuaGVscGVyICYmIHRoaXMuaGVscGVyWzBdLnBhcmVudE5vZGUpIHsKCQkJCXRoaXMuaGVscGVyLnJlbW92ZSgpOwoJCQl9CgoJCQkkLmV4dGVuZCh0aGlzLCB7CgkJCQloZWxwZXI6IG51bGwsCgkJCQlkcmFnZ2luZzogZmFsc2UsCgkJCQlyZXZlcnRpbmc6IGZhbHNlLAoJCQkJX25vRmluYWxTb3J0OiBudWxsCgkJCX0pOwoKCQkJaWYodGhpcy5kb21Qb3NpdGlvbi5wcmV2KSB7CgkJCQkkKHRoaXMuZG9tUG9zaXRpb24ucHJldikuYWZ0ZXIodGhpcy5jdXJyZW50SXRlbSk7CgkJCX0gZWxzZSB7CgkJCQkkKHRoaXMuZG9tUG9zaXRpb24ucGFyZW50KS5wcmVwZW5kKHRoaXMuY3VycmVudEl0ZW0pOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9LAoKCXNlcmlhbGl6ZTogZnVuY3Rpb24obykgewoKCQl2YXIgaXRlbXMgPSB0aGlzLl9nZXRJdGVtc0FzalF1ZXJ5KG8gJiYgby5jb25uZWN0ZWQpLAoJCQlzdHIgPSBbXTsKCQlvID0gbyB8fCB7fTsKCgkJJChpdGVtcykuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIHJlcyA9ICgkKG8uaXRlbSB8fCB0aGlzKS5hdHRyKG8uYXR0cmlidXRlIHx8ICJpZCIpIHx8ICIiKS5tYXRjaChvLmV4cHJlc3Npb24gfHwgKC8oLispW1wtPV9dKC4rKS8pKTsKCQkJaWYgKHJlcykgewoJCQkJc3RyLnB1c2goKG8ua2V5IHx8IHJlc1sxXSsiW10iKSsiPSIrKG8ua2V5ICYmIG8uZXhwcmVzc2lvbiA/IHJlc1sxXSA6IHJlc1syXSkpOwoJCQl9CgkJfSk7CgoJCWlmKCFzdHIubGVuZ3RoICYmIG8ua2V5KSB7CgkJCXN0ci5wdXNoKG8ua2V5ICsgIj0iKTsKCQl9CgoJCXJldHVybiBzdHIuam9pbigiJiIpOwoKCX0sCgoJdG9BcnJheTogZnVuY3Rpb24obykgewoKCQl2YXIgaXRlbXMgPSB0aGlzLl9nZXRJdGVtc0FzalF1ZXJ5KG8gJiYgby5jb25uZWN0ZWQpLAoJCQlyZXQgPSBbXTsKCgkJbyA9IG8gfHwge307CgoJCWl0ZW1zLmVhY2goZnVuY3Rpb24oKSB7IHJldC5wdXNoKCQoby5pdGVtIHx8IHRoaXMpLmF0dHIoby5hdHRyaWJ1dGUgfHwgImlkIikgfHwgIiIpOyB9KTsKCQlyZXR1cm4gcmV0OwoKCX0sCgoJLyogQmUgY2FyZWZ1bCB3aXRoIHRoZSBmb2xsb3dpbmcgY29yZSBmdW5jdGlvbnMgKi8KCV9pbnRlcnNlY3RzV2l0aDogZnVuY3Rpb24oaXRlbSkgewoKCQl2YXIgeDEgPSB0aGlzLnBvc2l0aW9uQWJzLmxlZnQsCgkJCXgyID0geDEgKyB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLAoJCQl5MSA9IHRoaXMucG9zaXRpb25BYnMudG9wLAoJCQl5MiA9IHkxICsgdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsCgkJCWwgPSBpdGVtLmxlZnQsCgkJCXIgPSBsICsgaXRlbS53aWR0aCwKCQkJdCA9IGl0ZW0udG9wLAoJCQliID0gdCArIGl0ZW0uaGVpZ2h0LAoJCQlkeUNsaWNrID0gdGhpcy5vZmZzZXQuY2xpY2sudG9wLAoJCQlkeENsaWNrID0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCwKCQkJaXNPdmVyRWxlbWVudEhlaWdodCA9ICggdGhpcy5vcHRpb25zLmF4aXMgPT09ICJ4IiApIHx8ICggKCB5MSArIGR5Q2xpY2sgKSA+IHQgJiYgKCB5MSArIGR5Q2xpY2sgKSA8IGIgKSwKCQkJaXNPdmVyRWxlbWVudFdpZHRoID0gKCB0aGlzLm9wdGlvbnMuYXhpcyA9PT0gInkiICkgfHwgKCAoIHgxICsgZHhDbGljayApID4gbCAmJiAoIHgxICsgZHhDbGljayApIDwgciApLAoJCQlpc092ZXJFbGVtZW50ID0gaXNPdmVyRWxlbWVudEhlaWdodCAmJiBpc092ZXJFbGVtZW50V2lkdGg7CgoJCWlmICggdGhpcy5vcHRpb25zLnRvbGVyYW5jZSA9PT0gInBvaW50ZXIiIHx8CgkJCXRoaXMub3B0aW9ucy5mb3JjZVBvaW50ZXJGb3JDb250YWluZXJzIHx8CgkJCSh0aGlzLm9wdGlvbnMudG9sZXJhbmNlICE9PSAicG9pbnRlciIgJiYgdGhpcy5oZWxwZXJQcm9wb3J0aW9uc1t0aGlzLmZsb2F0aW5nID8gIndpZHRoIiA6ICJoZWlnaHQiXSA+IGl0ZW1bdGhpcy5mbG9hdGluZyA/ICJ3aWR0aCIgOiAiaGVpZ2h0Il0pCgkJKSB7CgkJCXJldHVybiBpc092ZXJFbGVtZW50OwoJCX0gZWxzZSB7CgoJCQlyZXR1cm4gKGwgPCB4MSArICh0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC8gMikgJiYgLy8gUmlnaHQgSGFsZgoJCQkJeDIgLSAodGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAvIDIpIDwgciAmJiAvLyBMZWZ0IEhhbGYKCQkJCXQgPCB5MSArICh0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAvIDIpICYmIC8vIEJvdHRvbSBIYWxmCgkJCQl5MiAtICh0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAvIDIpIDwgYiApOyAvLyBUb3AgSGFsZgoKCQl9Cgl9LAoKCV9pbnRlcnNlY3RzV2l0aFBvaW50ZXI6IGZ1bmN0aW9uKGl0ZW0pIHsKCgkJdmFyIGlzT3ZlckVsZW1lbnRIZWlnaHQgPSAodGhpcy5vcHRpb25zLmF4aXMgPT09ICJ4IikgfHwgdGhpcy5faXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLnRvcCArIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCwgaXRlbS50b3AsIGl0ZW0uaGVpZ2h0KSwKCQkJaXNPdmVyRWxlbWVudFdpZHRoID0gKHRoaXMub3B0aW9ucy5heGlzID09PSAieSIpIHx8IHRoaXMuX2lzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy5sZWZ0ICsgdGhpcy5vZmZzZXQuY2xpY2subGVmdCwgaXRlbS5sZWZ0LCBpdGVtLndpZHRoKSwKCQkJaXNPdmVyRWxlbWVudCA9IGlzT3ZlckVsZW1lbnRIZWlnaHQgJiYgaXNPdmVyRWxlbWVudFdpZHRoLAoJCQl2ZXJ0aWNhbERpcmVjdGlvbiA9IHRoaXMuX2dldERyYWdWZXJ0aWNhbERpcmVjdGlvbigpLAoJCQlob3Jpem9udGFsRGlyZWN0aW9uID0gdGhpcy5fZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb24oKTsKCgkJaWYgKCFpc092ZXJFbGVtZW50KSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXJldHVybiB0aGlzLmZsb2F0aW5nID8KCQkJKCAoKGhvcml6b250YWxEaXJlY3Rpb24gJiYgaG9yaXpvbnRhbERpcmVjdGlvbiA9PT0gInJpZ2h0IikgfHwgdmVydGljYWxEaXJlY3Rpb24gPT09ICJkb3duIikgPyAyIDogMSApCgkJCTogKCB2ZXJ0aWNhbERpcmVjdGlvbiAmJiAodmVydGljYWxEaXJlY3Rpb24gPT09ICJkb3duIiA/IDIgOiAxKSApOwoKCX0sCgoJX2ludGVyc2VjdHNXaXRoU2lkZXM6IGZ1bmN0aW9uKGl0ZW0pIHsKCgkJdmFyIGlzT3ZlckJvdHRvbUhhbGYgPSB0aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMudG9wICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wLCBpdGVtLnRvcCArIChpdGVtLmhlaWdodC8yKSwgaXRlbS5oZWlnaHQpLAoJCQlpc092ZXJSaWdodEhhbGYgPSB0aGlzLl9pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCArIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQsIGl0ZW0ubGVmdCArIChpdGVtLndpZHRoLzIpLCBpdGVtLndpZHRoKSwKCQkJdmVydGljYWxEaXJlY3Rpb24gPSB0aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKSwKCQkJaG9yaXpvbnRhbERpcmVjdGlvbiA9IHRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCk7CgoJCWlmICh0aGlzLmZsb2F0aW5nICYmIGhvcml6b250YWxEaXJlY3Rpb24pIHsKCQkJcmV0dXJuICgoaG9yaXpvbnRhbERpcmVjdGlvbiA9PT0gInJpZ2h0IiAmJiBpc092ZXJSaWdodEhhbGYpIHx8IChob3Jpem9udGFsRGlyZWN0aW9uID09PSAibGVmdCIgJiYgIWlzT3ZlclJpZ2h0SGFsZikpOwoJCX0gZWxzZSB7CgkJCXJldHVybiB2ZXJ0aWNhbERpcmVjdGlvbiAmJiAoKHZlcnRpY2FsRGlyZWN0aW9uID09PSAiZG93biIgJiYgaXNPdmVyQm90dG9tSGFsZikgfHwgKHZlcnRpY2FsRGlyZWN0aW9uID09PSAidXAiICYmICFpc092ZXJCb3R0b21IYWxmKSk7CgkJfQoKCX0sCgoJX2dldERyYWdWZXJ0aWNhbERpcmVjdGlvbjogZnVuY3Rpb24oKSB7CgkJdmFyIGRlbHRhID0gdGhpcy5wb3NpdGlvbkFicy50b3AgLSB0aGlzLmxhc3RQb3NpdGlvbkFicy50b3A7CgkJcmV0dXJuIGRlbHRhICE9PSAwICYmIChkZWx0YSA+IDAgPyAiZG93biIgOiAidXAiKTsKCX0sCgoJX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZGVsdGEgPSB0aGlzLnBvc2l0aW9uQWJzLmxlZnQgLSB0aGlzLmxhc3RQb3NpdGlvbkFicy5sZWZ0OwoJCXJldHVybiBkZWx0YSAhPT0gMCAmJiAoZGVsdGEgPiAwID8gInJpZ2h0IiA6ICJsZWZ0Iik7Cgl9LAoKCXJlZnJlc2g6IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdGhpcy5fcmVmcmVzaEl0ZW1zKGV2ZW50KTsKCQl0aGlzLl9zZXRIYW5kbGVDbGFzc05hbWUoKTsKCQl0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKTsKCQlyZXR1cm4gdGhpczsKCX0sCgoJX2Nvbm5lY3RXaXRoOiBmdW5jdGlvbigpIHsKCQl2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKCQlyZXR1cm4gb3B0aW9ucy5jb25uZWN0V2l0aC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nID8gW29wdGlvbnMuY29ubmVjdFdpdGhdIDogb3B0aW9ucy5jb25uZWN0V2l0aDsKCX0sCgoJX2dldEl0ZW1zQXNqUXVlcnk6IGZ1bmN0aW9uKGNvbm5lY3RlZCkgewoKCQl2YXIgaSwgaiwgY3VyLCBpbnN0LAoJCQlpdGVtcyA9IFtdLAoJCQlxdWVyaWVzID0gW10sCgkJCWNvbm5lY3RXaXRoID0gdGhpcy5fY29ubmVjdFdpdGgoKTsKCgkJaWYoY29ubmVjdFdpdGggJiYgY29ubmVjdGVkKSB7CgkJCWZvciAoaSA9IGNvbm5lY3RXaXRoLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKXsKCQkJCWN1ciA9ICQoY29ubmVjdFdpdGhbaV0pOwoJCQkJZm9yICggaiA9IGN1ci5sZW5ndGggLSAxOyBqID49IDA7IGotLSl7CgkJCQkJaW5zdCA9ICQuZGF0YShjdXJbal0sIHRoaXMud2lkZ2V0RnVsbE5hbWUpOwoJCQkJCWlmKGluc3QgJiYgaW5zdCAhPT0gdGhpcyAmJiAhaW5zdC5vcHRpb25zLmRpc2FibGVkKSB7CgkJCQkJCXF1ZXJpZXMucHVzaChbJC5pc0Z1bmN0aW9uKGluc3Qub3B0aW9ucy5pdGVtcykgPyBpbnN0Lm9wdGlvbnMuaXRlbXMuY2FsbChpbnN0LmVsZW1lbnQpIDogJChpbnN0Lm9wdGlvbnMuaXRlbXMsIGluc3QuZWxlbWVudCkubm90KCIudWktc29ydGFibGUtaGVscGVyIikubm90KCIudWktc29ydGFibGUtcGxhY2Vob2xkZXIiKSwgaW5zdF0pOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcXVlcmllcy5wdXNoKFskLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKSA/IHRoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudCwgbnVsbCwgeyBvcHRpb25zOiB0aGlzLm9wdGlvbnMsIGl0ZW06IHRoaXMuY3VycmVudEl0ZW0gfSkgOiAkKHRoaXMub3B0aW9ucy5pdGVtcywgdGhpcy5lbGVtZW50KS5ub3QoIi51aS1zb3J0YWJsZS1oZWxwZXIiKS5ub3QoIi51aS1zb3J0YWJsZS1wbGFjZWhvbGRlciIpLCB0aGlzXSk7CgoJCWZ1bmN0aW9uIGFkZEl0ZW1zKCkgewoJCQlpdGVtcy5wdXNoKCB0aGlzICk7CgkJfQoJCWZvciAoaSA9IHF1ZXJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pewoJCQlxdWVyaWVzW2ldWzBdLmVhY2goIGFkZEl0ZW1zICk7CgkJfQoKCQlyZXR1cm4gJChpdGVtcyk7CgoJfSwKCglfcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXM6IGZ1bmN0aW9uKCkgewoKCQl2YXIgbGlzdCA9IHRoaXMuY3VycmVudEl0ZW0uZmluZCgiOmRhdGEoIiArIHRoaXMud2lkZ2V0TmFtZSArICItaXRlbSkiKTsKCgkJdGhpcy5pdGVtcyA9ICQuZ3JlcCh0aGlzLml0ZW1zLCBmdW5jdGlvbiAoaXRlbSkgewoJCQlmb3IgKHZhciBqPTA7IGogPCBsaXN0Lmxlbmd0aDsgaisrKSB7CgkJCQlpZihsaXN0W2pdID09PSBpdGVtLml0ZW1bMF0pIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSk7CgoJfSwKCglfcmVmcmVzaEl0ZW1zOiBmdW5jdGlvbihldmVudCkgewoKCQl0aGlzLml0ZW1zID0gW107CgkJdGhpcy5jb250YWluZXJzID0gW3RoaXNdOwoKCQl2YXIgaSwgaiwgY3VyLCBpbnN0LCB0YXJnZXREYXRhLCBfcXVlcmllcywgaXRlbSwgcXVlcmllc0xlbmd0aCwKCQkJaXRlbXMgPSB0aGlzLml0ZW1zLAoJCQlxdWVyaWVzID0gW1skLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKSA/IHRoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudFswXSwgZXZlbnQsIHsgaXRlbTogdGhpcy5jdXJyZW50SXRlbSB9KSA6ICQodGhpcy5vcHRpb25zLml0ZW1zLCB0aGlzLmVsZW1lbnQpLCB0aGlzXV0sCgkJCWNvbm5lY3RXaXRoID0gdGhpcy5fY29ubmVjdFdpdGgoKTsKCgkJaWYoY29ubmVjdFdpdGggJiYgdGhpcy5yZWFkeSkgeyAvL1Nob3VsZG4ndCBiZSBydW4gdGhlIGZpcnN0IHRpbWUgdGhyb3VnaCBkdWUgdG8gbWFzc2l2ZSBzbG93LWRvd24KCQkJZm9yIChpID0gY29ubmVjdFdpdGgubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pewoJCQkJY3VyID0gJChjb25uZWN0V2l0aFtpXSk7CgkJCQlmb3IgKGogPSBjdXIubGVuZ3RoIC0gMTsgaiA+PSAwOyBqLS0pewoJCQkJCWluc3QgPSAkLmRhdGEoY3VyW2pdLCB0aGlzLndpZGdldEZ1bGxOYW1lKTsKCQkJCQlpZihpbnN0ICYmIGluc3QgIT09IHRoaXMgJiYgIWluc3Qub3B0aW9ucy5kaXNhYmxlZCkgewoJCQkJCQlxdWVyaWVzLnB1c2goWyQuaXNGdW5jdGlvbihpbnN0Lm9wdGlvbnMuaXRlbXMpID8gaW5zdC5vcHRpb25zLml0ZW1zLmNhbGwoaW5zdC5lbGVtZW50WzBdLCBldmVudCwgeyBpdGVtOiB0aGlzLmN1cnJlbnRJdGVtIH0pIDogJChpbnN0Lm9wdGlvbnMuaXRlbXMsIGluc3QuZWxlbWVudCksIGluc3RdKTsKCQkJCQkJdGhpcy5jb250YWluZXJzLnB1c2goaW5zdCk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlmb3IgKGkgPSBxdWVyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CgkJCXRhcmdldERhdGEgPSBxdWVyaWVzW2ldWzFdOwoJCQlfcXVlcmllcyA9IHF1ZXJpZXNbaV1bMF07CgoJCQlmb3IgKGo9MCwgcXVlcmllc0xlbmd0aCA9IF9xdWVyaWVzLmxlbmd0aDsgaiA8IHF1ZXJpZXNMZW5ndGg7IGorKykgewoJCQkJaXRlbSA9ICQoX3F1ZXJpZXNbal0pOwoKCQkJCWl0ZW0uZGF0YSh0aGlzLndpZGdldE5hbWUgKyAiLWl0ZW0iLCB0YXJnZXREYXRhKTsgLy8gRGF0YSBmb3IgdGFyZ2V0IGNoZWNraW5nIChtb3VzZSBtYW5hZ2VyKQoKCQkJCWl0ZW1zLnB1c2goewoJCQkJCWl0ZW06IGl0ZW0sCgkJCQkJaW5zdGFuY2U6IHRhcmdldERhdGEsCgkJCQkJd2lkdGg6IDAsIGhlaWdodDogMCwKCQkJCQlsZWZ0OiAwLCB0b3A6IDAKCQkJCX0pOwoJCQl9CgkJfQoKCX0sCgoJcmVmcmVzaFBvc2l0aW9uczogZnVuY3Rpb24oZmFzdCkgewoKCQkvL1RoaXMgaGFzIHRvIGJlIHJlZG9uZSBiZWNhdXNlIGR1ZSB0byB0aGUgaXRlbSBiZWluZyBtb3ZlZCBvdXQvaW50byB0aGUgb2Zmc2V0UGFyZW50LCB0aGUgb2Zmc2V0UGFyZW50J3MgcG9zaXRpb24gd2lsbCBjaGFuZ2UKCQlpZih0aGlzLm9mZnNldFBhcmVudCAmJiB0aGlzLmhlbHBlcikgewoJCQl0aGlzLm9mZnNldC5wYXJlbnQgPSB0aGlzLl9nZXRQYXJlbnRPZmZzZXQoKTsKCQl9CgoJCXZhciBpLCBpdGVtLCB0LCBwOwoKCQlmb3IgKGkgPSB0aGlzLml0ZW1zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKXsKCQkJaXRlbSA9IHRoaXMuaXRlbXNbaV07CgoJCQkvL1dlIGlnbm9yZSBjYWxjdWxhdGluZyBwb3NpdGlvbnMgb2YgYWxsIGNvbm5lY3RlZCBjb250YWluZXJzIHdoZW4gd2UncmUgbm90IG92ZXIgdGhlbQoJCQlpZihpdGVtLmluc3RhbmNlICE9PSB0aGlzLmN1cnJlbnRDb250YWluZXIgJiYgdGhpcy5jdXJyZW50Q29udGFpbmVyICYmIGl0ZW0uaXRlbVswXSAhPT0gdGhpcy5jdXJyZW50SXRlbVswXSkgewoJCQkJY29udGludWU7CgkJCX0KCgkJCXQgPSB0aGlzLm9wdGlvbnMudG9sZXJhbmNlRWxlbWVudCA/ICQodGhpcy5vcHRpb25zLnRvbGVyYW5jZUVsZW1lbnQsIGl0ZW0uaXRlbSkgOiBpdGVtLml0ZW07CgoJCQlpZiAoIWZhc3QpIHsKCQkJCWl0ZW0ud2lkdGggPSB0Lm91dGVyV2lkdGgoKTsKCQkJCWl0ZW0uaGVpZ2h0ID0gdC5vdXRlckhlaWdodCgpOwoJCQl9CgoJCQlwID0gdC5vZmZzZXQoKTsKCQkJaXRlbS5sZWZ0ID0gcC5sZWZ0OwoJCQlpdGVtLnRvcCA9IHAudG9wOwoJCX0KCgkJaWYodGhpcy5vcHRpb25zLmN1c3RvbSAmJiB0aGlzLm9wdGlvbnMuY3VzdG9tLnJlZnJlc2hDb250YWluZXJzKSB7CgkJCXRoaXMub3B0aW9ucy5jdXN0b20ucmVmcmVzaENvbnRhaW5lcnMuY2FsbCh0aGlzKTsKCQl9IGVsc2UgewoJCQlmb3IgKGkgPSB0aGlzLmNvbnRhaW5lcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pewoJCQkJcCA9IHRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50Lm9mZnNldCgpOwoJCQkJdGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlLmxlZnQgPSBwLmxlZnQ7CgkJCQl0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUudG9wID0gcC50b3A7CgkJCQl0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUud2lkdGggPSB0aGlzLmNvbnRhaW5lcnNbaV0uZWxlbWVudC5vdXRlcldpZHRoKCk7CgkJCQl0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUuaGVpZ2h0ID0gdGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnQub3V0ZXJIZWlnaHQoKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCV9jcmVhdGVQbGFjZWhvbGRlcjogZnVuY3Rpb24odGhhdCkgewoJCXRoYXQgPSB0aGF0IHx8IHRoaXM7CgkJdmFyIGNsYXNzTmFtZSwKCQkJbyA9IHRoYXQub3B0aW9uczsKCgkJaWYoIW8ucGxhY2Vob2xkZXIgfHwgby5wbGFjZWhvbGRlci5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7CgkJCWNsYXNzTmFtZSA9IG8ucGxhY2Vob2xkZXI7CgkJCW8ucGxhY2Vob2xkZXIgPSB7CgkJCQllbGVtZW50OiBmdW5jdGlvbigpIHsKCgkJCQkJdmFyIG5vZGVOYW1lID0gdGhhdC5jdXJyZW50SXRlbVswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAoJCQkJCQllbGVtZW50ID0gJCggIjwiICsgbm9kZU5hbWUgKyAiPiIsIHRoYXQuZG9jdW1lbnRbMF0gKQoJCQkJCQkJLmFkZENsYXNzKGNsYXNzTmFtZSB8fCB0aGF0LmN1cnJlbnRJdGVtWzBdLmNsYXNzTmFtZSsiIHVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyIikKCQkJCQkJCS5yZW1vdmVDbGFzcygidWktc29ydGFibGUtaGVscGVyIik7CgoJCQkJCWlmICggbm9kZU5hbWUgPT09ICJ0ciIgKSB7CgkJCQkJCXRoYXQuY3VycmVudEl0ZW0uY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJCQkJJCggIjx0ZD4mIzE2MDs8L3RkPiIsIHRoYXQuZG9jdW1lbnRbMF0gKQoJCQkJCQkJCS5hdHRyKCAiY29sc3BhbiIsICQoIHRoaXMgKS5hdHRyKCAiY29sc3BhbiIgKSB8fCAxICkKCQkJCQkJCQkuYXBwZW5kVG8oIGVsZW1lbnQgKTsKCQkJCQkJfSk7CgkJCQkJfSBlbHNlIGlmICggbm9kZU5hbWUgPT09ICJpbWciICkgewoJCQkJCQllbGVtZW50LmF0dHIoICJzcmMiLCB0aGF0LmN1cnJlbnRJdGVtLmF0dHIoICJzcmMiICkgKTsKCQkJCQl9CgoJCQkJCWlmICggIWNsYXNzTmFtZSApIHsKCQkJCQkJZWxlbWVudC5jc3MoICJ2aXNpYmlsaXR5IiwgImhpZGRlbiIgKTsKCQkJCQl9CgoJCQkJCXJldHVybiBlbGVtZW50OwoJCQkJfSwKCQkJCXVwZGF0ZTogZnVuY3Rpb24oY29udGFpbmVyLCBwKSB7CgoJCQkJCS8vIDEuIElmIGEgY2xhc3NOYW1lIGlzIHNldCBhcyAncGxhY2Vob2xkZXIgb3B0aW9uLCB3ZSBkb24ndCBmb3JjZSBzaXplcyAtIHRoZSBjbGFzcyBpcyByZXNwb25zaWJsZSBmb3IgdGhhdAoJCQkJCS8vIDIuIFRoZSBvcHRpb24gJ2ZvcmNlUGxhY2Vob2xkZXJTaXplIGNhbiBiZSBlbmFibGVkIHRvIGZvcmNlIGl0IGV2ZW4gaWYgYSBjbGFzcyBuYW1lIGlzIHNwZWNpZmllZAoJCQkJCWlmKGNsYXNzTmFtZSAmJiAhby5mb3JjZVBsYWNlaG9sZGVyU2l6ZSkgewoJCQkJCQlyZXR1cm47CgkJCQkJfQoKCQkJCQkvL0lmIHRoZSBlbGVtZW50IGRvZXNuJ3QgaGF2ZSBhIGFjdHVhbCBoZWlnaHQgYnkgaXRzZWxmICh3aXRob3V0IHN0eWxlcyBjb21pbmcgZnJvbSBhIHN0eWxlc2hlZXQpLCBpdCByZWNlaXZlcyB0aGUgaW5saW5lIGhlaWdodCBmcm9tIHRoZSBkcmFnZ2VkIGl0ZW0KCQkJCQlpZighcC5oZWlnaHQoKSkgeyBwLmhlaWdodCh0aGF0LmN1cnJlbnRJdGVtLmlubmVySGVpZ2h0KCkgLSBwYXJzZUludCh0aGF0LmN1cnJlbnRJdGVtLmNzcygicGFkZGluZ1RvcCIpfHwwLCAxMCkgLSBwYXJzZUludCh0aGF0LmN1cnJlbnRJdGVtLmNzcygicGFkZGluZ0JvdHRvbSIpfHwwLCAxMCkpOyB9CgkJCQkJaWYoIXAud2lkdGgoKSkgeyBwLndpZHRoKHRoYXQuY3VycmVudEl0ZW0uaW5uZXJXaWR0aCgpIC0gcGFyc2VJbnQodGhhdC5jdXJyZW50SXRlbS5jc3MoInBhZGRpbmdMZWZ0Iil8fDAsIDEwKSAtIHBhcnNlSW50KHRoYXQuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nUmlnaHQiKXx8MCwgMTApKTsgfQoJCQkJfQoJCQl9OwoJCX0KCgkJLy9DcmVhdGUgdGhlIHBsYWNlaG9sZGVyCgkJdGhhdC5wbGFjZWhvbGRlciA9ICQoby5wbGFjZWhvbGRlci5lbGVtZW50LmNhbGwodGhhdC5lbGVtZW50LCB0aGF0LmN1cnJlbnRJdGVtKSk7CgoJCS8vQXBwZW5kIGl0IGFmdGVyIHRoZSBhY3R1YWwgY3VycmVudCBpdGVtCgkJdGhhdC5jdXJyZW50SXRlbS5hZnRlcih0aGF0LnBsYWNlaG9sZGVyKTsKCgkJLy9VcGRhdGUgdGhlIHNpemUgb2YgdGhlIHBsYWNlaG9sZGVyIChUT0RPOiBMb2dpYyB0byBmdXp6eSwgc2VlIGxpbmUgMzE2LzMxNykKCQlvLnBsYWNlaG9sZGVyLnVwZGF0ZSh0aGF0LCB0aGF0LnBsYWNlaG9sZGVyKTsKCgl9LAoKCV9jb250YWN0Q29udGFpbmVyczogZnVuY3Rpb24oZXZlbnQpIHsKCQl2YXIgaSwgaiwgZGlzdCwgaXRlbVdpdGhMZWFzdERpc3RhbmNlLCBwb3NQcm9wZXJ0eSwgc2l6ZVByb3BlcnR5LCBjdXIsIG5lYXJCb3R0b20sIGZsb2F0aW5nLCBheGlzLAoJCQlpbm5lcm1vc3RDb250YWluZXIgPSBudWxsLAoJCQlpbm5lcm1vc3RJbmRleCA9IG51bGw7CgoJCS8vIGdldCBpbm5lcm1vc3QgY29udGFpbmVyIHRoYXQgaW50ZXJzZWN0cyB3aXRoIGl0ZW0KCQlmb3IgKGkgPSB0aGlzLmNvbnRhaW5lcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKCgkJCS8vIG5ldmVyIGNvbnNpZGVyIGEgY29udGFpbmVyIHRoYXQncyBsb2NhdGVkIHdpdGhpbiB0aGUgaXRlbSBpdHNlbGYKCQkJaWYoJC5jb250YWlucyh0aGlzLmN1cnJlbnRJdGVtWzBdLCB0aGlzLmNvbnRhaW5lcnNbaV0uZWxlbWVudFswXSkpIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQlpZih0aGlzLl9pbnRlcnNlY3RzV2l0aCh0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUpKSB7CgoJCQkJLy8gaWYgd2UndmUgYWxyZWFkeSBmb3VuZCBhIGNvbnRhaW5lciBhbmQgaXQncyBtb3JlICJpbm5lciIgdGhhbiB0aGlzLCB0aGVuIGNvbnRpbnVlCgkJCQlpZihpbm5lcm1vc3RDb250YWluZXIgJiYgJC5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbaV0uZWxlbWVudFswXSwgaW5uZXJtb3N0Q29udGFpbmVyLmVsZW1lbnRbMF0pKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgoJCQkJaW5uZXJtb3N0Q29udGFpbmVyID0gdGhpcy5jb250YWluZXJzW2ldOwoJCQkJaW5uZXJtb3N0SW5kZXggPSBpOwoKCQkJfSBlbHNlIHsKCQkJCS8vIGNvbnRhaW5lciBkb2Vzbid0IGludGVyc2VjdC4gdHJpZ2dlciAib3V0IiBldmVudCBpZiBuZWNlc3NhcnkKCQkJCWlmKHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS5vdmVyKSB7CgkJCQkJdGhpcy5jb250YWluZXJzW2ldLl90cmlnZ2VyKCJvdXQiLCBldmVudCwgdGhpcy5fdWlIYXNoKHRoaXMpKTsKCQkJCQl0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUub3ZlciA9IDA7CgkJCQl9CgkJCX0KCgkJfQoKCQkvLyBpZiBubyBpbnRlcnNlY3RpbmcgY29udGFpbmVycyBmb3VuZCwgcmV0dXJuCgkJaWYoIWlubmVybW9zdENvbnRhaW5lcikgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBtb3ZlIHRoZSBpdGVtIGludG8gdGhlIGNvbnRhaW5lciBpZiBpdCdzIG5vdCB0aGVyZSBhbHJlYWR5CgkJaWYodGhpcy5jb250YWluZXJzLmxlbmd0aCA9PT0gMSkgewoJCQlpZiAoIXRoaXMuY29udGFpbmVyc1tpbm5lcm1vc3RJbmRleF0uY29udGFpbmVyQ2FjaGUub3ZlcikgewoJCQkJdGhpcy5jb250YWluZXJzW2lubmVybW9zdEluZGV4XS5fdHJpZ2dlcigib3ZlciIsIGV2ZW50LCB0aGlzLl91aUhhc2godGhpcykpOwoJCQkJdGhpcy5jb250YWluZXJzW2lubmVybW9zdEluZGV4XS5jb250YWluZXJDYWNoZS5vdmVyID0gMTsKCQkJfQoJCX0gZWxzZSB7CgoJCQkvL1doZW4gZW50ZXJpbmcgYSBuZXcgY29udGFpbmVyLCB3ZSB3aWxsIGZpbmQgdGhlIGl0ZW0gd2l0aCB0aGUgbGVhc3QgZGlzdGFuY2UgYW5kIGFwcGVuZCBvdXIgaXRlbSBuZWFyIGl0CgkJCWRpc3QgPSAxMDAwMDsKCQkJaXRlbVdpdGhMZWFzdERpc3RhbmNlID0gbnVsbDsKCQkJZmxvYXRpbmcgPSBpbm5lcm1vc3RDb250YWluZXIuZmxvYXRpbmcgfHwgdGhpcy5faXNGbG9hdGluZyh0aGlzLmN1cnJlbnRJdGVtKTsKCQkJcG9zUHJvcGVydHkgPSBmbG9hdGluZyA/ICJsZWZ0IiA6ICJ0b3AiOwoJCQlzaXplUHJvcGVydHkgPSBmbG9hdGluZyA/ICJ3aWR0aCIgOiAiaGVpZ2h0IjsKCQkJYXhpcyA9IGZsb2F0aW5nID8gImNsaWVudFgiIDogImNsaWVudFkiOwoKCQkJZm9yIChqID0gdGhpcy5pdGVtcy5sZW5ndGggLSAxOyBqID49IDA7IGotLSkgewoJCQkJaWYoISQuY29udGFpbnModGhpcy5jb250YWluZXJzW2lubmVybW9zdEluZGV4XS5lbGVtZW50WzBdLCB0aGlzLml0ZW1zW2pdLml0ZW1bMF0pKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgkJCQlpZih0aGlzLml0ZW1zW2pdLml0ZW1bMF0gPT09IHRoaXMuY3VycmVudEl0ZW1bMF0pIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQljdXIgPSB0aGlzLml0ZW1zW2pdLml0ZW0ub2Zmc2V0KClbcG9zUHJvcGVydHldOwoJCQkJbmVhckJvdHRvbSA9IGZhbHNlOwoJCQkJaWYgKCBldmVudFsgYXhpcyBdIC0gY3VyID4gdGhpcy5pdGVtc1sgaiBdWyBzaXplUHJvcGVydHkgXSAvIDIgKSB7CgkJCQkJbmVhckJvdHRvbSA9IHRydWU7CgkJCQl9CgoJCQkJaWYgKCBNYXRoLmFicyggZXZlbnRbIGF4aXMgXSAtIGN1ciApIDwgZGlzdCApIHsKCQkJCQlkaXN0ID0gTWF0aC5hYnMoIGV2ZW50WyBheGlzIF0gLSBjdXIgKTsKCQkJCQlpdGVtV2l0aExlYXN0RGlzdGFuY2UgPSB0aGlzLml0ZW1zWyBqIF07CgkJCQkJdGhpcy5kaXJlY3Rpb24gPSBuZWFyQm90dG9tID8gInVwIjogImRvd24iOwoJCQkJfQoJCQl9CgoJCQkvL0NoZWNrIGlmIGRyb3BPbkVtcHR5IGlzIGVuYWJsZWQKCQkJaWYoIWl0ZW1XaXRoTGVhc3REaXN0YW5jZSAmJiAhdGhpcy5vcHRpb25zLmRyb3BPbkVtcHR5KSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmKHRoaXMuY3VycmVudENvbnRhaW5lciA9PT0gdGhpcy5jb250YWluZXJzW2lubmVybW9zdEluZGV4XSkgewoJCQkJcmV0dXJuOwoJCQl9CgoJCQlpdGVtV2l0aExlYXN0RGlzdGFuY2UgPyB0aGlzLl9yZWFycmFuZ2UoZXZlbnQsIGl0ZW1XaXRoTGVhc3REaXN0YW5jZSwgbnVsbCwgdHJ1ZSkgOiB0aGlzLl9yZWFycmFuZ2UoZXZlbnQsIG51bGwsIHRoaXMuY29udGFpbmVyc1tpbm5lcm1vc3RJbmRleF0uZWxlbWVudCwgdHJ1ZSk7CgkJCXRoaXMuX3RyaWdnZXIoImNoYW5nZSIsIGV2ZW50LCB0aGlzLl91aUhhc2goKSk7CgkJCXRoaXMuY29udGFpbmVyc1tpbm5lcm1vc3RJbmRleF0uX3RyaWdnZXIoImNoYW5nZSIsIGV2ZW50LCB0aGlzLl91aUhhc2godGhpcykpOwoJCQl0aGlzLmN1cnJlbnRDb250YWluZXIgPSB0aGlzLmNvbnRhaW5lcnNbaW5uZXJtb3N0SW5kZXhdOwoKCQkJLy9VcGRhdGUgdGhlIHBsYWNlaG9sZGVyCgkJCXRoaXMub3B0aW9ucy5wbGFjZWhvbGRlci51cGRhdGUodGhpcy5jdXJyZW50Q29udGFpbmVyLCB0aGlzLnBsYWNlaG9sZGVyKTsKCgkJCXRoaXMuY29udGFpbmVyc1tpbm5lcm1vc3RJbmRleF0uX3RyaWdnZXIoIm92ZXIiLCBldmVudCwgdGhpcy5fdWlIYXNoKHRoaXMpKTsKCQkJdGhpcy5jb250YWluZXJzW2lubmVybW9zdEluZGV4XS5jb250YWluZXJDYWNoZS5vdmVyID0gMTsKCQl9CgoKCX0sCgoJX2NyZWF0ZUhlbHBlcjogZnVuY3Rpb24oZXZlbnQpIHsKCgkJdmFyIG8gPSB0aGlzLm9wdGlvbnMsCgkJCWhlbHBlciA9ICQuaXNGdW5jdGlvbihvLmhlbHBlcikgPyAkKG8uaGVscGVyLmFwcGx5KHRoaXMuZWxlbWVudFswXSwgW2V2ZW50LCB0aGlzLmN1cnJlbnRJdGVtXSkpIDogKG8uaGVscGVyID09PSAiY2xvbmUiID8gdGhpcy5jdXJyZW50SXRlbS5jbG9uZSgpIDogdGhpcy5jdXJyZW50SXRlbSk7CgoJCS8vQWRkIHRoZSBoZWxwZXIgdG8gdGhlIERPTSBpZiB0aGF0IGRpZG4ndCBoYXBwZW4gYWxyZWFkeQoJCWlmKCFoZWxwZXIucGFyZW50cygiYm9keSIpLmxlbmd0aCkgewoJCQkkKG8uYXBwZW5kVG8gIT09ICJwYXJlbnQiID8gby5hcHBlbmRUbyA6IHRoaXMuY3VycmVudEl0ZW1bMF0ucGFyZW50Tm9kZSlbMF0uYXBwZW5kQ2hpbGQoaGVscGVyWzBdKTsKCQl9CgoJCWlmKGhlbHBlclswXSA9PT0gdGhpcy5jdXJyZW50SXRlbVswXSkgewoJCQl0aGlzLl9zdG9yZWRDU1MgPSB7IHdpZHRoOiB0aGlzLmN1cnJlbnRJdGVtWzBdLnN0eWxlLndpZHRoLCBoZWlnaHQ6IHRoaXMuY3VycmVudEl0ZW1bMF0uc3R5bGUuaGVpZ2h0LCBwb3NpdGlvbjogdGhpcy5jdXJyZW50SXRlbS5jc3MoInBvc2l0aW9uIiksIHRvcDogdGhpcy5jdXJyZW50SXRlbS5jc3MoInRvcCIpLCBsZWZ0OiB0aGlzLmN1cnJlbnRJdGVtLmNzcygibGVmdCIpIH07CgkJfQoKCQlpZighaGVscGVyWzBdLnN0eWxlLndpZHRoIHx8IG8uZm9yY2VIZWxwZXJTaXplKSB7CgkJCWhlbHBlci53aWR0aCh0aGlzLmN1cnJlbnRJdGVtLndpZHRoKCkpOwoJCX0KCQlpZighaGVscGVyWzBdLnN0eWxlLmhlaWdodCB8fCBvLmZvcmNlSGVscGVyU2l6ZSkgewoJCQloZWxwZXIuaGVpZ2h0KHRoaXMuY3VycmVudEl0ZW0uaGVpZ2h0KCkpOwoJCX0KCgkJcmV0dXJuIGhlbHBlcjsKCgl9LAoKCV9hZGp1c3RPZmZzZXRGcm9tSGVscGVyOiBmdW5jdGlvbihvYmopIHsKCQlpZiAodHlwZW9mIG9iaiA9PT0gInN0cmluZyIpIHsKCQkJb2JqID0gb2JqLnNwbGl0KCIgIik7CgkJfQoJCWlmICgkLmlzQXJyYXkob2JqKSkgewoJCQlvYmogPSB7bGVmdDogK29ialswXSwgdG9wOiArb2JqWzFdIHx8IDB9OwoJCX0KCQlpZiAoImxlZnQiIGluIG9iaikgewoJCQl0aGlzLm9mZnNldC5jbGljay5sZWZ0ID0gb2JqLmxlZnQgKyB0aGlzLm1hcmdpbnMubGVmdDsKCQl9CgkJaWYgKCJyaWdodCIgaW4gb2JqKSB7CgkJCXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPSB0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoIC0gb2JqLnJpZ2h0ICsgdGhpcy5tYXJnaW5zLmxlZnQ7CgkJfQoJCWlmICgidG9wIiBpbiBvYmopIHsKCQkJdGhpcy5vZmZzZXQuY2xpY2sudG9wID0gb2JqLnRvcCArIHRoaXMubWFyZ2lucy50b3A7CgkJfQoJCWlmICgiYm90dG9tIiBpbiBvYmopIHsKCQkJdGhpcy5vZmZzZXQuY2xpY2sudG9wID0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLSBvYmouYm90dG9tICsgdGhpcy5tYXJnaW5zLnRvcDsKCQl9Cgl9LAoKCV9nZXRQYXJlbnRPZmZzZXQ6IGZ1bmN0aW9uKCkgewoKCgkJLy9HZXQgdGhlIG9mZnNldFBhcmVudCBhbmQgY2FjaGUgaXRzIHBvc2l0aW9uCgkJdGhpcy5vZmZzZXRQYXJlbnQgPSB0aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTsKCQl2YXIgcG8gPSB0aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTsKCgkJLy8gVGhpcyBpcyBhIHNwZWNpYWwgY2FzZSB3aGVyZSB3ZSBuZWVkIHRvIG1vZGlmeSBhIG9mZnNldCBjYWxjdWxhdGVkIG9uIHN0YXJ0LCBzaW5jZSB0aGUgZm9sbG93aW5nIGhhcHBlbmVkOgoJCS8vIDEuIFRoZSBwb3NpdGlvbiBvZiB0aGUgaGVscGVyIGlzIGFic29sdXRlLCBzbyBpdCdzIHBvc2l0aW9uIGlzIGNhbGN1bGF0ZWQgYmFzZWQgb24gdGhlIG5leHQgcG9zaXRpb25lZCBwYXJlbnQKCQkvLyAyLiBUaGUgYWN0dWFsIG9mZnNldCBwYXJlbnQgaXMgYSBjaGlsZCBvZiB0aGUgc2Nyb2xsIHBhcmVudCwgYW5kIHRoZSBzY3JvbGwgcGFyZW50IGlzbid0IHRoZSBkb2N1bWVudCwgd2hpY2ggbWVhbnMgdGhhdAoJCS8vICAgIHRoZSBzY3JvbGwgaXMgaW5jbHVkZWQgaW4gdGhlIGluaXRpYWwgY2FsY3VsYXRpb24gb2YgdGhlIG9mZnNldCBvZiB0aGUgcGFyZW50LCBhbmQgbmV2ZXIgcmVjYWxjdWxhdGVkIHVwb24gZHJhZwoJCWlmKHRoaXMuY3NzUG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgJiYgdGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IGRvY3VtZW50ICYmICQuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sIHRoaXMub2Zmc2V0UGFyZW50WzBdKSkgewoJCQlwby5sZWZ0ICs9IHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTsKCQkJcG8udG9wICs9IHRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOwoJCX0KCgkJLy8gVGhpcyBuZWVkcyB0byBiZSBhY3R1YWxseSBkb25lIGZvciBhbGwgYnJvd3NlcnMsIHNpbmNlIHBhZ2VYL3BhZ2VZIGluY2x1ZGVzIHRoaXMgaW5mb3JtYXRpb24KCQkvLyB3aXRoIGFuIHVnbHkgSUUgZml4CgkJaWYoIHRoaXMub2Zmc2V0UGFyZW50WzBdID09PSBkb2N1bWVudC5ib2R5IHx8ICh0aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lICYmIHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gImh0bWwiICYmICQudWkuaWUpKSB7CgkJCXBvID0geyB0b3A6IDAsIGxlZnQ6IDAgfTsKCQl9CgoJCXJldHVybiB7CgkJCXRvcDogcG8udG9wICsgKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCkgfHwgMCksCgkJCWxlZnQ6IHBvLmxlZnQgKyAocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwxMCkgfHwgMCkKCQl9OwoKCX0sCgoJX2dldFJlbGF0aXZlT2Zmc2V0OiBmdW5jdGlvbigpIHsKCgkJaWYodGhpcy5jc3NQb3NpdGlvbiA9PT0gInJlbGF0aXZlIikgewoJCQl2YXIgcCA9IHRoaXMuY3VycmVudEl0ZW0ucG9zaXRpb24oKTsKCQkJcmV0dXJuIHsKCQkJCXRvcDogcC50b3AgLSAocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKCJ0b3AiKSwxMCkgfHwgMCkgKyB0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSwKCQkJCWxlZnQ6IHAubGVmdCAtIChwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoImxlZnQiKSwxMCkgfHwgMCkgKyB0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCkKCQkJfTsKCQl9IGVsc2UgewoJCQlyZXR1cm4geyB0b3A6IDAsIGxlZnQ6IDAgfTsKCQl9CgoJfSwKCglfY2FjaGVNYXJnaW5zOiBmdW5jdGlvbigpIHsKCQl0aGlzLm1hcmdpbnMgPSB7CgkJCWxlZnQ6IChwYXJzZUludCh0aGlzLmN1cnJlbnRJdGVtLmNzcygibWFyZ2luTGVmdCIpLDEwKSB8fCAwKSwKCQkJdG9wOiAocGFyc2VJbnQodGhpcy5jdXJyZW50SXRlbS5jc3MoIm1hcmdpblRvcCIpLDEwKSB8fCAwKQoJCX07Cgl9LAoKCV9jYWNoZUhlbHBlclByb3BvcnRpb25zOiBmdW5jdGlvbigpIHsKCQl0aGlzLmhlbHBlclByb3BvcnRpb25zID0gewoJCQl3aWR0aDogdGhpcy5oZWxwZXIub3V0ZXJXaWR0aCgpLAoJCQloZWlnaHQ6IHRoaXMuaGVscGVyLm91dGVySGVpZ2h0KCkKCQl9OwoJfSwKCglfc2V0Q29udGFpbm1lbnQ6IGZ1bmN0aW9uKCkgewoKCQl2YXIgY2UsIGNvLCBvdmVyLAoJCQlvID0gdGhpcy5vcHRpb25zOwoJCWlmKG8uY29udGFpbm1lbnQgPT09ICJwYXJlbnQiKSB7CgkJCW8uY29udGFpbm1lbnQgPSB0aGlzLmhlbHBlclswXS5wYXJlbnROb2RlOwoJCX0KCQlpZihvLmNvbnRhaW5tZW50ID09PSAiZG9jdW1lbnQiIHx8IG8uY29udGFpbm1lbnQgPT09ICJ3aW5kb3ciKSB7CgkJCXRoaXMuY29udGFpbm1lbnQgPSBbCgkJCQkwIC0gdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCAtIHRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LAoJCQkJMCAtIHRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCAtIHRoaXMub2Zmc2V0LnBhcmVudC50b3AsCgkJCQkkKG8uY29udGFpbm1lbnQgPT09ICJkb2N1bWVudCIgPyBkb2N1bWVudCA6IHdpbmRvdykud2lkdGgoKSAtIHRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGggLSB0aGlzLm1hcmdpbnMubGVmdCwKCQkJCSgkKG8uY29udGFpbm1lbnQgPT09ICJkb2N1bWVudCIgPyBkb2N1bWVudCA6IHdpbmRvdykuaGVpZ2h0KCkgfHwgZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodCkgLSB0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCAtIHRoaXMubWFyZ2lucy50b3AKCQkJXTsKCQl9CgoJCWlmKCEoL14oZG9jdW1lbnR8d2luZG93fHBhcmVudCkkLykudGVzdChvLmNvbnRhaW5tZW50KSkgewoJCQljZSA9ICQoby5jb250YWlubWVudClbMF07CgkJCWNvID0gJChvLmNvbnRhaW5tZW50KS5vZmZzZXQoKTsKCQkJb3ZlciA9ICgkKGNlKS5jc3MoIm92ZXJmbG93IikgIT09ICJoaWRkZW4iKTsKCgkJCXRoaXMuY29udGFpbm1lbnQgPSBbCgkJCQljby5sZWZ0ICsgKHBhcnNlSW50KCQoY2UpLmNzcygiYm9yZGVyTGVmdFdpZHRoIiksMTApIHx8IDApICsgKHBhcnNlSW50KCQoY2UpLmNzcygicGFkZGluZ0xlZnQiKSwxMCkgfHwgMCkgLSB0aGlzLm1hcmdpbnMubGVmdCwKCQkJCWNvLnRvcCArIChwYXJzZUludCgkKGNlKS5jc3MoImJvcmRlclRvcFdpZHRoIiksMTApIHx8IDApICsgKHBhcnNlSW50KCQoY2UpLmNzcygicGFkZGluZ1RvcCIpLDEwKSB8fCAwKSAtIHRoaXMubWFyZ2lucy50b3AsCgkJCQljby5sZWZ0KyhvdmVyID8gTWF0aC5tYXgoY2Uuc2Nyb2xsV2lkdGgsY2Uub2Zmc2V0V2lkdGgpIDogY2Uub2Zmc2V0V2lkdGgpIC0gKHBhcnNlSW50KCQoY2UpLmNzcygiYm9yZGVyTGVmdFdpZHRoIiksMTApIHx8IDApIC0gKHBhcnNlSW50KCQoY2UpLmNzcygicGFkZGluZ1JpZ2h0IiksMTApIHx8IDApIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCAtIHRoaXMubWFyZ2lucy5sZWZ0LAoJCQkJY28udG9wKyhvdmVyID8gTWF0aC5tYXgoY2Uuc2Nyb2xsSGVpZ2h0LGNlLm9mZnNldEhlaWdodCkgOiBjZS5vZmZzZXRIZWlnaHQpIC0gKHBhcnNlSW50KCQoY2UpLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCkgfHwgMCkgLSAocGFyc2VJbnQoJChjZSkuY3NzKCJwYWRkaW5nQm90dG9tIiksMTApIHx8IDApIC0gdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQgLSB0aGlzLm1hcmdpbnMudG9wCgkJCV07CgkJfQoKCX0sCgoJX2NvbnZlcnRQb3NpdGlvblRvOiBmdW5jdGlvbihkLCBwb3MpIHsKCgkJaWYoIXBvcykgewoJCQlwb3MgPSB0aGlzLnBvc2l0aW9uOwoJCX0KCQl2YXIgbW9kID0gZCA9PT0gImFic29sdXRlIiA/IDEgOiAtMSwKCQkJc2Nyb2xsID0gdGhpcy5jc3NQb3NpdGlvbiA9PT0gImFic29sdXRlIiAmJiAhKHRoaXMuc2Nyb2xsUGFyZW50WzBdICE9PSBkb2N1bWVudCAmJiAkLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLCB0aGlzLm9mZnNldFBhcmVudFswXSkpID8gdGhpcy5vZmZzZXRQYXJlbnQgOiB0aGlzLnNjcm9sbFBhcmVudCwKCQkJc2Nyb2xsSXNSb290Tm9kZSA9ICgvKGh0bWx8Ym9keSkvaSkudGVzdChzY3JvbGxbMF0udGFnTmFtZSk7CgoJCXJldHVybiB7CgkJCXRvcDogKAoJCQkJcG9zLnRvcAkrCQkJCQkJCQkJCQkJCQkJCS8vIFRoZSBhYnNvbHV0ZSBtb3VzZSBwb3NpdGlvbgoJCQkJdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wICogbW9kICsJCQkJCQkJCQkJLy8gT25seSBmb3IgcmVsYXRpdmUgcG9zaXRpb25lZCBub2RlczogUmVsYXRpdmUgb2Zmc2V0IGZyb20gZWxlbWVudCB0byBvZmZzZXQgcGFyZW50CgkJCQl0aGlzLm9mZnNldC5wYXJlbnQudG9wICogbW9kIC0JCQkJCQkJCQkJCS8vIFRoZSBvZmZzZXRQYXJlbnQncyBvZmZzZXQgd2l0aG91dCBib3JkZXJzIChvZmZzZXQgKyBib3JkZXIpCgkJCQkoICggdGhpcy5jc3NQb3NpdGlvbiA9PT0gImZpeGVkIiA/IC10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSA6ICggc2Nyb2xsSXNSb290Tm9kZSA/IDAgOiBzY3JvbGwuc2Nyb2xsVG9wKCkgKSApICogbW9kKQoJCQkpLAoJCQlsZWZ0OiAoCgkJCQlwb3MubGVmdCArCQkJCQkJCQkJCQkJCQkJCS8vIFRoZSBhYnNvbHV0ZSBtb3VzZSBwb3NpdGlvbgoJCQkJdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCAqIG1vZCArCQkJCQkJCQkJCS8vIE9ubHkgZm9yIHJlbGF0aXZlIHBvc2l0aW9uZWQgbm9kZXM6IFJlbGF0aXZlIG9mZnNldCBmcm9tIGVsZW1lbnQgdG8gb2Zmc2V0IHBhcmVudAoJCQkJdGhpcy5vZmZzZXQucGFyZW50LmxlZnQgKiBtb2QJLQkJCQkJCQkJCQkvLyBUaGUgb2Zmc2V0UGFyZW50J3Mgb2Zmc2V0IHdpdGhvdXQgYm9yZGVycyAob2Zmc2V0ICsgYm9yZGVyKQoJCQkJKCAoIHRoaXMuY3NzUG9zaXRpb24gPT09ICJmaXhlZCIgPyAtdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpIDogc2Nyb2xsSXNSb290Tm9kZSA/IDAgOiBzY3JvbGwuc2Nyb2xsTGVmdCgpICkgKiBtb2QpCgkJCSkKCQl9OwoKCX0sCgoJX2dlbmVyYXRlUG9zaXRpb246IGZ1bmN0aW9uKGV2ZW50KSB7CgoJCXZhciB0b3AsIGxlZnQsCgkJCW8gPSB0aGlzLm9wdGlvbnMsCgkJCXBhZ2VYID0gZXZlbnQucGFnZVgsCgkJCXBhZ2VZID0gZXZlbnQucGFnZVksCgkJCXNjcm9sbCA9IHRoaXMuY3NzUG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgJiYgISh0aGlzLnNjcm9sbFBhcmVudFswXSAhPT0gZG9jdW1lbnQgJiYgJC5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSwgdGhpcy5vZmZzZXRQYXJlbnRbMF0pKSA/IHRoaXMub2Zmc2V0UGFyZW50IDogdGhpcy5zY3JvbGxQYXJlbnQsIHNjcm9sbElzUm9vdE5vZGUgPSAoLyhodG1sfGJvZHkpL2kpLnRlc3Qoc2Nyb2xsWzBdLnRhZ05hbWUpOwoKCQkvLyBUaGlzIGlzIGFub3RoZXIgdmVyeSB3ZWlyZCBzcGVjaWFsIGNhc2UgdGhhdCBvbmx5IGhhcHBlbnMgZm9yIHJlbGF0aXZlIGVsZW1lbnRzOgoJCS8vIDEuIElmIHRoZSBjc3MgcG9zaXRpb24gaXMgcmVsYXRpdmUKCQkvLyAyLiBhbmQgdGhlIHNjcm9sbCBwYXJlbnQgaXMgdGhlIGRvY3VtZW50IG9yIHNpbWlsYXIgdG8gdGhlIG9mZnNldCBwYXJlbnQKCQkvLyB3ZSBoYXZlIHRvIHJlZnJlc2ggdGhlIHJlbGF0aXZlIG9mZnNldCBkdXJpbmcgdGhlIHNjcm9sbCBzbyB0aGVyZSBhcmUgbm8ganVtcHMKCQlpZih0aGlzLmNzc1Bvc2l0aW9uID09PSAicmVsYXRpdmUiICYmICEodGhpcy5zY3JvbGxQYXJlbnRbMF0gIT09IGRvY3VtZW50ICYmIHRoaXMuc2Nyb2xsUGFyZW50WzBdICE9PSB0aGlzLm9mZnNldFBhcmVudFswXSkpIHsKCQkJdGhpcy5vZmZzZXQucmVsYXRpdmUgPSB0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpOwoJCX0KCgkJLyoKCQkgKiAtIFBvc2l0aW9uIGNvbnN0cmFpbmluZyAtCgkJICogQ29uc3RyYWluIHRoZSBwb3NpdGlvbiB0byBhIG1peCBvZiBncmlkLCBjb250YWlubWVudC4KCQkgKi8KCgkJaWYodGhpcy5vcmlnaW5hbFBvc2l0aW9uKSB7IC8vSWYgd2UgYXJlIG5vdCBkcmFnZ2luZyB5ZXQsIHdlIHdvbid0IGNoZWNrIGZvciBvcHRpb25zCgoJCQlpZih0aGlzLmNvbnRhaW5tZW50KSB7CgkJCQlpZihldmVudC5wYWdlWCAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPCB0aGlzLmNvbnRhaW5tZW50WzBdKSB7CgkJCQkJcGFnZVggPSB0aGlzLmNvbnRhaW5tZW50WzBdICsgdGhpcy5vZmZzZXQuY2xpY2subGVmdDsKCQkJCX0KCQkJCWlmKGV2ZW50LnBhZ2VZIC0gdGhpcy5vZmZzZXQuY2xpY2sudG9wIDwgdGhpcy5jb250YWlubWVudFsxXSkgewoJCQkJCXBhZ2VZID0gdGhpcy5jb250YWlubWVudFsxXSArIHRoaXMub2Zmc2V0LmNsaWNrLnRvcDsKCQkJCX0KCQkJCWlmKGV2ZW50LnBhZ2VYIC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA+IHRoaXMuY29udGFpbm1lbnRbMl0pIHsKCQkJCQlwYWdlWCA9IHRoaXMuY29udGFpbm1lbnRbMl0gKyB0aGlzLm9mZnNldC5jbGljay5sZWZ0OwoJCQkJfQoJCQkJaWYoZXZlbnQucGFnZVkgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPiB0aGlzLmNvbnRhaW5tZW50WzNdKSB7CgkJCQkJcGFnZVkgPSB0aGlzLmNvbnRhaW5tZW50WzNdICsgdGhpcy5vZmZzZXQuY2xpY2sudG9wOwoJCQkJfQoJCQl9CgoJCQlpZihvLmdyaWQpIHsKCQkJCXRvcCA9IHRoaXMub3JpZ2luYWxQYWdlWSArIE1hdGgucm91bmQoKHBhZ2VZIC0gdGhpcy5vcmlnaW5hbFBhZ2VZKSAvIG8uZ3JpZFsxXSkgKiBvLmdyaWRbMV07CgkJCQlwYWdlWSA9IHRoaXMuY29udGFpbm1lbnQgPyAoICh0b3AgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPj0gdGhpcy5jb250YWlubWVudFsxXSAmJiB0b3AgLSB0aGlzLm9mZnNldC5jbGljay50b3AgPD0gdGhpcy5jb250YWlubWVudFszXSkgPyB0b3AgOiAoKHRvcCAtIHRoaXMub2Zmc2V0LmNsaWNrLnRvcCA+PSB0aGlzLmNvbnRhaW5tZW50WzFdKSA/IHRvcCAtIG8uZ3JpZFsxXSA6IHRvcCArIG8uZ3JpZFsxXSkpIDogdG9wOwoKCQkJCWxlZnQgPSB0aGlzLm9yaWdpbmFsUGFnZVggKyBNYXRoLnJvdW5kKChwYWdlWCAtIHRoaXMub3JpZ2luYWxQYWdlWCkgLyBvLmdyaWRbMF0pICogby5ncmlkWzBdOwoJCQkJcGFnZVggPSB0aGlzLmNvbnRhaW5tZW50ID8gKCAobGVmdCAtIHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQgPj0gdGhpcy5jb250YWlubWVudFswXSAmJiBsZWZ0IC0gdGhpcy5vZmZzZXQuY2xpY2subGVmdCA8PSB0aGlzLmNvbnRhaW5tZW50WzJdKSA/IGxlZnQgOiAoKGxlZnQgLSB0aGlzLm9mZnNldC5jbGljay5sZWZ0ID49IHRoaXMuY29udGFpbm1lbnRbMF0pID8gbGVmdCAtIG8uZ3JpZFswXSA6IGxlZnQgKyBvLmdyaWRbMF0pKSA6IGxlZnQ7CgkJCX0KCgkJfQoKCQlyZXR1cm4gewoJCQl0b3A6ICgKCQkJCXBhZ2VZIC0JCQkJCQkJCQkJCQkJCQkJLy8gVGhlIGFic29sdXRlIG1vdXNlIHBvc2l0aW9uCgkJCQl0aGlzLm9mZnNldC5jbGljay50b3AgLQkJCQkJCQkJCQkJCQkvLyBDbGljayBvZmZzZXQgKHJlbGF0aXZlIHRvIHRoZSBlbGVtZW50KQoJCQkJdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wCS0JCQkJCQkJCQkJCS8vIE9ubHkgZm9yIHJlbGF0aXZlIHBvc2l0aW9uZWQgbm9kZXM6IFJlbGF0aXZlIG9mZnNldCBmcm9tIGVsZW1lbnQgdG8gb2Zmc2V0IHBhcmVudAoJCQkJdGhpcy5vZmZzZXQucGFyZW50LnRvcCArCQkJCQkJCQkJCQkJLy8gVGhlIG9mZnNldFBhcmVudCdzIG9mZnNldCB3aXRob3V0IGJvcmRlcnMgKG9mZnNldCArIGJvcmRlcikKCQkJCSggKCB0aGlzLmNzc1Bvc2l0aW9uID09PSAiZml4ZWQiID8gLXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpIDogKCBzY3JvbGxJc1Jvb3ROb2RlID8gMCA6IHNjcm9sbC5zY3JvbGxUb3AoKSApICkpCgkJCSksCgkJCWxlZnQ6ICgKCQkJCXBhZ2VYIC0JCQkJCQkJCQkJCQkJCQkJLy8gVGhlIGFic29sdXRlIG1vdXNlIHBvc2l0aW9uCgkJCQl0aGlzLm9mZnNldC5jbGljay5sZWZ0IC0JCQkJCQkJCQkJCQkvLyBDbGljayBvZmZzZXQgKHJlbGF0aXZlIHRvIHRoZSBlbGVtZW50KQoJCQkJdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdAktCQkJCQkJCQkJCQkvLyBPbmx5IGZvciByZWxhdGl2ZSBwb3NpdGlvbmVkIG5vZGVzOiBSZWxhdGl2ZSBvZmZzZXQgZnJvbSBlbGVtZW50IHRvIG9mZnNldCBwYXJlbnQKCQkJCXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0ICsJCQkJCQkJCQkJCQkvLyBUaGUgb2Zmc2V0UGFyZW50J3Mgb2Zmc2V0IHdpdGhvdXQgYm9yZGVycyAob2Zmc2V0ICsgYm9yZGVyKQoJCQkJKCAoIHRoaXMuY3NzUG9zaXRpb24gPT09ICJmaXhlZCIgPyAtdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpIDogc2Nyb2xsSXNSb290Tm9kZSA/IDAgOiBzY3JvbGwuc2Nyb2xsTGVmdCgpICkpCgkJCSkKCQl9OwoKCX0sCgoJX3JlYXJyYW5nZTogZnVuY3Rpb24oZXZlbnQsIGksIGEsIGhhcmRSZWZyZXNoKSB7CgoJCWEgPyBhWzBdLmFwcGVuZENoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pIDogaS5pdGVtWzBdLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMucGxhY2Vob2xkZXJbMF0sICh0aGlzLmRpcmVjdGlvbiA9PT0gImRvd24iID8gaS5pdGVtWzBdIDogaS5pdGVtWzBdLm5leHRTaWJsaW5nKSk7CgoJCS8vVmFyaW91cyB0aGluZ3MgZG9uZSBoZXJlIHRvIGltcHJvdmUgdGhlIHBlcmZvcm1hbmNlOgoJCS8vIDEuIHdlIGNyZWF0ZSBhIHNldFRpbWVvdXQsIHRoYXQgY2FsbHMgcmVmcmVzaFBvc2l0aW9ucwoJCS8vIDIuIG9uIHRoZSBpbnN0YW5jZSwgd2UgaGF2ZSBhIGNvdW50ZXIgdmFyaWFibGUsIHRoYXQgZ2V0J3MgaGlnaGVyIGFmdGVyIGV2ZXJ5IGFwcGVuZAoJCS8vIDMuIG9uIHRoZSBsb2NhbCBzY29wZSwgd2UgY29weSB0aGUgY291bnRlciB2YXJpYWJsZSwgYW5kIGNoZWNrIGluIHRoZSB0aW1lb3V0LCBpZiBpdCdzIHN0aWxsIHRoZSBzYW1lCgkJLy8gNC4gdGhpcyBsZXRzIG9ubHkgdGhlIGxhc3QgYWRkaXRpb24gdG8gdGhlIHRpbWVvdXQgc3RhY2sgdGhyb3VnaAoJCXRoaXMuY291bnRlciA9IHRoaXMuY291bnRlciA/ICsrdGhpcy5jb3VudGVyIDogMTsKCQl2YXIgY291bnRlciA9IHRoaXMuY291bnRlcjsKCgkJdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CgkJCWlmKGNvdW50ZXIgPT09IHRoaXMuY291bnRlcikgewoJCQkJdGhpcy5yZWZyZXNoUG9zaXRpb25zKCFoYXJkUmVmcmVzaCk7IC8vUHJlY29tcHV0ZSBhZnRlciBlYWNoIERPTSBpbnNlcnRpb24sIE5PVCBvbiBtb3VzZW1vdmUKCQkJfQoJCX0pOwoKCX0sCgoJX2NsZWFyOiBmdW5jdGlvbihldmVudCwgbm9Qcm9wYWdhdGlvbikgewoKCQl0aGlzLnJldmVydGluZyA9IGZhbHNlOwoJCS8vIFdlIGRlbGF5IGFsbCBldmVudHMgdGhhdCBoYXZlIHRvIGJlIHRyaWdnZXJlZCB0byBhZnRlciB0aGUgcG9pbnQgd2hlcmUgdGhlIHBsYWNlaG9sZGVyIGhhcyBiZWVuIHJlbW92ZWQgYW5kCgkJLy8gZXZlcnl0aGluZyBlbHNlIG5vcm1hbGl6ZWQgYWdhaW4KCQl2YXIgaSwKCQkJZGVsYXllZFRyaWdnZXJzID0gW107CgoJCS8vIFdlIGZpcnN0IGhhdmUgdG8gdXBkYXRlIHRoZSBkb20gcG9zaXRpb24gb2YgdGhlIGFjdHVhbCBjdXJyZW50SXRlbQoJCS8vIE5vdGU6IGRvbid0IGRvIGl0IGlmIHRoZSBjdXJyZW50IGl0ZW0gaXMgYWxyZWFkeSByZW1vdmVkIChieSBhIHVzZXIpLCBvciBpdCBnZXRzIHJlYXBwZW5kZWQgKHNlZSAjNDA4OCkKCQlpZighdGhpcy5fbm9GaW5hbFNvcnQgJiYgdGhpcy5jdXJyZW50SXRlbS5wYXJlbnQoKS5sZW5ndGgpIHsKCQkJdGhpcy5wbGFjZWhvbGRlci5iZWZvcmUodGhpcy5jdXJyZW50SXRlbSk7CgkJfQoJCXRoaXMuX25vRmluYWxTb3J0ID0gbnVsbDsKCgkJaWYodGhpcy5oZWxwZXJbMF0gPT09IHRoaXMuY3VycmVudEl0ZW1bMF0pIHsKCQkJZm9yKGkgaW4gdGhpcy5fc3RvcmVkQ1NTKSB7CgkJCQlpZih0aGlzLl9zdG9yZWRDU1NbaV0gPT09ICJhdXRvIiB8fCB0aGlzLl9zdG9yZWRDU1NbaV0gPT09ICJzdGF0aWMiKSB7CgkJCQkJdGhpcy5fc3RvcmVkQ1NTW2ldID0gIiI7CgkJCQl9CgkJCX0KCQkJdGhpcy5jdXJyZW50SXRlbS5jc3ModGhpcy5fc3RvcmVkQ1NTKS5yZW1vdmVDbGFzcygidWktc29ydGFibGUtaGVscGVyIik7CgkJfSBlbHNlIHsKCQkJdGhpcy5jdXJyZW50SXRlbS5zaG93KCk7CgkJfQoKCQlpZih0aGlzLmZyb21PdXRzaWRlICYmICFub1Byb3BhZ2F0aW9uKSB7CgkJCWRlbGF5ZWRUcmlnZ2Vycy5wdXNoKGZ1bmN0aW9uKGV2ZW50KSB7IHRoaXMuX3RyaWdnZXIoInJlY2VpdmUiLCBldmVudCwgdGhpcy5fdWlIYXNoKHRoaXMuZnJvbU91dHNpZGUpKTsgfSk7CgkJfQoJCWlmKCh0aGlzLmZyb21PdXRzaWRlIHx8IHRoaXMuZG9tUG9zaXRpb24ucHJldiAhPT0gdGhpcy5jdXJyZW50SXRlbS5wcmV2KCkubm90KCIudWktc29ydGFibGUtaGVscGVyIilbMF0gfHwgdGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQgIT09IHRoaXMuY3VycmVudEl0ZW0ucGFyZW50KClbMF0pICYmICFub1Byb3BhZ2F0aW9uKSB7CgkJCWRlbGF5ZWRUcmlnZ2Vycy5wdXNoKGZ1bmN0aW9uKGV2ZW50KSB7IHRoaXMuX3RyaWdnZXIoInVwZGF0ZSIsIGV2ZW50LCB0aGlzLl91aUhhc2goKSk7IH0pOyAvL1RyaWdnZXIgdXBkYXRlIGNhbGxiYWNrIGlmIHRoZSBET00gcG9zaXRpb24gaGFzIGNoYW5nZWQKCQl9CgoJCS8vIENoZWNrIGlmIHRoZSBpdGVtcyBDb250YWluZXIgaGFzIENoYW5nZWQgYW5kIHRyaWdnZXIgYXBwcm9wcmlhdGUKCQkvLyBldmVudHMuCgkJaWYgKHRoaXMgIT09IHRoaXMuY3VycmVudENvbnRhaW5lcikgewoJCQlpZighbm9Qcm9wYWdhdGlvbikgewoJCQkJZGVsYXllZFRyaWdnZXJzLnB1c2goZnVuY3Rpb24oZXZlbnQpIHsgdGhpcy5fdHJpZ2dlcigicmVtb3ZlIiwgZXZlbnQsIHRoaXMuX3VpSGFzaCgpKTsgfSk7CgkJCQlkZWxheWVkVHJpZ2dlcnMucHVzaCgoZnVuY3Rpb24oYykgeyByZXR1cm4gZnVuY3Rpb24oZXZlbnQpIHsgYy5fdHJpZ2dlcigicmVjZWl2ZSIsIGV2ZW50LCB0aGlzLl91aUhhc2godGhpcykpOyB9OyAgfSkuY2FsbCh0aGlzLCB0aGlzLmN1cnJlbnRDb250YWluZXIpKTsKCQkJCWRlbGF5ZWRUcmlnZ2Vycy5wdXNoKChmdW5jdGlvbihjKSB7IHJldHVybiBmdW5jdGlvbihldmVudCkgeyBjLl90cmlnZ2VyKCJ1cGRhdGUiLCBldmVudCwgdGhpcy5fdWlIYXNoKHRoaXMpKTsgIH07IH0pLmNhbGwodGhpcywgdGhpcy5jdXJyZW50Q29udGFpbmVyKSk7CgkJCX0KCQl9CgoKCQkvL1Bvc3QgZXZlbnRzIHRvIGNvbnRhaW5lcnMKCQlmdW5jdGlvbiBkZWxheUV2ZW50KCB0eXBlLCBpbnN0YW5jZSwgY29udGFpbmVyICkgewoJCQlyZXR1cm4gZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJY29udGFpbmVyLl90cmlnZ2VyKCB0eXBlLCBldmVudCwgaW5zdGFuY2UuX3VpSGFzaCggaW5zdGFuY2UgKSApOwoJCQl9OwoJCX0KCQlmb3IgKGkgPSB0aGlzLmNvbnRhaW5lcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pewoJCQlpZiAoIW5vUHJvcGFnYXRpb24pIHsKCQkJCWRlbGF5ZWRUcmlnZ2Vycy5wdXNoKCBkZWxheUV2ZW50KCAiZGVhY3RpdmF0ZSIsIHRoaXMsIHRoaXMuY29udGFpbmVyc1sgaSBdICkgKTsKCQkJfQoJCQlpZih0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUub3ZlcikgewoJCQkJZGVsYXllZFRyaWdnZXJzLnB1c2goIGRlbGF5RXZlbnQoICJvdXQiLCB0aGlzLCB0aGlzLmNvbnRhaW5lcnNbIGkgXSApICk7CgkJCQl0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUub3ZlciA9IDA7CgkJCX0KCQl9CgoJCS8vRG8gd2hhdCB3YXMgb3JpZ2luYWxseSBpbiBwbHVnaW5zCgkJaWYgKCB0aGlzLnN0b3JlZEN1cnNvciApIHsKCQkJdGhpcy5kb2N1bWVudC5maW5kKCAiYm9keSIgKS5jc3MoICJjdXJzb3IiLCB0aGlzLnN0b3JlZEN1cnNvciApOwoJCQl0aGlzLnN0b3JlZFN0eWxlc2hlZXQucmVtb3ZlKCk7CgkJfQoJCWlmKHRoaXMuX3N0b3JlZE9wYWNpdHkpIHsKCQkJdGhpcy5oZWxwZXIuY3NzKCJvcGFjaXR5IiwgdGhpcy5fc3RvcmVkT3BhY2l0eSk7CgkJfQoJCWlmKHRoaXMuX3N0b3JlZFpJbmRleCkgewoJCQl0aGlzLmhlbHBlci5jc3MoInpJbmRleCIsIHRoaXMuX3N0b3JlZFpJbmRleCA9PT0gImF1dG8iID8gIiIgOiB0aGlzLl9zdG9yZWRaSW5kZXgpOwoJCX0KCgkJdGhpcy5kcmFnZ2luZyA9IGZhbHNlOwoJCWlmKHRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbCkgewoJCQlpZighbm9Qcm9wYWdhdGlvbikgewoJCQkJdGhpcy5fdHJpZ2dlcigiYmVmb3JlU3RvcCIsIGV2ZW50LCB0aGlzLl91aUhhc2goKSk7CgkJCQlmb3IgKGk9MDsgaSA8IGRlbGF5ZWRUcmlnZ2Vycy5sZW5ndGg7IGkrKykgewoJCQkJCWRlbGF5ZWRUcmlnZ2Vyc1tpXS5jYWxsKHRoaXMsIGV2ZW50KTsKCQkJCX0gLy9UcmlnZ2VyIGFsbCBkZWxheWVkIGV2ZW50cwoJCQkJdGhpcy5fdHJpZ2dlcigic3RvcCIsIGV2ZW50LCB0aGlzLl91aUhhc2goKSk7CgkJCX0KCgkJCXRoaXMuZnJvbU91dHNpZGUgPSBmYWxzZTsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJaWYoIW5vUHJvcGFnYXRpb24pIHsKCQkJdGhpcy5fdHJpZ2dlcigiYmVmb3JlU3RvcCIsIGV2ZW50LCB0aGlzLl91aUhhc2goKSk7CgkJfQoKCQkvLyQodGhpcy5wbGFjZWhvbGRlclswXSkucmVtb3ZlKCk7IHdvdWxkIGhhdmUgYmVlbiB0aGUgalF1ZXJ5IHdheSAtIHVuZm9ydHVuYXRlbHksIGl0IHVuYmluZHMgQUxMIGV2ZW50cyBmcm9tIHRoZSBvcmlnaW5hbCBub2RlIQoJCXRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKTsKCgkJaWYodGhpcy5oZWxwZXJbMF0gIT09IHRoaXMuY3VycmVudEl0ZW1bMF0pIHsKCQkJdGhpcy5oZWxwZXIucmVtb3ZlKCk7CgkJfQoJCXRoaXMuaGVscGVyID0gbnVsbDsKCgkJaWYoIW5vUHJvcGFnYXRpb24pIHsKCQkJZm9yIChpPTA7IGkgPCBkZWxheWVkVHJpZ2dlcnMubGVuZ3RoOyBpKyspIHsKCQkJCWRlbGF5ZWRUcmlnZ2Vyc1tpXS5jYWxsKHRoaXMsIGV2ZW50KTsKCQkJfSAvL1RyaWdnZXIgYWxsIGRlbGF5ZWQgZXZlbnRzCgkJCXRoaXMuX3RyaWdnZXIoInN0b3AiLCBldmVudCwgdGhpcy5fdWlIYXNoKCkpOwoJCX0KCgkJdGhpcy5mcm9tT3V0c2lkZSA9IGZhbHNlOwoJCXJldHVybiB0cnVlOwoKCX0sCgoJX3RyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCWlmICgkLldpZGdldC5wcm90b3R5cGUuX3RyaWdnZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSA9PT0gZmFsc2UpIHsKCQkJdGhpcy5jYW5jZWwoKTsKCQl9Cgl9LAoKCV91aUhhc2g6IGZ1bmN0aW9uKF9pbnN0KSB7CgkJdmFyIGluc3QgPSBfaW5zdCB8fCB0aGlzOwoJCXJldHVybiB7CgkJCWhlbHBlcjogaW5zdC5oZWxwZXIsCgkJCXBsYWNlaG9sZGVyOiBpbnN0LnBsYWNlaG9sZGVyIHx8ICQoW10pLAoJCQlwb3NpdGlvbjogaW5zdC5wb3NpdGlvbiwKCQkJb3JpZ2luYWxQb3NpdGlvbjogaW5zdC5vcmlnaW5hbFBvc2l0aW9uLAoJCQlvZmZzZXQ6IGluc3QucG9zaXRpb25BYnMsCgkJCWl0ZW06IGluc3QuY3VycmVudEl0ZW0sCgkJCXNlbmRlcjogX2luc3QgPyBfaW5zdC5lbGVtZW50IDogbnVsbAoJCX07Cgl9Cgp9KTsKCgovKiEKICogalF1ZXJ5IFVJIFNwaW5uZXIgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vc3Bpbm5lci8KICovCgoKZnVuY3Rpb24gc3Bpbm5lcl9tb2RpZmllciggZm4gKSB7CglyZXR1cm4gZnVuY3Rpb24oKSB7CgkJdmFyIHByZXZpb3VzID0gdGhpcy5lbGVtZW50LnZhbCgpOwoJCWZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCQl0aGlzLl9yZWZyZXNoKCk7CgkJaWYgKCBwcmV2aW91cyAhPT0gdGhpcy5lbGVtZW50LnZhbCgpICkgewoJCQl0aGlzLl90cmlnZ2VyKCAiY2hhbmdlIiApOwoJCX0KCX07Cn0KCnZhciBzcGlubmVyID0gJC53aWRnZXQoICJ1aS5zcGlubmVyIiwgewoJdmVyc2lvbjogIjEuMTEuMSIsCglkZWZhdWx0RWxlbWVudDogIjxpbnB1dD4iLAoJd2lkZ2V0RXZlbnRQcmVmaXg6ICJzcGluIiwKCW9wdGlvbnM6IHsKCQljdWx0dXJlOiBudWxsLAoJCWljb25zOiB7CgkJCWRvd246ICJ1aS1pY29uLXRyaWFuZ2xlLTEtcyIsCgkJCXVwOiAidWktaWNvbi10cmlhbmdsZS0xLW4iCgkJfSwKCQlpbmNyZW1lbnRhbDogdHJ1ZSwKCQltYXg6IG51bGwsCgkJbWluOiBudWxsLAoJCW51bWJlckZvcm1hdDogbnVsbCwKCQlwYWdlOiAxMCwKCQlzdGVwOiAxLAoKCQljaGFuZ2U6IG51bGwsCgkJc3BpbjogbnVsbCwKCQlzdGFydDogbnVsbCwKCQlzdG9wOiBudWxsCgl9LAoKCV9jcmVhdGU6IGZ1bmN0aW9uKCkgewoJCS8vIGhhbmRsZSBzdHJpbmcgdmFsdWVzIHRoYXQgbmVlZCB0byBiZSBwYXJzZWQKCQl0aGlzLl9zZXRPcHRpb24oICJtYXgiLCB0aGlzLm9wdGlvbnMubWF4ICk7CgkJdGhpcy5fc2V0T3B0aW9uKCAibWluIiwgdGhpcy5vcHRpb25zLm1pbiApOwoJCXRoaXMuX3NldE9wdGlvbiggInN0ZXAiLCB0aGlzLm9wdGlvbnMuc3RlcCApOwoKCQkvLyBPbmx5IGZvcm1hdCBpZiB0aGVyZSBpcyBhIHZhbHVlLCBwcmV2ZW50cyB0aGUgZmllbGQgZnJvbSBiZWluZyBtYXJrZWQKCQkvLyBhcyBpbnZhbGlkIGluIEZpcmVmb3gsIHNlZSAjOTU3My4KCQlpZiAoIHRoaXMudmFsdWUoKSAhPT0gIiIgKSB7CgkJCS8vIEZvcm1hdCB0aGUgdmFsdWUsIGJ1dCBkb24ndCBjb25zdHJhaW4uCgkJCXRoaXMuX3ZhbHVlKCB0aGlzLmVsZW1lbnQudmFsKCksIHRydWUgKTsKCQl9CgoJCXRoaXMuX2RyYXcoKTsKCQl0aGlzLl9vbiggdGhpcy5fZXZlbnRzICk7CgkJdGhpcy5fcmVmcmVzaCgpOwoKCQkvLyB0dXJuaW5nIG9mZiBhdXRvY29tcGxldGUgcHJldmVudHMgdGhlIGJyb3dzZXIgZnJvbSByZW1lbWJlcmluZyB0aGUKCQkvLyB2YWx1ZSB3aGVuIG5hdmlnYXRpbmcgdGhyb3VnaCBoaXN0b3J5LCBzbyB3ZSByZS1lbmFibGUgYXV0b2NvbXBsZXRlCgkJLy8gaWYgdGhlIHBhZ2UgaXMgdW5sb2FkZWQgYmVmb3JlIHRoZSB3aWRnZXQgaXMgZGVzdHJveWVkLiAjNzc5MAoJCXRoaXMuX29uKCB0aGlzLndpbmRvdywgewoJCQliZWZvcmV1bmxvYWQ6IGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5lbGVtZW50LnJlbW92ZUF0dHIoICJhdXRvY29tcGxldGUiICk7CgkJCX0KCQl9KTsKCX0sCgoJX2dldENyZWF0ZU9wdGlvbnM6IGZ1bmN0aW9uKCkgewoJCXZhciBvcHRpb25zID0ge30sCgkJCWVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7CgoJCSQuZWFjaCggWyAibWluIiwgIm1heCIsICJzdGVwIiBdLCBmdW5jdGlvbiggaSwgb3B0aW9uICkgewoJCQl2YXIgdmFsdWUgPSBlbGVtZW50LmF0dHIoIG9wdGlvbiApOwoJCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUubGVuZ3RoICkgewoJCQkJb3B0aW9uc1sgb3B0aW9uIF0gPSB2YWx1ZTsKCQkJfQoJCX0pOwoKCQlyZXR1cm4gb3B0aW9uczsKCX0sCgoJX2V2ZW50czogewoJCWtleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJaWYgKCB0aGlzLl9zdGFydCggZXZlbnQgKSAmJiB0aGlzLl9rZXlkb3duKCBldmVudCApICkgewoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJfQoJCX0sCgkJa2V5dXA6ICJfc3RvcCIsCgkJZm9jdXM6IGZ1bmN0aW9uKCkgewoJCQl0aGlzLnByZXZpb3VzID0gdGhpcy5lbGVtZW50LnZhbCgpOwoJCX0sCgkJYmx1cjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQlpZiAoIHRoaXMuY2FuY2VsQmx1ciApIHsKCQkJCWRlbGV0ZSB0aGlzLmNhbmNlbEJsdXI7CgkJCQlyZXR1cm47CgkJCX0KCgkJCXRoaXMuX3N0b3AoKTsKCQkJdGhpcy5fcmVmcmVzaCgpOwoJCQlpZiAoIHRoaXMucHJldmlvdXMgIT09IHRoaXMuZWxlbWVudC52YWwoKSApIHsKCQkJCXRoaXMuX3RyaWdnZXIoICJjaGFuZ2UiLCBldmVudCApOwoJCQl9CgkJfSwKCQltb3VzZXdoZWVsOiBmdW5jdGlvbiggZXZlbnQsIGRlbHRhICkgewoJCQlpZiAoICFkZWx0YSApIHsKCQkJCXJldHVybjsKCQkJfQoJCQlpZiAoICF0aGlzLnNwaW5uaW5nICYmICF0aGlzLl9zdGFydCggZXZlbnQgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJdGhpcy5fc3BpbiggKGRlbHRhID4gMCA/IDEgOiAtMSkgKiB0aGlzLm9wdGlvbnMuc3RlcCwgZXZlbnQgKTsKCQkJY2xlYXJUaW1lb3V0KCB0aGlzLm1vdXNld2hlZWxUaW1lciApOwoJCQl0aGlzLm1vdXNld2hlZWxUaW1lciA9IHRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0aGlzLnNwaW5uaW5nICkgewoJCQkJCXRoaXMuX3N0b3AoIGV2ZW50ICk7CgkJCQl9CgkJCX0sIDEwMCApOwoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCX0sCgkJIm1vdXNlZG93biAudWktc3Bpbm5lci1idXR0b24iOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCXZhciBwcmV2aW91czsKCgkJCS8vIFdlIG5ldmVyIHdhbnQgdGhlIGJ1dHRvbnMgdG8gaGF2ZSBmb2N1czsgd2hlbmV2ZXIgdGhlIHVzZXIgaXMKCQkJLy8gaW50ZXJhY3Rpbmcgd2l0aCB0aGUgc3Bpbm5lciwgdGhlIGZvY3VzIHNob3VsZCBiZSBvbiB0aGUgaW5wdXQuCgkJCS8vIElmIHRoZSBpbnB1dCBpcyBmb2N1c2VkIHRoZW4gdGhpcy5wcmV2aW91cyBpcyBwcm9wZXJseSBzZXQgZnJvbQoJCQkvLyB3aGVuIHRoZSBpbnB1dCBmaXJzdCByZWNlaXZlZCBmb2N1cy4gSWYgdGhlIGlucHV0IGlzIG5vdCBmb2N1c2VkCgkJCS8vIHRoZW4gd2UgbmVlZCB0byBzZXQgdGhpcy5wcmV2aW91cyBiYXNlZCBvbiB0aGUgdmFsdWUgYmVmb3JlIHNwaW5uaW5nLgoJCQlwcmV2aW91cyA9IHRoaXMuZWxlbWVudFswXSA9PT0gdGhpcy5kb2N1bWVudFswXS5hY3RpdmVFbGVtZW50ID8KCQkJCXRoaXMucHJldmlvdXMgOiB0aGlzLmVsZW1lbnQudmFsKCk7CgkJCWZ1bmN0aW9uIGNoZWNrRm9jdXMoKSB7CgkJCQl2YXIgaXNBY3RpdmUgPSB0aGlzLmVsZW1lbnRbMF0gPT09IHRoaXMuZG9jdW1lbnRbMF0uYWN0aXZlRWxlbWVudDsKCQkJCWlmICggIWlzQWN0aXZlICkgewoJCQkJCXRoaXMuZWxlbWVudC5mb2N1cygpOwoJCQkJCXRoaXMucHJldmlvdXMgPSBwcmV2aW91czsKCQkJCQkvLyBzdXBwb3J0OiBJRQoJCQkJCS8vIElFIHNldHMgZm9jdXMgYXN5bmNocm9ub3VzbHksIHNvIHdlIG5lZWQgdG8gY2hlY2sgaWYgZm9jdXMKCQkJCQkvLyBtb3ZlZCBvZmYgb2YgdGhlIGlucHV0IGJlY2F1c2UgdGhlIHVzZXIgY2xpY2tlZCBvbiB0aGUgYnV0dG9uLgoJCQkJCXRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJCQl0aGlzLnByZXZpb3VzID0gcHJldmlvdXM7CgkJCQkJfSk7CgkJCQl9CgkJCX0KCgkJCS8vIGVuc3VyZSBmb2N1cyBpcyBvbiAob3Igc3RheXMgb24pIHRoZSB0ZXh0IGZpZWxkCgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCWNoZWNrRm9jdXMuY2FsbCggdGhpcyApOwoKCQkJLy8gc3VwcG9ydDogSUUKCQkJLy8gSUUgZG9lc24ndCBwcmV2ZW50IG1vdmluZyBmb2N1cyBldmVuIHdpdGggZXZlbnQucHJldmVudERlZmF1bHQoKQoJCQkvLyBzbyB3ZSBzZXQgYSBmbGFnIHRvIGtub3cgd2hlbiB3ZSBzaG91bGQgaWdub3JlIHRoZSBibHVyIGV2ZW50CgkJCS8vIGFuZCBjaGVjayAoYWdhaW4pIGlmIGZvY3VzIG1vdmVkIG9mZiBvZiB0aGUgaW5wdXQuCgkJCXRoaXMuY2FuY2VsQmx1ciA9IHRydWU7CgkJCXRoaXMuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJZGVsZXRlIHRoaXMuY2FuY2VsQmx1cjsKCQkJCWNoZWNrRm9jdXMuY2FsbCggdGhpcyApOwoJCQl9KTsKCgkJCWlmICggdGhpcy5fc3RhcnQoIGV2ZW50ICkgPT09IGZhbHNlICkgewoJCQkJcmV0dXJuOwoJCQl9CgoJCQl0aGlzLl9yZXBlYXQoIG51bGwsICQoIGV2ZW50LmN1cnJlbnRUYXJnZXQgKS5oYXNDbGFzcyggInVpLXNwaW5uZXItdXAiICkgPyAxIDogLTEsIGV2ZW50ICk7CgkJfSwKCQkibW91c2V1cCAudWktc3Bpbm5lci1idXR0b24iOiAiX3N0b3AiLAoJCSJtb3VzZWVudGVyIC51aS1zcGlubmVyLWJ1dHRvbiI6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJLy8gYnV0dG9uIHdpbGwgYWRkIHVpLXN0YXRlLWFjdGl2ZSBpZiBtb3VzZSB3YXMgZG93biB3aGlsZSBtb3VzZWxlYXZlIGFuZCBrZXB0IGRvd24KCQkJaWYgKCAhJCggZXZlbnQuY3VycmVudFRhcmdldCApLmhhc0NsYXNzKCAidWktc3RhdGUtYWN0aXZlIiApICkgewoJCQkJcmV0dXJuOwoJCQl9CgoJCQlpZiAoIHRoaXMuX3N0YXJ0KCBldmVudCApID09PSBmYWxzZSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQl0aGlzLl9yZXBlYXQoIG51bGwsICQoIGV2ZW50LmN1cnJlbnRUYXJnZXQgKS5oYXNDbGFzcyggInVpLXNwaW5uZXItdXAiICkgPyAxIDogLTEsIGV2ZW50ICk7CgkJfSwKCQkvLyBUT0RPOiBkbyB3ZSByZWFsbHkgd2FudCB0byBjb25zaWRlciB0aGlzIGEgc3RvcD8KCQkvLyBzaG91bGRuJ3Qgd2UganVzdCBzdG9wIHRoZSByZXBlYXRlciBhbmQgd2FpdCB1bnRpbCBtb3VzZXVwIGJlZm9yZQoJCS8vIHdlIHRyaWdnZXIgdGhlIHN0b3AgZXZlbnQ/CgkJIm1vdXNlbGVhdmUgLnVpLXNwaW5uZXItYnV0dG9uIjogIl9zdG9wIgoJfSwKCglfZHJhdzogZnVuY3Rpb24oKSB7CgkJdmFyIHVpU3Bpbm5lciA9IHRoaXMudWlTcGlubmVyID0gdGhpcy5lbGVtZW50CgkJCS5hZGRDbGFzcyggInVpLXNwaW5uZXItaW5wdXQiICkKCQkJLmF0dHIoICJhdXRvY29tcGxldGUiLCAib2ZmIiApCgkJCS53cmFwKCB0aGlzLl91aVNwaW5uZXJIdG1sKCkgKQoJCQkucGFyZW50KCkKCQkJCS8vIGFkZCBidXR0b25zCgkJCQkuYXBwZW5kKCB0aGlzLl9idXR0b25IdG1sKCkgKTsKCgkJdGhpcy5lbGVtZW50LmF0dHIoICJyb2xlIiwgInNwaW5idXR0b24iICk7CgoJCS8vIGJ1dHRvbiBiaW5kaW5ncwoJCXRoaXMuYnV0dG9ucyA9IHVpU3Bpbm5lci5maW5kKCAiLnVpLXNwaW5uZXItYnV0dG9uIiApCgkJCS5hdHRyKCAidGFiSW5kZXgiLCAtMSApCgkJCS5idXR0b24oKQoJCQkucmVtb3ZlQ2xhc3MoICJ1aS1jb3JuZXItYWxsIiApOwoKCQkvLyBJRSA2IGRvZXNuJ3QgdW5kZXJzdGFuZCBoZWlnaHQ6IDUwJSBmb3IgdGhlIGJ1dHRvbnMKCQkvLyB1bmxlc3MgdGhlIHdyYXBwZXIgaGFzIGFuIGV4cGxpY2l0IGhlaWdodAoJCWlmICggdGhpcy5idXR0b25zLmhlaWdodCgpID4gTWF0aC5jZWlsKCB1aVNwaW5uZXIuaGVpZ2h0KCkgKiAwLjUgKSAmJgoJCQkJdWlTcGlubmVyLmhlaWdodCgpID4gMCApIHsKCQkJdWlTcGlubmVyLmhlaWdodCggdWlTcGlubmVyLmhlaWdodCgpICk7CgkJfQoKCQkvLyBkaXNhYmxlIHNwaW5uZXIgaWYgZWxlbWVudCB3YXMgYWxyZWFkeSBkaXNhYmxlZAoJCWlmICggdGhpcy5vcHRpb25zLmRpc2FibGVkICkgewoJCQl0aGlzLmRpc2FibGUoKTsKCQl9Cgl9LAoKCV9rZXlkb3duOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCgkJCWtleUNvZGUgPSAkLnVpLmtleUNvZGU7CgoJCXN3aXRjaCAoIGV2ZW50LmtleUNvZGUgKSB7CgkJY2FzZSBrZXlDb2RlLlVQOgoJCQl0aGlzLl9yZXBlYXQoIG51bGwsIDEsIGV2ZW50ICk7CgkJCXJldHVybiB0cnVlOwoJCWNhc2Uga2V5Q29kZS5ET1dOOgoJCQl0aGlzLl9yZXBlYXQoIG51bGwsIC0xLCBldmVudCApOwoJCQlyZXR1cm4gdHJ1ZTsKCQljYXNlIGtleUNvZGUuUEFHRV9VUDoKCQkJdGhpcy5fcmVwZWF0KCBudWxsLCBvcHRpb25zLnBhZ2UsIGV2ZW50ICk7CgkJCXJldHVybiB0cnVlOwoJCWNhc2Uga2V5Q29kZS5QQUdFX0RPV046CgkJCXRoaXMuX3JlcGVhdCggbnVsbCwgLW9wdGlvbnMucGFnZSwgZXZlbnQgKTsKCQkJcmV0dXJuIHRydWU7CgkJfQoKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCV91aVNwaW5uZXJIdG1sOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gIjxzcGFuIGNsYXNzPSd1aS1zcGlubmVyIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsJz48L3NwYW4+IjsKCX0sCgoJX2J1dHRvbkh0bWw6IGZ1bmN0aW9uKCkgewoJCXJldHVybiAiIiArCgkJCSI8YSBjbGFzcz0ndWktc3Bpbm5lci1idXR0b24gdWktc3Bpbm5lci11cCB1aS1jb3JuZXItdHInPiIgKwoJCQkJIjxzcGFuIGNsYXNzPSd1aS1pY29uICIgKyB0aGlzLm9wdGlvbnMuaWNvbnMudXAgKyAiJz4mIzk2NTA7PC9zcGFuPiIgKwoJCQkiPC9hPiIgKwoJCQkiPGEgY2xhc3M9J3VpLXNwaW5uZXItYnV0dG9uIHVpLXNwaW5uZXItZG93biB1aS1jb3JuZXItYnInPiIgKwoJCQkJIjxzcGFuIGNsYXNzPSd1aS1pY29uICIgKyB0aGlzLm9wdGlvbnMuaWNvbnMuZG93biArICInPiYjOTY2MDs8L3NwYW4+IiArCgkJCSI8L2E+IjsKCX0sCgoJX3N0YXJ0OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCAhdGhpcy5zcGlubmluZyAmJiB0aGlzLl90cmlnZ2VyKCAic3RhcnQiLCBldmVudCApID09PSBmYWxzZSApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJaWYgKCAhdGhpcy5jb3VudGVyICkgewoJCQl0aGlzLmNvdW50ZXIgPSAxOwoJCX0KCQl0aGlzLnNwaW5uaW5nID0gdHJ1ZTsKCQlyZXR1cm4gdHJ1ZTsKCX0sCgoJX3JlcGVhdDogZnVuY3Rpb24oIGksIHN0ZXBzLCBldmVudCApIHsKCQlpID0gaSB8fCA1MDA7CgoJCWNsZWFyVGltZW91dCggdGhpcy50aW1lciApOwoJCXRoaXMudGltZXIgPSB0aGlzLl9kZWxheShmdW5jdGlvbigpIHsKCQkJdGhpcy5fcmVwZWF0KCA0MCwgc3RlcHMsIGV2ZW50ICk7CgkJfSwgaSApOwoKCQl0aGlzLl9zcGluKCBzdGVwcyAqIHRoaXMub3B0aW9ucy5zdGVwLCBldmVudCApOwoJfSwKCglfc3BpbjogZnVuY3Rpb24oIHN0ZXAsIGV2ZW50ICkgewoJCXZhciB2YWx1ZSA9IHRoaXMudmFsdWUoKSB8fCAwOwoKCQlpZiAoICF0aGlzLmNvdW50ZXIgKSB7CgkJCXRoaXMuY291bnRlciA9IDE7CgkJfQoKCQl2YWx1ZSA9IHRoaXMuX2FkanVzdFZhbHVlKCB2YWx1ZSArIHN0ZXAgKiB0aGlzLl9pbmNyZW1lbnQoIHRoaXMuY291bnRlciApICk7CgoJCWlmICggIXRoaXMuc3Bpbm5pbmcgfHwgdGhpcy5fdHJpZ2dlciggInNwaW4iLCBldmVudCwgeyB2YWx1ZTogdmFsdWUgfSApICE9PSBmYWxzZSkgewoJCQl0aGlzLl92YWx1ZSggdmFsdWUgKTsKCQkJdGhpcy5jb3VudGVyKys7CgkJfQoJfSwKCglfaW5jcmVtZW50OiBmdW5jdGlvbiggaSApIHsKCQl2YXIgaW5jcmVtZW50YWwgPSB0aGlzLm9wdGlvbnMuaW5jcmVtZW50YWw7CgoJCWlmICggaW5jcmVtZW50YWwgKSB7CgkJCXJldHVybiAkLmlzRnVuY3Rpb24oIGluY3JlbWVudGFsICkgPwoJCQkJaW5jcmVtZW50YWwoIGkgKSA6CgkJCQlNYXRoLmZsb29yKCBpICogaSAqIGkgLyA1MDAwMCAtIGkgKiBpIC8gNTAwICsgMTcgKiBpIC8gMjAwICsgMSApOwoJCX0KCgkJcmV0dXJuIDE7Cgl9LAoKCV9wcmVjaXNpb246IGZ1bmN0aW9uKCkgewoJCXZhciBwcmVjaXNpb24gPSB0aGlzLl9wcmVjaXNpb25PZiggdGhpcy5vcHRpb25zLnN0ZXAgKTsKCQlpZiAoIHRoaXMub3B0aW9ucy5taW4gIT09IG51bGwgKSB7CgkJCXByZWNpc2lvbiA9IE1hdGgubWF4KCBwcmVjaXNpb24sIHRoaXMuX3ByZWNpc2lvbk9mKCB0aGlzLm9wdGlvbnMubWluICkgKTsKCQl9CgkJcmV0dXJuIHByZWNpc2lvbjsKCX0sCgoJX3ByZWNpc2lvbk9mOiBmdW5jdGlvbiggbnVtICkgewoJCXZhciBzdHIgPSBudW0udG9TdHJpbmcoKSwKCQkJZGVjaW1hbCA9IHN0ci5pbmRleE9mKCAiLiIgKTsKCQlyZXR1cm4gZGVjaW1hbCA9PT0gLTEgPyAwIDogc3RyLmxlbmd0aCAtIGRlY2ltYWwgLSAxOwoJfSwKCglfYWRqdXN0VmFsdWU6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgYmFzZSwgYWJvdmVNaW4sCgkJCW9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgoJCS8vIG1ha2Ugc3VyZSB3ZSdyZSBhdCBhIHZhbGlkIHN0ZXAKCQkvLyAtIGZpbmQgb3V0IHdoZXJlIHdlIGFyZSByZWxhdGl2ZSB0byB0aGUgYmFzZSAobWluIG9yIDApCgkJYmFzZSA9IG9wdGlvbnMubWluICE9PSBudWxsID8gb3B0aW9ucy5taW4gOiAwOwoJCWFib3ZlTWluID0gdmFsdWUgLSBiYXNlOwoJCS8vIC0gcm91bmQgdG8gdGhlIG5lYXJlc3Qgc3RlcAoJCWFib3ZlTWluID0gTWF0aC5yb3VuZChhYm92ZU1pbiAvIG9wdGlvbnMuc3RlcCkgKiBvcHRpb25zLnN0ZXA7CgkJLy8gLSByb3VuZGluZyBpcyBiYXNlZCBvbiAwLCBzbyBhZGp1c3QgYmFjayB0byBvdXIgYmFzZQoJCXZhbHVlID0gYmFzZSArIGFib3ZlTWluOwoKCQkvLyBmaXggcHJlY2lzaW9uIGZyb20gYmFkIEpTIGZsb2F0aW5nIHBvaW50IG1hdGgKCQl2YWx1ZSA9IHBhcnNlRmxvYXQoIHZhbHVlLnRvRml4ZWQoIHRoaXMuX3ByZWNpc2lvbigpICkgKTsKCgkJLy8gY2xhbXAgdGhlIHZhbHVlCgkJaWYgKCBvcHRpb25zLm1heCAhPT0gbnVsbCAmJiB2YWx1ZSA+IG9wdGlvbnMubWF4KSB7CgkJCXJldHVybiBvcHRpb25zLm1heDsKCQl9CgkJaWYgKCBvcHRpb25zLm1pbiAhPT0gbnVsbCAmJiB2YWx1ZSA8IG9wdGlvbnMubWluICkgewoJCQlyZXR1cm4gb3B0aW9ucy5taW47CgkJfQoKCQlyZXR1cm4gdmFsdWU7Cgl9LAoKCV9zdG9wOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCAhdGhpcy5zcGlubmluZyApIHsKCQkJcmV0dXJuOwoJCX0KCgkJY2xlYXJUaW1lb3V0KCB0aGlzLnRpbWVyICk7CgkJY2xlYXJUaW1lb3V0KCB0aGlzLm1vdXNld2hlZWxUaW1lciApOwoJCXRoaXMuY291bnRlciA9IDA7CgkJdGhpcy5zcGlubmluZyA9IGZhbHNlOwoJCXRoaXMuX3RyaWdnZXIoICJzdG9wIiwgZXZlbnQgKTsKCX0sCgoJX3NldE9wdGlvbjogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJaWYgKCBrZXkgPT09ICJjdWx0dXJlIiB8fCBrZXkgPT09ICJudW1iZXJGb3JtYXQiICkgewoJCQl2YXIgcHJldlZhbHVlID0gdGhpcy5fcGFyc2UoIHRoaXMuZWxlbWVudC52YWwoKSApOwoJCQl0aGlzLm9wdGlvbnNbIGtleSBdID0gdmFsdWU7CgkJCXRoaXMuZWxlbWVudC52YWwoIHRoaXMuX2Zvcm1hdCggcHJldlZhbHVlICkgKTsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCBrZXkgPT09ICJtYXgiIHx8IGtleSA9PT0gIm1pbiIgfHwga2V5ID09PSAic3RlcCIgKSB7CgkJCWlmICggdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiApIHsKCQkJCXZhbHVlID0gdGhpcy5fcGFyc2UoIHZhbHVlICk7CgkJCX0KCQl9CgkJaWYgKCBrZXkgPT09ICJpY29ucyIgKSB7CgkJCXRoaXMuYnV0dG9ucy5maXJzdCgpLmZpbmQoICIudWktaWNvbiIgKQoJCQkJLnJlbW92ZUNsYXNzKCB0aGlzLm9wdGlvbnMuaWNvbnMudXAgKQoJCQkJLmFkZENsYXNzKCB2YWx1ZS51cCApOwoJCQl0aGlzLmJ1dHRvbnMubGFzdCgpLmZpbmQoICIudWktaWNvbiIgKQoJCQkJLnJlbW92ZUNsYXNzKCB0aGlzLm9wdGlvbnMuaWNvbnMuZG93biApCgkJCQkuYWRkQ2xhc3MoIHZhbHVlLmRvd24gKTsKCQl9CgoJCXRoaXMuX3N1cGVyKCBrZXksIHZhbHVlICk7CgoJCWlmICgga2V5ID09PSAiZGlzYWJsZWQiICkgewoJCQl0aGlzLndpZGdldCgpLnRvZ2dsZUNsYXNzKCAidWktc3RhdGUtZGlzYWJsZWQiLCAhIXZhbHVlICk7CgkJCXRoaXMuZWxlbWVudC5wcm9wKCAiZGlzYWJsZWQiLCAhIXZhbHVlICk7CgkJCXRoaXMuYnV0dG9ucy5idXR0b24oIHZhbHVlID8gImRpc2FibGUiIDogImVuYWJsZSIgKTsKCQl9Cgl9LAoKCV9zZXRPcHRpb25zOiBzcGlubmVyX21vZGlmaWVyKGZ1bmN0aW9uKCBvcHRpb25zICkgewoJCXRoaXMuX3N1cGVyKCBvcHRpb25zICk7Cgl9KSwKCglfcGFyc2U6IGZ1bmN0aW9uKCB2YWwgKSB7CgkJaWYgKCB0eXBlb2YgdmFsID09PSAic3RyaW5nIiAmJiB2YWwgIT09ICIiICkgewoJCQl2YWwgPSB3aW5kb3cuR2xvYmFsaXplICYmIHRoaXMub3B0aW9ucy5udW1iZXJGb3JtYXQgPwoJCQkJR2xvYmFsaXplLnBhcnNlRmxvYXQoIHZhbCwgMTAsIHRoaXMub3B0aW9ucy5jdWx0dXJlICkgOiArdmFsOwoJCX0KCQlyZXR1cm4gdmFsID09PSAiIiB8fCBpc05hTiggdmFsICkgPyBudWxsIDogdmFsOwoJfSwKCglfZm9ybWF0OiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJaWYgKCB2YWx1ZSA9PT0gIiIgKSB7CgkJCXJldHVybiAiIjsKCQl9CgkJcmV0dXJuIHdpbmRvdy5HbG9iYWxpemUgJiYgdGhpcy5vcHRpb25zLm51bWJlckZvcm1hdCA/CgkJCUdsb2JhbGl6ZS5mb3JtYXQoIHZhbHVlLCB0aGlzLm9wdGlvbnMubnVtYmVyRm9ybWF0LCB0aGlzLm9wdGlvbnMuY3VsdHVyZSApIDoKCQkJdmFsdWU7Cgl9LAoKCV9yZWZyZXNoOiBmdW5jdGlvbigpIHsKCQl0aGlzLmVsZW1lbnQuYXR0cih7CgkJCSJhcmlhLXZhbHVlbWluIjogdGhpcy5vcHRpb25zLm1pbiwKCQkJImFyaWEtdmFsdWVtYXgiOiB0aGlzLm9wdGlvbnMubWF4LAoJCQkvLyBUT0RPOiB3aGF0IHNob3VsZCB3ZSBkbyB3aXRoIHZhbHVlcyB0aGF0IGNhbid0IGJlIHBhcnNlZD8KCQkJImFyaWEtdmFsdWVub3ciOiB0aGlzLl9wYXJzZSggdGhpcy5lbGVtZW50LnZhbCgpICkKCQl9KTsKCX0sCgoJaXNWYWxpZDogZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlID0gdGhpcy52YWx1ZSgpOwoKCQkvLyBudWxsIGlzIGludmFsaWQKCQlpZiAoIHZhbHVlID09PSBudWxsICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvLyBpZiB2YWx1ZSBnZXRzIGFkanVzdGVkLCBpdCdzIGludmFsaWQKCQlyZXR1cm4gdmFsdWUgPT09IHRoaXMuX2FkanVzdFZhbHVlKCB2YWx1ZSApOwoJfSwKCgkvLyB1cGRhdGUgdGhlIHZhbHVlIHdpdGhvdXQgdHJpZ2dlcmluZyBjaGFuZ2UKCV92YWx1ZTogZnVuY3Rpb24oIHZhbHVlLCBhbGxvd0FueSApIHsKCQl2YXIgcGFyc2VkOwoJCWlmICggdmFsdWUgIT09ICIiICkgewoJCQlwYXJzZWQgPSB0aGlzLl9wYXJzZSggdmFsdWUgKTsKCQkJaWYgKCBwYXJzZWQgIT09IG51bGwgKSB7CgkJCQlpZiAoICFhbGxvd0FueSApIHsKCQkJCQlwYXJzZWQgPSB0aGlzLl9hZGp1c3RWYWx1ZSggcGFyc2VkICk7CgkJCQl9CgkJCQl2YWx1ZSA9IHRoaXMuX2Zvcm1hdCggcGFyc2VkICk7CgkJCX0KCQl9CgkJdGhpcy5lbGVtZW50LnZhbCggdmFsdWUgKTsKCQl0aGlzLl9yZWZyZXNoKCk7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQl0aGlzLmVsZW1lbnQKCQkJLnJlbW92ZUNsYXNzKCAidWktc3Bpbm5lci1pbnB1dCIgKQoJCQkucHJvcCggImRpc2FibGVkIiwgZmFsc2UgKQoJCQkucmVtb3ZlQXR0ciggImF1dG9jb21wbGV0ZSIgKQoJCQkucmVtb3ZlQXR0ciggInJvbGUiICkKCQkJLnJlbW92ZUF0dHIoICJhcmlhLXZhbHVlbWluIiApCgkJCS5yZW1vdmVBdHRyKCAiYXJpYS12YWx1ZW1heCIgKQoJCQkucmVtb3ZlQXR0ciggImFyaWEtdmFsdWVub3ciICk7CgkJdGhpcy51aVNwaW5uZXIucmVwbGFjZVdpdGgoIHRoaXMuZWxlbWVudCApOwoJfSwKCglzdGVwVXA6IHNwaW5uZXJfbW9kaWZpZXIoZnVuY3Rpb24oIHN0ZXBzICkgewoJCXRoaXMuX3N0ZXBVcCggc3RlcHMgKTsKCX0pLAoJX3N0ZXBVcDogZnVuY3Rpb24oIHN0ZXBzICkgewoJCWlmICggdGhpcy5fc3RhcnQoKSApIHsKCQkJdGhpcy5fc3BpbiggKHN0ZXBzIHx8IDEpICogdGhpcy5vcHRpb25zLnN0ZXAgKTsKCQkJdGhpcy5fc3RvcCgpOwoJCX0KCX0sCgoJc3RlcERvd246IHNwaW5uZXJfbW9kaWZpZXIoZnVuY3Rpb24oIHN0ZXBzICkgewoJCXRoaXMuX3N0ZXBEb3duKCBzdGVwcyApOwoJfSksCglfc3RlcERvd246IGZ1bmN0aW9uKCBzdGVwcyApIHsKCQlpZiAoIHRoaXMuX3N0YXJ0KCkgKSB7CgkJCXRoaXMuX3NwaW4oIChzdGVwcyB8fCAxKSAqIC10aGlzLm9wdGlvbnMuc3RlcCApOwoJCQl0aGlzLl9zdG9wKCk7CgkJfQoJfSwKCglwYWdlVXA6IHNwaW5uZXJfbW9kaWZpZXIoZnVuY3Rpb24oIHBhZ2VzICkgewoJCXRoaXMuX3N0ZXBVcCggKHBhZ2VzIHx8IDEpICogdGhpcy5vcHRpb25zLnBhZ2UgKTsKCX0pLAoKCXBhZ2VEb3duOiBzcGlubmVyX21vZGlmaWVyKGZ1bmN0aW9uKCBwYWdlcyApIHsKCQl0aGlzLl9zdGVwRG93biggKHBhZ2VzIHx8IDEpICogdGhpcy5vcHRpb25zLnBhZ2UgKTsKCX0pLAoKCXZhbHVlOiBmdW5jdGlvbiggbmV3VmFsICkgewoJCWlmICggIWFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCXJldHVybiB0aGlzLl9wYXJzZSggdGhpcy5lbGVtZW50LnZhbCgpICk7CgkJfQoJCXNwaW5uZXJfbW9kaWZpZXIoIHRoaXMuX3ZhbHVlICkuY2FsbCggdGhpcywgbmV3VmFsICk7Cgl9LAoKCXdpZGdldDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMudWlTcGlubmVyOwoJfQp9KTsKCgovKiEKICogalF1ZXJ5IFVJIFRhYnMgMS4xMS4xCiAqIGh0dHA6Ly9qcXVlcnl1aS5jb20KICoKICogQ29weXJpZ2h0IDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCiAqIGh0dHA6Ly9qcXVlcnkub3JnL2xpY2Vuc2UKICoKICogaHR0cDovL2FwaS5qcXVlcnl1aS5jb20vdGFicy8KICovCgoKdmFyIHRhYnMgPSAkLndpZGdldCggInVpLnRhYnMiLCB7Cgl2ZXJzaW9uOiAiMS4xMS4xIiwKCWRlbGF5OiAzMDAsCglvcHRpb25zOiB7CgkJYWN0aXZlOiBudWxsLAoJCWNvbGxhcHNpYmxlOiBmYWxzZSwKCQlldmVudDogImNsaWNrIiwKCQloZWlnaHRTdHlsZTogImNvbnRlbnQiLAoJCWhpZGU6IG51bGwsCgkJc2hvdzogbnVsbCwKCgkJLy8gY2FsbGJhY2tzCgkJYWN0aXZhdGU6IG51bGwsCgkJYmVmb3JlQWN0aXZhdGU6IG51bGwsCgkJYmVmb3JlTG9hZDogbnVsbCwKCQlsb2FkOiBudWxsCgl9LAoKCV9pc0xvY2FsOiAoZnVuY3Rpb24oKSB7CgkJdmFyIHJoYXNoID0gLyMuKiQvOwoKCQlyZXR1cm4gZnVuY3Rpb24oIGFuY2hvciApIHsKCQkJdmFyIGFuY2hvclVybCwgbG9jYXRpb25Vcmw7CgoJCQkvLyBzdXBwb3J0OiBJRTcKCQkJLy8gSUU3IGRvZXNuJ3Qgbm9ybWFsaXplIHRoZSBocmVmIHByb3BlcnR5IHdoZW4gc2V0IHZpYSBzY3JpcHQgKCM5MzE3KQoJCQlhbmNob3IgPSBhbmNob3IuY2xvbmVOb2RlKCBmYWxzZSApOwoKCQkJYW5jaG9yVXJsID0gYW5jaG9yLmhyZWYucmVwbGFjZSggcmhhc2gsICIiICk7CgkJCWxvY2F0aW9uVXJsID0gbG9jYXRpb24uaHJlZi5yZXBsYWNlKCByaGFzaCwgIiIgKTsKCgkJCS8vIGRlY29kaW5nIG1heSB0aHJvdyBhbiBlcnJvciBpZiB0aGUgVVJMIGlzbid0IFVURi04ICgjOTUxOCkKCQkJdHJ5IHsKCQkJCWFuY2hvclVybCA9IGRlY29kZVVSSUNvbXBvbmVudCggYW5jaG9yVXJsICk7CgkJCX0gY2F0Y2ggKCBlcnJvciApIHt9CgkJCXRyeSB7CgkJCQlsb2NhdGlvblVybCA9IGRlY29kZVVSSUNvbXBvbmVudCggbG9jYXRpb25VcmwgKTsKCQkJfSBjYXRjaCAoIGVycm9yICkge30KCgkJCXJldHVybiBhbmNob3IuaGFzaC5sZW5ndGggPiAxICYmIGFuY2hvclVybCA9PT0gbG9jYXRpb25Vcmw7CgkJfTsKCX0pKCksCgoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQlvcHRpb25zID0gdGhpcy5vcHRpb25zOwoKCQl0aGlzLnJ1bm5pbmcgPSBmYWxzZTsKCgkJdGhpcy5lbGVtZW50CgkJCS5hZGRDbGFzcyggInVpLXRhYnMgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiICkKCQkJLnRvZ2dsZUNsYXNzKCAidWktdGFicy1jb2xsYXBzaWJsZSIsIG9wdGlvbnMuY29sbGFwc2libGUgKTsKCgkJdGhpcy5fcHJvY2Vzc1RhYnMoKTsKCQlvcHRpb25zLmFjdGl2ZSA9IHRoaXMuX2luaXRpYWxBY3RpdmUoKTsKCgkJLy8gVGFrZSBkaXNhYmxpbmcgdGFicyB2aWEgY2xhc3MgYXR0cmlidXRlIGZyb20gSFRNTAoJCS8vIGludG8gYWNjb3VudCBhbmQgdXBkYXRlIG9wdGlvbiBwcm9wZXJseS4KCQlpZiAoICQuaXNBcnJheSggb3B0aW9ucy5kaXNhYmxlZCApICkgewoJCQlvcHRpb25zLmRpc2FibGVkID0gJC51bmlxdWUoIG9wdGlvbnMuZGlzYWJsZWQuY29uY2F0KAoJCQkJJC5tYXAoIHRoaXMudGFicy5maWx0ZXIoICIudWktc3RhdGUtZGlzYWJsZWQiICksIGZ1bmN0aW9uKCBsaSApIHsKCQkJCQlyZXR1cm4gdGhhdC50YWJzLmluZGV4KCBsaSApOwoJCQkJfSkKCQkJKSApLnNvcnQoKTsKCQl9CgoJCS8vIGNoZWNrIGZvciBsZW5ndGggYXZvaWRzIGVycm9yIHdoZW4gaW5pdGlhbGl6aW5nIGVtcHR5IGxpc3QKCQlpZiAoIHRoaXMub3B0aW9ucy5hY3RpdmUgIT09IGZhbHNlICYmIHRoaXMuYW5jaG9ycy5sZW5ndGggKSB7CgkJCXRoaXMuYWN0aXZlID0gdGhpcy5fZmluZEFjdGl2ZSggb3B0aW9ucy5hY3RpdmUgKTsKCQl9IGVsc2UgewoJCQl0aGlzLmFjdGl2ZSA9ICQoKTsKCQl9CgoJCXRoaXMuX3JlZnJlc2goKTsKCgkJaWYgKCB0aGlzLmFjdGl2ZS5sZW5ndGggKSB7CgkJCXRoaXMubG9hZCggb3B0aW9ucy5hY3RpdmUgKTsKCQl9Cgl9LAoKCV9pbml0aWFsQWN0aXZlOiBmdW5jdGlvbigpIHsKCQl2YXIgYWN0aXZlID0gdGhpcy5vcHRpb25zLmFjdGl2ZSwKCQkJY29sbGFwc2libGUgPSB0aGlzLm9wdGlvbnMuY29sbGFwc2libGUsCgkJCWxvY2F0aW9uSGFzaCA9IGxvY2F0aW9uLmhhc2guc3Vic3RyaW5nKCAxICk7CgoJCWlmICggYWN0aXZlID09PSBudWxsICkgewoJCQkvLyBjaGVjayB0aGUgZnJhZ21lbnQgaWRlbnRpZmllciBpbiB0aGUgVVJMCgkJCWlmICggbG9jYXRpb25IYXNoICkgewoJCQkJdGhpcy50YWJzLmVhY2goZnVuY3Rpb24oIGksIHRhYiApIHsKCQkJCQlpZiAoICQoIHRhYiApLmF0dHIoICJhcmlhLWNvbnRyb2xzIiApID09PSBsb2NhdGlvbkhhc2ggKSB7CgkJCQkJCWFjdGl2ZSA9IGk7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQl9KTsKCQkJfQoKCQkJLy8gY2hlY2sgZm9yIGEgdGFiIG1hcmtlZCBhY3RpdmUgdmlhIGEgY2xhc3MKCQkJaWYgKCBhY3RpdmUgPT09IG51bGwgKSB7CgkJCQlhY3RpdmUgPSB0aGlzLnRhYnMuaW5kZXgoIHRoaXMudGFicy5maWx0ZXIoICIudWktdGFicy1hY3RpdmUiICkgKTsKCQkJfQoKCQkJLy8gbm8gYWN0aXZlIHRhYiwgc2V0IHRvIGZhbHNlCgkJCWlmICggYWN0aXZlID09PSBudWxsIHx8IGFjdGl2ZSA9PT0gLTEgKSB7CgkJCQlhY3RpdmUgPSB0aGlzLnRhYnMubGVuZ3RoID8gMCA6IGZhbHNlOwoJCQl9CgkJfQoKCQkvLyBoYW5kbGUgbnVtYmVyczogbmVnYXRpdmUsIG91dCBvZiByYW5nZQoJCWlmICggYWN0aXZlICE9PSBmYWxzZSApIHsKCQkJYWN0aXZlID0gdGhpcy50YWJzLmluZGV4KCB0aGlzLnRhYnMuZXEoIGFjdGl2ZSApICk7CgkJCWlmICggYWN0aXZlID09PSAtMSApIHsKCQkJCWFjdGl2ZSA9IGNvbGxhcHNpYmxlID8gZmFsc2UgOiAwOwoJCQl9CgkJfQoKCQkvLyBkb24ndCBhbGxvdyBjb2xsYXBzaWJsZTogZmFsc2UgYW5kIGFjdGl2ZTogZmFsc2UKCQlpZiAoICFjb2xsYXBzaWJsZSAmJiBhY3RpdmUgPT09IGZhbHNlICYmIHRoaXMuYW5jaG9ycy5sZW5ndGggKSB7CgkJCWFjdGl2ZSA9IDA7CgkJfQoKCQlyZXR1cm4gYWN0aXZlOwoJfSwKCglfZ2V0Q3JlYXRlRXZlbnREYXRhOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gewoJCQl0YWI6IHRoaXMuYWN0aXZlLAoJCQlwYW5lbDogIXRoaXMuYWN0aXZlLmxlbmd0aCA/ICQoKSA6IHRoaXMuX2dldFBhbmVsRm9yVGFiKCB0aGlzLmFjdGl2ZSApCgkJfTsKCX0sCgoJX3RhYktleWRvd246IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgZm9jdXNlZFRhYiA9ICQoIHRoaXMuZG9jdW1lbnRbMF0uYWN0aXZlRWxlbWVudCApLmNsb3Nlc3QoICJsaSIgKSwKCQkJc2VsZWN0ZWRJbmRleCA9IHRoaXMudGFicy5pbmRleCggZm9jdXNlZFRhYiApLAoJCQlnb2luZ0ZvcndhcmQgPSB0cnVlOwoKCQlpZiAoIHRoaXMuX2hhbmRsZVBhZ2VOYXYoIGV2ZW50ICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCXN3aXRjaCAoIGV2ZW50LmtleUNvZGUgKSB7CgkJCWNhc2UgJC51aS5rZXlDb2RlLlJJR0hUOgoJCQljYXNlICQudWkua2V5Q29kZS5ET1dOOgoJCQkJc2VsZWN0ZWRJbmRleCsrOwoJCQkJYnJlYWs7CgkJCWNhc2UgJC51aS5rZXlDb2RlLlVQOgoJCQljYXNlICQudWkua2V5Q29kZS5MRUZUOgoJCQkJZ29pbmdGb3J3YXJkID0gZmFsc2U7CgkJCQlzZWxlY3RlZEluZGV4LS07CgkJCQlicmVhazsKCQkJY2FzZSAkLnVpLmtleUNvZGUuRU5EOgoJCQkJc2VsZWN0ZWRJbmRleCA9IHRoaXMuYW5jaG9ycy5sZW5ndGggLSAxOwoJCQkJYnJlYWs7CgkJCWNhc2UgJC51aS5rZXlDb2RlLkhPTUU6CgkJCQlzZWxlY3RlZEluZGV4ID0gMDsKCQkJCWJyZWFrOwoJCQljYXNlICQudWkua2V5Q29kZS5TUEFDRToKCQkJCS8vIEFjdGl2YXRlIG9ubHksIG5vIGNvbGxhcHNpbmcKCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQljbGVhclRpbWVvdXQoIHRoaXMuYWN0aXZhdGluZyApOwoJCQkJdGhpcy5fYWN0aXZhdGUoIHNlbGVjdGVkSW5kZXggKTsKCQkJCXJldHVybjsKCQkJY2FzZSAkLnVpLmtleUNvZGUuRU5URVI6CgkJCQkvLyBUb2dnbGUgKGNhbmNlbCBkZWxheWVkIGFjdGl2YXRpb24sIGFsbG93IGNvbGxhcHNpbmcpCgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJY2xlYXJUaW1lb3V0KCB0aGlzLmFjdGl2YXRpbmcgKTsKCQkJCS8vIERldGVybWluZSBpZiB3ZSBzaG91bGQgY29sbGFwc2Ugb3IgYWN0aXZhdGUKCQkJCXRoaXMuX2FjdGl2YXRlKCBzZWxlY3RlZEluZGV4ID09PSB0aGlzLm9wdGlvbnMuYWN0aXZlID8gZmFsc2UgOiBzZWxlY3RlZEluZGV4ICk7CgkJCQlyZXR1cm47CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm47CgkJfQoKCQkvLyBGb2N1cyB0aGUgYXBwcm9wcmlhdGUgdGFiLCBiYXNlZCBvbiB3aGljaCBrZXkgd2FzIHByZXNzZWQKCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCWNsZWFyVGltZW91dCggdGhpcy5hY3RpdmF0aW5nICk7CgkJc2VsZWN0ZWRJbmRleCA9IHRoaXMuX2ZvY3VzTmV4dFRhYiggc2VsZWN0ZWRJbmRleCwgZ29pbmdGb3J3YXJkICk7CgoJCS8vIE5hdmlnYXRpbmcgd2l0aCBjb250cm9sIGtleSB3aWxsIHByZXZlbnQgYXV0b21hdGljIGFjdGl2YXRpb24KCQlpZiAoICFldmVudC5jdHJsS2V5ICkgewoJCQkvLyBVcGRhdGUgYXJpYS1zZWxlY3RlZCBpbW1lZGlhdGVseSBzbyB0aGF0IEFUIHRoaW5rIHRoZSB0YWIgaXMgYWxyZWFkeSBzZWxlY3RlZC4KCQkJLy8gT3RoZXJ3aXNlIEFUIG1heSBjb25mdXNlIHRoZSB1c2VyIGJ5IHN0YXRpbmcgdGhhdCB0aGV5IG5lZWQgdG8gYWN0aXZhdGUgdGhlIHRhYiwKCQkJLy8gYnV0IHRoZSB0YWIgd2lsbCBhbHJlYWR5IGJlIGFjdGl2YXRlZCBieSB0aGUgdGltZSB0aGUgYW5ub3VuY2VtZW50IGZpbmlzaGVzLgoJCQlmb2N1c2VkVGFiLmF0dHIoICJhcmlhLXNlbGVjdGVkIiwgImZhbHNlIiApOwoJCQl0aGlzLnRhYnMuZXEoIHNlbGVjdGVkSW5kZXggKS5hdHRyKCAiYXJpYS1zZWxlY3RlZCIsICJ0cnVlIiApOwoKCQkJdGhpcy5hY3RpdmF0aW5nID0gdGhpcy5fZGVsYXkoZnVuY3Rpb24oKSB7CgkJCQl0aGlzLm9wdGlvbiggImFjdGl2ZSIsIHNlbGVjdGVkSW5kZXggKTsKCQkJfSwgdGhpcy5kZWxheSApOwoJCX0KCX0sCgoJX3BhbmVsS2V5ZG93bjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCWlmICggdGhpcy5faGFuZGxlUGFnZU5hdiggZXZlbnQgKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gQ3RybCt1cCBtb3ZlcyBmb2N1cyB0byB0aGUgY3VycmVudCB0YWIKCQlpZiAoIGV2ZW50LmN0cmxLZXkgJiYgZXZlbnQua2V5Q29kZSA9PT0gJC51aS5rZXlDb2RlLlVQICkgewoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQl0aGlzLmFjdGl2ZS5mb2N1cygpOwoJCX0KCX0sCgoJLy8gQWx0K3BhZ2UgdXAvZG93biBtb3ZlcyBmb2N1cyB0byB0aGUgcHJldmlvdXMvbmV4dCB0YWIgKGFuZCBhY3RpdmF0ZXMpCglfaGFuZGxlUGFnZU5hdjogZnVuY3Rpb24oIGV2ZW50ICkgewoJCWlmICggZXZlbnQuYWx0S2V5ICYmIGV2ZW50LmtleUNvZGUgPT09ICQudWkua2V5Q29kZS5QQUdFX1VQICkgewoJCQl0aGlzLl9hY3RpdmF0ZSggdGhpcy5fZm9jdXNOZXh0VGFiKCB0aGlzLm9wdGlvbnMuYWN0aXZlIC0gMSwgZmFsc2UgKSApOwoJCQlyZXR1cm4gdHJ1ZTsKCQl9CgkJaWYgKCBldmVudC5hbHRLZXkgJiYgZXZlbnQua2V5Q29kZSA9PT0gJC51aS5rZXlDb2RlLlBBR0VfRE9XTiApIHsKCQkJdGhpcy5fYWN0aXZhdGUoIHRoaXMuX2ZvY3VzTmV4dFRhYiggdGhpcy5vcHRpb25zLmFjdGl2ZSArIDEsIHRydWUgKSApOwoJCQlyZXR1cm4gdHJ1ZTsKCQl9Cgl9LAoKCV9maW5kTmV4dFRhYjogZnVuY3Rpb24oIGluZGV4LCBnb2luZ0ZvcndhcmQgKSB7CgkJdmFyIGxhc3RUYWJJbmRleCA9IHRoaXMudGFicy5sZW5ndGggLSAxOwoKCQlmdW5jdGlvbiBjb25zdHJhaW4oKSB7CgkJCWlmICggaW5kZXggPiBsYXN0VGFiSW5kZXggKSB7CgkJCQlpbmRleCA9IDA7CgkJCX0KCQkJaWYgKCBpbmRleCA8IDAgKSB7CgkJCQlpbmRleCA9IGxhc3RUYWJJbmRleDsKCQkJfQoJCQlyZXR1cm4gaW5kZXg7CgkJfQoKCQl3aGlsZSAoICQuaW5BcnJheSggY29uc3RyYWluKCksIHRoaXMub3B0aW9ucy5kaXNhYmxlZCApICE9PSAtMSApIHsKCQkJaW5kZXggPSBnb2luZ0ZvcndhcmQgPyBpbmRleCArIDEgOiBpbmRleCAtIDE7CgkJfQoKCQlyZXR1cm4gaW5kZXg7Cgl9LAoKCV9mb2N1c05leHRUYWI6IGZ1bmN0aW9uKCBpbmRleCwgZ29pbmdGb3J3YXJkICkgewoJCWluZGV4ID0gdGhpcy5fZmluZE5leHRUYWIoIGluZGV4LCBnb2luZ0ZvcndhcmQgKTsKCQl0aGlzLnRhYnMuZXEoIGluZGV4ICkuZm9jdXMoKTsKCQlyZXR1cm4gaW5kZXg7Cgl9LAoKCV9zZXRPcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCWlmICgga2V5ID09PSAiYWN0aXZlIiApIHsKCQkJLy8gX2FjdGl2YXRlKCkgd2lsbCBoYW5kbGUgaW52YWxpZCB2YWx1ZXMgYW5kIHVwZGF0ZSB0aGlzLm9wdGlvbnMKCQkJdGhpcy5fYWN0aXZhdGUoIHZhbHVlICk7CgkJCXJldHVybjsKCQl9CgoJCWlmICgga2V5ID09PSAiZGlzYWJsZWQiICkgewoJCQkvLyBkb24ndCB1c2UgdGhlIHdpZGdldCBmYWN0b3J5J3MgZGlzYWJsZWQgaGFuZGxpbmcKCQkJdGhpcy5fc2V0dXBEaXNhYmxlZCggdmFsdWUgKTsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5fc3VwZXIoIGtleSwgdmFsdWUpOwoKCQlpZiAoIGtleSA9PT0gImNvbGxhcHNpYmxlIiApIHsKCQkJdGhpcy5lbGVtZW50LnRvZ2dsZUNsYXNzKCAidWktdGFicy1jb2xsYXBzaWJsZSIsIHZhbHVlICk7CgkJCS8vIFNldHRpbmcgY29sbGFwc2libGU6IGZhbHNlIHdoaWxlIGNvbGxhcHNlZDsgb3BlbiBmaXJzdCBwYW5lbAoJCQlpZiAoICF2YWx1ZSAmJiB0aGlzLm9wdGlvbnMuYWN0aXZlID09PSBmYWxzZSApIHsKCQkJCXRoaXMuX2FjdGl2YXRlKCAwICk7CgkJCX0KCQl9CgoJCWlmICgga2V5ID09PSAiZXZlbnQiICkgewoJCQl0aGlzLl9zZXR1cEV2ZW50cyggdmFsdWUgKTsKCQl9CgoJCWlmICgga2V5ID09PSAiaGVpZ2h0U3R5bGUiICkgewoJCQl0aGlzLl9zZXR1cEhlaWdodFN0eWxlKCB2YWx1ZSApOwoJCX0KCX0sCgoJX3Nhbml0aXplU2VsZWN0b3I6IGZ1bmN0aW9uKCBoYXNoICkgewoJCXJldHVybiBoYXNoID8gaGFzaC5yZXBsYWNlKCAvWyEiJCUmJygpKissLlwvOjs8PT4/QFxbXF1cXmB7fH1+XS9nLCAiXFwkJiIgKSA6ICIiOwoJfSwKCglyZWZyZXNoOiBmdW5jdGlvbigpIHsKCQl2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKCQkJbGlzID0gdGhpcy50YWJsaXN0LmNoaWxkcmVuKCAiOmhhcyhhW2hyZWZdKSIgKTsKCgkJLy8gZ2V0IGRpc2FibGVkIHRhYnMgZnJvbSBjbGFzcyBhdHRyaWJ1dGUgZnJvbSBIVE1MCgkJLy8gdGhpcyB3aWxsIGdldCBjb252ZXJ0ZWQgdG8gYSBib29sZWFuIGlmIG5lZWRlZCBpbiBfcmVmcmVzaCgpCgkJb3B0aW9ucy5kaXNhYmxlZCA9ICQubWFwKCBsaXMuZmlsdGVyKCAiLnVpLXN0YXRlLWRpc2FibGVkIiApLCBmdW5jdGlvbiggdGFiICkgewoJCQlyZXR1cm4gbGlzLmluZGV4KCB0YWIgKTsKCQl9KTsKCgkJdGhpcy5fcHJvY2Vzc1RhYnMoKTsKCgkJLy8gd2FzIGNvbGxhcHNlZCBvciBubyB0YWJzCgkJaWYgKCBvcHRpb25zLmFjdGl2ZSA9PT0gZmFsc2UgfHwgIXRoaXMuYW5jaG9ycy5sZW5ndGggKSB7CgkJCW9wdGlvbnMuYWN0aXZlID0gZmFsc2U7CgkJCXRoaXMuYWN0aXZlID0gJCgpOwoJCS8vIHdhcyBhY3RpdmUsIGJ1dCBhY3RpdmUgdGFiIGlzIGdvbmUKCQl9IGVsc2UgaWYgKCB0aGlzLmFjdGl2ZS5sZW5ndGggJiYgISQuY29udGFpbnMoIHRoaXMudGFibGlzdFsgMCBdLCB0aGlzLmFjdGl2ZVsgMCBdICkgKSB7CgkJCS8vIGFsbCByZW1haW5pbmcgdGFicyBhcmUgZGlzYWJsZWQKCQkJaWYgKCB0aGlzLnRhYnMubGVuZ3RoID09PSBvcHRpb25zLmRpc2FibGVkLmxlbmd0aCApIHsKCQkJCW9wdGlvbnMuYWN0aXZlID0gZmFsc2U7CgkJCQl0aGlzLmFjdGl2ZSA9ICQoKTsKCQkJLy8gYWN0aXZhdGUgcHJldmlvdXMgdGFiCgkJCX0gZWxzZSB7CgkJCQl0aGlzLl9hY3RpdmF0ZSggdGhpcy5fZmluZE5leHRUYWIoIE1hdGgubWF4KCAwLCBvcHRpb25zLmFjdGl2ZSAtIDEgKSwgZmFsc2UgKSApOwoJCQl9CgkJLy8gd2FzIGFjdGl2ZSwgYWN0aXZlIHRhYiBzdGlsbCBleGlzdHMKCQl9IGVsc2UgewoJCQkvLyBtYWtlIHN1cmUgYWN0aXZlIGluZGV4IGlzIGNvcnJlY3QKCQkJb3B0aW9ucy5hY3RpdmUgPSB0aGlzLnRhYnMuaW5kZXgoIHRoaXMuYWN0aXZlICk7CgkJfQoKCQl0aGlzLl9yZWZyZXNoKCk7Cgl9LAoKCV9yZWZyZXNoOiBmdW5jdGlvbigpIHsKCQl0aGlzLl9zZXR1cERpc2FibGVkKCB0aGlzLm9wdGlvbnMuZGlzYWJsZWQgKTsKCQl0aGlzLl9zZXR1cEV2ZW50cyggdGhpcy5vcHRpb25zLmV2ZW50ICk7CgkJdGhpcy5fc2V0dXBIZWlnaHRTdHlsZSggdGhpcy5vcHRpb25zLmhlaWdodFN0eWxlICk7CgoJCXRoaXMudGFicy5ub3QoIHRoaXMuYWN0aXZlICkuYXR0cih7CgkJCSJhcmlhLXNlbGVjdGVkIjogImZhbHNlIiwKCQkJImFyaWEtZXhwYW5kZWQiOiAiZmFsc2UiLAoJCQl0YWJJbmRleDogLTEKCQl9KTsKCQl0aGlzLnBhbmVscy5ub3QoIHRoaXMuX2dldFBhbmVsRm9yVGFiKCB0aGlzLmFjdGl2ZSApICkKCQkJLmhpZGUoKQoJCQkuYXR0cih7CgkJCQkiYXJpYS1oaWRkZW4iOiAidHJ1ZSIKCQkJfSk7CgoJCS8vIE1ha2Ugc3VyZSBvbmUgdGFiIGlzIGluIHRoZSB0YWIgb3JkZXIKCQlpZiAoICF0aGlzLmFjdGl2ZS5sZW5ndGggKSB7CgkJCXRoaXMudGFicy5lcSggMCApLmF0dHIoICJ0YWJJbmRleCIsIDAgKTsKCQl9IGVsc2UgewoJCQl0aGlzLmFjdGl2ZQoJCQkJLmFkZENsYXNzKCAidWktdGFicy1hY3RpdmUgdWktc3RhdGUtYWN0aXZlIiApCgkJCQkuYXR0cih7CgkJCQkJImFyaWEtc2VsZWN0ZWQiOiAidHJ1ZSIsCgkJCQkJImFyaWEtZXhwYW5kZWQiOiAidHJ1ZSIsCgkJCQkJdGFiSW5kZXg6IDAKCQkJCX0pOwoJCQl0aGlzLl9nZXRQYW5lbEZvclRhYiggdGhpcy5hY3RpdmUgKQoJCQkJLnNob3coKQoJCQkJLmF0dHIoewoJCQkJCSJhcmlhLWhpZGRlbiI6ICJmYWxzZSIKCQkJCX0pOwoJCX0KCX0sCgoJX3Byb2Nlc3NUYWJzOiBmdW5jdGlvbigpIHsKCQl2YXIgdGhhdCA9IHRoaXM7CgoJCXRoaXMudGFibGlzdCA9IHRoaXMuX2dldExpc3QoKQoJCQkuYWRkQ2xhc3MoICJ1aS10YWJzLW5hdiB1aS1oZWxwZXItcmVzZXQgdWktaGVscGVyLWNsZWFyZml4IHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWFsbCIgKQoJCQkuYXR0ciggInJvbGUiLCAidGFibGlzdCIgKQoKCQkJLy8gUHJldmVudCB1c2VycyBmcm9tIGZvY3VzaW5nIGRpc2FibGVkIHRhYnMgdmlhIGNsaWNrCgkJCS5kZWxlZ2F0ZSggIj4gbGkiLCAibW91c2Vkb3duIiArIHRoaXMuZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKCBldmVudCApIHsKCQkJCWlmICggJCggdGhpcyApLmlzKCAiLnVpLXN0YXRlLWRpc2FibGVkIiApICkgewoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJCQl9CgkJCX0pCgoJCQkvLyBzdXBwb3J0OiBJRSA8OQoJCQkvLyBQcmV2ZW50aW5nIHRoZSBkZWZhdWx0IGFjdGlvbiBpbiBtb3VzZWRvd24gZG9lc24ndCBwcmV2ZW50IElFCgkJCS8vIGZyb20gZm9jdXNpbmcgdGhlIGVsZW1lbnQsIHNvIGlmIHRoZSBhbmNob3IgZ2V0cyBmb2N1c2VkLCBibHVyLgoJCQkvLyBXZSBkb24ndCBoYXZlIHRvIHdvcnJ5IGFib3V0IGZvY3VzaW5nIHRoZSBwcmV2aW91c2x5IGZvY3VzZWQKCQkJLy8gZWxlbWVudCBzaW5jZSBjbGlja2luZyBvbiBhIG5vbi1mb2N1c2FibGUgZWxlbWVudCBzaG91bGQgZm9jdXMKCQkJLy8gdGhlIGJvZHkgYW55d2F5LgoJCQkuZGVsZWdhdGUoICIudWktdGFicy1hbmNob3IiLCAiZm9jdXMiICsgdGhpcy5ldmVudE5hbWVzcGFjZSwgZnVuY3Rpb24oKSB7CgkJCQlpZiAoICQoIHRoaXMgKS5jbG9zZXN0KCAibGkiICkuaXMoICIudWktc3RhdGUtZGlzYWJsZWQiICkgKSB7CgkJCQkJdGhpcy5ibHVyKCk7CgkJCQl9CgkJCX0pOwoKCQl0aGlzLnRhYnMgPSB0aGlzLnRhYmxpc3QuZmluZCggIj4gbGk6aGFzKGFbaHJlZl0pIiApCgkJCS5hZGRDbGFzcyggInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXRvcCIgKQoJCQkuYXR0cih7CgkJCQlyb2xlOiAidGFiIiwKCQkJCXRhYkluZGV4OiAtMQoJCQl9KTsKCgkJdGhpcy5hbmNob3JzID0gdGhpcy50YWJzLm1hcChmdW5jdGlvbigpIHsKCQkJCXJldHVybiAkKCAiYSIsIHRoaXMgKVsgMCBdOwoJCQl9KQoJCQkuYWRkQ2xhc3MoICJ1aS10YWJzLWFuY2hvciIgKQoJCQkuYXR0cih7CgkJCQlyb2xlOiAicHJlc2VudGF0aW9uIiwKCQkJCXRhYkluZGV4OiAtMQoJCQl9KTsKCgkJdGhpcy5wYW5lbHMgPSAkKCk7CgoJCXRoaXMuYW5jaG9ycy5lYWNoKGZ1bmN0aW9uKCBpLCBhbmNob3IgKSB7CgkJCXZhciBzZWxlY3RvciwgcGFuZWwsIHBhbmVsSWQsCgkJCQlhbmNob3JJZCA9ICQoIGFuY2hvciApLnVuaXF1ZUlkKCkuYXR0ciggImlkIiApLAoJCQkJdGFiID0gJCggYW5jaG9yICkuY2xvc2VzdCggImxpIiApLAoJCQkJb3JpZ2luYWxBcmlhQ29udHJvbHMgPSB0YWIuYXR0ciggImFyaWEtY29udHJvbHMiICk7CgoJCQkvLyBpbmxpbmUgdGFiCgkJCWlmICggdGhhdC5faXNMb2NhbCggYW5jaG9yICkgKSB7CgkJCQlzZWxlY3RvciA9IGFuY2hvci5oYXNoOwoJCQkJcGFuZWxJZCA9IHNlbGVjdG9yLnN1YnN0cmluZyggMSApOwoJCQkJcGFuZWwgPSB0aGF0LmVsZW1lbnQuZmluZCggdGhhdC5fc2FuaXRpemVTZWxlY3Rvciggc2VsZWN0b3IgKSApOwoJCQkvLyByZW1vdGUgdGFiCgkJCX0gZWxzZSB7CgkJCQkvLyBJZiB0aGUgdGFiIGRvZXNuJ3QgYWxyZWFkeSBoYXZlIGFyaWEtY29udHJvbHMsCgkJCQkvLyBnZW5lcmF0ZSBhbiBpZCBieSB1c2luZyBhIHRocm93LWF3YXkgZWxlbWVudAoJCQkJcGFuZWxJZCA9IHRhYi5hdHRyKCAiYXJpYS1jb250cm9scyIgKSB8fCAkKCB7fSApLnVuaXF1ZUlkKClbIDAgXS5pZDsKCQkJCXNlbGVjdG9yID0gIiMiICsgcGFuZWxJZDsKCQkJCXBhbmVsID0gdGhhdC5lbGVtZW50LmZpbmQoIHNlbGVjdG9yICk7CgkJCQlpZiAoICFwYW5lbC5sZW5ndGggKSB7CgkJCQkJcGFuZWwgPSB0aGF0Ll9jcmVhdGVQYW5lbCggcGFuZWxJZCApOwoJCQkJCXBhbmVsLmluc2VydEFmdGVyKCB0aGF0LnBhbmVsc1sgaSAtIDEgXSB8fCB0aGF0LnRhYmxpc3QgKTsKCQkJCX0KCQkJCXBhbmVsLmF0dHIoICJhcmlhLWxpdmUiLCAicG9saXRlIiApOwoJCQl9CgoJCQlpZiAoIHBhbmVsLmxlbmd0aCkgewoJCQkJdGhhdC5wYW5lbHMgPSB0aGF0LnBhbmVscy5hZGQoIHBhbmVsICk7CgkJCX0KCQkJaWYgKCBvcmlnaW5hbEFyaWFDb250cm9scyApIHsKCQkJCXRhYi5kYXRhKCAidWktdGFicy1hcmlhLWNvbnRyb2xzIiwgb3JpZ2luYWxBcmlhQ29udHJvbHMgKTsKCQkJfQoJCQl0YWIuYXR0cih7CgkJCQkiYXJpYS1jb250cm9scyI6IHBhbmVsSWQsCgkJCQkiYXJpYS1sYWJlbGxlZGJ5IjogYW5jaG9ySWQKCQkJfSk7CgkJCXBhbmVsLmF0dHIoICJhcmlhLWxhYmVsbGVkYnkiLCBhbmNob3JJZCApOwoJCX0pOwoKCQl0aGlzLnBhbmVscwoJCQkuYWRkQ2xhc3MoICJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20iICkKCQkJLmF0dHIoICJyb2xlIiwgInRhYnBhbmVsIiApOwoJfSwKCgkvLyBhbGxvdyBvdmVycmlkaW5nIGhvdyB0byBmaW5kIHRoZSBsaXN0IGZvciByYXJlIHVzYWdlIHNjZW5hcmlvcyAoIzc3MTUpCglfZ2V0TGlzdDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMudGFibGlzdCB8fCB0aGlzLmVsZW1lbnQuZmluZCggIm9sLHVsIiApLmVxKCAwICk7Cgl9LAoKCV9jcmVhdGVQYW5lbDogZnVuY3Rpb24oIGlkICkgewoJCXJldHVybiAkKCAiPGRpdj4iICkKCQkJLmF0dHIoICJpZCIsIGlkICkKCQkJLmFkZENsYXNzKCAidWktdGFicy1wYW5lbCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tIiApCgkJCS5kYXRhKCAidWktdGFicy1kZXN0cm95IiwgdHJ1ZSApOwoJfSwKCglfc2V0dXBEaXNhYmxlZDogZnVuY3Rpb24oIGRpc2FibGVkICkgewoJCWlmICggJC5pc0FycmF5KCBkaXNhYmxlZCApICkgewoJCQlpZiAoICFkaXNhYmxlZC5sZW5ndGggKSB7CgkJCQlkaXNhYmxlZCA9IGZhbHNlOwoJCQl9IGVsc2UgaWYgKCBkaXNhYmxlZC5sZW5ndGggPT09IHRoaXMuYW5jaG9ycy5sZW5ndGggKSB7CgkJCQlkaXNhYmxlZCA9IHRydWU7CgkJCX0KCQl9CgoJCS8vIGRpc2FibGUgdGFicwoJCWZvciAoIHZhciBpID0gMCwgbGk7ICggbGkgPSB0aGlzLnRhYnNbIGkgXSApOyBpKysgKSB7CgkJCWlmICggZGlzYWJsZWQgPT09IHRydWUgfHwgJC5pbkFycmF5KCBpLCBkaXNhYmxlZCApICE9PSAtMSApIHsKCQkJCSQoIGxpICkKCQkJCQkuYWRkQ2xhc3MoICJ1aS1zdGF0ZS1kaXNhYmxlZCIgKQoJCQkJCS5hdHRyKCAiYXJpYS1kaXNhYmxlZCIsICJ0cnVlIiApOwoJCQl9IGVsc2UgewoJCQkJJCggbGkgKQoJCQkJCS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiApCgkJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWRpc2FibGVkIiApOwoJCQl9CgkJfQoKCQl0aGlzLm9wdGlvbnMuZGlzYWJsZWQgPSBkaXNhYmxlZDsKCX0sCgoJX3NldHVwRXZlbnRzOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdmFyIGV2ZW50cyA9IHt9OwoJCWlmICggZXZlbnQgKSB7CgkJCSQuZWFjaCggZXZlbnQuc3BsaXQoIiAiKSwgZnVuY3Rpb24oIGluZGV4LCBldmVudE5hbWUgKSB7CgkJCQlldmVudHNbIGV2ZW50TmFtZSBdID0gIl9ldmVudEhhbmRsZXIiOwoJCQl9KTsKCQl9CgoJCXRoaXMuX29mZiggdGhpcy5hbmNob3JzLmFkZCggdGhpcy50YWJzICkuYWRkKCB0aGlzLnBhbmVscyApICk7CgkJLy8gQWx3YXlzIHByZXZlbnQgdGhlIGRlZmF1bHQgYWN0aW9uLCBldmVuIHdoZW4gZGlzYWJsZWQKCQl0aGlzLl9vbiggdHJ1ZSwgdGhpcy5hbmNob3JzLCB7CgkJCWNsaWNrOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9CgkJfSk7CgkJdGhpcy5fb24oIHRoaXMuYW5jaG9ycywgZXZlbnRzICk7CgkJdGhpcy5fb24oIHRoaXMudGFicywgeyBrZXlkb3duOiAiX3RhYktleWRvd24iIH0gKTsKCQl0aGlzLl9vbiggdGhpcy5wYW5lbHMsIHsga2V5ZG93bjogIl9wYW5lbEtleWRvd24iIH0gKTsKCgkJdGhpcy5fZm9jdXNhYmxlKCB0aGlzLnRhYnMgKTsKCQl0aGlzLl9ob3ZlcmFibGUoIHRoaXMudGFicyApOwoJfSwKCglfc2V0dXBIZWlnaHRTdHlsZTogZnVuY3Rpb24oIGhlaWdodFN0eWxlICkgewoJCXZhciBtYXhIZWlnaHQsCgkJCXBhcmVudCA9IHRoaXMuZWxlbWVudC5wYXJlbnQoKTsKCgkJaWYgKCBoZWlnaHRTdHlsZSA9PT0gImZpbGwiICkgewoJCQltYXhIZWlnaHQgPSBwYXJlbnQuaGVpZ2h0KCk7CgkJCW1heEhlaWdodCAtPSB0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSAtIHRoaXMuZWxlbWVudC5oZWlnaHQoKTsKCgkJCXRoaXMuZWxlbWVudC5zaWJsaW5ncyggIjp2aXNpYmxlIiApLmVhY2goZnVuY3Rpb24oKSB7CgkJCQl2YXIgZWxlbSA9ICQoIHRoaXMgKSwKCQkJCQlwb3NpdGlvbiA9IGVsZW0uY3NzKCAicG9zaXRpb24iICk7CgoJCQkJaWYgKCBwb3NpdGlvbiA9PT0gImFic29sdXRlIiB8fCBwb3NpdGlvbiA9PT0gImZpeGVkIiApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQltYXhIZWlnaHQgLT0gZWxlbS5vdXRlckhlaWdodCggdHJ1ZSApOwoJCQl9KTsKCgkJCXRoaXMuZWxlbWVudC5jaGlsZHJlbigpLm5vdCggdGhpcy5wYW5lbHMgKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJbWF4SGVpZ2h0IC09ICQoIHRoaXMgKS5vdXRlckhlaWdodCggdHJ1ZSApOwoJCQl9KTsKCgkJCXRoaXMucGFuZWxzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQkkKCB0aGlzICkuaGVpZ2h0KCBNYXRoLm1heCggMCwgbWF4SGVpZ2h0IC0KCQkJCQkkKCB0aGlzICkuaW5uZXJIZWlnaHQoKSArICQoIHRoaXMgKS5oZWlnaHQoKSApICk7CgkJCX0pCgkJCS5jc3MoICJvdmVyZmxvdyIsICJhdXRvIiApOwoJCX0gZWxzZSBpZiAoIGhlaWdodFN0eWxlID09PSAiYXV0byIgKSB7CgkJCW1heEhlaWdodCA9IDA7CgkJCXRoaXMucGFuZWxzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQltYXhIZWlnaHQgPSBNYXRoLm1heCggbWF4SGVpZ2h0LCAkKCB0aGlzICkuaGVpZ2h0KCAiIiApLmhlaWdodCgpICk7CgkJCX0pLmhlaWdodCggbWF4SGVpZ2h0ICk7CgkJfQoJfSwKCglfZXZlbnRIYW5kbGVyOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCgkJCWFjdGl2ZSA9IHRoaXMuYWN0aXZlLAoJCQlhbmNob3IgPSAkKCBldmVudC5jdXJyZW50VGFyZ2V0ICksCgkJCXRhYiA9IGFuY2hvci5jbG9zZXN0KCAibGkiICksCgkJCWNsaWNrZWRJc0FjdGl2ZSA9IHRhYlsgMCBdID09PSBhY3RpdmVbIDAgXSwKCQkJY29sbGFwc2luZyA9IGNsaWNrZWRJc0FjdGl2ZSAmJiBvcHRpb25zLmNvbGxhcHNpYmxlLAoJCQl0b1Nob3cgPSBjb2xsYXBzaW5nID8gJCgpIDogdGhpcy5fZ2V0UGFuZWxGb3JUYWIoIHRhYiApLAoJCQl0b0hpZGUgPSAhYWN0aXZlLmxlbmd0aCA/ICQoKSA6IHRoaXMuX2dldFBhbmVsRm9yVGFiKCBhY3RpdmUgKSwKCQkJZXZlbnREYXRhID0gewoJCQkJb2xkVGFiOiBhY3RpdmUsCgkJCQlvbGRQYW5lbDogdG9IaWRlLAoJCQkJbmV3VGFiOiBjb2xsYXBzaW5nID8gJCgpIDogdGFiLAoJCQkJbmV3UGFuZWw6IHRvU2hvdwoJCQl9OwoKCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKCQlpZiAoIHRhYi5oYXNDbGFzcyggInVpLXN0YXRlLWRpc2FibGVkIiApIHx8CgkJCQkvLyB0YWIgaXMgYWxyZWFkeSBsb2FkaW5nCgkJCQl0YWIuaGFzQ2xhc3MoICJ1aS10YWJzLWxvYWRpbmciICkgfHwKCQkJCS8vIGNhbid0IHN3aXRjaCBkdXJuaW5nIGFuIGFuaW1hdGlvbgoJCQkJdGhpcy5ydW5uaW5nIHx8CgkJCQkvLyBjbGljayBvbiBhY3RpdmUgaGVhZGVyLCBidXQgbm90IGNvbGxhcHNpYmxlCgkJCQkoIGNsaWNrZWRJc0FjdGl2ZSAmJiAhb3B0aW9ucy5jb2xsYXBzaWJsZSApIHx8CgkJCQkvLyBhbGxvdyBjYW5jZWxpbmcgYWN0aXZhdGlvbgoJCQkJKCB0aGlzLl90cmlnZ2VyKCAiYmVmb3JlQWN0aXZhdGUiLCBldmVudCwgZXZlbnREYXRhICkgPT09IGZhbHNlICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCW9wdGlvbnMuYWN0aXZlID0gY29sbGFwc2luZyA/IGZhbHNlIDogdGhpcy50YWJzLmluZGV4KCB0YWIgKTsKCgkJdGhpcy5hY3RpdmUgPSBjbGlja2VkSXNBY3RpdmUgPyAkKCkgOiB0YWI7CgkJaWYgKCB0aGlzLnhociApIHsKCQkJdGhpcy54aHIuYWJvcnQoKTsKCQl9CgoJCWlmICggIXRvSGlkZS5sZW5ndGggJiYgIXRvU2hvdy5sZW5ndGggKSB7CgkJCSQuZXJyb3IoICJqUXVlcnkgVUkgVGFiczogTWlzbWF0Y2hpbmcgZnJhZ21lbnQgaWRlbnRpZmllci4iICk7CgkJfQoKCQlpZiAoIHRvU2hvdy5sZW5ndGggKSB7CgkJCXRoaXMubG9hZCggdGhpcy50YWJzLmluZGV4KCB0YWIgKSwgZXZlbnQgKTsKCQl9CgkJdGhpcy5fdG9nZ2xlKCBldmVudCwgZXZlbnREYXRhICk7Cgl9LAoKCS8vIGhhbmRsZXMgc2hvdy9oaWRlIGZvciBzZWxlY3RpbmcgdGFicwoJX3RvZ2dsZTogZnVuY3Rpb24oIGV2ZW50LCBldmVudERhdGEgKSB7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQl0b1Nob3cgPSBldmVudERhdGEubmV3UGFuZWwsCgkJCXRvSGlkZSA9IGV2ZW50RGF0YS5vbGRQYW5lbDsKCgkJdGhpcy5ydW5uaW5nID0gdHJ1ZTsKCgkJZnVuY3Rpb24gY29tcGxldGUoKSB7CgkJCXRoYXQucnVubmluZyA9IGZhbHNlOwoJCQl0aGF0Ll90cmlnZ2VyKCAiYWN0aXZhdGUiLCBldmVudCwgZXZlbnREYXRhICk7CgkJfQoKCQlmdW5jdGlvbiBzaG93KCkgewoJCQlldmVudERhdGEubmV3VGFiLmNsb3Nlc3QoICJsaSIgKS5hZGRDbGFzcyggInVpLXRhYnMtYWN0aXZlIHVpLXN0YXRlLWFjdGl2ZSIgKTsKCgkJCWlmICggdG9TaG93Lmxlbmd0aCAmJiB0aGF0Lm9wdGlvbnMuc2hvdyApIHsKCQkJCXRoYXQuX3Nob3coIHRvU2hvdywgdGhhdC5vcHRpb25zLnNob3csIGNvbXBsZXRlICk7CgkJCX0gZWxzZSB7CgkJCQl0b1Nob3cuc2hvdygpOwoJCQkJY29tcGxldGUoKTsKCQkJfQoJCX0KCgkJLy8gc3RhcnQgb3V0IGJ5IGhpZGluZywgdGhlbiBzaG93aW5nLCB0aGVuIGNvbXBsZXRpbmcKCQlpZiAoIHRvSGlkZS5sZW5ndGggJiYgdGhpcy5vcHRpb25zLmhpZGUgKSB7CgkJCXRoaXMuX2hpZGUoIHRvSGlkZSwgdGhpcy5vcHRpb25zLmhpZGUsIGZ1bmN0aW9uKCkgewoJCQkJZXZlbnREYXRhLm9sZFRhYi5jbG9zZXN0KCAibGkiICkucmVtb3ZlQ2xhc3MoICJ1aS10YWJzLWFjdGl2ZSB1aS1zdGF0ZS1hY3RpdmUiICk7CgkJCQlzaG93KCk7CgkJCX0pOwoJCX0gZWxzZSB7CgkJCWV2ZW50RGF0YS5vbGRUYWIuY2xvc2VzdCggImxpIiApLnJlbW92ZUNsYXNzKCAidWktdGFicy1hY3RpdmUgdWktc3RhdGUtYWN0aXZlIiApOwoJCQl0b0hpZGUuaGlkZSgpOwoJCQlzaG93KCk7CgkJfQoKCQl0b0hpZGUuYXR0ciggImFyaWEtaGlkZGVuIiwgInRydWUiICk7CgkJZXZlbnREYXRhLm9sZFRhYi5hdHRyKHsKCQkJImFyaWEtc2VsZWN0ZWQiOiAiZmFsc2UiLAoJCQkiYXJpYS1leHBhbmRlZCI6ICJmYWxzZSIKCQl9KTsKCQkvLyBJZiB3ZSdyZSBzd2l0Y2hpbmcgdGFicywgcmVtb3ZlIHRoZSBvbGQgdGFiIGZyb20gdGhlIHRhYiBvcmRlci4KCQkvLyBJZiB3ZSdyZSBvcGVuaW5nIGZyb20gY29sbGFwc2VkIHN0YXRlLCByZW1vdmUgdGhlIHByZXZpb3VzIHRhYiBmcm9tIHRoZSB0YWIgb3JkZXIuCgkJLy8gSWYgd2UncmUgY29sbGFwc2luZywgdGhlbiBrZWVwIHRoZSBjb2xsYXBzaW5nIHRhYiBpbiB0aGUgdGFiIG9yZGVyLgoJCWlmICggdG9TaG93Lmxlbmd0aCAmJiB0b0hpZGUubGVuZ3RoICkgewoJCQlldmVudERhdGEub2xkVGFiLmF0dHIoICJ0YWJJbmRleCIsIC0xICk7CgkJfSBlbHNlIGlmICggdG9TaG93Lmxlbmd0aCApIHsKCQkJdGhpcy50YWJzLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJCXJldHVybiAkKCB0aGlzICkuYXR0ciggInRhYkluZGV4IiApID09PSAwOwoJCQl9KQoJCQkuYXR0ciggInRhYkluZGV4IiwgLTEgKTsKCQl9CgoJCXRvU2hvdy5hdHRyKCAiYXJpYS1oaWRkZW4iLCAiZmFsc2UiICk7CgkJZXZlbnREYXRhLm5ld1RhYi5hdHRyKHsKCQkJImFyaWEtc2VsZWN0ZWQiOiAidHJ1ZSIsCgkJCSJhcmlhLWV4cGFuZGVkIjogInRydWUiLAoJCQl0YWJJbmRleDogMAoJCX0pOwoJfSwKCglfYWN0aXZhdGU6IGZ1bmN0aW9uKCBpbmRleCApIHsKCQl2YXIgYW5jaG9yLAoJCQlhY3RpdmUgPSB0aGlzLl9maW5kQWN0aXZlKCBpbmRleCApOwoKCQkvLyB0cnlpbmcgdG8gYWN0aXZhdGUgdGhlIGFscmVhZHkgYWN0aXZlIHBhbmVsCgkJaWYgKCBhY3RpdmVbIDAgXSA9PT0gdGhpcy5hY3RpdmVbIDAgXSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gdHJ5aW5nIHRvIGNvbGxhcHNlLCBzaW11bGF0ZSBhIGNsaWNrIG9uIHRoZSBjdXJyZW50IGFjdGl2ZSBoZWFkZXIKCQlpZiAoICFhY3RpdmUubGVuZ3RoICkgewoJCQlhY3RpdmUgPSB0aGlzLmFjdGl2ZTsKCQl9CgoJCWFuY2hvciA9IGFjdGl2ZS5maW5kKCAiLnVpLXRhYnMtYW5jaG9yIiApWyAwIF07CgkJdGhpcy5fZXZlbnRIYW5kbGVyKHsKCQkJdGFyZ2V0OiBhbmNob3IsCgkJCWN1cnJlbnRUYXJnZXQ6IGFuY2hvciwKCQkJcHJldmVudERlZmF1bHQ6ICQubm9vcAoJCX0pOwoJfSwKCglfZmluZEFjdGl2ZTogZnVuY3Rpb24oIGluZGV4ICkgewoJCXJldHVybiBpbmRleCA9PT0gZmFsc2UgPyAkKCkgOiB0aGlzLnRhYnMuZXEoIGluZGV4ICk7Cgl9LAoKCV9nZXRJbmRleDogZnVuY3Rpb24oIGluZGV4ICkgewoJCS8vIG1ldGEtZnVuY3Rpb24gdG8gZ2l2ZSB1c2VycyBvcHRpb24gdG8gcHJvdmlkZSBhIGhyZWYgc3RyaW5nIGluc3RlYWQgb2YgYSBudW1lcmljYWwgaW5kZXguCgkJaWYgKCB0eXBlb2YgaW5kZXggPT09ICJzdHJpbmciICkgewoJCQlpbmRleCA9IHRoaXMuYW5jaG9ycy5pbmRleCggdGhpcy5hbmNob3JzLmZpbHRlciggIltocmVmJD0nIiArIGluZGV4ICsgIiddIiApICk7CgkJfQoKCQlyZXR1cm4gaW5kZXg7Cgl9LAoKCV9kZXN0cm95OiBmdW5jdGlvbigpIHsKCQlpZiAoIHRoaXMueGhyICkgewoJCQl0aGlzLnhoci5hYm9ydCgpOwoJCX0KCgkJdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCAidWktdGFicyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCB1aS10YWJzLWNvbGxhcHNpYmxlIiApOwoKCQl0aGlzLnRhYmxpc3QKCQkJLnJlbW92ZUNsYXNzKCAidWktdGFicy1uYXYgdWktaGVscGVyLXJlc2V0IHVpLWhlbHBlci1jbGVhcmZpeCB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGwiICkKCQkJLnJlbW92ZUF0dHIoICJyb2xlIiApOwoKCQl0aGlzLmFuY2hvcnMKCQkJLnJlbW92ZUNsYXNzKCAidWktdGFicy1hbmNob3IiICkKCQkJLnJlbW92ZUF0dHIoICJyb2xlIiApCgkJCS5yZW1vdmVBdHRyKCAidGFiSW5kZXgiICkKCQkJLnJlbW92ZVVuaXF1ZUlkKCk7CgoJCXRoaXMudGFibGlzdC51bmJpbmQoIHRoaXMuZXZlbnROYW1lc3BhY2UgKTsKCgkJdGhpcy50YWJzLmFkZCggdGhpcy5wYW5lbHMgKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoICQuZGF0YSggdGhpcywgInVpLXRhYnMtZGVzdHJveSIgKSApIHsKCQkJCSQoIHRoaXMgKS5yZW1vdmUoKTsKCQkJfSBlbHNlIHsKCQkJCSQoIHRoaXMgKQoJCQkJCS5yZW1vdmVDbGFzcyggInVpLXN0YXRlLWRlZmF1bHQgdWktc3RhdGUtYWN0aXZlIHVpLXN0YXRlLWRpc2FibGVkICIgKwoJCQkJCQkidWktY29ybmVyLXRvcCB1aS1jb3JuZXItYm90dG9tIHVpLXdpZGdldC1jb250ZW50IHVpLXRhYnMtYWN0aXZlIHVpLXRhYnMtcGFuZWwiICkKCQkJCQkucmVtb3ZlQXR0ciggInRhYkluZGV4IiApCgkJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWxpdmUiICkKCQkJCQkucmVtb3ZlQXR0ciggImFyaWEtYnVzeSIgKQoJCQkJCS5yZW1vdmVBdHRyKCAiYXJpYS1zZWxlY3RlZCIgKQoJCQkJCS5yZW1vdmVBdHRyKCAiYXJpYS1sYWJlbGxlZGJ5IiApCgkJCQkJLnJlbW92ZUF0dHIoICJhcmlhLWhpZGRlbiIgKQoJCQkJCS5yZW1vdmVBdHRyKCAiYXJpYS1leHBhbmRlZCIgKQoJCQkJCS5yZW1vdmVBdHRyKCAicm9sZSIgKTsKCQkJfQoJCX0pOwoKCQl0aGlzLnRhYnMuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIGxpID0gJCggdGhpcyApLAoJCQkJcHJldiA9IGxpLmRhdGEoICJ1aS10YWJzLWFyaWEtY29udHJvbHMiICk7CgkJCWlmICggcHJldiApIHsKCQkJCWxpCgkJCQkJLmF0dHIoICJhcmlhLWNvbnRyb2xzIiwgcHJldiApCgkJCQkJLnJlbW92ZURhdGEoICJ1aS10YWJzLWFyaWEtY29udHJvbHMiICk7CgkJCX0gZWxzZSB7CgkJCQlsaS5yZW1vdmVBdHRyKCAiYXJpYS1jb250cm9scyIgKTsKCQkJfQoJCX0pOwoKCQl0aGlzLnBhbmVscy5zaG93KCk7CgoJCWlmICggdGhpcy5vcHRpb25zLmhlaWdodFN0eWxlICE9PSAiY29udGVudCIgKSB7CgkJCXRoaXMucGFuZWxzLmNzcyggImhlaWdodCIsICIiICk7CgkJfQoJfSwKCgllbmFibGU6IGZ1bmN0aW9uKCBpbmRleCApIHsKCQl2YXIgZGlzYWJsZWQgPSB0aGlzLm9wdGlvbnMuZGlzYWJsZWQ7CgkJaWYgKCBkaXNhYmxlZCA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggaW5kZXggPT09IHVuZGVmaW5lZCApIHsKCQkJZGlzYWJsZWQgPSBmYWxzZTsKCQl9IGVsc2UgewoJCQlpbmRleCA9IHRoaXMuX2dldEluZGV4KCBpbmRleCApOwoJCQlpZiAoICQuaXNBcnJheSggZGlzYWJsZWQgKSApIHsKCQkJCWRpc2FibGVkID0gJC5tYXAoIGRpc2FibGVkLCBmdW5jdGlvbiggbnVtICkgewoJCQkJCXJldHVybiBudW0gIT09IGluZGV4ID8gbnVtIDogbnVsbDsKCQkJCX0pOwoJCQl9IGVsc2UgewoJCQkJZGlzYWJsZWQgPSAkLm1hcCggdGhpcy50YWJzLCBmdW5jdGlvbiggbGksIG51bSApIHsKCQkJCQlyZXR1cm4gbnVtICE9PSBpbmRleCA/IG51bSA6IG51bGw7CgkJCQl9KTsKCQkJfQoJCX0KCQl0aGlzLl9zZXR1cERpc2FibGVkKCBkaXNhYmxlZCApOwoJfSwKCglkaXNhYmxlOiBmdW5jdGlvbiggaW5kZXggKSB7CgkJdmFyIGRpc2FibGVkID0gdGhpcy5vcHRpb25zLmRpc2FibGVkOwoJCWlmICggZGlzYWJsZWQgPT09IHRydWUgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggaW5kZXggPT09IHVuZGVmaW5lZCApIHsKCQkJZGlzYWJsZWQgPSB0cnVlOwoJCX0gZWxzZSB7CgkJCWluZGV4ID0gdGhpcy5fZ2V0SW5kZXgoIGluZGV4ICk7CgkJCWlmICggJC5pbkFycmF5KCBpbmRleCwgZGlzYWJsZWQgKSAhPT0gLTEgKSB7CgkJCQlyZXR1cm47CgkJCX0KCQkJaWYgKCAkLmlzQXJyYXkoIGRpc2FibGVkICkgKSB7CgkJCQlkaXNhYmxlZCA9ICQubWVyZ2UoIFsgaW5kZXggXSwgZGlzYWJsZWQgKS5zb3J0KCk7CgkJCX0gZWxzZSB7CgkJCQlkaXNhYmxlZCA9IFsgaW5kZXggXTsKCQkJfQoJCX0KCQl0aGlzLl9zZXR1cERpc2FibGVkKCBkaXNhYmxlZCApOwoJfSwKCglsb2FkOiBmdW5jdGlvbiggaW5kZXgsIGV2ZW50ICkgewoJCWluZGV4ID0gdGhpcy5fZ2V0SW5kZXgoIGluZGV4ICk7CgkJdmFyIHRoYXQgPSB0aGlzLAoJCQl0YWIgPSB0aGlzLnRhYnMuZXEoIGluZGV4ICksCgkJCWFuY2hvciA9IHRhYi5maW5kKCAiLnVpLXRhYnMtYW5jaG9yIiApLAoJCQlwYW5lbCA9IHRoaXMuX2dldFBhbmVsRm9yVGFiKCB0YWIgKSwKCQkJZXZlbnREYXRhID0gewoJCQkJdGFiOiB0YWIsCgkJCQlwYW5lbDogcGFuZWwKCQkJfTsKCgkJLy8gbm90IHJlbW90ZQoJCWlmICggdGhpcy5faXNMb2NhbCggYW5jaG9yWyAwIF0gKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy54aHIgPSAkLmFqYXgoIHRoaXMuX2FqYXhTZXR0aW5ncyggYW5jaG9yLCBldmVudCwgZXZlbnREYXRhICkgKTsKCgkJLy8gc3VwcG9ydDogalF1ZXJ5IDwxLjgKCQkvLyBqUXVlcnkgPDEuOCByZXR1cm5zIGZhbHNlIGlmIHRoZSByZXF1ZXN0IGlzIGNhbmNlbGVkIGluIGJlZm9yZVNlbmQsCgkJLy8gYnV0IGFzIG9mIDEuOCwgJC5hamF4KCkgYWx3YXlzIHJldHVybnMgYSBqcVhIUiBvYmplY3QuCgkJaWYgKCB0aGlzLnhociAmJiB0aGlzLnhoci5zdGF0dXNUZXh0ICE9PSAiY2FuY2VsZWQiICkgewoJCQl0YWIuYWRkQ2xhc3MoICJ1aS10YWJzLWxvYWRpbmciICk7CgkJCXBhbmVsLmF0dHIoICJhcmlhLWJ1c3kiLCAidHJ1ZSIgKTsKCgkJCXRoaXMueGhyCgkJCQkuc3VjY2VzcyhmdW5jdGlvbiggcmVzcG9uc2UgKSB7CgkJCQkJLy8gc3VwcG9ydDogalF1ZXJ5IDwxLjgKCQkJCQkvLyBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMTc3OAoJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQkJCXBhbmVsLmh0bWwoIHJlc3BvbnNlICk7CgkJCQkJCXRoYXQuX3RyaWdnZXIoICJsb2FkIiwgZXZlbnQsIGV2ZW50RGF0YSApOwoJCQkJCX0sIDEgKTsKCQkJCX0pCgkJCQkuY29tcGxldGUoZnVuY3Rpb24oIGpxWEhSLCBzdGF0dXMgKSB7CgkJCQkJLy8gc3VwcG9ydDogalF1ZXJ5IDwxLjgKCQkJCQkvLyBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMTc3OAoJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQkJCWlmICggc3RhdHVzID09PSAiYWJvcnQiICkgewoJCQkJCQkJdGhhdC5wYW5lbHMuc3RvcCggZmFsc2UsIHRydWUgKTsKCQkJCQkJfQoKCQkJCQkJdGFiLnJlbW92ZUNsYXNzKCAidWktdGFicy1sb2FkaW5nIiApOwoJCQkJCQlwYW5lbC5yZW1vdmVBdHRyKCAiYXJpYS1idXN5IiApOwoKCQkJCQkJaWYgKCBqcVhIUiA9PT0gdGhhdC54aHIgKSB7CgkJCQkJCQlkZWxldGUgdGhhdC54aHI7CgkJCQkJCX0KCQkJCQl9LCAxICk7CgkJCQl9KTsKCQl9Cgl9LAoKCV9hamF4U2V0dGluZ3M6IGZ1bmN0aW9uKCBhbmNob3IsIGV2ZW50LCBldmVudERhdGEgKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoJCXJldHVybiB7CgkJCXVybDogYW5jaG9yLmF0dHIoICJocmVmIiApLAoJCQliZWZvcmVTZW5kOiBmdW5jdGlvbigganFYSFIsIHNldHRpbmdzICkgewoJCQkJcmV0dXJuIHRoYXQuX3RyaWdnZXIoICJiZWZvcmVMb2FkIiwgZXZlbnQsCgkJCQkJJC5leHRlbmQoIHsganFYSFI6IGpxWEhSLCBhamF4U2V0dGluZ3M6IHNldHRpbmdzIH0sIGV2ZW50RGF0YSApICk7CgkJCX0KCQl9OwoJfSwKCglfZ2V0UGFuZWxGb3JUYWI6IGZ1bmN0aW9uKCB0YWIgKSB7CgkJdmFyIGlkID0gJCggdGFiICkuYXR0ciggImFyaWEtY29udHJvbHMiICk7CgkJcmV0dXJuIHRoaXMuZWxlbWVudC5maW5kKCB0aGlzLl9zYW5pdGl6ZVNlbGVjdG9yKCAiIyIgKyBpZCApICk7Cgl9Cn0pOwoKCi8qIQogKiBqUXVlcnkgVUkgVG9vbHRpcCAxLjExLjEKICogaHR0cDovL2pxdWVyeXVpLmNvbQogKgogKiBDb3B5cmlnaHQgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBodHRwOi8vYXBpLmpxdWVyeXVpLmNvbS90b29sdGlwLwogKi8KCgp2YXIgdG9vbHRpcCA9ICQud2lkZ2V0KCAidWkudG9vbHRpcCIsIHsKCXZlcnNpb246ICIxLjExLjEiLAoJb3B0aW9uczogewoJCWNvbnRlbnQ6IGZ1bmN0aW9uKCkgewoJCQkvLyBzdXBwb3J0OiBJRTw5LCBPcGVyYSBpbiBqUXVlcnkgPDEuNwoJCQkvLyAudGV4dCgpIGNhbid0IGFjY2VwdCB1bmRlZmluZWQsIHNvIGNvZXJjZSB0byBhIHN0cmluZwoJCQl2YXIgdGl0bGUgPSAkKCB0aGlzICkuYXR0ciggInRpdGxlIiApIHx8ICIiOwoJCQkvLyBFc2NhcGUgdGl0bGUsIHNpbmNlIHdlJ3JlIGdvaW5nIGZyb20gYW4gYXR0cmlidXRlIHRvIHJhdyBIVE1MCgkJCXJldHVybiAkKCAiPGE+IiApLnRleHQoIHRpdGxlICkuaHRtbCgpOwoJCX0sCgkJaGlkZTogdHJ1ZSwKCQkvLyBEaXNhYmxlZCBlbGVtZW50cyBoYXZlIGluY29uc2lzdGVudCBiZWhhdmlvciBhY3Jvc3MgYnJvd3NlcnMgKCM4NjYxKQoJCWl0ZW1zOiAiW3RpdGxlXTpub3QoW2Rpc2FibGVkXSkiLAoJCXBvc2l0aW9uOiB7CgkJCW15OiAibGVmdCB0b3ArMTUiLAoJCQlhdDogImxlZnQgYm90dG9tIiwKCQkJY29sbGlzaW9uOiAiZmxpcGZpdCBmbGlwIgoJCX0sCgkJc2hvdzogdHJ1ZSwKCQl0b29sdGlwQ2xhc3M6IG51bGwsCgkJdHJhY2s6IGZhbHNlLAoKCQkvLyBjYWxsYmFja3MKCQljbG9zZTogbnVsbCwKCQlvcGVuOiBudWxsCgl9LAoKCV9hZGREZXNjcmliZWRCeTogZnVuY3Rpb24oIGVsZW0sIGlkICkgewoJCXZhciBkZXNjcmliZWRieSA9IChlbGVtLmF0dHIoICJhcmlhLWRlc2NyaWJlZGJ5IiApIHx8ICIiKS5zcGxpdCggL1xzKy8gKTsKCQlkZXNjcmliZWRieS5wdXNoKCBpZCApOwoJCWVsZW0KCQkJLmRhdGEoICJ1aS10b29sdGlwLWlkIiwgaWQgKQoJCQkuYXR0ciggImFyaWEtZGVzY3JpYmVkYnkiLCAkLnRyaW0oIGRlc2NyaWJlZGJ5LmpvaW4oICIgIiApICkgKTsKCX0sCgoJX3JlbW92ZURlc2NyaWJlZEJ5OiBmdW5jdGlvbiggZWxlbSApIHsKCQl2YXIgaWQgPSBlbGVtLmRhdGEoICJ1aS10b29sdGlwLWlkIiApLAoJCQlkZXNjcmliZWRieSA9IChlbGVtLmF0dHIoICJhcmlhLWRlc2NyaWJlZGJ5IiApIHx8ICIiKS5zcGxpdCggL1xzKy8gKSwKCQkJaW5kZXggPSAkLmluQXJyYXkoIGlkLCBkZXNjcmliZWRieSApOwoKCQlpZiAoIGluZGV4ICE9PSAtMSApIHsKCQkJZGVzY3JpYmVkYnkuc3BsaWNlKCBpbmRleCwgMSApOwoJCX0KCgkJZWxlbS5yZW1vdmVEYXRhKCAidWktdG9vbHRpcC1pZCIgKTsKCQlkZXNjcmliZWRieSA9ICQudHJpbSggZGVzY3JpYmVkYnkuam9pbiggIiAiICkgKTsKCQlpZiAoIGRlc2NyaWJlZGJ5ICkgewoJCQllbGVtLmF0dHIoICJhcmlhLWRlc2NyaWJlZGJ5IiwgZGVzY3JpYmVkYnkgKTsKCQl9IGVsc2UgewoJCQllbGVtLnJlbW92ZUF0dHIoICJhcmlhLWRlc2NyaWJlZGJ5IiApOwoJCX0KCX0sCgoJX2NyZWF0ZTogZnVuY3Rpb24oKSB7CgkJdGhpcy5fb24oewoJCQltb3VzZW92ZXI6ICJvcGVuIiwKCQkJZm9jdXNpbjogIm9wZW4iCgkJfSk7CgoJCS8vIElEcyBvZiBnZW5lcmF0ZWQgdG9vbHRpcHMsIG5lZWRlZCBmb3IgZGVzdHJveQoJCXRoaXMudG9vbHRpcHMgPSB7fTsKCQkvLyBJRHMgb2YgcGFyZW50IHRvb2x0aXBzIHdoZXJlIHdlIHJlbW92ZWQgdGhlIHRpdGxlIGF0dHJpYnV0ZQoJCXRoaXMucGFyZW50cyA9IHt9OwoKCQlpZiAoIHRoaXMub3B0aW9ucy5kaXNhYmxlZCApIHsKCQkJdGhpcy5fZGlzYWJsZSgpOwoJCX0KCgkJLy8gQXBwZW5kIHRoZSBhcmlhLWxpdmUgcmVnaW9uIHNvIHRvb2x0aXBzIGFubm91bmNlIGNvcnJlY3RseQoJCXRoaXMubGl2ZVJlZ2lvbiA9ICQoICI8ZGl2PiIgKQoJCQkuYXR0cih7CgkJCQlyb2xlOiAibG9nIiwKCQkJCSJhcmlhLWxpdmUiOiAiYXNzZXJ0aXZlIiwKCQkJCSJhcmlhLXJlbGV2YW50IjogImFkZGl0aW9ucyIKCQkJfSkKCQkJLmFkZENsYXNzKCAidWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIiApCgkJCS5hcHBlbmRUbyggdGhpcy5kb2N1bWVudFsgMCBdLmJvZHkgKTsKCX0sCgoJX3NldE9wdGlvbjogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoKCQlpZiAoIGtleSA9PT0gImRpc2FibGVkIiApIHsKCQkJdGhpc1sgdmFsdWUgPyAiX2Rpc2FibGUiIDogIl9lbmFibGUiIF0oKTsKCQkJdGhpcy5vcHRpb25zWyBrZXkgXSA9IHZhbHVlOwoJCQkvLyBkaXNhYmxlIGVsZW1lbnQgc3R5bGUgY2hhbmdlcwoJCQlyZXR1cm47CgkJfQoKCQl0aGlzLl9zdXBlcigga2V5LCB2YWx1ZSApOwoKCQlpZiAoIGtleSA9PT0gImNvbnRlbnQiICkgewoJCQkkLmVhY2goIHRoaXMudG9vbHRpcHMsIGZ1bmN0aW9uKCBpZCwgZWxlbWVudCApIHsKCQkJCXRoYXQuX3VwZGF0ZUNvbnRlbnQoIGVsZW1lbnQgKTsKCQkJfSk7CgkJfQoJfSwKCglfZGlzYWJsZTogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoKCQkvLyBjbG9zZSBvcGVuIHRvb2x0aXBzCgkJJC5lYWNoKCB0aGlzLnRvb2x0aXBzLCBmdW5jdGlvbiggaWQsIGVsZW1lbnQgKSB7CgkJCXZhciBldmVudCA9ICQuRXZlbnQoICJibHVyIiApOwoJCQlldmVudC50YXJnZXQgPSBldmVudC5jdXJyZW50VGFyZ2V0ID0gZWxlbWVudFswXTsKCQkJdGhhdC5jbG9zZSggZXZlbnQsIHRydWUgKTsKCQl9KTsKCgkJLy8gcmVtb3ZlIHRpdGxlIGF0dHJpYnV0ZXMgdG8gcHJldmVudCBuYXRpdmUgdG9vbHRpcHMKCQl0aGlzLmVsZW1lbnQuZmluZCggdGhpcy5vcHRpb25zLml0ZW1zICkuYWRkQmFjaygpLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBlbGVtZW50ID0gJCggdGhpcyApOwoJCQlpZiAoIGVsZW1lbnQuaXMoICJbdGl0bGVdIiApICkgewoJCQkJZWxlbWVudAoJCQkJCS5kYXRhKCAidWktdG9vbHRpcC10aXRsZSIsIGVsZW1lbnQuYXR0ciggInRpdGxlIiApICkKCQkJCQkucmVtb3ZlQXR0ciggInRpdGxlIiApOwoJCQl9CgkJfSk7Cgl9LAoKCV9lbmFibGU6IGZ1bmN0aW9uKCkgewoJCS8vIHJlc3RvcmUgdGl0bGUgYXR0cmlidXRlcwoJCXRoaXMuZWxlbWVudC5maW5kKCB0aGlzLm9wdGlvbnMuaXRlbXMgKS5hZGRCYWNrKCkuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIGVsZW1lbnQgPSAkKCB0aGlzICk7CgkJCWlmICggZWxlbWVudC5kYXRhKCAidWktdG9vbHRpcC10aXRsZSIgKSApIHsKCQkJCWVsZW1lbnQuYXR0ciggInRpdGxlIiwgZWxlbWVudC5kYXRhKCAidWktdG9vbHRpcC10aXRsZSIgKSApOwoJCQl9CgkJfSk7Cgl9LAoKCW9wZW46IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCXRhcmdldCA9ICQoIGV2ZW50ID8gZXZlbnQudGFyZ2V0IDogdGhpcy5lbGVtZW50ICkKCQkJCS8vIHdlIG5lZWQgY2xvc2VzdCBoZXJlIGR1ZSB0byBtb3VzZW92ZXIgYnViYmxpbmcsCgkJCQkvLyBidXQgYWx3YXlzIHBvaW50aW5nIGF0IHRoZSBzYW1lIGV2ZW50IHRhcmdldAoJCQkJLmNsb3Nlc3QoIHRoaXMub3B0aW9ucy5pdGVtcyApOwoKCQkvLyBObyBlbGVtZW50IHRvIHNob3cgYSB0b29sdGlwIGZvciBvciB0aGUgdG9vbHRpcCBpcyBhbHJlYWR5IG9wZW4KCQlpZiAoICF0YXJnZXQubGVuZ3RoIHx8IHRhcmdldC5kYXRhKCAidWktdG9vbHRpcC1pZCIgKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJaWYgKCB0YXJnZXQuYXR0ciggInRpdGxlIiApICkgewoJCQl0YXJnZXQuZGF0YSggInVpLXRvb2x0aXAtdGl0bGUiLCB0YXJnZXQuYXR0ciggInRpdGxlIiApICk7CgkJfQoKCQl0YXJnZXQuZGF0YSggInVpLXRvb2x0aXAtb3BlbiIsIHRydWUgKTsKCgkJLy8ga2lsbCBwYXJlbnQgdG9vbHRpcHMsIGN1c3RvbSBvciBuYXRpdmUsIGZvciBob3ZlcgoJCWlmICggZXZlbnQgJiYgZXZlbnQudHlwZSA9PT0gIm1vdXNlb3ZlciIgKSB7CgkJCXRhcmdldC5wYXJlbnRzKCkuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBwYXJlbnQgPSAkKCB0aGlzICksCgkJCQkJYmx1ckV2ZW50OwoJCQkJaWYgKCBwYXJlbnQuZGF0YSggInVpLXRvb2x0aXAtb3BlbiIgKSApIHsKCQkJCQlibHVyRXZlbnQgPSAkLkV2ZW50KCAiYmx1ciIgKTsKCQkJCQlibHVyRXZlbnQudGFyZ2V0ID0gYmx1ckV2ZW50LmN1cnJlbnRUYXJnZXQgPSB0aGlzOwoJCQkJCXRoYXQuY2xvc2UoIGJsdXJFdmVudCwgdHJ1ZSApOwoJCQkJfQoJCQkJaWYgKCBwYXJlbnQuYXR0ciggInRpdGxlIiApICkgewoJCQkJCXBhcmVudC51bmlxdWVJZCgpOwoJCQkJCXRoYXQucGFyZW50c1sgdGhpcy5pZCBdID0gewoJCQkJCQllbGVtZW50OiB0aGlzLAoJCQkJCQl0aXRsZTogcGFyZW50LmF0dHIoICJ0aXRsZSIgKQoJCQkJCX07CgkJCQkJcGFyZW50LmF0dHIoICJ0aXRsZSIsICIiICk7CgkJCQl9CgkJCX0pOwoJCX0KCgkJdGhpcy5fdXBkYXRlQ29udGVudCggdGFyZ2V0LCBldmVudCApOwoJfSwKCglfdXBkYXRlQ29udGVudDogZnVuY3Rpb24oIHRhcmdldCwgZXZlbnQgKSB7CgkJdmFyIGNvbnRlbnQsCgkJCWNvbnRlbnRPcHRpb24gPSB0aGlzLm9wdGlvbnMuY29udGVudCwKCQkJdGhhdCA9IHRoaXMsCgkJCWV2ZW50VHlwZSA9IGV2ZW50ID8gZXZlbnQudHlwZSA6IG51bGw7CgoJCWlmICggdHlwZW9mIGNvbnRlbnRPcHRpb24gPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gdGhpcy5fb3BlbiggZXZlbnQsIHRhcmdldCwgY29udGVudE9wdGlvbiApOwoJCX0KCgkJY29udGVudCA9IGNvbnRlbnRPcHRpb24uY2FsbCggdGFyZ2V0WzBdLCBmdW5jdGlvbiggcmVzcG9uc2UgKSB7CgkJCS8vIGlnbm9yZSBhc3luYyByZXNwb25zZSBpZiB0b29sdGlwIHdhcyBjbG9zZWQgYWxyZWFkeQoJCQlpZiAoICF0YXJnZXQuZGF0YSggInVpLXRvb2x0aXAtb3BlbiIgKSApIHsKCQkJCXJldHVybjsKCQkJfQoJCQkvLyBJRSBtYXkgaW5zdGFudGx5IHNlcnZlIGEgY2FjaGVkIHJlc3BvbnNlIGZvciBhamF4IHJlcXVlc3RzCgkJCS8vIGRlbGF5IHRoaXMgY2FsbCB0byBfb3BlbiBzbyB0aGUgb3RoZXIgY2FsbCB0byBfb3BlbiBydW5zIGZpcnN0CgkJCXRoYXQuX2RlbGF5KGZ1bmN0aW9uKCkgewoJCQkJLy8galF1ZXJ5IGNyZWF0ZXMgYSBzcGVjaWFsIGV2ZW50IGZvciBmb2N1c2luIHdoZW4gaXQgZG9lc24ndAoJCQkJLy8gZXhpc3QgbmF0aXZlbHkuIFRvIGltcHJvdmUgcGVyZm9ybWFuY2UsIHRoZSBuYXRpdmUgZXZlbnQKCQkJCS8vIG9iamVjdCBpcyByZXVzZWQgYW5kIHRoZSB0eXBlIGlzIGNoYW5nZWQuIFRoZXJlZm9yZSwgd2UgY2FuJ3QKCQkJCS8vIHJlbHkgb24gdGhlIHR5cGUgYmVpbmcgY29ycmVjdCBhZnRlciB0aGUgZXZlbnQgZmluaXNoZWQKCQkJCS8vIGJ1YmJsaW5nLCBzbyB3ZSBzZXQgaXQgYmFjayB0byB0aGUgcHJldmlvdXMgdmFsdWUuICgjODc0MCkKCQkJCWlmICggZXZlbnQgKSB7CgkJCQkJZXZlbnQudHlwZSA9IGV2ZW50VHlwZTsKCQkJCX0KCQkJCXRoaXMuX29wZW4oIGV2ZW50LCB0YXJnZXQsIHJlc3BvbnNlICk7CgkJCX0pOwoJCX0pOwoJCWlmICggY29udGVudCApIHsKCQkJdGhpcy5fb3BlbiggZXZlbnQsIHRhcmdldCwgY29udGVudCApOwoJCX0KCX0sCgoJX29wZW46IGZ1bmN0aW9uKCBldmVudCwgdGFyZ2V0LCBjb250ZW50ICkgewoJCXZhciB0b29sdGlwLCBldmVudHMsIGRlbGF5ZWRTaG93LCBhMTF5Q29udGVudCwKCQkJcG9zaXRpb25PcHRpb24gPSAkLmV4dGVuZCgge30sIHRoaXMub3B0aW9ucy5wb3NpdGlvbiApOwoKCQlpZiAoICFjb250ZW50ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBDb250ZW50IGNhbiBiZSB1cGRhdGVkIG11bHRpcGxlIHRpbWVzLiBJZiB0aGUgdG9vbHRpcCBhbHJlYWR5CgkJLy8gZXhpc3RzLCB0aGVuIGp1c3QgdXBkYXRlIHRoZSBjb250ZW50IGFuZCBiYWlsLgoJCXRvb2x0aXAgPSB0aGlzLl9maW5kKCB0YXJnZXQgKTsKCQlpZiAoIHRvb2x0aXAubGVuZ3RoICkgewoJCQl0b29sdGlwLmZpbmQoICIudWktdG9vbHRpcC1jb250ZW50IiApLmh0bWwoIGNvbnRlbnQgKTsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gaWYgd2UgaGF2ZSBhIHRpdGxlLCBjbGVhciBpdCB0byBwcmV2ZW50IHRoZSBuYXRpdmUgdG9vbHRpcAoJCS8vIHdlIGhhdmUgdG8gY2hlY2sgZmlyc3QgdG8gYXZvaWQgZGVmaW5pbmcgYSB0aXRsZSBpZiBub25lIGV4aXN0cwoJCS8vICh3ZSBkb24ndCB3YW50IHRvIGNhdXNlIGFuIGVsZW1lbnQgdG8gc3RhcnQgbWF0Y2hpbmcgW3RpdGxlXSkKCQkvLwoJCS8vIFdlIHVzZSByZW1vdmVBdHRyIG9ubHkgZm9yIGtleSBldmVudHMsIHRvIGFsbG93IElFIHRvIGV4cG9ydCB0aGUgY29ycmVjdAoJCS8vIGFjY2Vzc2libGUgYXR0cmlidXRlcy4gRm9yIG1vdXNlIGV2ZW50cywgc2V0IHRvIGVtcHR5IHN0cmluZyB0byBhdm9pZAoJCS8vIG5hdGl2ZSB0b29sdGlwIHNob3dpbmcgdXAgKGhhcHBlbnMgb25seSB3aGVuIHJlbW92aW5nIGluc2lkZSBtb3VzZW92ZXIpLgoJCWlmICggdGFyZ2V0LmlzKCAiW3RpdGxlXSIgKSApIHsKCQkJaWYgKCBldmVudCAmJiBldmVudC50eXBlID09PSAibW91c2VvdmVyIiApIHsKCQkJCXRhcmdldC5hdHRyKCAidGl0bGUiLCAiIiApOwoJCQl9IGVsc2UgewoJCQkJdGFyZ2V0LnJlbW92ZUF0dHIoICJ0aXRsZSIgKTsKCQkJfQoJCX0KCgkJdG9vbHRpcCA9IHRoaXMuX3Rvb2x0aXAoIHRhcmdldCApOwoJCXRoaXMuX2FkZERlc2NyaWJlZEJ5KCB0YXJnZXQsIHRvb2x0aXAuYXR0ciggImlkIiApICk7CgkJdG9vbHRpcC5maW5kKCAiLnVpLXRvb2x0aXAtY29udGVudCIgKS5odG1sKCBjb250ZW50ICk7CgoJCS8vIFN1cHBvcnQ6IFZvaWNlb3ZlciBvbiBPUyBYLCBKQVdTIG9uIElFIDw9IDkKCQkvLyBKQVdTIGFubm91bmNlcyBkZWxldGlvbnMgZXZlbiB3aGVuIGFyaWEtcmVsZXZhbnQ9ImFkZGl0aW9ucyIKCQkvLyBWb2ljZW92ZXIgd2lsbCBzb21ldGltZXMgcmUtcmVhZCB0aGUgZW50aXJlIGxvZyByZWdpb24ncyBjb250ZW50cyBmcm9tIHRoZSBiZWdpbm5pbmcKCQl0aGlzLmxpdmVSZWdpb24uY2hpbGRyZW4oKS5oaWRlKCk7CgkJaWYgKCBjb250ZW50LmNsb25lICkgewoJCQlhMTF5Q29udGVudCA9IGNvbnRlbnQuY2xvbmUoKTsKCQkJYTExeUNvbnRlbnQucmVtb3ZlQXR0ciggImlkIiApLmZpbmQoICJbaWRdIiApLnJlbW92ZUF0dHIoICJpZCIgKTsKCQl9IGVsc2UgewoJCQlhMTF5Q29udGVudCA9IGNvbnRlbnQ7CgkJfQoJCSQoICI8ZGl2PiIgKS5odG1sKCBhMTF5Q29udGVudCApLmFwcGVuZFRvKCB0aGlzLmxpdmVSZWdpb24gKTsKCgkJZnVuY3Rpb24gcG9zaXRpb24oIGV2ZW50ICkgewoJCQlwb3NpdGlvbk9wdGlvbi5vZiA9IGV2ZW50OwoJCQlpZiAoIHRvb2x0aXAuaXMoICI6aGlkZGVuIiApICkgewoJCQkJcmV0dXJuOwoJCQl9CgkJCXRvb2x0aXAucG9zaXRpb24oIHBvc2l0aW9uT3B0aW9uICk7CgkJfQoJCWlmICggdGhpcy5vcHRpb25zLnRyYWNrICYmIGV2ZW50ICYmIC9ebW91c2UvLnRlc3QoIGV2ZW50LnR5cGUgKSApIHsKCQkJdGhpcy5fb24oIHRoaXMuZG9jdW1lbnQsIHsKCQkJCW1vdXNlbW92ZTogcG9zaXRpb24KCQkJfSk7CgkJCS8vIHRyaWdnZXIgb25jZSB0byBvdmVycmlkZSBlbGVtZW50LXJlbGF0aXZlIHBvc2l0aW9uaW5nCgkJCXBvc2l0aW9uKCBldmVudCApOwoJCX0gZWxzZSB7CgkJCXRvb2x0aXAucG9zaXRpb24oICQuZXh0ZW5kKHsKCQkJCW9mOiB0YXJnZXQKCQkJfSwgdGhpcy5vcHRpb25zLnBvc2l0aW9uICkgKTsKCQl9CgoJCXRoaXMuaGlkaW5nID0gZmFsc2U7CgkJdGhpcy5jbG9zaW5nID0gZmFsc2U7CgkJdG9vbHRpcC5oaWRlKCk7CgoJCXRoaXMuX3Nob3coIHRvb2x0aXAsIHRoaXMub3B0aW9ucy5zaG93ICk7CgkJLy8gSGFuZGxlIHRyYWNraW5nIHRvb2x0aXBzIHRoYXQgYXJlIHNob3duIHdpdGggYSBkZWxheSAoIzg2NDQpLiBBcyBzb29uCgkJLy8gYXMgdGhlIHRvb2x0aXAgaXMgdmlzaWJsZSwgcG9zaXRpb24gdGhlIHRvb2x0aXAgdXNpbmcgdGhlIG1vc3QgcmVjZW50CgkJLy8gZXZlbnQuCgkJaWYgKCB0aGlzLm9wdGlvbnMuc2hvdyAmJiB0aGlzLm9wdGlvbnMuc2hvdy5kZWxheSApIHsKCQkJZGVsYXllZFNob3cgPSB0aGlzLmRlbGF5ZWRTaG93ID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHRvb2x0aXAuaXMoICI6dmlzaWJsZSIgKSApIHsKCQkJCQlwb3NpdGlvbiggcG9zaXRpb25PcHRpb24ub2YgKTsKCQkJCQljbGVhckludGVydmFsKCBkZWxheWVkU2hvdyApOwoJCQkJfQoJCQl9LCAkLmZ4LmludGVydmFsICk7CgkJfQoKCQl0aGlzLl90cmlnZ2VyKCAib3BlbiIsIGV2ZW50LCB7IHRvb2x0aXA6IHRvb2x0aXAgfSApOwoKCQlldmVudHMgPSB7CgkJCWtleXVwOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQlpZiAoIGV2ZW50LmtleUNvZGUgPT09ICQudWkua2V5Q29kZS5FU0NBUEUgKSB7CgkJCQkJdmFyIGZha2VFdmVudCA9ICQuRXZlbnQoZXZlbnQpOwoJCQkJCWZha2VFdmVudC5jdXJyZW50VGFyZ2V0ID0gdGFyZ2V0WzBdOwoJCQkJCXRoaXMuY2xvc2UoIGZha2VFdmVudCwgdHJ1ZSApOwoJCQkJfQoJCQl9CgkJfTsKCgkJLy8gT25seSBiaW5kIHJlbW92ZSBoYW5kbGVyIGZvciBkZWxlZ2F0ZWQgdGFyZ2V0cy4gTm9uLWRlbGVnYXRlZAoJCS8vIHRvb2x0aXBzIHdpbGwgaGFuZGxlIHRoaXMgaW4gZGVzdHJveS4KCQlpZiAoIHRhcmdldFsgMCBdICE9PSB0aGlzLmVsZW1lbnRbIDAgXSApIHsKCQkJZXZlbnRzLnJlbW92ZSA9IGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5fcmVtb3ZlVG9vbHRpcCggdG9vbHRpcCApOwoJCQl9OwoJCX0KCgkJaWYgKCAhZXZlbnQgfHwgZXZlbnQudHlwZSA9PT0gIm1vdXNlb3ZlciIgKSB7CgkJCWV2ZW50cy5tb3VzZWxlYXZlID0gImNsb3NlIjsKCQl9CgkJaWYgKCAhZXZlbnQgfHwgZXZlbnQudHlwZSA9PT0gImZvY3VzaW4iICkgewoJCQlldmVudHMuZm9jdXNvdXQgPSAiY2xvc2UiOwoJCX0KCQl0aGlzLl9vbiggdHJ1ZSwgdGFyZ2V0LCBldmVudHMgKTsKCX0sCgoJY2xvc2U6IGZ1bmN0aW9uKCBldmVudCApIHsKCQl2YXIgdGhhdCA9IHRoaXMsCgkJCXRhcmdldCA9ICQoIGV2ZW50ID8gZXZlbnQuY3VycmVudFRhcmdldCA6IHRoaXMuZWxlbWVudCApLAoJCQl0b29sdGlwID0gdGhpcy5fZmluZCggdGFyZ2V0ICk7CgoJCS8vIGRpc2FibGluZyBjbG9zZXMgdGhlIHRvb2x0aXAsIHNvIHdlIG5lZWQgdG8gdHJhY2sgd2hlbiB3ZSdyZSBjbG9zaW5nCgkJLy8gdG8gYXZvaWQgYW4gaW5maW5pdGUgbG9vcCBpbiBjYXNlIHRoZSB0b29sdGlwIGJlY29tZXMgZGlzYWJsZWQgb24gY2xvc2UKCQlpZiAoIHRoaXMuY2xvc2luZyApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gQ2xlYXIgdGhlIGludGVydmFsIGZvciBkZWxheWVkIHRyYWNraW5nIHRvb2x0aXBzCgkJY2xlYXJJbnRlcnZhbCggdGhpcy5kZWxheWVkU2hvdyApOwoKCQkvLyBvbmx5IHNldCB0aXRsZSBpZiB3ZSBoYWQgb25lIGJlZm9yZSAoc2VlIGNvbW1lbnQgaW4gX29wZW4oKSkKCQkvLyBJZiB0aGUgdGl0bGUgYXR0cmlidXRlIGhhcyBjaGFuZ2VkIHNpbmNlIG9wZW4oKSwgZG9uJ3QgcmVzdG9yZQoJCWlmICggdGFyZ2V0LmRhdGEoICJ1aS10b29sdGlwLXRpdGxlIiApICYmICF0YXJnZXQuYXR0ciggInRpdGxlIiApICkgewoJCQl0YXJnZXQuYXR0ciggInRpdGxlIiwgdGFyZ2V0LmRhdGEoICJ1aS10b29sdGlwLXRpdGxlIiApICk7CgkJfQoKCQl0aGlzLl9yZW1vdmVEZXNjcmliZWRCeSggdGFyZ2V0ICk7CgoJCXRoaXMuaGlkaW5nID0gdHJ1ZTsKCQl0b29sdGlwLnN0b3AoIHRydWUgKTsKCQl0aGlzLl9oaWRlKCB0b29sdGlwLCB0aGlzLm9wdGlvbnMuaGlkZSwgZnVuY3Rpb24oKSB7CgkJCXRoYXQuX3JlbW92ZVRvb2x0aXAoICQoIHRoaXMgKSApOwoJCQl0aGlzLmhpZGluZyA9IGZhbHNlOwoJCQl0aGlzLmNsb3NpbmcgPSBmYWxzZTsKCQl9KTsKCgkJdGFyZ2V0LnJlbW92ZURhdGEoICJ1aS10b29sdGlwLW9wZW4iICk7CgkJdGhpcy5fb2ZmKCB0YXJnZXQsICJtb3VzZWxlYXZlIGZvY3Vzb3V0IGtleXVwIiApOwoKCQkvLyBSZW1vdmUgJ3JlbW92ZScgYmluZGluZyBvbmx5IG9uIGRlbGVnYXRlZCB0YXJnZXRzCgkJaWYgKCB0YXJnZXRbIDAgXSAhPT0gdGhpcy5lbGVtZW50WyAwIF0gKSB7CgkJCXRoaXMuX29mZiggdGFyZ2V0LCAicmVtb3ZlIiApOwoJCX0KCQl0aGlzLl9vZmYoIHRoaXMuZG9jdW1lbnQsICJtb3VzZW1vdmUiICk7CgoJCWlmICggZXZlbnQgJiYgZXZlbnQudHlwZSA9PT0gIm1vdXNlbGVhdmUiICkgewoJCQkkLmVhY2goIHRoaXMucGFyZW50cywgZnVuY3Rpb24oIGlkLCBwYXJlbnQgKSB7CgkJCQkkKCBwYXJlbnQuZWxlbWVudCApLmF0dHIoICJ0aXRsZSIsIHBhcmVudC50aXRsZSApOwoJCQkJZGVsZXRlIHRoYXQucGFyZW50c1sgaWQgXTsKCQkJfSk7CgkJfQoKCQl0aGlzLmNsb3NpbmcgPSB0cnVlOwoJCXRoaXMuX3RyaWdnZXIoICJjbG9zZSIsIGV2ZW50LCB7IHRvb2x0aXA6IHRvb2x0aXAgfSApOwoJCWlmICggIXRoaXMuaGlkaW5nICkgewoJCQl0aGlzLmNsb3NpbmcgPSBmYWxzZTsKCQl9Cgl9LAoKCV90b29sdGlwOiBmdW5jdGlvbiggZWxlbWVudCApIHsKCQl2YXIgdG9vbHRpcCA9ICQoICI8ZGl2PiIgKQoJCQkJLmF0dHIoICJyb2xlIiwgInRvb2x0aXAiICkKCQkJCS5hZGRDbGFzcyggInVpLXRvb2x0aXAgdWktd2lkZ2V0IHVpLWNvcm5lci1hbGwgdWktd2lkZ2V0LWNvbnRlbnQgIiArCgkJCQkJKCB0aGlzLm9wdGlvbnMudG9vbHRpcENsYXNzIHx8ICIiICkgKSwKCQkJaWQgPSB0b29sdGlwLnVuaXF1ZUlkKCkuYXR0ciggImlkIiApOwoKCQkkKCAiPGRpdj4iICkKCQkJLmFkZENsYXNzKCAidWktdG9vbHRpcC1jb250ZW50IiApCgkJCS5hcHBlbmRUbyggdG9vbHRpcCApOwoKCQl0b29sdGlwLmFwcGVuZFRvKCB0aGlzLmRvY3VtZW50WzBdLmJvZHkgKTsKCQl0aGlzLnRvb2x0aXBzWyBpZCBdID0gZWxlbWVudDsKCQlyZXR1cm4gdG9vbHRpcDsKCX0sCgoJX2ZpbmQ6IGZ1bmN0aW9uKCB0YXJnZXQgKSB7CgkJdmFyIGlkID0gdGFyZ2V0LmRhdGEoICJ1aS10b29sdGlwLWlkIiApOwoJCXJldHVybiBpZCA/ICQoICIjIiArIGlkICkgOiAkKCk7Cgl9LAoKCV9yZW1vdmVUb29sdGlwOiBmdW5jdGlvbiggdG9vbHRpcCApIHsKCQl0b29sdGlwLnJlbW92ZSgpOwoJCWRlbGV0ZSB0aGlzLnRvb2x0aXBzWyB0b29sdGlwLmF0dHIoICJpZCIgKSBdOwoJfSwKCglfZGVzdHJveTogZnVuY3Rpb24oKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoKCQkvLyBjbG9zZSBvcGVuIHRvb2x0aXBzCgkJJC5lYWNoKCB0aGlzLnRvb2x0aXBzLCBmdW5jdGlvbiggaWQsIGVsZW1lbnQgKSB7CgkJCS8vIERlbGVnYXRlIHRvIGNsb3NlIG1ldGhvZCB0byBoYW5kbGUgY29tbW9uIGNsZWFudXAKCQkJdmFyIGV2ZW50ID0gJC5FdmVudCggImJsdXIiICk7CgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQgPSBlbGVtZW50WzBdOwoJCQl0aGF0LmNsb3NlKCBldmVudCwgdHJ1ZSApOwoKCQkJLy8gUmVtb3ZlIGltbWVkaWF0ZWx5OyBkZXN0cm95aW5nIGFuIG9wZW4gdG9vbHRpcCBkb2Vzbid0IHVzZSB0aGUKCQkJLy8gaGlkZSBhbmltYXRpb24KCQkJJCggIiMiICsgaWQgKS5yZW1vdmUoKTsKCgkJCS8vIFJlc3RvcmUgdGhlIHRpdGxlCgkJCWlmICggZWxlbWVudC5kYXRhKCAidWktdG9vbHRpcC10aXRsZSIgKSApIHsKCQkJCS8vIElmIHRoZSB0aXRsZSBhdHRyaWJ1dGUgaGFzIGNoYW5nZWQgc2luY2Ugb3BlbigpLCBkb24ndCByZXN0b3JlCgkJCQlpZiAoICFlbGVtZW50LmF0dHIoICJ0aXRsZSIgKSApIHsKCQkJCQllbGVtZW50LmF0dHIoICJ0aXRsZSIsIGVsZW1lbnQuZGF0YSggInVpLXRvb2x0aXAtdGl0bGUiICkgKTsKCQkJCX0KCQkJCWVsZW1lbnQucmVtb3ZlRGF0YSggInVpLXRvb2x0aXAtdGl0bGUiICk7CgkJCX0KCQl9KTsKCQl0aGlzLmxpdmVSZWdpb24ucmVtb3ZlKCk7Cgl9Cn0pOwoKCgp9KSk7",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 315,
          "bodySize": 619204
        },
        "cache": {},
        "timings": {
          "send": 72,
          "wait": 0,
          "receive": 84
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8632"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.616-07:00",
        "time": 80,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/jquery/jquery-ui-extension.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 350,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "951"
            }
          ],
          "content": {
            "size": 2828,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "LyoqDQogKiBPdmVycmlkZSBzZWxlY3RhYmxlKCkgdG8gZXh0ZW5kIGZ1bmN0aW9uYWxpdHkgZm9yIHNoaWZ0IHNlbGVjdGlvbnMgYW5kIHNjcm9sbGJhciBkZXRlY3Rpb24uDQogKi8NCihmdW5jdGlvbigkKXsgDQoJLy8gVG8gb3ZlcnJpZGUgd2lkZ2V0IGp1c3QgZ2l2ZSBoaW0gdGhlIHNhbWUgbmFtZQ0KCSQud2lkZ2V0KCJzaGlmdC5zZWxlY3RhYmxlIiwgJC51aS5zZWxlY3RhYmxlLCB7DQoJICAgIG9wdGlvbnM6IHt9LCAvLyByZXF1aXJlZA0KCSAgICBwcmV2aW91c0luZGV4OiAtMSwgLy8gYWRkaXRpb25hbCBhdHRyaWJ1dGUgdG8gc3RvcmUgcHJldmlvdXMgc2VsZWN0aW9uIGluZGV4DQoJICAgIGN1cnJlbnRJbmRleDogLTEsIC8vIGFkZGl0aW9uYWwgYXR0cmlidXRlIHRvIHN0b3JlIGN1cnJlbnQgc2VsZWN0aW9uIGluZGV4DQoJICAgIHNjcm9sbGluZzogZmFsc2UsDQoJICAgIF9jcmVhdGU6IGZ1bmN0aW9uKCkgeyAvLyByZXF1aXJlZA0KCSAgICAgICAgdmFyIHNlbGYgPSB0aGlzOw0KCQ0KCSAgICAgICAgJC51aS5zZWxlY3RhYmxlLnByb3RvdHlwZS5fY3JlYXRlLmNhbGwodGhpcyk7IC8vIGRlZmF1bHQgaW1wbGVtZW50YXRpb24NCgkNCgkgICAgICAgIC8vIGhlcmUgd2UgYXJlIGNhdGNoaW5nICJzZWxlY3RpbmciIGV2ZW50IHdpdGggc2hpZnQga2V5DQoJICAgICAgICAkKHRoaXMuZWxlbWVudCkub24oJ3NlbGVjdGFibGVzZWxlY3RpbmcnLCBmdW5jdGlvbihldmVudCwgdWkpew0KCSAgICAgICAgICAgIHNlbGYuY3VycmVudEluZGV4ID0gJCh1aS5zZWxlY3RpbmcudGFnTmFtZSwgZXZlbnQudGFyZ2V0KS5pbmRleCh1aS5zZWxlY3RpbmcpOw0KCSAgICAgICAgICAgIGlmKGV2ZW50LnNoaWZ0S2V5ICYmIHNlbGYucHJldmlvdXNJbmRleCA+IC0xKSB7DQoJICAgICAgICAgICAgICAgICQodWkuc2VsZWN0aW5nLnRhZ05hbWUsIGV2ZW50LnRhcmdldCkuc2xpY2UoTWF0aC5taW4oc2VsZi5wcmV2aW91c0luZGV4LCBzZWxmLmN1cnJlbnRJbmRleCksIDEgKyBNYXRoLm1heChzZWxmLnByZXZpb3VzSW5kZXgsIHNlbGYuY3VycmVudEluZGV4KSkuYWRkQ2xhc3MoJ3VpLXNlbGVjdGVkJyk7DQoJICAgICAgICAgICAgfSBlbHNlIHsNCgkgICAgICAgICAgICAgICAgc2VsZi5wcmV2aW91c0luZGV4ID0gc2VsZi5jdXJyZW50SW5kZXg7DQoJICAgICAgICAgICAgfQ0KCSAgICAgICAgfSk7DQoJICAgIH0sDQoJICAgIF9tb3VzZVN0YXJ0OiBmdW5jdGlvbihldmVudCkgew0KCSAgICAJLy8gZGV0ZWN0IHNjcm9sbCBiYXJzLiBTaG9ydC1jaXJjdWl0IGlmIGNsaWNrZWQgd2l0aGluIHNjcm9sbGJhcg0KCSAgICAJaWYgKGV2ZW50LnBhZ2VYID4gJChldmVudC50YXJnZXQpWzBdLmNsaWVudFdpZHRoICsgJChldmVudC50YXJnZXQpLm9mZnNldCgpLmxlZnQpIHsNCgkgICAgCQlzY3JvbGxpbmcgPSB0cnVlOw0KCSAgICAJCXJldHVybjsNCgkgICAgCX0NCiAgICAJCXNjcm9sbGluZyA9IGZhbHNlOw0KCSAgICAgICAgJC51aS5zZWxlY3RhYmxlLnByb3RvdHlwZS5fbW91c2VTdGFydC5jYWxsKHRoaXMsIGV2ZW50KTsgLy8gZGVmYXVsdCBpbXBsZW1lbnRhdGlvbg0KCSAgICB9LA0KCSAgICBfbW91c2VEcmFnOiBmdW5jdGlvbihldmVudCkgew0KCSAgICAJLy8gZG9uJ3Qgd29ycnkgYWJvdXQgbW91c2UgZHJhZyBldmVudHMgd2hlbiBzY3JvbGxpbmcNCgkgICAgCWlmIChzY3JvbGxpbmcpIHsNCgkgICAgCQlyZXR1cm47DQoJICAgIAl9DQoJICAgICAgICAkLnVpLnNlbGVjdGFibGUucHJvdG90eXBlLl9tb3VzZURyYWcuY2FsbCh0aGlzLCBldmVudCk7IC8vIGRlZmF1bHQgaW1wbGVtZW50YXRpb24NCgkgICAgfSwNCgkgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7IC8vIHJlcXVpcmVkLCBkZWZhdWx0IGltcGxlbWVudGF0aW9uDQoJICAgICAgICAkLnVpLnNlbGVjdGFibGUucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKTsNCgkgICAgfSwNCgkgICAgX3NldE9wdGlvbjogZnVuY3Rpb24oKSB7IC8vIHJlcXVpcmVkLCBkZWZhdWx0IGltcGxlbWVudGF0aW9uDQoJICAgICAgICAkLnVpLnNlbGVjdGFibGUucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgkgICAgfQ0KCX0pOw0KfSkoalF1ZXJ5KTs=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 308,
          "bodySize": 2828
        },
        "cache": {},
        "timings": {
          "send": 24,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8631"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.616-07:00",
        "time": 82,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/jquery/jquery-ui.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 341,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "10998"
            }
          ],
          "content": {
            "size": 36415,
            "compression": 0,
            "mimeType": "text/css",
            "text": "/*! jQuery UI - v1.11.1 - 2014-08-13\n* http://jqueryui.com\n* Includes: core.css, accordion.css, autocomplete.css, button.css, datepicker.css, dialog.css, draggable.css, menu.css, progressbar.css, resizable.css, selectable.css, selectmenu.css, slider.css, sortable.css, spinner.css, tabs.css, tooltip.css, theme.css\n* To view and modify this theme, visit http://jqueryui.com/themeroller/?ffDefault=Trebuchet%20MS%2CTahoma%2CVerdana%2CArial%2Csans-serif&fwDefault=bold&fsDefault=1.1em&cornerRadius=4px&bgColorHeader=f6a828&bgTextureHeader=gloss_wave&bgImgOpacityHeader=35&borderColorHeader=e78f08&fcHeader=ffffff&iconColorHeader=ffffff&bgColorContent=eeeeee&bgTextureContent=highlight_soft&bgImgOpacityContent=100&borderColorContent=dddddd&fcContent=333333&iconColorContent=222222&bgColorDefault=f6f6f6&bgTextureDefault=glass&bgImgOpacityDefault=100&borderColorDefault=cccccc&fcDefault=1c94c4&iconColorDefault=ef8c08&bgColorHover=fdf5ce&bgTextureHover=glass&bgImgOpacityHover=100&borderColorHover=fbcb09&fcHover=c77405&iconColorHover=ef8c08&bgColorActive=ffffff&bgTextureActive=glass&bgImgOpacityActive=65&borderColorActive=fbd850&fcActive=eb8f00&iconColorActive=ef8c08&bgColorHighlight=ffe45c&bgTextureHighlight=highlight_soft&bgImgOpacityHighlight=75&borderColorHighlight=fed22f&fcHighlight=363636&iconColorHighlight=228ef1&bgColorError=b81900&bgTextureError=diagonals_thick&bgImgOpacityError=18&borderColorError=cd0a0a&fcError=ffffff&iconColorError=ffd27a&bgColorOverlay=666666&bgTextureOverlay=diagonals_thick&bgImgOpacityOverlay=20&opacityOverlay=50&bgColorShadow=000000&bgTextureShadow=flat&bgImgOpacityShadow=10&opacityShadow=20&thicknessShadow=5px&offsetTopShadow=-5px&offsetLeftShadow=-5px&cornerRadiusShadow=5px\n* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */\n\n/* Layout helpers\n----------------------------------*/\n.ui-helper-hidden {\n\tdisplay: none;\n}\n.ui-helper-hidden-accessible {\n\tborder: 0;\n\tclip: rect(0 0 0 0);\n\theight: 1px;\n\tmargin: -1px;\n\toverflow: hidden;\n\tpadding: 0;\n\tposition: absolute;\n\twidth: 1px;\n}\n.ui-helper-reset {\n\tmargin: 0;\n\tpadding: 0;\n\tborder: 0;\n\toutline: 0;\n\tline-height: 1.3;\n\ttext-decoration: none;\n\tfont-size: 100%;\n\tlist-style: none;\n}\n.ui-helper-clearfix:before,\n.ui-helper-clearfix:after {\n\tcontent: \"\";\n\tdisplay: table;\n\tborder-collapse: collapse;\n}\n.ui-helper-clearfix:after {\n\tclear: both;\n}\n.ui-helper-clearfix {\n\tmin-height: 0; /* support: IE7 */\n}\n.ui-helper-zfix {\n\twidth: 100%;\n\theight: 100%;\n\ttop: 0;\n\tleft: 0;\n\tposition: absolute;\n\topacity: 0;\n\tfilter:Alpha(Opacity=0); /* support: IE8 */\n}\n\n.ui-front {\n\tz-index: 100;\n}\n\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-disabled {\n\tcursor: default !important;\n}\n\n\n/* Icons\n----------------------------------*/\n\n/* states and images */\n.ui-icon {\n\tdisplay: block;\n\ttext-indent: -99999px;\n\toverflow: hidden;\n\tbackground-repeat: no-repeat;\n}\n\n\n/* Misc visuals\n----------------------------------*/\n\n/* Overlays */\n.ui-widget-overlay {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n.ui-accordion .ui-accordion-header {\n\tdisplay: block;\n\tcursor: pointer;\n\tposition: relative;\n\tmargin: 2px 0 0 0;\n\tpadding: .5em .5em .5em .7em;\n\tmin-height: 0; /* support: IE7 */\n\tfont-size: 9pt;\n\tcolor: black;\n}\n.ui-accordion .ui-accordion-icons {\n\tpadding-left: 2.2em;\n}\n.ui-accordion .ui-accordion-icons .ui-accordion-icons {\n\tpadding-left: 2.2em;\n}\n.ui-accordion .ui-accordion-header .ui-accordion-header-icon {\n\tposition: absolute;\n\tleft: .5em;\n\ttop: 50%;\n\tmargin-top: -8px;\n}\n.ui-accordion .ui-accordion-content {\n\tpadding: 1em 2.2em;\n\tborder-top: 0;\n\toverflow: auto;\n}\n.ui-accordion-header.ui-state-default.ui-accordion-icons.ui-corner-all {\n\tborder: none;\n}\n.ui-accordion-header-icon.ui-icon.ui-icon-triangle-1-e,\n.ui-accordion-header-icon.ui-icon.ui-icon-triangle-1-s {\n\tbackground-position: inherit;\n}\n.ui-accordion-header.ui-state-default {\n\tborder: none;\n}\n.ui-autocomplete {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tcursor: default;\n}\n.ui-button {\n\tdisplay: inline-block;\n\tposition: relative;\n\tpadding: 0;\n\tline-height: normal;\n\tmargin-right: .1em;\n\tcursor: pointer;\n\tvertical-align: middle;\n\ttext-align: center;\n\toverflow: visible; /* removes extra width in IE */\n}\n.ui-button,\n.ui-button:link,\n.ui-button:visited,\n.ui-button:hover,\n.ui-button:active {\n\ttext-decoration: none;\n}\n/* to make room for the icon, a width needs to be set here */\n.ui-button-icon-only {\n\twidth: 2.2em;\n}\n/* button elements seem to need a little more width */\nbutton.ui-button-icon-only {\n\twidth: 2.4em;\n}\n.ui-button-icons-only {\n\twidth: 3.4em;\n}\nbutton.ui-button-icons-only {\n\twidth: 3.7em;\n}\n\n/* button text element */\n.ui-button .ui-button-text {\n\tdisplay: block;\n\tline-height: normal;\n}\n.ui-button-text-only .ui-button-text {\n\tpadding: 0px;\n}\n.ui-button-icon-only .ui-button-text,\n.ui-button-icons-only .ui-button-text {\n\tpadding: .4em;\n\ttext-indent: -9999999px;\n}\n.ui-button-text-icon-primary .ui-button-text,\n.ui-button-text-icons .ui-button-text {\n\tpadding: .4em 1em .4em 2.1em;\n}\n.ui-button-text-icon-secondary .ui-button-text,\n.ui-button-text-icons .ui-button-text {\n\tpadding: .4em 2.1em .4em 1em;\n}\n.ui-button-text-icons .ui-button-text {\n\tpadding-left: 2.1em;\n\tpadding-right: 2.1em;\n}\n/* no icon support for input elements, provide padding by default */\ninput.ui-button {\n\tpadding: .4em 1em;\n}\n\n/* button icon element(s) */\n.ui-button-icon-only .ui-icon,\n.ui-button-text-icon-primary .ui-icon,\n.ui-button-text-icon-secondary .ui-icon,\n.ui-button-text-icons .ui-icon,\n.ui-button-icons-only .ui-icon {\n\tposition: absolute;\n\ttop: 50%;\n\tmargin-top: -8px;\n}\n.ui-button-icon-only .ui-icon {\n\tleft: 50%;\n\tmargin-left: -8px;\n}\n.ui-button-text-icon-primary .ui-button-icon-primary,\n.ui-button-text-icons .ui-button-icon-primary,\n.ui-button-icons-only .ui-button-icon-primary {\n\tleft: .5em;\n}\n.ui-button-text-icon-secondary .ui-button-icon-secondary,\n.ui-button-text-icons .ui-button-icon-secondary,\n.ui-button-icons-only .ui-button-icon-secondary {\n\tright: .5em;\n}\n\n/* button sets */\n.ui-buttonset {\n\tmargin-right: 7px;\n}\n.ui-buttonset .ui-button {\n\tmargin-left: 0;\n\tmargin-right: -.3em;\n}\n\n/* workarounds */\n/* reset extra padding in Firefox, see h5bp.com/l */\ninput.ui-button::-moz-focus-inner,\nbutton.ui-button::-moz-focus-inner {\n\tborder: 0;\n\tpadding: 0;\n}\n.ui-datepicker {\n\twidth: 17em;\n\tpadding: .2em .2em 0;\n\tdisplay: none;\n}\n.ui-datepicker .ui-datepicker-header {\n\tposition: relative;\n\tpadding: .2em 0;\n}\n.ui-datepicker .ui-datepicker-prev,\n.ui-datepicker .ui-datepicker-next {\n\tposition: absolute;\n\ttop: 2px;\n\twidth: 1.8em;\n\theight: 1.8em;\n}\n.ui-datepicker .ui-datepicker-prev-hover,\n.ui-datepicker .ui-datepicker-next-hover {\n\ttop: 1px;\n}\n.ui-datepicker .ui-datepicker-prev {\n\tleft: 2px;\n}\n.ui-datepicker .ui-datepicker-next {\n\tright: 2px;\n}\n.ui-datepicker .ui-datepicker-prev-hover {\n\tleft: 1px;\n}\n.ui-datepicker .ui-datepicker-next-hover {\n\tright: 1px;\n}\n.ui-datepicker .ui-datepicker-prev span,\n.ui-datepicker .ui-datepicker-next span {\n\tdisplay: block;\n\tposition: absolute;\n\tleft: 50%;\n\tmargin-left: -8px;\n\ttop: 50%;\n\tmargin-top: -8px;\n}\n.ui-datepicker .ui-datepicker-title {\n\tmargin: 0 2.3em;\n\tline-height: 1.8em;\n\ttext-align: center;\n}\n.ui-datepicker .ui-datepicker-title select {\n\tfont-size: 1em;\n\tmargin: 1px 0;\n}\n.ui-datepicker select.ui-datepicker-month,\n.ui-datepicker select.ui-datepicker-year {\n\twidth: 45%;\n}\n.ui-datepicker table {\n\twidth: 100%;\n\tfont-size: .9em;\n\tborder-collapse: collapse;\n\tmargin: 0 0 .4em;\n}\n.ui-datepicker th {\n\tpadding: .7em .3em;\n\ttext-align: center;\n\tfont-weight: bold;\n\tborder: 0;\n}\n.ui-datepicker td {\n\tborder: 0;\n\tpadding: 1px;\n}\n.ui-datepicker td span,\n.ui-datepicker td a {\n\tdisplay: block;\n\tpadding: .2em;\n\ttext-align: right;\n\ttext-decoration: none;\n}\n.ui-datepicker .ui-datepicker-buttonpane {\n\tbackground-image: none;\n\tmargin: .7em 0 0 0;\n\tpadding: 0 .2em;\n\tborder-left: 0;\n\tborder-right: 0;\n\tborder-bottom: 0;\n}\n.ui-datepicker .ui-datepicker-buttonpane button {\n\tfloat: right;\n\tmargin: .5em .2em .4em;\n\tcursor: pointer;\n\tpadding: .2em .6em .3em .6em;\n\twidth: auto;\n\toverflow: visible;\n}\n.ui-datepicker .ui-datepicker-buttonpane button.ui-datepicker-current {\n\tfloat: left;\n}\n\n/* with multiple calendars */\n.ui-datepicker.ui-datepicker-multi {\n\twidth: auto;\n}\n.ui-datepicker-multi .ui-datepicker-group {\n\tfloat: left;\n}\n.ui-datepicker-multi .ui-datepicker-group table {\n\twidth: 95%;\n\tmargin: 0 auto .4em;\n}\n.ui-datepicker-multi-2 .ui-datepicker-group {\n\twidth: 50%;\n}\n.ui-datepicker-multi-3 .ui-datepicker-group {\n\twidth: 33.3%;\n}\n.ui-datepicker-multi-4 .ui-datepicker-group {\n\twidth: 25%;\n}\n.ui-datepicker-multi .ui-datepicker-group-last .ui-datepicker-header,\n.ui-datepicker-multi .ui-datepicker-group-middle .ui-datepicker-header {\n\tborder-left-width: 0;\n}\n.ui-datepicker-multi .ui-datepicker-buttonpane {\n\tclear: left;\n}\n.ui-datepicker-row-break {\n\tclear: both;\n\twidth: 100%;\n\tfont-size: 0;\n}\n\n/* RTL support */\n.ui-datepicker-rtl {\n\tdirection: rtl;\n}\n.ui-datepicker-rtl .ui-datepicker-prev {\n\tright: 2px;\n\tleft: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-next {\n\tleft: 2px;\n\tright: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-prev:hover {\n\tright: 1px;\n\tleft: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-next:hover {\n\tleft: 1px;\n\tright: auto;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane {\n\tclear: right;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane button {\n\tfloat: left;\n}\n.ui-datepicker-rtl .ui-datepicker-buttonpane button.ui-datepicker-current,\n.ui-datepicker-rtl .ui-datepicker-group {\n\tfloat: right;\n}\n.ui-datepicker-rtl .ui-datepicker-group-last .ui-datepicker-header,\n.ui-datepicker-rtl .ui-datepicker-group-middle .ui-datepicker-header {\n\tborder-right-width: 0;\n\tborder-left-width: 1px;\n}\n.ui-dialog {\n\toverflow: hidden;\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tpadding: .2em;\n\toutline: 0;\t\n\tbackground-color: #EDEDCF;\n\tborder-radius: 0px;\n\tpadding: 0px;\n\tborder: 1px solid #666666;\n\tborder-bottom: 2px solid #666666;\n\tborder-right: 2px solid #666666;\n}\n.ui-dialog .ui-dialog-titlebar {\n\tpadding: .4em 1em;\n\tposition: relative;\t\n\tbackground-color: #CCCC99;\n\tcolor: #000000;\n    font-family: verdana, arial, helvetica, sans-serif;\n    font-size: 10pt;\n    font-weight: bold;\n\tborder-radius: 0px;\n\tborder-top: none;\n\tborder-left: none;\n\tborder-right: none;\n\tborder-bottom: 1px solid #666666;\n}\n.ui-dialog .ui-dialog-title {\n\tfloat: left;\n\tmargin: .1em 0;\n\twhite-space: nowrap;\n\twidth: 90%;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n.ui-dialog .ui-dialog-titlebar-close {\n\tdisplay: none;\n}\n.ui-dialog .ui-dialog-content {\n\tposition: relative;\n\tborder: 0;\n\tpadding: .5em 1em;\n\tbackground-color: #EDEDCF;\n\toverflow: auto;\n\ttext-align: center;\n}\n.ui-dialog .ui-dialog-buttonpane {\n\ttext-align: left;\n\tborder-width: 1px 0 0 0;\n\tbackground-image: none;\n\tpadding: .3em 1em .5em .4em;\n\tbackground-color: #DCDCB2;\n}\n.ui-dialog .ui-dialog-buttonpane .ui-dialog-buttonset {\n\tfloat: right;\n}\n.ui-dialog .ui-dialog-buttonpane button {\n\tmargin: .5em .4em .5em 0;\n\tcursor: pointer;\n\tfont-family: verdana, arial, helvetica, sans-serif;\n\tfont-size: 8pt;\n\tcolor: #333333;\n\tbackground: none;\n\tbackground-color: buttonface;\n\tfont-weight: normal;\n\tborder-width: 2px;\n\tborder-style: outset;\n\tborder-color: buttonface;\n\tborder-radius: 0px;\n\tpadding: 1px 6px;\n}\n.ui-dialog .ui-dialog-buttonpane button[disabled] {\n\tcolor: graytext;\n\tcursor: default;\n}\n.ui-dialog .ui-resizable-se {\n\twidth: 12px;\n\theight: 12px;\n\tright: -5px;\n\tbottom: -5px;\n\tbackground-position: 16px 16px;\n}\n.ui-draggable .ui-dialog-titlebar {\n\tcursor: move;\n}\n.ui-dialog-no-radius {\n\tborder-radius: 0px;\n}\n.ui-draggable-handle {\n\t-ms-touch-action: none;\n\ttouch-action: none;\n}\n.ui-menu {\n\tlist-style: none;\n\tpadding: 0;\n\tmargin: 0;\n\tdisplay: block;\n\toutline: none;\n}\n.ui-menu .ui-menu {\n\tposition: absolute;\n}\n.ui-menu .ui-menu-item {\n\tposition: relative;\n\tmargin: 0;\n\tpadding: 3px 1em 3px .4em;\n\tcursor: pointer;\n\tmin-height: 0; /* support: IE7 */\n\t/* support: IE10, see #8844 */\n\tlist-style-image: url(\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\");\n}\n.ui-menu .ui-menu-divider {\n\tmargin: 5px 0;\n\theight: 0;\n\tfont-size: 0;\n\tline-height: 0;\n\tborder-width: 1px 0 0 0;\n}\n.ui-menu .ui-state-focus,\n.ui-menu .ui-state-active {\n\tmargin: -1px;\n}\n\n/* icon support */\n.ui-menu-icons {\n\tposition: relative;\n}\n.ui-menu-icons .ui-menu-item {\n\tpadding-left: 2em;\n}\n\n/* left-aligned */\n.ui-menu .ui-icon {\n\tposition: absolute;\n\ttop: 0;\n\tbottom: 0;\n\tleft: .2em;\n\tmargin: auto 0;\n}\n\n/* right-aligned */\n.ui-menu .ui-menu-icon {\n\tleft: auto;\n\tright: 0;\n}\n.ui-progressbar {\n\theight: 2em;\n\ttext-align: left;\n\toverflow: hidden;\n}\n.ui-progressbar .ui-progressbar-value {\n\tmargin: -1px;\n\theight: 100%;\n}\n.ui-progressbar .ui-progressbar-overlay {\n\tbackground: url(\"data:image/gif;base64,R0lGODlhKAAoAIABAAAAAP///yH/C05FVFNDQVBFMi4wAwEAAAAh+QQJAQABACwAAAAAKAAoAAACkYwNqXrdC52DS06a7MFZI+4FHBCKoDeWKXqymPqGqxvJrXZbMx7Ttc+w9XgU2FB3lOyQRWET2IFGiU9m1frDVpxZZc6bfHwv4c1YXP6k1Vdy292Fb6UkuvFtXpvWSzA+HycXJHUXiGYIiMg2R6W459gnWGfHNdjIqDWVqemH2ekpObkpOlppWUqZiqr6edqqWQAAIfkECQEAAQAsAAAAACgAKAAAApSMgZnGfaqcg1E2uuzDmmHUBR8Qil95hiPKqWn3aqtLsS18y7G1SzNeowWBENtQd+T1JktP05nzPTdJZlR6vUxNWWjV+vUWhWNkWFwxl9VpZRedYcflIOLafaa28XdsH/ynlcc1uPVDZxQIR0K25+cICCmoqCe5mGhZOfeYSUh5yJcJyrkZWWpaR8doJ2o4NYq62lAAACH5BAkBAAEALAAAAAAoACgAAAKVDI4Yy22ZnINRNqosw0Bv7i1gyHUkFj7oSaWlu3ovC8GxNso5fluz3qLVhBVeT/Lz7ZTHyxL5dDalQWPVOsQWtRnuwXaFTj9jVVh8pma9JjZ4zYSj5ZOyma7uuolffh+IR5aW97cHuBUXKGKXlKjn+DiHWMcYJah4N0lYCMlJOXipGRr5qdgoSTrqWSq6WFl2ypoaUAAAIfkECQEAAQAsAAAAACgAKAAAApaEb6HLgd/iO7FNWtcFWe+ufODGjRfoiJ2akShbueb0wtI50zm02pbvwfWEMWBQ1zKGlLIhskiEPm9R6vRXxV4ZzWT2yHOGpWMyorblKlNp8HmHEb/lCXjcW7bmtXP8Xt229OVWR1fod2eWqNfHuMjXCPkIGNileOiImVmCOEmoSfn3yXlJWmoHGhqp6ilYuWYpmTqKUgAAIfkECQEAAQAsAAAAACgAKAAAApiEH6kb58biQ3FNWtMFWW3eNVcojuFGfqnZqSebuS06w5V80/X02pKe8zFwP6EFWOT1lDFk8rGERh1TTNOocQ61Hm4Xm2VexUHpzjymViHrFbiELsefVrn6XKfnt2Q9G/+Xdie499XHd2g4h7ioOGhXGJboGAnXSBnoBwKYyfioubZJ2Hn0RuRZaflZOil56Zp6iioKSXpUAAAh+QQJAQABACwAAAAAKAAoAAACkoQRqRvnxuI7kU1a1UU5bd5tnSeOZXhmn5lWK3qNTWvRdQxP8qvaC+/yaYQzXO7BMvaUEmJRd3TsiMAgswmNYrSgZdYrTX6tSHGZO73ezuAw2uxuQ+BbeZfMxsexY35+/Qe4J1inV0g4x3WHuMhIl2jXOKT2Q+VU5fgoSUI52VfZyfkJGkha6jmY+aaYdirq+lQAACH5BAkBAAEALAAAAAAoACgAAAKWBIKpYe0L3YNKToqswUlvznigd4wiR4KhZrKt9Upqip61i9E3vMvxRdHlbEFiEXfk9YARYxOZZD6VQ2pUunBmtRXo1Lf8hMVVcNl8JafV38aM2/Fu5V16Bn63r6xt97j09+MXSFi4BniGFae3hzbH9+hYBzkpuUh5aZmHuanZOZgIuvbGiNeomCnaxxap2upaCZsq+1kAACH5BAkBAAEALAAAAAAoACgAAAKXjI8By5zf4kOxTVrXNVlv1X0d8IGZGKLnNpYtm8Lr9cqVeuOSvfOW79D9aDHizNhDJidFZhNydEahOaDH6nomtJjp1tutKoNWkvA6JqfRVLHU/QUfau9l2x7G54d1fl995xcIGAdXqMfBNadoYrhH+Mg2KBlpVpbluCiXmMnZ2Sh4GBqJ+ckIOqqJ6LmKSllZmsoq6wpQAAAh+QQJAQABACwAAAAAKAAoAAAClYx/oLvoxuJDkU1a1YUZbJ59nSd2ZXhWqbRa2/gF8Gu2DY3iqs7yrq+xBYEkYvFSM8aSSObE+ZgRl1BHFZNr7pRCavZ5BW2142hY3AN/zWtsmf12p9XxxFl2lpLn1rseztfXZjdIWIf2s5dItwjYKBgo9yg5pHgzJXTEeGlZuenpyPmpGQoKOWkYmSpaSnqKileI2FAAACH5BAkBAAEALAAAAAAoACgAAAKVjB+gu+jG4kORTVrVhRlsnn2dJ3ZleFaptFrb+CXmO9OozeL5VfP99HvAWhpiUdcwkpBH3825AwYdU8xTqlLGhtCosArKMpvfa1mMRae9VvWZfeB2XfPkeLmm18lUcBj+p5dnN8jXZ3YIGEhYuOUn45aoCDkp16hl5IjYJvjWKcnoGQpqyPlpOhr3aElaqrq56Bq7VAAAOw==\");\n\theight: 100%;\n\tfilter: alpha(opacity=25); /* support: IE8 */\n\topacity: 0.25;\n}\n.ui-progressbar-indeterminate .ui-progressbar-value {\n\tbackground-image: none;\n}\n.ui-resizable {\n\tposition: relative;\n}\n.ui-resizable-handle {\n\tposition: absolute;\n\tfont-size: 0.1px;\n\tdisplay: block;\n\t-ms-touch-action: none;\n\ttouch-action: none;\n}\n.ui-resizable-disabled .ui-resizable-handle,\n.ui-resizable-autohide .ui-resizable-handle {\n\tdisplay: none;\n}\n.ui-resizable-n {\n\tcursor: n-resize;\n\theight: 7px;\n\twidth: 100%;\n\ttop: -5px;\n\tleft: 0;\n}\n.ui-resizable-s {\n\tcursor: s-resize;\n\theight: 7px;\n\twidth: 100%;\n\tbottom: -5px;\n\tleft: 0;\n}\n.ui-resizable-e {\n\tcursor: e-resize;\n\twidth: 7px;\n\tright: -5px;\n\ttop: 0;\n\theight: 100%;\n}\n.ui-resizable-w {\n\tcursor: w-resize;\n\twidth: 7px;\n\tleft: -5px;\n\ttop: 0;\n\theight: 100%;\n}\n.ui-resizable-se {\n\tcursor: se-resize;\n\twidth: 12px;\n\theight: 12px;\n\tright: 1px;\n\tbottom: 1px;\n}\n.ui-resizable-sw {\n\tcursor: sw-resize;\n\twidth: 9px;\n\theight: 9px;\n\tleft: -5px;\n\tbottom: -5px;\n}\n.ui-resizable-nw {\n\tcursor: nw-resize;\n\twidth: 9px;\n\theight: 9px;\n\tleft: -5px;\n\ttop: -5px;\n}\n.ui-resizable-ne {\n\tcursor: ne-resize;\n\twidth: 9px;\n\theight: 9px;\n\tright: -5px;\n\ttop: -5px;\n}\n.ui-selectable {\n\t-ms-touch-action: none;\n\ttouch-action: none;\n}\n.ui-selectable-helper {\n\tposition: absolute;\n\tz-index: 100;\n\tborder: 1px dotted black;\n}\n.ui-selectmenu-menu {\n\tpadding: 0;\n\tmargin: 0;\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tdisplay: none;\n}\n.ui-selectmenu-menu .ui-menu {\n\toverflow: auto;\n\t/* Support: IE7 */\n\toverflow-x: hidden;\n\tpadding-bottom: 1px;\n}\n.ui-selectmenu-menu .ui-menu .ui-selectmenu-optgroup {\n\tfont-size: 1em;\n\tfont-weight: bold;\n\tline-height: 1.5;\n\tpadding: 2px 0.4em;\n\tmargin: 0.5em 0 0 0;\n\theight: auto;\n\tborder: 0;\n}\n.ui-selectmenu-open {\n\tdisplay: block;\n}\n.ui-selectmenu-button {\n\tdisplay: inline-block;\n\toverflow: hidden;\n\tposition: relative;\n\ttext-decoration: none;\n\tcursor: pointer;\n}\n.ui-selectmenu-button span.ui-icon {\n\tright: 0.5em;\n\tleft: auto;\n\tmargin-top: -8px;\n\tposition: absolute;\n\ttop: 50%;\n}\n.ui-selectmenu-button span.ui-selectmenu-text {\n\ttext-align: left;\n\tpadding: 0.4em 2.1em 0.4em 1em;\n\tdisplay: block;\n\tline-height: 1.4;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n.ui-slider {\n\tposition: relative;\n\ttext-align: left;\n}\n.ui-slider .ui-slider-handle {\n\tposition: absolute;\n\tz-index: 2;\n\twidth: 1.2em;\n\theight: 1.2em;\n\tcursor: default;\n\t-ms-touch-action: none;\n\ttouch-action: none;\n}\n.ui-slider .ui-slider-range {\n\tposition: absolute;\n\tz-index: 1;\n\tfont-size: .7em;\n\tdisplay: block;\n\tborder: 0;\n\tbackground-position: 0 0;\n}\n\n/* support: IE8 - See #6727 */\n.ui-slider.ui-state-disabled .ui-slider-handle,\n.ui-slider.ui-state-disabled .ui-slider-range {\n\tfilter: inherit;\n}\n\n.ui-slider-horizontal {\n\theight: .8em;\n}\n.ui-slider-horizontal .ui-slider-handle {\n\ttop: -.3em;\n\tmargin-left: -.6em;\n}\n.ui-slider-horizontal .ui-slider-range {\n\ttop: 0;\n\theight: 100%;\n}\n.ui-slider-horizontal .ui-slider-range-min {\n\tleft: 0;\n}\n.ui-slider-horizontal .ui-slider-range-max {\n\tright: 0;\n}\n\n.ui-slider-vertical {\n\twidth: .8em;\n\theight: 100px;\n}\n.ui-slider-vertical .ui-slider-handle {\n\tleft: -.3em;\n\tmargin-left: 0;\n\tmargin-bottom: -.6em;\n}\n.ui-slider-vertical .ui-slider-range {\n\tleft: 0;\n\twidth: 100%;\n}\n.ui-slider-vertical .ui-slider-range-min {\n\tbottom: 0;\n}\n.ui-slider-vertical .ui-slider-range-max {\n\ttop: 0;\n}\n.ui-sortable-handle {\n\t-ms-touch-action: none;\n\ttouch-action: none;\n}\n.ui-spinner {\n\tposition: relative;\n\tdisplay: inline-block;\n\toverflow: hidden;\n\tpadding: 0;\n\tvertical-align: middle;\n}\n.ui-spinner-input {\n\tborder: none;\n\tbackground: none;\n\tcolor: inherit;\n\tpadding: 0;\n\tmargin: .2em 0;\n\tvertical-align: middle;\n\tmargin-left: .4em;\n\tmargin-right: 22px;\n}\n.ui-spinner-button {\n\twidth: 16px;\n\theight: 50%;\n\tfont-size: .5em;\n\tpadding: 0;\n\tmargin: 0;\n\ttext-align: center;\n\tposition: absolute;\n\tcursor: default;\n\tdisplay: block;\n\toverflow: hidden;\n\tright: 0;\n}\n/* more specificity required here to override default borders */\n.ui-spinner a.ui-spinner-button {\n\tborder-top: none;\n\tborder-bottom: none;\n\tborder-right: none;\n}\n/* vertically center icon */\n.ui-spinner .ui-icon {\n\tposition: absolute;\n\tmargin-top: -8px;\n\ttop: 50%;\n\tleft: 0;\n}\n.ui-spinner-up {\n\ttop: 0;\n}\n.ui-spinner-down {\n\tbottom: 0;\n}\n\n/* TR overrides */\n.ui-spinner .ui-icon-triangle-1-s {\n\t/* need to fix icons sprite */\n\tbackground-position: -65px -16px;\n}\n.ui-tabs {\n\tposition: relative;/* position: relative prevents IE scroll bug (element with position: relative inside container with overflow: auto appear as \"fixed\") */\n\tpadding: .2em;\n}\n.ui-tabs .ui-tabs-nav {\n\tmargin: 0;\n\tpadding: .2em .2em 0;\n}\n.ui-tabs .ui-tabs-nav li {\n\tlist-style: none;\n\tfloat: left;\n\tposition: relative;\n\ttop: 0;\n\tmargin: 1px .2em 0 0;\n\tborder-bottom-width: 0;\n\tpadding: 0;\n\twhite-space: nowrap;\n}\n.ui-tabs .ui-tabs-nav .ui-tabs-anchor {\n\tfloat: left;\n\tpadding: .5em 1em;\n\ttext-decoration: none;\n}\n.ui-tabs .ui-tabs-nav li.ui-tabs-active {\n\tmargin-bottom: -1px;\n\tpadding-bottom: 1px;\n}\n.ui-tabs .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor,\n.ui-tabs .ui-tabs-nav li.ui-state-disabled .ui-tabs-anchor,\n.ui-tabs .ui-tabs-nav li.ui-tabs-loading .ui-tabs-anchor {\n\tcursor: text;\n}\n.ui-tabs-collapsible .ui-tabs-nav li.ui-tabs-active .ui-tabs-anchor {\n\tcursor: pointer;\n}\n.ui-tabs .ui-tabs-panel {\n\tdisplay: block;\n\tborder-width: 0;\n\tpadding: 1em 1.4em;\n\tbackground: none;\n}\n.ui-tooltip {\n\tpadding: 8px;\n\tposition: absolute;\n\tz-index: 9999;\n\tmax-width: 300px;\n\t-webkit-box-shadow: 0 0 5px #aaa;\n\tbox-shadow: 0 0 5px #aaa;\n}\nbody .ui-tooltip {\n\tborder-width: 2px;\n}\n\n/* Component containers\n----------------------------------*/\n.ui-widget {\n\tfont-family: verdana,arial,helvetica,sans-serif;\n\tfont-size: 8pt;\n}\n.ui-widget .ui-widget {\n\tfont-size: 1em;\n}\n.ui-widget input,\n.ui-widget select,\n.ui-widget textarea,\n.ui-widget button {\n\tfont-family: Trebuchet MS,Tahoma,Verdana,Arial,sans-serif;\n\tfont-size: 1em;\n}\n.ui-widget-content {\n    background: #EDEDCF; /* OMNI standard */\n    /* border: 1px solid #dddddd; */\n    color: #666666;\n}\n/*\n.ui-widget-content a {\n\tcolor: #333333;\n}\n*/\n.ui-widget-header {\n\tborder: 1px solid #e78f08;\n\t/* background: #f6a828 url(\"images/ui-bg_gloss-wave_35_f6a828_500x100.png\") 50% 50% repeat-x; */\n\tcolor: #ffffff;\n\tfont-weight: bold;\n}\n.ui-widget-header a {\n\tcolor: #ffffff;\n}\n\n/* Interaction states\n----------------------------------*/\n.ui-state-default,\n.ui-widget-content .ui-state-default,\n.ui-widget-header .ui-state-default {\n\tborder: 1px solid #cccccc;\n\t/* background: #f6f6f6 url(\"images/ui-bg_glass_100_f6f6f6_1x400.png\") 50% 50% repeat-x; */\n\tfont-weight: bold;\n\tcolor: #1c94c4;\n}\n.ui-state-default a,\n.ui-state-default a:link,\n.ui-state-default a:visited {\n\tcolor: #1c94c4;\n\ttext-decoration: none;\n}\n.ui-state-hover,\n.ui-widget-content .ui-state-hover,\n.ui-widget-header .ui-state-hover,\n.ui-state-focus,\n.ui-widget-content .ui-state-focus,\n.ui-widget-header .ui-state-focus {\n\tborder: 1px solid #fbcb09;\n\t/* background: #fdf5ce url(\"images/ui-bg_glass_100_fdf5ce_1x400.png\") 50% 50% repeat-x; */\n\tfont-weight: bold;\n\tcolor: #c77405;\n}\n.ui-state-hover a,\n.ui-state-hover a:hover,\n.ui-state-hover a:link,\n.ui-state-hover a:visited,\n.ui-state-focus a,\n.ui-state-focus a:hover,\n.ui-state-focus a:link,\n.ui-state-focus a:visited {\n\tcolor: #c77405;\n\ttext-decoration: none;\n}\n.ui-state-active,\n.ui-widget-content .ui-state-active,\n.ui-widget-header .ui-state-active {\n\tborder: 1px solid #fbd850;\n\t/* background: #ffffff url(\"images/ui-bg_glass_65_ffffff_1x400.png\") 50% 50% repeat-x; */\n\tfont-weight: bold;\n\tcolor: #eb8f00;\n}\n.ui-state-active a,\n.ui-state-active a:link,\n.ui-state-active a:visited {\n\tcolor: #eb8f00;\n\ttext-decoration: none;\n}\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-highlight,\n.ui-widget-content .ui-state-highlight,\n.ui-widget-header .ui-state-highlight {\n\tborder: 1px solid #fed22f;\n\tbackground: #ffe45c url(\"images/ui-bg_highlight-soft_75_ffe45c_1x100.png\") 50% top repeat-x;\n\tcolor: #363636;\n}\n.ui-state-highlight a,\n.ui-widget-content .ui-state-highlight a,\n.ui-widget-header .ui-state-highlight a {\n\tcolor: #363636;\n}\n.ui-state-error,\n.ui-widget-content .ui-state-error,\n.ui-widget-header .ui-state-error {\n\tborder: 1px solid #cd0a0a;\n\tbackground: #b81900 url(\"images/ui-bg_diagonals-thick_18_b81900_40x40.png\") 50% 50% repeat;\n\tcolor: #ffffff;\n}\n.ui-state-error a,\n.ui-widget-content .ui-state-error a,\n.ui-widget-header .ui-state-error a {\n\tcolor: #ffffff;\n}\n.ui-state-error-text,\n.ui-widget-content .ui-state-error-text,\n.ui-widget-header .ui-state-error-text {\n\tcolor: #ffffff;\n}\n.ui-priority-primary,\n.ui-widget-content .ui-priority-primary,\n.ui-widget-header .ui-priority-primary {\n\tfont-weight: bold;\n}\n.ui-priority-secondary,\n.ui-widget-content .ui-priority-secondary,\n.ui-widget-header .ui-priority-secondary {\n\topacity: .7;\n\tfilter:Alpha(Opacity=70); /* support: IE8 */\n\tfont-weight: normal;\n}\n.ui-state-disabled,\n.ui-widget-content .ui-state-disabled,\n.ui-widget-header .ui-state-disabled {\n\topacity: .35;\n\tfilter:Alpha(Opacity=35); /* support: IE8 */\n\tbackground-image: none;\n}\n.ui-state-disabled .ui-icon {\n\tfilter:Alpha(Opacity=35); /* support: IE8 - See #6059 */\n}\n\n/* Icons\n----------------------------------*/\n\n/* states and images */\n.ui-icon {\n\twidth: 16px;\n\theight: 16px;\n}\n.ui-icon,\n.ui-widget-content .ui-icon {\n\t/* background-image: url(\"images/ui-icons_222222_256x240.png\"); */\n}\n.ui-widget-header .ui-icon {\n\tbackground-image: url(\"images/ui-icons_ffffff_256x240.png\");\n}\n.ui-state-default .ui-icon {\n\tbackground-image: url(\"images/ui-icons_ef8c08_256x240.png\");\n}\n.ui-state-hover .ui-icon,\n.ui-state-focus .ui-icon {\n\tbackground-image: url(\"images/ui-icons_ef8c08_256x240.png\");\n}\n.ui-state-active .ui-icon {\n\tbackground-image: url(\"images/ui-icons_ef8c08_256x240.png\");\n}\n.ui-state-highlight .ui-icon {\n\tbackground-image: url(\"images/ui-icons_228ef1_256x240.png\");\n}\n.ui-state-error .ui-icon,\n.ui-state-error-text .ui-icon {\n\tbackground-image: url(\"images/ui-icons_ffd27a_256x240.png\");\n}\n\n/* positioning */\n.ui-icon-blank { background-position: 16px 16px; }\n.ui-icon-carat-1-n { background-position: 0 0; }\n.ui-icon-carat-1-ne { background-position: -16px 0; }\n.ui-icon-carat-1-e { background-position: -32px 0; }\n.ui-icon-carat-1-se { background-position: -48px 0; }\n.ui-icon-carat-1-s { background-position: -64px 0; }\n.ui-icon-carat-1-sw { background-position: -80px 0; }\n.ui-icon-carat-1-w { background-position: -96px 0; }\n.ui-icon-carat-1-nw { background-position: -112px 0; }\n.ui-icon-carat-2-n-s { background-position: -128px 0; }\n.ui-icon-carat-2-e-w { background-position: -144px 0; }\n.ui-icon-triangle-1-n { background-position: 0 -16px; }\n.ui-icon-triangle-1-ne { background-position: -16px -16px; }\n.ui-icon-triangle-1-e { background-position: -32px -16px; }\n.ui-icon-triangle-1-se { background-position: -48px -16px; }\n.ui-icon-triangle-1-s { background-position: -64px -16px; }\n.ui-icon-triangle-1-sw { background-position: -80px -16px; }\n.ui-icon-triangle-1-w { background-position: -96px -16px; }\n.ui-icon-triangle-1-nw { background-position: -112px -16px; }\n.ui-icon-triangle-2-n-s { background-position: -128px -16px; }\n.ui-icon-triangle-2-e-w { background-position: -144px -16px; }\n.ui-icon-arrow-1-n { background-position: 0 -32px; }\n.ui-icon-arrow-1-ne { background-position: -16px -32px; }\n.ui-icon-arrow-1-e { background-position: -32px -32px; }\n.ui-icon-arrow-1-se { background-position: -48px -32px; }\n.ui-icon-arrow-1-s { background-position: -64px -32px; }\n.ui-icon-arrow-1-sw { background-position: -80px -32px; }\n.ui-icon-arrow-1-w { background-position: -96px -32px; }\n.ui-icon-arrow-1-nw { background-position: -112px -32px; }\n.ui-icon-arrow-2-n-s { background-position: -128px -32px; }\n.ui-icon-arrow-2-ne-sw { background-position: -144px -32px; }\n.ui-icon-arrow-2-e-w { background-position: -160px -32px; }\n.ui-icon-arrow-2-se-nw { background-position: -176px -32px; }\n.ui-icon-arrowstop-1-n { background-position: -192px -32px; }\n.ui-icon-arrowstop-1-e { background-position: -208px -32px; }\n.ui-icon-arrowstop-1-s { background-position: -224px -32px; }\n.ui-icon-arrowstop-1-w { background-position: -240px -32px; }\n.ui-icon-arrowthick-1-n { background-position: 0 -48px; }\n.ui-icon-arrowthick-1-ne { background-position: -16px -48px; }\n.ui-icon-arrowthick-1-e { background-position: -32px -48px; }\n.ui-icon-arrowthick-1-se { background-position: -48px -48px; }\n.ui-icon-arrowthick-1-s { background-position: -64px -48px; }\n.ui-icon-arrowthick-1-sw { background-position: -80px -48px; }\n.ui-icon-arrowthick-1-w { background-position: -96px -48px; }\n.ui-icon-arrowthick-1-nw { background-position: -112px -48px; }\n.ui-icon-arrowthick-2-n-s { background-position: -128px -48px; }\n.ui-icon-arrowthick-2-ne-sw { background-position: -144px -48px; }\n.ui-icon-arrowthick-2-e-w { background-position: -160px -48px; }\n.ui-icon-arrowthick-2-se-nw { background-position: -176px -48px; }\n.ui-icon-arrowthickstop-1-n { background-position: -192px -48px; }\n.ui-icon-arrowthickstop-1-e { background-position: -208px -48px; }\n.ui-icon-arrowthickstop-1-s { background-position: -224px -48px; }\n.ui-icon-arrowthickstop-1-w { background-position: -240px -48px; }\n.ui-icon-arrowreturnthick-1-w { background-position: 0 -64px; }\n.ui-icon-arrowreturnthick-1-n { background-position: -16px -64px; }\n.ui-icon-arrowreturnthick-1-e { background-position: -32px -64px; }\n.ui-icon-arrowreturnthick-1-s { background-position: -48px -64px; }\n.ui-icon-arrowreturn-1-w { background-position: -64px -64px; }\n.ui-icon-arrowreturn-1-n { background-position: -80px -64px; }\n.ui-icon-arrowreturn-1-e { background-position: -96px -64px; }\n.ui-icon-arrowreturn-1-s { background-position: -112px -64px; }\n.ui-icon-arrowrefresh-1-w { background-position: -128px -64px; }\n.ui-icon-arrowrefresh-1-n { background-position: -144px -64px; }\n.ui-icon-arrowrefresh-1-e { background-position: -160px -64px; }\n.ui-icon-arrowrefresh-1-s { background-position: -176px -64px; }\n.ui-icon-arrow-4 { background-position: 0 -80px; }\n.ui-icon-arrow-4-diag { background-position: -16px -80px; }\n.ui-icon-extlink { background-position: -32px -80px; }\n.ui-icon-newwin { background-position: -48px -80px; }\n.ui-icon-refresh { background-position: -64px -80px; }\n.ui-icon-shuffle { background-position: -80px -80px; }\n.ui-icon-transfer-e-w { background-position: -96px -80px; }\n.ui-icon-transferthick-e-w { background-position: -112px -80px; }\n.ui-icon-folder-collapsed { background-position: 0 -96px; }\n.ui-icon-folder-open { background-position: -16px -96px; }\n.ui-icon-document { background-position: -32px -96px; }\n.ui-icon-document-b { background-position: -48px -96px; }\n.ui-icon-note { background-position: -64px -96px; }\n.ui-icon-mail-closed { background-position: -80px -96px; }\n.ui-icon-mail-open { background-position: -96px -96px; }\n.ui-icon-suitcase { background-position: -112px -96px; }\n.ui-icon-comment { background-position: -128px -96px; }\n.ui-icon-person { background-position: -144px -96px; }\n.ui-icon-print { background-position: -160px -96px; }\n.ui-icon-trash { background-position: -176px -96px; }\n.ui-icon-locked { background-position: -192px -96px; }\n.ui-icon-unlocked { background-position: -208px -96px; }\n.ui-icon-bookmark { background-position: -224px -96px; }\n.ui-icon-tag { background-position: -240px -96px; }\n.ui-icon-home { background-position: 0 -112px; }\n.ui-icon-flag { background-position: -16px -112px; }\n.ui-icon-calendar { background-position: -32px -112px; }\n.ui-icon-cart { background-position: -48px -112px; }\n.ui-icon-pencil { background-position: -64px -112px; }\n.ui-icon-clock { background-position: -80px -112px; }\n.ui-icon-disk { background-position: -96px -112px; }\n.ui-icon-calculator { background-position: -112px -112px; }\n.ui-icon-zoomin { background-position: -128px -112px; }\n.ui-icon-zoomout { background-position: -144px -112px; }\n.ui-icon-search { background-position: -160px -112px; }\n.ui-icon-wrench { background-position: -176px -112px; }\n.ui-icon-gear { background-position: -192px -112px; }\n.ui-icon-heart { background-position: -208px -112px; }\n.ui-icon-star { background-position: -224px -112px; }\n.ui-icon-link { background-position: -240px -112px; }\n.ui-icon-cancel { background-position: 0 -128px; }\n.ui-icon-plus { background-position: -16px -128px; }\n.ui-icon-plusthick { background-position: -32px -128px; }\n.ui-icon-minus { background-position: -48px -128px; }\n.ui-icon-minusthick { background-position: -64px -128px; }\n.ui-icon-close { background-position: -80px -128px; }\n.ui-icon-closethick { background-position: -96px -128px; }\n.ui-icon-key { background-position: -112px -128px; }\n.ui-icon-lightbulb { background-position: -128px -128px; }\n.ui-icon-scissors { background-position: -144px -128px; }\n.ui-icon-clipboard { background-position: -160px -128px; }\n.ui-icon-copy { background-position: -176px -128px; }\n.ui-icon-contact { background-position: -192px -128px; }\n.ui-icon-image { background-position: -208px -128px; }\n.ui-icon-video { background-position: -224px -128px; }\n.ui-icon-script { background-position: -240px -128px; }\n.ui-icon-alert { background-position: 0 -144px; }\n.ui-icon-info { background-position: -16px -144px; }\n.ui-icon-notice { background-position: -32px -144px; }\n.ui-icon-help { background-position: -48px -144px; }\n.ui-icon-check { background-position: -64px -144px; }\n.ui-icon-bullet { background-position: -80px -144px; }\n.ui-icon-radio-on { background-position: -96px -144px; }\n.ui-icon-radio-off { background-position: -112px -144px; }\n.ui-icon-pin-w { background-position: -128px -144px; }\n.ui-icon-pin-s { background-position: -144px -144px; }\n.ui-icon-play { background-position: 0 -160px; }\n.ui-icon-pause { background-position: -16px -160px; }\n.ui-icon-seek-next { background-position: -32px -160px; }\n.ui-icon-seek-prev { background-position: -48px -160px; }\n.ui-icon-seek-end { background-position: -64px -160px; }\n.ui-icon-seek-start { background-position: -80px -160px; }\n/* ui-icon-seek-first is deprecated, use ui-icon-seek-start instead */\n.ui-icon-seek-first { background-position: -80px -160px; }\n.ui-icon-stop { background-position: -96px -160px; }\n.ui-icon-eject { background-position: -112px -160px; }\n.ui-icon-volume-off { background-position: -128px -160px; }\n.ui-icon-volume-on { background-position: -144px -160px; }\n.ui-icon-power { background-position: 0 -176px; }\n.ui-icon-signal-diag { background-position: -16px -176px; }\n.ui-icon-signal { background-position: -32px -176px; }\n.ui-icon-battery-0 { background-position: -48px -176px; }\n.ui-icon-battery-1 { background-position: -64px -176px; }\n.ui-icon-battery-2 { background-position: -80px -176px; }\n.ui-icon-battery-3 { background-position: -96px -176px; }\n.ui-icon-circle-plus { background-position: 0 -192px; }\n.ui-icon-circle-minus { background-position: -16px -192px; }\n.ui-icon-circle-close { background-position: -32px -192px; }\n.ui-icon-circle-triangle-e { background-position: -48px -192px; }\n.ui-icon-circle-triangle-s { background-position: -64px -192px; }\n.ui-icon-circle-triangle-w { background-position: -80px -192px; }\n.ui-icon-circle-triangle-n { background-position: -96px -192px; }\n.ui-icon-circle-arrow-e { background-position: -112px -192px; }\n.ui-icon-circle-arrow-s { background-position: -128px -192px; }\n.ui-icon-circle-arrow-w { background-position: -144px -192px; }\n.ui-icon-circle-arrow-n { background-position: -160px -192px; }\n.ui-icon-circle-zoomin { background-position: -176px -192px; }\n.ui-icon-circle-zoomout { background-position: -192px -192px; }\n.ui-icon-circle-check { background-position: -208px -192px; }\n.ui-icon-circlesmall-plus { background-position: 0 -208px; }\n.ui-icon-circlesmall-minus { background-position: -16px -208px; }\n.ui-icon-circlesmall-close { background-position: -32px -208px; }\n.ui-icon-squaresmall-plus { background-position: -48px -208px; }\n.ui-icon-squaresmall-minus { background-position: -64px -208px; }\n.ui-icon-squaresmall-close { background-position: -80px -208px; }\n.ui-icon-grip-dotted-vertical { background-position: 0 -224px; }\n.ui-icon-grip-dotted-horizontal { background-position: -16px -224px; }\n.ui-icon-grip-solid-vertical { background-position: -32px -224px; }\n.ui-icon-grip-solid-horizontal { background-position: -48px -224px; }\n.ui-icon-gripsmall-diagonal-se { background-position: -64px -224px; }\n.ui-icon-grip-diagonal-se { background-position: -80px -224px; }\n\n\n/* Misc visuals\n----------------------------------*/\n\n/* Corner radius */\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-left,\n.ui-corner-tl {\n\tborder-top-left-radius: 4px;\n}\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-right,\n.ui-corner-tr {\n\tborder-top-right-radius: 4px;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-left,\n.ui-corner-bl {\n\tborder-bottom-left-radius: 4px;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-right,\n.ui-corner-br {\n\tborder-bottom-right-radius: 4px;\n}\n\n/* Overlays */\n.ui-widget-overlay {\n\tbackground: #666666; /* url(\"images/ui-bg_diagonals-thick_20_666666_40x40.png\") 50% 50% repeat; */\n\topacity: .5;\n\tfilter: Alpha(Opacity=50); /* support: IE8 */\n}\n.ui-widget-shadow {\n\tmargin: -5px 0 0 -5px;\n\tpadding: 5px;\n\tbackground: #000000 url(\"images/ui-bg_flat_10_000000_40x100.png\") 50% 50% repeat-x;\n\topacity: .2;\n\tfilter: Alpha(Opacity=20); /* support: IE8 */\n\tborder-radius: 5px;\n}\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 294,
          "bodySize": 36415
        },
        "cache": {},
        "timings": {
          "send": 3,
          "wait": 0,
          "receive": 2
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8633"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.616-07:00",
        "time": 88,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/dwr/engine.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 320,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Cache-Control",
              "value": "must-revalidate, post-check=0, pre-check=0"
            },
            {
              "name": "Pragma",
              "value": "public"
            },
            {
              "name": "Content-Type",
              "value": "text/javascript; charset=utf-8"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Expires",
              "value": "0"
            },
            {
              "name": "Last-Modified",
              "value": "Mon, 13 Aug 2018 16:13:45 GMT"
            },
            {
              "name": "ETag",
              "value": "\"1534176825000\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Connection",
              "value": "close"
            }
          ],
          "content": {
            "size": 47356,
            "compression": 0,
            "mimeType": "text/javascript; charset=utf-8",
            "text": "/*\n * Copyright 2005 Joe Walker\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Declare an object to which we can add real functions.\n */\nif (dwr == null) var dwr = {};\nif (dwr.engine == null) dwr.engine = {};\nif (DWREngine == null) var DWREngine = dwr.engine;\n\n/**\n * Set an alternative error handler from the default alert box.\n * @see getahead.org/dwr/browser/engine/errors\n */\ndwr.engine.setErrorHandler = function(handler) {\n  dwr.engine._errorHandler = handler;\n};\n\n/**\n * Set an alternative warning handler from the default alert box.\n * @see getahead.org/dwr/browser/engine/errors\n */\ndwr.engine.setWarningHandler = function(handler) {\n  dwr.engine._warningHandler = handler;\n};\n\n/**\n * Setter for the text/html handler - what happens if a DWR request gets an HTML\n * reply rather than the expected Javascript. Often due to login timeout\n */\ndwr.engine.setTextHtmlHandler = function(handler) {\n  dwr.engine._textHtmlHandler = handler;\n};\n\n/**\n * Set a default timeout value for all calls. 0 (the default) turns timeouts off.\n * @see getahead.org/dwr/browser/engine/errors\n */\ndwr.engine.setTimeout = function(timeout) {\n  dwr.engine._timeout = timeout;\n};\n\n/**\n * The Pre-Hook is called before any DWR remoting is done.\n * @see getahead.org/dwr/browser/engine/hooks\n */\ndwr.engine.setPreHook = function(handler) {\n  dwr.engine._preHook = handler;\n};\n\n/**\n * The Post-Hook is called after any DWR remoting is done.\n * @see getahead.org/dwr/browser/engine/hooks\n */\ndwr.engine.setPostHook = function(handler) {\n  dwr.engine._postHook = handler;\n};\n\n/**\n * Custom headers for all DWR calls\n * @see getahead.org/dwr/????\n */\ndwr.engine.setHeaders = function(headers) {\n  dwr.engine._headers = headers;\n};\n\n/**\n * Custom parameters for all DWR calls\n * @see getahead.org/dwr/????\n */\ndwr.engine.setParameters = function(parameters) {\n  dwr.engine._parameters = parameters;\n};\n\n/** XHR remoting type constant. See dwr.engine.set[Rpc|Poll]Type() */\ndwr.engine.XMLHttpRequest = 1;\n\n/** XHR remoting type constant. See dwr.engine.set[Rpc|Poll]Type() */\ndwr.engine.IFrame = 2;\n\n/** XHR remoting type constant. See dwr.engine.setRpcType() */\ndwr.engine.ScriptTag = 3;\n\n/**\n * Set the preferred remoting type.\n * @param newType One of dwr.engine.XMLHttpRequest or dwr.engine.IFrame or dwr.engine.ScriptTag\n * @see getahead.org/dwr/browser/engine/options\n */\ndwr.engine.setRpcType = function(newType) {\n  if (newType != dwr.engine.XMLHttpRequest && newType != dwr.engine.IFrame && newType != dwr.engine.ScriptTag) {\n    dwr.engine._handleError(null, { name:\"dwr.engine.invalidRpcType\", message:\"RpcType must be one of dwr.engine.XMLHttpRequest or dwr.engine.IFrame or dwr.engine.ScriptTag\" });\n    return;\n  }\n  dwr.engine._rpcType = newType;\n};\n\n/**\n * Which HTTP method do we use to send results? Must be one of \"GET\" or \"POST\".\n * @see getahead.org/dwr/browser/engine/options\n */\ndwr.engine.setHttpMethod = function(httpMethod) {\n  if (httpMethod != \"GET\" && httpMethod != \"POST\") {\n    dwr.engine._handleError(null, { name:\"dwr.engine.invalidHttpMethod\", message:\"Remoting method must be one of GET or POST\" });\n    return;\n  }\n  dwr.engine._httpMethod = httpMethod;\n};\n\n/**\n * Ensure that remote calls happen in the order in which they were sent? (Default: false)\n * @see getahead.org/dwr/browser/engine/ordering\n */\ndwr.engine.setOrdered = function(ordered) {\n  dwr.engine._ordered = ordered;\n};\n\n/**\n * Do we ask the XHR object to be asynchronous? (Default: true)\n * @see getahead.org/dwr/browser/engine/options\n */\ndwr.engine.setAsync = function(async) {\n  dwr.engine._async = async;\n};\n\n/**\n * Does DWR poll the server for updates? (Default: false)\n * @see getahead.org/dwr/browser/engine/options\n */\ndwr.engine.setActiveReverseAjax = function(activeReverseAjax) {\n  if (activeReverseAjax) {\n    // Bail if we are already started\n    if (dwr.engine._activeReverseAjax) return;\n    dwr.engine._activeReverseAjax = true;\n    dwr.engine._poll();\n  }\n  else {\n    // Can we cancel an existing request?\n    if (dwr.engine._activeReverseAjax && dwr.engine._pollReq) dwr.engine._pollReq.abort();\n    dwr.engine._activeReverseAjax = false;\n  }\n  // TODO: in iframe mode, if we start, stop, start then the second start may\n  // well kick off a second iframe while the first is still about to return\n  // we should cope with this but we don't\n};\n\n/**\n * The default message handler.\n * @see getahead.org/dwr/browser/engine/errors\n */\ndwr.engine.defaultErrorHandler = function(message, ex) {\n  dwr.engine._debug(\"Error: \" + ex.name + \", \" + ex.message, true);\n  if (message == null || message == \"\") alert(\"A server error has occured.\");\n  // Ignore NS_ERROR_NOT_AVAILABLE if Mozilla is being narky\n  else if (message.indexOf(\"0x80040111\") != -1) dwr.engine._debug(message);\n  else alert(message);\n};\n\n/**\n * The default warning handler.\n * @see getahead.org/dwr/browser/engine/errors\n */\ndwr.engine.defaultWarningHandler = function(message, ex) {\n  dwr.engine._debug(message);\n};\n\n/**\n * For reduced latency you can group several remote calls together using a batch.\n * @see getahead.org/dwr/browser/engine/batch\n */\ndwr.engine.beginBatch = function() {\n  if (dwr.engine._batch) {\n    dwr.engine._handleError(null, { name:\"dwr.engine.batchBegun\", message:\"Batch already begun\" });\n    return;\n  }\n  dwr.engine._batch = dwr.engine._createBatch();\n};\n\n/**\n * Finished grouping a set of remote calls together. Go and execute them all.\n * @see getahead.org/dwr/browser/engine/batch\n */\ndwr.engine.endBatch = function(options) {\n  var batch = dwr.engine._batch;\n  if (batch == null) {\n    dwr.engine._handleError(null, { name:\"dwr.engine.batchNotBegun\", message:\"No batch in progress\" });\n    return;\n  }\n  dwr.engine._batch = null;\n  if (batch.map.callCount == 0) return;\n\n  // The hooks need to be merged carefully to preserve ordering\n  if (options) dwr.engine._mergeBatch(batch, options);\n\n  // In ordered mode, we don't send unless the list of sent items is empty\n  if (dwr.engine._ordered && dwr.engine._batchesLength != 0) {\n    dwr.engine._batchQueue[dwr.engine._batchQueue.length] = batch;\n  }\n  else {\n    dwr.engine._sendData(batch);\n  }\n};\n\n/** @deprecated */\ndwr.engine.setPollMethod = function(type) { dwr.engine.setPollType(type); };\ndwr.engine.setMethod = function(type) { dwr.engine.setRpcType(type); };\ndwr.engine.setVerb = function(verb) { dwr.engine.setHttpMethod(verb); };\ndwr.engine.setPollType = function() { dwr.engine._debug(\"Manually setting the Poll Type is not supported\"); };\n\n//==============================================================================\n// Only private stuff below here\n//==============================================================================\n\n/** The original page id sent from the server */\ndwr.engine._origScriptSessionId = \"422C473CBC57F09CB382DCF088BE207F\";\n\n/** The session cookie name */\ndwr.engine._sessionCookieName = \"JSESSIONID\"; // JSESSIONID\n\n/** Is GET enabled for the benefit of Safari? */\ndwr.engine._allowGetForSafariButMakeForgeryEasier = \"false\";\n\n/** The script prefix to strip in the case of scriptTagProtection. */\ndwr.engine._scriptTagProtection = \"throw 'allowScriptTagRemoting is false.';\";\n\n/** The default path to the DWR servlet */\ndwr.engine._defaultPath = \"/omni/dwr\";\n\n/** Do we use XHR for reverse ajax because we are not streaming? */\ndwr.engine._pollWithXhr = \"false\";\n\n/** The read page id that we calculate */\ndwr.engine._scriptSessionId = null;\n\n/** The function that we use to fetch/calculate a session id */\ndwr.engine._getScriptSessionId = function() {\n  if (dwr.engine._scriptSessionId == null) {\n    dwr.engine._scriptSessionId = dwr.engine._origScriptSessionId + Math.floor(Math.random() * 1000);\n  }\n  return dwr.engine._scriptSessionId;\n};\n\n/** A function to call if something fails. */\ndwr.engine._errorHandler = dwr.engine.defaultErrorHandler;\n\n/** For debugging when something unexplained happens. */\ndwr.engine._warningHandler = dwr.engine.defaultWarningHandler;\n\n/** A function to be called before requests are marshalled. Can be null. */\ndwr.engine._preHook = null;\n\n/** A function to be called after replies are received. Can be null. */\ndwr.engine._postHook = null;\n\n/** An map of the batches that we have sent and are awaiting a reply on. */\ndwr.engine._batches = {};\n\n/** A count of the number of outstanding batches. Should be == to _batches.length unless prototype has messed things up */\ndwr.engine._batchesLength = 0;\n\n/** In ordered mode, the array of batches waiting to be sent */\ndwr.engine._batchQueue = [];\n\n/** What is the default rpc type */\ndwr.engine._rpcType = dwr.engine.XMLHttpRequest;\n\n/** What is the default remoting method (ie GET or POST) */\ndwr.engine._httpMethod = \"POST\";\n\n/** Do we attempt to ensure that calls happen in the order in which they were sent? */\ndwr.engine._ordered = false;\n\n/** Do we make the calls async? */\ndwr.engine._async = true;\n\n/** The current batch (if we are in batch mode) */\ndwr.engine._batch = null;\n\n/** The global timeout */\ndwr.engine._timeout = 0;\n\n/** ActiveX objects to use when we want to convert an xml string into a DOM object. */\ndwr.engine._DOMDocument = [\"Msxml2.DOMDocument.6.0\", \"Msxml2.DOMDocument.5.0\", \"Msxml2.DOMDocument.4.0\", \"Msxml2.DOMDocument.3.0\", \"MSXML2.DOMDocument\", \"MSXML.DOMDocument\", \"Microsoft.XMLDOM\"];\n\n/** The ActiveX objects to use when we want to do an XMLHttpRequest call. */\ndwr.engine._XMLHTTP = [\"Msxml2.XMLHTTP.6.0\", \"Msxml2.XMLHTTP.5.0\", \"Msxml2.XMLHTTP.4.0\", \"MSXML2.XMLHTTP.3.0\", \"MSXML2.XMLHTTP\", \"Microsoft.XMLHTTP\"];\n\n/** Are we doing comet or polling? */\ndwr.engine._activeReverseAjax = false;\n\n/** The iframe that we are using to poll */\ndwr.engine._outstandingIFrames = [];\n\n/** The xhr object that we are using to poll */\ndwr.engine._pollReq = null;\n\n/** How many milliseconds between internal comet polls */\ndwr.engine._pollCometInterval = 200;\n\n/** How many times have we re-tried to poll? */\ndwr.engine._pollRetries = 0;\ndwr.engine._maxPollRetries = 0;\n\n/** Do we do a document.reload if we get a text/html reply? */\ndwr.engine._textHtmlHandler = null;\n\n/** If you wish to send custom headers with every request */\ndwr.engine._headers = null;\n\n/** If you wish to send extra custom request parameters with each request */\ndwr.engine._parameters = null;\n\n/** Undocumented interceptors - do not use */\ndwr.engine._postSeperator = \"\\n\";\ndwr.engine._defaultInterceptor = function(data) { return data; };\ndwr.engine._urlRewriteHandler = dwr.engine._defaultInterceptor;\ndwr.engine._contentRewriteHandler = dwr.engine._defaultInterceptor;\ndwr.engine._replyRewriteHandler = dwr.engine._defaultInterceptor;\n\n/** Batch ids allow us to know which batch the server is answering */\ndwr.engine._nextBatchId = 0;\n\n/** A list of the properties that need merging from calls to a batch */\ndwr.engine._propnames = [ \"rpcType\", \"httpMethod\", \"async\", \"timeout\", \"errorHandler\", \"warningHandler\", \"textHtmlHandler\" ];\n\n/** Do we stream, or can be hacked to do so? */\ndwr.engine._partialResponseNo = 0;\ndwr.engine._partialResponseYes = 1;\ndwr.engine._partialResponseFlush = 2;\n\n/** Is this page in the process of unloading? */\ndwr.engine._unloading = false;\n\n/**\n * @private Send a request. Called by the Javascript interface stub\n * @param path part of URL after the host and before the exec bit without leading or trailing /s\n * @param scriptName The class to execute\n * @param methodName The method on said class to execute\n * @param func The callback function to which any returned data should be passed\n *       if this is null, any returned data will be ignored\n * @param vararg_params The parameters to pass to the above class\n */\ndwr.engine._execute = function(path, scriptName, methodName, vararg_params) {\n  var singleShot = false;\n  if (dwr.engine._batch == null) {\n    dwr.engine.beginBatch();\n    singleShot = true;\n  }\n  var batch = dwr.engine._batch;\n  // To make them easy to manipulate we copy the arguments into an args array\n  var args = [];\n  for (var i = 0; i < arguments.length - 3; i++) {\n    args[i] = arguments[i + 3];\n  }\n  // All the paths MUST be to the same servlet\n  if (batch.path == null) {\n    batch.path = path;\n  }\n  else {\n    if (batch.path != path) {\n      dwr.engine._handleError(batch, { name:\"dwr.engine.multipleServlets\", message:\"Can't batch requests to multiple DWR Servlets.\" });\n      return;\n    }\n  }\n  // From the other params, work out which is the function (or object with\n  // call meta-data) and which is the call parameters\n  var callData;\n  var lastArg = args[args.length - 1];\n  if (typeof lastArg == \"function\" || lastArg == null) callData = { callback:args.pop() };\n  else callData = args.pop();\n\n  // Merge from the callData into the batch\n  dwr.engine._mergeBatch(batch, callData);\n  batch.handlers[batch.map.callCount] = {\n    exceptionHandler:callData.exceptionHandler,\n    callback:callData.callback\n  };\n\n  // Copy to the map the things that need serializing\n  var prefix = \"c\" + batch.map.callCount + \"-\";\n  batch.map[prefix + \"scriptName\"] = scriptName;\n  batch.map[prefix + \"methodName\"] = methodName;\n  batch.map[prefix + \"id\"] = batch.map.callCount;\n  var refctx = [];\n  for (i = 0; i < args.length; i++) {\n    dwr.engine._serializeAll(batch, refctx, args[i], prefix + \"param\" + i);\n  }\n\n  // Now we have finished remembering the call, we incr the call count\n  batch.map.callCount++;\n  if (singleShot) dwr.engine.endBatch();\n};\n\n/** @private Poll the server to see if there is any data waiting */\ndwr.engine._poll = function() {\n  if (!dwr.engine._activeReverseAjax) return;\n\n  var batch = dwr.engine._createBatch();\n  batch.map.id = 0; // TODO: Do we need this??\n  batch.map.callCount = 1;\n  batch.isPoll = true;\n  if (dwr.engine._pollWithXhr == \"true\") {\n    batch.rpcType = dwr.engine.XMLHttpRequest;\n    batch.map.partialResponse = dwr.engine._partialResponseNo;\n  }\n  else {\n    if (navigator.userAgent.indexOf(\"Gecko/\") != -1) {\n      batch.rpcType = dwr.engine.XMLHttpRequest;\n      batch.map.partialResponse = dwr.engine._partialResponseYes;\n    }\n    else {\n      batch.rpcType = dwr.engine.XMLHttpRequest;\n      batch.map.partialResponse = dwr.engine._partialResponseNo;\n    }\n  }\n  batch.httpMethod = \"POST\";\n  batch.async = true;\n  batch.timeout = 0;\n  batch.path = dwr.engine._defaultPath;\n  batch.preHooks = [];\n  batch.postHooks = [];\n  batch.errorHandler = dwr.engine._pollErrorHandler;\n  batch.warningHandler = dwr.engine._pollErrorHandler;\n  batch.handlers[0] = {\n    callback:function(pause) {\n      dwr.engine._pollRetries = 0;\n      setTimeout(dwr.engine._poll, pause);\n    }\n  };\n\n  // Send the data\n  dwr.engine._sendData(batch);\n  if (batch.rpcType == dwr.engine.XMLHttpRequest && batch.map.partialResponse == dwr.engine._partialResponseYes) {\n    dwr.engine._checkCometPoll();\n  }\n};\n\n/** Try to recover from polling errors */\ndwr.engine._pollErrorHandler = function(msg, ex) {\n  // if anything goes wrong then just silently try again (up to 3x) after 10s\n  dwr.engine._pollRetries++;\n  dwr.engine._debug(\"Reverse Ajax poll failed (pollRetries=\" + dwr.engine._pollRetries + \"): \" + ex.name + \" : \" + ex.message);\n  if (dwr.engine._pollRetries < dwr.engine._maxPollRetries) {\n    setTimeout(dwr.engine._poll, 10000);\n  }\n  else {\n    dwr.engine._activeReverseAjax = false;\n    dwr.engine._debug(\"Giving up.\");\n  }\n};\n\n/** @private Generate a new standard batch */\ndwr.engine._createBatch = function() {\n  var batch = {\n    map:{\n      callCount:0,\n      page:window.location.pathname + window.location.search,\n      httpSessionId:dwr.engine._getJSessionId(),\n      scriptSessionId:dwr.engine._getScriptSessionId()\n    },\n    charsProcessed:0, paramCount:0,\n    parameters:{}, headers:{},\n    isPoll:false, handlers:{}, preHooks:[], postHooks:[],\n    rpcType:dwr.engine._rpcType,\n    httpMethod:dwr.engine._httpMethod,\n    async:dwr.engine._async,\n    timeout:dwr.engine._timeout,\n    errorHandler:dwr.engine._errorHandler,\n    warningHandler:dwr.engine._warningHandler,\n    textHtmlHandler:dwr.engine._textHtmlHandler\n  };\n  if (dwr.engine._preHook) batch.preHooks.push(dwr.engine._preHook);\n  if (dwr.engine._postHook) batch.postHooks.push(dwr.engine._postHook);\n  var propname, data;\n  if (dwr.engine._headers) {\n    for (propname in dwr.engine._headers) {\n      data = dwr.engine._headers[propname];\n      if (typeof data != \"function\") batch.headers[propname] = data;\n    }\n  }\n  if (dwr.engine._parameters) {\n    for (propname in dwr.engine._parameters) {\n      data = dwr.engine._parameters[propname];\n      if (typeof data != \"function\") batch.parameters[propname] = data;\n    }\n  }\n  return batch;\n};\n\n/** @private Take further options and merge them into */\ndwr.engine._mergeBatch = function(batch, overrides) {\n  var propname, data;\n  for (var i = 0; i < dwr.engine._propnames.length; i++) {\n    propname = dwr.engine._propnames[i];\n    if (overrides[propname] != null) batch[propname] = overrides[propname];\n  }\n  if (overrides.preHook != null) batch.preHooks.unshift(overrides.preHook);\n  if (overrides.postHook != null) batch.postHooks.push(overrides.postHook);\n  if (overrides.headers) {\n    for (propname in overrides.headers) {\n      data = overrides.headers[propname];\n      if (typeof data != \"function\") batch.headers[propname] = data;\n    }\n  }\n  if (overrides.parameters) {\n    for (propname in overrides.parameters) {\n      data = overrides.parameters[propname];\n      if (typeof data != \"function\") batch.map[\"p-\" + propname] = \"\" + data;\n    }\n  }\n};\n\n/** @private What is our session id? */\ndwr.engine._getJSessionId =  function() {\n  var cookies = document.cookie.split(';');\n  for (var i = 0; i < cookies.length; i++) {\n    var cookie = cookies[i];\n    while (cookie.charAt(0) == ' ') cookie = cookie.substring(1, cookie.length);\n    if (cookie.indexOf(dwr.engine._sessionCookieName + \"=\") == 0) {\n      return cookie.substring(dwr.engine._sessionCookieName.length + 1, cookie.length);\n    }\n  }\n  return \"\";\n};\n\n/** @private Check for reverse Ajax activity */\ndwr.engine._checkCometPoll = function() {\n  for (var i = 0; i < dwr.engine._outstandingIFrames.length; i++) {\n    var text = \"\";\n    var iframe = dwr.engine._outstandingIFrames[i];\n    try {\n      text = dwr.engine._getTextFromCometIFrame(iframe);\n    }\n    catch (ex) {\n      dwr.engine._handleWarning(iframe.batch, ex);\n    }\n    if (text != \"\") dwr.engine._processCometResponse(text, iframe.batch);\n  }\n  if (dwr.engine._pollReq) {\n    var req = dwr.engine._pollReq;\n    var text = req.responseText;\n    if (text != null) dwr.engine._processCometResponse(text, req.batch);\n  }\n\n  // If the poll resources are still there, come back again\n  if (dwr.engine._outstandingIFrames.length > 0 || dwr.engine._pollReq) {\n    setTimeout(dwr.engine._checkCometPoll, dwr.engine._pollCometInterval);\n  }\n};\n\n/** @private Extract the whole (executed an all) text from the current iframe */\ndwr.engine._getTextFromCometIFrame = function(frameEle) {\n  var body = frameEle.contentWindow.document.body;\n  if (body == null) return \"\";\n  var text = body.innerHTML;\n  // We need to prevent IE from stripping line feeds\n  if (text.indexOf(\"<PRE>\") == 0 || text.indexOf(\"<pre>\") == 0) {\n    text = text.substring(5, text.length - 7);\n  }\n  return text;\n};\n\n/** @private Some more text might have come in, test and execute the new stuff */\ndwr.engine._processCometResponse = function(response, batch) {\n  if (batch.charsProcessed == response.length) return;\n  if (response.length == 0) {\n    batch.charsProcessed = 0;\n    return;\n  }\n\n  var firstStartTag = response.indexOf(\"//#DWR-START#\", batch.charsProcessed);\n  if (firstStartTag == -1) {\n    // dwr.engine._debug(\"No start tag (search from \" + batch.charsProcessed + \"). skipping '\" + response.substring(batch.charsProcessed) + \"'\");\n    batch.charsProcessed = response.length;\n    return;\n  }\n  // if (firstStartTag > 0) {\n  //   dwr.engine._debug(\"Start tag not at start (search from \" + batch.charsProcessed + \"). skipping '\" + response.substring(batch.charsProcessed, firstStartTag) + \"'\");\n  // }\n\n  var lastEndTag = response.lastIndexOf(\"//#DWR-END#\");\n  if (lastEndTag == -1) {\n    // dwr.engine._debug(\"No end tag. unchanged charsProcessed=\" + batch.charsProcessed);\n    return;\n  }\n\n  // Skip the end tag too for next time, remembering CR and LF\n  if (response.charCodeAt(lastEndTag + 11) == 13 && response.charCodeAt(lastEndTag + 12) == 10) {\n    batch.charsProcessed = lastEndTag + 13;\n  }\n  else {\n    batch.charsProcessed = lastEndTag + 11;\n  }\n\n  var exec = response.substring(firstStartTag + 13, lastEndTag);\n\n  dwr.engine._receivedBatch = batch;\n  dwr.engine._eval(exec);\n  dwr.engine._receivedBatch = null;\n};\n\n/** @private Actually send the block of data in the batch object. */\ndwr.engine._sendData = function(batch) {\n  batch.map.batchId = dwr.engine._nextBatchId;\n  dwr.engine._nextBatchId++;\n  dwr.engine._batches[batch.map.batchId] = batch;\n  dwr.engine._batchesLength++;\n  batch.completed = false;\n\n  for (var i = 0; i < batch.preHooks.length; i++) {\n    batch.preHooks[i]();\n  }\n  batch.preHooks = null;\n  // Set a timeout\n  if (batch.timeout && batch.timeout != 0) {\n    batch.timeoutId = setTimeout(function() { dwr.engine._abortRequest(batch); }, batch.timeout);\n  }\n  // Get setup for XMLHttpRequest if possible\n  if (batch.rpcType == dwr.engine.XMLHttpRequest) {\n    if (window.XMLHttpRequest) {\n      batch.req = new XMLHttpRequest();\n    }\n    // IE5 for the mac claims to support window.ActiveXObject, but throws an error when it's used\n    else if (window.ActiveXObject && !(navigator.userAgent.indexOf(\"Mac\") >= 0 && navigator.userAgent.indexOf(\"MSIE\") >= 0)) {\n      batch.req = dwr.engine._newActiveXObject(dwr.engine._XMLHTTP);\n    }\n  }\n\n  var prop, request;\n  if (batch.req) {\n    // Proceed using XMLHttpRequest\n    if (batch.async) {\n      batch.req.onreadystatechange = function() {\n        if (typeof dwr != 'undefined') dwr.engine._stateChange(batch);\n      };\n    }\n    // If we're polling, record this for monitoring\n    if (batch.isPoll) {\n      dwr.engine._pollReq = batch.req;\n      // In IE XHR is an ActiveX control so you can't augment it like this\n      if (!(document.all && !window.opera)) batch.req.batch = batch;\n    }\n    // Workaround for Safari 1.x POST bug\n    var indexSafari = navigator.userAgent.indexOf(\"Safari/\");\n    if (indexSafari >= 0) {\n      var version = navigator.userAgent.substring(indexSafari + 7);\n      if (parseInt(version, 10) < 400) {\n        if (dwr.engine._allowGetForSafariButMakeForgeryEasier == \"true\") batch.httpMethod = \"GET\";\n        else dwr.engine._handleWarning(batch, { name:\"dwr.engine.oldSafari\", message:\"Safari GET support disabled. See getahead.org/dwr/server/servlet and allowGetForSafariButMakeForgeryEasier.\" });\n      }\n    }\n    batch.mode = batch.isPoll ? dwr.engine._ModePlainPoll : dwr.engine._ModePlainCall;\n    request = dwr.engine._constructRequest(batch);\n    try {\n      batch.req.open(batch.httpMethod, request.url, batch.async);\n      try {\n        for (prop in batch.headers) {\n          var value = batch.headers[prop];\n          if (typeof value == \"string\") batch.req.setRequestHeader(prop, value);\n        }\n        if (!batch.headers[\"Content-Type\"]) batch.req.setRequestHeader(\"Content-Type\", \"text/plain\");\n      }\n      catch (ex) {\n        dwr.engine._handleWarning(batch, ex);\n      }\n      batch.req.send(request.body);\n      if (!batch.async) dwr.engine._stateChange(batch);\n    }\n    catch (ex) {\n      dwr.engine._handleError(batch, ex);\n    }\n  }\n  else if (batch.rpcType != dwr.engine.ScriptTag) {\n    var idname = batch.isPoll ? \"dwr-if-poll-\" + batch.map.batchId : \"dwr-if-\" + batch.map.batchId;\n    // Removed htmlfile implementation. Don't expect it to return before v3\n    batch.div = document.createElement(\"div\");\n    // Add the div to the document first, otherwise IE 6 will ignore onload handler.\n    document.body.appendChild(batch.div);\n    batch.div.innerHTML = \"<iframe src='javascript:void(0)' frameborder='0' style='width:0px;height:0px;border:0;' id='\" + idname + \"' name='\" + idname + \"' onload='dwr.engine._iframeLoadingComplete (\" + batch.map.batchId + \");'></iframe>\";\n    batch.document = document;\n    batch.iframe = batch.document.getElementById(idname);\n    batch.iframe.batch = batch;\n    batch.mode = batch.isPoll ? dwr.engine._ModeHtmlPoll : dwr.engine._ModeHtmlCall;\n    if (batch.isPoll) dwr.engine._outstandingIFrames.push(batch.iframe);\n    request = dwr.engine._constructRequest(batch);\n    if (batch.httpMethod == \"GET\") {\n      batch.iframe.setAttribute(\"src\", request.url);\n    }\n    else {\n      batch.form = batch.document.createElement(\"form\");\n      batch.form.setAttribute(\"id\", \"dwr-form\");\n      batch.form.setAttribute(\"action\", request.url);\n      batch.form.setAttribute(\"style\", \"display:none;\");\n      batch.form.setAttribute(\"target\", idname);\n      batch.form.target = idname;\n      batch.form.setAttribute(\"method\", batch.httpMethod);\n      for (prop in batch.map) {\n        var value = batch.map[prop];\n        if (typeof value != \"function\") {\n          var formInput = batch.document.createElement(\"input\");\n          formInput.setAttribute(\"type\", \"hidden\");\n          formInput.setAttribute(\"name\", prop);\n          formInput.setAttribute(\"value\", value);\n          batch.form.appendChild(formInput);\n        }\n      }\n      batch.document.body.appendChild(batch.form);\n      batch.form.submit();\n    }\n  }\n  else {\n    batch.httpMethod = \"GET\"; // There's no such thing as ScriptTag using POST\n    batch.mode = batch.isPoll ? dwr.engine._ModePlainPoll : dwr.engine._ModePlainCall;\n    request = dwr.engine._constructRequest(batch);\n    batch.script = document.createElement(\"script\");\n    batch.script.id = \"dwr-st-\" + batch.map[\"c0-id\"];\n    batch.script.src = request.url;\n    document.body.appendChild(batch.script);\n  }\n};\n\ndwr.engine._ModePlainCall = \"/call/plaincall/\";\ndwr.engine._ModeHtmlCall = \"/call/htmlcall/\";\ndwr.engine._ModePlainPoll = \"/call/plainpoll/\";\ndwr.engine._ModeHtmlPoll = \"/call/htmlpoll/\";\n\n/** @private Work out what the URL should look like */\ndwr.engine._constructRequest = function(batch) {\n  // A quick string to help people that use web log analysers\n  var request = { url:batch.path + batch.mode, body:null };\n  if (batch.isPoll == true) {\n    request.url += \"ReverseAjax.dwr\";\n  }\n  else if (batch.map.callCount == 1) {\n    request.url += batch.map[\"c0-scriptName\"] + \".\" + batch.map[\"c0-methodName\"] + \".dwr\";\n  }\n  else {\n    request.url += \"Multiple.\" + batch.map.callCount + \".dwr\";\n  }\n  // Play nice with url re-writing\n  var sessionMatch = location.href.match(/jsessionid=([^?]+)/);\n  if (sessionMatch != null) {\n    request.url += \";jsessionid=\" + sessionMatch[1];\n  }\n\n  var prop;\n  if (batch.httpMethod == \"GET\") {\n    // Some browsers (Opera/Safari2) seem to fail to convert the callCount value\n    // to a string in the loop below so we do it manually here.\n    batch.map.callCount = \"\" + batch.map.callCount;\n    request.url += \"?\";\n    for (prop in batch.map) {\n      if (typeof batch.map[prop] != \"function\") {\n        request.url += encodeURIComponent(prop) + \"=\" + encodeURIComponent(batch.map[prop]) + \"&\";\n      }\n    }\n    request.url = request.url.substring(0, request.url.length - 1);\n  }\n  else {\n    // PERFORMANCE: for iframe mode this is thrown away.\n    request.body = \"\";\n    if (document.all && !window.opera) {\n      // Use array joining on IE (fastest)\n      var buf = [];\n      for (prop in batch.map) {\n        if (typeof batch.map[prop] != \"function\") {\n          buf.push(prop + \"=\" + batch.map[prop] + dwr.engine._postSeperator);\n        }\n      }\n      request.body = buf.join(\"\");\n    }\n    else {\n      // Use string concat on other browsers (fastest)\n      for (prop in batch.map) {\n        if (typeof batch.map[prop] != \"function\") {\n          request.body += prop + \"=\" + batch.map[prop] + dwr.engine._postSeperator;\n        }\n      }\n    }\n    request.body = dwr.engine._contentRewriteHandler(request.body);\n  }\n  request.url = dwr.engine._urlRewriteHandler(request.url);\n  return request;\n};\n\n/** @private Called by XMLHttpRequest to indicate that something has happened */\ndwr.engine._stateChange = function(batch) {\n  var toEval;\n\n  if (batch.completed) {\n    dwr.engine._debug(\"Error: _stateChange() with batch.completed\");\n    return;\n  }\n\n  var req = batch.req;\n  try {\n    if (req.readyState != 4) return;\n  }\n  catch (ex) {\n    dwr.engine._handleWarning(batch, ex);\n    // It's broken - clear up and forget this call\n    dwr.engine._clearUp(batch);\n    return;\n  }\n\n  if (dwr.engine._unloading) {\n    dwr.engine._debug(\"Ignoring reply from server as page is unloading.\");\n    return;\n  }\n  \n  try {\n    var reply = req.responseText;\n    reply = dwr.engine._replyRewriteHandler(reply);\n    var status = req.status; // causes Mozilla to except on page moves\n\n    if (reply == null || reply == \"\") {\n      dwr.engine._handleWarning(batch, { name:\"dwr.engine.missingData\", message:\"No data received from server\" });\n    }\n    else if (status != 200) {\n      dwr.engine._handleError(batch, { name:\"dwr.engine.http.\" + status, message:req.statusText });\n    }\n    else {\n      var contentType = req.getResponseHeader(\"Content-Type\");\n      if (!contentType.match(/^text\\/plain/) && !contentType.match(/^text\\/javascript/)) {\n        if (contentType.match(/^text\\/html/) && typeof batch.textHtmlHandler == \"function\") {\n          batch.textHtmlHandler({ status:status, responseText:reply, contentType:contentType });\n        }\n        else {\n          dwr.engine._handleWarning(batch, { name:\"dwr.engine.invalidMimeType\", message:\"Invalid content type: '\" + contentType + \"'\" });\n        }\n      }\n      else {\n        // Comet replies might have already partially executed\n        if (batch.isPoll && batch.map.partialResponse == dwr.engine._partialResponseYes) {\n          dwr.engine._processCometResponse(reply, batch);\n        }\n        else {\n          if (reply.search(\"//#DWR\") == -1) {\n            dwr.engine._handleWarning(batch, { name:\"dwr.engine.invalidReply\", message:\"Invalid reply from server\" });\n          }\n          else {\n            toEval = reply;\n          }\n        }\n      }\n    }\n  }\n  catch (ex) {\n    dwr.engine._handleWarning(batch, ex);\n  }\n\n  dwr.engine._callPostHooks(batch);\n\n  // Outside of the try/catch so errors propogate normally:\n  dwr.engine._receivedBatch = batch;\n  if (toEval != null) toEval = toEval.replace(dwr.engine._scriptTagProtection, \"\");\n  dwr.engine._eval(toEval);\n  dwr.engine._receivedBatch = null;\n  dwr.engine._validateBatch(batch);\n  if (!batch.completed) dwr.engine._clearUp(batch);\n};\n\n/**\n * @private This function is invoked when a batch reply is received.\n * It checks that there is a response for every call in the batch. Otherwise,\n * an error will be signaled (a call without a response indicates that the \n * server failed to send complete batch response). \n */\ndwr.engine._validateBatch = function(batch) {\n  // If some call left unreplied, report an error.\n  if (!batch.completed) {\n    for (var i = 0; i < batch.map.callCount; i++) {\n      if (batch.handlers[i] != null) {\n        dwr.engine._handleWarning(batch, { name:\"dwr.engine.incompleteReply\", message:\"Incomplete reply from server\" });\n        break;\n      }\n    }\n  }\n}\n\n/** @private Called from iframe onload, check batch using batch-id */\ndwr.engine._iframeLoadingComplete = function(batchId) {\n  // dwr.engine._checkCometPoll();\n  var batch = dwr.engine._batches[batchId];\n  if (batch) dwr.engine._validateBatch(batch);\n}\n\n/** @private Called by the server: Execute a callback */\ndwr.engine._remoteHandleCallback = function(batchId, callId, reply) {\n  var batch = dwr.engine._batches[batchId];\n  if (batch == null) {\n    dwr.engine._debug(\"Warning: batch == null in remoteHandleCallback for batchId=\" + batchId, true);\n    return;\n  }\n  // Error handlers inside here indicate an error that is nothing to do\n  // with DWR so we handle them differently.\n  try {\n    var handlers = batch.handlers[callId];\n    batch.handlers[callId] = null;\n    if (!handlers) {\n      dwr.engine._debug(\"Warning: Missing handlers. callId=\" + callId, true);\n    }\n    else if (typeof handlers.callback == \"function\") handlers.callback(reply);\n  }\n  catch (ex) {\n    dwr.engine._handleError(batch, ex);\n  }\n};\n\n/** @private Called by the server: Handle an exception for a call */\ndwr.engine._remoteHandleException = function(batchId, callId, ex) {\n  var batch = dwr.engine._batches[batchId];\n  if (batch == null) { dwr.engine._debug(\"Warning: null batch in remoteHandleException\", true); return; }\n  var handlers = batch.handlers[callId];\n  batch.handlers[callId] = null;\n  if (handlers == null) { dwr.engine._debug(\"Warning: null handlers in remoteHandleException\", true); return; }\n  if (ex.message == undefined) ex.message = \"\";\n  if (typeof handlers.exceptionHandler == \"function\") handlers.exceptionHandler(ex.message, ex);\n  else if (typeof batch.errorHandler == \"function\") batch.errorHandler(ex.message, ex);\n};\n\n/** @private Called by the server: The whole batch is broken */\ndwr.engine._remoteHandleBatchException = function(ex, batchId) {\n  var searchBatch = (dwr.engine._receivedBatch == null && batchId != null);\n  if (searchBatch) {\n    dwr.engine._receivedBatch = dwr.engine._batches[batchId];\n  }\n  if (ex.message == undefined) ex.message = \"\";\n  dwr.engine._handleError(dwr.engine._receivedBatch, ex);\n  if (searchBatch) {\n    dwr.engine._receivedBatch = null;\n    dwr.engine._clearUp(dwr.engine._batches[batchId]);\n  }\n};\n\n/** @private Called by the server: Reverse ajax should not be used */\ndwr.engine._remotePollCometDisabled = function(ex, batchId) {\n  dwr.engine.setActiveReverseAjax(false);\n  var searchBatch = (dwr.engine._receivedBatch == null && batchId != null);\n  if (searchBatch) {\n    dwr.engine._receivedBatch = dwr.engine._batches[batchId];\n  }\n  if (ex.message == undefined) ex.message = \"\";\n  dwr.engine._handleError(dwr.engine._receivedBatch, ex);\n  if (searchBatch) {\n    dwr.engine._receivedBatch = null;\n    dwr.engine._clearUp(dwr.engine._batches[batchId]);\n  }\n};\n\n/** @private Called by the server: An IFrame reply is about to start */\ndwr.engine._remoteBeginIFrameResponse = function(iframe, batchId) {\n  if (iframe != null) dwr.engine._receivedBatch = iframe.batch;\n  dwr.engine._callPostHooks(dwr.engine._receivedBatch);\n};\n\n/** @private Called by the server: An IFrame reply is just completing */\ndwr.engine._remoteEndIFrameResponse = function(batchId) {\n  dwr.engine._clearUp(dwr.engine._receivedBatch);\n  dwr.engine._receivedBatch = null;\n};\n\n/** @private This is a hack to make the context be this window */\ndwr.engine._eval = function(script) {\n  if (script == null) return null;\n  if (script == \"\") { dwr.engine._debug(\"Warning: blank script\", true); return null; }\n  // dwr.engine._debug(\"Exec: [\" + script + \"]\", true);\n  return eval(script);\n};\n\n/** @private Called as a result of a request timeout */\ndwr.engine._abortRequest = function(batch) {\n  if (batch && !batch.completed) {\n    dwr.engine._clearUp(batch);\n    if (batch.req) batch.req.abort();\n    dwr.engine._handleError(batch, { name:\"dwr.engine.timeout\", message:\"Timeout\" });\n  }\n};\n\n/** @private call all the post hooks for a batch */\ndwr.engine._callPostHooks = function(batch) {\n  if (batch.postHooks) {\n    for (var i = 0; i < batch.postHooks.length; i++) {\n      batch.postHooks[i]();\n    }\n    batch.postHooks = null;\n  }\n};\n\n/** @private A call has finished by whatever means and we need to shut it all down. */\ndwr.engine._clearUp = function(batch) {\n  if (!batch) { dwr.engine._debug(\"Warning: null batch in dwr.engine._clearUp()\", true); return; }\n  if (batch.completed) { dwr.engine._debug(\"Warning: Double complete\", true); return; }\n\n  // IFrame tidyup\n  if (batch.div) batch.div.parentNode.removeChild(batch.div);\n  if (batch.iframe) {\n    // If this is a poll frame then stop comet polling\n    for (var i = 0; i < dwr.engine._outstandingIFrames.length; i++) {\n      if (dwr.engine._outstandingIFrames[i] == batch.iframe) {\n        dwr.engine._outstandingIFrames.splice(i, 1);\n      }\n    }\n    batch.iframe.parentNode.removeChild(batch.iframe);\n  }\n  if (batch.form) batch.form.parentNode.removeChild(batch.form);\n\n  // XHR tidyup: avoid IE handles increase\n  if (batch.req) {\n    // If this is a poll frame then stop comet polling\n    if (batch.req == dwr.engine._pollReq) dwr.engine._pollReq = null;\n    delete batch.req;\n  }\n\n  // Timeout tidyup\n  if (batch.timeoutId) {\n    clearTimeout(batch.timeoutId);\n    delete batch.timeoutId;\n  }\n\n  if (batch.map && (batch.map.batchId || batch.map.batchId == 0)) {\n    delete dwr.engine._batches[batch.map.batchId];\n    dwr.engine._batchesLength--;\n  }\n\n  batch.completed = true;\n\n  // If there is anything on the queue waiting to go out, then send it.\n  // We don't need to check for ordered mode, here because when ordered mode\n  // gets turned off, we still process *waiting* batches in an ordered way.\n  if (dwr.engine._batchQueue.length != 0) {\n    var sendbatch = dwr.engine._batchQueue.shift();\n    dwr.engine._sendData(sendbatch);\n  }\n};\n\n/** @private Abort any XHRs in progress at page unload (solves zombie socket problems in IE). */\ndwr.engine._unloader = function() {\n  dwr.engine._unloading = true;\n\n  // Empty queue of waiting ordered requests\n  dwr.engine._batchQueue.length = 0;\n\n  // Abort any ongoing XHRs and clear their batches\n  for (var batchId in dwr.engine._batches) {\n    var batch = dwr.engine._batches[batchId];\n    // Only process objects that look like batches (avoid prototype additions!)\n    if (batch && batch.map) {\n      if (batch.req) {\n        batch.req.abort();\n      }\n      dwr.engine._clearUp(batch);\n    }\n  }\n};\n// Now register the unload handler\nif (window.addEventListener) window.addEventListener('unload', dwr.engine._unloader, false);\nelse if (window.attachEvent) window.attachEvent('onunload', dwr.engine._unloader);\n\n/** @private Generic error handling routing to save having null checks everywhere */\ndwr.engine._handleError = function(batch, ex) {\n  if (typeof ex == \"string\") ex = { name:\"unknown\", message:ex };\n  if (ex.message == null) ex.message = \"\";\n  if (ex.name == null) ex.name = \"unknown\";\n  if (batch && typeof batch.errorHandler == \"function\") batch.errorHandler(ex.message, ex);\n  else if (dwr.engine._errorHandler) dwr.engine._errorHandler(ex.message, ex);\n  if (batch) dwr.engine._clearUp(batch);\n};\n\n/** @private Generic error handling routing to save having null checks everywhere */\ndwr.engine._handleWarning = function(batch, ex) {\n  if (typeof ex == \"string\") ex = { name:\"unknown\", message:ex };\n  if (ex.message == null) ex.message = \"\";\n  if (ex.name == null) ex.name = \"unknown\";\n  if (batch && typeof batch.warningHandler == \"function\") batch.warningHandler(ex.message, ex);\n  else if (dwr.engine._warningHandler) dwr.engine._warningHandler(ex.message, ex);\n  if (batch) dwr.engine._clearUp(batch);\n};\n\n/**\n * @private Marshall a data item\n * @param batch A map of variables to how they have been marshalled\n * @param referto An array of already marshalled variables to prevent recurrsion\n * @param data The data to be marshalled\n * @param name The name of the data being marshalled\n */\ndwr.engine._serializeAll = function(batch, referto, data, name) {\n  if (data == null) {\n    batch.map[name] = \"null:null\";\n    return;\n  }\n\n  switch (typeof data) {\n  case \"boolean\":\n    batch.map[name] = \"boolean:\" + data;\n    break;\n  case \"number\":\n    batch.map[name] = \"number:\" + data;\n    break;\n  case \"string\":\n    batch.map[name] = \"string:\" + encodeURIComponent(data);\n    break;\n  case \"object\":\n    var objstr = Object.prototype.toString.call(data);\n    if (objstr == \"[object String]\") batch.map[name] = \"String:\" + encodeURIComponent(data);\n    else if (objstr == \"[object Boolean]\") batch.map[name] = \"Boolean:\" + data;\n    else if (objstr == \"[object Number]\") batch.map[name] = \"Number:\" + data;\n    else if (objstr == \"[object Date]\") batch.map[name] = \"Date:\" + data.getTime();\n    else if (objstr == \"[object Array]\") batch.map[name] = dwr.engine._serializeArray(batch, referto, data, name);\n    else batch.map[name] = dwr.engine._serializeObject(batch, referto, data, name);\n    break;\n  case \"function\":\n    // We just ignore functions.\n    break;\n  default:\n    dwr.engine._handleWarning(null, { name:\"dwr.engine.unexpectedType\", message:\"Unexpected type: \" + typeof data + \", attempting default converter.\" });\n    batch.map[name] = \"default:\" + data;\n    break;\n  }\n};\n\n/** @private Have we already converted this object? */\ndwr.engine._lookup = function(referto, data, name) {\n  var lookup;\n  // Can't use a map: getahead.org/ajax/javascript-gotchas\n  for (var i = 0; i < referto.length; i++) {\n    if (referto[i].data == data) {\n      lookup = referto[i];\n      break;\n    }\n  }\n  if (lookup) return \"reference:\" + lookup.name;\n  referto.push({ data:data, name:name });\n  return null;\n};\n\n/** @private Marshall an object */\ndwr.engine._serializeObject = function(batch, referto, data, name) {\n  var ref = dwr.engine._lookup(referto, data, name);\n  if (ref) return ref;\n\n  // This check for an HTML is not complete, but is there a better way?\n  // Maybe we should add: data.hasChildNodes typeof \"function\" == true\n  if (data.nodeName && data.nodeType) {\n    return dwr.engine._serializeXml(batch, referto, data, name);\n  }\n\n  // treat objects as an associative arrays\n  var reply = \"Object_\" + dwr.engine._getObjectClassName(data) + \":{\";\n  var element;\n  for (element in data) {\n    if (typeof data[element] != \"function\") {\n      batch.paramCount++;\n      var childName = \"c\" + dwr.engine._batch.map.callCount + \"-e\" + batch.paramCount;\n      dwr.engine._serializeAll(batch, referto, data[element], childName);\n\n      reply += encodeURIComponent(element) + \":reference:\" + childName + \", \";\n    }\n  }\n\n  if (reply.substring(reply.length - 2) == \", \") {\n    reply = reply.substring(0, reply.length - 2);\n  }\n  reply += \"}\";\n\n  return reply;\n};\n\n/** @private Returns the classname of supplied argument obj */\ndwr.engine._errorClasses = { \"Error\":Error, \"EvalError\":EvalError, \"RangeError\":RangeError, \"ReferenceError\":ReferenceError, \"SyntaxError\":SyntaxError, \"TypeError\":TypeError, \"URIError\":URIError };\ndwr.engine._getObjectClassName = function(obj) {\n  // Try to find the classname by stringifying the object's constructor\n  // and extract <class> from \"function <class>\".\n  if (obj && obj.constructor && obj.constructor.toString)\n  {\n    var str = obj.constructor.toString();\n    var regexpmatch = str.match(/function\\s+(\\w+)/);\n    if (regexpmatch && regexpmatch.length == 2) {\n      return regexpmatch[1];\n    }\n  }\n\n  // Now manually test against the core Error classes, as these in some \n  // browsers successfully match to the wrong class in the \n  // Object.toString() test we will do later\n  if (obj && obj.constructor) {\n    for (var errorname in dwr.engine._errorClasses) {\n      if (obj.constructor == dwr.engine._errorClasses[errorname]) return errorname;\n    }\n  }\n\n  // Try to find the classname by calling Object.toString() on the object\n  // and extracting <class> from \"[object <class>]\"\n  if (obj) {\n    var str = Object.prototype.toString.call(obj);\n    var regexpmatch = str.match(/\\[object\\s+(\\w+)/);\n    if (regexpmatch && regexpmatch.length==2) {\n      return regexpmatch[1];\n    }\n  }\n\n  // Supplied argument was probably not an object, but what is better?\n  return \"Object\";\n};\n\n/** @private Marshall an object */\ndwr.engine._serializeXml = function(batch, referto, data, name) {\n  var ref = dwr.engine._lookup(referto, data, name);\n  if (ref) return ref;\n\n  var output;\n  if (window.XMLSerializer) output = new XMLSerializer().serializeToString(data);\n  else if (data.toXml) output = data.toXml;\n  else output = data.innerHTML;\n\n  return \"XML:\" + encodeURIComponent(output);\n};\n\n/** @private Marshall an array */\ndwr.engine._serializeArray = function(batch, referto, data, name) {\n  var ref = dwr.engine._lookup(referto, data, name);\n  if (ref) return ref;\n\n  if (document.all && !window.opera) {\n    // Use array joining on IE (fastest)\n    var buf = [\"Array:[\"];\n    for (var i = 0; i < data.length; i++) {\n      if (i != 0) buf.push(\",\");\n      batch.paramCount++;\n      var childName = \"c\" + dwr.engine._batch.map.callCount + \"-e\" + batch.paramCount;\n      dwr.engine._serializeAll(batch, referto, data[i], childName);\n      buf.push(\"reference:\");\n      buf.push(childName);\n    }\n    buf.push(\"]\");\n    reply = buf.join(\"\");\n  }\n  else {\n    // Use string concat on other browsers (fastest)\n    var reply = \"Array:[\";\n    for (var i = 0; i < data.length; i++) {\n      if (i != 0) reply += \",\";\n      batch.paramCount++;\n      var childName = \"c\" + dwr.engine._batch.map.callCount + \"-e\" + batch.paramCount;\n      dwr.engine._serializeAll(batch, referto, data[i], childName);\n      reply += \"reference:\";\n      reply += childName;\n    }\n    reply += \"]\";\n  }\n\n  return reply;\n};\n\n/** @private Convert an XML string into a DOM object. */\ndwr.engine._unserializeDocument = function(xml) {\n  var dom;\n  if (window.DOMParser) {\n    var parser = new DOMParser();\n    dom = parser.parseFromString(xml, \"text/xml\");\n    if (!dom.documentElement || dom.documentElement.tagName == \"parsererror\") {\n      var message = dom.documentElement.firstChild.data;\n      message += \"\\n\" + dom.documentElement.firstChild.nextSibling.firstChild.data;\n      throw message;\n    }\n    return dom;\n  }\n  else if (window.ActiveXObject) {\n    dom = dwr.engine._newActiveXObject(dwr.engine._DOMDocument);\n    dom.loadXML(xml); // What happens on parse fail with IE?\n    return dom;\n  }\n  else {\n    var div = document.createElement(\"div\");\n    div.innerHTML = xml;\n    return div;\n  }\n};\n\n/** @param axarray An array of strings to attempt to create ActiveX objects from */\ndwr.engine._newActiveXObject = function(axarray) {\n  var returnValue;  \n  for (var i = 0; i < axarray.length; i++) {\n    try {\n      returnValue = new ActiveXObject(axarray[i]);\n      break;\n    }\n    catch (ex) { /* ignore */ }\n  }\n  return returnValue;\n};\n\n/** @private Used internally when some message needs to get to the programmer */\ndwr.engine._debug = function(message, stacktrace) {\n  var written = false;\n  try {\n    if (window.console) {\n      if (stacktrace && window.console.trace) window.console.trace();\n      window.console.log(message);\n      written = true;\n    }\n    else if (window.opera && window.opera.postError) {\n      window.opera.postError(message);\n      written = true;\n    }\n  }\n  catch (ex) { /* ignore */ }\n\n  if (!written) {\n    var debug = document.getElementById(\"dwr-debug\");\n    if (debug) {\n      var contents = message + \"<br/>\" + debug.innerHTML;\n      if (contents.length > 2048) contents = contents.substring(0, 2048);\n      debug.innerHTML = contents;\n    }\n  }\n};\n\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 464,
          "bodySize": 47356
        },
        "cache": {},
        "timings": {
          "send": 6,
          "wait": 0,
          "receive": 1
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8631"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.616-07:00",
        "time": 86,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/dwr/util.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 318,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "WWW-Authenticate",
              "value": "Negotiate"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1293"
            }
          ],
          "content": {
            "size": 1293,
            "compression": 0,
            "mimeType": "text/html",
            "text": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;} \r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;} \r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} \r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n <div class=\"content-container\"><fieldset>\r\n  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>\r\n  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>\r\n </fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 216,
          "bodySize": 1293
        },
        "cache": {},
        "timings": {
          "send": 4,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8634"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.702-07:00",
        "time": 22,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/dwr/util.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAABAAAAB7IIogsACwAvAAAADwAPACAAAABET0MxWlRVTTExNjg3ODFET0MxLldBLkxDTA=="
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 420,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html; charset=us-ascii"
            },
            {
              "name": "Server",
              "value": "Microsoft-HTTPAPI/2.0"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM TlRMTVNTUAACAAAACAAIADgAAAAFgomih0Xd+uOE7aoAAAAAAAAAAJYAlgBAAAAABgGxHQAAAA9EAE8AQwAxAAIACABEAE8AQwAxAAEAGABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAEABYARABPAEMAMQAuAHcAYQAuAGwAYwBsAAMAMABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAuAEQATwBDADEALgB3AGEALgBsAGMAbAAFAAwAdwBhAC4AbABjAGwABwAIAADChcMENNQBAAAAAA=="
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "341"
            }
          ],
          "content": {
            "size": 341,
            "compression": 0,
            "mimeType": "text/html; charset=us-ascii",
            "text": "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\">\r\n<HTML><HEAD><TITLE>Not Authorized</TITLE>\r\n<META HTTP-EQUIV=\"Content-Type\" Content=\"text/html; charset=us-ascii\"></HEAD>\r\n<BODY><h2>Not Authorized</h2>\r\n<hr><p>HTTP Error 401. The requested resource requires user authentication.</p>\r\n</BODY></HTML>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 474,
          "bodySize": 341
        },
        "cache": {},
        "timings": {
          "send": 20,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8634"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.724-07:00",
        "time": 21,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/dwr/util.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAADAAAAGAAYAJwAAAAYABgAtAAAABYAFgBAAAAAKAAoAFYAAAAeAB4AfgAAAAAAAADMAAAABYKIokQATwBDADEALgBXAEEALgBMAEMATABzAHYAYwB3AGEAdQB0AGUAcwB0AHUAcwBlAHIAMAAxAGQAbwBjADEARABPAEMAMQBaAFQAVQBNADEAMQA2ADgANwA4ADEAwXyMBkdoiBIAAAAAAAAAAAAAAAAAAAAAja4X8JpsH6BFf+kjVWO7OkyKJY5DW5QP"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 612,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/javascript; charset=utf-8"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Last-Modified",
              "value": "Mon, 13 Aug 2018 16:13:45 GMT"
            },
            {
              "name": "ETag",
              "value": "\"1534176825000\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Connection",
              "value": "close"
            }
          ],
          "content": {
            "size": 46649,
            "compression": 0,
            "mimeType": "text/javascript; charset=utf-8",
            "text": "/*\n * Copyright 2005 Joe Walker\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Declare an object to which we can add real functions.\n */\nif (dwr == null) var dwr = {};\nif (dwr.util == null) dwr.util = {};\nif (DWRUtil == null) var DWRUtil = dwr.util;\n\n/** @private The flag we use to decide if we should escape html */\ndwr.util._escapeHtml = true;\n\n/**\n * Set the global escapeHtml flag\n */\ndwr.util.setEscapeHtml = function(escapeHtml) {\n  dwr.util._escapeHtml = escapeHtml;\n};\n\n/** @private Work out from an options list and global settings if we should be esccaping */\ndwr.util._shouldEscapeHtml = function(options) {\n  if (options && options.escapeHtml != null) {\n    return options.escapeHtml;\n  }\n  return dwr.util._escapeHtml;\n};\n\n/**\n * Return a string with &, < and > replaced with their entities\n * @see TODO\n */\ndwr.util.escapeHtml = function(original) {\n  return original.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');\n};\n\n/**\n * Replace common XML entities with characters (see dwr.util.escapeHtml())\n * @see TODO\n */\ndwr.util.unescapeHtml = function(original) {\n  return original.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>');\n};\n\n/**\n * Replace characters dangerous for XSS reasons with visually similar characters\n * @see TODO\n */\ndwr.util.replaceXmlCharacters = function(original) {\n  original = original.replace(\"&\", \"+\");\n  original = original.replace(\"<\", \"\\u2039\");\n  original = original.replace(\">\", \"\\u203A\");\n  original = original.replace(\"\\'\", \"\\u2018\");\n  original = original.replace(\"\\\"\", \"\\u201C\");\n  return original;\n};\n\n/**\n * Return true iff the input string contains any XSS dangerous characters\n * @see TODO\n */\ndwr.util.containsXssRiskyCharacters = function(original) {\n  return (original.indexOf('&') != -1\n    || original.indexOf('<') != -1\n    || original.indexOf('>') != -1\n    || original.indexOf('\\'') != -1\n    || original.indexOf('\\\"') != -1);\n};\n\n/**\n * Enables you to react to return being pressed in an input\n * @see http://getahead.org/dwr/browser/util/selectrange\n */\ndwr.util.onReturn = function(event, action) {\n  if (!event) event = window.event;\n  if (event && event.keyCode && event.keyCode == 13) action();\n};\n\n/**\n * Select a specific range in a text box. Useful for 'google suggest' type functions.\n * @see http://getahead.org/dwr/browser/util/selectrange\n */\ndwr.util.selectRange = function(ele, start, end) {\n  ele = dwr.util._getElementById(ele, \"selectRange()\");\n  if (ele == null) return;\n  if (ele.setSelectionRange) {\n    ele.setSelectionRange(start, end);\n  }\n  else if (ele.createTextRange) {\n    var range = ele.createTextRange();\n    range.moveStart(\"character\", start);\n    range.moveEnd(\"character\", end - ele.value.length);\n    range.select();\n  }\n  ele.focus();\n};\n\n/**\n * Find the element in the current HTML document with the given id or ids\n * @see http://getahead.org/dwr/browser/util/$\n */\nif (document.getElementById) {\n  dwr.util.byId = function() {\n    var elements = new Array();\n    for (var i = 0; i < arguments.length; i++) {\n      var element = arguments[i];\n      if (typeof element == 'string') {\n        element = document.getElementById(element);\n      }\n      if (arguments.length == 1) {\n        return element;\n      }\n      elements.push(element);\n    }\n    return elements;\n  };\n}\nelse if (document.all) {\n  dwr.util.byId = function() {\n    var elements = new Array();\n    for (var i = 0; i < arguments.length; i++) {\n      var element = arguments[i];\n      if (typeof element == 'string') {\n        element = document.all[element];\n      }\n      if (arguments.length == 1) {\n        return element;\n      }\n      elements.push(element);\n    }\n    return elements;\n  };\n}\n\n/**\n * Alias $ to dwr.util.byId\n * @see http://getahead.org/dwr/browser/util/$\n */\nif (window['$'] == null) {\n  window['$'] = dwr.util.byId;\n}\n\n/**\n * This function pretty-prints simple data or whole object graphs, f ex as an aid in debugging.\n * @see http://getahead.org/dwr/browser/util/todescriptivestring\n */\ndwr.util.toDescriptiveString = function(data, showLevels, options) {\n  if (showLevels === undefined) showLevels = 1;\n  var opt = {};\n  if (dwr.util._isObject(options)) opt = options;\n  var defaultoptions = {\n    escapeHtml:false,\n    baseIndent: \"\",\n    childIndent: \"\\u00A0\\u00A0\",\n    lineTerminator: \"\\n\",\n    oneLineMaxItems: 5,\n    shortStringMaxLength: 13,\n    propertyNameMaxLength: 30 \n  };\n  for (var p in defaultoptions) {\n    if (!(p in opt)) {\n      opt[p] = defaultoptions[p];\n    }\n  }\n\n  var skipDomProperties = {\n    document:true, ownerDocument:true,\n    all:true,\n    parentElement:true, parentNode:true, offsetParent:true,\n    children:true, firstChild:true, lastChild:true,\n    previousSibling:true, nextSibling:true,\n    innerHTML:true, outerHTML:true,\n    innerText:true, outerText:true, textContent:true,\n    attributes:true,\n    style:true, currentStyle:true, runtimeStyle:true,\n    parentTextEdit:true\n  };\n  \n  function recursive(data, showLevels, indentDepth, options) {\n    var reply = \"\";\n    try {\n      // string\n      if (typeof data == \"string\") {\n        var str = data;\n        if (showLevels == 0 && str.length > options.shortStringMaxLength)\n          str = str.substring(0, options.shortStringMaxLength-3) + \"...\";\n        if (options.escapeHtml) {\n          // Do the escape separately for every line as escapeHtml() on some \n          // browsers (IE) will strip line breaks and we want to preserve them\n          var lines = str.split(\"\\n\");\n          for (var i = 0; i < lines.length; i++) lines[i] = dwr.util.escapeHtml(lines[i]);\n          str = lines.join(\"\\n\");\n        }\n        if (showLevels == 0) { // Short format\n          str = str.replace(/\\n|\\r|\\t/g, function(ch) {\n            switch (ch) {\n              case \"\\n\": return \"\\\\n\";\n              case \"\\r\": return \"\";\n              case \"\\t\": return \"\\\\t\";\n            }\n          });\n        }\n        else { // Long format\n          str = str.replace(/\\n|\\r|\\t/g, function(ch) {\n            switch (ch) {\n              case \"\\n\": return options.lineTerminator + indent(indentDepth+1, options);\n              case \"\\r\": return \"\";\n              case \"\\t\": return \"\\\\t\";\n            }\n          });\n        }\n        reply = '\"' + str + '\"';\n      }\n      \n      // function\n      else if (typeof data == \"function\") {\n        reply = \"function\";\n      }\n    \n      // Array\n      else if (dwr.util._isArray(data)) {\n        if (showLevels == 0) { // Short format (don't show items)\n          if (data.length > 0)\n            reply = \"[...]\";\n          else\n            reply = \"[]\";\n        }\n        else { // Long format (show items)\n          var strarr = [];\n          strarr.push(\"[\");\n          var count = 0;\n          for (var i = 0; i < data.length; i++) {\n            if (! (i in data)) continue;\n            var itemvalue = data[i];\n            if (count > 0) strarr.push(\", \");\n            if (showLevels == 1) { // One-line format\n              if (count == options.oneLineMaxItems) {\n                strarr.push(\"...\");\n                break;\n              }\n            }\n            else { // Multi-line format\n              strarr.push(options.lineTerminator + indent(indentDepth+1, options));\n            }\n            if (i != count) {\n              strarr.push(i);\n              strarr.push(\":\");\n            }\n            strarr.push(recursive(itemvalue, showLevels-1, indentDepth+1, options));\n            count++;\n          }\n          if (showLevels > 1) strarr.push(options.lineTerminator + indent(indentDepth, options));\n          strarr.push(\"]\");\n          reply = strarr.join(\"\");\n        }\n      }\n      \n      // Objects except Date\n      else if (dwr.util._isObject(data) && !dwr.util._isDate(data)) {\n        if (showLevels == 0) { // Short format (don't show properties)\n          reply = dwr.util._detailedTypeOf(data);\n        }\n        else { // Long format (show properties)\n          var strarr = [];\n          if (dwr.util._detailedTypeOf(data) != \"Object\") {\n            strarr.push(dwr.util._detailedTypeOf(data));\n            if (typeof data.valueOf() != \"object\") {\n              strarr.push(\":\");\n              strarr.push(recursive(data.valueOf(), 1, indentDepth, options));\n            }\n            strarr.push(\" \");\n          }\n          strarr.push(\"{\");\n          var isDomObject = dwr.util._isHTMLElement(data); \n          var count = 0;\n          for (var prop in data) {\n            var propvalue = data[prop];\n            if (isDomObject) {\n              if (!propvalue) continue;\n              if (typeof propvalue == \"function\") continue;\n              if (skipDomProperties[prop]) continue;\n              if (prop.toUpperCase() == prop) continue;\n            }\n            if (count > 0) strarr.push(\", \");\n            if (showLevels == 1) { // One-line format\n              if (count == options.oneLineMaxItems) {\n                strarr.push(\"...\");\n                break;\n              }\n            }\n            else { // Multi-line format\n              strarr.push(options.lineTerminator + indent(indentDepth+1, options));\n            }\n            strarr.push(prop.length > options.propertyNameMaxLength ? prop.substring(0, options.propertyNameMaxLength-3) + \"...\" : prop);\n            strarr.push(\":\");\n            strarr.push(recursive(propvalue, showLevels-1, indentDepth+1, options));\n            count++;\n          }\n          if (showLevels > 1 && count > 0) strarr.push(options.lineTerminator + indent(indentDepth, options));\n          strarr.push(\"}\");\n          reply = strarr.join(\"\");\n        }\n      }\n  \n      // undefined, null, number, boolean, Date\n      else {\n        reply = \"\" + data;\n      }\n  \n      return reply;\n    }\n    catch(err) {\n      return (err.message ? err.message : \"\"+err);\n    }\n  }\n\n  function indent(count, options) {\n    var strarr = [];\n    strarr.push(options.baseIndent);\n    for (var i=0; i<count; i++) {\n      strarr.push(options.childIndent);\n    }\n    return strarr.join(\"\");\n  };\n  \n  return recursive(data, showLevels, 0, opt);\n};\n\n/**\n * Setup a GMail style loading message.\n * @see http://getahead.org/dwr/browser/util/useloadingmessage\n */\ndwr.util.useLoadingMessage = function(message) {\n  var loadingMessage;\n  if (message) loadingMessage = message;\n  else loadingMessage = \"Loading\";\n  dwr.engine.setPreHook(function() {\n    var disabledZone = dwr.util.byId('disabledZone');\n    if (!disabledZone) {\n      disabledZone = document.createElement('div');\n      disabledZone.setAttribute('id', 'disabledZone');\n      disabledZone.style.position = \"absolute\";\n      disabledZone.style.zIndex = \"1000\";\n      disabledZone.style.left = \"0px\";\n      disabledZone.style.top = \"0px\";\n      disabledZone.style.width = \"100%\";\n      disabledZone.style.height = \"100%\";\n      document.body.appendChild(disabledZone);\n      var messageZone = document.createElement('div');\n      messageZone.setAttribute('id', 'messageZone');\n      messageZone.style.position = \"absolute\";\n      messageZone.style.top = \"0px\";\n      messageZone.style.right = \"0px\";\n      messageZone.style.background = \"red\";\n      messageZone.style.color = \"white\";\n      messageZone.style.fontFamily = \"Arial,Helvetica,sans-serif\";\n      messageZone.style.padding = \"4px\";\n      disabledZone.appendChild(messageZone);\n      var text = document.createTextNode(loadingMessage);\n      messageZone.appendChild(text);\n      dwr.util._disabledZoneUseCount = 1;\n    }\n    else {\n      dwr.util.byId('messageZone').innerHTML = loadingMessage;\n      disabledZone.style.visibility = 'visible';\n      dwr.util._disabledZoneUseCount++;\n    }\n  });\n  dwr.engine.setPostHook(function() {\n    dwr.util._disabledZoneUseCount--;\n    if (dwr.util._disabledZoneUseCount == 0) {\n      dwr.util.byId('disabledZone').style.visibility = 'hidden';\n    }\n  });\n};\n\n/**\n * Set a global highlight handler\n */\ndwr.util.setHighlightHandler = function(handler) {\n  dwr.util._highlightHandler = handler;\n};\n\n/**\n * An example highlight handler\n */\ndwr.util.yellowFadeHighlightHandler = function(ele) {\n  dwr.util._yellowFadeProcess(ele, 0);\n};\ndwr.util._yellowFadeSteps = [ \"d0\", \"b0\", \"a0\", \"90\", \"98\", \"a0\", \"a8\", \"b0\", \"b8\", \"c0\", \"c8\", \"d0\", \"d8\", \"e0\", \"e8\", \"f0\", \"f8\" ];\ndwr.util._yellowFadeProcess = function(ele, colorIndex) {\n  ele = dwr.util.byId(ele);\n  if (colorIndex < dwr.util._yellowFadeSteps.length) {\n    ele.style.backgroundColor = \"#ffff\" + dwr.util._yellowFadeSteps[colorIndex];\n    setTimeout(\"dwr.util._yellowFadeProcess('\" + ele.id + \"',\" + (colorIndex + 1) + \")\", 200);\n  }\n  else {\n    ele.style.backgroundColor = \"transparent\";\n  }\n};\n\n/**\n * An example highlight handler\n */\ndwr.util.borderFadeHighlightHandler = function(ele) {\n  ele.style.borderWidth = \"2px\";\n  ele.style.borderStyle = \"solid\";\n  dwr.util._borderFadeProcess(ele, 0);\n};\ndwr.util._borderFadeSteps = [ \"d0\", \"b0\", \"a0\", \"90\", \"98\", \"a0\", \"a8\", \"b0\", \"b8\", \"c0\", \"c8\", \"d0\", \"d8\", \"e0\", \"e8\", \"f0\", \"f8\" ];\ndwr.util._borderFadeProcess = function(ele, colorIndex) {\n  ele = dwr.util.byId(ele);\n  if (colorIndex < dwr.util._borderFadeSteps.length) {\n    ele.style.borderColor = \"#ff\" + dwr.util._borderFadeSteps[colorIndex] + dwr.util._borderFadeSteps[colorIndex];\n    setTimeout(\"dwr.util._borderFadeProcess('\" + ele.id + \"',\" + (colorIndex + 1) + \")\", 200);\n  }\n  else {\n    ele.style.backgroundColor = \"transparent\";\n  }\n};\n\n/**\n * A focus highlight handler\n */\ndwr.util.focusHighlightHandler = function(ele) {\n  try {\n    ele.focus();\n  }\n  catch (ex) { /* ignore */ }\n};\n\n/** @private the current global highlight style */\ndwr.util._highlightHandler = null;\n\n/**\n * Highlight that an element has changed\n */\ndwr.util.highlight = function(ele, options) {\n  if (options && options.highlightHandler) {\n    options.highlightHandler(dwr.util.byId(ele));\n  }\n  else if (dwr.util._highlightHandler != null) {\n    dwr.util._highlightHandler(dwr.util.byId(ele));\n  }\n};\n\n/**\n * Set the value an HTML element to the specified value.\n * @see http://getahead.org/dwr/browser/util/setvalue\n */\ndwr.util.setValue = function(ele, val, options) {\n  if (val == null) val = \"\";\n  if (options == null) options = {};\n\n  var orig = ele;\n  if (typeof ele == \"string\") {\n    ele = dwr.util.byId(ele);\n    // We can work with names and need to sometimes for radio buttons, and IE has\n    // an annoying bug where getElementById() returns an element based on name if\n    // it doesn't find it by id. Here we don't want to do that, so:\n    if (ele && ele.id != orig) ele = null;\n  }\n  var nodes = null;\n  if (ele == null) {\n    // Now it is time to look by name\n    nodes = document.getElementsByName(orig);\n    if (nodes.length >= 1) ele = nodes.item(0);\n  }\n\n  if (ele == null) {\n    dwr.util._debug(\"setValue() can't find an element with id/name: \" + orig + \".\");\n    return;\n  }\n\n  // All paths now lead to some update so we highlight a change\n  dwr.util.highlight(ele, options);\n\n  if (dwr.util._isHTMLElement(ele, \"select\")) {\n    if (ele.type == \"select-multiple\" && dwr.util._isArray(val)) dwr.util._selectListItems(ele, val);\n    else dwr.util._selectListItem(ele, val);\n    return;\n  }\n\n  if (dwr.util._isHTMLElement(ele, \"input\")) {\n    if (ele.type == \"radio\" || ele.type == \"checkbox\") {\n      if (nodes && nodes.length >= 1) {\n        for (var i = 0; i < nodes.length; i++) {\n          var node = nodes.item(i);\n          if (node.type != ele.type) continue;\n          if (dwr.util._isArray(val)) {\n            node.checked = false;\n            for (var j = 0; j < val.length; j++)\n              if (val[j] == node.value) node.checked = true;\n          }\n          else {\n            node.checked = (node.value == val);\n          }\n        }\n      }\n      else {\n        ele.checked = (val == true);\n      }\n    }\n    else ele.value = val;\n\n    return;\n  }\n\n  if (dwr.util._isHTMLElement(ele, \"textarea\")) {\n    ele.value = val;\n    return;\n  }\n\n  // If the value to be set is a DOM object then we try importing the node\n  // rather than serializing it out\n  if (val.nodeType) {\n    if (val.nodeType == 9 /*Node.DOCUMENT_NODE*/) val = val.documentElement;\n    val = dwr.util._importNode(ele.ownerDocument, val, true);\n    ele.appendChild(val);\n    return;\n  }\n\n  // Fall back to innerHTML and friends\n  if (dwr.util._shouldEscapeHtml(options)) {\n    if (\"textContent\" in ele) ele.textContent = val.toString();\n    else if (\"innerText\" in ele) ele.innerText = val.toString();\n    else ele.innerHTML = dwr.util.escapeHtml(val.toString());\n  }\n  else {\n    ele.innerHTML = val;\n  }\n};\n\n/**\n * @private Find multiple items in a select list and select them. Used by setValue()\n * @param ele The select list item\n * @param val The array of values to select\n */\ndwr.util._selectListItems = function(ele, val) {\n  // We deal with select list elements by selecting the matching option\n  // Begin by searching through the values\n  var found  = false;\n  var i;\n  var j;\n  for (i = 0; i < ele.options.length; i++) {\n    ele.options[i].selected = false;\n    for (j = 0; j < val.length; j++) {\n      if (ele.options[i].value == val[j]) {\n        ele.options[i].selected = true;\n      }\n    }\n  }\n  // If that fails then try searching through the visible text\n  if (found) return;\n\n  for (i = 0; i < ele.options.length; i++) {\n    for (j = 0; j < val.length; j++) {\n      if (ele.options[i].text == val[j]) {\n        ele.options[i].selected = true;\n      }\n    }\n  }\n};\n\n/**\n * @private Find an item in a select list and select it. Used by setValue()\n * @param ele The select list item\n * @param val The value to select\n */\ndwr.util._selectListItem = function(ele, val) {\n  // We deal with select list elements by selecting the matching option\n  // Begin by searching through the values\n  var found = false;\n  var i;\n  for (i = 0; i < ele.options.length; i++) {\n    if (ele.options[i].value == val) {\n      ele.options[i].selected = true;\n      found = true;\n    }\n    else {\n      ele.options[i].selected = false;\n    }\n  }\n\n  // If that fails then try searching through the visible text\n  if (found) return;\n\n  for (i = 0; i < ele.options.length; i++) {\n    ele.options[i].selected = (ele.options[i].text == val);\n  }\n};\n\n/**\n * Read the current value for a given HTML element.\n * @see http://getahead.org/dwr/browser/util/getvalue\n */\ndwr.util.getValue = function(ele, options) {\n  if (options == null) options = {};\n  var orig = ele;\n  if (typeof ele == \"string\") {\n    ele = dwr.util.byId(ele);\n    // We can work with names and need to sometimes for radio buttons, and IE has\n    // an annoying bug where getElementById() returns an element based on name if\n    // it doesn't find it by id. Here we don't want to do that, so:\n    if (ele && ele.id != orig) ele = null;\n  }\n  var nodes = null;\n  if (ele == null) {\n    // Now it is time to look by name\n    nodes = document.getElementsByName(orig);\n    if (nodes.length >= 1) ele = nodes.item(0);\n  }\n  if (ele == null) {\n    dwr.util._debug(\"getValue() can't find an element with id/name: \" + orig + \".\");\n    return \"\";\n  }\n\n  if (dwr.util._isHTMLElement(ele, \"select\")) {\n    // Using \"type\" property instead of \"multiple\" as \"type\" is an official \n    // client-side property since JS 1.1\n    if (ele.type == \"select-multiple\") {\n      var reply = new Array();\n      for (var i = 0; i < ele.options.length; i++) {\n        var item = ele.options[i];\n        if (item.selected) {\n          var valueAttr = item.getAttributeNode(\"value\");\n          if (valueAttr && valueAttr.specified) {\n            reply.push(item.value);\n          }\n          else {\n            reply.push(item.text);\n          }\n        }\n      }\n      return reply;\n    }\n    else {\n      var sel = ele.selectedIndex;\n      if (sel != -1) {\n        var item = ele.options[sel];\n        var valueAttr = item.getAttributeNode(\"value\");\n        if (valueAttr && valueAttr.specified) {\n          return item.value;\n        }\n        return item.text;\n      }\n      else {\n        return \"\";\n      }\n    }\n  }\n\n  if (dwr.util._isHTMLElement(ele, \"input\")) {\n    if (ele.type == \"radio\") {\n      if (nodes && nodes.length >= 1) {\n        for (var i = 0; i < nodes.length; i++) {\n          var node = nodes.item(i);\n          if (node.type == ele.type) {\n            if (node.checked) return node.value;\n          }\n        }\n      }\n      return ele.checked;\n    }\n    if (ele.type == \"checkbox\") {\n      if (nodes && nodes.length >= 1) {\n        var reply = [];\n        for (var i = 0; i < nodes.length; i++) {\n          var node = nodes.item(i);\n          if (node.type == ele.type) {\n            if (node.checked) reply.push(node.value);\n          }\n        }\n        return reply;\n      }\n      return ele.checked;\n    }\n    return ele.value;\n  }\n\n  if (dwr.util._isHTMLElement(ele, \"textarea\")) {\n    return ele.value;\n  }\n\n  if (dwr.util._shouldEscapeHtml(options)) {\n    if (ele.textContent) return ele.textContent;\n    else if (ele.innerText) return ele.innerText;\n  }\n  return ele.innerHTML;\n};\n\n/**\n * getText() is like getValue() except that it reads the text (and not the value) from select elements\n * @see http://getahead.org/dwr/browser/util/gettext\n */\ndwr.util.getText = function(ele) {\n  ele = dwr.util._getElementById(ele, \"getText()\");\n  if (ele == null) return null;\n  if (!dwr.util._isHTMLElement(ele, \"select\")) {\n    dwr.util._debug(\"getText() can only be used with select elements. Attempt to use: \" + dwr.util._detailedTypeOf(ele) + \" from  id: \" + orig + \".\");\n    return \"\";\n  }\n\n  // This is a bit of a scam because it assumes single select\n  // but I'm not sure how we should treat multi-select.\n  var sel = ele.selectedIndex;\n  if (sel != -1) {\n    return ele.options[sel].text;\n  }\n  else {\n    return \"\";\n  }\n};\n\n/**\n * Given a map, or a recursive structure consisting of arrays and maps, call \n * setValue() for all leaf entries and use intermediate levels to form nested\n * element ids.\n * @see http://getahead.org/dwr/browser/util/setvalues\n */\ndwr.util.setValues = function(data, options) {\n  var prefix = \"\";\n  var depth = 100;\n  if (options && options.prefix) prefix = options.prefix;\n  if (options && options.idPrefix) prefix = options.idPrefix;\n  if (options && \"depth\" in options) depth = options.depth;\n  dwr.util._setValuesRecursive(data, prefix, depth, options);\n};\n\n/**\n * @private Recursive helper for setValues()\n */\ndwr.util._setValuesRecursive = function(data, idpath, depth, options) {\n  if (depth == 0) return;\n  // Array containing objects -> add \"[n]\" to prefix and make recursive call\n  // for each item object\n  if (dwr.util._isArray(data) && data.length > 0 && dwr.util._isObject(data[0])) {\n    for (var i = 0; i < data.length; i++) {\n      dwr.util._setValuesRecursive(data[i], idpath+\"[\"+i+\"]\", depth-1, options);\n    }\n  }\n  // Object (not array) -> handle nested object properties\n  else if (dwr.util._isObject(data) && !dwr.util._isArray(data)) {\n    for (var prop in data) {\n      var subidpath = idpath ? idpath+\".\"+prop : prop;\n      // Object (not array), or array containing objects -> call ourselves recursively\n      if (dwr.util._isObject(data[prop]) && !dwr.util._isArray(data[prop]) && !dwr.util._isDate(data[prop]) \n          || dwr.util._isArray(data[prop]) && data[prop].length > 0 && dwr.util._isObject(data[prop][0])) {\n        dwr.util._setValuesRecursive(data[prop], subidpath, depth-1, options);\n      }\n      // Functions -> skip\n      else if (typeof data[prop] == \"function\") {\n        // NOP\n      }\n      // Only simple values left (or array of simple values, or empty array)\n      // -> call setValue()\n      else {\n        // Are there any elements with that id or name\n        if (dwr.util.byId(subidpath) != null || document.getElementsByName(subidpath).length >= 1) {\n          dwr.util.setValue(subidpath, data[prop], options);\n        }\n      }\n    }\n  }\n};\n\n/**\n * Given a map, or a recursive structure consisting of arrays and maps, call \n * getValue() for all leaf entries and use intermediate levels to form nested\n * element ids.\n * Given a string or element that refers to a form, create an object from the \n * elements of the form.\n * @see http://getahead.org/dwr/browser/util/getvalues\n */\ndwr.util.getValues = function(data, options) {\n  if (typeof data == \"string\" || dwr.util._isHTMLElement(data)) {\n    return dwr.util.getFormValues(data);\n  }\n  else {\n    var prefix = \"\";\n    var depth = 100;\n    if (options != null && options.prefix) prefix = options.prefix;\n    if (options != null && options.idPrefix) prefix = options.idPrefix;\n    if (options != null && \"depth\" in options) depth = options.depth;\n    dwr.util._getValuesRecursive(data, prefix, depth, options);\n    return data;\n  }\n};\n\n/**\n * Given a string or element that refers to a form, create an object from the \n * elements of the form.\n * @see http://getahead.org/dwr/browser/util/getvalues\n */\ndwr.util.getFormValues = function(eleOrNameOrId) {\n  var ele = null;\n  if (typeof eleOrNameOrId == \"string\") {\n    ele = document.forms[eleOrNameOrId];\n    if (ele == null) ele = dwr.util.byId(eleOrNameOrId);\n  }\n  else if (dwr.util._isHTMLElement(eleOrNameOrId)) {\n    ele = eleOrNameOrId;\n  }\n  if (ele != null) {\n    if (ele.elements == null) {\n      alert(\"getFormValues() requires an object or reference to a form element.\");\n      return null;\n    }\n    var reply = {};\n    var name;\n    var value;\n    for (var i = 0; i < ele.elements.length; i++) {\n      if (ele[i].type in {button:0,submit:0,reset:0,image:0,file:0}) continue;\n      if (ele[i].name) {\n        name = ele[i].name;\n        value = dwr.util.getValue(name);\n      }\n      else {\n        if (ele[i].id) name = ele[i].id;\n        else name = \"element\" + i;\n        value = dwr.util.getValue(ele[i]);\n      }\n      reply[name] = value;\n    }\n    return reply;\n  }\n};\n\n/**\n * @private Recursive helper for getValues().\n */\ndwr.util._getValuesRecursive = function(data, idpath, depth, options) {\n  if (depth == 0) return;\n  // Array containing objects -> add \"[n]\" to idpath and make recursive call\n  // for each item object\n  if (dwr.util._isArray(data) && data.length > 0 && dwr.util._isObject(data[0])) {\n    for (var i = 0; i < data.length; i++) {\n      dwr.util._getValuesRecursive(data[i], idpath+\"[\"+i+\"]\", depth-1, options);\n    }\n  }\n  // Object (not array) -> handle nested object properties\n  else if (dwr.util._isObject(data) && !dwr.util._isArray(data)) {\n    for (var prop in data) {\n      var subidpath = idpath ? idpath+\".\"+prop : prop;\n      // Object, or array containing objects -> call ourselves recursively\n      if (dwr.util._isObject(data[prop]) && !dwr.util._isArray(data[prop])\n          || dwr.util._isArray(data[prop]) && data[prop].length > 0 && dwr.util._isObject(data[prop][0])) {\n        dwr.util._getValuesRecursive(data[prop], subidpath, depth-1, options);\n      }\n      // Functions -> skip\n      else if (typeof data[prop] == \"function\") {\n        // NOP\n      }\n      // Only simple values left (or array of simple values, or empty array)\n      // -> call getValue()\n      else {\n        // Are there any elements with that id or name\n        if (dwr.util.byId(subidpath) != null || document.getElementsByName(subidpath).length >= 1) {\n          data[prop] = dwr.util.getValue(subidpath);\n        }\n      }\n    }\n  }\n};\n\n/**\n * Add options to a list from an array or map.\n * @see http://getahead.org/dwr/browser/lists\n */\ndwr.util.addOptions = function(ele, data/*, options*/) {\n  ele = dwr.util._getElementById(ele, \"addOptions()\");\n  if (ele == null) return;\n  var useOptions = dwr.util._isHTMLElement(ele, \"select\");\n  var useLi = dwr.util._isHTMLElement(ele, [\"ul\", \"ol\"]);\n  if (!useOptions && !useLi) {\n    dwr.util._debug(\"addOptions() can only be used with select/ul/ol elements. Attempt to use: \" + dwr.util._detailedTypeOf(ele));\n    return;\n  }\n  if (data == null) return;\n  \n  var argcount = arguments.length;\n  var options = {};\n  var lastarg = arguments[argcount - 1]; \n  if (argcount > 2 && dwr.util._isObject(lastarg)) {\n    options = lastarg;\n    argcount--;\n  }\n  var arg3 = null; if (argcount >= 3) arg3 = arguments[2];\n  var arg4 = null; if (argcount >= 4) arg4 = arguments[3];\n  if (!options.optionCreator && useOptions) options.optionCreator = dwr.util._defaultOptionCreator;\n  if (!options.optionCreator && useLi) options.optionCreator = dwr.util._defaultListItemCreator;\n  options.document = ele.ownerDocument;\n\n  var text, value, li;\n  if (dwr.util._isArray(data)) {\n    // Loop through the data that we do have\n    for (var i = 0; i < data.length; i++) {\n      options.data = data[i];\n      options.text = null;\n      options.value = null;\n      if (useOptions) {\n        if (arg3 != null) {\n          if (arg4 != null) {\n            options.text = dwr.util._getValueFrom(data[i], arg4);\n            options.value = dwr.util._getValueFrom(data[i], arg3);\n          }\n          else options.text = options.value = dwr.util._getValueFrom(data[i], arg3);\n        }\n        else options.text = options.value = dwr.util._getValueFrom(data[i]);\n\n        if (options.text != null || options.value) {\n          var opt = options.optionCreator(options);\n          opt.text = options.text;\n          opt.value = options.value;\n          ele.options[ele.options.length] = opt;\n        }\n      }\n      else {\n        options.value = dwr.util._getValueFrom(data[i], arg3);\n        if (options.value != null) {\n          li = options.optionCreator(options);\n          if (dwr.util._shouldEscapeHtml(options)) {\n            options.value = dwr.util.escapeHtml(options.value);\n          }\n          li.innerHTML = options.value;\n          ele.appendChild(li);\n        }\n      }\n    }\n  }\n  else if (arg4 != null) {\n    if (!useOptions) {\n      alert(\"dwr.util.addOptions can only create select lists from objects.\");\n      return;\n    }\n    for (var prop in data) {\n      options.data = data[prop];\n      options.value = dwr.util._getValueFrom(data[prop], arg3);\n      options.text = dwr.util._getValueFrom(data[prop], arg4);\n\n      if (options.text != null || options.value) {\n        var opt = options.optionCreator(options);\n        opt.text = options.text;\n        opt.value = options.value;\n        ele.options[ele.options.length] = opt;\n      }\n    }\n  }\n  else {\n    if (!useOptions) {\n      dwr.util._debug(\"dwr.util.addOptions can only create select lists from objects.\");\n      return;\n    }\n    for (var prop in data) {\n      if (typeof data[prop] == \"function\") continue;\n      options.data = data[prop];\n      if (!arg3) {\n        options.value = prop;\n        options.text = data[prop];\n      }\n      else {\n        options.value = data[prop];\n        options.text = prop;\n      }\n      if (options.text != null || options.value) {\n        var opt = options.optionCreator(options);\n        opt.text = options.text;\n        opt.value = options.value;\n        ele.options[ele.options.length] = opt;\n      }\n    }\n  }\n\n  // All error routes through this function result in a return, so highlight now\n  dwr.util.highlight(ele, options); \n};\n\n/**\n * @private Get the data from an array function for dwr.util.addOptions\n */\ndwr.util._getValueFrom = function(data, method) {\n  if (method == null) return data;\n  else if (typeof method == 'function') return method(data);\n  else return data[method];\n};\n\n/**\n * @private Default option creation function\n */\ndwr.util._defaultOptionCreator = function(options) {\n  return options.document.createElement(\"option\");\n};\n\n/**\n * @private Default list item creation function\n */\ndwr.util._defaultListItemCreator = function(options) {\n  return options.document.createElement(\"li\");\n};\n\n/**\n * Remove all the options from a select list (specified by id)\n * @see http://getahead.org/dwr/browser/lists\n */\ndwr.util.removeAllOptions = function(ele) {\n  ele = dwr.util._getElementById(ele, \"removeAllOptions()\");\n  if (ele == null) return;\n  var useOptions = dwr.util._isHTMLElement(ele, \"select\");\n  var useLi = dwr.util._isHTMLElement(ele, [\"ul\", \"ol\"]);\n  if (!useOptions && !useLi) {\n    dwr.util._debug(\"removeAllOptions() can only be used with select, ol and ul elements. Attempt to use: \" + dwr.util._detailedTypeOf(ele));\n    return;\n  }\n  if (useOptions) {\n    ele.options.length = 0;\n  }\n  else {\n    while (ele.childNodes.length > 0) {\n      ele.removeChild(ele.firstChild);\n    }\n  }\n};\n\n/**\n * Create rows inside a the table, tbody, thead or tfoot element (given by id).\n * @see http://getahead.org/dwr/browser/tables\n */\ndwr.util.addRows = function(ele, data, cellFuncs, options) {\n  ele = dwr.util._getElementById(ele, \"addRows()\");\n  if (ele == null) return;\n  if (!dwr.util._isHTMLElement(ele, [\"table\", \"tbody\", \"thead\", \"tfoot\"])) {\n    dwr.util._debug(\"addRows() can only be used with table, tbody, thead and tfoot elements. Attempt to use: \" + dwr.util._detailedTypeOf(ele));\n    return;\n  }\n  if (!options) options = {};\n  if (!options.rowCreator) options.rowCreator = dwr.util._defaultRowCreator;\n  if (!options.cellCreator) options.cellCreator = dwr.util._defaultCellCreator;\n  options.document = ele.ownerDocument;\n  var tr, rowNum;\n  if (dwr.util._isArray(data)) {\n    for (rowNum = 0; rowNum < data.length; rowNum++) {\n      options.rowData = data[rowNum];\n      options.rowIndex = rowNum;\n      options.rowNum = rowNum;\n      options.data = null;\n      options.cellNum = -1;\n      tr = dwr.util._addRowInner(cellFuncs, options);\n      if (tr != null) ele.appendChild(tr);\n    }\n  }\n  else if (typeof data == \"object\") {\n    rowNum = 0;\n    for (var rowIndex in data) {\n      options.rowData = data[rowIndex];\n      options.rowIndex = rowIndex;\n      options.rowNum = rowNum;\n      options.data = null;\n      options.cellNum = -1;\n      tr = dwr.util._addRowInner(cellFuncs, options);\n      if (tr != null) ele.appendChild(tr);\n      rowNum++;\n    }\n  }\n\n  dwr.util.highlight(ele, options);\n};\n\n/**\n * @private Internal function to draw a single row of a table.\n */\ndwr.util._addRowInner = function(cellFuncs, options) {\n  var tr = options.rowCreator(options);\n  if (tr == null) return null;\n  for (var cellNum = 0; cellNum < cellFuncs.length; cellNum++) {\n    var func = cellFuncs[cellNum];\n    if (typeof func == 'function') options.data = func(options.rowData, options);\n    else options.data = func || \"\";\n    options.cellNum = cellNum;\n    var td = options.cellCreator(options);\n    if (td != null) {\n      if (options.data != null) {\n        if (dwr.util._isHTMLElement(options.data)) td.appendChild(options.data);\n        else {\n          if (dwr.util._shouldEscapeHtml(options) && typeof(options.data) == \"string\") {\n            td.innerHTML = dwr.util.escapeHtml(options.data);\n          }\n          else {\n            td.innerHTML = options.data;\n          }\n        }\n      }\n      tr.appendChild(td);\n    }\n  }\n  return tr;\n};\n\n/**\n * @private Default row creation function\n */\ndwr.util._defaultRowCreator = function(options) {\n  return options.document.createElement(\"tr\");\n};\n\n/**\n * @private Default cell creation function\n */\ndwr.util._defaultCellCreator = function(options) {\n  return options.document.createElement(\"td\");\n};\n\n/**\n * Remove all the children of a given node.\n * @see http://getahead.org/dwr/browser/tables\n */\ndwr.util.removeAllRows = function(ele, options) {\n  ele = dwr.util._getElementById(ele, \"removeAllRows()\");\n  if (ele == null) return;\n  if (!options) options = {};\n  if (!options.filter) options.filter = function() { return true; };\n  if (!dwr.util._isHTMLElement(ele, [\"table\", \"tbody\", \"thead\", \"tfoot\"])) {\n    dwr.util._debug(\"removeAllRows() can only be used with table, tbody, thead and tfoot elements. Attempt to use: \" + dwr.util._detailedTypeOf(ele));\n    return;\n  }\n  var child = ele.firstChild;\n  var next;\n  while (child != null) {\n    next = child.nextSibling;\n    if (options.filter(child)) {\n      ele.removeChild(child);\n    }\n    child = next;\n  }\n};\n\n/**\n * dwr.util.byId(ele).className = \"X\", that we can call from Java easily.\n */\ndwr.util.setClassName = function(ele, className) {\n  ele = dwr.util._getElementById(ele, \"setClassName()\");\n  if (ele == null) return;\n  ele.className = className;\n};\n\n/**\n * dwr.util.byId(ele).className += \"X\", that we can call from Java easily.\n */\ndwr.util.addClassName = function(ele, className) {\n  ele = dwr.util._getElementById(ele, \"addClassName()\");\n  if (ele == null) return;\n  ele.className += \" \" + className;\n};\n\n/**\n * dwr.util.byId(ele).className -= \"X\", that we can call from Java easily\n * From code originally by Gavin Kistner\n */\ndwr.util.removeClassName = function(ele, className) {\n  ele = dwr.util._getElementById(ele, \"removeClassName()\");\n  if (ele == null) return;\n  var regex = new RegExp(\"(^|\\\\s)\" + className + \"(\\\\s|$)\", 'g');\n  ele.className = ele.className.replace(regex, '');\n};\n\n/**\n * dwr.util.byId(ele).className |= \"X\", that we can call from Java easily.\n */\ndwr.util.toggleClassName = function(ele, className) {\n  ele = dwr.util._getElementById(ele, \"toggleClassName()\");\n  if (ele == null) return;\n  var regex = new RegExp(\"(^|\\\\s)\" + className + \"(\\\\s|$)\");\n  if (regex.test(ele.className)) {\n    ele.className = ele.className.replace(regex, '');\n  }\n  else {\n    ele.className += \" \" + className;\n  }\n};\n\n/**\n * Clone a node and insert it into the document just above the 'template' node\n * @see http://getahead.org/dwr/???\n */\ndwr.util.cloneNode = function(ele, options) {\n  ele = dwr.util._getElementById(ele, \"cloneNode()\");\n  if (ele == null) return null;\n  if (options == null) options = {};\n  var clone = ele.cloneNode(true);\n  if (options.idPrefix || options.idSuffix) {\n    dwr.util._updateIds(clone, options);\n  }\n  else {\n    dwr.util._removeIds(clone);\n  }\n  ele.parentNode.insertBefore(clone, ele);\n  return clone;\n};\n\n/**\n * @private Update all of the ids in an element tree\n */\ndwr.util._updateIds = function(ele, options) {\n  if (options == null) options = {};\n  if (ele.id) {\n    ele.setAttribute(\"id\", (options.idPrefix || \"\") + ele.id + (options.idSuffix || \"\"));\n  }\n  var children = ele.childNodes;\n  for (var i = 0; i < children.length; i++) {\n    var child = children.item(i);\n    if (child.nodeType == 1 /*Node.ELEMENT_NODE*/) {\n      dwr.util._updateIds(child, options);\n    }\n  }\n};\n\n/**\n * @private Remove all the Ids from an element\n */\ndwr.util._removeIds = function(ele) {\n  if (ele.id) ele.removeAttribute(\"id\");\n  var children = ele.childNodes;\n  for (var i = 0; i < children.length; i++) {\n    var child = children.item(i);\n    if (child.nodeType == 1 /*Node.ELEMENT_NODE*/) {\n      dwr.util._removeIds(child);\n    }\n  }\n};\n\n/**\n * Clone a template node and its embedded template child nodes according to\n * cardinalities (of arrays) in supplied data.  \n */\ndwr.util.cloneNodeForValues = function(templateEle, data, options) {\n  templateEle = dwr.util._getElementById(templateEle, \"cloneNodeForValues()\");\n  if (templateEle == null) return null;\n  if (options == null) options = {};\n  var idpath;\n  if (options.idPrefix != null)\n    idpath = options.idPrefix;\n  else\n    idpath = templateEle.id || \"\"; \n  return dwr.util._cloneNodeForValuesRecursive(templateEle, data, idpath, options);\n};\n\n/**\n * @private Recursive helper for cloneNodeForValues(). \n */\ndwr.util._cloneNodeForValuesRecursive = function(templateEle, data, idpath, options) {\n  // Incoming array -> make an id for each item and call clone of the template \n  // for each of them\n  if (dwr.util._isArray(data)) {\n    var clones = [];\n    for (var i = 0; i < data.length; i++) {\n      var item = data[i];\n      var clone = dwr.util._cloneNodeForValuesRecursive(templateEle, item, idpath + \"[\" + i + \"]\", options);\n      clones.push(clone);\n    }\n    return clones;\n  }\n  else\n  // Incoming object (not array) -> clone the template, add id prefixes, add \n  // clone to DOM, and then recurse into any array properties if they contain \n  // objects and there is a suitable template\n  if (dwr.util._isObject(data) && !dwr.util._isArray(data)) {\n    var clone = templateEle.cloneNode(true);\n    if (options.updateCloneStyle && clone.style) {\n      for (var propname in options.updateCloneStyle) {\n        clone.style[propname] = options.updateCloneStyle[propname];\n      }\n    }\n    dwr.util._replaceIds(clone, templateEle.id, idpath);\n    templateEle.parentNode.insertBefore(clone, templateEle);\n    dwr.util._cloneSubArrays(data, idpath, options);\n    return clone;\n  }\n\n  // It is an error to end up here so we return nothing\n  return null;\n};\n\n/**\n * @private Substitute a leading idpath fragment with another idpath for all \n * element ids tree, and remove ids that don't match the idpath. \n */\ndwr.util._replaceIds = function(ele, oldidpath, newidpath) {\n  if (ele.id) {\n    var newId = null;\n    if (ele.id == oldidpath) {\n      newId = newidpath;\n    }\n    else if (ele.id.length > oldidpath.length) {\n      if (ele.id.substr(0, oldidpath.length) == oldidpath) {\n        var trailingChar = ele.id.charAt(oldidpath.length);\n        if (trailingChar == \".\" || trailingChar == \"[\") {\n          newId = newidpath + ele.id.substr(oldidpath.length);\n        }\n      }\n    }\n    if (newId) {\n      ele.setAttribute(\"id\", newId);\n    }\n    else {\n      ele.removeAttribute(\"id\");\n    }\n  }\n  var children = ele.childNodes;\n  for (var i = 0; i < children.length; i++) {\n    var child = children.item(i);\n    if (child.nodeType == 1 /*Node.ELEMENT_NODE*/) {\n      dwr.util._replaceIds(child, oldidpath, newidpath);\n    }\n  }\n};\n\n/**\n * @private Finds arrays in supplied data and uses any corresponding template \n * node to make a clone for each item in the array. \n */\ndwr.util._cloneSubArrays = function(data, idpath, options) {\n  for (prop in data) {\n    var value = data[prop];\n    // Look for potential recursive cloning in all array properties\n    if (dwr.util._isArray(value)) {\n      // Only arrays with objects are interesting for cloning\n      if (value.length > 0 && dwr.util._isObject(value[0])) {\n        var subTemplateId = idpath + \".\" + prop;\n        var subTemplateEle = dwr.util.byId(subTemplateId);\n        if (subTemplateEle != null) {\n          dwr.util._cloneNodeForValuesRecursive(subTemplateEle, value, subTemplateId, options);\n        }\n      }\n    }\n    // Continue looking for arrays in object properties\n    else if (dwr.util._isObject(value)) {\n      dwr.util._cloneSubArrays(value, idpath + \".\" + prop, options);\n    }\n  }\n};\n\n/**\n * @private Helper to turn a string into an element with an error message\n */\ndwr.util._getElementById = function(ele, source) {\n  var orig = ele;\n  ele = dwr.util.byId(ele);\n  if (ele == null) {\n    dwr.util._debug(source + \" can't find an element with id: \" + orig + \".\");\n  }\n  return ele;\n};\n\n/**\n * @private Is the given node an HTML element (optionally of a given type)?\n * @param ele The element to test\n * @param nodeName eg \"input\", \"textarea\" - check for node name (optional)\n *         if nodeName is an array then check all for a match.\n */\ndwr.util._isHTMLElement = function(ele, nodeName) {\n  if (ele == null || typeof ele != \"object\" || ele.nodeName == null) {\n    return false;\n  }\n  if (nodeName != null) {\n    var test = ele.nodeName.toLowerCase();\n    if (typeof nodeName == \"string\") {\n      return test == nodeName.toLowerCase();\n    }\n    if (dwr.util._isArray(nodeName)) {\n      var match = false;\n      for (var i = 0; i < nodeName.length && !match; i++) {\n        if (test == nodeName[i].toLowerCase()) {\n          match =  true;\n        }\n      }\n      return match;\n    }\n    dwr.util._debug(\"dwr.util._isHTMLElement was passed test node name that is neither a string or array of strings\");\n    return false;\n  }\n  return true;\n};\n\n/**\n * @private Like typeOf except that more information for an object is returned other than \"object\"\n */\ndwr.util._detailedTypeOf = function(x) {\n  var reply = typeof x;\n  if (reply == \"object\") {\n    reply = Object.prototype.toString.apply(x); // Returns \"[object class]\"\n    reply = reply.substring(8, reply.length-1);  // Just get the class bit\n  }\n  return reply;\n};\n\n/**\n * @private Object detector. Excluding null from objects.\n */\ndwr.util._isObject = function(data) {\n  return (data && typeof data == \"object\");\n};\n\n/**\n * @private Array detector. Note: instanceof doesn't work with multiple frames.\n */\ndwr.util._isArray = function(data) {\n  return (data && data.join);\n};\n\n/**\n * @private Date detector. Note: instanceof doesn't work with multiple frames.\n */\ndwr.util._isDate = function(data) {\n  return (data && data.toUTCString) ? true : false;\n};\n\n/**\n * @private Used by setValue. Gets around the missing functionallity in IE.\n */\ndwr.util._importNode = function(doc, importedNode, deep) {\n  var newNode;\n\n  if (importedNode.nodeType == 1 /*Node.ELEMENT_NODE*/) {\n    newNode = doc.createElement(importedNode.nodeName);\n\n    for (var i = 0; i < importedNode.attributes.length; i++) {\n      var attr = importedNode.attributes[i];\n      if (attr.nodeValue != null && attr.nodeValue != '') {\n        newNode.setAttribute(attr.name, attr.nodeValue);\n      }\n    }\n\n    if (importedNode.style != null) {\n      newNode.style.cssText = importedNode.style.cssText;\n    }\n  }\n  else if (importedNode.nodeType == 3 /*Node.TEXT_NODE*/) {\n    newNode = doc.createTextNode(importedNode.nodeValue);\n  }\n\n  if (deep && importedNode.hasChildNodes()) {\n    for (i = 0; i < importedNode.childNodes.length; i++) {\n      newNode.appendChild(dwr.util._importNode(doc, importedNode.childNodes[i], true));\n    }\n  }\n\n  return newNode;\n};\n\n/** @private Used internally when some message needs to get to the programmer */\ndwr.util._debug = function(message, stacktrace) {\n  var written = false;\n  try {\n    if (window.console) {\n      if (stacktrace && window.console.trace) window.console.trace();\n      window.console.log(message);\n      written = true;\n    }\n    else if (window.opera && window.opera.postError) {\n      window.opera.postError(message);\n      written = true;\n    }\n  }\n  catch (ex) { /* ignore */ }\n\n  if (!written) {\n    var debug = document.getElementById(\"dwr-debug\");\n    if (debug) {\n      var contents = message + \"<br/>\" + debug.innerHTML;\n      if (contents.length > 2048) contents = contents.substring(0, 2048);\n      debug.innerHTML = contents;\n    }\n  }\n};\n\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 377,
          "bodySize": 46649
        },
        "cache": {},
        "timings": {
          "send": 19,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8634"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.616-07:00",
        "time": 106,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/common-session-storage.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 346,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 26 Jul 2018 15:35:32 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"07ad749f624d41:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "3123"
            }
          ],
          "content": {
            "size": 10184,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "DQovL2dlbmVyYXRlIGFuIHVuaXF1ZSBpZCBmb3IgZWFjaCB0YWIgb3IgbmV3IHdpbmRvdw0KZnVuY3Rpb24gZ2VuZXJhdGVHdWlkKCkgew0KICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgMTUpOw0KfQ0KDQovL2NoZWNrIGlmIG5vbiBvZiBzZXNzaW9uYnJvd3NlcmlkIGV4aXN0aW5nIHRoZW4gY3JlYXRlIG5ldyBzZXNzZWlvbmJyb3dzZXJpZC4NCmlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJzZXNzaW9uQnJvd3NlcklkIikgPT0gbnVsbCApDQp7DQoJdmFyIHN0clVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnRvTG93ZXJDYXNlKCk7DQoJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgic2Vzc2lvbkJyb3dzZXJJZCIsIGdlbmVyYXRlR3VpZCgpKTsNCgkvL2NyZWF0ZSBuZXcgc2Vzc2lvblN0b3JhZ2Ugc28gd2UgY2FuIHVzZSBsYXRlciBvbiBnbG9iYWwtc2VsZWN0ZWQtZG9jIHRvIHNldCBkb2Mtbm8gZmllbGQgdG8gZW1wdHkNCgkvL2l0IG9ubHkgaGFwcGVucyB3aGVuIHVzZXIgc2VsZWN0IEZpbGUtPk5ldyBXaW5kb3cgd2l0aGluIGN1cnJlbnQgT01OTiBTY3JlZW4uDQoJc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgiaXNOZXdCcm93c2VyIiwgIlkiKTsNCgkvL2NoZWNrIGlmIGNvcHkgYW5kIHBhc3RlIGxpbmsgb3IgYm9vayBtYXJrIG9yIG5ldyB3aW5kb3cgdGhlbiByZWRpcmVjdCB0byAvb21uaS9pbmRleC5qc3AJDQoJaWYgKHN0clVybC5pbmRleE9mKCJvbW5pL2luZGV4LmpzcCIpID09IC0xIA0KCQkJJiYgc3RyVXJsLmluZGV4T2YoIm9tbmkvc3ByaW5nYm9hcmQuanNwIikgPT0gLTEgDQoJCQkmJiBzdHJVcmwuaW5kZXhPZigib21uaS9sb2dpbi5qc3AiKSA9PSAtMQ0KCQkJJiYgc3RyVXJsLmluZGV4T2YoIm9tbmkvZGJzY2hlbWF0YWJsZS5qc3AiKSA9PSAtMQ0KCQkJJiYgc3RyVXJsLmluZGV4T2YoIm9tbmkvbWJzL21haW5saW5lc2NhbiIpID09IC0xKQ0KDQoJew0KCQkNCgkJCXdpbmRvdy5sb2NhdGlvbi5ocmVmID0gIi9vbW5pL3NwcmluZ2JvYXJkLmpzcCI7DQoJfQ0KfQ0KDQovLyBBZGQgc2Vzc2lvbkJyb3dzZXJJZCBhcyBhIGN1c3RvbSByZXF1ZXN0IGhlYWRlciB0byBhbGwgYWpheCByZXF1ZXN0cy4gDQokLmFqYXhTZXR1cCh7DQoJYmVmb3JlU2VuZDogZnVuY3Rpb24oeGhyKSB7DQoJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCdzZXNzaW9uQnJvd3NlcklkJywgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnc2Vzc2lvbkJyb3dzZXJJZCcpKTsNCgl9DQp9KTsNCg0KDQoNCi8vY3JlYXRlIG9uYmVmb3JldW5sb2FkIGV2ZW50IHRvIHNlbmQgc2Vzc2lvbkJyb3dzZXJJZCB0byBzZXJ2ZXIgdXNpbmcgSnF1ZXJ5L0FqYXggdG8gc2VydmxldA0KaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7DQoJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIHByb2Nlc3NBamF4U2VydmxldCwgZmFsc2UpOw0KCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgaW5pdFNlc3Npb24sIGZhbHNlKTsNCn0NCmVsc2UgaWYgKHdpbmRvdy5hdHRhY2hFdmVudCkgew0KCXdpbmRvdy5hdHRhY2hFdmVudCgib24iICsgImJlZm9yZXVubG9hZCIsIHByb2Nlc3NBamF4U2VydmxldCk7DQoJd2luZG93LmF0dGFjaEV2ZW50KCJvbiIgKyAibG9hZCIsIGluaXRTZXNzaW9uKTsNCn0gDQplbHNlIHsNCgl3aW5kb3dbIm9uIiArICJiZWZvcmV1bmxvYWQiXSA9IHByb2Nlc3NBamF4U2VydmxldDsNCgl3aW5kb3dbIm9uIiArICJsb2FkIl0gPSBpbml0U2Vzc2lvbjsNCn0NCg0KaWYgKHR5cGVvZiBkd3IgIT0gJ3VuZGVmaW5lZCcpDQp7DQoJZHdyLmVuZ2luZS5zZXRQcmVIb29rKHByb2Nlc3NBamF4U2VydmxldCkgOw0KfQ0KDQpmdW5jdGlvbiBwcm9jZXNzQWpheFNlcnZsZXQoKQ0Kew0KCQ0KCXZhciBicm93c2VySWQgPSAiIjsNCglpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgic2Vzc2lvbkJyb3dzZXJJZCIpICE9IG51bGwpDQoJew0KCQlicm93c2VySWQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJzZXNzaW9uQnJvd3NlcklkIik7CQkJDQoJfQ0KDQoJdmFyIGlucHV0ZGF0YSAgPSB7IHNlc3Npb25Ccm93c2VySWQgOiBicm93c2VySWQgICB9OyANCg0KCSQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgew0KCQkgJC5hamF4U2V0dXAgKHsNCgkJICAgICAgICBhc3luYzogZmFsc2UgLA0KCQkgICAgICAgIC8vIERpc2FibGUgY2FjaGluZyBvZiBBSkFYIHJlc3BvbnNlcyANCgkJICAgICAgICBjYWNoZTogZmFsc2UNCgkJICAgIH0pOw0KDQoJCSAkLmFqYXgoeyAgDQoJCQkgICAgdHlwZTogJ1BPU1QnLCAgDQoJCQkgICAgdXJsOicvb21uaS9IdHRwUmVxdWVzdEFqYXhTZXJ2bGV0JywgDQoJCQkgICAgZGF0YTogaW5wdXRkYXRhLAkJICAgDQoJCQkgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzdWx0KXsgIA0KDQoJCQkgICAgfSAgICAgICAgICAgICAgICANCgkJCSAgfSk7ICANCgl9KTsgDQp9DQoNCg0KLyogc2VjdGlvbiBmb3Igc2Vzc2lvbiB0aW1lIG91dCAqLw0KLy9Ib3cgZnJlcXVlbnRseSB0byBjaGVjayBmb3Igc2Vzc2lvbiBleHBpcmF0aW9uIGluIG1pbGxpc2Vjb25kcw0KdmFyIHNlc3NfcG9sbEludGVydmFsID0gNjAwMDA7DQovL0hvdyBtYW55IG1pbnV0ZXMgdGhlIHNlc3Npb24gaXMgdmFsaWQgZm9yDQp2YXIgc2Vzc19leHBpcmF0aW9uTWludXRlcyA9IDEyMDsNCi8vSG93IG1hbnkgbWludXRlcyBiZWZvcmUgdGhlIHdhcm5pbmcgcHJvbXB0DQp2YXIgc2Vzc193YXJuaW5nTWludXRlcyA9IDExMDsNCiANCnZhciBzZXNzX2ludGVydmFsSUQ7DQp2YXIgc2Vzc19sYXN0QWN0aXZpdHk7DQoNCkRhdGUucHJvdG90eXBlLmdldE1vbnRoTmFtZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIG1vbnRoTmFtZXMgPSBbICJKYW4iLCAiRmViIiwgIk1hciIsICJBcHIiLCAiTWF5IiwgIkp1biIsIA0KICAgICAgICAgICAgICAgICAgICAiSnVsIiwgIkF1ZyIsICJTZXAiLCAiT2N0IiwgIk5vdiIsICJEZWMiIF07DQogICAgICByZXR1cm4gbW9udGhOYW1lc1t0aGlzLmdldE1vbnRoKCldOw0KIH0NCg0KRGF0ZS5wcm90b3R5cGUuZ2V0RGF5TmFtZSA9IGZ1bmN0aW9uKCkgew0KCXZhciBkID0gWydTdW4nLCdNb24nLCdUdWUnLCdXZWQnLCdUaHUnLCdGcmknLCdTYXQnXTsNCglyZXR1cm4gZFt0aGlzLmdldERheSgpXTsNCn0NCiANCmZ1bmN0aW9uIGZvcm1hdFRpbWVPdXREYXRlKG5vdykNCnsNCgl2YXIgaG91ciA9IG5vdy5nZXRIb3VycygpIDwgMTAgPyAnMCcgKyBub3cuZ2V0SG91cnMoKSA6IG5vdy5nZXRIb3VycygpOw0KCXZhciBtaW4gPSBub3cuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgKyBub3cuZ2V0TWludXRlcygpIDogbm93LmdldE1pbnV0ZXMoKTsNCgl2YXIgeWVhciA9IG5vdy5nZXRGdWxsWWVhcigpOw0KCXZhciBtb250aE5hbWUgPSBub3cuZ2V0TW9udGhOYW1lKCk7DQoJdmFyIGRheU5hbWUgPSBub3cuZ2V0RGF5TmFtZSgpOw0KCXJldHVybiBob3VyICsgIjoiICsgbWluICsgIiBvbiAiICsgZGF5TmFtZSArICIsICIgKyBub3cuZ2V0RGF0ZSgpICsgIi0iICsgbW9udGhOYW1lICsgIi0iICsgeWVhcjsNCn0NCg0KDQpmdW5jdGlvbiBpbml0U2Vzc2lvbigpIHsNCiAgICBzZXNzX2xhc3RBY3Rpdml0eSA9IG5ldyBEYXRlKCk7CQkJDQogICAgc2Vzc1NldEludGVydmFsKCk7DQogICAgJChkb2N1bWVudCkuYmluZCgna2V5cHJlc3Muc2Vzc2lvbicsIGZ1bmN0aW9uIChlZCwgZSkgew0KICAgICAgICBzZXNzS2V5UHJlc3NlZChlZCwgZSk7DQogICAgfSk7DQp9DQpmdW5jdGlvbiBzZXNzU2V0SW50ZXJ2YWwoKSB7DQogICAgc2Vzc19pbnRlcnZhbElEID0gc2V0SW50ZXJ2YWwoJ3Nlc3NJbnRlcnZhbCgpJywgc2Vzc19wb2xsSW50ZXJ2YWwpOw0KfQ0KZnVuY3Rpb24gc2Vzc0NsZWFySW50ZXJ2YWwoKSB7DQogICAgY2xlYXJJbnRlcnZhbChzZXNzX2ludGVydmFsSUQpOw0KDQp9DQpmdW5jdGlvbiBzZXNzS2V5UHJlc3NlZChlZCwgZSkgew0KICAgIHNlc3NfbGFzdEFjdGl2aXR5ID0gbmV3IERhdGUoKTsNCn0NCg0KZnVuY3Rpb24gc2Vzc0ludGVydmFsKCkgew0KCXZhciB3aW5XaWR0aCA9IDQwMDsNCgl2YXIgd2luSGVpZ2h0ID0gMjAwOw0KICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpOw0KCXZhciByZXR1cm5WYWwgPSAiIjsNCiAgICAvL2dldCBtaWxsaXNlY29uZHMgb2YgZGlmZmVybmVjZXMNCiAgICB2YXIgZGlmZiA9IG5vdyAtIHNlc3NfbGFzdEFjdGl2aXR5Ow0KICAgIC8vZ2V0IG1pbnV0ZXMgYmV0d2VlbiBkaWZmZXJlbmNlcw0KICAgIHZhciBkaWZmTWlucyA9IChkaWZmIC8gMTAwMCAvIDYwKTsNCiAgICB2YXIgdXJsID0gIi9PTU5JU3RhdGljL2RpYWxvZ3Mvc2Vzc2lvblRpbWVvdXREaWFsb2cuaHRtbCI7DQogICANCiAgICB2YXIgd2FybmluZ0ZsYWcgPSB0cnVlOw0KICAgIGlmIChkaWZmTWlucyA+PSBzZXNzX3dhcm5pbmdNaW51dGVzICAmJiBkaWZmTWlucyA8IHNlc3NfZXhwaXJhdGlvbk1pbnV0ZXMpIHsNCiAgICAgICAgLy93YXJuIGJlZm9yZSBleHBpcmluZw0KICAgICAgICAvL3N0b3AgdGhlIHRpbWVyDQogICAgICAgIC8vc2Vzc0NsZWFySW50ZXJ2YWwoKTsNCiAgICAgICAgLy9wcm9tcHQgZm9yIGF0dGVudGlvbg0KICAgIAl3YXJuaW5nRmxhZyA9IGZhbHNlOw0KCQl2YXIgcGFyYW1ldGVycyA9IG5ldyBBcnJheSgpOwkNCgkJdmFyIG5vd0Zvcm1hdCA9ICBmb3JtYXRUaW1lT3V0RGF0ZShub3cpIDsNCgkJcGFyYW1ldGVyc1swXSA9ICJXYXJuaW5nIjsNCgkJcGFyYW1ldGVyc1sxXSA9ICJJdCBpcyAnIiArIG5vd0Zvcm1hdCArICAiJyAiOw0KCQlwYXJhbWV0ZXJzWzJdID0gIklmIHlvdSBhcmUgc3RpbGwgdXNpbmcgdGhlIE9NTkkgQXBwbGljYXRpb24sIFxucGxlYXNlIGNsaWNrIE9LIHdpdGggaW4gdGhlIG5leHQgMTAgbWludXRlcyB0byBcbmNvbnRpbnVlLiAgT3RoZXJ3aXNlLCB5b3VyIHNlc3Npb24gd2lsbCBleHBpcmUgYW5kIFxuYWxsIHVuc2F2ZWQgZG9jdW1lbnRhdGlvbiB3aWxsIGJlIGxvc3QuIjsNCgkJcGFyYW1ldGVyc1szXSA9ICJZb3VyIFNlc3Npb24gaGFzIGV4cGlyZWQgZHVlIHRvIDIgaG91cnMgXG5vZiBpbmFjdGl2aXR5LiAgQ2xpY2sgT0sgYW5kIG5hdmlnYXRlIHRvIHRoZSBcbidpRE9DJyBob21lIHBhZ2UgdG8gYWNjZXNzIE9NTkkuIjsNCgkJcmV0dXJuVmFsID0gd2luZG93LnNob3dNb2RhbERpYWxvZyh1cmwscGFyYW1ldGVycywiZGlhbG9nV2lkdGg6IiArIHdpbldpZHRoICsgIiBweDtkaWFsb2dIZWlnaHQ6IiArIHdpbkhlaWdodCArICJweDtjZW50ZXI6MTtoZWxwOjA7c3RhdHVzOjAiKTsNCgkJd2FybmluZ0ZsYWcgPSB0cnVlOw0KCQlpZiAodHlwZW9mIHJldHVyblZhbCA9PSAndW5kZWZpbmVkJykgew0KCQkJIHJldHVybiBmYWxzZTsNCgkJfSBlbHNlIGlmIChyZXR1cm5WYWwgIT0gbnVsbCAmJiByZXR1cm5WYWwgPT0gJ09LJykgew0KDQogICAgICAgICAgICBub3cgPSBuZXcgRGF0ZSgpOw0KICAgICAgICAgICAgZGlmZiA9IG5vdyAtIHNlc3NfbGFzdEFjdGl2aXR5Ow0KICAgICAgICAgICAgZGlmZk1pbnMgPSAoZGlmZiAvIDEwMDAgLyA2MCk7DQogICAgICAgICAgICBpZiAoZGlmZk1pbnMgPCBzZXNzX2V4cGlyYXRpb25NaW51dGVzKSB7DQogICAgICAgICAgLy8gICAgICBzZXNzTG9nT3V0KCk7DQogICAgICAgICAgLy8gIH0NCiAgICAgICAgICAvLyAgZWxzZSB7DQogICAgICAgICAgICAgICAgaW5pdFNlc3Npb24oKTsNCiAgICAgICAgICAgICAgICBzZXNzU2V0SW50ZXJ2YWwoKTsNCiAgICAgICAgICAgICAgICBzZXNzX2xhc3RBY3Rpdml0eSA9IG5ldyBEYXRlKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCgkJDQogICAgICAgIA0KICAgIH0NCgkvL2V4cGlyZWQNCglpZiAod2FybmluZ0ZsYWcgJiYgZGlmZk1pbnMgPj0gc2Vzc19leHBpcmF0aW9uTWludXRlcykgew0KCQlzZXNzQ2xlYXJJbnRlcnZhbCgpOw0KCQl2YXIgcGFyYW1ldGVycyA9IG5ldyBBcnJheSgpOwkNCgkJdmFyIG5vd0Zvcm1hdCA9ICBmb3JtYXRUaW1lT3V0RGF0ZShub3cpIDsNCgkJcGFyYW1ldGVyc1swXSA9ICJFeHBpcmVkIjsNCgkJcGFyYW1ldGVyc1sxXSA9ICJJdCBpcyAnIiArIG5vd0Zvcm1hdCArICAiJyAiOw0KCQlwYXJhbWV0ZXJzWzJdID0gIklmIHlvdSBhcmUgc3RpbGwgdXNpbmcgdGhlIE9NTkkgQXBwbGljYXRpb24sIFxucGxlYXNlIGNsaWNrIE9LIHdpdGggaW4gdGhlIG5leHQgMTAgbWludXRlcyB0byBcbmNvbnRpbnVlLiAgT3RoZXJ3aXNlLCB5b3VyIHNlc3Npb24gd2lsbCBleHBpcmUgYW5kIFxuYWxsIHVuc2F2ZWQgZG9jdW1lbnRhdGlvbiB3aWxsIGJlIGxvc3QuIjsNCgkJcGFyYW1ldGVyc1szXSA9ICJZb3VyIFNlc3Npb24gaGFzIGV4cGlyZWQgZHVlIHRvIDIgaG91cnMgXG5vZiBpbmFjdGl2aXR5LiAgQ2xpY2sgT0sgYW5kIG5hdmlnYXRlIHRvIHRoZSBcbidpRE9DJyBob21lIHBhZ2UgdG8gYWNjZXNzIE9NTkkuIjsNCgkJcmV0dXJuVmFsID0gd2luZG93LnNob3dNb2RhbERpYWxvZyh1cmwscGFyYW1ldGVycywiZGlhbG9nV2lkdGg6IiArIHdpbldpZHRoICsgIiBweDtkaWFsb2dIZWlnaHQ6IiArIHdpbkhlaWdodCArICJweDtjZW50ZXI6MTtoZWxwOjA7c3RhdHVzOjAiKTsNCg0KCX0NCn0NCiAgICANCg0KICAgIC8qIGVuZCBzZWN0aW9uIGZvciBzZXNzaW9uIHRpbWUgb3V0ICovDQogICAgDQovL2RlZmVjdCAyNjI1MCBHbG9iYWwgLSByb2xsYmFjayBjaGFuZ2VzIG1hZGUgZm9yIENRIDI1ODkxDQovL1dpdGggalF1ZXJ5IHRvIGRpc2FibGUgZ2xvYmFsIHJpZ2h0IGNsaWNrIHBlciBkZWZlY3QgMjU4OTENCi8vJChkb2N1bWVudCkub24oew0KIC8vICAgImNvbnRleHRtZW51IjogZnVuY3Rpb24oZSkgew0KICAgICAgIC8vIGFsZXJ0KCJjdHggbWVudSBidXR0b246IiwgZS53aGljaCk7IA0KDQogICAgICAgIC8vIFN0b3AgdGhlIGNvbnRleHQgbWVudQ0KLy8gICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCi8vCX0NCi8vY29tbWVudCBvdXQgZm9yIGRlZmVjdCBPTU5JMDAwMjYwNDYNCi8vLA0KLy8JIm1vdXNlZG93biI6IGZ1bmN0aW9uKGUpIHsgDQoJICAgIC8vY29uc29sZS5sb2coIm5vcm1hbCBtb3VzZSBkb3duOiIsIGUud2hpY2gpOyANCgkJLy8gZS5tZXRhS2V5ID0gZmFsc2U7DQoJDQogLy8JCWlmICggZS5jdHJsS2V5ICYmIGUud2hpY2ggPT0gMSkNCi8vCQl7DQovLwkJCWFsZXJ0KCJDVFJMICsgQ2xpY2sgaXMgZGlzYWJsZS4iKTsNCi8vCQkJZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOw0KCQkNCi8vCQl9DQovLwkJaWYgKCBlLnNoaWZ0S2V5ICYmIGUud2hpY2ggPT0xKQ0KLy8JCXsNCi8vCQkJYWxlcnQoIlNISUZUICsgQ2xpY2sgaXMgZGlzYWJsZS4iKTsNCi8vCQkJZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOw0KCQkNCi8vCQl9DQovLwkJaWYgKGUud2hpY2ggPT0yKQ0KLy8JCXsNCi8vCQkJYWxlcnQoIk1pZGRsZSBDbGljayBpcyBkaXNhYmxlLiIpOw0KLy8JCQllLnJldHVyblZhbHVlID0gZmFsc2U7DQoNCi8vCQl9DQoNCi8vCQkJCWlmKGUuc2hpZnRLZXkpIHsgDQoNCi8vCX0NCgkvLywNCgkvLyJtb3VzZXVwIjogZnVuY3Rpb24oZSkgeyANCgkgLy8gICBjb25zb2xlLmxvZygibm9ybWFsIG1vdXNlIHVwOiIsIGUud2hpY2gpOyANCgkvL30NCg0KDQovL30pOw0KDQo=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 309,
          "bodySize": 10184
        },
        "cache": {},
        "timings": {
          "send": 20,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8633"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.616-07:00",
        "time": 108,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/images/logo-doc.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 332,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "image/gif"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:10 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"02d9b6cda8ed31:0\""
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1004"
            }
          ],
          "content": {
            "size": 1340,
            "compression": 0,
            "mimeType": "image/gif",
            "text": "R0lGODlhoQAmALMAAP////T08efn39razs3NvMDAq7OzmaamiJubeouLZX5+U3FxQmtrOmZmMwAAAAAAACH5BAUUAAAALAAAAAChACYAAAT/EMhJq7046827/2AojmRpnmiqrmzrvnAsz3Rt33iu73zv/8CgcEgsGo/IkGAiCEycGejztUzyFtAGQ1I4aBRVQMC7MYQ5hoaCgQCYLYOC9YUgAAiILSBhbzKhYGFOS2eEAAtyYlKKFQ0TDAOIEgJVCG2Tcyp4AHV1AAwEDAYKXqQJCgAKC2mUqA0JB46HBwoNAmycCQltBgwHqxSkVbcIAQsHCAupYASkqJknxgCOAwnTk7TTfakDbmauEsyXjmABegwBBl4CzxN4uGCKBI4GBp8DAgmJ0CW2ytMDFJg7kC1AHmvx6rG7lkpAPQnkWoVzaG+huwn64i1AUICevQb1/97wK6GAVDgFIQEUQGXtELslCsE1DAhAQESGHmu20xaumcQAORksGbBoZAhWElgZ26WMwIJjDb0tlBXvVwJHB9A5XWDnocVJCxo08JKVHSlqDQgYK2m0CIFEetrKRVFywZm5ePPq3TvCId9Jpw7UU4Dgrl6nDYoagGUAQTwZYlMglRDWzgoELTXZ5TBAFgWgmQEM6NbCaRWCkm1RiMzkwl3Dk0BaqBKgKOwwtS4EOJO7Qm/dsBdJubs7nOfZRTExuTuZsmrBaXbX6ijWyUqxdmLFUqfGQMCxYhVQtwcAemJ2IMU6MgeSdLjCC1ANYADSMsR/FggLiO9GTck0JaGCR/9nliXDQALseQegBL8IkIdO6bG2wGihNZeKLR1BZE0a9qRhDWlq1NSAXfjI1p8c9NUWYobTbNiAHLUs8VtSsnTUzYwi7jRBGlw00I1YA9gBpFo+XnjIJfb8FqJN3QDlRRow2mLAP2dYGNaF9TTAi2rTPEPAgjaRFyaNMsoSYi1ZbgmTajj2NiaOQOEXjCxjhgjRM2kg0As6Jho3QYiTAaoaK/OoYV9/Z2hpJAWBevFKlyKKaSJSvZ15HKKYtkmnbDh+cqmfkUJ6J43u2UQGqJAGigpSSL2T2I5cpvIPh4xy6YipQKEyZqiZmrlqn5hSeml0or3aqU1y0uhEZ07YKaqZTTtVN4GSur4IkRys2mLfq87peUAC5DkX35pgnCpWGmldtdk0Y6FXmFgH2KRaWOOiZ81V1sSCBQXjSlLoqU+sQQAl3h0ChiSxpFUedhIgoIV4d4Qnh75jMJzHAJhBeO8rCnUBQnE0DlxBchXAhgHIGvgxsskYUHIGyh28NhzJNXEA8wgW/qXzBVeFu/PPQAct9NBEF200XhEAADs=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 247,
          "bodySize": 1340
        },
        "cache": {},
        "timings": {
          "send": 1,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8637"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.616-07:00",
        "time": 109,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/images/logo-omni.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 333,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "image/gif"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:10 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"02d9b6cda8ed31:0\""
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "2356"
            }
          ],
          "content": {
            "size": 3144,
            "compression": 0,
            "mimeType": "image/gif",
            "text": "R0lGODlhPAEoAPcAAAAAAGZmM3x8UIqKY5aWc6Ghgqurj7W1nb6+qcfHtdDQwNjYy+Dg1ujo4PDw6/f39QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAAA8ASgAAAj/AP8JHEiwoMGDCBMqXMiwocOHECNKnEixosWLGDNq3Mixo8ePIEOKHEmypMmTKFOqXMmypcuXMGPKnEmzps2bOHPq3Mmzp8+fQIMKHUq0qNGjSJMqXcq0qdOnUKNKnUq1qtWrWLNq3cq1q9evYMOKHUu2rNmzGBk4SMiAwcC2Fxug7engQUcHalPK7biAgIEDBwYcKJiAQAIBhg0jnuhggIABEw8ImLyX4GQBg50SmFyA4ObHa0k+2Jw54efHChYSQFBAQGWSDQIY4CjZrcAHAyALjL3gnwLevl9HfFxRQIDOBBEECJAaqgHjCAgqQH4SM0MDAQQwJKA7OsoDwi1i//c+UEEAAgIZBLCt3rbF3BWfaycoPyn1ggyUC3DPoDTC+xlZt5B6uikEn0kNkMeRA5MdZFwC/7SX3noYHRgZAQFAKNACCzR4FAPzGdSWcgX2pxCIHQl4YgAFJmQhSQX4t9EBLB6EoWEDsIijjrsVYEABayVgAAEMcDfbQIX9ZWEDPgL5j5AFKEAAegUdkECNAg3m4ZMD/CjXAoExUAABBezV15jN/dMAmQmMadd0MWZZQAF9DZAaAlOm+YABQ/YG5gBikvmlcVOK6FYBx6VX2p59/tPhedzl1mZuBiSQm1ysxfnPAwcQMN0AEGJm6QBUiojlAXNKOYB3nxkm0HQ/rv/FqacFgIoqndzdmadADoxZgHeIIpZAp+TB6uQ/t6qqYEE5tjgQjZBJGCGFvu2H7HwYRscglc+5tQCWClgrmUDZFhnas/9MFlp0Hqo32HNZykbufIuZ1xuDqQnAmgMG6FboA5NBSOKhAqzFIITf9kbjkZsJ5BhCcP2TY3Qm/nOwowH09jDGmXk4QG9zClSrXd8OwGi67y5LEIG3Tdabed5ZaKldh/nJIqMACyAwiwSvtdkDAA/m7oYBZDbzkwL0lvPLAajsMJZV1iittJMBhh2E4zoMWWxHpqtb1Qdcfe25Vf6D3WzebWkbjW6p19u1u004WNbwxUYAYJuttXG6yEn/SBpgAnTmdpbz7Y0fe5O1ldnfknW292JrFvxPZ5Kduxjflh2wQNcHsaz1QAIe+K2GEtN73+N9U+hAaMQNLZB1ow+0sYUqRu2syIlOTaF6BrTVll1ZSwwZjW8LP23vvgMfokGDMahdx8urmWPb1AZvMXaDHaY3ejQm4LtttGcm4WPfyyUt3dG/5d6VH3cMqO9y7Q3vAeol0ECoy29cuwDdrlhg+J/7R96eRaHaAXBa7vkHiaZVGusMMF5uOaBBnOegjCFwQtQDENw+xzbZRStRVUofugR4nLdtSTJh21315qOAAUSpaCLz0QDk0j2DHHB86Ttf4UQYoQQiSjCvS9/e/2KjAHb5KIgE0Z9/AueYBOIHagc8kGPO1UEDFkhAElrTx1oHw9cNZooEjOAVZUSQK8noSkfSnW22pKYNGu9bXSNOupZHQx4iSyDsA918zIgsFa5NO9tioG+I5J5v3ccuN6QQGNNzwQ0ajiALcGKOMrPICJXOMjM0m4AaBrqvLfGLkjtIyTwIOkp2x4LzWosVS4nB0tmFiw0cjHKKN0AJHkRsuwkckjKER172ETkISE1rQjM7AdgFRPOhETCFGUobgs475mGOAqWJIbVcSUPPcQDX+ngAByDgMrokoXcMoMr5MAg55kEYi9ayuSf5MpuTMyYjbcOngjAoMyVj52xac/9Ms+kGRKE5p0C+6RaB8kqXIALULbNjlzm2DDlbOhCIIGRQJFosnOn0GsYgw6DZKMCgEtWZRQGmwYLUqVMEKJ6q7LTS5ljqMdEJDKmYlBvk1MovjqHSS1eFrNwQgGyy+6kCs5Sb3AymNb3bTGFyowCZ/rRxCnhOpQLXKRAGBjEgq6kWBaMqTzlqM10aJFOdqs2aFqRWLixIEQfSl8ccqQFmVRN57tMrMhFALg6IVPP02kKjnrWotNKqXtFKnU6hyWJ6FZlgjdpVBbTwbodBz3MKsFQgIsuuzSHsVsk4F4fhJYCdDa1XiHRQp4n2tFbh05DShNrWuva1sI2tbGdL29oR2va2uM2tbnfL29769rcVCQgAOw==",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 247,
          "bodySize": 3144
        },
        "cache": {},
        "timings": {
          "send": 3,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8633"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.617-07:00",
        "time": 110,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/images/buttons/button-minus.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 344,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "image/gif"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:10 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"02d9b6cda8ed31:0\""
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "266"
            }
          ],
          "content": {
            "size": 356,
            "compression": 0,
            "mimeType": "image/gif",
            "text": "R0lGODlhEQASAMQAADc3HMXFlJycdXt7XF1dL7S0h9TUqKSke7y8jZmZZsfHpa2te8zMmdbWrI2NasDAmNXVsra2ic7OpZaWcb6+k4SEY6CgeNvbtsPDntHRq66ug////wAAAAAAAAAAAAAAACH5BAUUABsALAAAAAARABIAAAWH4EaMZGmKmKJg2OO+DxVFI2RnuKTvjDxel4ZhuOMhCqOGUMJoOpsUjSbZYD6fiMNhNDRcsVru8NsMRCwWsQHAbrPNaLXbDU8TumRGXWz97u8GfVcBBQICIzplAYuMCBoTEyNQCEcFlgVSAg4OIwGOBxaGkJAOFQOcBBSYoQKjo6WRIiazJBshADs=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 246,
          "bodySize": 356
        },
        "cache": {},
        "timings": {
          "send": 2,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8637"
      },
      {
        "pageRef": "page_2",
        "startedDateTime": "2018-08-14T12:26:56.617-07:00",
        "time": 111,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/images/buttons/button-plus.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 343,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "image/gif"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:10 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"02d9b6cda8ed31:0\""
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "274"
            }
          ],
          "content": {
            "size": 368,
            "compression": 0,
            "mimeType": "image/gif",
            "text": "R0lGODlhEQASAMQAADc3HL6+k42Nal1dL6mpf9TUqHt7XMzMmZycdbS0h6Ske8XFlM7OpdbWrLa2iZmZZtXVsry8jcfHpZaWccHBmYSEY6CgeNvbtsPDntHRq66ug////wAAAAAAAAAAAAAAACH5BAUUABsALAAAAAARABIAAAWP4DaMZGmKmCRhGOW+VOA4I2RnOKPvhzxel0ZhuONFEqOGcAcAHJ49DSHZYECb0ENEoRgNC1cn1MH1DsPQhcNiMTffcMC6PRjG43Mz+Il9qtlmVnxiB390RGh+CQgIIzppTQuSERoTEyNPARFHCZ0JUggCAiMLlAoWjJaWAhUGowMBCQSoCKqqrJciJrskGyEAOw==",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 246,
          "bodySize": 368
        },
        "cache": {},
        "timings": {
          "send": 0,
          "wait": 0,
          "receive": 1
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8633"
      },
      {
        "pageRef": "page_36",
        "startedDateTime": "2018-08-14T12:26:56.903-07:00",
        "time": 3,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/HttpRequestAjaxServlet",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "29"
            }
          ],
          "queryString": [],
          "headersSize": 399,
          "bodySize": 29
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "WWW-Authenticate",
              "value": "Negotiate"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1293"
            }
          ],
          "content": {
            "size": 1293,
            "compression": 0,
            "mimeType": "text/html",
            "text": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;} \r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;} \r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} \r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n <div class=\"content-container\"><fieldset>\r\n  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>\r\n  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>\r\n </fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 216,
          "bodySize": 1293
        },
        "cache": {},
        "timings": {
          "send": 2,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8637"
      },
      {
        "pageRef": "page_36",
        "startedDateTime": "2018-08-14T12:26:56.910-07:00",
        "time": 3,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/HttpRequestAjaxServlet",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAABAAAAB7IIogsACwAvAAAADwAPACAAAABET0MxWlRVTTExNjg3ODFET0MxLldBLkxDTA=="
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "29"
            }
          ],
          "queryString": [],
          "headersSize": 501,
          "bodySize": 29
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html; charset=us-ascii"
            },
            {
              "name": "Server",
              "value": "Microsoft-HTTPAPI/2.0"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM TlRMTVNTUAACAAAACAAIADgAAAAFgomi20Yb+T1UdZEAAAAAAAAAAJYAlgBAAAAABgGxHQAAAA9EAE8AQwAxAAIACABEAE8AQwAxAAEAGABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAEABYARABPAEMAMQAuAHcAYQAuAGwAYwBsAAMAMABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAuAEQATwBDADEALgB3AGEALgBsAGMAbAAFAAwAdwBhAC4AbABjAGwABwAIAGoVp8MENNQBAAAAAA=="
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "341"
            }
          ],
          "content": {
            "size": 341,
            "compression": 0,
            "mimeType": "text/html; charset=us-ascii",
            "text": "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\">\r\n<HTML><HEAD><TITLE>Not Authorized</TITLE>\r\n<META HTTP-EQUIV=\"Content-Type\" Content=\"text/html; charset=us-ascii\"></HEAD>\r\n<BODY><h2>Not Authorized</h2>\r\n<hr><p>HTTP Error 401. The requested resource requires user authentication.</p>\r\n</BODY></HTML>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 474,
          "bodySize": 341
        },
        "cache": {},
        "timings": {
          "send": 1,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8637"
      },
      {
        "pageRef": "page_36",
        "startedDateTime": "2018-08-14T12:26:56.919-07:00",
        "time": 15,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/HttpRequestAjaxServlet",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAADAAAAGAAYAJwAAAAYABgAtAAAABYAFgBAAAAAKAAoAFYAAAAeAB4AfgAAAAAAAADMAAAABYKIokQATwBDADEALgBXAEEALgBMAEMATABzAHYAYwB3AGEAdQB0AGUAcwB0AHUAcwBlAHIAMAAxAGQAbwBjADEARABPAEMAMQBaAFQAVQBNADEAMQA2ADgANwA4ADEAwXyMBkdoiBIAAAAAAAAAAAAAAAAAAAAAkgqeECg4ZtBNZ6Qf5bXCPxz57wy5DNGK"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "29"
            }
          ],
          "queryString": [],
          "headersSize": 693,
          "bodySize": 29
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Connection",
              "value": "close"
            }
          ],
          "content": {
            "size": -1,
            "compression": null,
            "mimeType": "",
            "text": null,
            "encoding": null
          },
          "redirectURL": "",
          "headersSize": 215,
          "bodySize": -1
        },
        "cache": {},
        "timings": {
          "send": 9,
          "wait": 0,
          "receive": 5
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8637"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:56.955-07:00",
        "time": 2,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/common/docNumberSearch.htm",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "28"
            }
          ],
          "queryString": [],
          "headersSize": 403,
          "bodySize": 28
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "WWW-Authenticate",
              "value": "Negotiate"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1293"
            }
          ],
          "content": {
            "size": 1293,
            "compression": 0,
            "mimeType": "text/html",
            "text": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;} \r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;} \r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} \r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n <div class=\"content-container\"><fieldset>\r\n  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>\r\n  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>\r\n </fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 216,
          "bodySize": 1293
        },
        "cache": {},
        "timings": {
          "send": 1,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8632"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:56.964-07:00",
        "time": 2,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/common/docNumberSearch.htm",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAABAAAAB7IIogsACwAvAAAADwAPACAAAABET0MxWlRVTTExNjg3ODFET0MxLldBLkxDTA=="
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "28"
            }
          ],
          "queryString": [],
          "headersSize": 505,
          "bodySize": 28
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html; charset=us-ascii"
            },
            {
              "name": "Server",
              "value": "Microsoft-HTTPAPI/2.0"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM TlRMTVNTUAACAAAACAAIADgAAAAFgomiJl90b/WLVCcAAAAAAAAAAJYAlgBAAAAABgGxHQAAAA9EAE8AQwAxAAIACABEAE8AQwAxAAEAGABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAEABYARABPAEMAMQAuAHcAYQAuAGwAYwBsAAMAMABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAuAEQATwBDADEALgB3AGEALgBsAGMAbAAFAAwAdwBhAC4AbABjAGwABwAIAJM5rsMENNQBAAAAAA=="
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "341"
            }
          ],
          "content": {
            "size": 341,
            "compression": 0,
            "mimeType": "text/html; charset=us-ascii",
            "text": "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\">\r\n<HTML><HEAD><TITLE>Not Authorized</TITLE>\r\n<META HTTP-EQUIV=\"Content-Type\" Content=\"text/html; charset=us-ascii\"></HEAD>\r\n<BODY><h2>Not Authorized</h2>\r\n<hr><p>HTTP Error 401. The requested resource requires user authentication.</p>\r\n</BODY></HTML>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 474,
          "bodySize": 341
        },
        "cache": {},
        "timings": {
          "send": 2,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8632"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:56.973-07:00",
        "time": 24,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/common/docNumberSearch.htm",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAADAAAAGAAYAJwAAAAYABgAtAAAABYAFgBAAAAAKAAoAFYAAAAeAB4AfgAAAAAAAADMAAAABYKIokQATwBDADEALgBXAEEALgBMAEMATABzAHYAYwB3AGEAdQB0AGUAcwB0AHUAcwBlAHIAMAAxAGQAbwBjADEARABPAEMAMQBaAFQAVQBNADEAMQA2ADgANwA4ADEAwXyMBkdoiBIAAAAAAAAAAAAAAAAAAAAAGsV0qGWeYEtc437qw8GNZt0oAkFNB3mG"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "28"
            }
          ],
          "queryString": [],
          "headersSize": 697,
          "bodySize": 28
        },
        "response": {
          "status": 302,
          "statusText": "Redirect",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache,no-store"
            },
            {
              "name": "Pragma",
              "value": "no-cache"
            },
            {
              "name": "Content-Length",
              "value": "0"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Expires",
              "value": "Thu, 01 Jan 1970 00:00:00 GMT"
            },
            {
              "name": "Location",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            }
          ],
          "content": {
            "size": -1,
            "compression": null,
            "mimeType": "",
            "text": null,
            "encoding": null
          },
          "redirectURL": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm",
          "headersSize": 376,
          "bodySize": -1
        },
        "cache": {},
        "timings": {
          "send": 24,
          "wait": 0,
          "receive": 6
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8632"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.004-07:00",
        "time": 2,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 340,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "WWW-Authenticate",
              "value": "Negotiate"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1293"
            }
          ],
          "content": {
            "size": 1293,
            "compression": 0,
            "mimeType": "text/html",
            "text": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;} \r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;} \r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} \r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n <div class=\"content-container\"><fieldset>\r\n  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>\r\n  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>\r\n </fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 216,
          "bodySize": 1293
        },
        "cache": {},
        "timings": {
          "send": 2,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8633"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.007-07:00",
        "time": 7,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAABAAAAB7IIogsACwAvAAAADwAPACAAAABET0MxWlRVTTExNjg3ODFET0MxLldBLkxDTA=="
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 442,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html; charset=us-ascii"
            },
            {
              "name": "Server",
              "value": "Microsoft-HTTPAPI/2.0"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM TlRMTVNTUAACAAAACAAIADgAAAAFgomiEogHhr0V93cAAAAAAAAAAJYAlgBAAAAABgGxHQAAAA9EAE8AQwAxAAIACABEAE8AQwAxAAEAGABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAEABYARABPAEMAMQAuAHcAYQAuAGwAYwBsAAMAMABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAuAEQATwBDADEALgB3AGEALgBsAGMAbAAFAAwAdwBhAC4AbABjAGwABwAIALxdtcMENNQBAAAAAA=="
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "341"
            }
          ],
          "content": {
            "size": 341,
            "compression": 0,
            "mimeType": "text/html; charset=us-ascii",
            "text": "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\">\r\n<HTML><HEAD><TITLE>Not Authorized</TITLE>\r\n<META HTTP-EQUIV=\"Content-Type\" Content=\"text/html; charset=us-ascii\"></HEAD>\r\n<BODY><h2>Not Authorized</h2>\r\n<hr><p>HTTP Error 401. The requested resource requires user authentication.</p>\r\n</BODY></HTML>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 474,
          "bodySize": 341
        },
        "cache": {},
        "timings": {
          "send": 3,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8633"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.017-07:00",
        "time": 91,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/index.jsp"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAADAAAAGAAYAJwAAAAYABgAtAAAABYAFgBAAAAAKAAoAFYAAAAeAB4AfgAAAAAAAADMAAAABYKIokQATwBDADEALgBXAEEALgBMAEMATABzAHYAYwB3AGEAdQB0AGUAcwB0AHUAcwBlAHIAMAAxAGQAbwBjADEARABPAEMAMQBaAFQAVQBNADEAMQA2ADgANwA4ADEAxHhUBZK/sKIAAAAAAAAAAAAAAAAAAAAAEXL8qBAsNdscW74Z/SSVh6MBDEABHft4"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 634,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache,no-store"
            },
            {
              "name": "Pragma",
              "value": "no-cache"
            },
            {
              "name": "Content-Type",
              "value": "text/html;charset=UTF-8"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Expires",
              "value": "Thu, 01 Jan 1970 00:00:00 GMT"
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Connection",
              "value": "close"
            }
          ],
          "content": {
            "size": 43670,
            "compression": 0,
            "mimeType": "text/html;charset=UTF-8",
            "text": "<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\r\n\r\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html lang=\"en-US\" xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\r\n\t<!-- Header portion: BEGIN -->\r\n\t<head>\r\n\r\n\t\t<!-- Set the meta parameters for this page -->\r\n\t\t\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html;charset=UTF-8\" />\r\n\t\t<meta http-equiv=\"Content-Style-Type\" content=\"text/css\" />\r\n\r\n\t\t<!-- Include common JSP files for OMNI -->\r\n\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\r\n\r\n\r\n\t\t\t\t<!-- Global body style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-body-styles.css\" />\r\n\r\n\t\t<!-- Global error style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-error-styles.css\" />\r\n\r\n\t\t<!-- Global hyperlink style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-link-styles.css\" />\r\n\r\n\t\t<!-- Global layer style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-layer-styles.css\" />\r\n\r\n\t\t<!-- Global layout declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-layout-styles.css\" />\r\n\r\n\t\t<!-- Global menu style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-menu-styles.css\" />\r\n\r\n\t\t<!-- Global print style declarations -->\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/themes/omni/global-print-styles.css\" media=\"print\" />\r\n\r\n\t\r\n\t\t<!-- Common scripts used in OMNI -->\r\n\t\t<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/common-scripts.js\"></script>\r\n\r\n\t\t<!-- Common deferred scripts used in OMNI -->\r\n        <script type=\"text/javascript\" defer=\"defer\" src=\"/OMNIStatic/scripts/common-deferred-scripts.js\"></script>\r\n        \r\n        <!-- Common jquery scripts used in OMNI -->\r\n        <script type=\"text/javascript\" src=\"/OMNIStatic/scripts/jquery/jquery-1.9.1.min.js\"></script>\r\n        <script type=\"text/javascript\" src=\"/OMNIStatic/scripts/jquery/jquery-extension-1.9.1.js\"></script>\r\n        <script type=\"text/javascript\" src=\"/OMNIStatic/scripts/jquery/jquery-ui.js\"></script>\r\n        <script type=\"text/javascript\" src=\"/OMNIStatic/scripts/jquery/jquery-ui-extension.js\"></script>\r\n\t\t<link rel=\"stylesheet\" type=\"text/css\" href=\"/OMNIStatic/scripts/jquery/jquery-ui.css\" />\r\n\r\n        <!-- dwr scripts used in OMNI -->\r\n        <script type=\"text/javascript\" src=\"/omni/dwr/engine.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"/omni/dwr/util.js\"></script>    \r\n\t\t\r\n        <!-- Common session storage scripts used in OMNI -->\r\n        <script type=\"text/javascript\" src=\"/OMNIStatic/scripts/common-session-storage.js\"></script>\r\n        \r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t<!-- $layername is set to \"id-main-right\" by default: override if neccessary -->\r\n\t\t\r\n\r\n\t\t<!-- Page-specific head content: BEGIN -->\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t<!-- Define the title for this page -->\r\n\t\t<title>OMNI: Offender Case Plan</title>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\r\n\t\t<!-- Include any global elements -->\r\n\t\t\r\n\r\n\t\t<!-- Specify scripts used in this page -->\r\n\t\t\r\n\t\t\r\n<!-- Header / Calendar (JavaScript): BEGIN -->\r\n<link rel=\"stylesheet\" href=\"/OMNIStatic/themes/calendar/calendar.css\"  type=\"text/css\" />\r\n<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/calendar.js\"></script>\r\n<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/calendar-en.js\"></script>\r\n<!-- Header / Calendar (JavaScript): END -->\r\n\r\n\t\t<!-- Header / Collapsible (JavaScript): BEGIN -->\r\n<link rel=\"stylesheet\" href=\"/OMNIStatic/themes/collapsible.css\"  type=\"text/css\" />\r\n<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/collapsible.js\"></script>\r\n<!-- Header / Collapsible (JavaScript): END -->\r\n\r\n\t\t<!-- Header / DisplayTag (JavaScript): BEGIN -->\r\n<link rel=\"stylesheet\" href=\"/OMNIStatic/themes/displaytag.css\"  type=\"text/css\" />\r\n<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/displaytag.js\"></script>\r\n<!-- Header / DisplayTag (JavaScript): END -->\r\n\r\n\t\t<link type=\"text/css\" href=\"/OMNIStatic/themes/jquery-picklist.css\" rel=\"stylesheet\" />\r\n<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/jquery/jquery-picklist.js\"></script>\r\n<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/jquery/jquery.scrollTo.js\"></script>\r\n\r\n\t\t<link rel=\"stylesheet\" href=\"/OMNIStatic/themes/visjs/vis.css\"  type=\"text/css\" />\r\n<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/vis.js\"></script>\r\n\t\t<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/spellcheck.js\"></script>\t\t\r\n\t\t<script type='text/javascript' src='/omni/dwr/interface/needsGoalsManager.js'></script>\t\r\n\t\t<script type=\"text/javascript\" src=\"/OMNIStatic/scripts/advcor/needsGoals.js\"></script>\r\n\t\t<script type=\"text/javascript\">\r\n\t\t//<![CDATA[\r\n\r\n\t\t// A global variable to track which section/subsection was last expanded or whose content was clicked on.\r\n\t\t//   This is a | separated list of targets where subsequent elements are references inside sections and subsections\r\n\t\tvar lastAccessed;\r\n\t\tvar window_location_hash = '';\r\n\t\t\r\n\t\t// Similiar to init(), except that this ready function is called *before* the page is rendered.\r\n\t\t$(document).ready(function($) {\t\t\r\n\r\n\t\t\t// should never focus here.  Only focus if we aren't coming here from another page (there isn't hashes in the url)\r\n\t\t\t//document.getElementById('doc_no').focus();//CQ32306\r\n\t\t\t//document.getElementById('doc_no').select();//CQ32306\r\n\t\t\t\t\t\t\t\r\n\t\t\t// Register click events to the Collapse All links\r\n\t\t\t$('a.collapseAll').addClass('cls-link').click(function(e) {\r\n\t\t\t\tif (!$(this).hasClass('disabled')) {\r\n\t\t\t\t\t$('.collapsible .collapsible-header').each(function() {\r\n\t\t\t\t\t\t$(this).trigger('header:collapse');\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$('html,body').animate({ scrollTop : 0 });\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\r\n\t\t\t// Register an event handler to trigger when *all* ajax requests have been processed.\r\n\t\t\t//   Scroll to the section of interest when the page finishes loading. \r\n\t\t\tif (window.location.hash === '#_') window.location.hash = '';\r\n\t\t\twindow_location_hash = window.location.hash;\r\n\t\t\tif (window_location_hash !== '') {\r\n\t\t\t\twindow_location_hash = window_location_hash.replace('#', '');\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdocument.getElementById('doc_no').focus();//CQ32306\r\n\t\t\t\tdocument.getElementById('doc_no').select();//CQ32306\r\n\t\t\t}\r\n\t\t\t// After loading the offender header, load the first section referenced in the hash (if existing)\r\n\t\t\t$(document).ajaxStop(function() {\t\r\n\t\t\t\tloadNextHashSection();\r\n\t\t\t\t\r\n\t\t\t\t// deregister this event (we only want it to fire on initial rendering)\r\n\t\t\t\t$(document).off('ajaxStop');\r\n\t\t\t\t$(\"#mainCasePlanSection\").show();\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// If there are no active ajax requests, show the main Case Plan section\r\n\t\t\tif ($.active == 0) {\r\n\t\t\t\t$(\"#mainCasePlanSection\").show();\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\t$(document).ready(function($) {    \r\n       \t\t\t$('#cntcPrdRsltsSpan').on('refresh', function() {       \r\n              \t\tvar editingCntc = false;\r\n\t              \tif(document.getElementById('editingCntc')) {\r\n\t                \teditingCntc = document.getElementById('editingCntc').value;\r\n\t              \t}\r\n              \t\t$(this).load('/omni/advcor/cntc/contacts.htm?bannerView=true&editing='+editingCntc, function( response, status, xhr ) {\r\n                    \t$(this).html( response );\r\n              \t\t});\r\n       \t\t\t});\r\n       \t\t\t$('#cntcPrdRsltsSpan').trigger('refresh');\r\n\t\t\t\t});\r\n\t\t\t// Add a refresh trigger for the Case Management flag that can be called at will.\r\n       \t\t$(\"#cm_section .flag:first\").on('refresh', function() {\r\n              var span = $(this);\r\n              needsGoalsManager.getCaseManagementFlag(\"888912\", {\r\n                     callback: function(flag) {\r\n                           if (flag) { span.addClass('flag-icon'); }\r\n                           else { span.removeClass('flag-icon'); }\r\n                     }, async:true\r\n              \t});\r\n       \t\t});                  \r\n       \t\t$('#cm_section .flag:first').trigger('refresh');\r\n\t\t\t});\r\n\r\n\t\t\r\n\t\t// Loads the first expandable section identified in the hash string\r\n\t\tfunction loadNextHashSection() {\r\n\t\t\tif (window_location_hash !== '') {\r\n\t\t\t\tvar anchors = window_location_hash.split('|');\r\n\t\t\t\tif (anchors.length > 1) {\r\n\t\t\t\t\twindow_location_hash = window_location_hash.substring(window_location_hash.indexOf('|')+1, window_location_hash.length);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\twindow_location_hash = '';\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$(\"#\"+anchors[0]+\" > .collapsible-header\").trigger('header:expand');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction returnToTop(elem) {\r\n\t\t\tvar header = $(elem).parents('.collapsible').first().find('.collapsible-header');\r\n\t\t\t$('html,body').animate({scrollTop: header.offset().top});\r\n\t\t}\r\n\t\t\r\n\t\t// A callback function triggered whenever a collapsible section is expanded.\r\n\t\t//   This method registers the section as the \"lastAccessed\"\r\n\t\tfunction onAfterExpand() {\r\n\t\t\tsetLastAccessed(this);\r\n\t\t\t\r\n\t\t \t$(this).next().off('click');\r\n\t\t \t$(this).next().on('click', function(event) { event.stopPropagation(); setLastAccessed(this); });\r\n\t\t \t\r\n\t\t\t// Re-enable the Collapse All links\r\n\t\t\t$('a.collapseAll').removeClass('disabled');\r\n\t\t\t\r\n\t\t\tloadNextHashSection();\r\n\t\t}\r\n\t\t\r\n\t\t// A callback function triggered whenever a collapsible section is collapsed.\r\n\t\t//   This method deregisters the section as the \"lastAccessed\" and collapses all child sections\r\n\t\tfunction onAfterCollapse() {\r\n\t\t\t// clear lastAccessed \r\n\t\t\tlastAccessed = \"_\";\r\n\t\t\t\r\n\t\t\tcollapseSubSections($(this));\r\n\t\t\t\r\n\t\t\t// Disable the Collapse All links if all sections are collapsed.\r\n\t\t\tif ($('.collapsible .collapsible-header').filter(function() {return $(this).data('state') == 'expanded';}).length == 0) {\t\t\t\t\r\n\t\t\t\t$('a.collapseAll').addClass('disabled');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction collapseSubSections(header) {\r\n\t\t\t// collapse all child sections\r\n\t\t\theader.next().find('.collapsible-header').each(function() {\r\n\t\t\t\t$(this).trigger('header:collapse');\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\t// register onbeforeunload event to save screen before we leave the page.\r\n\t\t$(window).bind('beforeunload', function() {\r\n\t\t\t// save screen state\r\n\t\t\t$(\"#lastAccessed\").val(lastAccessed);\r\n\t\t\t$(\"#submitAction\").val(\"saveState\");\r\n\t\t\tvar form = $(\"#ocpForm\");\r\n\t\t\t$.post(form[0].action, form.serialize());\t\r\n\t\t});\r\n\t\t\r\n\t\t// Override global function - reimplement without global variables.\r\n\t\t// Check all isDirty variables on all forms, not just one variable on one form.\r\n\t\tfunction checkFormChanged() {\r\n\t\t\tvar isDirty = false;\r\n\t\t\t$(\"input[name='isDirty']\").each(function() {\r\n\t\t\t\tif (this.value === 'true') isDirty = true;\r\n\t\t\t});\r\n\t\t\tif (isDirty) {\r\n\t\t\t\treturn window.confirm(getIsDirtyConfirmMessage()); \r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\r\n\t\tvar form_submitting = false;\t\r\n\t\tfunction ajaxPost(inputElem) {\r\n\t\t\r\n\t\t\tif (form_submitting) return false;\r\n\t\t\t\tform_submitting = true; \r\n\t\t\t\t\r\n\t\t\t// identify the form containing this input element \r\n\t\t\tvar form = $(inputElem).closest(\"form\");\r\n\t\t\tvar data = form.serialize();\r\n\t\t\tdata = data + \"&\" + inputElem.name + \"=\" + inputElem.value;\r\n\r\n\t\t\t// disable buttons within this form\r\n\t\t\tform.find(\"input[type='button']\").attr('disabled', 'disabled');\r\n\r\n\t\t\t$.ajax({\r\n\t\t\t\ttype : \"POST\",\r\n\t\t\t\turl : form[0].action,\r\n\t\t\t\tdata : data,\r\n\t\t\t\tsuccess : function(result) {\r\n\t\t\t\t\t// replace section content with results\r\n\t\t\t\t\tvar content = form.closest(\"div[data-url]\");\r\n\t\t\t\t\tcontent.empty().append(result);\r\n\t\t\t\t\t\r\n\t\t\t\t\tform_submitting = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\t// Sets the last accessed section and subsection in a | separated list.\r\n\t\tfunction setLastAccessed(elem) {\r\n\t\t\tlastAccessed = '';\r\n\t\t\t$(elem).parents('.collapsible').each(function () {\r\n\t\t\t\tlastAccessed = $(this).attr('id')+'|'+lastAccessed;\r\n\t\t\t});\r\n\t\t\t// remove last |\r\n\t\t\tlastAccessed = lastAccessed.substring(0, lastAccessed.length-1);\r\n\t\t}\r\n\r\n\t\t//]]>\r\n\t\t</script>\r\n\r\n\t\t<style type=\"text/css\">\t\t\t\r\n\t\t.collapsible-header span {\r\n\t\t\tfont-size: 8pt;\r\n\t\t\tcolor: gray;\r\n\t\t\tfont-weight: normal;\r\n\t\t}\r\n\t\t\t\r\n\t\ta.returnToTop {\r\n\t\t\tfloat: right;\r\n\t\t}\r\n\t\t\r\n\t\t.collapseAll {\r\n\t\t\tfloat: right;\r\n\t\t\tfont-size: 8pt;\r\n\t\t}\r\n\t\tfieldset {\r\n\t\t\tpadding: 0px;\r\n\t\t}\r\n\t\t.main-right-header .cls-link, .main-right-header .cls-link.disabled {\r\n\t\t\tfont-size: 8pt;\r\n\t\t\tfont-weight: normal;\r\n\t\t}\r\n\t\ttable td, table th {\r\n\t\t\tvertical-align: top;\r\n\t\t\twhite-space: nowrap;\r\n\t\t}\r\n\t\ttable#co_contactsOverride td, table#co_contactsOverride th {\r\n\t\t\tvertical-align: top;\r\n\t\t\twhite-space: normal;\r\n\t\t}\r\n\t\t.flag {\r\n\t\t\tbackground-position: left center;\r\n\t\t    background-repeat: no-repeat;\r\n\t\t    float: right;\r\n\t\t    height: 15px;\r\n\t\t    width: 15px;\r\n\t\t    padding-right: 5px;\r\n\t\t}\r\n\t\t.flag-icon {\r\n\t\t\tbackground-image: url(\"/OMNIStatic/images/icons/red-flag.gif\");\r\n\t\t}\r\n\t\t.main-right-header-overview-expanded:hover, .main-right-header-overview-collapsed:hover{\r\n\t\t\tbackground-color: #B8B885;\r\n\t\t}\r\n\t\ta.cls-link.disabled {\r\n\t\t\tcolor: gray;\r\n\t\t\tcursor: default;\r\n\t\t}\r\n\t\ta.cls-link.disabled:hover {\r\n\t\t\tcolor: gray;\r\n\t\t\ttext-decoration: underline;\r\n\t\t}\r\n\t\tinput[type='submit'][disabled] {\r\n\t\t    color: graytext;\r\n\t\t}\r\n\t\ttextarea[readonly]{\r\n\t\t\tbackground-color: #d4d0c8;\r\n\t\t}\r\n\t\t\r\n\t\ttable#cn_addCntcTbl td {\r\n\t\t\tpadding-right: 10px;\r\n\t\t}\r\n\t\t\r\n\t\t#cm_ng_ac_form .pickList_list {\r\n\t\t\theight: 55px;\r\n\t\t\twidth: 230px;\r\n\t\t}\r\n\t\t#cm_ng_ac_form .pickList_controlsContainer {\r\n\t\t\tmargin-top: 25px;\r\n\t\t}\r\n\t\t#cm_ng_ac_form .pickList_controlsContainer button {\r\n\t\t\theight: 25px;\r\n\t\t}\r\n\t\t#cm_ng_asmntDmns.displayTag > tbody > tr > td {\r\n\t\t\tvertical-align: middle;\r\n\t\t\tbackground-color: #DEDE8B;\r\n\t\t}\r\n\t\t#cm_ng_asmntDmns.displayTag > thead > tr > th {\r\n\t\t\tbackground-color: #B8B885;\r\n\t\t}\r\n\t\t.spinner-icon2 {\r\n\t\t\tbackground-image: url(\"/OMNIStatic/images/icons/wait-dede8b.gif\");\r\n\t\t\tbackground-size: 16px;\r\n\t\t\tbackground-repeat: no-repeat;\r\n\t\t\tpadding: 5px 12px 0px 8px;\r\n\t\t}\r\n\t\t#cm_ng_ad_fs fieldset {\r\n\t\t\tmargin-left: 0px;\r\n\t\t\tmargin-right: 0px;\r\n\t\t}\r\n\t\t\r\n\t\t.domainNeedLvlTbl { margin: auto; border-collapse: collapse; }\r\n\t\t.domainNeedLvlTbl th, .domainNeedLvlTbl td:first-child { border: thin solid black; padding: 5px; text-align: center; font-weight: bold; }\r\n\t\t.domainNeedLvlTbl td { border: thin solid grey; padding: 5px; text-align: center; }\r\n\t\t\r\n\t\t#cm_ng_ad_form select:disabled {\r\n\t\t\tcolor: #666666;\r\n\t\t\tbackground-color: #D4D0C8;\r\n\t\t}\r\n\t\t\r\n\t\t#cm_ng_pp_entity_fs table td {\r\n\t\t\tpadding: 2px;\r\n\t\t}\r\n\t\t</style>\r\n\t\t\r\n\t\t\r\n\t\t<!-- Page-specific head content: END -->\r\n\r\n\t</head>\r\n\t<!-- Header portion: END -->\r\n\r\n\t<!-- Body portion: BEGIN-->\r\n\t\r\n\t<body> \r\n\t\r\n\r\n\t\t<!-- Header content pane: BEGIN -->\r\n\t\t<div id=\"id-main-header\">\r\n\r\n\t\t\t<!-- Application header: BEGIN -->\r\n\t\t\t\r\n<!-- Header / Global: BEGIN -->\r\n\r\n\t<!-- Global header images: BEGIN -->\r\n\t<div id=\"id-main-header-a-1\">\r\n\t\t<img src=\"/OMNIStatic/images/logo-doc.gif\" alt=\"Department Of Corrections logo\" width=\"161\" height=\"38\" />\r\n\t</div>\r\n\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t<div id=\"id-main-header-a-2\">\r\n\t\t******TEST-CONV******<br/>\r\n\t\t\t<img src=\"/OMNIStatic/images/logo-omni.gif\" alt=\"Offender Management Network Information logo\" width=\"316\" height=\"25\" />\r\n\t\t</div>\r\n\t\t\r\n\t\t\r\n\t\r\n\t<!-- Global header images: END -->\r\n\r\n\t<script type=\"text/javascript\">\r\n\t//<![CDATA[\r\n\t//  function for suppressing form submission if enter is pressed\r\n\t//  when cursor in a input type=\"text\"\r\n          function killEnterAfterFirst(evt)\r\n          {\r\n             if(evt.keyCode == 13 || evt.which == 13){\r\n          \t\t//OMNI00016279 GLOBAL - Entering a DOC Number in the DOCNO box and hitting ENTER Bypasses Screen Warning\r\n          \t\tif(!hasFormChanged(currentOmniForm)) {\r\n\t          \t\treturn true;\r\n          \t\t} else {\r\n          \t\t\tif(checkFormChanged()) {\r\n\t\t\t\t\t\tdisableSubmitButtons('docNumberSearchForm');\r\n\t\t\t\t\t\tdocument.forms['docNumberSearchForm'].submit();\r\n\t\t\t\t\t\tdocument.getElementById('doc_no').setAttribute(\"disabled\",\"disabled\");\r\n\t\t                return true;\r\n\t\t\t\t\t} else {\r\n\t\t\t      \t\treturn false;\r\n          \t\t\t}\r\n          \t\t}\r\n           \t}\r\n            return true;\r\n          }\r\n          function disableSubmitButton(formName) {\r\n        \tvar elem = null;\r\n        \tdocument.forms['docNumberSearchForm'].submit();\r\n                document.getElementById('doc_no').setAttribute(\"disabled\",\"disabled\");\r\n\r\n                for ( j=0;j< document.forms[formName].elements.length; j++ ) {\r\n                    \telem = document.forms[formName].elements[j];\r\n\r\n                        if(elem.type && (elem.type == 'submit' || elem.type == 'reset' || elem.type == 'button')) {\r\n\t    \t                elem.onclick = voidAction;\r\n\t    \t                elem.style.color='#cccc99';\r\n\t                }\r\n\t        }\r\n          }\r\n\r\n          function onSubmitHandler() {\r\n\r\n          \tif(!hasFormChanged(currentOmniForm)) {\r\n\r\n          \t\treturn true;\r\n          \t} else {\r\n          \t\tif(checkFormChanged()) {\r\n          \t\t      disableSubmitButtons('docNumberSearchForm',false);\r\n\t\t\t      return true;\r\n\t\t\t} else {\r\n\t\t\t      return false;\r\n          \t\t}\r\n          \t}\r\n\r\n          }\r\n\t//]]>\r\n\t</script>\r\n\t<!-- Global DOC number: BEGIN -->\r\n\t\r\n\t\r\n\t<div id=\"id-main-header-a-3\">\r\n\t\t<form id=\"docNumberSearchForm\" method=\"post\" action=\"/omni/common/docNumberSearch.htm\" onsubmit=\"return onSubmitHandler();\">\r\n\t\t\t<table class=\"cls-doc-quick-jump\">\r\n\t\t\t\t<tr>\r\n\t\t\t\t\t<td class=\"cls-nowrap\">\r\n\t\t\t\t\t\t<label class=\"form-element\" for=\"doc_no\"> DOC No.:</label>\r\n\t\t\t\t\t\t<!-- fix for CQ14900 - add tab index to the doc number box -->\r\n\t\t\t\t\t\t<input class=\"form-element\" name=\"docSearchNumber\" type=\"text\" id=\"doc_no\" tabindex=\"1\" size=\"12\" maxlength=\"7\"  onkeypress=\"return killEnterAfterFirst(event);\" style=\"text-align:right\" value=\"888912\" />\r\n\t\t\t\t\t\t<input class=\"form-element\" name=\"go\" id=\"go\" type=\"submit\" value=\"Go\"  tabindex=\"2\"/><!-- Fix for 9746 -->\r\n\t\t\t\t\t</td>\r\n\t\t\t\t</tr>\r\n\t\t\t</table>\r\n\t\t</form>\r\n\t</div>\r\n\t\r\n\t<!-- Global DOC number: END -->\r\n\r\n\r\n<!-- Global selected DOC: BEGIN -->\r\n\r\n\t\r\n\t<div id=\"id-main-header-b-2\">\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<div id=\"selectedDocNo\">\r\n\t\t\t\t\t\tSelected DOC No.:  888912 TABLER, Patrick Roy\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t</div>\r\n\r\n<!-- Global selected DOC: END -->\r\n\r\n\r\n\t<!-- Global top tabs: BEGIN -->\r\n\r\n\t<!-- Menu tooltips: BEGIN -->\r\n\t<div id=\"id-tooltip-offender\">Single offender specific information regarding their overall case plan.</div>\r\n\t<div id=\"id-tooltip-assignments\">View and work with caseload specific, Notifications and Check Dates. Create a Group Chrono.</div>\r\n\t<div id=\"id-tooltip-facility\">Facility maintenance functions.</div>\r\n\t<div id=\"id-tooltip-search\">Search for offenders by name or other search criteria. Search Chronos, Check Dates, and Notifications. Locate staff / position and facility information.</div>\r\n\t<div id=\"id-tooltip-administration\">Create and maintain staff and position information. Create and maintain facility information. Maintain code tables and security authorizations.</div>\r\n\t<div id=\"id-tooltip-plans\">Manage the offender's plans.</div>\r\n\t<div id=\"id-tooltip-healthServices\">View and work with health services for offenders.</div>\r\n\t<div id=\"id-tooltip-programs\">Manage the offender's programs.</div>\r\n\t<!-- Menu tooltips: END -->\r\n\r\n\t<!-- Menu tabs: BEGIN -->\r\n\t<div id=\"id-main-header-b-1\">\r\n\t\t\r\n\t\t<a href=\"/omni/index.jsp\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-home','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-home','','hide')\">Home</a>\r\n\t\t\r\n\t\t\r\n\t\t\t<a href=\"/omni/assignments/index.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-assignments','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-assignments','','hide')\">Assignments</a>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t<a href=\"/omni/advcor/csPln/offenderCasePlan.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs-on\" onmouseover=\"MM_showHideLayers('id-tooltip-offender','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-offender','','hide')\">Offender</a>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t<a href=\"/omni/med/sched/schedulerQueue.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-healthServices','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-healthServices','','hide')\">Health Services</a>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t<a href=\"/omni/menu/plans.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-plans','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-plans','','hide')\">Plans</a>\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t<a href=\"/omni/menu/programs.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-programs','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-programs','','hide')\">Programs</a>\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t<!-- For CQ# 15120 create new authority -->\r\n\t\t\r\n\t\t\t<a href=\"/omni/records/facility/facilityModifyDeleteField.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-facility','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-facility','','hide')\">Facility</a>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t<a href=\"/omni/records/offender/offenderSearchQuick.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-search','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-search','','hide')\">Search</a>\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\t<a href=\"/omni/menu/prea.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-prea','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-prea','','hide')\">PREA</a>\r\n\t\t\r\n\t\t\r\n\t\t<a href=\"/omni/menu/administration.htm\" onclick=\"return processOmniLinkClick(this);\" class=\"cls-main-tabs\" onmouseover=\"MM_showHideLayers('id-tooltip-administration','','show')\" onmouseout=\"MM_showHideLayers('id-tooltip-administration','','hide')\">Administration</a>\r\n\t</div>\r\n\t<!-- Menu tabs: END -->\r\n\r\n\t<!-- Global top tabs: END -->\r\n\r\n\r\n<!-- Header / Global: END -->\r\n\r\n\t\t\t<!-- Application header: END -->\r\n\r\n\t\t\t<!-- Breadcrumb trail area: BEGIN -->\r\n\t\t\t<div id=\"id-main-header-c-1\">&nbsp;</div>\r\n\t\t\t<div id=\"id-main-header-d-1\">\r\n\t\t\t\r\n\t\t\t<div id=\"breadCrumb\"><a href=\"/omni/index.jsp\" class=\"cls-link\" onclick=\"return checkFormChanged();\">Home</a> &gt; Offender</div>\r\n\t\t\t\r\n\t\t\t</div>\r\n\t\t\t<!-- Breadcrumb trail area: END -->\r\n\r\n\t\t\t<!-- Most recent search & logged-in user area: BEGIN -->\r\n\t\t\t\r\n\t\t\t<div id=\"id-main-header-d-2\">\r\n\t\t\t\t\r\n\r\n\t<!-- Global user menu: END -->\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\t<a href=\"http://helpsitesdemo/omni/\" class=\"cls-link-help\" rel=\"external\" onclick=\"window.open(this.href, 'HelpWindow'); return false;\"  onkeypress=\"window.open(this.href); return false;\">Help</a>\r\n\t\r\n\t&nbsp;\r\n\t<span id=\"id-logged-in\">Logged in as <strong>PerfOne Tester</strong></span>\r\n\t<!-- Global user menu: END -->\r\n\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t<!-- Most recent search & logged-in user area: END -->\r\n\r\n\t\t</div>\r\n\t\t<!-- Header content pane: END -->\r\n\r\n\t\t<!-- Left content pane: BEGIN -->\r\n\t\t\r\n\t\t<div id=\"menu-block-expanded\" style=\"display:inline; margin:5px; position:absolute; left:155px; top:100px; z-index:1;\">\r\n\t\t<a href=\"\" onclick=\"hideElement('id-main-left');hideElement('menu-block-expanded');showElement('menu-block-collapsed');resetMarginLeft('id-main-right', '25px');return(false);\" >\r\n\t\t<img style=\"border-width: 0px;\" \r\n\t\t      height=\"15\" alt=\"Hide Menu\" \r\n\t\t      src=\"/OMNIStatic/images/buttons/button-minus.gif\" /></a>\r\n\t\t</div>\r\n\t\t<div id=\"menu-block-collapsed\" style=\"display:none; margin:5px; position:absolute; left:0px; top:100px; z-index:1;\">\r\n\t\t<a href=\"\" onclick=\"showElement('id-main-left');showElement('menu-block-expanded');hideElement('menu-block-collapsed');resetMarginLeft('id-main-right', '190px');return(false);\" >\r\n\t\t<img style=\"border-width: 0px;\" \r\n\t\t      height=\"15\" alt=\"Show Menu\" \r\n\t\t      src=\"/OMNIStatic/images/buttons/button-plus.gif\" /></a>\r\n\t\t</div>\t\t\r\n\t\t\r\n\t\t<div id=\"id-main-left\">\r\n\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Left / Menu / Offender: BEGIN -->\r\n<ul class=\"cls-menu-left\">\r\n\t<li class=\"cls-menu-left-header\">Offender Menu</li>\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/records/offender/inmateStatus/inmateStatus.htm\" onclick=\"return processOmniLinkClick(this);\">General Status</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/records/offender/personalCharacteristics/offenderSummary.htm\" onclick=\"return processOmniLinkClick(this);\">Personal Characteristics</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/records/offender/registerOffender/registerOffender.htm\" onclick=\"return processOmniLinkClick(this);\">Register Offender</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t<li><a href=\"/omni/ssta/viewJSPrison.htm\" onclick=\"return processOmniLinkClick(this);\">Sentence Information</a></li>\r\n\t\t\t\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/records/offender/releaseNotificationStatus/releaseNotification.htm\" onclick=\"return processOmniLinkClick(this);\">Release Notification Status</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t<li><a href=\"/omni/vw/createVwNotification.htm\" onclick=\"return processOmniLinkClick(this);\">Victim/Witness Notification</a></li>\r\n\t\t\t\r\n\t\t\r\n\t\r\n\t\r\n\t\t<li><a href=\"/omni/detainee/viewWarrants.htm\" onclick=\"return processOmniLinkClick(this);\">Warrant Detainer Status</a></li>\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/grievance/viewGrievanceStatusList.htm\" onclick=\"return processOmniLinkClick(this);\">Grievance</a></li>\r\n\t\t\r\n\t\r\n\t<li class=\"cls-menu-left-inactive\">\r\n\t\t<hr />\r\n\t</li>\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/records/offender/index.htm\" onclick=\"return processOmniLinkClick(this);\">Chronological Events / Notifications / Checkdates</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/advcor/bhvr/behaviorObservationSummary.htm\" onclick=\"return processOmniLinkClick(this);\">Behavior Observation</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/cmfm/supervisionActivityRecord.htm\" onclick=\"return processOmniLinkClick(this);\">Supervision Activities</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t<li><a href=\"/omni/fieldhearings/createHearing.htm\" onclick=\"return processOmniLinkClick(this);\">Create Hearing</a></li>\r\n\t\t\t\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/fd/viewViolationSummary.htm\" onclick=\"return processOmniLinkClick(this);\">Field Discipline</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t<li><a href=\"/omni/isrb/viewIsrbActionsList.htm\" onclick=\"return processOmniLinkClick(this);\">ISRB Actions</a></li>\r\n\t\t\t\r\n\t\r\n\t\r\n\r\n\t\r\n\t\r\n\t\t\t\r\n\t\t\t        \r\n\t\t\t\t<li><a href=\"/omni/vip/violatorSummary.htm\" onclick=\"return processOmniLinkClick(this);\">Violator Management</a></li>\r\n\t\t\t\t    \r\n\t\t \t\r\n\t  \r\n\t\r\n\t<li class=\"cls-menu-left-inactive\"> \r\n\t\t<hr />\r\n\t</li>\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/pmbcm/bedAssign.htm\" onclick=\"return processOmniLinkClick(this);\">Assign Bed &amp; Counselor</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/pd/viewInfractionSummary.htm\" onclick=\"return processOmniLinkClick(this);\">Prison Discipline</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/pmbcm/extmv/externalMovements.htm\" onclick=\"return processOmniLinkClick(this);\">Prison Movements</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/menu/offender-screeningRestriction.htm\" onclick=\"return processOmniLinkClick(this);\">Screening &amp; Restriction</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/stg/stgOffenderInfo.htm\" onclick=\"return processOmniLinkClick(this);\">Security Threat Group</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/segman/viewSegmanAuthSummary.htm\" onclick=\"return processOmniLinkClick(this);\">Segregation Management</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/pmbcm/transfer/transferOrderSummary.htm\" onclick=\"return processOmniLinkClick(this);\">Transfer Orders</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t<li><a href=\"/omni/vw/createVictimWitness.htm\" onclick=\"return processOmniLinkClick(this);\">Victim/Witness</a></li>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/cos/cosLfoInformation.htm\" onclick=\"return processOmniLinkClick(this);\">COS/LFO Information</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/cos/cosTransactions.htm\" onclick=\"return processOmniLinkClick(this);\">COS Transactions</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/cos/cosPaymentAdjustments.htm\" onclick=\"return processOmniLinkClick(this);\">COS Payment Adjustments</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/cos/cosSuspenseAdjustment.htm\" onclick=\"return processOmniLinkClick(this);\">COS Suspense Adjustment</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/cos/interstateApplicationTransaction.htm\" onclick=\"return processOmniLinkClick(this);\">Interstate Application Transaction</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/cos/viewInterstateApplicationTransaction.htm\" onclick=\"return processOmniLinkClick(this);\">View Interstate Application Transaction</a></li>\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/dat/viewDAT.htm\" onclick=\"return processOmniLinkClick(this);\">Drug/Alcohol Tests</a></li>\r\n\t\t\r\n\t\r\n\t<li class=\"cls-menu-left-inactive\">\r\n\t\t<hr />\r\n\t</li>\r\n\t\r\n\t\t\r\n\t\t\t<li><a href=\"/omni/ssta/reports/offenderReports.htm\" onclick=\"return processOmniLinkClick(this);\">Offender Reports</a></li>\r\n\t\t\r\n\t\r\n</ul>\r\n\t\r\n\t<!-- Left Link Menu Start -->\r\n\t\r\n\t<ul class=\"cls-menu-left\">\r\n\t\t<li class=\"cls-menu-left-header\">Links</li>\r\n\t\t<li><a target=\"_new\" class=\".cls-link\" href=\"https://OnBaseQUAL/AppNet/docpop/docpop.aspx?clienttype=html&cqid=102&KT102_0_0_0=888912\">OnBase</a></li>\r\n\t\t<li><a target=\"_new\" class=\".cls-link\" href=\"http://ceconnectconv/cefield/\">CeField</a></li>\r\n\r\n\t\t<li><a target=\"_new\" class=\".cls-link\" href=\"http://ceprisonconv/\">CePrison</a></li>\r\n\r\n\t\t\r\n\t\t<li><a target=\"_new\" class=\".cls-link\" rel=\"external\" href=\"http://insidedoc/policies/\">Policies</a></li>\r\n\t\t<li><a target=\"_new\" class=\".cls-link\" href=\"http://reportwizardtest/Pages/Menu.aspx\">Report Wizard</a></li>\r\n\t</ul>\r\n<!-- Left / Menu / Offender: END -->\r\n\r\n\r\n\t\t\t\r\n<!-- Left / Offender Information: BEGIN -->\r\n\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\r\n\t\r\n\t\r\n\t\r\n\t\r\n\t\r\n\r\n\t<div id=\"id-menu-left-header\">\r\n\t\tPersonal Characteristics\r\n\t</div>\r\n\t<div id=\"id-menu-left\">\r\n\t\t<table border=\"0\" cellpadding=\"2\" cellspacing=\"0\" width=\"100%\">\r\n\t\t\t<tr><td colspan=\"2\" class=\"cls-label\" style=\"vertical-align:top;\" width=\"60px\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tName\r\n</span></td></tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td colspan=\"2\" class=\"cls-value\" style=\"vertical-align:top; white-space: normal; padding-bottom: 5px;\">\r\n\t\t\t\t\r\n\t\t\t\tTABLER,\r\n\t\t\t\tPatrick\r\n\t\t\t\tRoy\r\n\t\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t\r\n\t\t\t<tr><td colspan=\"2\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tAddress\r\n</span></td></tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td colspan=\"2\" style=\"padding-bottom: 5px;\">\r\n\t\t\t\t<!-- CQ 32761 -->\r\n\t\t\t\t\t917 FRUITVALE BLVD #25        <br/>\r\n\t\t\t\t\t\r\n\t\t\t\t\tYakima&nbsp;WA<br/>\r\n\t\t\t\t\tUnited States<br/>\r\n\t\t\t\t\t98902\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr><td colspan=\"2\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tPhone Number\r\n</span></td></tr>\r\n\t\t\t<tr><td colspan=\"2\" style=\"padding-bottom: 5px;\">(509) 452-5952</td></tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tSSN\r\n</span></td>\r\n\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;white-space: normal;\">\r\n\t\t\t\t\r\n\t\t\t\t508-17-2720\r\n\t\t\t\t\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tDOC Number\r\n</span></td>\r\n\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;\">888912</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tFBI Number\r\n</span></td>\r\n\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;white-space: normal;\">39380KC6 </td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tWASID Number\r\n</span></td>\r\n\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;white-space: normal;\">WA22967137</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tDOB\r\n</span></td>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;white-space: normal;\">December 8, 1986</td>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tAge\r\n</span></td>\r\n\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;\">31 yrs</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tRace\r\n</span></td>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;white-space: normal;\">White</td>\r\n\t\t\t\t\r\n\t\t\t    \r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tHeight\r\n</span></td>\r\n\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;\">6 ft. 2 In.</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tWeight\r\n</span></td>\r\n\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;\">196 lbs</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tEye Color\r\n</span></td>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;\">Brown</td>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"cls-label\" style=\"vertical-align:top;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tHair Color\r\n</span></td>\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<td class=\"cls-value\" style=\"vertical-align:top;\">Brown</td>\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t</tr>\r\n\t\t\t<tr>\r\n\t\t\t\t<td>&nbsp;</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n\r\n<!-- Left / Offender Information: END -->\r\n\t\t</div>\r\n\t\t\r\n\t\t<!-- Left content pane: END -->\r\n\r\n\t\t<!-- Right content pane: BEGIN -->\r\n\t\t<div id=\"id-main-right\">\r\n\r\n\t\t\t<!-- Autosave message area: BEGIN -->\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t<!-- Autosave message area: END -->\r\n\r\n\t\t\t<!-- Alert message area: BEGIN -->\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t<!-- Alert message area: END -->\r\n\r\n\t\t\t<!-- Main content area: BEGIN -->\r\n\t\t\t\r\n\t\t\t<!-- Main content goes here -->\r\n\t\t\t<div style=\"min-width: 1045px;\">\r\n\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div id=\"hdr_offenderCPHeader\">\r\n\t<form id=\"hdr_form\" action=\"\" >\r\n\t\t<input type=\"hidden\" value=\"\" name=\"persCallback\"/>\r\n\t\t<input type=\"hidden\" value=\"true\" name=\"persCheckIsDirty\"/>\r\n\t\t<input type=\"hidden\" value=\"\" name=\"inctvCallback\"/>\r\n\t\t<input type=\"hidden\" value=\"true\" name=\"inctvCheckIsDirty\"/>\r\n\t\t<input type=\"hidden\" value=\"$('#sc_section').trigger('header:expand'); return false;\" name=\"ccOnClick\"/>\r\n\t\t<input type=\"hidden\" value=\"$('#sc_section').trigger('header:expand'); return false;\" name=\"waOnClick\"/>\r\n\t\t<input type=\"hidden\" value=\"$('#sc_section').trigger('header:expand'); return false;\" name=\"scOnClick\"/>\r\n\t\t<input type=\"hidden\" value=\"false\" name=\"readOnly\"/>\r\n\t\t\r\n\t\t<input type=\"hidden\" value=\"\" name=\"isPrint\"/>\r\n\t\t<input type=\"hidden\" value=\"\" name=\"nrtvHstryPage\"/>\r\n\t</form>\r\n</div>\r\n<script type=\"text/javascript\">\r\n\t//<![CDATA[\r\n\t$.ajax({\r\n\t\turl:'/omni/advcor/csPln/offenderCPHeader.htm', \r\n\t\tdata:$(\"#hdr_form\").serialize(),\r\n\t\tasync: false\r\n\t}).done(function(html) {\r\n\t\t$(\"#hdr_offenderCPHeader\").empty().append(html);\t\t\t\t\r\n\t});\r\n\t//]]>\r\n</script>\r\n\r\n\t\t\t\r\n\t\t\t<form id=\"ocpForm\" action=\"offenderCasePlan.htm\" method=\"post\">\r\n\t\t\t\t<input id=\"lastAccessed\" name=\"lastAccessed\" type=\"hidden\" value=\"\"/>\r\n\t\t\t\t<input type=\"hidden\" id=\"submitAction\" name=\"submitAction\" />\r\n\t\t\t</form>\r\n\t\t\t\r\n\t\t\t<div id=\"mainCasePlanSection\" style=\"display: none;\">\r\n\t\t\t\t\r\n\t\t\t\t \r\n\t\t\t\t<a class=\"collapseAll disabled\" style=\"display: \">Collapse All</a><br/>\r\n\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\r\n<div id=\"cm_section\">\r\n\t<h3 class=\"\">Case Management<span class='flag'></span></h3>\r\n\t<div class=\"main-contents\" data-url=\"caseMgmt.htm\" ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"cm_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n      afterExpand: onAfterExpand,  \r\n      afterCollapse: onAfterCollapse,\r\n      title2: '',\r\n      scrollToBanner: true,\r\n      cached: true\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div id=\"cn_section\">\r\n\t<h3 class=\"\">Contacts</h3>\r\n\t<div class=\"main-contents\" data-url=\"../cntc/contacts.htm\" ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"cn_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n      afterExpand: onAfterExpand,  \r\n      afterCollapse: onAfterCollapse,\r\n      title2: '<span style=\"display: inline-block; width:95%\" id=\"cntcPrdRsltsSpan\"></span>',\r\n      scrollToBanner: true,\r\n      cached: false\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div id=\"ch_section\">\r\n\t<h3 class=\"\">Criminal History</h3>\r\n\t<div class=\"main-contents\" data-url=\"../ccr/ccrHeaderBanner.htm\" ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"ch_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n      afterExpand: onAfterExpand,  \r\n      afterCollapse: onAfterCollapse,\r\n      title2: '',\r\n      scrollToBanner: true,\r\n      cached: false\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\t\t\t\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\r\n<div id=\"as_section\">\r\n\t<h3 class=\"\">Assessments</h3>\r\n\t<div class=\"main-contents\" data-url=\"../riskAssmnts/assessments.htm\" ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"as_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n      afterExpand: onAfterExpand,  \r\n      afterCollapse: onAfterCollapse,\r\n      title2: '',\r\n      scrollToBanner: true,\r\n      cached: true\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\r\n<div id=\"sc_section\">\r\n\t<h3 class=\"\">Safety Concerns<span class=\"flag \"></span></h3>\r\n\t<div class=\"main-contents\" data-url=\"safetyConcerns.htm\" ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"sc_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n      afterExpand: onAfterExpand,  \r\n      afterCollapse: onAfterCollapse,\r\n      title2: '',\r\n      scrollToBanner: true,\r\n      cached: true\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\r\n<div id=\"bh_section\">\r\n\t<h3 class=\"\">Behavior<span class=\"flag \"></span></h3>\r\n\t<div class=\"main-contents\" data-url=\"behavior.htm\" ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"bh_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n      afterExpand: onAfterExpand,  \r\n      afterCollapse: onAfterCollapse,\r\n      title2: '',\r\n      scrollToBanner: true,\r\n      cached: true\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\r\n\r\n\t\r\n\r\n<div id=\"ct_section\">\r\n\t<h3 class=\"disabled\">Custody/Transfers\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t&nbsp;&nbsp;<span style=\"left:7%;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a href=\"/omni/cfp/index.htm\" class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; \">Custody Facility Plan</a>\r\n</span>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<span style=\"right:7%;position: absolute;\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a href=\"/omni/vip/violatorSummary.htm\" class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; \">Violator Management</a>\r\n</span></h3>\r\n\t<div class=\"main-contents\"  ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"ct_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n        \r\n      \r\n      title2: '',\r\n      scrollToBanner: false,\r\n      cached: true\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\r\n\r\n\t\r\n\r\n<div id=\"re_section\">\r\n\t<h3 class=\"disabled\">Reentry</h3>\r\n\t<div class=\"main-contents\"  ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"re_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n        \r\n      \r\n      title2: '',\r\n      scrollToBanner: false,\r\n      cached: true\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\r\n\r\n\t\r\n\r\n<div id=\"rp_section\">\r\n\t<h3 class=\"disabled\">Reports</h3>\r\n\t<div class=\"main-contents\"  ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"rp_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n        \r\n      \r\n      title2: '',\r\n      scrollToBanner: false,\r\n      cached: true\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\t\t\t\t\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\r\n\r\n\r\n\t\r\n\r\n<div id=\"ce_section\">\r\n\t<h3 class=\"disabled\">Chronological Events</h3>\r\n\t<div class=\"main-contents\"  ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"ce_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n        \r\n      \r\n      title2: '',\r\n      scrollToBanner: false,\r\n      cached: true\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div id=\"sa_section\">\r\n\t<h3 class=\"\">Supervisor Approvals</h3>\r\n\t<div class=\"main-contents\" data-url=\"supervisorApprovals.htm\" ></div>\r\n</div>\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n$(document).ready(function($) { \r\n   $(\"#\" + esc(\"sa_section\")).collapsible({ \r\n      init: function() { $(this).find(\".collapsible-header\").data(\"state\", \"collapsed\"); },\r\n        \r\n      afterExpand: onAfterExpand,  \r\n      afterCollapse: onAfterCollapse,\r\n      title2: '',\r\n      scrollToBanner: true,\r\n      cached: false\r\n   });\r\n});\r\n//]]>\r\n</script>\r\n\t\t\t\t\r\n\t\t\t\t<a class=\"collapseAll disabled\">Collapse All</a><br/>\r\n\t\t\t\r\n\t\t\t\t<div style=\"height: 1000px;\" />\r\n\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t<!-- Main content area: END -->\r\n\r\n\t\t</div>\r\n\t\t<!-- Right content pane: END -->\r\n\r\n\t</body>\r\n\t<!-- Body portion: END -->\r\n\r\n</html>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 393,
          "bodySize": 43670
        },
        "cache": {},
        "timings": {
          "send": 84,
          "wait": 0,
          "receive": 6
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8633"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.106-07:00",
        "time": 77,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/dwr/engine.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "If-Modified-Since",
              "value": "Mon, 13 Aug 2018 16:13:45 GMT"
            },
            {
              "name": "If-None-Match",
              "value": "\"1534176825000\""
            }
          ],
          "queryString": [],
          "headersSize": 426,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Cache-Control",
              "value": "must-revalidate, post-check=0, pre-check=0"
            },
            {
              "name": "Pragma",
              "value": "public"
            },
            {
              "name": "Content-Type",
              "value": "text/javascript; charset=utf-8"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Expires",
              "value": "0"
            },
            {
              "name": "Last-Modified",
              "value": "Mon, 13 Aug 2018 16:13:45 GMT"
            },
            {
              "name": "ETag",
              "value": "\"1534176825000\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Connection",
              "value": "close"
            }
          ],
          "content": {
            "size": 47356,
            "compression": 0,
            "mimeType": "text/javascript; charset=utf-8",
            "text": "/*\n * Copyright 2005 Joe Walker\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Declare an object to which we can add real functions.\n */\nif (dwr == null) var dwr = {};\nif (dwr.engine == null) dwr.engine = {};\nif (DWREngine == null) var DWREngine = dwr.engine;\n\n/**\n * Set an alternative error handler from the default alert box.\n * @see getahead.org/dwr/browser/engine/errors\n */\ndwr.engine.setErrorHandler = function(handler) {\n  dwr.engine._errorHandler = handler;\n};\n\n/**\n * Set an alternative warning handler from the default alert box.\n * @see getahead.org/dwr/browser/engine/errors\n */\ndwr.engine.setWarningHandler = function(handler) {\n  dwr.engine._warningHandler = handler;\n};\n\n/**\n * Setter for the text/html handler - what happens if a DWR request gets an HTML\n * reply rather than the expected Javascript. Often due to login timeout\n */\ndwr.engine.setTextHtmlHandler = function(handler) {\n  dwr.engine._textHtmlHandler = handler;\n};\n\n/**\n * Set a default timeout value for all calls. 0 (the default) turns timeouts off.\n * @see getahead.org/dwr/browser/engine/errors\n */\ndwr.engine.setTimeout = function(timeout) {\n  dwr.engine._timeout = timeout;\n};\n\n/**\n * The Pre-Hook is called before any DWR remoting is done.\n * @see getahead.org/dwr/browser/engine/hooks\n */\ndwr.engine.setPreHook = function(handler) {\n  dwr.engine._preHook = handler;\n};\n\n/**\n * The Post-Hook is called after any DWR remoting is done.\n * @see getahead.org/dwr/browser/engine/hooks\n */\ndwr.engine.setPostHook = function(handler) {\n  dwr.engine._postHook = handler;\n};\n\n/**\n * Custom headers for all DWR calls\n * @see getahead.org/dwr/????\n */\ndwr.engine.setHeaders = function(headers) {\n  dwr.engine._headers = headers;\n};\n\n/**\n * Custom parameters for all DWR calls\n * @see getahead.org/dwr/????\n */\ndwr.engine.setParameters = function(parameters) {\n  dwr.engine._parameters = parameters;\n};\n\n/** XHR remoting type constant. See dwr.engine.set[Rpc|Poll]Type() */\ndwr.engine.XMLHttpRequest = 1;\n\n/** XHR remoting type constant. See dwr.engine.set[Rpc|Poll]Type() */\ndwr.engine.IFrame = 2;\n\n/** XHR remoting type constant. See dwr.engine.setRpcType() */\ndwr.engine.ScriptTag = 3;\n\n/**\n * Set the preferred remoting type.\n * @param newType One of dwr.engine.XMLHttpRequest or dwr.engine.IFrame or dwr.engine.ScriptTag\n * @see getahead.org/dwr/browser/engine/options\n */\ndwr.engine.setRpcType = function(newType) {\n  if (newType != dwr.engine.XMLHttpRequest && newType != dwr.engine.IFrame && newType != dwr.engine.ScriptTag) {\n    dwr.engine._handleError(null, { name:\"dwr.engine.invalidRpcType\", message:\"RpcType must be one of dwr.engine.XMLHttpRequest or dwr.engine.IFrame or dwr.engine.ScriptTag\" });\n    return;\n  }\n  dwr.engine._rpcType = newType;\n};\n\n/**\n * Which HTTP method do we use to send results? Must be one of \"GET\" or \"POST\".\n * @see getahead.org/dwr/browser/engine/options\n */\ndwr.engine.setHttpMethod = function(httpMethod) {\n  if (httpMethod != \"GET\" && httpMethod != \"POST\") {\n    dwr.engine._handleError(null, { name:\"dwr.engine.invalidHttpMethod\", message:\"Remoting method must be one of GET or POST\" });\n    return;\n  }\n  dwr.engine._httpMethod = httpMethod;\n};\n\n/**\n * Ensure that remote calls happen in the order in which they were sent? (Default: false)\n * @see getahead.org/dwr/browser/engine/ordering\n */\ndwr.engine.setOrdered = function(ordered) {\n  dwr.engine._ordered = ordered;\n};\n\n/**\n * Do we ask the XHR object to be asynchronous? (Default: true)\n * @see getahead.org/dwr/browser/engine/options\n */\ndwr.engine.setAsync = function(async) {\n  dwr.engine._async = async;\n};\n\n/**\n * Does DWR poll the server for updates? (Default: false)\n * @see getahead.org/dwr/browser/engine/options\n */\ndwr.engine.setActiveReverseAjax = function(activeReverseAjax) {\n  if (activeReverseAjax) {\n    // Bail if we are already started\n    if (dwr.engine._activeReverseAjax) return;\n    dwr.engine._activeReverseAjax = true;\n    dwr.engine._poll();\n  }\n  else {\n    // Can we cancel an existing request?\n    if (dwr.engine._activeReverseAjax && dwr.engine._pollReq) dwr.engine._pollReq.abort();\n    dwr.engine._activeReverseAjax = false;\n  }\n  // TODO: in iframe mode, if we start, stop, start then the second start may\n  // well kick off a second iframe while the first is still about to return\n  // we should cope with this but we don't\n};\n\n/**\n * The default message handler.\n * @see getahead.org/dwr/browser/engine/errors\n */\ndwr.engine.defaultErrorHandler = function(message, ex) {\n  dwr.engine._debug(\"Error: \" + ex.name + \", \" + ex.message, true);\n  if (message == null || message == \"\") alert(\"A server error has occured.\");\n  // Ignore NS_ERROR_NOT_AVAILABLE if Mozilla is being narky\n  else if (message.indexOf(\"0x80040111\") != -1) dwr.engine._debug(message);\n  else alert(message);\n};\n\n/**\n * The default warning handler.\n * @see getahead.org/dwr/browser/engine/errors\n */\ndwr.engine.defaultWarningHandler = function(message, ex) {\n  dwr.engine._debug(message);\n};\n\n/**\n * For reduced latency you can group several remote calls together using a batch.\n * @see getahead.org/dwr/browser/engine/batch\n */\ndwr.engine.beginBatch = function() {\n  if (dwr.engine._batch) {\n    dwr.engine._handleError(null, { name:\"dwr.engine.batchBegun\", message:\"Batch already begun\" });\n    return;\n  }\n  dwr.engine._batch = dwr.engine._createBatch();\n};\n\n/**\n * Finished grouping a set of remote calls together. Go and execute them all.\n * @see getahead.org/dwr/browser/engine/batch\n */\ndwr.engine.endBatch = function(options) {\n  var batch = dwr.engine._batch;\n  if (batch == null) {\n    dwr.engine._handleError(null, { name:\"dwr.engine.batchNotBegun\", message:\"No batch in progress\" });\n    return;\n  }\n  dwr.engine._batch = null;\n  if (batch.map.callCount == 0) return;\n\n  // The hooks need to be merged carefully to preserve ordering\n  if (options) dwr.engine._mergeBatch(batch, options);\n\n  // In ordered mode, we don't send unless the list of sent items is empty\n  if (dwr.engine._ordered && dwr.engine._batchesLength != 0) {\n    dwr.engine._batchQueue[dwr.engine._batchQueue.length] = batch;\n  }\n  else {\n    dwr.engine._sendData(batch);\n  }\n};\n\n/** @deprecated */\ndwr.engine.setPollMethod = function(type) { dwr.engine.setPollType(type); };\ndwr.engine.setMethod = function(type) { dwr.engine.setRpcType(type); };\ndwr.engine.setVerb = function(verb) { dwr.engine.setHttpMethod(verb); };\ndwr.engine.setPollType = function() { dwr.engine._debug(\"Manually setting the Poll Type is not supported\"); };\n\n//==============================================================================\n// Only private stuff below here\n//==============================================================================\n\n/** The original page id sent from the server */\ndwr.engine._origScriptSessionId = \"FD4D5052C975051AE93369486B9585F1\";\n\n/** The session cookie name */\ndwr.engine._sessionCookieName = \"JSESSIONID\"; // JSESSIONID\n\n/** Is GET enabled for the benefit of Safari? */\ndwr.engine._allowGetForSafariButMakeForgeryEasier = \"false\";\n\n/** The script prefix to strip in the case of scriptTagProtection. */\ndwr.engine._scriptTagProtection = \"throw 'allowScriptTagRemoting is false.';\";\n\n/** The default path to the DWR servlet */\ndwr.engine._defaultPath = \"/omni/dwr\";\n\n/** Do we use XHR for reverse ajax because we are not streaming? */\ndwr.engine._pollWithXhr = \"false\";\n\n/** The read page id that we calculate */\ndwr.engine._scriptSessionId = null;\n\n/** The function that we use to fetch/calculate a session id */\ndwr.engine._getScriptSessionId = function() {\n  if (dwr.engine._scriptSessionId == null) {\n    dwr.engine._scriptSessionId = dwr.engine._origScriptSessionId + Math.floor(Math.random() * 1000);\n  }\n  return dwr.engine._scriptSessionId;\n};\n\n/** A function to call if something fails. */\ndwr.engine._errorHandler = dwr.engine.defaultErrorHandler;\n\n/** For debugging when something unexplained happens. */\ndwr.engine._warningHandler = dwr.engine.defaultWarningHandler;\n\n/** A function to be called before requests are marshalled. Can be null. */\ndwr.engine._preHook = null;\n\n/** A function to be called after replies are received. Can be null. */\ndwr.engine._postHook = null;\n\n/** An map of the batches that we have sent and are awaiting a reply on. */\ndwr.engine._batches = {};\n\n/** A count of the number of outstanding batches. Should be == to _batches.length unless prototype has messed things up */\ndwr.engine._batchesLength = 0;\n\n/** In ordered mode, the array of batches waiting to be sent */\ndwr.engine._batchQueue = [];\n\n/** What is the default rpc type */\ndwr.engine._rpcType = dwr.engine.XMLHttpRequest;\n\n/** What is the default remoting method (ie GET or POST) */\ndwr.engine._httpMethod = \"POST\";\n\n/** Do we attempt to ensure that calls happen in the order in which they were sent? */\ndwr.engine._ordered = false;\n\n/** Do we make the calls async? */\ndwr.engine._async = true;\n\n/** The current batch (if we are in batch mode) */\ndwr.engine._batch = null;\n\n/** The global timeout */\ndwr.engine._timeout = 0;\n\n/** ActiveX objects to use when we want to convert an xml string into a DOM object. */\ndwr.engine._DOMDocument = [\"Msxml2.DOMDocument.6.0\", \"Msxml2.DOMDocument.5.0\", \"Msxml2.DOMDocument.4.0\", \"Msxml2.DOMDocument.3.0\", \"MSXML2.DOMDocument\", \"MSXML.DOMDocument\", \"Microsoft.XMLDOM\"];\n\n/** The ActiveX objects to use when we want to do an XMLHttpRequest call. */\ndwr.engine._XMLHTTP = [\"Msxml2.XMLHTTP.6.0\", \"Msxml2.XMLHTTP.5.0\", \"Msxml2.XMLHTTP.4.0\", \"MSXML2.XMLHTTP.3.0\", \"MSXML2.XMLHTTP\", \"Microsoft.XMLHTTP\"];\n\n/** Are we doing comet or polling? */\ndwr.engine._activeReverseAjax = false;\n\n/** The iframe that we are using to poll */\ndwr.engine._outstandingIFrames = [];\n\n/** The xhr object that we are using to poll */\ndwr.engine._pollReq = null;\n\n/** How many milliseconds between internal comet polls */\ndwr.engine._pollCometInterval = 200;\n\n/** How many times have we re-tried to poll? */\ndwr.engine._pollRetries = 0;\ndwr.engine._maxPollRetries = 0;\n\n/** Do we do a document.reload if we get a text/html reply? */\ndwr.engine._textHtmlHandler = null;\n\n/** If you wish to send custom headers with every request */\ndwr.engine._headers = null;\n\n/** If you wish to send extra custom request parameters with each request */\ndwr.engine._parameters = null;\n\n/** Undocumented interceptors - do not use */\ndwr.engine._postSeperator = \"\\n\";\ndwr.engine._defaultInterceptor = function(data) { return data; };\ndwr.engine._urlRewriteHandler = dwr.engine._defaultInterceptor;\ndwr.engine._contentRewriteHandler = dwr.engine._defaultInterceptor;\ndwr.engine._replyRewriteHandler = dwr.engine._defaultInterceptor;\n\n/** Batch ids allow us to know which batch the server is answering */\ndwr.engine._nextBatchId = 0;\n\n/** A list of the properties that need merging from calls to a batch */\ndwr.engine._propnames = [ \"rpcType\", \"httpMethod\", \"async\", \"timeout\", \"errorHandler\", \"warningHandler\", \"textHtmlHandler\" ];\n\n/** Do we stream, or can be hacked to do so? */\ndwr.engine._partialResponseNo = 0;\ndwr.engine._partialResponseYes = 1;\ndwr.engine._partialResponseFlush = 2;\n\n/** Is this page in the process of unloading? */\ndwr.engine._unloading = false;\n\n/**\n * @private Send a request. Called by the Javascript interface stub\n * @param path part of URL after the host and before the exec bit without leading or trailing /s\n * @param scriptName The class to execute\n * @param methodName The method on said class to execute\n * @param func The callback function to which any returned data should be passed\n *       if this is null, any returned data will be ignored\n * @param vararg_params The parameters to pass to the above class\n */\ndwr.engine._execute = function(path, scriptName, methodName, vararg_params) {\n  var singleShot = false;\n  if (dwr.engine._batch == null) {\n    dwr.engine.beginBatch();\n    singleShot = true;\n  }\n  var batch = dwr.engine._batch;\n  // To make them easy to manipulate we copy the arguments into an args array\n  var args = [];\n  for (var i = 0; i < arguments.length - 3; i++) {\n    args[i] = arguments[i + 3];\n  }\n  // All the paths MUST be to the same servlet\n  if (batch.path == null) {\n    batch.path = path;\n  }\n  else {\n    if (batch.path != path) {\n      dwr.engine._handleError(batch, { name:\"dwr.engine.multipleServlets\", message:\"Can't batch requests to multiple DWR Servlets.\" });\n      return;\n    }\n  }\n  // From the other params, work out which is the function (or object with\n  // call meta-data) and which is the call parameters\n  var callData;\n  var lastArg = args[args.length - 1];\n  if (typeof lastArg == \"function\" || lastArg == null) callData = { callback:args.pop() };\n  else callData = args.pop();\n\n  // Merge from the callData into the batch\n  dwr.engine._mergeBatch(batch, callData);\n  batch.handlers[batch.map.callCount] = {\n    exceptionHandler:callData.exceptionHandler,\n    callback:callData.callback\n  };\n\n  // Copy to the map the things that need serializing\n  var prefix = \"c\" + batch.map.callCount + \"-\";\n  batch.map[prefix + \"scriptName\"] = scriptName;\n  batch.map[prefix + \"methodName\"] = methodName;\n  batch.map[prefix + \"id\"] = batch.map.callCount;\n  var refctx = [];\n  for (i = 0; i < args.length; i++) {\n    dwr.engine._serializeAll(batch, refctx, args[i], prefix + \"param\" + i);\n  }\n\n  // Now we have finished remembering the call, we incr the call count\n  batch.map.callCount++;\n  if (singleShot) dwr.engine.endBatch();\n};\n\n/** @private Poll the server to see if there is any data waiting */\ndwr.engine._poll = function() {\n  if (!dwr.engine._activeReverseAjax) return;\n\n  var batch = dwr.engine._createBatch();\n  batch.map.id = 0; // TODO: Do we need this??\n  batch.map.callCount = 1;\n  batch.isPoll = true;\n  if (dwr.engine._pollWithXhr == \"true\") {\n    batch.rpcType = dwr.engine.XMLHttpRequest;\n    batch.map.partialResponse = dwr.engine._partialResponseNo;\n  }\n  else {\n    if (navigator.userAgent.indexOf(\"Gecko/\") != -1) {\n      batch.rpcType = dwr.engine.XMLHttpRequest;\n      batch.map.partialResponse = dwr.engine._partialResponseYes;\n    }\n    else {\n      batch.rpcType = dwr.engine.XMLHttpRequest;\n      batch.map.partialResponse = dwr.engine._partialResponseNo;\n    }\n  }\n  batch.httpMethod = \"POST\";\n  batch.async = true;\n  batch.timeout = 0;\n  batch.path = dwr.engine._defaultPath;\n  batch.preHooks = [];\n  batch.postHooks = [];\n  batch.errorHandler = dwr.engine._pollErrorHandler;\n  batch.warningHandler = dwr.engine._pollErrorHandler;\n  batch.handlers[0] = {\n    callback:function(pause) {\n      dwr.engine._pollRetries = 0;\n      setTimeout(dwr.engine._poll, pause);\n    }\n  };\n\n  // Send the data\n  dwr.engine._sendData(batch);\n  if (batch.rpcType == dwr.engine.XMLHttpRequest && batch.map.partialResponse == dwr.engine._partialResponseYes) {\n    dwr.engine._checkCometPoll();\n  }\n};\n\n/** Try to recover from polling errors */\ndwr.engine._pollErrorHandler = function(msg, ex) {\n  // if anything goes wrong then just silently try again (up to 3x) after 10s\n  dwr.engine._pollRetries++;\n  dwr.engine._debug(\"Reverse Ajax poll failed (pollRetries=\" + dwr.engine._pollRetries + \"): \" + ex.name + \" : \" + ex.message);\n  if (dwr.engine._pollRetries < dwr.engine._maxPollRetries) {\n    setTimeout(dwr.engine._poll, 10000);\n  }\n  else {\n    dwr.engine._activeReverseAjax = false;\n    dwr.engine._debug(\"Giving up.\");\n  }\n};\n\n/** @private Generate a new standard batch */\ndwr.engine._createBatch = function() {\n  var batch = {\n    map:{\n      callCount:0,\n      page:window.location.pathname + window.location.search,\n      httpSessionId:dwr.engine._getJSessionId(),\n      scriptSessionId:dwr.engine._getScriptSessionId()\n    },\n    charsProcessed:0, paramCount:0,\n    parameters:{}, headers:{},\n    isPoll:false, handlers:{}, preHooks:[], postHooks:[],\n    rpcType:dwr.engine._rpcType,\n    httpMethod:dwr.engine._httpMethod,\n    async:dwr.engine._async,\n    timeout:dwr.engine._timeout,\n    errorHandler:dwr.engine._errorHandler,\n    warningHandler:dwr.engine._warningHandler,\n    textHtmlHandler:dwr.engine._textHtmlHandler\n  };\n  if (dwr.engine._preHook) batch.preHooks.push(dwr.engine._preHook);\n  if (dwr.engine._postHook) batch.postHooks.push(dwr.engine._postHook);\n  var propname, data;\n  if (dwr.engine._headers) {\n    for (propname in dwr.engine._headers) {\n      data = dwr.engine._headers[propname];\n      if (typeof data != \"function\") batch.headers[propname] = data;\n    }\n  }\n  if (dwr.engine._parameters) {\n    for (propname in dwr.engine._parameters) {\n      data = dwr.engine._parameters[propname];\n      if (typeof data != \"function\") batch.parameters[propname] = data;\n    }\n  }\n  return batch;\n};\n\n/** @private Take further options and merge them into */\ndwr.engine._mergeBatch = function(batch, overrides) {\n  var propname, data;\n  for (var i = 0; i < dwr.engine._propnames.length; i++) {\n    propname = dwr.engine._propnames[i];\n    if (overrides[propname] != null) batch[propname] = overrides[propname];\n  }\n  if (overrides.preHook != null) batch.preHooks.unshift(overrides.preHook);\n  if (overrides.postHook != null) batch.postHooks.push(overrides.postHook);\n  if (overrides.headers) {\n    for (propname in overrides.headers) {\n      data = overrides.headers[propname];\n      if (typeof data != \"function\") batch.headers[propname] = data;\n    }\n  }\n  if (overrides.parameters) {\n    for (propname in overrides.parameters) {\n      data = overrides.parameters[propname];\n      if (typeof data != \"function\") batch.map[\"p-\" + propname] = \"\" + data;\n    }\n  }\n};\n\n/** @private What is our session id? */\ndwr.engine._getJSessionId =  function() {\n  var cookies = document.cookie.split(';');\n  for (var i = 0; i < cookies.length; i++) {\n    var cookie = cookies[i];\n    while (cookie.charAt(0) == ' ') cookie = cookie.substring(1, cookie.length);\n    if (cookie.indexOf(dwr.engine._sessionCookieName + \"=\") == 0) {\n      return cookie.substring(dwr.engine._sessionCookieName.length + 1, cookie.length);\n    }\n  }\n  return \"\";\n};\n\n/** @private Check for reverse Ajax activity */\ndwr.engine._checkCometPoll = function() {\n  for (var i = 0; i < dwr.engine._outstandingIFrames.length; i++) {\n    var text = \"\";\n    var iframe = dwr.engine._outstandingIFrames[i];\n    try {\n      text = dwr.engine._getTextFromCometIFrame(iframe);\n    }\n    catch (ex) {\n      dwr.engine._handleWarning(iframe.batch, ex);\n    }\n    if (text != \"\") dwr.engine._processCometResponse(text, iframe.batch);\n  }\n  if (dwr.engine._pollReq) {\n    var req = dwr.engine._pollReq;\n    var text = req.responseText;\n    if (text != null) dwr.engine._processCometResponse(text, req.batch);\n  }\n\n  // If the poll resources are still there, come back again\n  if (dwr.engine._outstandingIFrames.length > 0 || dwr.engine._pollReq) {\n    setTimeout(dwr.engine._checkCometPoll, dwr.engine._pollCometInterval);\n  }\n};\n\n/** @private Extract the whole (executed an all) text from the current iframe */\ndwr.engine._getTextFromCometIFrame = function(frameEle) {\n  var body = frameEle.contentWindow.document.body;\n  if (body == null) return \"\";\n  var text = body.innerHTML;\n  // We need to prevent IE from stripping line feeds\n  if (text.indexOf(\"<PRE>\") == 0 || text.indexOf(\"<pre>\") == 0) {\n    text = text.substring(5, text.length - 7);\n  }\n  return text;\n};\n\n/** @private Some more text might have come in, test and execute the new stuff */\ndwr.engine._processCometResponse = function(response, batch) {\n  if (batch.charsProcessed == response.length) return;\n  if (response.length == 0) {\n    batch.charsProcessed = 0;\n    return;\n  }\n\n  var firstStartTag = response.indexOf(\"//#DWR-START#\", batch.charsProcessed);\n  if (firstStartTag == -1) {\n    // dwr.engine._debug(\"No start tag (search from \" + batch.charsProcessed + \"). skipping '\" + response.substring(batch.charsProcessed) + \"'\");\n    batch.charsProcessed = response.length;\n    return;\n  }\n  // if (firstStartTag > 0) {\n  //   dwr.engine._debug(\"Start tag not at start (search from \" + batch.charsProcessed + \"). skipping '\" + response.substring(batch.charsProcessed, firstStartTag) + \"'\");\n  // }\n\n  var lastEndTag = response.lastIndexOf(\"//#DWR-END#\");\n  if (lastEndTag == -1) {\n    // dwr.engine._debug(\"No end tag. unchanged charsProcessed=\" + batch.charsProcessed);\n    return;\n  }\n\n  // Skip the end tag too for next time, remembering CR and LF\n  if (response.charCodeAt(lastEndTag + 11) == 13 && response.charCodeAt(lastEndTag + 12) == 10) {\n    batch.charsProcessed = lastEndTag + 13;\n  }\n  else {\n    batch.charsProcessed = lastEndTag + 11;\n  }\n\n  var exec = response.substring(firstStartTag + 13, lastEndTag);\n\n  dwr.engine._receivedBatch = batch;\n  dwr.engine._eval(exec);\n  dwr.engine._receivedBatch = null;\n};\n\n/** @private Actually send the block of data in the batch object. */\ndwr.engine._sendData = function(batch) {\n  batch.map.batchId = dwr.engine._nextBatchId;\n  dwr.engine._nextBatchId++;\n  dwr.engine._batches[batch.map.batchId] = batch;\n  dwr.engine._batchesLength++;\n  batch.completed = false;\n\n  for (var i = 0; i < batch.preHooks.length; i++) {\n    batch.preHooks[i]();\n  }\n  batch.preHooks = null;\n  // Set a timeout\n  if (batch.timeout && batch.timeout != 0) {\n    batch.timeoutId = setTimeout(function() { dwr.engine._abortRequest(batch); }, batch.timeout);\n  }\n  // Get setup for XMLHttpRequest if possible\n  if (batch.rpcType == dwr.engine.XMLHttpRequest) {\n    if (window.XMLHttpRequest) {\n      batch.req = new XMLHttpRequest();\n    }\n    // IE5 for the mac claims to support window.ActiveXObject, but throws an error when it's used\n    else if (window.ActiveXObject && !(navigator.userAgent.indexOf(\"Mac\") >= 0 && navigator.userAgent.indexOf(\"MSIE\") >= 0)) {\n      batch.req = dwr.engine._newActiveXObject(dwr.engine._XMLHTTP);\n    }\n  }\n\n  var prop, request;\n  if (batch.req) {\n    // Proceed using XMLHttpRequest\n    if (batch.async) {\n      batch.req.onreadystatechange = function() {\n        if (typeof dwr != 'undefined') dwr.engine._stateChange(batch);\n      };\n    }\n    // If we're polling, record this for monitoring\n    if (batch.isPoll) {\n      dwr.engine._pollReq = batch.req;\n      // In IE XHR is an ActiveX control so you can't augment it like this\n      if (!(document.all && !window.opera)) batch.req.batch = batch;\n    }\n    // Workaround for Safari 1.x POST bug\n    var indexSafari = navigator.userAgent.indexOf(\"Safari/\");\n    if (indexSafari >= 0) {\n      var version = navigator.userAgent.substring(indexSafari + 7);\n      if (parseInt(version, 10) < 400) {\n        if (dwr.engine._allowGetForSafariButMakeForgeryEasier == \"true\") batch.httpMethod = \"GET\";\n        else dwr.engine._handleWarning(batch, { name:\"dwr.engine.oldSafari\", message:\"Safari GET support disabled. See getahead.org/dwr/server/servlet and allowGetForSafariButMakeForgeryEasier.\" });\n      }\n    }\n    batch.mode = batch.isPoll ? dwr.engine._ModePlainPoll : dwr.engine._ModePlainCall;\n    request = dwr.engine._constructRequest(batch);\n    try {\n      batch.req.open(batch.httpMethod, request.url, batch.async);\n      try {\n        for (prop in batch.headers) {\n          var value = batch.headers[prop];\n          if (typeof value == \"string\") batch.req.setRequestHeader(prop, value);\n        }\n        if (!batch.headers[\"Content-Type\"]) batch.req.setRequestHeader(\"Content-Type\", \"text/plain\");\n      }\n      catch (ex) {\n        dwr.engine._handleWarning(batch, ex);\n      }\n      batch.req.send(request.body);\n      if (!batch.async) dwr.engine._stateChange(batch);\n    }\n    catch (ex) {\n      dwr.engine._handleError(batch, ex);\n    }\n  }\n  else if (batch.rpcType != dwr.engine.ScriptTag) {\n    var idname = batch.isPoll ? \"dwr-if-poll-\" + batch.map.batchId : \"dwr-if-\" + batch.map.batchId;\n    // Removed htmlfile implementation. Don't expect it to return before v3\n    batch.div = document.createElement(\"div\");\n    // Add the div to the document first, otherwise IE 6 will ignore onload handler.\n    document.body.appendChild(batch.div);\n    batch.div.innerHTML = \"<iframe src='javascript:void(0)' frameborder='0' style='width:0px;height:0px;border:0;' id='\" + idname + \"' name='\" + idname + \"' onload='dwr.engine._iframeLoadingComplete (\" + batch.map.batchId + \");'></iframe>\";\n    batch.document = document;\n    batch.iframe = batch.document.getElementById(idname);\n    batch.iframe.batch = batch;\n    batch.mode = batch.isPoll ? dwr.engine._ModeHtmlPoll : dwr.engine._ModeHtmlCall;\n    if (batch.isPoll) dwr.engine._outstandingIFrames.push(batch.iframe);\n    request = dwr.engine._constructRequest(batch);\n    if (batch.httpMethod == \"GET\") {\n      batch.iframe.setAttribute(\"src\", request.url);\n    }\n    else {\n      batch.form = batch.document.createElement(\"form\");\n      batch.form.setAttribute(\"id\", \"dwr-form\");\n      batch.form.setAttribute(\"action\", request.url);\n      batch.form.setAttribute(\"style\", \"display:none;\");\n      batch.form.setAttribute(\"target\", idname);\n      batch.form.target = idname;\n      batch.form.setAttribute(\"method\", batch.httpMethod);\n      for (prop in batch.map) {\n        var value = batch.map[prop];\n        if (typeof value != \"function\") {\n          var formInput = batch.document.createElement(\"input\");\n          formInput.setAttribute(\"type\", \"hidden\");\n          formInput.setAttribute(\"name\", prop);\n          formInput.setAttribute(\"value\", value);\n          batch.form.appendChild(formInput);\n        }\n      }\n      batch.document.body.appendChild(batch.form);\n      batch.form.submit();\n    }\n  }\n  else {\n    batch.httpMethod = \"GET\"; // There's no such thing as ScriptTag using POST\n    batch.mode = batch.isPoll ? dwr.engine._ModePlainPoll : dwr.engine._ModePlainCall;\n    request = dwr.engine._constructRequest(batch);\n    batch.script = document.createElement(\"script\");\n    batch.script.id = \"dwr-st-\" + batch.map[\"c0-id\"];\n    batch.script.src = request.url;\n    document.body.appendChild(batch.script);\n  }\n};\n\ndwr.engine._ModePlainCall = \"/call/plaincall/\";\ndwr.engine._ModeHtmlCall = \"/call/htmlcall/\";\ndwr.engine._ModePlainPoll = \"/call/plainpoll/\";\ndwr.engine._ModeHtmlPoll = \"/call/htmlpoll/\";\n\n/** @private Work out what the URL should look like */\ndwr.engine._constructRequest = function(batch) {\n  // A quick string to help people that use web log analysers\n  var request = { url:batch.path + batch.mode, body:null };\n  if (batch.isPoll == true) {\n    request.url += \"ReverseAjax.dwr\";\n  }\n  else if (batch.map.callCount == 1) {\n    request.url += batch.map[\"c0-scriptName\"] + \".\" + batch.map[\"c0-methodName\"] + \".dwr\";\n  }\n  else {\n    request.url += \"Multiple.\" + batch.map.callCount + \".dwr\";\n  }\n  // Play nice with url re-writing\n  var sessionMatch = location.href.match(/jsessionid=([^?]+)/);\n  if (sessionMatch != null) {\n    request.url += \";jsessionid=\" + sessionMatch[1];\n  }\n\n  var prop;\n  if (batch.httpMethod == \"GET\") {\n    // Some browsers (Opera/Safari2) seem to fail to convert the callCount value\n    // to a string in the loop below so we do it manually here.\n    batch.map.callCount = \"\" + batch.map.callCount;\n    request.url += \"?\";\n    for (prop in batch.map) {\n      if (typeof batch.map[prop] != \"function\") {\n        request.url += encodeURIComponent(prop) + \"=\" + encodeURIComponent(batch.map[prop]) + \"&\";\n      }\n    }\n    request.url = request.url.substring(0, request.url.length - 1);\n  }\n  else {\n    // PERFORMANCE: for iframe mode this is thrown away.\n    request.body = \"\";\n    if (document.all && !window.opera) {\n      // Use array joining on IE (fastest)\n      var buf = [];\n      for (prop in batch.map) {\n        if (typeof batch.map[prop] != \"function\") {\n          buf.push(prop + \"=\" + batch.map[prop] + dwr.engine._postSeperator);\n        }\n      }\n      request.body = buf.join(\"\");\n    }\n    else {\n      // Use string concat on other browsers (fastest)\n      for (prop in batch.map) {\n        if (typeof batch.map[prop] != \"function\") {\n          request.body += prop + \"=\" + batch.map[prop] + dwr.engine._postSeperator;\n        }\n      }\n    }\n    request.body = dwr.engine._contentRewriteHandler(request.body);\n  }\n  request.url = dwr.engine._urlRewriteHandler(request.url);\n  return request;\n};\n\n/** @private Called by XMLHttpRequest to indicate that something has happened */\ndwr.engine._stateChange = function(batch) {\n  var toEval;\n\n  if (batch.completed) {\n    dwr.engine._debug(\"Error: _stateChange() with batch.completed\");\n    return;\n  }\n\n  var req = batch.req;\n  try {\n    if (req.readyState != 4) return;\n  }\n  catch (ex) {\n    dwr.engine._handleWarning(batch, ex);\n    // It's broken - clear up and forget this call\n    dwr.engine._clearUp(batch);\n    return;\n  }\n\n  if (dwr.engine._unloading) {\n    dwr.engine._debug(\"Ignoring reply from server as page is unloading.\");\n    return;\n  }\n  \n  try {\n    var reply = req.responseText;\n    reply = dwr.engine._replyRewriteHandler(reply);\n    var status = req.status; // causes Mozilla to except on page moves\n\n    if (reply == null || reply == \"\") {\n      dwr.engine._handleWarning(batch, { name:\"dwr.engine.missingData\", message:\"No data received from server\" });\n    }\n    else if (status != 200) {\n      dwr.engine._handleError(batch, { name:\"dwr.engine.http.\" + status, message:req.statusText });\n    }\n    else {\n      var contentType = req.getResponseHeader(\"Content-Type\");\n      if (!contentType.match(/^text\\/plain/) && !contentType.match(/^text\\/javascript/)) {\n        if (contentType.match(/^text\\/html/) && typeof batch.textHtmlHandler == \"function\") {\n          batch.textHtmlHandler({ status:status, responseText:reply, contentType:contentType });\n        }\n        else {\n          dwr.engine._handleWarning(batch, { name:\"dwr.engine.invalidMimeType\", message:\"Invalid content type: '\" + contentType + \"'\" });\n        }\n      }\n      else {\n        // Comet replies might have already partially executed\n        if (batch.isPoll && batch.map.partialResponse == dwr.engine._partialResponseYes) {\n          dwr.engine._processCometResponse(reply, batch);\n        }\n        else {\n          if (reply.search(\"//#DWR\") == -1) {\n            dwr.engine._handleWarning(batch, { name:\"dwr.engine.invalidReply\", message:\"Invalid reply from server\" });\n          }\n          else {\n            toEval = reply;\n          }\n        }\n      }\n    }\n  }\n  catch (ex) {\n    dwr.engine._handleWarning(batch, ex);\n  }\n\n  dwr.engine._callPostHooks(batch);\n\n  // Outside of the try/catch so errors propogate normally:\n  dwr.engine._receivedBatch = batch;\n  if (toEval != null) toEval = toEval.replace(dwr.engine._scriptTagProtection, \"\");\n  dwr.engine._eval(toEval);\n  dwr.engine._receivedBatch = null;\n  dwr.engine._validateBatch(batch);\n  if (!batch.completed) dwr.engine._clearUp(batch);\n};\n\n/**\n * @private This function is invoked when a batch reply is received.\n * It checks that there is a response for every call in the batch. Otherwise,\n * an error will be signaled (a call without a response indicates that the \n * server failed to send complete batch response). \n */\ndwr.engine._validateBatch = function(batch) {\n  // If some call left unreplied, report an error.\n  if (!batch.completed) {\n    for (var i = 0; i < batch.map.callCount; i++) {\n      if (batch.handlers[i] != null) {\n        dwr.engine._handleWarning(batch, { name:\"dwr.engine.incompleteReply\", message:\"Incomplete reply from server\" });\n        break;\n      }\n    }\n  }\n}\n\n/** @private Called from iframe onload, check batch using batch-id */\ndwr.engine._iframeLoadingComplete = function(batchId) {\n  // dwr.engine._checkCometPoll();\n  var batch = dwr.engine._batches[batchId];\n  if (batch) dwr.engine._validateBatch(batch);\n}\n\n/** @private Called by the server: Execute a callback */\ndwr.engine._remoteHandleCallback = function(batchId, callId, reply) {\n  var batch = dwr.engine._batches[batchId];\n  if (batch == null) {\n    dwr.engine._debug(\"Warning: batch == null in remoteHandleCallback for batchId=\" + batchId, true);\n    return;\n  }\n  // Error handlers inside here indicate an error that is nothing to do\n  // with DWR so we handle them differently.\n  try {\n    var handlers = batch.handlers[callId];\n    batch.handlers[callId] = null;\n    if (!handlers) {\n      dwr.engine._debug(\"Warning: Missing handlers. callId=\" + callId, true);\n    }\n    else if (typeof handlers.callback == \"function\") handlers.callback(reply);\n  }\n  catch (ex) {\n    dwr.engine._handleError(batch, ex);\n  }\n};\n\n/** @private Called by the server: Handle an exception for a call */\ndwr.engine._remoteHandleException = function(batchId, callId, ex) {\n  var batch = dwr.engine._batches[batchId];\n  if (batch == null) { dwr.engine._debug(\"Warning: null batch in remoteHandleException\", true); return; }\n  var handlers = batch.handlers[callId];\n  batch.handlers[callId] = null;\n  if (handlers == null) { dwr.engine._debug(\"Warning: null handlers in remoteHandleException\", true); return; }\n  if (ex.message == undefined) ex.message = \"\";\n  if (typeof handlers.exceptionHandler == \"function\") handlers.exceptionHandler(ex.message, ex);\n  else if (typeof batch.errorHandler == \"function\") batch.errorHandler(ex.message, ex);\n};\n\n/** @private Called by the server: The whole batch is broken */\ndwr.engine._remoteHandleBatchException = function(ex, batchId) {\n  var searchBatch = (dwr.engine._receivedBatch == null && batchId != null);\n  if (searchBatch) {\n    dwr.engine._receivedBatch = dwr.engine._batches[batchId];\n  }\n  if (ex.message == undefined) ex.message = \"\";\n  dwr.engine._handleError(dwr.engine._receivedBatch, ex);\n  if (searchBatch) {\n    dwr.engine._receivedBatch = null;\n    dwr.engine._clearUp(dwr.engine._batches[batchId]);\n  }\n};\n\n/** @private Called by the server: Reverse ajax should not be used */\ndwr.engine._remotePollCometDisabled = function(ex, batchId) {\n  dwr.engine.setActiveReverseAjax(false);\n  var searchBatch = (dwr.engine._receivedBatch == null && batchId != null);\n  if (searchBatch) {\n    dwr.engine._receivedBatch = dwr.engine._batches[batchId];\n  }\n  if (ex.message == undefined) ex.message = \"\";\n  dwr.engine._handleError(dwr.engine._receivedBatch, ex);\n  if (searchBatch) {\n    dwr.engine._receivedBatch = null;\n    dwr.engine._clearUp(dwr.engine._batches[batchId]);\n  }\n};\n\n/** @private Called by the server: An IFrame reply is about to start */\ndwr.engine._remoteBeginIFrameResponse = function(iframe, batchId) {\n  if (iframe != null) dwr.engine._receivedBatch = iframe.batch;\n  dwr.engine._callPostHooks(dwr.engine._receivedBatch);\n};\n\n/** @private Called by the server: An IFrame reply is just completing */\ndwr.engine._remoteEndIFrameResponse = function(batchId) {\n  dwr.engine._clearUp(dwr.engine._receivedBatch);\n  dwr.engine._receivedBatch = null;\n};\n\n/** @private This is a hack to make the context be this window */\ndwr.engine._eval = function(script) {\n  if (script == null) return null;\n  if (script == \"\") { dwr.engine._debug(\"Warning: blank script\", true); return null; }\n  // dwr.engine._debug(\"Exec: [\" + script + \"]\", true);\n  return eval(script);\n};\n\n/** @private Called as a result of a request timeout */\ndwr.engine._abortRequest = function(batch) {\n  if (batch && !batch.completed) {\n    dwr.engine._clearUp(batch);\n    if (batch.req) batch.req.abort();\n    dwr.engine._handleError(batch, { name:\"dwr.engine.timeout\", message:\"Timeout\" });\n  }\n};\n\n/** @private call all the post hooks for a batch */\ndwr.engine._callPostHooks = function(batch) {\n  if (batch.postHooks) {\n    for (var i = 0; i < batch.postHooks.length; i++) {\n      batch.postHooks[i]();\n    }\n    batch.postHooks = null;\n  }\n};\n\n/** @private A call has finished by whatever means and we need to shut it all down. */\ndwr.engine._clearUp = function(batch) {\n  if (!batch) { dwr.engine._debug(\"Warning: null batch in dwr.engine._clearUp()\", true); return; }\n  if (batch.completed) { dwr.engine._debug(\"Warning: Double complete\", true); return; }\n\n  // IFrame tidyup\n  if (batch.div) batch.div.parentNode.removeChild(batch.div);\n  if (batch.iframe) {\n    // If this is a poll frame then stop comet polling\n    for (var i = 0; i < dwr.engine._outstandingIFrames.length; i++) {\n      if (dwr.engine._outstandingIFrames[i] == batch.iframe) {\n        dwr.engine._outstandingIFrames.splice(i, 1);\n      }\n    }\n    batch.iframe.parentNode.removeChild(batch.iframe);\n  }\n  if (batch.form) batch.form.parentNode.removeChild(batch.form);\n\n  // XHR tidyup: avoid IE handles increase\n  if (batch.req) {\n    // If this is a poll frame then stop comet polling\n    if (batch.req == dwr.engine._pollReq) dwr.engine._pollReq = null;\n    delete batch.req;\n  }\n\n  // Timeout tidyup\n  if (batch.timeoutId) {\n    clearTimeout(batch.timeoutId);\n    delete batch.timeoutId;\n  }\n\n  if (batch.map && (batch.map.batchId || batch.map.batchId == 0)) {\n    delete dwr.engine._batches[batch.map.batchId];\n    dwr.engine._batchesLength--;\n  }\n\n  batch.completed = true;\n\n  // If there is anything on the queue waiting to go out, then send it.\n  // We don't need to check for ordered mode, here because when ordered mode\n  // gets turned off, we still process *waiting* batches in an ordered way.\n  if (dwr.engine._batchQueue.length != 0) {\n    var sendbatch = dwr.engine._batchQueue.shift();\n    dwr.engine._sendData(sendbatch);\n  }\n};\n\n/** @private Abort any XHRs in progress at page unload (solves zombie socket problems in IE). */\ndwr.engine._unloader = function() {\n  dwr.engine._unloading = true;\n\n  // Empty queue of waiting ordered requests\n  dwr.engine._batchQueue.length = 0;\n\n  // Abort any ongoing XHRs and clear their batches\n  for (var batchId in dwr.engine._batches) {\n    var batch = dwr.engine._batches[batchId];\n    // Only process objects that look like batches (avoid prototype additions!)\n    if (batch && batch.map) {\n      if (batch.req) {\n        batch.req.abort();\n      }\n      dwr.engine._clearUp(batch);\n    }\n  }\n};\n// Now register the unload handler\nif (window.addEventListener) window.addEventListener('unload', dwr.engine._unloader, false);\nelse if (window.attachEvent) window.attachEvent('onunload', dwr.engine._unloader);\n\n/** @private Generic error handling routing to save having null checks everywhere */\ndwr.engine._handleError = function(batch, ex) {\n  if (typeof ex == \"string\") ex = { name:\"unknown\", message:ex };\n  if (ex.message == null) ex.message = \"\";\n  if (ex.name == null) ex.name = \"unknown\";\n  if (batch && typeof batch.errorHandler == \"function\") batch.errorHandler(ex.message, ex);\n  else if (dwr.engine._errorHandler) dwr.engine._errorHandler(ex.message, ex);\n  if (batch) dwr.engine._clearUp(batch);\n};\n\n/** @private Generic error handling routing to save having null checks everywhere */\ndwr.engine._handleWarning = function(batch, ex) {\n  if (typeof ex == \"string\") ex = { name:\"unknown\", message:ex };\n  if (ex.message == null) ex.message = \"\";\n  if (ex.name == null) ex.name = \"unknown\";\n  if (batch && typeof batch.warningHandler == \"function\") batch.warningHandler(ex.message, ex);\n  else if (dwr.engine._warningHandler) dwr.engine._warningHandler(ex.message, ex);\n  if (batch) dwr.engine._clearUp(batch);\n};\n\n/**\n * @private Marshall a data item\n * @param batch A map of variables to how they have been marshalled\n * @param referto An array of already marshalled variables to prevent recurrsion\n * @param data The data to be marshalled\n * @param name The name of the data being marshalled\n */\ndwr.engine._serializeAll = function(batch, referto, data, name) {\n  if (data == null) {\n    batch.map[name] = \"null:null\";\n    return;\n  }\n\n  switch (typeof data) {\n  case \"boolean\":\n    batch.map[name] = \"boolean:\" + data;\n    break;\n  case \"number\":\n    batch.map[name] = \"number:\" + data;\n    break;\n  case \"string\":\n    batch.map[name] = \"string:\" + encodeURIComponent(data);\n    break;\n  case \"object\":\n    var objstr = Object.prototype.toString.call(data);\n    if (objstr == \"[object String]\") batch.map[name] = \"String:\" + encodeURIComponent(data);\n    else if (objstr == \"[object Boolean]\") batch.map[name] = \"Boolean:\" + data;\n    else if (objstr == \"[object Number]\") batch.map[name] = \"Number:\" + data;\n    else if (objstr == \"[object Date]\") batch.map[name] = \"Date:\" + data.getTime();\n    else if (objstr == \"[object Array]\") batch.map[name] = dwr.engine._serializeArray(batch, referto, data, name);\n    else batch.map[name] = dwr.engine._serializeObject(batch, referto, data, name);\n    break;\n  case \"function\":\n    // We just ignore functions.\n    break;\n  default:\n    dwr.engine._handleWarning(null, { name:\"dwr.engine.unexpectedType\", message:\"Unexpected type: \" + typeof data + \", attempting default converter.\" });\n    batch.map[name] = \"default:\" + data;\n    break;\n  }\n};\n\n/** @private Have we already converted this object? */\ndwr.engine._lookup = function(referto, data, name) {\n  var lookup;\n  // Can't use a map: getahead.org/ajax/javascript-gotchas\n  for (var i = 0; i < referto.length; i++) {\n    if (referto[i].data == data) {\n      lookup = referto[i];\n      break;\n    }\n  }\n  if (lookup) return \"reference:\" + lookup.name;\n  referto.push({ data:data, name:name });\n  return null;\n};\n\n/** @private Marshall an object */\ndwr.engine._serializeObject = function(batch, referto, data, name) {\n  var ref = dwr.engine._lookup(referto, data, name);\n  if (ref) return ref;\n\n  // This check for an HTML is not complete, but is there a better way?\n  // Maybe we should add: data.hasChildNodes typeof \"function\" == true\n  if (data.nodeName && data.nodeType) {\n    return dwr.engine._serializeXml(batch, referto, data, name);\n  }\n\n  // treat objects as an associative arrays\n  var reply = \"Object_\" + dwr.engine._getObjectClassName(data) + \":{\";\n  var element;\n  for (element in data) {\n    if (typeof data[element] != \"function\") {\n      batch.paramCount++;\n      var childName = \"c\" + dwr.engine._batch.map.callCount + \"-e\" + batch.paramCount;\n      dwr.engine._serializeAll(batch, referto, data[element], childName);\n\n      reply += encodeURIComponent(element) + \":reference:\" + childName + \", \";\n    }\n  }\n\n  if (reply.substring(reply.length - 2) == \", \") {\n    reply = reply.substring(0, reply.length - 2);\n  }\n  reply += \"}\";\n\n  return reply;\n};\n\n/** @private Returns the classname of supplied argument obj */\ndwr.engine._errorClasses = { \"Error\":Error, \"EvalError\":EvalError, \"RangeError\":RangeError, \"ReferenceError\":ReferenceError, \"SyntaxError\":SyntaxError, \"TypeError\":TypeError, \"URIError\":URIError };\ndwr.engine._getObjectClassName = function(obj) {\n  // Try to find the classname by stringifying the object's constructor\n  // and extract <class> from \"function <class>\".\n  if (obj && obj.constructor && obj.constructor.toString)\n  {\n    var str = obj.constructor.toString();\n    var regexpmatch = str.match(/function\\s+(\\w+)/);\n    if (regexpmatch && regexpmatch.length == 2) {\n      return regexpmatch[1];\n    }\n  }\n\n  // Now manually test against the core Error classes, as these in some \n  // browsers successfully match to the wrong class in the \n  // Object.toString() test we will do later\n  if (obj && obj.constructor) {\n    for (var errorname in dwr.engine._errorClasses) {\n      if (obj.constructor == dwr.engine._errorClasses[errorname]) return errorname;\n    }\n  }\n\n  // Try to find the classname by calling Object.toString() on the object\n  // and extracting <class> from \"[object <class>]\"\n  if (obj) {\n    var str = Object.prototype.toString.call(obj);\n    var regexpmatch = str.match(/\\[object\\s+(\\w+)/);\n    if (regexpmatch && regexpmatch.length==2) {\n      return regexpmatch[1];\n    }\n  }\n\n  // Supplied argument was probably not an object, but what is better?\n  return \"Object\";\n};\n\n/** @private Marshall an object */\ndwr.engine._serializeXml = function(batch, referto, data, name) {\n  var ref = dwr.engine._lookup(referto, data, name);\n  if (ref) return ref;\n\n  var output;\n  if (window.XMLSerializer) output = new XMLSerializer().serializeToString(data);\n  else if (data.toXml) output = data.toXml;\n  else output = data.innerHTML;\n\n  return \"XML:\" + encodeURIComponent(output);\n};\n\n/** @private Marshall an array */\ndwr.engine._serializeArray = function(batch, referto, data, name) {\n  var ref = dwr.engine._lookup(referto, data, name);\n  if (ref) return ref;\n\n  if (document.all && !window.opera) {\n    // Use array joining on IE (fastest)\n    var buf = [\"Array:[\"];\n    for (var i = 0; i < data.length; i++) {\n      if (i != 0) buf.push(\",\");\n      batch.paramCount++;\n      var childName = \"c\" + dwr.engine._batch.map.callCount + \"-e\" + batch.paramCount;\n      dwr.engine._serializeAll(batch, referto, data[i], childName);\n      buf.push(\"reference:\");\n      buf.push(childName);\n    }\n    buf.push(\"]\");\n    reply = buf.join(\"\");\n  }\n  else {\n    // Use string concat on other browsers (fastest)\n    var reply = \"Array:[\";\n    for (var i = 0; i < data.length; i++) {\n      if (i != 0) reply += \",\";\n      batch.paramCount++;\n      var childName = \"c\" + dwr.engine._batch.map.callCount + \"-e\" + batch.paramCount;\n      dwr.engine._serializeAll(batch, referto, data[i], childName);\n      reply += \"reference:\";\n      reply += childName;\n    }\n    reply += \"]\";\n  }\n\n  return reply;\n};\n\n/** @private Convert an XML string into a DOM object. */\ndwr.engine._unserializeDocument = function(xml) {\n  var dom;\n  if (window.DOMParser) {\n    var parser = new DOMParser();\n    dom = parser.parseFromString(xml, \"text/xml\");\n    if (!dom.documentElement || dom.documentElement.tagName == \"parsererror\") {\n      var message = dom.documentElement.firstChild.data;\n      message += \"\\n\" + dom.documentElement.firstChild.nextSibling.firstChild.data;\n      throw message;\n    }\n    return dom;\n  }\n  else if (window.ActiveXObject) {\n    dom = dwr.engine._newActiveXObject(dwr.engine._DOMDocument);\n    dom.loadXML(xml); // What happens on parse fail with IE?\n    return dom;\n  }\n  else {\n    var div = document.createElement(\"div\");\n    div.innerHTML = xml;\n    return div;\n  }\n};\n\n/** @param axarray An array of strings to attempt to create ActiveX objects from */\ndwr.engine._newActiveXObject = function(axarray) {\n  var returnValue;  \n  for (var i = 0; i < axarray.length; i++) {\n    try {\n      returnValue = new ActiveXObject(axarray[i]);\n      break;\n    }\n    catch (ex) { /* ignore */ }\n  }\n  return returnValue;\n};\n\n/** @private Used internally when some message needs to get to the programmer */\ndwr.engine._debug = function(message, stacktrace) {\n  var written = false;\n  try {\n    if (window.console) {\n      if (stacktrace && window.console.trace) window.console.trace();\n      window.console.log(message);\n      written = true;\n    }\n    else if (window.opera && window.opera.postError) {\n      window.opera.postError(message);\n      written = true;\n    }\n  }\n  catch (ex) { /* ignore */ }\n\n  if (!written) {\n    var debug = document.getElementById(\"dwr-debug\");\n    if (debug) {\n      var contents = message + \"<br/>\" + debug.innerHTML;\n      if (contents.length > 2048) contents = contents.substring(0, 2048);\n      debug.innerHTML = contents;\n    }\n  }\n};\n\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 464,
          "bodySize": 47356
        },
        "cache": {},
        "timings": {
          "send": 25,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8632"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 57,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/calendar/calendar.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 365,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1835"
            }
          ],
          "content": {
            "size": 5727,
            "compression": 0,
            "mimeType": "text/css",
            "text": "/* The main calendar widget.\tDIV containing a table. */\n\n.calendar {\n\tposition:relative;\n\tdisplay:none;\n\tborder-top:2px solid #fff;\n\tborder-right:2px solid #000;\n\tborder-bottom:2px solid #000;\n\tborder-left:2px solid #fff;\n\tfont-size:11px;\n\tcolor:#000;\n\tcursor:default;\n\tbackground:#d4c8d0;\n\tfont-family:tahoma,verdana,sans-serif;\n\tz-index:200;\n}\n\n.calendar table {\n\tborder-top:1px solid #000;\n\tborder-right:1px solid #fff;\n\tborder-bottom:1px solid #fff;\n\tborder-left:1px solid #000;\n\tfont-size:11px;\n\tcolor:#000;\n\tcursor:default;\n\tbackground:#d4c8d0;\n\tfont-family:tahoma,verdana,sans-serif;\n}\n\n/* Header part -- contains navigation buttons and day names. */\n\n.calendar .button { /* \"<<\", \"<\", \">\", \">>\" buttons have this class */\n\ttext-align:center;\n\tpadding:1px;\n\tborder-top:1px solid #fff;\n\tborder-right:1px solid #000;\n\tborder-bottom:1px solid #000;\n\tborder-left:1px solid #fff;\n}\n\n.calendar .nav {\n\tbackground:transparent url(../../images/icons/calendar-menuarrow.gif) no-repeat 100% 100%;\n}\n\n.calendar thead .title { /* This holds the current \"month, year\" */\n\tfont-weight:bold;\n\tpadding:1px;\n\tborder:1px solid #000;\n\tbackground:#847880;\n\tcolor:#fff;\n\ttext-align:center;\n}\n\n.calendar thead .headrow { /* Row <TR> containing navigation buttons */\n}\n\n.calendar thead .daynames { /* Row <TR> containing the day names */\n}\n\n.calendar thead .name { /* Cells <TD> containing the day names */\n\tborder-bottom:1px solid #000;\n\tpadding:2px;\n\ttext-align:center;\n\tbackground:#f4e8f0;\n}\n\n.calendar thead .weekend { /* How a weekend day name shows in header */\n\tcolor:#f00;\n}\n\n.calendar thead .hilite { /* How do the buttons in header appear when hover */\n\tborder-top:2px solid #fff;\n\tborder-right:2px solid #000;\n\tborder-bottom:2px solid #000;\n\tborder-left:2px solid #fff;\n\tpadding:0px;\n\tbackground-color:#e4d8e0;\n}\n\n.calendar thead .active { /* Active (pressed) buttons in header */\n\tpadding:2px 0px 0px 2px;\n\tborder-top:1px solid #000;\n\tborder-right:1px solid #fff;\n\tborder-bottom:1px solid #fff;\n\tborder-left:1px solid #000;\n\tbackground-color:#c4b8c0;\n}\n\n/* The body part -- contains all the days in month. */\n\n.calendar tbody .day { /* Cells <TD> containing month days dates */\n\twidth:2em;\n\ttext-align:right;\n\tpadding:2px 4px 2px 2px;\n}\n.calendar tbody .day.othermonth {\n\tfont-size:80%;\n\tcolor:#aaa;\n}\n.calendar tbody .day.othermonth.oweekend {\n\tcolor:#faa;\n}\n\n.calendar table .wn {\n\tpadding:2px 3px 2px 2px;\n\tborder-right:1px solid #000;\n\tbackground:#f4e8f0;\n}\n\n.calendar tbody .rowhilite td {\n\tbackground:#e4d8e0;\n}\n\n.calendar tbody .rowhilite td.wn {\n\tbackground:#d4c8d0;\n}\n\n.calendar tbody td.hilite { /* Hovered cells <TD> */\n\tpadding:1px 3px 1px 1px;\n\tborder-top:1px solid #fff;\n\tborder-right:1px solid #000;\n\tborder-bottom:1px solid #000;\n\tborder-left:1px solid #fff;\n}\n\n.calendar tbody td.active { /* Active (pressed) cells <TD> */\n\tpadding:2px 2px 0px 2px;\n\tborder-top:1px solid #000;\n\tborder-right:1px solid #fff;\n\tborder-bottom:1px solid #fff;\n\tborder-left:1px solid #000;\n}\n\n.calendar tbody td.selected { /* Cell showing selected date */\n\tfont-weight:bold;\n\tborder-top:1px solid #000;\n\tborder-right:1px solid #fff;\n\tborder-bottom:1px solid #fff;\n\tborder-left:1px solid #000;\n\tpadding:2px 2px 0px 2px;\n\tbackground:#e4d8e0;\n}\n\n.calendar tbody td.weekend { /* Cells showing weekend days */\n\tcolor:#f00;\n}\n\n.calendar tbody td.today { /* Cell showing today date */\n\tfont-weight:bold;\n\tcolor:#00f;\n}\n\n.calendar tbody .disabled { color:#999; }\n\n.calendar tbody .emptycell { /* Empty cells (the best is to hide them) */\n\tvisibility:hidden;\n}\n\n.calendar tbody .emptyrow { /* Empty row (some months need less than 6 rows) */\n\tdisplay:none;\n}\n\n/* The footer part -- status bar and \"Close\" button */\n\n.calendar tfoot .footrow { /* The <TR> in footer (only one right now) */\n}\n\n.calendar tfoot .ttip { /* Tooltip (status bar) cell <TD> */\n\tbackground:#f4e8f0;\n\tpadding:1px;\n\tborder:1px solid #000;\n\tbackground:#847880;\n\tcolor:#fff;\n\ttext-align:center;\n}\n\n.calendar tfoot .hilite { /* Hover style for buttons in footer */\n\tborder-top:1px solid #fff;\n\tborder-right:1px solid #000;\n\tborder-bottom:1px solid #000;\n\tborder-left:1px solid #fff;\n\tpadding:1px;\n\tbackground:#e4d8e0;\n}\n\n.calendar tfoot .active { /* Active (pressed) style for buttons in footer */\n\tpadding:2px 0px 0px 2px;\n\tborder-top:1px solid #000;\n\tborder-right:1px solid #fff;\n\tborder-bottom:1px solid #fff;\n\tborder-left:1px solid #000;\n}\n\n/* Combo boxes (menus that display months/years for direct selection) */\n\n.calendar .combo {\n\tposition:absolute;\n\tdisplay:none;\n\twidth:4em;\n\ttop:0px;\n\tleft:0px;\n\tcursor:default;\n\tborder-top:1px solid #fff;\n\tborder-right:1px solid #000;\n\tborder-bottom:1px solid #000;\n\tborder-left:1px solid #fff;\n\tbackground:#e4d8e0;\n\tfont-size:90%;\n\tpadding:1px;\n}\n\n.calendar .combo .label, .calendar .combo .label-IEfix {\n\ttext-align:center;\n\tpadding:1px;\n}\n\n.calendar .combo .label-IEfix {\n\twidth:4em;\n}\n\n.calendar .combo .active {\n\tbackground:#d4c8d0;\n\tpadding:0px;\n\tborder-top:1px solid #000;\n\tborder-right:1px solid #fff;\n\tborder-bottom:1px solid #fff;\n\tborder-left:1px solid #000;\n}\n\n.calendar .combo .hilite {\n\tbackground:#408;\n\tcolor:#fea;\n}\n\n.calendar td.time {\n\tborder-top:1px solid #000;\n\tpadding:1px 0px;\n\ttext-align:center;\n\tbackground-color:#f4f0e8;\n}\n\n.calendar td.time .hour, .calendar td.time .minute, .calendar td.time .ampm {\n\tpadding:0px 3px 0px 4px;\n\tborder:1px solid #889;\n\tfont-weight:bold;\n\tbackground-color:#fff;\n}\n\n.calendar td.time .ampm {\n\ttext-align:center;\n}\n\n.calendar td.time .colon {\n\tpadding:0px 2px 0px 3px;\n\tfont-weight:bold;\n}\n\n.calendar td.time span.hilite {\n\tborder-color:#000;\n\tbackground-color:#766;\n\tcolor:#fff;\n}\n\n.calendar td.time span.active {\n\tborder-color:#f00;\n\tbackground-color:#000;\n\tcolor:#0f0;\n}",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 293,
          "bodySize": 5727
        },
        "cache": {},
        "timings": {
          "send": 4,
          "wait": 0,
          "receive": 1
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8635"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 134,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/calendar.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 356,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "21932"
            }
          ],
          "content": {
            "size": 85388,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "Ly8gTm90ZTogMTkwcHggaXMgdGhlIHdpZHRoIG9mIHRoZSBPTU5JIGxlZnQgc2lkZSBtZW51IGFuZCBUaGlzIGlzIHJlcXVpcmVkIGZvciBJRSBkaXNwbGF5IGJ1Zy4NCnZhciBfT01OSU1lbnVXaWR0aCA9IDE5MDsNCg0KLyogIENvcHlyaWdodCBNaWhhaSBCYXpvbiwgMjAwMi0yMDA1ICB8ICB3d3cuYmF6b24ubmV0L21pc2hvbw0KKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KKg0KKiBUaGUgREhUTUwgQ2FsZW5kYXIsIHZlcnNpb24gMS4wICJJdCBpcyBoYXBwZW5pbmcgYWdhaW4iDQoqDQoqIERldGFpbHMgYW5kIGxhdGVzdCB2ZXJzaW9uIGF0Og0KKiB3d3cuZHluYXJjaC5jb20vcHJvamVjdHMvY2FsZW5kYXINCioNCiogVGhpcyBzY3JpcHQgaXMgZGV2ZWxvcGVkIGJ5IER5bmFyY2guY29tLiAgVmlzaXQgdXMgYXQgd3d3LmR5bmFyY2guY29tLg0KKg0KKiBUaGlzIHNjcmlwdCBpcyBkaXN0cmlidXRlZCB1bmRlciB0aGUgR05VIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlLg0KKiBSZWFkIHRoZSBlbnRpcmUgbGljZW5zZSB0ZXh0IGhlcmU6IGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9sZ3BsLmh0bWwNCiovDQoNCi8vICRJZDogY2FsZW5kYXIuanMgMTk0MzcgMjAwNy0xMS0xNiAxODo1MDowOVogU0lFUlJBREVWXFdXaW5kZWxzICQNCg0KLyoqIFRoZSBDYWxlbmRhciBvYmplY3QgY29uc3RydWN0b3IuICovDQp2YXIgQ2FsZW5kYXIgPSBmdW5jdGlvbiAoZmlyc3REYXlPZldlZWssIGRhdGVTdHIsIG9uU2VsZWN0ZWQsIG9uQ2xvc2UpIHsNCgkvLyBtZW1iZXIgdmFyaWFibGVzDQoJdGhpcy5hY3RpdmVEaXYgPSBudWxsOw0KCXRoaXMuY3VycmVudERhdGVFbCA9IG51bGw7DQoJdGhpcy5nZXREYXRlU3RhdHVzID0gbnVsbDsNCgl0aGlzLmdldERhdGVUb29sVGlwID0gbnVsbDsNCgl0aGlzLmdldERhdGVUZXh0ID0gbnVsbDsNCgl0aGlzLnRpbWVvdXQgPSBudWxsOw0KCXRoaXMub25TZWxlY3RlZCA9IG9uU2VsZWN0ZWQgfHwgbnVsbDsNCgl0aGlzLm9uQ2xvc2UgPSBvbkNsb3NlIHx8IG51bGw7DQoJdGhpcy5kcmFnZ2luZyA9IGZhbHNlOw0KCXRoaXMuaGlkZGVuID0gZmFsc2U7DQoJdGhpcy5taW5ZZWFyID0gMTk3MDsNCgl0aGlzLm1heFllYXIgPSAyMDUwOw0KCXRoaXMuZGF0ZUZvcm1hdCA9IENhbGVuZGFyLl9UVFsiREVGX0RBVEVfRk9STUFUIl07DQoJdGhpcy50dERhdGVGb3JtYXQgPSBDYWxlbmRhci5fVFRbIlRUX0RBVEVfRk9STUFUIl07DQoJdGhpcy5pc1BvcHVwID0gdHJ1ZTsNCgl0aGlzLndlZWtOdW1iZXJzID0gdHJ1ZTsNCgl0aGlzLmZpcnN0RGF5T2ZXZWVrID0gdHlwZW9mIGZpcnN0RGF5T2ZXZWVrID09ICJudW1iZXIiID8gZmlyc3REYXlPZldlZWsgOiBDYWxlbmRhci5fRkQ7IC8vIDAgZm9yIFN1bmRheSwgMSBmb3IgTW9uZGF5LCBldGMuDQoJdGhpcy5zaG93c090aGVyTW9udGhzID0gZmFsc2U7DQoJdGhpcy5kYXRlU3RyID0gZGF0ZVN0cjsNCgl0aGlzLmFyX2RheXMgPSBudWxsOw0KCXRoaXMuc2hvd3NUaW1lID0gZmFsc2U7DQoJdGhpcy50aW1lMjQgPSB0cnVlOw0KCXRoaXMueWVhclN0ZXAgPSAyOw0KCXRoaXMuaGlsaXRlVG9kYXkgPSB0cnVlOw0KCXRoaXMubXVsdGlwbGUgPSBudWxsOw0KCS8vIEhUTUwgZWxlbWVudHMNCgl0aGlzLnRhYmxlID0gbnVsbDsNCgl0aGlzLmVsZW1lbnQgPSBudWxsOw0KCXRoaXMudGJvZHkgPSBudWxsOw0KCXRoaXMuZmlyc3RkYXluYW1lID0gbnVsbDsNCgkvLyBDb21ibyBib3hlcw0KCXRoaXMubW9udGhzQ29tYm8gPSBudWxsOw0KCXRoaXMueWVhcnNDb21ibyA9IG51bGw7DQoJdGhpcy5oaWxpdGVkTW9udGggPSBudWxsOw0KCXRoaXMuYWN0aXZlTW9udGggPSBudWxsOw0KCXRoaXMuaGlsaXRlZFllYXIgPSBudWxsOw0KCXRoaXMuYWN0aXZlWWVhciA9IG51bGw7DQoJLy8gSW5mb3JtYXRpb24NCgl0aGlzLmRhdGVDbGlja2VkID0gZmFsc2U7DQoJdGhpcy50b2RheUNsaWNrZWQgPSBmYWxzZTsNCgl0aGlzLmFkanVzdFggPSAwOw0KCXRoaXMuYWRqdXN0WSA9IDA7DQoJdGhpcy5wYXJlbnREb2N1bWVudFdpZHRoID0gMDsNCgl0aGlzLnBhcmVudERvY3VtZW50SGVpZ2h0ID0gMDsNCgl0aGlzLnZpZXdwb3J0TGVmdCA9IDA7DQoJdGhpcy52aWV3cG9ydFRvcCA9IDA7DQoJdGhpcy52aWV3cG9ydFdpZHRoID0gMDsNCgl0aGlzLnZpZXdwb3J0SGVpZ2h0ID0gMDsNCgl0aGlzLmZpcmVPbkNoYW5nZUV2ZW50ID0gZmFsc2U7DQoJdGhpcy5maXJlT25CbHVyRXZlbnQgPSBmYWxzZTsNCgl0aGlzLmZpcmVPbkZvY3VzRXZlbnQgPSBmYWxzZTsNCg0KCS8vIG9uZS10aW1lIGluaXRpYWxpemF0aW9ucw0KCWlmICh0eXBlb2YgQ2FsZW5kYXIuX1NETiA9PSAidW5kZWZpbmVkIikgew0KCQkvLyB0YWJsZSBvZiBzaG9ydCBkYXkgbmFtZXMNCgkJaWYgKHR5cGVvZiBDYWxlbmRhci5fU0ROX2xlbiA9PSAidW5kZWZpbmVkIikNCgkJCUNhbGVuZGFyLl9TRE5fbGVuID0gMzsNCgkJdmFyIGFyID0gbmV3IEFycmF5KCk7DQoJCWZvciAodmFyIGkgPSA4OyBpID4gMDspIHsNCgkJCWFyWy0taV0gPSBDYWxlbmRhci5fRE5baV0uc3Vic3RyKDAsIENhbGVuZGFyLl9TRE5fbGVuKTsNCgkJfQ0KCQlDYWxlbmRhci5fU0ROID0gYXI7DQoJCS8vIHRhYmxlIG9mIHNob3J0IG1vbnRoIG5hbWVzDQoJCWlmICh0eXBlb2YgQ2FsZW5kYXIuX1NNTl9sZW4gPT0gInVuZGVmaW5lZCIpDQoJCQlDYWxlbmRhci5fU01OX2xlbiA9IDM7DQoJCWFyID0gbmV3IEFycmF5KCk7DQoJCWZvciAodmFyIGkgPSAxMjsgaSA+IDA7KSB7DQoJCQlhclstLWldID0gQ2FsZW5kYXIuX01OW2ldLnN1YnN0cigwLCBDYWxlbmRhci5fU01OX2xlbik7DQoJCX0NCgkJQ2FsZW5kYXIuX1NNTiA9IGFyOw0KCX0NCn07DQoNCi8vICoqIGNvbnN0YW50cw0KDQovLy8gInN0YXRpYyIsIG5lZWRlZCBmb3IgZXZlbnQgaGFuZGxlcnMuDQpDYWxlbmRhci5fQyA9IG51bGw7DQoNCi8vLyBkZXRlY3QgYSBzcGVjaWFsIGNhc2Ugb2YgIndlYiBicm93c2VyIg0KQ2FsZW5kYXIuaXNfaWUgPSAoIC9tc2llL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSAmJiAhL29wZXJhL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSApOw0KDQpDYWxlbmRhci5pc19pZTUgPSAoIENhbGVuZGFyLmlzX2llICYmIC9tc2llIDVcLjAvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpICk7DQoNCi8vLyBkZXRlY3QgT3BlcmEgYnJvd3Nlcg0KQ2FsZW5kYXIuaXNfb3BlcmEgPSAvb3BlcmEvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOw0KDQovLy8gZGV0ZWN0IEtIVE1MLWJhc2VkIGJyb3dzZXJzDQpDYWxlbmRhci5pc19raHRtbCA9IC9Lb25xdWVyb3J8U2FmYXJpfEtIVE1ML2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsNCg0KLy8gQkVHSU46IFVUSUxJVFkgRlVOQ1RJT05TOyBiZXdhcmUgdGhhdCB0aGVzZSBtaWdodCBiZSBtb3ZlZCBpbnRvIGEgc2VwYXJhdGUNCi8vICAgICAgICBsaWJyYXJ5LCBhdCBzb21lIHBvaW50Lg0KDQpDYWxlbmRhci5nZXRBYnNvbHV0ZVBvcyA9IGZ1bmN0aW9uKGVsKSB7DQoJdmFyIFNMID0gMCwgU1QgPSAwOw0KCXZhciBpc19kaXYgPSAvXmRpdiQvaS50ZXN0KGVsLnRhZ05hbWUpOw0KCWlmIChpc19kaXYgJiYgZWwuc2Nyb2xsTGVmdCkNCgkJU0wgPSBlbC5zY3JvbGxMZWZ0Ow0KCWlmIChpc19kaXYgJiYgZWwuc2Nyb2xsVG9wKQ0KCQlTVCA9IGVsLnNjcm9sbFRvcDsNCgl2YXIgciA9IHsgeDogZWwub2Zmc2V0TGVmdCAtIFNMLCB5OiBlbC5vZmZzZXRUb3AgLSBTVCB9Ow0KCWlmIChlbC5vZmZzZXRQYXJlbnQpIHsNCgkJdmFyIHRtcCA9IHRoaXMuZ2V0QWJzb2x1dGVQb3MoZWwub2Zmc2V0UGFyZW50KTsNCgkJci54ICs9IHRtcC54Ow0KCQlyLnkgKz0gdG1wLnk7DQoJfQ0KCXJldHVybiByOw0KfTsNCg0KQ2FsZW5kYXIuaXNSZWxhdGVkID0gZnVuY3Rpb24gKGVsLCBldnQpIHsNCgl2YXIgcmVsYXRlZCA9IGV2dC5yZWxhdGVkVGFyZ2V0Ow0KCWlmICghcmVsYXRlZCkgew0KCQl2YXIgdHlwZSA9IGV2dC50eXBlOw0KCQlpZiAodHlwZSA9PSAibW91c2VvdmVyIikgew0KCQkJcmVsYXRlZCA9IGV2dC5mcm9tRWxlbWVudDsNCgkJfSBlbHNlIGlmICh0eXBlID09ICJtb3VzZW91dCIpIHsNCgkJCXJlbGF0ZWQgPSBldnQudG9FbGVtZW50Ow0KCQl9DQoJfQ0KCXdoaWxlIChyZWxhdGVkKSB7DQoJCWlmIChyZWxhdGVkID09IGVsKSB7DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KCQlyZWxhdGVkID0gcmVsYXRlZC5wYXJlbnROb2RlOw0KCX0NCglyZXR1cm4gZmFsc2U7DQp9Ow0KDQpDYWxlbmRhci5yZW1vdmVDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjbGFzc05hbWUpIHsNCglpZiAoIShlbCAmJiBlbC5jbGFzc05hbWUpKSB7DQoJCXJldHVybjsNCgl9DQoJdmFyIGNscyA9IGVsLmNsYXNzTmFtZS5zcGxpdCgiICIpOw0KCXZhciBhciA9IG5ldyBBcnJheSgpOw0KCWZvciAodmFyIGkgPSBjbHMubGVuZ3RoOyBpID4gMDspIHsNCgkJaWYgKGNsc1stLWldICE9IGNsYXNzTmFtZSkgew0KCQkJYXJbYXIubGVuZ3RoXSA9IGNsc1tpXTsNCgkJfQ0KCX0NCgllbC5jbGFzc05hbWUgPSBhci5qb2luKCIgIik7DQp9Ow0KDQpDYWxlbmRhci5hZGRDbGFzcyA9IGZ1bmN0aW9uKGVsLCBjbGFzc05hbWUpIHsNCglDYWxlbmRhci5yZW1vdmVDbGFzcyhlbCwgY2xhc3NOYW1lKTsNCgllbC5jbGFzc05hbWUgKz0gIiAiICsgY2xhc3NOYW1lOw0KfTsNCg0KLy8gRklYTUU6IHRoZSBmb2xsb3dpbmcgMiBmdW5jdGlvbnMgdG90YWxseSBzdWNrLCBhcmUgdXNlbGVzcyBhbmQgc2hvdWxkIGJlIHJlcGxhY2VkIGltbWVkaWF0ZWx5Lg0KQ2FsZW5kYXIuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uKGV2KSB7DQoJdmFyIGYgPSBDYWxlbmRhci5pc19pZSA/IHdpbmRvdy5ldmVudC5zcmNFbGVtZW50IDogZXYuY3VycmVudFRhcmdldDsNCgl3aGlsZSAoZi5ub2RlVHlwZSAhPSAxIHx8IC9eZGl2JC9pLnRlc3QoZi50YWdOYW1lKSkNCgkJZiA9IGYucGFyZW50Tm9kZTsNCglyZXR1cm4gZjsNCn07DQoNCkNhbGVuZGFyLmdldFRhcmdldEVsZW1lbnQgPSBmdW5jdGlvbihldikgew0KCXZhciBmID0gQ2FsZW5kYXIuaXNfaWUgPyB3aW5kb3cuZXZlbnQuc3JjRWxlbWVudCA6IGV2LnRhcmdldDsNCgl3aGlsZSAoZi5ub2RlVHlwZSAhPSAxKQ0KCQlmID0gZi5wYXJlbnROb2RlOw0KCXJldHVybiBmOw0KfTsNCg0KQ2FsZW5kYXIuc3RvcEV2ZW50ID0gZnVuY3Rpb24oZXYpIHsNCglldiB8fCAoZXYgPSB3aW5kb3cuZXZlbnQpOw0KCWlmIChDYWxlbmRhci5pc19pZSkgew0KCQlldi5jYW5jZWxCdWJibGUgPSB0cnVlOw0KCQlldi5yZXR1cm5WYWx1ZSA9IGZhbHNlOw0KCX0gZWxzZSB7DQoJCWV2LnByZXZlbnREZWZhdWx0KCk7DQoJCWV2LnN0b3BQcm9wYWdhdGlvbigpOw0KCX0NCglyZXR1cm4gZmFsc2U7DQp9Ow0KDQpDYWxlbmRhci5hZGRFdmVudCA9IGZ1bmN0aW9uKGVsLCBldm5hbWUsIGZ1bmMpIHsNCglpZiAoZWwuYXR0YWNoRXZlbnQpIHsgLy8gSUUNCgkJZWwuYXR0YWNoRXZlbnQoIm9uIiArIGV2bmFtZSwgZnVuYyk7DQoJfSBlbHNlIGlmIChlbC5hZGRFdmVudExpc3RlbmVyKSB7IC8vIEdlY2tvIC8gVzNDDQoJCWVsLmFkZEV2ZW50TGlzdGVuZXIoZXZuYW1lLCBmdW5jLCB0cnVlKTsNCgl9IGVsc2Ugew0KCQllbFsib24iICsgZXZuYW1lXSA9IGZ1bmM7DQoJfQ0KfTsNCg0KQ2FsZW5kYXIucmVtb3ZlRXZlbnQgPSBmdW5jdGlvbihlbCwgZXZuYW1lLCBmdW5jKSB7DQoJaWYgKGVsLmRldGFjaEV2ZW50KSB7IC8vIElFDQoJCWVsLmRldGFjaEV2ZW50KCJvbiIgKyBldm5hbWUsIGZ1bmMpOw0KCX0gZWxzZSBpZiAoZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcikgeyAvLyBHZWNrbyAvIFczQw0KCQllbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2bmFtZSwgZnVuYywgdHJ1ZSk7DQoJfSBlbHNlIHsNCgkJZWxbIm9uIiArIGV2bmFtZV0gPSBudWxsOw0KCX0NCn07DQoNCkNhbGVuZGFyLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbih0eXBlLCBwYXJlbnQpIHsNCgl2YXIgZWwgPSBudWxsOw0KCWlmIChkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMpIHsNCgkJLy8gdXNlIHRoZSBYSFRNTCBuYW1lc3BhY2U7IElFIHdvbid0IG5vcm1hbGx5IGdldCBoZXJlIHVubGVzcw0KCQkvLyBfdGhleV8gImZpeCIgdGhlIERPTTIgaW1wbGVtZW50YXRpb24uDQoJCWVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiwgdHlwZSk7DQoJfSBlbHNlIHsNCgkJZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHR5cGUpOw0KCX0NCglpZiAodHlwZW9mIHBhcmVudCAhPSAidW5kZWZpbmVkIikgew0KCQlwYXJlbnQuYXBwZW5kQ2hpbGQoZWwpOw0KCX0NCglyZXR1cm4gZWw7DQp9Ow0KDQovLyBFTkQ6IFVUSUxJVFkgRlVOQ1RJT05TDQoNCi8vIEJFR0lOOiBDQUxFTkRBUiBTVEFUSUMgRlVOQ1RJT05TDQoNCi8qKiBJbnRlcm5hbCAtLSBhZGRzIGEgc2V0IG9mIGV2ZW50cyB0byBtYWtlIHNvbWUgZWxlbWVudCBiZWhhdmUgbGlrZSBhIGJ1dHRvbi4gKi8NCkNhbGVuZGFyLl9hZGRfZXZzID0gZnVuY3Rpb24oZWwpIHsNCgl3aXRoIChDYWxlbmRhcikgew0KCQlhZGRFdmVudChlbCwgIm1vdXNlb3ZlciIsIGRheU1vdXNlT3Zlcik7DQoJCWFkZEV2ZW50KGVsLCAibW91c2Vkb3duIiwgZGF5TW91c2VEb3duKTsNCgkJYWRkRXZlbnQoZWwsICJtb3VzZW91dCIsIGRheU1vdXNlT3V0KTsNCgkJaWYgKGlzX2llKSB7DQoJCQlhZGRFdmVudChlbCwgImRibGNsaWNrIiwgZGF5TW91c2VEYmxDbGljayk7DQoJCQllbC5zZXRBdHRyaWJ1dGUoInVuc2VsZWN0YWJsZSIsIHRydWUpOw0KCQl9DQoJfQ0KfTsNCg0KQ2FsZW5kYXIuZmluZE1vbnRoID0gZnVuY3Rpb24oZWwpIHsNCglpZiAodHlwZW9mIGVsLm1vbnRoICE9ICJ1bmRlZmluZWQiKSB7DQoJCXJldHVybiBlbDsNCgl9IGVsc2UgaWYgKHR5cGVvZiBlbC5wYXJlbnROb2RlLm1vbnRoICE9ICJ1bmRlZmluZWQiKSB7DQoJCXJldHVybiBlbC5wYXJlbnROb2RlOw0KCX0NCglyZXR1cm4gbnVsbDsNCn07DQoNCkNhbGVuZGFyLmZpbmRZZWFyID0gZnVuY3Rpb24oZWwpIHsNCglpZiAodHlwZW9mIGVsLnllYXIgIT0gInVuZGVmaW5lZCIpIHsNCgkJcmV0dXJuIGVsOw0KCX0gZWxzZSBpZiAodHlwZW9mIGVsLnBhcmVudE5vZGUueWVhciAhPSAidW5kZWZpbmVkIikgew0KCQlyZXR1cm4gZWwucGFyZW50Tm9kZTsNCgl9DQoJcmV0dXJuIG51bGw7DQp9Ow0KDQpDYWxlbmRhci5zaG93TW9udGhzQ29tYm8gPSBmdW5jdGlvbiAoKSB7DQoJdmFyIGNhbCA9IENhbGVuZGFyLl9DOw0KCWlmICghY2FsKSB7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoJdmFyIGNhbCA9IGNhbDsNCgl2YXIgY2QgPSBjYWwuYWN0aXZlRGl2Ow0KCXZhciBtYyA9IGNhbC5tb250aHNDb21ibzsNCglpZiAoY2FsLmhpbGl0ZWRNb250aCkgew0KCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuaGlsaXRlZE1vbnRoLCAiaGlsaXRlIik7DQoJfQ0KCWlmIChjYWwuYWN0aXZlTW9udGgpIHsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2FsLmFjdGl2ZU1vbnRoLCAiYWN0aXZlIik7DQoJfQ0KCXZhciBtb24gPSBjYWwubW9udGhzQ29tYm8uZ2V0RWxlbWVudHNCeVRhZ05hbWUoImRpdiIpW2NhbC5kYXRlLmdldE1vbnRoKCldOw0KCUNhbGVuZGFyLmFkZENsYXNzKG1vbiwgImFjdGl2ZSIpOw0KCWNhbC5hY3RpdmVNb250aCA9IG1vbjsNCgl2YXIgcyA9IG1jLnN0eWxlOw0KCXMuZGlzcGxheSA9ICJibG9jayI7DQoJaWYgKGNkLm5hdnR5cGUgPCAwKQ0KCQlzLmxlZnQgPSBjZC5vZmZzZXRMZWZ0ICsgInB4IjsNCgllbHNlIHsNCgkJdmFyIG1jdyA9IG1jLm9mZnNldFdpZHRoOw0KCQlpZiAodHlwZW9mIG1jdyA9PSAidW5kZWZpbmVkIikNCgkJCS8vIEtvbnF1ZXJvciBicmFpbi1kZWFkIHRlY2huaXF1ZXMNCgkJCW1jdyA9IDUwOw0KCQlzLmxlZnQgPSAoY2Qub2Zmc2V0TGVmdCArIGNkLm9mZnNldFdpZHRoIC0gbWN3KSArICJweCI7DQoJfQ0KCXMudG9wID0gKGNkLm9mZnNldFRvcCArIGNkLm9mZnNldEhlaWdodCkgKyAicHgiOw0KfTsNCg0KQ2FsZW5kYXIuc2hvd1llYXJzQ29tYm8gPSBmdW5jdGlvbiAoZndkKSB7DQoJdmFyIGNhbCA9IENhbGVuZGFyLl9DOw0KCWlmICghY2FsKSB7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoJdmFyIGNhbCA9IGNhbDsNCgl2YXIgY2QgPSBjYWwuYWN0aXZlRGl2Ow0KCXZhciB5YyA9IGNhbC55ZWFyc0NvbWJvOw0KCWlmIChjYWwuaGlsaXRlZFllYXIpIHsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2FsLmhpbGl0ZWRZZWFyLCAiaGlsaXRlIik7DQoJfQ0KCWlmIChjYWwuYWN0aXZlWWVhcikgew0KCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuYWN0aXZlWWVhciwgImFjdGl2ZSIpOw0KCX0NCgljYWwuYWN0aXZlWWVhciA9IG51bGw7DQoJdmFyIFkgPSBjYWwuZGF0ZS5nZXRGdWxsWWVhcigpICsgKGZ3ZCA/IDEgOiAtMSk7DQoJdmFyIHlyID0geWMuZmlyc3RDaGlsZDsNCgl2YXIgc2hvdyA9IGZhbHNlOw0KCWZvciAodmFyIGkgPSAxMjsgaSA+IDA7IC0taSkgew0KCQlpZiAoWSA+PSBjYWwubWluWWVhciAmJiBZIDw9IGNhbC5tYXhZZWFyKSB7DQoJCQl5ci5pbm5lckhUTUwgPSBZOw0KCQkJeXIueWVhciA9IFk7DQoJCQl5ci5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCgkJCXNob3cgPSB0cnVlOw0KCQl9IGVsc2Ugew0KCQkJeXIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJfQ0KCQl5ciA9IHlyLm5leHRTaWJsaW5nOw0KCQlZICs9IGZ3ZCA/IGNhbC55ZWFyU3RlcCA6IC1jYWwueWVhclN0ZXA7DQoJfQ0KCWlmIChzaG93KSB7DQoJCXZhciBzID0geWMuc3R5bGU7DQoJCXMuZGlzcGxheSA9ICJibG9jayI7DQoJCWlmIChjZC5uYXZ0eXBlIDwgMCkNCgkJCXMubGVmdCA9IGNkLm9mZnNldExlZnQgKyAicHgiOw0KCQllbHNlIHsNCgkJCXZhciB5Y3cgPSB5Yy5vZmZzZXRXaWR0aDsNCgkJCWlmICh0eXBlb2YgeWN3ID09ICJ1bmRlZmluZWQiKQ0KCQkJCS8vIEtvbnF1ZXJvciBicmFpbi1kZWFkIHRlY2huaXF1ZXMNCgkJCQl5Y3cgPSA1MDsNCgkJCXMubGVmdCA9IChjZC5vZmZzZXRMZWZ0ICsgY2Qub2Zmc2V0V2lkdGggLSB5Y3cpICsgInB4IjsNCgkJfQ0KCQlzLnRvcCA9IChjZC5vZmZzZXRUb3AgKyBjZC5vZmZzZXRIZWlnaHQpICsgInB4IjsNCgl9DQp9Ow0KDQovLyBldmVudCBoYW5kbGVycw0KDQpDYWxlbmRhci50YWJsZU1vdXNlVXAgPSBmdW5jdGlvbihldikgew0KCXZhciBjYWwgPSBDYWxlbmRhci5fQzsNCglpZiAoIWNhbCkgew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCWlmIChjYWwudGltZW91dCkgew0KCQljbGVhclRpbWVvdXQoY2FsLnRpbWVvdXQpOw0KCX0NCgl2YXIgZWwgPSBjYWwuYWN0aXZlRGl2Ow0KCWlmICghZWwpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCgl2YXIgdGFyZ2V0ID0gQ2FsZW5kYXIuZ2V0VGFyZ2V0RWxlbWVudChldik7DQoJZXYgfHwgKGV2ID0gd2luZG93LmV2ZW50KTsNCglDYWxlbmRhci5yZW1vdmVDbGFzcyhlbCwgImFjdGl2ZSIpOw0KCWlmICh0YXJnZXQgPT0gZWwgfHwgdGFyZ2V0LnBhcmVudE5vZGUgPT0gZWwpIHsNCgkJQ2FsZW5kYXIuY2VsbENsaWNrKGVsLCBldik7DQoJfQ0KCXZhciBtb24gPSBDYWxlbmRhci5maW5kTW9udGgodGFyZ2V0KTsNCgl2YXIgZGF0ZSA9IG51bGw7DQoJaWYgKG1vbikgew0KCQlkYXRlID0gbmV3IERhdGUoY2FsLmRhdGUpOw0KCQlpZiAobW9uLm1vbnRoICE9IGRhdGUuZ2V0TW9udGgoKSkgew0KCQkJZGF0ZS5zZXRNb250aChtb24ubW9udGgpOw0KCQkJY2FsLnNldERhdGUoZGF0ZSk7DQoJCQljYWwuZGF0ZUNsaWNrZWQgPSBmYWxzZTsNCgkJCWNhbC50b2RheUNsaWNrZWQgPSBmYWxzZTsNCgkJCWNhbC5jYWxsSGFuZGxlcigpOw0KCQl9DQoJfSBlbHNlIHsNCgkJdmFyIHllYXIgPSBDYWxlbmRhci5maW5kWWVhcih0YXJnZXQpOw0KCQlpZiAoeWVhcikgew0KCQkJZGF0ZSA9IG5ldyBEYXRlKGNhbC5kYXRlKTsNCgkJCWlmICh5ZWFyLnllYXIgIT0gZGF0ZS5nZXRGdWxsWWVhcigpKSB7DQoJCQkJZGF0ZS5zZXRGdWxsWWVhcih5ZWFyLnllYXIpOw0KCQkJCWNhbC5zZXREYXRlKGRhdGUpOw0KCQkJCWNhbC5kYXRlQ2xpY2tlZCA9IGZhbHNlOw0KCQkJCWNhbC50b2RheUNsaWNrZWQgPSBmYWxzZTsNCgkJCQljYWwuY2FsbEhhbmRsZXIoKTsNCgkJCX0NCgkJfQ0KCX0NCgl3aXRoIChDYWxlbmRhcikgew0KCQlyZW1vdmVFdmVudChkb2N1bWVudCwgIm1vdXNldXAiLCB0YWJsZU1vdXNlVXApOw0KCQlyZW1vdmVFdmVudChkb2N1bWVudCwgIm1vdXNlb3ZlciIsIHRhYmxlTW91c2VPdmVyKTsNCgkJcmVtb3ZlRXZlbnQoZG9jdW1lbnQsICJtb3VzZW1vdmUiLCB0YWJsZU1vdXNlT3Zlcik7DQoJCWNhbC5faGlkZUNvbWJvcygpOw0KCQlfQyA9IG51bGw7DQoJCXJldHVybiBzdG9wRXZlbnQoZXYpOw0KCX0NCn07DQoNCkNhbGVuZGFyLnRhYmxlTW91c2VPdmVyID0gZnVuY3Rpb24gKGV2KSB7DQoJdmFyIGNhbCA9IENhbGVuZGFyLl9DOw0KCWlmICghY2FsKSB7DQoJCXJldHVybjsNCgl9DQoJdmFyIGVsID0gY2FsLmFjdGl2ZURpdjsNCgl2YXIgdGFyZ2V0ID0gQ2FsZW5kYXIuZ2V0VGFyZ2V0RWxlbWVudChldik7DQoJaWYgKHRhcmdldCA9PSBlbCB8fCB0YXJnZXQucGFyZW50Tm9kZSA9PSBlbCkgew0KCQlDYWxlbmRhci5hZGRDbGFzcyhlbCwgImhpbGl0ZSBhY3RpdmUiKTsNCgkJQ2FsZW5kYXIuYWRkQ2xhc3MoZWwucGFyZW50Tm9kZSwgInJvd2hpbGl0ZSIpOw0KCX0gZWxzZSB7DQoJCWlmICh0eXBlb2YgZWwubmF2dHlwZSA9PSAidW5kZWZpbmVkIiB8fCAoZWwubmF2dHlwZSAhPSA1MCAmJiAoZWwubmF2dHlwZSA9PSAwIHx8IE1hdGguYWJzKGVsLm5hdnR5cGUpID4gMikpKQ0KCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwsICJhY3RpdmUiKTsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwsICJoaWxpdGUiKTsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwucGFyZW50Tm9kZSwgInJvd2hpbGl0ZSIpOw0KCX0NCglldiB8fCAoZXYgPSB3aW5kb3cuZXZlbnQpOw0KCWlmIChlbC5uYXZ0eXBlID09IDUwICYmIHRhcmdldCAhPSBlbCkgew0KCQl2YXIgcG9zID0gQ2FsZW5kYXIuZ2V0QWJzb2x1dGVQb3MoZWwpOw0KCQl2YXIgdyA9IGVsLm9mZnNldFdpZHRoOw0KCQl2YXIgeCA9IGV2LmNsaWVudFg7DQoJCXZhciBkeDsNCgkJdmFyIGRlY3JlYXNlID0gdHJ1ZTsNCgkJaWYgKHggPiBwb3MueCArIHcpIHsNCgkJCWR4ID0geCAtIHBvcy54IC0gdzsNCgkJCWRlY3JlYXNlID0gZmFsc2U7DQoJCX0gZWxzZQ0KCQkJZHggPSBwb3MueCAtIHg7DQoNCgkJaWYgKGR4IDwgMCkgZHggPSAwOw0KCQl2YXIgcmFuZ2UgPSBlbC5fcmFuZ2U7DQoJCXZhciBjdXJyZW50ID0gZWwuX2N1cnJlbnQ7DQoJCXZhciBjb3VudCA9IE1hdGguZmxvb3IoZHggLyAxMCkgJSByYW5nZS5sZW5ndGg7DQoJCWZvciAodmFyIGkgPSByYW5nZS5sZW5ndGg7IC0taSA+PSAwOykNCgkJCWlmIChyYW5nZVtpXSA9PSBjdXJyZW50KQ0KCQkJCWJyZWFrOw0KCQl3aGlsZSAoY291bnQtLSA+IDApDQoJCQlpZiAoZGVjcmVhc2UpIHsNCgkJCQlpZiAoLS1pIDwgMCkNCgkJCQkJaSA9IHJhbmdlLmxlbmd0aCAtIDE7DQoJCQl9IGVsc2UgaWYgKCArK2kgPj0gcmFuZ2UubGVuZ3RoICkNCgkJCQlpID0gMDsNCgkJdmFyIG5ld3ZhbCA9IHJhbmdlW2ldOw0KCQllbC5pbm5lckhUTUwgPSBuZXd2YWw7DQoNCgkJY2FsLm9uVXBkYXRlVGltZSgpOw0KCX0NCgl2YXIgbW9uID0gQ2FsZW5kYXIuZmluZE1vbnRoKHRhcmdldCk7DQoJaWYgKG1vbikgew0KCQlpZiAobW9uLm1vbnRoICE9IGNhbC5kYXRlLmdldE1vbnRoKCkpIHsNCgkJCWlmIChjYWwuaGlsaXRlZE1vbnRoKSB7DQoJCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2FsLmhpbGl0ZWRNb250aCwgImhpbGl0ZSIpOw0KCQkJfQ0KCQkJQ2FsZW5kYXIuYWRkQ2xhc3MobW9uLCAiaGlsaXRlIik7DQoJCQljYWwuaGlsaXRlZE1vbnRoID0gbW9uOw0KCQl9IGVsc2UgaWYgKGNhbC5oaWxpdGVkTW9udGgpIHsNCgkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNhbC5oaWxpdGVkTW9udGgsICJoaWxpdGUiKTsNCgkJfQ0KCX0gZWxzZSB7DQoJCWlmIChjYWwuaGlsaXRlZE1vbnRoKSB7DQoJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuaGlsaXRlZE1vbnRoLCAiaGlsaXRlIik7DQoJCX0NCgkJdmFyIHllYXIgPSBDYWxlbmRhci5maW5kWWVhcih0YXJnZXQpOw0KCQlpZiAoeWVhcikgew0KCQkJaWYgKHllYXIueWVhciAhPSBjYWwuZGF0ZS5nZXRGdWxsWWVhcigpKSB7DQoJCQkJaWYgKGNhbC5oaWxpdGVkWWVhcikgew0KCQkJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuaGlsaXRlZFllYXIsICJoaWxpdGUiKTsNCgkJCQl9DQoJCQkJQ2FsZW5kYXIuYWRkQ2xhc3MoeWVhciwgImhpbGl0ZSIpOw0KCQkJCWNhbC5oaWxpdGVkWWVhciA9IHllYXI7DQoJCQl9IGVsc2UgaWYgKGNhbC5oaWxpdGVkWWVhcikgew0KCQkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNhbC5oaWxpdGVkWWVhciwgImhpbGl0ZSIpOw0KCQkJfQ0KCQl9IGVsc2UgaWYgKGNhbC5oaWxpdGVkWWVhcikgew0KCQkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoY2FsLmhpbGl0ZWRZZWFyLCAiaGlsaXRlIik7DQoJCX0NCgl9DQoJcmV0dXJuIENhbGVuZGFyLnN0b3BFdmVudChldik7DQp9Ow0KDQpDYWxlbmRhci50YWJsZU1vdXNlRG93biA9IGZ1bmN0aW9uIChldikgew0KCWlmIChDYWxlbmRhci5nZXRUYXJnZXRFbGVtZW50KGV2KSA9PSBDYWxlbmRhci5nZXRFbGVtZW50KGV2KSkgew0KCQlyZXR1cm4gQ2FsZW5kYXIuc3RvcEV2ZW50KGV2KTsNCgl9DQp9Ow0KDQpDYWxlbmRhci5jYWxEcmFnSXQgPSBmdW5jdGlvbiAoZXYpIHsNCgl2YXIgY2FsID0gQ2FsZW5kYXIuX0M7DQoJaWYgKCEoY2FsICYmIGNhbC5kcmFnZ2luZykpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCgl2YXIgcG9zWDsNCgl2YXIgcG9zWTsNCglpZiAoQ2FsZW5kYXIuaXNfaWUpIHsNCgkJcG9zWSA9IHdpbmRvdy5ldmVudC5jbGllbnRZICsgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7DQoJCXBvc1ggPSB3aW5kb3cuZXZlbnQuY2xpZW50WCArIGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDsNCgl9IGVsc2Ugew0KCQlwb3NYID0gZXYucGFnZVg7DQoJCXBvc1kgPSBldi5wYWdlWTsNCgl9DQoJLy9jYWwuaGlkZVNob3dDb3ZlcmVkKCk7DQoJdmFyIHN0ID0gY2FsLmVsZW1lbnQuc3R5bGU7DQoJc3QubGVmdCA9IChwb3NYIC0gY2FsLnhPZmZzKSArICJweCI7DQoJc3QudG9wID0gKHBvc1kgLSBjYWwueU9mZnMpICsgInB4IjsNCg0KCS8vIGZpeCBieSBNYXJrIGFuZCBWaWN0b3I6IEJFR0lODQoJdmFyIGlmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjYWxfaWZyYW1lIik7DQoJaWZyYW1lLnN0eWxlLmxlZnQgPSBzdC5sZWZ0Ow0KCWlmcmFtZS5zdHlsZS50b3AgPSBzdC50b3A7DQoJLy8gZml4IGJ5IE1hcmsgYW5kIFZpY3RvcjogRU5EDQoNCglyZXR1cm4gQ2FsZW5kYXIuc3RvcEV2ZW50KGV2KTsNCn07DQoNCkNhbGVuZGFyLmNhbERyYWdFbmQgPSBmdW5jdGlvbiAoZXYpIHsNCgl2YXIgY2FsID0gQ2FsZW5kYXIuX0M7DQoJaWYgKCFjYWwpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCgljYWwuZHJhZ2dpbmcgPSBmYWxzZTsNCgl3aXRoIChDYWxlbmRhcikgew0KCQlyZW1vdmVFdmVudChkb2N1bWVudCwgIm1vdXNlbW92ZSIsIGNhbERyYWdJdCk7DQoJCXJlbW92ZUV2ZW50KGRvY3VtZW50LCAibW91c2V1cCIsIGNhbERyYWdFbmQpOw0KCQl0YWJsZU1vdXNlVXAoZXYpOw0KCX0NCgkvL2NhbC5oaWRlU2hvd0NvdmVyZWQoKTsNCn07DQoNCkNhbGVuZGFyLmRheU1vdXNlRG93biA9IGZ1bmN0aW9uKGV2KSB7DQoJdmFyIGVsID0gQ2FsZW5kYXIuZ2V0RWxlbWVudChldik7DQoJaWYgKGVsLmRpc2FibGVkKSB7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoJdmFyIGNhbCA9IGVsLmNhbGVuZGFyOw0KCWNhbC5hY3RpdmVEaXYgPSBlbDsNCglDYWxlbmRhci5fQyA9IGNhbDsNCglpZiAoZWwubmF2dHlwZSAhPSAzMDApIHdpdGggKENhbGVuZGFyKSB7DQoJCWlmIChlbC5uYXZ0eXBlID09IDUwKSB7DQoJCQllbC5fY3VycmVudCA9IGVsLmlubmVySFRNTDsNCgkJCWFkZEV2ZW50KGRvY3VtZW50LCAibW91c2Vtb3ZlIiwgdGFibGVNb3VzZU92ZXIpOw0KCQl9IGVsc2UNCgkJCWFkZEV2ZW50KGRvY3VtZW50LCBDYWxlbmRhci5pc19pZTUgPyAibW91c2Vtb3ZlIiA6ICJtb3VzZW92ZXIiLCB0YWJsZU1vdXNlT3Zlcik7DQoJCWFkZENsYXNzKGVsLCAiaGlsaXRlIGFjdGl2ZSIpOw0KCQlhZGRFdmVudChkb2N1bWVudCwgIm1vdXNldXAiLCB0YWJsZU1vdXNlVXApOw0KCX0gZWxzZSBpZiAoY2FsLmlzUG9wdXApIHsNCgkJY2FsLl9kcmFnU3RhcnQoZXYpOw0KCX0NCglpZiAoZWwubmF2dHlwZSA9PSAtMSB8fCBlbC5uYXZ0eXBlID09IDEpIHsNCgkJaWYgKGNhbC50aW1lb3V0KSBjbGVhclRpbWVvdXQoY2FsLnRpbWVvdXQpOw0KCQljYWwudGltZW91dCA9IHNldFRpbWVvdXQoIkNhbGVuZGFyLnNob3dNb250aHNDb21ibygpIiwgMjUwKTsNCgl9IGVsc2UgaWYgKGVsLm5hdnR5cGUgPT0gLTIgfHwgZWwubmF2dHlwZSA9PSAyKSB7DQoJCWlmIChjYWwudGltZW91dCkgY2xlYXJUaW1lb3V0KGNhbC50aW1lb3V0KTsNCgkJY2FsLnRpbWVvdXQgPSBzZXRUaW1lb3V0KChlbC5uYXZ0eXBlID4gMCkgPyAiQ2FsZW5kYXIuc2hvd1llYXJzQ29tYm8odHJ1ZSkiIDogIkNhbGVuZGFyLnNob3dZZWFyc0NvbWJvKGZhbHNlKSIsIDI1MCk7DQoJfSBlbHNlIHsNCgkJY2FsLnRpbWVvdXQgPSBudWxsOw0KCX0NCglyZXR1cm4gQ2FsZW5kYXIuc3RvcEV2ZW50KGV2KTsNCn07DQoNCkNhbGVuZGFyLmRheU1vdXNlRGJsQ2xpY2sgPSBmdW5jdGlvbihldikgew0KCUNhbGVuZGFyLmNlbGxDbGljayhDYWxlbmRhci5nZXRFbGVtZW50KGV2KSwgZXYgfHwgd2luZG93LmV2ZW50KTsNCglpZiAoQ2FsZW5kYXIuaXNfaWUpIHsNCgkJZG9jdW1lbnQuc2VsZWN0aW9uLmVtcHR5KCk7DQoJfQ0KfTsNCg0KQ2FsZW5kYXIuZGF5TW91c2VPdmVyID0gZnVuY3Rpb24oZXYpIHsNCgl2YXIgZWwgPSBDYWxlbmRhci5nZXRFbGVtZW50KGV2KTsNCglpZiAoQ2FsZW5kYXIuaXNSZWxhdGVkKGVsLCBldikgfHwgQ2FsZW5kYXIuX0MgfHwgZWwuZGlzYWJsZWQpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCglpZiAoZWwudHRpcCkgew0KCQlpZiAoZWwudHRpcC5zdWJzdHIoMCwgMSkgPT0gIl8iKSB7DQoJCQllbC50dGlwID0gZWwuY2FsZGF0ZS5wcmludChlbC5jYWxlbmRhci50dERhdGVGb3JtYXQpICsgZWwudHRpcC5zdWJzdHIoMSk7DQoJCX0NCgkJZWwuY2FsZW5kYXIudG9vbHRpcHMuaW5uZXJIVE1MID0gZWwudHRpcDsNCgl9DQoJaWYgKGVsLm5hdnR5cGUgIT0gMzAwKSB7DQoJCUNhbGVuZGFyLmFkZENsYXNzKGVsLCAiaGlsaXRlIik7DQoJCWlmIChlbC5jYWxkYXRlKSB7DQoJCQlDYWxlbmRhci5hZGRDbGFzcyhlbC5wYXJlbnROb2RlLCAicm93aGlsaXRlIik7DQoJCX0NCgl9DQoJcmV0dXJuIENhbGVuZGFyLnN0b3BFdmVudChldik7DQp9Ow0KDQpDYWxlbmRhci5kYXlNb3VzZU91dCA9IGZ1bmN0aW9uKGV2KSB7DQoJd2l0aCAoQ2FsZW5kYXIpIHsNCgkJdmFyIGVsID0gZ2V0RWxlbWVudChldik7DQoJCWlmIChpc1JlbGF0ZWQoZWwsIGV2KSB8fCBfQyB8fCBlbC5kaXNhYmxlZCkNCgkJCXJldHVybiBmYWxzZTsNCgkJcmVtb3ZlQ2xhc3MoZWwsICJoaWxpdGUiKTsNCgkJaWYgKGVsLmNhbGRhdGUpDQoJCQlyZW1vdmVDbGFzcyhlbC5wYXJlbnROb2RlLCAicm93aGlsaXRlIik7DQoJCWlmIChlbC5jYWxlbmRhcikNCgkJCWVsLmNhbGVuZGFyLnRvb2x0aXBzLmlubmVySFRNTCA9IF9UVFsiU0VMX0RBVEUiXTsNCgkJcmV0dXJuIHN0b3BFdmVudChldik7DQoJfQ0KfTsNCg0KLyoqDQoqICBBIGdlbmVyaWMgImNsaWNrIiBoYW5kbGVyIDopIGhhbmRsZXMgYWxsIHR5cGVzIG9mIGJ1dHRvbnMgZGVmaW5lZCBpbiB0aGlzDQoqICBjYWxlbmRhci4NCiovDQpDYWxlbmRhci5jZWxsQ2xpY2sgPSBmdW5jdGlvbihlbCwgZXYpIHsNCgl2YXIgY2FsID0gZWwuY2FsZW5kYXI7DQoJdmFyIGNsb3NpbmcgPSBmYWxzZTsNCgl2YXIgbmV3ZGF0ZSA9IGZhbHNlOw0KCXZhciBkYXRlID0gbnVsbDsNCglpZiAodHlwZW9mIGVsLm5hdnR5cGUgPT0gInVuZGVmaW5lZCIpIHsNCgkJaWYgKGNhbC5jdXJyZW50RGF0ZUVsKSB7DQoJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjYWwuY3VycmVudERhdGVFbCwgInNlbGVjdGVkIik7DQoJCQlDYWxlbmRhci5hZGRDbGFzcyhlbCwgInNlbGVjdGVkIik7DQoJCQljbG9zaW5nID0gKGNhbC5jdXJyZW50RGF0ZUVsID09IGVsKTsNCgkJCWlmICghY2xvc2luZykgew0KCQkJCWNhbC5jdXJyZW50RGF0ZUVsID0gZWw7DQoJCQl9DQoJCX0NCgkJY2FsLmRhdGUuc2V0RGF0ZU9ubHkoZWwuY2FsZGF0ZSk7DQoJCWRhdGUgPSBjYWwuZGF0ZTsNCgkJdmFyIG90aGVyX21vbnRoID0gIShjYWwuZGF0ZUNsaWNrZWQgPSAhZWwub3RoZXJNb250aCk7DQoJCWlmICghb3RoZXJfbW9udGggJiYgIWNhbC5jdXJyZW50RGF0ZUVsKQ0KCQkJY2FsLl90b2dnbGVNdWx0aXBsZURhdGUobmV3IERhdGUoZGF0ZSkpOw0KCQllbHNlDQoJCQluZXdkYXRlID0gIWVsLmRpc2FibGVkOw0KCQkvLyBhIGRhdGUgd2FzIGNsaWNrZWQNCgkJaWYgKG90aGVyX21vbnRoKQ0KCQkJY2FsLl9pbml0KGNhbC5maXJzdERheU9mV2VlaywgZGF0ZSk7DQoJfSBlbHNlIHsNCgkJaWYgKGVsLm5hdnR5cGUgPT0gMjAwKSB7DQoJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhlbCwgImhpbGl0ZSIpOw0KCQkJY2FsLmNhbGxDbG9zZUhhbmRsZXIoKTsNCgkJCXJldHVybjsNCgkJfQ0KCQlkYXRlID0gbmV3IERhdGUoY2FsLmRhdGUpOw0KCQlpZiAoZWwubmF2dHlwZSA9PSAwKSB7DQoJCQlkYXRlLnNldERhdGVPbmx5KG5ldyBEYXRlKCkpOyAvLyBUT0RBWQ0KCQkJY2FsLnRvZGF5Q2xpY2tlZCA9IHRydWU7DQoJCX0NCgkJLy8gdW5sZXNzICJ0b2RheSIgd2FzIGNsaWNrZWQsIHdlIGFzc3VtZSBubyBkYXRlIHdhcyBjbGlja2VkIHNvDQoJCS8vIHRoZSBzZWxlY3RlZCBoYW5kbGVyIHdpbGwga25vdyBub3QgdG8gY2xvc2UgdGhlIGNhbGVuYXIgd2hlbg0KCQkvLyBpbiBzaW5nbGUtY2xpY2sgbW9kZS4NCgkJLy8gY2FsLmRhdGVDbGlja2VkID0gKGVsLm5hdnR5cGUgPT0gMCk7DQoJCWNhbC5kYXRlQ2xpY2tlZCA9IGZhbHNlOw0KCQl2YXIgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTsNCgkJdmFyIG1vbiA9IGRhdGUuZ2V0TW9udGgoKTsNCgkJZnVuY3Rpb24gc2V0TW9udGgobSkgew0KCQkJdmFyIGRheSA9IGRhdGUuZ2V0RGF0ZSgpOw0KCQkJdmFyIG1heCA9IGRhdGUuZ2V0TW9udGhEYXlzKG0pOw0KCQkJaWYgKGRheSA+IG1heCkgew0KCQkJCWRhdGUuc2V0RGF0ZShtYXgpOw0KCQkJfQ0KCQkJZGF0ZS5zZXRNb250aChtKTsNCgkJfTsNCgkJc3dpdGNoIChlbC5uYXZ0eXBlKSB7DQoJCQljYXNlIDQwMDoNCgkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGVsLCAiaGlsaXRlIik7DQoJCQl2YXIgdGV4dCA9IENhbGVuZGFyLl9UVFsiQUJPVVQiXTsNCgkJCWlmICh0eXBlb2YgdGV4dCAhPSAidW5kZWZpbmVkIikgew0KCQkJCXRleHQgKz0gY2FsLnNob3dzVGltZSA/IENhbGVuZGFyLl9UVFsiQUJPVVRfVElNRSJdIDogIiI7DQoJCQl9IGVsc2Ugew0KCQkJCS8vIEZJWE1FOiB0aGlzIHNob3VsZCBiZSByZW1vdmVkIGFzIHNvb24gYXMgbGFuZyBmaWxlcyBnZXQgdXBkYXRlZCENCgkJCQl0ZXh0ID0gIkhlbHAgYW5kIGFib3V0IGJveCB0ZXh0IGlzIG5vdCB0cmFuc2xhdGVkIGludG8gdGhpcyBsYW5ndWFnZS5cbiIgKw0KCQkJCQkiSWYgeW91IGtub3cgdGhpcyBsYW5ndWFnZSBhbmQgeW91IGZlZWwgZ2VuZXJvdXMgcGxlYXNlIHVwZGF0ZVxuIiArDQoJCQkJCSJ0aGUgY29ycmVzcG9uZGluZyBmaWxlIGluIFwibGFuZ1wiIHN1YmRpciB0byBtYXRjaCBjYWxlbmRhci1lbi5qc1xuIiArDQoJCQkJCSJhbmQgc2VuZCBpdCBiYWNrIHRvIDxtaWhhaV9iYXpvbkB5YWhvby5jb20+IHRvIGdldCBpdCBpbnRvIHRoZSBkaXN0cmlidXRpb24gIDstKVxuXG4iICsNCgkJCQkJIlRoYW5rIHlvdSFcbiIgKw0KCQkJCQkiaHR0cDovL2R5bmFyY2guY29tL21pc2hvby9jYWxlbmRhci5lcGxcbiI7DQoJCQl9DQoJCQlhbGVydCh0ZXh0KTsNCgkJCXJldHVybjsNCgkJCWNhc2UgLTI6DQoJCQlpZiAoeWVhciA+IGNhbC5taW5ZZWFyKSB7DQoJCQkJZGF0ZS5zZXRGdWxsWWVhcih5ZWFyIC0gMSk7DQoJCQl9DQoJCQlicmVhazsNCgkJCWNhc2UgLTE6DQoJCQlpZiAobW9uID4gMCkgew0KCQkJCXNldE1vbnRoKG1vbiAtIDEpOw0KCQkJfSBlbHNlIGlmICh5ZWFyLS0gPiBjYWwubWluWWVhcikgew0KCQkJCWRhdGUuc2V0RnVsbFllYXIoeWVhcik7DQoJCQkJc2V0TW9udGgoMTEpOw0KCQkJfQ0KCQkJYnJlYWs7DQoJCQljYXNlIDE6DQoJCQlpZiAobW9uIDwgMTEpIHsNCgkJCQlzZXRNb250aChtb24gKyAxKTsNCgkJCX0gZWxzZSBpZiAoeWVhciA8IGNhbC5tYXhZZWFyKSB7DQoJCQkJZGF0ZS5zZXRGdWxsWWVhcih5ZWFyICsgMSk7DQoJCQkJc2V0TW9udGgoMCk7DQoJCQl9DQoJCQlicmVhazsNCgkJCWNhc2UgMjoNCgkJCWlmICh5ZWFyIDwgY2FsLm1heFllYXIpIHsNCgkJCQlkYXRlLnNldEZ1bGxZZWFyKHllYXIgKyAxKTsNCgkJCX0NCgkJCWJyZWFrOw0KCQkJY2FzZSAxMDA6DQoJCQkJLy8gQnVnIGZpeDogT01OSTAwMDAzMTk4OyBvbmx5IGFsbG93IFN1bmRheSBhbmQgTW9uZGF5IHRvIGJlIGNsaWNrZWQNCgkJCQlpZiAoZWwuZmRvdyA8PSAxKSB7DQoJCQkJCWNhbC5zZXRGaXJzdERheU9mV2VlayhlbC5mZG93KTsNCgkJCQl9DQoJCQlyZXR1cm47DQoJCQljYXNlIDUwOg0KCQkJdmFyIHJhbmdlID0gZWwuX3JhbmdlOw0KCQkJdmFyIGN1cnJlbnQgPSBlbC5pbm5lckhUTUw7DQoJCQlmb3IgKHZhciBpID0gcmFuZ2UubGVuZ3RoOyAtLWkgPj0gMDspDQoJCQkJaWYgKHJhbmdlW2ldID09IGN1cnJlbnQpDQoJCQkJCWJyZWFrOw0KCQkJaWYgKGV2ICYmIGV2LnNoaWZ0S2V5KSB7DQoJCQkJaWYgKC0taSA8IDApDQoJCQkJCWkgPSByYW5nZS5sZW5ndGggLSAxOw0KCQkJfSBlbHNlIGlmICggKytpID49IHJhbmdlLmxlbmd0aCApDQoJCQkJaSA9IDA7DQoJCQl2YXIgbmV3dmFsID0gcmFuZ2VbaV07DQoJCQllbC5pbm5lckhUTUwgPSBuZXd2YWw7DQoJCQljYWwub25VcGRhdGVUaW1lKCk7DQoJCQlyZXR1cm47DQoJCQljYXNlIDA6DQoJCQkvLyBUT0RBWSB3aWxsIGJyaW5nIHVzIGhlcmUNCgkJCWlmICgodHlwZW9mIGNhbC5nZXREYXRlU3RhdHVzID09ICJmdW5jdGlvbiIpICYmDQoJCQkJY2FsLmdldERhdGVTdGF0dXMoZGF0ZSwgZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCksIGRhdGUuZ2V0RGF0ZSgpKSkgew0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCgkJCWJyZWFrOw0KCQl9DQoJCWlmICghZGF0ZS5lcXVhbHNUbyhjYWwuZGF0ZSkpIHsNCgkJCWNhbC5zZXREYXRlKGRhdGUpOw0KCQkJbmV3ZGF0ZSA9IHRydWU7DQoJCX0gZWxzZSBpZiAoZWwubmF2dHlwZSA9PSAwKQ0KCQkJbmV3ZGF0ZSA9IGNsb3NpbmcgPSB0cnVlOw0KCX0NCglpZiAobmV3ZGF0ZSkgew0KCQlldiAmJiBjYWwuY2FsbEhhbmRsZXIoKTsNCgl9DQoJaWYgKGNsb3NpbmcpIHsNCgkJQ2FsZW5kYXIucmVtb3ZlQ2xhc3MoZWwsICJoaWxpdGUiKTsNCgkJZXYgJiYgY2FsLmNhbGxDbG9zZUhhbmRsZXIoKTsNCgl9DQp9Ow0KDQovLyBFTkQ6IENBTEVOREFSIFNUQVRJQyBGVU5DVElPTlMNCg0KLy8gQkVHSU46IENBTEVOREFSIE9CSkVDVCBGVU5DVElPTlMNCg0KLyoqDQoqICBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgdGhlIGNhbGVuZGFyIGluc2lkZSB0aGUgZ2l2ZW4gcGFyZW50LiAgSWYgX3BhciBpcw0KKiAgbnVsbCB0aGFuIGl0IGNyZWF0ZXMgYSBwb3B1cCBjYWxlbmRhciBpbnNpZGUgdGhlIEJPRFkgZWxlbWVudC4gIElmIF9wYXIgaXMNCiogIGFuIGVsZW1lbnQsIGJlIGl0IEJPRFksIHRoZW4gaXQgY3JlYXRlcyBhIG5vbi1wb3B1cCBjYWxlbmRhciAoc3RpbGwNCiogIGhpZGRlbikuICBTb21lIHByb3BlcnRpZXMgbmVlZCB0byBiZSBzZXQgYmVmb3JlIGNhbGxpbmcgdGhpcyBmdW5jdGlvbi4NCiovDQpDYWxlbmRhci5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKF9wYXIpIHsNCgl2YXIgcGFyZW50ID0gbnVsbDsNCglpZiAoISBfcGFyKSB7DQoJCS8vIGRlZmF1bHQgcGFyZW50IGlzIHRoZSBkb2N1bWVudCBib2R5LCBpbiB3aGljaCBjYXNlIHdlIGNyZWF0ZQ0KCQkvLyBhIHBvcHVwIGNhbGVuZGFyLg0KCQlwYXJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdOw0KCQl0aGlzLmlzUG9wdXAgPSB0cnVlOw0KCX0gZWxzZSB7DQoJCXBhcmVudCA9IF9wYXI7DQoJCXRoaXMuaXNQb3B1cCA9IGZhbHNlOw0KCX0NCgl0aGlzLmRhdGUgPSB0aGlzLmRhdGVTdHIgPyBuZXcgRGF0ZSh0aGlzLmRhdGVTdHIpIDogbmV3IERhdGUoKTsNCg0KCXZhciB0YWJsZSA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRhYmxlIik7DQoJdGhpcy50YWJsZSA9IHRhYmxlOw0KCXRhYmxlLmNlbGxTcGFjaW5nID0gMDsNCgl0YWJsZS5jZWxsUGFkZGluZyA9IDA7DQoJdGFibGUuY2FsZW5kYXIgPSB0aGlzOw0KCUNhbGVuZGFyLmFkZEV2ZW50KHRhYmxlLCAibW91c2Vkb3duIiwgQ2FsZW5kYXIudGFibGVNb3VzZURvd24pOw0KDQoJdmFyIGRpdiA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCXRoaXMuZWxlbWVudCA9IGRpdjsNCg0KCQkvLyBmaXggYnkgTWFyayBhbmQgVmljdG9yIHdpdGgga3Vkb3MgdG8geG1hcnQ6IEJFR0lODQoJCXZhciBpZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2FsX2lmcmFtZSIpOw0KCQlpZiAoaWZyYW1lID09IG51bGwpIHsNCgkJCWlmcmFtZSA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoImlmcmFtZSIsIGRvY3VtZW50LmJvZHkpOw0KCQkJaWZyYW1lLnNldEF0dHJpYnV0ZSgiaWQiLCAiY2FsX2lmcmFtZSIpOw0KCQl9DQoJCXRoaXMuaWZyYW1lID0gaWZyYW1lOw0KCQl0aGlzLmlmcmFtZS5zdHlsZS5ib3JkZXIgPSAnbm9uZSc7DQoJCXRoaXMuaWZyYW1lLnN0eWxlLnpJbmRleCA9IDE5OTsNCgkJLy8gZml4IGJ5IE1hcmsgYW5kIFZpY3RvciB3aXRoIGt1ZG9zIHRvIHhtYXJ0OiBFTkQNCg0KCWRpdi5jbGFzc05hbWUgPSAiY2FsZW5kYXIiOw0KCWlmICh0aGlzLmlzUG9wdXApIHsNCgkJZGl2LnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsNCgkJZGl2LnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJfQ0KCWRpdi5hcHBlbmRDaGlsZCh0YWJsZSk7DQoNCgl2YXIgdGhlYWQgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0aGVhZCIsIHRhYmxlKTsNCgl2YXIgY2VsbCA9IG51bGw7DQoJdmFyIHJvdyA9IG51bGw7DQoNCgl2YXIgY2FsID0gdGhpczsNCgl2YXIgaGggPSBmdW5jdGlvbiAodGV4dCwgY3MsIG5hdnR5cGUpIHsNCgkJY2VsbCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRkIiwgcm93KTsNCgkJY2VsbC5jb2xTcGFuID0gY3M7DQoJCWNlbGwuY2xhc3NOYW1lID0gImJ1dHRvbiI7DQoJCWlmIChuYXZ0eXBlICE9IDAgJiYgTWF0aC5hYnMobmF2dHlwZSkgPD0gMikNCgkJCWNlbGwuY2xhc3NOYW1lICs9ICIgbmF2IjsNCgkJQ2FsZW5kYXIuX2FkZF9ldnMoY2VsbCk7DQoJCWNlbGwuY2FsZW5kYXIgPSBjYWw7DQoJCWNlbGwubmF2dHlwZSA9IG5hdnR5cGU7DQoJCWNlbGwuaW5uZXJIVE1MID0gIjxkaXYgdW5zZWxlY3RhYmxlPSdvbic+IiArIHRleHQgKyAiPC9kaXY+IjsNCgkJcmV0dXJuIGNlbGw7DQoJfTsNCg0KCXJvdyA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRyIiwgdGhlYWQpOw0KCXZhciB0aXRsZV9sZW5ndGggPSA2Ow0KCSh0aGlzLmlzUG9wdXApICYmIC0tdGl0bGVfbGVuZ3RoOw0KCSh0aGlzLndlZWtOdW1iZXJzKSAmJiArK3RpdGxlX2xlbmd0aDsNCg0KCWhoKCI/IiwgMSwgNDAwKS50dGlwID0gQ2FsZW5kYXIuX1RUWyJJTkZPIl07DQoJdGhpcy50aXRsZSA9IGhoKCIiLCB0aXRsZV9sZW5ndGgsIDMwMCk7DQoJdGhpcy50aXRsZS5jbGFzc05hbWUgPSAidGl0bGUiOw0KCWlmICh0aGlzLmlzUG9wdXApIHsNCgkJdGhpcy50aXRsZS50dGlwID0gQ2FsZW5kYXIuX1RUWyJEUkFHX1RPX01PVkUiXTsNCgkJdGhpcy50aXRsZS5zdHlsZS5jdXJzb3IgPSAibW92ZSI7DQoJCWhoKCImI3gwMGQ3OyIsIDEsIDIwMCkudHRpcCA9IENhbGVuZGFyLl9UVFsiQ0xPU0UiXTsNCgl9DQoNCglyb3cgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ciIsIHRoZWFkKTsNCglyb3cuY2xhc3NOYW1lID0gImhlYWRyb3ciOw0KDQoJdGhpcy5fbmF2X3B5ID0gaGgoIiYjeDAwYWI7IiwgMSwgLTIpOw0KCXRoaXMuX25hdl9weS50dGlwID0gQ2FsZW5kYXIuX1RUWyJQUkVWX1lFQVIiXTsNCg0KCXRoaXMuX25hdl9wbSA9IGhoKCImI3gyMDM5OyIsIDEsIC0xKTsNCgl0aGlzLl9uYXZfcG0udHRpcCA9IENhbGVuZGFyLl9UVFsiUFJFVl9NT05USCJdOw0KDQoJdGhpcy5fbmF2X25vdyA9IGhoKENhbGVuZGFyLl9UVFsiVE9EQVkiXSwgdGhpcy53ZWVrTnVtYmVycyA/IDQgOiAzLCAwKTsNCgl0aGlzLl9uYXZfbm93LnR0aXAgPSBDYWxlbmRhci5fVFRbIkdPX1RPREFZIl07DQoNCgl0aGlzLl9uYXZfbm0gPSBoaCgiJiN4MjAzYTsiLCAxLCAxKTsNCgl0aGlzLl9uYXZfbm0udHRpcCA9IENhbGVuZGFyLl9UVFsiTkVYVF9NT05USCJdOw0KDQoJdGhpcy5fbmF2X255ID0gaGgoIiYjeDAwYmI7IiwgMSwgMik7DQoJdGhpcy5fbmF2X255LnR0aXAgPSBDYWxlbmRhci5fVFRbIk5FWFRfWUVBUiJdOw0KDQoJLy8gZGF5IG5hbWVzDQoJcm93ID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgidHIiLCB0aGVhZCk7DQoJcm93LmNsYXNzTmFtZSA9ICJkYXluYW1lcyI7DQoJaWYgKHRoaXMud2Vla051bWJlcnMpIHsNCgkJY2VsbCA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRkIiwgcm93KTsNCgkJY2VsbC5jbGFzc05hbWUgPSAibmFtZSB3biI7DQoJCWNlbGwuaW5uZXJIVE1MID0gQ2FsZW5kYXIuX1RUWyJXSyJdOw0KCX0NCglmb3IgKHZhciBpID0gNzsgaSA+IDA7IC0taSkgew0KCQljZWxsID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgidGQiLCByb3cpOw0KCQlpZiAoIWkpIHsNCgkJCWNlbGwubmF2dHlwZSA9IDEwMDsNCgkJCWNlbGwuY2FsZW5kYXIgPSB0aGlzOw0KCQkJQ2FsZW5kYXIuX2FkZF9ldnMoY2VsbCk7DQoJCX0NCgl9DQoJdGhpcy5maXJzdGRheW5hbWUgPSAodGhpcy53ZWVrTnVtYmVycykgPyByb3cuZmlyc3RDaGlsZC5uZXh0U2libGluZyA6IHJvdy5maXJzdENoaWxkOw0KCXRoaXMuX2Rpc3BsYXlXZWVrZGF5cygpOw0KDQoJdmFyIHRib2R5ID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgidGJvZHkiLCB0YWJsZSk7DQoJdGhpcy50Ym9keSA9IHRib2R5Ow0KDQoJZm9yIChpID0gNjsgaSA+IDA7IC0taSkgew0KCQlyb3cgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ciIsIHRib2R5KTsNCgkJaWYgKHRoaXMud2Vla051bWJlcnMpIHsNCgkJCWNlbGwgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ZCIsIHJvdyk7DQoJCX0NCgkJZm9yICh2YXIgaiA9IDc7IGogPiAwOyAtLWopIHsNCgkJCWNlbGwgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ZCIsIHJvdyk7DQoJCQljZWxsLmNhbGVuZGFyID0gdGhpczsNCgkJCUNhbGVuZGFyLl9hZGRfZXZzKGNlbGwpOw0KCQl9DQoJfQ0KDQoJaWYgKHRoaXMuc2hvd3NUaW1lKSB7DQoJCXJvdyA9IENhbGVuZGFyLmNyZWF0ZUVsZW1lbnQoInRyIiwgdGJvZHkpOw0KCQlyb3cuY2xhc3NOYW1lID0gInRpbWUiOw0KDQoJCWNlbGwgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ZCIsIHJvdyk7DQoJCWNlbGwuY2xhc3NOYW1lID0gInRpbWUiOw0KCQljZWxsLmNvbFNwYW4gPSAyOw0KCQljZWxsLmlubmVySFRNTCA9IENhbGVuZGFyLl9UVFsiVElNRSJdIHx8ICImbmJzcDsiOw0KDQoJCWNlbGwgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ZCIsIHJvdyk7DQoJCWNlbGwuY2xhc3NOYW1lID0gInRpbWUiOw0KCQljZWxsLmNvbFNwYW4gPSB0aGlzLndlZWtOdW1iZXJzID8gNCA6IDM7DQoNCgkJKGZ1bmN0aW9uKCl7DQoJCQlmdW5jdGlvbiBtYWtlVGltZVBhcnQoY2xhc3NOYW1lLCBpbml0LCByYW5nZV9zdGFydCwgcmFuZ2VfZW5kKSB7DQoJCQkJdmFyIHBhcnQgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJzcGFuIiwgY2VsbCk7DQoJCQkJcGFydC5jbGFzc05hbWUgPSBjbGFzc05hbWU7DQoJCQkJcGFydC5pbm5lckhUTUwgPSBpbml0Ow0KCQkJCXBhcnQuY2FsZW5kYXIgPSBjYWw7DQoJCQkJcGFydC50dGlwID0gQ2FsZW5kYXIuX1RUWyJUSU1FX1BBUlQiXTsNCgkJCQlwYXJ0Lm5hdnR5cGUgPSA1MDsNCgkJCQlwYXJ0Ll9yYW5nZSA9IFtdOw0KCQkJCWlmICh0eXBlb2YgcmFuZ2Vfc3RhcnQgIT0gIm51bWJlciIpDQoJCQkJCXBhcnQuX3JhbmdlID0gcmFuZ2Vfc3RhcnQ7DQoJCQkJZWxzZSB7DQoJCQkJCWZvciAodmFyIGkgPSByYW5nZV9zdGFydDsgaSA8PSByYW5nZV9lbmQ7ICsraSkgew0KCQkJCQkJdmFyIHR4dDsNCgkJCQkJCWlmIChpIDwgMTAgJiYgcmFuZ2VfZW5kID49IDEwKSB0eHQgPSAnMCcgKyBpOw0KCQkJCQkJZWxzZSB0eHQgPSAnJyArIGk7DQoJCQkJCQlwYXJ0Ll9yYW5nZVtwYXJ0Ll9yYW5nZS5sZW5ndGhdID0gdHh0Ow0KCQkJCQl9DQoJCQkJfQ0KCQkJCUNhbGVuZGFyLl9hZGRfZXZzKHBhcnQpOw0KCQkJCXJldHVybiBwYXJ0Ow0KCQkJfTsNCgkJCXZhciBocnMgPSBjYWwuZGF0ZS5nZXRIb3VycygpOw0KCQkJdmFyIG1pbnMgPSBjYWwuZGF0ZS5nZXRNaW51dGVzKCk7DQoJCQl2YXIgdDEyID0gIWNhbC50aW1lMjQ7DQoJCQl2YXIgcG0gPSAoaHJzID4gMTIpOw0KCQkJaWYgKHQxMiAmJiBwbSkgaHJzIC09IDEyOw0KCQkJdmFyIEggPSBtYWtlVGltZVBhcnQoImhvdXIiLCBocnMsIHQxMiA/IDEgOiAwLCB0MTIgPyAxMiA6IDIzKTsNCgkJCXZhciBzcGFuID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgic3BhbiIsIGNlbGwpOw0KCQkJc3Bhbi5pbm5lckhUTUwgPSAiOiI7DQoJCQlzcGFuLmNsYXNzTmFtZSA9ICJjb2xvbiI7DQoJCQl2YXIgTSA9IG1ha2VUaW1lUGFydCgibWludXRlIiwgbWlucywgMCwgNTkpOw0KCQkJdmFyIEFQID0gbnVsbDsNCgkJCWNlbGwgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ZCIsIHJvdyk7DQoJCQljZWxsLmNsYXNzTmFtZSA9ICJ0aW1lIjsNCgkJCWNlbGwuY29sU3BhbiA9IDI7DQoJCQlpZiAodDEyKQ0KCQkJCUFQID0gbWFrZVRpbWVQYXJ0KCJhbXBtIiwgcG0gPyAicG0iIDogImFtIiwgWyJhbSIsICJwbSJdKTsNCgkJCWVsc2UNCgkJCQljZWxsLmlubmVySFRNTCA9ICImbmJzcDsiOw0KDQoJCQljYWwub25TZXRUaW1lID0gZnVuY3Rpb24oKSB7DQoJCQkJdmFyIHBtLCBocnMgPSB0aGlzLmRhdGUuZ2V0SG91cnMoKSwNCgkJCQkJbWlucyA9IHRoaXMuZGF0ZS5nZXRNaW51dGVzKCk7DQoJCQkJaWYgKHQxMikgew0KCQkJCQlwbSA9IChocnMgPj0gMTIpOw0KCQkJCQlpZiAocG0pIGhycyAtPSAxMjsNCgkJCQkJaWYgKGhycyA9PSAwKSBocnMgPSAxMjsNCgkJCQkJQVAuaW5uZXJIVE1MID0gcG0gPyAicG0iIDogImFtIjsNCgkJCQl9DQoJCQkJSC5pbm5lckhUTUwgPSAoaHJzIDwgMTApID8gKCIwIiArIGhycykgOiBocnM7DQoJCQkJTS5pbm5lckhUTUwgPSAobWlucyA8IDEwKSA/ICgiMCIgKyBtaW5zKSA6IG1pbnM7DQoJCQl9Ow0KDQoJCQljYWwub25VcGRhdGVUaW1lID0gZnVuY3Rpb24oKSB7DQoJCQkJdmFyIGRhdGUgPSB0aGlzLmRhdGU7DQoJCQkJdmFyIGggPSBwYXJzZUludChILmlubmVySFRNTCwgMTApOw0KCQkJCWlmICh0MTIpIHsNCgkJCQkJaWYgKC9wbS9pLnRlc3QoQVAuaW5uZXJIVE1MKSAmJiBoIDwgMTIpDQoJCQkJCQloICs9IDEyOw0KCQkJCQllbHNlIGlmICgvYW0vaS50ZXN0KEFQLmlubmVySFRNTCkgJiYgaCA9PSAxMikNCgkJCQkJCWggPSAwOw0KCQkJCX0NCgkJCQl2YXIgZCA9IGRhdGUuZ2V0RGF0ZSgpOw0KCQkJCXZhciBtID0gZGF0ZS5nZXRNb250aCgpOw0KCQkJCXZhciB5ID0gZGF0ZS5nZXRGdWxsWWVhcigpOw0KCQkJCWRhdGUuc2V0SG91cnMoaCk7DQoJCQkJZGF0ZS5zZXRNaW51dGVzKHBhcnNlSW50KE0uaW5uZXJIVE1MLCAxMCkpOw0KCQkJCWRhdGUuc2V0RnVsbFllYXIoeSk7DQoJCQkJZGF0ZS5zZXRNb250aChtKTsNCgkJCQlkYXRlLnNldERhdGUoZCk7DQoJCQkJdGhpcy5kYXRlQ2xpY2tlZCA9IGZhbHNlOw0KCQkJCXRoaXMuY2FsbEhhbmRsZXIoKTsNCgkJCX07DQoJCX0pKCk7DQoJfSBlbHNlIHsNCgkJdGhpcy5vblNldFRpbWUgPSB0aGlzLm9uVXBkYXRlVGltZSA9IGZ1bmN0aW9uKCkge307DQoJfQ0KDQoJdmFyIHRmb290ID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgidGZvb3QiLCB0YWJsZSk7DQoNCglyb3cgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJ0ciIsIHRmb290KTsNCglyb3cuY2xhc3NOYW1lID0gImZvb3Ryb3ciOw0KDQoJY2VsbCA9IGhoKENhbGVuZGFyLl9UVFsiU0VMX0RBVEUiXSwgdGhpcy53ZWVrTnVtYmVycyA/IDggOiA3LCAzMDApOw0KCWNlbGwuY2xhc3NOYW1lID0gInR0aXAiOw0KCWlmICh0aGlzLmlzUG9wdXApIHsNCgkJY2VsbC50dGlwID0gQ2FsZW5kYXIuX1RUWyJEUkFHX1RPX01PVkUiXTsNCgkJY2VsbC5zdHlsZS5jdXJzb3IgPSAibW92ZSI7DQoJfQ0KCXRoaXMudG9vbHRpcHMgPSBjZWxsOw0KDQoJZGl2ID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgiZGl2IiwgdGhpcy5lbGVtZW50KTsNCgl0aGlzLm1vbnRoc0NvbWJvID0gZGl2Ow0KCWRpdi5jbGFzc05hbWUgPSAiY29tYm8iOw0KCWZvciAoaSA9IDA7IGkgPCBDYWxlbmRhci5fTU4ubGVuZ3RoOyArK2kpIHsNCgkJdmFyIG1uID0gQ2FsZW5kYXIuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCW1uLmNsYXNzTmFtZSA9IENhbGVuZGFyLmlzX2llID8gImxhYmVsLUlFZml4IiA6ICJsYWJlbCI7DQoJCW1uLm1vbnRoID0gaTsNCgkJbW4uaW5uZXJIVE1MID0gQ2FsZW5kYXIuX1NNTltpXTsNCgkJZGl2LmFwcGVuZENoaWxkKG1uKTsNCgl9DQoNCglkaXYgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJkaXYiLCB0aGlzLmVsZW1lbnQpOw0KCXRoaXMueWVhcnNDb21ibyA9IGRpdjsNCglkaXYuY2xhc3NOYW1lID0gImNvbWJvIjsNCglmb3IgKGkgPSAxMjsgaSA+IDA7IC0taSkgew0KCQl2YXIgeXIgPSBDYWxlbmRhci5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJeXIuY2xhc3NOYW1lID0gQ2FsZW5kYXIuaXNfaWUgPyAibGFiZWwtSUVmaXgiIDogImxhYmVsIjsNCgkJZGl2LmFwcGVuZENoaWxkKHlyKTsNCgl9DQoNCgl0aGlzLl9pbml0KHRoaXMuZmlyc3REYXlPZldlZWssIHRoaXMuZGF0ZSk7DQoJcGFyZW50LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7DQp9Ow0KDQovKioga2V5Ym9hcmQgbmF2aWdhdGlvbiwgb25seSBmb3IgcG9wdXAgY2FsZW5kYXJzICovDQpDYWxlbmRhci5fa2V5RXZlbnQgPSBmdW5jdGlvbihldikgew0KCXZhciBjYWwgPSB3aW5kb3cuX2R5bmFyY2hfcG9wdXBDYWxlbmRhcjsNCglpZiAoIWNhbCB8fCBjYWwubXVsdGlwbGUpDQoJCXJldHVybiBmYWxzZTsNCgkoQ2FsZW5kYXIuaXNfaWUpICYmIChldiA9IHdpbmRvdy5ldmVudCk7DQoJdmFyIGFjdCA9IChDYWxlbmRhci5pc19pZSB8fCBldi50eXBlID09ICJrZXlwcmVzcyIpLA0KCQlLID0gZXYua2V5Q29kZTsNCglpZiAoZXYuY3RybEtleSkgew0KCQlzd2l0Y2ggKEspIHsNCgkJCWNhc2UgMzc6IC8vIEtFWSBsZWZ0DQoJCQlhY3QgJiYgQ2FsZW5kYXIuY2VsbENsaWNrKGNhbC5fbmF2X3BtKTsNCgkJCWJyZWFrOw0KCQkJY2FzZSAzODogLy8gS0VZIHVwDQoJCQlhY3QgJiYgQ2FsZW5kYXIuY2VsbENsaWNrKGNhbC5fbmF2X3B5KTsNCgkJCWJyZWFrOw0KCQkJY2FzZSAzOTogLy8gS0VZIHJpZ2h0DQoJCQlhY3QgJiYgQ2FsZW5kYXIuY2VsbENsaWNrKGNhbC5fbmF2X25tKTsNCgkJCWJyZWFrOw0KCQkJY2FzZSA0MDogLy8gS0VZIGRvd24NCgkJCWFjdCAmJiBDYWxlbmRhci5jZWxsQ2xpY2soY2FsLl9uYXZfbnkpOw0KCQkJYnJlYWs7DQoJCQlkZWZhdWx0Og0KCQkJcmV0dXJuIGZhbHNlOw0KCQl9DQoJfSBlbHNlIHN3aXRjaCAoSykgew0KCQljYXNlIDMyOiAvLyBLRVkgc3BhY2UgKG5vdykNCgkJQ2FsZW5kYXIuY2VsbENsaWNrKGNhbC5fbmF2X25vdyk7DQoJCWJyZWFrOw0KCQljYXNlIDI3OiAvLyBLRVkgZXNjDQoJCWFjdCAmJiBjYWwuY2FsbENsb3NlSGFuZGxlcigpOw0KCQlicmVhazsNCgkJY2FzZSAzNzogLy8gS0VZIGxlZnQNCgkJY2FzZSAzODogLy8gS0VZIHVwDQoJCWNhc2UgMzk6IC8vIEtFWSByaWdodA0KCQljYXNlIDQwOiAvLyBLRVkgZG93bg0KCQlpZiAoYWN0KSB7DQoJCQl2YXIgcHJldiwgeCwgeSwgbmUsIGVsLCBzdGVwOw0KCQkJcHJldiA9IEsgPT0gMzcgfHwgSyA9PSAzODsNCgkJCXN0ZXAgPSAoSyA9PSAzNyB8fCBLID09IDM5KSA/IDEgOiA3Ow0KCQkJZnVuY3Rpb24gc2V0VmFycygpIHsNCgkJCQllbCA9IGNhbC5jdXJyZW50RGF0ZUVsOw0KCQkJCXZhciBwID0gZWwucG9zOw0KCQkJCXggPSBwICYgMTU7DQoJCQkJeSA9IHAgPj4gNDsNCgkJCQluZSA9IGNhbC5hcl9kYXlzW3ldW3hdOw0KCQkJfTtzZXRWYXJzKCk7DQoJCQlmdW5jdGlvbiBwcmV2TW9udGgoKSB7DQoJCQkJdmFyIGRhdGUgPSBuZXcgRGF0ZShjYWwuZGF0ZSk7DQoJCQkJZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpIC0gc3RlcCk7DQoJCQkJY2FsLnNldERhdGUoZGF0ZSk7DQoJCQl9Ow0KCQkJZnVuY3Rpb24gbmV4dE1vbnRoKCkgew0KCQkJCXZhciBkYXRlID0gbmV3IERhdGUoY2FsLmRhdGUpOw0KCQkJCWRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIHN0ZXApOw0KCQkJCWNhbC5zZXREYXRlKGRhdGUpOw0KCQkJfTsNCgkJCXdoaWxlICgxKSB7DQoJCQkJc3dpdGNoIChLKSB7DQoJCQkJCWNhc2UgMzc6IC8vIEtFWSBsZWZ0DQoJCQkJCWlmICgtLXggPj0gMCkNCgkJCQkJCW5lID0gY2FsLmFyX2RheXNbeV1beF07DQoJCQkJCWVsc2Ugew0KCQkJCQkJeCA9IDY7DQoJCQkJCQlLID0gMzg7DQoJCQkJCQljb250aW51ZTsNCgkJCQkJfQ0KCQkJCQlicmVhazsNCgkJCQkJY2FzZSAzODogLy8gS0VZIHVwDQoJCQkJCWlmICgtLXkgPj0gMCkNCgkJCQkJCW5lID0gY2FsLmFyX2RheXNbeV1beF07DQoJCQkJCWVsc2Ugew0KCQkJCQkJcHJldk1vbnRoKCk7DQoJCQkJCQlzZXRWYXJzKCk7DQoJCQkJCX0NCgkJCQkJYnJlYWs7DQoJCQkJCWNhc2UgMzk6IC8vIEtFWSByaWdodA0KCQkJCQlpZiAoKyt4IDwgNykNCgkJCQkJCW5lID0gY2FsLmFyX2RheXNbeV1beF07DQoJCQkJCWVsc2Ugew0KCQkJCQkJeCA9IDA7DQoJCQkJCQlLID0gNDA7DQoJCQkJCQljb250aW51ZTsNCgkJCQkJfQ0KCQkJCQlicmVhazsNCgkJCQkJY2FzZSA0MDogLy8gS0VZIGRvd24NCgkJCQkJaWYgKCsreSA8IGNhbC5hcl9kYXlzLmxlbmd0aCkNCgkJCQkJCW5lID0gY2FsLmFyX2RheXNbeV1beF07DQoJCQkJCWVsc2Ugew0KCQkJCQkJbmV4dE1vbnRoKCk7DQoJCQkJCQlzZXRWYXJzKCk7DQoJCQkJCX0NCgkJCQkJYnJlYWs7DQoJCQkJfQ0KCQkJCWJyZWFrOw0KCQkJfQ0KCQkJaWYgKG5lKSB7DQoJCQkJaWYgKCFuZS5kaXNhYmxlZCkNCgkJCQkJQ2FsZW5kYXIuY2VsbENsaWNrKG5lKTsNCgkJCQllbHNlIGlmIChwcmV2KQ0KCQkJCQlwcmV2TW9udGgoKTsNCgkJCQllbHNlDQoJCQkJCW5leHRNb250aCgpOw0KCQkJfQ0KCQl9DQoJCWJyZWFrOw0KCQljYXNlIDEzOiAvLyBLRVkgZW50ZXINCgkJaWYgKGFjdCkNCgkJCUNhbGVuZGFyLmNlbGxDbGljayhjYWwuY3VycmVudERhdGVFbCwgZXYpOw0KCQlicmVhazsNCgkJZGVmYXVsdDoNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCglyZXR1cm4gQ2FsZW5kYXIuc3RvcEV2ZW50KGV2KTsNCn07DQoNCi8qKg0KKiAgKFJFKUluaXRpYWxpemVzIHRoZSBjYWxlbmRhciB0byB0aGUgZ2l2ZW4gZGF0ZSBhbmQgZmlyc3REYXlPZldlZWsNCiovDQpDYWxlbmRhci5wcm90b3R5cGUuX2luaXQgPSBmdW5jdGlvbiAoZmlyc3REYXlPZldlZWssIGRhdGUpIHsNCgl2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpLA0KCQlUWSA9IHRvZGF5LmdldEZ1bGxZZWFyKCksDQoJCVRNID0gdG9kYXkuZ2V0TW9udGgoKSwNCgkJVEQgPSB0b2RheS5nZXREYXRlKCk7DQoJdGhpcy50YWJsZS5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7DQoJdmFyIHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7DQoJaWYgKHllYXIgPCB0aGlzLm1pblllYXIpIHsNCgkJeWVhciA9IHRoaXMubWluWWVhcjsNCgkJZGF0ZS5zZXRGdWxsWWVhcih5ZWFyKTsNCgl9IGVsc2UgaWYgKHllYXIgPiB0aGlzLm1heFllYXIpIHsNCgkJeWVhciA9IHRoaXMubWF4WWVhcjsNCgkJZGF0ZS5zZXRGdWxsWWVhcih5ZWFyKTsNCgl9DQoJdGhpcy5maXJzdERheU9mV2VlayA9IGZpcnN0RGF5T2ZXZWVrOw0KCXRoaXMuZGF0ZSA9IG5ldyBEYXRlKGRhdGUpOw0KCXZhciBtb250aCA9IGRhdGUuZ2V0TW9udGgoKTsNCgl2YXIgbWRheSA9IGRhdGUuZ2V0RGF0ZSgpOw0KCXZhciBub19kYXlzID0gZGF0ZS5nZXRNb250aERheXMoKTsNCg0KCS8vIGNhbGVuZGFyIHZvb2RvbyBmb3IgY29tcHV0aW5nIHRoZSBmaXJzdCBkYXkgdGhhdCB3b3VsZCBhY3R1YWxseSBiZQ0KCS8vIGRpc3BsYXllZCBpbiB0aGUgY2FsZW5kYXIsIGV2ZW4gaWYgaXQncyBmcm9tIHRoZSBwcmV2aW91cyBtb250aC4NCgkvLyBXQVJOSU5HOiB0aGlzIGlzIG1hZ2ljLiA7LSkNCglkYXRlLnNldERhdGUoMSk7DQoJdmFyIGRheTEgPSAoZGF0ZS5nZXREYXkoKSAtIHRoaXMuZmlyc3REYXlPZldlZWspICUgNzsNCglpZiAoZGF5MSA8IDApDQoJCWRheTEgKz0gNzsNCglkYXRlLnNldERhdGUoLWRheTEpOw0KCWRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIDEpOw0KDQoJdmFyIHJvdyA9IHRoaXMudGJvZHkuZmlyc3RDaGlsZDsNCgl2YXIgTU4gPSBDYWxlbmRhci5fU01OW21vbnRoXTsNCgl2YXIgYXJfZGF5cyA9IHRoaXMuYXJfZGF5cyA9IG5ldyBBcnJheSgpOw0KCXZhciB3ZWVrZW5kID0gQ2FsZW5kYXIuX1RUWyJXRUVLRU5EIl07DQoJdmFyIGRhdGVzID0gdGhpcy5tdWx0aXBsZSA/ICh0aGlzLmRhdGVzQ2VsbHMgPSB7fSkgOiBudWxsOw0KCWZvciAodmFyIGkgPSAwOyBpIDwgNjsgKytpLCByb3cgPSByb3cubmV4dFNpYmxpbmcpIHsNCgkJdmFyIGNlbGwgPSByb3cuZmlyc3RDaGlsZDsNCgkJaWYgKHRoaXMud2Vla051bWJlcnMpIHsNCgkJCWNlbGwuY2xhc3NOYW1lID0gImRheSB3biI7DQoJCQljZWxsLmlubmVySFRNTCA9IGRhdGUuZ2V0V2Vla051bWJlcigpOw0KCQkJY2VsbCA9IGNlbGwubmV4dFNpYmxpbmc7DQoJCX0NCgkJcm93LmNsYXNzTmFtZSA9ICJkYXlzcm93IjsNCgkJdmFyIGhhc2RheXMgPSBmYWxzZSwgaWRheSwgZHBvcyA9IGFyX2RheXNbaV0gPSBbXTsNCgkJZm9yICh2YXIgaiA9IDA7IGogPCA3OyArK2osIGNlbGwgPSBjZWxsLm5leHRTaWJsaW5nLCBkYXRlLnNldERhdGUoaWRheSArIDEpKSB7DQoJCQlpZGF5ID0gZGF0ZS5nZXREYXRlKCk7DQoJCQl2YXIgd2RheSA9IGRhdGUuZ2V0RGF5KCk7DQoJCQljZWxsLmNsYXNzTmFtZSA9ICJkYXkiOw0KCQkJY2VsbC5wb3MgPSBpIDw8IDQgfCBqOw0KCQkJZHBvc1tqXSA9IGNlbGw7DQoJCQl2YXIgY3VycmVudF9tb250aCA9IChkYXRlLmdldE1vbnRoKCkgPT0gbW9udGgpOw0KCQkJaWYgKCFjdXJyZW50X21vbnRoKSB7DQoJCQkJaWYgKHRoaXMuc2hvd3NPdGhlck1vbnRocykgew0KCQkJCQljZWxsLmNsYXNzTmFtZSArPSAiIG90aGVybW9udGgiOw0KCQkJCQljZWxsLm90aGVyTW9udGggPSB0cnVlOw0KCQkJCX0gZWxzZSB7DQoJCQkJCWNlbGwuY2xhc3NOYW1lID0gImVtcHR5Y2VsbCI7DQoJCQkJCWNlbGwuaW5uZXJIVE1MID0gIiZuYnNwOyI7DQoJCQkJCWNlbGwuZGlzYWJsZWQgPSB0cnVlOw0KCQkJCQljb250aW51ZTsNCgkJCQl9DQoJCQl9IGVsc2Ugew0KCQkJCWNlbGwub3RoZXJNb250aCA9IGZhbHNlOw0KCQkJCWhhc2RheXMgPSB0cnVlOw0KCQkJfQ0KCQkJY2VsbC5kaXNhYmxlZCA9IGZhbHNlOw0KCQkJY2VsbC5pbm5lckhUTUwgPSB0aGlzLmdldERhdGVUZXh0ID8gdGhpcy5nZXREYXRlVGV4dChkYXRlLCBpZGF5KSA6IGlkYXk7DQoJCQlpZiAoZGF0ZXMpDQoJCQkJZGF0ZXNbZGF0ZS5wcmludCgiJVklbSVkIildID0gY2VsbDsNCgkJCWlmICh0aGlzLmdldERhdGVTdGF0dXMpIHsNCgkJCQl2YXIgc3RhdHVzID0gdGhpcy5nZXREYXRlU3RhdHVzKGRhdGUsIHllYXIsIG1vbnRoLCBpZGF5KTsNCgkJCQlpZiAodGhpcy5nZXREYXRlVG9vbFRpcCkgew0KCQkJCQl2YXIgdG9vbFRpcCA9IHRoaXMuZ2V0RGF0ZVRvb2xUaXAoZGF0ZSwgeWVhciwgbW9udGgsIGlkYXkpOw0KCQkJCQlpZiAodG9vbFRpcCkNCgkJCQkJCWNlbGwudGl0bGUgPSB0b29sVGlwOw0KCQkJCX0NCgkJCQlpZiAoc3RhdHVzID09PSB0cnVlKSB7DQoJCQkJCWNlbGwuY2xhc3NOYW1lICs9ICIgZGlzYWJsZWQiOw0KCQkJCQljZWxsLmRpc2FibGVkID0gdHJ1ZTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlpZiAoL2Rpc2FibGVkL2kudGVzdChzdGF0dXMpKQ0KCQkJCQkJY2VsbC5kaXNhYmxlZCA9IHRydWU7DQoJCQkJCWNlbGwuY2xhc3NOYW1lICs9ICIgIiArIHN0YXR1czsNCgkJCQl9DQoJCQl9DQoJCQlpZiAoIWNlbGwuZGlzYWJsZWQpIHsNCgkJCQljZWxsLmNhbGRhdGUgPSBuZXcgRGF0ZShkYXRlKTsNCgkJCQljZWxsLnR0aXAgPSAiXyI7DQoJCQkJaWYgKCF0aGlzLm11bHRpcGxlICYmIGN1cnJlbnRfbW9udGgNCgkJCQkJJiYgaWRheSA9PSBtZGF5ICYmIHRoaXMuaGlsaXRlVG9kYXkpIHsNCgkJCQkJY2VsbC5jbGFzc05hbWUgKz0gIiBzZWxlY3RlZCI7DQoJCQkJCXRoaXMuY3VycmVudERhdGVFbCA9IGNlbGw7DQoJCQkJfQ0KCQkJCWlmIChkYXRlLmdldEZ1bGxZZWFyKCkgPT0gVFkgJiYNCgkJCQkJZGF0ZS5nZXRNb250aCgpID09IFRNICYmDQoJCQkJCWlkYXkgPT0gVEQpIHsNCgkJCQkJY2VsbC5jbGFzc05hbWUgKz0gIiB0b2RheSI7DQoJCQkJCWNlbGwudHRpcCArPSBDYWxlbmRhci5fVFRbIlBBUlRfVE9EQVkiXTsNCgkJCQl9DQoJCQkJaWYgKHdlZWtlbmQuaW5kZXhPZih3ZGF5LnRvU3RyaW5nKCkpICE9IC0xKQ0KCQkJCQljZWxsLmNsYXNzTmFtZSArPSBjZWxsLm90aGVyTW9udGggPyAiIG93ZWVrZW5kIiA6ICIgd2Vla2VuZCI7DQoJCQl9DQoJCX0NCgkJaWYgKCEoaGFzZGF5cyB8fCB0aGlzLnNob3dzT3RoZXJNb250aHMpKQ0KCQkJcm93LmNsYXNzTmFtZSA9ICJlbXB0eXJvdyI7DQoJfQ0KCXRoaXMudGl0bGUuaW5uZXJIVE1MID0gQ2FsZW5kYXIuX01OW21vbnRoXSArICIsICIgKyB5ZWFyOw0KCXRoaXMub25TZXRUaW1lKCk7DQoJdGhpcy50YWJsZS5zdHlsZS52aXNpYmlsaXR5ID0gInZpc2libGUiOw0KCXRoaXMuX2luaXRNdWx0aXBsZURhdGVzKCk7DQoJLy8gUFJPRklMRQ0KCS8vIHRoaXMudG9vbHRpcHMuaW5uZXJIVE1MID0gIkdlbmVyYXRlZCBpbiAiICsgKChuZXcgRGF0ZSgpKSAtIHRvZGF5KSArICIgbXMiOw0KfTsNCg0KQ2FsZW5kYXIucHJvdG90eXBlLl9pbml0TXVsdGlwbGVEYXRlcyA9IGZ1bmN0aW9uKCkgew0KCWlmICh0aGlzLm11bHRpcGxlKSB7DQoJCWZvciAodmFyIGkgaW4gdGhpcy5tdWx0aXBsZSkgew0KCQkJdmFyIGNlbGwgPSB0aGlzLmRhdGVzQ2VsbHNbaV07DQoJCQl2YXIgZCA9IHRoaXMubXVsdGlwbGVbaV07DQoJCQlpZiAoIWQpDQoJCQkJY29udGludWU7DQoJCQlpZiAoY2VsbCkNCgkJCQljZWxsLmNsYXNzTmFtZSArPSAiIHNlbGVjdGVkIjsNCgkJfQ0KCX0NCn07DQoNCkNhbGVuZGFyLnByb3RvdHlwZS5fdG9nZ2xlTXVsdGlwbGVEYXRlID0gZnVuY3Rpb24oZGF0ZSkgew0KCWlmICh0aGlzLm11bHRpcGxlKSB7DQoJCXZhciBkcyA9IGRhdGUucHJpbnQoIiVZJW0lZCIpOw0KCQl2YXIgY2VsbCA9IHRoaXMuZGF0ZXNDZWxsc1tkc107DQoJCWlmIChjZWxsKSB7DQoJCQl2YXIgZCA9IHRoaXMubXVsdGlwbGVbZHNdOw0KCQkJaWYgKCFkKSB7DQoJCQkJQ2FsZW5kYXIuYWRkQ2xhc3MoY2VsbCwgInNlbGVjdGVkIik7DQoJCQkJdGhpcy5tdWx0aXBsZVtkc10gPSBkYXRlOw0KCQkJfSBlbHNlIHsNCgkJCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhjZWxsLCAic2VsZWN0ZWQiKTsNCgkJCQlkZWxldGUgdGhpcy5tdWx0aXBsZVtkc107DQoJCQl9DQoJCX0NCgl9DQp9Ow0KDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0RGF0ZVRvb2xUaXBIYW5kbGVyID0gZnVuY3Rpb24gKHVuYXJ5RnVuY3Rpb24pIHsNCgl0aGlzLmdldERhdGVUb29sVGlwID0gdW5hcnlGdW5jdGlvbjsNCn07DQoNCi8qKg0KKiAgQ2FsbHMgX2luaXQgZnVuY3Rpb24gYWJvdmUgZm9yIGdvaW5nIHRvIGEgY2VydGFpbiBkYXRlIChidXQgb25seSBpZiB0aGUNCiogIGRhdGUgaXMgZGlmZmVyZW50IHRoYW4gdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBvbmUpLg0KKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5nZXRFbGVtZW50ID0gZnVuY3Rpb24gKCkgew0KCXJldHVybiB0aGlzLmVsZW1lbnQ7DQp9Ow0KDQovKioNCiogIENhbGxzIF9pbml0IGZ1bmN0aW9uIGFib3ZlIGZvciBnb2luZyB0byBhIGNlcnRhaW4gZGF0ZSAoYnV0IG9ubHkgaWYgdGhlDQoqICBkYXRlIGlzIGRpZmZlcmVudCB0aGFuIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgb25lKS4NCiovDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0RGF0ZSA9IGZ1bmN0aW9uIChkYXRlKSB7DQoJaWYgKCFkYXRlLmVxdWFsc1RvKHRoaXMuZGF0ZSkpIHsNCgkJdGhpcy5faW5pdCh0aGlzLmZpcnN0RGF5T2ZXZWVrLCBkYXRlKTsNCgl9DQp9Ow0KDQovKioNCiogIFJlZnJlc2hlcyB0aGUgY2FsZW5kYXIuICBVc2VmdWwgaWYgdGhlICJkaXNhYmxlZEhhbmRsZXIiIGZ1bmN0aW9uIGlzDQoqICBkeW5hbWljLCBtZWFuaW5nIHRoYXQgdGhlIGxpc3Qgb2YgZGlzYWJsZWQgZGF0ZSBjYW4gY2hhbmdlIGF0IHJ1bnRpbWUuDQoqICBKdXN0ICogY2FsbCB0aGlzIGZ1bmN0aW9uIGlmIHlvdSB0aGluayB0aGF0IHRoZSBsaXN0IG9mIGRpc2FibGVkIGRhdGVzDQoqICBzaG91bGQgKiBjaGFuZ2UuDQoqLw0KQ2FsZW5kYXIucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7DQoJdGhpcy5faW5pdCh0aGlzLmZpcnN0RGF5T2ZXZWVrLCB0aGlzLmRhdGUpOw0KfTsNCg0KLyoqIE1vZGlmaWVzIHRoZSAiZmlyc3REYXlPZldlZWsiIHBhcmFtZXRlciAocGFzcyAwIGZvciBTeW5kYXksIDEgZm9yIE1vbmRheSwgZXRjLikuICovDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0Rmlyc3REYXlPZldlZWsgPSBmdW5jdGlvbiAoZmlyc3REYXlPZldlZWspIHsNCgl0aGlzLl9pbml0KGZpcnN0RGF5T2ZXZWVrLCB0aGlzLmRhdGUpOw0KCXRoaXMuX2Rpc3BsYXlXZWVrZGF5cygpOw0KfTsNCg0KLyoqDQoqICBBbGxvd3MgY3VzdG9taXphdGlvbiBvZiB3aGF0IGRhdGVzIGFyZSBlbmFibGVkLiAgVGhlICJ1bmFyeUZ1bmN0aW9uIg0KKiAgcGFyYW1ldGVyIG11c3QgYmUgYSBmdW5jdGlvbiBvYmplY3QgdGhhdCByZWNlaXZlcyB0aGUgZGF0ZSAoYXMgYSBKUyBEYXRlDQoqICBvYmplY3QpIGFuZCByZXR1cm5zIGEgYm9vbGVhbiB2YWx1ZS4gIElmIHRoZSByZXR1cm5lZCB2YWx1ZSBpcyB0cnVlIHRoZW4NCiogIHRoZSBwYXNzZWQgZGF0ZSB3aWxsIGJlIG1hcmtlZCBhcyBkaXNhYmxlZC4NCiovDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0RGF0ZVN0YXR1c0hhbmRsZXIgPSBDYWxlbmRhci5wcm90b3R5cGUuc2V0RGlzYWJsZWRIYW5kbGVyID0gZnVuY3Rpb24gKHVuYXJ5RnVuY3Rpb24pIHsNCgl0aGlzLmdldERhdGVTdGF0dXMgPSB1bmFyeUZ1bmN0aW9uOw0KfTsNCg0KLyoqIEN1c3RvbWl6YXRpb24gb2YgYWxsb3dlZCB5ZWFyIHJhbmdlIGZvciB0aGUgY2FsZW5kYXIuICovDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoYSwgeikgew0KCXRoaXMubWluWWVhciA9IGE7DQoJdGhpcy5tYXhZZWFyID0gejsNCn07DQoNCi8qKiBDYWxscyB0aGUgZmlyc3QgdXNlciBoYW5kbGVyIChzZWxlY3RlZEhhbmRsZXIpLiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLmNhbGxIYW5kbGVyID0gZnVuY3Rpb24gKCkgew0KCWlmICh0aGlzLm9uU2VsZWN0ZWQpIHsNCgkJdGhpcy5vblNlbGVjdGVkKHRoaXMsIHRoaXMuZGF0ZS5wcmludCh0aGlzLmRhdGVGb3JtYXQpKTsNCgl9DQp9Ow0KDQovKiogQ2FsbHMgdGhlIHNlY29uZCB1c2VyIGhhbmRsZXIgKGNsb3NlSGFuZGxlcikuICovDQpDYWxlbmRhci5wcm90b3R5cGUuY2FsbENsb3NlSGFuZGxlciA9IGZ1bmN0aW9uICgpIHsNCglpZiAodGhpcy5vbkNsb3NlKSB7DQoJCXRoaXMub25DbG9zZSh0aGlzKTsNCgl9DQoJLy90aGlzLmhpZGVTaG93Q292ZXJlZCgpOw0KfTsNCg0KLyoqIFJlbW92ZXMgdGhlIGNhbGVuZGFyIG9iamVjdCBmcm9tIHRoZSBET00gdHJlZSBhbmQgZGVzdHJveXMgaXQuICovDQpDYWxlbmRhci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsNCgl2YXIgZWwgPSB0aGlzLmVsZW1lbnQucGFyZW50Tm9kZTsNCgllbC5yZW1vdmVDaGlsZCh0aGlzLmVsZW1lbnQpOw0KCUNhbGVuZGFyLl9DID0gbnVsbDsNCgl3aW5kb3cuX2R5bmFyY2hfcG9wdXBDYWxlbmRhciA9IG51bGw7DQp9Ow0KDQovKioNCiogIE1vdmVzIHRoZSBjYWxlbmRhciBlbGVtZW50IHRvIGEgZGlmZmVyZW50IHNlY3Rpb24gaW4gdGhlIERPTSB0cmVlIChjaGFuZ2VzDQoqICBpdHMgcGFyZW50KS4NCiovDQpDYWxlbmRhci5wcm90b3R5cGUucmVwYXJlbnQgPSBmdW5jdGlvbiAobmV3X3BhcmVudCkgew0KCXZhciBlbCA9IHRoaXMuZWxlbWVudDsNCgllbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKTsNCgluZXdfcGFyZW50LmFwcGVuZENoaWxkKGVsKTsNCn07DQoNCi8vIFRoaXMgZ2V0cyBjYWxsZWQgd2hlbiB0aGUgdXNlciBwcmVzc2VzIGEgbW91c2UgYnV0dG9uIGFueXdoZXJlIGluIHRoZQ0KLy8gZG9jdW1lbnQsIGlmIHRoZSBjYWxlbmRhciBpcyBzaG93bi4gIElmIHRoZSBjbGljayB3YXMgb3V0c2lkZSB0aGUgb3Blbg0KLy8gY2FsZW5kYXIgdGhpcyBmdW5jdGlvbiBjbG9zZXMgaXQuDQpDYWxlbmRhci5fY2hlY2tDYWxlbmRhciA9IGZ1bmN0aW9uKGV2KSB7DQoJdmFyIGNhbGVuZGFyID0gd2luZG93Ll9keW5hcmNoX3BvcHVwQ2FsZW5kYXI7DQoJaWYgKCFjYWxlbmRhcikgew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KCXZhciBlbCA9IENhbGVuZGFyLmlzX2llID8gQ2FsZW5kYXIuZ2V0RWxlbWVudChldikgOiBDYWxlbmRhci5nZXRUYXJnZXRFbGVtZW50KGV2KTsNCglmb3IgKDsgZWwgIT0gbnVsbCAmJiBlbCAhPSBjYWxlbmRhci5lbGVtZW50OyBlbCA9IGVsLnBhcmVudE5vZGUpOw0KCWlmIChlbCA9PSBudWxsKSB7DQoJCS8vIGNhbGxzIGNsb3NlSGFuZGxlciB3aGljaCBzaG91bGQgaGlkZSB0aGUgY2FsZW5kYXIuDQoJCXdpbmRvdy5fZHluYXJjaF9wb3B1cENhbGVuZGFyLmNhbGxDbG9zZUhhbmRsZXIoKTsNCgkJcmV0dXJuIENhbGVuZGFyLnN0b3BFdmVudChldik7DQoJfQ0KfTsNCg0KLyoqIFNob3dzIHRoZSBjYWxlbmRhci4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkgew0KCXZhciByb3dzID0gdGhpcy50YWJsZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgidHIiKTsNCglmb3IgKHZhciBpID0gcm93cy5sZW5ndGg7IGkgPiAwOykgew0KCQl2YXIgcm93ID0gcm93c1stLWldOw0KCQlDYWxlbmRhci5yZW1vdmVDbGFzcyhyb3csICJyb3doaWxpdGUiKTsNCgkJdmFyIGNlbGxzID0gcm93LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ZCIpOw0KCQlmb3IgKHZhciBqID0gY2VsbHMubGVuZ3RoOyBqID4gMDspIHsNCgkJCXZhciBjZWxsID0gY2VsbHNbLS1qXTsNCgkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNlbGwsICJoaWxpdGUiKTsNCgkJCUNhbGVuZGFyLnJlbW92ZUNsYXNzKGNlbGwsICJhY3RpdmUiKTsNCgkJfQ0KCX0NCgl0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoNCgkJLy8gZml4IGJ5IE1hcmsgYW5kIFZpY3RvciB3aXRoIGt1ZG9zIHRvIHhtYXJ0OiBCRUdJTg0KCQl2YXIgdyA9IHRoaXMuZWxlbWVudC5vZmZzZXRXaWR0aDsNCgkJdmFyIGggPSB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0Ow0KCQl0aGlzLmlmcmFtZS5zdHlsZS53aWR0aCA9IHcgKyAicHgiOw0KCQl0aGlzLmlmcmFtZS5zdHlsZS5oZWlnaHQgPSBoICsgInB4IjsNCgkJdGhpcy5pZnJhbWUuc3R5bGUudG9wID0gdGhpcy5lbGVtZW50LnN0eWxlLnRvcDsNCgkJdGhpcy5pZnJhbWUuc3R5bGUubGVmdCA9IHRoaXMuZWxlbWVudC5zdHlsZS5sZWZ0Ow0KCQl0aGlzLmlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCgkJdGhpcy5pZnJhbWUuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOw0KCQkvLyBmaXggYnkgTWFyayBhbmQgVmljdG9yIHdpdGgga3Vkb3MgdG8geG1hcnQ6IEVORA0KDQoJdGhpcy5oaWRkZW4gPSBmYWxzZTsNCglpZiAodGhpcy5pc1BvcHVwKSB7DQoJCXdpbmRvdy5fZHluYXJjaF9wb3B1cENhbGVuZGFyID0gdGhpczsNCgkJQ2FsZW5kYXIuYWRkRXZlbnQoZG9jdW1lbnQsICJrZXlkb3duIiwgQ2FsZW5kYXIuX2tleUV2ZW50KTsNCgkJQ2FsZW5kYXIuYWRkRXZlbnQoZG9jdW1lbnQsICJrZXlwcmVzcyIsIENhbGVuZGFyLl9rZXlFdmVudCk7DQoJCUNhbGVuZGFyLmFkZEV2ZW50KGRvY3VtZW50LCAibW91c2Vkb3duIiwgQ2FsZW5kYXIuX2NoZWNrQ2FsZW5kYXIpOw0KCX0NCgkvL3RoaXMuaGlkZVNob3dDb3ZlcmVkKCk7DQp9Ow0KDQovKioNCiogIEhpZGVzIHRoZSBjYWxlbmRhci4gIEFsc28gcmVtb3ZlcyBhbnkgImhpbGl0ZSIgZnJvbSB0aGUgY2xhc3Mgb2YgYW55IFREDQoqICBlbGVtZW50Lg0KKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgew0KCWlmICh0aGlzLmlzUG9wdXApIHsNCgkJQ2FsZW5kYXIucmVtb3ZlRXZlbnQoZG9jdW1lbnQsICJrZXlkb3duIiwgQ2FsZW5kYXIuX2tleUV2ZW50KTsNCgkJQ2FsZW5kYXIucmVtb3ZlRXZlbnQoZG9jdW1lbnQsICJrZXlwcmVzcyIsIENhbGVuZGFyLl9rZXlFdmVudCk7DQoJCUNhbGVuZGFyLnJlbW92ZUV2ZW50KGRvY3VtZW50LCAibW91c2Vkb3duIiwgQ2FsZW5kYXIuX2NoZWNrQ2FsZW5kYXIpOw0KCX0NCgl0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCg0KCQkvLyBmaXggYnkgeG1hcnQ6IEJFR0lODQoJCXRoaXMuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQl0aGlzLmlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQkvLyBmaXggYnkgeG1hcnQ6IEVORA0KDQoJdGhpcy5oaWRkZW4gPSB0cnVlOw0KCS8vdGhpcy5oaWRlU2hvd0NvdmVyZWQoKTsNCn07DQoNCi8qKg0KKiAgU2hvd3MgdGhlIGNhbGVuZGFyIGF0IGEgZ2l2ZW4gYWJzb2x1dGUgcG9zaXRpb24gKGJld2FyZSB0aGF0LCBkZXBlbmRpbmcgb24NCiogIHRoZSBjYWxlbmRhciBlbGVtZW50IHN0eWxlIC0tIHBvc2l0aW9uIHByb3BlcnR5IC0tIHRoaXMgbWlnaHQgYmUgcmVsYXRpdmUNCiogIHRvIHRoZSBwYXJlbnQncyBjb250YWluaW5nIHJlY3RhbmdsZSkuDQoqLw0KQ2FsZW5kYXIucHJvdG90eXBlLnNob3dBdCA9IGZ1bmN0aW9uICh4LCB5KSB7DQoJdmFyIHMgPSB0aGlzLmVsZW1lbnQuc3R5bGU7DQoNCgl2YXIgY2FsZW5kYXJEaWFsb2dXaWR0aCA9IDIxMDsNCgl2YXIgY2FsZW5kYXJEaWFsb2dIZWlnaHQgPSAxODA7DQoNCgl2YXIgdmlld3BvcnRBYnNvbHV0ZVgyID0gdGhpcy52aWV3cG9ydExlZnQgKyB0aGlzLnZpZXdwb3J0V2lkdGg7DQoJdmFyIHZpZXdwb3J0QWJzb2x1dGVZMiA9IHRoaXMudmlld3BvcnRUb3AgKyB0aGlzLnZpZXdwb3J0SGVpZ2h0Ow0KDQoJeCA9ICh4ICsgdGhpcy5hZGp1c3RYKTsNCgl5ID0gKHkgKyB0aGlzLmFkanVzdFkpOw0KDQoJdmFyIGNhbGVuZGFyWDIgPSB4ICsgY2FsZW5kYXJEaWFsb2dXaWR0aDsNCgl2YXIgY2FsZW5kYXJZMiA9IHkgKyBjYWxlbmRhckRpYWxvZ0hlaWdodDsNCg0KCWlmKGNhbGVuZGFyWDIgPiB2aWV3cG9ydEFic29sdXRlWDIpIHsNCgkJeCAtPSAoY2FsZW5kYXJYMiAtIHZpZXdwb3J0QWJzb2x1dGVYMik7DQoJfQ0KDQoJaWYoY2FsZW5kYXJZMiA+IHZpZXdwb3J0QWJzb2x1dGVZMikgew0KCQl5IC09IChjYWxlbmRhclkyIC0gdmlld3BvcnRBYnNvbHV0ZVkyKTsNCgl9DQoJaWYoeSA8IDApIHsNCgkJeSA9IDA7DQoJfQ0KCWlmKHggPCAwKSB7DQoJCXggPSAwOw0KCX0NCg0KCXMubGVmdCA9IHggKyAicHgiOw0KCXMudG9wID0geSArICJweCI7DQoJdGhpcy5zaG93KCk7DQp9Ow0KDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0QWRqdXN0bWVudFBvc2l0aW9uID0gZnVuY3Rpb24oeCwgeSkgew0KCXRoaXMuYWRqdXN0WCA9IHg7DQoJdGhpcy5hZGp1c3RZID0geTsNCn07DQoNCkNhbGVuZGFyLnByb3RvdHlwZS5zZXRWaWV3cG9ydCA9IGZ1bmN0aW9uKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCkgew0KCXRoaXMudmlld3BvcnRMZWZ0ID0gbGVmdDsNCgl0aGlzLnZpZXdwb3J0VG9wID0gdG9wOw0KCXRoaXMudmlld3BvcnRXaWR0aCA9IHdpZHRoOw0KCXRoaXMudmlld3BvcnRIZWlnaHQgPSBoZWlnaHQ7DQp9DQoNCkNhbGVuZGFyLnByb3RvdHlwZS5zZXRQYXJlbnREb2N1bWVudERpbWVuc2lvbnMgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7DQoJdGhpcy5wYXJlbnREb2N1bWVudFdpZHRoID0gd2lkdGg7DQoJdGhpcy5wYXJlbnREb2N1bWVudEhlaWdodCA9IGhlaWdodDsNCn07DQoNCg0KLyoqIFNob3dzIHRoZSBjYWxlbmRhciBuZWFyIGEgZ2l2ZW4gZWxlbWVudC4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5zaG93QXRFbGVtZW50ID0gZnVuY3Rpb24gKGVsLCBvcHRzKSB7DQoJdmFyIHNlbGYgPSB0aGlzOw0KCXZhciBwID0gQ2FsZW5kYXIuZ2V0QWJzb2x1dGVQb3MoZWwpOw0KCWlmICghb3B0cyB8fCB0eXBlb2Ygb3B0cyAhPSAic3RyaW5nIikgew0KCQl0aGlzLnNob3dBdChwLngsIHAueSArIGVsLm9mZnNldEhlaWdodCk7DQoJCXJldHVybiB0cnVlOw0KCX0NCglmdW5jdGlvbiBmaXhQb3NpdGlvbihib3gpIHsNCgkJaWYgKGJveC54IDwgMCkNCgkJCWJveC54ID0gMDsNCgkJaWYgKGJveC55IDwgMCkNCgkJCWJveC55ID0gMDsNCgkJdmFyIGNwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCXZhciBzID0gY3Auc3R5bGU7DQoJCXMucG9zaXRpb24gPSAiYWJzb2x1dGUiOw0KCQlzLnJpZ2h0ID0gcy5ib3R0b20gPSBzLndpZHRoID0gcy5oZWlnaHQgPSAiMHB4IjsNCgkJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjcCk7DQoJCXZhciBiciA9IENhbGVuZGFyLmdldEFic29sdXRlUG9zKGNwKTsNCgkJZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChjcCk7DQoJCWlmIChDYWxlbmRhci5pc19pZSkgew0KCQkJYnIueSArPSBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDsNCgkJCWJyLnggKz0gZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0Ow0KCQl9IGVsc2Ugew0KCQkJYnIueSArPSB3aW5kb3cuc2Nyb2xsWTsNCgkJCWJyLnggKz0gd2luZG93LnNjcm9sbFg7DQoJCX0NCgkJdmFyIHRtcCA9IGJveC54ICsgYm94LndpZHRoIC0gYnIueDsNCgkJaWYgKHRtcCA+IDApIGJveC54IC09IHRtcDsNCgkJdG1wID0gYm94LnkgKyBib3guaGVpZ2h0IC0gYnIueTsNCgkJaWYgKHRtcCA+IDApIGJveC55IC09IHRtcDsNCgl9Ow0KCXRoaXMuZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCglDYWxlbmRhci5jb250aW51YXRpb25fZm9yX3RoZV9mdWNraW5nX2todG1sX2Jyb3dzZXIgPSBmdW5jdGlvbigpIHsNCgkJdmFyIHcgPSBzZWxmLmVsZW1lbnQub2Zmc2V0V2lkdGg7DQoJCXZhciBoID0gc2VsZi5lbGVtZW50Lm9mZnNldEhlaWdodDsNCgkJc2VsZi5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCXZhciB2YWxpZ24gPSBvcHRzLnN1YnN0cigwLCAxKTsNCgkJdmFyIGhhbGlnbiA9ICJsIjsNCgkJaWYgKG9wdHMubGVuZ3RoID4gMSkgew0KCQkJaGFsaWduID0gb3B0cy5zdWJzdHIoMSwgMSk7DQoJCX0NCgkJLy8gdmVydGljYWwgYWxpZ25tZW50DQoJCXN3aXRjaCAodmFsaWduKSB7DQoJCQljYXNlICJUIjogcC55IC09IGg7IGJyZWFrOw0KCQkJY2FzZSAiQiI6IHAueSArPSBlbC5vZmZzZXRIZWlnaHQ7IGJyZWFrOw0KCQkJY2FzZSAiQyI6IHAueSArPSAoZWwub2Zmc2V0SGVpZ2h0IC0gaCkgLyAyOyBicmVhazsNCgkJCWNhc2UgInQiOiBwLnkgKz0gZWwub2Zmc2V0SGVpZ2h0IC0gaDsgYnJlYWs7DQoJCQljYXNlICJiIjogYnJlYWs7IC8vIGFscmVhZHkgdGhlcmUNCgkJfQ0KCQkvLyBob3Jpem9udGFsIGFsaWdubWVudA0KCQlzd2l0Y2ggKGhhbGlnbikgew0KCQkJY2FzZSAiTCI6IHAueCAtPSB3OyBicmVhazsNCgkJCWNhc2UgIlIiOiBwLnggKz0gZWwub2Zmc2V0V2lkdGg7IGJyZWFrOw0KCQkJY2FzZSAiQyI6IHAueCArPSAoZWwub2Zmc2V0V2lkdGggLSB3KSAvIDI7IGJyZWFrOw0KCQkJY2FzZSAibCI6IHAueCArPSBlbC5vZmZzZXRXaWR0aCAtIHc7IGJyZWFrOw0KCQkJY2FzZSAiciI6IGJyZWFrOyAvLyBhbHJlYWR5IHRoZXJlDQoJCX0NCgkJcC53aWR0aCA9IHc7DQoJCXAuaGVpZ2h0ID0gaCArIDQwOw0KCQlzZWxmLm1vbnRoc0NvbWJvLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCWZpeFBvc2l0aW9uKHApOw0KCQlzZWxmLnNob3dBdChwLngsIHAueSk7DQoJfTsNCglpZiAoQ2FsZW5kYXIuaXNfa2h0bWwpDQoJCXNldFRpbWVvdXQoIkNhbGVuZGFyLmNvbnRpbnVhdGlvbl9mb3JfdGhlX2Z1Y2tpbmdfa2h0bWxfYnJvd3NlcigpIiwgMTApOw0KCWVsc2UNCgkJQ2FsZW5kYXIuY29udGludWF0aW9uX2Zvcl90aGVfZnVja2luZ19raHRtbF9icm93c2VyKCk7DQp9Ow0KDQovKiogQ3VzdG9taXplcyB0aGUgZGF0ZSBmb3JtYXQuICovDQpDYWxlbmRhci5wcm90b3R5cGUuc2V0RGF0ZUZvcm1hdCA9IGZ1bmN0aW9uIChzdHIpIHsNCgl0aGlzLmRhdGVGb3JtYXQgPSBzdHI7DQp9Ow0KDQovKiogQ3VzdG9taXplcyB0aGUgdG9vbHRpcCBkYXRlIGZvcm1hdC4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5zZXRUdERhdGVGb3JtYXQgPSBmdW5jdGlvbiAoc3RyKSB7DQoJdGhpcy50dERhdGVGb3JtYXQgPSBzdHI7DQp9Ow0KDQovKioNCiogIFRyaWVzIHRvIGlkZW50aWZ5IHRoZSBkYXRlIHJlcHJlc2VudGVkIGluIGEgc3RyaW5nLiAgSWYgc3VjY2Vzc2Z1bCBpdCBhbHNvDQoqICBjYWxscyB0aGlzLnNldERhdGUgd2hpY2ggbW92ZXMgdGhlIGNhbGVuZGFyIHRvIHRoZSBnaXZlbiBkYXRlLg0KKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5wYXJzZURhdGUgPSBmdW5jdGlvbihzdHIsIGZtdCkgew0KCWlmICghZm10KQ0KCQlmbXQgPSB0aGlzLmRhdGVGb3JtYXQ7DQoJdGhpcy5zZXREYXRlKERhdGUucGFyc2VEYXRlKHN0ciwgZm10KSk7DQp9Ow0KDQpDYWxlbmRhci5wcm90b3R5cGUuaGlkZVNob3dDb3ZlcmVkID0gZnVuY3Rpb24gKCkgew0KCWlmICghQ2FsZW5kYXIuaXNfaWUgJiYgIUNhbGVuZGFyLmlzX29wZXJhKQ0KCQlyZXR1cm47DQoJZnVuY3Rpb24gZ2V0VmlzaWIob2JqKXsNCgkJdmFyIHZhbHVlID0gb2JqLnN0eWxlLnZpc2liaWxpdHk7DQoJCWlmICghdmFsdWUpIHsNCgkJCWlmIChkb2N1bWVudC5kZWZhdWx0VmlldyAmJiB0eXBlb2YgKGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUpID09ICJmdW5jdGlvbiIpIHsgLy8gR2Vja28sIFczQw0KCQkJCWlmICghQ2FsZW5kYXIuaXNfa2h0bWwpDQoJCQkJCXZhbHVlID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcuDQoJCQkJCQlnZXRDb21wdXRlZFN0eWxlKG9iaiwgIiIpLmdldFByb3BlcnR5VmFsdWUoInZpc2liaWxpdHkiKTsNCgkJCQllbHNlDQoJCQkJCXZhbHVlID0gJyc7DQoJCQl9IGVsc2UgaWYgKG9iai5jdXJyZW50U3R5bGUpIHsgLy8gSUUNCgkJCQl2YWx1ZSA9IG9iai5jdXJyZW50U3R5bGUudmlzaWJpbGl0eTsNCgkJCX0gZWxzZQ0KCQkJCXZhbHVlID0gJyc7DQoJCX0NCgkJcmV0dXJuIHZhbHVlOw0KCX07DQoNCgl2YXIgdGFncyA9IG5ldyBBcnJheSgiYXBwbGV0IiwgImlmcmFtZSIsICJzZWxlY3QiKTsNCgl2YXIgZWwgPSB0aGlzLmVsZW1lbnQ7DQoNCgl2YXIgcCA9IENhbGVuZGFyLmdldEFic29sdXRlUG9zKGVsKTsNCgl2YXIgRVgxID0gcC54Ow0KCXZhciBFWDIgPSBlbC5vZmZzZXRXaWR0aCArIEVYMTsNCgl2YXIgRVkxID0gcC55Ow0KCXZhciBFWTIgPSBlbC5vZmZzZXRIZWlnaHQgKyBFWTE7DQoNCglmb3IgKHZhciBrID0gdGFncy5sZW5ndGg7IGsgPiAwOyApIHsNCgkJdmFyIGFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnc1stLWtdKTsNCgkJdmFyIGNjID0gbnVsbDsNCg0KCQlmb3IgKHZhciBpID0gYXIubGVuZ3RoOyBpID4gMDspIHsNCgkJCWNjID0gYXJbLS1pXTsNCg0KCQkJcCA9IENhbGVuZGFyLmdldEFic29sdXRlUG9zKGNjKTsNCgkJCXZhciBDWDEgPSBwLng7DQoJCQl2YXIgQ1gyID0gY2Mub2Zmc2V0V2lkdGggKyBDWDE7DQoJCQl2YXIgQ1kxID0gcC55Ow0KCQkJdmFyIENZMiA9IGNjLm9mZnNldEhlaWdodCArIENZMTsNCg0KCQkJaWYgKHRoaXMuaGlkZGVuIHx8IChDWDEgPiBFWDIpIHx8IChDWDIgPCBFWDEpIHx8IChDWTEgPiBFWTIpIHx8IChDWTIgPCBFWTEpKSB7DQoJCQkJaWYgKCFjYy5fX21zaF9zYXZlX3Zpc2liaWxpdHkpIHsNCgkJCQkJY2MuX19tc2hfc2F2ZV92aXNpYmlsaXR5ID0gZ2V0VmlzaWIoY2MpOw0KCQkJCX0NCgkJCQljYy5zdHlsZS52aXNpYmlsaXR5ID0gY2MuX19tc2hfc2F2ZV92aXNpYmlsaXR5Ow0KCQkJfSBlbHNlIHsNCgkJCQlpZiAoIWNjLl9fbXNoX3NhdmVfdmlzaWJpbGl0eSkgew0KCQkJCQljYy5fX21zaF9zYXZlX3Zpc2liaWxpdHkgPSBnZXRWaXNpYihjYyk7DQoJCQkJfQ0KCQkJCWNjLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsNCgkJCX0NCgkJfQ0KCX0NCn07DQoNCi8qKiBJbnRlcm5hbCBmdW5jdGlvbjsgaXQgZGlzcGxheXMgdGhlIGJhciB3aXRoIHRoZSBuYW1lcyBvZiB0aGUgd2Vla2RheS4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5fZGlzcGxheVdlZWtkYXlzID0gZnVuY3Rpb24gKCkgew0KCXZhciBmZG93ID0gdGhpcy5maXJzdERheU9mV2VlazsNCgl2YXIgY2VsbCA9IHRoaXMuZmlyc3RkYXluYW1lOw0KCXZhciB3ZWVrZW5kID0gQ2FsZW5kYXIuX1RUWyJXRUVLRU5EIl07DQoJZm9yICh2YXIgaSA9IDA7IGkgPCA3OyArK2kpIHsNCgkJY2VsbC5jbGFzc05hbWUgPSAiZGF5IG5hbWUiOw0KCQl2YXIgcmVhbGRheSA9IChpICsgZmRvdykgJSA3Ow0KCQlpZiAoaSkgew0KCQkJLy8gQnVnIGZpeDogT01OSTAwMDAzMTk4OyBvbmx5IGFsbG93IFN1bmRheSBhbmQgTW9uZGF5IHRvIGJlIGNsaWNrZWQNCgkJCWlmIChyZWFsZGF5IDw9IDEpIHsNCgkJCQljZWxsLnR0aXAgPSBDYWxlbmRhci5fVFRbIkRBWV9GSVJTVCJdLnJlcGxhY2UoIiVzIiwgQ2FsZW5kYXIuX0ROW3JlYWxkYXldKTsNCgkJCX0gZWxzZSB7DQoJCQkJY2VsbC50dGlwID0gIiI7DQoJCQl9DQoJCQljZWxsLm5hdnR5cGUgPSAxMDA7DQoJCQljZWxsLmNhbGVuZGFyID0gdGhpczsNCgkJCWNlbGwuZmRvdyA9IHJlYWxkYXk7DQoJCQlDYWxlbmRhci5fYWRkX2V2cyhjZWxsKTsNCgkJfQ0KCQlpZiAod2Vla2VuZC5pbmRleE9mKHJlYWxkYXkudG9TdHJpbmcoKSkgIT0gLTEpIHsNCgkJCUNhbGVuZGFyLmFkZENsYXNzKGNlbGwsICJ3ZWVrZW5kIik7DQoJCX0NCgkJY2VsbC5pbm5lckhUTUwgPSBDYWxlbmRhci5fU0ROWyhpICsgZmRvdykgJSA3XTsNCgkJY2VsbCA9IGNlbGwubmV4dFNpYmxpbmc7DQoJfQ0KfTsNCg0KLyoqIEludGVybmFsIGZ1bmN0aW9uLiAgSGlkZXMgYWxsIGNvbWJvIGJveGVzIHRoYXQgbWlnaHQgYmUgZGlzcGxheWVkLiAqLw0KQ2FsZW5kYXIucHJvdG90eXBlLl9oaWRlQ29tYm9zID0gZnVuY3Rpb24gKCkgew0KCXRoaXMubW9udGhzQ29tYm8uc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgl0aGlzLnllYXJzQ29tYm8uc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCn07DQoNCi8qKiBJbnRlcm5hbCBmdW5jdGlvbi4gIFN0YXJ0cyBkcmFnZ2luZyB0aGUgZWxlbWVudC4gKi8NCkNhbGVuZGFyLnByb3RvdHlwZS5fZHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKGV2KSB7DQoJaWYgKHRoaXMuZHJhZ2dpbmcpIHsNCgkJcmV0dXJuOw0KCX0NCgl0aGlzLmRyYWdnaW5nID0gdHJ1ZTsNCgl2YXIgcG9zWDsNCgl2YXIgcG9zWTsNCglpZiAoQ2FsZW5kYXIuaXNfaWUpIHsNCgkJcG9zWSA9IHdpbmRvdy5ldmVudC5jbGllbnRZICsgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7DQoJCXBvc1ggPSB3aW5kb3cuZXZlbnQuY2xpZW50WCArIGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDsNCgl9IGVsc2Ugew0KCQlwb3NZID0gZXYuY2xpZW50WSArIHdpbmRvdy5zY3JvbGxZOw0KCQlwb3NYID0gZXYuY2xpZW50WCArIHdpbmRvdy5zY3JvbGxYOw0KCX0NCgl2YXIgc3QgPSB0aGlzLmVsZW1lbnQuc3R5bGU7DQoJdGhpcy54T2ZmcyA9IHBvc1ggLSBwYXJzZUludChzdC5sZWZ0KTsNCgl0aGlzLnlPZmZzID0gcG9zWSAtIHBhcnNlSW50KHN0LnRvcCk7DQoJd2l0aCAoQ2FsZW5kYXIpIHsNCgkJYWRkRXZlbnQoZG9jdW1lbnQsICJtb3VzZW1vdmUiLCBjYWxEcmFnSXQpOw0KCQlhZGRFdmVudChkb2N1bWVudCwgIm1vdXNldXAiLCBjYWxEcmFnRW5kKTsNCgl9DQp9Ow0KDQovLyBCRUdJTjogREFURSBPQkpFQ1QgUEFUQ0hFUw0KDQovKiogQWRkcyB0aGUgbnVtYmVyIG9mIGRheXMgYXJyYXkgdG8gdGhlIERhdGUgb2JqZWN0LiAqLw0KRGF0ZS5fTUQgPSBuZXcgQXJyYXkoMzEsMjgsMzEsMzAsMzEsMzAsMzEsMzEsMzAsMzEsMzAsMzEpOw0KDQovKiogQ29uc3RhbnRzIHVzZWQgZm9yIHRpbWUgY29tcHV0YXRpb25zICovDQpEYXRlLlNFQ09ORCA9IDEwMDAgLyogbWlsbGlzZWNvbmRzICovOw0KRGF0ZS5NSU5VVEUgPSA2MCAqIERhdGUuU0VDT05EOw0KRGF0ZS5IT1VSICAgPSA2MCAqIERhdGUuTUlOVVRFOw0KRGF0ZS5EQVkgICAgPSAyNCAqIERhdGUuSE9VUjsNCkRhdGUuV0VFSyAgID0gIDcgKiBEYXRlLkRBWTsNCg0KRGF0ZS5wYXJzZURhdGUgPSBmdW5jdGlvbihzdHIsIGZtdCkgew0KCXZhciB0b2RheSA9IG5ldyBEYXRlKCk7DQoJdmFyIHkgPSAwOw0KCXZhciBtID0gLTE7DQoJdmFyIGQgPSAwOw0KCXZhciBhID0gc3RyLnNwbGl0KC9cVysvKTsNCgl2YXIgYiA9IGZtdC5tYXRjaCgvJS4vZyk7DQoJdmFyIGkgPSAwLCBqID0gMDsNCgl2YXIgaHIgPSAwOw0KCXZhciBtaW4gPSAwOw0KCWZvciAoaSA9IDA7IGkgPCBhLmxlbmd0aDsgKytpKSB7DQoJCWlmICghYVtpXSkNCgkJCWNvbnRpbnVlOw0KCQlzd2l0Y2ggKGJbaV0pIHsNCgkJCWNhc2UgIiVkIjoNCgkJCWNhc2UgIiVlIjoNCgkJCWQgPSBwYXJzZUludChhW2ldLCAxMCk7DQoJCQlicmVhazsNCg0KCQkJY2FzZSAiJW0iOg0KCQkJbSA9IHBhcnNlSW50KGFbaV0sIDEwKSAtIDE7DQoJCQlicmVhazsNCg0KCQkJY2FzZSAiJVkiOg0KCQkJY2FzZSAiJXkiOg0KCQkJaWYgKGFbaV0ubGVuZ3RoID09IDQpIHsNCgkJCQlpZiAocGFyc2VJbnQoYVtpXSwgMTApIDwgMTAwMCkgew0KCQkJCQlhbGVydCgiRGF0ZXMgYmVmb3JlIFllYXIgMTAwMCBhcmUgbm90IHN1cHBvcnRlZC4gIERlZmF1bHRpbmcgdG8gdG9kYXkuIik7DQoJCQkJCXJldHVybiB0b2RheTsNCgkJCQl9DQoJCQl9IGVsc2Ugew0KCQkJCXkgPSBwYXJzZUludChhW2ldLCAxMCk7DQoJCQkJKHkgPCAxMDApICYmICh5ICs9ICh5ID4gMjkpID8gMTkwMCA6IDIwMDApOw0KCQkJfQ0KCQkJYnJlYWs7DQoNCgkJCWNhc2UgIiViIjoNCgkJCWNhc2UgIiVCIjoNCgkJCWZvciAoaiA9IDA7IGogPCAxMjsgKytqKSB7DQoJCQkJaWYgKENhbGVuZGFyLl9NTltqXS5zdWJzdHIoMCwgYVtpXS5sZW5ndGgpLnRvTG93ZXJDYXNlKCkgPT0gYVtpXS50b0xvd2VyQ2FzZSgpKSB7IG0gPSBqOyBicmVhazsgfQ0KCQkJfQ0KCQkJYnJlYWs7DQoNCgkJCWNhc2UgIiVIIjoNCgkJCWNhc2UgIiVJIjoNCgkJCWNhc2UgIiVrIjoNCgkJCWNhc2UgIiVsIjoNCgkJCWhyID0gcGFyc2VJbnQoYVtpXSwgMTApOw0KCQkJYnJlYWs7DQoNCgkJCWNhc2UgIiVQIjoNCgkJCWNhc2UgIiVwIjoNCgkJCWlmICgvcG0vaS50ZXN0KGFbaV0pICYmIGhyIDwgMTIpDQoJCQkJaHIgKz0gMTI7DQoJCQllbHNlIGlmICgvYW0vaS50ZXN0KGFbaV0pICYmIGhyID49IDEyKQ0KCQkJCWhyIC09IDEyOw0KCQkJYnJlYWs7DQoNCgkJCWNhc2UgIiVNIjoNCgkJCW1pbiA9IHBhcnNlSW50KGFbaV0sIDEwKTsNCgkJCWJyZWFrOw0KCQl9DQoJfQ0KCWlmIChpc05hTih5KSkgeSA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7DQoJaWYgKGlzTmFOKG0pKSBtID0gdG9kYXkuZ2V0TW9udGgoKTsNCglpZiAoaXNOYU4oZCkpIGQgPSB0b2RheS5nZXREYXRlKCk7DQoJaWYgKGlzTmFOKGhyKSkgaHIgPSB0b2RheS5nZXRIb3VycygpOw0KCWlmIChpc05hTihtaW4pKSBtaW4gPSB0b2RheS5nZXRNaW51dGVzKCk7DQoJaWYgKHkgIT0gMCAmJiBtICE9IC0xICYmIGQgIT0gMCkNCgkJcmV0dXJuIG5ldyBEYXRlKHksIG0sIGQsIGhyLCBtaW4sIDApOw0KCXkgPSAwOyBtID0gLTE7IGQgPSAwOw0KCWZvciAoaSA9IDA7IGkgPCBhLmxlbmd0aDsgKytpKSB7DQoJCWlmIChhW2ldLnNlYXJjaCgvW2EtekEtWl0rLykgIT0gLTEpIHsNCgkJCXZhciB0ID0gLTE7DQoJCQlmb3IgKGogPSAwOyBqIDwgMTI7ICsraikgew0KCQkJCWlmIChDYWxlbmRhci5fTU5bal0uc3Vic3RyKDAsIGFbaV0ubGVuZ3RoKS50b0xvd2VyQ2FzZSgpID09IGFbaV0udG9Mb3dlckNhc2UoKSkgeyB0ID0gajsgYnJlYWs7IH0NCgkJCX0NCgkJCWlmICh0ICE9IC0xKSB7DQoJCQkJaWYgKG0gIT0gLTEpIHsNCgkJCQkJZCA9IG0rMTsNCgkJCQl9DQoJCQkJbSA9IHQ7DQoJCQl9DQoJCX0gZWxzZSBpZiAocGFyc2VJbnQoYVtpXSwgMTApIDw9IDEyICYmIG0gPT0gLTEpIHsNCgkJCW0gPSBhW2ldLTE7DQoJCX0gZWxzZSBpZiAocGFyc2VJbnQoYVtpXSwgMTApID4gMzEgJiYgeSA9PSAwKSB7DQoJCQl5ID0gcGFyc2VJbnQoYVtpXSwgMTApOw0KCQkJKHkgPCAxMDApICYmICh5ICs9ICh5ID4gMjkpID8gMTkwMCA6IDIwMDApOw0KCQl9IGVsc2UgaWYgKGQgPT0gMCkgew0KCQkJZCA9IGFbaV07DQoJCX0NCgl9DQoJaWYgKHkgPT0gMCkNCgkJeSA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7DQoJaWYgKG0gIT0gLTEgJiYgZCAhPSAwKQ0KCQlyZXR1cm4gbmV3IERhdGUoeSwgbSwgZCwgaHIsIG1pbiwgMCk7DQoJcmV0dXJuIHRvZGF5Ow0KfTsNCg0KLyoqIFJldHVybnMgdGhlIG51bWJlciBvZiBkYXlzIGluIHRoZSBjdXJyZW50IG1vbnRoICovDQpEYXRlLnByb3RvdHlwZS5nZXRNb250aERheXMgPSBmdW5jdGlvbihtb250aCkgew0KCXZhciB5ZWFyID0gdGhpcy5nZXRGdWxsWWVhcigpOw0KCWlmICh0eXBlb2YgbW9udGggPT0gInVuZGVmaW5lZCIpIHsNCgkJbW9udGggPSB0aGlzLmdldE1vbnRoKCk7DQoJfQ0KCWlmICgoKDAgPT0gKHllYXIlNCkpICYmICggKDAgIT0gKHllYXIlMTAwKSkgfHwgKDAgPT0gKHllYXIlNDAwKSkpKSAmJiBtb250aCA9PSAxKSB7DQoJCXJldHVybiAyOTsNCgl9IGVsc2Ugew0KCQlyZXR1cm4gRGF0ZS5fTURbbW9udGhdOw0KCX0NCn07DQoNCi8qKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZGF5IGluIHRoZSB5ZWFyLiAqLw0KRGF0ZS5wcm90b3R5cGUuZ2V0RGF5T2ZZZWFyID0gZnVuY3Rpb24oKSB7DQoJdmFyIG5vdyA9IG5ldyBEYXRlKHRoaXMuZ2V0RnVsbFllYXIoKSwgdGhpcy5nZXRNb250aCgpLCB0aGlzLmdldERhdGUoKSwgMCwgMCwgMCk7DQoJdmFyIHRoZW4gPSBuZXcgRGF0ZSh0aGlzLmdldEZ1bGxZZWFyKCksIDAsIDAsIDAsIDAsIDApOw0KCXZhciB0aW1lID0gbm93IC0gdGhlbjsNCglyZXR1cm4gTWF0aC5mbG9vcih0aW1lIC8gRGF0ZS5EQVkpOw0KfTsNCg0KLyoqIFJldHVybnMgdGhlIG51bWJlciBvZiB0aGUgd2VlayBpbiB5ZWFyLCBhcyBkZWZpbmVkIGluIElTTyA4NjAxLiAqLw0KRGF0ZS5wcm90b3R5cGUuZ2V0V2Vla051bWJlciA9IGZ1bmN0aW9uKCkgew0KCXZhciBkID0gbmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLCB0aGlzLmdldE1vbnRoKCksIHRoaXMuZ2V0RGF0ZSgpLCAwLCAwLCAwKTsNCgl2YXIgRG9XID0gZC5nZXREYXkoKTsNCglkLnNldERhdGUoZC5nZXREYXRlKCkgLSAoRG9XICsgNikgJSA3ICsgMyk7IC8vIE5lYXJlc3QgVGh1DQoJdmFyIG1zID0gZC52YWx1ZU9mKCk7IC8vIEdNVA0KCWQuc2V0TW9udGgoMCk7DQoJZC5zZXREYXRlKDQpOyAvLyBUaHUgaW4gV2VlayAxDQoJcmV0dXJuIE1hdGgucm91bmQoKG1zIC0gZC52YWx1ZU9mKCkpIC8gKDcgKiA4NjRlNSkpICsgMTsNCn07DQoNCi8qKiBDaGVja3MgZGF0ZSBhbmQgdGltZSBlcXVhbGl0eSAqLw0KRGF0ZS5wcm90b3R5cGUuZXF1YWxzVG8gPSBmdW5jdGlvbihkYXRlKSB7DQoJcmV0dXJuICgodGhpcy5nZXRGdWxsWWVhcigpID09IGRhdGUuZ2V0RnVsbFllYXIoKSkgJiYNCgkJKHRoaXMuZ2V0TW9udGgoKSA9PSBkYXRlLmdldE1vbnRoKCkpICYmDQoJCSh0aGlzLmdldERhdGUoKSA9PSBkYXRlLmdldERhdGUoKSkgJiYNCgkJKHRoaXMuZ2V0SG91cnMoKSA9PSBkYXRlLmdldEhvdXJzKCkpICYmDQoJCSh0aGlzLmdldE1pbnV0ZXMoKSA9PSBkYXRlLmdldE1pbnV0ZXMoKSkpOw0KfTsNCg0KLyoqIFNldCBvbmx5IHRoZSB5ZWFyLCBtb250aCwgZGF0ZSBwYXJ0cyAoa2VlcCBleGlzdGluZyB0aW1lKSAqLw0KRGF0ZS5wcm90b3R5cGUuc2V0RGF0ZU9ubHkgPSBmdW5jdGlvbihkYXRlKSB7DQoJdmFyIHRtcCA9IG5ldyBEYXRlKGRhdGUpOw0KCXRoaXMuc2V0RGF0ZSgxKTsNCgl0aGlzLnNldEZ1bGxZZWFyKHRtcC5nZXRGdWxsWWVhcigpKTsNCgl0aGlzLnNldE1vbnRoKHRtcC5nZXRNb250aCgpKTsNCgl0aGlzLnNldERhdGUodG1wLmdldERhdGUoKSk7DQp9Ow0KDQovKiogUHJpbnRzIHRoZSBkYXRlIGluIGEgc3RyaW5nIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gZm9ybWF0LiAqLw0KRGF0ZS5wcm90b3R5cGUucHJpbnQgPSBmdW5jdGlvbiAoc3RyKSB7DQoJdmFyIG0gPSB0aGlzLmdldE1vbnRoKCk7DQoJdmFyIGQgPSB0aGlzLmdldERhdGUoKTsNCgl2YXIgeSA9IHRoaXMuZ2V0RnVsbFllYXIoKTsNCgl2YXIgd24gPSB0aGlzLmdldFdlZWtOdW1iZXIoKTsNCgl2YXIgdyA9IHRoaXMuZ2V0RGF5KCk7DQoJdmFyIHMgPSB7fTsNCgl2YXIgaHIgPSB0aGlzLmdldEhvdXJzKCk7DQoJdmFyIHBtID0gKGhyID49IDEyKTsNCgl2YXIgaXIgPSAocG0pID8gKGhyIC0gMTIpIDogaHI7DQoJdmFyIGR5ID0gdGhpcy5nZXREYXlPZlllYXIoKTsNCglpZiAoaXIgPT0gMCkgew0KCQlpciA9IDEyOw0KCX0NCgl2YXIgbWluID0gdGhpcy5nZXRNaW51dGVzKCk7DQoJdmFyIHNlYyA9IHRoaXMuZ2V0U2Vjb25kcygpOw0KCXNbIiVhIl0gPSBDYWxlbmRhci5fU0ROW3ddOyAvLyBhYmJyZXZpYXRlZCB3ZWVrZGF5IG5hbWUgW0ZJWE1FOiBJMThOXQ0KCXNbIiVBIl0gPSBDYWxlbmRhci5fRE5bd107IC8vIGZ1bGwgd2Vla2RheSBuYW1lDQoJc1siJWIiXSA9IENhbGVuZGFyLl9TTU5bbV07IC8vIGFiYnJldmlhdGVkIG1vbnRoIG5hbWUgW0ZJWE1FOiBJMThOXQ0KCXNbIiVCIl0gPSBDYWxlbmRhci5fTU5bbV07IC8vIGZ1bGwgbW9udGggbmFtZQ0KCS8vIEZJWE1FOiAlYyA6IHByZWZlcnJlZCBkYXRlIGFuZCB0aW1lIHJlcHJlc2VudGF0aW9uIGZvciB0aGUgY3VycmVudCBsb2NhbGUNCglzWyIlQyJdID0gMSArIE1hdGguZmxvb3IoeSAvIDEwMCk7IC8vIHRoZSBjZW50dXJ5IG51bWJlcg0KCXNbIiVkIl0gPSAoZCA8IDEwKSA/ICgiMCIgKyBkKSA6IGQ7IC8vIHRoZSBkYXkgb2YgdGhlIG1vbnRoIChyYW5nZSAwMSB0byAzMSkNCglzWyIlZSJdID0gZDsgLy8gdGhlIGRheSBvZiB0aGUgbW9udGggKHJhbmdlIDEgdG8gMzEpDQoJLy8gRklYTUU6ICVEIDogYW1lcmljYW4gZGF0ZSBzdHlsZTogJW0vJWQvJXkNCgkvLyBGSVhNRTogJUUsICVGLCAlRywgJWcsICVoIChtYW4gc3RyZnRpbWUpDQoJc1siJUgiXSA9IChociA8IDEwKSA/ICgiMCIgKyBocikgOiBocjsgLy8gaG91ciwgcmFuZ2UgMDAgdG8gMjMgKDI0aCBmb3JtYXQpDQoJc1siJUkiXSA9IChpciA8IDEwKSA/ICgiMCIgKyBpcikgOiBpcjsgLy8gaG91ciwgcmFuZ2UgMDEgdG8gMTIgKDEyaCBmb3JtYXQpDQoJc1siJWoiXSA9IChkeSA8IDEwMCkgPyAoKGR5IDwgMTApID8gKCIwMCIgKyBkeSkgOiAoIjAiICsgZHkpKSA6IGR5OyAvLyBkYXkgb2YgdGhlIHllYXIgKHJhbmdlIDAwMSB0byAzNjYpDQoJc1siJWsiXSA9IGhyOyAvLyBob3VyLCByYW5nZSAwIHRvIDIzICgyNGggZm9ybWF0KQ0KCXNbIiVsIl0gPSBpcjsgLy8gaG91ciwgcmFuZ2UgMSB0byAxMiAoMTJoIGZvcm1hdCkNCglzWyIlbSJdID0gKG0gPCA5KSA/ICgiMCIgKyAoMSttKSkgOiAoMSttKTsgLy8gbW9udGgsIHJhbmdlIDAxIHRvIDEyDQoJc1siJU0iXSA9IChtaW4gPCAxMCkgPyAoIjAiICsgbWluKSA6IG1pbjsgLy8gbWludXRlLCByYW5nZSAwMCB0byA1OQ0KCXNbIiVuIl0gPSAiXG4iOyAvLyBhIG5ld2xpbmUgY2hhcmFjdGVyDQoJc1siJXAiXSA9IHBtID8gIlBNIiA6ICJBTSI7DQoJc1siJVAiXSA9IHBtID8gInBtIiA6ICJhbSI7DQoJLy8gRklYTUU6ICVyIDogdGhlIHRpbWUgaW4gYW0vcG0gbm90YXRpb24gJUk6JU06JVMgJXANCgkvLyBGSVhNRTogJVIgOiB0aGUgdGltZSBpbiAyNC1ob3VyIG5vdGF0aW9uICVIOiVNDQoJc1siJXMiXSA9IE1hdGguZmxvb3IodGhpcy5nZXRUaW1lKCkgLyAxMDAwKTsNCglzWyIlUyJdID0gKHNlYyA8IDEwKSA/ICgiMCIgKyBzZWMpIDogc2VjOyAvLyBzZWNvbmRzLCByYW5nZSAwMCB0byA1OQ0KCXNbIiV0Il0gPSAiXHQiOyAvLyBhIHRhYiBjaGFyYWN0ZXINCgkvLyBGSVhNRTogJVQgOiB0aGUgdGltZSBpbiAyNC1ob3VyIG5vdGF0aW9uICglSDolTTolUykNCglzWyIlVSJdID0gc1siJVciXSA9IHNbIiVWIl0gPSAod24gPCAxMCkgPyAoIjAiICsgd24pIDogd247DQoJc1siJXUiXSA9IHcgKyAxOyAvLyB0aGUgZGF5IG9mIHRoZSB3ZWVrIChyYW5nZSAxIHRvIDcsIDEgPSBNT04pDQoJc1siJXciXSA9IHc7IC8vIHRoZSBkYXkgb2YgdGhlIHdlZWsgKHJhbmdlIDAgdG8gNiwgMCA9IFNVTikNCgkvLyBGSVhNRTogJXggOiBwcmVmZXJyZWQgZGF0ZSByZXByZXNlbnRhdGlvbiBmb3IgdGhlIGN1cnJlbnQgbG9jYWxlIHdpdGhvdXQgdGhlIHRpbWUNCgkvLyBGSVhNRTogJVggOiBwcmVmZXJyZWQgdGltZSByZXByZXNlbnRhdGlvbiBmb3IgdGhlIGN1cnJlbnQgbG9jYWxlIHdpdGhvdXQgdGhlIGRhdGUNCglzWyIleSJdID0gKCcnICsgeSkuc3Vic3RyKDIsIDIpOyAvLyB5ZWFyIHdpdGhvdXQgdGhlIGNlbnR1cnkgKHJhbmdlIDAwIHRvIDk5KQ0KCXNbIiVZIl0gPSB5OyAvLyB5ZWFyIHdpdGggdGhlIGNlbnR1cnkNCglzWyIlJSJdID0gIiUiOyAvLyBhIGxpdGVyYWwgJyUnIGNoYXJhY3Rlcg0KDQoJdmFyIHJlID0gLyUuL2c7DQoJaWYgKCFDYWxlbmRhci5pc19pZTUgJiYgIUNhbGVuZGFyLmlzX2todG1sKQ0KCQlyZXR1cm4gc3RyLnJlcGxhY2UocmUsIGZ1bmN0aW9uIChwYXIpIHsgcmV0dXJuIHNbcGFyXSB8fCBwYXI7IH0pOw0KDQoJdmFyIGEgPSBzdHIubWF0Y2gocmUpOw0KCWZvciAodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgew0KCQl2YXIgdG1wID0gc1thW2ldXTsNCgkJaWYgKHRtcCkgew0KCQkJcmUgPSBuZXcgUmVnRXhwKGFbaV0sICdnJyk7DQoJCQlzdHIgPSBzdHIucmVwbGFjZShyZSwgdG1wKTsNCgkJfQ0KCX0NCg0KCXJldHVybiBzdHI7DQp9Ow0KDQpEYXRlLnByb3RvdHlwZS5fX21zaF9vbGRTZXRGdWxsWWVhciA9IERhdGUucHJvdG90eXBlLnNldEZ1bGxZZWFyOw0KRGF0ZS5wcm90b3R5cGUuc2V0RnVsbFllYXIgPSBmdW5jdGlvbih5KSB7DQoJdmFyIGQgPSBuZXcgRGF0ZSh0aGlzKTsNCglkLl9fbXNoX29sZFNldEZ1bGxZZWFyKHkpOw0KCWlmIChkLmdldE1vbnRoKCkgIT0gdGhpcy5nZXRNb250aCgpKQ0KCQl0aGlzLnNldERhdGUoMjgpOw0KCXRoaXMuX19tc2hfb2xkU2V0RnVsbFllYXIoeSk7DQp9Ow0KDQovLyBFTkQ6IERBVEUgT0JKRUNUIFBBVENIRVMNCg0KLy8gZ2xvYmFsIG9iamVjdCB0aGF0IHJlbWVtYmVycyB0aGUgY2FsZW5kYXINCndpbmRvdy5fZHluYXJjaF9wb3B1cENhbGVuZGFyID0gbnVsbDsNCg0KdmFyIF9jYWxlbmRhckVsZW1lbnRBcnJheSA9IG5ldyBBcnJheSgxKTsNCnZhciBfb25lQ2xpY2tFbGVtZW50ID0gbnVsbDsNCg0KDQpmdW5jdGlvbiBzZXRFbGVtZW50Rm9yT25lQ2xpY2tFdmVudChzdHJFbGVtZW50SWQpIHsNCglfb25lQ2xpY2tFbGVtZW50ID0gc3RyRWxlbWVudElkOw0KfQ0KDQpmdW5jdGlvbiBhZGRDYWxlbmRhckVsZW1lbnRUb0FycmF5KHN0ckVsZW1lbnRJZCkgew0KCV9vbmVDbGlja0VsZW1lbnQgPSBzdHJFbGVtZW50SWQ7DQp9DQoNCmZ1bmN0aW9uIGdldEZvcm1JbnB1dE5hbWVGcm9tR2VuZXJhdGVkSW1hZ2VOYW1lKHN0ck5hbWUpIHsNCgl2YXIgcmV0ID0gbnVsbDsNCg0KCXZhciB0b01hdGNoU3RyID0gIl9fQ0FMXyI7DQoJdmFyIGxlbiA9IHRvTWF0Y2hTdHIubGVuZ3RoOw0KCXZhciByZXN1bHQgPSBzdHJOYW1lLmluZGV4T2YodG9NYXRjaFN0cik7DQoNCglpZihyZXN1bHQgPT0gMCkgew0KCQlyZXQgPSBzdHJOYW1lLnN1YnN0cmluZyhsZW4sIHN0ck5hbWUubGVuZ3RoKTsNCgl9DQoJcmV0dXJuIHJldDsNCn0NCg0KLy8gVmljdG9yOiBUaGlzIGZ1bmN0aW9uIGdldHMgY2FsbGVkIHdoZW4gdGhlIGVuZC11c2VyIGNsaWNrcyBvbiBzb21lIGRhdGUuDQovLyBCdWcgZml4OiBPTU5JMDAwMDM4ODYNCmZ1bmN0aW9uIHNlbGVjdGVkKGNhbCwgZGF0ZSkgew0KCWlmICgoY2FsLmRhdGVDbGlja2VkIHx8IGNhbC50b2RheUNsaWNrZWQpICYmIF9vbmVDbGlja0VsZW1lbnQgIT0gbnVsbCkgew0KCQkvLyBqdXN0IHVwZGF0ZSB0aGUgZGF0ZSBpbiB0aGUgaW5wdXQgZmllbGQNCgkJY2FsLnNlbC52YWx1ZSA9IGRhdGU7DQoJCWlmIChjYWwuZmlyZU9uQ2hhbmdlRXZlbnQgJiYgY2FsLnNlbCAvKiYmIGNhbC5zZWwub25jaGFuZ2UqLyApIHsgLy8gZmlyZSBvbmNoYW5nZSBldmVudA0KCQkJLy9jYWwuc2VsLm9uY2hhbmdlKCk7DQoJCQkvLyBCdWcgZml4OiBvbmNoYW5nZSgpIGRvZXMgbm90IGNhbGwgYWxsIGNoYW5nZSBldmVudHMgdGhhdCBtYXkgYmUgYXR0YWNoZWQgdG8gdGhlIGVsZW1lbnQgKGllLiBpZiBsaXN0ZW5lcnMgd2VyZSBhZGRlZCBieSBlbGVtLmF0dGFjaEV2ZW50KC4uLikgKS4NCgkJCS8vIFRoZSBwcm9wZXIgd2F5IHRvIGZpcmUgdGhpcyBldmVudCBpcyB0byBjcmVhdGUgYW4gRXZlbnRPYmplY3QgYW5kIGZpcmUgYW4gZXZlbnQgb24gdGhlIGVsZW1lbnQsIGxpa2U6DQoJCQkvLyAgICBlbGVtLmZpcmVFdmVudCgnb24nK2V2ZW50LGRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0KCkpOyAgT2YgY291cnNlLCB0aGlzIGlzIGRpZmZlcmVudCBmb3IgRkYgYW5kIG90aGVyIGJyb3dzZXJzLg0KCQkJaWYgKGZpcmVFdmVudCkgeyAvLyBhdmFpbGFibGUgaW4gY29tbW9uLXNjcmlwdHMuanMNCgkJCQlmaXJlRXZlbnQoY2FsLnNlbCwgJ2NoYW5nZScpOw0KCQkJfQ0KCQl9DQoJCWlmIChjYWwuZmlyZU9uQmx1ckV2ZW50ICYmIGNhbC5zZWwgJiYgY2FsLnNlbC5vbmJsdXIpIHsgLy8gZmlyZSBvbmJsdWUgZXZlbnQNCgkJCWNhbC5zZWwub25ibHVyKCk7DQoJCX0NCgkJaWYgKGNhbC5maXJlT25Gb2N1c0V2ZW50ICYmIGNhbC5zZWwgJiYgY2FsLnNlbC5vbmZvY3VzKSB7IC8vIGZpcmUgb25mb2N1cyBldmVudA0KCQkJY2FsLnNlbC5vbmZvY3VzKCk7DQoJCX0NCgkJaWYgKF9vbmVDbGlja0VsZW1lbnQgPT0gY2FsLnNlbC5pZCkgew0KCQkJY2FsLmNhbGxDbG9zZUhhbmRsZXIoKTsNCgkJfQ0KCX0NCn0NCg0KLy8gQW5kIHRoaXMgZ2V0cyBjYWxsZWQgd2hlbiB0aGUgZW5kLXVzZXIgY2xpY2tzIG9uIHRoZSBfc2VsZWN0ZWRfIGRhdGUsDQovLyBvciBjbGlja3Mgb24gdGhlICJDbG9zZSIgYnV0dG9uLiAgSXQganVzdCBoaWRlcyB0aGUgY2FsZW5kYXIgd2l0aG91dA0KLy8gZGVzdHJveWluZyBpdC4NCmZ1bmN0aW9uIGNsb3NlSGFuZGxlcihjYWwpIHsNCmNhbC5oaWRlKCk7ICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSB0aGUgY2FsZW5kYXINCl9keW5hcmNoX3BvcHVwQ2FsZW5kYXIgPSBudWxsOw0KLy9pZiAob25Gb3JtQ2hhbmdlQ2xpY2tFdmVudCkgew0KLy8Jb25Gb3JtQ2hhbmdlQ2xpY2tFdmVudCgpOw0KLy99DQp9DQoNCi8vIFRoaXMgZnVuY3Rpb24gc2hvd3MgdGhlIGNhbGVuZGFyIHVuZGVyIHRoZSBlbGVtZW50IGhhdmluZyB0aGUgZ2l2ZW4gaWQuDQovLyBJdCB0YWtlcyBjYXJlIG9mIGNhdGNoaW5nICJtb3VzZWRvd24iIHNpZ25hbHMgb24gZG9jdW1lbnQgYW5kIGhpZGluZyB0aGUNCi8vIGNhbGVuZGFyIGlmIHRoZSBjbGljayB3YXMgb3V0c2lkZS4NCmZ1bmN0aW9uIHNob3dDYWxlbmRhcihjYWxsZXJJZCwgZmlyZU9uQ2hhbmdlRXZlbnQsIGZpcmVPbkZvY3VzRXZlbnQsIGZpcmVPbkJsdXJFdmVudCwgY2FsbGJhY2tGdW5jdGlvbikgew0KdmFyIGZvcm1hdCA9ICclbS8lZC8lWSc7DQp2YXIgc2hvd3NUaW1lOw0KdmFyIHNob3dzT3RoZXJNb250aHMgPSB0cnVlOw0KDQp2YXIgc3RySW5wdXRJZCA9IGdldEZvcm1JbnB1dE5hbWVGcm9tR2VuZXJhdGVkSW1hZ2VOYW1lKGNhbGxlcklkKTsNCg0KaWYoc3RySW5wdXRJZCAhPSBudWxsKSB7DQoJCS8vIGFkZCB0aGUgaW5wdXQgSUQNCglzZXRFbGVtZW50Rm9yT25lQ2xpY2tFdmVudChzdHJJbnB1dElkKTsNCg0KCXZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHN0cklucHV0SWQpOw0KCXZhciBjYWxsZXJFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FsbGVySWQpOw0KCXZhciBfZmlyZU9uQ2hhbmdlRXZlbnQgPSBmYWxzZTsvLyBmaXJlIG9uY2hhbmdlIGV2ZW50IG9uIHRoZSBpbnB1dCBmaWVsZA0KCXZhciBfZmlyZU9uQmx1ckV2ZW50ID0gZmFsc2U7IC8vIGZpcmUgb25ibHVyIGV2ZW50IG9uIHRoZSBpbnB1dCBmaWVsZA0KCXZhciBfZmlyZU9uRm9jdXNFdmVudCA9IGZhbHNlOyAvLyBmaXJlIG9uZm9jdXMgZXZlbnQgb24gdGhlIGlucHV0IGZpZWxkDQoJaWYoZmlyZU9uQ2hhbmdlRXZlbnQpIHsNCgkJCV9maXJlT25DaGFuZ2VFdmVudCA9IHRydWU7DQoJfQ0KCWlmKGZpcmVPbkJsdXJFdmVudCkgew0KCQkJX2ZpcmVPbkJsdXJFdmVudCA9IHRydWU7DQoJfQ0KCWlmKGZpcmVPbkZvY3VzRXZlbnQpIHsNCgkJCV9maXJlT25Gb2N1c0V2ZW50ID0gdHJ1ZTsNCgl9DQoNCglpZihlbCAhPSBudWxsICYmIGNhbGxlckVsZW1lbnQgIT0gbnVsbCkgew0KCQlpZiAoX2R5bmFyY2hfcG9wdXBDYWxlbmRhciAhPSBudWxsKSB7DQoJCQkvLyB3ZSBhbHJlYWR5IGhhdmUgc29tZSBjYWxlbmRhciBjcmVhdGVkDQoJCQlfZHluYXJjaF9wb3B1cENhbGVuZGFyLmhpZGUoKTsgLy8gc28gd2UgaGlkZSBpdCBmaXJzdC4NCgkJfSBlbHNlIHsNCgkJCS8vIGZpcnN0LXRpbWUgY2FsbCwgY3JlYXRlIHRoZSBjYWxlbmRhci4NCgkJCS8vIEJ1ZyBmaXg6IE9NTkkwMDAwMzE5NzsgY2hhbmdlIHN0YXJ0IG9mIHdlZWsgdG8gU3VuZGF5DQoJCQl2YXIgY2FsID0gbmV3IENhbGVuZGFyKDAsIG51bGwsIHNlbGVjdGVkLCBmdW5jdGlvbiAoKSB7Y2xvc2VIYW5kbGVyKHRoaXMpOyBpZiAoY2FsbGJhY2tGdW5jdGlvbikgY2FsbGJhY2tGdW5jdGlvbigpO30pOw0KCQkJLy8gdW5jb21tZW50IHRoZSBmb2xsb3dpbmcgbGluZSB0byBoaWRlIHRoZSB3ZWVrIG51bWJlcnMNCgkJCWNhbC53ZWVrTnVtYmVycyA9IGZhbHNlOw0KCQkJaWYgKHR5cGVvZiBzaG93c1RpbWUgPT0gInN0cmluZyIpIHsNCgkJCWNhbC5zaG93c1RpbWUgPSB0cnVlOw0KCQkJY2FsLnRpbWUyNCA9IChzaG93c1RpbWUgPT0gIjI0Iik7DQoJCQl9DQoJCQlpZiAoc2hvd3NPdGhlck1vbnRocykgew0KCQkJY2FsLnNob3dzT3RoZXJNb250aHMgPSB0cnVlOw0KCQkJfQ0KCQkJX2R5bmFyY2hfcG9wdXBDYWxlbmRhciA9IGNhbDsgLy8gcmVtZW1iZXIgaXQgaW4gdGhlIGdsb2JhbCB2YXINCgkJCS8vIEJ1ZyBmaXg6IE9NTkkwMDAwMzIxNw0KCQkJY2FsLnNldFJhbmdlKDEwMDAsIDk5OTkpOyAvLyBtaW4vbWF4IHllYXIgYWxsb3dlZC4NCg0KCQkJdmFyIGFkanVzdFggPSBnZXRUZW1wbGF0ZUFkanVzdG1lbnQoKTsNCgkJCWNhbC5zZXRBZGp1c3RtZW50UG9zaXRpb24oYWRqdXN0WCwgMCk7DQoNCgkJCXZhciBkaW1lbnNpb24gPSBnZXREb2N1bWVudERpbWVuc2lvbigpOw0KCQkJY2FsLnNldFBhcmVudERvY3VtZW50RGltZW5zaW9ucyhkaW1lbnNpb24ud2lkdGgsIGRpbWVuc2lvbi5oZWlnaHQpOw0KDQoJCQljYWwuY3JlYXRlKCk7DQoJCX0NCgkJX2R5bmFyY2hfcG9wdXBDYWxlbmRhci5zZXREYXRlRm9ybWF0KGZvcm1hdCk7ICAgIC8vIHNldCB0aGUgc3BlY2lmaWVkIGRhdGUgZm9ybWF0DQoJCV9keW5hcmNoX3BvcHVwQ2FsZW5kYXIucGFyc2VEYXRlKGVsLnZhbHVlKTsgICAgICAvLyB0cnkgdG8gcGFyc2UgdGhlIHRleHQgaW4gZmllbGQNCgkJX2R5bmFyY2hfcG9wdXBDYWxlbmRhci5zZWwgPSBlbDsgICAgICAgICAgICAgICAgIC8vIGluZm9ybSBpdCB3aGF0IGlucHV0IGZpZWxkIHdlIHVzZQ0KCQlfZHluYXJjaF9wb3B1cENhbGVuZGFyLmZpcmVPbkNoYW5nZUV2ZW50ID0gX2ZpcmVPbkNoYW5nZUV2ZW50Oy8vIGZpcmUgb25jaGFuZ2UgZXZlbnQgb24gdGhlIGlucHV0IGZpZWxkDQoJCV9keW5hcmNoX3BvcHVwQ2FsZW5kYXIuZmlyZU9uQmx1ckV2ZW50ID0gX2ZpcmVPbkJsdXJFdmVudDsgIC8vIGZpcmUgb25ibHVyIGV2ZW50IG9uIHRoZSBpbnB1dCBmaWVsZA0KCQlfZHluYXJjaF9wb3B1cENhbGVuZGFyLmZpcmVPbkZvY3VzRXZlbnQgPSBfZmlyZU9uRm9jdXNFdmVudDsgLy8gZmlyZSBvbmZvY3VzIGV2ZW50IG9uIHRoZSBpbnB1dCBmaWVsZA0KDQoJCXZhciB2aWV3cG9ydCA9IGdldFZpZXdwb3J0KCk7DQoJCV9keW5hcmNoX3BvcHVwQ2FsZW5kYXIuc2V0Vmlld3BvcnQodmlld3BvcnQubGVmdCwgdmlld3BvcnQudG9wLCB2aWV3cG9ydC53aWR0aCwgdmlld3BvcnQuaGVpZ2h0KTsNCgkJX2R5bmFyY2hfcG9wdXBDYWxlbmRhci5zaG93QXRFbGVtZW50KGNhbGxlckVsZW1lbnQpOyAvLyBzZXQgdGhlIHBvc2l0aW9uDQoNCgl9DQp9DQpyZXR1cm4gZmFsc2U7DQp9DQoNCmZ1bmN0aW9uIHNob3dDYWxlbmRhcldpdGhUaW1lKGNhbGxlcklkLCBmaXJlT25DaGFuZ2VFdmVudCwgZmlyZU9uRm9jdXNFdmVudCwgZmlyZU9uQmx1ckV2ZW50LCBjYWxsYmFja0Z1bmN0aW9uKSB7DQoJcmV0dXJuIHNob3dDYWxlbmRhcldpdGhUaW1lKGNhbGxlcklkLCBmYWxzZSwgZmlyZU9uQ2hhbmdlRXZlbnQsIGZpcmVPbkZvY3VzRXZlbnQsIGZpcmVPbkJsdXJFdmVudCwgY2FsbGJhY2tGdW5jdGlvbik7DQp9DQoNCmZ1bmN0aW9uIHNob3dDYWxlbmRhcldpdGhUaW1lKGNhbGxlcklkLCBleGNsdWRlU2Vjb25kcywgZmlyZU9uQ2hhbmdlRXZlbnQsIGZpcmVPbkZvY3VzRXZlbnQsIGZpcmVPbkJsdXJFdmVudCwgY2FsbGJhY2tGdW5jdGlvbikgew0KdmFyIGZvcm1hdCA9IChleGNsdWRlU2Vjb25kcyA/ICclbS8lZC8lWSAlSDolTScgOiAnJW0vJWQvJVkgJUg6JU06JVMnKTsNCnZhciBzaG93c1RpbWUgPSAiMjQiOw0KdmFyIHNob3dzT3RoZXJNb250aHMgPSB0cnVlOw0KDQp2YXIgc3RySW5wdXRJZCA9IGdldEZvcm1JbnB1dE5hbWVGcm9tR2VuZXJhdGVkSW1hZ2VOYW1lKGNhbGxlcklkKTsNCnZhciBfZmlyZU9uQ2hhbmdlRXZlbnQgPSBmYWxzZTsvLyBmaXJlIG9uY2hhbmdlIGV2ZW50IG9uIHRoZSBpbnB1dCBmaWVsZA0KdmFyIF9maXJlT25CbHVyRXZlbnQgPSBmYWxzZTsgIC8vIGZpcmUgb25ibHVyIGV2ZW50IG9uIHRoZSBpbnB1dCBmaWVsZA0KdmFyIF9maXJlT25Gb2N1c0V2ZW50ID0gZmFsc2U7IC8vIGZpcmUgb25mb2N1cyBldmVudCBvbiB0aGUgaW5wdXQgZmllbGQNCmlmKGZpcmVPbkNoYW5nZUV2ZW50KSB7DQoJX2ZpcmVPbkNoYW5nZUV2ZW50ID0gdHJ1ZTsNCn0NCmlmKGZpcmVPbkJsdXJFdmVudCkgew0KCV9maXJlT25CbHVyRXZlbnQgPSB0cnVlOw0KfQ0KaWYoZmlyZU9uRm9jdXNFdmVudCkgew0KCV9maXJlT25Gb2N1c0V2ZW50ID0gdHJ1ZTsNCn0NCg0KaWYoc3RySW5wdXRJZCAhPSBudWxsKSB7DQoJLy8gYWRkIHRoZSBpbnB1dCBJRA0KCXNldEVsZW1lbnRGb3JPbmVDbGlja0V2ZW50KHN0cklucHV0SWQpOw0KDQoJdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3RySW5wdXRJZCk7DQoJdmFyIGNhbGxlckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYWxsZXJJZCk7DQoNCglpZihlbCAhPSBudWxsICYmIGNhbGxlckVsZW1lbnQgIT0gbnVsbCkgew0KCQlpZiAoX2R5bmFyY2hfcG9wdXBDYWxlbmRhciAhPSBudWxsKSB7DQoJCQkvLyB3ZSBhbHJlYWR5IGhhdmUgc29tZSBjYWxlbmRhciBjcmVhdGVkLCBzbyB3ZSBoaWRlIGl0IGZpcnN0DQoJCQlfZHluYXJjaF9wb3B1cENhbGVuZGFyLmhpZGUoKTsNCgkJfSBlbHNlIHsNCgkJCS8vIGZpcnN0LXRpbWUgY2FsbCwgY3JlYXRlIHRoZSBjYWxlbmRhci4NCgkJCS8vIEJ1ZyBmaXg6IE9NTkkwMDAwMzE5NzsgY2hhbmdlIHN0YXJ0IG9mIHdlZWsgdG8gU3VuZGF5DQoJCQl2YXIgY2FsID0gbmV3IENhbGVuZGFyKDAsIG51bGwsIHNlbGVjdGVkLCBmdW5jdGlvbiAoKSB7Y2xvc2VIYW5kbGVyKHRoaXMpOyBpZiAoY2FsbGJhY2tGdW5jdGlvbikgY2FsbGJhY2tGdW5jdGlvbigpO30pOw0KCQkJLy8gdW5jb21tZW50IHRoZSBmb2xsb3dpbmcgbGluZSB0byBoaWRlIHRoZSB3ZWVrIG51bWJlcnMNCgkJCWNhbC53ZWVrTnVtYmVycyA9IGZhbHNlOw0KCQkJaWYgKHR5cGVvZiBzaG93c1RpbWUgPT0gInN0cmluZyIpIHsNCgkJCWNhbC5zaG93c1RpbWUgPSB0cnVlOw0KCQkJY2FsLnRpbWUyNCA9IChzaG93c1RpbWUgPT0gIjI0Iik7DQoJCQl9DQoJCQlpZiAoc2hvd3NPdGhlck1vbnRocykgew0KCQkJCWNhbC5zaG93c090aGVyTW9udGhzID0gdHJ1ZTsNCgkJCX0NCgkJCS8vIHJlbWVtYmVyIGl0IGluIHRoZSBnbG9iYWwgdmFyDQoJCQlfZHluYXJjaF9wb3B1cENhbGVuZGFyID0gY2FsOw0KCQkJLy8gQnVnIGZpeDogT01OSTAwMDAzMjE3DQoJCQljYWwuc2V0UmFuZ2UoMTAwMCwgOTk5OSk7IC8vIG1pbi9tYXggeWVhciBhbGxvd2VkLg0KDQoJCQl2YXIgYWRqdXN0WCA9IGdldFRlbXBsYXRlQWRqdXN0bWVudCgpOw0KCQkJY2FsLnNldEFkanVzdG1lbnRQb3NpdGlvbihhZGp1c3RYLCAwKTsNCg0KCQkJdmFyIGRpbWVuc2lvbiA9IGdldERvY3VtZW50RGltZW5zaW9uKCk7DQoJCQljYWwuc2V0UGFyZW50RG9jdW1lbnREaW1lbnNpb25zKGRpbWVuc2lvbi53aWR0aCwgZGltZW5zaW9uLmhlaWdodCk7DQoNCgkJCWNhbC5jcmVhdGUoKTsNCgkJfQ0KCQkvLyBzZXQgdGhlIHNwZWNpZmllZCBkYXRlIGZvcm1hdA0KCQlfZHluYXJjaF9wb3B1cENhbGVuZGFyLnNldERhdGVGb3JtYXQoZm9ybWF0KTsNCgkJLy8gdHJ5IHRvIHBhcnNlIHRoZSB0ZXh0IGluIGZpZWxkDQoJCV9keW5hcmNoX3BvcHVwQ2FsZW5kYXIucGFyc2VEYXRlKGVsLnZhbHVlKTsNCgkJLy8gaW5mb3JtIGl0IHdoYXQgaW5wdXQgZmllbGQgd2UgdXNlDQoJCV9keW5hcmNoX3BvcHVwQ2FsZW5kYXIuc2VsID0gZWw7DQoJCS8vIGZpcmUgb25jaGFuZ2UgZXZlbnQgb24gdGhlIGlucHV0IGZpZWxkDQoJCV9keW5hcmNoX3BvcHVwQ2FsZW5kYXIuZmlyZU9uQ2hhbmdlRXZlbnQgPSBfZmlyZU9uQ2hhbmdlRXZlbnQ7DQoJCS8vIGZpcmUgb25ibHVyIGV2ZW50IG9uIHRoZSBpbnB1dCBmaWVsZA0KCQlfZHluYXJjaF9wb3B1cENhbGVuZGFyLmZpcmVPbkJsdXJFdmVudCA9IF9maXJlT25CbHVyRXZlbnQ7DQoJCS8vIGZpcmUgb25mb2N1cyBldmVudCBvbiB0aGUgaW5wdXQgZmllbGQNCgkJX2R5bmFyY2hfcG9wdXBDYWxlbmRhci5maXJlT25Gb2N1c0V2ZW50ID0gX2ZpcmVPbkZvY3VzRXZlbnQ7DQoNCgkJdmFyIHZpZXdwb3J0ID0gZ2V0Vmlld3BvcnQoKTsNCgkJX2R5bmFyY2hfcG9wdXBDYWxlbmRhci5zZXRWaWV3cG9ydCh2aWV3cG9ydC5sZWZ0LCB2aWV3cG9ydC50b3AsIHZpZXdwb3J0LndpZHRoLCB2aWV3cG9ydC5oZWlnaHQpOw0KCQkvLyBzZXQgdGhlIHBvc2l0aW9uDQoJCV9keW5hcmNoX3BvcHVwQ2FsZW5kYXIuc2hvd0F0RWxlbWVudChjYWxsZXJFbGVtZW50KTsNCg0KCX0NCn0NCnJldHVybiBmYWxzZTsNCn0NCg0KDQpmdW5jdGlvbiBnZXREb2N1bWVudERpbWVuc2lvbigpIHsNCgl2YXIgdyA9IDA7DQoJdmFyIGggPSAwOw0KDQoJaWYoZG9jdW1lbnQuYm9keSkgew0KCQlpZihkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoICYmIGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0KSB7DQoJCQl3ICA9IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7DQoJCQloID0gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQ7DQoJCX0NCgl9DQoJcmV0dXJuIHt3aWR0aDp3LCBoZWlnaHQ6aH07DQp9DQoNCmZ1bmN0aW9uIGdldFZpZXdwb3J0KCkgew0KCXZhciB4LHksdyxoOw0KCWlmIChzZWxmLnBhZ2VZT2Zmc2V0KSB7IC8vIGFsbCBleGNlcHQgRXhwbG9yZXINCgkJeCA9IHNlbGYucGFnZVhPZmZzZXQ7DQoJCXkgPSBzZWxmLnBhZ2VZT2Zmc2V0Ow0KCQl3ID0gc2VsZi5pbm5lcldpZHRoOw0KCQloID0gc2VsZi5pbm5lckhlaWdodDsNCgl9IGVsc2UgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wKSB7IC8vIEV4cGxvcmVyIDYgU3RyaWN0DQoNCgkJeCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0Ow0KCQl5ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDsNCgkJdyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDsNCgkJaCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7DQoJfSBlbHNlIGlmIChkb2N1bWVudC5ib2R5KSB7IC8vIGFsbCBvdGhlciBFeHBsb3JlcnMNCgkJeCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDsNCgkJeSA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wOw0KCQl3ID0gZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDsNCgkJaCA9IGRvY3VtZW50LmJvZHkuY2xpZW50SGVpZ2h0Ow0KCX0NCglyZXR1cm4ge2xlZnQ6eCx0b3A6eSx3aWR0aDp3LGhlaWdodDpofTsNCn0NCg0KZnVuY3Rpb24gZ2V0VGVtcGxhdGVBZGp1c3RtZW50KCkgew0KCXZhciB4ID0gMDsNCg0KCXZhciBpZE1haW5MZWZ0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpZC1tYWluLWxlZnQnKTsNCglpZihpZE1haW5MZWZ0RWxlbWVudCAhPSB1bmRlZmluZWQgJiYgaWRNYWluTGVmdEVsZW1lbnQudGFnTmFtZSAhPSB1bmRlZmluZWQpIHsNCgkJLy9DUTE2MzY2IC0gb25seSBhZGp1c3QgdGhlIHdpZHRoIGlmIElFIHZlcnNpb24gaXMgNyBvciBsZXNzDQoJCWlmKG1zaWV2ZXJzaW9uKCkgPD0gNyAgJiYgbXNpZXZlcnNpb24oKSAhPSAwKXsNCgkJCXggLT0gX09NTklNZW51V2lkdGg7DQoJCX0NCgl9DQoJcmV0dXJuIHg7DQp9DQpmdW5jdGlvbiBtc2lldmVyc2lvbigpew0KICAgICAgdmFyIHVhID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQNCiAgICAgIHZhciBtc2llID0gdWEuaW5kZXhPZiAoICJNU0lFICIgKQ0KDQogICAgICBpZiAoIG1zaWUgPiAwICkgICAgICAvLyBJZiBJbnRlcm5ldCBFeHBsb3JlciwgcmV0dXJuIHZlcnNpb24gbnVtYmVyDQogICAgICAgICByZXR1cm4gcGFyc2VJbnQgKHVhLnN1YnN0cmluZyAobXNpZSs1LCB1YS5pbmRleE9mICgiLiIsIG1zaWUgKSkpDQogICAgICBlbHNlICAgICAgICAgICAgICAgICAvLyBJZiBhbm90aGVyIGJyb3dzZXIsIHJldHVybiAwDQogICAgICAgICByZXR1cm4gMA0KDQogICB9DQo=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 310,
          "bodySize": 85388
        },
        "cache": {},
        "timings": {
          "send": 6,
          "wait": 0,
          "receive": 86
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8636"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 59,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/calendar-en.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 359,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1893"
            }
          ],
          "content": {
            "size": 4924,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "Ly8gKiogSTE4Tg0KDQovLyBDYWxlbmRhciBFTiBsYW5ndWFnZQ0KLy8gQXV0aG9yOiBNaWhhaSBCYXpvbiwgPG1paGFpX2Jhem9uQHlhaG9vLmNvbT4NCi8vIEVuY29kaW5nOiBhbnkNCi8vIERpc3RyaWJ1dGVkIHVuZGVyIHRoZSBzYW1lIHRlcm1zIGFzIHRoZSBjYWxlbmRhciBpdHNlbGYuDQoNCi8vIEZvciB0cmFuc2xhdG9yczogcGxlYXNlIHVzZSBVVEYtOCBpZiBwb3NzaWJsZS4gIFdlIHN0cm9uZ2x5IGJlbGlldmUgdGhhdA0KLy8gVW5pY29kZSBpcyB0aGUgYW5zd2VyIHRvIGEgcmVhbCBpbnRlcm5hdGlvbmFsaXplZCB3b3JsZC4gIEFsc28gcGxlYXNlDQovLyBpbmNsdWRlIHlvdXIgY29udGFjdCBpbmZvcm1hdGlvbiBpbiB0aGUgaGVhZGVyLCBhcyBjYW4gYmUgc2VlbiBhYm92ZS4NCg0KLy8gZnVsbCBkYXkgbmFtZXMNCkNhbGVuZGFyLl9ETiA9IG5ldyBBcnJheQ0KKCJTdW5kYXkiLA0KIk1vbmRheSIsDQoiVHVlc2RheSIsDQoiV2VkbmVzZGF5IiwNCiJUaHVyc2RheSIsDQoiRnJpZGF5IiwNCiJTYXR1cmRheSIsDQoiU3VuZGF5Iik7DQoNCi8vIFBsZWFzZSBub3RlIHRoYXQgdGhlIGZvbGxvd2luZyBhcnJheSBvZiBzaG9ydCBkYXkgbmFtZXMgKGFuZCB0aGUgc2FtZSBnb2VzDQovLyBmb3Igc2hvcnQgbW9udGggbmFtZXMsIF9TTU4pIGlzbid0IGFic29sdXRlbHkgbmVjZXNzYXJ5LiAgV2UgZ2l2ZSBpdCBoZXJlDQovLyBmb3IgZXhlbXBsaWZpY2F0aW9uIG9uIGhvdyBvbmUgY2FuIGN1c3RvbWl6ZSB0aGUgc2hvcnQgZGF5IG5hbWVzLCBidXQgaWYNCi8vIHRoZXkgYXJlIHNpbXBseSB0aGUgZmlyc3QgTiBsZXR0ZXJzIG9mIHRoZSBmdWxsIG5hbWUgeW91IGNhbiBzaW1wbHkgc2F5Og0KLy8NCi8vICAgQ2FsZW5kYXIuX1NETl9sZW4gPSBOOyAvLyBzaG9ydCBkYXkgbmFtZSBsZW5ndGgNCi8vICAgQ2FsZW5kYXIuX1NNTl9sZW4gPSBOOyAvLyBzaG9ydCBtb250aCBuYW1lIGxlbmd0aA0KLy8NCi8vIElmIE4gPSAzIHRoZW4gdGhpcyBpcyBub3QgbmVlZGVkIGVpdGhlciBzaW5jZSB3ZSBhc3N1bWUgYSB2YWx1ZSBvZiAzIGlmIG5vdA0KLy8gcHJlc2VudCwgdG8gYmUgY29tcGF0aWJsZSB3aXRoIHRyYW5zbGF0aW9uIGZpbGVzIHRoYXQgd2VyZSB3cml0dGVuIGJlZm9yZQ0KLy8gdGhpcyBmZWF0dXJlLg0KDQovLyBzaG9ydCBkYXkgbmFtZXMNCkNhbGVuZGFyLl9TRE4gPSBuZXcgQXJyYXkNCigiU3VuIiwNCiJNb24iLA0KIlR1ZSIsDQoiV2VkIiwNCiJUaHUiLA0KIkZyaSIsDQoiU2F0IiwNCiJTdW4iKTsNCg0KLy8gRmlyc3QgZGF5IG9mIHRoZSB3ZWVrLiAiMCIgbWVhbnMgZGlzcGxheSBTdW5kYXkgZmlyc3QsICIxIiBtZWFucyBkaXNwbGF5DQovLyBNb25kYXkgZmlyc3QsIGV0Yy4NCkNhbGVuZGFyLl9GRCA9IDA7DQoNCi8vIGZ1bGwgbW9udGggbmFtZXMNCkNhbGVuZGFyLl9NTiA9IG5ldyBBcnJheQ0KKCJKYW51YXJ5IiwNCiJGZWJydWFyeSIsDQoiTWFyY2giLA0KIkFwcmlsIiwNCiJNYXkiLA0KIkp1bmUiLA0KIkp1bHkiLA0KIkF1Z3VzdCIsDQoiU2VwdGVtYmVyIiwNCiJPY3RvYmVyIiwNCiJOb3ZlbWJlciIsDQoiRGVjZW1iZXIiKTsNCg0KLy8gc2hvcnQgbW9udGggbmFtZXMNCkNhbGVuZGFyLl9TTU4gPSBuZXcgQXJyYXkNCigiSmFuIiwNCiJGZWIiLA0KIk1hciIsDQoiQXByIiwNCiJNYXkiLA0KIkp1biIsDQoiSnVsIiwNCiJBdWciLA0KIlNlcCIsDQoiT2N0IiwNCiJOb3YiLA0KIkRlYyIpOw0KDQovLyB0b29sdGlwcw0KQ2FsZW5kYXIuX1RUID0ge307DQpDYWxlbmRhci5fVFRbIklORk8iXSA9ICJBYm91dCB0aGUgY2FsZW5kYXIiOw0KDQpDYWxlbmRhci5fVFRbIkFCT1VUIl0gPQ0KIkRIVE1MIERhdGUvVGltZSBTZWxlY3RvclxuIiArDQoiKGMpIGR5bmFyY2guY29tIDIwMDItMjAwNSAvIEF1dGhvcjogTWloYWkgQmF6b25cbiIgKyAvLyBkb24ndCB0cmFuc2xhdGUgdGhpcyB0aGlzIDstKQ0KIkZvciBsYXRlc3QgdmVyc2lvbiB2aXNpdDogaHR0cDovL3d3dy5keW5hcmNoLmNvbS9wcm9qZWN0cy9jYWxlbmRhci9cbiIgKw0KIkRpc3RyaWJ1dGVkIHVuZGVyIEdOVSBMR1BMLiAgU2VlIGh0dHA6Ly9nbnUub3JnL2xpY2Vuc2VzL2xncGwuaHRtbCBmb3IgZGV0YWlscy4iICsNCiJcblxuIiArDQoiRGF0ZSBzZWxlY3Rpb246XG4iICsNCiItIFVzZSB0aGUgXHhhYiwgXHhiYiBidXR0b25zIHRvIHNlbGVjdCB5ZWFyXG4iICsNCiItIFVzZSB0aGUgIiArIFN0cmluZy5mcm9tQ2hhckNvZGUoMHgyMDM5KSArICIsICIgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4MjAzYSkgKyAiIGJ1dHRvbnMgdG8gc2VsZWN0IG1vbnRoXG4iICsNCiItIEhvbGQgbW91c2UgYnV0dG9uIG9uIGFueSBvZiB0aGUgYWJvdmUgYnV0dG9ucyBmb3IgZmFzdGVyIHNlbGVjdGlvbi4iOw0KQ2FsZW5kYXIuX1RUWyJBQk9VVF9USU1FIl0gPSAiXG5cbiIgKw0KIlRpbWUgc2VsZWN0aW9uOlxuIiArDQoiLSBDbGljayBvbiBhbnkgb2YgdGhlIHRpbWUgcGFydHMgdG8gaW5jcmVhc2UgaXRcbiIgKw0KIi0gb3IgU2hpZnQtY2xpY2sgdG8gZGVjcmVhc2UgaXRcbiIgKw0KIi0gb3IgY2xpY2sgYW5kIGRyYWcgZm9yIGZhc3RlciBzZWxlY3Rpb24uIjsNCg0KQ2FsZW5kYXIuX1RUWyJQUkVWX1lFQVIiXSA9ICJQcmV2LiB5ZWFyIChob2xkIGZvciBtZW51KSI7DQpDYWxlbmRhci5fVFRbIlBSRVZfTU9OVEgiXSA9ICJQcmV2LiBtb250aCAoaG9sZCBmb3IgbWVudSkiOw0KQ2FsZW5kYXIuX1RUWyJHT19UT0RBWSJdID0gIkdvIFRvZGF5IjsNCkNhbGVuZGFyLl9UVFsiTkVYVF9NT05USCJdID0gIk5leHQgbW9udGggKGhvbGQgZm9yIG1lbnUpIjsNCkNhbGVuZGFyLl9UVFsiTkVYVF9ZRUFSIl0gPSAiTmV4dCB5ZWFyIChob2xkIGZvciBtZW51KSI7DQpDYWxlbmRhci5fVFRbIlNFTF9EQVRFIl0gPSAiU2VsZWN0IGRhdGUiOw0KQ2FsZW5kYXIuX1RUWyJEUkFHX1RPX01PVkUiXSA9ICJEcmFnIHRvIG1vdmUiOw0KQ2FsZW5kYXIuX1RUWyJQQVJUX1RPREFZIl0gPSAiICh0b2RheSkiOw0KDQovLyB0aGUgZm9sbG93aW5nIGlzIHRvIGluZm9ybSB0aGF0ICIlcyIgaXMgdG8gYmUgdGhlIGZpcnN0IGRheSBvZiB3ZWVrDQovLyAlcyB3aWxsIGJlIHJlcGxhY2VkIHdpdGggdGhlIGRheSBuYW1lLg0KQ2FsZW5kYXIuX1RUWyJEQVlfRklSU1QiXSA9ICJEaXNwbGF5ICVzIGZpcnN0IjsNCg0KLy8gVGhpcyBtYXkgYmUgbG9jYWxlLWRlcGVuZGVudC4gIEl0IHNwZWNpZmllcyB0aGUgd2Vlay1lbmQgZGF5cywgYXMgYW4gYXJyYXkNCi8vIG9mIGNvbW1hLXNlcGFyYXRlZCBudW1iZXJzLiAgVGhlIG51bWJlcnMgYXJlIGZyb20gMCB0byA2OiAwIG1lYW5zIFN1bmRheSwgMQ0KLy8gbWVhbnMgTW9uZGF5LCBldGMuDQpDYWxlbmRhci5fVFRbIldFRUtFTkQiXSA9ICIwLDYiOw0KDQpDYWxlbmRhci5fVFRbIkNMT1NFIl0gPSAiQ2xvc2UiOw0KQ2FsZW5kYXIuX1RUWyJUT0RBWSJdID0gIlRvZGF5IjsNCkNhbGVuZGFyLl9UVFsiVElNRV9QQVJUIl0gPSAiKFNoaWZ0LSlDbGljayBvciBkcmFnIHRvIGNoYW5nZSB2YWx1ZSI7DQoNCi8vIGRhdGUgZm9ybWF0cw0KQ2FsZW5kYXIuX1RUWyJERUZfREFURV9GT1JNQVQiXSA9ICIlWS0lbS0lZCI7DQpDYWxlbmRhci5fVFRbIlRUX0RBVEVfRk9STUFUIl0gPSAiJWEsICViICVlIjsNCg0KQ2FsZW5kYXIuX1RUWyJXSyJdID0gIndrIjsNCkNhbGVuZGFyLl9UVFsiVElNRSJdID0gIlRpbWU6IjsNCg==",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 309,
          "bodySize": 4924
        },
        "cache": {},
        "timings": {
          "send": 4,
          "wait": 0,
          "receive": 5
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8638"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 107,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/collapsible.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 359,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "480"
            }
          ],
          "content": {
            "size": 1423,
            "compression": 0,
            "mimeType": "text/css",
            "text": "\r\n.collapsible-header {\r\n\tpadding: 4px 5px;\r\n}\r\n\r\n.collapsible-header-icon, .collapsible-icon {\r\n\theight: 15px;\r\n\twidth: 15px;\r\n\tbackground-position: right center;\r\n\tbackground-repeat: no-repeat;\r\n\tfloat: right;\r\n\tcursor: pointer;\r\n}\r\n\r\n.collapsible-header-icon-minus, .collapsible-icon.expanded {\r\n\tbackground-image: url('../images/buttons/button-minus-15pt.gif');\r\n}\r\n\r\n.collapsible-header-icon-plus, .collapsible-icon.collapsed {\r\n\tbackground-image: url('../images/buttons/button-plus-15pt.gif');\r\n}\r\n\r\n.collapsible-header-hover {\r\n\tbackground-color: #B8B885;\r\n}\r\n\r\n.collapsible h3.disabled {\r\n\tbackground-color: #DEDAD2;\r\n}\r\n\r\n.collapsible-header-icon.disabled, \r\n.collapsible-icon.expanded.disabled, \r\n.collapsible-icon.collapsed.disabled {\r\n\tbackground-image: url('../images/buttons/button-plus-gray.gif');\r\n\tcursor: auto;\r\n}\r\n\r\n.collapsible .disabled .collapsible-header-icon-minus {\r\n\tbackground-image: url('../images/buttons/button-minus-gray.gif');\r\n}\r\n\r\n.collapsible .disabled .collapsible-header-icon-plus {\r\n\tbackground-image: url('../images/buttons/button-plus-gray.gif');\r\n}\r\n\r\n.collapsible-header-spinner {\r\n\tfloat: right;\r\n\tmargin-right: 10px;\r\n}\r\n\r\n.collapsible-header.collapsed .collapsible-header-icon {\r\n\tbackground-image: url('../images/buttons/button-plus-15pt.gif');\r\n}\r\n\r\n.collapsible-header.expanded .collapsible-header-icon {\r\n\tbackground-image: url('../images/buttons/button-minus-15pt.gif');\r\n}",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 292,
          "bodySize": 1423
        },
        "cache": {},
        "timings": {
          "send": 52,
          "wait": 0,
          "receive": 2
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8640"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 65,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/collapsible.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 359,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "3278"
            }
          ],
          "content": {
            "size": 12252,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "LyoqDQogKiBjb2xsYXBzaWJsZSgpIGlzIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGNvbnZlcnQgYSBncm91cGluZyBvZiBoMy1kaXYgcGFpcnMgaW50byBjb2xsYXBzaWJsZSBzZWN0aW9ucy4NCiAqIFdoZW4gdGhlIGhlYWRlciAoaDMpIGlzIGNsaWNrZWQsIHRoZSBjb250ZW50IChkaXYpIGlzIGR5bmFtaWNhbGx5IGxvYWRlZCwgY2FjaGVkLCBhbmQgZXhwYW5kZWQgb3IgY29sbGFwc2VkLg0KICogICAgdXNhZ2U6ICQoIiNteUNvbGxhcHNpYmxlRGl2IikuY29sbGFwc2libGUoKTsNCiAqLw0KKGZ1bmN0aW9uKCQpIHsNCgkkLmZuLmNvbGxhcHNpYmxlID0gZnVuY3Rpb24ob3B0aW9ucykgew0KDQoJCXZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHsNCgkJCS8vIEluaXRpYWxpemF0aW9uIGZ1bmN0aW9uDQoJCQlpbml0IDogZnVuY3Rpb24oKSB7fSwNCgkJCQ0KCQkJLy8gSWYgdHJ1ZSwgd2lsbCBzY3JvbGwgdG8gdGhlIGJhbm5lciBqdXN0IGV4cGFuZGVkDQoJCQlzY3JvbGxUb0Jhbm5lcjogZmFsc2UsDQoJCQkNCgkJCS8vIENhbGxiYWNrIGZ1bmN0aW9uIGVudm9rZWQgYWZ0ZXIgYSBzZWN0aW9uJ3MgY29udGVudCBoYXMgYmVlbiByZWxvYWRlZC4NCgkJCWFmdGVyUmVsb2FkIDogZnVuY3Rpb24oaGVhZGVyLCBjb250ZW50KSB7fSwNCg0KCQkJLy8gRnVuY3Rpb24gdG8gZXhlY3V0ZSB3aGVuIGhlYWRlciBpcyBleHBhbmRlZA0KCQkJYWZ0ZXJFeHBhbmQ6IGZ1bmN0aW9uKCkge30sDQoJCQkNCgkJCS8vIEZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2hlbiBoZWFkZXIgaXMgY29sbGFwc2VkDQoJCQlhZnRlckNvbGxhcHNlOiBmdW5jdGlvbigpIHt9LA0KCQkJDQoJCQkvLyBkZWZhdWx0IERPTSBlbGVtZW50IHVzZWQgdG8gZGVub3RlIHRoZSBIZWFkZXIgc2VjdGlvbnMNCgkJCWhlYWRlckVsZW06ICdoMycsDQoJCQkNCgkJCS8vIGEgc2Vjb25kIHJvdyBvZiB0aGUgbWFpbiB0aXRsZSwgaWYgbmVlZGVkLg0KCQkJdGl0bGUyOiAnJywgDQoJCQkNCgkJCWNhY2hlZDogdHJ1ZQ0KCQl9LCBvcHRpb25zKTsNCg0KCQkvKioNCgkJICogUmVsb2FkcyBhIGNvbGxhcHNpYmxlIHNlY3Rpb24gYmVsb3cgYSBoZWFkZXIgZWxlbWVudA0KCQkgKiANCgkJICogQHBhcmFtIGhlYWRlciAtIGhlYWRlciBlbGVtZW50IGFib3ZlIHRoZSBjb2xsYXBzaWJsZSBzZWN0aW9uIHRvIHJlbG9hZA0KCQkgKiBAcGFyYW0gYVN5bmMgLSBwYXNzdGhyb3VnaCBwYXJhbWV0ZXIgdG8galF1ZXJ5IHRvIGRlbm90ZSBpZiB0aGUgcmVxdWVzdCBzaG91bGQgYmUgYXN5bmNocm9ub3VzIG9yIG5vdA0KCQkgKiBAcGFyYW0gY29tcGxldGUgLSBhIGZ1bmN0aW9uIHRvIGNhbGwgYWZ0ZXIgdGhlIGRhdGEgaXMgbG9hZGVkDQoJCSAqLw0KCQlmdW5jdGlvbiByZWxvYWRDb250ZW50KGhlYWRlciwgYVN5bmMsIGNvbXBsZXRlKSB7DQoJCQlpZiAoaGVhZGVyLm5leHQoKS5kYXRhKCd1cmwnKSkgew0KCQkJCWhlYWRlci5maW5kKCcuY29sbGFwc2libGUtaGVhZGVyLXNwaW5uZXInKS5hZGRTcGlubmVyUE5HKCk7DQoJCQkJaGVhZGVyLm5leHQoKS5lYWNoKGZ1bmN0aW9uKGksIGUpIHsNCgkJCQkJdmFyIGNvbnRlbnQgPSAkKGUpOw0KCQkJCQkkLmFqYXgoew0KCQkJCQkJdXJsOmNvbnRlbnQuZGF0YSgndXJsJyksDQoJCQkJCQlkYXRhOnsgDQoJCQkJCQkJbW9kZTpoZWFkZXIuZGF0YSgnbW9kZScpLCANCgkJCQkJCQlyZXN0b3JlU3RhdGU6aGVhZGVyLmRhdGEoJ3Jlc3RvcmVTdGF0ZScpDQoJCQkJCQl9LCANCgkJCQkJCWFzeW5jIDogYVN5bmMNCgkJCQkJfSkuZG9uZShmdW5jdGlvbihyZXNwb25zZSwgc3RhdHVzLCB4aHIpIHsNCgkJCQkJCS8vIENRMzEwNDAgLSB0aGUgcmVzcG9uc2Ugc2hvdWxkIGJlIGp1c3QgYW4gaHRtbCBmcmFnbWVudC4gIEJ1dCBpZiB0aGVyZSBpcyBhIDxib2R5PiB0YWcgKGllLiBmcm9tIGEgNTUwLmpzcCBlcnJvciBmaWxlKSwganVzdCBkaXNwbGF5IHRoZSBzdHVmZiBiZXR3ZWVuLiANCgkJCQkJCXZhciByZSA9IC8uKjxib2R5W14+XSo+KFtcc1xTXSopPFwvYm9keT4uKi9pOw0KCQkJCQkJdmFyIG0gPSByZS5leGVjKHJlc3BvbnNlKTsNCgkJCQkJCWlmIChtICE9IG51bGwpIHsNCgkJCQkJCQljb250ZW50Lmh0bWwobVsxXSk7DQoJCQkJCQl9DQoJCQkJCQllbHNlIHsJCQkJCQkNCgkJCQkJCQljb250ZW50Lmh0bWwocmVzcG9uc2UpOw0KCQkJCQkJfQ0KCQkJDQoJCQkJCQkvLyBkbyBsb2NhbCBjYWxsYmFjaywgaWYgaXQgZXhpc3RzDQoJCQkJCQlpZiAoY29tcGxldGUpIGNvbXBsZXRlLmNhbGwoaGVhZGVyKTsNCgkJCQkJCQ0KCQkJCQkJLy8gZG8gZ2xvYmFsIGNhbGxiYWNrLCBpZiBzcGVjaWZpZWQNCgkJCQkJCXNldHRpbmdzLmFmdGVyUmVsb2FkLmNhbGwoaGVhZGVyLCBjb250ZW50KTsJCQ0KCQkJCQkJDQoJCQkJCQloZWFkZXIuZmluZCgnLmNvbGxhcHNpYmxlLWhlYWRlci1zcGlubmVyJykucmVtb3ZlU3Bpbm5lclBORygpOwkJCQkJDQoJCQkJCX0pOw0KCQkJCX0pOw0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSAqIEV4cGFuZHMgYSBzZWN0aW9uIA0KCQkgKi8NCgkJZnVuY3Rpb24gc2hvd0NvbnRlbnQoZSwgY2FsbGJhY2spIHsNCgkJCXZhciBoZWFkZXIgPSAkKHRoaXMpOw0KCQkJaGVhZGVyLmRhdGEoJ3N0YXRlJywgJ2V4cGFuZGVkJyk7DQoJCQkNCgkJCS8vIGxvYWQgdGhlIGNvbnRlbnQgaWYgaXQncyBlbXB0eQ0KCQkJaWYgKCFzZXR0aW5ncy5jYWNoZWQgfHwgaGVhZGVyLm5leHQoKS5odG1sKCkgPT0gJycpIHsNCgkJCQkvLyByZWxvYWQgYW5kIHNob3cgdGhlIGNvbnRlbnQgb24gY2FsbGJhY2sNCgkJCQlyZWxvYWRDb250ZW50KGhlYWRlciwgdHJ1ZSwgZnVuY3Rpb24oKSB7IHNob3dIaWRlQ29udGVudChoZWFkZXIsIHRydWUsIGNhbGxiYWNrKTsgfSk7DQoJCQl9DQoJCQllbHNlIHsNCgkJCQlzaG93SGlkZUNvbnRlbnQoaGVhZGVyLCB0cnVlLCBjYWxsYmFjayk7DQoJCQl9DQoJCX0NCg0KCQkvKioNCgkJICogQ29sbGFwc2VkIGEgc2VjdGlvbg0KCQkgKi8NCgkJZnVuY3Rpb24gaGlkZUNvbnRlbnQoKSB7DQoJCQl2YXIgaGVhZGVyID0gJCh0aGlzKTsNCgkJCWhlYWRlci5kYXRhKCdzdGF0ZScsICdjb2xsYXBzZWQnKTsNCgkJCXNob3dIaWRlQ29udGVudChoZWFkZXIsIHRydWUpOw0KCQl9DQoNCgkJLyoqDQoJCSAqIFRvZ2dsZXMgYSBzZWN0aW9uJ3MgZXhwYW5kL2NvbGxhcHNlIHN0YXRlDQoJCSAqLw0KCQlmdW5jdGlvbiB0b2dnbGVDb250ZW50KCkgew0KCQkJdmFyIGhlYWRlciA9ICQodGhpcyk7DQoJCQlpZiAoaGVhZGVyLmRhdGEoJ3N0YXRlJykgPT0gJ2V4cGFuZGVkJykgew0KCQkJCWhlYWRlci50cmlnZ2VyKCdoZWFkZXI6Y29sbGFwc2UnKTsNCgkJCX0gDQoJCQllbHNlIHsNCgkJCQloZWFkZXIudHJpZ2dlcignaGVhZGVyOmV4cGFuZCcpOw0KCQkJfQ0KCQl9DQoNCgkJLyoqDQoJCSAqIERvZXMgdGhlIGFjdHVhbCB3b3JrIG9mIGV4cGFuZGluZy9jb2xsYXBzaW5nIGEgc2VjdGlvbg0KCQkgKi8NCgkJZnVuY3Rpb24gc2hvd0hpZGVDb250ZW50KGhlYWRlciwgYW5pbWF0ZSwgY2FsbGJhY2spIHsNCgkJCXZhciBjb250ZW50ID0gaGVhZGVyLm5leHQoKTsNCg0KCQkJaWYgKGhlYWRlci5kYXRhKCdzdGF0ZScpID09ICdleHBhbmRlZCcpIHsNCgkJCQloZWFkZXIuZmluZCgnLmNvbGxhcHNpYmxlLWhlYWRlci1pY29uJykNCgkJCQkJLnJlbW92ZUNsYXNzKCdjb2xsYXBzaWJsZS1oZWFkZXItaWNvbi1wbHVzJykNCgkJCQkJLmFkZENsYXNzKCdjb2xsYXBzaWJsZS1oZWFkZXItaWNvbi1taW51cycpOw0KCQkJCWlmIChhbmltYXRlKSB7DQoJCQkvLwkJaWYgKHNldHRpbmdzLnNjcm9sbFRvQmFubmVyKSB7DQoJCQkJCWNvbnRlbnQuc2xpZGVEb3duKCdmYXN0JywgZnVuY3Rpb24oKSB7DQoJCQkJCQkkKCdodG1sLGJvZHknKS5hbmltYXRlKHsNCgkJCQkJCQlzY3JvbGxUb3AgOiBoZWFkZXIub2Zmc2V0KCkudG9wDQoJCQkJCQl9KTsNCgkJCQkJCWhlYWRlci50cmlnZ2VyKCdoZWFkZXI6YWZ0ZXJFeHBhbmQnKTsNCg0KCQkJCQkJLy8gZG8gY2FsbGJhY2sgcGFzc2VkIGluIGZyb20gdGhlIHRyaWdnZXIsIGlmIGl0IGV4aXN0cw0KCQkJCQkJaWYgKGNhbGxiYWNrKSBjYWxsYmFjay5jYWxsKCk7DQoJCQkJCX0pOw0KCQkJLy8JCX0NCgkJCS8vCQllbHNlIHsNCgkJCS8vCQkJY29udGVudC5zbGlkZURvd24oJ2Zhc3QnKTsNCgkJCS8vCQl9DQoJCQkJfSBlbHNlIHsNCgkJCQkJY29udGVudC5yZW1vdmVDbGFzcygnaGlkZGVuJyk7DQoJCQkJCWhlYWRlci50cmlnZ2VyKCdoZWFkZXI6YWZ0ZXJFeHBhbmQnKTsNCgkJCQkJDQoJCQkJCS8vIGRvIGNhbGxiYWNrIHBhc3NlZCBpbiBmcm9tIHRoZSB0cmlnZ2VyLCBpZiBpdCBleGlzdHMNCgkJCQkJaWYgKGNhbGxiYWNrKSBjYWxsYmFjay5jYWxsKCk7DQoJCQkJfQ0KCQkJCSQoJy5jb2xsYXBzaWJsZSBhLmNvbGxhcHNlQWxsJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7DQoJCQl9IGVsc2Ugew0KCQkJCWhlYWRlci5maW5kKCcuY29sbGFwc2libGUtaGVhZGVyLWljb24nKQ0KCQkJCQkucmVtb3ZlQ2xhc3MoJ2NvbGxhcHNpYmxlLWhlYWRlci1pY29uLW1pbnVzJykNCgkJCQkJLmFkZENsYXNzKCdjb2xsYXBzaWJsZS1oZWFkZXItaWNvbi1wbHVzJyk7DQoJCQkJY29udGVudC5zbGlkZVVwKCdmYXN0Jyk7DQoJCQkJLy8gZGlzYWJsZSB0aGUgQ29sbGFwc2UgQWxsIGxpbmtzIGlmIGFsbCBzZWN0aW9ucyBhcmUgY29sbGFwc2VkLg0KCQkJCWlmICgkKCcuY29sbGFwc2libGUgLmNvbGxhcHNpYmxlLWhlYWRlcicpLmZpbHRlcihmdW5jdGlvbigpIHtyZXR1cm4gJCh0aGlzKS5kYXRhKCdzdGF0ZScpID09ICdleHBhbmRlZCc7fSkubGVuZ3RoID09IDApIHsJCQkJDQoJCQkJCSQoJy5jb2xsYXBzaWJsZSBhLmNvbGxhcHNlQWxsJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7DQoJCQkJfQ0KCQkJCWhlYWRlci50cmlnZ2VyKCdoZWFkZXI6YWZ0ZXJDb2xsYXBzZScpOw0KDQoJCQkJLy8gZG8gY2FsbGJhY2sgcGFzc2VkIGluIGZyb20gdGhlIHRyaWdnZXIsIGlmIGl0IGV4aXN0cw0KCQkJCWlmIChjYWxsYmFjaykgY2FsbGJhY2suY2FsbCgpOw0KCQkJfQkJCQ0KCQl9DQoJCQ0KCQlmdW5jdGlvbiBzZXRFZGl0TW9kZSgpIHsNCgkJCSQodGhpcykuZGF0YSgnbW9kZScsICdlZGl0Jyk7DQoJCQkvLyBEaXNhYmxlIHRoZSBbRWRpdF0gbGluaw0KCQkJJCh0aGlzKS5maW5kKCdhLmVkaXQnKS5yZW1vdmVDbGFzcygnY2xzLWxpbmsnKTsNCgkJCXJlbG9hZENvbnRlbnQoJCh0aGlzKSwgdHJ1ZSk7DQoJCX0NCgkJDQoJCWZ1bmN0aW9uIHNldFZpZXdNb2RlKCkgew0KCQkJLy8gU2V0IHRoZSBoZWFkZXIgYmFjayB0byB2aWV3LW9ubHkgbW9kZSBhbmQgcmVsb2FkIGNvbnRlbnQNCgkJCSQodGhpcykuZGF0YSgnbW9kZScsICd2aWV3Jyk7DQoJCQkvLyBFbmFibGUgdGhlIFtFZGl0XSBsaW5rDQoJCQkkKHRoaXMpLmZpbmQoJ2EuZWRpdCcpLmFkZENsYXNzKCdjbHMtbGluaycpOw0KCQkJcmVsb2FkQ29udGVudCgkKHRoaXMpLCB0cnVlKTsNCgkJfQ0KDQoJCS8vIFNldHVwIERPTSwgYWRkIHN0eWxlcw0KCQl0aGlzLmFkZENsYXNzKCdjb2xsYXBzaWJsZScpDQoJCQkuZmluZChzZXR0aW5ncy5oZWFkZXJFbGVtKQ0KCQkJLmFkZENsYXNzKCdjb2xsYXBzaWJsZS1oZWFkZXInKQ0KCQkJLmFwcGVuZCgnPHNwYW4gY2xhc3M9ImNvbGxhcHNpYmxlLWhlYWRlci1pY29uIGNvbGxhcHNpYmxlLWhlYWRlci1pY29uLXBsdXMiPjwvc3Bhbj4nKQ0KCQkJLmFwcGVuZCgnPHNwYW4gY2xhc3M9ImNvbGxhcHNpYmxlLWhlYWRlci1zcGlubmVyIj48L3NwYW4+JykNCgkJCS5hcHBlbmQoc2V0dGluZ3MudGl0bGUyKQ0KCQkJLm5leHQoKSAvLyB0aGUgbmV4dCBlbGVtZW50IGFmdGVyIHRoZSBoZWFkZXIgKHRoZSBkaXYpLCBpbml0aWFsbHkgc2V0IGFzIGhpZGRlbi4NCgkJCQkuYWRkQ2xhc3MoJ2NvbGxhcHNpYmxlLWNvbnRlbnQgaGlkZGVuJyk7DQoJCXRoaXMuZmluZCgiLmNvbGxhcHNpYmxlLWhlYWRlciAuZmxhZyIpLmVhY2goZnVuY3Rpb24gKCkgew0KCQkJJCh0aGlzKS5hcHBlbmRUbygkKHRoaXMpLnBhcmVudCgpKTsNCgkJfSk7DQoJCXRoaXMuZmluZChzZXR0aW5ncy5oZWFkZXJFbGVtKS5ub3QoJy5kaXNhYmxlZCcpDQoJCQkuaG92ZXIoZnVuY3Rpb24oKSB7ICQodGhpcykudG9nZ2xlQ2xhc3MoJ2NvbGxhcHNpYmxlLWhlYWRlci1ob3ZlcicpOyB9KQ0KCQkJLm9uKCdoZWFkZXI6dG9nZ2xlJywgdG9nZ2xlQ29udGVudCkNCgkJCS5vbignaGVhZGVyOmV4cGFuZCcsIHNob3dDb250ZW50KQ0KCQkJLm9uKCdoZWFkZXI6Y29sbGFwc2UnLCBoaWRlQ29udGVudCkNCgkJCS5vbignaGVhZGVyOmVkaXQnLCBzZXRFZGl0TW9kZSkNCgkJCS5vbignaGVhZGVyOnZpZXcnLCBzZXRWaWV3TW9kZSkNCgkJCS5vbignaGVhZGVyOmFmdGVyRXhwYW5kJywgc2V0dGluZ3MuYWZ0ZXJFeHBhbmQpDQoJCQkub24oJ2hlYWRlcjphZnRlckNvbGxhcHNlJywgc2V0dGluZ3MuYWZ0ZXJDb2xsYXBzZSkNCgkJCS5lYWNoKGZ1bmN0aW9uKCkgeyAkKHRoaXMpLmRhdGEoJ21vZGUnLCAndmlldycpOyAkKHRoaXMpLmRhdGEoJ3N0YXRlJywgJ2NvbGxhcHNlZCcpOyAkKHRoaXMpLmRhdGEoJ3Jlc3RvcmVTdGF0ZScsICdmYWxzZScpO30pDQoJCQkuZmluZCgnYS5lZGl0JykuYWRkQ2xhc3MoJ2hyZWYtZGlzYWJsZWQnKS5hZGRDbGFzcygnY2xzLWxpbmsnKTsNCg0KCQkvLyBSZWdpc3RlciBoZWFkZXIgY2xpY2sgZXZlbnQgdG8gdG9nZ2xlIHRoZSB2aWV3aW5nIG9mIHRoZSBjb250ZW50IHNlY3Rpb24NCgkJdGhpcy5maW5kKCcuY29sbGFwc2libGUtaGVhZGVyJykubm90KCcuZGlzYWJsZWQnKS5jbGljayhmdW5jdGlvbigpIHsNCgkJCSQodGhpcykudHJpZ2dlcignaGVhZGVyOnRvZ2dsZScpOw0KCQl9KTsNCg0KCQkvLyBBZGQgW0VkaXRdIGNsaWNrIGV2ZW50IHRvIHJlbG9hZCBjb250ZW50IGluIGVkaXQgbW9kZS4NCgkJdGhpcy5maW5kKCcuY29sbGFwc2libGUtaGVhZGVyJykubm90KCcuZGlzYWJsZWQnKS5maW5kKCdhLmVkaXQnKS5jbGljayhmdW5jdGlvbihlKSB7DQoJCQkvLyBkb24ndCBidWJibGUgdXAgdG8gaGVhZGVyIGNsaWNrIGV2ZW50DQoJCQllLnN0b3BQcm9wYWdhdGlvbigpOw0KDQoJCQkvLyBzaG9ydC1jaXJjdWl0IGlmIHRoaXMgaGVhZGVyIGlzIGFscmVhZHkgaW4gZWRpdCBtb2RlDQoJCQl2YXIgaGVhZGVyID0gJCh0aGlzKS5jbG9zZXN0KCcuY29sbGFwc2libGUtaGVhZGVyJyk7DQoJCQlpZiAoaGVhZGVyLmRhdGEoJ21vZGUnKSA9PSAnZWRpdCcpIHJldHVybjsNCgkJCQ0KCQkJLy8gT25seSBvbmUgc2VjdGlvbiBjYW4gYmUgZWRpdGlibGUgYXQgYW55IGdpdmVuIHRpbWUuICBDaGVjayBpZiBwYWdlIGlzIGRpcnR5Lg0KCQkJaWYgKGNoZWNrRm9ybUNoYW5nZWQoKSA9PSBmYWxzZSkgcmV0dXJuOw0KDQoJCQkvLyByZWxvYWQgYWxsIGVkaXRhYmxlIHNlY3Rpb25zIGluIHJlYWQtb25seSBtb2RlDQoJCQkkKCIuY29sbGFwc2libGUgLmNvbGxhcHNpYmxlLWhlYWRlciIpLm5vdCgnLmRpc2FibGVkJykNCgkJCQkuZmlsdGVyKGZ1bmN0aW9uKCkgeyByZXR1cm4gaGVhZGVyLmF0dHIoJ2lkJykgIT09ICQodGhpcykuYXR0cignaWQnKTsgfSkgLy8gZG9uJ3QgcmVsb2FkIHRoaXMgaGVhZGVyIGZpcnN0IGluIHZpZXcgbW9kZSB0aGVuIGluIGVkaXQgbW9kZS4NCgkJCQkuZmlsdGVyKGZ1bmN0aW9uKCkgeyByZXR1cm4gJCh0aGlzKS5kYXRhKCdtb2RlJykgPT0gJ2VkaXQnOyB9KQ0KCQkJCS5lYWNoKGZ1bmN0aW9uKCkgeyAkKHRoaXMpLnRyaWdnZXIoJ2hlYWRlcjp2aWV3Jyk7IH0pOw0KDQoJCQkvLyBvbmx5IHJlbG9hZCB0aGUgZXhwYW5kYWJsZSBzZWN0aW9uIGluIGVkaXQgbW9kZSBpZiB3ZSBoYXZlbid0IGFscmVhZHkNCgkJCWlmIChoZWFkZXIuZGF0YSgnbW9kZScpICE9ICdlZGl0JykgewkJCQkJDQoJCQkJLy8gRGlzYWJsZSB0aGUgW0VkaXRdIGxpbmsNCgkJCQkkKHRoaXMpLnJlbW92ZUNsYXNzKCdjbHMtbGluaycpOw0KCQkJCQ0KCQkJCS8vIFdlIGRvbid0IHdhbnQgdG8gdG9nZ2xlIHRoZSBzZWN0aW9uLCBidXQgd2UgZG8gd2FudCB0byByZWxvYWQgdGhlIHNlY3Rpb24gaW4gZWRpdCBtb2RlLg0KCQkJCWhlYWRlci5kYXRhKCdtb2RlJywgJ2VkaXQnKTsNCgkJCQlyZWxvYWRDb250ZW50KGhlYWRlciwgdHJ1ZSwgc2hvd0NvbnRlbnQpOw0KCQkJfQ0KCQl9KTsNCg0KCQkvLyBSZXR1cm4gdG8gdG9wIGxpbmtzIHNjcm9sbCB0byB0aGUgdG9wIG9mIHRoZSBzZWN0aW9uDQoJCXRoaXMuZmluZCgnYS5jb2xsYXBzZUFsbCcpLmFkZENsYXNzKCdjbHMtbGluaycpLmNsaWNrKGZ1bmN0aW9uKGUpIHsNCgkJCSQoJy5jb2xsYXBzaWJsZSAuY29sbGFwc2libGUtaGVhZGVyJykuZWFjaChmdW5jdGlvbigpIHsNCgkJCQkkKHRoaXMpLnRyaWdnZXIoJ2hlYWRlcjpjb2xsYXBzZScpOw0KCQkJfSk7DQoJCQkkKCdodG1sLGJvZHknKS5hbmltYXRlKHsgc2Nyb2xsVG9wIDogMCB9KTsNCgkJfSk7DQoNCgkJc2V0dGluZ3MuaW5pdC5jYWxsKCk7DQoNCgkJLy8gSW5pdCAtIGxvYWQgYWxsIHNlY3Rpb25zIHRoYXQgc2hvdWxkIGJlIG9wZW4gdG8gc3RhcnQgd2l0aC4NCgkJdGhpcy5maW5kKCcuY29sbGFwc2libGUtaGVhZGVyJykubm90KCcuZGlzYWJsZWQnKS5maWx0ZXIoZnVuY3Rpb24oKSB7DQoJCQlyZXR1cm4gJCh0aGlzKS5kYXRhKCdzdGF0ZScpID09ICdleHBhbmRlZCc7DQoJCX0pLmVhY2goZnVuY3Rpb24oKSB7DQoJCQl2YXIgaGVhZGVyID0gJCh0aGlzKTsNCgkJCXJlbG9hZENvbnRlbnQoaGVhZGVyLCBmYWxzZSk7DQoJCQlzaG93SGlkZUNvbnRlbnQoaGVhZGVyLCBmYWxzZSk7CQkJCQkNCgkJfSk7DQoJCXRoaXMuZmluZCgnLmNvbGxhcHNpYmxlLWhlYWRlcicpLm5vdCgnLmRpc2FibGVkJykuZWFjaChmdW5jdGlvbigpIHsNCgkJCXZhciBoZWFkZXIgPSAkKHRoaXMpOw0KCQkJLy8gcmVmcmVzaCBoZWFkZXINCgkJCWlmIChoZWFkZXIuZGF0YSgnbW9kZScpID09ICdlZGl0Jykgew0KCQkJCS8vIERpc2FibGUgdGhlIFtFZGl0XSBsaW5rDQoJCQkJaGVhZGVyLmZpbmQoJ2EuZWRpdCcpLnJlbW92ZUNsYXNzKCdjbHMtbGluaycpOw0KCQkJfQ0KCQkJZWxzZSB7DQoJCQkJLy8gRW5hYmxlIHRoZSBbRWRpdF0gbGluaw0KCQkJCWhlYWRlci5maW5kKCdhLmVkaXQnKS5hZGRDbGFzcygnY2xzLWxpbmsnKTsNCgkJCX0NCgkJfSk7DQoJCQ0KCQl0aGlzLnNob3coKTsNCgl9DQp9KGpRdWVyeSkpOw0K",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 309,
          "bodySize": 12252
        },
        "cache": {},
        "timings": {
          "send": 10,
          "wait": 0,
          "receive": 8
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8639"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 111,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/displaytag.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 358,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "293"
            }
          ],
          "content": {
            "size": 442,
            "compression": 0,
            "mimeType": "text/css",
            "text": "table.displayTag th.sorted span,th.sortable span {\r\n\tbackground-position: right;\r\n\tbackground-repeat: no-repeat;\r\n\tpadding-right: 12px;\r\n}\t\t\r\n\r\ntable.displayTag th.sortable span {\r\n\tbackground-image: url('../images/icons/arrow_off.png');\r\n}\t\r\n\t\r\ntable.displayTag th.order1 span {\r\n\tbackground-image: url('../images/icons/arrow_up.png');\r\n}\t\r\n\t\r\ntable.displayTag th.order2 span {\r\n\tbackground-image: url('../images/icons/arrow_down.png');\r\n}\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 292,
          "bodySize": 442
        },
        "cache": {},
        "timings": {
          "send": 53,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8635"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 74,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/displaytag.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 358,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:34 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"049e97ada8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "486"
            }
          ],
          "content": {
            "size": 796,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "LyoqDQogKiBUaGlzIG1ldGhvZCBpbXBsZW1lbnRzIHRoZSBvbkNsaWNrIG1ldGhvZCBvZiBEaXNwbGF5VGFnIGFuY2hvciB0YWdzIHNvIHRoZSB0YWJsZSBpcyANCiAqIHJlZnJlc2hlZCB2aWEgYW4gYWpheCByZXF1ZXN0IHJhdGhlciB0aGFuIGEgc2ltcGxlIEdFVCByZXF1ZXN0Lg0KICovDQpmdW5jdGlvbiBkaXNwbGF5VGFnT25DbGljayh0YmxJZCwgYSkgew0KCWlmICh0eXBlb2YoYSkgIT0gJ3N0cmluZycgJiYgJChhKS5oYXNDbGFzcygnZGlzYWJsZWQnKSkgcmV0dXJuIGZhbHNlOw0KCXZhciB1cmwgPSAodHlwZW9mKGEpID09ICdzdHJpbmcnKSA/IGEgOiBhLmhyZWY7DQoJJC5nZXQodXJsLCBmdW5jdGlvbihodG1sKXsNCgkJdmFyIG5ld1RibCA9ICQoJC5wYXJzZUhUTUwoaHRtbCkpLmZpbmQoIiMiICsgdGJsSWQpOw0KCQkvLyByZXBsYWNlIHRhYmxlIHdpdGggbmV3IHRhYmxlIHJldHVybmVkIGJ5IGNvbnRyb2xsZXINCgkJJCgiIyIgKyB0YmxJZCkuaHRtbChuZXdUYmwuaHRtbCgpKTsNCgkJJCgiIyIgKyB0YmxJZCkubmV4dCgpLmh0bWwobmV3VGJsLm5leHQoKS5odG1sKCkpOwkJCQkJCQkJDQoJfSk7DQoJcmV0dXJuIGZhbHNlOw0KfSA=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 308,
          "bodySize": 796
        },
        "cache": {},
        "timings": {
          "send": 10,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8638"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 103,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/jquery-picklist.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 363,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "682"
            }
          ],
          "content": {
            "size": 1652,
            "compression": 0,
            "mimeType": "text/css",
            "text": ".pickList_addAll { background-image: url(\"/OMNIStatic/images/buttons/button-add-all-to-right.gif\"); }\n.pickList_add {\tbackground-image: url(\"/OMNIStatic/images/buttons/button-add-to-right.gif\"); }\n.pickList_add:disabled { background-image: url(\"/OMNIStatic/images/buttons/button-add-to-right-disabled.png\"); }\n.pickList_remove { background-image: url(\"/OMNIStatic/images/buttons/button-remove-from-right.gif\"); }\n.pickList_remove:disabled { background-image: url(\"/OMNIStatic/images/buttons/button-remove-from-right-disabled.png\"); }\n.pickList_removeAll { background-image: url(\"/OMNIStatic/images/buttons/button-remove-all-from-right.gif\"); }\n\n.pickList_sourceListContainer, .pickList_controlsContainer, .pickList_targetListContainer { \n\tfloat: left; margin: 0.25em;\n}\n.pickList_controlsContainer { \n\ttext-align: center; \n\tmargin-top: 145px;\n}\n.pickList_controlsContainer button { \n\tdisplay: block; width: 100%; text-align: center; \n\twidth: 85px;\n\theight: 34px;\n\tborder: none;\n\tbackground-repeat: no-repeat;\n\tbackground-color: transparent;\n}\n.pickList_list { \n\tlist-style-type: none; margin: 0; padding: 0; \n\tfloat: left; \n\twidth: 300px; \n\theight: 300px; \n\tborder: 1px inset #eee; \n\toverflow-y: auto; \n\tcursor: default; \n\tcolor: #666666;\n\tbackground: white;\n\toutline: none;\n}\n.pickList_selectedListItem { \n\tbackground-color: #a3c8f5; \n}\n.pickList_listLabel {\n\tcolor: #666666;\n\ttext-align: center; \n}\n.pickList_clear { \n\tclear: both; \n}\n.pickList_list .ui-selectee { background: inherit; color: #666666; }\n.pickList_list .ui-selecting, .pickList_list .ui-selected { background: #a3c8f5; color: white; }\n.pickList_error { \n\tbackground-color: #ffff00; \n}",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 292,
          "bodySize": 1652
        },
        "cache": {},
        "timings": {
          "send": 29,
          "wait": 0,
          "receive": 2
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8639"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 94,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/jquery/jquery-picklist.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 370,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "4485"
            }
          ],
          "content": {
            "size": 21836,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "LyoqCiAqIGpRdWVyeSBQaWNrTGlzdCBXaWRnZXQKICoKICogQ29weXJpZ2h0IChjKSAyMDEyLTIwMTMgSm9uYXRob24gRnJlZW1hbiA8am9uYXRob25AYXducnkuY29tPgogKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBMaWNlbnNlLgogKgogKiBodHRwOi8vY29kZS5nb29nbGUuY29tL3AvanF1ZXJ5LXVpLXBpY2tsaXN0LwogKi8KKGZ1bmN0aW9uKCQpCnsKCSQud2lkZ2V0KCJhd25yeS5waWNrTGlzdCIsCgl7CgkJd2lkZ2V0RXZlbnRQcmVmaXg6ICJwaWNrTGlzdF8iLAoKCQlvcHRpb25zOgoJCXsKCQkJLy8gQ29udGFpbmVyIGNsYXNzZXMKCQkJbWFpbkNsYXNzOiAgICAgICAgICAgICAgICAgICJwaWNrTGlzdCIsCgkJCWxpc3RDb250YWluZXJDbGFzczogICAgICAgICAicGlja0xpc3RfbGlzdENvbnRhaW5lciIsCgkJCXNvdXJjZUxpc3RDb250YWluZXJDbGFzczogICAicGlja0xpc3Rfc291cmNlTGlzdENvbnRhaW5lciIsCgkJCWNvbnRyb2xzQ29udGFpbmVyQ2xhc3M6ICAgICAicGlja0xpc3RfY29udHJvbHNDb250YWluZXIiLAoJCQl0YXJnZXRMaXN0Q29udGFpbmVyQ2xhc3M6ICAgInBpY2tMaXN0X3RhcmdldExpc3RDb250YWluZXIiLAoJCQlsaXN0Q2xhc3M6ICAgICAgICAgICAgICAgICAgInBpY2tMaXN0X2xpc3QiLAoJCQlzb3VyY2VMaXN0Q2xhc3M6ICAgICAgICAgICAgInBpY2tMaXN0X3NvdXJjZUxpc3QiLAoJCQl0YXJnZXRMaXN0Q2xhc3M6ICAgICAgICAgICAgInBpY2tMaXN0X3RhcmdldExpc3QiLAoJCQljbGVhckNsYXNzOiAgICAgICAgICAgICAgICAgInBpY2tMaXN0X2NsZWFyIiwKCQkJZXJyb3JDbGFzczoJCQkJCSJwaWNrTGlzdF9lcnJvciIsCgoJCQkvLyBMaXN0IGl0ZW0gY2xhc3NlcwoJCQlsaXN0SXRlbUNsYXNzOiAgICAgICAgICAgICAgInBpY2tMaXN0X2xpc3RJdGVtIiwKCQkJcmljaExpc3RJdGVtQ2xhc3M6ICAgICAgICAgICJwaWNrTGlzdF9yaWNoTGlzdEl0ZW0iLAoJCQlzZWxlY3RlZExpc3RJdGVtQ2xhc3M6ICAgICAgInBpY2tMaXN0X3NlbGVjdGVkTGlzdEl0ZW0iLAoKCQkJLy8gQ29udHJvbCBjbGFzc2VzCgkJCWFkZEFsbENsYXNzOiAgICAgICAgICAgICAgICAicGlja0xpc3RfYWRkQWxsIiwKCQkJYWRkQ2xhc3M6ICAgICAgICAgICAgICAgICAgICJwaWNrTGlzdF9hZGQiLAoJCQlyZW1vdmVBbGxDbGFzczogICAgICAgICAgICAgInBpY2tMaXN0X3JlbW92ZUFsbCIsCgkJCXJlbW92ZUNsYXNzOiAgICAgICAgICAgICAgICAicGlja0xpc3RfcmVtb3ZlIiwKCgkJCS8vIENvbnRyb2wgbGFiZWxzCgkJCWFkZEFsbExhYmVsOiAgICAgICAgICAgICAgICAiJmd0OyZndDsiLAoJCQlhZGRMYWJlbDogICAgICAgICAgICAgICAgICAgIiZndDsiLAoJCQlyZW1vdmVBbGxMYWJlbDogICAgICAgICAgICAgIiZsdDsmbHQ7IiwKCQkJcmVtb3ZlTGFiZWw6ICAgICAgICAgICAgICAgICImbHQ7IiwKCgkJCS8vIExpc3QgbGFiZWxzCgkJCWxpc3RMYWJlbENsYXNzOiAgICAgICAgICAgICAicGlja0xpc3RfbGlzdExhYmVsIiwKCQkJc291cmNlTGlzdExhYmVsOiAgICAgICAgICAgICJBdmFpbGFibGUiLAoJCQlzb3VyY2VMaXN0TGFiZWxDbGFzczogICAgICAgInBpY2tMaXN0X3NvdXJjZUxpc3RMYWJlbCIsCgkJCXRhcmdldExpc3RMYWJlbDogICAgICAgICAgICAiU2VsZWN0ZWQiLAoJCQl0YXJnZXRMaXN0TGFiZWxDbGFzczogICAgICAgInBpY2tMaXN0X3RhcmdldExpc3RMYWJlbCIsCgoJCQkvLyBTb3J0aW5nCgkJCXNvcnRJdGVtczogICAgICAgICAgICAgICAgICB0cnVlLAoJCQlzb3J0QXR0cmlidXRlOiAgICAgICAgICAgICAgImxhYmVsIiwKCQkJc29ydERpcjoJCQkJCSJhc2MiLAoJCQkKCQkJLy8gRW5hYmxlL2Rpc2FibGUKCQkJZW5hYmxlQWRkQWxsOgkJCQl0cnVlLAoJCQllbmFibGVSZW1vdmVBbGw6CQkJdHJ1ZSwKCgkJCS8vIE5hbWUgb2YgY3VzdG9tIHZhbHVlIGF0dHJpYnV0ZSBmb3IgbGlzdCBpdGVtcwoJCQlsaXN0SXRlbVZhbHVlQXR0cmlidXRlOiAgICAgImRhdGEtdmFsdWUiLAoKCQkJLy8gQWRkaXRpb25hbCBsaXN0IGl0ZW1zCgkJCWl0ZW1zOgkJCQkJCVtdLAoJCQlzZWxlY3RMaW1pdDoJCQkJMTAwMDAsCgkJCQoJCQkvLyBjcm9zcy1zY3JpcHRpbmcgb3B0aW9ucwoJCQkvLyBCeSBkZWZhdWx0IHhzcyB3aWxsIHVzZSAuaHRtbCgpIHRvIGRpc3BsYXkgdGV4dCwgYnV0IHRoaXMgc3RyaXBzIG91dCBodG1sIHRhZ3MsIHNvbWV0aW1lcyAKCQkJLy8gICB0aGVzZSB0YWdzIGFyZSBuZWVkZWQuICBJbiB0aGlzIGNhc2VzLCAudGV4dCgpIHNob3VsZCBiZSB1c2VkIGluc3RlYWQsIGJ1dCBvbmx5IGlmCgkJCS8vICAgdGhlIGRldmVsb3BlciBpcyBzdXJlIG5vIGJhZCB4bWwgdGFncyB3aWxsIGJlIGRpc3BsYXllZAoJCQl4c3M6ICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZQoJCX0sCgoJCV9jcmVhdGU6IGZ1bmN0aW9uKCkKCQl7CgkJCXZhciBzZWxmID0gdGhpczsKCgkJCXNlbGYuX2J1aWxkUGlja0xpc3QoKTsKCQkJc2VsZi5fcmVmcmVzaCgpOwoJCX0sCgoJCV9idWlsZFBpY2tMaXN0OiBmdW5jdGlvbigpCgkJewoJCQl2YXIgc2VsZiA9IHRoaXM7CgoJCQlzZWxmLl90cmlnZ2VyKCJiZWZvcmVCdWlsZCIpOwoKCQkJc2VsZi5waWNrTGlzdCA9ICQoIjxkaXYvPiIpCgkJCQkJLmhpZGUoKQoJCQkJCS5hZGRDbGFzcyhzZWxmLm9wdGlvbnMubWFpbkNsYXNzKQoJCQkJCS5pbnNlcnRBZnRlcihzZWxmLmVsZW1lbnQpCgkJCQkJLmFwcGVuZChzZWxmLl9idWlsZFNvdXJjZUxpc3QoKSkKCQkJCQkuYXBwZW5kKHNlbGYuX2J1aWxkQ29udHJvbHMoKSkKCQkJCQkuYXBwZW5kKHNlbGYuX2J1aWxkVGFyZ2V0TGlzdCgpKQoJCQkJCS5hcHBlbmQoICQoIjxkaXYvPiIpLmFkZENsYXNzKHNlbGYub3B0aW9ucy5jbGVhckNsYXNzKSApOwoKCQkJc2VsZi5fcG9wdWxhdGVMaXN0cygpOwoKCQkJc2VsZi5lbGVtZW50LmhpZGUoKTsKCQkJc2VsZi5waWNrTGlzdC5zaG93KCk7CgoJCQlzZWxmLl90cmlnZ2VyKCJhZnRlckJ1aWxkIik7CgkJfSwKCgkJX2J1aWxkU291cmNlTGlzdDogZnVuY3Rpb24oKQoJCXsKCQkJdmFyIHNlbGYgPSB0aGlzOwoKCQkJdmFyIGNvbnRhaW5lciA9ICQoIjxkaXYvPiIpCgkJCQkJLmFkZENsYXNzKHNlbGYub3B0aW9ucy5saXN0Q29udGFpbmVyQ2xhc3MpCgkJCQkJLmFkZENsYXNzKHNlbGYub3B0aW9ucy5zb3VyY2VMaXN0Q29udGFpbmVyQ2xhc3MpCgkJCQkJLmNzcyh7CgkJCQkJCSItbW96LXVzZXItc2VsZWN0IjogIm5vbmUiLAoJCQkJCQkiLXdlYmtpdC11c2VyLXNlbGVjdCI6ICJub25lIiwKCQkJCQkJInVzZXItc2VsZWN0IjogIm5vbmUiLAoJCQkJCQkiLW1zLXVzZXItc2VsZWN0IjogIm5vbmUiCgkJCQkJfSkKCQkJCQkuZWFjaChmdW5jdGlvbigpCgkJCQkJewoJCQkJCQl0aGlzLm9uc2VsZWN0c3RhcnQgPSBmdW5jdGlvbigpIHsgcmV0dXJuIGZhbHNlOyB9OwoJCQkJCX0pOwoKCQkJdmFyIGxhYmVsID0gJCgiPGRpdi8+IikKCQkJCQkudGV4dChzZWxmLm9wdGlvbnMuc291cmNlTGlzdExhYmVsKQoJCQkJCS5hZGRDbGFzcyhzZWxmLm9wdGlvbnMubGlzdExhYmVsQ2xhc3MpCgkJCQkJLmFkZENsYXNzKHNlbGYub3B0aW9ucy5zb3VyY2VMaXN0TGFiZWxDbGFzcyk7CgoJCQlzZWxmLnNvdXJjZUxpc3QgPSAkKCI8dWwvPiIpCgkJCQkJLmFkZENsYXNzKHNlbGYub3B0aW9ucy5saXN0Q2xhc3MpCgkJCQkJLmFkZENsYXNzKHNlbGYub3B0aW9ucy5zb3VyY2VMaXN0Q2xhc3MpCgkJCQkJLnByb3AoInRhYmluZGV4IiwgIjEiKQoJCQkJCS5zZWxlY3RhYmxlKHsgY2FuY2VsOiAnLnVpLXNlbGVjdGVkJyB9KSAvLyByZS1lbmFibGVzIGRibGNsaWNrIGV2ZW50IGFzIGEgc2lkZS1lZmZlY3QKCQkJCQkub24oICJzZWxlY3RhYmxlc2VsZWN0aW5nIiwgZnVuY3Rpb24oIGV2ZW50LCB1aSApIHsgc2VsZi5fcmVmcmVzaENvbnRyb2xzKCk7IH0pCgkJCQkJLm9uKCAic2VsZWN0YWJsZXVuc2VsZWN0aW5nIiwgZnVuY3Rpb24oIGV2ZW50LCB1aSApIHsgc2VsZi5fcmVmcmVzaENvbnRyb2xzKCk7IH0pCgkJCQkJLmRlbGVnYXRlKCIiLCAibW91c2V1cCIsIHsgcGlja0xpc3Q6IHNlbGYgfSwgc2VsZi5fY2hhbmdlSGFuZGxlcik7CgoJCQljb250YWluZXIKCQkJCQkuYXBwZW5kKGxhYmVsKQoJCQkJCS5hcHBlbmQoc2VsZi5zb3VyY2VMaXN0KTsKCgkJCXNlbGYuc291cmNlTGlzdC5kZWxlZ2F0ZSgiLnBpY2tMaXN0X2xpc3RJdGVtIiwgImRibGNsaWNrIiwge3BpY2tMaXN0OiBzZWxmfSwgZnVuY3Rpb24oZSkKCQkJewoJCQkJdmFyIHNlbGYgPSBlLmRhdGEucGlja0xpc3Q7CgkJCQlpZiAoc2VsZi5vcHRpb25zLnNlbGVjdExpbWl0ID4gc2VsZi50YXJnZXRMaXN0LmNoaWxkcmVuKCkubGVuZ3RoKSB7CgkJCQkJc2VsZi5fYWRkSXRlbXMoIHNlbGYuc291cmNlTGlzdC5jaGlsZHJlbigiLnVpLXNlbGVjdGVkIikgKTsKCQkJCX0KCQkJfSk7CgkJCQoJCQlzZWxmLnNvdXJjZUxpc3Qub24oImtleXByZXNzIiwgc2VsZi5fa2V5cHJlc3NIYW5kbGVyKTsKCQkJc2VsZi5zb3VyY2VMaXN0WzBdLm1hdGNoU3RyaW5nID0gIiI7CgoJCQlpZiAoc2VsZi5lbGVtZW50Lmhhc0NsYXNzKCJmb3JtLWVsZW1lbnQtZXJyb3IiKSkgewoJCQkJc2VsZi5zb3VyY2VMaXN0LmFkZENsYXNzKHNlbGYub3B0aW9ucy5lcnJvckNsYXNzKTsKCQkJfQoJCQkKCQkJcmV0dXJuIGNvbnRhaW5lcjsKCQl9LAoKCQlfYnVpbGRUYXJnZXRMaXN0OiBmdW5jdGlvbigpCgkJewoJCQl2YXIgc2VsZiA9IHRoaXM7CgoJCQl2YXIgY29udGFpbmVyID0gJCgiPGRpdi8+IikKCQkJCQkuYWRkQ2xhc3Moc2VsZi5vcHRpb25zLmxpc3RDb250YWluZXJDbGFzcykKCQkJCQkuYWRkQ2xhc3Moc2VsZi5vcHRpb25zLnRhcmdldExpc3RDb250YWluZXJDbGFzcykKCQkJCQkuY3NzKHsKCQkJCQkJIi1tb3otdXNlci1zZWxlY3QiOiAibm9uZSIsCgkJCQkJCSItd2Via2l0LXVzZXItc2VsZWN0IjogIm5vbmUiLAoJCQkJCQkidXNlci1zZWxlY3QiOiAibm9uZSIsCgkJCQkJCSItbXMtdXNlci1zZWxlY3QiOiAibm9uZSIKCQkJCQl9KQoJCQkJCS5lYWNoKGZ1bmN0aW9uKCkKCQkJCQl7CgkJCQkJCXRoaXMub25zZWxlY3RzdGFydCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gZmFsc2U7IH07CgkJCQkJfSk7CgoJCQl2YXIgbGFiZWwgPSAkKCI8ZGl2Lz4iKQoJCQkJCS50ZXh0KHNlbGYub3B0aW9ucy50YXJnZXRMaXN0TGFiZWwpCgkJCQkJLmFkZENsYXNzKHNlbGYub3B0aW9ucy5saXN0TGFiZWxDbGFzcykKCQkJCQkuYWRkQ2xhc3Moc2VsZi5vcHRpb25zLnRhcmdldExpc3RMYWJlbENsYXNzKTsKCgkJCXNlbGYudGFyZ2V0TGlzdCA9ICQoIjx1bC8+IikKCQkJCQkuYWRkQ2xhc3Moc2VsZi5vcHRpb25zLmxpc3RDbGFzcykKCQkJCQkuYWRkQ2xhc3Moc2VsZi5vcHRpb25zLnRhcmdldExpc3RDbGFzcykKCQkJCQkuc2VsZWN0YWJsZSh7IGNhbmNlbDogJy51aS1zZWxlY3RlZCcgfSkgLy8gcmUtZW5hYmxlcyBkYmxjbGljayBldmVudCBhcyBhIHNpZGUtZWZmZWN0CgkJCQkJLm9uKCAic2VsZWN0YWJsZXNlbGVjdGluZyIsIGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7IHNlbGYuX3JlZnJlc2hDb250cm9scygpOyB9KQoJCQkJCS5vbiggInNlbGVjdGFibGV1bnNlbGVjdGluZyIsIGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7IHNlbGYuX3JlZnJlc2hDb250cm9scygpOyB9KQoJCQkJCS5kZWxlZ2F0ZSgiIiwgIm1vdXNldXAiLCB7IHBpY2tMaXN0OiBzZWxmIH0sIHNlbGYuX2NoYW5nZUhhbmRsZXIpCgkJCQkJLnByb3AoInRhYmluZGV4IiwgIjIiKTsKCgkJCWNvbnRhaW5lcgoJCQkJCS5hcHBlbmQobGFiZWwpCgkJCQkJLmFwcGVuZChzZWxmLnRhcmdldExpc3QpOwoKCQkJc2VsZi50YXJnZXRMaXN0LmRlbGVnYXRlKCIucGlja0xpc3RfbGlzdEl0ZW0iLCAiZGJsY2xpY2siLCB7cGlja0xpc3Q6IHNlbGZ9LCBmdW5jdGlvbihlKQoJCQl7CgkJCQl2YXIgc2VsZiA9IGUuZGF0YS5waWNrTGlzdDsKCQkJCXNlbGYuX3JlbW92ZUl0ZW1zKCBzZWxmLnRhcmdldExpc3QuY2hpbGRyZW4oIi51aS1zZWxlY3RlZCIpICk7CgkJCX0pOwoJCQkKCQkJc2VsZi50YXJnZXRMaXN0Lm9uKCJrZXlwcmVzcyIsIHNlbGYuX2tleXByZXNzSGFuZGxlcik7CgkJCXNlbGYudGFyZ2V0TGlzdFswXS5tYXRjaFN0cmluZyA9ICIiOwoKCQkJaWYgKHNlbGYuZWxlbWVudC5oYXNDbGFzcygiZm9ybS1lbGVtZW50LWVycm9yIikpIHsKCQkJCXNlbGYudGFyZ2V0TGlzdC5hZGRDbGFzcyhzZWxmLm9wdGlvbnMuZXJyb3JDbGFzcyk7CgkJCX0KCQkJCgkJCXJldHVybiBjb250YWluZXI7CgkJfSwKCgkJX2J1aWxkQ29udHJvbHM6IGZ1bmN0aW9uKCkKCQl7CgkJCXZhciBzZWxmID0gdGhpczsKCgkJCXNlbGYuY29udHJvbHMgPSAkKCI8ZGl2Lz4iKS5hZGRDbGFzcyhzZWxmLm9wdGlvbnMuY29udHJvbHNDb250YWluZXJDbGFzcyk7CgoJCQlzZWxmLmFkZEFsbEJ1dHRvbiA9ICQoIjxidXR0b24gdHlwZT0nYnV0dG9uJy8+IikuY2xpY2soe3BpY2tMaXN0OiBzZWxmfSwgc2VsZi5fYWRkQWxsSGFuZGxlcikuaHRtbChzZWxmLm9wdGlvbnMuYWRkQWxsTGFiZWwpLmFkZENsYXNzKHNlbGYub3B0aW9ucy5hZGRBbGxDbGFzcyk7CQkKCQkJc2VsZi5hZGRCdXR0b24gPSAkKCI8YnV0dG9uIHR5cGU9J2J1dHRvbicvPiIpLmNsaWNrKHtwaWNrTGlzdDogc2VsZn0sIHNlbGYuX2FkZEhhbmRsZXIpLmh0bWwoc2VsZi5vcHRpb25zLmFkZExhYmVsKS5hZGRDbGFzcyhzZWxmLm9wdGlvbnMuYWRkQ2xhc3MpOwoJCQlzZWxmLnJlbW92ZUJ1dHRvbiA9ICQoIjxidXR0b24gdHlwZT0nYnV0dG9uJy8+IikuY2xpY2soe3BpY2tMaXN0OiBzZWxmfSwgc2VsZi5fcmVtb3ZlSGFuZGxlcikuaHRtbChzZWxmLm9wdGlvbnMucmVtb3ZlTGFiZWwpLmFkZENsYXNzKHNlbGYub3B0aW9ucy5yZW1vdmVDbGFzcyk7CgkJCXNlbGYucmVtb3ZlQWxsQnV0dG9uID0gJCgiPGJ1dHRvbiB0eXBlPSdidXR0b24nLz4iKS5jbGljayh7cGlja0xpc3Q6IHNlbGZ9LCBzZWxmLl9yZW1vdmVBbGxIYW5kbGVyKS5odG1sKHNlbGYub3B0aW9ucy5yZW1vdmVBbGxMYWJlbCkuYWRkQ2xhc3Moc2VsZi5vcHRpb25zLnJlbW92ZUFsbENsYXNzKTsKCgkJCWlmIChzZWxmLm9wdGlvbnMuZW5hYmxlQWRkQWxsKSB7CgkJCQlzZWxmLmNvbnRyb2xzLmFwcGVuZChzZWxmLmFkZEFsbEJ1dHRvbik7CgkJCX0KCQkJc2VsZi5jb250cm9scy5hcHBlbmQoc2VsZi5hZGRCdXR0b24pOwoJCQlzZWxmLmNvbnRyb2xzLmFwcGVuZChzZWxmLnJlbW92ZUJ1dHRvbik7CgkJCWlmIChzZWxmLm9wdGlvbnMuZW5hYmxlUmVtb3ZlQWxsKSB7CgkJCQlzZWxmLmNvbnRyb2xzLmFwcGVuZChzZWxmLnJlbW92ZUFsbEJ1dHRvbik7CgkJCX0KCgkJCXJldHVybiBzZWxmLmNvbnRyb2xzOwoJCX0sCgoJCV9wb3B1bGF0ZUxpc3RzOiBmdW5jdGlvbigpCgkJewoJCQl2YXIgc2VsZiA9IHRoaXM7CgoJCQlzZWxmLl90cmlnZ2VyKCJiZWZvcmVQb3B1bGF0ZSIpOwoKCQkJdmFyIHNvdXJjZUxpc3RJdGVtcyA9IFtdOwoJCQl2YXIgdGFyZ2V0TGlzdEl0ZW1zID0gW107CgkJCXZhciBzZWxlY3RJdGVtcyA9IHNlbGYuZWxlbWVudC5jaGlsZHJlbigpOwoKCQkJc2VsZWN0SXRlbXMubm90KCI6c2VsZWN0ZWQiKS5lYWNoKGZ1bmN0aW9uKCkKCQkJewoJCQkJc291cmNlTGlzdEl0ZW1zLnB1c2goIHNlbGYuX2NyZWF0ZURvcHBlbGdhbmdlcih0aGlzKSApOwoJCQl9KTsKCgkJCXNlbGVjdEl0ZW1zLmZpbHRlcigiOnNlbGVjdGVkIikuZWFjaChmdW5jdGlvbigpCgkJCXsKCQkJCXRhcmdldExpc3RJdGVtcy5wdXNoKCBzZWxmLl9jcmVhdGVEb3BwZWxnYW5nZXIodGhpcykgKTsKCQkJfSk7CgoJCQlzZWxmLnNvdXJjZUxpc3QuYXBwZW5kKHNvdXJjZUxpc3RJdGVtcy5qb2luKCJcbiIpKTsKCQkJc2VsZi50YXJnZXRMaXN0LmFwcGVuZCh0YXJnZXRMaXN0SXRlbXMuam9pbigiXG4iKSk7CgkJCXNlbGYuaW5zZXJ0SXRlbXMoc2VsZi5vcHRpb25zLml0ZW1zKTsKCgkJCXNlbGYuX3RyaWdnZXIoImFmdGVyUG9wdWxhdGUiKTsKCQl9LAoKCQlfYWRkSXRlbXM6IGZ1bmN0aW9uKGl0ZW1zKQoJCXsKCQkJdmFyIHNlbGYgPSB0aGlzOwoJCQkKCQkJc2VsZi5fdHJpZ2dlcigiYmVmb3JlQWRkIik7CgoJCQlzZWxmLnRhcmdldExpc3QuYXBwZW5kKCBzZWxmLl9yZW1vdmVTZWxlY3Rpb25zKGl0ZW1zKSApOwoKCQkJdmFyIGl0ZW1JZHMgPSBbXTsKCQkJaXRlbXMuZWFjaChmdW5jdGlvbigpCgkJCXsKCQkJCWl0ZW1JZHMucHVzaCggc2VsZi5fZ2V0SXRlbVZhbHVlKHRoaXMpICk7CgkJCX0pOwoKCQkJc2VsZi5lbGVtZW50LmNoaWxkcmVuKCkuZmlsdGVyKGZ1bmN0aW9uKCkKCQkJewoJCQkJcmV0dXJuICQuaW5BcnJheSh0aGlzLnZhbHVlLCBpdGVtSWRzKSAhPSAtMTsKCQkJfSkucHJvcCgic2VsZWN0ZWQiLCB0cnVlKTsKCgkJCXNlbGYuX3JlZnJlc2goKTsKCgkJCXNlbGYuX3RyaWdnZXIoImFmdGVyQWRkIiwgbnVsbCwgeyBpdGVtczogaXRlbXMgfSk7CgkJCXNlbGYuX3RyaWdnZXIoIm9uQ2hhbmdlIiwgbnVsbCwgeyB0eXBlOiAiYWRkIiwgaXRlbXM6IGl0ZW1zIH0pOwoJCX0sCgoJCV9yZW1vdmVJdGVtczogZnVuY3Rpb24oaXRlbXMpCgkJewoJCQl2YXIgc2VsZiA9IHRoaXM7CgkJCQoJCQlzZWxmLl90cmlnZ2VyKCJiZWZvcmVSZW1vdmUiKTsKCgkJCXNlbGYuc291cmNlTGlzdC5hcHBlbmQoIHNlbGYuX3JlbW92ZVNlbGVjdGlvbnMoaXRlbXMpICk7CgoJCQl2YXIgaXRlbUlkcyA9IFtdOwoJCQlpdGVtcy5lYWNoKGZ1bmN0aW9uKCkKCQkJewoJCQkJaXRlbUlkcy5wdXNoKCBzZWxmLl9nZXRJdGVtVmFsdWUodGhpcykgKTsKCQkJfSk7CgoJCQlzZWxmLmVsZW1lbnQuY2hpbGRyZW4oKS5maWx0ZXIoZnVuY3Rpb24oKQoJCQl7CgkJCQlyZXR1cm4gJC5pbkFycmF5KHRoaXMudmFsdWUsIGl0ZW1JZHMpICE9IC0xOwoJCQl9KS5wcm9wKCJzZWxlY3RlZCIsIGZhbHNlKTsKCgkJCXNlbGYuX3JlZnJlc2goKTsKCgkJCXNlbGYuX3RyaWdnZXIoImFmdGVyUmVtb3ZlIiwgbnVsbCwgeyBpdGVtczogaXRlbXMgfSk7CgkJCXNlbGYuX3RyaWdnZXIoIm9uQ2hhbmdlIiwgbnVsbCwgeyB0eXBlOiAicmVtb3ZlIiwgaXRlbXM6IGl0ZW1zIH0pOwoJCX0sCgoJCV9hZGRBbGxIYW5kbGVyOiBmdW5jdGlvbihlKQoJCXsKCQkJdmFyIHNlbGYgPSBlLmRhdGEucGlja0xpc3Q7CgoJCQlzZWxmLl90cmlnZ2VyKCJiZWZvcmVBZGRBbGwiKTsKCgkJCXZhciBpdGVtcyA9IHNlbGYuc291cmNlTGlzdC5jaGlsZHJlbigpOwoJCQlzZWxmLnRhcmdldExpc3QuYXBwZW5kKCBzZWxmLl9yZW1vdmVTZWxlY3Rpb25zKGl0ZW1zKSApOwoKCQkJc2VsZi5lbGVtZW50LmNoaWxkcmVuKCkubm90KCI6c2VsZWN0ZWQiKS5wcm9wKCJzZWxlY3RlZCIsIHRydWUpOwoKCQkJc2VsZi5fcmVmcmVzaCgpOwoKCQkJc2VsZi5fdHJpZ2dlcigiYWZ0ZXJBZGRBbGwiLCBudWxsLCB7IGl0ZW1zOiBpdGVtcyB9KTsKCQkJc2VsZi5fdHJpZ2dlcigib25DaGFuZ2UiLCBudWxsLCB7IHR5cGU6ICJhZGRBbGwiLCBpdGVtczogaXRlbXMgfSk7CgkJfSwKCgkJX2FkZEhhbmRsZXI6IGZ1bmN0aW9uKGUpCgkJewoJCQl2YXIgc2VsZiA9IGUuZGF0YS5waWNrTGlzdDsKCQkJdmFyIGl0ZW1zU2VsZWN0ZWRDb3VudCA9IHNlbGYuc291cmNlTGlzdC5jaGlsZHJlbigiLnVpLXNlbGVjdGVkIikubGVuZ3RoOwoJCQl2YXIgaXRlbXNBbHJlYWR5VGFyZ2V0dGVkQ291bnQgPSBzZWxmLnRhcmdldExpc3QuY2hpbGRyZW4oKS5sZW5ndGg7CgkJCXZhciBzcGFjZXNBdmFpbGFibGVDb3VudCA9IHNlbGYub3B0aW9ucy5zZWxlY3RMaW1pdCAtIGl0ZW1zQWxyZWFkeVRhcmdldHRlZENvdW50OwoJCQlpZiAoc2VsZi5vcHRpb25zLnNlbGVjdExpbWl0ID4gaXRlbXNBbHJlYWR5VGFyZ2V0dGVkQ291bnQgJiYgc3BhY2VzQXZhaWxhYmxlQ291bnQgPj0gaXRlbXNTZWxlY3RlZENvdW50KSB7CgkJCQlzZWxmLl9hZGRJdGVtcyhzZWxmLnNvdXJjZUxpc3QuY2hpbGRyZW4oIi51aS1zZWxlY3RlZCIpKTsKCQkJfQoJCX0sCgoJCV9yZW1vdmVIYW5kbGVyOiBmdW5jdGlvbihlKQoJCXsKCQkJdmFyIHNlbGYgPSBlLmRhdGEucGlja0xpc3Q7CgkJCXNlbGYuX3JlbW92ZUl0ZW1zKHNlbGYudGFyZ2V0TGlzdC5jaGlsZHJlbigiLnVpLXNlbGVjdGVkIikpOwoJCX0sCgoJCV9yZW1vdmVBbGxIYW5kbGVyOiBmdW5jdGlvbihlKQoJCXsKCQkJdmFyIHNlbGYgPSBlLmRhdGEucGlja0xpc3Q7CgoJCQlzZWxmLl90cmlnZ2VyKCJiZWZvcmVSZW1vdmVBbGwiKTsKCgkJCXZhciBpdGVtcyA9IHNlbGYudGFyZ2V0TGlzdC5jaGlsZHJlbigpOwoJCQlzZWxmLnNvdXJjZUxpc3QuYXBwZW5kKCBzZWxmLl9yZW1vdmVTZWxlY3Rpb25zKGl0ZW1zKSApOwoKCQkJc2VsZi5lbGVtZW50LmNoaWxkcmVuKCkuZmlsdGVyKCI6c2VsZWN0ZWQiKS5wcm9wKCJzZWxlY3RlZCIsIGZhbHNlKTsKCgkJCXNlbGYuX3JlZnJlc2goKTsKCgkJCXNlbGYuX3RyaWdnZXIoImFmdGVyUmVtb3ZlQWxsIiwgbnVsbCwgeyBpdGVtczogaXRlbXMgfSk7CgkJCXNlbGYuX3RyaWdnZXIoIm9uQ2hhbmdlIiwgbnVsbCwgeyB0eXBlOiAicmVtb3ZlQWxsIiwgaXRlbXM6IGl0ZW1zIH0pOwoJCX0sCgkJCgkJX2tleXByZXNzSGFuZGxlcjogZnVuY3Rpb24oZSkgewoJCQl2YXIgYyA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZS53aGljaCk7CgkJCXZhciB0ZXN0U3RyID0gdGhpcy5tYXRjaFN0cmluZyArIGM7CgkJCXZhciBsaSA9ICQodGhpcykuY2hpbGRyZW4oJ2xpW2xhYmVsXj0iJyt0ZXN0U3RyKyciXScpLmZpcnN0KCk7CgkJCWlmIChsaS5zaXplKCkgPT0gMCkgewoJCQkJdGVzdFN0ciA9IHRoaXMubWF0Y2hTdHJpbmcgKyBjLnRvVXBwZXJDYXNlKCk7CgkJCQlsaSA9ICQodGhpcykuY2hpbGRyZW4oJ2xpW2xhYmVsXj0iJyt0ZXN0U3RyKyciXScpLmZpcnN0KCk7CgkJCX0KCQkJaWYgKGxpLnNpemUoKSA+IDApIHsKCQkJCSQodGhpcykuY2hpbGRyZW4oImxpIikucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGVkIik7CgkJCQlsaS5hZGRDbGFzcygidWktc2VsZWN0ZWQiKTsKCQkJCSQodGhpcykuc2Nyb2xsVG8obGkpOwoJCQl9CgoJCQl2YXIgc2VsZiA9IHRoaXM7CgkJCXRoaXMubWF0Y2hTdHJpbmcgPSB0ZXN0U3RyOwoJCQljbGVhclRpbWVvdXQodGhpcy50aW1lcklkKTsKCQkJdGhpcy50aW1lcklkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtzZWxmLm1hdGNoU3RyaW5nID0gIiI7fSwgNTAwKTsKCQl9LAoKCQlfcmVmcmVzaDogZnVuY3Rpb24oKQoJCXsKCQkJdmFyIHNlbGYgPSB0aGlzOwoKCQkJc2VsZi5fdHJpZ2dlcigiYmVmb3JlUmVmcmVzaCIpOwoKCQkJc2VsZi5fcmVmcmVzaENvbnRyb2xzKCk7CgoJCQkvLyBTb3J0IHRoZSBzZWxlY3Rpb24gbGlzdHMuCgkJCWlmKHNlbGYub3B0aW9ucy5zb3J0SXRlbXMpCgkJCXsKCQkJCXNlbGYuX3NvcnRJdGVtcyhzZWxmLnNvdXJjZUxpc3QsIHNlbGYub3B0aW9ucyk7CgkJCQlzZWxmLl9zb3J0SXRlbXMoc2VsZi50YXJnZXRMaXN0LCBzZWxmLm9wdGlvbnMpOwoJCQl9CgoJCQlzZWxmLl90cmlnZ2VyKCJhZnRlclJlZnJlc2giKTsKCQl9LAoKCQlfcmVmcmVzaENvbnRyb2xzOiBmdW5jdGlvbigpCgkJewoJCQl2YXIgc2VsZiA9IHRoaXM7CgoJCQlzZWxmLl90cmlnZ2VyKCJiZWZvcmVSZWZyZXNoQ29udHJvbHMiKTsKCgkJCS8vIEVuYWJsZS9kaXNhYmxlIHRoZSBBZGQgQWxsIGJ1dHRvbiBzdGF0ZS4KCQkJaWYoc2VsZi5zb3VyY2VMaXN0LmNoaWxkcmVuKCkubGVuZ3RoKQoJCQl7CgkJCQlzZWxmLmFkZEFsbEJ1dHRvbi5yZW1vdmVBdHRyKCJkaXNhYmxlZCIpOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJc2VsZi5hZGRBbGxCdXR0b24uYXR0cigiZGlzYWJsZWQiLCAiZGlzYWJsZWQiKTsKCQkJfQoKCQkJLy8gRW5hYmxlL2Rpc2FibGUgdGhlIFJlbW92ZSBBbGwgYnV0dG9uIHN0YXRlLgoJCQlpZihzZWxmLnRhcmdldExpc3QuY2hpbGRyZW4oKS5sZW5ndGgpCgkJCXsKCQkJCXNlbGYucmVtb3ZlQWxsQnV0dG9uLnJlbW92ZUF0dHIoImRpc2FibGVkIik7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlzZWxmLnJlbW92ZUFsbEJ1dHRvbi5hdHRyKCJkaXNhYmxlZCIsICJkaXNhYmxlZCIpOwoJCQl9CgoJCQkvLyBFbmFibGUvZGlzYWJsZSB0aGUgQWRkIGJ1dHRvbiBzdGF0ZS4KCQkJdmFyIHNlbGVjdGVkU291cmNlQ291bnQgPSBzZWxmLnNvdXJjZUxpc3QuY2hpbGRyZW4oIi51aS1zZWxlY3RpbmcsIC51aS1zZWxlY3RlZCIpLmxlbmd0aDsKCQkJdmFyIHRhcmdldENvdW50ID0gc2VsZi50YXJnZXRMaXN0LmNoaWxkcmVuKCkubGVuZ3RoOwoJCQlpZihzZWxlY3RlZFNvdXJjZUNvdW50ICYmIHNlbGYub3B0aW9ucy5zZWxlY3RMaW1pdCA+PSAoc2VsZWN0ZWRTb3VyY2VDb3VudCArIHRhcmdldENvdW50KSkKCQkJewoJCQkJc2VsZi5hZGRCdXR0b24ucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXNlbGYuYWRkQnV0dG9uLmF0dHIoImRpc2FibGVkIiwgImRpc2FibGVkIik7CgkJCX0KCgkJCS8vIEVuYWJsZS9kaXNhYmxlIHRoZSBSZW1vdmUgYnV0dG9uIHN0YXRlLgoJCQlpZihzZWxmLnRhcmdldExpc3QuY2hpbGRyZW4oIi51aS1zZWxlY3RpbmcsIC51aS1zZWxlY3RlZCIpLmxlbmd0aCkKCQkJewoJCQkJc2VsZi5yZW1vdmVCdXR0b24ucmVtb3ZlQXR0cigiZGlzYWJsZWQiKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXNlbGYucmVtb3ZlQnV0dG9uLmF0dHIoImRpc2FibGVkIiwgImRpc2FibGVkIik7CgkJCX0KCgkJCXNlbGYuX3RyaWdnZXIoImFmdGVyUmVmcmVzaENvbnRyb2xzIik7CgkJfSwKCgkJX3NvcnRJdGVtczogZnVuY3Rpb24obGlzdCwgb3B0aW9ucykKCQl7CgkJCXZhciBpdGVtcyA9IG5ldyBBcnJheSgpOwoJCQl2YXIgc29ydERpciA9IChvcHRpb25zLnNvcnREaXIgPT0gImFzYyIpID8gMSA6IC0xOwoKCQkJbGlzdC5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKQoJCQl7CgkJCQlpdGVtcy5wdXNoKCAkKHRoaXMpICk7CgkJCX0pOwoKCQkJaXRlbXMuc29ydChmdW5jdGlvbihhLCBiKQoJCQl7CgkJCQlpZihhLmF0dHIob3B0aW9ucy5zb3J0QXR0cmlidXRlKSA+IGIuYXR0cihvcHRpb25zLnNvcnRBdHRyaWJ1dGUpKQoJCQkJewoJCQkJCXJldHVybiAxICogc29ydERpcjsKCQkJCX0KCQkJCWVsc2UgaWYoYS5hdHRyKG9wdGlvbnMuc29ydEF0dHJpYnV0ZSkgPT0gYi5hdHRyKG9wdGlvbnMuc29ydEF0dHJpYnV0ZSkpCgkJCQl7CgkJCQkJcmV0dXJuIDA7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJcmV0dXJuIC0xICogc29ydERpcjsKCQkJCX0KCQkJfSk7CgoJCQlsaXN0LmVtcHR5KCk7CgoJCQlmb3IodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspCgkJCXsKCQkJCWxpc3QuYXBwZW5kKGl0ZW1zW2ldKTsKCQkJfQoJCX0sCgoJCV9jaGFuZ2VIYW5kbGVyOiBmdW5jdGlvbihlKQoJCXsKCQkJdmFyIHNlbGYgPSBlLmRhdGEucGlja0xpc3Q7CgkJCSQodGhpcykuZm9jdXMoKTsKCQkJc2VsZi5fcmVmcmVzaENvbnRyb2xzKCk7CgkJfSwKCgkJX3JlbW92ZVNlbGVjdGlvbjogZnVuY3Rpb24obGlzdEl0ZW0pCgkJewoJCQl2YXIgc2VsZiA9IHRoaXM7CgoJCQlyZXR1cm4gbGlzdEl0ZW0KCQkJCQkucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGVkIikKCQkJCQkucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhpZ2hsaWdodCIpCgkJCQkJLnJlbW92ZUNsYXNzKHNlbGYub3B0aW9ucy5zZWxlY3RlZExpc3RJdGVtQ2xhc3MpOwoJCX0sCgoJCV9yZW1vdmVTZWxlY3Rpb25zOiBmdW5jdGlvbihsaXN0SXRlbXMpCgkJewoJCQl2YXIgc2VsZiA9IHRoaXM7CgoJCQlsaXN0SXRlbXMuZWFjaChmdW5jdGlvbigpCgkJCXsKCQkJCSQodGhpcykKCQkJCQkJLnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RlZCIpCgkJCQkJCS5yZW1vdmVDbGFzcygidWktc3RhdGUtaGlnaGxpZ2h0IikKCQkJCQkJLnJlbW92ZUNsYXNzKHNlbGYub3B0aW9ucy5zZWxlY3RlZExpc3RJdGVtQ2xhc3MpOwoJCQl9KTsKCgkJCXJldHVybiBsaXN0SXRlbXM7CgkJfSwKCgkJX3NldE9wdGlvbjogZnVuY3Rpb24oa2V5LCB2YWx1ZSkKCQl7CgkJCXN3aXRjaChrZXkpCgkJCXsKCQkJCWNhc2UgImNsZWFyIjoKCQkJCXsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoKCQkJJC5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQl9LAoKCQlkZXN0cm95OiBmdW5jdGlvbigpCgkJewoJCQl2YXIgc2VsZiA9IHRoaXM7CgoJCQlzZWxmLl90cmlnZ2VyKCJvbkRlc3Ryb3kiKTsKCgkJCXNlbGYucGlja0xpc3QucmVtb3ZlKCk7CgkJCXNlbGYuZWxlbWVudC5zaG93KCk7CgoJCQkkLldpZGdldC5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHNlbGYpOwoJCX0sCgoJCWluc2VydEl0ZW1zOiBmdW5jdGlvbihpdGVtcykKCQl7CgkJCXZhciBzZWxmID0gdGhpczsKCgkJCXZhciBzZWxlY3RJdGVtcyA9IFtdOwoJCQl2YXIgc291cmNlSXRlbXMgPSBbXTsKCQkJdmFyIHRhcmdldEl0ZW1zID0gW107CgoJCQkkKGl0ZW1zKS5lYWNoKGZ1bmN0aW9uKCkKCQkJewoJCQkJdmFyIHNlbGVjdEl0ZW0gPSBzZWxmLl9jcmVhdGVTZWxlY3RJdGVtKHRoaXMpOwoJCQkJdmFyIGxpc3RJdGVtID0gc2VsZi5fY3JlYXRlTGlzdEl0ZW0odGhpcyk7CgoJCQkJc2VsZWN0SXRlbXMucHVzaChzZWxlY3RJdGVtKTsKCgkJCQlpZih0aGlzLnNlbGVjdGVkKQoJCQkJewoJCQkJCXRhcmdldEl0ZW1zLnB1c2gobGlzdEl0ZW0pOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCXNvdXJjZUl0ZW1zLnB1c2gobGlzdEl0ZW0pOwoJCQkJfQoJCQl9KTsKCgkJCXNlbGYuZWxlbWVudC5hcHBlbmQoc2VsZWN0SXRlbXMuam9pbigiXG4iKSk7CgkJCXNlbGYuc291cmNlTGlzdC5hcHBlbmQoc291cmNlSXRlbXMuam9pbigiXG4iKSk7CgkJCXNlbGYudGFyZ2V0TGlzdC5hcHBlbmQodGFyZ2V0SXRlbXMuam9pbigiXG4iKSk7CgoJCQlzZWxmLl9yZWZyZXNoKCk7CgkJfSwKCgkJX2NyZWF0ZVNlbGVjdEl0ZW06IGZ1bmN0aW9uKGl0ZW0pCgkJewoJCQl2YXIgc2VsZWN0ZWQgPSBpdGVtLnNlbGVjdGVkID8gIiBzZWxlY3RlZD0nc2VsZWN0ZWQnIiA6ICIiOwoJCQlyZXR1cm4gIjxvcHRpb24gdmFsdWU9JyIgKyBpdGVtLnZhbHVlICsgIiciICsgc2VsZWN0ZWQgKyAiPiIgKyBpdGVtLmxhYmVsICsgIjwvb3B0aW9uPiI7CgkJfSwKCgkJX2NyZWF0ZUxpc3RJdGVtOiBmdW5jdGlvbihpdGVtKQoJCXsKCQkJdmFyIHNlbGYgPSB0aGlzOwoKCQkJaWYoaXRlbS5lbGVtZW50ICE9IHVuZGVmaW5lZCkKCQkJewoJCQkJdmFyIHJpY2hJdGVtSHRtbCA9IGl0ZW0uZWxlbWVudC5jbG9uZSgpLndyYXAoIjxkaXY+IikucGFyZW50KCkuaHRtbCgpOwoJCQkJaXRlbS5lbGVtZW50LmhpZGUoKTsKCQkJCXJldHVybiAiPGxpICIgKyBzZWxmLm9wdGlvbnMubGlzdEl0ZW1WYWx1ZUF0dHJpYnV0ZSArICI9JyIgKyBpdGVtLnZhbHVlICsgIicgbGFiZWw9JyIgKyBpdGVtLmxhYmVsICsgIicgY2xhc3M9JyIgKyBzZWxmLm9wdGlvbnMubGlzdEl0ZW1DbGFzcyArICIgIiArIHNlbGYub3B0aW9ucy5yaWNoTGlzdEl0ZW1DbGFzcyArICInPiIgKyByaWNoSXRlbUh0bWwgKyAiPC9saT4iOwoJCQl9CgoJCQlyZXR1cm4gIjxsaSAiICsgc2VsZi5vcHRpb25zLmxpc3RJdGVtVmFsdWVBdHRyaWJ1dGUgKyAiPSciICsgaXRlbS52YWx1ZSArICInIGxhYmVsPSciICsgaXRlbS5sYWJlbCArICInIGNsYXNzPSciICsgc2VsZi5vcHRpb25zLmxpc3RJdGVtQ2xhc3MgKyAiJz4iICsgaXRlbS5sYWJlbCArICI8L2xpPiI7CgkJfSwKCgkJX2NyZWF0ZURvcHBlbGdhbmdlcjogZnVuY3Rpb24oaXRlbSkKCQl7CgkJCXZhciBzZWxmID0gdGhpczsKCQkJaWYgKHNlbGYub3B0aW9ucy54c3MpIHsJCQkJCgkJCQlyZXR1cm4gIjxsaSAiICsgc2VsZi5vcHRpb25zLmxpc3RJdGVtVmFsdWVBdHRyaWJ1dGUgKyAiPSciICsgJChpdGVtKS52YWwoKSArICInIGxhYmVsPSciICsgJChpdGVtKS5odG1sKCkgKyAiJyBjbGFzcz0nIiArIHNlbGYub3B0aW9ucy5saXN0SXRlbUNsYXNzICsgIic+IiArICQoaXRlbSkuaHRtbCgpICsgIjwvbGk+IjsKCQkJfQoJCQllbHNlIHsKCQkJCXJldHVybiAiPGxpICIgKyBzZWxmLm9wdGlvbnMubGlzdEl0ZW1WYWx1ZUF0dHJpYnV0ZSArICI9JyIgKyAkKGl0ZW0pLnZhbCgpICsgIicgbGFiZWw9JyIgKyAkKGl0ZW0pLnRleHQoKSArICInIGNsYXNzPSciICsgc2VsZi5vcHRpb25zLmxpc3RJdGVtQ2xhc3MgKyAiJz4iICsgJChpdGVtKS50ZXh0KCkgKyAiPC9saT4iOwoJCQl9CgkJfSwKCgkJX2dldEl0ZW1WYWx1ZTogZnVuY3Rpb24oaXRlbSkKCQl7CgkJCXZhciBzZWxmID0gdGhpczsKCQkJcmV0dXJuICQoaXRlbSkuYXR0cihzZWxmLm9wdGlvbnMubGlzdEl0ZW1WYWx1ZUF0dHJpYnV0ZSk7CgkJfQoJfSk7Cn0oalF1ZXJ5KSk7Cg==",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 309,
          "bodySize": 21836
        },
        "cache": {},
        "timings": {
          "send": 18,
          "wait": 1,
          "receive": 7
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8638"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 116,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/jquery/jquery.scrollTo.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 370,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "2730"
            }
          ],
          "content": {
            "size": 7476,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "LyohCiAqIGpRdWVyeS5zY3JvbGxUbwogKiBDb3B5cmlnaHQgKGMpIDIwMDctMjAxNCBBcmllbCBGbGVzbGVyIC0gYWZsZXNsZXI8YT5nbWFpbDxkPmNvbSB8IGh0dHA6Ly9mbGVzbGVyLmJsb2dzcG90LmNvbQogKiBMaWNlbnNlZCB1bmRlciBNSVQKICogaHR0cDovL2ZsZXNsZXIuYmxvZ3Nwb3QuY29tLzIwMDcvMTAvanF1ZXJ5c2Nyb2xsdG8uaHRtbAogKiBAcHJvamVjdERlc2NyaXB0aW9uIEVhc3kgZWxlbWVudCBzY3JvbGxpbmcgdXNpbmcgalF1ZXJ5LgogKiBAYXV0aG9yIEFyaWVsIEZsZXNsZXIKICogQHZlcnNpb24gMS40LjEzCiAqLwo7KGZ1bmN0aW9uIChkZWZpbmUpIHsKCSd1c2Ugc3RyaWN0JzsKCglkZWZpbmUoWydqcXVlcnknXSwgZnVuY3Rpb24gKCQpIHsKCgkJdmFyICRzY3JvbGxUbyA9ICQuc2Nyb2xsVG8gPSBmdW5jdGlvbiggdGFyZ2V0LCBkdXJhdGlvbiwgc2V0dGluZ3MgKSB7CgkJCXJldHVybiAkKHdpbmRvdykuc2Nyb2xsVG8oIHRhcmdldCwgZHVyYXRpb24sIHNldHRpbmdzICk7CgkJfTsKCgkJJHNjcm9sbFRvLmRlZmF1bHRzID0gewoJCQlheGlzOid4eScsCgkJCWR1cmF0aW9uOiBwYXJzZUZsb2F0KCQuZm4uanF1ZXJ5KSA+PSAxLjMgPyAwIDogMSwKCQkJbGltaXQ6dHJ1ZQoJCX07CgoJCS8vIFJldHVybnMgdGhlIGVsZW1lbnQgdGhhdCBuZWVkcyB0byBiZSBhbmltYXRlZCB0byBzY3JvbGwgdGhlIHdpbmRvdy4KCQkvLyBLZXB0IGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSAoc3BlY2lhbGx5IGZvciBsb2NhbFNjcm9sbCAmIHNlcmlhbFNjcm9sbCkKCQkkc2Nyb2xsVG8ud2luZG93ID0gZnVuY3Rpb24oIHNjb3BlICkgewoJCQlyZXR1cm4gJCh3aW5kb3cpLl9zY3JvbGxhYmxlKCk7CgkJfTsKCgkJLy8gSGFjaywgaGFjaywgaGFjayA6KQoJCS8vIFJldHVybnMgdGhlIHJlYWwgZWxlbWVudHMgdG8gc2Nyb2xsIChzdXBwb3J0cyB3aW5kb3cvaWZyYW1lcywgZG9jdW1lbnRzIGFuZCByZWd1bGFyIG5vZGVzKQoJCSQuZm4uX3Njcm9sbGFibGUgPSBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQkJdmFyIGVsZW0gPSB0aGlzLAoJCQkJCWlzV2luID0gIWVsZW0ubm9kZU5hbWUgfHwgJC5pbkFycmF5KCBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksIFsnaWZyYW1lJywnI2RvY3VtZW50JywnaHRtbCcsJ2JvZHknXSApICE9IC0xOwoKCQkJCQlpZiAoIWlzV2luKQoJCQkJCQlyZXR1cm4gZWxlbTsKCgkJCQl2YXIgZG9jID0gKGVsZW0uY29udGVudFdpbmRvdyB8fCBlbGVtKS5kb2N1bWVudCB8fCBlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbTsKCgkJCQlyZXR1cm4gL3dlYmtpdC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgfHwgZG9jLmNvbXBhdE1vZGUgPT0gJ0JhY2tDb21wYXQnID8KCQkJCQlkb2MuYm9keSA6CgkJCQkJZG9jLmRvY3VtZW50RWxlbWVudDsKCQkJfSk7CgkJfTsKCgkJJC5mbi5zY3JvbGxUbyA9IGZ1bmN0aW9uKCB0YXJnZXQsIGR1cmF0aW9uLCBzZXR0aW5ncyApIHsKCQkJaWYgKHR5cGVvZiBkdXJhdGlvbiA9PSAnb2JqZWN0JykgewoJCQkJc2V0dGluZ3MgPSBkdXJhdGlvbjsKCQkJCWR1cmF0aW9uID0gMDsKCQkJfQoJCQlpZiAodHlwZW9mIHNldHRpbmdzID09ICdmdW5jdGlvbicpCgkJCQlzZXR0aW5ncyA9IHsgb25BZnRlcjpzZXR0aW5ncyB9OwoKCQkJaWYgKHRhcmdldCA9PSAnbWF4JykKCQkJCXRhcmdldCA9IDllOTsKCgkJCXNldHRpbmdzID0gJC5leHRlbmQoIHt9LCAkc2Nyb2xsVG8uZGVmYXVsdHMsIHNldHRpbmdzICk7CgkJCS8vIFNwZWVkIGlzIHN0aWxsIHJlY29nbml6ZWQgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CgkJCWR1cmF0aW9uID0gZHVyYXRpb24gfHwgc2V0dGluZ3MuZHVyYXRpb247CgkJCS8vIE1ha2Ugc3VyZSB0aGUgc2V0dGluZ3MgYXJlIGdpdmVuIHJpZ2h0CgkJCXNldHRpbmdzLnF1ZXVlID0gc2V0dGluZ3MucXVldWUgJiYgc2V0dGluZ3MuYXhpcy5sZW5ndGggPiAxOwoKCQkJaWYgKHNldHRpbmdzLnF1ZXVlKQoJCQkJLy8gTGV0J3Mga2VlcCB0aGUgb3ZlcmFsbCBkdXJhdGlvbgoJCQkJZHVyYXRpb24gLz0gMjsKCQkJc2V0dGluZ3Mub2Zmc2V0ID0gYm90aCggc2V0dGluZ3Mub2Zmc2V0ICk7CgkJCXNldHRpbmdzLm92ZXIgPSBib3RoKCBzZXR0aW5ncy5vdmVyICk7CgoJCQlyZXR1cm4gdGhpcy5fc2Nyb2xsYWJsZSgpLmVhY2goZnVuY3Rpb24oKSB7CgkJCQkvLyBOdWxsIHRhcmdldCB5aWVsZHMgbm90aGluZywganVzdCBsaWtlIGpRdWVyeSBkb2VzCgkJCQlpZiAodGFyZ2V0ID09IG51bGwpIHJldHVybjsKCgkJCQl2YXIgZWxlbSA9IHRoaXMsCgkJCQkJJGVsZW0gPSAkKGVsZW0pLAoJCQkJCXRhcmcgPSB0YXJnZXQsIHRvZmYsIGF0dHIgPSB7fSwKCQkJCQl3aW4gPSAkZWxlbS5pcygnaHRtbCxib2R5Jyk7CgoJCQkJc3dpdGNoICh0eXBlb2YgdGFyZykgewoJCQkJCS8vIEEgbnVtYmVyIHdpbGwgcGFzcyB0aGUgcmVnZXgKCQkJCQljYXNlICdudW1iZXInOgoJCQkJCWNhc2UgJ3N0cmluZyc6CgkJCQkJCWlmICgvXihbKy1dPT8pP1xkKyhcLlxkKyk/KHB4fCUpPyQvLnRlc3QodGFyZykpIHsKCQkJCQkJCXRhcmcgPSBib3RoKCB0YXJnICk7CgkJCQkJCQkvLyBXZSBhcmUgZG9uZQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJLy8gUmVsYXRpdmUvQWJzb2x1dGUgc2VsZWN0b3IsIG5vIGJyZWFrIQoJCQkJCQl0YXJnID0gd2luID8gJCh0YXJnKSA6ICQodGFyZywgdGhpcyk7CgkJCQkJCWlmICghdGFyZy5sZW5ndGgpIHJldHVybjsKCQkJCQljYXNlICdvYmplY3QnOgoJCQkJCQkvLyBET01FbGVtZW50IC8galF1ZXJ5CgkJCQkJCWlmICh0YXJnLmlzIHx8IHRhcmcuc3R5bGUpCgkJCQkJCQkvLyBHZXQgdGhlIHJlYWwgcG9zaXRpb24gb2YgdGhlIHRhcmdldAoJCQkJCQkJdG9mZiA9ICh0YXJnID0gJCh0YXJnKSkub2Zmc2V0KCk7CgkJCQl9CgoJCQkJdmFyIG9mZnNldCA9ICQuaXNGdW5jdGlvbihzZXR0aW5ncy5vZmZzZXQpICYmIHNldHRpbmdzLm9mZnNldChlbGVtLCB0YXJnKSB8fCBzZXR0aW5ncy5vZmZzZXQ7CgoJCQkJJC5lYWNoKCBzZXR0aW5ncy5heGlzLnNwbGl0KCcnKSwgZnVuY3Rpb24oIGksIGF4aXMgKSB7CgkJCQkJdmFyIFBvcwk9IGF4aXMgPT0gJ3gnID8gJ0xlZnQnIDogJ1RvcCcsCgkJCQkJCXBvcyA9IFBvcy50b0xvd2VyQ2FzZSgpLAoJCQkJCQlrZXkgPSAnc2Nyb2xsJyArIFBvcywKCQkJCQkJb2xkID0gZWxlbVtrZXldLAoJCQkJCQltYXggPSAkc2Nyb2xsVG8ubWF4KGVsZW0sIGF4aXMpOwoKCQkJCQlpZiAodG9mZikgey8vIGpRdWVyeSAvIERPTUVsZW1lbnQKCQkJCQkJYXR0cltrZXldID0gdG9mZltwb3NdICsgKCB3aW4gPyAwIDogb2xkIC0gJGVsZW0ub2Zmc2V0KClbcG9zXSApOwoKCQkJCQkJLy8gSWYgaXQncyBhIGRvbSBlbGVtZW50LCByZWR1Y2UgdGhlIG1hcmdpbgoJCQkJCQlpZiAoc2V0dGluZ3MubWFyZ2luKSB7CgkJCQkJCQlhdHRyW2tleV0gLT0gcGFyc2VJbnQodGFyZy5jc3MoJ21hcmdpbicrUG9zKSkgfHwgMDsKCQkJCQkJCWF0dHJba2V5XSAtPSBwYXJzZUludCh0YXJnLmNzcygnYm9yZGVyJytQb3MrJ1dpZHRoJykpIHx8IDA7CgkJCQkJCX0KCgkJCQkJCWF0dHJba2V5XSArPSBvZmZzZXRbcG9zXSB8fCAwOwoKCQkJCQkJaWYoc2V0dGluZ3Mub3Zlcltwb3NdKQoJCQkJCQkJLy8gU2Nyb2xsIHRvIGEgZnJhY3Rpb24gb2YgaXRzIHdpZHRoL2hlaWdodAoJCQkJCQkJYXR0cltrZXldICs9IHRhcmdbYXhpcz09J3gnPyd3aWR0aCc6J2hlaWdodCddKCkgKiBzZXR0aW5ncy5vdmVyW3Bvc107CgkJCQkJfSBlbHNlIHsKCQkJCQkJdmFyIHZhbCA9IHRhcmdbcG9zXTsKCQkJCQkJLy8gSGFuZGxlIHBlcmNlbnRhZ2UgdmFsdWVzCgkJCQkJCWF0dHJba2V5XSA9IHZhbC5zbGljZSAmJiB2YWwuc2xpY2UoLTEpID09ICclJyA/CgkJCQkJCQlwYXJzZUZsb2F0KHZhbCkgLyAxMDAgKiBtYXgKCQkJCQkJCTogdmFsOwoJCQkJCX0KCgkJCQkJLy8gTnVtYmVyIG9yICdudW1iZXInCgkJCQkJaWYgKHNldHRpbmdzLmxpbWl0ICYmIC9eXGQrJC8udGVzdChhdHRyW2tleV0pKQoJCQkJCQkvLyBDaGVjayB0aGUgbGltaXRzCgkJCQkJCWF0dHJba2V5XSA9IGF0dHJba2V5XSA8PSAwID8gMCA6IE1hdGgubWluKCBhdHRyW2tleV0sIG1heCApOwoKCQkJCQkvLyBRdWV1ZWluZyBheGVzCgkJCQkJaWYgKCFpICYmIHNldHRpbmdzLnF1ZXVlKSB7CgkJCQkJCS8vIERvbid0IHdhc3RlIHRpbWUgYW5pbWF0aW5nLCBpZiB0aGVyZSdzIG5vIG5lZWQuCgkJCQkJCWlmIChvbGQgIT0gYXR0cltrZXldKQoJCQkJCQkJLy8gSW50ZXJtZWRpYXRlIGFuaW1hdGlvbgoJCQkJCQkJYW5pbWF0ZSggc2V0dGluZ3Mub25BZnRlckZpcnN0ICk7CgkJCQkJCS8vIERvbid0IGFuaW1hdGUgdGhpcyBheGlzIGFnYWluIGluIHRoZSBuZXh0IGl0ZXJhdGlvbi4KCQkJCQkJZGVsZXRlIGF0dHJba2V5XTsKCQkJCQl9CgkJCQl9KTsKCgkJCQlhbmltYXRlKCBzZXR0aW5ncy5vbkFmdGVyICk7CgoJCQkJZnVuY3Rpb24gYW5pbWF0ZSggY2FsbGJhY2sgKSB7CgkJCQkJJGVsZW0uYW5pbWF0ZSggYXR0ciwgZHVyYXRpb24sIHNldHRpbmdzLmVhc2luZywgY2FsbGJhY2sgJiYgZnVuY3Rpb24oKSB7CgkJCQkJCWNhbGxiYWNrLmNhbGwodGhpcywgdGFyZywgc2V0dGluZ3MpOwoJCQkJCX0pOwoJCQkJfQoJCQl9KS5lbmQoKTsKCQl9OwoKCQkvLyBNYXggc2Nyb2xsaW5nIHBvc2l0aW9uLCB3b3JrcyBvbiBxdWlya3MgbW9kZQoJCS8vIEl0IG9ubHkgZmFpbHMgKG5vdCB0b28gYmFkbHkpIG9uIElFLCBxdWlya3MgbW9kZS4KCQkkc2Nyb2xsVG8ubWF4ID0gZnVuY3Rpb24oIGVsZW0sIGF4aXMgKSB7CgkJCXZhciBEaW0gPSBheGlzID09ICd4JyA/ICdXaWR0aCcgOiAnSGVpZ2h0JywKCQkJCXNjcm9sbCA9ICdzY3JvbGwnK0RpbTsKCgkJCWlmICghJChlbGVtKS5pcygnaHRtbCxib2R5JykpCgkJCQlyZXR1cm4gZWxlbVtzY3JvbGxdIC0gJChlbGVtKVtEaW0udG9Mb3dlckNhc2UoKV0oKTsKCgkJCXZhciBzaXplID0gJ2NsaWVudCcgKyBEaW0sCgkJCQlodG1sID0gZWxlbS5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwKCQkJCWJvZHkgPSBlbGVtLm93bmVyRG9jdW1lbnQuYm9keTsKCgkJCXJldHVybiBNYXRoLm1heCggaHRtbFtzY3JvbGxdLCBib2R5W3Njcm9sbF0gKSAtIE1hdGgubWluKCBodG1sW3NpemVdICAsIGJvZHlbc2l6ZV0gICApOwoJCX07CgoJCWZ1bmN0aW9uIGJvdGgoIHZhbCApIHsKCQkJcmV0dXJuICQuaXNGdW5jdGlvbih2YWwpIHx8IHR5cGVvZiB2YWwgPT0gJ29iamVjdCcgPyB2YWwgOiB7IHRvcDp2YWwsIGxlZnQ6dmFsIH07CgkJfQoKCQkvLyBBTUQgcmVxdWlyZW1lbnQKCQlyZXR1cm4gJHNjcm9sbFRvOwoJfSkKfSh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUgOiBmdW5jdGlvbiAoZGVwcywgZmFjdG9yeSkgewoJaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CgkJLy8gTm9kZQoJCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKCdqcXVlcnknKSk7Cgl9IGVsc2UgewoJCWZhY3RvcnkoalF1ZXJ5KTsKCX0KfSkpOwo=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 309,
          "bodySize": 7476
        },
        "cache": {},
        "timings": {
          "send": 7,
          "wait": 0,
          "receive": 12
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8641"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 112,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/themes/visjs/vis.css",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 357,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "7990"
            }
          ],
          "content": {
            "size": 33187,
            "compression": 0,
            "mimeType": "text/css",
            "text": ".vis .overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n\n  /* Must be displayed above for example selected Timeline items */\n  z-index: 10;\n}\n\n.vis-active {\n  box-shadow: 0 0 10px #86d5f8;\n}\n\n/* override some bootstrap styles screwing up the timelines css */\n\n.vis [class*=\"span\"] {\n  min-height: 0;\n  width: auto;\n}\n\n\n.vis-timeline {\n  position: relative;\n  border: 1px solid #bfbfbf;\n\n  overflow: hidden;\n  padding: 0;\n  margin: 0;\n\n  box-sizing: border-box;\n}\n\n\n.vis-panel {\n  position: absolute;\n\n  padding: 0;\n  margin: 0;\n\n  box-sizing: border-box;\n}\n\n.vis-panel.vis-center,\n.vis-panel.vis-left,\n.vis-panel.vis-right,\n.vis-panel.vis-top,\n.vis-panel.vis-bottom {\n  border: 1px #bfbfbf;\n}\n\n.vis-panel.vis-center,\n.vis-panel.vis-left,\n.vis-panel.vis-right {\n  border-top-style: solid;\n  border-bottom-style: solid;\n  overflow: hidden;\n}\n\n.vis-panel.vis-center,\n.vis-panel.vis-top,\n.vis-panel.vis-bottom {\n  border-left-style: solid;\n  border-right-style: solid;\n}\n\n.vis-background {\n  overflow: hidden;\n}\n\n.vis-panel > .vis-content {\n  position: relative;\n}\n\n.vis-panel .vis-shadow {\n  position: absolute;\n  width: 100%;\n  height: 1px;\n  box-shadow: 0 0 10px rgba(0,0,0,0.8);\n  /* TODO: find a nice way to ensure vis-shadows are drawn on top of items\n  z-index: 1;\n  */\n}\n\n.vis-panel .vis-shadow.vis-top {\n  top: -1px;\n  left: 0;\n}\n\n.vis-panel .vis-shadow.vis-bottom {\n  bottom: -1px;\n  left: 0;\n}\n\n.vis-labelset {\n  position: relative;\n\n  overflow: hidden;\n\n  box-sizing: border-box;\n}\n\n.vis-labelset .vis-label {\n  position: relative;\n  left: 0;\n  top: 0;\n  width: 100%;\n  color: #4d4d4d;\n\n  box-sizing: border-box;\n}\n\n.vis-labelset .vis-label {\n  border-bottom: 1px solid #bfbfbf;\n}\n\n.vis-labelset .vis-label:last-child {\n  border-bottom: none;\n}\n\n.vis-labelset .vis-label .vis-inner {\n  display: inline-block;\n  padding: 5px;\n}\n\n.vis-labelset .vis-label .vis-inner.vis-hidden {\n  padding: 0;\n}\n\n\n.vis-itemset {\n  position: relative;\n  padding: 0;\n  margin: 0;\n\n  box-sizing: border-box;\n}\n\n.vis-itemset .vis-background,\n.vis-itemset .vis-foreground {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: visible;\n}\n\n.vis-axis {\n  position: absolute;\n  width: 100%;\n  height: 0;\n  left: 0;\n  z-index: 1;\n}\n\n.vis-foreground .vis-group {\n  position: relative;\n  box-sizing: border-box;\n  border-bottom: 1px solid #bfbfbf;\n}\n\n.vis-foreground .vis-group:last-child {\n  border-bottom: none;\n}\n\n.vis-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 10;\n}\n\n.vis-item {\n  position: absolute;\n  color: #1A1A1A;\n  border-color: #97B0F8;\n  border-width: 1px;\n  background-color: #D5DDF6;\n  display: inline-block;\n  /*overflow: hidden;*/\n}\n\n.vis-item.vis-selected {\n  border-color: #FFC200;\n  background-color: #FFF785;\n\n  /* z-index must be higher than the z-index of custom time bar and current time bar */\n  z-index: 2;\n}\n\n.vis-editable.vis-selected {\n  cursor: move;\n}\n\n.vis-item.vis-point.vis-selected {\n  background-color: #FFF785;\n}\n\n.vis-item.vis-box {\n  text-align: center;\n  border-style: solid;\n  border-radius: 2px;\n}\n\n.vis-item.vis-point {\n  background: none;\n}\n\n.vis-item.vis-dot {\n  position: absolute;\n  padding: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-radius: 4px;\n}\n\n.vis-item.vis-range {\n  border-style: solid;\n  border-radius: 2px;\n  box-sizing: border-box;\n}\n\n.vis-item.vis-background {\n  border: none;\n  background-color: rgba(213, 221, 246, 0.4);\n  box-sizing: border-box;\n  padding: 0;\n  margin: 0;\n}\n\n.vis-item .vis-item-overflow {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  padding: 0;\n  margin: 0;\n  overflow: hidden;\n}\n\n.vis-item.vis-range .vis-item-content {\n  position: relative;\n  display: inline-block;\n}\n\n.vis-item.vis-background .vis-item-content {\n  position: absolute;\n  display: inline-block;\n}\n\n.vis-item.vis-line {\n  padding: 0;\n  position: absolute;\n  width: 0;\n  border-left-width: 1px;\n  border-left-style: solid;\n}\n\n.vis-item .vis-item-content {\n  white-space: nowrap;\n  box-sizing: border-box;\n  padding: 5px;\n}\n\n.vis-item .vis-delete {\n  background: url('img/timeline/delete.png') no-repeat center;\n  position: absolute;\n  width: 24px;\n  height: 24px;\n  top: -4px;\n  right: -24px;\n  cursor: pointer;\n}\n\n.vis-item.vis-range .vis-drag-left {\n  position: absolute;\n  width: 24px;\n  max-width: 20%;\n  min-width: 2px;\n  height: 100%;\n  top: 0;\n  left: -4px;\n\n  cursor: w-resize;\n}\n\n.vis-item.vis-range .vis-drag-right {\n  position: absolute;\n  width: 24px;\n  max-width: 20%;\n  min-width: 2px;\n  height: 100%;\n  top: 0;\n  right: -4px;\n\n  cursor: e-resize;\n}\n\n.vis-time-axis {\n  position: relative;\n  overflow: hidden;\n}\n\n.vis-time-axis.vis-foreground {\n  top: 0;\n  left: 0;\n  width: 100%;\n}\n\n.vis-time-axis.vis-background {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n\n.vis-time-axis .vis-text {\n  position: absolute;\n  color: #4d4d4d;\n  padding: 3px;\n  white-space: nowrap;\n}\n\n.vis-time-axis .vis-text.vis-measure {\n  position: absolute;\n  padding-left: 0;\n  padding-right: 0;\n  margin-left: 0;\n  margin-right: 0;\n  visibility: hidden;\n}\n\n.vis-time-axis .vis-grid.vis-vertical {\n  position: absolute;\n  border-left: 1px solid;\n}\n\n.vis-time-axis .vis-grid.vis-minor {\n  border-color: #e5e5e5;\n}\n\n.vis-time-axis .vis-grid.vis-major {\n  border-color: #bfbfbf;\n}\n\n.vis-current-time {\n  background-color: #FF7F6E;\n  width: 2px;\n  z-index: 1;\n}\n.vis-custom-time {\n  background-color: #6E94FF;\n  width: 2px;\n  cursor: move;\n  z-index: 1;\n}\n.vis-timeline {\n  /*\n  -webkit-transition: height .4s ease-in-out;\n  transition:         height .4s ease-in-out;\n  */\n}\n\n.vis-panel {\n  /*\n  -webkit-transition: height .4s ease-in-out, top .4s ease-in-out;\n  transition:         height .4s ease-in-out, top .4s ease-in-out;\n  */\n}\n\n.vis-axis {\n  /*\n  -webkit-transition: top .4s ease-in-out;\n  transition:         top .4s ease-in-out;\n  */\n}\n\n/* TODO: get animation working nicely\n\n.vis-item {\n  -webkit-transition: top .4s ease-in-out;\n  transition:         top .4s ease-in-out;\n}\n\n.vis-item.line {\n  -webkit-transition: height .4s ease-in-out, top .4s ease-in-out;\n  transition:         height .4s ease-in-out, top .4s ease-in-out;\n}\n/**/\n\n.vis-panel.vis-background.vis-horizontal .vis-grid.vis-horizontal {\n  position: absolute;\n  width: 100%;\n  height: 0;\n  border-bottom: 1px solid;\n}\n\n.vis-panel.vis-background.vis-horizontal .vis-grid.vis-minor {\n  border-color: #e5e5e5;\n}\n\n.vis-panel.vis-background.vis-horizontal .vis-grid.vis-major {\n  border-color: #bfbfbf;\n}\n\n\n.vis-data-axis .vis-y-axis.vis-major {\n  width: 100%;\n  position: absolute;\n  color: #4d4d4d;\n  white-space: nowrap;\n}\n\n.vis-data-axis .vis-y-axis.vis-major.vis-measure {\n  padding: 0;\n  margin: 0;\n  border: 0;\n  visibility: hidden;\n  width: auto;\n}\n\n\n.vis-data-axis .vis-y-axis.vis-minor {\n  position: absolute;\n  width: 100%;\n  color: #bebebe;\n  white-space: nowrap;\n}\n\n.vis-data-axis .vis-y-axis.vis-minor.vis-measure {\n  padding: 0;\n  margin: 0;\n  border: 0;\n  visibility: hidden;\n  width: auto;\n}\n\n.vis-data-axis .vis-y-axis.vis-title {\n  position: absolute;\n  color: #4d4d4d;\n  white-space: nowrap;\n  bottom: 20px;\n  text-align: center;\n}\n\n.vis-data-axis .vis-y-axis.vis-title.vis-measure {\n  padding: 0;\n  margin: 0;\n  visibility: hidden;\n  width: auto;\n}\n\n.vis-data-axis .vis-y-axis.vis-title.vis-left {\n  bottom: 0;\n  -webkit-transform-origin: left top;\n  -moz-transform-origin: left top;\n  -ms-transform-origin: left top;\n  -o-transform-origin: left top;\n  transform-origin: left bottom;\n  -webkit-transform: rotate(-90deg);\n  -moz-transform: rotate(-90deg);\n  -ms-transform: rotate(-90deg);\n  -o-transform: rotate(-90deg);\n  transform: rotate(-90deg);\n}\n\n.vis-data-axis .vis-y-axis.vis-title.vis-right {\n  bottom: 0;\n  -webkit-transform-origin: right bottom;\n  -moz-transform-origin: right bottom;\n  -ms-transform-origin: right bottom;\n  -o-transform-origin: right bottom;\n  transform-origin: right bottom;\n  -webkit-transform: rotate(90deg);\n  -moz-transform: rotate(90deg);\n  -ms-transform: rotate(90deg);\n  -o-transform: rotate(90deg);\n  transform: rotate(90deg);\n}\n\n.vis-legend {\n  background-color: rgba(247, 252, 255, 0.65);\n  padding: 5px;\n  border: 1px solid #b3b3b3;\n  box-shadow: 2px 2px 10px rgba(154, 154, 154, 0.55);\n}\n\n.vis-legend-text {\n  /*font-size: 10px;*/\n  white-space: nowrap;\n  display: inline-block\n}\n.vis-graph-group0 {\n    fill:#4f81bd;\n    fill-opacity:0;\n    stroke-width:2px;\n    stroke: #4f81bd;\n}\n\n.vis-graph-group1 {\n    fill:#f79646;\n    fill-opacity:0;\n    stroke-width:2px;\n    stroke: #f79646;\n}\n\n.vis-graph-group2 {\n    fill: #8c51cf;\n    fill-opacity:0;\n    stroke-width:2px;\n    stroke: #8c51cf;\n}\n\n.vis-graph-group3 {\n    fill: #75c841;\n    fill-opacity:0;\n    stroke-width:2px;\n    stroke: #75c841;\n}\n\n.vis-graph-group4 {\n    fill: #ff0100;\n    fill-opacity:0;\n    stroke-width:2px;\n    stroke: #ff0100;\n}\n\n.vis-graph-group5 {\n    fill: #37d8e6;\n    fill-opacity:0;\n    stroke-width:2px;\n    stroke: #37d8e6;\n}\n\n.vis-graph-group6 {\n    fill: #042662;\n    fill-opacity:0;\n    stroke-width:2px;\n    stroke: #042662;\n}\n\n.vis-graph-group7 {\n    fill:#00ff26;\n    fill-opacity:0;\n    stroke-width:2px;\n    stroke: #00ff26;\n}\n\n.vis-graph-group8 {\n    fill:#ff00ff;\n    fill-opacity:0;\n    stroke-width:2px;\n    stroke: #ff00ff;\n}\n\n.vis-graph-group9 {\n    fill: #8f3938;\n    fill-opacity:0;\n    stroke-width:2px;\n    stroke: #8f3938;\n}\n\n.vis-timeline .vis-fill {\n    fill-opacity:0.1;\n    stroke: none;\n}\n\n\n.vis-timeline .vis-bar {\n    fill-opacity:0.5;\n    stroke-width:1px;\n}\n\n.vis-timeline .vis-point {\n    stroke-width:2px;\n    fill-opacity:1.0;\n}\n\n\n.vis-timeline .vis-legend-background {\n    stroke-width:1px;\n    fill-opacity:0.9;\n    fill: #ffffff;\n    stroke: #c2c2c2;\n}\n\n\n.vis-timeline .vis-outline {\n    stroke-width:1px;\n    fill-opacity:1;\n    fill: #ffffff;\n    stroke: #e5e5e5;\n}\n\n.vis-timeline .vis-icon-fill {\n    fill-opacity:0.3;\n    stroke: none;\n}\n\ndiv.vis-network div.vis-manipulation {\n  border-width: 0;\n  border-bottom: 1px;\n  border-style:solid;\n  border-color: #d6d9d8;\n  background: #ffffff; /* Old browsers */\n  background: -moz-linear-gradient(top,  #ffffff 0%, #fcfcfc 48%, #fafafa 50%, #fcfcfc 100%); /* FF3.6+ */\n  background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(48%,#fcfcfc), color-stop(50%,#fafafa), color-stop(100%,#fcfcfc)); /* Chrome,Safari4+ */\n  background: -webkit-linear-gradient(top,  #ffffff 0%,#fcfcfc 48%,#fafafa 50%,#fcfcfc 100%); /* Chrome10+,Safari5.1+ */\n  background: -o-linear-gradient(top,  #ffffff 0%,#fcfcfc 48%,#fafafa 50%,#fcfcfc 100%); /* Opera 11.10+ */\n  background: -ms-linear-gradient(top,  #ffffff 0%,#fcfcfc 48%,#fafafa 50%,#fcfcfc 100%); /* IE10+ */\n  background: linear-gradient(to bottom,  #ffffff 0%,#fcfcfc 48%,#fafafa 50%,#fcfcfc 100%); /* W3C */\n  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#fcfcfc',GradientType=0 ); /* IE6-9 */\n\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 30px;\n}\n\ndiv.vis-network div.vis-edit-mode {\n  position:absolute;\n  left: 0;\n  top: 15px;\n  height: 30px;\n}\n\n/* FIXME: shouldn't the vis-close button be a child of the vis-manipulation div? */\n\ndiv.vis-network div.vis-close {\n  position:absolute;\n  right: 0;\n  top: 0;\n  width: 30px;\n  height: 30px;\n\n  background-position: 20px 3px;\n  background-repeat: no-repeat;\n  background-image: url(\"img/network/cross.png\");\n  cursor: pointer;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\ndiv.vis-network div.vis-close:hover {\n  opacity: 0.6;\n}\n\ndiv.vis-network div.vis-manipulation div.vis-button,\ndiv.vis-network div.vis-edit-mode div.vis-button {\n  position:relative;\n  top:-7px;\n  font-family: verdana;\n  font-size: 12px;\n  -moz-border-radius: 15px;\n  border-radius: 15px;\n  display:inline-block;\n  background-position: 0px 0px;\n  background-repeat:no-repeat;\n  height:24px;\n  margin: 0px 0px 0px 10px;\n  vertical-align:middle;\n  cursor: pointer;\n  padding: 0px 8px 0px 8px;\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\ndiv.vis-network div.vis-manipulation div.vis-button:hover {\n  box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.20);\n}\n\ndiv.vis-network div.vis-manipulation div.vis-button:active {\n  box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.50);\n}\n\ndiv.vis-network div.vis-manipulation div.vis-button.vis-back {\n  background-image: url(\"img/network/backIcon.png\");\n}\n\ndiv.vis-network div.vis-manipulation div.vis-button.vis-none:hover {\n  box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.0);\n  cursor: default;\n}\ndiv.vis-network div.vis-manipulation div.vis-button.vis-none:active {\n  box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.0);\n}\ndiv.vis-network div.vis-manipulation div.vis-button.vis-none {\n  padding: 0;\n}\ndiv.vis-network div.vis-manipulation div.notification {\n  margin: 2px;\n  font-weight: bold;\n}\n\ndiv.vis-network div.vis-manipulation div.vis-button.vis-add {\n  background-image: url(\"img/network/addNodeIcon.png\");\n}\n\ndiv.vis-network div.vis-manipulation div.vis-button.vis-edit,\ndiv.vis-network div.vis-edit-mode div.vis-button.vis-edit {\n  background-image: url(\"img/network/editIcon.png\");\n}\n\ndiv.vis-network div.vis-edit-mode div.vis-button.vis-edit.vis-edit-mode {\n  background-color: #fcfcfc;\n  border: 1px solid #cccccc;\n}\n\ndiv.vis-network div.vis-manipulation div.vis-button.vis-connect {\n  background-image: url(\"img/network/connectIcon.png\");\n}\n\ndiv.vis-network div.vis-manipulation div.vis-button.vis-delete {\n  background-image: url(\"img/network/deleteIcon.png\");\n}\n/* top right bottom left */\ndiv.vis-network div.vis-manipulation div.vis-label,\ndiv.vis-network div.vis-edit-mode div.vis-label {\n  margin: 0 0 0 23px;\n  line-height: 25px;\n}\ndiv.vis-network div.vis-manipulation div.vis-separator-line {\n  display:inline-block;\n  width:1px;\n  height:20px;\n  background-color: #bdbdbd;\n  margin: 5px 7px 0 15px;\n}\n\n/* TODO: is this redundant?\ndiv.network-navigation_wrapper {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n}\n*/\ndiv.vis-network div.vis-navigation div.vis-button {\n    width:34px;\n    height:34px;\n    -moz-border-radius: 17px;\n    border-radius: 17px;\n    position:absolute;\n    display:inline-block;\n    background-position: 2px 2px;\n    background-repeat:no-repeat;\n    cursor: pointer;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n}\n\ndiv.vis-network div.vis-navigation div.vis-button:hover {\n    box-shadow: 0 0 3px 3px rgba(56, 207, 21, 0.30);\n}\n\ndiv.vis-network div.vis-navigation div.vis-button:active {\n    box-shadow: 0 0 1px 3px rgba(56, 207, 21, 0.95);\n}\n\ndiv.vis-network div.vis-navigation div.vis-button.vis-up {\n    background-image: url(\"img/network/upArrow.png\");\n    bottom:50px;\n    left:55px;\n}\ndiv.vis-network div.vis-navigation div.vis-button.vis-down {\n    background-image: url(\"img/network/downArrow.png\");\n    bottom:10px;\n    left:55px;\n}\ndiv.vis-network div.vis-navigation div.vis-button.vis-left {\n    background-image: url(\"img/network/leftArrow.png\");\n    bottom:10px;\n    left:15px;\n}\ndiv.vis-network div.vis-navigation div.vis-button.vis-right {\n    background-image: url(\"img/network/rightArrow.png\");\n    bottom:10px;\n    left:95px;\n}\ndiv.vis-network div.vis-navigation div.vis-button.vis-zoomIn {\n    background-image: url(\"img/network/plus.png\");\n    bottom:10px;\n    right:15px;\n}\ndiv.vis-network div.vis-navigation div.vis-button.vis-zoomOut {\n    background-image: url(\"img/network/minus.png\");\n    bottom:10px;\n    right:55px;\n}\ndiv.vis-network div.vis-navigation div.vis-button.vis-zoomExtends {\n    background-image: url(\"img/network/zoomExtends.png\");\n    bottom:50px;\n    right:15px;\n}\ndiv.vis-network-tooltip {\n  position: absolute;\n  visibility: hidden;\n  padding: 5px;\n  white-space: nowrap;\n\n  font-family: verdana;\n  font-size:14px;\n  font-color:#000000;\n  background-color: #f5f4ed;\n\n  -moz-border-radius: 3px;\n  -webkit-border-radius: 3px;\n  border-radius: 3px;\n  border: 1px solid #808074;\n\n  box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);\n  pointer-events: none;\n}\ndiv.vis-network-configuration {\n    position:relative;\n    display:block;\n    float:left;\n    font-size:12px;\n}\n\ndiv.vis-network-configuration-wrapper {\n    display:block;\n    width:700px;\n}\n\n\ndiv.vis-network-configuration.vis-option-container{\n    display:block;\n    width:495px;\n    background-color: #ffffff;\n    border:2px solid #f7f8fa;\n    border-radius:4px;\n    margin-top:20px;\n    left:10px;\n    padding-left:5px;\n}\n\ndiv.vis-network-configuration.button{\n    display:block;\n    width:495px;\n    height:25px;\n    vertical-align: middle;\n    line-height:25px;\n    background-color: #f7f8fa;\n    border:2px solid #ceced0;\n    border-radius:4px;\n    margin-top:20px;\n    left:10px;\n    padding-left:5px;\n    cursor: pointer;\n    margin-bottom:30px;\n}\n\ndiv.vis-network-configuration.button.hover{\n    background-color: #4588e6;\n    border:2px solid #214373;\n    color:#ffffff;\n}\n\ndiv.vis-network-configuration.item{\n    display:block;\n    float:left;\n    width:495px;\n    height:25px;\n    vertical-align: middle;\n    line-height:25px;\n}\n\n\ndiv.vis-network-configuration.item.s2{\n    left:10px;\n    background-color: #f7f8fa;\n    padding-left:5px;\n    border-radius:3px;\n}\ndiv.vis-network-configuration.item.s3{\n    left:20px;\n    background-color: #e4e9f0;\n    padding-left:5px;\n    border-radius:3px;\n}\ndiv.vis-network-configuration.item.s4{\n    left:30px;\n    background-color: #cfd8e6;\n    padding-left:5px;\n    border-radius:3px;\n}\n\ndiv.vis-network-configuration.header{\n    font-size:18px;\n    font-weight: bold;\n}\n\ndiv.vis-network-configuration.label{\n    width:120px;\n    height:25px;\n    line-height: 25px;\n}\n\ndiv.vis-network-configuration.label.s3{\n    width:110px;\n}\ndiv.vis-network-configuration.label.s4{\n    width:100px;\n}\n\ndiv.vis-network-configuration.colorBlock{\n    top:1px;\n    width:30px;\n    height:19px;\n    border:1px solid #444444;\n    border-radius:2px;\n    padding:0px;\n    margin:0px;\n    cursor:pointer;\n}\n\ninput.vis-network-configuration.checkbox {\n    left:-5px;\n}\n\n\ninput.vis-network-configuration.rangeinput{\n    position:relative;\n    top:-5px;\n    width:60px;\n    height:13px;\n    padding:1px;\n    margin:0;\n    pointer-events:none;\n}\n\ninput.vis-network-configuration.range{\n    /*removes default webkit styles*/\n    -webkit-appearance: none;\n\n    /*fix for FF unable to apply focus style bug */\n    border: 0px solid white;\n    background-color:rgba(0,0,0,0);\n\n    /*required for proper track sizing in FF*/\n    width: 300px;\n    height:20px;\n}\ninput.vis-network-configuration.range::-webkit-slider-runnable-track {\n    width: 300px;\n    height: 5px;\n    background: #dedede; /* Old browsers */\n    background: -moz-linear-gradient(top,  #dedede 0%, #c8c8c8 99%); /* FF3.6+ */\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#dedede), color-stop(99%,#c8c8c8)); /* Chrome,Safari4+ */\n    background: -webkit-linear-gradient(top,  #dedede 0%,#c8c8c8 99%); /* Chrome10+,Safari5.1+ */\n    background: -o-linear-gradient(top, #dedede 0%, #c8c8c8 99%); /* Opera 11.10+ */\n    background: -ms-linear-gradient(top,  #dedede 0%,#c8c8c8 99%); /* IE10+ */\n    background: linear-gradient(to bottom,  #dedede 0%,#c8c8c8 99%); /* W3C */\n    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#dedede', endColorstr='#c8c8c8',GradientType=0 ); /* IE6-9 */\n\n    border: 1px solid #999999;\n    box-shadow: #aaaaaa 0px 0px 3px 0px;\n    border-radius: 3px;\n}\ninput.vis-network-configuration.range::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    border: 1px solid #14334b;\n    height: 17px;\n    width: 17px;\n    border-radius: 50%;\n    background: #3876c2; /* Old browsers */\n    background: -moz-linear-gradient(top,  #3876c2 0%, #385380 100%); /* FF3.6+ */\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#3876c2), color-stop(100%,#385380)); /* Chrome,Safari4+ */\n    background: -webkit-linear-gradient(top,  #3876c2 0%,#385380 100%); /* Chrome10+,Safari5.1+ */\n    background: -o-linear-gradient(top,  #3876c2 0%,#385380 100%); /* Opera 11.10+ */\n    background: -ms-linear-gradient(top,  #3876c2 0%,#385380 100%); /* IE10+ */\n    background: linear-gradient(to bottom,  #3876c2 0%,#385380 100%); /* W3C */\n    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#3876c2', endColorstr='#385380',GradientType=0 ); /* IE6-9 */\n    box-shadow: #111927 0px 0px 1px 0px;\n    margin-top: -7px;\n}\ninput.vis-network-configuration.range:focus {\n    outline: none;\n}\ninput.vis-network-configuration.range:focus::-webkit-slider-runnable-track {\n    background: #9d9d9d; /* Old browsers */\n    background: -moz-linear-gradient(top, #9d9d9d 0%, #c8c8c8 99%); /* FF3.6+ */\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#9d9d9d), color-stop(99%,#c8c8c8)); /* Chrome,Safari4+ */\n    background: -webkit-linear-gradient(top,  #9d9d9d 0%,#c8c8c8 99%); /* Chrome10+,Safari5.1+ */\n    background: -o-linear-gradient(top,  #9d9d9d 0%,#c8c8c8 99%); /* Opera 11.10+ */\n    background: -ms-linear-gradient(top,  #9d9d9d 0%,#c8c8c8 99%); /* IE10+ */\n    background: linear-gradient(to bottom,  #9d9d9d 0%,#c8c8c8 99%); /* W3C */\n    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#9d9d9d', endColorstr='#c8c8c8',GradientType=0 ); /* IE6-9 */\n}\n\ninput.vis-network-configuration.range::-moz-range-track {\n    width: 300px;\n    height: 10px;\n    background: #dedede; /* Old browsers */\n    background: -moz-linear-gradient(top,  #dedede 0%, #c8c8c8 99%); /* FF3.6+ */\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#dedede), color-stop(99%,#c8c8c8)); /* Chrome,Safari4+ */\n    background: -webkit-linear-gradient(top,  #dedede 0%,#c8c8c8 99%); /* Chrome10+,Safari5.1+ */\n    background: -o-linear-gradient(top, #dedede 0%, #c8c8c8 99%); /* Opera 11.10+ */\n    background: -ms-linear-gradient(top,  #dedede 0%,#c8c8c8 99%); /* IE10+ */\n    background: linear-gradient(to bottom,  #dedede 0%,#c8c8c8 99%); /* W3C */\n    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#dedede', endColorstr='#c8c8c8',GradientType=0 ); /* IE6-9 */\n\n    border: 1px solid #999999;\n    box-shadow: #aaaaaa 0px 0px 3px 0px;\n    border-radius: 3px;\n}\ninput.vis-network-configuration.range::-moz-range-thumb {\n    border: none;\n    height: 16px;\n    width: 16px;\n\n    border-radius: 50%;\n    background:  #385380;\n}\n\n/*hide the outline behind the border*/\ninput.vis-network-configuration.range:-moz-focusring{\n    outline: 1px solid white;\n    outline-offset: -1px;\n}\n\ninput.vis-network-configuration.range::-ms-track {\n    width: 300px;\n    height: 5px;\n\n    /*remove bg colour from the track, we'll use ms-fill-lower and ms-fill-upper instead */\n    background: transparent;\n\n    /*leave room for the larger thumb to overflow with a transparent border */\n    border-color: transparent;\n    border-width: 6px 0;\n\n    /*remove default tick marks*/\n    color: transparent;\n}\ninput.vis-network-configuration.range::-ms-fill-lower {\n    background: #777;\n    border-radius: 10px;\n}\ninput.vis-network-configuration.range::-ms-fill-upper {\n    background: #ddd;\n    border-radius: 10px;\n}\ninput.vis-network-configuration.range::-ms-thumb {\n    border: none;\n    height: 16px;\n    width: 16px;\n    border-radius: 50%;\n    background:  #385380;\n}\ninput.vis-network-configuration.range:focus::-ms-fill-lower {\n    background: #888;\n}\ninput.vis-network-configuration.range:focus::-ms-fill-upper {\n    background: #ccc;\n}\n\ndiv.vis-color-picker {\n  position:absolute;\n  margin-top:-140px;\n  margin-left:30px;\n  width:293px;\n  height:425px;\n  padding: 10px;\n  border-radius:15px;\n  background-color:#ffffff;\n  display:none;\n  box-shadow: rgba(0,0,0,0.5) 0px 0px 10px 0px;\n}\n\ndiv.vis-color-picker div.vis-arrow {\n  position: absolute;\n  top:147px;\n  left:5px;\n}\n\ndiv.vis-color-picker div.vis-arrow:after,\ndiv.vis-color-picker div.vis-arrow:before {\n  right: 100%;\n  top: 50%;\n  border: solid transparent;\n  content: \" \";\n  height: 0;\n  width: 0;\n  position: absolute;\n  pointer-events: none;\n}\n\ndiv.vis-color-picker div.vis-arrow:after {\n  border-color: rgba(255, 255, 255, 0);\n  border-right-color: #ffffff;\n  border-width: 30px;\n  margin-top: -30px;\n}\n\ndiv.vis-color-picker div.vis-color {\n  position:absolute;\n  width: 289px;\n  height: 289px;\n  cursor: pointer;\n}\n\n\n\ndiv.vis-color-picker div.vis-brightness {\n  position: absolute;\n  top:313px;\n}\n\ndiv.vis-color-picker div.vis-opacity {\n  position:absolute;\n  top:350px;\n}\n\ndiv.vis-color-picker div.vis-selector {\n  position:absolute;\n  top:137px;\n  left:137px;\n  width:15px;\n  height:15px;\n  border-radius:15px;\n  border:1px solid #ffffff;\n  background: #4c4c4c; /* Old browsers */\n  background: -moz-linear-gradient(top,  #4c4c4c 0%, #595959 12%, #666666 25%, #474747 39%, #2c2c2c 50%, #000000 51%, #111111 60%, #2b2b2b 76%, #1c1c1c 91%, #131313 100%); /* FF3.6+ */\n  background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#4c4c4c), color-stop(12%,#595959), color-stop(25%,#666666), color-stop(39%,#474747), color-stop(50%,#2c2c2c), color-stop(51%,#000000), color-stop(60%,#111111), color-stop(76%,#2b2b2b), color-stop(91%,#1c1c1c), color-stop(100%,#131313)); /* Chrome,Safari4+ */\n  background: -webkit-linear-gradient(top,  #4c4c4c 0%,#595959 12%,#666666 25%,#474747 39%,#2c2c2c 50%,#000000 51%,#111111 60%,#2b2b2b 76%,#1c1c1c 91%,#131313 100%); /* Chrome10+,Safari5.1+ */\n  background: -o-linear-gradient(top,  #4c4c4c 0%,#595959 12%,#666666 25%,#474747 39%,#2c2c2c 50%,#000000 51%,#111111 60%,#2b2b2b 76%,#1c1c1c 91%,#131313 100%); /* Opera 11.10+ */\n  background: -ms-linear-gradient(top,  #4c4c4c 0%,#595959 12%,#666666 25%,#474747 39%,#2c2c2c 50%,#000000 51%,#111111 60%,#2b2b2b 76%,#1c1c1c 91%,#131313 100%); /* IE10+ */\n  background: linear-gradient(to bottom,  #4c4c4c 0%,#595959 12%,#666666 25%,#474747 39%,#2c2c2c 50%,#000000 51%,#111111 60%,#2b2b2b 76%,#1c1c1c 91%,#131313 100%); /* W3C */\n  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#4c4c4c', endColorstr='#131313',GradientType=0 ); /* IE6-9 */\n}\n\n\n\ndiv.vis-color-picker div.vis-new-color {\n  position:absolute;\n  width:140px;\n  height:20px;\n  border:1px solid rgba(0,0,0,0.1);\n  border-radius:5px;\n  top:380px;\n  left:159px;\n  text-align:right;\n  padding-right:2px;\n  font-size:10px;\n  color:rgba(0,0,0,0.4);\n  vertical-align:middle;\n  line-height:20px;\n\n}\n\ndiv.vis-color-picker div.vis-initial-color {\n  position:absolute;\n  width:140px;\n  height:20px;\n  border:1px solid rgba(0,0,0,0.1);\n  border-radius:5px;\n  top:380px;\n  left:10px;\n  text-align:left;\n  padding-left:2px;\n  font-size:10px;\n  color:rgba(0,0,0,0.4);\n  vertical-align:middle;\n  line-height:20px;\n}\n\ndiv.vis-color-picker div.vis-label {\n  position:absolute;\n  width:300px;\n  left:10px;\n}\n\ndiv.vis-color-picker div.vis-label.vis-brightness {\n  top:300px;\n}\n\ndiv.vis-color-picker div.vis-label.vis-opacity {\n  top:338px;\n}\n\ndiv.vis-color-picker div.vis-button {\n  position:absolute;\n  width:68px;\n  height:25px;\n  border-radius:10px;\n  vertical-align: middle;\n  text-align:center;\n  line-height: 25px;\n  top:410px;\n  border:2px solid #d9d9d9;\n  background-color: #f7f7f7;\n  cursor:pointer;\n}\n\ndiv.vis-color-picker div.vis-button.vis-cancel {\n  /*border:2px solid #ff4e33;*/\n  /*background-color: #ff7761;*/\n  left:5px;\n}\ndiv.vis-color-picker div.vis-button.vis-load {\n  /*border:2px solid #a153e6;*/\n  /*background-color: #cb8dff;*/\n  left:82px;\n}\ndiv.vis-color-picker div.vis-button.vis-apply {\n  /*border:2px solid #4588e6;*/\n  /*background-color: #82b6ff;*/\n  left:159px;\n}\ndiv.vis-color-picker div.vis-button.vis-save {\n  /*border:2px solid #45e655;*/\n  /*background-color: #6dff7c;*/\n  left:236px;\n}\n\n\ndiv.vis-color-picker input.vis-range {\n  width: 290px;\n  height:20px;\n}\n\n/* visjs fix for rendering group background colors above the time grid */\n.vis-time-axis { z-index: 1; }\n.vis-item { z-index: 2; }\n.vis-current-time { z-index: 3; }\n\n/* Style per OMNI standards */\n.vis-item .vis-item-content { padding: 1px 5px; }\n.vis-timeline { border: 1px solid #666666; background-color: #cccc99; z-index: }\n.vis-labelset .vis-label { border-bottom: 1px solid #666666; }\n.vis-panel.vis-center, .vis-panel.vis-left, .vis-panel.vis-right, .vis-panel.vis-top, .vis-panel.vis-bottom { border-color: #666666; }\n.vis-foreground .vis-group { background-color: #ededcf; border-bottom: 1px solid #cccc99; }\n.vis-time-axis .vis-grid.vis-major { border-color: #cccc99; }\n.vis-time-axis .vis-grid.vis-minor { border-color: #ffffcc; }\n\n/* BRD styles */\ndiv.littleRedBox {\n  float: left;\n  width: 14px;\n  height: 14px;\n  margin: 1px;\n  background-color: #ff0000;\n}\ndiv.littleGoldBox {\n  float: left;\n  width: 14px;\n  height: 14px;\n  margin: 1px;\n  background-color: #ffd700;\n}\ndiv.littleGreenBox {\n  float: left;\n  width: 14px;\n  height: 14px;\n  margin: 1px;\n  background-color: #009900;\n}\ndiv.littleDodgerBlueBox {\n  float: left;\n  width: 14px;\n  height: 14px;\n  margin: 1px;\n  background-color: #1e90ff;\n}\ndiv.littleLightSalmonBox {\n  float: left;\n  width: 14px;\n  height: 14px;\n  margin: 1px;\n  background-color: #ffa07a;\n}\ndiv.littleSilverBox {\n  float: left;\n  width: 14px;\n  height: 14px;\n  margin: 1px;\n  background-color: #c0c0c0;\n}\n.vis-current-time { width: 0px; border-left: 2px dashed red; background-color: transparent; }\n\n.vis-background .custody { background-color: #EDEDCF; }\n.custody-planned-lightpink { background-color: #ffb6c1; }\n.plan-note-thistle { background-color: #dfb8df; }\n.program-educational-red { background-color: #ff0000; }\n.program-employment-gold { background-color: #ffd700; }\n.program-trans-green { background-color: #009900; }\n.program-compl-dodgerblue { background-color: #1e90ff; }\n.program-mental-lightsalmon { background-color: #ffa07a; }\n.program-change-silver { background-color: #c0c0c0; }\n\n/* hide border separating the Custody/Supervision Type groups */\t\n.vis-labelset .subgroup-top-no-border { \n  border-bottom: none; \n}\n.vis-labelset .subgroup-top-need-focus { \n  font-weight: bold; \n  -moz-text-decoration-color: blue; \n  text-decoration-color: blue; \n  color: blue; \n  border-bottom: none; \n  height: 20px; \n}\n.vis-labelset .subgroup-top-need.focus {\n  font-weight: bold; \n  color: blue; \n}\n.vis-labelset .subgroup-top-need.print {\n  font-weight: normal; \n  color: #4d4d4d; \n}\n.vis-labelset .subgroup-top-need a { \n  text-decoration: underline;\n}\n.vis-labelset .subgroup-top-need { \n  font-weight: normal; \n  -moz-text-decoration-color: black; \n  text-decoration-color: black; \n  color: black; \n  border-bottom: none; \n  height: 20px; \n}\n.vis-labelset .subgroup-bottom-need-focus { \n  font-weight: bold; \n  -moz-text-decoration-color: blue; \n  text-decoration-color: blue; \n  color: blue; \n}\n.vis-labelset .subgroup-bottom-need { \n  font-weight: normal; \n  -moz-text-decoration-color: black; \n  text-decoration-color: black; \n  color: black; \n}\n.vis-group.subgroup-top-no-border { \n  border-bottom: none; \n}\n.vis-group.subgroup-top-need-focus { \n  font-weight: bold; \n  -moz-text-decoration-color: blue; \n  text-decoration-color: blue; \n  color: blue; \n  border-bottom: none; \n  height: 20px; \n}\n.vis-group.subgroup-top-need { \n  font-weight: normal; \n  -moz-text-decoration-color: black; \n  text-decoration-color: black; \n  color: black; \n  border-bottom: none; \n  height: 20px; \n}\n.vis-group.subgroup-bottom-need-focus { \n  font-weight: bold; \n  -moz-text-decoration-color: blue; \n  text-decoration-color: blue; \n  color: blue; \n}\n.vis-group.subgroup-bottom-need { \n  font-weight: normal; \n  -moz-text-decoration-color: black; \n  text-decoration-color: black; \n  color: black; \n}\n\n.vis-background .tolling { \n  /*background-color: #00ff74;*/\n  background: repeating-linear-gradient(-80deg, #ff0000, #ff0000 3px, #ffffff, #ffffff 6px);\n  /*padding: 15px;*/ \n  overflow: hidden;\n  margin: auto;\n  /*padding-top: 50px;*/\n  /*padding-bottom: 50px;*/\n}\n\n.vis-background .tolling .vis-item-overflow {\n  margin: auto;\n  /*background-color: white;*/\n  width: 20px;\n}\n\n.vis-background .tolling .vis-item-content { \n  transform: translateX(0px) translateY(230px) rotate(-90deg); \n  font-weight: bold;\n  /* adds a white text outline*/\n  text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n  position: static;\n  display: block;\n}\n\n.vis-background .interruption { background-color: red; z-index: 2; overflow: hidden; }\n.vis-background .interruption .vis-item-overflow { margin: auto; width: 18px; }\n.vis-background .interruption .vis-item-content { \n  transform: translateX(0px) translateY(230px) rotate(-90deg); \n  position: static;\n  display: block;\n}\n\n.notes { background-color: white; }\n\n/* TODO: is this redundant?\ndiv.vis-color-picker input.vis-range-brightness {\n  width: 289px !important;\n}\n\n\ndiv.vis-color-picker input.vis-saturation-range {\n  width: 289px !important;\n}*/",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 293,
          "bodySize": 33187
        },
        "cache": {},
        "timings": {
          "send": 8,
          "wait": 0,
          "receive": 3
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8638"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.107-07:00",
        "time": 384,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/vis.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 351,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Transfer-Encoding",
              "value": "chunked"
            },
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:34 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"049e97ada8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            }
          ],
          "content": {
            "size": 1862772,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "LyoqCiAqIHZpcy5qcwogKiBodHRwczovL2dpdGh1Yi5jb20vYWxtZW5kZS92aXMKICoKICogQSBkeW5hbWljLCBicm93c2VyLWJhc2VkIHZpc3VhbGl6YXRpb24gbGlicmFyeS4KICoKICogQHZlcnNpb24gNC4zLjAKICogQGRhdGUgICAgMjAxNS0wNi0xNgogKgogKiBAbGljZW5zZQogKiBDb3B5cmlnaHQgKEMpIDIwMTEtMjAxNCBBbG1lbmRlIEIuViwgaHR0cDovL2FsbWVuZGUuY29tCiAqCiAqIFZpcy5qcyBpcyBkdWFsIGxpY2Vuc2VkIHVuZGVyIGJvdGgKICoKICogKiBUaGUgQXBhY2hlIDIuMCBMaWNlbnNlCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIGFuZAogKgogKiAqIFRoZSBNSVQgTGljZW5zZQogKiAgIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVQKICoKICogVmlzLmpzIG1heSBiZSBkaXN0cmlidXRlZCB1bmRlciBlaXRoZXIgbGljZW5zZS4KICovCgoidXNlIHN0cmljdCI7CgooZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkgewoJaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKQoJCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwoJZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpCgkJZGVmaW5lKGZhY3RvcnkpOwoJZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpCgkJZXhwb3J0c1sidmlzIl0gPSBmYWN0b3J5KCk7CgllbHNlCgkJcm9vdFsidmlzIl0gPSBmYWN0b3J5KCk7Cn0pKHRoaXMsIGZ1bmN0aW9uKCkgewpyZXR1cm4gLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcAovKioqKioqLyAJLy8gVGhlIG1vZHVsZSBjYWNoZQovKioqKioqLyAJdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsKCi8qKioqKiovIAkvLyBUaGUgcmVxdWlyZSBmdW5jdGlvbgovKioqKioqLyAJZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewoKLyoqKioqKi8gCQkvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGUKLyoqKioqKi8gCQlpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkKLyoqKioqKi8gCQkJcmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7CgovKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCi8qKioqKiovIAkJdmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0gewovKioqKioqLyAJCQlleHBvcnRzOiB7fSwKLyoqKioqKi8gCQkJaWQ6IG1vZHVsZUlkLAovKioqKioqLyAJCQlsb2FkZWQ6IGZhbHNlCi8qKioqKiovIAkJfTsKCi8qKioqKiovIAkJLy8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uCi8qKioqKiovIAkJbW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7CgovKioqKioqLyAJCS8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWQKLyoqKioqKi8gCQltb2R1bGUubG9hZGVkID0gdHJ1ZTsKCi8qKioqKiovIAkJLy8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGUKLyoqKioqKi8gCQlyZXR1cm4gbW9kdWxlLmV4cG9ydHM7Ci8qKioqKiovIAl9CgoKLyoqKioqKi8gCS8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOwoKLyoqKioqKi8gCS8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzOwoKLyoqKioqKi8gCS8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fCi8qKioqKiovIAlfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSAiIjsKCi8qKioqKiovIAkvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHMKLyoqKioqKi8gCXJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApOwovKioqKioqLyB9KQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqLyAoWwovKiAwICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAvLyB1dGlscwogICd1c2Ugc3RyaWN0JzsKCiAgZXhwb3J0cy51dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKICBleHBvcnRzLkRPTXV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOwoKICAvLyBkYXRhCiAgZXhwb3J0cy5EYXRhU2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKICBleHBvcnRzLkRhdGFWaWV3ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7CiAgZXhwb3J0cy5RdWV1ZSA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7CgogIC8vIEdyYXBoM2QKICBleHBvcnRzLkdyYXBoM2QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDExKTsKICBleHBvcnRzLmdyYXBoM2QgPSB7CiAgICBDYW1lcmE6IF9fd2VicGFja19yZXF1aXJlX18oMTUpLAogICAgRmlsdGVyOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDE2KSwKICAgIFBvaW50MmQ6IF9fd2VicGFja19yZXF1aXJlX18oMTIpLAogICAgUG9pbnQzZDogX193ZWJwYWNrX3JlcXVpcmVfXygxNCksCiAgICBTbGlkZXI6IF9fd2VicGFja19yZXF1aXJlX18oMTcpLAogICAgU3RlcE51bWJlcjogX193ZWJwYWNrX3JlcXVpcmVfXygxOCkKICB9OwoKICAvLyBUaW1lbGluZQogIGV4cG9ydHMuVGltZWxpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE5KTsKICBleHBvcnRzLkdyYXBoMmQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5KTsKICBleHBvcnRzLnRpbWVsaW5lID0gewogICAgRGF0ZVV0aWw6IF9fd2VicGFja19yZXF1aXJlX18oMjkpLAogICAgRGF0YVN0ZXA6IF9fd2VicGFja19yZXF1aXJlX18oNTIpLAogICAgUmFuZ2U6IF9fd2VicGFja19yZXF1aXJlX18oMjcpLAogICAgc3RhY2s6IF9fd2VicGFja19yZXF1aXJlX18oMzMpLAogICAgVGltZVN0ZXA6IF9fd2VicGFja19yZXF1aXJlX18oMzYpLAoKICAgIGNvbXBvbmVudHM6IHsKICAgICAgaXRlbXM6IHsKICAgICAgICBJdGVtOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDM1KSwKICAgICAgICBCYWNrZ3JvdW5kSXRlbTogX193ZWJwYWNrX3JlcXVpcmVfXyg0MCksCiAgICAgICAgQm94SXRlbTogX193ZWJwYWNrX3JlcXVpcmVfXygzOCksCiAgICAgICAgUG9pbnRJdGVtOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDM5KSwKICAgICAgICBSYW5nZUl0ZW06IF9fd2VicGFja19yZXF1aXJlX18oMzQpCiAgICAgIH0sCgogICAgICBDb21wb25lbnQ6IF9fd2VicGFja19yZXF1aXJlX18oMjEpLAogICAgICBDdXJyZW50VGltZTogX193ZWJwYWNrX3JlcXVpcmVfXygyMCksCiAgICAgIEN1c3RvbVRpbWU6IF9fd2VicGFja19yZXF1aXJlX18oNDQpLAogICAgICBEYXRhQXhpczogX193ZWJwYWNrX3JlcXVpcmVfXyg1MSksCiAgICAgIEdyYXBoR3JvdXA6IF9fd2VicGFja19yZXF1aXJlX18oNTMpLAogICAgICBHcm91cDogX193ZWJwYWNrX3JlcXVpcmVfXygzMiksCiAgICAgIEJhY2tncm91bmRHcm91cDogX193ZWJwYWNrX3JlcXVpcmVfXygzNyksCiAgICAgIEl0ZW1TZXQ6IF9fd2VicGFja19yZXF1aXJlX18oMzEpLAogICAgICBMZWdlbmQ6IF9fd2VicGFja19yZXF1aXJlX18oNTcpLAogICAgICBMaW5lR3JhcGg6IF9fd2VicGFja19yZXF1aXJlX18oNTApLAogICAgICBUaW1lQXhpczogX193ZWJwYWNrX3JlcXVpcmVfXyg0MSkKICAgIH0KICB9OwoKICAvLyBOZXR3b3JrCiAgZXhwb3J0cy5OZXR3b3JrID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1OSk7CiAgZXhwb3J0cy5uZXR3b3JrID0gewogICAgSW1hZ2VzOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDExMiksCiAgICBkb3RwYXJzZXI6IF9fd2VicGFja19yZXF1aXJlX18oMTEwKSwKICAgIGdlcGhpUGFyc2VyOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDExMSksCiAgICBhbGxPcHRpb25zOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwOCkKICB9OwogIGV4cG9ydHMubmV0d29yay5jb252ZXJ0RG90ID0gZnVuY3Rpb24gKGlucHV0KSB7CiAgICByZXR1cm4gZXhwb3J0cy5uZXR3b3JrLmRvdHBhcnNlci5ET1RUb0dyYXBoKGlucHV0KTsKICB9OwogIGV4cG9ydHMubmV0d29yay5jb252ZXJ0R2VwaGkgPSBmdW5jdGlvbiAoaW5wdXQsIG9wdGlvbnMpIHsKICAgIHJldHVybiBleHBvcnRzLm5ldHdvcmsuZ2VwaGlQYXJzZXIucGFyc2VHZXBoaShpbnB1dCwgb3B0aW9ucyk7CiAgfTsKCiAgLy8gRGVwcmVjYXRlZCBzaW5jZSB2My4wLjAKICBleHBvcnRzLkdyYXBoID0gZnVuY3Rpb24gKCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdHcmFwaCBpcyByZW5hbWVkIHRvIE5ldHdvcmsuIFBsZWFzZSBjcmVhdGUgYSBncmFwaCBhcyBuZXcgdmlzLk5ldHdvcmsoLi4uKScpOwogIH07CgogIC8vIGJ1bmRsZWQgZXh0ZXJuYWwgbGlicmFyaWVzCiAgZXhwb3J0cy5tb21lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwogIGV4cG9ydHMuaGFtbWVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMyk7IC8vIFRPRE86IGRlcHJlY2F0ZSBleHBvcnRzLmhhbW1lciBzb21lIGRheQogIGV4cG9ydHMuSGFtbWVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMyk7CgovKioqLyB9LAovKiAxICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAvLyB1dGlsaXR5IGZ1bmN0aW9ucwoKICAvLyBmaXJzdCBjaGVjayBpZiBtb21lbnQuanMgaXMgYWxyZWFkeSBsb2FkZWQgaW4gdGhlIGJyb3dzZXIgd2luZG93LCBpZiBzbywKICAvLyB1c2UgdGhpcyBpbnN0YW5jZS4gRWxzZSwgbG9hZCB2aWEgY29tbW9uanMuCgogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIG1vbWVudCA9IF9fd2VicGFja19yZXF1aXJlX18oMik7CiAgdmFyIHV1aWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwoKICAvKioKICAgKiBUZXN0IHdoZXRoZXIgZ2l2ZW4gb2JqZWN0IGlzIGEgbnVtYmVyCiAgICogQHBhcmFtIHsqfSBvYmplY3QKICAgKiBAcmV0dXJuIHtCb29sZWFufSBpc051bWJlcgogICAqLwogIGV4cG9ydHMuaXNOdW1iZXIgPSBmdW5jdGlvbiAob2JqZWN0KSB7CiAgICByZXR1cm4gb2JqZWN0IGluc3RhbmNlb2YgTnVtYmVyIHx8IHR5cGVvZiBvYmplY3QgPT0gJ251bWJlcic7CiAgfTsKCiAgLyoqCiAgICogUmVtb3ZlIGV2ZXJ5dGhpbmcgaW4gdGhlIERPTSBvYmplY3QKICAgKiBAcGFyYW0gRE9Nb2JqZWN0CiAgICovCiAgZXhwb3J0cy5yZWN1cnNpdmVET01EZWxldGUgPSBmdW5jdGlvbiAoRE9Nb2JqZWN0KSB7CiAgICBpZiAoRE9Nb2JqZWN0KSB7CiAgICAgIHdoaWxlIChET01vYmplY3QuaGFzQ2hpbGROb2RlcygpID09PSB0cnVlKSB7CiAgICAgICAgZXhwb3J0cy5yZWN1cnNpdmVET01EZWxldGUoRE9Nb2JqZWN0LmZpcnN0Q2hpbGQpOwogICAgICAgIERPTW9iamVjdC5yZW1vdmVDaGlsZChET01vYmplY3QuZmlyc3RDaGlsZCk7CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiB0aGlzIGZ1bmN0aW9uIGdpdmVzIHlvdSBhIHJhbmdlIGJldHdlZW4gMCBhbmQgMSBiYXNlZCBvbiB0aGUgbWluIGFuZCBtYXggdmFsdWVzIGluIHRoZSBzZXQsIHRoZSB0b3RhbCBzdW0gb2YgYWxsIHZhbHVlcyBhbmQgdGhlIGN1cnJlbnQgdmFsdWUuCiAgICoKICAgKiBAcGFyYW0gbWluCiAgICogQHBhcmFtIG1heAogICAqIEBwYXJhbSB0b3RhbAogICAqIEBwYXJhbSB2YWx1ZQogICAqIEByZXR1cm5zIHtudW1iZXJ9CiAgICovCiAgZXhwb3J0cy5naXZlUmFuZ2UgPSBmdW5jdGlvbiAobWluLCBtYXgsIHRvdGFsLCB2YWx1ZSkgewogICAgaWYgKG1heCA9PSBtaW4pIHsKICAgICAgcmV0dXJuIDAuNTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBzY2FsZSA9IDEgLyAobWF4IC0gbWluKTsKICAgICAgcmV0dXJuIE1hdGgubWF4KDAsICh2YWx1ZSAtIG1pbikgKiBzY2FsZSk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogVGVzdCB3aGV0aGVyIGdpdmVuIG9iamVjdCBpcyBhIHN0cmluZwogICAqIEBwYXJhbSB7Kn0gb2JqZWN0CiAgICogQHJldHVybiB7Qm9vbGVhbn0gaXNTdHJpbmcKICAgKi8KICBleHBvcnRzLmlzU3RyaW5nID0gZnVuY3Rpb24gKG9iamVjdCkgewogICAgcmV0dXJuIG9iamVjdCBpbnN0YW5jZW9mIFN0cmluZyB8fCB0eXBlb2Ygb2JqZWN0ID09ICdzdHJpbmcnOwogIH07CgogIC8qKgogICAqIFRlc3Qgd2hldGhlciBnaXZlbiBvYmplY3QgaXMgYSBEYXRlLCBvciBhIFN0cmluZyBjb250YWluaW5nIGEgRGF0ZQogICAqIEBwYXJhbSB7RGF0ZSB8IFN0cmluZ30gb2JqZWN0CiAgICogQHJldHVybiB7Qm9vbGVhbn0gaXNEYXRlCiAgICovCiAgZXhwb3J0cy5pc0RhdGUgPSBmdW5jdGlvbiAob2JqZWN0KSB7CiAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgRGF0ZSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSBpZiAoZXhwb3J0cy5pc1N0cmluZyhvYmplY3QpKSB7CiAgICAgIC8vIHRlc3Qgd2hldGhlciB0aGlzIHN0cmluZyBjb250YWlucyBhIGRhdGUKICAgICAgdmFyIG1hdGNoID0gQVNQRGF0ZVJlZ2V4LmV4ZWMob2JqZWN0KTsKICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSBpZiAoIWlzTmFOKERhdGUucGFyc2Uob2JqZWN0KSkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9OwoKICAvKioKICAgKiBDcmVhdGUgYSBzZW1pIFVVSUQKICAgKiBzb3VyY2U6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzEwNTA3NC8xMjYyNzUzCiAgICogQHJldHVybiB7U3RyaW5nfSB1dWlkCiAgICovCiAgZXhwb3J0cy5yYW5kb21VVUlEID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHV1aWQudjQoKTsKICB9OwoKICAvKioKICAgKiBhc3NpZ24gYWxsIGtleXMgb2YgYW4gb2JqZWN0IHRoYXQgYXJlIG5vdCBuZXN0ZWQgb2JqZWN0cyB0byBhIGNlcnRhaW4gdmFsdWUgKHVzZWQgZm9yIGNvbG9yIG9iamVjdHMpLgogICAqIEBwYXJhbSBvYmoKICAgKiBAcGFyYW0gdmFsdWUKICAgKi8KICBleHBvcnRzLmFzc2lnbkFsbEtleXMgPSBmdW5jdGlvbiAob2JqLCB2YWx1ZSkgewogICAgZm9yICh2YXIgcHJvcCBpbiBvYmopIHsKICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgIGlmICh0eXBlb2Ygb2JqW3Byb3BdICE9PSAnb2JqZWN0JykgewogICAgICAgICAgb2JqW3Byb3BdID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogRmlsbCBhbiBvYmplY3Qgd2l0aCBhIHBvc3NpYmx5IHBhcnRpYWxseSBkZWZpbmVkIG90aGVyIG9iamVjdC4gT25seSBjb3BpZXMgdmFsdWVzIGlmIHRoZSBhIG9iamVjdCBoYXMgYW4gb2JqZWN0IHJlcXVpcmluZyB2YWx1ZXMuCiAgICogVGhhdCBtZWFucyBhbiBvYmplY3QgaXMgbm90IGNyZWF0ZWQgb24gYSBwcm9wZXJ0eSBpZiBvbmx5IHRoZSBiIG9iamVjdCBoYXMgaXQuCiAgICogQHBhcmFtIG9iagogICAqIEBwYXJhbSB2YWx1ZQogICAqLwogIGV4cG9ydHMuZmlsbElmRGVmaW5lZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICB2YXIgYWxsb3dEZWxldGlvbiA9IGFyZ3VtZW50c1syXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbMl07CgogICAgZm9yICh2YXIgcHJvcCBpbiBhKSB7CiAgICAgIGlmIChiW3Byb3BdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAodHlwZW9mIGJbcHJvcF0gIT09ICdvYmplY3QnKSB7CiAgICAgICAgICBpZiAoKGJbcHJvcF0gPT09IHVuZGVmaW5lZCB8fCBiW3Byb3BdID09PSBudWxsKSAmJiBhW3Byb3BdICE9PSB1bmRlZmluZWQgJiYgYWxsb3dEZWxldGlvbiA9PT0gdHJ1ZSkgewogICAgICAgICAgICBkZWxldGUgYVtwcm9wXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFbcHJvcF0gPSBiW3Byb3BdOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodHlwZW9mIGFbcHJvcF0gPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIGV4cG9ydHMuZmlsbElmRGVmaW5lZChhW3Byb3BdLCBiW3Byb3BdLCBhbGxvd0RlbGV0aW9uKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBFeHRlbmQgb2JqZWN0IGEgd2l0aCB0aGUgcHJvcGVydGllcyBvZiBvYmplY3QgYiBvciBhIHNlcmllcyBvZiBvYmplY3RzCiAgICogT25seSBwcm9wZXJ0aWVzIHdpdGggZGVmaW5lZCB2YWx1ZXMgYXJlIGNvcGllZAogICAqIEBwYXJhbSB7T2JqZWN0fSBhCiAgICogQHBhcmFtIHsuLi4gT2JqZWN0fSBiCiAgICogQHJldHVybiB7T2JqZWN0fSBhCiAgICovCiAgZXhwb3J0cy5wcm90b0V4dGVuZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgb3RoZXIgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gb3RoZXIpIHsKICAgICAgICBhW3Byb3BdID0gb3RoZXJbcHJvcF07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhOwogIH07CgogIC8qKgogICAqIEV4dGVuZCBvYmplY3QgYSB3aXRoIHRoZSBwcm9wZXJ0aWVzIG9mIG9iamVjdCBiIG9yIGEgc2VyaWVzIG9mIG9iamVjdHMKICAgKiBPbmx5IHByb3BlcnRpZXMgd2l0aCBkZWZpbmVkIHZhbHVlcyBhcmUgY29waWVkCiAgICogQHBhcmFtIHtPYmplY3R9IGEKICAgKiBAcGFyYW0gey4uLiBPYmplY3R9IGIKICAgKiBAcmV0dXJuIHtPYmplY3R9IGEKICAgKi8KICBleHBvcnRzLmV4dGVuZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgb3RoZXIgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIuaGFzT3duUHJvcGVydHkocHJvcCkpIHsKICAgICAgICAgIGFbcHJvcF0gPSBvdGhlcltwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhOwogIH07CgogIC8qKgogICAqIEV4dGVuZCBvYmplY3QgYSB3aXRoIHNlbGVjdGVkIHByb3BlcnRpZXMgb2Ygb2JqZWN0IGIgb3IgYSBzZXJpZXMgb2Ygb2JqZWN0cwogICAqIE9ubHkgcHJvcGVydGllcyB3aXRoIGRlZmluZWQgdmFsdWVzIGFyZSBjb3BpZWQKICAgKiBAcGFyYW0ge0FycmF5LjxTdHJpbmc+fSBwcm9wcwogICAqIEBwYXJhbSB7T2JqZWN0fSBhCiAgICogQHBhcmFtIHtPYmplY3R9IGIKICAgKiBAcmV0dXJuIHtPYmplY3R9IGEKICAgKi8KICBleHBvcnRzLnNlbGVjdGl2ZUV4dGVuZCA9IGZ1bmN0aW9uIChwcm9wcywgYSwgYikgewogICAgaWYgKCFBcnJheS5pc0FycmF5KHByb3BzKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FycmF5IHdpdGggcHJvcGVydHkgbmFtZXMgZXhwZWN0ZWQgYXMgZmlyc3QgYXJndW1lbnQnKTsKICAgIH0KCiAgICBmb3IgKHZhciBpID0gMjsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgb3RoZXIgPSBhcmd1bWVudHNbaV07CgogICAgICBmb3IgKHZhciBwID0gMDsgcCA8IHByb3BzLmxlbmd0aDsgcCsrKSB7CiAgICAgICAgdmFyIHByb3AgPSBwcm9wc1twXTsKICAgICAgICBpZiAob3RoZXIuaGFzT3duUHJvcGVydHkocHJvcCkpIHsKICAgICAgICAgIGFbcHJvcF0gPSBvdGhlcltwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhOwogIH07CgogIC8qKgogICAqIEV4dGVuZCBvYmplY3QgYSB3aXRoIHNlbGVjdGVkIHByb3BlcnRpZXMgb2Ygb2JqZWN0IGIgb3IgYSBzZXJpZXMgb2Ygb2JqZWN0cwogICAqIE9ubHkgcHJvcGVydGllcyB3aXRoIGRlZmluZWQgdmFsdWVzIGFyZSBjb3BpZWQKICAgKiBAcGFyYW0ge0FycmF5LjxTdHJpbmc+fSBwcm9wcwogICAqIEBwYXJhbSB7T2JqZWN0fSBhCiAgICogQHBhcmFtIHtPYmplY3R9IGIKICAgKiBAcmV0dXJuIHtPYmplY3R9IGEKICAgKi8KICBleHBvcnRzLnNlbGVjdGl2ZURlZXBFeHRlbmQgPSBmdW5jdGlvbiAocHJvcHMsIGEsIGIpIHsKICAgIHZhciBhbGxvd0RlbGV0aW9uID0gYXJndW1lbnRzWzNdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1szXTsKCiAgICAvLyBUT0RPOiBhZGQgc3VwcG9ydCBmb3IgQXJyYXlzIHRvIGRlZXBFeHRlbmQKICAgIGlmIChBcnJheS5pc0FycmF5KGIpKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FycmF5cyBhcmUgbm90IHN1cHBvcnRlZCBieSBkZWVwRXh0ZW5kJyk7CiAgICB9CiAgICBmb3IgKHZhciBpID0gMjsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgb3RoZXIgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHAgPSAwOyBwIDwgcHJvcHMubGVuZ3RoOyBwKyspIHsKICAgICAgICB2YXIgcHJvcCA9IHByb3BzW3BdOwogICAgICAgIGlmIChvdGhlci5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgaWYgKGJbcHJvcF0gJiYgYltwcm9wXS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICAgICAgICAgIGlmIChhW3Byb3BdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBhW3Byb3BdID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFbcHJvcF0uY29uc3RydWN0b3IgPT09IE9iamVjdCkgewogICAgICAgICAgICAgIGV4cG9ydHMuZGVlcEV4dGVuZChhW3Byb3BdLCBiW3Byb3BdLCBmYWxzZSwgYWxsb3dEZWxldGlvbik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKGJbcHJvcF0gPT09IG51bGwgJiYgYVtwcm9wXSAhPT0gdW5kZWZpbmVkICYmIGFsbG93RGVsZXRpb24gPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBhW3Byb3BdOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhW3Byb3BdID0gYltwcm9wXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShiW3Byb3BdKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheXMgYXJlIG5vdCBzdXBwb3J0ZWQgYnkgZGVlcEV4dGVuZCcpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYVtwcm9wXSA9IGJbcHJvcF07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gYTsKICB9OwoKICAvKioKICAgKiBFeHRlbmQgb2JqZWN0IGEgd2l0aCBzZWxlY3RlZCBwcm9wZXJ0aWVzIG9mIG9iamVjdCBiIG9yIGEgc2VyaWVzIG9mIG9iamVjdHMKICAgKiBPbmx5IHByb3BlcnRpZXMgd2l0aCBkZWZpbmVkIHZhbHVlcyBhcmUgY29waWVkCiAgICogQHBhcmFtIHtBcnJheS48U3RyaW5nPn0gcHJvcHMKICAgKiBAcGFyYW0ge09iamVjdH0gYQogICAqIEBwYXJhbSB7T2JqZWN0fSBiCiAgICogQHJldHVybiB7T2JqZWN0fSBhCiAgICovCiAgZXhwb3J0cy5zZWxlY3RpdmVOb3REZWVwRXh0ZW5kID0gZnVuY3Rpb24gKHByb3BzLCBhLCBiKSB7CiAgICB2YXIgYWxsb3dEZWxldGlvbiA9IGFyZ3VtZW50c1szXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbM107CgogICAgLy8gVE9ETzogYWRkIHN1cHBvcnQgZm9yIEFycmF5cyB0byBkZWVwRXh0ZW5kCiAgICBpZiAoQXJyYXkuaXNBcnJheShiKSkgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheXMgYXJlIG5vdCBzdXBwb3J0ZWQgYnkgZGVlcEV4dGVuZCcpOwogICAgfQogICAgZm9yICh2YXIgcHJvcCBpbiBiKSB7CiAgICAgIGlmIChiLmhhc093blByb3BlcnR5KHByb3ApKSB7CiAgICAgICAgaWYgKHByb3BzLmluZGV4T2YocHJvcCkgPT0gLTEpIHsKICAgICAgICAgIGlmIChiW3Byb3BdICYmIGJbcHJvcF0uY29uc3RydWN0b3IgPT09IE9iamVjdCkgewogICAgICAgICAgICBpZiAoYVtwcm9wXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgYVtwcm9wXSA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhW3Byb3BdLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHsKICAgICAgICAgICAgICBleHBvcnRzLmRlZXBFeHRlbmQoYVtwcm9wXSwgYltwcm9wXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKGJbcHJvcF0gPT09IG51bGwgJiYgYVtwcm9wXSAhPT0gdW5kZWZpbmVkICYmIGFsbG93RGVsZXRpb24gPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBhW3Byb3BdOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhW3Byb3BdID0gYltwcm9wXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShiW3Byb3BdKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheXMgYXJlIG5vdCBzdXBwb3J0ZWQgYnkgZGVlcEV4dGVuZCcpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYVtwcm9wXSA9IGJbcHJvcF07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gYTsKICB9OwoKICAvKioKICAgKiBEZWVwIGV4dGVuZCBhbiBvYmplY3QgYSB3aXRoIHRoZSBwcm9wZXJ0aWVzIG9mIG9iamVjdCBiCiAgICogQHBhcmFtIHtPYmplY3R9IGEKICAgKiBAcGFyYW0ge09iamVjdH0gYgogICAqIEBwYXJhbSBbQm9vbGVhbl0gcHJvdG9FeHRlbmQgLS0+IG9wdGlvbmFsIHBhcmFtZXRlci4gSWYgdHJ1ZSwgdGhlIHByb3RvdHlwZSB2YWx1ZXMgd2lsbCBhbHNvIGJlIGV4dGVuZGVkLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChpZS4gdGhlIG9wdGlvbnMgb2JqZWN0cyB0aGF0IGluaGVyaXQgZnJvbSBvdGhlcnMgd2lsbCBhbHNvIGdldCB0aGUgaW5oZXJpdGVkIG9wdGlvbnMpCiAgICogQHBhcmFtIFtCb29sZWFuXSBnbG9iYWwgICAgICAtLT4gb3B0aW9uYWwgcGFyYW1ldGVyLiBJZiB0cnVlLCB0aGUgdmFsdWVzIG9mIGZpZWxkcyB0aGF0IGFyZSBudWxsIHdpbGwgbm90IGRlbGV0ZWQKICAgKiBAcmV0dXJucyB7T2JqZWN0fQogICAqLwogIGV4cG9ydHMuZGVlcEV4dGVuZCA9IGZ1bmN0aW9uIChhLCBiLCBwcm90b0V4dGVuZCwgYWxsb3dEZWxldGlvbikgewogICAgZm9yICh2YXIgcHJvcCBpbiBiKSB7CiAgICAgIGlmIChiLmhhc093blByb3BlcnR5KHByb3ApIHx8IHByb3RvRXh0ZW5kID09PSB0cnVlKSB7CiAgICAgICAgaWYgKGJbcHJvcF0gJiYgYltwcm9wXS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7CiAgICAgICAgICBpZiAoYVtwcm9wXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGFbcHJvcF0gPSB7fTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChhW3Byb3BdLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHsKICAgICAgICAgICAgZXhwb3J0cy5kZWVwRXh0ZW5kKGFbcHJvcF0sIGJbcHJvcF0sIHByb3RvRXh0ZW5kKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChiW3Byb3BdID09PSBudWxsICYmIGFbcHJvcF0gIT09IHVuZGVmaW5lZCAmJiBhbGxvd0RlbGV0aW9uID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgZGVsZXRlIGFbcHJvcF07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYVtwcm9wXSA9IGJbcHJvcF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoYltwcm9wXSkpIHsKICAgICAgICAgIGFbcHJvcF0gPSBbXTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYltwcm9wXS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhW3Byb3BdLnB1c2goYltwcm9wXVtpXSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFbcHJvcF0gPSBiW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGE7CiAgfTsKCiAgLyoqCiAgICogVGVzdCB3aGV0aGVyIGFsbCBlbGVtZW50cyBpbiB0d28gYXJyYXlzIGFyZSBlcXVhbC4KICAgKiBAcGFyYW0ge0FycmF5fSBhCiAgICogQHBhcmFtIHtBcnJheX0gYgogICAqIEByZXR1cm4ge2Jvb2xlYW59IFJldHVybnMgdHJ1ZSBpZiBib3RoIGFycmF5cyBoYXZlIHRoZSBzYW1lIGxlbmd0aCBhbmQgc2FtZQogICAqICAgICAgICAgICAgICAgICAgIGVsZW1lbnRzLgogICAqLwogIGV4cG9ydHMuZXF1YWxBcnJheSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICBpZiAoYS5sZW5ndGggIT0gYi5sZW5ndGgpIHJldHVybiBmYWxzZTsKCiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICBpZiAoYVtpXSAhPSBiW2ldKSByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLyoqCiAgICogQ29udmVydCBhbiBvYmplY3QgdG8gYW5vdGhlciB0eXBlCiAgICogQHBhcmFtIHtCb29sZWFuIHwgTnVtYmVyIHwgU3RyaW5nIHwgRGF0ZSB8IE1vbWVudCB8IE51bGwgfCB1bmRlZmluZWR9IG9iamVjdAogICAqIEBwYXJhbSB7U3RyaW5nIHwgdW5kZWZpbmVkfSB0eXBlICAgTmFtZSBvZiB0aGUgdHlwZS4gQXZhaWxhYmxlIHR5cGVzOgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0Jvb2xlYW4nLCAnTnVtYmVyJywgJ1N0cmluZycsCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnRGF0ZScsICdNb21lbnQnLCBJU09EYXRlJywgJ0FTUERhdGUnLgogICAqIEByZXR1cm4geyp9IG9iamVjdAogICAqIEB0aHJvd3MgRXJyb3IKICAgKi8KICBleHBvcnRzLmNvbnZlcnQgPSBmdW5jdGlvbiAob2JqZWN0LCB0eXBlKSB7CiAgICB2YXIgbWF0Y2g7CgogICAgaWYgKG9iamVjdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBpZiAob2JqZWN0ID09PSBudWxsKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGlmICghdHlwZSkgewogICAgICByZXR1cm4gb2JqZWN0OwogICAgfQogICAgaWYgKCEodHlwZW9mIHR5cGUgPT09ICdzdHJpbmcnKSAmJiAhKHR5cGUgaW5zdGFuY2VvZiBTdHJpbmcpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignVHlwZSBtdXN0IGJlIGEgc3RyaW5nJyk7CiAgICB9CgogICAgLy9ub2luc3BlY3Rpb24gRmFsbHRocm91Z2hJblN3aXRjaFN0YXRlbWVudEpTCiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnYm9vbGVhbic6CiAgICAgIGNhc2UgJ0Jvb2xlYW4nOgogICAgICAgIHJldHVybiBCb29sZWFuKG9iamVjdCk7CgogICAgICBjYXNlICdudW1iZXInOgogICAgICBjYXNlICdOdW1iZXInOgogICAgICAgIHJldHVybiBOdW1iZXIob2JqZWN0LnZhbHVlT2YoKSk7CgogICAgICBjYXNlICdzdHJpbmcnOgogICAgICBjYXNlICdTdHJpbmcnOgogICAgICAgIHJldHVybiBTdHJpbmcob2JqZWN0KTsKCiAgICAgIGNhc2UgJ0RhdGUnOgogICAgICAgIGlmIChleHBvcnRzLmlzTnVtYmVyKG9iamVjdCkpIHsKICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShvYmplY3QpOwogICAgICAgIH0KICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKG9iamVjdC52YWx1ZU9mKCkpOwogICAgICAgIH0gZWxzZSBpZiAobW9tZW50LmlzTW9tZW50KG9iamVjdCkpIHsKICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShvYmplY3QudmFsdWVPZigpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGV4cG9ydHMuaXNTdHJpbmcob2JqZWN0KSkgewogICAgICAgICAgbWF0Y2ggPSBBU1BEYXRlUmVnZXguZXhlYyhvYmplY3QpOwogICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgIC8vIG9iamVjdCBpcyBhbiBBU1AgZGF0ZQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoTnVtYmVyKG1hdGNoWzFdKSk7IC8vIHBhcnNlIG51bWJlcgogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG1vbWVudChvYmplY3QpLnRvRGF0ZSgpOyAvLyBwYXJzZSBzdHJpbmcKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY29udmVydCBvYmplY3Qgb2YgdHlwZSAnICsgZXhwb3J0cy5nZXRUeXBlKG9iamVjdCkgKyAnIHRvIHR5cGUgRGF0ZScpOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ01vbWVudCc6CiAgICAgICAgaWYgKGV4cG9ydHMuaXNOdW1iZXIob2JqZWN0KSkgewogICAgICAgICAgcmV0dXJuIG1vbWVudChvYmplY3QpOwogICAgICAgIH0KICAgICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgcmV0dXJuIG1vbWVudChvYmplY3QudmFsdWVPZigpKTsKICAgICAgICB9IGVsc2UgaWYgKG1vbWVudC5pc01vbWVudChvYmplY3QpKSB7CiAgICAgICAgICByZXR1cm4gbW9tZW50KG9iamVjdCk7CiAgICAgICAgfQogICAgICAgIGlmIChleHBvcnRzLmlzU3RyaW5nKG9iamVjdCkpIHsKICAgICAgICAgIG1hdGNoID0gQVNQRGF0ZVJlZ2V4LmV4ZWMob2JqZWN0KTsKICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAvLyBvYmplY3QgaXMgYW4gQVNQIGRhdGUKICAgICAgICAgICAgcmV0dXJuIG1vbWVudChOdW1iZXIobWF0Y2hbMV0pKTsgLy8gcGFyc2UgbnVtYmVyCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbW9tZW50KG9iamVjdCk7IC8vIHBhcnNlIHN0cmluZwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0IG9iamVjdCBvZiB0eXBlICcgKyBleHBvcnRzLmdldFR5cGUob2JqZWN0KSArICcgdG8gdHlwZSBEYXRlJyk7CiAgICAgICAgfQoKICAgICAgY2FzZSAnSVNPRGF0ZSc6CiAgICAgICAgaWYgKGV4cG9ydHMuaXNOdW1iZXIob2JqZWN0KSkgewogICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKG9iamVjdCk7CiAgICAgICAgfSBlbHNlIGlmIChvYmplY3QgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgICByZXR1cm4gb2JqZWN0LnRvSVNPU3RyaW5nKCk7CiAgICAgICAgfSBlbHNlIGlmIChtb21lbnQuaXNNb21lbnQob2JqZWN0KSkgewogICAgICAgICAgcmV0dXJuIG9iamVjdC50b0RhdGUoKS50b0lTT1N0cmluZygpOwogICAgICAgIH0gZWxzZSBpZiAoZXhwb3J0cy5pc1N0cmluZyhvYmplY3QpKSB7CiAgICAgICAgICBtYXRjaCA9IEFTUERhdGVSZWdleC5leGVjKG9iamVjdCk7CiAgICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgICAgLy8gb2JqZWN0IGlzIGFuIEFTUCBkYXRlCiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShOdW1iZXIobWF0Y2hbMV0pKS50b0lTT1N0cmluZygpOyAvLyBwYXJzZSBudW1iZXIKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShvYmplY3QpLnRvSVNPU3RyaW5nKCk7IC8vIHBhcnNlIHN0cmluZwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0IG9iamVjdCBvZiB0eXBlICcgKyBleHBvcnRzLmdldFR5cGUob2JqZWN0KSArICcgdG8gdHlwZSBJU09EYXRlJyk7CiAgICAgICAgfQoKICAgICAgY2FzZSAnQVNQRGF0ZSc6CiAgICAgICAgaWYgKGV4cG9ydHMuaXNOdW1iZXIob2JqZWN0KSkgewogICAgICAgICAgcmV0dXJuICcvRGF0ZSgnICsgb2JqZWN0ICsgJykvJzsKICAgICAgICB9IGVsc2UgaWYgKG9iamVjdCBpbnN0YW5jZW9mIERhdGUpIHsKICAgICAgICAgIHJldHVybiAnL0RhdGUoJyArIG9iamVjdC52YWx1ZU9mKCkgKyAnKS8nOwogICAgICAgIH0gZWxzZSBpZiAoZXhwb3J0cy5pc1N0cmluZyhvYmplY3QpKSB7CiAgICAgICAgICBtYXRjaCA9IEFTUERhdGVSZWdleC5leGVjKG9iamVjdCk7CiAgICAgICAgICB2YXIgdmFsdWU7CiAgICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgICAgLy8gb2JqZWN0IGlzIGFuIEFTUCBkYXRlCiAgICAgICAgICAgIHZhbHVlID0gbmV3IERhdGUoTnVtYmVyKG1hdGNoWzFdKSkudmFsdWVPZigpOyAvLyBwYXJzZSBudW1iZXIKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhbHVlID0gbmV3IERhdGUob2JqZWN0KS52YWx1ZU9mKCk7IC8vIHBhcnNlIHN0cmluZwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICcvRGF0ZSgnICsgdmFsdWUgKyAnKS8nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0IG9iamVjdCBvZiB0eXBlICcgKyBleHBvcnRzLmdldFR5cGUob2JqZWN0KSArICcgdG8gdHlwZSBBU1BEYXRlJyk7CiAgICAgICAgfQoKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gdHlwZSAiJyArIHR5cGUgKyAnIicpOwogICAgfQogIH07CgogIC8vIHBhcnNlIEFTUC5OZXQgRGF0ZSBwYXR0ZXJuLAogIC8vIGZvciBleGFtcGxlICcvRGF0ZSgxMTk4OTA4NzE3MDU2KS8nIG9yICcvRGF0ZSgxMTk4OTA4NzE3MDU2LTA3MDApLycKICAvLyBjb2RlIGZyb20gaHR0cDovL21vbWVudGpzLmNvbS8KICB2YXIgQVNQRGF0ZVJlZ2V4ID0gL15cLz9EYXRlXCgoXC0/XGQrKS9pOwoKICAvKioKICAgKiBHZXQgdGhlIHR5cGUgb2YgYW4gb2JqZWN0LCBmb3IgZXhhbXBsZSBleHBvcnRzLmdldFR5cGUoW10pIHJldHVybnMgJ0FycmF5JwogICAqIEBwYXJhbSB7Kn0gb2JqZWN0CiAgICogQHJldHVybiB7U3RyaW5nfSB0eXBlCiAgICovCiAgZXhwb3J0cy5nZXRUeXBlID0gZnVuY3Rpb24gKG9iamVjdCkgewogICAgdmFyIHR5cGUgPSB0eXBlb2Ygb2JqZWN0OwoKICAgIGlmICh0eXBlID09ICdvYmplY3QnKSB7CiAgICAgIGlmIChvYmplY3QgPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gJ251bGwnOwogICAgICB9CiAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBCb29sZWFuKSB7CiAgICAgICAgcmV0dXJuICdCb29sZWFuJzsKICAgICAgfQogICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgTnVtYmVyKSB7CiAgICAgICAgcmV0dXJuICdOdW1iZXInOwogICAgICB9CiAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICByZXR1cm4gJ1N0cmluZyc7CiAgICAgIH0KICAgICAgaWYgKEFycmF5LmlzQXJyYXkob2JqZWN0KSkgewogICAgICAgIHJldHVybiAnQXJyYXknOwogICAgICB9CiAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgcmV0dXJuICdEYXRlJzsKICAgICAgfQogICAgICByZXR1cm4gJ09iamVjdCc7CiAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ251bWJlcicpIHsKICAgICAgcmV0dXJuICdOdW1iZXInOwogICAgfSBlbHNlIGlmICh0eXBlID09ICdib29sZWFuJykgewogICAgICByZXR1cm4gJ0Jvb2xlYW4nOwogICAgfSBlbHNlIGlmICh0eXBlID09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiAnU3RyaW5nJzsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiAndW5kZWZpbmVkJzsKICAgIH0KCiAgICByZXR1cm4gdHlwZTsKICB9OwoKICAvKioKICAgKiBVc2VkIHRvIGV4dGVuZCBhbiBhcnJheSBhbmQgY29weSBpdC4gVGhpcyBpcyB1c2VkIHRvIHByb3BhZ2F0ZSBwYXRocyByZWN1cnNpdmVseS4KICAgKgogICAqIEBwYXJhbSBhcnIKICAgKiBAcGFyYW0gbmV3VmFsdWUKICAgKiBAcmV0dXJucyB7QXJyYXl9CiAgICovCiAgZXhwb3J0cy5jb3B5QW5kRXh0ZW5kQXJyYXkgPSBmdW5jdGlvbiAoYXJyLCBuZXdWYWx1ZSkgewogICAgdmFyIG5ld0FyciA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgbmV3QXJyLnB1c2goYXJyW2ldKTsKICAgIH0KICAgIG5ld0Fyci5wdXNoKG5ld1ZhbHVlKTsKICAgIHJldHVybiBuZXdBcnI7CiAgfTsKCiAgLyoqCiAgICogVXNlZCB0byBleHRlbmQgYW4gYXJyYXkgYW5kIGNvcHkgaXQuIFRoaXMgaXMgdXNlZCB0byBwcm9wYWdhdGUgcGF0aHMgcmVjdXJzaXZlbHkuCiAgICoKICAgKiBAcGFyYW0gYXJyCiAgICogQHBhcmFtIG5ld1ZhbHVlCiAgICogQHJldHVybnMge0FycmF5fQogICAqLwogIGV4cG9ydHMuY29weUFycmF5ID0gZnVuY3Rpb24gKGFycikgewogICAgdmFyIG5ld0FyciA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgbmV3QXJyLnB1c2goYXJyW2ldKTsKICAgIH0KICAgIHJldHVybiBuZXdBcnI7CiAgfTsKCiAgLyoqCiAgICogUmV0cmlldmUgdGhlIGFic29sdXRlIGxlZnQgdmFsdWUgb2YgYSBET00gZWxlbWVudAogICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbSAgICAgICAgQSBkb20gZWxlbWVudCwgZm9yIGV4YW1wbGUgYSBkaXYKICAgKiBAcmV0dXJuIHtudW1iZXJ9IGxlZnQgICAgICAgIFRoZSBhYnNvbHV0ZSBsZWZ0IHBvc2l0aW9uIG9mIHRoaXMgZWxlbWVudAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW4gdGhlIGJyb3dzZXIgcGFnZS4KICAgKi8KICBleHBvcnRzLmdldEFic29sdXRlTGVmdCA9IGZ1bmN0aW9uIChlbGVtKSB7CiAgICByZXR1cm4gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0OwogIH07CgogIC8qKgogICAqIFJldHJpZXZlIHRoZSBhYnNvbHV0ZSB0b3AgdmFsdWUgb2YgYSBET00gZWxlbWVudAogICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbSAgICAgICAgQSBkb20gZWxlbWVudCwgZm9yIGV4YW1wbGUgYSBkaXYKICAgKiBAcmV0dXJuIHtudW1iZXJ9IHRvcCAgICAgICAgVGhlIGFic29sdXRlIHRvcCBwb3NpdGlvbiBvZiB0aGlzIGVsZW1lbnQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIHRoZSBicm93c2VyIHBhZ2UuCiAgICovCiAgZXhwb3J0cy5nZXRBYnNvbHV0ZVRvcCA9IGZ1bmN0aW9uIChlbGVtKSB7CiAgICByZXR1cm4gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7CiAgfTsKCiAgLyoqCiAgICogYWRkIGEgY2xhc3NOYW1lIHRvIHRoZSBnaXZlbiBlbGVtZW50cyBzdHlsZQogICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbQogICAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUKICAgKi8KICBleHBvcnRzLmFkZENsYXNzTmFtZSA9IGZ1bmN0aW9uIChlbGVtLCBjbGFzc05hbWUpIHsKICAgIHZhciBjbGFzc2VzID0gZWxlbS5jbGFzc05hbWUuc3BsaXQoJyAnKTsKICAgIGlmIChjbGFzc2VzLmluZGV4T2YoY2xhc3NOYW1lKSA9PSAtMSkgewogICAgICBjbGFzc2VzLnB1c2goY2xhc3NOYW1lKTsgLy8gYWRkIHRoZSBjbGFzcyB0byB0aGUgYXJyYXkKICAgICAgZWxlbS5jbGFzc05hbWUgPSBjbGFzc2VzLmpvaW4oJyAnKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBhZGQgYSBjbGFzc05hbWUgdG8gdGhlIGdpdmVuIGVsZW1lbnRzIHN0eWxlCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtCiAgICogQHBhcmFtIHtTdHJpbmd9IGNsYXNzTmFtZQogICAqLwogIGV4cG9ydHMucmVtb3ZlQ2xhc3NOYW1lID0gZnVuY3Rpb24gKGVsZW0sIGNsYXNzTmFtZSkgewogICAgdmFyIGNsYXNzZXMgPSBlbGVtLmNsYXNzTmFtZS5zcGxpdCgnICcpOwogICAgdmFyIGluZGV4ID0gY2xhc3Nlcy5pbmRleE9mKGNsYXNzTmFtZSk7CiAgICBpZiAoaW5kZXggIT0gLTEpIHsKICAgICAgY2xhc3Nlcy5zcGxpY2UoaW5kZXgsIDEpOyAvLyByZW1vdmUgdGhlIGNsYXNzIGZyb20gdGhlIGFycmF5CiAgICAgIGVsZW0uY2xhc3NOYW1lID0gY2xhc3Nlcy5qb2luKCcgJyk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogRm9yIGVhY2ggbWV0aG9kIGZvciBib3RoIGFycmF5cyBhbmQgb2JqZWN0cy4KICAgKiBJbiBjYXNlIG9mIGFuIGFycmF5LCB0aGUgYnVpbHQtaW4gQXJyYXkuZm9yRWFjaCgpIGlzIGFwcGxpZWQuCiAgICogSW4gY2FzZSBvZiBhbiBPYmplY3QsIHRoZSBtZXRob2QgbG9vcHMgb3ZlciBhbGwgcHJvcGVydGllcyBvZiB0aGUgb2JqZWN0LgogICAqIEBwYXJhbSB7T2JqZWN0IHwgQXJyYXl9IG9iamVjdCAgIEFuIE9iamVjdCBvciBBcnJheQogICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrICAgICAgIENhbGxiYWNrIG1ldGhvZCwgY2FsbGVkIGZvciBlYWNoIGl0ZW0gaW4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgb2JqZWN0IG9yIGFycmF5IHdpdGggdGhyZWUgcGFyYW1ldGVyczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh2YWx1ZSwgaW5kZXgsIG9iamVjdCkKICAgKi8KICBleHBvcnRzLmZvckVhY2ggPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykgewogICAgdmFyIGksIGxlbjsKICAgIGlmIChBcnJheS5pc0FycmF5KG9iamVjdCkpIHsKICAgICAgLy8gYXJyYXkKICAgICAgZm9yIChpID0gMCwgbGVuID0gb2JqZWN0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgY2FsbGJhY2sob2JqZWN0W2ldLCBpLCBvYmplY3QpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBvYmplY3QKICAgICAgZm9yIChpIGluIG9iamVjdCkgewogICAgICAgIGlmIChvYmplY3QuaGFzT3duUHJvcGVydHkoaSkpIHsKICAgICAgICAgIGNhbGxiYWNrKG9iamVjdFtpXSwgaSwgb2JqZWN0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBDb252ZXJ0IGFuIG9iamVjdCBpbnRvIGFuIGFycmF5OiBhbGwgb2JqZWN0cyBwcm9wZXJ0aWVzIGFyZSBwdXQgaW50byB0aGUKICAgKiBhcnJheS4gVGhlIHJlc3VsdGluZyBhcnJheSBpcyB1bm9yZGVyZWQuCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdAogICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5CiAgICovCiAgZXhwb3J0cy50b0FycmF5ID0gZnVuY3Rpb24gKG9iamVjdCkgewogICAgdmFyIGFycmF5ID0gW107CgogICAgZm9yICh2YXIgcHJvcCBpbiBvYmplY3QpIHsKICAgICAgaWYgKG9iamVjdC5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgYXJyYXkucHVzaChvYmplY3RbcHJvcF0pOwogICAgfQoKICAgIHJldHVybiBhcnJheTsKICB9OwoKICAvKioKICAgKiBVcGRhdGUgYSBwcm9wZXJ0eSBpbiBhbiBvYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0CiAgICogQHBhcmFtIHtTdHJpbmd9IGtleQogICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgKiBAcmV0dXJuIHtCb29sZWFufSBjaGFuZ2VkCiAgICovCiAgZXhwb3J0cy51cGRhdGVQcm9wZXJ0eSA9IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHsKICAgIGlmIChvYmplY3Rba2V5XSAhPT0gdmFsdWUpIHsKICAgICAgb2JqZWN0W2tleV0gPSB2YWx1ZTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQWRkIGFuZCBldmVudCBsaXN0ZW5lci4gV29ya3MgZm9yIGFsbCBicm93c2VycwogICAqIEBwYXJhbSB7RWxlbWVudH0gICAgIGVsZW1lbnQgICAgQW4gaHRtbCBlbGVtZW50CiAgICogQHBhcmFtIHtzdHJpbmd9ICAgICAgYWN0aW9uICAgICBUaGUgYWN0aW9uLCBmb3IgZXhhbXBsZSAiY2xpY2siLAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aG91dCB0aGUgcHJlZml4ICJvbiIKICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSAgICBsaXN0ZW5lciAgIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZAogICAqIEBwYXJhbSB7Ym9vbGVhbn0gICAgIFt1c2VDYXB0dXJlXQogICAqLwogIGV4cG9ydHMuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uIChlbGVtZW50LCBhY3Rpb24sIGxpc3RlbmVyLCB1c2VDYXB0dXJlKSB7CiAgICBpZiAoZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIGlmICh1c2VDYXB0dXJlID09PSB1bmRlZmluZWQpIHVzZUNhcHR1cmUgPSBmYWxzZTsKCiAgICAgIGlmIChhY3Rpb24gPT09ICdtb3VzZXdoZWVsJyAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0ZpcmVmb3gnKSA+PSAwKSB7CiAgICAgICAgYWN0aW9uID0gJ0RPTU1vdXNlU2Nyb2xsJzsgLy8gRm9yIEZpcmVmb3gKICAgICAgfQoKICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGFjdGlvbiwgbGlzdGVuZXIsIHVzZUNhcHR1cmUpOwogICAgfSBlbHNlIHsKICAgICAgZWxlbWVudC5hdHRhY2hFdmVudCgnb24nICsgYWN0aW9uLCBsaXN0ZW5lcik7IC8vIElFIGJyb3dzZXJzCiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmVtb3ZlIGFuIGV2ZW50IGxpc3RlbmVyIGZyb20gYW4gZWxlbWVudAogICAqIEBwYXJhbSB7RWxlbWVudH0gICAgIGVsZW1lbnQgICAgICAgICBBbiBodG1sIGRvbSBlbGVtZW50CiAgICogQHBhcmFtIHtzdHJpbmd9ICAgICAgYWN0aW9uICAgICAgICAgIFRoZSBuYW1lIG9mIHRoZSBldmVudCwgZm9yIGV4YW1wbGUgIm1vdXNlZG93biIKICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSAgICBsaXN0ZW5lciAgICAgICAgVGhlIGxpc3RlbmVyIGZ1bmN0aW9uCiAgICogQHBhcmFtIHtib29sZWFufSAgICAgW3VzZUNhcHR1cmVdCiAgICovCiAgZXhwb3J0cy5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKGVsZW1lbnQsIGFjdGlvbiwgbGlzdGVuZXIsIHVzZUNhcHR1cmUpIHsKICAgIGlmIChlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHsKICAgICAgLy8gbm9uLUlFIGJyb3dzZXJzCiAgICAgIGlmICh1c2VDYXB0dXJlID09PSB1bmRlZmluZWQpIHVzZUNhcHR1cmUgPSBmYWxzZTsKCiAgICAgIGlmIChhY3Rpb24gPT09ICdtb3VzZXdoZWVsJyAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0ZpcmVmb3gnKSA+PSAwKSB7CiAgICAgICAgYWN0aW9uID0gJ0RPTU1vdXNlU2Nyb2xsJzsgLy8gRm9yIEZpcmVmb3gKICAgICAgfQoKICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGFjdGlvbiwgbGlzdGVuZXIsIHVzZUNhcHR1cmUpOwogICAgfSBlbHNlIHsKICAgICAgLy8gSUUgYnJvd3NlcnMKICAgICAgZWxlbWVudC5kZXRhY2hFdmVudCgnb24nICsgYWN0aW9uLCBsaXN0ZW5lcik7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ2FuY2VscyB0aGUgZXZlbnQgaWYgaXQgaXMgY2FuY2VsYWJsZSwgd2l0aG91dCBzdG9wcGluZyBmdXJ0aGVyIHByb3BhZ2F0aW9uIG9mIHRoZSBldmVudC4KICAgKi8KICBleHBvcnRzLnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZiAoIWV2ZW50KSBldmVudCA9IHdpbmRvdy5ldmVudDsKCiAgICBpZiAoZXZlbnQucHJldmVudERlZmF1bHQpIHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gbm9uLUlFIGJyb3dzZXJzCiAgICB9IGVsc2UgewogICAgICBldmVudC5yZXR1cm5WYWx1ZSA9IGZhbHNlOyAvLyBJRSBicm93c2VycwogICAgfQogIH07CgogIC8qKgogICAqIEdldCBIVE1MIGVsZW1lbnQgd2hpY2ggaXMgdGhlIHRhcmdldCBvZiB0aGUgZXZlbnQKICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudAogICAqIEByZXR1cm4ge0VsZW1lbnR9IHRhcmdldCBlbGVtZW50CiAgICovCiAgZXhwb3J0cy5nZXRUYXJnZXQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIC8vIGNvZGUgZnJvbSBodHRwOi8vd3d3LnF1aXJrc21vZGUub3JnL2pzL2V2ZW50c19wcm9wZXJ0aWVzLmh0bWwKICAgIGlmICghZXZlbnQpIHsKICAgICAgZXZlbnQgPSB3aW5kb3cuZXZlbnQ7CiAgICB9CgogICAgdmFyIHRhcmdldDsKCiAgICBpZiAoZXZlbnQudGFyZ2V0KSB7CiAgICAgIHRhcmdldCA9IGV2ZW50LnRhcmdldDsKICAgIH0gZWxzZSBpZiAoZXZlbnQuc3JjRWxlbWVudCkgewogICAgICB0YXJnZXQgPSBldmVudC5zcmNFbGVtZW50OwogICAgfQoKICAgIGlmICh0YXJnZXQubm9kZVR5cGUgIT0gdW5kZWZpbmVkICYmIHRhcmdldC5ub2RlVHlwZSA9PSAzKSB7CiAgICAgIC8vIGRlZmVhdCBTYWZhcmkgYnVnCiAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlOwogICAgfQoKICAgIHJldHVybiB0YXJnZXQ7CiAgfTsKCiAgLyoqCiAgICogQ2hlY2sgaWYgZ2l2ZW4gZWxlbWVudCBjb250YWlucyBnaXZlbiBwYXJlbnQgc29tZXdoZXJlIGluIHRoZSBET00gdHJlZQogICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudAogICAqIEBwYXJhbSB7RWxlbWVudH0gcGFyZW50CiAgICovCiAgZXhwb3J0cy5oYXNQYXJlbnQgPSBmdW5jdGlvbiAoZWxlbWVudCwgcGFyZW50KSB7CiAgICB2YXIgZSA9IGVsZW1lbnQ7CgogICAgd2hpbGUgKGUpIHsKICAgICAgaWYgKGUgPT09IHBhcmVudCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGUgPSBlLnBhcmVudE5vZGU7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIGV4cG9ydHMub3B0aW9uID0ge307CgogIC8qKgogICAqIENvbnZlcnQgYSB2YWx1ZSBpbnRvIGEgYm9vbGVhbgogICAqIEBwYXJhbSB7Qm9vbGVhbiB8IGZ1bmN0aW9uIHwgdW5kZWZpbmVkfSB2YWx1ZQogICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2RlZmF1bHRWYWx1ZV0KICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gYm9vbAogICAqLwogIGV4cG9ydHMub3B0aW9uLmFzQm9vbGVhbiA9IGZ1bmN0aW9uICh2YWx1ZSwgZGVmYXVsdFZhbHVlKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlID09ICdmdW5jdGlvbicpIHsKICAgICAgdmFsdWUgPSB2YWx1ZSgpOwogICAgfQoKICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiB2YWx1ZSAhPSBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gZGVmYXVsdFZhbHVlIHx8IG51bGw7CiAgfTsKCiAgLyoqCiAgICogQ29udmVydCBhIHZhbHVlIGludG8gYSBudW1iZXIKICAgKiBAcGFyYW0ge0Jvb2xlYW4gfCBmdW5jdGlvbiB8IHVuZGVmaW5lZH0gdmFsdWUKICAgKiBAcGFyYW0ge051bWJlcn0gW2RlZmF1bHRWYWx1ZV0KICAgKiBAcmV0dXJucyB7TnVtYmVyfSBudW1iZXIKICAgKi8KICBleHBvcnRzLm9wdGlvbi5hc051bWJlciA9IGZ1bmN0aW9uICh2YWx1ZSwgZGVmYXVsdFZhbHVlKSB7CiAgICBpZiAodHlwZW9mIHZhbHVlID09ICdmdW5jdGlvbicpIHsKICAgICAgdmFsdWUgPSB2YWx1ZSgpOwogICAgfQoKICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBOdW1iZXIodmFsdWUpIHx8IGRlZmF1bHRWYWx1ZSB8fCBudWxsOwogICAgfQoKICAgIHJldHVybiBkZWZhdWx0VmFsdWUgfHwgbnVsbDsKICB9OwoKICAvKioKICAgKiBDb252ZXJ0IGEgdmFsdWUgaW50byBhIHN0cmluZwogICAqIEBwYXJhbSB7U3RyaW5nIHwgZnVuY3Rpb24gfCB1bmRlZmluZWR9IHZhbHVlCiAgICogQHBhcmFtIHtTdHJpbmd9IFtkZWZhdWx0VmFsdWVdCiAgICogQHJldHVybnMge1N0cmluZ30gc3RyCiAgICovCiAgZXhwb3J0cy5vcHRpb24uYXNTdHJpbmcgPSBmdW5jdGlvbiAodmFsdWUsIGRlZmF1bHRWYWx1ZSkgewogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgIHZhbHVlID0gdmFsdWUoKTsKICAgIH0KCiAgICBpZiAodmFsdWUgIT0gbnVsbCkgewogICAgICByZXR1cm4gU3RyaW5nKHZhbHVlKTsKICAgIH0KCiAgICByZXR1cm4gZGVmYXVsdFZhbHVlIHx8IG51bGw7CiAgfTsKCiAgLyoqCiAgICogQ29udmVydCBhIHNpemUgb3IgbG9jYXRpb24gaW50byBhIHN0cmluZyB3aXRoIHBpeGVscyBvciBhIHBlcmNlbnRhZ2UKICAgKiBAcGFyYW0ge1N0cmluZyB8IE51bWJlciB8IGZ1bmN0aW9uIHwgdW5kZWZpbmVkfSB2YWx1ZQogICAqIEBwYXJhbSB7U3RyaW5nfSBbZGVmYXVsdFZhbHVlXQogICAqIEByZXR1cm5zIHtTdHJpbmd9IHNpemUKICAgKi8KICBleHBvcnRzLm9wdGlvbi5hc1NpemUgPSBmdW5jdGlvbiAodmFsdWUsIGRlZmF1bHRWYWx1ZSkgewogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgIHZhbHVlID0gdmFsdWUoKTsKICAgIH0KCiAgICBpZiAoZXhwb3J0cy5pc1N0cmluZyh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSBlbHNlIGlmIChleHBvcnRzLmlzTnVtYmVyKHZhbHVlKSkgewogICAgICByZXR1cm4gdmFsdWUgKyAncHgnOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZSB8fCBudWxsOwogICAgfQogIH07CgogIC8qKgogICAqIENvbnZlcnQgYSB2YWx1ZSBpbnRvIGEgRE9NIGVsZW1lbnQKICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50IHwgZnVuY3Rpb24gfCB1bmRlZmluZWR9IHZhbHVlCiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gW2RlZmF1bHRWYWx1ZV0KICAgKiBAcmV0dXJucyB7SFRNTEVsZW1lbnQgfCBudWxsfSBkb20KICAgKi8KICBleHBvcnRzLm9wdGlvbi5hc0VsZW1lbnQgPSBmdW5jdGlvbiAodmFsdWUsIGRlZmF1bHRWYWx1ZSkgewogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnZnVuY3Rpb24nKSB7CiAgICAgIHZhbHVlID0gdmFsdWUoKTsKICAgIH0KCiAgICByZXR1cm4gdmFsdWUgfHwgZGVmYXVsdFZhbHVlIHx8IG51bGw7CiAgfTsKCiAgLyoqCiAgICogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy81NjIzODM4L3JnYi10by1oZXgtYW5kLWhleC10by1yZ2IKICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBoZXgKICAgKiBAcmV0dXJucyB7e3I6ICosIGc6ICosIGI6ICp9fSB8IDI1NSByYW5nZQogICAqLwogIGV4cG9ydHMuaGV4VG9SR0IgPSBmdW5jdGlvbiAoaGV4KSB7CiAgICAvLyBFeHBhbmQgc2hvcnRoYW5kIGZvcm0gKGUuZy4gIjAzRiIpIHRvIGZ1bGwgZm9ybSAoZS5nLiAiMDAzM0ZGIikKICAgIHZhciBzaG9ydGhhbmRSZWdleCA9IC9eIz8oW2EtZlxkXSkoW2EtZlxkXSkoW2EtZlxkXSkkL2k7CiAgICBoZXggPSBoZXgucmVwbGFjZShzaG9ydGhhbmRSZWdleCwgZnVuY3Rpb24gKG0sIHIsIGcsIGIpIHsKICAgICAgcmV0dXJuIHIgKyByICsgZyArIGcgKyBiICsgYjsKICAgIH0pOwogICAgdmFyIHJlc3VsdCA9IC9eIz8oW2EtZlxkXXsyfSkoW2EtZlxkXXsyfSkoW2EtZlxkXXsyfSkkL2kuZXhlYyhoZXgpOwogICAgcmV0dXJuIHJlc3VsdCA/IHsKICAgICAgcjogcGFyc2VJbnQocmVzdWx0WzFdLCAxNiksCiAgICAgIGc6IHBhcnNlSW50KHJlc3VsdFsyXSwgMTYpLAogICAgICBiOiBwYXJzZUludChyZXN1bHRbM10sIDE2KQogICAgfSA6IG51bGw7CiAgfTsKCiAgLyoqCiAgICogVGhpcyBmdW5jdGlvbiB0YWtlcyBjb2xvciBpbiBoZXggZm9ybWF0IG9yIHJnYigpIG9yIHJnYmEoKSBmb3JtYXQgYW5kIG92ZXJyaWRlcyB0aGUgb3BhY2l0eS4gUmV0dXJucyByZ2JhKCkgc3RyaW5nLgogICAqIEBwYXJhbSBjb2xvcgogICAqIEBwYXJhbSBvcGFjaXR5CiAgICogQHJldHVybnMgeyp9CiAgICovCiAgZXhwb3J0cy5vdmVycmlkZU9wYWNpdHkgPSBmdW5jdGlvbiAoY29sb3IsIG9wYWNpdHkpIHsKICAgIGlmIChjb2xvci5pbmRleE9mKCdyZ2JhJykgIT0gLTEpIHsKICAgICAgcmV0dXJuIGNvbG9yOwogICAgfSBlbHNlIGlmIChjb2xvci5pbmRleE9mKCdyZ2InKSAhPSAtMSkgewogICAgICB2YXIgcmdiID0gY29sb3Iuc3Vic3RyKGNvbG9yLmluZGV4T2YoJygnKSArIDEpLnJlcGxhY2UoJyknLCAnJykuc3BsaXQoJywnKTsKICAgICAgcmV0dXJuICdyZ2JhKCcgKyByZ2JbMF0gKyAnLCcgKyByZ2JbMV0gKyAnLCcgKyByZ2JbMl0gKyAnLCcgKyBvcGFjaXR5ICsgJyknOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHJnYiA9IGV4cG9ydHMuaGV4VG9SR0IoY29sb3IpOwogICAgICBpZiAocmdiID09IG51bGwpIHsKICAgICAgICByZXR1cm4gY29sb3I7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICdyZ2JhKCcgKyByZ2IuciArICcsJyArIHJnYi5nICsgJywnICsgcmdiLmIgKyAnLCcgKyBvcGFjaXR5ICsgJyknOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICoKICAgKiBAcGFyYW0gcmVkICAgICAwIC0tIDI1NQogICAqIEBwYXJhbSBncmVlbiAgIDAgLS0gMjU1CiAgICogQHBhcmFtIGJsdWUgICAgMCAtLSAyNTUKICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGV4cG9ydHMuUkdCVG9IZXggPSBmdW5jdGlvbiAocmVkLCBncmVlbiwgYmx1ZSkgewogICAgcmV0dXJuICcjJyArICgoMSA8PCAyNCkgKyAocmVkIDw8IDE2KSArIChncmVlbiA8PCA4KSArIGJsdWUpLnRvU3RyaW5nKDE2KS5zbGljZSgxKTsKICB9OwoKICAvKioKICAgKiBQYXJzZSBhIGNvbG9yIHByb3BlcnR5IGludG8gYW4gb2JqZWN0IHdpdGggYm9yZGVyLCBiYWNrZ3JvdW5kLCBhbmQKICAgKiBoaWdobGlnaHQgY29sb3JzCiAgICogQHBhcmFtIHtPYmplY3QgfCBTdHJpbmd9IGNvbG9yCiAgICogQHJldHVybiB7T2JqZWN0fSBjb2xvck9iamVjdAogICAqLwogIGV4cG9ydHMucGFyc2VDb2xvciA9IGZ1bmN0aW9uIChjb2xvcikgewogICAgdmFyIGM7CiAgICBpZiAoZXhwb3J0cy5pc1N0cmluZyhjb2xvcikgPT09IHRydWUpIHsKICAgICAgaWYgKGV4cG9ydHMuaXNWYWxpZFJHQihjb2xvcikgPT09IHRydWUpIHsKICAgICAgICB2YXIgcmdiID0gY29sb3Iuc3Vic3RyKDQpLnN1YnN0cigwLCBjb2xvci5sZW5ndGggLSA1KS5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgIHJldHVybiBwYXJzZUludCh2YWx1ZSk7CiAgICAgICAgfSk7CiAgICAgICAgY29sb3IgPSBleHBvcnRzLlJHQlRvSGV4KHJnYlswXSwgcmdiWzFdLCByZ2JbMl0pOwogICAgICB9CiAgICAgIGlmIChleHBvcnRzLmlzVmFsaWRIZXgoY29sb3IpID09PSB0cnVlKSB7CiAgICAgICAgdmFyIGhzdiA9IGV4cG9ydHMuaGV4VG9IU1YoY29sb3IpOwogICAgICAgIHZhciBsaWdodGVyQ29sb3JIU1YgPSB7IGg6IGhzdi5oLCBzOiBoc3YucyAqIDAuOCwgdjogTWF0aC5taW4oMSwgaHN2LnYgKiAxLjAyKSB9OwogICAgICAgIHZhciBkYXJrZXJDb2xvckhTViA9IHsgaDogaHN2LmgsIHM6IE1hdGgubWluKDEsIGhzdi5zICogMS4yNSksIHY6IGhzdi52ICogMC44IH07CiAgICAgICAgdmFyIGRhcmtlckNvbG9ySGV4ID0gZXhwb3J0cy5IU1ZUb0hleChkYXJrZXJDb2xvckhTVi5oLCBkYXJrZXJDb2xvckhTVi5zLCBkYXJrZXJDb2xvckhTVi52KTsKICAgICAgICB2YXIgbGlnaHRlckNvbG9ySGV4ID0gZXhwb3J0cy5IU1ZUb0hleChsaWdodGVyQ29sb3JIU1YuaCwgbGlnaHRlckNvbG9ySFNWLnMsIGxpZ2h0ZXJDb2xvckhTVi52KTsKICAgICAgICBjID0gewogICAgICAgICAgYmFja2dyb3VuZDogY29sb3IsCiAgICAgICAgICBib3JkZXI6IGRhcmtlckNvbG9ySGV4LAogICAgICAgICAgaGlnaGxpZ2h0OiB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpZ2h0ZXJDb2xvckhleCwKICAgICAgICAgICAgYm9yZGVyOiBkYXJrZXJDb2xvckhleAogICAgICAgICAgfSwKICAgICAgICAgIGhvdmVyOiB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpZ2h0ZXJDb2xvckhleCwKICAgICAgICAgICAgYm9yZGVyOiBkYXJrZXJDb2xvckhleAogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyA9IHsKICAgICAgICAgIGJhY2tncm91bmQ6IGNvbG9yLAogICAgICAgICAgYm9yZGVyOiBjb2xvciwKICAgICAgICAgIGhpZ2hsaWdodDogewogICAgICAgICAgICBiYWNrZ3JvdW5kOiBjb2xvciwKICAgICAgICAgICAgYm9yZGVyOiBjb2xvcgogICAgICAgICAgfSwKICAgICAgICAgIGhvdmVyOiB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGNvbG9yLAogICAgICAgICAgICBib3JkZXI6IGNvbG9yCiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgYyA9IHt9OwogICAgICBjLmJhY2tncm91bmQgPSBjb2xvci5iYWNrZ3JvdW5kIHx8IHVuZGVmaW5lZDsKICAgICAgYy5ib3JkZXIgPSBjb2xvci5ib3JkZXIgfHwgdW5kZWZpbmVkOwoKICAgICAgaWYgKGV4cG9ydHMuaXNTdHJpbmcoY29sb3IuaGlnaGxpZ2h0KSkgewogICAgICAgIGMuaGlnaGxpZ2h0ID0gewogICAgICAgICAgYm9yZGVyOiBjb2xvci5oaWdobGlnaHQsCiAgICAgICAgICBiYWNrZ3JvdW5kOiBjb2xvci5oaWdobGlnaHQKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIGMuaGlnaGxpZ2h0ID0ge307CiAgICAgICAgYy5oaWdobGlnaHQuYmFja2dyb3VuZCA9IGNvbG9yLmhpZ2hsaWdodCAmJiBjb2xvci5oaWdobGlnaHQuYmFja2dyb3VuZCB8fCB1bmRlZmluZWQ7CiAgICAgICAgYy5oaWdobGlnaHQuYm9yZGVyID0gY29sb3IuaGlnaGxpZ2h0ICYmIGNvbG9yLmhpZ2hsaWdodC5ib3JkZXIgfHwgdW5kZWZpbmVkOwogICAgICB9CgogICAgICBpZiAoZXhwb3J0cy5pc1N0cmluZyhjb2xvci5ob3ZlcikpIHsKICAgICAgICBjLmhvdmVyID0gewogICAgICAgICAgYm9yZGVyOiBjb2xvci5ob3ZlciwKICAgICAgICAgIGJhY2tncm91bmQ6IGNvbG9yLmhvdmVyCiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjLmhvdmVyID0ge307CiAgICAgICAgYy5ob3Zlci5iYWNrZ3JvdW5kID0gY29sb3IuaG92ZXIgJiYgY29sb3IuaG92ZXIuYmFja2dyb3VuZCB8fCB1bmRlZmluZWQ7CiAgICAgICAgYy5ob3Zlci5ib3JkZXIgPSBjb2xvci5ob3ZlciAmJiBjb2xvci5ob3Zlci5ib3JkZXIgfHwgdW5kZWZpbmVkOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGM7CiAgfTsKCiAgLyoqCiAgICogaHR0cDovL3d3dy5qYXZhc2NyaXB0ZXIubmV0L2ZhcS9yZ2IyaHN2Lmh0bQogICAqCiAgICogQHBhcmFtIHJlZAogICAqIEBwYXJhbSBncmVlbgogICAqIEBwYXJhbSBibHVlCiAgICogQHJldHVybnMgeyp9CiAgICogQGNvbnN0cnVjdG9yCiAgICovCiAgZXhwb3J0cy5SR0JUb0hTViA9IGZ1bmN0aW9uIChyZWQsIGdyZWVuLCBibHVlKSB7CiAgICByZWQgPSByZWQgLyAyNTU7Z3JlZW4gPSBncmVlbiAvIDI1NTtibHVlID0gYmx1ZSAvIDI1NTsKICAgIHZhciBtaW5SR0IgPSBNYXRoLm1pbihyZWQsIE1hdGgubWluKGdyZWVuLCBibHVlKSk7CiAgICB2YXIgbWF4UkdCID0gTWF0aC5tYXgocmVkLCBNYXRoLm1heChncmVlbiwgYmx1ZSkpOwoKICAgIC8vIEJsYWNrLWdyYXktd2hpdGUKICAgIGlmIChtaW5SR0IgPT0gbWF4UkdCKSB7CiAgICAgIHJldHVybiB7IGg6IDAsIHM6IDAsIHY6IG1pblJHQiB9OwogICAgfQoKICAgIC8vIENvbG9ycyBvdGhlciB0aGFuIGJsYWNrLWdyYXktd2hpdGU6CiAgICB2YXIgZCA9IHJlZCA9PSBtaW5SR0IgPyBncmVlbiAtIGJsdWUgOiBibHVlID09IG1pblJHQiA/IHJlZCAtIGdyZWVuIDogYmx1ZSAtIHJlZDsKICAgIHZhciBoID0gcmVkID09IG1pblJHQiA/IDMgOiBibHVlID09IG1pblJHQiA/IDEgOiA1OwogICAgdmFyIGh1ZSA9IDYwICogKGggLSBkIC8gKG1heFJHQiAtIG1pblJHQikpIC8gMzYwOwogICAgdmFyIHNhdHVyYXRpb24gPSAobWF4UkdCIC0gbWluUkdCKSAvIG1heFJHQjsKICAgIHZhciB2YWx1ZSA9IG1heFJHQjsKICAgIHJldHVybiB7IGg6IGh1ZSwgczogc2F0dXJhdGlvbiwgdjogdmFsdWUgfTsKICB9OwoKICB2YXIgY3NzVXRpbCA9IHsKICAgIC8vIHNwbGl0IGEgc3RyaW5nIHdpdGggY3NzIHN0eWxlcyBpbnRvIGFuIG9iamVjdCB3aXRoIGtleS92YWx1ZXMKICAgIHNwbGl0OiBmdW5jdGlvbiBzcGxpdChjc3NUZXh0KSB7CiAgICAgIHZhciBzdHlsZXMgPSB7fTsKCiAgICAgIGNzc1RleHQuc3BsaXQoJzsnKS5mb3JFYWNoKGZ1bmN0aW9uIChzdHlsZSkgewogICAgICAgIGlmIChzdHlsZS50cmltKCkgIT0gJycpIHsKICAgICAgICAgIHZhciBwYXJ0cyA9IHN0eWxlLnNwbGl0KCc6Jyk7CiAgICAgICAgICB2YXIga2V5ID0gcGFydHNbMF0udHJpbSgpOwogICAgICAgICAgdmFyIHZhbHVlID0gcGFydHNbMV0udHJpbSgpOwogICAgICAgICAgc3R5bGVzW2tleV0gPSB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHN0eWxlczsKICAgIH0sCgogICAgLy8gYnVpbGQgYSBjc3MgdGV4dCBzdHJpbmcgZnJvbSBhbiBvYmplY3Qgd2l0aCBrZXkvdmFsdWVzCiAgICBqb2luOiBmdW5jdGlvbiBqb2luKHN0eWxlcykgewogICAgICByZXR1cm4gT2JqZWN0LmtleXMoc3R5bGVzKS5tYXAoZnVuY3Rpb24gKGtleSkgewogICAgICAgIHJldHVybiBrZXkgKyAnOiAnICsgc3R5bGVzW2tleV07CiAgICAgIH0pLmpvaW4oJzsgJyk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQXBwZW5kIGEgc3RyaW5nIHdpdGggY3NzIHN0eWxlcyB0byBhbiBlbGVtZW50CiAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50CiAgICogQHBhcmFtIHtTdHJpbmd9IGNzc1RleHQKICAgKi8KICBleHBvcnRzLmFkZENzc1RleHQgPSBmdW5jdGlvbiAoZWxlbWVudCwgY3NzVGV4dCkgewogICAgdmFyIGN1cnJlbnRTdHlsZXMgPSBjc3NVdGlsLnNwbGl0KGVsZW1lbnQuc3R5bGUuY3NzVGV4dCk7CiAgICB2YXIgbmV3U3R5bGVzID0gY3NzVXRpbC5zcGxpdChjc3NUZXh0KTsKICAgIHZhciBzdHlsZXMgPSBleHBvcnRzLmV4dGVuZChjdXJyZW50U3R5bGVzLCBuZXdTdHlsZXMpOwoKICAgIGVsZW1lbnQuc3R5bGUuY3NzVGV4dCA9IGNzc1V0aWwuam9pbihzdHlsZXMpOwogIH07CgogIC8qKgogICAqIFJlbW92ZSBhIHN0cmluZyB3aXRoIGNzcyBzdHlsZXMgZnJvbSBhbiBlbGVtZW50CiAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50CiAgICogQHBhcmFtIHtTdHJpbmd9IGNzc1RleHQKICAgKi8KICBleHBvcnRzLnJlbW92ZUNzc1RleHQgPSBmdW5jdGlvbiAoZWxlbWVudCwgY3NzVGV4dCkgewogICAgdmFyIHN0eWxlcyA9IGNzc1V0aWwuc3BsaXQoZWxlbWVudC5zdHlsZS5jc3NUZXh0KTsKICAgIHZhciByZW1vdmVTdHlsZXMgPSBjc3NVdGlsLnNwbGl0KGNzc1RleHQpOwoKICAgIGZvciAodmFyIGtleSBpbiByZW1vdmVTdHlsZXMpIHsKICAgICAgaWYgKHJlbW92ZVN0eWxlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgZGVsZXRlIHN0eWxlc1trZXldOwogICAgICB9CiAgICB9CgogICAgZWxlbWVudC5zdHlsZS5jc3NUZXh0ID0gY3NzVXRpbC5qb2luKHN0eWxlcyk7CiAgfTsKCiAgLyoqCiAgICogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vbWppamFja3Nvbi81MzExMjU2CiAgICogQHBhcmFtIGgKICAgKiBAcGFyYW0gcwogICAqIEBwYXJhbSB2CiAgICogQHJldHVybnMge3tyOiBudW1iZXIsIGc6IG51bWJlciwgYjogbnVtYmVyfX0KICAgKiBAY29uc3RydWN0b3IKICAgKi8KICBleHBvcnRzLkhTVlRvUkdCID0gZnVuY3Rpb24gKGgsIHMsIHYpIHsKICAgIHZhciByLCBnLCBiOwoKICAgIHZhciBpID0gTWF0aC5mbG9vcihoICogNik7CiAgICB2YXIgZiA9IGggKiA2IC0gaTsKICAgIHZhciBwID0gdiAqICgxIC0gcyk7CiAgICB2YXIgcSA9IHYgKiAoMSAtIGYgKiBzKTsKICAgIHZhciB0ID0gdiAqICgxIC0gKDEgLSBmKSAqIHMpOwoKICAgIHN3aXRjaCAoaSAlIDYpIHsKICAgICAgY2FzZSAwOgogICAgICAgIHIgPSB2LCBnID0gdCwgYiA9IHA7YnJlYWs7CiAgICAgIGNhc2UgMToKICAgICAgICByID0gcSwgZyA9IHYsIGIgPSBwO2JyZWFrOwogICAgICBjYXNlIDI6CiAgICAgICAgciA9IHAsIGcgPSB2LCBiID0gdDticmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIHIgPSBwLCBnID0gcSwgYiA9IHY7YnJlYWs7CiAgICAgIGNhc2UgNDoKICAgICAgICByID0gdCwgZyA9IHAsIGIgPSB2O2JyZWFrOwogICAgICBjYXNlIDU6CiAgICAgICAgciA9IHYsIGcgPSBwLCBiID0gcTticmVhazsKICAgIH0KCiAgICByZXR1cm4geyByOiBNYXRoLmZsb29yKHIgKiAyNTUpLCBnOiBNYXRoLmZsb29yKGcgKiAyNTUpLCBiOiBNYXRoLmZsb29yKGIgKiAyNTUpIH07CiAgfTsKCiAgZXhwb3J0cy5IU1ZUb0hleCA9IGZ1bmN0aW9uIChoLCBzLCB2KSB7CiAgICB2YXIgcmdiID0gZXhwb3J0cy5IU1ZUb1JHQihoLCBzLCB2KTsKICAgIHJldHVybiBleHBvcnRzLlJHQlRvSGV4KHJnYi5yLCByZ2IuZywgcmdiLmIpOwogIH07CgogIGV4cG9ydHMuaGV4VG9IU1YgPSBmdW5jdGlvbiAoaGV4KSB7CiAgICB2YXIgcmdiID0gZXhwb3J0cy5oZXhUb1JHQihoZXgpOwogICAgcmV0dXJuIGV4cG9ydHMuUkdCVG9IU1YocmdiLnIsIHJnYi5nLCByZ2IuYik7CiAgfTsKCiAgZXhwb3J0cy5pc1ZhbGlkSGV4ID0gZnVuY3Rpb24gKGhleCkgewogICAgdmFyIGlzT2sgPSAvKF4jWzAtOUEtRl17Nn0kKXwoXiNbMC05QS1GXXszfSQpL2kudGVzdChoZXgpOwogICAgcmV0dXJuIGlzT2s7CiAgfTsKCiAgZXhwb3J0cy5pc1ZhbGlkUkdCID0gZnVuY3Rpb24gKHJnYikgewogICAgcmdiID0gcmdiLnJlcGxhY2UoJyAnLCAnJyk7CiAgICB2YXIgaXNPayA9IC9yZ2JcKChcZHsxLDN9KSwoXGR7MSwzfSksKFxkezEsM30pXCkvaS50ZXN0KHJnYik7CiAgICByZXR1cm4gaXNPazsKICB9OwogIGV4cG9ydHMuaXNWYWxpZFJHQkEgPSBmdW5jdGlvbiAocmdiYSkgewogICAgcmdiYSA9IHJnYmEucmVwbGFjZSgnICcsICcnKTsKICAgIHZhciBpc09rID0gL3JnYmFcKChcZHsxLDN9KSwoXGR7MSwzfSksKFxkezEsM30pLCguezEsM30pXCkvaS50ZXN0KHJnYmEpOwogICAgcmV0dXJuIGlzT2s7CiAgfTsKCiAgLyoqCiAgICogVGhpcyByZWN1cnNpdmVseSByZWRpcmVjdHMgdGhlIHByb3RvdHlwZSBvZiBKU09OIG9iamVjdHMgdG8gdGhlIHJlZmVyZW5jZU9iamVjdAogICAqIFRoaXMgaXMgdXNlZCBmb3IgZGVmYXVsdCBvcHRpb25zLgogICAqCiAgICogQHBhcmFtIHJlZmVyZW5jZU9iamVjdAogICAqIEByZXR1cm5zIHsqfQogICAqLwogIGV4cG9ydHMuc2VsZWN0aXZlQnJpZGdlT2JqZWN0ID0gZnVuY3Rpb24gKGZpZWxkcywgcmVmZXJlbmNlT2JqZWN0KSB7CiAgICBpZiAodHlwZW9mIHJlZmVyZW5jZU9iamVjdCA9PSAnb2JqZWN0JykgewogICAgICB2YXIgb2JqZWN0VG8gPSBPYmplY3QuY3JlYXRlKHJlZmVyZW5jZU9iamVjdCk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHJlZmVyZW5jZU9iamVjdC5oYXNPd25Qcm9wZXJ0eShmaWVsZHNbaV0pKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHJlZmVyZW5jZU9iamVjdFtmaWVsZHNbaV1dID09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIG9iamVjdFRvW2ZpZWxkc1tpXV0gPSBleHBvcnRzLmJyaWRnZU9iamVjdChyZWZlcmVuY2VPYmplY3RbZmllbGRzW2ldXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvYmplY3RUbzsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH07CgogIC8qKgogICAqIFRoaXMgcmVjdXJzaXZlbHkgcmVkaXJlY3RzIHRoZSBwcm90b3R5cGUgb2YgSlNPTiBvYmplY3RzIHRvIHRoZSByZWZlcmVuY2VPYmplY3QKICAgKiBUaGlzIGlzIHVzZWQgZm9yIGRlZmF1bHQgb3B0aW9ucy4KICAgKgogICAqIEBwYXJhbSByZWZlcmVuY2VPYmplY3QKICAgKiBAcmV0dXJucyB7Kn0KICAgKi8KICBleHBvcnRzLmJyaWRnZU9iamVjdCA9IGZ1bmN0aW9uIChyZWZlcmVuY2VPYmplY3QpIHsKICAgIGlmICh0eXBlb2YgcmVmZXJlbmNlT2JqZWN0ID09ICdvYmplY3QnKSB7CiAgICAgIHZhciBvYmplY3RUbyA9IE9iamVjdC5jcmVhdGUocmVmZXJlbmNlT2JqZWN0KTsKICAgICAgZm9yICh2YXIgaSBpbiByZWZlcmVuY2VPYmplY3QpIHsKICAgICAgICBpZiAocmVmZXJlbmNlT2JqZWN0Lmhhc093blByb3BlcnR5KGkpKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHJlZmVyZW5jZU9iamVjdFtpXSA9PSAnb2JqZWN0JykgewogICAgICAgICAgICBvYmplY3RUb1tpXSA9IGV4cG9ydHMuYnJpZGdlT2JqZWN0KHJlZmVyZW5jZU9iamVjdFtpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvYmplY3RUbzsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH07CgogIC8qKgogICAqIHRoaXMgaXMgdXNlZCB0byBzZXQgdGhlIG9wdGlvbnMgb2Ygc3Vib2JqZWN0cyBpbiB0aGUgb3B0aW9ucyBvYmplY3QuIEEgcmVxdWlyZW1lbnQgb2YgdGhlc2Ugc3Vib2JqZWN0cwogICAqIGlzIHRoYXQgdGhleSBoYXZlIGFuICdlbmFibGVkJyBlbGVtZW50IHdoaWNoIGlzIG9wdGlvbmFsIGZvciB0aGUgdXNlciBidXQgbWFuZGF0b3J5IGZvciB0aGUgcHJvZ3JhbS4KICAgKgogICAqIEBwYXJhbSBbb2JqZWN0XSBtZXJnZVRhcmdldCB8IHRoaXMgaXMgZWl0aGVyIHRoaXMub3B0aW9ucyBvciB0aGUgb3B0aW9ucyB1c2VkIGZvciB0aGUgZ3JvdXBzLgogICAqIEBwYXJhbSBbb2JqZWN0XSBvcHRpb25zICAgICB8IG9wdGlvbnMKICAgKiBAcGFyYW0gW1N0cmluZ10gb3B0aW9uICAgICAgfCB0aGlzIGlzIHRoZSBvcHRpb24ga2V5IGluIHRoZSBvcHRpb25zIGFyZ3VtZW50CiAgICogQHByaXZhdGUKICAgKi8KICBleHBvcnRzLm1lcmdlT3B0aW9ucyA9IGZ1bmN0aW9uIChtZXJnZVRhcmdldCwgb3B0aW9ucywgb3B0aW9uKSB7CiAgICB2YXIgYWxsb3dEZWxldGlvbiA9IGFyZ3VtZW50c1szXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbM107CgogICAgaWYgKG9wdGlvbnNbb3B0aW9uXSA9PT0gbnVsbCkgewogICAgICBtZXJnZVRhcmdldFtvcHRpb25dID0gdW5kZWZpbmVkOwogICAgICBkZWxldGUgbWVyZ2VUYXJnZXRbb3B0aW9uXTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChvcHRpb25zW29wdGlvbl0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9uc1tvcHRpb25dID09PSAnYm9vbGVhbicpIHsKICAgICAgICAgIG1lcmdlVGFyZ2V0W29wdGlvbl0uZW5hYmxlZCA9IG9wdGlvbnNbb3B0aW9uXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKG9wdGlvbnNbb3B0aW9uXS5lbmFibGVkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgbWVyZ2VUYXJnZXRbb3B0aW9uXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gb3B0aW9uc1tvcHRpb25dKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zW29wdGlvbl0uaGFzT3duUHJvcGVydHkocHJvcCkpIHsKICAgICAgICAgICAgICBtZXJnZVRhcmdldFtvcHRpb25dW3Byb3BdID0gb3B0aW9uc1tvcHRpb25dW3Byb3BdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogVGhpcyBmdW5jdGlvbiBkb2VzIGEgYmluYXJ5IHNlYXJjaCBmb3IgYSB2aXNpYmxlIGl0ZW0gaW4gYSBzb3J0ZWQgbGlzdC4gSWYgd2UgZmluZCBhIHZpc2libGUgaXRlbSwgdGhlIGNvZGUgdGhhdCB1c2VzCiAgICogdGhpcyBmdW5jdGlvbiB3aWxsIHRoZW4gaXRlcmF0ZSBpbiBib3RoIGRpcmVjdGlvbnMgb3ZlciB0aGlzIHNvcnRlZCBsaXN0IHRvIGZpbmQgYWxsIHZpc2libGUgaXRlbXMuCiAgICoKICAgKiBAcGFyYW0ge0l0ZW1bXX0gb3JkZXJlZEl0ZW1zICAgICAgIHwgSXRlbXMgb3JkZXJlZCBieSBzdGFydAogICAqIEBwYXJhbSB7ZnVuY3Rpb259IHNlYXJjaEZ1bmN0aW9uICAgfCAtMSBpcyBsb3dlciwgMCBpcyBmb3VuZCwgMSBpcyBoaWdoZXIKICAgKiBAcGFyYW0ge1N0cmluZ30gZmllbGQKICAgKiBAcGFyYW0ge1N0cmluZ30gZmllbGQyCiAgICogQHJldHVybnMge251bWJlcn0KICAgKiBAcHJpdmF0ZQogICAqLwogIGV4cG9ydHMuYmluYXJ5U2VhcmNoQ3VzdG9tID0gZnVuY3Rpb24gKG9yZGVyZWRJdGVtcywgc2VhcmNoRnVuY3Rpb24sIGZpZWxkLCBmaWVsZDIpIHsKICAgIHZhciBtYXhJdGVyYXRpb25zID0gMTAwMDA7CiAgICB2YXIgaXRlcmF0aW9uID0gMDsKICAgIHZhciBsb3cgPSAwOwogICAgdmFyIGhpZ2ggPSBvcmRlcmVkSXRlbXMubGVuZ3RoIC0gMTsKCiAgICB3aGlsZSAobG93IDw9IGhpZ2ggJiYgaXRlcmF0aW9uIDwgbWF4SXRlcmF0aW9ucykgewogICAgICB2YXIgbWlkZGxlID0gTWF0aC5mbG9vcigobG93ICsgaGlnaCkgLyAyKTsKCiAgICAgIHZhciBpdGVtID0gb3JkZXJlZEl0ZW1zW21pZGRsZV07CiAgICAgIHZhciB2YWx1ZSA9IGZpZWxkMiA9PT0gdW5kZWZpbmVkID8gaXRlbVtmaWVsZF0gOiBpdGVtW2ZpZWxkXVtmaWVsZDJdOwoKICAgICAgdmFyIHNlYXJjaFJlc3VsdCA9IHNlYXJjaEZ1bmN0aW9uKHZhbHVlKTsKICAgICAgaWYgKHNlYXJjaFJlc3VsdCA9PSAwKSB7CiAgICAgICAgLy8gamloYWEsIGZvdW5kIGEgdmlzaWJsZSBpdGVtIQogICAgICAgIHJldHVybiBtaWRkbGU7CiAgICAgIH0gZWxzZSBpZiAoc2VhcmNoUmVzdWx0ID09IC0xKSB7CiAgICAgICAgLy8gaXQgaXMgdG9vIHNtYWxsIC0tPiBpbmNyZWFzZSBsb3cKICAgICAgICBsb3cgPSBtaWRkbGUgKyAxOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGl0IGlzIHRvbyBiaWcgLS0+IGRlY3JlYXNlIGhpZ2gKICAgICAgICBoaWdoID0gbWlkZGxlIC0gMTsKICAgICAgfQoKICAgICAgaXRlcmF0aW9uKys7CiAgICB9CgogICAgcmV0dXJuIC0xOwogIH07CgogIC8qKgogICAqIFRoaXMgZnVuY3Rpb24gZG9lcyBhIGJpbmFyeSBzZWFyY2ggZm9yIGEgc3BlY2lmaWMgdmFsdWUgaW4gYSBzb3J0ZWQgYXJyYXkuIElmIGl0IGRvZXMgbm90IGV4aXN0IGJ1dCBpcyBpbiBiZXR3ZWVuIG9mCiAgICogdHdvIHZhbHVlcywgd2UgcmV0dXJuIGVpdGhlciB0aGUgb25lIGJlZm9yZSBvciB0aGUgb25lIGFmdGVyLCBkZXBlbmRpbmcgb24gdXNlciBpbnB1dAogICAqIElmIGl0IGlzIGZvdW5kLCB3ZSByZXR1cm4gdGhlIGluZGV4LCBlbHNlIC0xLgogICAqCiAgICogQHBhcmFtIHtBcnJheX0gb3JkZXJlZEl0ZW1zCiAgICogQHBhcmFtIHt7c3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXJ9fSB0YXJnZXQKICAgKiBAcGFyYW0ge1N0cmluZ30gZmllbGQKICAgKiBAcGFyYW0ge1N0cmluZ30gc2lkZVByZWZlcmVuY2UgICAnYmVmb3JlJyBvciAnYWZ0ZXInCiAgICogQHJldHVybnMge251bWJlcn0KICAgKiBAcHJpdmF0ZQogICAqLwogIGV4cG9ydHMuYmluYXJ5U2VhcmNoVmFsdWUgPSBmdW5jdGlvbiAob3JkZXJlZEl0ZW1zLCB0YXJnZXQsIGZpZWxkLCBzaWRlUHJlZmVyZW5jZSkgewogICAgdmFyIG1heEl0ZXJhdGlvbnMgPSAxMDAwMDsKICAgIHZhciBpdGVyYXRpb24gPSAwOwogICAgdmFyIGxvdyA9IDA7CiAgICB2YXIgaGlnaCA9IG9yZGVyZWRJdGVtcy5sZW5ndGggLSAxOwogICAgdmFyIHByZXZWYWx1ZSwgdmFsdWUsIG5leHRWYWx1ZSwgbWlkZGxlOwoKICAgIHdoaWxlIChsb3cgPD0gaGlnaCAmJiBpdGVyYXRpb24gPCBtYXhJdGVyYXRpb25zKSB7CiAgICAgIC8vIGdldCBhIG5ldyBndWVzcwogICAgICBtaWRkbGUgPSBNYXRoLmZsb29yKDAuNSAqIChoaWdoICsgbG93KSk7CiAgICAgIHByZXZWYWx1ZSA9IG9yZGVyZWRJdGVtc1tNYXRoLm1heCgwLCBtaWRkbGUgLSAxKV1bZmllbGRdOwogICAgICB2YWx1ZSA9IG9yZGVyZWRJdGVtc1ttaWRkbGVdW2ZpZWxkXTsKICAgICAgbmV4dFZhbHVlID0gb3JkZXJlZEl0ZW1zW01hdGgubWluKG9yZGVyZWRJdGVtcy5sZW5ndGggLSAxLCBtaWRkbGUgKyAxKV1bZmllbGRdOwoKICAgICAgaWYgKHZhbHVlID09IHRhcmdldCkgewogICAgICAgIC8vIHdlIGZvdW5kIHRoZSB0YXJnZXQKICAgICAgICByZXR1cm4gbWlkZGxlOwogICAgICB9IGVsc2UgaWYgKHByZXZWYWx1ZSA8IHRhcmdldCAmJiB2YWx1ZSA+IHRhcmdldCkgewogICAgICAgIC8vIHRhcmdldCBpcyBpbiBiZXR3ZWVuIG9mIHRoZSBwcmV2aW91cyBhbmQgdGhlIGN1cnJlbnQKICAgICAgICByZXR1cm4gc2lkZVByZWZlcmVuY2UgPT0gJ2JlZm9yZScgPyBNYXRoLm1heCgwLCBtaWRkbGUgLSAxKSA6IG1pZGRsZTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA8IHRhcmdldCAmJiBuZXh0VmFsdWUgPiB0YXJnZXQpIHsKICAgICAgICAvLyB0YXJnZXQgaXMgaW4gYmV0d2VlbiBvZiB0aGUgY3VycmVudCBhbmQgdGhlIG5leHQKICAgICAgICByZXR1cm4gc2lkZVByZWZlcmVuY2UgPT0gJ2JlZm9yZScgPyBtaWRkbGUgOiBNYXRoLm1pbihvcmRlcmVkSXRlbXMubGVuZ3RoIC0gMSwgbWlkZGxlICsgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZGlkbnQgZmluZCB0aGUgdGFyZ2V0LCB3ZSBuZWVkIHRvIGNoYW5nZSBvdXIgYm91bmRhcmllcy4KICAgICAgICBpZiAodmFsdWUgPCB0YXJnZXQpIHsKICAgICAgICAgIC8vIGl0IGlzIHRvbyBzbWFsbCAtLT4gaW5jcmVhc2UgbG93CiAgICAgICAgICBsb3cgPSBtaWRkbGUgKyAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBpdCBpcyB0b28gYmlnIC0tPiBkZWNyZWFzZSBoaWdoCiAgICAgICAgICBoaWdoID0gbWlkZGxlIC0gMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaXRlcmF0aW9uKys7CiAgICB9CgogICAgLy8gZGlkbnQgZmluZCBhbnl0aGluZy4gUmV0dXJuIC0xLgogICAgcmV0dXJuIC0xOwogIH07CgogIC8qCiAgICogRWFzaW5nIEZ1bmN0aW9ucyAtIGluc3BpcmVkIGZyb20gaHR0cDovL2dpem1hLmNvbS9lYXNpbmcvCiAgICogb25seSBjb25zaWRlcmluZyB0aGUgdCB2YWx1ZSBmb3IgdGhlIHJhbmdlIFswLCAxXSA9PiBbMCwgMV0KICAgKiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9ncmUvMTY1MDI5NAogICAqLwogIGV4cG9ydHMuZWFzaW5nRnVuY3Rpb25zID0gewogICAgLy8gbm8gZWFzaW5nLCBubyBhY2NlbGVyYXRpb24KICAgIGxpbmVhcjogZnVuY3Rpb24gbGluZWFyKHQpIHsKICAgICAgcmV0dXJuIHQ7CiAgICB9LAogICAgLy8gYWNjZWxlcmF0aW5nIGZyb20gemVybyB2ZWxvY2l0eQogICAgZWFzZUluUXVhZDogZnVuY3Rpb24gZWFzZUluUXVhZCh0KSB7CiAgICAgIHJldHVybiB0ICogdDsKICAgIH0sCiAgICAvLyBkZWNlbGVyYXRpbmcgdG8gemVybyB2ZWxvY2l0eQogICAgZWFzZU91dFF1YWQ6IGZ1bmN0aW9uIGVhc2VPdXRRdWFkKHQpIHsKICAgICAgcmV0dXJuIHQgKiAoMiAtIHQpOwogICAgfSwKICAgIC8vIGFjY2VsZXJhdGlvbiB1bnRpbCBoYWxmd2F5LCB0aGVuIGRlY2VsZXJhdGlvbgogICAgZWFzZUluT3V0UXVhZDogZnVuY3Rpb24gZWFzZUluT3V0UXVhZCh0KSB7CiAgICAgIHJldHVybiB0IDwgMC41ID8gMiAqIHQgKiB0IDogLTEgKyAoNCAtIDIgKiB0KSAqIHQ7CiAgICB9LAogICAgLy8gYWNjZWxlcmF0aW5nIGZyb20gemVybyB2ZWxvY2l0eQogICAgZWFzZUluQ3ViaWM6IGZ1bmN0aW9uIGVhc2VJbkN1YmljKHQpIHsKICAgICAgcmV0dXJuIHQgKiB0ICogdDsKICAgIH0sCiAgICAvLyBkZWNlbGVyYXRpbmcgdG8gemVybyB2ZWxvY2l0eQogICAgZWFzZU91dEN1YmljOiBmdW5jdGlvbiBlYXNlT3V0Q3ViaWModCkgewogICAgICByZXR1cm4gLS10ICogdCAqIHQgKyAxOwogICAgfSwKICAgIC8vIGFjY2VsZXJhdGlvbiB1bnRpbCBoYWxmd2F5LCB0aGVuIGRlY2VsZXJhdGlvbgogICAgZWFzZUluT3V0Q3ViaWM6IGZ1bmN0aW9uIGVhc2VJbk91dEN1YmljKHQpIHsKICAgICAgcmV0dXJuIHQgPCAwLjUgPyA0ICogdCAqIHQgKiB0IDogKHQgLSAxKSAqICgyICogdCAtIDIpICogKDIgKiB0IC0gMikgKyAxOwogICAgfSwKICAgIC8vIGFjY2VsZXJhdGluZyBmcm9tIHplcm8gdmVsb2NpdHkKICAgIGVhc2VJblF1YXJ0OiBmdW5jdGlvbiBlYXNlSW5RdWFydCh0KSB7CiAgICAgIHJldHVybiB0ICogdCAqIHQgKiB0OwogICAgfSwKICAgIC8vIGRlY2VsZXJhdGluZyB0byB6ZXJvIHZlbG9jaXR5CiAgICBlYXNlT3V0UXVhcnQ6IGZ1bmN0aW9uIGVhc2VPdXRRdWFydCh0KSB7CiAgICAgIHJldHVybiAxIC0gLS10ICogdCAqIHQgKiB0OwogICAgfSwKICAgIC8vIGFjY2VsZXJhdGlvbiB1bnRpbCBoYWxmd2F5LCB0aGVuIGRlY2VsZXJhdGlvbgogICAgZWFzZUluT3V0UXVhcnQ6IGZ1bmN0aW9uIGVhc2VJbk91dFF1YXJ0KHQpIHsKICAgICAgcmV0dXJuIHQgPCAwLjUgPyA4ICogdCAqIHQgKiB0ICogdCA6IDEgLSA4ICogLS10ICogdCAqIHQgKiB0OwogICAgfSwKICAgIC8vIGFjY2VsZXJhdGluZyBmcm9tIHplcm8gdmVsb2NpdHkKICAgIGVhc2VJblF1aW50OiBmdW5jdGlvbiBlYXNlSW5RdWludCh0KSB7CiAgICAgIHJldHVybiB0ICogdCAqIHQgKiB0ICogdDsKICAgIH0sCiAgICAvLyBkZWNlbGVyYXRpbmcgdG8gemVybyB2ZWxvY2l0eQogICAgZWFzZU91dFF1aW50OiBmdW5jdGlvbiBlYXNlT3V0UXVpbnQodCkgewogICAgICByZXR1cm4gMSArIC0tdCAqIHQgKiB0ICogdCAqIHQ7CiAgICB9LAogICAgLy8gYWNjZWxlcmF0aW9uIHVudGlsIGhhbGZ3YXksIHRoZW4gZGVjZWxlcmF0aW9uCiAgICBlYXNlSW5PdXRRdWludDogZnVuY3Rpb24gZWFzZUluT3V0UXVpbnQodCkgewogICAgICByZXR1cm4gdCA8IDAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAtLXQgKiB0ICogdCAqIHQgKiB0OwogICAgfQogIH07CgovKioqLyB9LAovKiAyICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAvLyBmaXJzdCBjaGVjayBpZiBtb21lbnQuanMgaXMgYWxyZWFkeSBsb2FkZWQgaW4gdGhlIGJyb3dzZXIgd2luZG93LCBpZiBzbywKICAvLyB1c2UgdGhpcyBpbnN0YW5jZS4gRWxzZSwgbG9hZCB2aWEgY29tbW9uanMuCiAgJ3VzZSBzdHJpY3QnOwoKICBtb2R1bGUuZXhwb3J0cyA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvd1snbW9tZW50J10gfHwgX193ZWJwYWNrX3JlcXVpcmVfXygzKTsKCi8qKiovIH0sCi8qIDMgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogIC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihtb2R1bGUpIHsvLyEgbW9tZW50LmpzCiAgLy8hIHZlcnNpb24gOiAyLjEwLjMKICAvLyEgYXV0aG9ycyA6IFRpbSBXb29kLCBJc2tyZW4gQ2hlcm5ldiwgTW9tZW50LmpzIGNvbnRyaWJ1dG9ycwogIC8vISBsaWNlbnNlIDogTUlUCiAgLy8hIG1vbWVudGpzLmNvbQoKICAoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewogICAgICB0cnVlID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOgogICAgICB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZmFjdG9yeSkgOgogICAgICBnbG9iYWwubW9tZW50ID0gZmFjdG9yeSgpCiAgfSh0aGlzLCBmdW5jdGlvbiAoKSB7ICd1c2Ugc3RyaWN0JzsKCiAgICAgIHZhciBob29rQ2FsbGJhY2s7CgogICAgICBmdW5jdGlvbiB1dGlsc19ob29rc19faG9va3MgKCkgewogICAgICAgICAgcmV0dXJuIGhvb2tDYWxsYmFjay5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICAvLyBUaGlzIGlzIGRvbmUgdG8gcmVnaXN0ZXIgdGhlIG1ldGhvZCBjYWxsZWQgd2l0aCBtb21lbnQoKQogICAgICAvLyB3aXRob3V0IGNyZWF0aW5nIGNpcmN1bGFyIGRlcGVuZGVuY2llcy4KICAgICAgZnVuY3Rpb24gc2V0SG9va0NhbGxiYWNrIChjYWxsYmFjaykgewogICAgICAgICAgaG9va0NhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGlzQXJyYXkoaW5wdXQpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaW5wdXQpID09PSAnW29iamVjdCBBcnJheV0nOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc0RhdGUoaW5wdXQpIHsKICAgICAgICAgIHJldHVybiBpbnB1dCBpbnN0YW5jZW9mIERhdGUgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGlucHV0KSA9PT0gJ1tvYmplY3QgRGF0ZV0nOwogICAgICB9CgogICAgICBmdW5jdGlvbiBtYXAoYXJyLCBmbikgewogICAgICAgICAgdmFyIHJlcyA9IFtdLCBpOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgIHJlcy5wdXNoKGZuKGFycltpXSwgaSkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaGFzT3duUHJvcChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGEsIGIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBleHRlbmQoYSwgYikgewogICAgICAgICAgZm9yICh2YXIgaSBpbiBiKSB7CiAgICAgICAgICAgICAgaWYgKGhhc093blByb3AoYiwgaSkpIHsKICAgICAgICAgICAgICAgICAgYVtpXSA9IGJbaV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChoYXNPd25Qcm9wKGIsICd0b1N0cmluZycpKSB7CiAgICAgICAgICAgICAgYS50b1N0cmluZyA9IGIudG9TdHJpbmc7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhhc093blByb3AoYiwgJ3ZhbHVlT2YnKSkgewogICAgICAgICAgICAgIGEudmFsdWVPZiA9IGIudmFsdWVPZjsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gYTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY3JlYXRlX3V0Y19fY3JlYXRlVVRDIChpbnB1dCwgZm9ybWF0LCBsb2NhbGUsIHN0cmljdCkgewogICAgICAgICAgcmV0dXJuIGNyZWF0ZUxvY2FsT3JVVEMoaW5wdXQsIGZvcm1hdCwgbG9jYWxlLCBzdHJpY3QsIHRydWUpLnV0YygpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkZWZhdWx0UGFyc2luZ0ZsYWdzKCkgewogICAgICAgICAgLy8gV2UgbmVlZCB0byBkZWVwIGNsb25lIHRoaXMgb2JqZWN0LgogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBlbXB0eSAgICAgICAgICAgOiBmYWxzZSwKICAgICAgICAgICAgICB1bnVzZWRUb2tlbnMgICAgOiBbXSwKICAgICAgICAgICAgICB1bnVzZWRJbnB1dCAgICAgOiBbXSwKICAgICAgICAgICAgICBvdmVyZmxvdyAgICAgICAgOiAtMiwKICAgICAgICAgICAgICBjaGFyc0xlZnRPdmVyICAgOiAwLAogICAgICAgICAgICAgIG51bGxJbnB1dCAgICAgICA6IGZhbHNlLAogICAgICAgICAgICAgIGludmFsaWRNb250aCAgICA6IG51bGwsCiAgICAgICAgICAgICAgaW52YWxpZEZvcm1hdCAgIDogZmFsc2UsCiAgICAgICAgICAgICAgdXNlckludmFsaWRhdGVkIDogZmFsc2UsCiAgICAgICAgICAgICAgaXNvICAgICAgICAgICAgIDogZmFsc2UKICAgICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldFBhcnNpbmdGbGFncyhtKSB7CiAgICAgICAgICBpZiAobS5fcGYgPT0gbnVsbCkgewogICAgICAgICAgICAgIG0uX3BmID0gZGVmYXVsdFBhcnNpbmdGbGFncygpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG0uX3BmOwogICAgICB9CgogICAgICBmdW5jdGlvbiB2YWxpZF9faXNWYWxpZChtKSB7CiAgICAgICAgICBpZiAobS5faXNWYWxpZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgdmFyIGZsYWdzID0gZ2V0UGFyc2luZ0ZsYWdzKG0pOwogICAgICAgICAgICAgIG0uX2lzVmFsaWQgPSAhaXNOYU4obS5fZC5nZXRUaW1lKCkpICYmCiAgICAgICAgICAgICAgICAgIGZsYWdzLm92ZXJmbG93IDwgMCAmJgogICAgICAgICAgICAgICAgICAhZmxhZ3MuZW1wdHkgJiYKICAgICAgICAgICAgICAgICAgIWZsYWdzLmludmFsaWRNb250aCAmJgogICAgICAgICAgICAgICAgICAhZmxhZ3MubnVsbElucHV0ICYmCiAgICAgICAgICAgICAgICAgICFmbGFncy5pbnZhbGlkRm9ybWF0ICYmCiAgICAgICAgICAgICAgICAgICFmbGFncy51c2VySW52YWxpZGF0ZWQ7CgogICAgICAgICAgICAgIGlmIChtLl9zdHJpY3QpIHsKICAgICAgICAgICAgICAgICAgbS5faXNWYWxpZCA9IG0uX2lzVmFsaWQgJiYKICAgICAgICAgICAgICAgICAgICAgIGZsYWdzLmNoYXJzTGVmdE92ZXIgPT09IDAgJiYKICAgICAgICAgICAgICAgICAgICAgIGZsYWdzLnVudXNlZFRva2Vucy5sZW5ndGggPT09IDAgJiYKICAgICAgICAgICAgICAgICAgICAgIGZsYWdzLmJpZ0hvdXIgPT09IHVuZGVmaW5lZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbS5faXNWYWxpZDsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gdmFsaWRfX2NyZWF0ZUludmFsaWQgKGZsYWdzKSB7CiAgICAgICAgICB2YXIgbSA9IGNyZWF0ZV91dGNfX2NyZWF0ZVVUQyhOYU4pOwogICAgICAgICAgaWYgKGZsYWdzICE9IG51bGwpIHsKICAgICAgICAgICAgICBleHRlbmQoZ2V0UGFyc2luZ0ZsYWdzKG0pLCBmbGFncyk7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MobSkudXNlckludmFsaWRhdGVkID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbTsKICAgICAgfQoKICAgICAgdmFyIG1vbWVudFByb3BlcnRpZXMgPSB1dGlsc19ob29rc19faG9va3MubW9tZW50UHJvcGVydGllcyA9IFtdOwoKICAgICAgZnVuY3Rpb24gY29weUNvbmZpZyh0bywgZnJvbSkgewogICAgICAgICAgdmFyIGksIHByb3AsIHZhbDsKCiAgICAgICAgICBpZiAodHlwZW9mIGZyb20uX2lzQU1vbWVudE9iamVjdCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICB0by5faXNBTW9tZW50T2JqZWN0ID0gZnJvbS5faXNBTW9tZW50T2JqZWN0OwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBmcm9tLl9pICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgIHRvLl9pID0gZnJvbS5faTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgZnJvbS5fZiAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICB0by5fZiA9IGZyb20uX2Y7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodHlwZW9mIGZyb20uX2wgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgdG8uX2wgPSBmcm9tLl9sOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBmcm9tLl9zdHJpY3QgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgdG8uX3N0cmljdCA9IGZyb20uX3N0cmljdDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgZnJvbS5fdHptICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgIHRvLl90em0gPSBmcm9tLl90em07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodHlwZW9mIGZyb20uX2lzVVRDICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgIHRvLl9pc1VUQyA9IGZyb20uX2lzVVRDOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBmcm9tLl9vZmZzZXQgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgdG8uX29mZnNldCA9IGZyb20uX29mZnNldDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgZnJvbS5fcGYgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgdG8uX3BmID0gZ2V0UGFyc2luZ0ZsYWdzKGZyb20pOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBmcm9tLl9sb2NhbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgdG8uX2xvY2FsZSA9IGZyb20uX2xvY2FsZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobW9tZW50UHJvcGVydGllcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgZm9yIChpIGluIG1vbWVudFByb3BlcnRpZXMpIHsKICAgICAgICAgICAgICAgICAgcHJvcCA9IG1vbWVudFByb3BlcnRpZXNbaV07CiAgICAgICAgICAgICAgICAgIHZhbCA9IGZyb21bcHJvcF07CiAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgICAgdG9bcHJvcF0gPSB2YWw7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRvOwogICAgICB9CgogICAgICB2YXIgdXBkYXRlSW5Qcm9ncmVzcyA9IGZhbHNlOwoKICAgICAgLy8gTW9tZW50IHByb3RvdHlwZSBvYmplY3QKICAgICAgZnVuY3Rpb24gTW9tZW50KGNvbmZpZykgewogICAgICAgICAgY29weUNvbmZpZyh0aGlzLCBjb25maWcpOwogICAgICAgICAgdGhpcy5fZCA9IG5ldyBEYXRlKCtjb25maWcuX2QpOwogICAgICAgICAgLy8gUHJldmVudCBpbmZpbml0ZSBsb29wIGluIGNhc2UgdXBkYXRlT2Zmc2V0IGNyZWF0ZXMgbmV3IG1vbWVudAogICAgICAgICAgLy8gb2JqZWN0cy4KICAgICAgICAgIGlmICh1cGRhdGVJblByb2dyZXNzID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHVwZGF0ZUluUHJvZ3Jlc3MgPSB0cnVlOwogICAgICAgICAgICAgIHV0aWxzX2hvb2tzX19ob29rcy51cGRhdGVPZmZzZXQodGhpcyk7CiAgICAgICAgICAgICAgdXBkYXRlSW5Qcm9ncmVzcyA9IGZhbHNlOwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBpc01vbWVudCAob2JqKSB7CiAgICAgICAgICByZXR1cm4gb2JqIGluc3RhbmNlb2YgTW9tZW50IHx8IChvYmogIT0gbnVsbCAmJiBvYmouX2lzQU1vbWVudE9iamVjdCAhPSBudWxsKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gdG9JbnQoYXJndW1lbnRGb3JDb2VyY2lvbikgewogICAgICAgICAgdmFyIGNvZXJjZWROdW1iZXIgPSArYXJndW1lbnRGb3JDb2VyY2lvbiwKICAgICAgICAgICAgICB2YWx1ZSA9IDA7CgogICAgICAgICAgaWYgKGNvZXJjZWROdW1iZXIgIT09IDAgJiYgaXNGaW5pdGUoY29lcmNlZE51bWJlcikpIHsKICAgICAgICAgICAgICBpZiAoY29lcmNlZE51bWJlciA+PSAwKSB7CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gTWF0aC5mbG9vcihjb2VyY2VkTnVtYmVyKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB2YWx1ZSA9IE1hdGguY2VpbChjb2VyY2VkTnVtYmVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjb21wYXJlQXJyYXlzKGFycmF5MSwgYXJyYXkyLCBkb250Q29udmVydCkgewogICAgICAgICAgdmFyIGxlbiA9IE1hdGgubWluKGFycmF5MS5sZW5ndGgsIGFycmF5Mi5sZW5ndGgpLAogICAgICAgICAgICAgIGxlbmd0aERpZmYgPSBNYXRoLmFicyhhcnJheTEubGVuZ3RoIC0gYXJyYXkyLmxlbmd0aCksCiAgICAgICAgICAgICAgZGlmZnMgPSAwLAogICAgICAgICAgICAgIGk7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICBpZiAoKGRvbnRDb252ZXJ0ICYmIGFycmF5MVtpXSAhPT0gYXJyYXkyW2ldKSB8fAogICAgICAgICAgICAgICAgICAoIWRvbnRDb252ZXJ0ICYmIHRvSW50KGFycmF5MVtpXSkgIT09IHRvSW50KGFycmF5MltpXSkpKSB7CiAgICAgICAgICAgICAgICAgIGRpZmZzKys7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGRpZmZzICsgbGVuZ3RoRGlmZjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gTG9jYWxlKCkgewogICAgICB9CgogICAgICB2YXIgbG9jYWxlcyA9IHt9OwogICAgICB2YXIgZ2xvYmFsTG9jYWxlOwoKICAgICAgZnVuY3Rpb24gbm9ybWFsaXplTG9jYWxlKGtleSkgewogICAgICAgICAgcmV0dXJuIGtleSA/IGtleS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJ18nLCAnLScpIDoga2V5OwogICAgICB9CgogICAgICAvLyBwaWNrIHRoZSBsb2NhbGUgZnJvbSB0aGUgYXJyYXkKICAgICAgLy8gdHJ5IFsnZW4tYXUnLCAnZW4tZ2InXSBhcyAnZW4tYXUnLCAnZW4tZ2InLCAnZW4nLCBhcyBpbiBtb3ZlIHRocm91Z2ggdGhlIGxpc3QgdHJ5aW5nIGVhY2gKICAgICAgLy8gc3Vic3RyaW5nIGZyb20gbW9zdCBzcGVjaWZpYyB0byBsZWFzdCwgYnV0IG1vdmUgdG8gdGhlIG5leHQgYXJyYXkgaXRlbSBpZiBpdCdzIGEgbW9yZSBzcGVjaWZpYyB2YXJpYW50IHRoYW4gdGhlIGN1cnJlbnQgcm9vdAogICAgICBmdW5jdGlvbiBjaG9vc2VMb2NhbGUobmFtZXMpIHsKICAgICAgICAgIHZhciBpID0gMCwgaiwgbmV4dCwgbG9jYWxlLCBzcGxpdDsKCiAgICAgICAgICB3aGlsZSAoaSA8IG5hbWVzLmxlbmd0aCkgewogICAgICAgICAgICAgIHNwbGl0ID0gbm9ybWFsaXplTG9jYWxlKG5hbWVzW2ldKS5zcGxpdCgnLScpOwogICAgICAgICAgICAgIGogPSBzcGxpdC5sZW5ndGg7CiAgICAgICAgICAgICAgbmV4dCA9IG5vcm1hbGl6ZUxvY2FsZShuYW1lc1tpICsgMV0pOwogICAgICAgICAgICAgIG5leHQgPSBuZXh0ID8gbmV4dC5zcGxpdCgnLScpIDogbnVsbDsKICAgICAgICAgICAgICB3aGlsZSAoaiA+IDApIHsKICAgICAgICAgICAgICAgICAgbG9jYWxlID0gbG9hZExvY2FsZShzcGxpdC5zbGljZSgwLCBqKS5qb2luKCctJykpOwogICAgICAgICAgICAgICAgICBpZiAobG9jYWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9jYWxlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChuZXh0ICYmIG5leHQubGVuZ3RoID49IGogJiYgY29tcGFyZUFycmF5cyhzcGxpdCwgbmV4dCwgdHJ1ZSkgPj0gaiAtIDEpIHsKICAgICAgICAgICAgICAgICAgICAgIC8vdGhlIG5leHQgYXJyYXkgaXRlbSBpcyBiZXR0ZXIgdGhhbiBhIHNoYWxsb3dlciBzdWJzdHJpbmcgb2YgdGhpcyBvbmUKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGotLTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGxvYWRMb2NhbGUobmFtZSkgewogICAgICAgICAgdmFyIG9sZExvY2FsZSA9IG51bGw7CiAgICAgICAgICAvLyBUT0RPOiBGaW5kIGEgYmV0dGVyIHdheSB0byByZWdpc3RlciBhbmQgbG9hZCBhbGwgdGhlIGxvY2FsZXMgaW4gTm9kZQogICAgICAgICAgaWYgKCFsb2NhbGVzW25hbWVdICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmCiAgICAgICAgICAgICAgICAgIG1vZHVsZSAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIG9sZExvY2FsZSA9IGdsb2JhbExvY2FsZS5fYWJicjsKICAgICAgICAgICAgICAgICAgIShmdW5jdGlvbiB3ZWJwYWNrTWlzc2luZ01vZHVsZSgpIHsgdmFyIGUgPSBuZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSBcIi4vbG9jYWxlXCIiKTsgZS5jb2RlID0gJ01PRFVMRV9OT1RfRk9VTkQnOyB0aHJvdyBlOyB9KCkpOwogICAgICAgICAgICAgICAgICAvLyBiZWNhdXNlIGRlZmluZUxvY2FsZSBjdXJyZW50bHkgYWxzbyBzZXRzIHRoZSBnbG9iYWwgbG9jYWxlLCB3ZQogICAgICAgICAgICAgICAgICAvLyB3YW50IHRvIHVuZG8gdGhhdCBmb3IgbGF6eSBsb2FkZWQgbG9jYWxlcwogICAgICAgICAgICAgICAgICBsb2NhbGVfbG9jYWxlc19fZ2V0U2V0R2xvYmFsTG9jYWxlKG9sZExvY2FsZSk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgeyB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbG9jYWxlc1tuYW1lXTsKICAgICAgfQoKICAgICAgLy8gVGhpcyBmdW5jdGlvbiB3aWxsIGxvYWQgbG9jYWxlIGFuZCB0aGVuIHNldCB0aGUgZ2xvYmFsIGxvY2FsZS4gIElmCiAgICAgIC8vIG5vIGFyZ3VtZW50cyBhcmUgcGFzc2VkIGluLCBpdCB3aWxsIHNpbXBseSByZXR1cm4gdGhlIGN1cnJlbnQgZ2xvYmFsCiAgICAgIC8vIGxvY2FsZSBrZXkuCiAgICAgIGZ1bmN0aW9uIGxvY2FsZV9sb2NhbGVzX19nZXRTZXRHbG9iYWxMb2NhbGUgKGtleSwgdmFsdWVzKSB7CiAgICAgICAgICB2YXIgZGF0YTsKICAgICAgICAgIGlmIChrZXkpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlcyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgZGF0YSA9IGxvY2FsZV9sb2NhbGVzX19nZXRMb2NhbGUoa2V5KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGRhdGEgPSBkZWZpbmVMb2NhbGUoa2V5LCB2YWx1ZXMpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgLy8gbW9tZW50LmR1cmF0aW9uLl9sb2NhbGUgPSBtb21lbnQuX2xvY2FsZSA9IGRhdGE7CiAgICAgICAgICAgICAgICAgIGdsb2JhbExvY2FsZSA9IGRhdGE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBnbG9iYWxMb2NhbGUuX2FiYnI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGRlZmluZUxvY2FsZSAobmFtZSwgdmFsdWVzKSB7CiAgICAgICAgICBpZiAodmFsdWVzICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgdmFsdWVzLmFiYnIgPSBuYW1lOwogICAgICAgICAgICAgIGlmICghbG9jYWxlc1tuYW1lXSkgewogICAgICAgICAgICAgICAgICBsb2NhbGVzW25hbWVdID0gbmV3IExvY2FsZSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBsb2NhbGVzW25hbWVdLnNldCh2YWx1ZXMpOwoKICAgICAgICAgICAgICAvLyBiYWNrd2FyZHMgY29tcGF0IGZvciBub3c6IGFsc28gc2V0IHRoZSBsb2NhbGUKICAgICAgICAgICAgICBsb2NhbGVfbG9jYWxlc19fZ2V0U2V0R2xvYmFsTG9jYWxlKG5hbWUpOwoKICAgICAgICAgICAgICByZXR1cm4gbG9jYWxlc1tuYW1lXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gdXNlZnVsIGZvciB0ZXN0aW5nCiAgICAgICAgICAgICAgZGVsZXRlIGxvY2FsZXNbbmFtZV07CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIHJldHVybnMgbG9jYWxlIGRhdGEKICAgICAgZnVuY3Rpb24gbG9jYWxlX2xvY2FsZXNfX2dldExvY2FsZSAoa2V5KSB7CiAgICAgICAgICB2YXIgbG9jYWxlOwoKICAgICAgICAgIGlmIChrZXkgJiYga2V5Ll9sb2NhbGUgJiYga2V5Ll9sb2NhbGUuX2FiYnIpIHsKICAgICAgICAgICAgICBrZXkgPSBrZXkuX2xvY2FsZS5fYWJicjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWtleSkgewogICAgICAgICAgICAgIHJldHVybiBnbG9iYWxMb2NhbGU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFpc0FycmF5KGtleSkpIHsKICAgICAgICAgICAgICAvL3Nob3J0LWNpcmN1aXQgZXZlcnl0aGluZyBlbHNlCiAgICAgICAgICAgICAgbG9jYWxlID0gbG9hZExvY2FsZShrZXkpOwogICAgICAgICAgICAgIGlmIChsb2NhbGUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvY2FsZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAga2V5ID0gW2tleV07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGNob29zZUxvY2FsZShrZXkpOwogICAgICB9CgogICAgICB2YXIgYWxpYXNlcyA9IHt9OwoKICAgICAgZnVuY3Rpb24gYWRkVW5pdEFsaWFzICh1bml0LCBzaG9ydGhhbmQpIHsKICAgICAgICAgIHZhciBsb3dlckNhc2UgPSB1bml0LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICBhbGlhc2VzW2xvd2VyQ2FzZV0gPSBhbGlhc2VzW2xvd2VyQ2FzZSArICdzJ10gPSBhbGlhc2VzW3Nob3J0aGFuZF0gPSB1bml0OwogICAgICB9CgogICAgICBmdW5jdGlvbiBub3JtYWxpemVVbml0cyh1bml0cykgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiB1bml0cyA9PT0gJ3N0cmluZycgPyBhbGlhc2VzW3VuaXRzXSB8fCBhbGlhc2VzW3VuaXRzLnRvTG93ZXJDYXNlKCldIDogdW5kZWZpbmVkOwogICAgICB9CgogICAgICBmdW5jdGlvbiBub3JtYWxpemVPYmplY3RVbml0cyhpbnB1dE9iamVjdCkgewogICAgICAgICAgdmFyIG5vcm1hbGl6ZWRJbnB1dCA9IHt9LAogICAgICAgICAgICAgIG5vcm1hbGl6ZWRQcm9wLAogICAgICAgICAgICAgIHByb3A7CgogICAgICAgICAgZm9yIChwcm9wIGluIGlucHV0T2JqZWN0KSB7CiAgICAgICAgICAgICAgaWYgKGhhc093blByb3AoaW5wdXRPYmplY3QsIHByb3ApKSB7CiAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRQcm9wID0gbm9ybWFsaXplVW5pdHMocHJvcCk7CiAgICAgICAgICAgICAgICAgIGlmIChub3JtYWxpemVkUHJvcCkgewogICAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZElucHV0W25vcm1hbGl6ZWRQcm9wXSA9IGlucHV0T2JqZWN0W3Byb3BdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBub3JtYWxpemVkSW5wdXQ7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG1ha2VHZXRTZXQgKHVuaXQsIGtlZXBUaW1lKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgZ2V0X3NldF9fc2V0KHRoaXMsIHVuaXQsIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLnVwZGF0ZU9mZnNldCh0aGlzLCBrZWVwVGltZSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRfc2V0X19nZXQodGhpcywgdW5pdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0X3NldF9fZ2V0IChtb20sIHVuaXQpIHsKICAgICAgICAgIHJldHVybiBtb20uX2RbJ2dldCcgKyAobW9tLl9pc1VUQyA/ICdVVEMnIDogJycpICsgdW5pdF0oKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0X3NldF9fc2V0IChtb20sIHVuaXQsIHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gbW9tLl9kWydzZXQnICsgKG1vbS5faXNVVEMgPyAnVVRDJyA6ICcnKSArIHVuaXRdKHZhbHVlKTsKICAgICAgfQoKICAgICAgLy8gTU9NRU5UUwoKICAgICAgZnVuY3Rpb24gZ2V0U2V0ICh1bml0cywgdmFsdWUpIHsKICAgICAgICAgIHZhciB1bml0OwogICAgICAgICAgaWYgKHR5cGVvZiB1bml0cyA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICBmb3IgKHVuaXQgaW4gdW5pdHMpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zZXQodW5pdCwgdW5pdHNbdW5pdF0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzW3VuaXRzXSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1t1bml0c10odmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBmdW5jdGlvbiB6ZXJvRmlsbChudW1iZXIsIHRhcmdldExlbmd0aCwgZm9yY2VTaWduKSB7CiAgICAgICAgICB2YXIgb3V0cHV0ID0gJycgKyBNYXRoLmFicyhudW1iZXIpLAogICAgICAgICAgICAgIHNpZ24gPSBudW1iZXIgPj0gMDsKCiAgICAgICAgICB3aGlsZSAob3V0cHV0Lmxlbmd0aCA8IHRhcmdldExlbmd0aCkgewogICAgICAgICAgICAgIG91dHB1dCA9ICcwJyArIG91dHB1dDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAoc2lnbiA/IChmb3JjZVNpZ24gPyAnKycgOiAnJykgOiAnLScpICsgb3V0cHV0OwogICAgICB9CgogICAgICB2YXIgZm9ybWF0dGluZ1Rva2VucyA9IC8oXFtbXlxbXSpcXSl8KFxcKT8oTW98TU0/TT9NP3xEb3xERERvfEREP0Q/RD98ZGRkP2Q/fGRvP3x3W298d10/fFdbb3xXXT98UXxZWVlZWVl8WVlZWVl8WVlZWXxZWXxnZyhnZ2c/KT98R0coR0dHPyk/fGV8RXxhfEF8aGg/fEhIP3xtbT98c3M/fFN7MSw0fXx4fFh8eno/fFpaP3wuKS9nOwoKICAgICAgdmFyIGxvY2FsRm9ybWF0dGluZ1Rva2VucyA9IC8oXFtbXlxbXSpcXSl8KFxcKT8oTFRTfExUfExMP0w/TD98bHsxLDR9KS9nOwoKICAgICAgdmFyIGZvcm1hdEZ1bmN0aW9ucyA9IHt9OwoKICAgICAgdmFyIGZvcm1hdFRva2VuRnVuY3Rpb25zID0ge307CgogICAgICAvLyB0b2tlbjogICAgJ00nCiAgICAgIC8vIHBhZGRlZDogICBbJ01NJywgMl0KICAgICAgLy8gb3JkaW5hbDogICdNbycKICAgICAgLy8gY2FsbGJhY2s6IGZ1bmN0aW9uICgpIHsgdGhpcy5tb250aCgpICsgMSB9CiAgICAgIGZ1bmN0aW9uIGFkZEZvcm1hdFRva2VuICh0b2tlbiwgcGFkZGVkLCBvcmRpbmFsLCBjYWxsYmFjaykgewogICAgICAgICAgdmFyIGZ1bmMgPSBjYWxsYmFjazsKICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgZnVuYyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNbY2FsbGJhY2tdKCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0b2tlbikgewogICAgICAgICAgICAgIGZvcm1hdFRva2VuRnVuY3Rpb25zW3Rva2VuXSA9IGZ1bmM7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocGFkZGVkKSB7CiAgICAgICAgICAgICAgZm9ybWF0VG9rZW5GdW5jdGlvbnNbcGFkZGVkWzBdXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHplcm9GaWxsKGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgcGFkZGVkWzFdLCBwYWRkZWRbMl0pOwogICAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3JkaW5hbCkgewogICAgICAgICAgICAgIGZvcm1hdFRva2VuRnVuY3Rpb25zW29yZGluYWxdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkub3JkaW5hbChmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRva2VuKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiByZW1vdmVGb3JtYXR0aW5nVG9rZW5zKGlucHV0KSB7CiAgICAgICAgICBpZiAoaW5wdXQubWF0Y2goL1xbW1xzXFNdLykpIHsKICAgICAgICAgICAgICByZXR1cm4gaW5wdXQucmVwbGFjZSgvXlxbfFxdJC9nLCAnJyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaW5wdXQucmVwbGFjZSgvXFwvZywgJycpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBtYWtlRm9ybWF0RnVuY3Rpb24oZm9ybWF0KSB7CiAgICAgICAgICB2YXIgYXJyYXkgPSBmb3JtYXQubWF0Y2goZm9ybWF0dGluZ1Rva2VucyksIGksIGxlbmd0aDsKCiAgICAgICAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSBhcnJheS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmIChmb3JtYXRUb2tlbkZ1bmN0aW9uc1thcnJheVtpXV0pIHsKICAgICAgICAgICAgICAgICAgYXJyYXlbaV0gPSBmb3JtYXRUb2tlbkZ1bmN0aW9uc1thcnJheVtpXV07CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgYXJyYXlbaV0gPSByZW1vdmVGb3JtYXR0aW5nVG9rZW5zKGFycmF5W2ldKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChtb20pIHsKICAgICAgICAgICAgICB2YXIgb3V0cHV0ID0gJyc7CiAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIG91dHB1dCArPSBhcnJheVtpXSBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gYXJyYXlbaV0uY2FsbChtb20sIGZvcm1hdCkgOiBhcnJheVtpXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgICAgICAgIH07CiAgICAgIH0KCiAgICAgIC8vIGZvcm1hdCBkYXRlIHVzaW5nIG5hdGl2ZSBkYXRlIG9iamVjdAogICAgICBmdW5jdGlvbiBmb3JtYXRNb21lbnQobSwgZm9ybWF0KSB7CiAgICAgICAgICBpZiAoIW0uaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG0ubG9jYWxlRGF0YSgpLmludmFsaWREYXRlKCk7CiAgICAgICAgICB9CgogICAgICAgICAgZm9ybWF0ID0gZXhwYW5kRm9ybWF0KGZvcm1hdCwgbS5sb2NhbGVEYXRhKCkpOwoKICAgICAgICAgIGlmICghZm9ybWF0RnVuY3Rpb25zW2Zvcm1hdF0pIHsKICAgICAgICAgICAgICBmb3JtYXRGdW5jdGlvbnNbZm9ybWF0XSA9IG1ha2VGb3JtYXRGdW5jdGlvbihmb3JtYXQpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBmb3JtYXRGdW5jdGlvbnNbZm9ybWF0XShtKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZXhwYW5kRm9ybWF0KGZvcm1hdCwgbG9jYWxlKSB7CiAgICAgICAgICB2YXIgaSA9IDU7CgogICAgICAgICAgZnVuY3Rpb24gcmVwbGFjZUxvbmdEYXRlRm9ybWF0VG9rZW5zKGlucHV0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIGxvY2FsZS5sb25nRGF0ZUZvcm1hdChpbnB1dCkgfHwgaW5wdXQ7CiAgICAgICAgICB9CgogICAgICAgICAgbG9jYWxGb3JtYXR0aW5nVG9rZW5zLmxhc3RJbmRleCA9IDA7CiAgICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGxvY2FsRm9ybWF0dGluZ1Rva2Vucy50ZXN0KGZvcm1hdCkpIHsKICAgICAgICAgICAgICBmb3JtYXQgPSBmb3JtYXQucmVwbGFjZShsb2NhbEZvcm1hdHRpbmdUb2tlbnMsIHJlcGxhY2VMb25nRGF0ZUZvcm1hdFRva2Vucyk7CiAgICAgICAgICAgICAgbG9jYWxGb3JtYXR0aW5nVG9rZW5zLmxhc3RJbmRleCA9IDA7CiAgICAgICAgICAgICAgaSAtPSAxOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBmb3JtYXQ7CiAgICAgIH0KCiAgICAgIHZhciBtYXRjaDEgICAgICAgICA9IC9cZC87ICAgICAgICAgICAgLy8gICAgICAgMCAtIDkKICAgICAgdmFyIG1hdGNoMiAgICAgICAgID0gL1xkXGQvOyAgICAgICAgICAvLyAgICAgIDAwIC0gOTkKICAgICAgdmFyIG1hdGNoMyAgICAgICAgID0gL1xkezN9LzsgICAgICAgICAvLyAgICAgMDAwIC0gOTk5CiAgICAgIHZhciBtYXRjaDQgICAgICAgICA9IC9cZHs0fS87ICAgICAgICAgLy8gICAgMDAwMCAtIDk5OTkKICAgICAgdmFyIG1hdGNoNiAgICAgICAgID0gL1srLV0/XGR7Nn0vOyAgICAvLyAtOTk5OTk5IC0gOTk5OTk5CiAgICAgIHZhciBtYXRjaDF0bzIgICAgICA9IC9cZFxkPy87ICAgICAgICAgLy8gICAgICAgMCAtIDk5CiAgICAgIHZhciBtYXRjaDF0bzMgICAgICA9IC9cZHsxLDN9LzsgICAgICAgLy8gICAgICAgMCAtIDk5OQogICAgICB2YXIgbWF0Y2gxdG80ICAgICAgPSAvXGR7MSw0fS87ICAgICAgIC8vICAgICAgIDAgLSA5OTk5CiAgICAgIHZhciBtYXRjaDF0bzYgICAgICA9IC9bKy1dP1xkezEsNn0vOyAgLy8gLTk5OTk5OSAtIDk5OTk5OQoKICAgICAgdmFyIG1hdGNoVW5zaWduZWQgID0gL1xkKy87ICAgICAgICAgICAvLyAgICAgICAwIC0gaW5mCiAgICAgIHZhciBtYXRjaFNpZ25lZCAgICA9IC9bKy1dP1xkKy87ICAgICAgLy8gICAgLWluZiAtIGluZgoKICAgICAgdmFyIG1hdGNoT2Zmc2V0ICAgID0gL1p8WystXVxkXGQ6P1xkXGQvZ2k7IC8vICswMDowMCAtMDA6MDAgKzAwMDAgLTAwMDAgb3IgWgoKICAgICAgdmFyIG1hdGNoVGltZXN0YW1wID0gL1srLV0/XGQrKFwuXGR7MSwzfSk/LzsgLy8gMTIzNDU2Nzg5IDEyMzQ1Njc4OS4xMjMKCiAgICAgIC8vIGFueSB3b3JkIChvciB0d28pIGNoYXJhY3RlcnMgb3IgbnVtYmVycyBpbmNsdWRpbmcgdHdvL3RocmVlIHdvcmQgbW9udGggaW4gYXJhYmljLgogICAgICB2YXIgbWF0Y2hXb3JkID0gL1swLTldKlsnYS16XHUwMEEwLVx1MDVGRlx1MDcwMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0rfFtcdTA2MDAtXHUwNkZGXC9dKyhccyo/W1x1MDYwMC1cdTA2RkZdKyl7MSwyfS9pOwoKICAgICAgdmFyIHJlZ2V4ZXMgPSB7fTsKCiAgICAgIGZ1bmN0aW9uIGFkZFJlZ2V4VG9rZW4gKHRva2VuLCByZWdleCwgc3RyaWN0UmVnZXgpIHsKICAgICAgICAgIHJlZ2V4ZXNbdG9rZW5dID0gdHlwZW9mIHJlZ2V4ID09PSAnZnVuY3Rpb24nID8gcmVnZXggOiBmdW5jdGlvbiAoaXNTdHJpY3QpIHsKICAgICAgICAgICAgICByZXR1cm4gKGlzU3RyaWN0ICYmIHN0cmljdFJlZ2V4KSA/IHN0cmljdFJlZ2V4IDogcmVnZXg7CiAgICAgICAgICB9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXRQYXJzZVJlZ2V4Rm9yVG9rZW4gKHRva2VuLCBjb25maWcpIHsKICAgICAgICAgIGlmICghaGFzT3duUHJvcChyZWdleGVzLCB0b2tlbikpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cCh1bmVzY2FwZUZvcm1hdCh0b2tlbikpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZWdleGVzW3Rva2VuXShjb25maWcuX3N0cmljdCwgY29uZmlnLl9sb2NhbGUpOwogICAgICB9CgogICAgICAvLyBDb2RlIGZyb20gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zNTYxNDkzL2lzLXRoZXJlLWEtcmVnZXhwLWVzY2FwZS1mdW5jdGlvbi1pbi1qYXZhc2NyaXB0CiAgICAgIGZ1bmN0aW9uIHVuZXNjYXBlRm9ybWF0KHMpIHsKICAgICAgICAgIHJldHVybiBzLnJlcGxhY2UoJ1xcJywgJycpLnJlcGxhY2UoL1xcKFxbKXxcXChcXSl8XFsoW15cXVxbXSopXF18XFwoLikvZywgZnVuY3Rpb24gKG1hdGNoZWQsIHAxLCBwMiwgcDMsIHA0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHAxIHx8IHAyIHx8IHAzIHx8IHA0OwogICAgICAgICAgfSkucmVwbGFjZSgvWy1cL1xcXiQqKz8uKCl8W1xde31dL2csICdcXCQmJyk7CiAgICAgIH0KCiAgICAgIHZhciB0b2tlbnMgPSB7fTsKCiAgICAgIGZ1bmN0aW9uIGFkZFBhcnNlVG9rZW4gKHRva2VuLCBjYWxsYmFjaykgewogICAgICAgICAgdmFyIGksIGZ1bmMgPSBjYWxsYmFjazsKICAgICAgICAgIGlmICh0eXBlb2YgdG9rZW4gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgdG9rZW4gPSBbdG9rZW5dOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICBmdW5jID0gZnVuY3Rpb24gKGlucHV0LCBhcnJheSkgewogICAgICAgICAgICAgICAgICBhcnJheVtjYWxsYmFja10gPSB0b0ludChpbnB1dCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0b2tlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHRva2Vuc1t0b2tlbltpXV0gPSBmdW5jOwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBhZGRXZWVrUGFyc2VUb2tlbiAodG9rZW4sIGNhbGxiYWNrKSB7CiAgICAgICAgICBhZGRQYXJzZVRva2VuKHRva2VuLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcsIHRva2VuKSB7CiAgICAgICAgICAgICAgY29uZmlnLl93ID0gY29uZmlnLl93IHx8IHt9OwogICAgICAgICAgICAgIGNhbGxiYWNrKGlucHV0LCBjb25maWcuX3csIGNvbmZpZywgdG9rZW4pOwogICAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFkZFRpbWVUb0FycmF5RnJvbVRva2VuKHRva2VuLCBpbnB1dCwgY29uZmlnKSB7CiAgICAgICAgICBpZiAoaW5wdXQgIT0gbnVsbCAmJiBoYXNPd25Qcm9wKHRva2VucywgdG9rZW4pKSB7CiAgICAgICAgICAgICAgdG9rZW5zW3Rva2VuXShpbnB1dCwgY29uZmlnLl9hLCBjb25maWcsIHRva2VuKTsKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIFlFQVIgPSAwOwogICAgICB2YXIgTU9OVEggPSAxOwogICAgICB2YXIgREFURSA9IDI7CiAgICAgIHZhciBIT1VSID0gMzsKICAgICAgdmFyIE1JTlVURSA9IDQ7CiAgICAgIHZhciBTRUNPTkQgPSA1OwogICAgICB2YXIgTUlMTElTRUNPTkQgPSA2OwoKICAgICAgZnVuY3Rpb24gZGF5c0luTW9udGgoeWVhciwgbW9udGgpIHsKICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShEYXRlLlVUQyh5ZWFyLCBtb250aCArIDEsIDApKS5nZXRVVENEYXRlKCk7CiAgICAgIH0KCiAgICAgIC8vIEZPUk1BVFRJTkcKCiAgICAgIGFkZEZvcm1hdFRva2VuKCdNJywgWydNTScsIDJdLCAnTW8nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5tb250aCgpICsgMTsKICAgICAgfSk7CgogICAgICBhZGRGb3JtYXRUb2tlbignTU1NJywgMCwgMCwgZnVuY3Rpb24gKGZvcm1hdCkgewogICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLm1vbnRoc1Nob3J0KHRoaXMsIGZvcm1hdCk7CiAgICAgIH0pOwoKICAgICAgYWRkRm9ybWF0VG9rZW4oJ01NTU0nLCAwLCAwLCBmdW5jdGlvbiAoZm9ybWF0KSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkubW9udGhzKHRoaXMsIGZvcm1hdCk7CiAgICAgIH0pOwoKICAgICAgLy8gQUxJQVNFUwoKICAgICAgYWRkVW5pdEFsaWFzKCdtb250aCcsICdNJyk7CgogICAgICAvLyBQQVJTSU5HCgogICAgICBhZGRSZWdleFRva2VuKCdNJywgICAgbWF0Y2gxdG8yKTsKICAgICAgYWRkUmVnZXhUb2tlbignTU0nLCAgIG1hdGNoMXRvMiwgbWF0Y2gyKTsKICAgICAgYWRkUmVnZXhUb2tlbignTU1NJywgIG1hdGNoV29yZCk7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ01NTU0nLCBtYXRjaFdvcmQpOwoKICAgICAgYWRkUGFyc2VUb2tlbihbJ00nLCAnTU0nXSwgZnVuY3Rpb24gKGlucHV0LCBhcnJheSkgewogICAgICAgICAgYXJyYXlbTU9OVEhdID0gdG9JbnQoaW5wdXQpIC0gMTsKICAgICAgfSk7CgogICAgICBhZGRQYXJzZVRva2VuKFsnTU1NJywgJ01NTU0nXSwgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnLCB0b2tlbikgewogICAgICAgICAgdmFyIG1vbnRoID0gY29uZmlnLl9sb2NhbGUubW9udGhzUGFyc2UoaW5wdXQsIHRva2VuLCBjb25maWcuX3N0cmljdCk7CiAgICAgICAgICAvLyBpZiB3ZSBkaWRuJ3QgZmluZCBhIG1vbnRoIG5hbWUsIG1hcmsgdGhlIGRhdGUgYXMgaW52YWxpZC4KICAgICAgICAgIGlmIChtb250aCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgYXJyYXlbTU9OVEhdID0gbW9udGg7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmludmFsaWRNb250aCA9IGlucHV0OwogICAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIExPQ0FMRVMKCiAgICAgIHZhciBkZWZhdWx0TG9jYWxlTW9udGhzID0gJ0phbnVhcnlfRmVicnVhcnlfTWFyY2hfQXByaWxfTWF5X0p1bmVfSnVseV9BdWd1c3RfU2VwdGVtYmVyX09jdG9iZXJfTm92ZW1iZXJfRGVjZW1iZXInLnNwbGl0KCdfJyk7CiAgICAgIGZ1bmN0aW9uIGxvY2FsZU1vbnRocyAobSkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX21vbnRoc1ttLm1vbnRoKCldOwogICAgICB9CgogICAgICB2YXIgZGVmYXVsdExvY2FsZU1vbnRoc1Nob3J0ID0gJ0phbl9GZWJfTWFyX0Fwcl9NYXlfSnVuX0p1bF9BdWdfU2VwX09jdF9Ob3ZfRGVjJy5zcGxpdCgnXycpOwogICAgICBmdW5jdGlvbiBsb2NhbGVNb250aHNTaG9ydCAobSkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX21vbnRoc1Nob3J0W20ubW9udGgoKV07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGxvY2FsZU1vbnRoc1BhcnNlIChtb250aE5hbWUsIGZvcm1hdCwgc3RyaWN0KSB7CiAgICAgICAgICB2YXIgaSwgbW9tLCByZWdleDsKCiAgICAgICAgICBpZiAoIXRoaXMuX21vbnRoc1BhcnNlKSB7CiAgICAgICAgICAgICAgdGhpcy5fbW9udGhzUGFyc2UgPSBbXTsKICAgICAgICAgICAgICB0aGlzLl9sb25nTW9udGhzUGFyc2UgPSBbXTsKICAgICAgICAgICAgICB0aGlzLl9zaG9ydE1vbnRoc1BhcnNlID0gW107CiAgICAgICAgICB9CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IDEyOyBpKyspIHsKICAgICAgICAgICAgICAvLyBtYWtlIHRoZSByZWdleCBpZiB3ZSBkb24ndCBoYXZlIGl0IGFscmVhZHkKICAgICAgICAgICAgICBtb20gPSBjcmVhdGVfdXRjX19jcmVhdGVVVEMoWzIwMDAsIGldKTsKICAgICAgICAgICAgICBpZiAoc3RyaWN0ICYmICF0aGlzLl9sb25nTW9udGhzUGFyc2VbaV0pIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fbG9uZ01vbnRoc1BhcnNlW2ldID0gbmV3IFJlZ0V4cCgnXicgKyB0aGlzLm1vbnRocyhtb20sICcnKS5yZXBsYWNlKCcuJywgJycpICsgJyQnLCAnaScpOwogICAgICAgICAgICAgICAgICB0aGlzLl9zaG9ydE1vbnRoc1BhcnNlW2ldID0gbmV3IFJlZ0V4cCgnXicgKyB0aGlzLm1vbnRoc1Nob3J0KG1vbSwgJycpLnJlcGxhY2UoJy4nLCAnJykgKyAnJCcsICdpJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICghc3RyaWN0ICYmICF0aGlzLl9tb250aHNQYXJzZVtpXSkgewogICAgICAgICAgICAgICAgICByZWdleCA9ICdeJyArIHRoaXMubW9udGhzKG1vbSwgJycpICsgJ3xeJyArIHRoaXMubW9udGhzU2hvcnQobW9tLCAnJyk7CiAgICAgICAgICAgICAgICAgIHRoaXMuX21vbnRoc1BhcnNlW2ldID0gbmV3IFJlZ0V4cChyZWdleC5yZXBsYWNlKCcuJywgJycpLCAnaScpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAvLyB0ZXN0IHRoZSByZWdleAogICAgICAgICAgICAgIGlmIChzdHJpY3QgJiYgZm9ybWF0ID09PSAnTU1NTScgJiYgdGhpcy5fbG9uZ01vbnRoc1BhcnNlW2ldLnRlc3QobW9udGhOYW1lKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0cmljdCAmJiBmb3JtYXQgPT09ICdNTU0nICYmIHRoaXMuX3Nob3J0TW9udGhzUGFyc2VbaV0udGVzdChtb250aE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXN0cmljdCAmJiB0aGlzLl9tb250aHNQYXJzZVtpXS50ZXN0KG1vbnRoTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CgogICAgICAvLyBNT01FTlRTCgogICAgICBmdW5jdGlvbiBzZXRNb250aCAobW9tLCB2YWx1ZSkgewogICAgICAgICAgdmFyIGRheU9mTW9udGg7CgogICAgICAgICAgLy8gVE9ETzogTW92ZSB0aGlzIG91dCBvZiBoZXJlIQogICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICB2YWx1ZSA9IG1vbS5sb2NhbGVEYXRhKCkubW9udGhzUGFyc2UodmFsdWUpOwogICAgICAgICAgICAgIC8vIFRPRE86IEFub3RoZXIgc2lsZW50IGZhaWx1cmU/CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZGF5T2ZNb250aCA9IE1hdGgubWluKG1vbS5kYXRlKCksIGRheXNJbk1vbnRoKG1vbS55ZWFyKCksIHZhbHVlKSk7CiAgICAgICAgICBtb20uX2RbJ3NldCcgKyAobW9tLl9pc1VUQyA/ICdVVEMnIDogJycpICsgJ01vbnRoJ10odmFsdWUsIGRheU9mTW9udGgpOwogICAgICAgICAgcmV0dXJuIG1vbTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0U2V0TW9udGggKHZhbHVlKSB7CiAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgewogICAgICAgICAgICAgIHNldE1vbnRoKHRoaXMsIHZhbHVlKTsKICAgICAgICAgICAgICB1dGlsc19ob29rc19faG9va3MudXBkYXRlT2Zmc2V0KHRoaXMsIHRydWUpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gZ2V0X3NldF9fZ2V0KHRoaXMsICdNb250aCcpOwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXREYXlzSW5Nb250aCAoKSB7CiAgICAgICAgICByZXR1cm4gZGF5c0luTW9udGgodGhpcy55ZWFyKCksIHRoaXMubW9udGgoKSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNoZWNrT3ZlcmZsb3cgKG0pIHsKICAgICAgICAgIHZhciBvdmVyZmxvdzsKICAgICAgICAgIHZhciBhID0gbS5fYTsKCiAgICAgICAgICBpZiAoYSAmJiBnZXRQYXJzaW5nRmxhZ3MobSkub3ZlcmZsb3cgPT09IC0yKSB7CiAgICAgICAgICAgICAgb3ZlcmZsb3cgPQogICAgICAgICAgICAgICAgICBhW01PTlRIXSAgICAgICA8IDAgfHwgYVtNT05USF0gICAgICAgPiAxMSAgPyBNT05USCA6CiAgICAgICAgICAgICAgICAgIGFbREFURV0gICAgICAgIDwgMSB8fCBhW0RBVEVdICAgICAgICA+IGRheXNJbk1vbnRoKGFbWUVBUl0sIGFbTU9OVEhdKSA/IERBVEUgOgogICAgICAgICAgICAgICAgICBhW0hPVVJdICAgICAgICA8IDAgfHwgYVtIT1VSXSAgICAgICAgPiAyNCB8fCAoYVtIT1VSXSA9PT0gMjQgJiYgKGFbTUlOVVRFXSAhPT0gMCB8fCBhW1NFQ09ORF0gIT09IDAgfHwgYVtNSUxMSVNFQ09ORF0gIT09IDApKSA/IEhPVVIgOgogICAgICAgICAgICAgICAgICBhW01JTlVURV0gICAgICA8IDAgfHwgYVtNSU5VVEVdICAgICAgPiA1OSAgPyBNSU5VVEUgOgogICAgICAgICAgICAgICAgICBhW1NFQ09ORF0gICAgICA8IDAgfHwgYVtTRUNPTkRdICAgICAgPiA1OSAgPyBTRUNPTkQgOgogICAgICAgICAgICAgICAgICBhW01JTExJU0VDT05EXSA8IDAgfHwgYVtNSUxMSVNFQ09ORF0gPiA5OTkgPyBNSUxMSVNFQ09ORCA6CiAgICAgICAgICAgICAgICAgIC0xOwoKICAgICAgICAgICAgICBpZiAoZ2V0UGFyc2luZ0ZsYWdzKG0pLl9vdmVyZmxvd0RheU9mWWVhciAmJiAob3ZlcmZsb3cgPCBZRUFSIHx8IG92ZXJmbG93ID4gREFURSkpIHsKICAgICAgICAgICAgICAgICAgb3ZlcmZsb3cgPSBEQVRFOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKG0pLm92ZXJmbG93ID0gb3ZlcmZsb3c7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHdhcm4obXNnKSB7CiAgICAgICAgICBpZiAodXRpbHNfaG9va3NfX2hvb2tzLnN1cHByZXNzRGVwcmVjYXRpb25XYXJuaW5ncyA9PT0gZmFsc2UgJiYgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUud2FybikgewogICAgICAgICAgICAgIGNvbnNvbGUud2FybignRGVwcmVjYXRpb24gd2FybmluZzogJyArIG1zZyk7CiAgICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGRlcHJlY2F0ZShtc2csIGZuKSB7CiAgICAgICAgICB2YXIgZmlyc3RUaW1lID0gdHJ1ZSwKICAgICAgICAgICAgICBtc2dXaXRoU3RhY2sgPSBtc2cgKyAnXG4nICsgKG5ldyBFcnJvcigpKS5zdGFjazsKCiAgICAgICAgICByZXR1cm4gZXh0ZW5kKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoZmlyc3RUaW1lKSB7CiAgICAgICAgICAgICAgICAgIHdhcm4obXNnV2l0aFN0YWNrKTsKICAgICAgICAgICAgICAgICAgZmlyc3RUaW1lID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfSwgZm4pOwogICAgICB9CgogICAgICB2YXIgZGVwcmVjYXRpb25zID0ge307CgogICAgICBmdW5jdGlvbiBkZXByZWNhdGVTaW1wbGUobmFtZSwgbXNnKSB7CiAgICAgICAgICBpZiAoIWRlcHJlY2F0aW9uc1tuYW1lXSkgewogICAgICAgICAgICAgIHdhcm4obXNnKTsKICAgICAgICAgICAgICBkZXByZWNhdGlvbnNbbmFtZV0gPSB0cnVlOwogICAgICAgICAgfQogICAgICB9CgogICAgICB1dGlsc19ob29rc19faG9va3Muc3VwcHJlc3NEZXByZWNhdGlvbldhcm5pbmdzID0gZmFsc2U7CgogICAgICB2YXIgZnJvbV9zdHJpbmdfX2lzb1JlZ2V4ID0gL15ccyooPzpbKy1dXGR7Nn18XGR7NH0pLSg/OihcZFxkLVxkXGQpfChXXGRcZCQpfChXXGRcZC1cZCl8KFxkXGRcZCkpKChUfCApKFxkXGQoOlxkXGQoOlxkXGQoXC5cZCspPyk/KT8pPyhbXCtcLV1cZFxkKD86Oj9cZFxkKT98XHMqWik/KT8kLzsKCiAgICAgIHZhciBpc29EYXRlcyA9IFsKICAgICAgICAgIFsnWVlZWVlZLU1NLUREJywgL1srLV1cZHs2fS1cZHsyfS1cZHsyfS9dLAogICAgICAgICAgWydZWVlZLU1NLUREJywgL1xkezR9LVxkezJ9LVxkezJ9L10sCiAgICAgICAgICBbJ0dHR0ctW1ddV1ctRScsIC9cZHs0fS1XXGR7Mn0tXGQvXSwKICAgICAgICAgIFsnR0dHRy1bV11XVycsIC9cZHs0fS1XXGR7Mn0vXSwKICAgICAgICAgIFsnWVlZWS1EREQnLCAvXGR7NH0tXGR7M30vXQogICAgICBdOwoKICAgICAgLy8gaXNvIHRpbWUgZm9ybWF0cyBhbmQgcmVnZXhlcwogICAgICB2YXIgaXNvVGltZXMgPSBbCiAgICAgICAgICBbJ0hIOm1tOnNzLlNTU1MnLCAvKFR8IClcZFxkOlxkXGQ6XGRcZFwuXGQrL10sCiAgICAgICAgICBbJ0hIOm1tOnNzJywgLyhUfCApXGRcZDpcZFxkOlxkXGQvXSwKICAgICAgICAgIFsnSEg6bW0nLCAvKFR8IClcZFxkOlxkXGQvXSwKICAgICAgICAgIFsnSEgnLCAvKFR8IClcZFxkL10KICAgICAgXTsKCiAgICAgIHZhciBhc3BOZXRKc29uUmVnZXggPSAvXlwvP0RhdGVcKChcLT9cZCspL2k7CgogICAgICAvLyBkYXRlIGZyb20gaXNvIGZvcm1hdAogICAgICBmdW5jdGlvbiBjb25maWdGcm9tSVNPKGNvbmZpZykgewogICAgICAgICAgdmFyIGksIGwsCiAgICAgICAgICAgICAgc3RyaW5nID0gY29uZmlnLl9pLAogICAgICAgICAgICAgIG1hdGNoID0gZnJvbV9zdHJpbmdfX2lzb1JlZ2V4LmV4ZWMoc3RyaW5nKTsKCiAgICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5pc28gPSB0cnVlOwogICAgICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBpc29EYXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgICAgICAgaWYgKGlzb0RhdGVzW2ldWzFdLmV4ZWMoc3RyaW5nKSkgewogICAgICAgICAgICAgICAgICAgICAgLy8gbWF0Y2hbNV0gc2hvdWxkIGJlICdUJyBvciB1bmRlZmluZWQKICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5fZiA9IGlzb0RhdGVzW2ldWzBdICsgKG1hdGNoWzZdIHx8ICcgJyk7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBsID0gaXNvVGltZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChpc29UaW1lc1tpXVsxXS5leGVjKHN0cmluZykpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5fZiArPSBpc29UaW1lc1tpXVswXTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzdHJpbmcubWF0Y2gobWF0Y2hPZmZzZXQpKSB7CiAgICAgICAgICAgICAgICAgIGNvbmZpZy5fZiArPSAnWic7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbmZpZ0Zyb21TdHJpbmdBbmRGb3JtYXQoY29uZmlnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uZmlnLl9pc1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIGRhdGUgZnJvbSBpc28gZm9ybWF0IG9yIGZhbGxiYWNrCiAgICAgIGZ1bmN0aW9uIGNvbmZpZ0Zyb21TdHJpbmcoY29uZmlnKSB7CiAgICAgICAgICB2YXIgbWF0Y2hlZCA9IGFzcE5ldEpzb25SZWdleC5leGVjKGNvbmZpZy5faSk7CgogICAgICAgICAgaWYgKG1hdGNoZWQgIT09IG51bGwpIHsKICAgICAgICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZSgrbWF0Y2hlZFsxXSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbmZpZ0Zyb21JU08oY29uZmlnKTsKICAgICAgICAgIGlmIChjb25maWcuX2lzVmFsaWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgZGVsZXRlIGNvbmZpZy5faXNWYWxpZDsKICAgICAgICAgICAgICB1dGlsc19ob29rc19faG9va3MuY3JlYXRlRnJvbUlucHV0RmFsbGJhY2soY29uZmlnKTsKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLmNyZWF0ZUZyb21JbnB1dEZhbGxiYWNrID0gZGVwcmVjYXRlKAogICAgICAgICAgJ21vbWVudCBjb25zdHJ1Y3Rpb24gZmFsbHMgYmFjayB0byBqcyBEYXRlLiBUaGlzIGlzICcgKwogICAgICAgICAgJ2Rpc2NvdXJhZ2VkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gdXBjb21pbmcgbWFqb3IgJyArCiAgICAgICAgICAncmVsZWFzZS4gUGxlYXNlIHJlZmVyIHRvICcgKwogICAgICAgICAgJ2h0dHBzOi8vZ2l0aHViLmNvbS9tb21lbnQvbW9tZW50L2lzc3Vlcy8xNDA3IGZvciBtb3JlIGluZm8uJywKICAgICAgICAgIGZ1bmN0aW9uIChjb25maWcpIHsKICAgICAgICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZShjb25maWcuX2kgKyAoY29uZmlnLl91c2VVVEMgPyAnIFVUQycgOiAnJykpOwogICAgICAgICAgfQogICAgICApOwoKICAgICAgZnVuY3Rpb24gY3JlYXRlRGF0ZSAoeSwgbSwgZCwgaCwgTSwgcywgbXMpIHsKICAgICAgICAgIC8vY2FuJ3QganVzdCBhcHBseSgpIHRvIGNyZWF0ZSBhIGRhdGU6CiAgICAgICAgICAvL2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTgxMzQ4L2luc3RhbnRpYXRpbmctYS1qYXZhc2NyaXB0LW9iamVjdC1ieS1jYWxsaW5nLXByb3RvdHlwZS1jb25zdHJ1Y3Rvci1hcHBseQogICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh5LCBtLCBkLCBoLCBNLCBzLCBtcyk7CgogICAgICAgICAgLy90aGUgZGF0ZSBjb25zdHJ1Y3RvciBkb2Vzbid0IGFjY2VwdCB5ZWFycyA8IDE5NzAKICAgICAgICAgIGlmICh5IDwgMTk3MCkgewogICAgICAgICAgICAgIGRhdGUuc2V0RnVsbFllYXIoeSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZGF0ZTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY3JlYXRlVVRDRGF0ZSAoeSkgewogICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShEYXRlLlVUQy5hcHBseShudWxsLCBhcmd1bWVudHMpKTsKICAgICAgICAgIGlmICh5IDwgMTk3MCkgewogICAgICAgICAgICAgIGRhdGUuc2V0VVRDRnVsbFllYXIoeSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZGF0ZTsKICAgICAgfQoKICAgICAgYWRkRm9ybWF0VG9rZW4oMCwgWydZWScsIDJdLCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy55ZWFyKCkgJSAxMDA7CiAgICAgIH0pOwoKICAgICAgYWRkRm9ybWF0VG9rZW4oMCwgWydZWVlZJywgICA0XSwgICAgICAgMCwgJ3llYXInKTsKICAgICAgYWRkRm9ybWF0VG9rZW4oMCwgWydZWVlZWScsICA1XSwgICAgICAgMCwgJ3llYXInKTsKICAgICAgYWRkRm9ybWF0VG9rZW4oMCwgWydZWVlZWVknLCA2LCB0cnVlXSwgMCwgJ3llYXInKTsKCiAgICAgIC8vIEFMSUFTRVMKCiAgICAgIGFkZFVuaXRBbGlhcygneWVhcicsICd5Jyk7CgogICAgICAvLyBQQVJTSU5HCgogICAgICBhZGRSZWdleFRva2VuKCdZJywgICAgICBtYXRjaFNpZ25lZCk7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ1lZJywgICAgIG1hdGNoMXRvMiwgbWF0Y2gyKTsKICAgICAgYWRkUmVnZXhUb2tlbignWVlZWScsICAgbWF0Y2gxdG80LCBtYXRjaDQpOwogICAgICBhZGRSZWdleFRva2VuKCdZWVlZWScsICBtYXRjaDF0bzYsIG1hdGNoNik7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ1lZWVlZWScsIG1hdGNoMXRvNiwgbWF0Y2g2KTsKCiAgICAgIGFkZFBhcnNlVG9rZW4oWydZWVlZJywgJ1lZWVlZJywgJ1lZWVlZWSddLCBZRUFSKTsKICAgICAgYWRkUGFyc2VUb2tlbignWVknLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5KSB7CiAgICAgICAgICBhcnJheVtZRUFSXSA9IHV0aWxzX2hvb2tzX19ob29rcy5wYXJzZVR3b0RpZ2l0WWVhcihpbnB1dCk7CiAgICAgIH0pOwoKICAgICAgLy8gSEVMUEVSUwoKICAgICAgZnVuY3Rpb24gZGF5c0luWWVhcih5ZWFyKSB7CiAgICAgICAgICByZXR1cm4gaXNMZWFwWWVhcih5ZWFyKSA/IDM2NiA6IDM2NTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaXNMZWFwWWVhcih5ZWFyKSB7CiAgICAgICAgICByZXR1cm4gKHllYXIgJSA0ID09PSAwICYmIHllYXIgJSAxMDAgIT09IDApIHx8IHllYXIgJSA0MDAgPT09IDA7CiAgICAgIH0KCiAgICAgIC8vIEhPT0tTCgogICAgICB1dGlsc19ob29rc19faG9va3MucGFyc2VUd29EaWdpdFllYXIgPSBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgIHJldHVybiB0b0ludChpbnB1dCkgKyAodG9JbnQoaW5wdXQpID4gNjggPyAxOTAwIDogMjAwMCk7CiAgICAgIH07CgogICAgICAvLyBNT01FTlRTCgogICAgICB2YXIgZ2V0U2V0WWVhciA9IG1ha2VHZXRTZXQoJ0Z1bGxZZWFyJywgZmFsc2UpOwoKICAgICAgZnVuY3Rpb24gZ2V0SXNMZWFwWWVhciAoKSB7CiAgICAgICAgICByZXR1cm4gaXNMZWFwWWVhcih0aGlzLnllYXIoKSk7CiAgICAgIH0KCiAgICAgIGFkZEZvcm1hdFRva2VuKCd3JywgWyd3dycsIDJdLCAnd28nLCAnd2VlaycpOwogICAgICBhZGRGb3JtYXRUb2tlbignVycsIFsnV1cnLCAyXSwgJ1dvJywgJ2lzb1dlZWsnKTsKCiAgICAgIC8vIEFMSUFTRVMKCiAgICAgIGFkZFVuaXRBbGlhcygnd2VlaycsICd3Jyk7CiAgICAgIGFkZFVuaXRBbGlhcygnaXNvV2VlaycsICdXJyk7CgogICAgICAvLyBQQVJTSU5HCgogICAgICBhZGRSZWdleFRva2VuKCd3JywgIG1hdGNoMXRvMik7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ3d3JywgbWF0Y2gxdG8yLCBtYXRjaDIpOwogICAgICBhZGRSZWdleFRva2VuKCdXJywgIG1hdGNoMXRvMik7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ1dXJywgbWF0Y2gxdG8yLCBtYXRjaDIpOwoKICAgICAgYWRkV2Vla1BhcnNlVG9rZW4oWyd3JywgJ3d3JywgJ1cnLCAnV1cnXSwgZnVuY3Rpb24gKGlucHV0LCB3ZWVrLCBjb25maWcsIHRva2VuKSB7CiAgICAgICAgICB3ZWVrW3Rva2VuLnN1YnN0cigwLCAxKV0gPSB0b0ludChpbnB1dCk7CiAgICAgIH0pOwoKICAgICAgLy8gSEVMUEVSUwoKICAgICAgLy8gZmlyc3REYXlPZldlZWsgICAgICAgMCA9IHN1biwgNiA9IHNhdAogICAgICAvLyAgICAgICAgICAgICAgICAgICAgICB0aGUgZGF5IG9mIHRoZSB3ZWVrIHRoYXQgc3RhcnRzIHRoZSB3ZWVrCiAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICh1c3VhbGx5IHN1bmRheSBvciBtb25kYXkpCiAgICAgIC8vIGZpcnN0RGF5T2ZXZWVrT2ZZZWFyIDAgPSBzdW4sIDYgPSBzYXQKICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGhlIGZpcnN0IHdlZWsgaXMgdGhlIHdlZWsgdGhhdCBjb250YWlucyB0aGUgZmlyc3QKICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgb2YgdGhpcyBkYXkgb2YgdGhlIHdlZWsKICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgKGVnLiBJU08gd2Vla3MgdXNlIHRodXJzZGF5ICg0KSkKICAgICAgZnVuY3Rpb24gd2Vla09mWWVhcihtb20sIGZpcnN0RGF5T2ZXZWVrLCBmaXJzdERheU9mV2Vla09mWWVhcikgewogICAgICAgICAgdmFyIGVuZCA9IGZpcnN0RGF5T2ZXZWVrT2ZZZWFyIC0gZmlyc3REYXlPZldlZWssCiAgICAgICAgICAgICAgZGF5c1RvRGF5T2ZXZWVrID0gZmlyc3REYXlPZldlZWtPZlllYXIgLSBtb20uZGF5KCksCiAgICAgICAgICAgICAgYWRqdXN0ZWRNb21lbnQ7CgoKICAgICAgICAgIGlmIChkYXlzVG9EYXlPZldlZWsgPiBlbmQpIHsKICAgICAgICAgICAgICBkYXlzVG9EYXlPZldlZWsgLT0gNzsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZGF5c1RvRGF5T2ZXZWVrIDwgZW5kIC0gNykgewogICAgICAgICAgICAgIGRheXNUb0RheU9mV2VlayArPSA3OwogICAgICAgICAgfQoKICAgICAgICAgIGFkanVzdGVkTW9tZW50ID0gbG9jYWxfX2NyZWF0ZUxvY2FsKG1vbSkuYWRkKGRheXNUb0RheU9mV2VlaywgJ2QnKTsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgd2VlazogTWF0aC5jZWlsKGFkanVzdGVkTW9tZW50LmRheU9mWWVhcigpIC8gNyksCiAgICAgICAgICAgICAgeWVhcjogYWRqdXN0ZWRNb21lbnQueWVhcigpCiAgICAgICAgICB9OwogICAgICB9CgogICAgICAvLyBMT0NBTEVTCgogICAgICBmdW5jdGlvbiBsb2NhbGVXZWVrIChtb20pIHsKICAgICAgICAgIHJldHVybiB3ZWVrT2ZZZWFyKG1vbSwgdGhpcy5fd2Vlay5kb3csIHRoaXMuX3dlZWsuZG95KS53ZWVrOwogICAgICB9CgogICAgICB2YXIgZGVmYXVsdExvY2FsZVdlZWsgPSB7CiAgICAgICAgICBkb3cgOiAwLCAvLyBTdW5kYXkgaXMgdGhlIGZpcnN0IGRheSBvZiB0aGUgd2Vlay4KICAgICAgICAgIGRveSA6IDYgIC8vIFRoZSB3ZWVrIHRoYXQgY29udGFpbnMgSmFuIDFzdCBpcyB0aGUgZmlyc3Qgd2VlayBvZiB0aGUgeWVhci4KICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIGxvY2FsZUZpcnN0RGF5T2ZXZWVrICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrLmRvdzsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbG9jYWxlRmlyc3REYXlPZlllYXIgKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX3dlZWsuZG95OwogICAgICB9CgogICAgICAvLyBNT01FTlRTCgogICAgICBmdW5jdGlvbiBnZXRTZXRXZWVrIChpbnB1dCkgewogICAgICAgICAgdmFyIHdlZWsgPSB0aGlzLmxvY2FsZURhdGEoKS53ZWVrKHRoaXMpOwogICAgICAgICAgcmV0dXJuIGlucHV0ID09IG51bGwgPyB3ZWVrIDogdGhpcy5hZGQoKGlucHV0IC0gd2VlaykgKiA3LCAnZCcpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXRTZXRJU09XZWVrIChpbnB1dCkgewogICAgICAgICAgdmFyIHdlZWsgPSB3ZWVrT2ZZZWFyKHRoaXMsIDEsIDQpLndlZWs7CiAgICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHdlZWsgOiB0aGlzLmFkZCgoaW5wdXQgLSB3ZWVrKSAqIDcsICdkJyk7CiAgICAgIH0KCiAgICAgIGFkZEZvcm1hdFRva2VuKCdEREQnLCBbJ0REREQnLCAzXSwgJ0RERG8nLCAnZGF5T2ZZZWFyJyk7CgogICAgICAvLyBBTElBU0VTCgogICAgICBhZGRVbml0QWxpYXMoJ2RheU9mWWVhcicsICdEREQnKTsKCiAgICAgIC8vIFBBUlNJTkcKCiAgICAgIGFkZFJlZ2V4VG9rZW4oJ0RERCcsICBtYXRjaDF0bzMpOwogICAgICBhZGRSZWdleFRva2VuKCdEREREJywgbWF0Y2gzKTsKICAgICAgYWRkUGFyc2VUb2tlbihbJ0RERCcsICdEREREJ10sIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykgewogICAgICAgICAgY29uZmlnLl9kYXlPZlllYXIgPSB0b0ludChpbnB1dCk7CiAgICAgIH0pOwoKICAgICAgLy8gSEVMUEVSUwoKICAgICAgLy9odHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0lTT193ZWVrX2RhdGUjQ2FsY3VsYXRpbmdfYV9kYXRlX2dpdmVuX3RoZV95ZWFyLjJDX3dlZWtfbnVtYmVyX2FuZF93ZWVrZGF5CiAgICAgIGZ1bmN0aW9uIGRheU9mWWVhckZyb21XZWVrcyh5ZWFyLCB3ZWVrLCB3ZWVrZGF5LCBmaXJzdERheU9mV2Vla09mWWVhciwgZmlyc3REYXlPZldlZWspIHsKICAgICAgICAgIHZhciBkID0gY3JlYXRlVVRDRGF0ZSh5ZWFyLCAwLCAxKS5nZXRVVENEYXkoKTsKICAgICAgICAgIHZhciBkYXlzVG9BZGQ7CiAgICAgICAgICB2YXIgZGF5T2ZZZWFyOwoKICAgICAgICAgIGQgPSBkID09PSAwID8gNyA6IGQ7CiAgICAgICAgICB3ZWVrZGF5ID0gd2Vla2RheSAhPSBudWxsID8gd2Vla2RheSA6IGZpcnN0RGF5T2ZXZWVrOwogICAgICAgICAgZGF5c1RvQWRkID0gZmlyc3REYXlPZldlZWsgLSBkICsgKGQgPiBmaXJzdERheU9mV2Vla09mWWVhciA/IDcgOiAwKSAtIChkIDwgZmlyc3REYXlPZldlZWsgPyA3IDogMCk7CiAgICAgICAgICBkYXlPZlllYXIgPSA3ICogKHdlZWsgLSAxKSArICh3ZWVrZGF5IC0gZmlyc3REYXlPZldlZWspICsgZGF5c1RvQWRkICsgMTsKCiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHllYXIgICAgICA6IGRheU9mWWVhciA+IDAgPyB5ZWFyICAgICAgOiB5ZWFyIC0gMSwKICAgICAgICAgICAgICBkYXlPZlllYXIgOiBkYXlPZlllYXIgPiAwID8gZGF5T2ZZZWFyIDogZGF5c0luWWVhcih5ZWFyIC0gMSkgKyBkYXlPZlllYXIKICAgICAgICAgIH07CiAgICAgIH0KCiAgICAgIC8vIE1PTUVOVFMKCiAgICAgIGZ1bmN0aW9uIGdldFNldERheU9mWWVhciAoaW5wdXQpIHsKICAgICAgICAgIHZhciBkYXlPZlllYXIgPSBNYXRoLnJvdW5kKCh0aGlzLmNsb25lKCkuc3RhcnRPZignZGF5JykgLSB0aGlzLmNsb25lKCkuc3RhcnRPZigneWVhcicpKSAvIDg2NGU1KSArIDE7CiAgICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IGRheU9mWWVhciA6IHRoaXMuYWRkKChpbnB1dCAtIGRheU9mWWVhciksICdkJyk7CiAgICAgIH0KCiAgICAgIC8vIFBpY2sgdGhlIGZpcnN0IGRlZmluZWQgb2YgdHdvIG9yIHRocmVlIGFyZ3VtZW50cy4KICAgICAgZnVuY3Rpb24gZGVmYXVsdHMoYSwgYiwgYykgewogICAgICAgICAgaWYgKGEgIT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBhOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGIgIT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBiOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGM7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGN1cnJlbnREYXRlQXJyYXkoY29uZmlnKSB7CiAgICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTsKICAgICAgICAgIGlmIChjb25maWcuX3VzZVVUQykgewogICAgICAgICAgICAgIHJldHVybiBbbm93LmdldFVUQ0Z1bGxZZWFyKCksIG5vdy5nZXRVVENNb250aCgpLCBub3cuZ2V0VVRDRGF0ZSgpXTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbbm93LmdldEZ1bGxZZWFyKCksIG5vdy5nZXRNb250aCgpLCBub3cuZ2V0RGF0ZSgpXTsKICAgICAgfQoKICAgICAgLy8gY29udmVydCBhbiBhcnJheSB0byBhIGRhdGUuCiAgICAgIC8vIHRoZSBhcnJheSBzaG91bGQgbWlycm9yIHRoZSBwYXJhbWV0ZXJzIGJlbG93CiAgICAgIC8vIG5vdGU6IGFsbCB2YWx1ZXMgcGFzdCB0aGUgeWVhciBhcmUgb3B0aW9uYWwgYW5kIHdpbGwgZGVmYXVsdCB0byB0aGUgbG93ZXN0IHBvc3NpYmxlIHZhbHVlLgogICAgICAvLyBbeWVhciwgbW9udGgsIGRheSAsIGhvdXIsIG1pbnV0ZSwgc2Vjb25kLCBtaWxsaXNlY29uZF0KICAgICAgZnVuY3Rpb24gY29uZmlnRnJvbUFycmF5IChjb25maWcpIHsKICAgICAgICAgIHZhciBpLCBkYXRlLCBpbnB1dCA9IFtdLCBjdXJyZW50RGF0ZSwgeWVhclRvVXNlOwoKICAgICAgICAgIGlmIChjb25maWcuX2QpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgY3VycmVudERhdGUgPSBjdXJyZW50RGF0ZUFycmF5KGNvbmZpZyk7CgogICAgICAgICAgLy9jb21wdXRlIGRheSBvZiB0aGUgeWVhciBmcm9tIHdlZWtzIGFuZCB3ZWVrZGF5cwogICAgICAgICAgaWYgKGNvbmZpZy5fdyAmJiBjb25maWcuX2FbREFURV0gPT0gbnVsbCAmJiBjb25maWcuX2FbTU9OVEhdID09IG51bGwpIHsKICAgICAgICAgICAgICBkYXlPZlllYXJGcm9tV2Vla0luZm8oY29uZmlnKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvL2lmIHRoZSBkYXkgb2YgdGhlIHllYXIgaXMgc2V0LCBmaWd1cmUgb3V0IHdoYXQgaXQgaXMKICAgICAgICAgIGlmIChjb25maWcuX2RheU9mWWVhcikgewogICAgICAgICAgICAgIHllYXJUb1VzZSA9IGRlZmF1bHRzKGNvbmZpZy5fYVtZRUFSXSwgY3VycmVudERhdGVbWUVBUl0pOwoKICAgICAgICAgICAgICBpZiAoY29uZmlnLl9kYXlPZlllYXIgPiBkYXlzSW5ZZWFyKHllYXJUb1VzZSkpIHsKICAgICAgICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuX292ZXJmbG93RGF5T2ZZZWFyID0gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGRhdGUgPSBjcmVhdGVVVENEYXRlKHllYXJUb1VzZSwgMCwgY29uZmlnLl9kYXlPZlllYXIpOwogICAgICAgICAgICAgIGNvbmZpZy5fYVtNT05USF0gPSBkYXRlLmdldFVUQ01vbnRoKCk7CiAgICAgICAgICAgICAgY29uZmlnLl9hW0RBVEVdID0gZGF0ZS5nZXRVVENEYXRlKCk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gRGVmYXVsdCB0byBjdXJyZW50IGRhdGUuCiAgICAgICAgICAvLyAqIGlmIG5vIHllYXIsIG1vbnRoLCBkYXkgb2YgbW9udGggYXJlIGdpdmVuLCBkZWZhdWx0IHRvIHRvZGF5CiAgICAgICAgICAvLyAqIGlmIGRheSBvZiBtb250aCBpcyBnaXZlbiwgZGVmYXVsdCBtb250aCBhbmQgeWVhcgogICAgICAgICAgLy8gKiBpZiBtb250aCBpcyBnaXZlbiwgZGVmYXVsdCBvbmx5IHllYXIKICAgICAgICAgIC8vICogaWYgeWVhciBpcyBnaXZlbiwgZG9uJ3QgZGVmYXVsdCBhbnl0aGluZwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IDMgJiYgY29uZmlnLl9hW2ldID09IG51bGw7ICsraSkgewogICAgICAgICAgICAgIGNvbmZpZy5fYVtpXSA9IGlucHV0W2ldID0gY3VycmVudERhdGVbaV07CiAgICAgICAgICB9CgogICAgICAgICAgLy8gWmVybyBvdXQgd2hhdGV2ZXIgd2FzIG5vdCBkZWZhdWx0ZWQsIGluY2x1ZGluZyB0aW1lCiAgICAgICAgICBmb3IgKDsgaSA8IDc7IGkrKykgewogICAgICAgICAgICAgIGNvbmZpZy5fYVtpXSA9IGlucHV0W2ldID0gKGNvbmZpZy5fYVtpXSA9PSBudWxsKSA/IChpID09PSAyID8gMSA6IDApIDogY29uZmlnLl9hW2ldOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIENoZWNrIGZvciAyNDowMDowMC4wMDAKICAgICAgICAgIGlmIChjb25maWcuX2FbSE9VUl0gPT09IDI0ICYmCiAgICAgICAgICAgICAgICAgIGNvbmZpZy5fYVtNSU5VVEVdID09PSAwICYmCiAgICAgICAgICAgICAgICAgIGNvbmZpZy5fYVtTRUNPTkRdID09PSAwICYmCiAgICAgICAgICAgICAgICAgIGNvbmZpZy5fYVtNSUxMSVNFQ09ORF0gPT09IDApIHsKICAgICAgICAgICAgICBjb25maWcuX25leHREYXkgPSB0cnVlOwogICAgICAgICAgICAgIGNvbmZpZy5fYVtIT1VSXSA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgY29uZmlnLl9kID0gKGNvbmZpZy5fdXNlVVRDID8gY3JlYXRlVVRDRGF0ZSA6IGNyZWF0ZURhdGUpLmFwcGx5KG51bGwsIGlucHV0KTsKICAgICAgICAgIC8vIEFwcGx5IHRpbWV6b25lIG9mZnNldCBmcm9tIGlucHV0LiBUaGUgYWN0dWFsIHV0Y09mZnNldCBjYW4gYmUgY2hhbmdlZAogICAgICAgICAgLy8gd2l0aCBwYXJzZVpvbmUuCiAgICAgICAgICBpZiAoY29uZmlnLl90em0gIT0gbnVsbCkgewogICAgICAgICAgICAgIGNvbmZpZy5fZC5zZXRVVENNaW51dGVzKGNvbmZpZy5fZC5nZXRVVENNaW51dGVzKCkgLSBjb25maWcuX3R6bSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNvbmZpZy5fbmV4dERheSkgewogICAgICAgICAgICAgIGNvbmZpZy5fYVtIT1VSXSA9IDI0OwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBkYXlPZlllYXJGcm9tV2Vla0luZm8oY29uZmlnKSB7CiAgICAgICAgICB2YXIgdywgd2Vla1llYXIsIHdlZWssIHdlZWtkYXksIGRvdywgZG95LCB0ZW1wOwoKICAgICAgICAgIHcgPSBjb25maWcuX3c7CiAgICAgICAgICBpZiAody5HRyAhPSBudWxsIHx8IHcuVyAhPSBudWxsIHx8IHcuRSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgZG93ID0gMTsKICAgICAgICAgICAgICBkb3kgPSA0OwoKICAgICAgICAgICAgICAvLyBUT0RPOiBXZSBuZWVkIHRvIHRha2UgdGhlIGN1cnJlbnQgaXNvV2Vla1llYXIsIGJ1dCB0aGF0IGRlcGVuZHMgb24KICAgICAgICAgICAgICAvLyBob3cgd2UgaW50ZXJwcmV0IG5vdyAobG9jYWwsIHV0YywgZml4ZWQgb2Zmc2V0KS4gU28gY3JlYXRlCiAgICAgICAgICAgICAgLy8gYSBub3cgdmVyc2lvbiBvZiBjdXJyZW50IGNvbmZpZyAodGFrZSBsb2NhbC91dGMvb2Zmc2V0IGZsYWdzLCBhbmQKICAgICAgICAgICAgICAvLyBjcmVhdGUgbm93KS4KICAgICAgICAgICAgICB3ZWVrWWVhciA9IGRlZmF1bHRzKHcuR0csIGNvbmZpZy5fYVtZRUFSXSwgd2Vla09mWWVhcihsb2NhbF9fY3JlYXRlTG9jYWwoKSwgMSwgNCkueWVhcik7CiAgICAgICAgICAgICAgd2VlayA9IGRlZmF1bHRzKHcuVywgMSk7CiAgICAgICAgICAgICAgd2Vla2RheSA9IGRlZmF1bHRzKHcuRSwgMSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGRvdyA9IGNvbmZpZy5fbG9jYWxlLl93ZWVrLmRvdzsKICAgICAgICAgICAgICBkb3kgPSBjb25maWcuX2xvY2FsZS5fd2Vlay5kb3k7CgogICAgICAgICAgICAgIHdlZWtZZWFyID0gZGVmYXVsdHMody5nZywgY29uZmlnLl9hW1lFQVJdLCB3ZWVrT2ZZZWFyKGxvY2FsX19jcmVhdGVMb2NhbCgpLCBkb3csIGRveSkueWVhcik7CiAgICAgICAgICAgICAgd2VlayA9IGRlZmF1bHRzKHcudywgMSk7CgogICAgICAgICAgICAgIGlmICh3LmQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAvLyB3ZWVrZGF5IC0tIGxvdyBkYXkgbnVtYmVycyBhcmUgY29uc2lkZXJlZCBuZXh0IHdlZWsKICAgICAgICAgICAgICAgICAgd2Vla2RheSA9IHcuZDsKICAgICAgICAgICAgICAgICAgaWYgKHdlZWtkYXkgPCBkb3cpIHsKICAgICAgICAgICAgICAgICAgICAgICsrd2VlazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAody5lICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgLy8gbG9jYWwgd2Vla2RheSAtLSBjb3VudGluZyBzdGFydHMgZnJvbSBiZWdpbmluZyBvZiB3ZWVrCiAgICAgICAgICAgICAgICAgIHdlZWtkYXkgPSB3LmUgKyBkb3c7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgLy8gZGVmYXVsdCB0byBiZWdpbmluZyBvZiB3ZWVrCiAgICAgICAgICAgICAgICAgIHdlZWtkYXkgPSBkb3c7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGVtcCA9IGRheU9mWWVhckZyb21XZWVrcyh3ZWVrWWVhciwgd2Vlaywgd2Vla2RheSwgZG95LCBkb3cpOwoKICAgICAgICAgIGNvbmZpZy5fYVtZRUFSXSA9IHRlbXAueWVhcjsKICAgICAgICAgIGNvbmZpZy5fZGF5T2ZZZWFyID0gdGVtcC5kYXlPZlllYXI7CiAgICAgIH0KCiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5JU09fODYwMSA9IGZ1bmN0aW9uICgpIHt9OwoKICAgICAgLy8gZGF0ZSBmcm9tIHN0cmluZyBhbmQgZm9ybWF0IHN0cmluZwogICAgICBmdW5jdGlvbiBjb25maWdGcm9tU3RyaW5nQW5kRm9ybWF0KGNvbmZpZykgewogICAgICAgICAgLy8gVE9ETzogTW92ZSB0aGlzIHRvIGFub3RoZXIgcGFydCBvZiB0aGUgY3JlYXRpb24gZmxvdyB0byBwcmV2ZW50IGNpcmN1bGFyIGRlcHMKICAgICAgICAgIGlmIChjb25maWcuX2YgPT09IHV0aWxzX2hvb2tzX19ob29rcy5JU09fODYwMSkgewogICAgICAgICAgICAgIGNvbmZpZ0Zyb21JU08oY29uZmlnKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgY29uZmlnLl9hID0gW107CiAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5lbXB0eSA9IHRydWU7CgogICAgICAgICAgLy8gVGhpcyBhcnJheSBpcyB1c2VkIHRvIG1ha2UgYSBEYXRlLCBlaXRoZXIgd2l0aCBgbmV3IERhdGVgIG9yIGBEYXRlLlVUQ2AKICAgICAgICAgIHZhciBzdHJpbmcgPSAnJyArIGNvbmZpZy5faSwKICAgICAgICAgICAgICBpLCBwYXJzZWRJbnB1dCwgdG9rZW5zLCB0b2tlbiwgc2tpcHBlZCwKICAgICAgICAgICAgICBzdHJpbmdMZW5ndGggPSBzdHJpbmcubGVuZ3RoLAogICAgICAgICAgICAgIHRvdGFsUGFyc2VkSW5wdXRMZW5ndGggPSAwOwoKICAgICAgICAgIHRva2VucyA9IGV4cGFuZEZvcm1hdChjb25maWcuX2YsIGNvbmZpZy5fbG9jYWxlKS5tYXRjaChmb3JtYXR0aW5nVG9rZW5zKSB8fCBbXTsKCiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgdG9rZW4gPSB0b2tlbnNbaV07CiAgICAgICAgICAgICAgcGFyc2VkSW5wdXQgPSAoc3RyaW5nLm1hdGNoKGdldFBhcnNlUmVnZXhGb3JUb2tlbih0b2tlbiwgY29uZmlnKSkgfHwgW10pWzBdOwogICAgICAgICAgICAgIGlmIChwYXJzZWRJbnB1dCkgewogICAgICAgICAgICAgICAgICBza2lwcGVkID0gc3RyaW5nLnN1YnN0cigwLCBzdHJpbmcuaW5kZXhPZihwYXJzZWRJbnB1dCkpOwogICAgICAgICAgICAgICAgICBpZiAoc2tpcHBlZC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS51bnVzZWRJbnB1dC5wdXNoKHNraXBwZWQpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5zbGljZShzdHJpbmcuaW5kZXhPZihwYXJzZWRJbnB1dCkgKyBwYXJzZWRJbnB1dC5sZW5ndGgpOwogICAgICAgICAgICAgICAgICB0b3RhbFBhcnNlZElucHV0TGVuZ3RoICs9IHBhcnNlZElucHV0Lmxlbmd0aDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy8gZG9uJ3QgcGFyc2UgaWYgaXQncyBub3QgYSBrbm93biB0b2tlbgogICAgICAgICAgICAgIGlmIChmb3JtYXRUb2tlbkZ1bmN0aW9uc1t0b2tlbl0pIHsKICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlZElucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5lbXB0eSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykudW51c2VkVG9rZW5zLnB1c2godG9rZW4pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGFkZFRpbWVUb0FycmF5RnJvbVRva2VuKHRva2VuLCBwYXJzZWRJbnB1dCwgY29uZmlnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnLl9zdHJpY3QgJiYgIXBhcnNlZElucHV0KSB7CiAgICAgICAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLnVudXNlZFRva2Vucy5wdXNoKHRva2VuKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gYWRkIHJlbWFpbmluZyB1bnBhcnNlZCBpbnB1dCBsZW5ndGggdG8gdGhlIHN0cmluZwogICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuY2hhcnNMZWZ0T3ZlciA9IHN0cmluZ0xlbmd0aCAtIHRvdGFsUGFyc2VkSW5wdXRMZW5ndGg7CiAgICAgICAgICBpZiAoc3RyaW5nLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS51bnVzZWRJbnB1dC5wdXNoKHN0cmluZyk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gY2xlYXIgXzEyaCBmbGFnIGlmIGhvdXIgaXMgPD0gMTIKICAgICAgICAgIGlmIChnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5iaWdIb3VyID09PSB0cnVlICYmCiAgICAgICAgICAgICAgICAgIGNvbmZpZy5fYVtIT1VSXSA8PSAxMiAmJgogICAgICAgICAgICAgICAgICBjb25maWcuX2FbSE9VUl0gPiAwKSB7CiAgICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuYmlnSG91ciA9IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGhhbmRsZSBtZXJpZGllbQogICAgICAgICAgY29uZmlnLl9hW0hPVVJdID0gbWVyaWRpZW1GaXhXcmFwKGNvbmZpZy5fbG9jYWxlLCBjb25maWcuX2FbSE9VUl0sIGNvbmZpZy5fbWVyaWRpZW0pOwoKICAgICAgICAgIGNvbmZpZ0Zyb21BcnJheShjb25maWcpOwogICAgICAgICAgY2hlY2tPdmVyZmxvdyhjb25maWcpOwogICAgICB9CgoKICAgICAgZnVuY3Rpb24gbWVyaWRpZW1GaXhXcmFwIChsb2NhbGUsIGhvdXIsIG1lcmlkaWVtKSB7CiAgICAgICAgICB2YXIgaXNQbTsKCiAgICAgICAgICBpZiAobWVyaWRpZW0gPT0gbnVsbCkgewogICAgICAgICAgICAgIC8vIG5vdGhpbmcgdG8gZG8KICAgICAgICAgICAgICByZXR1cm4gaG91cjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChsb2NhbGUubWVyaWRpZW1Ib3VyICE9IG51bGwpIHsKICAgICAgICAgICAgICByZXR1cm4gbG9jYWxlLm1lcmlkaWVtSG91cihob3VyLCBtZXJpZGllbSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGxvY2FsZS5pc1BNICE9IG51bGwpIHsKICAgICAgICAgICAgICAvLyBGYWxsYmFjawogICAgICAgICAgICAgIGlzUG0gPSBsb2NhbGUuaXNQTShtZXJpZGllbSk7CiAgICAgICAgICAgICAgaWYgKGlzUG0gJiYgaG91ciA8IDEyKSB7CiAgICAgICAgICAgICAgICAgIGhvdXIgKz0gMTI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICghaXNQbSAmJiBob3VyID09PSAxMikgewogICAgICAgICAgICAgICAgICBob3VyID0gMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGhvdXI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIHRoaXMgaXMgbm90IHN1cHBvc2VkIHRvIGhhcHBlbgogICAgICAgICAgICAgIHJldHVybiBob3VyOwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBjb25maWdGcm9tU3RyaW5nQW5kQXJyYXkoY29uZmlnKSB7CiAgICAgICAgICB2YXIgdGVtcENvbmZpZywKICAgICAgICAgICAgICBiZXN0TW9tZW50LAoKICAgICAgICAgICAgICBzY29yZVRvQmVhdCwKICAgICAgICAgICAgICBpLAogICAgICAgICAgICAgIGN1cnJlbnRTY29yZTsKCiAgICAgICAgICBpZiAoY29uZmlnLl9mLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmludmFsaWRGb3JtYXQgPSB0cnVlOwogICAgICAgICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKE5hTik7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb25maWcuX2YubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBjdXJyZW50U2NvcmUgPSAwOwogICAgICAgICAgICAgIHRlbXBDb25maWcgPSBjb3B5Q29uZmlnKHt9LCBjb25maWcpOwogICAgICAgICAgICAgIGlmIChjb25maWcuX3VzZVVUQyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIHRlbXBDb25maWcuX3VzZVVUQyA9IGNvbmZpZy5fdXNlVVRDOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0ZW1wQ29uZmlnLl9mID0gY29uZmlnLl9mW2ldOwogICAgICAgICAgICAgIGNvbmZpZ0Zyb21TdHJpbmdBbmRGb3JtYXQodGVtcENvbmZpZyk7CgogICAgICAgICAgICAgIGlmICghdmFsaWRfX2lzVmFsaWQodGVtcENvbmZpZykpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhbnkgaW5wdXQgdGhhdCB3YXMgbm90IHBhcnNlZCBhZGQgYSBwZW5hbHR5IGZvciB0aGF0IGZvcm1hdAogICAgICAgICAgICAgIGN1cnJlbnRTY29yZSArPSBnZXRQYXJzaW5nRmxhZ3ModGVtcENvbmZpZykuY2hhcnNMZWZ0T3ZlcjsKCiAgICAgICAgICAgICAgLy9vciB0b2tlbnMKICAgICAgICAgICAgICBjdXJyZW50U2NvcmUgKz0gZ2V0UGFyc2luZ0ZsYWdzKHRlbXBDb25maWcpLnVudXNlZFRva2Vucy5sZW5ndGggKiAxMDsKCiAgICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKHRlbXBDb25maWcpLnNjb3JlID0gY3VycmVudFNjb3JlOwoKICAgICAgICAgICAgICBpZiAoc2NvcmVUb0JlYXQgPT0gbnVsbCB8fCBjdXJyZW50U2NvcmUgPCBzY29yZVRvQmVhdCkgewogICAgICAgICAgICAgICAgICBzY29yZVRvQmVhdCA9IGN1cnJlbnRTY29yZTsKICAgICAgICAgICAgICAgICAgYmVzdE1vbWVudCA9IHRlbXBDb25maWc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGV4dGVuZChjb25maWcsIGJlc3RNb21lbnQgfHwgdGVtcENvbmZpZyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNvbmZpZ0Zyb21PYmplY3QoY29uZmlnKSB7CiAgICAgICAgICBpZiAoY29uZmlnLl9kKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpID0gbm9ybWFsaXplT2JqZWN0VW5pdHMoY29uZmlnLl9pKTsKICAgICAgICAgIGNvbmZpZy5fYSA9IFtpLnllYXIsIGkubW9udGgsIGkuZGF5IHx8IGkuZGF0ZSwgaS5ob3VyLCBpLm1pbnV0ZSwgaS5zZWNvbmQsIGkubWlsbGlzZWNvbmRdOwoKICAgICAgICAgIGNvbmZpZ0Zyb21BcnJheShjb25maWcpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjcmVhdGVGcm9tQ29uZmlnIChjb25maWcpIHsKICAgICAgICAgIHZhciBpbnB1dCA9IGNvbmZpZy5faSwKICAgICAgICAgICAgICBmb3JtYXQgPSBjb25maWcuX2YsCiAgICAgICAgICAgICAgcmVzOwoKICAgICAgICAgIGNvbmZpZy5fbG9jYWxlID0gY29uZmlnLl9sb2NhbGUgfHwgbG9jYWxlX2xvY2FsZXNfX2dldExvY2FsZShjb25maWcuX2wpOwoKICAgICAgICAgIGlmIChpbnB1dCA9PT0gbnVsbCB8fCAoZm9ybWF0ID09PSB1bmRlZmluZWQgJiYgaW5wdXQgPT09ICcnKSkgewogICAgICAgICAgICAgIHJldHVybiB2YWxpZF9fY3JlYXRlSW52YWxpZCh7bnVsbElucHV0OiB0cnVlfSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICBjb25maWcuX2kgPSBpbnB1dCA9IGNvbmZpZy5fbG9jYWxlLnByZXBhcnNlKGlucHV0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaXNNb21lbnQoaW5wdXQpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNb21lbnQoY2hlY2tPdmVyZmxvdyhpbnB1dCkpOwogICAgICAgICAgfSBlbHNlIGlmIChpc0FycmF5KGZvcm1hdCkpIHsKICAgICAgICAgICAgICBjb25maWdGcm9tU3RyaW5nQW5kQXJyYXkoY29uZmlnKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0KSB7CiAgICAgICAgICAgICAgY29uZmlnRnJvbVN0cmluZ0FuZEZvcm1hdChjb25maWcpOwogICAgICAgICAgfSBlbHNlIGlmIChpc0RhdGUoaW5wdXQpKSB7CiAgICAgICAgICAgICAgY29uZmlnLl9kID0gaW5wdXQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbmZpZ0Zyb21JbnB1dChjb25maWcpOwogICAgICAgICAgfQoKICAgICAgICAgIHJlcyA9IG5ldyBNb21lbnQoY2hlY2tPdmVyZmxvdyhjb25maWcpKTsKICAgICAgICAgIGlmIChyZXMuX25leHREYXkpIHsKICAgICAgICAgICAgICAvLyBBZGRpbmcgaXMgc21hcnQgZW5vdWdoIGFyb3VuZCBEU1QKICAgICAgICAgICAgICByZXMuYWRkKDEsICdkJyk7CiAgICAgICAgICAgICAgcmVzLl9uZXh0RGF5ID0gdW5kZWZpbmVkOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZXM7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNvbmZpZ0Zyb21JbnB1dChjb25maWcpIHsKICAgICAgICAgIHZhciBpbnB1dCA9IGNvbmZpZy5faTsKICAgICAgICAgIGlmIChpbnB1dCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUoKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaXNEYXRlKGlucHV0KSkgewogICAgICAgICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKCtpbnB1dCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICBjb25maWdGcm9tU3RyaW5nKGNvbmZpZyk7CiAgICAgICAgICB9IGVsc2UgaWYgKGlzQXJyYXkoaW5wdXQpKSB7CiAgICAgICAgICAgICAgY29uZmlnLl9hID0gbWFwKGlucHV0LnNsaWNlKDApLCBmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludChvYmosIDEwKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBjb25maWdGcm9tQXJyYXkoY29uZmlnKTsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGlucHV0KSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICBjb25maWdGcm9tT2JqZWN0KGNvbmZpZyk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZihpbnB1dCkgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgLy8gZnJvbSBtaWxsaXNlY29uZHMKICAgICAgICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZShpbnB1dCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5jcmVhdGVGcm9tSW5wdXRGYWxsYmFjayhjb25maWcpOwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBjcmVhdGVMb2NhbE9yVVRDIChpbnB1dCwgZm9ybWF0LCBsb2NhbGUsIHN0cmljdCwgaXNVVEMpIHsKICAgICAgICAgIHZhciBjID0ge307CgogICAgICAgICAgaWYgKHR5cGVvZihsb2NhbGUpID09PSAnYm9vbGVhbicpIHsKICAgICAgICAgICAgICBzdHJpY3QgPSBsb2NhbGU7CiAgICAgICAgICAgICAgbG9jYWxlID0gdW5kZWZpbmVkOwogICAgICAgICAgfQogICAgICAgICAgLy8gb2JqZWN0IGNvbnN0cnVjdGlvbiBtdXN0IGJlIGRvbmUgdGhpcyB3YXkuCiAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9pc3N1ZXMvMTQyMwogICAgICAgICAgYy5faXNBTW9tZW50T2JqZWN0ID0gdHJ1ZTsKICAgICAgICAgIGMuX3VzZVVUQyA9IGMuX2lzVVRDID0gaXNVVEM7CiAgICAgICAgICBjLl9sID0gbG9jYWxlOwogICAgICAgICAgYy5faSA9IGlucHV0OwogICAgICAgICAgYy5fZiA9IGZvcm1hdDsKICAgICAgICAgIGMuX3N0cmljdCA9IHN0cmljdDsKCiAgICAgICAgICByZXR1cm4gY3JlYXRlRnJvbUNvbmZpZyhjKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbG9jYWxfX2NyZWF0ZUxvY2FsIChpbnB1dCwgZm9ybWF0LCBsb2NhbGUsIHN0cmljdCkgewogICAgICAgICAgcmV0dXJuIGNyZWF0ZUxvY2FsT3JVVEMoaW5wdXQsIGZvcm1hdCwgbG9jYWxlLCBzdHJpY3QsIGZhbHNlKTsKICAgICAgfQoKICAgICAgdmFyIHByb3RvdHlwZU1pbiA9IGRlcHJlY2F0ZSgKICAgICAgICAgICAnbW9tZW50KCkubWluIGlzIGRlcHJlY2F0ZWQsIHVzZSBtb21lbnQubWluIGluc3RlYWQuIGh0dHBzOi8vZ2l0aHViLmNvbS9tb21lbnQvbW9tZW50L2lzc3Vlcy8xNTQ4JywKICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgIHZhciBvdGhlciA9IGxvY2FsX19jcmVhdGVMb2NhbC5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICByZXR1cm4gb3RoZXIgPCB0aGlzID8gdGhpcyA6IG90aGVyOwogICAgICAgICAgIH0KICAgICAgICk7CgogICAgICB2YXIgcHJvdG90eXBlTWF4ID0gZGVwcmVjYXRlKAogICAgICAgICAgJ21vbWVudCgpLm1heCBpcyBkZXByZWNhdGVkLCB1c2UgbW9tZW50Lm1heCBpbnN0ZWFkLiBodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9pc3N1ZXMvMTU0OCcsCiAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIG90aGVyID0gbG9jYWxfX2NyZWF0ZUxvY2FsLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgcmV0dXJuIG90aGVyID4gdGhpcyA/IHRoaXMgOiBvdGhlcjsKICAgICAgICAgIH0KICAgICAgKTsKCiAgICAgIC8vIFBpY2sgYSBtb21lbnQgbSBmcm9tIG1vbWVudHMgc28gdGhhdCBtW2ZuXShvdGhlcikgaXMgdHJ1ZSBmb3IgYWxsCiAgICAgIC8vIG90aGVyLiBUaGlzIHJlbGllcyBvbiB0aGUgZnVuY3Rpb24gZm4gdG8gYmUgdHJhbnNpdGl2ZS4KICAgICAgLy8KICAgICAgLy8gbW9tZW50cyBzaG91bGQgZWl0aGVyIGJlIGFuIGFycmF5IG9mIG1vbWVudCBvYmplY3RzIG9yIGFuIGFycmF5LCB3aG9zZQogICAgICAvLyBmaXJzdCBlbGVtZW50IGlzIGFuIGFycmF5IG9mIG1vbWVudCBvYmplY3RzLgogICAgICBmdW5jdGlvbiBwaWNrQnkoZm4sIG1vbWVudHMpIHsKICAgICAgICAgIHZhciByZXMsIGk7CiAgICAgICAgICBpZiAobW9tZW50cy5sZW5ndGggPT09IDEgJiYgaXNBcnJheShtb21lbnRzWzBdKSkgewogICAgICAgICAgICAgIG1vbWVudHMgPSBtb21lbnRzWzBdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFtb21lbnRzLmxlbmd0aCkgewogICAgICAgICAgICAgIHJldHVybiBsb2NhbF9fY3JlYXRlTG9jYWwoKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlcyA9IG1vbWVudHNbMF07CiAgICAgICAgICBmb3IgKGkgPSAxOyBpIDwgbW9tZW50cy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgIGlmIChtb21lbnRzW2ldW2ZuXShyZXMpKSB7CiAgICAgICAgICAgICAgICAgIHJlcyA9IG1vbWVudHNbaV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgfQoKICAgICAgLy8gVE9ETzogVXNlIFtdLnNvcnQgaW5zdGVhZD8KICAgICAgZnVuY3Rpb24gbWluICgpIHsKICAgICAgICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDApOwoKICAgICAgICAgIHJldHVybiBwaWNrQnkoJ2lzQmVmb3JlJywgYXJncyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG1heCAoKSB7CiAgICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKCiAgICAgICAgICByZXR1cm4gcGlja0J5KCdpc0FmdGVyJywgYXJncyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIER1cmF0aW9uIChkdXJhdGlvbikgewogICAgICAgICAgdmFyIG5vcm1hbGl6ZWRJbnB1dCA9IG5vcm1hbGl6ZU9iamVjdFVuaXRzKGR1cmF0aW9uKSwKICAgICAgICAgICAgICB5ZWFycyA9IG5vcm1hbGl6ZWRJbnB1dC55ZWFyIHx8IDAsCiAgICAgICAgICAgICAgcXVhcnRlcnMgPSBub3JtYWxpemVkSW5wdXQucXVhcnRlciB8fCAwLAogICAgICAgICAgICAgIG1vbnRocyA9IG5vcm1hbGl6ZWRJbnB1dC5tb250aCB8fCAwLAogICAgICAgICAgICAgIHdlZWtzID0gbm9ybWFsaXplZElucHV0LndlZWsgfHwgMCwKICAgICAgICAgICAgICBkYXlzID0gbm9ybWFsaXplZElucHV0LmRheSB8fCAwLAogICAgICAgICAgICAgIGhvdXJzID0gbm9ybWFsaXplZElucHV0LmhvdXIgfHwgMCwKICAgICAgICAgICAgICBtaW51dGVzID0gbm9ybWFsaXplZElucHV0Lm1pbnV0ZSB8fCAwLAogICAgICAgICAgICAgIHNlY29uZHMgPSBub3JtYWxpemVkSW5wdXQuc2Vjb25kIHx8IDAsCiAgICAgICAgICAgICAgbWlsbGlzZWNvbmRzID0gbm9ybWFsaXplZElucHV0Lm1pbGxpc2Vjb25kIHx8IDA7CgogICAgICAgICAgLy8gcmVwcmVzZW50YXRpb24gZm9yIGRhdGVBZGRSZW1vdmUKICAgICAgICAgIHRoaXMuX21pbGxpc2Vjb25kcyA9ICttaWxsaXNlY29uZHMgKwogICAgICAgICAgICAgIHNlY29uZHMgKiAxZTMgKyAvLyAxMDAwCiAgICAgICAgICAgICAgbWludXRlcyAqIDZlNCArIC8vIDEwMDAgKiA2MAogICAgICAgICAgICAgIGhvdXJzICogMzZlNTsgLy8gMTAwMCAqIDYwICogNjAKICAgICAgICAgIC8vIEJlY2F1c2Ugb2YgZGF0ZUFkZFJlbW92ZSB0cmVhdHMgMjQgaG91cnMgYXMgZGlmZmVyZW50IGZyb20gYQogICAgICAgICAgLy8gZGF5IHdoZW4gd29ya2luZyBhcm91bmQgRFNULCB3ZSBuZWVkIHRvIHN0b3JlIHRoZW0gc2VwYXJhdGVseQogICAgICAgICAgdGhpcy5fZGF5cyA9ICtkYXlzICsKICAgICAgICAgICAgICB3ZWVrcyAqIDc7CiAgICAgICAgICAvLyBJdCBpcyBpbXBvc3NpYmxlIHRyYW5zbGF0ZSBtb250aHMgaW50byBkYXlzIHdpdGhvdXQga25vd2luZwogICAgICAgICAgLy8gd2hpY2ggbW9udGhzIHlvdSBhcmUgYXJlIHRhbGtpbmcgYWJvdXQsIHNvIHdlIGhhdmUgdG8gc3RvcmUKICAgICAgICAgIC8vIGl0IHNlcGFyYXRlbHkuCiAgICAgICAgICB0aGlzLl9tb250aHMgPSArbW9udGhzICsKICAgICAgICAgICAgICBxdWFydGVycyAqIDMgKwogICAgICAgICAgICAgIHllYXJzICogMTI7CgogICAgICAgICAgdGhpcy5fZGF0YSA9IHt9OwoKICAgICAgICAgIHRoaXMuX2xvY2FsZSA9IGxvY2FsZV9sb2NhbGVzX19nZXRMb2NhbGUoKTsKCiAgICAgICAgICB0aGlzLl9idWJibGUoKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaXNEdXJhdGlvbiAob2JqKSB7CiAgICAgICAgICByZXR1cm4gb2JqIGluc3RhbmNlb2YgRHVyYXRpb247CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG9mZnNldCAodG9rZW4sIHNlcGFyYXRvcikgewogICAgICAgICAgYWRkRm9ybWF0VG9rZW4odG9rZW4sIDAsIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgb2Zmc2V0ID0gdGhpcy51dGNPZmZzZXQoKTsKICAgICAgICAgICAgICB2YXIgc2lnbiA9ICcrJzsKICAgICAgICAgICAgICBpZiAob2Zmc2V0IDwgMCkgewogICAgICAgICAgICAgICAgICBvZmZzZXQgPSAtb2Zmc2V0OwogICAgICAgICAgICAgICAgICBzaWduID0gJy0nOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gc2lnbiArIHplcm9GaWxsKH5+KG9mZnNldCAvIDYwKSwgMikgKyBzZXBhcmF0b3IgKyB6ZXJvRmlsbCh+fihvZmZzZXQpICUgNjAsIDIpOwogICAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIG9mZnNldCgnWicsICc6Jyk7CiAgICAgIG9mZnNldCgnWlonLCAnJyk7CgogICAgICAvLyBQQVJTSU5HCgogICAgICBhZGRSZWdleFRva2VuKCdaJywgIG1hdGNoT2Zmc2V0KTsKICAgICAgYWRkUmVnZXhUb2tlbignWlonLCBtYXRjaE9mZnNldCk7CiAgICAgIGFkZFBhcnNlVG9rZW4oWydaJywgJ1paJ10sIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykgewogICAgICAgICAgY29uZmlnLl91c2VVVEMgPSB0cnVlOwogICAgICAgICAgY29uZmlnLl90em0gPSBvZmZzZXRGcm9tU3RyaW5nKGlucHV0KTsKICAgICAgfSk7CgogICAgICAvLyBIRUxQRVJTCgogICAgICAvLyB0aW1lem9uZSBjaHVua2VyCiAgICAgIC8vICcrMTA6MDAnID4gWycxMCcsICAnMDAnXQogICAgICAvLyAnLTE1MzAnICA+IFsnLTE1JywgJzMwJ10KICAgICAgdmFyIGNodW5rT2Zmc2V0ID0gLyhbXCtcLV18XGRcZCkvZ2k7CgogICAgICBmdW5jdGlvbiBvZmZzZXRGcm9tU3RyaW5nKHN0cmluZykgewogICAgICAgICAgdmFyIG1hdGNoZXMgPSAoKHN0cmluZyB8fCAnJykubWF0Y2gobWF0Y2hPZmZzZXQpIHx8IFtdKTsKICAgICAgICAgIHZhciBjaHVuayAgID0gbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdIHx8IFtdOwogICAgICAgICAgdmFyIHBhcnRzICAgPSAoY2h1bmsgKyAnJykubWF0Y2goY2h1bmtPZmZzZXQpIHx8IFsnLScsIDAsIDBdOwogICAgICAgICAgdmFyIG1pbnV0ZXMgPSArKHBhcnRzWzFdICogNjApICsgdG9JbnQocGFydHNbMl0pOwoKICAgICAgICAgIHJldHVybiBwYXJ0c1swXSA9PT0gJysnID8gbWludXRlcyA6IC1taW51dGVzOwogICAgICB9CgogICAgICAvLyBSZXR1cm4gYSBtb21lbnQgZnJvbSBpbnB1dCwgdGhhdCBpcyBsb2NhbC91dGMvem9uZSBlcXVpdmFsZW50IHRvIG1vZGVsLgogICAgICBmdW5jdGlvbiBjbG9uZVdpdGhPZmZzZXQoaW5wdXQsIG1vZGVsKSB7CiAgICAgICAgICB2YXIgcmVzLCBkaWZmOwogICAgICAgICAgaWYgKG1vZGVsLl9pc1VUQykgewogICAgICAgICAgICAgIHJlcyA9IG1vZGVsLmNsb25lKCk7CiAgICAgICAgICAgICAgZGlmZiA9IChpc01vbWVudChpbnB1dCkgfHwgaXNEYXRlKGlucHV0KSA/ICtpbnB1dCA6ICtsb2NhbF9fY3JlYXRlTG9jYWwoaW5wdXQpKSAtICgrcmVzKTsKICAgICAgICAgICAgICAvLyBVc2UgbG93LWxldmVsIGFwaSwgYmVjYXVzZSB0aGlzIGZuIGlzIGxvdy1sZXZlbCBhcGkuCiAgICAgICAgICAgICAgcmVzLl9kLnNldFRpbWUoK3Jlcy5fZCArIGRpZmYpOwogICAgICAgICAgICAgIHV0aWxzX2hvb2tzX19ob29rcy51cGRhdGVPZmZzZXQocmVzLCBmYWxzZSk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIGxvY2FsX19jcmVhdGVMb2NhbChpbnB1dCkubG9jYWwoKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBtb2RlbC5faXNVVEMgPyBsb2NhbF9fY3JlYXRlTG9jYWwoaW5wdXQpLnpvbmUobW9kZWwuX29mZnNldCB8fCAwKSA6IGxvY2FsX19jcmVhdGVMb2NhbChpbnB1dCkubG9jYWwoKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0RGF0ZU9mZnNldCAobSkgewogICAgICAgICAgLy8gT24gRmlyZWZveC4yNCBEYXRlI2dldFRpbWV6b25lT2Zmc2V0IHJldHVybnMgYSBmbG9hdGluZyBwb2ludC4KICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tb21lbnQvbW9tZW50L3B1bGwvMTg3MQogICAgICAgICAgcmV0dXJuIC1NYXRoLnJvdW5kKG0uX2QuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDE1KSAqIDE1OwogICAgICB9CgogICAgICAvLyBIT09LUwoKICAgICAgLy8gVGhpcyBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCB3aGVuZXZlciBhIG1vbWVudCBpcyBtdXRhdGVkLgogICAgICAvLyBJdCBpcyBpbnRlbmRlZCB0byBrZWVwIHRoZSBvZmZzZXQgaW4gc3luYyB3aXRoIHRoZSB0aW1lem9uZS4KICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLnVwZGF0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHt9OwoKICAgICAgLy8gTU9NRU5UUwoKICAgICAgLy8ga2VlcExvY2FsVGltZSA9IHRydWUgbWVhbnMgb25seSBjaGFuZ2UgdGhlIHRpbWV6b25lLCB3aXRob3V0CiAgICAgIC8vIGFmZmVjdGluZyB0aGUgbG9jYWwgaG91ci4gU28gNTozMToyNiArMDMwMCAtLVt1dGNPZmZzZXQoMiwgdHJ1ZSldLS0+CiAgICAgIC8vIDU6MzE6MjYgKzAyMDAgSXQgaXMgcG9zc2libGUgdGhhdCA1OjMxOjI2IGRvZXNuJ3QgZXhpc3Qgd2l0aCBvZmZzZXQKICAgICAgLy8gKzAyMDAsIHNvIHdlIGFkanVzdCB0aGUgdGltZSBhcyBuZWVkZWQsIHRvIGJlIHZhbGlkLgogICAgICAvLwogICAgICAvLyBLZWVwaW5nIHRoZSB0aW1lIGFjdHVhbGx5IGFkZHMvc3VidHJhY3RzIChvbmUgaG91cikKICAgICAgLy8gZnJvbSB0aGUgYWN0dWFsIHJlcHJlc2VudGVkIHRpbWUuIFRoYXQgaXMgd2h5IHdlIGNhbGwgdXBkYXRlT2Zmc2V0CiAgICAgIC8vIGEgc2Vjb25kIHRpbWUuIEluIGNhc2UgaXQgd2FudHMgdXMgdG8gY2hhbmdlIHRoZSBvZmZzZXQgYWdhaW4KICAgICAgLy8gX2NoYW5nZUluUHJvZ3Jlc3MgPT0gdHJ1ZSBjYXNlLCB0aGVuIHdlIGhhdmUgdG8gYWRqdXN0LCBiZWNhdXNlCiAgICAgIC8vIHRoZXJlIGlzIG5vIHN1Y2ggdGltZSBpbiB0aGUgZ2l2ZW4gdGltZXpvbmUuCiAgICAgIGZ1bmN0aW9uIGdldFNldE9mZnNldCAoaW5wdXQsIGtlZXBMb2NhbFRpbWUpIHsKICAgICAgICAgIHZhciBvZmZzZXQgPSB0aGlzLl9vZmZzZXQgfHwgMCwKICAgICAgICAgICAgICBsb2NhbEFkanVzdDsKICAgICAgICAgIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgaW5wdXQgPSBvZmZzZXRGcm9tU3RyaW5nKGlucHV0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKGlucHV0KSA8IDE2KSB7CiAgICAgICAgICAgICAgICAgIGlucHV0ID0gaW5wdXQgKiA2MDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc1VUQyAmJiBrZWVwTG9jYWxUaW1lKSB7CiAgICAgICAgICAgICAgICAgIGxvY2FsQWRqdXN0ID0gZ2V0RGF0ZU9mZnNldCh0aGlzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5fb2Zmc2V0ID0gaW5wdXQ7CiAgICAgICAgICAgICAgdGhpcy5faXNVVEMgPSB0cnVlOwogICAgICAgICAgICAgIGlmIChsb2NhbEFkanVzdCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuYWRkKGxvY2FsQWRqdXN0LCAnbScpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAob2Zmc2V0ICE9PSBpbnB1dCkgewogICAgICAgICAgICAgICAgICBpZiAoIWtlZXBMb2NhbFRpbWUgfHwgdGhpcy5fY2hhbmdlSW5Qcm9ncmVzcykgewogICAgICAgICAgICAgICAgICAgICAgYWRkX3N1YnRyYWN0X19hZGRTdWJ0cmFjdCh0aGlzLCBjcmVhdGVfX2NyZWF0ZUR1cmF0aW9uKGlucHV0IC0gb2Zmc2V0LCAnbScpLCAxLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLnVwZGF0ZU9mZnNldCh0aGlzLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MgPSBudWxsOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNVVEMgPyBvZmZzZXQgOiBnZXREYXRlT2Zmc2V0KHRoaXMpOwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXRTZXRab25lIChpbnB1dCwga2VlcExvY2FsVGltZSkgewogICAgICAgICAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGlucHV0ICE9PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICBpbnB1dCA9IC1pbnB1dDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMudXRjT2Zmc2V0KGlucHV0LCBrZWVwTG9jYWxUaW1lKTsKCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiAtdGhpcy51dGNPZmZzZXQoKTsKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gc2V0T2Zmc2V0VG9VVEMgKGtlZXBMb2NhbFRpbWUpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnV0Y09mZnNldCgwLCBrZWVwTG9jYWxUaW1lKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gc2V0T2Zmc2V0VG9Mb2NhbCAoa2VlcExvY2FsVGltZSkgewogICAgICAgICAgaWYgKHRoaXMuX2lzVVRDKSB7CiAgICAgICAgICAgICAgdGhpcy51dGNPZmZzZXQoMCwga2VlcExvY2FsVGltZSk7CiAgICAgICAgICAgICAgdGhpcy5faXNVVEMgPSBmYWxzZTsKCiAgICAgICAgICAgICAgaWYgKGtlZXBMb2NhbFRpbWUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zdWJ0cmFjdChnZXREYXRlT2Zmc2V0KHRoaXMpLCAnbScpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzZXRPZmZzZXRUb1BhcnNlZE9mZnNldCAoKSB7CiAgICAgICAgICBpZiAodGhpcy5fdHptKSB7CiAgICAgICAgICAgICAgdGhpcy51dGNPZmZzZXQodGhpcy5fdHptKTsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoaXMuX2kgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgdGhpcy51dGNPZmZzZXQob2Zmc2V0RnJvbVN0cmluZyh0aGlzLl9pKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaGFzQWxpZ25lZEhvdXJPZmZzZXQgKGlucHV0KSB7CiAgICAgICAgICBpZiAoIWlucHV0KSB7CiAgICAgICAgICAgICAgaW5wdXQgPSAwOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgaW5wdXQgPSBsb2NhbF9fY3JlYXRlTG9jYWwoaW5wdXQpLnV0Y09mZnNldCgpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAodGhpcy51dGNPZmZzZXQoKSAtIGlucHV0KSAlIDYwID09PSAwOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc0RheWxpZ2h0U2F2aW5nVGltZSAoKSB7CiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgIHRoaXMudXRjT2Zmc2V0KCkgPiB0aGlzLmNsb25lKCkubW9udGgoMCkudXRjT2Zmc2V0KCkgfHwKICAgICAgICAgICAgICB0aGlzLnV0Y09mZnNldCgpID4gdGhpcy5jbG9uZSgpLm1vbnRoKDUpLnV0Y09mZnNldCgpCiAgICAgICAgICApOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc0RheWxpZ2h0U2F2aW5nVGltZVNoaWZ0ZWQgKCkgewogICAgICAgICAgaWYgKHRoaXMuX2EpIHsKICAgICAgICAgICAgICB2YXIgb3RoZXIgPSB0aGlzLl9pc1VUQyA/IGNyZWF0ZV91dGNfX2NyZWF0ZVVUQyh0aGlzLl9hKSA6IGxvY2FsX19jcmVhdGVMb2NhbCh0aGlzLl9hKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc1ZhbGlkKCkgJiYgY29tcGFyZUFycmF5cyh0aGlzLl9hLCBvdGhlci50b0FycmF5KCkpID4gMDsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGlzTG9jYWwgKCkgewogICAgICAgICAgcmV0dXJuICF0aGlzLl9pc1VUQzsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaXNVdGNPZmZzZXQgKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVVRDOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc1V0YyAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faXNVVEMgJiYgdGhpcy5fb2Zmc2V0ID09PSAwOwogICAgICB9CgogICAgICB2YXIgYXNwTmV0UmVnZXggPSAvKFwtKT8oPzooXGQqKVwuKT8oXGQrKVw6KFxkKykoPzpcOihcZCspXC4/KFxkezN9KT8pPy87CgogICAgICAvLyBmcm9tIGh0dHA6Ly9kb2NzLmNsb3N1cmUtbGlicmFyeS5nb29nbGVjb2RlLmNvbS9naXQvY2xvc3VyZV9nb29nX2RhdGVfZGF0ZS5qcy5zb3VyY2UuaHRtbAogICAgICAvLyBzb21ld2hhdCBtb3JlIGluIGxpbmUgd2l0aCA0LjQuMy4yIDIwMDQgc3BlYywgYnV0IGFsbG93cyBkZWNpbWFsIGFueXdoZXJlCiAgICAgIHZhciBjcmVhdGVfX2lzb1JlZ2V4ID0gL14oLSk/UCg/Oig/OihbMC05LC5dKilZKT8oPzooWzAtOSwuXSopTSk/KD86KFswLTksLl0qKUQpPyg/OlQoPzooWzAtOSwuXSopSCk/KD86KFswLTksLl0qKU0pPyg/OihbMC05LC5dKilTKT8pP3woWzAtOSwuXSopVykkLzsKCiAgICAgIGZ1bmN0aW9uIGNyZWF0ZV9fY3JlYXRlRHVyYXRpb24gKGlucHV0LCBrZXkpIHsKICAgICAgICAgIHZhciBkdXJhdGlvbiA9IGlucHV0LAogICAgICAgICAgICAgIC8vIG1hdGNoaW5nIGFnYWluc3QgcmVnZXhwIGlzIGV4cGVuc2l2ZSwgZG8gaXQgb24gZGVtYW5kCiAgICAgICAgICAgICAgbWF0Y2ggPSBudWxsLAogICAgICAgICAgICAgIHNpZ24sCiAgICAgICAgICAgICAgcmV0LAogICAgICAgICAgICAgIGRpZmZSZXM7CgogICAgICAgICAgaWYgKGlzRHVyYXRpb24oaW5wdXQpKSB7CiAgICAgICAgICAgICAgZHVyYXRpb24gPSB7CiAgICAgICAgICAgICAgICAgIG1zIDogaW5wdXQuX21pbGxpc2Vjb25kcywKICAgICAgICAgICAgICAgICAgZCAgOiBpbnB1dC5fZGF5cywKICAgICAgICAgICAgICAgICAgTSAgOiBpbnB1dC5fbW9udGhzCiAgICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGlucHV0ID09PSAnbnVtYmVyJykgewogICAgICAgICAgICAgIGR1cmF0aW9uID0ge307CiAgICAgICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICAgICAgICBkdXJhdGlvbltrZXldID0gaW5wdXQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZHVyYXRpb24ubWlsbGlzZWNvbmRzID0gaW5wdXQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICghIShtYXRjaCA9IGFzcE5ldFJlZ2V4LmV4ZWMoaW5wdXQpKSkgewogICAgICAgICAgICAgIHNpZ24gPSAobWF0Y2hbMV0gPT09ICctJykgPyAtMSA6IDE7CiAgICAgICAgICAgICAgZHVyYXRpb24gPSB7CiAgICAgICAgICAgICAgICAgIHkgIDogMCwKICAgICAgICAgICAgICAgICAgZCAgOiB0b0ludChtYXRjaFtEQVRFXSkgICAgICAgICogc2lnbiwKICAgICAgICAgICAgICAgICAgaCAgOiB0b0ludChtYXRjaFtIT1VSXSkgICAgICAgICogc2lnbiwKICAgICAgICAgICAgICAgICAgbSAgOiB0b0ludChtYXRjaFtNSU5VVEVdKSAgICAgICogc2lnbiwKICAgICAgICAgICAgICAgICAgcyAgOiB0b0ludChtYXRjaFtTRUNPTkRdKSAgICAgICogc2lnbiwKICAgICAgICAgICAgICAgICAgbXMgOiB0b0ludChtYXRjaFtNSUxMSVNFQ09ORF0pICogc2lnbgogICAgICAgICAgICAgIH07CiAgICAgICAgICB9IGVsc2UgaWYgKCEhKG1hdGNoID0gY3JlYXRlX19pc29SZWdleC5leGVjKGlucHV0KSkpIHsKICAgICAgICAgICAgICBzaWduID0gKG1hdGNoWzFdID09PSAnLScpID8gLTEgOiAxOwogICAgICAgICAgICAgIGR1cmF0aW9uID0gewogICAgICAgICAgICAgICAgICB5IDogcGFyc2VJc28obWF0Y2hbMl0sIHNpZ24pLAogICAgICAgICAgICAgICAgICBNIDogcGFyc2VJc28obWF0Y2hbM10sIHNpZ24pLAogICAgICAgICAgICAgICAgICBkIDogcGFyc2VJc28obWF0Y2hbNF0sIHNpZ24pLAogICAgICAgICAgICAgICAgICBoIDogcGFyc2VJc28obWF0Y2hbNV0sIHNpZ24pLAogICAgICAgICAgICAgICAgICBtIDogcGFyc2VJc28obWF0Y2hbNl0sIHNpZ24pLAogICAgICAgICAgICAgICAgICBzIDogcGFyc2VJc28obWF0Y2hbN10sIHNpZ24pLAogICAgICAgICAgICAgICAgICB3IDogcGFyc2VJc28obWF0Y2hbOF0sIHNpZ24pCiAgICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSBpZiAoZHVyYXRpb24gPT0gbnVsbCkgey8vIGNoZWNrcyBmb3IgbnVsbCBvciB1bmRlZmluZWQKICAgICAgICAgICAgICBkdXJhdGlvbiA9IHt9OwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZHVyYXRpb24gPT09ICdvYmplY3QnICYmICgnZnJvbScgaW4gZHVyYXRpb24gfHwgJ3RvJyBpbiBkdXJhdGlvbikpIHsKICAgICAgICAgICAgICBkaWZmUmVzID0gbW9tZW50c0RpZmZlcmVuY2UobG9jYWxfX2NyZWF0ZUxvY2FsKGR1cmF0aW9uLmZyb20pLCBsb2NhbF9fY3JlYXRlTG9jYWwoZHVyYXRpb24udG8pKTsKCiAgICAgICAgICAgICAgZHVyYXRpb24gPSB7fTsKICAgICAgICAgICAgICBkdXJhdGlvbi5tcyA9IGRpZmZSZXMubWlsbGlzZWNvbmRzOwogICAgICAgICAgICAgIGR1cmF0aW9uLk0gPSBkaWZmUmVzLm1vbnRoczsKICAgICAgICAgIH0KCiAgICAgICAgICByZXQgPSBuZXcgRHVyYXRpb24oZHVyYXRpb24pOwoKICAgICAgICAgIGlmIChpc0R1cmF0aW9uKGlucHV0KSAmJiBoYXNPd25Qcm9wKGlucHV0LCAnX2xvY2FsZScpKSB7CiAgICAgICAgICAgICAgcmV0Ll9sb2NhbGUgPSBpbnB1dC5fbG9jYWxlOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgIH0KCiAgICAgIGNyZWF0ZV9fY3JlYXRlRHVyYXRpb24uZm4gPSBEdXJhdGlvbi5wcm90b3R5cGU7CgogICAgICBmdW5jdGlvbiBwYXJzZUlzbyAoaW5wLCBzaWduKSB7CiAgICAgICAgICAvLyBXZSdkIG5vcm1hbGx5IHVzZSB+fmlucCBmb3IgdGhpcywgYnV0IHVuZm9ydHVuYXRlbHkgaXQgYWxzbwogICAgICAgICAgLy8gY29udmVydHMgZmxvYXRzIHRvIGludHMuCiAgICAgICAgICAvLyBpbnAgbWF5IGJlIHVuZGVmaW5lZCwgc28gY2FyZWZ1bCBjYWxsaW5nIHJlcGxhY2Ugb24gaXQuCiAgICAgICAgICB2YXIgcmVzID0gaW5wICYmIHBhcnNlRmxvYXQoaW5wLnJlcGxhY2UoJywnLCAnLicpKTsKICAgICAgICAgIC8vIGFwcGx5IHNpZ24gd2hpbGUgd2UncmUgYXQgaXQKICAgICAgICAgIHJldHVybiAoaXNOYU4ocmVzKSA/IDAgOiByZXMpICogc2lnbjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcG9zaXRpdmVNb21lbnRzRGlmZmVyZW5jZShiYXNlLCBvdGhlcikgewogICAgICAgICAgdmFyIHJlcyA9IHttaWxsaXNlY29uZHM6IDAsIG1vbnRoczogMH07CgogICAgICAgICAgcmVzLm1vbnRocyA9IG90aGVyLm1vbnRoKCkgLSBiYXNlLm1vbnRoKCkgKwogICAgICAgICAgICAgIChvdGhlci55ZWFyKCkgLSBiYXNlLnllYXIoKSkgKiAxMjsKICAgICAgICAgIGlmIChiYXNlLmNsb25lKCkuYWRkKHJlcy5tb250aHMsICdNJykuaXNBZnRlcihvdGhlcikpIHsKICAgICAgICAgICAgICAtLXJlcy5tb250aHM7CiAgICAgICAgICB9CgogICAgICAgICAgcmVzLm1pbGxpc2Vjb25kcyA9ICtvdGhlciAtICsoYmFzZS5jbG9uZSgpLmFkZChyZXMubW9udGhzLCAnTScpKTsKCiAgICAgICAgICByZXR1cm4gcmVzOwogICAgICB9CgogICAgICBmdW5jdGlvbiBtb21lbnRzRGlmZmVyZW5jZShiYXNlLCBvdGhlcikgewogICAgICAgICAgdmFyIHJlczsKICAgICAgICAgIG90aGVyID0gY2xvbmVXaXRoT2Zmc2V0KG90aGVyLCBiYXNlKTsKICAgICAgICAgIGlmIChiYXNlLmlzQmVmb3JlKG90aGVyKSkgewogICAgICAgICAgICAgIHJlcyA9IHBvc2l0aXZlTW9tZW50c0RpZmZlcmVuY2UoYmFzZSwgb3RoZXIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXMgPSBwb3NpdGl2ZU1vbWVudHNEaWZmZXJlbmNlKG90aGVyLCBiYXNlKTsKICAgICAgICAgICAgICByZXMubWlsbGlzZWNvbmRzID0gLXJlcy5taWxsaXNlY29uZHM7CiAgICAgICAgICAgICAgcmVzLm1vbnRocyA9IC1yZXMubW9udGhzOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZXM7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNyZWF0ZUFkZGVyKGRpcmVjdGlvbiwgbmFtZSkgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWwsIHBlcmlvZCkgewogICAgICAgICAgICAgIHZhciBkdXIsIHRtcDsKICAgICAgICAgICAgICAvL2ludmVydCB0aGUgYXJndW1lbnRzLCBidXQgY29tcGxhaW4gYWJvdXQgaXQKICAgICAgICAgICAgICBpZiAocGVyaW9kICE9PSBudWxsICYmICFpc05hTigrcGVyaW9kKSkgewogICAgICAgICAgICAgICAgICBkZXByZWNhdGVTaW1wbGUobmFtZSwgJ21vbWVudCgpLicgKyBuYW1lICArICcocGVyaW9kLCBudW1iZXIpIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgbW9tZW50KCkuJyArIG5hbWUgKyAnKG51bWJlciwgcGVyaW9kKS4nKTsKICAgICAgICAgICAgICAgICAgdG1wID0gdmFsOyB2YWwgPSBwZXJpb2Q7IHBlcmlvZCA9IHRtcDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnID8gK3ZhbCA6IHZhbDsKICAgICAgICAgICAgICBkdXIgPSBjcmVhdGVfX2NyZWF0ZUR1cmF0aW9uKHZhbCwgcGVyaW9kKTsKICAgICAgICAgICAgICBhZGRfc3VidHJhY3RfX2FkZFN1YnRyYWN0KHRoaXMsIGR1ciwgZGlyZWN0aW9uKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFkZF9zdWJ0cmFjdF9fYWRkU3VidHJhY3QgKG1vbSwgZHVyYXRpb24sIGlzQWRkaW5nLCB1cGRhdGVPZmZzZXQpIHsKICAgICAgICAgIHZhciBtaWxsaXNlY29uZHMgPSBkdXJhdGlvbi5fbWlsbGlzZWNvbmRzLAogICAgICAgICAgICAgIGRheXMgPSBkdXJhdGlvbi5fZGF5cywKICAgICAgICAgICAgICBtb250aHMgPSBkdXJhdGlvbi5fbW9udGhzOwogICAgICAgICAgdXBkYXRlT2Zmc2V0ID0gdXBkYXRlT2Zmc2V0ID09IG51bGwgPyB0cnVlIDogdXBkYXRlT2Zmc2V0OwoKICAgICAgICAgIGlmIChtaWxsaXNlY29uZHMpIHsKICAgICAgICAgICAgICBtb20uX2Quc2V0VGltZSgrbW9tLl9kICsgbWlsbGlzZWNvbmRzICogaXNBZGRpbmcpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGRheXMpIHsKICAgICAgICAgICAgICBnZXRfc2V0X19zZXQobW9tLCAnRGF0ZScsIGdldF9zZXRfX2dldChtb20sICdEYXRlJykgKyBkYXlzICogaXNBZGRpbmcpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG1vbnRocykgewogICAgICAgICAgICAgIHNldE1vbnRoKG1vbSwgZ2V0X3NldF9fZ2V0KG1vbSwgJ01vbnRoJykgKyBtb250aHMgKiBpc0FkZGluZyk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodXBkYXRlT2Zmc2V0KSB7CiAgICAgICAgICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLnVwZGF0ZU9mZnNldChtb20sIGRheXMgfHwgbW9udGhzKTsKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGFkZF9zdWJ0cmFjdF9fYWRkICAgICAgPSBjcmVhdGVBZGRlcigxLCAnYWRkJyk7CiAgICAgIHZhciBhZGRfc3VidHJhY3RfX3N1YnRyYWN0ID0gY3JlYXRlQWRkZXIoLTEsICdzdWJ0cmFjdCcpOwoKICAgICAgZnVuY3Rpb24gbW9tZW50X2NhbGVuZGFyX19jYWxlbmRhciAodGltZSkgewogICAgICAgICAgLy8gV2Ugd2FudCB0byBjb21wYXJlIHRoZSBzdGFydCBvZiB0b2RheSwgdnMgdGhpcy4KICAgICAgICAgIC8vIEdldHRpbmcgc3RhcnQtb2YtdG9kYXkgZGVwZW5kcyBvbiB3aGV0aGVyIHdlJ3JlIGxvY2FsL3V0Yy9vZmZzZXQgb3Igbm90LgogICAgICAgICAgdmFyIG5vdyA9IHRpbWUgfHwgbG9jYWxfX2NyZWF0ZUxvY2FsKCksCiAgICAgICAgICAgICAgc29kID0gY2xvbmVXaXRoT2Zmc2V0KG5vdywgdGhpcykuc3RhcnRPZignZGF5JyksCiAgICAgICAgICAgICAgZGlmZiA9IHRoaXMuZGlmZihzb2QsICdkYXlzJywgdHJ1ZSksCiAgICAgICAgICAgICAgZm9ybWF0ID0gZGlmZiA8IC02ID8gJ3NhbWVFbHNlJyA6CiAgICAgICAgICAgICAgICAgIGRpZmYgPCAtMSA/ICdsYXN0V2VlaycgOgogICAgICAgICAgICAgICAgICBkaWZmIDwgMCA/ICdsYXN0RGF5JyA6CiAgICAgICAgICAgICAgICAgIGRpZmYgPCAxID8gJ3NhbWVEYXknIDoKICAgICAgICAgICAgICAgICAgZGlmZiA8IDIgPyAnbmV4dERheScgOgogICAgICAgICAgICAgICAgICBkaWZmIDwgNyA/ICduZXh0V2VlaycgOiAnc2FtZUVsc2UnOwogICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0KHRoaXMubG9jYWxlRGF0YSgpLmNhbGVuZGFyKGZvcm1hdCwgdGhpcywgbG9jYWxfX2NyZWF0ZUxvY2FsKG5vdykpKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY2xvbmUgKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBNb21lbnQodGhpcyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGlzQWZ0ZXIgKGlucHV0LCB1bml0cykgewogICAgICAgICAgdmFyIGlucHV0TXM7CiAgICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHR5cGVvZiB1bml0cyAhPT0gJ3VuZGVmaW5lZCcgPyB1bml0cyA6ICdtaWxsaXNlY29uZCcpOwogICAgICAgICAgaWYgKHVuaXRzID09PSAnbWlsbGlzZWNvbmQnKSB7CiAgICAgICAgICAgICAgaW5wdXQgPSBpc01vbWVudChpbnB1dCkgPyBpbnB1dCA6IGxvY2FsX19jcmVhdGVMb2NhbChpbnB1dCk7CiAgICAgICAgICAgICAgcmV0dXJuICt0aGlzID4gK2lucHV0OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpbnB1dE1zID0gaXNNb21lbnQoaW5wdXQpID8gK2lucHV0IDogK2xvY2FsX19jcmVhdGVMb2NhbChpbnB1dCk7CiAgICAgICAgICAgICAgcmV0dXJuIGlucHV0TXMgPCArdGhpcy5jbG9uZSgpLnN0YXJ0T2YodW5pdHMpOwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBpc0JlZm9yZSAoaW5wdXQsIHVuaXRzKSB7CiAgICAgICAgICB2YXIgaW5wdXRNczsKICAgICAgICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModHlwZW9mIHVuaXRzICE9PSAndW5kZWZpbmVkJyA/IHVuaXRzIDogJ21pbGxpc2Vjb25kJyk7CiAgICAgICAgICBpZiAodW5pdHMgPT09ICdtaWxsaXNlY29uZCcpIHsKICAgICAgICAgICAgICBpbnB1dCA9IGlzTW9tZW50KGlucHV0KSA/IGlucHV0IDogbG9jYWxfX2NyZWF0ZUxvY2FsKGlucHV0KTsKICAgICAgICAgICAgICByZXR1cm4gK3RoaXMgPCAraW5wdXQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlucHV0TXMgPSBpc01vbWVudChpbnB1dCkgPyAraW5wdXQgOiArbG9jYWxfX2NyZWF0ZUxvY2FsKGlucHV0KTsKICAgICAgICAgICAgICByZXR1cm4gK3RoaXMuY2xvbmUoKS5lbmRPZih1bml0cykgPCBpbnB1dE1zOwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBpc0JldHdlZW4gKGZyb20sIHRvLCB1bml0cykgewogICAgICAgICAgcmV0dXJuIHRoaXMuaXNBZnRlcihmcm9tLCB1bml0cykgJiYgdGhpcy5pc0JlZm9yZSh0bywgdW5pdHMpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc1NhbWUgKGlucHV0LCB1bml0cykgewogICAgICAgICAgdmFyIGlucHV0TXM7CiAgICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzIHx8ICdtaWxsaXNlY29uZCcpOwogICAgICAgICAgaWYgKHVuaXRzID09PSAnbWlsbGlzZWNvbmQnKSB7CiAgICAgICAgICAgICAgaW5wdXQgPSBpc01vbWVudChpbnB1dCkgPyBpbnB1dCA6IGxvY2FsX19jcmVhdGVMb2NhbChpbnB1dCk7CiAgICAgICAgICAgICAgcmV0dXJuICt0aGlzID09PSAraW5wdXQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlucHV0TXMgPSArbG9jYWxfX2NyZWF0ZUxvY2FsKGlucHV0KTsKICAgICAgICAgICAgICByZXR1cm4gKyh0aGlzLmNsb25lKCkuc3RhcnRPZih1bml0cykpIDw9IGlucHV0TXMgJiYgaW5wdXRNcyA8PSArKHRoaXMuY2xvbmUoKS5lbmRPZih1bml0cykpOwogICAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiBhYnNGbG9vciAobnVtYmVyKSB7CiAgICAgICAgICBpZiAobnVtYmVyIDwgMCkgewogICAgICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwobnVtYmVyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IobnVtYmVyKTsKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gZGlmZiAoaW5wdXQsIHVuaXRzLCBhc0Zsb2F0KSB7CiAgICAgICAgICB2YXIgdGhhdCA9IGNsb25lV2l0aE9mZnNldChpbnB1dCwgdGhpcyksCiAgICAgICAgICAgICAgem9uZURlbHRhID0gKHRoYXQudXRjT2Zmc2V0KCkgLSB0aGlzLnV0Y09mZnNldCgpKSAqIDZlNCwKICAgICAgICAgICAgICBkZWx0YSwgb3V0cHV0OwoKICAgICAgICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModW5pdHMpOwoKICAgICAgICAgIGlmICh1bml0cyA9PT0gJ3llYXInIHx8IHVuaXRzID09PSAnbW9udGgnIHx8IHVuaXRzID09PSAncXVhcnRlcicpIHsKICAgICAgICAgICAgICBvdXRwdXQgPSBtb250aERpZmYodGhpcywgdGhhdCk7CiAgICAgICAgICAgICAgaWYgKHVuaXRzID09PSAncXVhcnRlcicpIHsKICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gb3V0cHV0IC8gMzsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVuaXRzID09PSAneWVhcicpIHsKICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gb3V0cHV0IC8gMTI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBkZWx0YSA9IHRoaXMgLSB0aGF0OwogICAgICAgICAgICAgIG91dHB1dCA9IHVuaXRzID09PSAnc2Vjb25kJyA/IGRlbHRhIC8gMWUzIDogLy8gMTAwMAogICAgICAgICAgICAgICAgICB1bml0cyA9PT0gJ21pbnV0ZScgPyBkZWx0YSAvIDZlNCA6IC8vIDEwMDAgKiA2MAogICAgICAgICAgICAgICAgICB1bml0cyA9PT0gJ2hvdXInID8gZGVsdGEgLyAzNmU1IDogLy8gMTAwMCAqIDYwICogNjAKICAgICAgICAgICAgICAgICAgdW5pdHMgPT09ICdkYXknID8gKGRlbHRhIC0gem9uZURlbHRhKSAvIDg2NGU1IDogLy8gMTAwMCAqIDYwICogNjAgKiAyNCwgbmVnYXRlIGRzdAogICAgICAgICAgICAgICAgICB1bml0cyA9PT0gJ3dlZWsnID8gKGRlbHRhIC0gem9uZURlbHRhKSAvIDYwNDhlNSA6IC8vIDEwMDAgKiA2MCAqIDYwICogMjQgKiA3LCBuZWdhdGUgZHN0CiAgICAgICAgICAgICAgICAgIGRlbHRhOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGFzRmxvYXQgPyBvdXRwdXQgOiBhYnNGbG9vcihvdXRwdXQpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBtb250aERpZmYgKGEsIGIpIHsKICAgICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gbW9udGhzCiAgICAgICAgICB2YXIgd2hvbGVNb250aERpZmYgPSAoKGIueWVhcigpIC0gYS55ZWFyKCkpICogMTIpICsgKGIubW9udGgoKSAtIGEubW9udGgoKSksCiAgICAgICAgICAgICAgLy8gYiBpcyBpbiAoYW5jaG9yIC0gMSBtb250aCwgYW5jaG9yICsgMSBtb250aCkKICAgICAgICAgICAgICBhbmNob3IgPSBhLmNsb25lKCkuYWRkKHdob2xlTW9udGhEaWZmLCAnbW9udGhzJyksCiAgICAgICAgICAgICAgYW5jaG9yMiwgYWRqdXN0OwoKICAgICAgICAgIGlmIChiIC0gYW5jaG9yIDwgMCkgewogICAgICAgICAgICAgIGFuY2hvcjIgPSBhLmNsb25lKCkuYWRkKHdob2xlTW9udGhEaWZmIC0gMSwgJ21vbnRocycpOwogICAgICAgICAgICAgIC8vIGxpbmVhciBhY3Jvc3MgdGhlIG1vbnRoCiAgICAgICAgICAgICAgYWRqdXN0ID0gKGIgLSBhbmNob3IpIC8gKGFuY2hvciAtIGFuY2hvcjIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBhbmNob3IyID0gYS5jbG9uZSgpLmFkZCh3aG9sZU1vbnRoRGlmZiArIDEsICdtb250aHMnKTsKICAgICAgICAgICAgICAvLyBsaW5lYXIgYWNyb3NzIHRoZSBtb250aAogICAgICAgICAgICAgIGFkanVzdCA9IChiIC0gYW5jaG9yKSAvIChhbmNob3IyIC0gYW5jaG9yKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gLSh3aG9sZU1vbnRoRGlmZiArIGFkanVzdCk7CiAgICAgIH0KCiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5kZWZhdWx0Rm9ybWF0ID0gJ1lZWVktTU0tRERUSEg6bW06c3NaJzsKCiAgICAgIGZ1bmN0aW9uIHRvU3RyaW5nICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNsb25lKCkubG9jYWxlKCdlbicpLmZvcm1hdCgnZGRkIE1NTSBERCBZWVlZIEhIOm1tOnNzIFtHTVRdWlonKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbW9tZW50X2Zvcm1hdF9fdG9JU09TdHJpbmcgKCkgewogICAgICAgICAgdmFyIG0gPSB0aGlzLmNsb25lKCkudXRjKCk7CiAgICAgICAgICBpZiAoMCA8IG0ueWVhcigpICYmIG0ueWVhcigpIDw9IDk5OTkpIHsKICAgICAgICAgICAgICBpZiAoJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mIERhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgIC8vIG5hdGl2ZSBpbXBsZW1lbnRhdGlvbiBpcyB+NTB4IGZhc3RlciwgdXNlIGl0IHdoZW4gd2UgY2FuCiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnRvRGF0ZSgpLnRvSVNPU3RyaW5nKCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdE1vbWVudChtLCAnWVlZWS1NTS1ERFtUXUhIOm1tOnNzLlNTU1taXScpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdE1vbWVudChtLCAnWVlZWVlZLU1NLUREW1RdSEg6bW06c3MuU1NTW1pdJyk7CiAgICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGZvcm1hdCAoaW5wdXRTdHJpbmcpIHsKICAgICAgICAgIHZhciBvdXRwdXQgPSBmb3JtYXRNb21lbnQodGhpcywgaW5wdXRTdHJpbmcgfHwgdXRpbHNfaG9va3NfX2hvb2tzLmRlZmF1bHRGb3JtYXQpOwogICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLnBvc3Rmb3JtYXQob3V0cHV0KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZnJvbSAodGltZSwgd2l0aG91dFN1ZmZpeCkgewogICAgICAgICAgaWYgKCF0aGlzLmlzVmFsaWQoKSkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS5pbnZhbGlkRGF0ZSgpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGNyZWF0ZV9fY3JlYXRlRHVyYXRpb24oe3RvOiB0aGlzLCBmcm9tOiB0aW1lfSkubG9jYWxlKHRoaXMubG9jYWxlKCkpLmh1bWFuaXplKCF3aXRob3V0U3VmZml4KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZnJvbU5vdyAod2l0aG91dFN1ZmZpeCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuZnJvbShsb2NhbF9fY3JlYXRlTG9jYWwoKSwgd2l0aG91dFN1ZmZpeCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHRvICh0aW1lLCB3aXRob3V0U3VmZml4KSB7CiAgICAgICAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLmludmFsaWREYXRlKCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gY3JlYXRlX19jcmVhdGVEdXJhdGlvbih7ZnJvbTogdGhpcywgdG86IHRpbWV9KS5sb2NhbGUodGhpcy5sb2NhbGUoKSkuaHVtYW5pemUoIXdpdGhvdXRTdWZmaXgpOwogICAgICB9CgogICAgICBmdW5jdGlvbiB0b05vdyAod2l0aG91dFN1ZmZpeCkgewogICAgICAgICAgcmV0dXJuIHRoaXMudG8obG9jYWxfX2NyZWF0ZUxvY2FsKCksIHdpdGhvdXRTdWZmaXgpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBsb2NhbGUgKGtleSkgewogICAgICAgICAgdmFyIG5ld0xvY2FsZURhdGE7CgogICAgICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2xvY2FsZS5fYWJicjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbmV3TG9jYWxlRGF0YSA9IGxvY2FsZV9sb2NhbGVzX19nZXRMb2NhbGUoa2V5KTsKICAgICAgICAgICAgICBpZiAobmV3TG9jYWxlRGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuX2xvY2FsZSA9IG5ld0xvY2FsZURhdGE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgbGFuZyA9IGRlcHJlY2F0ZSgKICAgICAgICAgICdtb21lbnQoKS5sYW5nKCkgaXMgZGVwcmVjYXRlZC4gSW5zdGVhZCwgdXNlIG1vbWVudCgpLmxvY2FsZURhdGEoKSB0byBnZXQgdGhlIGxhbmd1YWdlIGNvbmZpZ3VyYXRpb24uIFVzZSBtb21lbnQoKS5sb2NhbGUoKSB0byBjaGFuZ2UgbGFuZ3VhZ2VzLicsCiAgICAgICAgICBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGUoa2V5KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICk7CgogICAgICBmdW5jdGlvbiBsb2NhbGVEYXRhICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9sb2NhbGU7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHN0YXJ0T2YgKHVuaXRzKSB7CiAgICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsKICAgICAgICAgIC8vIHRoZSBmb2xsb3dpbmcgc3dpdGNoIGludGVudGlvbmFsbHkgb21pdHMgYnJlYWsga2V5d29yZHMKICAgICAgICAgIC8vIHRvIHV0aWxpemUgZmFsbGluZyB0aHJvdWdoIHRoZSBjYXNlcy4KICAgICAgICAgIHN3aXRjaCAodW5pdHMpIHsKICAgICAgICAgIGNhc2UgJ3llYXInOgogICAgICAgICAgICAgIHRoaXMubW9udGgoMCk7CiAgICAgICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgICAgY2FzZSAncXVhcnRlcic6CiAgICAgICAgICBjYXNlICdtb250aCc6CiAgICAgICAgICAgICAgdGhpcy5kYXRlKDEpOwogICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgIGNhc2UgJ3dlZWsnOgogICAgICAgICAgY2FzZSAnaXNvV2Vlayc6CiAgICAgICAgICBjYXNlICdkYXknOgogICAgICAgICAgICAgIHRoaXMuaG91cnMoMCk7CiAgICAgICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgICAgY2FzZSAnaG91cic6CiAgICAgICAgICAgICAgdGhpcy5taW51dGVzKDApOwogICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgIGNhc2UgJ21pbnV0ZSc6CiAgICAgICAgICAgICAgdGhpcy5zZWNvbmRzKDApOwogICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgIGNhc2UgJ3NlY29uZCc6CiAgICAgICAgICAgICAgdGhpcy5taWxsaXNlY29uZHMoMCk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gd2Vla3MgYXJlIGEgc3BlY2lhbCBjYXNlCiAgICAgICAgICBpZiAodW5pdHMgPT09ICd3ZWVrJykgewogICAgICAgICAgICAgIHRoaXMud2Vla2RheSgwKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh1bml0cyA9PT0gJ2lzb1dlZWsnKSB7CiAgICAgICAgICAgICAgdGhpcy5pc29XZWVrZGF5KDEpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIHF1YXJ0ZXJzIGFyZSBhbHNvIHNwZWNpYWwKICAgICAgICAgIGlmICh1bml0cyA9PT0gJ3F1YXJ0ZXInKSB7CiAgICAgICAgICAgICAgdGhpcy5tb250aChNYXRoLmZsb29yKHRoaXMubW9udGgoKSAvIDMpICogMyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGVuZE9mICh1bml0cykgewogICAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7CiAgICAgICAgICBpZiAodW5pdHMgPT09IHVuZGVmaW5lZCB8fCB1bml0cyA9PT0gJ21pbGxpc2Vjb25kJykgewogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnRPZih1bml0cykuYWRkKDEsICh1bml0cyA9PT0gJ2lzb1dlZWsnID8gJ3dlZWsnIDogdW5pdHMpKS5zdWJ0cmFjdCgxLCAnbXMnKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gdG9fdHlwZV9fdmFsdWVPZiAoKSB7CiAgICAgICAgICByZXR1cm4gK3RoaXMuX2QgLSAoKHRoaXMuX29mZnNldCB8fCAwKSAqIDYwMDAwKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gdW5peCAoKSB7CiAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigrdGhpcyAvIDEwMDApOwogICAgICB9CgogICAgICBmdW5jdGlvbiB0b0RhdGUgKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX29mZnNldCA/IG5ldyBEYXRlKCt0aGlzKSA6IHRoaXMuX2Q7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHRvQXJyYXkgKCkgewogICAgICAgICAgdmFyIG0gPSB0aGlzOwogICAgICAgICAgcmV0dXJuIFttLnllYXIoKSwgbS5tb250aCgpLCBtLmRhdGUoKSwgbS5ob3VyKCksIG0ubWludXRlKCksIG0uc2Vjb25kKCksIG0ubWlsbGlzZWNvbmQoKV07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG1vbWVudF92YWxpZF9faXNWYWxpZCAoKSB7CiAgICAgICAgICByZXR1cm4gdmFsaWRfX2lzVmFsaWQodGhpcyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHBhcnNpbmdGbGFncyAoKSB7CiAgICAgICAgICByZXR1cm4gZXh0ZW5kKHt9LCBnZXRQYXJzaW5nRmxhZ3ModGhpcykpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpbnZhbGlkQXQgKCkgewogICAgICAgICAgcmV0dXJuIGdldFBhcnNpbmdGbGFncyh0aGlzKS5vdmVyZmxvdzsKICAgICAgfQoKICAgICAgYWRkRm9ybWF0VG9rZW4oMCwgWydnZycsIDJdLCAwLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy53ZWVrWWVhcigpICUgMTAwOwogICAgICB9KTsKCiAgICAgIGFkZEZvcm1hdFRva2VuKDAsIFsnR0cnLCAyXSwgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuaXNvV2Vla1llYXIoKSAlIDEwMDsKICAgICAgfSk7CgogICAgICBmdW5jdGlvbiBhZGRXZWVrWWVhckZvcm1hdFRva2VuICh0b2tlbiwgZ2V0dGVyKSB7CiAgICAgICAgICBhZGRGb3JtYXRUb2tlbigwLCBbdG9rZW4sIHRva2VuLmxlbmd0aF0sIDAsIGdldHRlcik7CiAgICAgIH0KCiAgICAgIGFkZFdlZWtZZWFyRm9ybWF0VG9rZW4oJ2dnZ2cnLCAgICAgJ3dlZWtZZWFyJyk7CiAgICAgIGFkZFdlZWtZZWFyRm9ybWF0VG9rZW4oJ2dnZ2dnJywgICAgJ3dlZWtZZWFyJyk7CiAgICAgIGFkZFdlZWtZZWFyRm9ybWF0VG9rZW4oJ0dHR0cnLCAgJ2lzb1dlZWtZZWFyJyk7CiAgICAgIGFkZFdlZWtZZWFyRm9ybWF0VG9rZW4oJ0dHR0dHJywgJ2lzb1dlZWtZZWFyJyk7CgogICAgICAvLyBBTElBU0VTCgogICAgICBhZGRVbml0QWxpYXMoJ3dlZWtZZWFyJywgJ2dnJyk7CiAgICAgIGFkZFVuaXRBbGlhcygnaXNvV2Vla1llYXInLCAnR0cnKTsKCiAgICAgIC8vIFBBUlNJTkcKCiAgICAgIGFkZFJlZ2V4VG9rZW4oJ0cnLCAgICAgIG1hdGNoU2lnbmVkKTsKICAgICAgYWRkUmVnZXhUb2tlbignZycsICAgICAgbWF0Y2hTaWduZWQpOwogICAgICBhZGRSZWdleFRva2VuKCdHRycsICAgICBtYXRjaDF0bzIsIG1hdGNoMik7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ2dnJywgICAgIG1hdGNoMXRvMiwgbWF0Y2gyKTsKICAgICAgYWRkUmVnZXhUb2tlbignR0dHRycsICAgbWF0Y2gxdG80LCBtYXRjaDQpOwogICAgICBhZGRSZWdleFRva2VuKCdnZ2dnJywgICBtYXRjaDF0bzQsIG1hdGNoNCk7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ0dHR0dHJywgIG1hdGNoMXRvNiwgbWF0Y2g2KTsKICAgICAgYWRkUmVnZXhUb2tlbignZ2dnZ2cnLCAgbWF0Y2gxdG82LCBtYXRjaDYpOwoKICAgICAgYWRkV2Vla1BhcnNlVG9rZW4oWydnZ2dnJywgJ2dnZ2dnJywgJ0dHR0cnLCAnR0dHR0cnXSwgZnVuY3Rpb24gKGlucHV0LCB3ZWVrLCBjb25maWcsIHRva2VuKSB7CiAgICAgICAgICB3ZWVrW3Rva2VuLnN1YnN0cigwLCAyKV0gPSB0b0ludChpbnB1dCk7CiAgICAgIH0pOwoKICAgICAgYWRkV2Vla1BhcnNlVG9rZW4oWydnZycsICdHRyddLCBmdW5jdGlvbiAoaW5wdXQsIHdlZWssIGNvbmZpZywgdG9rZW4pIHsKICAgICAgICAgIHdlZWtbdG9rZW5dID0gdXRpbHNfaG9va3NfX2hvb2tzLnBhcnNlVHdvRGlnaXRZZWFyKGlucHV0KTsKICAgICAgfSk7CgogICAgICAvLyBIRUxQRVJTCgogICAgICBmdW5jdGlvbiB3ZWVrc0luWWVhcih5ZWFyLCBkb3csIGRveSkgewogICAgICAgICAgcmV0dXJuIHdlZWtPZlllYXIobG9jYWxfX2NyZWF0ZUxvY2FsKFt5ZWFyLCAxMSwgMzEgKyBkb3cgLSBkb3ldKSwgZG93LCBkb3kpLndlZWs7CiAgICAgIH0KCiAgICAgIC8vIE1PTUVOVFMKCiAgICAgIGZ1bmN0aW9uIGdldFNldFdlZWtZZWFyIChpbnB1dCkgewogICAgICAgICAgdmFyIHllYXIgPSB3ZWVrT2ZZZWFyKHRoaXMsIHRoaXMubG9jYWxlRGF0YSgpLl93ZWVrLmRvdywgdGhpcy5sb2NhbGVEYXRhKCkuX3dlZWsuZG95KS55ZWFyOwogICAgICAgICAgcmV0dXJuIGlucHV0ID09IG51bGwgPyB5ZWFyIDogdGhpcy5hZGQoKGlucHV0IC0geWVhciksICd5Jyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldFNldElTT1dlZWtZZWFyIChpbnB1dCkgewogICAgICAgICAgdmFyIHllYXIgPSB3ZWVrT2ZZZWFyKHRoaXMsIDEsIDQpLnllYXI7CiAgICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHllYXIgOiB0aGlzLmFkZCgoaW5wdXQgLSB5ZWFyKSwgJ3knKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0SVNPV2Vla3NJblllYXIgKCkgewogICAgICAgICAgcmV0dXJuIHdlZWtzSW5ZZWFyKHRoaXMueWVhcigpLCAxLCA0KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0V2Vla3NJblllYXIgKCkgewogICAgICAgICAgdmFyIHdlZWtJbmZvID0gdGhpcy5sb2NhbGVEYXRhKCkuX3dlZWs7CiAgICAgICAgICByZXR1cm4gd2Vla3NJblllYXIodGhpcy55ZWFyKCksIHdlZWtJbmZvLmRvdywgd2Vla0luZm8uZG95KTsKICAgICAgfQoKICAgICAgYWRkRm9ybWF0VG9rZW4oJ1EnLCAwLCAwLCAncXVhcnRlcicpOwoKICAgICAgLy8gQUxJQVNFUwoKICAgICAgYWRkVW5pdEFsaWFzKCdxdWFydGVyJywgJ1EnKTsKCiAgICAgIC8vIFBBUlNJTkcKCiAgICAgIGFkZFJlZ2V4VG9rZW4oJ1EnLCBtYXRjaDEpOwogICAgICBhZGRQYXJzZVRva2VuKCdRJywgZnVuY3Rpb24gKGlucHV0LCBhcnJheSkgewogICAgICAgICAgYXJyYXlbTU9OVEhdID0gKHRvSW50KGlucHV0KSAtIDEpICogMzsKICAgICAgfSk7CgogICAgICAvLyBNT01FTlRTCgogICAgICBmdW5jdGlvbiBnZXRTZXRRdWFydGVyIChpbnB1dCkgewogICAgICAgICAgcmV0dXJuIGlucHV0ID09IG51bGwgPyBNYXRoLmNlaWwoKHRoaXMubW9udGgoKSArIDEpIC8gMykgOiB0aGlzLm1vbnRoKChpbnB1dCAtIDEpICogMyArIHRoaXMubW9udGgoKSAlIDMpOwogICAgICB9CgogICAgICBhZGRGb3JtYXRUb2tlbignRCcsIFsnREQnLCAyXSwgJ0RvJywgJ2RhdGUnKTsKCiAgICAgIC8vIEFMSUFTRVMKCiAgICAgIGFkZFVuaXRBbGlhcygnZGF0ZScsICdEJyk7CgogICAgICAvLyBQQVJTSU5HCgogICAgICBhZGRSZWdleFRva2VuKCdEJywgIG1hdGNoMXRvMik7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ0REJywgbWF0Y2gxdG8yLCBtYXRjaDIpOwogICAgICBhZGRSZWdleFRva2VuKCdEbycsIGZ1bmN0aW9uIChpc1N0cmljdCwgbG9jYWxlKSB7CiAgICAgICAgICByZXR1cm4gaXNTdHJpY3QgPyBsb2NhbGUuX29yZGluYWxQYXJzZSA6IGxvY2FsZS5fb3JkaW5hbFBhcnNlTGVuaWVudDsKICAgICAgfSk7CgogICAgICBhZGRQYXJzZVRva2VuKFsnRCcsICdERCddLCBEQVRFKTsKICAgICAgYWRkUGFyc2VUb2tlbignRG8nLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5KSB7CiAgICAgICAgICBhcnJheVtEQVRFXSA9IHRvSW50KGlucHV0Lm1hdGNoKG1hdGNoMXRvMilbMF0sIDEwKTsKICAgICAgfSk7CgogICAgICAvLyBNT01FTlRTCgogICAgICB2YXIgZ2V0U2V0RGF5T2ZNb250aCA9IG1ha2VHZXRTZXQoJ0RhdGUnLCB0cnVlKTsKCiAgICAgIGFkZEZvcm1hdFRva2VuKCdkJywgMCwgJ2RvJywgJ2RheScpOwoKICAgICAgYWRkRm9ybWF0VG9rZW4oJ2RkJywgMCwgMCwgZnVuY3Rpb24gKGZvcm1hdCkgewogICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLndlZWtkYXlzTWluKHRoaXMsIGZvcm1hdCk7CiAgICAgIH0pOwoKICAgICAgYWRkRm9ybWF0VG9rZW4oJ2RkZCcsIDAsIDAsIGZ1bmN0aW9uIChmb3JtYXQpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS53ZWVrZGF5c1Nob3J0KHRoaXMsIGZvcm1hdCk7CiAgICAgIH0pOwoKICAgICAgYWRkRm9ybWF0VG9rZW4oJ2RkZGQnLCAwLCAwLCBmdW5jdGlvbiAoZm9ybWF0KSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkud2Vla2RheXModGhpcywgZm9ybWF0KTsKICAgICAgfSk7CgogICAgICBhZGRGb3JtYXRUb2tlbignZScsIDAsIDAsICd3ZWVrZGF5Jyk7CiAgICAgIGFkZEZvcm1hdFRva2VuKCdFJywgMCwgMCwgJ2lzb1dlZWtkYXknKTsKCiAgICAgIC8vIEFMSUFTRVMKCiAgICAgIGFkZFVuaXRBbGlhcygnZGF5JywgJ2QnKTsKICAgICAgYWRkVW5pdEFsaWFzKCd3ZWVrZGF5JywgJ2UnKTsKICAgICAgYWRkVW5pdEFsaWFzKCdpc29XZWVrZGF5JywgJ0UnKTsKCiAgICAgIC8vIFBBUlNJTkcKCiAgICAgIGFkZFJlZ2V4VG9rZW4oJ2QnLCAgICBtYXRjaDF0bzIpOwogICAgICBhZGRSZWdleFRva2VuKCdlJywgICAgbWF0Y2gxdG8yKTsKICAgICAgYWRkUmVnZXhUb2tlbignRScsICAgIG1hdGNoMXRvMik7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ2RkJywgICBtYXRjaFdvcmQpOwogICAgICBhZGRSZWdleFRva2VuKCdkZGQnLCAgbWF0Y2hXb3JkKTsKICAgICAgYWRkUmVnZXhUb2tlbignZGRkZCcsIG1hdGNoV29yZCk7CgogICAgICBhZGRXZWVrUGFyc2VUb2tlbihbJ2RkJywgJ2RkZCcsICdkZGRkJ10sIGZ1bmN0aW9uIChpbnB1dCwgd2VlaywgY29uZmlnKSB7CiAgICAgICAgICB2YXIgd2Vla2RheSA9IGNvbmZpZy5fbG9jYWxlLndlZWtkYXlzUGFyc2UoaW5wdXQpOwogICAgICAgICAgLy8gaWYgd2UgZGlkbid0IGdldCBhIHdlZWtkYXkgbmFtZSwgbWFyayB0aGUgZGF0ZSBhcyBpbnZhbGlkCiAgICAgICAgICBpZiAod2Vla2RheSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgd2Vlay5kID0gd2Vla2RheTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuaW52YWxpZFdlZWtkYXkgPSBpbnB1dDsKICAgICAgICAgIH0KICAgICAgfSk7CgogICAgICBhZGRXZWVrUGFyc2VUb2tlbihbJ2QnLCAnZScsICdFJ10sIGZ1bmN0aW9uIChpbnB1dCwgd2VlaywgY29uZmlnLCB0b2tlbikgewogICAgICAgICAgd2Vla1t0b2tlbl0gPSB0b0ludChpbnB1dCk7CiAgICAgIH0pOwoKICAgICAgLy8gSEVMUEVSUwoKICAgICAgZnVuY3Rpb24gcGFyc2VXZWVrZGF5KGlucHV0LCBsb2NhbGUpIHsKICAgICAgICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgaWYgKCFpc05hTihpbnB1dCkpIHsKICAgICAgICAgICAgICAgICAgaW5wdXQgPSBwYXJzZUludChpbnB1dCwgMTApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgaW5wdXQgPSBsb2NhbGUud2Vla2RheXNQYXJzZShpbnB1dCk7CiAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaW5wdXQgIT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpbnB1dDsKICAgICAgfQoKICAgICAgLy8gTE9DQUxFUwoKICAgICAgdmFyIGRlZmF1bHRMb2NhbGVXZWVrZGF5cyA9ICdTdW5kYXlfTW9uZGF5X1R1ZXNkYXlfV2VkbmVzZGF5X1RodXJzZGF5X0ZyaWRheV9TYXR1cmRheScuc3BsaXQoJ18nKTsKICAgICAgZnVuY3Rpb24gbG9jYWxlV2Vla2RheXMgKG0pIHsKICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c1ttLmRheSgpXTsKICAgICAgfQoKICAgICAgdmFyIGRlZmF1bHRMb2NhbGVXZWVrZGF5c1Nob3J0ID0gJ1N1bl9Nb25fVHVlX1dlZF9UaHVfRnJpX1NhdCcuc3BsaXQoJ18nKTsKICAgICAgZnVuY3Rpb24gbG9jYWxlV2Vla2RheXNTaG9ydCAobSkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX3dlZWtkYXlzU2hvcnRbbS5kYXkoKV07CiAgICAgIH0KCiAgICAgIHZhciBkZWZhdWx0TG9jYWxlV2Vla2RheXNNaW4gPSAnU3VfTW9fVHVfV2VfVGhfRnJfU2EnLnNwbGl0KCdfJyk7CiAgICAgIGZ1bmN0aW9uIGxvY2FsZVdlZWtkYXlzTWluIChtKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fd2Vla2RheXNNaW5bbS5kYXkoKV07CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGxvY2FsZVdlZWtkYXlzUGFyc2UgKHdlZWtkYXlOYW1lKSB7CiAgICAgICAgICB2YXIgaSwgbW9tLCByZWdleDsKCiAgICAgICAgICBpZiAoIXRoaXMuX3dlZWtkYXlzUGFyc2UpIHsKICAgICAgICAgICAgICB0aGlzLl93ZWVrZGF5c1BhcnNlID0gW107CiAgICAgICAgICB9CgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IDc7IGkrKykgewogICAgICAgICAgICAgIC8vIG1ha2UgdGhlIHJlZ2V4IGlmIHdlIGRvbid0IGhhdmUgaXQgYWxyZWFkeQogICAgICAgICAgICAgIGlmICghdGhpcy5fd2Vla2RheXNQYXJzZVtpXSkgewogICAgICAgICAgICAgICAgICBtb20gPSBsb2NhbF9fY3JlYXRlTG9jYWwoWzIwMDAsIDFdKS5kYXkoaSk7CiAgICAgICAgICAgICAgICAgIHJlZ2V4ID0gJ14nICsgdGhpcy53ZWVrZGF5cyhtb20sICcnKSArICd8XicgKyB0aGlzLndlZWtkYXlzU2hvcnQobW9tLCAnJykgKyAnfF4nICsgdGhpcy53ZWVrZGF5c01pbihtb20sICcnKTsKICAgICAgICAgICAgICAgICAgdGhpcy5fd2Vla2RheXNQYXJzZVtpXSA9IG5ldyBSZWdFeHAocmVnZXgucmVwbGFjZSgnLicsICcnKSwgJ2knKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy8gdGVzdCB0aGUgcmVnZXgKICAgICAgICAgICAgICBpZiAodGhpcy5fd2Vla2RheXNQYXJzZVtpXS50ZXN0KHdlZWtkYXlOYW1lKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIE1PTUVOVFMKCiAgICAgIGZ1bmN0aW9uIGdldFNldERheU9mV2VlayAoaW5wdXQpIHsKICAgICAgICAgIHZhciBkYXkgPSB0aGlzLl9pc1VUQyA/IHRoaXMuX2QuZ2V0VVRDRGF5KCkgOiB0aGlzLl9kLmdldERheSgpOwogICAgICAgICAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgICAgICAgICAgICBpbnB1dCA9IHBhcnNlV2Vla2RheShpbnB1dCwgdGhpcy5sb2NhbGVEYXRhKCkpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZChpbnB1dCAtIGRheSwgJ2QnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRheTsKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0U2V0TG9jYWxlRGF5T2ZXZWVrIChpbnB1dCkgewogICAgICAgICAgdmFyIHdlZWtkYXkgPSAodGhpcy5kYXkoKSArIDcgLSB0aGlzLmxvY2FsZURhdGEoKS5fd2Vlay5kb3cpICUgNzsKICAgICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gd2Vla2RheSA6IHRoaXMuYWRkKGlucHV0IC0gd2Vla2RheSwgJ2QnKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0U2V0SVNPRGF5T2ZXZWVrIChpbnB1dCkgewogICAgICAgICAgLy8gYmVoYXZlcyB0aGUgc2FtZSBhcyBtb21lbnQjZGF5IGV4Y2VwdAogICAgICAgICAgLy8gYXMgYSBnZXR0ZXIsIHJldHVybnMgNyBpbnN0ZWFkIG9mIDAgKDEtNyByYW5nZSBpbnN0ZWFkIG9mIDAtNikKICAgICAgICAgIC8vIGFzIGEgc2V0dGVyLCBzdW5kYXkgc2hvdWxkIGJlbG9uZyB0byB0aGUgcHJldmlvdXMgd2Vlay4KICAgICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gdGhpcy5kYXkoKSB8fCA3IDogdGhpcy5kYXkodGhpcy5kYXkoKSAlIDcgPyBpbnB1dCA6IGlucHV0IC0gNyk7CiAgICAgIH0KCiAgICAgIGFkZEZvcm1hdFRva2VuKCdIJywgWydISCcsIDJdLCAwLCAnaG91cicpOwogICAgICBhZGRGb3JtYXRUb2tlbignaCcsIFsnaGgnLCAyXSwgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuaG91cnMoKSAlIDEyIHx8IDEyOwogICAgICB9KTsKCiAgICAgIGZ1bmN0aW9uIG1lcmlkaWVtICh0b2tlbiwgbG93ZXJjYXNlKSB7CiAgICAgICAgICBhZGRGb3JtYXRUb2tlbih0b2tlbiwgMCwgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS5tZXJpZGllbSh0aGlzLmhvdXJzKCksIHRoaXMubWludXRlcygpLCBsb3dlcmNhc2UpOwogICAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIG1lcmlkaWVtKCdhJywgdHJ1ZSk7CiAgICAgIG1lcmlkaWVtKCdBJywgZmFsc2UpOwoKICAgICAgLy8gQUxJQVNFUwoKICAgICAgYWRkVW5pdEFsaWFzKCdob3VyJywgJ2gnKTsKCiAgICAgIC8vIFBBUlNJTkcKCiAgICAgIGZ1bmN0aW9uIG1hdGNoTWVyaWRpZW0gKGlzU3RyaWN0LCBsb2NhbGUpIHsKICAgICAgICAgIHJldHVybiBsb2NhbGUuX21lcmlkaWVtUGFyc2U7CiAgICAgIH0KCiAgICAgIGFkZFJlZ2V4VG9rZW4oJ2EnLCAgbWF0Y2hNZXJpZGllbSk7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ0EnLCAgbWF0Y2hNZXJpZGllbSk7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ0gnLCAgbWF0Y2gxdG8yKTsKICAgICAgYWRkUmVnZXhUb2tlbignaCcsICBtYXRjaDF0bzIpOwogICAgICBhZGRSZWdleFRva2VuKCdISCcsIG1hdGNoMXRvMiwgbWF0Y2gyKTsKICAgICAgYWRkUmVnZXhUb2tlbignaGgnLCBtYXRjaDF0bzIsIG1hdGNoMik7CgogICAgICBhZGRQYXJzZVRva2VuKFsnSCcsICdISCddLCBIT1VSKTsKICAgICAgYWRkUGFyc2VUb2tlbihbJ2EnLCAnQSddLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHsKICAgICAgICAgIGNvbmZpZy5faXNQbSA9IGNvbmZpZy5fbG9jYWxlLmlzUE0oaW5wdXQpOwogICAgICAgICAgY29uZmlnLl9tZXJpZGllbSA9IGlucHV0OwogICAgICB9KTsKICAgICAgYWRkUGFyc2VUb2tlbihbJ2gnLCAnaGgnXSwgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnKSB7CiAgICAgICAgICBhcnJheVtIT1VSXSA9IHRvSW50KGlucHV0KTsKICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmJpZ0hvdXIgPSB0cnVlOwogICAgICB9KTsKCiAgICAgIC8vIExPQ0FMRVMKCiAgICAgIGZ1bmN0aW9uIGxvY2FsZUlzUE0gKGlucHV0KSB7CiAgICAgICAgICAvLyBJRTggUXVpcmtzIE1vZGUgJiBJRTcgU3RhbmRhcmRzIE1vZGUgZG8gbm90IGFsbG93IGFjY2Vzc2luZyBzdHJpbmdzIGxpa2UgYXJyYXlzCiAgICAgICAgICAvLyBVc2luZyBjaGFyQXQgc2hvdWxkIGJlIG1vcmUgY29tcGF0aWJsZS4KICAgICAgICAgIHJldHVybiAoKGlucHV0ICsgJycpLnRvTG93ZXJDYXNlKCkuY2hhckF0KDApID09PSAncCcpOwogICAgICB9CgogICAgICB2YXIgZGVmYXVsdExvY2FsZU1lcmlkaWVtUGFyc2UgPSAvW2FwXVwuP20/XC4/L2k7CiAgICAgIGZ1bmN0aW9uIGxvY2FsZU1lcmlkaWVtIChob3VycywgbWludXRlcywgaXNMb3dlcikgewogICAgICAgICAgaWYgKGhvdXJzID4gMTEpIHsKICAgICAgICAgICAgICByZXR1cm4gaXNMb3dlciA/ICdwbScgOiAnUE0nOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gaXNMb3dlciA/ICdhbScgOiAnQU0nOwogICAgICAgICAgfQogICAgICB9CgoKICAgICAgLy8gTU9NRU5UUwoKICAgICAgLy8gU2V0dGluZyB0aGUgaG91ciBzaG91bGQga2VlcCB0aGUgdGltZSwgYmVjYXVzZSB0aGUgdXNlciBleHBsaWNpdGx5CiAgICAgIC8vIHNwZWNpZmllZCB3aGljaCBob3VyIGhlIHdhbnRzLiBTbyB0cnlpbmcgdG8gbWFpbnRhaW4gdGhlIHNhbWUgaG91ciAoaW4KICAgICAgLy8gYSBuZXcgdGltZXpvbmUpIG1ha2VzIHNlbnNlLiBBZGRpbmcvc3VidHJhY3RpbmcgaG91cnMgZG9lcyBub3QgZm9sbG93CiAgICAgIC8vIHRoaXMgcnVsZS4KICAgICAgdmFyIGdldFNldEhvdXIgPSBtYWtlR2V0U2V0KCdIb3VycycsIHRydWUpOwoKICAgICAgYWRkRm9ybWF0VG9rZW4oJ20nLCBbJ21tJywgMl0sIDAsICdtaW51dGUnKTsKCiAgICAgIC8vIEFMSUFTRVMKCiAgICAgIGFkZFVuaXRBbGlhcygnbWludXRlJywgJ20nKTsKCiAgICAgIC8vIFBBUlNJTkcKCiAgICAgIGFkZFJlZ2V4VG9rZW4oJ20nLCAgbWF0Y2gxdG8yKTsKICAgICAgYWRkUmVnZXhUb2tlbignbW0nLCBtYXRjaDF0bzIsIG1hdGNoMik7CiAgICAgIGFkZFBhcnNlVG9rZW4oWydtJywgJ21tJ10sIE1JTlVURSk7CgogICAgICAvLyBNT01FTlRTCgogICAgICB2YXIgZ2V0U2V0TWludXRlID0gbWFrZUdldFNldCgnTWludXRlcycsIGZhbHNlKTsKCiAgICAgIGFkZEZvcm1hdFRva2VuKCdzJywgWydzcycsIDJdLCAwLCAnc2Vjb25kJyk7CgogICAgICAvLyBBTElBU0VTCgogICAgICBhZGRVbml0QWxpYXMoJ3NlY29uZCcsICdzJyk7CgogICAgICAvLyBQQVJTSU5HCgogICAgICBhZGRSZWdleFRva2VuKCdzJywgIG1hdGNoMXRvMik7CiAgICAgIGFkZFJlZ2V4VG9rZW4oJ3NzJywgbWF0Y2gxdG8yLCBtYXRjaDIpOwogICAgICBhZGRQYXJzZVRva2VuKFsncycsICdzcyddLCBTRUNPTkQpOwoKICAgICAgLy8gTU9NRU5UUwoKICAgICAgdmFyIGdldFNldFNlY29uZCA9IG1ha2VHZXRTZXQoJ1NlY29uZHMnLCBmYWxzZSk7CgogICAgICBhZGRGb3JtYXRUb2tlbignUycsIDAsIDAsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB+fih0aGlzLm1pbGxpc2Vjb25kKCkgLyAxMDApOwogICAgICB9KTsKCiAgICAgIGFkZEZvcm1hdFRva2VuKDAsIFsnU1MnLCAyXSwgMCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIH5+KHRoaXMubWlsbGlzZWNvbmQoKSAvIDEwKTsKICAgICAgfSk7CgogICAgICBmdW5jdGlvbiBtaWxsaXNlY29uZF9fbWlsbGlzZWNvbmRzICh0b2tlbikgewogICAgICAgICAgYWRkRm9ybWF0VG9rZW4oMCwgW3Rva2VuLCAzXSwgMCwgJ21pbGxpc2Vjb25kJyk7CiAgICAgIH0KCiAgICAgIG1pbGxpc2Vjb25kX19taWxsaXNlY29uZHMoJ1NTUycpOwogICAgICBtaWxsaXNlY29uZF9fbWlsbGlzZWNvbmRzKCdTU1NTJyk7CgogICAgICAvLyBBTElBU0VTCgogICAgICBhZGRVbml0QWxpYXMoJ21pbGxpc2Vjb25kJywgJ21zJyk7CgogICAgICAvLyBQQVJTSU5HCgogICAgICBhZGRSZWdleFRva2VuKCdTJywgICAgbWF0Y2gxdG8zLCBtYXRjaDEpOwogICAgICBhZGRSZWdleFRva2VuKCdTUycsICAgbWF0Y2gxdG8zLCBtYXRjaDIpOwogICAgICBhZGRSZWdleFRva2VuKCdTU1MnLCAgbWF0Y2gxdG8zLCBtYXRjaDMpOwogICAgICBhZGRSZWdleFRva2VuKCdTU1NTJywgbWF0Y2hVbnNpZ25lZCk7CiAgICAgIGFkZFBhcnNlVG9rZW4oWydTJywgJ1NTJywgJ1NTUycsICdTU1NTJ10sIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXkpIHsKICAgICAgICAgIGFycmF5W01JTExJU0VDT05EXSA9IHRvSW50KCgnMC4nICsgaW5wdXQpICogMTAwMCk7CiAgICAgIH0pOwoKICAgICAgLy8gTU9NRU5UUwoKICAgICAgdmFyIGdldFNldE1pbGxpc2Vjb25kID0gbWFrZUdldFNldCgnTWlsbGlzZWNvbmRzJywgZmFsc2UpOwoKICAgICAgYWRkRm9ybWF0VG9rZW4oJ3onLCAgMCwgMCwgJ3pvbmVBYmJyJyk7CiAgICAgIGFkZEZvcm1hdFRva2VuKCd6eicsIDAsIDAsICd6b25lTmFtZScpOwoKICAgICAgLy8gTU9NRU5UUwoKICAgICAgZnVuY3Rpb24gZ2V0Wm9uZUFiYnIgKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVVRDID8gJ1VUQycgOiAnJzsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0Wm9uZU5hbWUgKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVVRDID8gJ0Nvb3JkaW5hdGVkIFVuaXZlcnNhbCBUaW1lJyA6ICcnOwogICAgICB9CgogICAgICB2YXIgbW9tZW50UHJvdG90eXBlX19wcm90byA9IE1vbWVudC5wcm90b3R5cGU7CgogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmFkZCAgICAgICAgICA9IGFkZF9zdWJ0cmFjdF9fYWRkOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmNhbGVuZGFyICAgICA9IG1vbWVudF9jYWxlbmRhcl9fY2FsZW5kYXI7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uY2xvbmUgICAgICAgID0gY2xvbmU7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uZGlmZiAgICAgICAgID0gZGlmZjsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5lbmRPZiAgICAgICAgPSBlbmRPZjsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5mb3JtYXQgICAgICAgPSBmb3JtYXQ7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uZnJvbSAgICAgICAgID0gZnJvbTsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5mcm9tTm93ICAgICAgPSBmcm9tTm93OwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLnRvICAgICAgICAgICA9IHRvOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLnRvTm93ICAgICAgICA9IHRvTm93OwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmdldCAgICAgICAgICA9IGdldFNldDsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5pbnZhbGlkQXQgICAgPSBpbnZhbGlkQXQ7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uaXNBZnRlciAgICAgID0gaXNBZnRlcjsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5pc0JlZm9yZSAgICAgPSBpc0JlZm9yZTsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5pc0JldHdlZW4gICAgPSBpc0JldHdlZW47CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uaXNTYW1lICAgICAgID0gaXNTYW1lOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmlzVmFsaWQgICAgICA9IG1vbWVudF92YWxpZF9faXNWYWxpZDsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5sYW5nICAgICAgICAgPSBsYW5nOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmxvY2FsZSAgICAgICA9IGxvY2FsZTsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5sb2NhbGVEYXRhICAgPSBsb2NhbGVEYXRhOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLm1heCAgICAgICAgICA9IHByb3RvdHlwZU1heDsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5taW4gICAgICAgICAgPSBwcm90b3R5cGVNaW47CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8ucGFyc2luZ0ZsYWdzID0gcGFyc2luZ0ZsYWdzOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLnNldCAgICAgICAgICA9IGdldFNldDsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5zdGFydE9mICAgICAgPSBzdGFydE9mOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLnN1YnRyYWN0ICAgICA9IGFkZF9zdWJ0cmFjdF9fc3VidHJhY3Q7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8udG9BcnJheSAgICAgID0gdG9BcnJheTsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by50b0RhdGUgICAgICAgPSB0b0RhdGU7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8udG9JU09TdHJpbmcgID0gbW9tZW50X2Zvcm1hdF9fdG9JU09TdHJpbmc7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8udG9KU09OICAgICAgID0gbW9tZW50X2Zvcm1hdF9fdG9JU09TdHJpbmc7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8udG9TdHJpbmcgICAgID0gdG9TdHJpbmc7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8udW5peCAgICAgICAgID0gdW5peDsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by52YWx1ZU9mICAgICAgPSB0b190eXBlX192YWx1ZU9mOwoKICAgICAgLy8gWWVhcgogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLnllYXIgICAgICAgPSBnZXRTZXRZZWFyOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmlzTGVhcFllYXIgPSBnZXRJc0xlYXBZZWFyOwoKICAgICAgLy8gV2VlayBZZWFyCiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8ud2Vla1llYXIgICAgPSBnZXRTZXRXZWVrWWVhcjsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5pc29XZWVrWWVhciA9IGdldFNldElTT1dlZWtZZWFyOwoKICAgICAgLy8gUXVhcnRlcgogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLnF1YXJ0ZXIgPSBtb21lbnRQcm90b3R5cGVfX3Byb3RvLnF1YXJ0ZXJzID0gZ2V0U2V0UXVhcnRlcjsKCiAgICAgIC8vIE1vbnRoCiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8ubW9udGggICAgICAgPSBnZXRTZXRNb250aDsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5kYXlzSW5Nb250aCA9IGdldERheXNJbk1vbnRoOwoKICAgICAgLy8gV2VlawogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLndlZWsgICAgICAgICAgID0gbW9tZW50UHJvdG90eXBlX19wcm90by53ZWVrcyAgICAgICAgPSBnZXRTZXRXZWVrOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmlzb1dlZWsgICAgICAgID0gbW9tZW50UHJvdG90eXBlX19wcm90by5pc29XZWVrcyAgICAgPSBnZXRTZXRJU09XZWVrOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLndlZWtzSW5ZZWFyICAgID0gZ2V0V2Vla3NJblllYXI7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uaXNvV2Vla3NJblllYXIgPSBnZXRJU09XZWVrc0luWWVhcjsKCiAgICAgIC8vIERheQogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmRhdGUgICAgICAgPSBnZXRTZXREYXlPZk1vbnRoOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmRheSAgICAgICAgPSBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmRheXMgICAgICAgICAgICAgPSBnZXRTZXREYXlPZldlZWs7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8ud2Vla2RheSAgICA9IGdldFNldExvY2FsZURheU9mV2VlazsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5pc29XZWVrZGF5ID0gZ2V0U2V0SVNPRGF5T2ZXZWVrOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmRheU9mWWVhciAgPSBnZXRTZXREYXlPZlllYXI7CgogICAgICAvLyBIb3VyCiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uaG91ciA9IG1vbWVudFByb3RvdHlwZV9fcHJvdG8uaG91cnMgPSBnZXRTZXRIb3VyOwoKICAgICAgLy8gTWludXRlCiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8ubWludXRlID0gbW9tZW50UHJvdG90eXBlX19wcm90by5taW51dGVzID0gZ2V0U2V0TWludXRlOwoKICAgICAgLy8gU2Vjb25kCiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uc2Vjb25kID0gbW9tZW50UHJvdG90eXBlX19wcm90by5zZWNvbmRzID0gZ2V0U2V0U2Vjb25kOwoKICAgICAgLy8gTWlsbGlzZWNvbmQKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5taWxsaXNlY29uZCA9IG1vbWVudFByb3RvdHlwZV9fcHJvdG8ubWlsbGlzZWNvbmRzID0gZ2V0U2V0TWlsbGlzZWNvbmQ7CgogICAgICAvLyBPZmZzZXQKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by51dGNPZmZzZXQgICAgICAgICAgICA9IGdldFNldE9mZnNldDsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by51dGMgICAgICAgICAgICAgICAgICA9IHNldE9mZnNldFRvVVRDOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmxvY2FsICAgICAgICAgICAgICAgID0gc2V0T2Zmc2V0VG9Mb2NhbDsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5wYXJzZVpvbmUgICAgICAgICAgICA9IHNldE9mZnNldFRvUGFyc2VkT2Zmc2V0OwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmhhc0FsaWduZWRIb3VyT2Zmc2V0ID0gaGFzQWxpZ25lZEhvdXJPZmZzZXQ7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uaXNEU1QgICAgICAgICAgICAgICAgPSBpc0RheWxpZ2h0U2F2aW5nVGltZTsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5pc0RTVFNoaWZ0ZWQgICAgICAgICA9IGlzRGF5bGlnaHRTYXZpbmdUaW1lU2hpZnRlZDsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5pc0xvY2FsICAgICAgICAgICAgICA9IGlzTG9jYWw7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uaXNVdGNPZmZzZXQgICAgICAgICAgPSBpc1V0Y09mZnNldDsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5pc1V0YyAgICAgICAgICAgICAgICA9IGlzVXRjOwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmlzVVRDICAgICAgICAgICAgICAgID0gaXNVdGM7CgogICAgICAvLyBUaW1lem9uZQogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLnpvbmVBYmJyID0gZ2V0Wm9uZUFiYnI7CiAgICAgIG1vbWVudFByb3RvdHlwZV9fcHJvdG8uem9uZU5hbWUgPSBnZXRab25lTmFtZTsKCiAgICAgIC8vIERlcHJlY2F0aW9ucwogICAgICBtb21lbnRQcm90b3R5cGVfX3Byb3RvLmRhdGVzICA9IGRlcHJlY2F0ZSgnZGF0ZXMgYWNjZXNzb3IgaXMgZGVwcmVjYXRlZC4gVXNlIGRhdGUgaW5zdGVhZC4nLCBnZXRTZXREYXlPZk1vbnRoKTsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by5tb250aHMgPSBkZXByZWNhdGUoJ21vbnRocyBhY2Nlc3NvciBpcyBkZXByZWNhdGVkLiBVc2UgbW9udGggaW5zdGVhZCcsIGdldFNldE1vbnRoKTsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by55ZWFycyAgPSBkZXByZWNhdGUoJ3llYXJzIGFjY2Vzc29yIGlzIGRlcHJlY2F0ZWQuIFVzZSB5ZWFyIGluc3RlYWQnLCBnZXRTZXRZZWFyKTsKICAgICAgbW9tZW50UHJvdG90eXBlX19wcm90by56b25lICAgPSBkZXByZWNhdGUoJ21vbWVudCgpLnpvbmUgaXMgZGVwcmVjYXRlZCwgdXNlIG1vbWVudCgpLnV0Y09mZnNldCBpbnN0ZWFkLiBodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9pc3N1ZXMvMTc3OScsIGdldFNldFpvbmUpOwoKICAgICAgdmFyIG1vbWVudFByb3RvdHlwZSA9IG1vbWVudFByb3RvdHlwZV9fcHJvdG87CgogICAgICBmdW5jdGlvbiBtb21lbnRfX2NyZWF0ZVVuaXggKGlucHV0KSB7CiAgICAgICAgICByZXR1cm4gbG9jYWxfX2NyZWF0ZUxvY2FsKGlucHV0ICogMTAwMCk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIG1vbWVudF9fY3JlYXRlSW5ab25lICgpIHsKICAgICAgICAgIHJldHVybiBsb2NhbF9fY3JlYXRlTG9jYWwuYXBwbHkobnVsbCwgYXJndW1lbnRzKS5wYXJzZVpvbmUoKTsKICAgICAgfQoKICAgICAgdmFyIGRlZmF1bHRDYWxlbmRhciA9IHsKICAgICAgICAgIHNhbWVEYXkgOiAnW1RvZGF5IGF0XSBMVCcsCiAgICAgICAgICBuZXh0RGF5IDogJ1tUb21vcnJvdyBhdF0gTFQnLAogICAgICAgICAgbmV4dFdlZWsgOiAnZGRkZCBbYXRdIExUJywKICAgICAgICAgIGxhc3REYXkgOiAnW1llc3RlcmRheSBhdF0gTFQnLAogICAgICAgICAgbGFzdFdlZWsgOiAnW0xhc3RdIGRkZGQgW2F0XSBMVCcsCiAgICAgICAgICBzYW1lRWxzZSA6ICdMJwogICAgICB9OwoKICAgICAgZnVuY3Rpb24gbG9jYWxlX2NhbGVuZGFyX19jYWxlbmRhciAoa2V5LCBtb20sIG5vdykgewogICAgICAgICAgdmFyIG91dHB1dCA9IHRoaXMuX2NhbGVuZGFyW2tleV07CiAgICAgICAgICByZXR1cm4gdHlwZW9mIG91dHB1dCA9PT0gJ2Z1bmN0aW9uJyA/IG91dHB1dC5jYWxsKG1vbSwgbm93KSA6IG91dHB1dDsKICAgICAgfQoKICAgICAgdmFyIGRlZmF1bHRMb25nRGF0ZUZvcm1hdCA9IHsKICAgICAgICAgIExUUyAgOiAnaDptbTpzcyBBJywKICAgICAgICAgIExUICAgOiAnaDptbSBBJywKICAgICAgICAgIEwgICAgOiAnTU0vREQvWVlZWScsCiAgICAgICAgICBMTCAgIDogJ01NTU0gRCwgWVlZWScsCiAgICAgICAgICBMTEwgIDogJ01NTU0gRCwgWVlZWSBMVCcsCiAgICAgICAgICBMTExMIDogJ2RkZGQsIE1NTU0gRCwgWVlZWSBMVCcKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIGxvbmdEYXRlRm9ybWF0IChrZXkpIHsKICAgICAgICAgIHZhciBvdXRwdXQgPSB0aGlzLl9sb25nRGF0ZUZvcm1hdFtrZXldOwogICAgICAgICAgaWYgKCFvdXRwdXQgJiYgdGhpcy5fbG9uZ0RhdGVGb3JtYXRba2V5LnRvVXBwZXJDYXNlKCldKSB7CiAgICAgICAgICAgICAgb3V0cHV0ID0gdGhpcy5fbG9uZ0RhdGVGb3JtYXRba2V5LnRvVXBwZXJDYXNlKCldLnJlcGxhY2UoL01NTU18TU18RER8ZGRkZC9nLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB2YWwuc2xpY2UoMSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy5fbG9uZ0RhdGVGb3JtYXRba2V5XSA9IG91dHB1dDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgIH0KCiAgICAgIHZhciBkZWZhdWx0SW52YWxpZERhdGUgPSAnSW52YWxpZCBkYXRlJzsKCiAgICAgIGZ1bmN0aW9uIGludmFsaWREYXRlICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9pbnZhbGlkRGF0ZTsKICAgICAgfQoKICAgICAgdmFyIGRlZmF1bHRPcmRpbmFsID0gJyVkJzsKICAgICAgdmFyIGRlZmF1bHRPcmRpbmFsUGFyc2UgPSAvXGR7MSwyfS87CgogICAgICBmdW5jdGlvbiBvcmRpbmFsIChudW1iZXIpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRpbmFsLnJlcGxhY2UoJyVkJywgbnVtYmVyKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcHJlUGFyc2VQb3N0Rm9ybWF0IChzdHJpbmcpIHsKICAgICAgICAgIHJldHVybiBzdHJpbmc7CiAgICAgIH0KCiAgICAgIHZhciBkZWZhdWx0UmVsYXRpdmVUaW1lID0gewogICAgICAgICAgZnV0dXJlIDogJ2luICVzJywKICAgICAgICAgIHBhc3QgICA6ICclcyBhZ28nLAogICAgICAgICAgcyAgOiAnYSBmZXcgc2Vjb25kcycsCiAgICAgICAgICBtICA6ICdhIG1pbnV0ZScsCiAgICAgICAgICBtbSA6ICclZCBtaW51dGVzJywKICAgICAgICAgIGggIDogJ2FuIGhvdXInLAogICAgICAgICAgaGggOiAnJWQgaG91cnMnLAogICAgICAgICAgZCAgOiAnYSBkYXknLAogICAgICAgICAgZGQgOiAnJWQgZGF5cycsCiAgICAgICAgICBNICA6ICdhIG1vbnRoJywKICAgICAgICAgIE1NIDogJyVkIG1vbnRocycsCiAgICAgICAgICB5ICA6ICdhIHllYXInLAogICAgICAgICAgeXkgOiAnJWQgeWVhcnMnCiAgICAgIH07CgogICAgICBmdW5jdGlvbiByZWxhdGl2ZV9fcmVsYXRpdmVUaW1lIChudW1iZXIsIHdpdGhvdXRTdWZmaXgsIHN0cmluZywgaXNGdXR1cmUpIHsKICAgICAgICAgIHZhciBvdXRwdXQgPSB0aGlzLl9yZWxhdGl2ZVRpbWVbc3RyaW5nXTsKICAgICAgICAgIHJldHVybiAodHlwZW9mIG91dHB1dCA9PT0gJ2Z1bmN0aW9uJykgPwogICAgICAgICAgICAgIG91dHB1dChudW1iZXIsIHdpdGhvdXRTdWZmaXgsIHN0cmluZywgaXNGdXR1cmUpIDoKICAgICAgICAgICAgICBvdXRwdXQucmVwbGFjZSgvJWQvaSwgbnVtYmVyKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcGFzdEZ1dHVyZSAoZGlmZiwgb3V0cHV0KSB7CiAgICAgICAgICB2YXIgZm9ybWF0ID0gdGhpcy5fcmVsYXRpdmVUaW1lW2RpZmYgPiAwID8gJ2Z1dHVyZScgOiAncGFzdCddOwogICAgICAgICAgcmV0dXJuIHR5cGVvZiBmb3JtYXQgPT09ICdmdW5jdGlvbicgPyBmb3JtYXQob3V0cHV0KSA6IGZvcm1hdC5yZXBsYWNlKC8lcy9pLCBvdXRwdXQpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBsb2NhbGVfc2V0X19zZXQgKGNvbmZpZykgewogICAgICAgICAgdmFyIHByb3AsIGk7CiAgICAgICAgICBmb3IgKGkgaW4gY29uZmlnKSB7CiAgICAgICAgICAgICAgcHJvcCA9IGNvbmZpZ1tpXTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHByb3AgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgdGhpc1tpXSA9IHByb3A7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhpc1snXycgKyBpXSA9IHByb3A7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy8gTGVuaWVudCBvcmRpbmFsIHBhcnNpbmcgYWNjZXB0cyBqdXN0IGEgbnVtYmVyIGluIGFkZGl0aW9uIHRvCiAgICAgICAgICAvLyBudW1iZXIgKyAocG9zc2libHkpIHN0dWZmIGNvbWluZyBmcm9tIF9vcmRpbmFsUGFyc2VMZW5pZW50LgogICAgICAgICAgdGhpcy5fb3JkaW5hbFBhcnNlTGVuaWVudCA9IG5ldyBSZWdFeHAodGhpcy5fb3JkaW5hbFBhcnNlLnNvdXJjZSArICd8JyArICgvXGR7MSwyfS8pLnNvdXJjZSk7CiAgICAgIH0KCiAgICAgIHZhciBwcm90b3R5cGVfX3Byb3RvID0gTG9jYWxlLnByb3RvdHlwZTsKCiAgICAgIHByb3RvdHlwZV9fcHJvdG8uX2NhbGVuZGFyICAgICAgID0gZGVmYXVsdENhbGVuZGFyOwogICAgICBwcm90b3R5cGVfX3Byb3RvLmNhbGVuZGFyICAgICAgICA9IGxvY2FsZV9jYWxlbmRhcl9fY2FsZW5kYXI7CiAgICAgIHByb3RvdHlwZV9fcHJvdG8uX2xvbmdEYXRlRm9ybWF0ID0gZGVmYXVsdExvbmdEYXRlRm9ybWF0OwogICAgICBwcm90b3R5cGVfX3Byb3RvLmxvbmdEYXRlRm9ybWF0ICA9IGxvbmdEYXRlRm9ybWF0OwogICAgICBwcm90b3R5cGVfX3Byb3RvLl9pbnZhbGlkRGF0ZSAgICA9IGRlZmF1bHRJbnZhbGlkRGF0ZTsKICAgICAgcHJvdG90eXBlX19wcm90by5pbnZhbGlkRGF0ZSAgICAgPSBpbnZhbGlkRGF0ZTsKICAgICAgcHJvdG90eXBlX19wcm90by5fb3JkaW5hbCAgICAgICAgPSBkZWZhdWx0T3JkaW5hbDsKICAgICAgcHJvdG90eXBlX19wcm90by5vcmRpbmFsICAgICAgICAgPSBvcmRpbmFsOwogICAgICBwcm90b3R5cGVfX3Byb3RvLl9vcmRpbmFsUGFyc2UgICA9IGRlZmF1bHRPcmRpbmFsUGFyc2U7CiAgICAgIHByb3RvdHlwZV9fcHJvdG8ucHJlcGFyc2UgICAgICAgID0gcHJlUGFyc2VQb3N0Rm9ybWF0OwogICAgICBwcm90b3R5cGVfX3Byb3RvLnBvc3Rmb3JtYXQgICAgICA9IHByZVBhcnNlUG9zdEZvcm1hdDsKICAgICAgcHJvdG90eXBlX19wcm90by5fcmVsYXRpdmVUaW1lICAgPSBkZWZhdWx0UmVsYXRpdmVUaW1lOwogICAgICBwcm90b3R5cGVfX3Byb3RvLnJlbGF0aXZlVGltZSAgICA9IHJlbGF0aXZlX19yZWxhdGl2ZVRpbWU7CiAgICAgIHByb3RvdHlwZV9fcHJvdG8ucGFzdEZ1dHVyZSAgICAgID0gcGFzdEZ1dHVyZTsKICAgICAgcHJvdG90eXBlX19wcm90by5zZXQgICAgICAgICAgICAgPSBsb2NhbGVfc2V0X19zZXQ7CgogICAgICAvLyBNb250aAogICAgICBwcm90b3R5cGVfX3Byb3RvLm1vbnRocyAgICAgICA9ICAgICAgICBsb2NhbGVNb250aHM7CiAgICAgIHByb3RvdHlwZV9fcHJvdG8uX21vbnRocyAgICAgID0gZGVmYXVsdExvY2FsZU1vbnRoczsKICAgICAgcHJvdG90eXBlX19wcm90by5tb250aHNTaG9ydCAgPSAgICAgICAgbG9jYWxlTW9udGhzU2hvcnQ7CiAgICAgIHByb3RvdHlwZV9fcHJvdG8uX21vbnRoc1Nob3J0ID0gZGVmYXVsdExvY2FsZU1vbnRoc1Nob3J0OwogICAgICBwcm90b3R5cGVfX3Byb3RvLm1vbnRoc1BhcnNlICA9ICAgICAgICBsb2NhbGVNb250aHNQYXJzZTsKCiAgICAgIC8vIFdlZWsKICAgICAgcHJvdG90eXBlX19wcm90by53ZWVrID0gbG9jYWxlV2VlazsKICAgICAgcHJvdG90eXBlX19wcm90by5fd2VlayA9IGRlZmF1bHRMb2NhbGVXZWVrOwogICAgICBwcm90b3R5cGVfX3Byb3RvLmZpcnN0RGF5T2ZZZWFyID0gbG9jYWxlRmlyc3REYXlPZlllYXI7CiAgICAgIHByb3RvdHlwZV9fcHJvdG8uZmlyc3REYXlPZldlZWsgPSBsb2NhbGVGaXJzdERheU9mV2VlazsKCiAgICAgIC8vIERheSBvZiBXZWVrCiAgICAgIHByb3RvdHlwZV9fcHJvdG8ud2Vla2RheXMgICAgICAgPSAgICAgICAgbG9jYWxlV2Vla2RheXM7CiAgICAgIHByb3RvdHlwZV9fcHJvdG8uX3dlZWtkYXlzICAgICAgPSBkZWZhdWx0TG9jYWxlV2Vla2RheXM7CiAgICAgIHByb3RvdHlwZV9fcHJvdG8ud2Vla2RheXNNaW4gICAgPSAgICAgICAgbG9jYWxlV2Vla2RheXNNaW47CiAgICAgIHByb3RvdHlwZV9fcHJvdG8uX3dlZWtkYXlzTWluICAgPSBkZWZhdWx0TG9jYWxlV2Vla2RheXNNaW47CiAgICAgIHByb3RvdHlwZV9fcHJvdG8ud2Vla2RheXNTaG9ydCAgPSAgICAgICAgbG9jYWxlV2Vla2RheXNTaG9ydDsKICAgICAgcHJvdG90eXBlX19wcm90by5fd2Vla2RheXNTaG9ydCA9IGRlZmF1bHRMb2NhbGVXZWVrZGF5c1Nob3J0OwogICAgICBwcm90b3R5cGVfX3Byb3RvLndlZWtkYXlzUGFyc2UgID0gICAgICAgIGxvY2FsZVdlZWtkYXlzUGFyc2U7CgogICAgICAvLyBIb3VycwogICAgICBwcm90b3R5cGVfX3Byb3RvLmlzUE0gPSBsb2NhbGVJc1BNOwogICAgICBwcm90b3R5cGVfX3Byb3RvLl9tZXJpZGllbVBhcnNlID0gZGVmYXVsdExvY2FsZU1lcmlkaWVtUGFyc2U7CiAgICAgIHByb3RvdHlwZV9fcHJvdG8ubWVyaWRpZW0gPSBsb2NhbGVNZXJpZGllbTsKCiAgICAgIGZ1bmN0aW9uIGxpc3RzX19nZXQgKGZvcm1hdCwgaW5kZXgsIGZpZWxkLCBzZXR0ZXIpIHsKICAgICAgICAgIHZhciBsb2NhbGUgPSBsb2NhbGVfbG9jYWxlc19fZ2V0TG9jYWxlKCk7CiAgICAgICAgICB2YXIgdXRjID0gY3JlYXRlX3V0Y19fY3JlYXRlVVRDKCkuc2V0KHNldHRlciwgaW5kZXgpOwogICAgICAgICAgcmV0dXJuIGxvY2FsZVtmaWVsZF0odXRjLCBmb3JtYXQpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBsaXN0IChmb3JtYXQsIGluZGV4LCBmaWVsZCwgY291bnQsIHNldHRlcikgewogICAgICAgICAgaWYgKHR5cGVvZiBmb3JtYXQgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgaW5kZXggPSBmb3JtYXQ7CiAgICAgICAgICAgICAgZm9ybWF0ID0gdW5kZWZpbmVkOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcm1hdCA9IGZvcm1hdCB8fCAnJzsKCiAgICAgICAgICBpZiAoaW5kZXggIT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBsaXN0c19fZ2V0KGZvcm1hdCwgaW5kZXgsIGZpZWxkLCBzZXR0ZXIpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpOwogICAgICAgICAgdmFyIG91dCA9IFtdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICBvdXRbaV0gPSBsaXN0c19fZ2V0KGZvcm1hdCwgaSwgZmllbGQsIHNldHRlcik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gb3V0OwogICAgICB9CgogICAgICBmdW5jdGlvbiBsaXN0c19fbGlzdE1vbnRocyAoZm9ybWF0LCBpbmRleCkgewogICAgICAgICAgcmV0dXJuIGxpc3QoZm9ybWF0LCBpbmRleCwgJ21vbnRocycsIDEyLCAnbW9udGgnKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbGlzdHNfX2xpc3RNb250aHNTaG9ydCAoZm9ybWF0LCBpbmRleCkgewogICAgICAgICAgcmV0dXJuIGxpc3QoZm9ybWF0LCBpbmRleCwgJ21vbnRoc1Nob3J0JywgMTIsICdtb250aCcpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBsaXN0c19fbGlzdFdlZWtkYXlzIChmb3JtYXQsIGluZGV4KSB7CiAgICAgICAgICByZXR1cm4gbGlzdChmb3JtYXQsIGluZGV4LCAnd2Vla2RheXMnLCA3LCAnZGF5Jyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGxpc3RzX19saXN0V2Vla2RheXNTaG9ydCAoZm9ybWF0LCBpbmRleCkgewogICAgICAgICAgcmV0dXJuIGxpc3QoZm9ybWF0LCBpbmRleCwgJ3dlZWtkYXlzU2hvcnQnLCA3LCAnZGF5Jyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGxpc3RzX19saXN0V2Vla2RheXNNaW4gKGZvcm1hdCwgaW5kZXgpIHsKICAgICAgICAgIHJldHVybiBsaXN0KGZvcm1hdCwgaW5kZXgsICd3ZWVrZGF5c01pbicsIDcsICdkYXknKTsKICAgICAgfQoKICAgICAgbG9jYWxlX2xvY2FsZXNfX2dldFNldEdsb2JhbExvY2FsZSgnZW4nLCB7CiAgICAgICAgICBvcmRpbmFsUGFyc2U6IC9cZHsxLDJ9KHRofHN0fG5kfHJkKS8sCiAgICAgICAgICBvcmRpbmFsIDogZnVuY3Rpb24gKG51bWJlcikgewogICAgICAgICAgICAgIHZhciBiID0gbnVtYmVyICUgMTAsCiAgICAgICAgICAgICAgICAgIG91dHB1dCA9ICh0b0ludChudW1iZXIgJSAxMDAgLyAxMCkgPT09IDEpID8gJ3RoJyA6CiAgICAgICAgICAgICAgICAgIChiID09PSAxKSA/ICdzdCcgOgogICAgICAgICAgICAgICAgICAoYiA9PT0gMikgPyAnbmQnIDoKICAgICAgICAgICAgICAgICAgKGIgPT09IDMpID8gJ3JkJyA6ICd0aCc7CiAgICAgICAgICAgICAgcmV0dXJuIG51bWJlciArIG91dHB1dDsKICAgICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyBTaWRlIGVmZmVjdCBpbXBvcnRzCiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5sYW5nID0gZGVwcmVjYXRlKCdtb21lbnQubGFuZyBpcyBkZXByZWNhdGVkLiBVc2UgbW9tZW50LmxvY2FsZSBpbnN0ZWFkLicsIGxvY2FsZV9sb2NhbGVzX19nZXRTZXRHbG9iYWxMb2NhbGUpOwogICAgICB1dGlsc19ob29rc19faG9va3MubGFuZ0RhdGEgPSBkZXByZWNhdGUoJ21vbWVudC5sYW5nRGF0YSBpcyBkZXByZWNhdGVkLiBVc2UgbW9tZW50LmxvY2FsZURhdGEgaW5zdGVhZC4nLCBsb2NhbGVfbG9jYWxlc19fZ2V0TG9jYWxlKTsKCiAgICAgIHZhciBtYXRoQWJzID0gTWF0aC5hYnM7CgogICAgICBmdW5jdGlvbiBkdXJhdGlvbl9hYnNfX2FicyAoKSB7CiAgICAgICAgICB2YXIgZGF0YSAgICAgICAgICAgPSB0aGlzLl9kYXRhOwoKICAgICAgICAgIHRoaXMuX21pbGxpc2Vjb25kcyA9IG1hdGhBYnModGhpcy5fbWlsbGlzZWNvbmRzKTsKICAgICAgICAgIHRoaXMuX2RheXMgICAgICAgICA9IG1hdGhBYnModGhpcy5fZGF5cyk7CiAgICAgICAgICB0aGlzLl9tb250aHMgICAgICAgPSBtYXRoQWJzKHRoaXMuX21vbnRocyk7CgogICAgICAgICAgZGF0YS5taWxsaXNlY29uZHMgID0gbWF0aEFicyhkYXRhLm1pbGxpc2Vjb25kcyk7CiAgICAgICAgICBkYXRhLnNlY29uZHMgICAgICAgPSBtYXRoQWJzKGRhdGEuc2Vjb25kcyk7CiAgICAgICAgICBkYXRhLm1pbnV0ZXMgICAgICAgPSBtYXRoQWJzKGRhdGEubWludXRlcyk7CiAgICAgICAgICBkYXRhLmhvdXJzICAgICAgICAgPSBtYXRoQWJzKGRhdGEuaG91cnMpOwogICAgICAgICAgZGF0YS5tb250aHMgICAgICAgID0gbWF0aEFicyhkYXRhLm1vbnRocyk7CiAgICAgICAgICBkYXRhLnllYXJzICAgICAgICAgPSBtYXRoQWJzKGRhdGEueWVhcnMpOwoKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkdXJhdGlvbl9hZGRfc3VidHJhY3RfX2FkZFN1YnRyYWN0IChkdXJhdGlvbiwgaW5wdXQsIHZhbHVlLCBkaXJlY3Rpb24pIHsKICAgICAgICAgIHZhciBvdGhlciA9IGNyZWF0ZV9fY3JlYXRlRHVyYXRpb24oaW5wdXQsIHZhbHVlKTsKCiAgICAgICAgICBkdXJhdGlvbi5fbWlsbGlzZWNvbmRzICs9IGRpcmVjdGlvbiAqIG90aGVyLl9taWxsaXNlY29uZHM7CiAgICAgICAgICBkdXJhdGlvbi5fZGF5cyAgICAgICAgICs9IGRpcmVjdGlvbiAqIG90aGVyLl9kYXlzOwogICAgICAgICAgZHVyYXRpb24uX21vbnRocyAgICAgICArPSBkaXJlY3Rpb24gKiBvdGhlci5fbW9udGhzOwoKICAgICAgICAgIHJldHVybiBkdXJhdGlvbi5fYnViYmxlKCk7CiAgICAgIH0KCiAgICAgIC8vIHN1cHBvcnRzIG9ubHkgMi4wLXN0eWxlIGFkZCgxLCAncycpIG9yIGFkZChkdXJhdGlvbikKICAgICAgZnVuY3Rpb24gZHVyYXRpb25fYWRkX3N1YnRyYWN0X19hZGQgKGlucHV0LCB2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIGR1cmF0aW9uX2FkZF9zdWJ0cmFjdF9fYWRkU3VidHJhY3QodGhpcywgaW5wdXQsIHZhbHVlLCAxKTsKICAgICAgfQoKICAgICAgLy8gc3VwcG9ydHMgb25seSAyLjAtc3R5bGUgc3VidHJhY3QoMSwgJ3MnKSBvciBzdWJ0cmFjdChkdXJhdGlvbikKICAgICAgZnVuY3Rpb24gZHVyYXRpb25fYWRkX3N1YnRyYWN0X19zdWJ0cmFjdCAoaW5wdXQsIHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gZHVyYXRpb25fYWRkX3N1YnRyYWN0X19hZGRTdWJ0cmFjdCh0aGlzLCBpbnB1dCwgdmFsdWUsIC0xKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYnViYmxlICgpIHsKICAgICAgICAgIHZhciBtaWxsaXNlY29uZHMgPSB0aGlzLl9taWxsaXNlY29uZHM7CiAgICAgICAgICB2YXIgZGF5cyAgICAgICAgID0gdGhpcy5fZGF5czsKICAgICAgICAgIHZhciBtb250aHMgICAgICAgPSB0aGlzLl9tb250aHM7CiAgICAgICAgICB2YXIgZGF0YSAgICAgICAgID0gdGhpcy5fZGF0YTsKICAgICAgICAgIHZhciBzZWNvbmRzLCBtaW51dGVzLCBob3VycywgeWVhcnMgPSAwOwoKICAgICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgY29kZSBidWJibGVzIHVwIHZhbHVlcywgc2VlIHRoZSB0ZXN0cyBmb3IKICAgICAgICAgIC8vIGV4YW1wbGVzIG9mIHdoYXQgdGhhdCBtZWFucy4KICAgICAgICAgIGRhdGEubWlsbGlzZWNvbmRzID0gbWlsbGlzZWNvbmRzICUgMTAwMDsKCiAgICAgICAgICBzZWNvbmRzICAgICAgICAgICA9IGFic0Zsb29yKG1pbGxpc2Vjb25kcyAvIDEwMDApOwogICAgICAgICAgZGF0YS5zZWNvbmRzICAgICAgPSBzZWNvbmRzICUgNjA7CgogICAgICAgICAgbWludXRlcyAgICAgICAgICAgPSBhYnNGbG9vcihzZWNvbmRzIC8gNjApOwogICAgICAgICAgZGF0YS5taW51dGVzICAgICAgPSBtaW51dGVzICUgNjA7CgogICAgICAgICAgaG91cnMgICAgICAgICAgICAgPSBhYnNGbG9vcihtaW51dGVzIC8gNjApOwogICAgICAgICAgZGF0YS5ob3VycyAgICAgICAgPSBob3VycyAlIDI0OwoKICAgICAgICAgIGRheXMgKz0gYWJzRmxvb3IoaG91cnMgLyAyNCk7CgogICAgICAgICAgLy8gQWNjdXJhdGVseSBjb252ZXJ0IGRheXMgdG8geWVhcnMsIGFzc3VtZSBzdGFydCBmcm9tIHllYXIgMC4KICAgICAgICAgIHllYXJzID0gYWJzRmxvb3IoZGF5c1RvWWVhcnMoZGF5cykpOwogICAgICAgICAgZGF5cyAtPSBhYnNGbG9vcih5ZWFyc1RvRGF5cyh5ZWFycykpOwoKICAgICAgICAgIC8vIDMwIGRheXMgdG8gYSBtb250aAogICAgICAgICAgLy8gVE9ETyAoaXNrcmVuKTogVXNlIGFuY2hvciBkYXRlIChsaWtlIDFzdCBKYW4pIHRvIGNvbXB1dGUgdGhpcy4KICAgICAgICAgIG1vbnRocyArPSBhYnNGbG9vcihkYXlzIC8gMzApOwogICAgICAgICAgZGF5cyAgICU9IDMwOwoKICAgICAgICAgIC8vIDEyIG1vbnRocyAtPiAxIHllYXIKICAgICAgICAgIHllYXJzICArPSBhYnNGbG9vcihtb250aHMgLyAxMik7CiAgICAgICAgICBtb250aHMgJT0gMTI7CgogICAgICAgICAgZGF0YS5kYXlzICAgPSBkYXlzOwogICAgICAgICAgZGF0YS5tb250aHMgPSBtb250aHM7CiAgICAgICAgICBkYXRhLnllYXJzICA9IHllYXJzOwoKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkYXlzVG9ZZWFycyAoZGF5cykgewogICAgICAgICAgLy8gNDAwIHllYXJzIGhhdmUgMTQ2MDk3IGRheXMgKHRha2luZyBpbnRvIGFjY291bnQgbGVhcCB5ZWFyIHJ1bGVzKQogICAgICAgICAgcmV0dXJuIGRheXMgKiA0MDAgLyAxNDYwOTc7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHllYXJzVG9EYXlzICh5ZWFycykgewogICAgICAgICAgLy8geWVhcnMgKiAzNjUgKyBhYnNGbG9vcih5ZWFycyAvIDQpIC0KICAgICAgICAgIC8vICAgICBhYnNGbG9vcih5ZWFycyAvIDEwMCkgKyBhYnNGbG9vcih5ZWFycyAvIDQwMCk7CiAgICAgICAgICByZXR1cm4geWVhcnMgKiAxNDYwOTcgLyA0MDA7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGFzICh1bml0cykgewogICAgICAgICAgdmFyIGRheXM7CiAgICAgICAgICB2YXIgbW9udGhzOwogICAgICAgICAgdmFyIG1pbGxpc2Vjb25kcyA9IHRoaXMuX21pbGxpc2Vjb25kczsKCiAgICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsKCiAgICAgICAgICBpZiAodW5pdHMgPT09ICdtb250aCcgfHwgdW5pdHMgPT09ICd5ZWFyJykgewogICAgICAgICAgICAgIGRheXMgICA9IHRoaXMuX2RheXMgICArIG1pbGxpc2Vjb25kcyAvIDg2NGU1OwogICAgICAgICAgICAgIG1vbnRocyA9IHRoaXMuX21vbnRocyArIGRheXNUb1llYXJzKGRheXMpICogMTI7CiAgICAgICAgICAgICAgcmV0dXJuIHVuaXRzID09PSAnbW9udGgnID8gbW9udGhzIDogbW9udGhzIC8gMTI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIGhhbmRsZSBtaWxsaXNlY29uZHMgc2VwYXJhdGVseSBiZWNhdXNlIG9mIGZsb2F0aW5nIHBvaW50IG1hdGggZXJyb3JzIChpc3N1ZSAjMTg2NykKICAgICAgICAgICAgICBkYXlzID0gdGhpcy5fZGF5cyArIE1hdGgucm91bmQoeWVhcnNUb0RheXModGhpcy5fbW9udGhzIC8gMTIpKTsKICAgICAgICAgICAgICBzd2l0Y2ggKHVuaXRzKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgJ3dlZWsnICAgOiByZXR1cm4gZGF5cyAvIDcgICAgICsgbWlsbGlzZWNvbmRzIC8gNjA0OGU1OwogICAgICAgICAgICAgICAgICBjYXNlICdkYXknICAgIDogcmV0dXJuIGRheXMgICAgICAgICArIG1pbGxpc2Vjb25kcyAvIDg2NGU1OwogICAgICAgICAgICAgICAgICBjYXNlICdob3VyJyAgIDogcmV0dXJuIGRheXMgKiAyNCAgICArIG1pbGxpc2Vjb25kcyAvIDM2ZTU7CiAgICAgICAgICAgICAgICAgIGNhc2UgJ21pbnV0ZScgOiByZXR1cm4gZGF5cyAqIDE0NDAgICsgbWlsbGlzZWNvbmRzIC8gNmU0OwogICAgICAgICAgICAgICAgICBjYXNlICdzZWNvbmQnIDogcmV0dXJuIGRheXMgKiA4NjQwMCArIG1pbGxpc2Vjb25kcyAvIDEwMDA7CiAgICAgICAgICAgICAgICAgIC8vIE1hdGguZmxvb3IgcHJldmVudHMgZmxvYXRpbmcgcG9pbnQgbWF0aCBlcnJvcnMgaGVyZQogICAgICAgICAgICAgICAgICBjYXNlICdtaWxsaXNlY29uZCc6IHJldHVybiBNYXRoLmZsb29yKGRheXMgKiA4NjRlNSkgKyBtaWxsaXNlY29uZHM7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcignVW5rbm93biB1bml0ICcgKyB1bml0cyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9CgogICAgICAvLyBUT0RPOiBVc2UgdGhpcy5hcygnbXMnKT8KICAgICAgZnVuY3Rpb24gZHVyYXRpb25fYXNfX3ZhbHVlT2YgKCkgewogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICB0aGlzLl9taWxsaXNlY29uZHMgKwogICAgICAgICAgICAgIHRoaXMuX2RheXMgKiA4NjRlNSArCiAgICAgICAgICAgICAgKHRoaXMuX21vbnRocyAlIDEyKSAqIDI1OTJlNiArCiAgICAgICAgICAgICAgdG9JbnQodGhpcy5fbW9udGhzIC8gMTIpICogMzE1MzZlNgogICAgICAgICAgKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gbWFrZUFzIChhbGlhcykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hcyhhbGlhcyk7CiAgICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgYXNNaWxsaXNlY29uZHMgPSBtYWtlQXMoJ21zJyk7CiAgICAgIHZhciBhc1NlY29uZHMgICAgICA9IG1ha2VBcygncycpOwogICAgICB2YXIgYXNNaW51dGVzICAgICAgPSBtYWtlQXMoJ20nKTsKICAgICAgdmFyIGFzSG91cnMgICAgICAgID0gbWFrZUFzKCdoJyk7CiAgICAgIHZhciBhc0RheXMgICAgICAgICA9IG1ha2VBcygnZCcpOwogICAgICB2YXIgYXNXZWVrcyAgICAgICAgPSBtYWtlQXMoJ3cnKTsKICAgICAgdmFyIGFzTW9udGhzICAgICAgID0gbWFrZUFzKCdNJyk7CiAgICAgIHZhciBhc1llYXJzICAgICAgICA9IG1ha2VBcygneScpOwoKICAgICAgZnVuY3Rpb24gZHVyYXRpb25fZ2V0X19nZXQgKHVuaXRzKSB7CiAgICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsKICAgICAgICAgIHJldHVybiB0aGlzW3VuaXRzICsgJ3MnXSgpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBtYWtlR2V0dGVyKG5hbWUpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGFbbmFtZV07CiAgICAgICAgICB9OwogICAgICB9CgogICAgICB2YXIgZHVyYXRpb25fZ2V0X19taWxsaXNlY29uZHMgPSBtYWtlR2V0dGVyKCdtaWxsaXNlY29uZHMnKTsKICAgICAgdmFyIHNlY29uZHMgICAgICA9IG1ha2VHZXR0ZXIoJ3NlY29uZHMnKTsKICAgICAgdmFyIG1pbnV0ZXMgICAgICA9IG1ha2VHZXR0ZXIoJ21pbnV0ZXMnKTsKICAgICAgdmFyIGhvdXJzICAgICAgICA9IG1ha2VHZXR0ZXIoJ2hvdXJzJyk7CiAgICAgIHZhciBkYXlzICAgICAgICAgPSBtYWtlR2V0dGVyKCdkYXlzJyk7CiAgICAgIHZhciBtb250aHMgICAgICAgPSBtYWtlR2V0dGVyKCdtb250aHMnKTsKICAgICAgdmFyIHllYXJzICAgICAgICA9IG1ha2VHZXR0ZXIoJ3llYXJzJyk7CgogICAgICBmdW5jdGlvbiB3ZWVrcyAoKSB7CiAgICAgICAgICByZXR1cm4gYWJzRmxvb3IodGhpcy5kYXlzKCkgLyA3KTsKICAgICAgfQoKICAgICAgdmFyIHJvdW5kID0gTWF0aC5yb3VuZDsKICAgICAgdmFyIHRocmVzaG9sZHMgPSB7CiAgICAgICAgICBzOiA0NSwgIC8vIHNlY29uZHMgdG8gbWludXRlCiAgICAgICAgICBtOiA0NSwgIC8vIG1pbnV0ZXMgdG8gaG91cgogICAgICAgICAgaDogMjIsICAvLyBob3VycyB0byBkYXkKICAgICAgICAgIGQ6IDI2LCAgLy8gZGF5cyB0byBtb250aAogICAgICAgICAgTTogMTEgICAvLyBtb250aHMgdG8geWVhcgogICAgICB9OwoKICAgICAgLy8gaGVscGVyIGZ1bmN0aW9uIGZvciBtb21lbnQuZm4uZnJvbSwgbW9tZW50LmZuLmZyb21Ob3csIGFuZCBtb21lbnQuZHVyYXRpb24uZm4uaHVtYW5pemUKICAgICAgZnVuY3Rpb24gc3Vic3RpdHV0ZVRpbWVBZ28oc3RyaW5nLCBudW1iZXIsIHdpdGhvdXRTdWZmaXgsIGlzRnV0dXJlLCBsb2NhbGUpIHsKICAgICAgICAgIHJldHVybiBsb2NhbGUucmVsYXRpdmVUaW1lKG51bWJlciB8fCAxLCAhIXdpdGhvdXRTdWZmaXgsIHN0cmluZywgaXNGdXR1cmUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBkdXJhdGlvbl9odW1hbml6ZV9fcmVsYXRpdmVUaW1lIChwb3NOZWdEdXJhdGlvbiwgd2l0aG91dFN1ZmZpeCwgbG9jYWxlKSB7CiAgICAgICAgICB2YXIgZHVyYXRpb24gPSBjcmVhdGVfX2NyZWF0ZUR1cmF0aW9uKHBvc05lZ0R1cmF0aW9uKS5hYnMoKTsKICAgICAgICAgIHZhciBzZWNvbmRzICA9IHJvdW5kKGR1cmF0aW9uLmFzKCdzJykpOwogICAgICAgICAgdmFyIG1pbnV0ZXMgID0gcm91bmQoZHVyYXRpb24uYXMoJ20nKSk7CiAgICAgICAgICB2YXIgaG91cnMgICAgPSByb3VuZChkdXJhdGlvbi5hcygnaCcpKTsKICAgICAgICAgIHZhciBkYXlzICAgICA9IHJvdW5kKGR1cmF0aW9uLmFzKCdkJykpOwogICAgICAgICAgdmFyIG1vbnRocyAgID0gcm91bmQoZHVyYXRpb24uYXMoJ00nKSk7CiAgICAgICAgICB2YXIgeWVhcnMgICAgPSByb3VuZChkdXJhdGlvbi5hcygneScpKTsKCiAgICAgICAgICB2YXIgYSA9IHNlY29uZHMgPCB0aHJlc2hvbGRzLnMgJiYgWydzJywgc2Vjb25kc10gIHx8CiAgICAgICAgICAgICAgICAgIG1pbnV0ZXMgPT09IDEgICAgICAgICAgJiYgWydtJ10gICAgICAgICAgIHx8CiAgICAgICAgICAgICAgICAgIG1pbnV0ZXMgPCB0aHJlc2hvbGRzLm0gJiYgWydtbScsIG1pbnV0ZXNdIHx8CiAgICAgICAgICAgICAgICAgIGhvdXJzICAgPT09IDEgICAgICAgICAgJiYgWydoJ10gICAgICAgICAgIHx8CiAgICAgICAgICAgICAgICAgIGhvdXJzICAgPCB0aHJlc2hvbGRzLmggJiYgWydoaCcsIGhvdXJzXSAgIHx8CiAgICAgICAgICAgICAgICAgIGRheXMgICAgPT09IDEgICAgICAgICAgJiYgWydkJ10gICAgICAgICAgIHx8CiAgICAgICAgICAgICAgICAgIGRheXMgICAgPCB0aHJlc2hvbGRzLmQgJiYgWydkZCcsIGRheXNdICAgIHx8CiAgICAgICAgICAgICAgICAgIG1vbnRocyAgPT09IDEgICAgICAgICAgJiYgWydNJ10gICAgICAgICAgIHx8CiAgICAgICAgICAgICAgICAgIG1vbnRocyAgPCB0aHJlc2hvbGRzLk0gJiYgWydNTScsIG1vbnRoc10gIHx8CiAgICAgICAgICAgICAgICAgIHllYXJzICAgPT09IDEgICAgICAgICAgJiYgWyd5J10gICAgICAgICAgIHx8IFsneXknLCB5ZWFyc107CgogICAgICAgICAgYVsyXSA9IHdpdGhvdXRTdWZmaXg7CiAgICAgICAgICBhWzNdID0gK3Bvc05lZ0R1cmF0aW9uID4gMDsKICAgICAgICAgIGFbNF0gPSBsb2NhbGU7CiAgICAgICAgICByZXR1cm4gc3Vic3RpdHV0ZVRpbWVBZ28uYXBwbHkobnVsbCwgYSk7CiAgICAgIH0KCiAgICAgIC8vIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHlvdSB0byBzZXQgYSB0aHJlc2hvbGQgZm9yIHJlbGF0aXZlIHRpbWUgc3RyaW5ncwogICAgICBmdW5jdGlvbiBkdXJhdGlvbl9odW1hbml6ZV9fZ2V0U2V0UmVsYXRpdmVUaW1lVGhyZXNob2xkICh0aHJlc2hvbGQsIGxpbWl0KSB7CiAgICAgICAgICBpZiAodGhyZXNob2xkc1t0aHJlc2hvbGRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobGltaXQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHJldHVybiB0aHJlc2hvbGRzW3RocmVzaG9sZF07CiAgICAgICAgICB9CiAgICAgICAgICB0aHJlc2hvbGRzW3RocmVzaG9sZF0gPSBsaW1pdDsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICBmdW5jdGlvbiBodW1hbml6ZSAod2l0aFN1ZmZpeCkgewogICAgICAgICAgdmFyIGxvY2FsZSA9IHRoaXMubG9jYWxlRGF0YSgpOwogICAgICAgICAgdmFyIG91dHB1dCA9IGR1cmF0aW9uX2h1bWFuaXplX19yZWxhdGl2ZVRpbWUodGhpcywgIXdpdGhTdWZmaXgsIGxvY2FsZSk7CgogICAgICAgICAgaWYgKHdpdGhTdWZmaXgpIHsKICAgICAgICAgICAgICBvdXRwdXQgPSBsb2NhbGUucGFzdEZ1dHVyZSgrdGhpcywgb3V0cHV0KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gbG9jYWxlLnBvc3Rmb3JtYXQob3V0cHV0KTsKICAgICAgfQoKICAgICAgdmFyIGlzb19zdHJpbmdfX2FicyA9IE1hdGguYWJzOwoKICAgICAgZnVuY3Rpb24gaXNvX3N0cmluZ19fdG9JU09TdHJpbmcoKSB7CiAgICAgICAgICAvLyBpbnNwaXJlZCBieSBodHRwczovL2dpdGh1Yi5jb20vZG9yZGlsbGUvbW9tZW50LWlzb2R1cmF0aW9uL2Jsb2IvbWFzdGVyL21vbWVudC5pc29kdXJhdGlvbi5qcwogICAgICAgICAgdmFyIFkgPSBpc29fc3RyaW5nX19hYnModGhpcy55ZWFycygpKTsKICAgICAgICAgIHZhciBNID0gaXNvX3N0cmluZ19fYWJzKHRoaXMubW9udGhzKCkpOwogICAgICAgICAgdmFyIEQgPSBpc29fc3RyaW5nX19hYnModGhpcy5kYXlzKCkpOwogICAgICAgICAgdmFyIGggPSBpc29fc3RyaW5nX19hYnModGhpcy5ob3VycygpKTsKICAgICAgICAgIHZhciBtID0gaXNvX3N0cmluZ19fYWJzKHRoaXMubWludXRlcygpKTsKICAgICAgICAgIHZhciBzID0gaXNvX3N0cmluZ19fYWJzKHRoaXMuc2Vjb25kcygpICsgdGhpcy5taWxsaXNlY29uZHMoKSAvIDEwMDApOwogICAgICAgICAgdmFyIHRvdGFsID0gdGhpcy5hc1NlY29uZHMoKTsKCiAgICAgICAgICBpZiAoIXRvdGFsKSB7CiAgICAgICAgICAgICAgLy8gdGhpcyBpcyB0aGUgc2FtZSBhcyBDIydzIChOb2RhKSBhbmQgcHl0aG9uIChpc29kYXRlKS4uLgogICAgICAgICAgICAgIC8vIGJ1dCBub3Qgb3RoZXIgSlMgKGdvb2cuZGF0ZSkKICAgICAgICAgICAgICByZXR1cm4gJ1AwRCc7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuICh0b3RhbCA8IDAgPyAnLScgOiAnJykgKwogICAgICAgICAgICAgICdQJyArCiAgICAgICAgICAgICAgKFkgPyBZICsgJ1knIDogJycpICsKICAgICAgICAgICAgICAoTSA/IE0gKyAnTScgOiAnJykgKwogICAgICAgICAgICAgIChEID8gRCArICdEJyA6ICcnKSArCiAgICAgICAgICAgICAgKChoIHx8IG0gfHwgcykgPyAnVCcgOiAnJykgKwogICAgICAgICAgICAgIChoID8gaCArICdIJyA6ICcnKSArCiAgICAgICAgICAgICAgKG0gPyBtICsgJ00nIDogJycpICsKICAgICAgICAgICAgICAocyA/IHMgKyAnUycgOiAnJyk7CiAgICAgIH0KCiAgICAgIHZhciBkdXJhdGlvbl9wcm90b3R5cGVfX3Byb3RvID0gRHVyYXRpb24ucHJvdG90eXBlOwoKICAgICAgZHVyYXRpb25fcHJvdG90eXBlX19wcm90by5hYnMgICAgICAgICAgICA9IGR1cmF0aW9uX2Fic19fYWJzOwogICAgICBkdXJhdGlvbl9wcm90b3R5cGVfX3Byb3RvLmFkZCAgICAgICAgICAgID0gZHVyYXRpb25fYWRkX3N1YnRyYWN0X19hZGQ7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8uc3VidHJhY3QgICAgICAgPSBkdXJhdGlvbl9hZGRfc3VidHJhY3RfX3N1YnRyYWN0OwogICAgICBkdXJhdGlvbl9wcm90b3R5cGVfX3Byb3RvLmFzICAgICAgICAgICAgID0gYXM7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8uYXNNaWxsaXNlY29uZHMgPSBhc01pbGxpc2Vjb25kczsKICAgICAgZHVyYXRpb25fcHJvdG90eXBlX19wcm90by5hc1NlY29uZHMgICAgICA9IGFzU2Vjb25kczsKICAgICAgZHVyYXRpb25fcHJvdG90eXBlX19wcm90by5hc01pbnV0ZXMgICAgICA9IGFzTWludXRlczsKICAgICAgZHVyYXRpb25fcHJvdG90eXBlX19wcm90by5hc0hvdXJzICAgICAgICA9IGFzSG91cnM7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8uYXNEYXlzICAgICAgICAgPSBhc0RheXM7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8uYXNXZWVrcyAgICAgICAgPSBhc1dlZWtzOwogICAgICBkdXJhdGlvbl9wcm90b3R5cGVfX3Byb3RvLmFzTW9udGhzICAgICAgID0gYXNNb250aHM7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8uYXNZZWFycyAgICAgICAgPSBhc1llYXJzOwogICAgICBkdXJhdGlvbl9wcm90b3R5cGVfX3Byb3RvLnZhbHVlT2YgICAgICAgID0gZHVyYXRpb25fYXNfX3ZhbHVlT2Y7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8uX2J1YmJsZSAgICAgICAgPSBidWJibGU7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8uZ2V0ICAgICAgICAgICAgPSBkdXJhdGlvbl9nZXRfX2dldDsKICAgICAgZHVyYXRpb25fcHJvdG90eXBlX19wcm90by5taWxsaXNlY29uZHMgICA9IGR1cmF0aW9uX2dldF9fbWlsbGlzZWNvbmRzOwogICAgICBkdXJhdGlvbl9wcm90b3R5cGVfX3Byb3RvLnNlY29uZHMgICAgICAgID0gc2Vjb25kczsKICAgICAgZHVyYXRpb25fcHJvdG90eXBlX19wcm90by5taW51dGVzICAgICAgICA9IG1pbnV0ZXM7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8uaG91cnMgICAgICAgICAgPSBob3VyczsKICAgICAgZHVyYXRpb25fcHJvdG90eXBlX19wcm90by5kYXlzICAgICAgICAgICA9IGRheXM7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8ud2Vla3MgICAgICAgICAgPSB3ZWVrczsKICAgICAgZHVyYXRpb25fcHJvdG90eXBlX19wcm90by5tb250aHMgICAgICAgICA9IG1vbnRoczsKICAgICAgZHVyYXRpb25fcHJvdG90eXBlX19wcm90by55ZWFycyAgICAgICAgICA9IHllYXJzOwogICAgICBkdXJhdGlvbl9wcm90b3R5cGVfX3Byb3RvLmh1bWFuaXplICAgICAgID0gaHVtYW5pemU7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8udG9JU09TdHJpbmcgICAgPSBpc29fc3RyaW5nX190b0lTT1N0cmluZzsKICAgICAgZHVyYXRpb25fcHJvdG90eXBlX19wcm90by50b1N0cmluZyAgICAgICA9IGlzb19zdHJpbmdfX3RvSVNPU3RyaW5nOwogICAgICBkdXJhdGlvbl9wcm90b3R5cGVfX3Byb3RvLnRvSlNPTiAgICAgICAgID0gaXNvX3N0cmluZ19fdG9JU09TdHJpbmc7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8ubG9jYWxlICAgICAgICAgPSBsb2NhbGU7CiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8ubG9jYWxlRGF0YSAgICAgPSBsb2NhbGVEYXRhOwoKICAgICAgLy8gRGVwcmVjYXRpb25zCiAgICAgIGR1cmF0aW9uX3Byb3RvdHlwZV9fcHJvdG8udG9Jc29TdHJpbmcgPSBkZXByZWNhdGUoJ3RvSXNvU3RyaW5nKCkgaXMgZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSB0b0lTT1N0cmluZygpIGluc3RlYWQgKG5vdGljZSB0aGUgY2FwaXRhbHMpJywgaXNvX3N0cmluZ19fdG9JU09TdHJpbmcpOwogICAgICBkdXJhdGlvbl9wcm90b3R5cGVfX3Byb3RvLmxhbmcgPSBsYW5nOwoKICAgICAgLy8gU2lkZSBlZmZlY3QgaW1wb3J0cwoKICAgICAgYWRkRm9ybWF0VG9rZW4oJ1gnLCAwLCAwLCAndW5peCcpOwogICAgICBhZGRGb3JtYXRUb2tlbigneCcsIDAsIDAsICd2YWx1ZU9mJyk7CgogICAgICAvLyBQQVJTSU5HCgogICAgICBhZGRSZWdleFRva2VuKCd4JywgbWF0Y2hTaWduZWQpOwogICAgICBhZGRSZWdleFRva2VuKCdYJywgbWF0Y2hUaW1lc3RhbXApOwogICAgICBhZGRQYXJzZVRva2VuKCdYJywgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnKSB7CiAgICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZShwYXJzZUZsb2F0KGlucHV0LCAxMCkgKiAxMDAwKTsKICAgICAgfSk7CiAgICAgIGFkZFBhcnNlVG9rZW4oJ3gnLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHsKICAgICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKHRvSW50KGlucHV0KSk7CiAgICAgIH0pOwoKICAgICAgLy8gU2lkZSBlZmZlY3QgaW1wb3J0cwoKCiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy52ZXJzaW9uID0gJzIuMTAuMyc7CgogICAgICBzZXRIb29rQ2FsbGJhY2sobG9jYWxfX2NyZWF0ZUxvY2FsKTsKCiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5mbiAgICAgICAgICAgICAgICAgICAgPSBtb21lbnRQcm90b3R5cGU7CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5taW4gICAgICAgICAgICAgICAgICAgPSBtaW47CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5tYXggICAgICAgICAgICAgICAgICAgPSBtYXg7CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy51dGMgICAgICAgICAgICAgICAgICAgPSBjcmVhdGVfdXRjX19jcmVhdGVVVEM7CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy51bml4ICAgICAgICAgICAgICAgICAgPSBtb21lbnRfX2NyZWF0ZVVuaXg7CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5tb250aHMgICAgICAgICAgICAgICAgPSBsaXN0c19fbGlzdE1vbnRoczsKICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLmlzRGF0ZSAgICAgICAgICAgICAgICA9IGlzRGF0ZTsKICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLmxvY2FsZSAgICAgICAgICAgICAgICA9IGxvY2FsZV9sb2NhbGVzX19nZXRTZXRHbG9iYWxMb2NhbGU7CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5pbnZhbGlkICAgICAgICAgICAgICAgPSB2YWxpZF9fY3JlYXRlSW52YWxpZDsKICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLmR1cmF0aW9uICAgICAgICAgICAgICA9IGNyZWF0ZV9fY3JlYXRlRHVyYXRpb247CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5pc01vbWVudCAgICAgICAgICAgICAgPSBpc01vbWVudDsKICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLndlZWtkYXlzICAgICAgICAgICAgICA9IGxpc3RzX19saXN0V2Vla2RheXM7CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5wYXJzZVpvbmUgICAgICAgICAgICAgPSBtb21lbnRfX2NyZWF0ZUluWm9uZTsKICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLmxvY2FsZURhdGEgICAgICAgICAgICA9IGxvY2FsZV9sb2NhbGVzX19nZXRMb2NhbGU7CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5pc0R1cmF0aW9uICAgICAgICAgICAgPSBpc0R1cmF0aW9uOwogICAgICB1dGlsc19ob29rc19faG9va3MubW9udGhzU2hvcnQgICAgICAgICAgID0gbGlzdHNfX2xpc3RNb250aHNTaG9ydDsKICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLndlZWtkYXlzTWluICAgICAgICAgICA9IGxpc3RzX19saXN0V2Vla2RheXNNaW47CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5kZWZpbmVMb2NhbGUgICAgICAgICAgPSBkZWZpbmVMb2NhbGU7CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy53ZWVrZGF5c1Nob3J0ICAgICAgICAgPSBsaXN0c19fbGlzdFdlZWtkYXlzU2hvcnQ7CiAgICAgIHV0aWxzX2hvb2tzX19ob29rcy5ub3JtYWxpemVVbml0cyAgICAgICAgPSBub3JtYWxpemVVbml0czsKICAgICAgdXRpbHNfaG9va3NfX2hvb2tzLnJlbGF0aXZlVGltZVRocmVzaG9sZCA9IGR1cmF0aW9uX2h1bWFuaXplX19nZXRTZXRSZWxhdGl2ZVRpbWVUaHJlc2hvbGQ7CgogICAgICB2YXIgX21vbWVudCA9IHV0aWxzX2hvb2tzX19ob29rczsKCiAgICAgIHJldHVybiBfbW9tZW50OwoKICB9KSk7CiAgLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18oNCkobW9kdWxlKSkpCgovKioqLyB9LAovKiA0ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG1vZHVsZSkgewogIAlpZighbW9kdWxlLndlYnBhY2tQb2x5ZmlsbCkgewogIAkJbW9kdWxlLmRlcHJlY2F0ZSA9IGZ1bmN0aW9uKCkge307CiAgCQltb2R1bGUucGF0aHMgPSBbXTsKICAJCS8vIG1vZHVsZS5wYXJlbnQgPSB1bmRlZmluZWQgYnkgZGVmYXVsdAogIAkJbW9kdWxlLmNoaWxkcmVuID0gW107CiAgCQltb2R1bGUud2VicGFja1BvbHlmaWxsID0gMTsKICAJfQogIAlyZXR1cm4gbW9kdWxlOwogIH0KCgovKioqLyB9LAovKiA1ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKICBmdW5jdGlvbiB3ZWJwYWNrQ29udGV4dChyZXEpIHsKICAJdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIgKyByZXEgKyAiJy4iKTsKICB9CiAgd2VicGFja0NvbnRleHQua2V5cyA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gW107IH07CiAgd2VicGFja0NvbnRleHQucmVzb2x2ZSA9IHdlYnBhY2tDb250ZXh0OwogIG1vZHVsZS5leHBvcnRzID0gd2VicGFja0NvbnRleHQ7CiAgd2VicGFja0NvbnRleHQuaWQgPSA1OwoKCi8qKiovIH0sCi8qIDYgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgogIC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHsndXNlIHN0cmljdCc7CgogIHZhciBfcm5nOwoKICB2YXIgZ2xvYmFsVmFyID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiB0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbCA6IG51bGw7CgogIGlmIChnbG9iYWxWYXIgJiYgZ2xvYmFsVmFyLmNyeXB0byAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKSB7CiAgICAvLyBXSEFUV0cgY3J5cHRvLWJhc2VkIFJORyAtIGh0dHA6Ly93aWtpLndoYXR3Zy5vcmcvd2lraS9DcnlwdG8KICAgIC8vIE1vZGVyYXRlbHkgZmFzdCwgaGlnaCBxdWFsaXR5CiAgICB2YXIgX3JuZHM4ID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgX3JuZyA9IGZ1bmN0aW9uIHdoYXR3Z1JORygpIHsKICAgICAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhfcm5kczgpOwogICAgICByZXR1cm4gX3JuZHM4OwogICAgfTsKICB9CgogIGlmICghX3JuZykgewogICAgLy8gTWF0aC5yYW5kb20oKS1iYXNlZCAoUk5HKQogICAgLy8KICAgIC8vIElmIGFsbCBlbHNlIGZhaWxzLCB1c2UgTWF0aC5yYW5kb20oKS4gIEl0J3MgZmFzdCwgYnV0IGlzIG9mIHVuc3BlY2lmaWVkCiAgICAvLyBxdWFsaXR5LgogICAgdmFyIF9ybmRzID0gbmV3IEFycmF5KDE2KTsKICAgIF9ybmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCByOyBpIDwgMTY7IGkrKykgewogICAgICAgIGlmICgoaSAmIDMpID09PSAwKSByID0gTWF0aC5yYW5kb20oKSAqIDQyOTQ5NjcyOTY7CiAgICAgICAgX3JuZHNbaV0gPSByID4+PiAoKGkgJiAzKSA8PCAzKSAmIDI1NTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9ybmRzOwogICAgfTsKICB9CgogIC8vICAgICB1dWlkLmpzCiAgLy8KICAvLyAgICAgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTIgUm9iZXJ0IEtpZWZmZXIKICAvLyAgICAgTUlUIExpY2Vuc2UgLSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwCgogIC8vIFVuaXF1ZSBJRCBjcmVhdGlvbiByZXF1aXJlcyBhIGhpZ2ggcXVhbGl0eSByYW5kb20gIyBnZW5lcmF0b3IuICBXZSBmZWF0dXJlCiAgLy8gZGV0ZWN0IHRvIGRldGVybWluZSB0aGUgYmVzdCBSTkcgc291cmNlLCBub3JtYWxpemluZyB0byBhIGZ1bmN0aW9uIHRoYXQKICAvLyByZXR1cm5zIDEyOC1iaXRzIG9mIHJhbmRvbW5lc3MsIHNpbmNlIHRoYXQncyB3aGF0J3MgdXN1YWxseSByZXF1aXJlZAoKICAvL3ZhciBfcm5nID0gcmVxdWlyZSgnLi9ybmcnKTsKCiAgLy8gTWFwcyBmb3IgbnVtYmVyIDwtPiBoZXggc3RyaW5nIGNvbnZlcnNpb24KICB2YXIgX2J5dGVUb0hleCA9IFtdOwogIHZhciBfaGV4VG9CeXRlID0ge307CiAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7IGkrKykgewogICAgX2J5dGVUb0hleFtpXSA9IChpICsgMjU2KS50b1N0cmluZygxNikuc3Vic3RyKDEpOwogICAgX2hleFRvQnl0ZVtfYnl0ZVRvSGV4W2ldXSA9IGk7CiAgfQoKICAvLyAqKmBwYXJzZSgpYCAtIFBhcnNlIGEgVVVJRCBpbnRvIGl0J3MgY29tcG9uZW50IGJ5dGVzKioKICBmdW5jdGlvbiBwYXJzZShzLCBidWYsIG9mZnNldCkgewogICAgdmFyIGkgPSBidWYgJiYgb2Zmc2V0IHx8IDAsCiAgICAgICAgaWkgPSAwOwoKICAgIGJ1ZiA9IGJ1ZiB8fCBbXTsKICAgIHMudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bMC05YS1mXXsyfS9nLCBmdW5jdGlvbiAob2N0KSB7CiAgICAgIGlmIChpaSA8IDE2KSB7CiAgICAgICAgLy8gRG9uJ3Qgb3ZlcmZsb3chCiAgICAgICAgYnVmW2kgKyBpaSsrXSA9IF9oZXhUb0J5dGVbb2N0XTsKICAgICAgfQogICAgfSk7CgogICAgLy8gWmVybyBvdXQgcmVtYWluaW5nIGJ5dGVzIGlmIHN0cmluZyB3YXMgc2hvcnQKICAgIHdoaWxlIChpaSA8IDE2KSB7CiAgICAgIGJ1ZltpICsgaWkrK10gPSAwOwogICAgfQoKICAgIHJldHVybiBidWY7CiAgfQoKICAvLyAqKmB1bnBhcnNlKClgIC0gQ29udmVydCBVVUlEIGJ5dGUgYXJyYXkgKGFsYSBwYXJzZSgpKSBpbnRvIGEgc3RyaW5nKioKICBmdW5jdGlvbiB1bnBhcnNlKGJ1Ziwgb2Zmc2V0KSB7CiAgICB2YXIgaSA9IG9mZnNldCB8fCAwLAogICAgICAgIGJ0aCA9IF9ieXRlVG9IZXg7CiAgICByZXR1cm4gYnRoW2J1ZltpKytdXSArIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArICctJyArIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICsgJy0nICsgYnRoW2J1ZltpKytdXSArIGJ0aFtidWZbaSsrXV0gKyAnLScgKyBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArICctJyArIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXTsKICB9CgogIC8vICoqYHYxKClgIC0gR2VuZXJhdGUgdGltZS1iYXNlZCBVVUlEKioKICAvLwogIC8vIEluc3BpcmVkIGJ5IGh0dHBzOi8vZ2l0aHViLmNvbS9MaW9zSy9VVUlELmpzCiAgLy8gYW5kIGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvbGlicmFyeS91dWlkLmh0bWwKCiAgLy8gcmFuZG9tICMncyB3ZSBuZWVkIHRvIGluaXQgbm9kZSBhbmQgY2xvY2tzZXEKICB2YXIgX3NlZWRCeXRlcyA9IF9ybmcoKTsKCiAgLy8gUGVyIDQuNSwgY3JlYXRlIGFuZCA0OC1iaXQgbm9kZSBpZCwgKDQ3IHJhbmRvbSBiaXRzICsgbXVsdGljYXN0IGJpdCA9IDEpCiAgdmFyIF9ub2RlSWQgPSBbX3NlZWRCeXRlc1swXSB8IDEsIF9zZWVkQnl0ZXNbMV0sIF9zZWVkQnl0ZXNbMl0sIF9zZWVkQnl0ZXNbM10sIF9zZWVkQnl0ZXNbNF0sIF9zZWVkQnl0ZXNbNV1dOwoKICAvLyBQZXIgNC4yLjIsIHJhbmRvbWl6ZSAoMTQgYml0KSBjbG9ja3NlcQogIHZhciBfY2xvY2tzZXEgPSAoX3NlZWRCeXRlc1s2XSA8PCA4IHwgX3NlZWRCeXRlc1s3XSkgJiAxNjM4MzsKCiAgLy8gUHJldmlvdXMgdXVpZCBjcmVhdGlvbiB0aW1lCiAgdmFyIF9sYXN0TVNlY3MgPSAwLAogICAgICBfbGFzdE5TZWNzID0gMDsKCiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9icm9vZmEvbm9kZS11dWlkIGZvciBBUEkgZGV0YWlscwogIGZ1bmN0aW9uIHYxKG9wdGlvbnMsIGJ1Ziwgb2Zmc2V0KSB7CiAgICB2YXIgaSA9IGJ1ZiAmJiBvZmZzZXQgfHwgMDsKICAgIHZhciBiID0gYnVmIHx8IFtdOwoKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwoKICAgIHZhciBjbG9ja3NlcSA9IG9wdGlvbnMuY2xvY2tzZXEgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuY2xvY2tzZXEgOiBfY2xvY2tzZXE7CgogICAgLy8gVVVJRCB0aW1lc3RhbXBzIGFyZSAxMDAgbmFuby1zZWNvbmQgdW5pdHMgc2luY2UgdGhlIEdyZWdvcmlhbiBlcG9jaCwKICAgIC8vICgxNTgyLTEwLTE1IDAwOjAwKS4gIEpTTnVtYmVycyBhcmVuJ3QgcHJlY2lzZSBlbm91Z2ggZm9yIHRoaXMsIHNvCiAgICAvLyB0aW1lIGlzIGhhbmRsZWQgaW50ZXJuYWxseSBhcyAnbXNlY3MnIChpbnRlZ2VyIG1pbGxpc2Vjb25kcykgYW5kICduc2VjcycKICAgIC8vICgxMDAtbmFub3NlY29uZHMgb2Zmc2V0IGZyb20gbXNlY3MpIHNpbmNlIHVuaXggZXBvY2gsIDE5NzAtMDEtMDEgMDA6MDAuCiAgICB2YXIgbXNlY3MgPSBvcHRpb25zLm1zZWNzICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLm1zZWNzIDogbmV3IERhdGUoKS5nZXRUaW1lKCk7CgogICAgLy8gUGVyIDQuMi4xLjIsIHVzZSBjb3VudCBvZiB1dWlkJ3MgZ2VuZXJhdGVkIGR1cmluZyB0aGUgY3VycmVudCBjbG9jawogICAgLy8gY3ljbGUgdG8gc2ltdWxhdGUgaGlnaGVyIHJlc29sdXRpb24gY2xvY2sKICAgIHZhciBuc2VjcyA9IG9wdGlvbnMubnNlY3MgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMubnNlY3MgOiBfbGFzdE5TZWNzICsgMTsKCiAgICAvLyBUaW1lIHNpbmNlIGxhc3QgdXVpZCBjcmVhdGlvbiAoaW4gbXNlY3MpCiAgICB2YXIgZHQgPSBtc2VjcyAtIF9sYXN0TVNlY3MgKyAobnNlY3MgLSBfbGFzdE5TZWNzKSAvIDEwMDAwOwoKICAgIC8vIFBlciA0LjIuMS4yLCBCdW1wIGNsb2Nrc2VxIG9uIGNsb2NrIHJlZ3Jlc3Npb24KICAgIGlmIChkdCA8IDAgJiYgb3B0aW9ucy5jbG9ja3NlcSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGNsb2Nrc2VxID0gY2xvY2tzZXEgKyAxICYgMTYzODM7CiAgICB9CgogICAgLy8gUmVzZXQgbnNlY3MgaWYgY2xvY2sgcmVncmVzc2VzIChuZXcgY2xvY2tzZXEpIG9yIHdlJ3ZlIG1vdmVkIG9udG8gYSBuZXcKICAgIC8vIHRpbWUgaW50ZXJ2YWwKICAgIGlmICgoZHQgPCAwIHx8IG1zZWNzID4gX2xhc3RNU2VjcykgJiYgb3B0aW9ucy5uc2VjcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIG5zZWNzID0gMDsKICAgIH0KCiAgICAvLyBQZXIgNC4yLjEuMiBUaHJvdyBlcnJvciBpZiB0b28gbWFueSB1dWlkcyBhcmUgcmVxdWVzdGVkCiAgICBpZiAobnNlY3MgPj0gMTAwMDApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCd1dWlkLnYxKCk6IENhblwndCBjcmVhdGUgbW9yZSB0aGFuIDEwTSB1dWlkcy9zZWMnKTsKICAgIH0KCiAgICBfbGFzdE1TZWNzID0gbXNlY3M7CiAgICBfbGFzdE5TZWNzID0gbnNlY3M7CiAgICBfY2xvY2tzZXEgPSBjbG9ja3NlcTsKCiAgICAvLyBQZXIgNC4xLjQgLSBDb252ZXJ0IGZyb20gdW5peCBlcG9jaCB0byBHcmVnb3JpYW4gZXBvY2gKICAgIG1zZWNzICs9IDEyMjE5MjkyODAwMDAwOwoKICAgIC8vIGB0aW1lX2xvd2AKICAgIHZhciB0bCA9ICgobXNlY3MgJiAyNjg0MzU0NTUpICogMTAwMDAgKyBuc2VjcykgJSA0Mjk0OTY3Mjk2OwogICAgYltpKytdID0gdGwgPj4+IDI0ICYgMjU1OwogICAgYltpKytdID0gdGwgPj4+IDE2ICYgMjU1OwogICAgYltpKytdID0gdGwgPj4+IDggJiAyNTU7CiAgICBiW2krK10gPSB0bCAmIDI1NTsKCiAgICAvLyBgdGltZV9taWRgCiAgICB2YXIgdG1oID0gbXNlY3MgLyA0Mjk0OTY3Mjk2ICogMTAwMDAgJiAyNjg0MzU0NTU7CiAgICBiW2krK10gPSB0bWggPj4+IDggJiAyNTU7CiAgICBiW2krK10gPSB0bWggJiAyNTU7CgogICAgLy8gYHRpbWVfaGlnaF9hbmRfdmVyc2lvbmAKICAgIGJbaSsrXSA9IHRtaCA+Pj4gMjQgJiAxNSB8IDE2OyAvLyBpbmNsdWRlIHZlcnNpb24KICAgIGJbaSsrXSA9IHRtaCA+Pj4gMTYgJiAyNTU7CgogICAgLy8gYGNsb2NrX3NlcV9oaV9hbmRfcmVzZXJ2ZWRgIChQZXIgNC4yLjIgLSBpbmNsdWRlIHZhcmlhbnQpCiAgICBiW2krK10gPSBjbG9ja3NlcSA+Pj4gOCB8IDEyODsKCiAgICAvLyBgY2xvY2tfc2VxX2xvd2AKICAgIGJbaSsrXSA9IGNsb2Nrc2VxICYgMjU1OwoKICAgIC8vIGBub2RlYAogICAgdmFyIG5vZGUgPSBvcHRpb25zLm5vZGUgfHwgX25vZGVJZDsKICAgIGZvciAodmFyIG4gPSAwOyBuIDwgNjsgbisrKSB7CiAgICAgIGJbaSArIG5dID0gbm9kZVtuXTsKICAgIH0KCiAgICByZXR1cm4gYnVmID8gYnVmIDogdW5wYXJzZShiKTsKICB9CgogIC8vICoqYHY0KClgIC0gR2VuZXJhdGUgcmFuZG9tIFVVSUQqKgoKICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2Jyb29mYS9ub2RlLXV1aWQgZm9yIEFQSSBkZXRhaWxzCiAgZnVuY3Rpb24gdjQob3B0aW9ucywgYnVmLCBvZmZzZXQpIHsKICAgIC8vIERlcHJlY2F0ZWQgLSAnZm9ybWF0JyBhcmd1bWVudCwgYXMgc3VwcG9ydGVkIGluIHYxLjIKICAgIHZhciBpID0gYnVmICYmIG9mZnNldCB8fCAwOwoKICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PSAnc3RyaW5nJykgewogICAgICBidWYgPSBvcHRpb25zID09ICdiaW5hcnknID8gbmV3IEFycmF5KDE2KSA6IG51bGw7CiAgICAgIG9wdGlvbnMgPSBudWxsOwogICAgfQogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgdmFyIHJuZHMgPSBvcHRpb25zLnJhbmRvbSB8fCAob3B0aW9ucy5ybmcgfHwgX3JuZykoKTsKCiAgICAvLyBQZXIgNC40LCBzZXQgYml0cyBmb3IgdmVyc2lvbiBhbmQgYGNsb2NrX3NlcV9oaV9hbmRfcmVzZXJ2ZWRgCiAgICBybmRzWzZdID0gcm5kc1s2XSAmIDE1IHwgNjQ7CiAgICBybmRzWzhdID0gcm5kc1s4XSAmIDYzIHwgMTI4OwoKICAgIC8vIENvcHkgYnl0ZXMgdG8gYnVmZmVyLCBpZiBwcm92aWRlZAogICAgaWYgKGJ1ZikgewogICAgICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgMTY7IGlpKyspIHsKICAgICAgICBidWZbaSArIGlpXSA9IHJuZHNbaWldOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGJ1ZiB8fCB1bnBhcnNlKHJuZHMpOwogIH0KCiAgLy8gRXhwb3J0IHB1YmxpYyBBUEkKICB2YXIgdXVpZCA9IHY0OwogIHV1aWQudjEgPSB2MTsKICB1dWlkLnY0ID0gdjQ7CiAgdXVpZC5wYXJzZSA9IHBhcnNlOwogIHV1aWQudW5wYXJzZSA9IHVucGFyc2U7CgogIG1vZHVsZS5leHBvcnRzID0gdXVpZDsKICAvKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi99LmNhbGwoZXhwb3J0cywgKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSgpKSkpCgovKioqLyB9LAovKiA3ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKICAvLyBET00gdXRpbGl0eSBtZXRob2RzCgogIC8qKgogICAqIHRoaXMgcHJlcGFyZXMgdGhlIEpTT04gY29udGFpbmVyIGZvciBhbGxvY2F0aW5nIFNWRyBlbGVtZW50cwogICAqIEBwYXJhbSBKU09OY29udGFpbmVyCiAgICogQHByaXZhdGUKICAgKi8KICAndXNlIHN0cmljdCc7CgogIGV4cG9ydHMucHJlcGFyZUVsZW1lbnRzID0gZnVuY3Rpb24gKEpTT05jb250YWluZXIpIHsKICAgIC8vIGNsZWFudXAgdGhlIHJlZHVuZGFudCBzdmdFbGVtZW50czsKICAgIGZvciAodmFyIGVsZW1lbnRUeXBlIGluIEpTT05jb250YWluZXIpIHsKICAgICAgaWYgKEpTT05jb250YWluZXIuaGFzT3duUHJvcGVydHkoZWxlbWVudFR5cGUpKSB7CiAgICAgICAgSlNPTmNvbnRhaW5lcltlbGVtZW50VHlwZV0ucmVkdW5kYW50ID0gSlNPTmNvbnRhaW5lcltlbGVtZW50VHlwZV0udXNlZDsKICAgICAgICBKU09OY29udGFpbmVyW2VsZW1lbnRUeXBlXS51c2VkID0gW107CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiB0aGlzIGNsZWFucyB1cCBhbGwgdGhlIHVudXNlZCBTVkcgZWxlbWVudHMuIEJ5IGFza2luZyBmb3IgdGhlIHBhcmVudE5vZGUsIHdlIG9ubHkgbmVlZCB0byBzdXBwbHkgdGhlIEpTT04gY29udGFpbmVyIGZyb20KICAgKiB3aGljaCB0byByZW1vdmUgdGhlIHJlZHVuZGFudCBlbGVtZW50cy4KICAgKgogICAqIEBwYXJhbSBKU09OY29udGFpbmVyCiAgICogQHByaXZhdGUKICAgKi8KICBleHBvcnRzLmNsZWFudXBFbGVtZW50cyA9IGZ1bmN0aW9uIChKU09OY29udGFpbmVyKSB7CiAgICAvLyBjbGVhbnVwIHRoZSByZWR1bmRhbnQgc3ZnRWxlbWVudHM7CiAgICBmb3IgKHZhciBlbGVtZW50VHlwZSBpbiBKU09OY29udGFpbmVyKSB7CiAgICAgIGlmIChKU09OY29udGFpbmVyLmhhc093blByb3BlcnR5KGVsZW1lbnRUeXBlKSkgewogICAgICAgIGlmIChKU09OY29udGFpbmVyW2VsZW1lbnRUeXBlXS5yZWR1bmRhbnQpIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgSlNPTmNvbnRhaW5lcltlbGVtZW50VHlwZV0ucmVkdW5kYW50Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIEpTT05jb250YWluZXJbZWxlbWVudFR5cGVdLnJlZHVuZGFudFtpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKEpTT05jb250YWluZXJbZWxlbWVudFR5cGVdLnJlZHVuZGFudFtpXSk7CiAgICAgICAgICB9CiAgICAgICAgICBKU09OY29udGFpbmVyW2VsZW1lbnRUeXBlXS5yZWR1bmRhbnQgPSBbXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBBbGxvY2F0ZSBvciBnZW5lcmF0ZSBhbiBTVkcgZWxlbWVudCBpZiBuZWVkZWQuIFN0b3JlIGEgcmVmZXJlbmNlIHRvIGl0IGluIHRoZSBKU09OIGNvbnRhaW5lciBhbmQgZHJhdyBpdCBpbiB0aGUgc3ZnQ29udGFpbmVyCiAgICogdGhlIEpTT04gY29udGFpbmVyIGFuZCB0aGUgU1ZHIGNvbnRhaW5lciBoYXZlIHRvIGJlIHN1cHBsaWVkIHNvIG90aGVyIHN2ZyBjb250YWluZXJzIChsaWtlIHRoZSBsZWdlbmQpIGNhbiB1c2UgdGhpcy4KICAgKgogICAqIEBwYXJhbSBlbGVtZW50VHlwZQogICAqIEBwYXJhbSBKU09OY29udGFpbmVyCiAgICogQHBhcmFtIHN2Z0NvbnRhaW5lcgogICAqIEByZXR1cm5zIHsqfQogICAqIEBwcml2YXRlCiAgICovCiAgZXhwb3J0cy5nZXRTVkdFbGVtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnRUeXBlLCBKU09OY29udGFpbmVyLCBzdmdDb250YWluZXIpIHsKICAgIHZhciBlbGVtZW50OwogICAgLy8gYWxsb2NhdGUgU1ZHIGVsZW1lbnQsIGlmIGl0IGRvZXNudCB5ZXQgZXhpc3QsIGNyZWF0ZSBvbmUuCiAgICBpZiAoSlNPTmNvbnRhaW5lci5oYXNPd25Qcm9wZXJ0eShlbGVtZW50VHlwZSkpIHsKICAgICAgLy8gdGhpcyBlbGVtZW50IGhhcyBiZWVuIGNyZWF0ZWQgYmVmb3JlCiAgICAgIC8vIGNoZWNrIGlmIHRoZXJlIGlzIGFuIHJlZHVuZGFudCBlbGVtZW50CiAgICAgIGlmIChKU09OY29udGFpbmVyW2VsZW1lbnRUeXBlXS5yZWR1bmRhbnQubGVuZ3RoID4gMCkgewogICAgICAgIGVsZW1lbnQgPSBKU09OY29udGFpbmVyW2VsZW1lbnRUeXBlXS5yZWR1bmRhbnRbMF07CiAgICAgICAgSlNPTmNvbnRhaW5lcltlbGVtZW50VHlwZV0ucmVkdW5kYW50LnNoaWZ0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gY3JlYXRlIGEgbmV3IGVsZW1lbnQgYW5kIGFkZCBpdCB0byB0aGUgU1ZHCiAgICAgICAgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCBlbGVtZW50VHlwZSk7CiAgICAgICAgc3ZnQ29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBjcmVhdGUgYSBuZXcgZWxlbWVudCBhbmQgYWRkIGl0IHRvIHRoZSBTVkcsIGFsc28gY3JlYXRlIGEgbmV3IG9iamVjdCBpbiB0aGUgc3ZnRWxlbWVudHMgdG8ga2VlcCB0cmFjayBvZiBpdC4KICAgICAgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCBlbGVtZW50VHlwZSk7CiAgICAgIEpTT05jb250YWluZXJbZWxlbWVudFR5cGVdID0geyB1c2VkOiBbXSwgcmVkdW5kYW50OiBbXSB9OwogICAgICBzdmdDb250YWluZXIuYXBwZW5kQ2hpbGQoZWxlbWVudCk7CiAgICB9CiAgICBKU09OY29udGFpbmVyW2VsZW1lbnRUeXBlXS51c2VkLnB1c2goZWxlbWVudCk7CiAgICByZXR1cm4gZWxlbWVudDsKICB9OwoKICAvKioKICAgKiBBbGxvY2F0ZSBvciBnZW5lcmF0ZSBhbiBTVkcgZWxlbWVudCBpZiBuZWVkZWQuIFN0b3JlIGEgcmVmZXJlbmNlIHRvIGl0IGluIHRoZSBKU09OIGNvbnRhaW5lciBhbmQgZHJhdyBpdCBpbiB0aGUgc3ZnQ29udGFpbmVyCiAgICogdGhlIEpTT04gY29udGFpbmVyIGFuZCB0aGUgU1ZHIGNvbnRhaW5lciBoYXZlIHRvIGJlIHN1cHBsaWVkIHNvIG90aGVyIHN2ZyBjb250YWluZXJzIChsaWtlIHRoZSBsZWdlbmQpIGNhbiB1c2UgdGhpcy4KICAgKgogICAqIEBwYXJhbSBlbGVtZW50VHlwZQogICAqIEBwYXJhbSBKU09OY29udGFpbmVyCiAgICogQHBhcmFtIERPTUNvbnRhaW5lcgogICAqIEByZXR1cm5zIHsqfQogICAqIEBwcml2YXRlCiAgICovCiAgZXhwb3J0cy5nZXRET01FbGVtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnRUeXBlLCBKU09OY29udGFpbmVyLCBET01Db250YWluZXIsIGluc2VydEJlZm9yZSkgewogICAgdmFyIGVsZW1lbnQ7CiAgICAvLyBhbGxvY2F0ZSBET00gZWxlbWVudCwgaWYgaXQgZG9lc250IHlldCBleGlzdCwgY3JlYXRlIG9uZS4KICAgIGlmIChKU09OY29udGFpbmVyLmhhc093blByb3BlcnR5KGVsZW1lbnRUeXBlKSkgewogICAgICAvLyB0aGlzIGVsZW1lbnQgaGFzIGJlZW4gY3JlYXRlZCBiZWZvcmUKICAgICAgLy8gY2hlY2sgaWYgdGhlcmUgaXMgYW4gcmVkdW5kYW50IGVsZW1lbnQKICAgICAgaWYgKEpTT05jb250YWluZXJbZWxlbWVudFR5cGVdLnJlZHVuZGFudC5sZW5ndGggPiAwKSB7CiAgICAgICAgZWxlbWVudCA9IEpTT05jb250YWluZXJbZWxlbWVudFR5cGVdLnJlZHVuZGFudFswXTsKICAgICAgICBKU09OY29udGFpbmVyW2VsZW1lbnRUeXBlXS5yZWR1bmRhbnQuc2hpZnQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBjcmVhdGUgYSBuZXcgZWxlbWVudCBhbmQgYWRkIGl0IHRvIHRoZSBTVkcKICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtZW50VHlwZSk7CiAgICAgICAgaWYgKGluc2VydEJlZm9yZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBET01Db250YWluZXIuaW5zZXJ0QmVmb3JlKGVsZW1lbnQsIGluc2VydEJlZm9yZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIERPTUNvbnRhaW5lci5hcHBlbmRDaGlsZChlbGVtZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIGNyZWF0ZSBhIG5ldyBlbGVtZW50IGFuZCBhZGQgaXQgdG8gdGhlIFNWRywgYWxzbyBjcmVhdGUgYSBuZXcgb2JqZWN0IGluIHRoZSBzdmdFbGVtZW50cyB0byBrZWVwIHRyYWNrIG9mIGl0LgogICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbGVtZW50VHlwZSk7CiAgICAgIEpTT05jb250YWluZXJbZWxlbWVudFR5cGVdID0geyB1c2VkOiBbXSwgcmVkdW5kYW50OiBbXSB9OwogICAgICBpZiAoaW5zZXJ0QmVmb3JlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBET01Db250YWluZXIuaW5zZXJ0QmVmb3JlKGVsZW1lbnQsIGluc2VydEJlZm9yZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgRE9NQ29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnQpOwogICAgICB9CiAgICB9CiAgICBKU09OY29udGFpbmVyW2VsZW1lbnRUeXBlXS51c2VkLnB1c2goZWxlbWVudCk7CiAgICByZXR1cm4gZWxlbWVudDsKICB9OwoKICAvKioKICAgKiBkcmF3IGEgcG9pbnQgb2JqZWN0LiB0aGlzIGlzIGEgc2VwZXJhdGUgZnVuY3Rpb24gYmVjYXVzZSBpdCBjYW4gYWxzbyBiZSBjYWxsZWQgYnkgdGhlIGxlZ2VuZC4KICAgKiBUaGUgcmVhc29uIHRoZSBKU09OY29udGFpbmVyIGFuZCB0aGUgdGFyZ2V0IFNWRyBzdmdDb250YWluZXIgaGF2ZSB0byBiZSBzdXBwbGllZCBpcyBzbyB0aGUgbGVnZW5kIGNhbiB1c2UgdGhlc2UgZnVuY3Rpb25zCiAgICogYXMgd2VsbC4KICAgKgogICAqIEBwYXJhbSB4CiAgICogQHBhcmFtIHkKICAgKiBAcGFyYW0gZ3JvdXAKICAgKiBAcGFyYW0gSlNPTmNvbnRhaW5lcgogICAqIEBwYXJhbSBzdmdDb250YWluZXIKICAgKiBAcGFyYW0gbGFiZWxPYmoKICAgKiBAcmV0dXJucyB7Kn0KICAgKi8KICBleHBvcnRzLmRyYXdQb2ludCA9IGZ1bmN0aW9uICh4LCB5LCBncm91cCwgSlNPTmNvbnRhaW5lciwgc3ZnQ29udGFpbmVyLCBsYWJlbE9iaikgewogICAgdmFyIHBvaW50OwogICAgaWYgKGdyb3VwLm9wdGlvbnMuZHJhd1BvaW50cy5zdHlsZSA9PSAnY2lyY2xlJykgewogICAgICBwb2ludCA9IGV4cG9ydHMuZ2V0U1ZHRWxlbWVudCgnY2lyY2xlJywgSlNPTmNvbnRhaW5lciwgc3ZnQ29udGFpbmVyKTsKICAgICAgcG9pbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2N4JywgeCk7CiAgICAgIHBvaW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICdjeScsIHkpOwogICAgICBwb2ludC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAncicsIDAuNSAqIGdyb3VwLm9wdGlvbnMuZHJhd1BvaW50cy5zaXplKTsKICAgIH0gZWxzZSB7CiAgICAgIHBvaW50ID0gZXhwb3J0cy5nZXRTVkdFbGVtZW50KCdyZWN0JywgSlNPTmNvbnRhaW5lciwgc3ZnQ29udGFpbmVyKTsKICAgICAgcG9pbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgJ3gnLCB4IC0gMC41ICogZ3JvdXAub3B0aW9ucy5kcmF3UG9pbnRzLnNpemUpOwogICAgICBwb2ludC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAneScsIHkgLSAwLjUgKiBncm91cC5vcHRpb25zLmRyYXdQb2ludHMuc2l6ZSk7CiAgICAgIHBvaW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICd3aWR0aCcsIGdyb3VwLm9wdGlvbnMuZHJhd1BvaW50cy5zaXplKTsKICAgICAgcG9pbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2hlaWdodCcsIGdyb3VwLm9wdGlvbnMuZHJhd1BvaW50cy5zaXplKTsKICAgIH0KCiAgICBpZiAoZ3JvdXAub3B0aW9ucy5kcmF3UG9pbnRzLnN0eWxlcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHBvaW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICdzdHlsZScsIGdyb3VwLmdyb3VwLm9wdGlvbnMuZHJhd1BvaW50cy5zdHlsZXMpOwogICAgfQogICAgcG9pbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgJ2NsYXNzJywgZ3JvdXAuY2xhc3NOYW1lICsgJyB2aXMtcG9pbnQnKTsKICAgIC8vaGFuZGxlIGxhYmVsCgogICAgaWYgKGxhYmVsT2JqKSB7CiAgICAgIHZhciBsYWJlbCA9IGV4cG9ydHMuZ2V0U1ZHRWxlbWVudCgndGV4dCcsIEpTT05jb250YWluZXIsIHN2Z0NvbnRhaW5lcik7CiAgICAgIGlmIChsYWJlbE9iai54T2Zmc2V0KSB7CiAgICAgICAgeCA9IHggKyBsYWJlbE9iai54T2Zmc2V0OwogICAgICB9CgogICAgICBpZiAobGFiZWxPYmoueU9mZnNldCkgewogICAgICAgIHkgPSB5ICsgbGFiZWxPYmoueU9mZnNldDsKICAgICAgfQogICAgICBpZiAobGFiZWxPYmouY29udGVudCkgewogICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gbGFiZWxPYmouY29udGVudDsKICAgICAgfQoKICAgICAgaWYgKGxhYmVsT2JqLmNsYXNzTmFtZSkgewogICAgICAgIGxhYmVsLnNldEF0dHJpYnV0ZU5TKG51bGwsICdjbGFzcycsIGxhYmVsT2JqLmNsYXNzTmFtZSArICcgdmlzLWxhYmVsJyk7CiAgICAgIH0KICAgICAgbGFiZWwuc2V0QXR0cmlidXRlTlMobnVsbCwgJ3gnLCB4KTsKICAgICAgbGFiZWwuc2V0QXR0cmlidXRlTlMobnVsbCwgJ3knLCB5KTsKICAgIH0KCiAgICByZXR1cm4gcG9pbnQ7CiAgfTsKCiAgLyoqCiAgICogZHJhdyBhIGJhciBTVkcgZWxlbWVudCBjZW50ZXJlZCBvbiB0aGUgWCBjb29yZGluYXRlCiAgICoKICAgKiBAcGFyYW0geAogICAqIEBwYXJhbSB5CiAgICogQHBhcmFtIGNsYXNzTmFtZQogICAqLwogIGV4cG9ydHMuZHJhd0JhciA9IGZ1bmN0aW9uICh4LCB5LCB3aWR0aCwgaGVpZ2h0LCBjbGFzc05hbWUsIEpTT05jb250YWluZXIsIHN2Z0NvbnRhaW5lciwgc3R5bGUpIHsKICAgIGlmIChoZWlnaHQgIT0gMCkgewogICAgICBpZiAoaGVpZ2h0IDwgMCkgewogICAgICAgIGhlaWdodCAqPSAtMTsKICAgICAgICB5IC09IGhlaWdodDsKICAgICAgfQogICAgICB2YXIgcmVjdCA9IGV4cG9ydHMuZ2V0U1ZHRWxlbWVudCgncmVjdCcsIEpTT05jb250YWluZXIsIHN2Z0NvbnRhaW5lcik7CiAgICAgIHJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgJ3gnLCB4IC0gMC41ICogd2lkdGgpOwogICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICd5JywgeSk7CiAgICAgIHJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgJ3dpZHRoJywgd2lkdGgpOwogICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICdoZWlnaHQnLCBoZWlnaHQpOwogICAgICByZWN0LnNldEF0dHJpYnV0ZU5TKG51bGwsICdjbGFzcycsIGNsYXNzTmFtZSk7CiAgICAgIGlmIChzdHlsZSkgewogICAgICAgIHJlY3Quc2V0QXR0cmlidXRlTlMobnVsbCwgJ3N0eWxlJywgc3R5bGUpOwogICAgICB9CiAgICB9CiAgfTsKCi8qKiovIH0sCi8qIDggKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwogIHZhciBRdWV1ZSA9IF9fd2VicGFja19yZXF1aXJlX18oOSk7CgogIC8qKgogICAqIERhdGFTZXQKICAgKgogICAqIFVzYWdlOgogICAqICAgICB2YXIgZGF0YVNldCA9IG5ldyBEYXRhU2V0KHsKICAgKiAgICAgICAgIGZpZWxkSWQ6ICdfaWQnLAogICAqICAgICAgICAgdHlwZTogewogICAqICAgICAgICAgICAgIC8vIC4uLgogICAqICAgICAgICAgfQogICAqICAgICB9KTsKICAgKgogICAqICAgICBkYXRhU2V0LmFkZChpdGVtKTsKICAgKiAgICAgZGF0YVNldC5hZGQoZGF0YSk7CiAgICogICAgIGRhdGFTZXQudXBkYXRlKGl0ZW0pOwogICAqICAgICBkYXRhU2V0LnVwZGF0ZShkYXRhKTsKICAgKiAgICAgZGF0YVNldC5yZW1vdmUoaWQpOwogICAqICAgICBkYXRhU2V0LnJlbW92ZShpZHMpOwogICAqICAgICB2YXIgZGF0YSA9IGRhdGFTZXQuZ2V0KCk7CiAgICogICAgIHZhciBkYXRhID0gZGF0YVNldC5nZXQoaWQpOwogICAqICAgICB2YXIgZGF0YSA9IGRhdGFTZXQuZ2V0KGlkcyk7CiAgICogICAgIHZhciBkYXRhID0gZGF0YVNldC5nZXQoaWRzLCBvcHRpb25zLCBkYXRhKTsKICAgKiAgICAgZGF0YVNldC5jbGVhcigpOwogICAqCiAgICogQSBkYXRhIHNldCBjYW46CiAgICogLSBhZGQvcmVtb3ZlL3VwZGF0ZSBkYXRhCiAgICogLSBnaXZlcyB0cmlnZ2VycyB1cG9uIGNoYW5nZXMgaW4gdGhlIGRhdGEKICAgKiAtIGNhbiAgaW1wb3J0L2V4cG9ydCBkYXRhIGluIHZhcmlvdXMgZGF0YSBmb3JtYXRzCiAgICoKICAgKiBAcGFyYW0ge0FycmF5fSBbZGF0YV0gICAgT3B0aW9uYWwgYXJyYXkgd2l0aCBpbml0aWFsIGRhdGEKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICAgQXZhaWxhYmxlIG9wdGlvbnM6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmd9IGZpZWxkSWQgRmllbGQgbmFtZSBvZiB0aGUgaWQgaW4gdGhlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMsICdpZCcgYnkgZGVmYXVsdC4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAge09iamVjdC48U3RyaW5nLCBTdHJpbmd9IHR5cGUKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIG1hcCB3aXRoIGZpZWxkIG5hbWVzIGFzIGtleSwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmQgdGhlIGZpZWxkIHR5cGUgYXMgdmFsdWUuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtPYmplY3R9IHF1ZXVlICAgUXVldWUgY2hhbmdlcyB0byB0aGUgRGF0YVNldCwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbHVzaCB0aGVtIGFsbCBhdCBvbmNlLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFF1ZXVlIG9wdGlvbnM6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSB7bnVtYmVyfSBkZWxheSAgRGVsYXkgaW4gbXMsIG51bGwgYnkgZGVmYXVsdAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0ge251bWJlcn0gbWF4ICAgIE1heGltdW0gbnVtYmVyIG9mIGVudHJpZXMgaW4gdGhlIHF1ZXVlLCBJbmZpbml0eSBieSBkZWZhdWx0CiAgICogQGNvbnN0cnVjdG9yIERhdGFTZXQKICAgKi8KICAvLyBUT0RPOiBhZGQgYSBEYXRhU2V0IGNvbnN0cnVjdG9yIERhdGFTZXQoZGF0YSwgb3B0aW9ucykKICBmdW5jdGlvbiBEYXRhU2V0KGRhdGEsIG9wdGlvbnMpIHsKICAgIC8vIGNvcnJlY3RseSByZWFkIG9wdGlvbmFsIGFyZ3VtZW50cwogICAgaWYgKGRhdGEgJiYgIUFycmF5LmlzQXJyYXkoZGF0YSkpIHsKICAgICAgb3B0aW9ucyA9IGRhdGE7CiAgICAgIGRhdGEgPSBudWxsOwogICAgfQoKICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgdGhpcy5fZGF0YSA9IHt9OyAvLyBtYXAgd2l0aCBkYXRhIGluZGV4ZWQgYnkgaWQKICAgIHRoaXMubGVuZ3RoID0gMDsgLy8gbnVtYmVyIG9mIGl0ZW1zIGluIHRoZSBEYXRhU2V0CiAgICB0aGlzLl9maWVsZElkID0gdGhpcy5fb3B0aW9ucy5maWVsZElkIHx8ICdpZCc7IC8vIG5hbWUgb2YgdGhlIGZpZWxkIGNvbnRhaW5pbmcgaWQKICAgIHRoaXMuX3R5cGUgPSB7fTsgLy8gaW50ZXJuYWwgZmllbGQgdHlwZXMgKE5PVEU6IHRoaXMgY2FuIGRpZmZlciBmcm9tIHRoaXMuX29wdGlvbnMudHlwZSkKCiAgICAvLyBhbGwgdmFyaWFudHMgb2YgYSBEYXRlIGFyZSBpbnRlcm5hbGx5IHN0b3JlZCBhcyBEYXRlLCBzbyB3ZSBjYW4gY29udmVydAogICAgLy8gZnJvbSBldmVyeXRoaW5nIHRvIGV2ZXJ5dGhpbmcgKGFsc28gZnJvbSBJU09EYXRlIHRvIE51bWJlciBmb3IgZXhhbXBsZSkKICAgIGlmICh0aGlzLl9vcHRpb25zLnR5cGUpIHsKICAgICAgZm9yICh2YXIgZmllbGQgaW4gdGhpcy5fb3B0aW9ucy50eXBlKSB7CiAgICAgICAgaWYgKHRoaXMuX29wdGlvbnMudHlwZS5oYXNPd25Qcm9wZXJ0eShmaWVsZCkpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX29wdGlvbnMudHlwZVtmaWVsZF07CiAgICAgICAgICBpZiAodmFsdWUgPT0gJ0RhdGUnIHx8IHZhbHVlID09ICdJU09EYXRlJyB8fCB2YWx1ZSA9PSAnQVNQRGF0ZScpIHsKICAgICAgICAgICAgdGhpcy5fdHlwZVtmaWVsZF0gPSAnRGF0ZSc7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl90eXBlW2ZpZWxkXSA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8vIFRPRE86IGRlcHJlY2F0ZWQgc2luY2UgdmVyc2lvbiAxLjEuMSAob3IgMi4wLjA/KQogICAgaWYgKHRoaXMuX29wdGlvbnMuY29udmVydCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ09wdGlvbiAiY29udmVydCIgaXMgZGVwcmVjYXRlZC4gVXNlICJ0eXBlIiBpbnN0ZWFkLicpOwogICAgfQoKICAgIHRoaXMuX3N1YnNjcmliZXJzID0ge307IC8vIGV2ZW50IHN1YnNjcmliZXJzCgogICAgLy8gYWRkIGluaXRpYWwgZGF0YSB3aGVuIHByb3ZpZGVkCiAgICBpZiAoZGF0YSkgewogICAgICB0aGlzLmFkZChkYXRhKTsKICAgIH0KCiAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgfQoKICAvKioKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICAgQXZhaWxhYmxlIG9wdGlvbnM6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtPYmplY3R9IHF1ZXVlICAgUXVldWUgY2hhbmdlcyB0byB0aGUgRGF0YVNldCwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbHVzaCB0aGVtIGFsbCBhdCBvbmNlLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFF1ZXVlIG9wdGlvbnM6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSB7bnVtYmVyfSBkZWxheSAgRGVsYXkgaW4gbXMsIG51bGwgYnkgZGVmYXVsdAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0ge251bWJlcn0gbWF4ICAgIE1heGltdW0gbnVtYmVyIG9mIGVudHJpZXMgaW4gdGhlIHF1ZXVlLCBJbmZpbml0eSBieSBkZWZhdWx0CiAgICogQHBhcmFtIG9wdGlvbnMKICAgKi8KICBEYXRhU2V0LnByb3RvdHlwZS5zZXRPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMucXVldWUgIT09IHVuZGVmaW5lZCkgewogICAgICBpZiAob3B0aW9ucy5xdWV1ZSA9PT0gZmFsc2UpIHsKICAgICAgICAvLyBkZWxldGUgcXVldWUgaWYgbG9hZGVkCiAgICAgICAgaWYgKHRoaXMuX3F1ZXVlKSB7CiAgICAgICAgICB0aGlzLl9xdWV1ZS5kZXN0cm95KCk7CiAgICAgICAgICBkZWxldGUgdGhpcy5fcXVldWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIGNyZWF0ZSBxdWV1ZSBhbmQgdXBkYXRlIGl0cyBvcHRpb25zCiAgICAgICAgaWYgKCF0aGlzLl9xdWV1ZSkgewogICAgICAgICAgdGhpcy5fcXVldWUgPSBRdWV1ZS5leHRlbmQodGhpcywgewogICAgICAgICAgICByZXBsYWNlOiBbJ2FkZCcsICd1cGRhdGUnLCAncmVtb3ZlJ10KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnF1ZXVlID09PSAnb2JqZWN0JykgewogICAgICAgICAgdGhpcy5fcXVldWUuc2V0T3B0aW9ucyhvcHRpb25zLnF1ZXVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBTdWJzY3JpYmUgdG8gYW4gZXZlbnQsIGFkZCBhbiBldmVudCBsaXN0ZW5lcgogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudCAgICAgICAgRXZlbnQgbmFtZS4gQXZhaWxhYmxlIGV2ZW50czogJ3B1dCcsICd1cGRhdGUnLAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlbW92ZScKICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAgIENhbGxiYWNrIG1ldGhvZC4gQ2FsbGVkIHdpdGggdGhyZWUgcGFyYW1ldGVyczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7U3RyaW5nfSBldmVudAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtPYmplY3QgfCBudWxsfSBwYXJhbXMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7U3RyaW5nIHwgTnVtYmVyfSBzZW5kZXJJZAogICAqLwogIERhdGFTZXQucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKGV2ZW50LCBjYWxsYmFjaykgewogICAgdmFyIHN1YnNjcmliZXJzID0gdGhpcy5fc3Vic2NyaWJlcnNbZXZlbnRdOwogICAgaWYgKCFzdWJzY3JpYmVycykgewogICAgICBzdWJzY3JpYmVycyA9IFtdOwogICAgICB0aGlzLl9zdWJzY3JpYmVyc1tldmVudF0gPSBzdWJzY3JpYmVyczsKICAgIH0KCiAgICBzdWJzY3JpYmVycy5wdXNoKHsKICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrCiAgICB9KTsKICB9OwoKICAvLyBUT0RPOiByZW1vdmUgdGhpcyBkZXByZWNhdGVkIGZ1bmN0aW9uIHNvbWUgZGF5IChyZXBsYWNlZCB3aXRoIGBvbmAgc2luY2UgdmVyc2lvbiAwLjUsIGRlcHJlY2F0ZWQgc2luY2UgdjQuMCkKICBEYXRhU2V0LnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFTZXQuc3Vic2NyaWJlIGlzIGRlcHJlY2F0ZWQuIFVzZSBEYXRhU2V0Lm9uIGluc3RlYWQuJyk7CiAgfTsKCiAgLyoqCiAgICogVW5zdWJzY3JpYmUgZnJvbSBhbiBldmVudCwgcmVtb3ZlIGFuIGV2ZW50IGxpc3RlbmVyCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sKICAgKi8KICBEYXRhU2V0LnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbiAoZXZlbnQsIGNhbGxiYWNrKSB7CiAgICB2YXIgc3Vic2NyaWJlcnMgPSB0aGlzLl9zdWJzY3JpYmVyc1tldmVudF07CiAgICBpZiAoc3Vic2NyaWJlcnMpIHsKICAgICAgdGhpcy5fc3Vic2NyaWJlcnNbZXZlbnRdID0gc3Vic2NyaWJlcnMuZmlsdGVyKGZ1bmN0aW9uIChsaXN0ZW5lcikgewogICAgICAgIHJldHVybiBsaXN0ZW5lci5jYWxsYmFjayAhPSBjYWxsYmFjazsKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgZGVwcmVjYXRlZCBmdW5jdGlvbiBzb21lIGRheSAocmVwbGFjZWQgd2l0aCBgb25gIHNpbmNlIHZlcnNpb24gMC41LCBkZXByZWNhdGVkIHNpbmNlIHY0LjApCiAgRGF0YVNldC5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFTZXQudW5zdWJzY3JpYmUgaXMgZGVwcmVjYXRlZC4gVXNlIERhdGFTZXQub2ZmIGluc3RlYWQuJyk7CiAgfTsKCiAgLyoqCiAgICogVHJpZ2dlciBhbiBldmVudAogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudAogICAqIEBwYXJhbSB7T2JqZWN0IHwgbnVsbH0gcGFyYW1zCiAgICogQHBhcmFtIHtTdHJpbmd9IFtzZW5kZXJJZF0gICAgICAgT3B0aW9uYWwgaWQgb2YgdGhlIHNlbmRlci4KICAgKiBAcHJpdmF0ZQogICAqLwogIERhdGFTZXQucHJvdG90eXBlLl90cmlnZ2VyID0gZnVuY3Rpb24gKGV2ZW50LCBwYXJhbXMsIHNlbmRlcklkKSB7CiAgICBpZiAoZXZlbnQgPT0gJyonKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHRyaWdnZXIgZXZlbnQgKicpOwogICAgfQoKICAgIHZhciBzdWJzY3JpYmVycyA9IFtdOwogICAgaWYgKGV2ZW50IGluIHRoaXMuX3N1YnNjcmliZXJzKSB7CiAgICAgIHN1YnNjcmliZXJzID0gc3Vic2NyaWJlcnMuY29uY2F0KHRoaXMuX3N1YnNjcmliZXJzW2V2ZW50XSk7CiAgICB9CiAgICBpZiAoJyonIGluIHRoaXMuX3N1YnNjcmliZXJzKSB7CiAgICAgIHN1YnNjcmliZXJzID0gc3Vic2NyaWJlcnMuY29uY2F0KHRoaXMuX3N1YnNjcmliZXJzWycqJ10pOwogICAgfQoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Vic2NyaWJlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHN1YnNjcmliZXIgPSBzdWJzY3JpYmVyc1tpXTsKICAgICAgaWYgKHN1YnNjcmliZXIuY2FsbGJhY2spIHsKICAgICAgICBzdWJzY3JpYmVyLmNhbGxiYWNrKGV2ZW50LCBwYXJhbXMsIHNlbmRlcklkIHx8IG51bGwpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQWRkIGRhdGEuCiAgICogQWRkaW5nIGFuIGl0ZW0gd2lsbCBmYWlsIHdoZW4gdGhlcmUgYWxyZWFkeSBpcyBhbiBpdGVtIHdpdGggdGhlIHNhbWUgaWQuCiAgICogQHBhcmFtIHtPYmplY3QgfCBBcnJheX0gZGF0YQogICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VuZGVySWRdIE9wdGlvbmFsIHNlbmRlciBpZAogICAqIEByZXR1cm4ge0FycmF5fSBhZGRlZElkcyAgICAgIEFycmF5IHdpdGggdGhlIGlkcyBvZiB0aGUgYWRkZWQgaXRlbXMKICAgKi8KICBEYXRhU2V0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAoZGF0YSwgc2VuZGVySWQpIHsKICAgIHZhciBhZGRlZElkcyA9IFtdLAogICAgICAgIGlkLAogICAgICAgIG1lID0gdGhpczsKCiAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICAvLyBBcnJheQogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZGF0YS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGlkID0gbWUuX2FkZEl0ZW0oZGF0YVtpXSk7CiAgICAgICAgYWRkZWRJZHMucHVzaChpZCk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZGF0YSBpbnN0YW5jZW9mIE9iamVjdCkgewogICAgICAvLyBTaW5nbGUgaXRlbQogICAgICBpZCA9IG1lLl9hZGRJdGVtKGRhdGEpOwogICAgICBhZGRlZElkcy5wdXNoKGlkKTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBkYXRhVHlwZScpOwogICAgfQoKICAgIGlmIChhZGRlZElkcy5sZW5ndGgpIHsKICAgICAgdGhpcy5fdHJpZ2dlcignYWRkJywgeyBpdGVtczogYWRkZWRJZHMgfSwgc2VuZGVySWQpOwogICAgfQoKICAgIHJldHVybiBhZGRlZElkczsKICB9OwoKICAvKioKICAgKiBVcGRhdGUgZXhpc3RpbmcgaXRlbXMuIFdoZW4gYW4gaXRlbSBkb2VzIG5vdCBleGlzdCwgaXQgd2lsbCBiZSBjcmVhdGVkCiAgICogQHBhcmFtIHtPYmplY3QgfCBBcnJheX0gZGF0YQogICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VuZGVySWRdIE9wdGlvbmFsIHNlbmRlciBpZAogICAqIEByZXR1cm4ge0FycmF5fSB1cGRhdGVkSWRzICAgICBUaGUgaWRzIG9mIHRoZSBhZGRlZCBvciB1cGRhdGVkIGl0ZW1zCiAgICovCiAgRGF0YVNldC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGRhdGEsIHNlbmRlcklkKSB7CiAgICB2YXIgYWRkZWRJZHMgPSBbXTsKICAgIHZhciB1cGRhdGVkSWRzID0gW107CiAgICB2YXIgdXBkYXRlZERhdGEgPSBbXTsKICAgIHZhciBtZSA9IHRoaXM7CiAgICB2YXIgZmllbGRJZCA9IG1lLl9maWVsZElkOwoKICAgIHZhciBhZGRPclVwZGF0ZSA9IGZ1bmN0aW9uIGFkZE9yVXBkYXRlKGl0ZW0pIHsKICAgICAgdmFyIGlkID0gaXRlbVtmaWVsZElkXTsKICAgICAgaWYgKG1lLl9kYXRhW2lkXSkgewogICAgICAgIC8vIHVwZGF0ZSBpdGVtCiAgICAgICAgaWQgPSBtZS5fdXBkYXRlSXRlbShpdGVtKTsKICAgICAgICB1cGRhdGVkSWRzLnB1c2goaWQpOwogICAgICAgIHVwZGF0ZWREYXRhLnB1c2goaXRlbSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gYWRkIG5ldyBpdGVtCiAgICAgICAgaWQgPSBtZS5fYWRkSXRlbShpdGVtKTsKICAgICAgICBhZGRlZElkcy5wdXNoKGlkKTsKICAgICAgfQogICAgfTsKCiAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICAvLyBBcnJheQogICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gZGF0YS5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGFkZE9yVXBkYXRlKGRhdGFbaV0pOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGRhdGEgaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgLy8gU2luZ2xlIGl0ZW0KICAgICAgYWRkT3JVcGRhdGUoZGF0YSk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gZGF0YVR5cGUnKTsKICAgIH0KCiAgICBpZiAoYWRkZWRJZHMubGVuZ3RoKSB7CiAgICAgIHRoaXMuX3RyaWdnZXIoJ2FkZCcsIHsgaXRlbXM6IGFkZGVkSWRzIH0sIHNlbmRlcklkKTsKICAgIH0KICAgIGlmICh1cGRhdGVkSWRzLmxlbmd0aCkgewogICAgICB0aGlzLl90cmlnZ2VyKCd1cGRhdGUnLCB7IGl0ZW1zOiB1cGRhdGVkSWRzLCBkYXRhOiB1cGRhdGVkRGF0YSB9LCBzZW5kZXJJZCk7CiAgICB9CgogICAgcmV0dXJuIGFkZGVkSWRzLmNvbmNhdCh1cGRhdGVkSWRzKTsKICB9OwoKICAvKioKICAgKiBHZXQgYSBkYXRhIGl0ZW0gb3IgbXVsdGlwbGUgaXRlbXMuCiAgICoKICAgKiBVc2FnZToKICAgKgogICAqICAgICBnZXQoKQogICAqICAgICBnZXQob3B0aW9uczogT2JqZWN0KQogICAqCiAgICogICAgIGdldChpZDogTnVtYmVyIHwgU3RyaW5nKQogICAqICAgICBnZXQoaWQ6IE51bWJlciB8IFN0cmluZywgb3B0aW9uczogT2JqZWN0KQogICAqCiAgICogICAgIGdldChpZHM6IE51bWJlcltdIHwgU3RyaW5nW10pCiAgICogICAgIGdldChpZHM6IE51bWJlcltdIHwgU3RyaW5nW10sIG9wdGlvbnM6IE9iamVjdCkKICAgKgogICAqIFdoZXJlOgogICAqCiAgICoge051bWJlciB8IFN0cmluZ30gaWQgICAgICAgICBUaGUgaWQgb2YgYW4gaXRlbQogICAqIHtOdW1iZXJbXSB8IFN0cmluZ3t9fSBpZHMgICAgQW4gYXJyYXkgd2l0aCBpZHMgb2YgaXRlbXMKICAgKiB7T2JqZWN0fSBvcHRpb25zICAgICAgICAgICAgIEFuIE9iamVjdCB3aXRoIG9wdGlvbnMuIEF2YWlsYWJsZSBvcHRpb25zOgogICAqIHtTdHJpbmd9IFtyZXR1cm5UeXBlXSAgICAgICAgVHlwZSBvZiBkYXRhIHRvIGJlIHJldHVybmVkLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FuIGJlICdBcnJheScgKGRlZmF1bHQpIG9yICdPYmplY3QnLgogICAqIHtPYmplY3QuPFN0cmluZywgU3RyaW5nPn0gW3R5cGVdCiAgICoge1N0cmluZ1tdfSBbZmllbGRzXSAgICAgICAgICBmaWVsZCBuYW1lcyB0byBiZSByZXR1cm5lZAogICAqIHtmdW5jdGlvbn0gW2ZpbHRlcl0gICAgICAgICAgZmlsdGVyIGl0ZW1zCiAgICoge1N0cmluZyB8IGZ1bmN0aW9ufSBbb3JkZXJdICBPcmRlciB0aGUgaXRlbXMgYnkgYSBmaWVsZCBuYW1lIG9yIGN1c3RvbSBzb3J0IGZ1bmN0aW9uLgogICAqIEB0aHJvd3MgRXJyb3IKICAgKi8KICBEYXRhU2V0LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoYXJncykgewogICAgdmFyIG1lID0gdGhpczsKCiAgICAvLyBwYXJzZSB0aGUgYXJndW1lbnRzCiAgICB2YXIgaWQsIGlkcywgb3B0aW9uczsKICAgIHZhciBmaXJzdFR5cGUgPSB1dGlsLmdldFR5cGUoYXJndW1lbnRzWzBdKTsKICAgIGlmIChmaXJzdFR5cGUgPT0gJ1N0cmluZycgfHwgZmlyc3RUeXBlID09ICdOdW1iZXInKSB7CiAgICAgIC8vIGdldChpZCBbLCBvcHRpb25zXSkKICAgICAgaWQgPSBhcmd1bWVudHNbMF07CiAgICAgIG9wdGlvbnMgPSBhcmd1bWVudHNbMV07CiAgICB9IGVsc2UgaWYgKGZpcnN0VHlwZSA9PSAnQXJyYXknKSB7CiAgICAgIC8vIGdldChpZHMgWywgb3B0aW9uc10pCiAgICAgIGlkcyA9IGFyZ3VtZW50c1swXTsKICAgICAgb3B0aW9ucyA9IGFyZ3VtZW50c1sxXTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGdldChbLCBvcHRpb25zXSkKICAgICAgb3B0aW9ucyA9IGFyZ3VtZW50c1swXTsKICAgIH0KCiAgICAvLyBkZXRlcm1pbmUgdGhlIHJldHVybiB0eXBlCiAgICB2YXIgcmV0dXJuVHlwZTsKICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMucmV0dXJuVHlwZSkgewogICAgICB2YXIgYWxsb3dlZFZhbHVlcyA9IFsnQXJyYXknLCAnT2JqZWN0J107CiAgICAgIHJldHVyblR5cGUgPSBhbGxvd2VkVmFsdWVzLmluZGV4T2Yob3B0aW9ucy5yZXR1cm5UeXBlKSA9PSAtMSA/ICdBcnJheScgOiBvcHRpb25zLnJldHVyblR5cGU7CiAgICB9IGVsc2UgewogICAgICByZXR1cm5UeXBlID0gJ0FycmF5JzsKICAgIH0KCiAgICAvLyBidWlsZCBvcHRpb25zCiAgICB2YXIgdHlwZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlIHx8IHRoaXMuX29wdGlvbnMudHlwZTsKICAgIHZhciBmaWx0ZXIgPSBvcHRpb25zICYmIG9wdGlvbnMuZmlsdGVyOwogICAgdmFyIGl0ZW1zID0gW10sCiAgICAgICAgaXRlbSwKICAgICAgICBpdGVtSWQsCiAgICAgICAgaSwKICAgICAgICBsZW47CgogICAgLy8gY29udmVydCBpdGVtcwogICAgaWYgKGlkICE9IHVuZGVmaW5lZCkgewogICAgICAvLyByZXR1cm4gYSBzaW5nbGUgaXRlbQogICAgICBpdGVtID0gbWUuX2dldEl0ZW0oaWQsIHR5cGUpOwogICAgICBpZiAoZmlsdGVyICYmICFmaWx0ZXIoaXRlbSkpIHsKICAgICAgICBpdGVtID0gbnVsbDsKICAgICAgfQogICAgfSBlbHNlIGlmIChpZHMgIT0gdW5kZWZpbmVkKSB7CiAgICAgIC8vIHJldHVybiBhIHN1YnNldCBvZiBpdGVtcwogICAgICBmb3IgKGkgPSAwLCBsZW4gPSBpZHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBpdGVtID0gbWUuX2dldEl0ZW0oaWRzW2ldLCB0eXBlKTsKICAgICAgICBpZiAoIWZpbHRlciB8fCBmaWx0ZXIoaXRlbSkpIHsKICAgICAgICAgIGl0ZW1zLnB1c2goaXRlbSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyByZXR1cm4gYWxsIGl0ZW1zCiAgICAgIGZvciAoaXRlbUlkIGluIHRoaXMuX2RhdGEpIHsKICAgICAgICBpZiAodGhpcy5fZGF0YS5oYXNPd25Qcm9wZXJ0eShpdGVtSWQpKSB7CiAgICAgICAgICBpdGVtID0gbWUuX2dldEl0ZW0oaXRlbUlkLCB0eXBlKTsKICAgICAgICAgIGlmICghZmlsdGVyIHx8IGZpbHRlcihpdGVtKSkgewogICAgICAgICAgICBpdGVtcy5wdXNoKGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8vIG9yZGVyIHRoZSByZXN1bHRzCiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLm9yZGVyICYmIGlkID09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLl9zb3J0KGl0ZW1zLCBvcHRpb25zLm9yZGVyKTsKICAgIH0KCiAgICAvLyBmaWx0ZXIgZmllbGRzIG9mIHRoZSBpdGVtcwogICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5maWVsZHMpIHsKICAgICAgdmFyIGZpZWxkcyA9IG9wdGlvbnMuZmllbGRzOwogICAgICBpZiAoaWQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaXRlbSA9IHRoaXMuX2ZpbHRlckZpZWxkcyhpdGVtLCBmaWVsZHMpOwogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGl0ZW1zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBpdGVtc1tpXSA9IHRoaXMuX2ZpbHRlckZpZWxkcyhpdGVtc1tpXSwgZmllbGRzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyByZXR1cm4gdGhlIHJlc3VsdHMKICAgIGlmIChyZXR1cm5UeXBlID09ICdPYmplY3QnKSB7CiAgICAgIHZhciByZXN1bHQgPSB7fTsKICAgICAgZm9yIChpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcmVzdWx0W2l0ZW1zW2ldLmlkXSA9IGl0ZW1zW2ldOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9IGVsc2UgewogICAgICBpZiAoaWQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gYSBzaW5nbGUgaXRlbQogICAgICAgIHJldHVybiBpdGVtOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGp1c3QgcmV0dXJuIG91ciBhcnJheQogICAgICAgIHJldHVybiBpdGVtczsKICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIEdldCBpZHMgb2YgYWxsIGl0ZW1zIG9yIGZyb20gYSBmaWx0ZXJlZCBzZXQgb2YgaXRlbXMuCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgICBBbiBPYmplY3Qgd2l0aCBvcHRpb25zLiBBdmFpbGFibGUgb3B0aW9uczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtmdW5jdGlvbn0gW2ZpbHRlcl0gZmlsdGVyIGl0ZW1zCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7U3RyaW5nIHwgZnVuY3Rpb259IFtvcmRlcl0gT3JkZXIgdGhlIGl0ZW1zIGJ5CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSBmaWVsZCBuYW1lIG9yIGN1c3RvbSBzb3J0IGZ1bmN0aW9uLgogICAqIEByZXR1cm4ge0FycmF5fSBpZHMKICAgKi8KICBEYXRhU2V0LnByb3RvdHlwZS5nZXRJZHMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgdmFyIGRhdGEgPSB0aGlzLl9kYXRhLAogICAgICAgIGZpbHRlciA9IG9wdGlvbnMgJiYgb3B0aW9ucy5maWx0ZXIsCiAgICAgICAgb3JkZXIgPSBvcHRpb25zICYmIG9wdGlvbnMub3JkZXIsCiAgICAgICAgdHlwZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlIHx8IHRoaXMuX29wdGlvbnMudHlwZSwKICAgICAgICBpLAogICAgICAgIGxlbiwKICAgICAgICBpZCwKICAgICAgICBpdGVtLAogICAgICAgIGl0ZW1zLAogICAgICAgIGlkcyA9IFtdOwoKICAgIGlmIChmaWx0ZXIpIHsKICAgICAgLy8gZ2V0IGZpbHRlcmVkIGl0ZW1zCiAgICAgIGlmIChvcmRlcikgewogICAgICAgIC8vIGNyZWF0ZSBvcmRlcmVkIGxpc3QKICAgICAgICBpdGVtcyA9IFtdOwogICAgICAgIGZvciAoaWQgaW4gZGF0YSkgewogICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgICAgICAgIGl0ZW0gPSB0aGlzLl9nZXRJdGVtKGlkLCB0eXBlKTsKICAgICAgICAgICAgaWYgKGZpbHRlcihpdGVtKSkgewogICAgICAgICAgICAgIGl0ZW1zLnB1c2goaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuX3NvcnQoaXRlbXMsIG9yZGVyKTsKCiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGlkc1tpXSA9IGl0ZW1zW2ldW3RoaXMuX2ZpZWxkSWRdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBjcmVhdGUgdW5vcmRlcmVkIGxpc3QKICAgICAgICBmb3IgKGlkIGluIGRhdGEpIHsKICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgICAgICBpdGVtID0gdGhpcy5fZ2V0SXRlbShpZCwgdHlwZSk7CiAgICAgICAgICAgIGlmIChmaWx0ZXIoaXRlbSkpIHsKICAgICAgICAgICAgICBpZHMucHVzaChpdGVtW3RoaXMuX2ZpZWxkSWRdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gZ2V0IGFsbCBpdGVtcwogICAgICBpZiAob3JkZXIpIHsKICAgICAgICAvLyBjcmVhdGUgYW4gb3JkZXJlZCBsaXN0CiAgICAgICAgaXRlbXMgPSBbXTsKICAgICAgICBmb3IgKGlkIGluIGRhdGEpIHsKICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgICAgICBpdGVtcy5wdXNoKGRhdGFbaWRdKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuX3NvcnQoaXRlbXMsIG9yZGVyKTsKCiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGlkc1tpXSA9IGl0ZW1zW2ldW3RoaXMuX2ZpZWxkSWRdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBjcmVhdGUgdW5vcmRlcmVkIGxpc3QKICAgICAgICBmb3IgKGlkIGluIGRhdGEpIHsKICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgICAgICBpdGVtID0gZGF0YVtpZF07CiAgICAgICAgICAgIGlkcy5wdXNoKGl0ZW1bdGhpcy5fZmllbGRJZF0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiBpZHM7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJucyB0aGUgRGF0YVNldCBpdHNlbGYuIElzIG92ZXJ3cml0dGVuIGZvciBleGFtcGxlIGJ5IHRoZSBEYXRhVmlldywKICAgKiB3aGljaCByZXR1cm5zIHRoZSBEYXRhU2V0IGl0IGlzIGNvbm5lY3RlZCB0byBpbnN0ZWFkLgogICAqLwogIERhdGFTZXQucHJvdG90eXBlLmdldERhdGFTZXQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvKioKICAgKiBFeGVjdXRlIGEgY2FsbGJhY2sgZnVuY3Rpb24gZm9yIGV2ZXJ5IGl0ZW0gaW4gdGhlIGRhdGFzZXQuCiAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICAgIEF2YWlsYWJsZSBvcHRpb25zOgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge09iamVjdC48U3RyaW5nLCBTdHJpbmc+fSBbdHlwZV0KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmdbXX0gW2ZpZWxkc10gZmlsdGVyIGZpZWxkcwogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2Z1bmN0aW9ufSBbZmlsdGVyXSBmaWx0ZXIgaXRlbXMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmcgfCBmdW5jdGlvbn0gW29yZGVyXSBPcmRlciB0aGUgaXRlbXMgYnkKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIGZpZWxkIG5hbWUgb3IgY3VzdG9tIHNvcnQgZnVuY3Rpb24uCiAgICovCiAgRGF0YVNldC5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uIChjYWxsYmFjaywgb3B0aW9ucykgewogICAgdmFyIGZpbHRlciA9IG9wdGlvbnMgJiYgb3B0aW9ucy5maWx0ZXIsCiAgICAgICAgdHlwZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlIHx8IHRoaXMuX29wdGlvbnMudHlwZSwKICAgICAgICBkYXRhID0gdGhpcy5fZGF0YSwKICAgICAgICBpdGVtLAogICAgICAgIGlkOwoKICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMub3JkZXIpIHsKICAgICAgLy8gZXhlY3V0ZSBmb3JFYWNoIG9uIG9yZGVyZWQgbGlzdAogICAgICB2YXIgaXRlbXMgPSB0aGlzLmdldChvcHRpb25zKTsKCiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBpdGVtcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGl0ZW0gPSBpdGVtc1tpXTsKICAgICAgICBpZCA9IGl0ZW1bdGhpcy5fZmllbGRJZF07CiAgICAgICAgY2FsbGJhY2soaXRlbSwgaWQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyB1bm9yZGVyZWQKICAgICAgZm9yIChpZCBpbiBkYXRhKSB7CiAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgICAgICBpdGVtID0gdGhpcy5fZ2V0SXRlbShpZCwgdHlwZSk7CiAgICAgICAgICBpZiAoIWZpbHRlciB8fCBmaWx0ZXIoaXRlbSkpIHsKICAgICAgICAgICAgY2FsbGJhY2soaXRlbSwgaWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIE1hcCBldmVyeSBpdGVtIGluIHRoZSBkYXRhc2V0LgogICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgICBBdmFpbGFibGUgb3B0aW9uczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtPYmplY3QuPFN0cmluZywgU3RyaW5nPn0gW3R5cGVdCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7U3RyaW5nW119IFtmaWVsZHNdIGZpbHRlciBmaWVsZHMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtmdW5jdGlvbn0gW2ZpbHRlcl0gZmlsdGVyIGl0ZW1zCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7U3RyaW5nIHwgZnVuY3Rpb259IFtvcmRlcl0gT3JkZXIgdGhlIGl0ZW1zIGJ5CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSBmaWVsZCBuYW1lIG9yIGN1c3RvbSBzb3J0IGZ1bmN0aW9uLgogICAqIEByZXR1cm4ge09iamVjdFtdfSBtYXBwZWRJdGVtcwogICAqLwogIERhdGFTZXQucHJvdG90eXBlLm1hcCA9IGZ1bmN0aW9uIChjYWxsYmFjaywgb3B0aW9ucykgewogICAgdmFyIGZpbHRlciA9IG9wdGlvbnMgJiYgb3B0aW9ucy5maWx0ZXIsCiAgICAgICAgdHlwZSA9IG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlIHx8IHRoaXMuX29wdGlvbnMudHlwZSwKICAgICAgICBtYXBwZWRJdGVtcyA9IFtdLAogICAgICAgIGRhdGEgPSB0aGlzLl9kYXRhLAogICAgICAgIGl0ZW07CgogICAgLy8gY29udmVydCBhbmQgZmlsdGVyIGl0ZW1zCiAgICBmb3IgKHZhciBpZCBpbiBkYXRhKSB7CiAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgIGl0ZW0gPSB0aGlzLl9nZXRJdGVtKGlkLCB0eXBlKTsKICAgICAgICBpZiAoIWZpbHRlciB8fCBmaWx0ZXIoaXRlbSkpIHsKICAgICAgICAgIG1hcHBlZEl0ZW1zLnB1c2goY2FsbGJhY2soaXRlbSwgaWQpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBvcmRlciBpdGVtcwogICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5vcmRlcikgewogICAgICB0aGlzLl9zb3J0KG1hcHBlZEl0ZW1zLCBvcHRpb25zLm9yZGVyKTsKICAgIH0KCiAgICByZXR1cm4gbWFwcGVkSXRlbXM7CiAgfTsKCiAgLyoqCiAgICogRmlsdGVyIHRoZSBmaWVsZHMgb2YgYW4gaXRlbQogICAqIEBwYXJhbSB7T2JqZWN0IHwgbnVsbH0gaXRlbQogICAqIEBwYXJhbSB7U3RyaW5nW119IGZpZWxkcyAgICAgRmllbGQgbmFtZXMKICAgKiBAcmV0dXJuIHtPYmplY3QgfCBudWxsfSBmaWx0ZXJlZEl0ZW0gb3IgbnVsbCBpZiBubyBpdGVtIGlzIHByb3ZpZGVkCiAgICogQHByaXZhdGUKICAgKi8KICBEYXRhU2V0LnByb3RvdHlwZS5fZmlsdGVyRmllbGRzID0gZnVuY3Rpb24gKGl0ZW0sIGZpZWxkcykgewogICAgaWYgKCFpdGVtKSB7CiAgICAgIC8vIGl0ZW0gaXMgbnVsbAogICAgICByZXR1cm4gaXRlbTsKICAgIH0KCiAgICB2YXIgZmlsdGVyZWRJdGVtID0ge307CgogICAgaWYgKEFycmF5LmlzQXJyYXkoZmllbGRzKSkgewogICAgICBmb3IgKHZhciBmaWVsZCBpbiBpdGVtKSB7CiAgICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoZmllbGQpICYmIGZpZWxkcy5pbmRleE9mKGZpZWxkKSAhPSAtMSkgewogICAgICAgICAgZmlsdGVyZWRJdGVtW2ZpZWxkXSA9IGl0ZW1bZmllbGRdOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yICh2YXIgZmllbGQgaW4gaXRlbSkgewogICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KGZpZWxkKSAmJiBmaWVsZHMuaGFzT3duUHJvcGVydHkoZmllbGQpKSB7CiAgICAgICAgICBmaWx0ZXJlZEl0ZW1bZmllbGRzW2ZpZWxkXV0gPSBpdGVtW2ZpZWxkXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmlsdGVyZWRJdGVtOwogIH07CgogIC8qKgogICAqIFNvcnQgdGhlIHByb3ZpZGVkIGFycmF5IHdpdGggaXRlbXMKICAgKiBAcGFyYW0ge09iamVjdFtdfSBpdGVtcwogICAqIEBwYXJhbSB7U3RyaW5nIHwgZnVuY3Rpb259IG9yZGVyICAgICAgQSBmaWVsZCBuYW1lIG9yIGN1c3RvbSBzb3J0IGZ1bmN0aW9uLgogICAqIEBwcml2YXRlCiAgICovCiAgRGF0YVNldC5wcm90b3R5cGUuX3NvcnQgPSBmdW5jdGlvbiAoaXRlbXMsIG9yZGVyKSB7CiAgICBpZiAodXRpbC5pc1N0cmluZyhvcmRlcikpIHsKICAgICAgLy8gb3JkZXIgYnkgcHJvdmlkZWQgZmllbGQgbmFtZQogICAgICB2YXIgbmFtZSA9IG9yZGVyOyAvLyBmaWVsZCBuYW1lCiAgICAgIGl0ZW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYXYgPSBhW25hbWVdOwogICAgICAgIHZhciBidiA9IGJbbmFtZV07CiAgICAgICAgcmV0dXJuIGF2ID4gYnYgPyAxIDogYXYgPCBidiA/IC0xIDogMDsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcmRlciA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAvLyBvcmRlciBieSBzb3J0IGZ1bmN0aW9uCiAgICAgIGl0ZW1zLnNvcnQob3JkZXIpOwogICAgfQogICAgLy8gVE9ETzogZXh0ZW5kIG9yZGVyIGJ5IGFuIE9iamVjdCB7ZmllbGQ6U3RyaW5nLCBkaXJlY3Rpb246U3RyaW5nfQogICAgLy8gICAgICAgd2hlcmUgZGlyZWN0aW9uIGNhbiBiZSAnYXNjJyBvciAnZGVzYycKICAgIGVsc2UgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdPcmRlciBtdXN0IGJlIGEgZnVuY3Rpb24gb3IgYSBzdHJpbmcnKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBSZW1vdmUgYW4gb2JqZWN0IGJ5IHBvaW50ZXIgb3IgYnkgaWQKICAgKiBAcGFyYW0ge1N0cmluZyB8IE51bWJlciB8IE9iamVjdCB8IEFycmF5fSBpZCBPYmplY3Qgb3IgaWQsIG9yIGFuIGFycmF5IHdpdGgKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RzIG9yIGlkcyB0byBiZSByZW1vdmVkCiAgICogQHBhcmFtIHtTdHJpbmd9IFtzZW5kZXJJZF0gT3B0aW9uYWwgc2VuZGVyIGlkCiAgICogQHJldHVybiB7QXJyYXl9IHJlbW92ZWRJZHMKICAgKi8KICBEYXRhU2V0LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoaWQsIHNlbmRlcklkKSB7CiAgICB2YXIgcmVtb3ZlZElkcyA9IFtdLAogICAgICAgIGksCiAgICAgICAgbGVuLAogICAgICAgIHJlbW92ZWRJZDsKCiAgICBpZiAoQXJyYXkuaXNBcnJheShpZCkpIHsKICAgICAgZm9yIChpID0gMCwgbGVuID0gaWQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICByZW1vdmVkSWQgPSB0aGlzLl9yZW1vdmUoaWRbaV0pOwogICAgICAgIGlmIChyZW1vdmVkSWQgIT0gbnVsbCkgewogICAgICAgICAgcmVtb3ZlZElkcy5wdXNoKHJlbW92ZWRJZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICByZW1vdmVkSWQgPSB0aGlzLl9yZW1vdmUoaWQpOwogICAgICBpZiAocmVtb3ZlZElkICE9IG51bGwpIHsKICAgICAgICByZW1vdmVkSWRzLnB1c2gocmVtb3ZlZElkKTsKICAgICAgfQogICAgfQoKICAgIGlmIChyZW1vdmVkSWRzLmxlbmd0aCkgewogICAgICB0aGlzLl90cmlnZ2VyKCdyZW1vdmUnLCB7IGl0ZW1zOiByZW1vdmVkSWRzIH0sIHNlbmRlcklkKTsKICAgIH0KCiAgICByZXR1cm4gcmVtb3ZlZElkczsKICB9OwoKICAvKioKICAgKiBSZW1vdmUgYW4gaXRlbSBieSBpdHMgaWQKICAgKiBAcGFyYW0ge051bWJlciB8IFN0cmluZyB8IE9iamVjdH0gaWQgICBpZCBvciBpdGVtCiAgICogQHJldHVybnMge051bWJlciB8IFN0cmluZyB8IG51bGx9IGlkCiAgICogQHByaXZhdGUKICAgKi8KICBEYXRhU2V0LnByb3RvdHlwZS5fcmVtb3ZlID0gZnVuY3Rpb24gKGlkKSB7CiAgICBpZiAodXRpbC5pc051bWJlcihpZCkgfHwgdXRpbC5pc1N0cmluZyhpZCkpIHsKICAgICAgaWYgKHRoaXMuX2RhdGFbaWRdKSB7CiAgICAgICAgZGVsZXRlIHRoaXMuX2RhdGFbaWRdOwogICAgICAgIHRoaXMubGVuZ3RoLS07CiAgICAgICAgcmV0dXJuIGlkOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGlkIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgIHZhciBpdGVtSWQgPSBpZFt0aGlzLl9maWVsZElkXTsKICAgICAgaWYgKGl0ZW1JZCAmJiB0aGlzLl9kYXRhW2l0ZW1JZF0pIHsKICAgICAgICBkZWxldGUgdGhpcy5fZGF0YVtpdGVtSWRdOwogICAgICAgIHRoaXMubGVuZ3RoLS07CiAgICAgICAgcmV0dXJuIGl0ZW1JZDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfTsKCiAgLyoqCiAgICogQ2xlYXIgdGhlIGRhdGEKICAgKiBAcGFyYW0ge1N0cmluZ30gW3NlbmRlcklkXSBPcHRpb25hbCBzZW5kZXIgaWQKICAgKiBAcmV0dXJuIHtBcnJheX0gcmVtb3ZlZElkcyAgICBUaGUgaWRzIG9mIGFsbCByZW1vdmVkIGl0ZW1zCiAgICovCiAgRGF0YVNldC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoc2VuZGVySWQpIHsKICAgIHZhciBpZHMgPSBPYmplY3Qua2V5cyh0aGlzLl9kYXRhKTsKCiAgICB0aGlzLl9kYXRhID0ge307CiAgICB0aGlzLmxlbmd0aCA9IDA7CgogICAgdGhpcy5fdHJpZ2dlcigncmVtb3ZlJywgeyBpdGVtczogaWRzIH0sIHNlbmRlcklkKTsKCiAgICByZXR1cm4gaWRzOwogIH07CgogIC8qKgogICAqIEZpbmQgdGhlIGl0ZW0gd2l0aCBtYXhpbXVtIHZhbHVlIG9mIGEgc3BlY2lmaWVkIGZpZWxkCiAgICogQHBhcmFtIHtTdHJpbmd9IGZpZWxkCiAgICogQHJldHVybiB7T2JqZWN0IHwgbnVsbH0gaXRlbSAgSXRlbSBjb250YWluaW5nIG1heCB2YWx1ZSwgb3IgbnVsbCBpZiBubyBpdGVtcwogICAqLwogIERhdGFTZXQucHJvdG90eXBlLm1heCA9IGZ1bmN0aW9uIChmaWVsZCkgewogICAgdmFyIGRhdGEgPSB0aGlzLl9kYXRhLAogICAgICAgIG1heCA9IG51bGwsCiAgICAgICAgbWF4RmllbGQgPSBudWxsOwoKICAgIGZvciAodmFyIGlkIGluIGRhdGEpIHsKICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgICAgdmFyIGl0ZW0gPSBkYXRhW2lkXTsKICAgICAgICB2YXIgaXRlbUZpZWxkID0gaXRlbVtmaWVsZF07CiAgICAgICAgaWYgKGl0ZW1GaWVsZCAhPSBudWxsICYmICghbWF4IHx8IGl0ZW1GaWVsZCA+IG1heEZpZWxkKSkgewogICAgICAgICAgbWF4ID0gaXRlbTsKICAgICAgICAgIG1heEZpZWxkID0gaXRlbUZpZWxkOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiBtYXg7CiAgfTsKCiAgLyoqCiAgICogRmluZCB0aGUgaXRlbSB3aXRoIG1pbmltdW0gdmFsdWUgb2YgYSBzcGVjaWZpZWQgZmllbGQKICAgKiBAcGFyYW0ge1N0cmluZ30gZmllbGQKICAgKiBAcmV0dXJuIHtPYmplY3QgfCBudWxsfSBpdGVtICBJdGVtIGNvbnRhaW5pbmcgbWF4IHZhbHVlLCBvciBudWxsIGlmIG5vIGl0ZW1zCiAgICovCiAgRGF0YVNldC5wcm90b3R5cGUubWluID0gZnVuY3Rpb24gKGZpZWxkKSB7CiAgICB2YXIgZGF0YSA9IHRoaXMuX2RhdGEsCiAgICAgICAgbWluID0gbnVsbCwKICAgICAgICBtaW5GaWVsZCA9IG51bGw7CgogICAgZm9yICh2YXIgaWQgaW4gZGF0YSkgewogICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICB2YXIgaXRlbSA9IGRhdGFbaWRdOwogICAgICAgIHZhciBpdGVtRmllbGQgPSBpdGVtW2ZpZWxkXTsKICAgICAgICBpZiAoaXRlbUZpZWxkICE9IG51bGwgJiYgKCFtaW4gfHwgaXRlbUZpZWxkIDwgbWluRmllbGQpKSB7CiAgICAgICAgICBtaW4gPSBpdGVtOwogICAgICAgICAgbWluRmllbGQgPSBpdGVtRmllbGQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG1pbjsKICB9OwoKICAvKioKICAgKiBGaW5kIGFsbCBkaXN0aW5jdCB2YWx1ZXMgb2YgYSBzcGVjaWZpZWQgZmllbGQKICAgKiBAcGFyYW0ge1N0cmluZ30gZmllbGQKICAgKiBAcmV0dXJuIHtBcnJheX0gdmFsdWVzICBBcnJheSBjb250YWluaW5nIGFsbCBkaXN0aW5jdCB2YWx1ZXMuIElmIGRhdGEgaXRlbXMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICBkbyBub3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIGZpZWxkIGFyZSBpZ25vcmVkLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSByZXR1cm5lZCBhcnJheSBpcyB1bm9yZGVyZWQuCiAgICovCiAgRGF0YVNldC5wcm90b3R5cGUuZGlzdGluY3QgPSBmdW5jdGlvbiAoZmllbGQpIHsKICAgIHZhciBkYXRhID0gdGhpcy5fZGF0YTsKICAgIHZhciB2YWx1ZXMgPSBbXTsKICAgIHZhciBmaWVsZFR5cGUgPSB0aGlzLl9vcHRpb25zLnR5cGUgJiYgdGhpcy5fb3B0aW9ucy50eXBlW2ZpZWxkXSB8fCBudWxsOwogICAgdmFyIGNvdW50ID0gMDsKICAgIHZhciBpOwoKICAgIGZvciAodmFyIHByb3AgaW4gZGF0YSkgewogICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgIHZhciBpdGVtID0gZGF0YVtwcm9wXTsKICAgICAgICB2YXIgdmFsdWUgPSBpdGVtW2ZpZWxkXTsKICAgICAgICB2YXIgZXhpc3RzID0gZmFsc2U7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgIGlmICh2YWx1ZXNbaV0gPT0gdmFsdWUpIHsKICAgICAgICAgICAgZXhpc3RzID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZXhpc3RzICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhbHVlc1tjb3VudF0gPSB2YWx1ZTsKICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKGZpZWxkVHlwZSkgewogICAgICBmb3IgKGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFsdWVzW2ldID0gdXRpbC5jb252ZXJ0KHZhbHVlc1tpXSwgZmllbGRUeXBlKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB2YWx1ZXM7CiAgfTsKCiAgLyoqCiAgICogQWRkIGEgc2luZ2xlIGl0ZW0uIFdpbGwgZmFpbCB3aGVuIGFuIGl0ZW0gd2l0aCB0aGUgc2FtZSBpZCBhbHJlYWR5IGV4aXN0cy4KICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbQogICAqIEByZXR1cm4ge1N0cmluZ30gaWQKICAgKiBAcHJpdmF0ZQogICAqLwogIERhdGFTZXQucHJvdG90eXBlLl9hZGRJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHsKICAgIHZhciBpZCA9IGl0ZW1bdGhpcy5fZmllbGRJZF07CgogICAgaWYgKGlkICE9IHVuZGVmaW5lZCkgewogICAgICAvLyBjaGVjayB3aGV0aGVyIHRoaXMgaWQgaXMgYWxyZWFkeSB0YWtlbgogICAgICBpZiAodGhpcy5fZGF0YVtpZF0pIHsKICAgICAgICAvLyBpdGVtIGFscmVhZHkgZXhpc3RzCiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgYWRkIGl0ZW06IGl0ZW0gd2l0aCBpZCAnICsgaWQgKyAnIGFscmVhZHkgZXhpc3RzJyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIGdlbmVyYXRlIGFuIGlkCiAgICAgIGlkID0gdXRpbC5yYW5kb21VVUlEKCk7CiAgICAgIGl0ZW1bdGhpcy5fZmllbGRJZF0gPSBpZDsKICAgIH0KCiAgICB2YXIgZCA9IHt9OwogICAgZm9yICh2YXIgZmllbGQgaW4gaXRlbSkgewogICAgICBpZiAoaXRlbS5oYXNPd25Qcm9wZXJ0eShmaWVsZCkpIHsKICAgICAgICB2YXIgZmllbGRUeXBlID0gdGhpcy5fdHlwZVtmaWVsZF07IC8vIHR5cGUgbWF5IGJlIHVuZGVmaW5lZAogICAgICAgIGRbZmllbGRdID0gdXRpbC5jb252ZXJ0KGl0ZW1bZmllbGRdLCBmaWVsZFR5cGUpOwogICAgICB9CiAgICB9CiAgICB0aGlzLl9kYXRhW2lkXSA9IGQ7CiAgICB0aGlzLmxlbmd0aCsrOwoKICAgIHJldHVybiBpZDsKICB9OwoKICAvKioKICAgKiBHZXQgYW4gaXRlbS4gRmllbGRzIGNhbiBiZSBjb252ZXJ0ZWQgdG8gYSBzcGVjaWZpYyB0eXBlCiAgICogQHBhcmFtIHtTdHJpbmd9IGlkCiAgICogQHBhcmFtIHtPYmplY3QuPFN0cmluZywgU3RyaW5nPn0gW3R5cGVzXSAgZmllbGQgdHlwZXMgdG8gY29udmVydAogICAqIEByZXR1cm4ge09iamVjdCB8IG51bGx9IGl0ZW0KICAgKiBAcHJpdmF0ZQogICAqLwogIERhdGFTZXQucHJvdG90eXBlLl9nZXRJdGVtID0gZnVuY3Rpb24gKGlkLCB0eXBlcykgewogICAgdmFyIGZpZWxkLCB2YWx1ZTsKCiAgICAvLyBnZXQgdGhlIGl0ZW0gZnJvbSB0aGUgZGF0YXNldAogICAgdmFyIHJhdyA9IHRoaXMuX2RhdGFbaWRdOwogICAgaWYgKCFyYXcpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLy8gY29udmVydCB0aGUgaXRlbXMgZmllbGQgdHlwZXMKICAgIHZhciBjb252ZXJ0ZWQgPSB7fTsKICAgIGlmICh0eXBlcykgewogICAgICBmb3IgKGZpZWxkIGluIHJhdykgewogICAgICAgIGlmIChyYXcuaGFzT3duUHJvcGVydHkoZmllbGQpKSB7CiAgICAgICAgICB2YWx1ZSA9IHJhd1tmaWVsZF07CiAgICAgICAgICBjb252ZXJ0ZWRbZmllbGRdID0gdXRpbC5jb252ZXJ0KHZhbHVlLCB0eXBlc1tmaWVsZF0pOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gbm8gZmllbGQgdHlwZXMgc3BlY2lmaWVkLCBubyBjb252ZXJ0aW5nIG5lZWRlZAogICAgICBmb3IgKGZpZWxkIGluIHJhdykgewogICAgICAgIGlmIChyYXcuaGFzT3duUHJvcGVydHkoZmllbGQpKSB7CiAgICAgICAgICB2YWx1ZSA9IHJhd1tmaWVsZF07CiAgICAgICAgICBjb252ZXJ0ZWRbZmllbGRdID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gY29udmVydGVkOwogIH07CgogIC8qKgogICAqIFVwZGF0ZSBhIHNpbmdsZSBpdGVtOiBtZXJnZSB3aXRoIGV4aXN0aW5nIGl0ZW0uCiAgICogV2lsbCBmYWlsIHdoZW4gdGhlIGl0ZW0gaGFzIG5vIGlkLCBvciB3aGVuIHRoZXJlIGRvZXMgbm90IGV4aXN0IGFuIGl0ZW0KICAgKiB3aXRoIHRoZSBzYW1lIGlkLgogICAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtCiAgICogQHJldHVybiB7U3RyaW5nfSBpZAogICAqIEBwcml2YXRlCiAgICovCiAgRGF0YVNldC5wcm90b3R5cGUuX3VwZGF0ZUl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkgewogICAgdmFyIGlkID0gaXRlbVt0aGlzLl9maWVsZElkXTsKICAgIGlmIChpZCA9PSB1bmRlZmluZWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgdXBkYXRlIGl0ZW06IGl0ZW0gaGFzIG5vIGlkIChpdGVtOiAnICsgSlNPTi5zdHJpbmdpZnkoaXRlbSkgKyAnKScpOwogICAgfQogICAgdmFyIGQgPSB0aGlzLl9kYXRhW2lkXTsKICAgIGlmICghZCkgewogICAgICAvLyBpdGVtIGRvZXNuJ3QgZXhpc3QKICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgdXBkYXRlIGl0ZW06IG5vIGl0ZW0gd2l0aCBpZCAnICsgaWQgKyAnIGZvdW5kJyk7CiAgICB9CgogICAgLy8gbWVyZ2Ugd2l0aCBjdXJyZW50IGl0ZW0KICAgIGZvciAodmFyIGZpZWxkIGluIGl0ZW0pIHsKICAgICAgaWYgKGl0ZW0uaGFzT3duUHJvcGVydHkoZmllbGQpKSB7CiAgICAgICAgdmFyIGZpZWxkVHlwZSA9IHRoaXMuX3R5cGVbZmllbGRdOyAvLyB0eXBlIG1heSBiZSB1bmRlZmluZWQKICAgICAgICBkW2ZpZWxkXSA9IHV0aWwuY29udmVydChpdGVtW2ZpZWxkXSwgZmllbGRUeXBlKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBpZDsKICB9OwoKICBtb2R1bGUuZXhwb3J0cyA9IERhdGFTZXQ7CgovKioqLyB9LAovKiA5ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKICAvKioKICAgKiBBIHF1ZXVlCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiAgICAgICAgICAgIEF2YWlsYWJsZSBvcHRpb25zOgogICAqICAgICAgICAgICAgLSBkZWxheTogbnVtYmVyICAgIFdoZW4gcHJvdmlkZWQsIHRoZSBxdWV1ZSB3aWxsIGJlIGZsdXNoZWQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5IGFmdGVyIGFuIGluYWN0aXZpdHkgb2YgdGhpcyBkZWxheQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIG1pbGxpc2Vjb25kcy4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHZhbHVlIGlzIG51bGwuCiAgICogICAgICAgICAgICAtIG1heDogbnVtYmVyICAgICAgV2hlbiB0aGUgcXVldWUgZXhjZWVkcyB0aGUgZ2l2ZW4gbWF4aW11bSBudW1iZXIKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZiBlbnRyaWVzLCB0aGUgcXVldWUgaXMgZmx1c2hlZCBhdXRvbWF0aWNhbGx5LgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWUgb2YgbWF4IGlzIEluZmluaXR5LgogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogICd1c2Ugc3RyaWN0JzsKCiAgZnVuY3Rpb24gUXVldWUob3B0aW9ucykgewogICAgLy8gb3B0aW9ucwogICAgdGhpcy5kZWxheSA9IG51bGw7CiAgICB0aGlzLm1heCA9IEluZmluaXR5OwoKICAgIC8vIHByb3BlcnRpZXMKICAgIHRoaXMuX3F1ZXVlID0gW107CiAgICB0aGlzLl90aW1lb3V0ID0gbnVsbDsKICAgIHRoaXMuX2V4dGVuZGVkID0gbnVsbDsKCiAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgfQoKICAvKioKICAgKiBVcGRhdGUgdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIHF1ZXVlCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiAgICAgICAgICAgIEF2YWlsYWJsZSBvcHRpb25zOgogICAqICAgICAgICAgICAgLSBkZWxheTogbnVtYmVyICAgIFdoZW4gcHJvdmlkZWQsIHRoZSBxdWV1ZSB3aWxsIGJlIGZsdXNoZWQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvbWF0aWNhbGx5IGFmdGVyIGFuIGluYWN0aXZpdHkgb2YgdGhpcyBkZWxheQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIG1pbGxpc2Vjb25kcy4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IHZhbHVlIGlzIG51bGwuCiAgICogICAgICAgICAgICAtIG1heDogbnVtYmVyICAgICAgV2hlbiB0aGUgcXVldWUgZXhjZWVkcyB0aGUgZ2l2ZW4gbWF4aW11bSBudW1iZXIKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZiBlbnRyaWVzLCB0aGUgcXVldWUgaXMgZmx1c2hlZCBhdXRvbWF0aWNhbGx5LgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWUgb2YgbWF4IGlzIEluZmluaXR5LgogICAqIEBwYXJhbSBvcHRpb25zCiAgICovCiAgUXVldWUucHJvdG90eXBlLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMgJiYgdHlwZW9mIG9wdGlvbnMuZGVsYXkgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRoaXMuZGVsYXkgPSBvcHRpb25zLmRlbGF5OwogICAgfQogICAgaWYgKG9wdGlvbnMgJiYgdHlwZW9mIG9wdGlvbnMubWF4ICE9PSAndW5kZWZpbmVkJykgewogICAgICB0aGlzLm1heCA9IG9wdGlvbnMubWF4OwogICAgfQoKICAgIHRoaXMuX2ZsdXNoSWZOZWVkZWQoKTsKICB9OwoKICAvKioKICAgKiBFeHRlbmQgYW4gb2JqZWN0IHdpdGggcXVldWluZyBmdW5jdGlvbmFsaXR5LgogICAqIFRoZSBvYmplY3Qgd2lsbCBiZSBleHRlbmRlZCB3aXRoIGEgZnVuY3Rpb24gZmx1c2gsIGFuZCB0aGUgbWV0aG9kcyBwcm92aWRlZAogICAqIGluIG9wdGlvbnMucmVwbGFjZSB3aWxsIGJlIHJlcGxhY2VkIHdpdGggcXVldWVkIG9uZXMuCiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdAogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICogICAgICAgICAgICBBdmFpbGFibGUgb3B0aW9uczoKICAgKiAgICAgICAgICAgIC0gcmVwbGFjZTogQXJyYXkuPHN0cmluZz4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBIGxpc3Qgd2l0aCBtZXRob2QgbmFtZXMgb2YgdGhlIG1ldGhvZHMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbiB0aGUgb2JqZWN0IHRvIGJlIHJlcGxhY2VkIHdpdGggcXVldWVkIG9uZXMuCiAgICogICAgICAgICAgICAtIGRlbGF5OiBudW1iZXIgICAgV2hlbiBwcm92aWRlZCwgdGhlIHF1ZXVlIHdpbGwgYmUgZmx1c2hlZAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHkgYWZ0ZXIgYW4gaW5hY3Rpdml0eSBvZiB0aGlzIGRlbGF5CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW4gbWlsbGlzZWNvbmRzLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgdmFsdWUgaXMgbnVsbC4KICAgKiAgICAgICAgICAgIC0gbWF4OiBudW1iZXIgICAgICBXaGVuIHRoZSBxdWV1ZSBleGNlZWRzIHRoZSBnaXZlbiBtYXhpbXVtIG51bWJlcgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mIGVudHJpZXMsIHRoZSBxdWV1ZSBpcyBmbHVzaGVkIGF1dG9tYXRpY2FsbHkuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB2YWx1ZSBvZiBtYXggaXMgSW5maW5pdHkuCiAgICogQHJldHVybiB7UXVldWV9IFJldHVybnMgdGhlIGNyZWF0ZWQgcXVldWUKICAgKi8KICBRdWV1ZS5leHRlbmQgPSBmdW5jdGlvbiAob2JqZWN0LCBvcHRpb25zKSB7CiAgICB2YXIgcXVldWUgPSBuZXcgUXVldWUob3B0aW9ucyk7CgogICAgaWYgKG9iamVjdC5mbHVzaCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignVGFyZ2V0IG9iamVjdCBhbHJlYWR5IGhhcyBhIHByb3BlcnR5IGZsdXNoJyk7CiAgICB9CiAgICBvYmplY3QuZmx1c2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgIHF1ZXVlLmZsdXNoKCk7CiAgICB9OwoKICAgIHZhciBtZXRob2RzID0gW3sKICAgICAgbmFtZTogJ2ZsdXNoJywKICAgICAgb3JpZ2luYWw6IHVuZGVmaW5lZAogICAgfV07CgogICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5yZXBsYWNlKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3B0aW9ucy5yZXBsYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIG5hbWUgPSBvcHRpb25zLnJlcGxhY2VbaV07CiAgICAgICAgbWV0aG9kcy5wdXNoKHsKICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICBvcmlnaW5hbDogb2JqZWN0W25hbWVdCiAgICAgICAgfSk7CiAgICAgICAgcXVldWUucmVwbGFjZShvYmplY3QsIG5hbWUpOwogICAgICB9CiAgICB9CgogICAgcXVldWUuX2V4dGVuZGVkID0gewogICAgICBvYmplY3Q6IG9iamVjdCwKICAgICAgbWV0aG9kczogbWV0aG9kcwogICAgfTsKCiAgICByZXR1cm4gcXVldWU7CiAgfTsKCiAgLyoqCiAgICogRGVzdHJveSB0aGUgcXVldWUuIFRoZSBxdWV1ZSB3aWxsIGZpcnN0IGZsdXNoIGFsbCBxdWV1ZWQgYWN0aW9ucywgYW5kIGluCiAgICogY2FzZSBpdCBoYXMgZXh0ZW5kZWQgYW4gb2JqZWN0LCB3aWxsIHJlc3RvcmUgdGhlIG9yaWdpbmFsIG9iamVjdC4KICAgKi8KICBRdWV1ZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZmx1c2goKTsKCiAgICBpZiAodGhpcy5fZXh0ZW5kZWQpIHsKICAgICAgdmFyIG9iamVjdCA9IHRoaXMuX2V4dGVuZGVkLm9iamVjdDsKICAgICAgdmFyIG1ldGhvZHMgPSB0aGlzLl9leHRlbmRlZC5tZXRob2RzOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1ldGhvZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgbWV0aG9kID0gbWV0aG9kc1tpXTsKICAgICAgICBpZiAobWV0aG9kLm9yaWdpbmFsKSB7CiAgICAgICAgICBvYmplY3RbbWV0aG9kLm5hbWVdID0gbWV0aG9kLm9yaWdpbmFsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkZWxldGUgb2JqZWN0W21ldGhvZC5uYW1lXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5fZXh0ZW5kZWQgPSBudWxsOwogICAgfQogIH07CgogIC8qKgogICAqIFJlcGxhY2UgYSBtZXRob2Qgb24gYW4gb2JqZWN0IHdpdGggYSBxdWV1ZWQgdmVyc2lvbgogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgICBPYmplY3QgaGF2aW5nIHRoZSBtZXRob2QKICAgKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kICAgVGhlIG1ldGhvZCBuYW1lCiAgICovCiAgUXVldWUucHJvdG90eXBlLnJlcGxhY2UgPSBmdW5jdGlvbiAob2JqZWN0LCBtZXRob2QpIHsKICAgIHZhciBtZSA9IHRoaXM7CiAgICB2YXIgb3JpZ2luYWwgPSBvYmplY3RbbWV0aG9kXTsKICAgIGlmICghb3JpZ2luYWwpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2QgJyArIG1ldGhvZCArICcgdW5kZWZpbmVkJyk7CiAgICB9CgogICAgb2JqZWN0W21ldGhvZF0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIGNyZWF0ZSBhbiBBcnJheSB3aXRoIHRoZSBhcmd1bWVudHMKICAgICAgdmFyIGFyZ3MgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBhcmdzW2ldID0gYXJndW1lbnRzW2ldOwogICAgICB9CgogICAgICAvLyBhZGQgdGhpcyBjYWxsIHRvIHRoZSBxdWV1ZQogICAgICBtZS5xdWV1ZSh7CiAgICAgICAgYXJnczogYXJncywKICAgICAgICBmbjogb3JpZ2luYWwsCiAgICAgICAgY29udGV4dDogdGhpcwogICAgICB9KTsKICAgIH07CiAgfTsKCiAgLyoqCiAgICogUXVldWUgYSBjYWxsCiAgICogQHBhcmFtIHtmdW5jdGlvbiB8IHtmbjogZnVuY3Rpb24sIGFyZ3M6IEFycmF5fSB8IHtmbjogZnVuY3Rpb24sIGFyZ3M6IEFycmF5LCBjb250ZXh0OiBPYmplY3R9fSBlbnRyeQogICAqLwogIFF1ZXVlLnByb3RvdHlwZS5xdWV1ZSA9IGZ1bmN0aW9uIChlbnRyeSkgewogICAgaWYgKHR5cGVvZiBlbnRyeSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICB0aGlzLl9xdWV1ZS5wdXNoKHsgZm46IGVudHJ5IH0pOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fcXVldWUucHVzaChlbnRyeSk7CiAgICB9CgogICAgdGhpcy5fZmx1c2hJZk5lZWRlZCgpOwogIH07CgogIC8qKgogICAqIENoZWNrIHdoZXRoZXIgdGhlIHF1ZXVlIG5lZWRzIHRvIGJlIGZsdXNoZWQKICAgKiBAcHJpdmF0ZQogICAqLwogIFF1ZXVlLnByb3RvdHlwZS5fZmx1c2hJZk5lZWRlZCA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIGZsdXNoIHdoZW4gdGhlIG1heGltdW0gaXMgZXhjZWVkZWQuCiAgICBpZiAodGhpcy5fcXVldWUubGVuZ3RoID4gdGhpcy5tYXgpIHsKICAgICAgdGhpcy5mbHVzaCgpOwogICAgfQoKICAgIC8vIGZsdXNoIGFmdGVyIGEgcGVyaW9kIG9mIGluYWN0aXZpdHkgd2hlbiBhIGRlbGF5IGlzIGNvbmZpZ3VyZWQKICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0KTsKICAgIGlmICh0aGlzLnF1ZXVlLmxlbmd0aCA+IDAgJiYgdHlwZW9mIHRoaXMuZGVsYXkgPT09ICdudW1iZXInKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHRoaXMuX3RpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBtZS5mbHVzaCgpOwogICAgICB9LCB0aGlzLmRlbGF5KTsKICAgIH0KICB9OwoKICAvKioKICAgKiBGbHVzaCBhbGwgcXVldWVkIGNhbGxzCiAgICovCiAgUXVldWUucHJvdG90eXBlLmZsdXNoID0gZnVuY3Rpb24gKCkgewogICAgd2hpbGUgKHRoaXMuX3F1ZXVlLmxlbmd0aCA+IDApIHsKICAgICAgdmFyIGVudHJ5ID0gdGhpcy5fcXVldWUuc2hpZnQoKTsKICAgICAgZW50cnkuZm4uYXBwbHkoZW50cnkuY29udGV4dCB8fCBlbnRyeS5mbiwgZW50cnkuYXJncyB8fCBbXSk7CiAgICB9CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBRdWV1ZTsKCi8qKiovIH0sCi8qIDEwICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKICB2YXIgRGF0YVNldCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7CgogIC8qKgogICAqIERhdGFWaWV3CiAgICoKICAgKiBhIGRhdGF2aWV3IG9mZmVycyBhIGZpbHRlcmVkIHZpZXcgb24gYSBkYXRhc2V0IG9yIGFuIG90aGVyIGRhdGF2aWV3LgogICAqCiAgICogQHBhcmFtIHtEYXRhU2V0IHwgRGF0YVZpZXd9IGRhdGEKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICAgQXZhaWxhYmxlIG9wdGlvbnM6IHNlZSBtZXRob2QgZ2V0CiAgICoKICAgKiBAY29uc3RydWN0b3IgRGF0YVZpZXcKICAgKi8KICBmdW5jdGlvbiBEYXRhVmlldyhkYXRhLCBvcHRpb25zKSB7CiAgICB0aGlzLl9kYXRhID0gbnVsbDsKICAgIHRoaXMuX2lkcyA9IHt9OyAvLyBpZHMgb2YgdGhlIGl0ZW1zIGN1cnJlbnRseSBpbiBtZW1vcnkgKGp1c3QgY29udGFpbnMgYSBib29sZWFuIHRydWUpCiAgICB0aGlzLmxlbmd0aCA9IDA7IC8vIG51bWJlciBvZiBpdGVtcyBpbiB0aGUgRGF0YVZpZXcKICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgdGhpcy5fZmllbGRJZCA9ICdpZCc7IC8vIG5hbWUgb2YgdGhlIGZpZWxkIGNvbnRhaW5pbmcgaWQKICAgIHRoaXMuX3N1YnNjcmliZXJzID0ge307IC8vIGV2ZW50IHN1YnNjcmliZXJzCgogICAgdmFyIG1lID0gdGhpczsKICAgIHRoaXMubGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIG1lLl9vbkV2ZW50LmFwcGx5KG1lLCBhcmd1bWVudHMpOwogICAgfTsKCiAgICB0aGlzLnNldERhdGEoZGF0YSk7CiAgfQoKICAvLyBUT0RPOiBpbXBsZW1lbnQgYSBmdW5jdGlvbiAuY29uZmlnKCkgdG8gZHluYW1pY2FsbHkgdXBkYXRlIHRoaW5ncyBsaWtlIGNvbmZpZ3VyZWQgZmlsdGVyCiAgLy8gYW5kIHRyaWdnZXIgY2hhbmdlcyBhY2NvcmRpbmdseQoKICAvKioKICAgKiBTZXQgYSBkYXRhIHNvdXJjZSBmb3IgdGhlIHZpZXcKICAgKiBAcGFyYW0ge0RhdGFTZXQgfCBEYXRhVmlld30gZGF0YQogICAqLwogIERhdGFWaWV3LnByb3RvdHlwZS5zZXREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBpZHMsIGksIGxlbjsKCiAgICBpZiAodGhpcy5fZGF0YSkgewogICAgICAvLyB1bnN1YnNjcmliZSBmcm9tIGN1cnJlbnQgZGF0YXNldAogICAgICBpZiAodGhpcy5fZGF0YS5vZmYpIHsKICAgICAgICB0aGlzLl9kYXRhLm9mZignKicsIHRoaXMubGlzdGVuZXIpOwogICAgICB9CgogICAgICAvLyB0cmlnZ2VyIGEgcmVtb3ZlIG9mIGFsbCBpdGVtcyBpbiBtZW1vcnkKICAgICAgaWRzID0gW107CiAgICAgIGZvciAodmFyIGlkIGluIHRoaXMuX2lkcykgewogICAgICAgIGlmICh0aGlzLl9pZHMuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgICAgICBpZHMucHVzaChpZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuX2lkcyA9IHt9OwogICAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuX3RyaWdnZXIoJ3JlbW92ZScsIHsgaXRlbXM6IGlkcyB9KTsKICAgIH0KCiAgICB0aGlzLl9kYXRhID0gZGF0YTsKCiAgICBpZiAodGhpcy5fZGF0YSkgewogICAgICAvLyB1cGRhdGUgZmllbGRJZAogICAgICB0aGlzLl9maWVsZElkID0gdGhpcy5fb3B0aW9ucy5maWVsZElkIHx8IHRoaXMuX2RhdGEgJiYgdGhpcy5fZGF0YS5vcHRpb25zICYmIHRoaXMuX2RhdGEub3B0aW9ucy5maWVsZElkIHx8ICdpZCc7CgogICAgICAvLyB0cmlnZ2VyIGFuIGFkZCBvZiBhbGwgYWRkZWQgaXRlbXMKICAgICAgaWRzID0gdGhpcy5fZGF0YS5nZXRJZHMoeyBmaWx0ZXI6IHRoaXMuX29wdGlvbnMgJiYgdGhpcy5fb3B0aW9ucy5maWx0ZXIgfSk7CiAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGlkcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgIGlkID0gaWRzW2ldOwogICAgICAgIHRoaXMuX2lkc1tpZF0gPSB0cnVlOwogICAgICB9CiAgICAgIHRoaXMubGVuZ3RoID0gaWRzLmxlbmd0aDsKICAgICAgdGhpcy5fdHJpZ2dlcignYWRkJywgeyBpdGVtczogaWRzIH0pOwoKICAgICAgLy8gc3Vic2NyaWJlIHRvIG5ldyBkYXRhc2V0CiAgICAgIGlmICh0aGlzLl9kYXRhLm9uKSB7CiAgICAgICAgdGhpcy5fZGF0YS5vbignKicsIHRoaXMubGlzdGVuZXIpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmVmcmVzaCB0aGUgRGF0YVZpZXcuIFVzZWZ1bCB3aGVuIHRoZSBEYXRhVmlldyBoYXMgYSBmaWx0ZXIgZnVuY3Rpb24KICAgKiBjb250YWluaW5nIGEgdmFyaWFibGUgcGFyYW1ldGVyLgogICAqLwogIERhdGFWaWV3LnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGlkOwogICAgdmFyIGlkcyA9IHRoaXMuX2RhdGEuZ2V0SWRzKHsgZmlsdGVyOiB0aGlzLl9vcHRpb25zICYmIHRoaXMuX29wdGlvbnMuZmlsdGVyIH0pOwogICAgdmFyIG5ld0lkcyA9IHt9OwogICAgdmFyIGFkZGVkID0gW107CiAgICB2YXIgcmVtb3ZlZCA9IFtdOwoKICAgIC8vIGNoZWNrIGZvciBhZGRpdGlvbnMKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlkID0gaWRzW2ldOwogICAgICBuZXdJZHNbaWRdID0gdHJ1ZTsKICAgICAgaWYgKCF0aGlzLl9pZHNbaWRdKSB7CiAgICAgICAgYWRkZWQucHVzaChpZCk7CiAgICAgICAgdGhpcy5faWRzW2lkXSA9IHRydWU7CiAgICAgICAgdGhpcy5sZW5ndGgrKzsKICAgICAgfQogICAgfQoKICAgIC8vIGNoZWNrIGZvciByZW1vdmFscwogICAgZm9yIChpZCBpbiB0aGlzLl9pZHMpIHsKICAgICAgaWYgKHRoaXMuX2lkcy5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICBpZiAoIW5ld0lkc1tpZF0pIHsKICAgICAgICAgIHJlbW92ZWQucHVzaChpZCk7CiAgICAgICAgICBkZWxldGUgdGhpcy5faWRzW2lkXTsKICAgICAgICAgIHRoaXMubGVuZ3RoLS07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gdHJpZ2dlciBldmVudHMKICAgIGlmIChhZGRlZC5sZW5ndGgpIHsKICAgICAgdGhpcy5fdHJpZ2dlcignYWRkJywgeyBpdGVtczogYWRkZWQgfSk7CiAgICB9CiAgICBpZiAocmVtb3ZlZC5sZW5ndGgpIHsKICAgICAgdGhpcy5fdHJpZ2dlcigncmVtb3ZlJywgeyBpdGVtczogcmVtb3ZlZCB9KTsKICAgIH0KICB9OwoKICAvKioKICAgKiBHZXQgZGF0YSBmcm9tIHRoZSBkYXRhIHZpZXcKICAgKgogICAqIFVzYWdlOgogICAqCiAgICogICAgIGdldCgpCiAgICogICAgIGdldChvcHRpb25zOiBPYmplY3QpCiAgICogICAgIGdldChvcHRpb25zOiBPYmplY3QsIGRhdGE6IEFycmF5IHwgRGF0YVRhYmxlKQogICAqCiAgICogICAgIGdldChpZDogTnVtYmVyKQogICAqICAgICBnZXQoaWQ6IE51bWJlciwgb3B0aW9uczogT2JqZWN0KQogICAqICAgICBnZXQoaWQ6IE51bWJlciwgb3B0aW9uczogT2JqZWN0LCBkYXRhOiBBcnJheSB8IERhdGFUYWJsZSkKICAgKgogICAqICAgICBnZXQoaWRzOiBOdW1iZXJbXSkKICAgKiAgICAgZ2V0KGlkczogTnVtYmVyW10sIG9wdGlvbnM6IE9iamVjdCkKICAgKiAgICAgZ2V0KGlkczogTnVtYmVyW10sIG9wdGlvbnM6IE9iamVjdCwgZGF0YTogQXJyYXkgfCBEYXRhVGFibGUpCiAgICoKICAgKiBXaGVyZToKICAgKgogICAqIHtOdW1iZXIgfCBTdHJpbmd9IGlkICAgICAgICAgVGhlIGlkIG9mIGFuIGl0ZW0KICAgKiB7TnVtYmVyW10gfCBTdHJpbmd7fX0gaWRzICAgIEFuIGFycmF5IHdpdGggaWRzIG9mIGl0ZW1zCiAgICoge09iamVjdH0gb3B0aW9ucyAgICAgICAgICAgICBBbiBPYmplY3Qgd2l0aCBvcHRpb25zLiBBdmFpbGFibGUgb3B0aW9uczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmd9IFt0eXBlXSBUeXBlIG9mIGRhdGEgdG8gYmUgcmV0dXJuZWQuIENhbgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlICdEYXRhVGFibGUnIG9yICdBcnJheScgKGRlZmF1bHQpCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7T2JqZWN0LjxTdHJpbmcsIFN0cmluZz59IFtjb252ZXJ0XQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1N0cmluZ1tdfSBbZmllbGRzXSBmaWVsZCBuYW1lcyB0byBiZSByZXR1cm5lZAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2Z1bmN0aW9ufSBbZmlsdGVyXSBmaWx0ZXIgaXRlbXMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmcgfCBmdW5jdGlvbn0gW29yZGVyXSBPcmRlciB0aGUgaXRlbXMgYnkKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIGZpZWxkIG5hbWUgb3IgY3VzdG9tIHNvcnQgZnVuY3Rpb24uCiAgICoge0FycmF5IHwgRGF0YVRhYmxlfSBbZGF0YV0gICBJZiBwcm92aWRlZCwgaXRlbXMgd2lsbCBiZSBhcHBlbmRlZCB0byB0aGlzCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnJheSBvciB0YWJsZS4gUmVxdWlyZWQgaW4gY2FzZSBvZiBHb29nbGUKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGFUYWJsZS4KICAgKiBAcGFyYW0gYXJncwogICAqLwogIERhdGFWaWV3LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoYXJncykgewogICAgdmFyIG1lID0gdGhpczsKCiAgICAvLyBwYXJzZSB0aGUgYXJndW1lbnRzCiAgICB2YXIgaWRzLCBvcHRpb25zLCBkYXRhOwogICAgdmFyIGZpcnN0VHlwZSA9IHV0aWwuZ2V0VHlwZShhcmd1bWVudHNbMF0pOwogICAgaWYgKGZpcnN0VHlwZSA9PSAnU3RyaW5nJyB8fCBmaXJzdFR5cGUgPT0gJ051bWJlcicgfHwgZmlyc3RUeXBlID09ICdBcnJheScpIHsKICAgICAgLy8gZ2V0KGlkKHMpIFssIG9wdGlvbnNdIFssIGRhdGFdKQogICAgICBpZHMgPSBhcmd1bWVudHNbMF07IC8vIGNhbiBiZSBhIHNpbmdsZSBpZCBvciBhbiBhcnJheSB3aXRoIGlkcwogICAgICBvcHRpb25zID0gYXJndW1lbnRzWzFdOwogICAgICBkYXRhID0gYXJndW1lbnRzWzJdOwogICAgfSBlbHNlIHsKICAgICAgLy8gZ2V0KFssIG9wdGlvbnNdIFssIGRhdGFdKQogICAgICBvcHRpb25zID0gYXJndW1lbnRzWzBdOwogICAgICBkYXRhID0gYXJndW1lbnRzWzFdOwogICAgfQoKICAgIC8vIGV4dGVuZCB0aGUgb3B0aW9ucyB3aXRoIHRoZSBkZWZhdWx0IG9wdGlvbnMgYW5kIHByb3ZpZGVkIG9wdGlvbnMKICAgIHZhciB2aWV3T3B0aW9ucyA9IHV0aWwuZXh0ZW5kKHt9LCB0aGlzLl9vcHRpb25zLCBvcHRpb25zKTsKCiAgICAvLyBjcmVhdGUgYSBjb21iaW5lZCBmaWx0ZXIgbWV0aG9kIHdoZW4gbmVlZGVkCiAgICBpZiAodGhpcy5fb3B0aW9ucy5maWx0ZXIgJiYgb3B0aW9ucyAmJiBvcHRpb25zLmZpbHRlcikgewogICAgICB2aWV3T3B0aW9ucy5maWx0ZXIgPSBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBtZS5fb3B0aW9ucy5maWx0ZXIoaXRlbSkgJiYgb3B0aW9ucy5maWx0ZXIoaXRlbSk7CiAgICAgIH07CiAgICB9CgogICAgLy8gYnVpbGQgdXAgdGhlIGNhbGwgdG8gdGhlIGxpbmtlZCBkYXRhIHNldAogICAgdmFyIGdldEFyZ3VtZW50cyA9IFtdOwogICAgaWYgKGlkcyAhPSB1bmRlZmluZWQpIHsKICAgICAgZ2V0QXJndW1lbnRzLnB1c2goaWRzKTsKICAgIH0KICAgIGdldEFyZ3VtZW50cy5wdXNoKHZpZXdPcHRpb25zKTsKICAgIGdldEFyZ3VtZW50cy5wdXNoKGRhdGEpOwoKICAgIHJldHVybiB0aGlzLl9kYXRhICYmIHRoaXMuX2RhdGEuZ2V0LmFwcGx5KHRoaXMuX2RhdGEsIGdldEFyZ3VtZW50cyk7CiAgfTsKCiAgLyoqCiAgICogR2V0IGlkcyBvZiBhbGwgaXRlbXMgb3IgZnJvbSBhIGZpbHRlcmVkIHNldCBvZiBpdGVtcy4KICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICAgIEFuIE9iamVjdCB3aXRoIG9wdGlvbnMuIEF2YWlsYWJsZSBvcHRpb25zOgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2Z1bmN0aW9ufSBbZmlsdGVyXSBmaWx0ZXIgaXRlbXMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmcgfCBmdW5jdGlvbn0gW29yZGVyXSBPcmRlciB0aGUgaXRlbXMgYnkKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIGZpZWxkIG5hbWUgb3IgY3VzdG9tIHNvcnQgZnVuY3Rpb24uCiAgICogQHJldHVybiB7QXJyYXl9IGlkcwogICAqLwogIERhdGFWaWV3LnByb3RvdHlwZS5nZXRJZHMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgdmFyIGlkczsKCiAgICBpZiAodGhpcy5fZGF0YSkgewogICAgICB2YXIgZGVmYXVsdEZpbHRlciA9IHRoaXMuX29wdGlvbnMuZmlsdGVyOwogICAgICB2YXIgZmlsdGVyOwoKICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5maWx0ZXIpIHsKICAgICAgICBpZiAoZGVmYXVsdEZpbHRlcikgewogICAgICAgICAgZmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRGaWx0ZXIoaXRlbSkgJiYgb3B0aW9ucy5maWx0ZXIoaXRlbSk7CiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmaWx0ZXIgPSBvcHRpb25zLmZpbHRlcjsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZmlsdGVyID0gZGVmYXVsdEZpbHRlcjsKICAgICAgfQoKICAgICAgaWRzID0gdGhpcy5fZGF0YS5nZXRJZHMoewogICAgICAgIGZpbHRlcjogZmlsdGVyLAogICAgICAgIG9yZGVyOiBvcHRpb25zICYmIG9wdGlvbnMub3JkZXIKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBpZHMgPSBbXTsKICAgIH0KCiAgICByZXR1cm4gaWRzOwogIH07CgogIC8qKgogICAqIEdldCB0aGUgRGF0YVNldCB0byB3aGljaCB0aGlzIERhdGFWaWV3IGlzIGNvbm5lY3RlZC4gSW4gY2FzZSB0aGVyZSBpcyBhIGNoYWluCiAgICogb2YgbXVsdGlwbGUgRGF0YVZpZXdzLCB0aGUgcm9vdCBEYXRhU2V0IG9mIHRoaXMgY2hhaW4gaXMgcmV0dXJuZWQuCiAgICogQHJldHVybiB7RGF0YVNldH0gZGF0YVNldAogICAqLwogIERhdGFWaWV3LnByb3RvdHlwZS5nZXREYXRhU2V0ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGRhdGFTZXQgPSB0aGlzOwogICAgd2hpbGUgKGRhdGFTZXQgaW5zdGFuY2VvZiBEYXRhVmlldykgewogICAgICBkYXRhU2V0ID0gZGF0YVNldC5fZGF0YTsKICAgIH0KICAgIHJldHVybiBkYXRhU2V0IHx8IG51bGw7CiAgfTsKCiAgLyoqCiAgICogRXZlbnQgbGlzdGVuZXIuIFdpbGwgcHJvcGFnYXRlIGFsbCBldmVudHMgZnJvbSB0aGUgY29ubmVjdGVkIGRhdGEgc2V0IHRvCiAgICogdGhlIHN1YnNjcmliZXJzIG9mIHRoZSBEYXRhVmlldywgYnV0IHdpbGwgZmlsdGVyIHRoZSBpdGVtcyBhbmQgb25seSB0cmlnZ2VyCiAgICogd2hlbiB0aGVyZSBhcmUgY2hhbmdlcyBpbiB0aGUgZmlsdGVyZWQgZGF0YSBzZXQuCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICogQHBhcmFtIHtPYmplY3QgfCBudWxsfSBwYXJhbXMKICAgKiBAcGFyYW0ge1N0cmluZ30gc2VuZGVySWQKICAgKiBAcHJpdmF0ZQogICAqLwogIERhdGFWaWV3LnByb3RvdHlwZS5fb25FdmVudCA9IGZ1bmN0aW9uIChldmVudCwgcGFyYW1zLCBzZW5kZXJJZCkgewogICAgdmFyIGksIGxlbiwgaWQsIGl0ZW07CiAgICB2YXIgaWRzID0gcGFyYW1zICYmIHBhcmFtcy5pdGVtczsKICAgIHZhciBkYXRhID0gdGhpcy5fZGF0YTsKICAgIHZhciB1cGRhdGVkRGF0YSA9IFtdOwogICAgdmFyIGFkZGVkID0gW107CiAgICB2YXIgdXBkYXRlZCA9IFtdOwogICAgdmFyIHJlbW92ZWQgPSBbXTsKCiAgICBpZiAoaWRzICYmIGRhdGEpIHsKICAgICAgc3dpdGNoIChldmVudCkgewogICAgICAgIGNhc2UgJ2FkZCc6CiAgICAgICAgICAvLyBmaWx0ZXIgdGhlIGlkcyBvZiB0aGUgYWRkZWQgaXRlbXMKICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGlkcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBpZCA9IGlkc1tpXTsKICAgICAgICAgICAgaXRlbSA9IHRoaXMuZ2V0KGlkKTsKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICB0aGlzLl9pZHNbaWRdID0gdHJ1ZTsKICAgICAgICAgICAgICBhZGRlZC5wdXNoKGlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICd1cGRhdGUnOgogICAgICAgICAgLy8gZGV0ZXJtaW5lIHRoZSBldmVudCBmcm9tIHRoZSB2aWV3cyB2aWV3cG9pbnQ6IGFuIHVwZGF0ZWQKICAgICAgICAgIC8vIGl0ZW0gY2FuIGJlIGFkZGVkLCB1cGRhdGVkLCBvciByZW1vdmVkIGZyb20gdGhpcyB2aWV3LgogICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gaWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGlkID0gaWRzW2ldOwogICAgICAgICAgICBpdGVtID0gdGhpcy5nZXQoaWQpOwoKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICBpZiAodGhpcy5faWRzW2lkXSkgewogICAgICAgICAgICAgICAgdXBkYXRlZC5wdXNoKGlkKTsKICAgICAgICAgICAgICAgIHVwZGF0ZWREYXRhLnB1c2gocGFyYW1zLmRhdGFbaV0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9pZHNbaWRdID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGFkZGVkLnB1c2goaWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAodGhpcy5faWRzW2lkXSkgewogICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2lkc1tpZF07CiAgICAgICAgICAgICAgICByZW1vdmVkLnB1c2goaWQpOwogICAgICAgICAgICAgIH0gZWxzZSB7fQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ3JlbW92ZSc6CiAgICAgICAgICAvLyBmaWx0ZXIgdGhlIGlkcyBvZiB0aGUgcmVtb3ZlZCBpdGVtcwogICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gaWRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGlkID0gaWRzW2ldOwogICAgICAgICAgICBpZiAodGhpcy5faWRzW2lkXSkgewogICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9pZHNbaWRdOwogICAgICAgICAgICAgIHJlbW92ZWQucHVzaChpZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgdGhpcy5sZW5ndGggKz0gYWRkZWQubGVuZ3RoIC0gcmVtb3ZlZC5sZW5ndGg7CgogICAgICBpZiAoYWRkZWQubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5fdHJpZ2dlcignYWRkJywgeyBpdGVtczogYWRkZWQgfSwgc2VuZGVySWQpOwogICAgICB9CiAgICAgIGlmICh1cGRhdGVkLmxlbmd0aCkgewogICAgICAgIHRoaXMuX3RyaWdnZXIoJ3VwZGF0ZScsIHsgaXRlbXM6IHVwZGF0ZWQsIGRhdGE6IHVwZGF0ZWREYXRhIH0sIHNlbmRlcklkKTsKICAgICAgfQogICAgICBpZiAocmVtb3ZlZC5sZW5ndGgpIHsKICAgICAgICB0aGlzLl90cmlnZ2VyKCdyZW1vdmUnLCB7IGl0ZW1zOiByZW1vdmVkIH0sIHNlbmRlcklkKTsKICAgICAgfQogICAgfQogIH07CgogIC8vIGNvcHkgc3Vic2NyaXB0aW9uIGZ1bmN0aW9uYWxpdHkgZnJvbSBEYXRhU2V0CiAgRGF0YVZpZXcucHJvdG90eXBlLm9uID0gRGF0YVNldC5wcm90b3R5cGUub247CiAgRGF0YVZpZXcucHJvdG90eXBlLm9mZiA9IERhdGFTZXQucHJvdG90eXBlLm9mZjsKICBEYXRhVmlldy5wcm90b3R5cGUuX3RyaWdnZXIgPSBEYXRhU2V0LnByb3RvdHlwZS5fdHJpZ2dlcjsKCiAgLy8gVE9ETzogbWFrZSB0aGVzZSBmdW5jdGlvbnMgZGVwcmVjYXRlZCAocmVwbGFjZWQgd2l0aCBgb25gIGFuZCBgb2ZmYCBzaW5jZSB2ZXJzaW9uIDAuNSkKICBEYXRhVmlldy5wcm90b3R5cGUuc3Vic2NyaWJlID0gRGF0YVZpZXcucHJvdG90eXBlLm9uOwogIERhdGFWaWV3LnByb3RvdHlwZS51bnN1YnNjcmliZSA9IERhdGFWaWV3LnByb3RvdHlwZS5vZmY7CgogIG1vZHVsZS5leHBvcnRzID0gRGF0YVZpZXc7CgogIC8vIG5vdGhpbmcgaW50ZXJlc3RpbmcgZm9yIG1lIDotKAoKLyoqKi8gfSwKLyogMTEgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIEVtaXR0ZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKTsKICB2YXIgRGF0YVNldCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7CiAgdmFyIERhdGFWaWV3ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7CiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwogIHZhciBQb2ludDNkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNCk7CiAgdmFyIFBvaW50MmQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyKTsKICB2YXIgQ2FtZXJhID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7CiAgdmFyIEZpbHRlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTYpOwogIHZhciBTbGlkZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE3KTsKICB2YXIgU3RlcE51bWJlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTgpOwoKICAvKioKICAgKiBAY29uc3RydWN0b3IgR3JhcGgzZAogICAqIEdyYXBoM2QgZGlzcGxheXMgZGF0YSBpbiAzZC4KICAgKgogICAqIEdyYXBoM2QgaXMgZGV2ZWxvcGVkIGluIGphdmFzY3JpcHQgYXMgYSBHb29nbGUgVmlzdWFsaXphdGlvbiBDaGFydC4KICAgKgogICAqIEBwYXJhbSB7RWxlbWVudH0gY29udGFpbmVyICAgVGhlIERPTSBlbGVtZW50IGluIHdoaWNoIHRoZSBHcmFwaDNkIHdpbGwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlIGNyZWF0ZWQuIE5vcm1hbGx5IGEgZGl2IGVsZW1lbnQuCiAgICogQHBhcmFtIHtEYXRhU2V0IHwgRGF0YVZpZXcgfCBBcnJheX0gW2RhdGFdCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXQogICAqLwogIGZ1bmN0aW9uIEdyYXBoM2QoY29udGFpbmVyLCBkYXRhLCBvcHRpb25zKSB7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgR3JhcGgzZCkpIHsKICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCdDb25zdHJ1Y3RvciBtdXN0IGJlIGNhbGxlZCB3aXRoIHRoZSBuZXcgb3BlcmF0b3InKTsKICAgIH0KCiAgICAvLyBjcmVhdGUgdmFyaWFibGVzIGFuZCBzZXQgZGVmYXVsdCB2YWx1ZXMKICAgIHRoaXMuY29udGFpbmVyRWxlbWVudCA9IGNvbnRhaW5lcjsKICAgIHRoaXMud2lkdGggPSAnNDAwcHgnOwogICAgdGhpcy5oZWlnaHQgPSAnNDAwcHgnOwogICAgdGhpcy5tYXJnaW4gPSAxMDsgLy8gcHgKICAgIHRoaXMuZGVmYXVsdFhDZW50ZXIgPSAnNTUlJzsKICAgIHRoaXMuZGVmYXVsdFlDZW50ZXIgPSAnNTAlJzsKCiAgICB0aGlzLnhMYWJlbCA9ICd4JzsKICAgIHRoaXMueUxhYmVsID0gJ3knOwogICAgdGhpcy56TGFiZWwgPSAneic7CgogICAgdmFyIHBhc3NWYWx1ZUZuID0gZnVuY3Rpb24gcGFzc1ZhbHVlRm4odikgewogICAgICByZXR1cm4gdjsKICAgIH07CiAgICB0aGlzLnhWYWx1ZUxhYmVsID0gcGFzc1ZhbHVlRm47CiAgICB0aGlzLnlWYWx1ZUxhYmVsID0gcGFzc1ZhbHVlRm47CiAgICB0aGlzLnpWYWx1ZUxhYmVsID0gcGFzc1ZhbHVlRm47CgogICAgdGhpcy5maWx0ZXJMYWJlbCA9ICd0aW1lJzsKICAgIHRoaXMubGVnZW5kTGFiZWwgPSAndmFsdWUnOwoKICAgIHRoaXMuc3R5bGUgPSBHcmFwaDNkLlNUWUxFLkRPVDsKICAgIHRoaXMuc2hvd1BlcnNwZWN0aXZlID0gdHJ1ZTsKICAgIHRoaXMuc2hvd0dyaWQgPSB0cnVlOwogICAgdGhpcy5rZWVwQXNwZWN0UmF0aW8gPSB0cnVlOwogICAgdGhpcy5zaG93U2hhZG93ID0gZmFsc2U7CiAgICB0aGlzLnNob3dHcmF5Qm90dG9tID0gZmFsc2U7IC8vIFRPRE86IHRoaXMgZG9lcyBub3Qgd29yayBjb3JyZWN0bHkKICAgIHRoaXMuc2hvd1Rvb2x0aXAgPSBmYWxzZTsKICAgIHRoaXMudmVydGljYWxSYXRpbyA9IDAuNTsgLy8gMC4xIHRvIDEuMCwgd2hlcmUgMS4wIHJlc3VsdHMgaW4gYSAnY3ViZScKCiAgICB0aGlzLmFuaW1hdGlvbkludGVydmFsID0gMTAwMDsgLy8gbWlsbGlzZWNvbmRzCiAgICB0aGlzLmFuaW1hdGlvblByZWxvYWQgPSBmYWxzZTsKCiAgICB0aGlzLmNhbWVyYSA9IG5ldyBDYW1lcmEoKTsKICAgIHRoaXMuZXllID0gbmV3IFBvaW50M2QoMCwgMCwgLTEpOyAvLyBUT0RPOiBzZXQgZXllLnogYWJvdXQgMy80IG9mIHRoZSB3aWR0aCBvZiB0aGUgd2luZG93PwoKICAgIHRoaXMuZGF0YVRhYmxlID0gbnVsbDsgLy8gVGhlIG9yaWdpbmFsIGRhdGEgdGFibGUKICAgIHRoaXMuZGF0YVBvaW50cyA9IG51bGw7IC8vIFRoZSB0YWJsZSB3aXRoIHBvaW50IG9iamVjdHMKCiAgICAvLyB0aGUgY29sdW1uIGluZGV4ZXMKICAgIHRoaXMuY29sWCA9IHVuZGVmaW5lZDsKICAgIHRoaXMuY29sWSA9IHVuZGVmaW5lZDsKICAgIHRoaXMuY29sWiA9IHVuZGVmaW5lZDsKICAgIHRoaXMuY29sVmFsdWUgPSB1bmRlZmluZWQ7CiAgICB0aGlzLmNvbEZpbHRlciA9IHVuZGVmaW5lZDsKCiAgICB0aGlzLnhNaW4gPSAwOwogICAgdGhpcy54U3RlcCA9IHVuZGVmaW5lZDsgLy8gYXV0byBieSBkZWZhdWx0CiAgICB0aGlzLnhNYXggPSAxOwogICAgdGhpcy55TWluID0gMDsKICAgIHRoaXMueVN0ZXAgPSB1bmRlZmluZWQ7IC8vIGF1dG8gYnkgZGVmYXVsdAogICAgdGhpcy55TWF4ID0gMTsKICAgIHRoaXMuek1pbiA9IDA7CiAgICB0aGlzLnpTdGVwID0gdW5kZWZpbmVkOyAvLyBhdXRvIGJ5IGRlZmF1bHQKICAgIHRoaXMuek1heCA9IDE7CiAgICB0aGlzLnZhbHVlTWluID0gMDsKICAgIHRoaXMudmFsdWVNYXggPSAxOwogICAgdGhpcy54QmFyV2lkdGggPSAxOwogICAgdGhpcy55QmFyV2lkdGggPSAxOwogICAgLy8gVE9ETzogY3VzdG9taXplIGF4aXMgcmFuZ2UKCiAgICAvLyBjb25zdGFudHMKICAgIHRoaXMuY29sb3JBeGlzID0gJyM0RDRENEQnOwogICAgdGhpcy5jb2xvckdyaWQgPSAnI0QzRDNEMyc7CiAgICB0aGlzLmNvbG9yRG90ID0gJyM3REMxRkYnOwogICAgdGhpcy5jb2xvckRvdEJvcmRlciA9ICcjMzI2N0QyJzsKCiAgICAvLyBjcmVhdGUgYSBmcmFtZSBhbmQgY2FudmFzCiAgICB0aGlzLmNyZWF0ZSgpOwoKICAgIC8vIGFwcGx5IG9wdGlvbnMgKGFsc28gd2hlbiB1bmRlZmluZWQpCiAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CgogICAgLy8gYXBwbHkgZGF0YQogICAgaWYgKGRhdGEpIHsKICAgICAgdGhpcy5zZXREYXRhKGRhdGEpOwogICAgfQogIH0KCiAgLy8gRXh0ZW5kIEdyYXBoM2Qgd2l0aCBhbiBFbWl0dGVyIG1peGluCiAgRW1pdHRlcihHcmFwaDNkLnByb3RvdHlwZSk7CgogIC8qKgogICAqIENhbGN1bGF0ZSB0aGUgc2NhbGluZyB2YWx1ZXMsIGRlcGVuZGVudCBvbiB0aGUgcmFuZ2UgaW4geCwgeSwgYW5kIHogZGlyZWN0aW9uCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX3NldFNjYWxlID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5zY2FsZSA9IG5ldyBQb2ludDNkKDEgLyAodGhpcy54TWF4IC0gdGhpcy54TWluKSwgMSAvICh0aGlzLnlNYXggLSB0aGlzLnlNaW4pLCAxIC8gKHRoaXMuek1heCAtIHRoaXMuek1pbikpOwoKICAgIC8vIGtlZXAgYXNwZWN0IHJhdGlvbiBiZXR3ZWVuIHggYW5kIHkgc2NhbGUgaWYgZGVzaXJlZAogICAgaWYgKHRoaXMua2VlcEFzcGVjdFJhdGlvKSB7CiAgICAgIGlmICh0aGlzLnNjYWxlLnggPCB0aGlzLnNjYWxlLnkpIHsKICAgICAgICAvL25vaW5zcGVjdGlvbiBKU1N1c3BpY2lvdXNOYW1lQ29tYmluYXRpb24KICAgICAgICB0aGlzLnNjYWxlLnkgPSB0aGlzLnNjYWxlLng7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy9ub2luc3BlY3Rpb24gSlNTdXNwaWNpb3VzTmFtZUNvbWJpbmF0aW9uCiAgICAgICAgdGhpcy5zY2FsZS54ID0gdGhpcy5zY2FsZS55OwogICAgICB9CiAgICB9CgogICAgLy8gc2NhbGUgdGhlIHZlcnRpY2FsIGF4aXMKICAgIHRoaXMuc2NhbGUueiAqPSB0aGlzLnZlcnRpY2FsUmF0aW87CiAgICAvLyBUT0RPOiBjYW4gdGhpcyBiZSBhdXRvbWF0ZWQ/IHZlcnRpY2FsUmF0aW8/CgogICAgLy8gZGV0ZXJtaW5lIHNjYWxlIGZvciAob3B0aW9uYWwpIHZhbHVlCiAgICB0aGlzLnNjYWxlLnZhbHVlID0gMSAvICh0aGlzLnZhbHVlTWF4IC0gdGhpcy52YWx1ZU1pbik7CgogICAgLy8gcG9zaXRpb24gdGhlIGNhbWVyYSBhcm0KICAgIHZhciB4Q2VudGVyID0gKHRoaXMueE1heCArIHRoaXMueE1pbikgLyAyICogdGhpcy5zY2FsZS54OwogICAgdmFyIHlDZW50ZXIgPSAodGhpcy55TWF4ICsgdGhpcy55TWluKSAvIDIgKiB0aGlzLnNjYWxlLnk7CiAgICB2YXIgekNlbnRlciA9ICh0aGlzLnpNYXggKyB0aGlzLnpNaW4pIC8gMiAqIHRoaXMuc2NhbGUuejsKICAgIHRoaXMuY2FtZXJhLnNldEFybUxvY2F0aW9uKHhDZW50ZXIsIHlDZW50ZXIsIHpDZW50ZXIpOwogIH07CgogIC8qKgogICAqIENvbnZlcnQgYSAzRCBsb2NhdGlvbiB0byBhIDJEIGxvY2F0aW9uIG9uIHNjcmVlbgogICAqIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvM0RfcHJvamVjdGlvbgogICAqIEBwYXJhbSB7UG9pbnQzZH0gcG9pbnQzZCAgIEEgM0QgcG9pbnQgd2l0aCBwYXJhbWV0ZXJzIHgsIHksIHoKICAgKiBAcmV0dXJuIHtQb2ludDJkfSBwb2ludDJkICBBIDJEIHBvaW50IHdpdGggcGFyYW1ldGVycyB4LCB5CiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX2NvbnZlcnQzRHRvMkQgPSBmdW5jdGlvbiAocG9pbnQzZCkgewogICAgdmFyIHRyYW5zbGF0aW9uID0gdGhpcy5fY29udmVydFBvaW50VG9UcmFuc2xhdGlvbihwb2ludDNkKTsKICAgIHJldHVybiB0aGlzLl9jb252ZXJ0VHJhbnNsYXRpb25Ub1NjcmVlbih0cmFuc2xhdGlvbik7CiAgfTsKCiAgLyoqCiAgICogQ29udmVydCBhIDNEIGxvY2F0aW9uIGl0cyB0cmFuc2xhdGlvbiBzZWVuIGZyb20gdGhlIGNhbWVyYQogICAqIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvM0RfcHJvamVjdGlvbgogICAqIEBwYXJhbSB7UG9pbnQzZH0gcG9pbnQzZCAgICBBIDNEIHBvaW50IHdpdGggcGFyYW1ldGVycyB4LCB5LCB6CiAgICogQHJldHVybiB7UG9pbnQzZH0gdHJhbnNsYXRpb24gQSAzRCBwb2ludCB3aXRoIHBhcmFtZXRlcnMgeCwgeSwgeiBUaGlzIGlzCiAgICogICAgICAgICAgICAgICAgICAgdGhlIHRyYW5zbGF0aW9uIG9mIHRoZSBwb2ludCwgc2VlbiBmcm9tIHRoZQogICAqICAgICAgICAgICAgICAgICAgIGNhbWVyYQogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9jb252ZXJ0UG9pbnRUb1RyYW5zbGF0aW9uID0gZnVuY3Rpb24gKHBvaW50M2QpIHsKICAgIHZhciBheCA9IHBvaW50M2QueCAqIHRoaXMuc2NhbGUueCwKICAgICAgICBheSA9IHBvaW50M2QueSAqIHRoaXMuc2NhbGUueSwKICAgICAgICBheiA9IHBvaW50M2QueiAqIHRoaXMuc2NhbGUueiwKICAgICAgICBjeCA9IHRoaXMuY2FtZXJhLmdldENhbWVyYUxvY2F0aW9uKCkueCwKICAgICAgICBjeSA9IHRoaXMuY2FtZXJhLmdldENhbWVyYUxvY2F0aW9uKCkueSwKICAgICAgICBjeiA9IHRoaXMuY2FtZXJhLmdldENhbWVyYUxvY2F0aW9uKCkueiwKCiAgICAvLyBjYWxjdWxhdGUgYW5nbGVzCiAgICBzaW5UeCA9IE1hdGguc2luKHRoaXMuY2FtZXJhLmdldENhbWVyYVJvdGF0aW9uKCkueCksCiAgICAgICAgY29zVHggPSBNYXRoLmNvcyh0aGlzLmNhbWVyYS5nZXRDYW1lcmFSb3RhdGlvbigpLngpLAogICAgICAgIHNpblR5ID0gTWF0aC5zaW4odGhpcy5jYW1lcmEuZ2V0Q2FtZXJhUm90YXRpb24oKS55KSwKICAgICAgICBjb3NUeSA9IE1hdGguY29zKHRoaXMuY2FtZXJhLmdldENhbWVyYVJvdGF0aW9uKCkueSksCiAgICAgICAgc2luVHogPSBNYXRoLnNpbih0aGlzLmNhbWVyYS5nZXRDYW1lcmFSb3RhdGlvbigpLnopLAogICAgICAgIGNvc1R6ID0gTWF0aC5jb3ModGhpcy5jYW1lcmEuZ2V0Q2FtZXJhUm90YXRpb24oKS56KSwKCiAgICAvLyBjYWxjdWxhdGUgdHJhbnNsYXRpb24KICAgIGR4ID0gY29zVHkgKiAoc2luVHogKiAoYXkgLSBjeSkgKyBjb3NUeiAqIChheCAtIGN4KSkgLSBzaW5UeSAqIChheiAtIGN6KSwKICAgICAgICBkeSA9IHNpblR4ICogKGNvc1R5ICogKGF6IC0gY3opICsgc2luVHkgKiAoc2luVHogKiAoYXkgLSBjeSkgKyBjb3NUeiAqIChheCAtIGN4KSkpICsgY29zVHggKiAoY29zVHogKiAoYXkgLSBjeSkgLSBzaW5UeiAqIChheCAtIGN4KSksCiAgICAgICAgZHogPSBjb3NUeCAqIChjb3NUeSAqIChheiAtIGN6KSArIHNpblR5ICogKHNpblR6ICogKGF5IC0gY3kpICsgY29zVHogKiAoYXggLSBjeCkpKSAtIHNpblR4ICogKGNvc1R6ICogKGF5IC0gY3kpIC0gc2luVHogKiAoYXggLSBjeCkpOwoKICAgIHJldHVybiBuZXcgUG9pbnQzZChkeCwgZHksIGR6KTsKICB9OwoKICAvKioKICAgKiBDb252ZXJ0IGEgdHJhbnNsYXRpb24gcG9pbnQgdG8gYSBwb2ludCBvbiB0aGUgc2NyZWVuCiAgICogQHBhcmFtIHtQb2ludDNkfSB0cmFuc2xhdGlvbiAgIEEgM0QgcG9pbnQgd2l0aCBwYXJhbWV0ZXJzIHgsIHksIHogVGhpcyBpcwogICAqICAgICAgICAgICAgICAgICAgICB0aGUgdHJhbnNsYXRpb24gb2YgdGhlIHBvaW50LCBzZWVuIGZyb20gdGhlCiAgICogICAgICAgICAgICAgICAgICAgIGNhbWVyYQogICAqIEByZXR1cm4ge1BvaW50MmR9IHBvaW50MmQgICAgQSAyRCBwb2ludCB3aXRoIHBhcmFtZXRlcnMgeCwgeQogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9jb252ZXJ0VHJhbnNsYXRpb25Ub1NjcmVlbiA9IGZ1bmN0aW9uICh0cmFuc2xhdGlvbikgewogICAgdmFyIGV4ID0gdGhpcy5leWUueCwKICAgICAgICBleSA9IHRoaXMuZXllLnksCiAgICAgICAgZXogPSB0aGlzLmV5ZS56LAogICAgICAgIGR4ID0gdHJhbnNsYXRpb24ueCwKICAgICAgICBkeSA9IHRyYW5zbGF0aW9uLnksCiAgICAgICAgZHogPSB0cmFuc2xhdGlvbi56OwoKICAgIC8vIGNhbGN1bGF0ZSBwb3NpdGlvbiBvbiBzY3JlZW4gZnJvbSB0cmFuc2xhdGlvbgogICAgdmFyIGJ4OwogICAgdmFyIGJ5OwogICAgaWYgKHRoaXMuc2hvd1BlcnNwZWN0aXZlKSB7CiAgICAgIGJ4ID0gKGR4IC0gZXgpICogKGV6IC8gZHopOwogICAgICBieSA9IChkeSAtIGV5KSAqIChleiAvIGR6KTsKICAgIH0gZWxzZSB7CiAgICAgIGJ4ID0gZHggKiAtKGV6IC8gdGhpcy5jYW1lcmEuZ2V0QXJtTGVuZ3RoKCkpOwogICAgICBieSA9IGR5ICogLShleiAvIHRoaXMuY2FtZXJhLmdldEFybUxlbmd0aCgpKTsKICAgIH0KCiAgICAvLyBzaGlmdCBhbmQgc2NhbGUgdGhlIHBvaW50IHRvIHRoZSBjZW50ZXIgb2YgdGhlIHNjcmVlbgogICAgLy8gdXNlIHRoZSB3aWR0aCBvZiB0aGUgZ3JhcGggdG8gc2NhbGUgYm90aCBob3Jpem9udGFsbHkgYW5kIHZlcnRpY2FsbHkuCiAgICByZXR1cm4gbmV3IFBvaW50MmQodGhpcy54Y2VudGVyICsgYnggKiB0aGlzLmZyYW1lLmNhbnZhcy5jbGllbnRXaWR0aCwgdGhpcy55Y2VudGVyIC0gYnkgKiB0aGlzLmZyYW1lLmNhbnZhcy5jbGllbnRXaWR0aCk7CiAgfTsKCiAgLyoqCiAgICogU2V0IHRoZSBiYWNrZ3JvdW5kIHN0eWxpbmcgZm9yIHRoZSBncmFwaAogICAqIEBwYXJhbSB7c3RyaW5nIHwge2ZpbGw6IHN0cmluZywgc3Ryb2tlOiBzdHJpbmcsIHN0cm9rZVdpZHRoOiBzdHJpbmd9fSBiYWNrZ3JvdW5kQ29sb3IKICAgKi8KICBHcmFwaDNkLnByb3RvdHlwZS5fc2V0QmFja2dyb3VuZENvbG9yID0gZnVuY3Rpb24gKGJhY2tncm91bmRDb2xvcikgewogICAgdmFyIGZpbGwgPSAnd2hpdGUnOwogICAgdmFyIHN0cm9rZSA9ICdncmF5JzsKICAgIHZhciBzdHJva2VXaWR0aCA9IDE7CgogICAgaWYgKHR5cGVvZiBiYWNrZ3JvdW5kQ29sb3IgPT09ICdzdHJpbmcnKSB7CiAgICAgIGZpbGwgPSBiYWNrZ3JvdW5kQ29sb3I7CiAgICAgIHN0cm9rZSA9ICdub25lJzsKICAgICAgc3Ryb2tlV2lkdGggPSAwOwogICAgfSBlbHNlIGlmICh0eXBlb2YgYmFja2dyb3VuZENvbG9yID09PSAnb2JqZWN0JykgewogICAgICBpZiAoYmFja2dyb3VuZENvbG9yLmZpbGwgIT09IHVuZGVmaW5lZCkgZmlsbCA9IGJhY2tncm91bmRDb2xvci5maWxsOwogICAgICBpZiAoYmFja2dyb3VuZENvbG9yLnN0cm9rZSAhPT0gdW5kZWZpbmVkKSBzdHJva2UgPSBiYWNrZ3JvdW5kQ29sb3Iuc3Ryb2tlOwogICAgICBpZiAoYmFja2dyb3VuZENvbG9yLnN0cm9rZVdpZHRoICE9PSB1bmRlZmluZWQpIHN0cm9rZVdpZHRoID0gYmFja2dyb3VuZENvbG9yLnN0cm9rZVdpZHRoOwogICAgfSBlbHNlIGlmIChiYWNrZ3JvdW5kQ29sb3IgPT09IHVuZGVmaW5lZCkge30gZWxzZSB7CiAgICAgIHRocm93ICdVbnN1cHBvcnRlZCB0eXBlIG9mIGJhY2tncm91bmRDb2xvcic7CiAgICB9CgogICAgdGhpcy5mcmFtZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBmaWxsOwogICAgdGhpcy5mcmFtZS5zdHlsZS5ib3JkZXJDb2xvciA9IHN0cm9rZTsKICAgIHRoaXMuZnJhbWUuc3R5bGUuYm9yZGVyV2lkdGggPSBzdHJva2VXaWR0aCArICdweCc7CiAgICB0aGlzLmZyYW1lLnN0eWxlLmJvcmRlclN0eWxlID0gJ3NvbGlkJzsKICB9OwoKICAvLy8gZW51bWVyYXRlIHRoZSBhdmFpbGFibGUgc3R5bGVzCiAgR3JhcGgzZC5TVFlMRSA9IHsKICAgIEJBUjogMCwKICAgIEJBUkNPTE9SOiAxLAogICAgQkFSU0laRTogMiwKICAgIERPVDogMywKICAgIERPVExJTkU6IDQsCiAgICBET1RDT0xPUjogNSwKICAgIERPVFNJWkU6IDYsCiAgICBHUklEOiA3LAogICAgTElORTogOCwKICAgIFNVUkZBQ0U6IDkKICB9OwoKICAvKioKICAgKiBSZXRyaWV2ZSB0aGUgc3R5bGUgaW5kZXggZnJvbSBnaXZlbiBzdHlsZU5hbWUKICAgKiBAcGFyYW0ge3N0cmluZ30gc3R5bGVOYW1lICBTdHlsZSBuYW1lIHN1Y2ggYXMgJ2RvdCcsICdncmlkJywgJ2RvdC1saW5lJwogICAqIEByZXR1cm4ge051bWJlcn0gc3R5bGVOdW1iZXIgRW51bWVyYXRpb24gdmFsdWUgcmVwcmVzZW50aW5nIHRoZSBzdHlsZSwgb3IgLTEKICAgKiAgICAgICAgICAgICAgICB3aGVuIG5vdCBmb3VuZAogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9nZXRTdHlsZU51bWJlciA9IGZ1bmN0aW9uIChzdHlsZU5hbWUpIHsKICAgIHN3aXRjaCAoc3R5bGVOYW1lKSB7CiAgICAgIGNhc2UgJ2RvdCc6CiAgICAgICAgcmV0dXJuIEdyYXBoM2QuU1RZTEUuRE9UOwogICAgICBjYXNlICdkb3QtbGluZSc6CiAgICAgICAgcmV0dXJuIEdyYXBoM2QuU1RZTEUuRE9UTElORTsKICAgICAgY2FzZSAnZG90LWNvbG9yJzoKICAgICAgICByZXR1cm4gR3JhcGgzZC5TVFlMRS5ET1RDT0xPUjsKICAgICAgY2FzZSAnZG90LXNpemUnOgogICAgICAgIHJldHVybiBHcmFwaDNkLlNUWUxFLkRPVFNJWkU7CiAgICAgIGNhc2UgJ2xpbmUnOgogICAgICAgIHJldHVybiBHcmFwaDNkLlNUWUxFLkxJTkU7CiAgICAgIGNhc2UgJ2dyaWQnOgogICAgICAgIHJldHVybiBHcmFwaDNkLlNUWUxFLkdSSUQ7CiAgICAgIGNhc2UgJ3N1cmZhY2UnOgogICAgICAgIHJldHVybiBHcmFwaDNkLlNUWUxFLlNVUkZBQ0U7CiAgICAgIGNhc2UgJ2Jhcic6CiAgICAgICAgcmV0dXJuIEdyYXBoM2QuU1RZTEUuQkFSOwogICAgICBjYXNlICdiYXItY29sb3InOgogICAgICAgIHJldHVybiBHcmFwaDNkLlNUWUxFLkJBUkNPTE9SOwogICAgICBjYXNlICdiYXItc2l6ZSc6CiAgICAgICAgcmV0dXJuIEdyYXBoM2QuU1RZTEUuQkFSU0laRTsKICAgIH0KCiAgICByZXR1cm4gLTE7CiAgfTsKCiAgLyoqCiAgICogRGV0ZXJtaW5lIHRoZSBpbmRleGVzIG9mIHRoZSBkYXRhIGNvbHVtbnMsIGJhc2VkIG9uIHRoZSBnaXZlbiBzdHlsZSBhbmQgZGF0YQogICAqIEBwYXJhbSB7RGF0YVNldH0gZGF0YQogICAqIEBwYXJhbSB7TnVtYmVyfSAgc3R5bGUKICAgKi8KICBHcmFwaDNkLnByb3RvdHlwZS5fZGV0ZXJtaW5lQ29sdW1uSW5kZXhlcyA9IGZ1bmN0aW9uIChkYXRhLCBzdHlsZSkgewogICAgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuRE9UIHx8IHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuRE9UTElORSB8fCB0aGlzLnN0eWxlID09PSBHcmFwaDNkLlNUWUxFLkxJTkUgfHwgdGhpcy5zdHlsZSA9PT0gR3JhcGgzZC5TVFlMRS5HUklEIHx8IHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuU1VSRkFDRSB8fCB0aGlzLnN0eWxlID09PSBHcmFwaDNkLlNUWUxFLkJBUikgewogICAgICAvLyAzIGNvbHVtbnMgZXhwZWN0ZWQsIGFuZCBvcHRpb25hbGx5IGEgNHRoIHdpdGggZmlsdGVyIHZhbHVlcwogICAgICB0aGlzLmNvbFggPSAwOwogICAgICB0aGlzLmNvbFkgPSAxOwogICAgICB0aGlzLmNvbFogPSAyOwogICAgICB0aGlzLmNvbFZhbHVlID0gdW5kZWZpbmVkOwoKICAgICAgaWYgKGRhdGEuZ2V0TnVtYmVyT2ZDb2x1bW5zKCkgPiAzKSB7CiAgICAgICAgdGhpcy5jb2xGaWx0ZXIgPSAzOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuRE9UQ09MT1IgfHwgdGhpcy5zdHlsZSA9PT0gR3JhcGgzZC5TVFlMRS5ET1RTSVpFIHx8IHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuQkFSQ09MT1IgfHwgdGhpcy5zdHlsZSA9PT0gR3JhcGgzZC5TVFlMRS5CQVJTSVpFKSB7CiAgICAgIC8vIDQgY29sdW1ucyBleHBlY3RlZCwgYW5kIG9wdGlvbmFsbHkgYSA1dGggd2l0aCBmaWx0ZXIgdmFsdWVzCiAgICAgIHRoaXMuY29sWCA9IDA7CiAgICAgIHRoaXMuY29sWSA9IDE7CiAgICAgIHRoaXMuY29sWiA9IDI7CiAgICAgIHRoaXMuY29sVmFsdWUgPSAzOwoKICAgICAgaWYgKGRhdGEuZ2V0TnVtYmVyT2ZDb2x1bW5zKCkgPiA0KSB7CiAgICAgICAgdGhpcy5jb2xGaWx0ZXIgPSA0OwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aHJvdyAnVW5rbm93biBzdHlsZSAiJyArIHRoaXMuc3R5bGUgKyAnIic7CiAgICB9CiAgfTsKCiAgR3JhcGgzZC5wcm90b3R5cGUuZ2V0TnVtYmVyT2ZSb3dzID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHJldHVybiBkYXRhLmxlbmd0aDsKICB9OwoKICBHcmFwaDNkLnByb3RvdHlwZS5nZXROdW1iZXJPZkNvbHVtbnMgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgdmFyIGNvdW50ZXIgPSAwOwogICAgZm9yICh2YXIgY29sdW1uIGluIGRhdGFbMF0pIHsKICAgICAgaWYgKGRhdGFbMF0uaGFzT3duUHJvcGVydHkoY29sdW1uKSkgewogICAgICAgIGNvdW50ZXIrKzsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGNvdW50ZXI7CiAgfTsKCiAgR3JhcGgzZC5wcm90b3R5cGUuZ2V0RGlzdGluY3RWYWx1ZXMgPSBmdW5jdGlvbiAoZGF0YSwgY29sdW1uKSB7CiAgICB2YXIgZGlzdGluY3RWYWx1ZXMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICBpZiAoZGlzdGluY3RWYWx1ZXMuaW5kZXhPZihkYXRhW2ldW2NvbHVtbl0pID09IC0xKSB7CiAgICAgICAgZGlzdGluY3RWYWx1ZXMucHVzaChkYXRhW2ldW2NvbHVtbl0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZGlzdGluY3RWYWx1ZXM7CiAgfTsKCiAgR3JhcGgzZC5wcm90b3R5cGUuZ2V0Q29sdW1uUmFuZ2UgPSBmdW5jdGlvbiAoZGF0YSwgY29sdW1uKSB7CiAgICB2YXIgbWluTWF4ID0geyBtaW46IGRhdGFbMF1bY29sdW1uXSwgbWF4OiBkYXRhWzBdW2NvbHVtbl0gfTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICBpZiAobWluTWF4Lm1pbiA+IGRhdGFbaV1bY29sdW1uXSkgewogICAgICAgIG1pbk1heC5taW4gPSBkYXRhW2ldW2NvbHVtbl07CiAgICAgIH0KICAgICAgaWYgKG1pbk1heC5tYXggPCBkYXRhW2ldW2NvbHVtbl0pIHsKICAgICAgICBtaW5NYXgubWF4ID0gZGF0YVtpXVtjb2x1bW5dOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWluTWF4OwogIH07CgogIC8qKgogICAqIEluaXRpYWxpemUgdGhlIGRhdGEgZnJvbSB0aGUgZGF0YSB0YWJsZS4gQ2FsY3VsYXRlIG1pbmltdW0gYW5kIG1heGltdW0gdmFsdWVzCiAgICogYW5kIGNvbHVtbiBpbmRleCB2YWx1ZXMKICAgKiBAcGFyYW0ge0FycmF5IHwgRGF0YVNldCB8IERhdGFWaWV3fSByYXdEYXRhICAgVGhlIGRhdGEgY29udGFpbmluZyB0aGUgaXRlbXMgZm9yIHRoZSBHcmFwaC4KICAgKiBAcGFyYW0ge051bWJlcn0gICAgIHN0eWxlICAgU3R5bGUgTnVtYmVyCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX2RhdGFJbml0aWFsaXplID0gZnVuY3Rpb24gKHJhd0RhdGEsIHN0eWxlKSB7CiAgICB2YXIgbWUgPSB0aGlzOwoKICAgIC8vIHVuc3Vic2NyaWJlIGZyb20gdGhlIGRhdGFUYWJsZQogICAgaWYgKHRoaXMuZGF0YVNldCkgewogICAgICB0aGlzLmRhdGFTZXQub2ZmKCcqJywgdGhpcy5fb25DaGFuZ2UpOwogICAgfQoKICAgIGlmIChyYXdEYXRhID09PSB1bmRlZmluZWQpIHJldHVybjsKCiAgICBpZiAoQXJyYXkuaXNBcnJheShyYXdEYXRhKSkgewogICAgICByYXdEYXRhID0gbmV3IERhdGFTZXQocmF3RGF0YSk7CiAgICB9CgogICAgdmFyIGRhdGE7CiAgICBpZiAocmF3RGF0YSBpbnN0YW5jZW9mIERhdGFTZXQgfHwgcmF3RGF0YSBpbnN0YW5jZW9mIERhdGFWaWV3KSB7CiAgICAgIGRhdGEgPSByYXdEYXRhLmdldCgpOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcnJheSwgRGF0YVNldCwgb3IgRGF0YVZpZXcgZXhwZWN0ZWQnKTsKICAgIH0KCiAgICBpZiAoZGF0YS5sZW5ndGggPT0gMCkgcmV0dXJuOwoKICAgIHRoaXMuZGF0YVNldCA9IHJhd0RhdGE7CiAgICB0aGlzLmRhdGFUYWJsZSA9IGRhdGE7CgogICAgLy8gc3Vic2NyaWJlIHRvIGNoYW5nZXMgaW4gdGhlIGRhdGFzZXQKICAgIHRoaXMuX29uQ2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICBtZS5zZXREYXRhKG1lLmRhdGFTZXQpOwogICAgfTsKICAgIHRoaXMuZGF0YVNldC5vbignKicsIHRoaXMuX29uQ2hhbmdlKTsKCiAgICAvLyBfZGV0ZXJtaW5lQ29sdW1uSW5kZXhlcwogICAgLy8gZ2V0TnVtYmVyT2ZSb3dzIChwb2ludHMpCiAgICAvLyBnZXROdW1iZXJPZkNvbHVtbnMgKHgseSx6LHYsdCx0MSx0Mi4uLikKICAgIC8vIGdldERpc3RpbmN0VmFsdWVzICh1bmlxdWUgdmFsdWVzPykKICAgIC8vIGdldENvbHVtblJhbmdlCgogICAgLy8gZGV0ZXJtaW5lIHRoZSBsb2NhdGlvbiBvZiB4LHkseix2YWx1ZSxmaWx0ZXIgY29sdW1ucwogICAgdGhpcy5jb2xYID0gJ3gnOwogICAgdGhpcy5jb2xZID0gJ3knOwogICAgdGhpcy5jb2xaID0gJ3onOwogICAgdGhpcy5jb2xWYWx1ZSA9ICdzdHlsZSc7CiAgICB0aGlzLmNvbEZpbHRlciA9ICdmaWx0ZXInOwoKICAgIC8vIGNoZWNrIGlmIGEgZmlsdGVyIGNvbHVtbiBpcyBwcm92aWRlZAogICAgaWYgKGRhdGFbMF0uaGFzT3duUHJvcGVydHkoJ2ZpbHRlcicpKSB7CiAgICAgIGlmICh0aGlzLmRhdGFGaWx0ZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuZGF0YUZpbHRlciA9IG5ldyBGaWx0ZXIocmF3RGF0YSwgdGhpcy5jb2xGaWx0ZXIsIHRoaXMpOwogICAgICAgIHRoaXMuZGF0YUZpbHRlci5zZXRPbkxvYWRDYWxsYmFjayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5yZWRyYXcoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICAgIHZhciB3aXRoQmFycyA9IHRoaXMuc3R5bGUgPT0gR3JhcGgzZC5TVFlMRS5CQVIgfHwgdGhpcy5zdHlsZSA9PSBHcmFwaDNkLlNUWUxFLkJBUkNPTE9SIHx8IHRoaXMuc3R5bGUgPT0gR3JhcGgzZC5TVFlMRS5CQVJTSVpFOwoKICAgIC8vIGRldGVybWluZSBiYXJXaWR0aCBmcm9tIGRhdGEKICAgIGlmICh3aXRoQmFycykgewogICAgICBpZiAodGhpcy5kZWZhdWx0WEJhcldpZHRoICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnhCYXJXaWR0aCA9IHRoaXMuZGVmYXVsdFhCYXJXaWR0aDsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZGF0YVggPSB0aGlzLmdldERpc3RpbmN0VmFsdWVzKGRhdGEsIHRoaXMuY29sWCk7CiAgICAgICAgdGhpcy54QmFyV2lkdGggPSBkYXRhWFsxXSAtIGRhdGFYWzBdIHx8IDE7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmRlZmF1bHRZQmFyV2lkdGggIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMueUJhcldpZHRoID0gdGhpcy5kZWZhdWx0WUJhcldpZHRoOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBkYXRhWSA9IHRoaXMuZ2V0RGlzdGluY3RWYWx1ZXMoZGF0YSwgdGhpcy5jb2xZKTsKICAgICAgICB0aGlzLnlCYXJXaWR0aCA9IGRhdGFZWzFdIC0gZGF0YVlbMF0gfHwgMTsKICAgICAgfQogICAgfQoKICAgIC8vIGNhbGN1bGF0ZSBtaW5pbXVtcyBhbmQgbWF4aW11bXMKICAgIHZhciB4UmFuZ2UgPSB0aGlzLmdldENvbHVtblJhbmdlKGRhdGEsIHRoaXMuY29sWCk7CiAgICBpZiAod2l0aEJhcnMpIHsKICAgICAgeFJhbmdlLm1pbiAtPSB0aGlzLnhCYXJXaWR0aCAvIDI7CiAgICAgIHhSYW5nZS5tYXggKz0gdGhpcy54QmFyV2lkdGggLyAyOwogICAgfQogICAgdGhpcy54TWluID0gdGhpcy5kZWZhdWx0WE1pbiAhPT0gdW5kZWZpbmVkID8gdGhpcy5kZWZhdWx0WE1pbiA6IHhSYW5nZS5taW47CiAgICB0aGlzLnhNYXggPSB0aGlzLmRlZmF1bHRYTWF4ICE9PSB1bmRlZmluZWQgPyB0aGlzLmRlZmF1bHRYTWF4IDogeFJhbmdlLm1heDsKICAgIGlmICh0aGlzLnhNYXggPD0gdGhpcy54TWluKSB0aGlzLnhNYXggPSB0aGlzLnhNaW4gKyAxOwogICAgdGhpcy54U3RlcCA9IHRoaXMuZGVmYXVsdFhTdGVwICE9PSB1bmRlZmluZWQgPyB0aGlzLmRlZmF1bHRYU3RlcCA6ICh0aGlzLnhNYXggLSB0aGlzLnhNaW4pIC8gNTsKCiAgICB2YXIgeVJhbmdlID0gdGhpcy5nZXRDb2x1bW5SYW5nZShkYXRhLCB0aGlzLmNvbFkpOwogICAgaWYgKHdpdGhCYXJzKSB7CiAgICAgIHlSYW5nZS5taW4gLT0gdGhpcy55QmFyV2lkdGggLyAyOwogICAgICB5UmFuZ2UubWF4ICs9IHRoaXMueUJhcldpZHRoIC8gMjsKICAgIH0KICAgIHRoaXMueU1pbiA9IHRoaXMuZGVmYXVsdFlNaW4gIT09IHVuZGVmaW5lZCA/IHRoaXMuZGVmYXVsdFlNaW4gOiB5UmFuZ2UubWluOwogICAgdGhpcy55TWF4ID0gdGhpcy5kZWZhdWx0WU1heCAhPT0gdW5kZWZpbmVkID8gdGhpcy5kZWZhdWx0WU1heCA6IHlSYW5nZS5tYXg7CiAgICBpZiAodGhpcy55TWF4IDw9IHRoaXMueU1pbikgdGhpcy55TWF4ID0gdGhpcy55TWluICsgMTsKICAgIHRoaXMueVN0ZXAgPSB0aGlzLmRlZmF1bHRZU3RlcCAhPT0gdW5kZWZpbmVkID8gdGhpcy5kZWZhdWx0WVN0ZXAgOiAodGhpcy55TWF4IC0gdGhpcy55TWluKSAvIDU7CgogICAgdmFyIHpSYW5nZSA9IHRoaXMuZ2V0Q29sdW1uUmFuZ2UoZGF0YSwgdGhpcy5jb2xaKTsKICAgIHRoaXMuek1pbiA9IHRoaXMuZGVmYXVsdFpNaW4gIT09IHVuZGVmaW5lZCA/IHRoaXMuZGVmYXVsdFpNaW4gOiB6UmFuZ2UubWluOwogICAgdGhpcy56TWF4ID0gdGhpcy5kZWZhdWx0Wk1heCAhPT0gdW5kZWZpbmVkID8gdGhpcy5kZWZhdWx0Wk1heCA6IHpSYW5nZS5tYXg7CiAgICBpZiAodGhpcy56TWF4IDw9IHRoaXMuek1pbikgdGhpcy56TWF4ID0gdGhpcy56TWluICsgMTsKICAgIHRoaXMuelN0ZXAgPSB0aGlzLmRlZmF1bHRaU3RlcCAhPT0gdW5kZWZpbmVkID8gdGhpcy5kZWZhdWx0WlN0ZXAgOiAodGhpcy56TWF4IC0gdGhpcy56TWluKSAvIDU7CgogICAgaWYgKHRoaXMuY29sVmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICB2YXIgdmFsdWVSYW5nZSA9IHRoaXMuZ2V0Q29sdW1uUmFuZ2UoZGF0YSwgdGhpcy5jb2xWYWx1ZSk7CiAgICAgIHRoaXMudmFsdWVNaW4gPSB0aGlzLmRlZmF1bHRWYWx1ZU1pbiAhPT0gdW5kZWZpbmVkID8gdGhpcy5kZWZhdWx0VmFsdWVNaW4gOiB2YWx1ZVJhbmdlLm1pbjsKICAgICAgdGhpcy52YWx1ZU1heCA9IHRoaXMuZGVmYXVsdFZhbHVlTWF4ICE9PSB1bmRlZmluZWQgPyB0aGlzLmRlZmF1bHRWYWx1ZU1heCA6IHZhbHVlUmFuZ2UubWF4OwogICAgICBpZiAodGhpcy52YWx1ZU1heCA8PSB0aGlzLnZhbHVlTWluKSB0aGlzLnZhbHVlTWF4ID0gdGhpcy52YWx1ZU1pbiArIDE7CiAgICB9CgogICAgLy8gc2V0IHRoZSBzY2FsZSBkZXBlbmRlbnQgb24gdGhlIHJhbmdlcy4KICAgIHRoaXMuX3NldFNjYWxlKCk7CiAgfTsKCiAgLyoqCiAgICogRmlsdGVyIHRoZSBkYXRhIGJhc2VkIG9uIHRoZSBjdXJyZW50IGZpbHRlcgogICAqIEBwYXJhbSB7QXJyYXl9IGRhdGEKICAgKiBAcmV0dXJuIHtBcnJheX0gZGF0YVBvaW50cyAgIEFycmF5IHdpdGggcG9pbnQgb2JqZWN0cyB3aGljaCBjYW4gYmUgZHJhd24gb24gc2NyZWVuCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX2dldERhdGFQb2ludHMgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgLy8gVE9ETzogc3RvcmUgdGhlIGNyZWF0ZWQgbWF0cml4IGRhdGFQb2ludHMgaW4gdGhlIGZpbHRlcnMgaW5zdGVhZCBvZiByZWxvYWRpbmcgZWFjaCB0aW1lCiAgICB2YXIgeCwgeSwgaSwgeiwgb2JqLCBwb2ludDsKCiAgICB2YXIgZGF0YVBvaW50cyA9IFtdOwoKICAgIGlmICh0aGlzLnN0eWxlID09PSBHcmFwaDNkLlNUWUxFLkdSSUQgfHwgdGhpcy5zdHlsZSA9PT0gR3JhcGgzZC5TVFlMRS5TVVJGQUNFKSB7CiAgICAgIC8vIGNvcHkgYWxsIHZhbHVlcyBmcm9tIHRoZSBnb29nbGUgZGF0YSB0YWJsZSB0byBhIG1hdHJpeAogICAgICAvLyB0aGUgcHJvdmlkZWQgdmFsdWVzIGFyZSBzdXBwb3NlZCB0byBmb3JtIGEgZ3JpZCBvZiAoeCx5KSBwb3NpdGlvbnMKCiAgICAgIC8vIGNyZWF0ZSB0d28gbGlzdHMgd2l0aCBhbGwgcHJlc2VudCB4IGFuZCB5IHZhbHVlcwogICAgICB2YXIgZGF0YVggPSBbXTsKICAgICAgdmFyIGRhdGFZID0gW107CiAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmdldE51bWJlck9mUm93cyhkYXRhKTsgaSsrKSB7CiAgICAgICAgeCA9IGRhdGFbaV1bdGhpcy5jb2xYXSB8fCAwOwogICAgICAgIHkgPSBkYXRhW2ldW3RoaXMuY29sWV0gfHwgMDsKCiAgICAgICAgaWYgKGRhdGFYLmluZGV4T2YoeCkgPT09IC0xKSB7CiAgICAgICAgICBkYXRhWC5wdXNoKHgpOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YVkuaW5kZXhPZih5KSA9PT0gLTEpIHsKICAgICAgICAgIGRhdGFZLnB1c2goeSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgc29ydE51bWJlciA9IGZ1bmN0aW9uIHNvcnROdW1iZXIoYSwgYikgewogICAgICAgIHJldHVybiBhIC0gYjsKICAgICAgfTsKICAgICAgZGF0YVguc29ydChzb3J0TnVtYmVyKTsKICAgICAgZGF0YVkuc29ydChzb3J0TnVtYmVyKTsKCiAgICAgIC8vIGNyZWF0ZSBhIGdyaWQsIGEgMmQgbWF0cml4LCB3aXRoIGFsbCB2YWx1ZXMuCiAgICAgIHZhciBkYXRhTWF0cml4ID0gW107IC8vIHRlbXBvcmFyeSBkYXRhIG1hdHJpeAogICAgICBmb3IgKGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIHggPSBkYXRhW2ldW3RoaXMuY29sWF0gfHwgMDsKICAgICAgICB5ID0gZGF0YVtpXVt0aGlzLmNvbFldIHx8IDA7CiAgICAgICAgeiA9IGRhdGFbaV1bdGhpcy5jb2xaXSB8fCAwOwoKICAgICAgICB2YXIgeEluZGV4ID0gZGF0YVguaW5kZXhPZih4KTsgLy8gVE9ETzogaW1wbGVtZW50IEFycmF5KCkuaW5kZXhPZigpIGZvciBJbnRlcm5ldCBFeHBsb3JlcgogICAgICAgIHZhciB5SW5kZXggPSBkYXRhWS5pbmRleE9mKHkpOwoKICAgICAgICBpZiAoZGF0YU1hdHJpeFt4SW5kZXhdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGRhdGFNYXRyaXhbeEluZGV4XSA9IFtdOwogICAgICAgIH0KCiAgICAgICAgdmFyIHBvaW50M2QgPSBuZXcgUG9pbnQzZCgpOwogICAgICAgIHBvaW50M2QueCA9IHg7CiAgICAgICAgcG9pbnQzZC55ID0geTsKICAgICAgICBwb2ludDNkLnogPSB6OwoKICAgICAgICBvYmogPSB7fTsKICAgICAgICBvYmoucG9pbnQgPSBwb2ludDNkOwogICAgICAgIG9iai50cmFucyA9IHVuZGVmaW5lZDsKICAgICAgICBvYmouc2NyZWVuID0gdW5kZWZpbmVkOwogICAgICAgIG9iai5ib3R0b20gPSBuZXcgUG9pbnQzZCh4LCB5LCB0aGlzLnpNaW4pOwoKICAgICAgICBkYXRhTWF0cml4W3hJbmRleF1beUluZGV4XSA9IG9iajsKCiAgICAgICAgZGF0YVBvaW50cy5wdXNoKG9iaik7CiAgICAgIH0KCiAgICAgIC8vIGZpbGwgaW4gdGhlIHBvaW50ZXJzIHRvIHRoZSBuZWlnaGJvcnMuCiAgICAgIGZvciAoeCA9IDA7IHggPCBkYXRhTWF0cml4Lmxlbmd0aDsgeCsrKSB7CiAgICAgICAgZm9yICh5ID0gMDsgeSA8IGRhdGFNYXRyaXhbeF0ubGVuZ3RoOyB5KyspIHsKICAgICAgICAgIGlmIChkYXRhTWF0cml4W3hdW3ldKSB7CiAgICAgICAgICAgIGRhdGFNYXRyaXhbeF1beV0ucG9pbnRSaWdodCA9IHggPCBkYXRhTWF0cml4Lmxlbmd0aCAtIDEgPyBkYXRhTWF0cml4W3ggKyAxXVt5XSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgZGF0YU1hdHJpeFt4XVt5XS5wb2ludFRvcCA9IHkgPCBkYXRhTWF0cml4W3hdLmxlbmd0aCAtIDEgPyBkYXRhTWF0cml4W3hdW3kgKyAxXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgZGF0YU1hdHJpeFt4XVt5XS5wb2ludENyb3NzID0geCA8IGRhdGFNYXRyaXgubGVuZ3RoIC0gMSAmJiB5IDwgZGF0YU1hdHJpeFt4XS5sZW5ndGggLSAxID8gZGF0YU1hdHJpeFt4ICsgMV1beSArIDFdIDogdW5kZWZpbmVkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gJ2RvdCcsICdkb3QtbGluZScsIGV0Yy4KICAgICAgLy8gY29weSBhbGwgdmFsdWVzIGZyb20gdGhlIGdvb2dsZSBkYXRhIHRhYmxlIHRvIGEgbGlzdCB3aXRoIFBvaW50M2Qgb2JqZWN0cwogICAgICBmb3IgKGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIHBvaW50ID0gbmV3IFBvaW50M2QoKTsKICAgICAgICBwb2ludC54ID0gZGF0YVtpXVt0aGlzLmNvbFhdIHx8IDA7CiAgICAgICAgcG9pbnQueSA9IGRhdGFbaV1bdGhpcy5jb2xZXSB8fCAwOwogICAgICAgIHBvaW50LnogPSBkYXRhW2ldW3RoaXMuY29sWl0gfHwgMDsKCiAgICAgICAgaWYgKHRoaXMuY29sVmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcG9pbnQudmFsdWUgPSBkYXRhW2ldW3RoaXMuY29sVmFsdWVdIHx8IDA7CiAgICAgICAgfQoKICAgICAgICBvYmogPSB7fTsKICAgICAgICBvYmoucG9pbnQgPSBwb2ludDsKICAgICAgICBvYmouYm90dG9tID0gbmV3IFBvaW50M2QocG9pbnQueCwgcG9pbnQueSwgdGhpcy56TWluKTsKICAgICAgICBvYmoudHJhbnMgPSB1bmRlZmluZWQ7CiAgICAgICAgb2JqLnNjcmVlbiA9IHVuZGVmaW5lZDsKCiAgICAgICAgZGF0YVBvaW50cy5wdXNoKG9iaik7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZGF0YVBvaW50czsKICB9OwoKICAvKioKICAgKiBDcmVhdGUgdGhlIG1haW4gZnJhbWUgZm9yIHRoZSBHcmFwaDNkLgogICAqIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgb25jZSB3aGVuIGEgR3JhcGgzZCBvYmplY3QgaXMgY3JlYXRlZC4gVGhlIGZyYW1lCiAgICogY29udGFpbnMgYSBjYW52YXMsIGFuZCB0aGlzIGNhbnZhcyBjb250YWlucyBhbGwgb2JqZWN0cyBsaWtlIHRoZSBheGlzIGFuZAogICAqIG5vZGVzLgogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIHJlbW92ZSBhbGwgZWxlbWVudHMgZnJvbSB0aGUgY29udGFpbmVyIGVsZW1lbnQuCiAgICB3aGlsZSAodGhpcy5jb250YWluZXJFbGVtZW50Lmhhc0NoaWxkTm9kZXMoKSkgewogICAgICB0aGlzLmNvbnRhaW5lckVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5jb250YWluZXJFbGVtZW50LmZpcnN0Q2hpbGQpOwogICAgfQoKICAgIHRoaXMuZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHRoaXMuZnJhbWUuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnOwogICAgdGhpcy5mcmFtZS5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nOwoKICAgIC8vIGNyZWF0ZSB0aGUgZ3JhcGggY2FudmFzIChIVE1MIGNhbnZhcyBlbGVtZW50KQogICAgdGhpcy5mcmFtZS5jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgIHRoaXMuZnJhbWUuY2FudmFzLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsKICAgIHRoaXMuZnJhbWUuYXBwZW5kQ2hpbGQodGhpcy5mcmFtZS5jYW52YXMpOwogICAgLy9pZiAoIXRoaXMuZnJhbWUuY2FudmFzLmdldENvbnRleHQpIHsKICAgIHsKICAgICAgdmFyIG5vQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRElWJyk7CiAgICAgIG5vQ2FudmFzLnN0eWxlLmNvbG9yID0gJ3JlZCc7CiAgICAgIG5vQ2FudmFzLnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7CiAgICAgIG5vQ2FudmFzLnN0eWxlLnBhZGRpbmcgPSAnMTBweCc7CiAgICAgIG5vQ2FudmFzLmlubmVySFRNTCA9ICdFcnJvcjogeW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgSFRNTCBjYW52YXMnOwogICAgICB0aGlzLmZyYW1lLmNhbnZhcy5hcHBlbmRDaGlsZChub0NhbnZhcyk7CiAgICB9CgogICAgdGhpcy5mcmFtZS5maWx0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHRoaXMuZnJhbWUuZmlsdGVyLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKICAgIHRoaXMuZnJhbWUuZmlsdGVyLnN0eWxlLmJvdHRvbSA9ICcwcHgnOwogICAgdGhpcy5mcmFtZS5maWx0ZXIuc3R5bGUubGVmdCA9ICcwcHgnOwogICAgdGhpcy5mcmFtZS5maWx0ZXIuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICB0aGlzLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuZnJhbWUuZmlsdGVyKTsKCiAgICAvLyBhZGQgZXZlbnQgbGlzdGVuZXJzIHRvIGhhbmRsZSBtb3ZpbmcgYW5kIHpvb21pbmcgdGhlIGNvbnRlbnRzCiAgICB2YXIgbWUgPSB0aGlzOwogICAgdmFyIG9ubW91c2Vkb3duID0gZnVuY3Rpb24gb25tb3VzZWRvd24oZXZlbnQpIHsKICAgICAgbWUuX29uTW91c2VEb3duKGV2ZW50KTsKICAgIH07CiAgICB2YXIgb250b3VjaHN0YXJ0ID0gZnVuY3Rpb24gb250b3VjaHN0YXJ0KGV2ZW50KSB7CiAgICAgIG1lLl9vblRvdWNoU3RhcnQoZXZlbnQpOwogICAgfTsKICAgIHZhciBvbm1vdXNld2hlZWwgPSBmdW5jdGlvbiBvbm1vdXNld2hlZWwoZXZlbnQpIHsKICAgICAgbWUuX29uV2hlZWwoZXZlbnQpOwogICAgfTsKICAgIHZhciBvbnRvb2x0aXAgPSBmdW5jdGlvbiBvbnRvb2x0aXAoZXZlbnQpIHsKICAgICAgbWUuX29uVG9vbHRpcChldmVudCk7CiAgICB9OwogICAgLy8gVE9ETzogdGhlc2UgZXZlbnRzIGFyZSBuZXZlciBjbGVhbmVkIHVwLi4uIGNhbiBnaXZlIGEgJ21lbW9yeSBsZWFrYWdlJwoKICAgIHV0aWwuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmZyYW1lLmNhbnZhcywgJ2tleWRvd24nLCBvbmtleWRvd24pOwogICAgdXRpbC5hZGRFdmVudExpc3RlbmVyKHRoaXMuZnJhbWUuY2FudmFzLCAnbW91c2Vkb3duJywgb25tb3VzZWRvd24pOwogICAgdXRpbC5hZGRFdmVudExpc3RlbmVyKHRoaXMuZnJhbWUuY2FudmFzLCAndG91Y2hzdGFydCcsIG9udG91Y2hzdGFydCk7CiAgICB1dGlsLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5mcmFtZS5jYW52YXMsICdtb3VzZXdoZWVsJywgb25tb3VzZXdoZWVsKTsKICAgIHV0aWwuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmZyYW1lLmNhbnZhcywgJ21vdXNlbW92ZScsIG9udG9vbHRpcCk7CgogICAgLy8gYWRkIHRoZSBuZXcgZ3JhcGggdG8gdGhlIGNvbnRhaW5lciBlbGVtZW50CiAgICB0aGlzLmNvbnRhaW5lckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5mcmFtZSk7CiAgfTsKCiAgLyoqCiAgICogU2V0IGEgbmV3IHNpemUgZm9yIHRoZSBncmFwaAogICAqIEBwYXJhbSB7c3RyaW5nfSB3aWR0aCAgIFdpZHRoIGluIHBpeGVscyBvciBwZXJjZW50YWdlIChmb3IgZXhhbXBsZSAnODAwcHgnCiAgICogICAgICAgICAgICAgb3IgJzUwJScpCiAgICogQHBhcmFtIHtzdHJpbmd9IGhlaWdodCAgSGVpZ2h0IGluIHBpeGVscyBvciBwZXJjZW50YWdlICAoZm9yIGV4YW1wbGUgJzQwMHB4JwogICAqICAgICAgICAgICAgIG9yICczMCUnKQogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLnNldFNpemUgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCkgewogICAgdGhpcy5mcmFtZS5zdHlsZS53aWR0aCA9IHdpZHRoOwogICAgdGhpcy5mcmFtZS5zdHlsZS5oZWlnaHQgPSBoZWlnaHQ7CgogICAgdGhpcy5fcmVzaXplQ2FudmFzKCk7CiAgfTsKCiAgLyoqCiAgICogUmVzaXplIHRoZSBjYW52YXMgdG8gdGhlIGN1cnJlbnQgc2l6ZSBvZiB0aGUgZnJhbWUKICAgKi8KICBHcmFwaDNkLnByb3RvdHlwZS5fcmVzaXplQ2FudmFzID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5mcmFtZS5jYW52YXMuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICB0aGlzLmZyYW1lLmNhbnZhcy5zdHlsZS5oZWlnaHQgPSAnMTAwJSc7CgogICAgdGhpcy5mcmFtZS5jYW52YXMud2lkdGggPSB0aGlzLmZyYW1lLmNhbnZhcy5jbGllbnRXaWR0aDsKICAgIHRoaXMuZnJhbWUuY2FudmFzLmhlaWdodCA9IHRoaXMuZnJhbWUuY2FudmFzLmNsaWVudEhlaWdodDsKCiAgICAvLyBhZGp1c3Qgd2l0aCBmb3IgbWFyZ2luCiAgICB0aGlzLmZyYW1lLmZpbHRlci5zdHlsZS53aWR0aCA9IHRoaXMuZnJhbWUuY2FudmFzLmNsaWVudFdpZHRoIC0gMiAqIDEwICsgJ3B4JzsKICB9OwoKICAvKioKICAgKiBTdGFydCBhbmltYXRpb24KICAgKi8KICBHcmFwaDNkLnByb3RvdHlwZS5hbmltYXRpb25TdGFydCA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5mcmFtZS5maWx0ZXIgfHwgIXRoaXMuZnJhbWUuZmlsdGVyLnNsaWRlcikgdGhyb3cgJ05vIGFuaW1hdGlvbiBhdmFpbGFibGUnOwoKICAgIHRoaXMuZnJhbWUuZmlsdGVyLnNsaWRlci5wbGF5KCk7CiAgfTsKCiAgLyoqCiAgICogU3RvcCBhbmltYXRpb24KICAgKi8KICBHcmFwaDNkLnByb3RvdHlwZS5hbmltYXRpb25TdG9wID0gZnVuY3Rpb24gKCkgewogICAgaWYgKCF0aGlzLmZyYW1lLmZpbHRlciB8fCAhdGhpcy5mcmFtZS5maWx0ZXIuc2xpZGVyKSByZXR1cm47CgogICAgdGhpcy5mcmFtZS5maWx0ZXIuc2xpZGVyLnN0b3AoKTsKICB9OwoKICAvKioKICAgKiBSZXNpemUgdGhlIGNlbnRlciBwb3NpdGlvbiBiYXNlZCBvbiB0aGUgY3VycmVudCB2YWx1ZXMgaW4gdGhpcy5kZWZhdWx0WENlbnRlcgogICAqIGFuZCB0aGlzLmRlZmF1bHRZQ2VudGVyICh3aGljaCBhcmUgc3RyaW5ncyB3aXRoIGEgcGVyY2VudGFnZSBvciBhIHZhbHVlCiAgICogaW4gcGl4ZWxzKS4gVGhlIGNlbnRlciBwb3NpdGlvbnMgYXJlIHRoZSB2YXJpYWJsZXMgdGhpcy54Q2VudGVyCiAgICogYW5kIHRoaXMueUNlbnRlcgogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9yZXNpemVDZW50ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAvLyBjYWxjdWxhdGUgdGhlIGhvcml6b250YWwgY2VudGVyIHBvc2l0aW9uCiAgICBpZiAodGhpcy5kZWZhdWx0WENlbnRlci5jaGFyQXQodGhpcy5kZWZhdWx0WENlbnRlci5sZW5ndGggLSAxKSA9PT0gJyUnKSB7CiAgICAgIHRoaXMueGNlbnRlciA9IHBhcnNlRmxvYXQodGhpcy5kZWZhdWx0WENlbnRlcikgLyAxMDAgKiB0aGlzLmZyYW1lLmNhbnZhcy5jbGllbnRXaWR0aDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMueGNlbnRlciA9IHBhcnNlRmxvYXQodGhpcy5kZWZhdWx0WENlbnRlcik7IC8vIHN1cHBvc2VkIHRvIGJlIGluIHB4CiAgICB9CgogICAgLy8gY2FsY3VsYXRlIHRoZSB2ZXJ0aWNhbCBjZW50ZXIgcG9zaXRpb24KICAgIGlmICh0aGlzLmRlZmF1bHRZQ2VudGVyLmNoYXJBdCh0aGlzLmRlZmF1bHRZQ2VudGVyLmxlbmd0aCAtIDEpID09PSAnJScpIHsKICAgICAgdGhpcy55Y2VudGVyID0gcGFyc2VGbG9hdCh0aGlzLmRlZmF1bHRZQ2VudGVyKSAvIDEwMCAqICh0aGlzLmZyYW1lLmNhbnZhcy5jbGllbnRIZWlnaHQgLSB0aGlzLmZyYW1lLmZpbHRlci5jbGllbnRIZWlnaHQpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy55Y2VudGVyID0gcGFyc2VGbG9hdCh0aGlzLmRlZmF1bHRZQ2VudGVyKTsgLy8gc3VwcG9zZWQgdG8gYmUgaW4gcHgKICAgIH0KICB9OwoKICAvKioKICAgKiBTZXQgdGhlIHJvdGF0aW9uIGFuZCBkaXN0YW5jZSBvZiB0aGUgY2FtZXJhCiAgICogQHBhcmFtIHtPYmplY3R9IHBvcyAgIEFuIG9iamVjdCB3aXRoIHRoZSBjYW1lcmEgcG9zaXRpb24uIFRoZSBvYmplY3QKICAgKiAgICAgICAgICAgICBjb250YWlucyB0aHJlZSBwYXJhbWV0ZXJzOgogICAqICAgICAgICAgICAgIC0gaG9yaXpvbnRhbCB7TnVtYmVyfQogICAqICAgICAgICAgICAgIFRoZSBob3Jpem9udGFsIHJvdGF0aW9uLCBiZXR3ZWVuIDAgYW5kIDIqUEkuCiAgICogICAgICAgICAgICAgT3B0aW9uYWwsIGNhbiBiZSBsZWZ0IHVuZGVmaW5lZC4KICAgKiAgICAgICAgICAgICAtIHZlcnRpY2FsIHtOdW1iZXJ9CiAgICogICAgICAgICAgICAgVGhlIHZlcnRpY2FsIHJvdGF0aW9uLCBiZXR3ZWVuIDAgYW5kIDAuNSpQSQogICAqICAgICAgICAgICAgIGlmIHZlcnRpY2FsPTAuNSpQSSwgdGhlIGdyYXBoIGlzIHNob3duIGZyb20gdGhlCiAgICogICAgICAgICAgICAgdG9wLiBPcHRpb25hbCwgY2FuIGJlIGxlZnQgdW5kZWZpbmVkLgogICAqICAgICAgICAgICAgIC0gZGlzdGFuY2Uge051bWJlcn0KICAgKiAgICAgICAgICAgICBUaGUgKG5vcm1hbGl6ZWQpIGRpc3RhbmNlIG9mIHRoZSBjYW1lcmEgdG8gdGhlCiAgICogICAgICAgICAgICAgY2VudGVyIG9mIHRoZSBncmFwaCwgYSB2YWx1ZSBiZXR3ZWVuIDAuNzEgYW5kIDUuMC4KICAgKiAgICAgICAgICAgICBPcHRpb25hbCwgY2FuIGJlIGxlZnQgdW5kZWZpbmVkLgogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLnNldENhbWVyYVBvc2l0aW9uID0gZnVuY3Rpb24gKHBvcykgewogICAgaWYgKHBvcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAocG9zLmhvcml6b250YWwgIT09IHVuZGVmaW5lZCAmJiBwb3MudmVydGljYWwgIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLmNhbWVyYS5zZXRBcm1Sb3RhdGlvbihwb3MuaG9yaXpvbnRhbCwgcG9zLnZlcnRpY2FsKTsKICAgIH0KCiAgICBpZiAocG9zLmRpc3RhbmNlICE9PSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy5jYW1lcmEuc2V0QXJtTGVuZ3RoKHBvcy5kaXN0YW5jZSk7CiAgICB9CgogICAgdGhpcy5yZWRyYXcoKTsKICB9OwoKICAvKioKICAgKiBSZXRyaWV2ZSB0aGUgY3VycmVudCBjYW1lcmEgcm90YXRpb24KICAgKiBAcmV0dXJuIHtvYmplY3R9ICAgQW4gb2JqZWN0IHdpdGggcGFyYW1ldGVycyBob3Jpem9udGFsLCB2ZXJ0aWNhbCwgYW5kCiAgICogICAgICAgICAgZGlzdGFuY2UKICAgKi8KICBHcmFwaDNkLnByb3RvdHlwZS5nZXRDYW1lcmFQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBwb3MgPSB0aGlzLmNhbWVyYS5nZXRBcm1Sb3RhdGlvbigpOwogICAgcG9zLmRpc3RhbmNlID0gdGhpcy5jYW1lcmEuZ2V0QXJtTGVuZ3RoKCk7CiAgICByZXR1cm4gcG9zOwogIH07CgogIC8qKgogICAqIExvYWQgZGF0YSBpbnRvIHRoZSAzRCBHcmFwaAogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9yZWFkRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAvLyByZWFkIHRoZSBkYXRhCiAgICB0aGlzLl9kYXRhSW5pdGlhbGl6ZShkYXRhLCB0aGlzLnN0eWxlKTsKCiAgICBpZiAodGhpcy5kYXRhRmlsdGVyKSB7CiAgICAgIC8vIGFwcGx5IGZpbHRlcmluZwogICAgICB0aGlzLmRhdGFQb2ludHMgPSB0aGlzLmRhdGFGaWx0ZXIuX2dldERhdGFQb2ludHMoKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIG5vIGZpbHRlcmluZy4gbG9hZCBhbGwgZGF0YQogICAgICB0aGlzLmRhdGFQb2ludHMgPSB0aGlzLl9nZXREYXRhUG9pbnRzKHRoaXMuZGF0YVRhYmxlKTsKICAgIH0KCiAgICAvLyBkcmF3IHRoZSBmaWx0ZXIKICAgIHRoaXMuX3JlZHJhd0ZpbHRlcigpOwogIH07CgogIC8qKgogICAqIFJlcGxhY2UgdGhlIGRhdGFzZXQgb2YgdGhlIEdyYXBoM2QKICAgKiBAcGFyYW0ge0FycmF5IHwgRGF0YVNldCB8IERhdGFWaWV3fSBkYXRhCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuc2V0RGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB0aGlzLl9yZWFkRGF0YShkYXRhKTsKICAgIHRoaXMucmVkcmF3KCk7CgogICAgLy8gc3RhcnQgYW5pbWF0aW9uIHdoZW4gb3B0aW9uIGlzIHRydWUKICAgIGlmICh0aGlzLmFuaW1hdGlvbkF1dG9TdGFydCAmJiB0aGlzLmRhdGFGaWx0ZXIpIHsKICAgICAgdGhpcy5hbmltYXRpb25TdGFydCgpOwogICAgfQogIH07CgogIC8qKgogICAqIFVwZGF0ZSB0aGUgb3B0aW9ucy4gT3B0aW9ucyB3aWxsIGJlIG1lcmdlZCB3aXRoIGN1cnJlbnQgb3B0aW9ucwogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICB2YXIgY2FtZXJhUG9zaXRpb24gPSB1bmRlZmluZWQ7CgogICAgdGhpcy5hbmltYXRpb25TdG9wKCk7CgogICAgaWYgKG9wdGlvbnMgIT09IHVuZGVmaW5lZCkgewogICAgICAvLyByZXRyaWV2ZSBwYXJhbWV0ZXIgdmFsdWVzCiAgICAgIGlmIChvcHRpb25zLndpZHRoICE9PSB1bmRlZmluZWQpIHRoaXMud2lkdGggPSBvcHRpb25zLndpZHRoOwogICAgICBpZiAob3B0aW9ucy5oZWlnaHQgIT09IHVuZGVmaW5lZCkgdGhpcy5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDsKCiAgICAgIGlmIChvcHRpb25zLnhDZW50ZXIgIT09IHVuZGVmaW5lZCkgdGhpcy5kZWZhdWx0WENlbnRlciA9IG9wdGlvbnMueENlbnRlcjsKICAgICAgaWYgKG9wdGlvbnMueUNlbnRlciAhPT0gdW5kZWZpbmVkKSB0aGlzLmRlZmF1bHRZQ2VudGVyID0gb3B0aW9ucy55Q2VudGVyOwoKICAgICAgaWYgKG9wdGlvbnMuZmlsdGVyTGFiZWwgIT09IHVuZGVmaW5lZCkgdGhpcy5maWx0ZXJMYWJlbCA9IG9wdGlvbnMuZmlsdGVyTGFiZWw7CiAgICAgIGlmIChvcHRpb25zLmxlZ2VuZExhYmVsICE9PSB1bmRlZmluZWQpIHRoaXMubGVnZW5kTGFiZWwgPSBvcHRpb25zLmxlZ2VuZExhYmVsOwogICAgICBpZiAob3B0aW9ucy54TGFiZWwgIT09IHVuZGVmaW5lZCkgdGhpcy54TGFiZWwgPSBvcHRpb25zLnhMYWJlbDsKICAgICAgaWYgKG9wdGlvbnMueUxhYmVsICE9PSB1bmRlZmluZWQpIHRoaXMueUxhYmVsID0gb3B0aW9ucy55TGFiZWw7CiAgICAgIGlmIChvcHRpb25zLnpMYWJlbCAhPT0gdW5kZWZpbmVkKSB0aGlzLnpMYWJlbCA9IG9wdGlvbnMuekxhYmVsOwoKICAgICAgaWYgKG9wdGlvbnMueFZhbHVlTGFiZWwgIT09IHVuZGVmaW5lZCkgdGhpcy54VmFsdWVMYWJlbCA9IG9wdGlvbnMueFZhbHVlTGFiZWw7CiAgICAgIGlmIChvcHRpb25zLnlWYWx1ZUxhYmVsICE9PSB1bmRlZmluZWQpIHRoaXMueVZhbHVlTGFiZWwgPSBvcHRpb25zLnlWYWx1ZUxhYmVsOwogICAgICBpZiAob3B0aW9ucy56VmFsdWVMYWJlbCAhPT0gdW5kZWZpbmVkKSB0aGlzLnpWYWx1ZUxhYmVsID0gb3B0aW9ucy56VmFsdWVMYWJlbDsKCiAgICAgIGlmIChvcHRpb25zLnN0eWxlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB2YXIgc3R5bGVOdW1iZXIgPSB0aGlzLl9nZXRTdHlsZU51bWJlcihvcHRpb25zLnN0eWxlKTsKICAgICAgICBpZiAoc3R5bGVOdW1iZXIgIT09IC0xKSB7CiAgICAgICAgICB0aGlzLnN0eWxlID0gc3R5bGVOdW1iZXI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChvcHRpb25zLnNob3dHcmlkICE9PSB1bmRlZmluZWQpIHRoaXMuc2hvd0dyaWQgPSBvcHRpb25zLnNob3dHcmlkOwogICAgICBpZiAob3B0aW9ucy5zaG93UGVyc3BlY3RpdmUgIT09IHVuZGVmaW5lZCkgdGhpcy5zaG93UGVyc3BlY3RpdmUgPSBvcHRpb25zLnNob3dQZXJzcGVjdGl2ZTsKICAgICAgaWYgKG9wdGlvbnMuc2hvd1NoYWRvdyAhPT0gdW5kZWZpbmVkKSB0aGlzLnNob3dTaGFkb3cgPSBvcHRpb25zLnNob3dTaGFkb3c7CiAgICAgIGlmIChvcHRpb25zLnRvb2x0aXAgIT09IHVuZGVmaW5lZCkgdGhpcy5zaG93VG9vbHRpcCA9IG9wdGlvbnMudG9vbHRpcDsKICAgICAgaWYgKG9wdGlvbnMuc2hvd0FuaW1hdGlvbkNvbnRyb2xzICE9PSB1bmRlZmluZWQpIHRoaXMuc2hvd0FuaW1hdGlvbkNvbnRyb2xzID0gb3B0aW9ucy5zaG93QW5pbWF0aW9uQ29udHJvbHM7CiAgICAgIGlmIChvcHRpb25zLmtlZXBBc3BlY3RSYXRpbyAhPT0gdW5kZWZpbmVkKSB0aGlzLmtlZXBBc3BlY3RSYXRpbyA9IG9wdGlvbnMua2VlcEFzcGVjdFJhdGlvOwogICAgICBpZiAob3B0aW9ucy52ZXJ0aWNhbFJhdGlvICE9PSB1bmRlZmluZWQpIHRoaXMudmVydGljYWxSYXRpbyA9IG9wdGlvbnMudmVydGljYWxSYXRpbzsKCiAgICAgIGlmIChvcHRpb25zLmFuaW1hdGlvbkludGVydmFsICE9PSB1bmRlZmluZWQpIHRoaXMuYW5pbWF0aW9uSW50ZXJ2YWwgPSBvcHRpb25zLmFuaW1hdGlvbkludGVydmFsOwogICAgICBpZiAob3B0aW9ucy5hbmltYXRpb25QcmVsb2FkICE9PSB1bmRlZmluZWQpIHRoaXMuYW5pbWF0aW9uUHJlbG9hZCA9IG9wdGlvbnMuYW5pbWF0aW9uUHJlbG9hZDsKICAgICAgaWYgKG9wdGlvbnMuYW5pbWF0aW9uQXV0b1N0YXJ0ICE9PSB1bmRlZmluZWQpIHRoaXMuYW5pbWF0aW9uQXV0b1N0YXJ0ID0gb3B0aW9ucy5hbmltYXRpb25BdXRvU3RhcnQ7CgogICAgICBpZiAob3B0aW9ucy54QmFyV2lkdGggIT09IHVuZGVmaW5lZCkgdGhpcy5kZWZhdWx0WEJhcldpZHRoID0gb3B0aW9ucy54QmFyV2lkdGg7CiAgICAgIGlmIChvcHRpb25zLnlCYXJXaWR0aCAhPT0gdW5kZWZpbmVkKSB0aGlzLmRlZmF1bHRZQmFyV2lkdGggPSBvcHRpb25zLnlCYXJXaWR0aDsKCiAgICAgIGlmIChvcHRpb25zLnhNaW4gIT09IHVuZGVmaW5lZCkgdGhpcy5kZWZhdWx0WE1pbiA9IG9wdGlvbnMueE1pbjsKICAgICAgaWYgKG9wdGlvbnMueFN0ZXAgIT09IHVuZGVmaW5lZCkgdGhpcy5kZWZhdWx0WFN0ZXAgPSBvcHRpb25zLnhTdGVwOwogICAgICBpZiAob3B0aW9ucy54TWF4ICE9PSB1bmRlZmluZWQpIHRoaXMuZGVmYXVsdFhNYXggPSBvcHRpb25zLnhNYXg7CiAgICAgIGlmIChvcHRpb25zLnlNaW4gIT09IHVuZGVmaW5lZCkgdGhpcy5kZWZhdWx0WU1pbiA9IG9wdGlvbnMueU1pbjsKICAgICAgaWYgKG9wdGlvbnMueVN0ZXAgIT09IHVuZGVmaW5lZCkgdGhpcy5kZWZhdWx0WVN0ZXAgPSBvcHRpb25zLnlTdGVwOwogICAgICBpZiAob3B0aW9ucy55TWF4ICE9PSB1bmRlZmluZWQpIHRoaXMuZGVmYXVsdFlNYXggPSBvcHRpb25zLnlNYXg7CiAgICAgIGlmIChvcHRpb25zLnpNaW4gIT09IHVuZGVmaW5lZCkgdGhpcy5kZWZhdWx0Wk1pbiA9IG9wdGlvbnMuek1pbjsKICAgICAgaWYgKG9wdGlvbnMuelN0ZXAgIT09IHVuZGVmaW5lZCkgdGhpcy5kZWZhdWx0WlN0ZXAgPSBvcHRpb25zLnpTdGVwOwogICAgICBpZiAob3B0aW9ucy56TWF4ICE9PSB1bmRlZmluZWQpIHRoaXMuZGVmYXVsdFpNYXggPSBvcHRpb25zLnpNYXg7CiAgICAgIGlmIChvcHRpb25zLnZhbHVlTWluICE9PSB1bmRlZmluZWQpIHRoaXMuZGVmYXVsdFZhbHVlTWluID0gb3B0aW9ucy52YWx1ZU1pbjsKICAgICAgaWYgKG9wdGlvbnMudmFsdWVNYXggIT09IHVuZGVmaW5lZCkgdGhpcy5kZWZhdWx0VmFsdWVNYXggPSBvcHRpb25zLnZhbHVlTWF4OwoKICAgICAgaWYgKG9wdGlvbnMuY2FtZXJhUG9zaXRpb24gIT09IHVuZGVmaW5lZCkgY2FtZXJhUG9zaXRpb24gPSBvcHRpb25zLmNhbWVyYVBvc2l0aW9uOwoKICAgICAgaWYgKGNhbWVyYVBvc2l0aW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLmNhbWVyYS5zZXRBcm1Sb3RhdGlvbihjYW1lcmFQb3NpdGlvbi5ob3Jpem9udGFsLCBjYW1lcmFQb3NpdGlvbi52ZXJ0aWNhbCk7CiAgICAgICAgdGhpcy5jYW1lcmEuc2V0QXJtTGVuZ3RoKGNhbWVyYVBvc2l0aW9uLmRpc3RhbmNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNhbWVyYS5zZXRBcm1Sb3RhdGlvbigxLCAwLjUpOwogICAgICAgIHRoaXMuY2FtZXJhLnNldEFybUxlbmd0aCgxLjcpOwogICAgICB9CiAgICB9CgogICAgdGhpcy5fc2V0QmFja2dyb3VuZENvbG9yKG9wdGlvbnMgJiYgb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IpOwoKICAgIHRoaXMuc2V0U2l6ZSh0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7CgogICAgLy8gcmUtbG9hZCB0aGUgZGF0YQogICAgaWYgKHRoaXMuZGF0YVRhYmxlKSB7CiAgICAgIHRoaXMuc2V0RGF0YSh0aGlzLmRhdGFUYWJsZSk7CiAgICB9CgogICAgLy8gc3RhcnQgYW5pbWF0aW9uIHdoZW4gb3B0aW9uIGlzIHRydWUKICAgIGlmICh0aGlzLmFuaW1hdGlvbkF1dG9TdGFydCAmJiB0aGlzLmRhdGFGaWx0ZXIpIHsKICAgICAgdGhpcy5hbmltYXRpb25TdGFydCgpOwogICAgfQogIH07CgogIC8qKgogICAqIFJlZHJhdyB0aGUgR3JhcGguCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuZGF0YVBvaW50cyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHRocm93ICdFcnJvcjogZ3JhcGggZGF0YSBub3QgaW5pdGlhbGl6ZWQnOwogICAgfQoKICAgIHRoaXMuX3Jlc2l6ZUNhbnZhcygpOwogICAgdGhpcy5fcmVzaXplQ2VudGVyKCk7CiAgICB0aGlzLl9yZWRyYXdTbGlkZXIoKTsKICAgIHRoaXMuX3JlZHJhd0NsZWFyKCk7CiAgICB0aGlzLl9yZWRyYXdBeGlzKCk7CgogICAgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuR1JJRCB8fCB0aGlzLnN0eWxlID09PSBHcmFwaDNkLlNUWUxFLlNVUkZBQ0UpIHsKICAgICAgdGhpcy5fcmVkcmF3RGF0YUdyaWQoKTsKICAgIH0gZWxzZSBpZiAodGhpcy5zdHlsZSA9PT0gR3JhcGgzZC5TVFlMRS5MSU5FKSB7CiAgICAgIHRoaXMuX3JlZHJhd0RhdGFMaW5lKCk7CiAgICB9IGVsc2UgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuQkFSIHx8IHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuQkFSQ09MT1IgfHwgdGhpcy5zdHlsZSA9PT0gR3JhcGgzZC5TVFlMRS5CQVJTSVpFKSB7CiAgICAgIHRoaXMuX3JlZHJhd0RhdGFCYXIoKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIHN0eWxlIGlzIERPVCwgRE9UTElORSwgRE9UQ09MT1IsIERPVFNJWkUKICAgICAgdGhpcy5fcmVkcmF3RGF0YURvdCgpOwogICAgfQoKICAgIHRoaXMuX3JlZHJhd0luZm8oKTsKICAgIHRoaXMuX3JlZHJhd0xlZ2VuZCgpOwogIH07CgogIC8qKgogICAqIENsZWFyIHRoZSBjYW52YXMgYmVmb3JlIHJlZHJhd2luZwogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9yZWRyYXdDbGVhciA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBjYW52YXMgPSB0aGlzLmZyYW1lLmNhbnZhczsKICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKCiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgfTsKCiAgLyoqCiAgICogUmVkcmF3IHRoZSBsZWdlbmQgc2hvd2luZyB0aGUgY29sb3JzCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX3JlZHJhd0xlZ2VuZCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciB5OwoKICAgIGlmICh0aGlzLnN0eWxlID09PSBHcmFwaDNkLlNUWUxFLkRPVENPTE9SIHx8IHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuRE9UU0laRSkgewoKICAgICAgdmFyIGRvdFNpemUgPSB0aGlzLmZyYW1lLmNsaWVudFdpZHRoICogMC4wMjsKCiAgICAgIHZhciB3aWR0aE1pbiwgd2lkdGhNYXg7CiAgICAgIGlmICh0aGlzLnN0eWxlID09PSBHcmFwaDNkLlNUWUxFLkRPVFNJWkUpIHsKICAgICAgICB3aWR0aE1pbiA9IGRvdFNpemUgLyAyOyAvLyBweAogICAgICAgIHdpZHRoTWF4ID0gZG90U2l6ZSAvIDIgKyBkb3RTaXplICogMjsgLy8gVG9kbzogcHV0IHRoaXMgaW4gb25lIGZ1bmN0aW9uCiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2lkdGhNaW4gPSAyMDsgLy8gcHgKICAgICAgICB3aWR0aE1heCA9IDIwOyAvLyBweAogICAgICB9CgogICAgICB2YXIgaGVpZ2h0ID0gTWF0aC5tYXgodGhpcy5mcmFtZS5jbGllbnRIZWlnaHQgKiAwLjI1LCAxMDApOwogICAgICB2YXIgdG9wID0gdGhpcy5tYXJnaW47CiAgICAgIHZhciByaWdodCA9IHRoaXMuZnJhbWUuY2xpZW50V2lkdGggLSB0aGlzLm1hcmdpbjsKICAgICAgdmFyIGxlZnQgPSByaWdodCAtIHdpZHRoTWF4OwogICAgICB2YXIgYm90dG9tID0gdG9wICsgaGVpZ2h0OwogICAgfQoKICAgIHZhciBjYW52YXMgPSB0aGlzLmZyYW1lLmNhbnZhczsKICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgIGN0eC5saW5lV2lkdGggPSAxOwogICAgY3R4LmZvbnQgPSAnMTRweCBhcmlhbCc7IC8vIFRPRE86IHB1dCBpbiBvcHRpb25zCgogICAgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuRE9UQ09MT1IpIHsKICAgICAgLy8gZHJhdyB0aGUgY29sb3IgYmFyCiAgICAgIHZhciB5bWluID0gMDsKICAgICAgdmFyIHltYXggPSBoZWlnaHQ7IC8vIFRvZG86IG1ha2UgaGVpZ2h0IGN1c3RvbWl6YWJsZQogICAgICBmb3IgKHkgPSB5bWluOyB5IDwgeW1heDsgeSsrKSB7CiAgICAgICAgdmFyIGYgPSAoeSAtIHltaW4pIC8gKHltYXggLSB5bWluKTsKCiAgICAgICAgLy92YXIgd2lkdGggPSAoZG90U2l6ZSAvIDIgKyAoMS1mKSAqIGRvdFNpemUgKiAyKTsgLy8gVG9kbzogcHV0IHRoaXMgaW4gb25lIGZ1bmN0aW9uCiAgICAgICAgdmFyIGh1ZSA9IGYgKiAyNDA7CiAgICAgICAgdmFyIGNvbG9yID0gdGhpcy5faHN2MnJnYihodWUsIDEsIDEpOwoKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyhsZWZ0LCB0b3AgKyB5KTsKICAgICAgICBjdHgubGluZVRvKHJpZ2h0LCB0b3AgKyB5KTsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgIH0KCiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMuY29sb3JBeGlzOwogICAgICBjdHguc3Ryb2tlUmVjdChsZWZ0LCB0b3AsIHdpZHRoTWF4LCBoZWlnaHQpOwogICAgfQoKICAgIGlmICh0aGlzLnN0eWxlID09PSBHcmFwaDNkLlNUWUxFLkRPVFNJWkUpIHsKICAgICAgLy8gZHJhdyBib3JkZXIgYXJvdW5kIGNvbG9yIGJhcgogICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yQXhpczsKICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29sb3JEb3Q7CiAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgY3R4Lm1vdmVUbyhsZWZ0LCB0b3ApOwogICAgICBjdHgubGluZVRvKHJpZ2h0LCB0b3ApOwogICAgICBjdHgubGluZVRvKHJpZ2h0IC0gd2lkdGhNYXggKyB3aWR0aE1pbiwgYm90dG9tKTsKICAgICAgY3R4LmxpbmVUbyhsZWZ0LCBib3R0b20pOwogICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgIGN0eC5maWxsKCk7CiAgICAgIGN0eC5zdHJva2UoKTsKICAgIH0KCiAgICBpZiAodGhpcy5zdHlsZSA9PT0gR3JhcGgzZC5TVFlMRS5ET1RDT0xPUiB8fCB0aGlzLnN0eWxlID09PSBHcmFwaDNkLlNUWUxFLkRPVFNJWkUpIHsKICAgICAgLy8gcHJpbnQgdmFsdWVzIGFsb25nIHRoZSBjb2xvciBiYXIKICAgICAgdmFyIGdyaWRMaW5lTGVuID0gNTsgLy8gcHgKICAgICAgdmFyIHN0ZXAgPSBuZXcgU3RlcE51bWJlcih0aGlzLnZhbHVlTWluLCB0aGlzLnZhbHVlTWF4LCAodGhpcy52YWx1ZU1heCAtIHRoaXMudmFsdWVNaW4pIC8gNSwgdHJ1ZSk7CiAgICAgIHN0ZXAuc3RhcnQoKTsKICAgICAgaWYgKHN0ZXAuZ2V0Q3VycmVudCgpIDwgdGhpcy52YWx1ZU1pbikgewogICAgICAgIHN0ZXAubmV4dCgpOwogICAgICB9CiAgICAgIHdoaWxlICghc3RlcC5lbmQoKSkgewogICAgICAgIHkgPSBib3R0b20gLSAoc3RlcC5nZXRDdXJyZW50KCkgLSB0aGlzLnZhbHVlTWluKSAvICh0aGlzLnZhbHVlTWF4IC0gdGhpcy52YWx1ZU1pbikgKiBoZWlnaHQ7CgogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHgubW92ZVRvKGxlZnQgLSBncmlkTGluZUxlbiwgeSk7CiAgICAgICAgY3R4LmxpbmVUbyhsZWZ0LCB5KTsKICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgIGN0eC50ZXh0QWxpZ24gPSAncmlnaHQnOwogICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsKICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5jb2xvckF4aXM7CiAgICAgICAgY3R4LmZpbGxUZXh0KHN0ZXAuZ2V0Q3VycmVudCgpLCBsZWZ0IC0gMiAqIGdyaWRMaW5lTGVuLCB5KTsKCiAgICAgICAgc3RlcC5uZXh0KCk7CiAgICAgIH0KCiAgICAgIGN0eC50ZXh0QWxpZ24gPSAncmlnaHQnOwogICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ3RvcCc7CiAgICAgIHZhciBsYWJlbCA9IHRoaXMubGVnZW5kTGFiZWw7CiAgICAgIGN0eC5maWxsVGV4dChsYWJlbCwgcmlnaHQsIGJvdHRvbSArIHRoaXMubWFyZ2luKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBSZWRyYXcgdGhlIGZpbHRlcgogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9yZWRyYXdGaWx0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmZyYW1lLmZpbHRlci5pbm5lckhUTUwgPSAnJzsKCiAgICBpZiAodGhpcy5kYXRhRmlsdGVyKSB7CiAgICAgIHZhciBvcHRpb25zID0gewogICAgICAgICd2aXNpYmxlJzogdGhpcy5zaG93QW5pbWF0aW9uQ29udHJvbHMKICAgICAgfTsKICAgICAgdmFyIHNsaWRlciA9IG5ldyBTbGlkZXIodGhpcy5mcmFtZS5maWx0ZXIsIG9wdGlvbnMpOwogICAgICB0aGlzLmZyYW1lLmZpbHRlci5zbGlkZXIgPSBzbGlkZXI7CgogICAgICAvLyBUT0RPOiBjc3MgaGVyZSBpcyBub3QgbmljZSBoZXJlLi4uCiAgICAgIHRoaXMuZnJhbWUuZmlsdGVyLnN0eWxlLnBhZGRpbmcgPSAnMTBweCc7CiAgICAgIC8vdGhpcy5mcmFtZS5maWx0ZXIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNFRkVGRUYnOwoKICAgICAgc2xpZGVyLnNldFZhbHVlcyh0aGlzLmRhdGFGaWx0ZXIudmFsdWVzKTsKICAgICAgc2xpZGVyLnNldFBsYXlJbnRlcnZhbCh0aGlzLmFuaW1hdGlvbkludGVydmFsKTsKCiAgICAgIC8vIGNyZWF0ZSBhbiBldmVudCBoYW5kbGVyCiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBvbmNoYW5nZSA9IGZ1bmN0aW9uIG9uY2hhbmdlKCkgewogICAgICAgIHZhciBpbmRleCA9IHNsaWRlci5nZXRJbmRleCgpOwoKICAgICAgICBtZS5kYXRhRmlsdGVyLnNlbGVjdFZhbHVlKGluZGV4KTsKICAgICAgICBtZS5kYXRhUG9pbnRzID0gbWUuZGF0YUZpbHRlci5fZ2V0RGF0YVBvaW50cygpOwoKICAgICAgICBtZS5yZWRyYXcoKTsKICAgICAgfTsKICAgICAgc2xpZGVyLnNldE9uQ2hhbmdlQ2FsbGJhY2sob25jaGFuZ2UpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5mcmFtZS5maWx0ZXIuc2xpZGVyID0gdW5kZWZpbmVkOwogICAgfQogIH07CgogIC8qKgogICAqIFJlZHJhdyB0aGUgc2xpZGVyCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX3JlZHJhd1NsaWRlciA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmZyYW1lLmZpbHRlci5zbGlkZXIgIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLmZyYW1lLmZpbHRlci5zbGlkZXIucmVkcmF3KCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmVkcmF3IGNvbW1vbiBpbmZvcm1hdGlvbgogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9yZWRyYXdJbmZvID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuZGF0YUZpbHRlcikgewogICAgICB2YXIgY2FudmFzID0gdGhpcy5mcmFtZS5jYW52YXM7CiAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKCiAgICAgIGN0eC5mb250ID0gJzE0cHggYXJpYWwnOyAvLyBUT0RPOiBwdXQgaW4gb3B0aW9ucwogICAgICBjdHgubGluZVN0eWxlID0gJ2dyYXknOwogICAgICBjdHguZmlsbFN0eWxlID0gJ2dyYXknOwogICAgICBjdHgudGV4dEFsaWduID0gJ2xlZnQnOwogICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ3RvcCc7CgogICAgICB2YXIgeCA9IHRoaXMubWFyZ2luOwogICAgICB2YXIgeSA9IHRoaXMubWFyZ2luOwogICAgICBjdHguZmlsbFRleHQodGhpcy5kYXRhRmlsdGVyLmdldExhYmVsKCkgKyAnOiAnICsgdGhpcy5kYXRhRmlsdGVyLmdldFNlbGVjdGVkVmFsdWUoKSwgeCwgeSk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmVkcmF3IHRoZSBheGlzCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX3JlZHJhd0F4aXMgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY2FudmFzID0gdGhpcy5mcmFtZS5jYW52YXMsCiAgICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyksCiAgICAgICAgZnJvbSwKICAgICAgICB0bywKICAgICAgICBzdGVwLAogICAgICAgIHByZXR0eVN0ZXAsCiAgICAgICAgdGV4dCwKICAgICAgICB4VGV4dCwKICAgICAgICB5VGV4dCwKICAgICAgICB6VGV4dCwKICAgICAgICBvZmZzZXQsCiAgICAgICAgeE9mZnNldCwKICAgICAgICB5T2Zmc2V0LAogICAgICAgIHhNaW4yZCwKICAgICAgICB4TWF4MmQ7CgogICAgLy8gVE9ETzogZ2V0IHRoZSBhY3R1YWwgcmVuZGVyZWQgc3R5bGUgb2YgdGhlIGNvbnRhaW5lckVsZW1lbnQKICAgIC8vY3R4LmZvbnQgPSB0aGlzLmNvbnRhaW5lckVsZW1lbnQuc3R5bGUuZm9udDsKICAgIGN0eC5mb250ID0gMjQgLyB0aGlzLmNhbWVyYS5nZXRBcm1MZW5ndGgoKSArICdweCBhcmlhbCc7CgogICAgLy8gY2FsY3VsYXRlIHRoZSBsZW5ndGggZm9yIHRoZSBzaG9ydCBncmlkIGxpbmVzCiAgICB2YXIgZ3JpZExlblggPSAwLjAyNSAvIHRoaXMuc2NhbGUueDsKICAgIHZhciBncmlkTGVuWSA9IDAuMDI1IC8gdGhpcy5zY2FsZS55OwogICAgdmFyIHRleHRNYXJnaW4gPSA1IC8gdGhpcy5jYW1lcmEuZ2V0QXJtTGVuZ3RoKCk7IC8vIHB4CiAgICB2YXIgYXJtQW5nbGUgPSB0aGlzLmNhbWVyYS5nZXRBcm1Sb3RhdGlvbigpLmhvcml6b250YWw7CgogICAgLy8gZHJhdyB4LWdyaWQgbGluZXMKICAgIGN0eC5saW5lV2lkdGggPSAxOwogICAgcHJldHR5U3RlcCA9IHRoaXMuZGVmYXVsdFhTdGVwID09PSB1bmRlZmluZWQ7CiAgICBzdGVwID0gbmV3IFN0ZXBOdW1iZXIodGhpcy54TWluLCB0aGlzLnhNYXgsIHRoaXMueFN0ZXAsIHByZXR0eVN0ZXApOwogICAgc3RlcC5zdGFydCgpOwogICAgaWYgKHN0ZXAuZ2V0Q3VycmVudCgpIDwgdGhpcy54TWluKSB7CiAgICAgIHN0ZXAubmV4dCgpOwogICAgfQogICAgd2hpbGUgKCFzdGVwLmVuZCgpKSB7CiAgICAgIHZhciB4ID0gc3RlcC5nZXRDdXJyZW50KCk7CgogICAgICBpZiAodGhpcy5zaG93R3JpZCkgewogICAgICAgIGZyb20gPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHgsIHRoaXMueU1pbiwgdGhpcy56TWluKSk7CiAgICAgICAgdG8gPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHgsIHRoaXMueU1heCwgdGhpcy56TWluKSk7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5jb2xvckdyaWQ7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5tb3ZlVG8oZnJvbS54LCBmcm9tLnkpOwogICAgICAgIGN0eC5saW5lVG8odG8ueCwgdG8ueSk7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIGZyb20gPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHgsIHRoaXMueU1pbiwgdGhpcy56TWluKSk7CiAgICAgICAgdG8gPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHgsIHRoaXMueU1pbiArIGdyaWRMZW5YLCB0aGlzLnpNaW4pKTsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yQXhpczsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyhmcm9tLngsIGZyb20ueSk7CiAgICAgICAgY3R4LmxpbmVUbyh0by54LCB0by55KTsKICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgIGZyb20gPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHgsIHRoaXMueU1heCwgdGhpcy56TWluKSk7CiAgICAgICAgdG8gPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHgsIHRoaXMueU1heCAtIGdyaWRMZW5YLCB0aGlzLnpNaW4pKTsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yQXhpczsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyhmcm9tLngsIGZyb20ueSk7CiAgICAgICAgY3R4LmxpbmVUbyh0by54LCB0by55KTsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgIH0KCiAgICAgIHlUZXh0ID0gTWF0aC5jb3MoYXJtQW5nbGUpID4gMCA/IHRoaXMueU1pbiA6IHRoaXMueU1heDsKICAgICAgdGV4dCA9IHRoaXMuX2NvbnZlcnQzRHRvMkQobmV3IFBvaW50M2QoeCwgeVRleHQsIHRoaXMuek1pbikpOwogICAgICBpZiAoTWF0aC5jb3MoYXJtQW5nbGUgKiAyKSA+IDApIHsKICAgICAgICBjdHgudGV4dEFsaWduID0gJ2NlbnRlcic7CiAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICd0b3AnOwogICAgICAgIHRleHQueSArPSB0ZXh0TWFyZ2luOwogICAgICB9IGVsc2UgaWYgKE1hdGguc2luKGFybUFuZ2xlICogMikgPCAwKSB7CiAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdyaWdodCc7CiAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOwogICAgICB9IGVsc2UgewogICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnbGVmdCc7CiAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOwogICAgICB9CiAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvbG9yQXhpczsKICAgICAgY3R4LmZpbGxUZXh0KCcgICcgKyB0aGlzLnhWYWx1ZUxhYmVsKHN0ZXAuZ2V0Q3VycmVudCgpKSArICcgICcsIHRleHQueCwgdGV4dC55KTsKCiAgICAgIHN0ZXAubmV4dCgpOwogICAgfQoKICAgIC8vIGRyYXcgeS1ncmlkIGxpbmVzCiAgICBjdHgubGluZVdpZHRoID0gMTsKICAgIHByZXR0eVN0ZXAgPSB0aGlzLmRlZmF1bHRZU3RlcCA9PT0gdW5kZWZpbmVkOwogICAgc3RlcCA9IG5ldyBTdGVwTnVtYmVyKHRoaXMueU1pbiwgdGhpcy55TWF4LCB0aGlzLnlTdGVwLCBwcmV0dHlTdGVwKTsKICAgIHN0ZXAuc3RhcnQoKTsKICAgIGlmIChzdGVwLmdldEN1cnJlbnQoKSA8IHRoaXMueU1pbikgewogICAgICBzdGVwLm5leHQoKTsKICAgIH0KICAgIHdoaWxlICghc3RlcC5lbmQoKSkgewogICAgICBpZiAodGhpcy5zaG93R3JpZCkgewogICAgICAgIGZyb20gPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHRoaXMueE1pbiwgc3RlcC5nZXRDdXJyZW50KCksIHRoaXMuek1pbikpOwogICAgICAgIHRvID0gdGhpcy5fY29udmVydDNEdG8yRChuZXcgUG9pbnQzZCh0aGlzLnhNYXgsIHN0ZXAuZ2V0Q3VycmVudCgpLCB0aGlzLnpNaW4pKTsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yR3JpZDsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyhmcm9tLngsIGZyb20ueSk7CiAgICAgICAgY3R4LmxpbmVUbyh0by54LCB0by55KTsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZnJvbSA9IHRoaXMuX2NvbnZlcnQzRHRvMkQobmV3IFBvaW50M2QodGhpcy54TWluLCBzdGVwLmdldEN1cnJlbnQoKSwgdGhpcy56TWluKSk7CiAgICAgICAgdG8gPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHRoaXMueE1pbiArIGdyaWRMZW5ZLCBzdGVwLmdldEN1cnJlbnQoKSwgdGhpcy56TWluKSk7CiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5jb2xvckF4aXM7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5tb3ZlVG8oZnJvbS54LCBmcm9tLnkpOwogICAgICAgIGN0eC5saW5lVG8odG8ueCwgdG8ueSk7CiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICBmcm9tID0gdGhpcy5fY29udmVydDNEdG8yRChuZXcgUG9pbnQzZCh0aGlzLnhNYXgsIHN0ZXAuZ2V0Q3VycmVudCgpLCB0aGlzLnpNaW4pKTsKICAgICAgICB0byA9IHRoaXMuX2NvbnZlcnQzRHRvMkQobmV3IFBvaW50M2QodGhpcy54TWF4IC0gZ3JpZExlblksIHN0ZXAuZ2V0Q3VycmVudCgpLCB0aGlzLnpNaW4pKTsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yQXhpczsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyhmcm9tLngsIGZyb20ueSk7CiAgICAgICAgY3R4LmxpbmVUbyh0by54LCB0by55KTsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgIH0KCiAgICAgIHhUZXh0ID0gTWF0aC5zaW4oYXJtQW5nbGUpID4gMCA/IHRoaXMueE1pbiA6IHRoaXMueE1heDsKICAgICAgdGV4dCA9IHRoaXMuX2NvbnZlcnQzRHRvMkQobmV3IFBvaW50M2QoeFRleHQsIHN0ZXAuZ2V0Q3VycmVudCgpLCB0aGlzLnpNaW4pKTsKICAgICAgaWYgKE1hdGguY29zKGFybUFuZ2xlICogMikgPCAwKSB7CiAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAndG9wJzsKICAgICAgICB0ZXh0LnkgKz0gdGV4dE1hcmdpbjsKICAgICAgfSBlbHNlIGlmIChNYXRoLnNpbihhcm1BbmdsZSAqIDIpID4gMCkgewogICAgICAgIGN0eC50ZXh0QWxpZ24gPSAncmlnaHQnOwogICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBjdHgudGV4dEFsaWduID0gJ2xlZnQnOwogICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsKICAgICAgfQogICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5jb2xvckF4aXM7CiAgICAgIGN0eC5maWxsVGV4dCgnICAnICsgdGhpcy55VmFsdWVMYWJlbChzdGVwLmdldEN1cnJlbnQoKSkgKyAnICAnLCB0ZXh0LngsIHRleHQueSk7CgogICAgICBzdGVwLm5leHQoKTsKICAgIH0KCiAgICAvLyBkcmF3IHotZ3JpZCBsaW5lcyBhbmQgYXhpcwogICAgY3R4LmxpbmVXaWR0aCA9IDE7CiAgICBwcmV0dHlTdGVwID0gdGhpcy5kZWZhdWx0WlN0ZXAgPT09IHVuZGVmaW5lZDsKICAgIHN0ZXAgPSBuZXcgU3RlcE51bWJlcih0aGlzLnpNaW4sIHRoaXMuek1heCwgdGhpcy56U3RlcCwgcHJldHR5U3RlcCk7CiAgICBzdGVwLnN0YXJ0KCk7CiAgICBpZiAoc3RlcC5nZXRDdXJyZW50KCkgPCB0aGlzLnpNaW4pIHsKICAgICAgc3RlcC5uZXh0KCk7CiAgICB9CiAgICB4VGV4dCA9IE1hdGguY29zKGFybUFuZ2xlKSA+IDAgPyB0aGlzLnhNaW4gOiB0aGlzLnhNYXg7CiAgICB5VGV4dCA9IE1hdGguc2luKGFybUFuZ2xlKSA8IDAgPyB0aGlzLnlNaW4gOiB0aGlzLnlNYXg7CiAgICB3aGlsZSAoIXN0ZXAuZW5kKCkpIHsKICAgICAgLy8gVE9ETzogbWFrZSB6LWdyaWQgbGluZXMgcmVhbGx5IDNkPwogICAgICBmcm9tID0gdGhpcy5fY29udmVydDNEdG8yRChuZXcgUG9pbnQzZCh4VGV4dCwgeVRleHQsIHN0ZXAuZ2V0Q3VycmVudCgpKSk7CiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMuY29sb3JBeGlzOwogICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgIGN0eC5tb3ZlVG8oZnJvbS54LCBmcm9tLnkpOwogICAgICBjdHgubGluZVRvKGZyb20ueCAtIHRleHRNYXJnaW4sIGZyb20ueSk7CiAgICAgIGN0eC5zdHJva2UoKTsKCiAgICAgIGN0eC50ZXh0QWxpZ24gPSAncmlnaHQnOwogICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7CiAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvbG9yQXhpczsKICAgICAgY3R4LmZpbGxUZXh0KHRoaXMuelZhbHVlTGFiZWwoc3RlcC5nZXRDdXJyZW50KCkpICsgJyAnLCBmcm9tLnggLSA1LCBmcm9tLnkpOwoKICAgICAgc3RlcC5uZXh0KCk7CiAgICB9CiAgICBjdHgubGluZVdpZHRoID0gMTsKICAgIGZyb20gPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHhUZXh0LCB5VGV4dCwgdGhpcy56TWluKSk7CiAgICB0byA9IHRoaXMuX2NvbnZlcnQzRHRvMkQobmV3IFBvaW50M2QoeFRleHQsIHlUZXh0LCB0aGlzLnpNYXgpKTsKICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMuY29sb3JBeGlzOwogICAgY3R4LmJlZ2luUGF0aCgpOwogICAgY3R4Lm1vdmVUbyhmcm9tLngsIGZyb20ueSk7CiAgICBjdHgubGluZVRvKHRvLngsIHRvLnkpOwogICAgY3R4LnN0cm9rZSgpOwoKICAgIC8vIGRyYXcgeC1heGlzCiAgICBjdHgubGluZVdpZHRoID0gMTsKICAgIC8vIGxpbmUgYXQgeU1pbgogICAgeE1pbjJkID0gdGhpcy5fY29udmVydDNEdG8yRChuZXcgUG9pbnQzZCh0aGlzLnhNaW4sIHRoaXMueU1pbiwgdGhpcy56TWluKSk7CiAgICB4TWF4MmQgPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHRoaXMueE1heCwgdGhpcy55TWluLCB0aGlzLnpNaW4pKTsKICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMuY29sb3JBeGlzOwogICAgY3R4LmJlZ2luUGF0aCgpOwogICAgY3R4Lm1vdmVUbyh4TWluMmQueCwgeE1pbjJkLnkpOwogICAgY3R4LmxpbmVUbyh4TWF4MmQueCwgeE1heDJkLnkpOwogICAgY3R4LnN0cm9rZSgpOwogICAgLy8gbGluZSBhdCB5bWF4CiAgICB4TWluMmQgPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHRoaXMueE1pbiwgdGhpcy55TWF4LCB0aGlzLnpNaW4pKTsKICAgIHhNYXgyZCA9IHRoaXMuX2NvbnZlcnQzRHRvMkQobmV3IFBvaW50M2QodGhpcy54TWF4LCB0aGlzLnlNYXgsIHRoaXMuek1pbikpOwogICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5jb2xvckF4aXM7CiAgICBjdHguYmVnaW5QYXRoKCk7CiAgICBjdHgubW92ZVRvKHhNaW4yZC54LCB4TWluMmQueSk7CiAgICBjdHgubGluZVRvKHhNYXgyZC54LCB4TWF4MmQueSk7CiAgICBjdHguc3Ryb2tlKCk7CgogICAgLy8gZHJhdyB5LWF4aXMKICAgIGN0eC5saW5lV2lkdGggPSAxOwogICAgLy8gbGluZSBhdCB4TWluCiAgICBmcm9tID0gdGhpcy5fY29udmVydDNEdG8yRChuZXcgUG9pbnQzZCh0aGlzLnhNaW4sIHRoaXMueU1pbiwgdGhpcy56TWluKSk7CiAgICB0byA9IHRoaXMuX2NvbnZlcnQzRHRvMkQobmV3IFBvaW50M2QodGhpcy54TWluLCB0aGlzLnlNYXgsIHRoaXMuek1pbikpOwogICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5jb2xvckF4aXM7CiAgICBjdHguYmVnaW5QYXRoKCk7CiAgICBjdHgubW92ZVRvKGZyb20ueCwgZnJvbS55KTsKICAgIGN0eC5saW5lVG8odG8ueCwgdG8ueSk7CiAgICBjdHguc3Ryb2tlKCk7CiAgICAvLyBsaW5lIGF0IHhNYXgKICAgIGZyb20gPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHRoaXMueE1heCwgdGhpcy55TWluLCB0aGlzLnpNaW4pKTsKICAgIHRvID0gdGhpcy5fY29udmVydDNEdG8yRChuZXcgUG9pbnQzZCh0aGlzLnhNYXgsIHRoaXMueU1heCwgdGhpcy56TWluKSk7CiAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yQXhpczsKICAgIGN0eC5iZWdpblBhdGgoKTsKICAgIGN0eC5tb3ZlVG8oZnJvbS54LCBmcm9tLnkpOwogICAgY3R4LmxpbmVUbyh0by54LCB0by55KTsKICAgIGN0eC5zdHJva2UoKTsKCiAgICAvLyBkcmF3IHgtbGFiZWwKICAgIHZhciB4TGFiZWwgPSB0aGlzLnhMYWJlbDsKICAgIGlmICh4TGFiZWwubGVuZ3RoID4gMCkgewogICAgICB5T2Zmc2V0ID0gMC4xIC8gdGhpcy5zY2FsZS55OwogICAgICB4VGV4dCA9ICh0aGlzLnhNaW4gKyB0aGlzLnhNYXgpIC8gMjsKICAgICAgeVRleHQgPSBNYXRoLmNvcyhhcm1BbmdsZSkgPiAwID8gdGhpcy55TWluIC0geU9mZnNldCA6IHRoaXMueU1heCArIHlPZmZzZXQ7CiAgICAgIHRleHQgPSB0aGlzLl9jb252ZXJ0M0R0bzJEKG5ldyBQb2ludDNkKHhUZXh0LCB5VGV4dCwgdGhpcy56TWluKSk7CiAgICAgIGlmIChNYXRoLmNvcyhhcm1BbmdsZSAqIDIpID4gMCkgewogICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ3RvcCc7CiAgICAgIH0gZWxzZSBpZiAoTWF0aC5zaW4oYXJtQW5nbGUgKiAyKSA8IDApIHsKICAgICAgICBjdHgudGV4dEFsaWduID0gJ3JpZ2h0JzsKICAgICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdsZWZ0JzsKICAgICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7CiAgICAgIH0KICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29sb3JBeGlzOwogICAgICBjdHguZmlsbFRleHQoeExhYmVsLCB0ZXh0LngsIHRleHQueSk7CiAgICB9CgogICAgLy8gZHJhdyB5LWxhYmVsCiAgICB2YXIgeUxhYmVsID0gdGhpcy55TGFiZWw7CiAgICBpZiAoeUxhYmVsLmxlbmd0aCA+IDApIHsKICAgICAgeE9mZnNldCA9IDAuMSAvIHRoaXMuc2NhbGUueDsKICAgICAgeFRleHQgPSBNYXRoLnNpbihhcm1BbmdsZSkgPiAwID8gdGhpcy54TWluIC0geE9mZnNldCA6IHRoaXMueE1heCArIHhPZmZzZXQ7CiAgICAgIHlUZXh0ID0gKHRoaXMueU1pbiArIHRoaXMueU1heCkgLyAyOwogICAgICB0ZXh0ID0gdGhpcy5fY29udmVydDNEdG8yRChuZXcgUG9pbnQzZCh4VGV4dCwgeVRleHQsIHRoaXMuek1pbikpOwogICAgICBpZiAoTWF0aC5jb3MoYXJtQW5nbGUgKiAyKSA8IDApIHsKICAgICAgICBjdHgudGV4dEFsaWduID0gJ2NlbnRlcic7CiAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICd0b3AnOwogICAgICB9IGVsc2UgaWYgKE1hdGguc2luKGFybUFuZ2xlICogMikgPiAwKSB7CiAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdyaWdodCc7CiAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOwogICAgICB9IGVsc2UgewogICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnbGVmdCc7CiAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOwogICAgICB9CiAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvbG9yQXhpczsKICAgICAgY3R4LmZpbGxUZXh0KHlMYWJlbCwgdGV4dC54LCB0ZXh0LnkpOwogICAgfQoKICAgIC8vIGRyYXcgei1sYWJlbAogICAgdmFyIHpMYWJlbCA9IHRoaXMuekxhYmVsOwogICAgaWYgKHpMYWJlbC5sZW5ndGggPiAwKSB7CiAgICAgIG9mZnNldCA9IDMwOyAvLyBwaXhlbHMuICAvLyBUT0RPOiByZWxhdGUgdG8gdGhlIG1heCB3aWR0aCBvZiB0aGUgdmFsdWVzIG9uIHRoZSB6IGF4aXM/CiAgICAgIHhUZXh0ID0gTWF0aC5jb3MoYXJtQW5nbGUpID4gMCA/IHRoaXMueE1pbiA6IHRoaXMueE1heDsKICAgICAgeVRleHQgPSBNYXRoLnNpbihhcm1BbmdsZSkgPCAwID8gdGhpcy55TWluIDogdGhpcy55TWF4OwogICAgICB6VGV4dCA9ICh0aGlzLnpNaW4gKyB0aGlzLnpNYXgpIC8gMjsKICAgICAgdGV4dCA9IHRoaXMuX2NvbnZlcnQzRHRvMkQobmV3IFBvaW50M2QoeFRleHQsIHlUZXh0LCB6VGV4dCkpOwogICAgICBjdHgudGV4dEFsaWduID0gJ3JpZ2h0JzsKICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOwogICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5jb2xvckF4aXM7CiAgICAgIGN0eC5maWxsVGV4dCh6TGFiZWwsIHRleHQueCAtIG9mZnNldCwgdGV4dC55KTsKICAgIH0KICB9OwoKICAvKioKICAgKiBDYWxjdWxhdGUgdGhlIGNvbG9yIGJhc2VkIG9uIHRoZSBnaXZlbiB2YWx1ZS4KICAgKiBAcGFyYW0ge051bWJlcn0gSCAgIEh1ZSwgYSB2YWx1ZSBiZSBiZXR3ZWVuIDAgYW5kIDM2MAogICAqIEBwYXJhbSB7TnVtYmVyfSBTICAgU2F0dXJhdGlvbiwgYSB2YWx1ZSBiZXR3ZWVuIDAgYW5kIDEKICAgKiBAcGFyYW0ge051bWJlcn0gViAgIFZhbHVlLCBhIHZhbHVlIGJldHdlZW4gMCBhbmQgMQogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9oc3YycmdiID0gZnVuY3Rpb24gKEgsIFMsIFYpIHsKICAgIHZhciBSLCBHLCBCLCBDLCBIaSwgWDsKCiAgICBDID0gViAqIFM7CiAgICBIaSA9IE1hdGguZmxvb3IoSCAvIDYwKTsgLy8gaGkgPSAwLDEsMiwzLDQsNQogICAgWCA9IEMgKiAoMSAtIE1hdGguYWJzKEggLyA2MCAlIDIgLSAxKSk7CgogICAgc3dpdGNoIChIaSkgewogICAgICBjYXNlIDA6CiAgICAgICAgUiA9IEM7RyA9IFg7QiA9IDA7YnJlYWs7CiAgICAgIGNhc2UgMToKICAgICAgICBSID0gWDtHID0gQztCID0gMDticmVhazsKICAgICAgY2FzZSAyOgogICAgICAgIFIgPSAwO0cgPSBDO0IgPSBYO2JyZWFrOwogICAgICBjYXNlIDM6CiAgICAgICAgUiA9IDA7RyA9IFg7QiA9IEM7YnJlYWs7CiAgICAgIGNhc2UgNDoKICAgICAgICBSID0gWDtHID0gMDtCID0gQzticmVhazsKICAgICAgY2FzZSA1OgogICAgICAgIFIgPSBDO0cgPSAwO0IgPSBYO2JyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICBSID0gMDtHID0gMDtCID0gMDticmVhazsKICAgIH0KCiAgICByZXR1cm4gJ1JHQignICsgcGFyc2VJbnQoUiAqIDI1NSkgKyAnLCcgKyBwYXJzZUludChHICogMjU1KSArICcsJyArIHBhcnNlSW50KEIgKiAyNTUpICsgJyknOwogIH07CgogIC8qKgogICAqIERyYXcgYWxsIGRhdGFwb2ludHMgYXMgYSBncmlkCiAgICogVGhpcyBmdW5jdGlvbiBjYW4gYmUgdXNlZCB3aGVuIHRoZSBzdHlsZSBpcyAnZ3JpZCcKICAgKi8KICBHcmFwaDNkLnByb3RvdHlwZS5fcmVkcmF3RGF0YUdyaWQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY2FudmFzID0gdGhpcy5mcmFtZS5jYW52YXMsCiAgICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyksCiAgICAgICAgcG9pbnQsCiAgICAgICAgcmlnaHQsCiAgICAgICAgdG9wLAogICAgICAgIGNyb3NzLAogICAgICAgIGksCiAgICAgICAgdG9wU2lkZVZpc2libGUsCiAgICAgICAgZmlsbFN0eWxlLAogICAgICAgIHN0cm9rZVN0eWxlLAogICAgICAgIGxpbmVXaWR0aCwKICAgICAgICBoLAogICAgICAgIHMsCiAgICAgICAgdiwKICAgICAgICB6QXZnOwoKICAgIGlmICh0aGlzLmRhdGFQb2ludHMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLmRhdGFQb2ludHMubGVuZ3RoIDw9IDApIHJldHVybjsgLy8gVE9ETzogdGhyb3cgZXhjZXB0aW9uPwoKICAgIC8vIGNhbGN1bGF0ZSB0aGUgdHJhbnNsYXRpb25zIGFuZCBzY3JlZW4gcG9zaXRpb24gb2YgYWxsIHBvaW50cwogICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZGF0YVBvaW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgdHJhbnMgPSB0aGlzLl9jb252ZXJ0UG9pbnRUb1RyYW5zbGF0aW9uKHRoaXMuZGF0YVBvaW50c1tpXS5wb2ludCk7CiAgICAgIHZhciBzY3JlZW4gPSB0aGlzLl9jb252ZXJ0VHJhbnNsYXRpb25Ub1NjcmVlbih0cmFucyk7CgogICAgICB0aGlzLmRhdGFQb2ludHNbaV0udHJhbnMgPSB0cmFuczsKICAgICAgdGhpcy5kYXRhUG9pbnRzW2ldLnNjcmVlbiA9IHNjcmVlbjsKCiAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgdHJhbnNsYXRpb24gb2YgdGhlIHBvaW50IGF0IHRoZSBib3R0b20gKG5lZWRlZCBmb3Igc29ydGluZykKICAgICAgdmFyIHRyYW5zQm90dG9tID0gdGhpcy5fY29udmVydFBvaW50VG9UcmFuc2xhdGlvbih0aGlzLmRhdGFQb2ludHNbaV0uYm90dG9tKTsKICAgICAgdGhpcy5kYXRhUG9pbnRzW2ldLmRpc3QgPSB0aGlzLnNob3dQZXJzcGVjdGl2ZSA/IHRyYW5zQm90dG9tLmxlbmd0aCgpIDogLXRyYW5zQm90dG9tLno7CiAgICB9CgogICAgLy8gc29ydCB0aGUgcG9pbnRzIG9uIGRlcHRoIG9mIHRoZWlyICh4LHkpIHBvc2l0aW9uIChub3Qgb24geikKICAgIHZhciBzb3J0RGVwdGggPSBmdW5jdGlvbiBzb3J0RGVwdGgoYSwgYikgewogICAgICByZXR1cm4gYi5kaXN0IC0gYS5kaXN0OwogICAgfTsKICAgIHRoaXMuZGF0YVBvaW50cy5zb3J0KHNvcnREZXB0aCk7CgogICAgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuU1VSRkFDRSkgewogICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5kYXRhUG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcG9pbnQgPSB0aGlzLmRhdGFQb2ludHNbaV07CiAgICAgICAgcmlnaHQgPSB0aGlzLmRhdGFQb2ludHNbaV0ucG9pbnRSaWdodDsKICAgICAgICB0b3AgPSB0aGlzLmRhdGFQb2ludHNbaV0ucG9pbnRUb3A7CiAgICAgICAgY3Jvc3MgPSB0aGlzLmRhdGFQb2ludHNbaV0ucG9pbnRDcm9zczsKCiAgICAgICAgaWYgKHBvaW50ICE9PSB1bmRlZmluZWQgJiYgcmlnaHQgIT09IHVuZGVmaW5lZCAmJiB0b3AgIT09IHVuZGVmaW5lZCAmJiBjcm9zcyAhPT0gdW5kZWZpbmVkKSB7CgogICAgICAgICAgaWYgKHRoaXMuc2hvd0dyYXlCb3R0b20gfHwgdGhpcy5zaG93U2hhZG93KSB7CiAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgY3Jvc3MgcHJvZHVjdCBvZiB0aGUgdHdvIHZlY3RvcnMgZnJvbSBjZW50ZXIKICAgICAgICAgICAgLy8gdG8gbGVmdCBhbmQgcmlnaHQsIGluIG9yZGVyIHRvIGtub3cgd2hldGhlciB3ZSBhcmUgbG9va2luZyBhdCB0aGUKICAgICAgICAgICAgLy8gYm90dG9tIG9yIGF0IHRoZSB0b3Agc2lkZS4gV2UgY2FuIGFsc28gdXNlIHRoZSBjcm9zcyBwcm9kdWN0CiAgICAgICAgICAgIC8vIGZvciBjYWxjdWxhdGluZyBsaWdodCBpbnRlbnNpdHkKICAgICAgICAgICAgdmFyIGFEaWZmID0gUG9pbnQzZC5zdWJ0cmFjdChjcm9zcy50cmFucywgcG9pbnQudHJhbnMpOwogICAgICAgICAgICB2YXIgYkRpZmYgPSBQb2ludDNkLnN1YnRyYWN0KHRvcC50cmFucywgcmlnaHQudHJhbnMpOwogICAgICAgICAgICB2YXIgY3Jvc3Nwcm9kdWN0ID0gUG9pbnQzZC5jcm9zc1Byb2R1Y3QoYURpZmYsIGJEaWZmKTsKICAgICAgICAgICAgdmFyIGxlbiA9IGNyb3NzcHJvZHVjdC5sZW5ndGgoKTsKICAgICAgICAgICAgLy8gRklYTUU6IHRoZXJlIGlzIGEgYnVnIHdpdGggZGV0ZXJtaW5pbmcgdGhlIHN1cmZhY2Ugc2lkZSAoc2hhZG93IG9yIGNvbG9yZWQpCgogICAgICAgICAgICB0b3BTaWRlVmlzaWJsZSA9IGNyb3NzcHJvZHVjdC56ID4gMDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRvcFNpZGVWaXNpYmxlID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodG9wU2lkZVZpc2libGUpIHsKICAgICAgICAgICAgLy8gY2FsY3VsYXRlIEh1ZSBmcm9tIHRoZSBjdXJyZW50IHZhbHVlLiBBdCB6TWluIHRoZSBodWUgaXMgMjQwLCBhdCB6TWF4IHRoZSBodWUgaXMgMAogICAgICAgICAgICB6QXZnID0gKHBvaW50LnBvaW50LnogKyByaWdodC5wb2ludC56ICsgdG9wLnBvaW50LnogKyBjcm9zcy5wb2ludC56KSAvIDQ7CiAgICAgICAgICAgIGggPSAoMSAtICh6QXZnIC0gdGhpcy56TWluKSAqIHRoaXMuc2NhbGUueiAvIHRoaXMudmVydGljYWxSYXRpbykgKiAyNDA7CiAgICAgICAgICAgIHMgPSAxOyAvLyBzYXR1cmF0aW9uCgogICAgICAgICAgICBpZiAodGhpcy5zaG93U2hhZG93KSB7CiAgICAgICAgICAgICAgdiA9IE1hdGgubWluKDEgKyBjcm9zc3Byb2R1Y3QueCAvIGxlbiAvIDIsIDEpOyAvLyB2YWx1ZS4gVE9ETzogc2NhbGUKICAgICAgICAgICAgICBmaWxsU3R5bGUgPSB0aGlzLl9oc3YycmdiKGgsIHMsIHYpOwogICAgICAgICAgICAgIHN0cm9rZVN0eWxlID0gZmlsbFN0eWxlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHYgPSAxOwogICAgICAgICAgICAgIGZpbGxTdHlsZSA9IHRoaXMuX2hzdjJyZ2IoaCwgcywgdik7CiAgICAgICAgICAgICAgc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yQXhpczsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmlsbFN0eWxlID0gJ2dyYXknOwogICAgICAgICAgICBzdHJva2VTdHlsZSA9IHRoaXMuY29sb3JBeGlzOwogICAgICAgICAgfQogICAgICAgICAgbGluZVdpZHRoID0gMC41OwoKICAgICAgICAgIGN0eC5saW5lV2lkdGggPSBsaW5lV2lkdGg7CiAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZmlsbFN0eWxlOwogICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gc3Ryb2tlU3R5bGU7CiAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICBjdHgubW92ZVRvKHBvaW50LnNjcmVlbi54LCBwb2ludC5zY3JlZW4ueSk7CiAgICAgICAgICBjdHgubGluZVRvKHJpZ2h0LnNjcmVlbi54LCByaWdodC5zY3JlZW4ueSk7CiAgICAgICAgICBjdHgubGluZVRvKGNyb3NzLnNjcmVlbi54LCBjcm9zcy5zY3JlZW4ueSk7CiAgICAgICAgICBjdHgubGluZVRvKHRvcC5zY3JlZW4ueCwgdG9wLnNjcmVlbi55KTsKICAgICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBncmlkIHN0eWxlCiAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmRhdGFQb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBwb2ludCA9IHRoaXMuZGF0YVBvaW50c1tpXTsKICAgICAgICByaWdodCA9IHRoaXMuZGF0YVBvaW50c1tpXS5wb2ludFJpZ2h0OwogICAgICAgIHRvcCA9IHRoaXMuZGF0YVBvaW50c1tpXS5wb2ludFRvcDsKCiAgICAgICAgaWYgKHBvaW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGlmICh0aGlzLnNob3dQZXJzcGVjdGl2ZSkgewogICAgICAgICAgICBsaW5lV2lkdGggPSAyIC8gLXBvaW50LnRyYW5zLno7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsaW5lV2lkdGggPSAyICogLSh0aGlzLmV5ZS56IC8gdGhpcy5jYW1lcmEuZ2V0QXJtTGVuZ3RoKCkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHBvaW50ICE9PSB1bmRlZmluZWQgJiYgcmlnaHQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgLy8gY2FsY3VsYXRlIEh1ZSBmcm9tIHRoZSBjdXJyZW50IHZhbHVlLiBBdCB6TWluIHRoZSBodWUgaXMgMjQwLCBhdCB6TWF4IHRoZSBodWUgaXMgMAogICAgICAgICAgekF2ZyA9IChwb2ludC5wb2ludC56ICsgcmlnaHQucG9pbnQueikgLyAyOwogICAgICAgICAgaCA9ICgxIC0gKHpBdmcgLSB0aGlzLnpNaW4pICogdGhpcy5zY2FsZS56IC8gdGhpcy52ZXJ0aWNhbFJhdGlvKSAqIDI0MDsKCiAgICAgICAgICBjdHgubGluZVdpZHRoID0gbGluZVdpZHRoOwogICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5faHN2MnJnYihoLCAxLCAxKTsKICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgIGN0eC5tb3ZlVG8ocG9pbnQuc2NyZWVuLngsIHBvaW50LnNjcmVlbi55KTsKICAgICAgICAgIGN0eC5saW5lVG8ocmlnaHQuc2NyZWVuLngsIHJpZ2h0LnNjcmVlbi55KTsKICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICB9CgogICAgICAgIGlmIChwb2ludCAhPT0gdW5kZWZpbmVkICYmIHRvcCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvLyBjYWxjdWxhdGUgSHVlIGZyb20gdGhlIGN1cnJlbnQgdmFsdWUuIEF0IHpNaW4gdGhlIGh1ZSBpcyAyNDAsIGF0IHpNYXggdGhlIGh1ZSBpcyAwCiAgICAgICAgICB6QXZnID0gKHBvaW50LnBvaW50LnogKyB0b3AucG9pbnQueikgLyAyOwogICAgICAgICAgaCA9ICgxIC0gKHpBdmcgLSB0aGlzLnpNaW4pICogdGhpcy5zY2FsZS56IC8gdGhpcy52ZXJ0aWNhbFJhdGlvKSAqIDI0MDsKCiAgICAgICAgICBjdHgubGluZVdpZHRoID0gbGluZVdpZHRoOwogICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5faHN2MnJnYihoLCAxLCAxKTsKICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgIGN0eC5tb3ZlVG8ocG9pbnQuc2NyZWVuLngsIHBvaW50LnNjcmVlbi55KTsKICAgICAgICAgIGN0eC5saW5lVG8odG9wLnNjcmVlbi54LCB0b3Auc2NyZWVuLnkpOwogICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIERyYXcgYWxsIGRhdGFwb2ludHMgYXMgZG90cy4KICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHdoZW4gdGhlIHN0eWxlIGlzICdkb3QnIG9yICdkb3QtbGluZScKICAgKi8KICBHcmFwaDNkLnByb3RvdHlwZS5fcmVkcmF3RGF0YURvdCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBjYW52YXMgPSB0aGlzLmZyYW1lLmNhbnZhczsKICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgIHZhciBpOwoKICAgIGlmICh0aGlzLmRhdGFQb2ludHMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLmRhdGFQb2ludHMubGVuZ3RoIDw9IDApIHJldHVybjsgLy8gVE9ETzogdGhyb3cgZXhjZXB0aW9uPwoKICAgIC8vIGNhbGN1bGF0ZSB0aGUgdHJhbnNsYXRpb25zIG9mIGFsbCBwb2ludHMKICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmRhdGFQb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHRyYW5zID0gdGhpcy5fY29udmVydFBvaW50VG9UcmFuc2xhdGlvbih0aGlzLmRhdGFQb2ludHNbaV0ucG9pbnQpOwogICAgICB2YXIgc2NyZWVuID0gdGhpcy5fY29udmVydFRyYW5zbGF0aW9uVG9TY3JlZW4odHJhbnMpOwogICAgICB0aGlzLmRhdGFQb2ludHNbaV0udHJhbnMgPSB0cmFuczsKICAgICAgdGhpcy5kYXRhUG9pbnRzW2ldLnNjcmVlbiA9IHNjcmVlbjsKCiAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgcG9pbnQgYXQgdGhlIGJvdHRvbSB0byB0aGUgY2FtZXJhCiAgICAgIHZhciB0cmFuc0JvdHRvbSA9IHRoaXMuX2NvbnZlcnRQb2ludFRvVHJhbnNsYXRpb24odGhpcy5kYXRhUG9pbnRzW2ldLmJvdHRvbSk7CiAgICAgIHRoaXMuZGF0YVBvaW50c1tpXS5kaXN0ID0gdGhpcy5zaG93UGVyc3BlY3RpdmUgPyB0cmFuc0JvdHRvbS5sZW5ndGgoKSA6IC10cmFuc0JvdHRvbS56OwogICAgfQoKICAgIC8vIG9yZGVyIHRoZSB0cmFuc2xhdGVkIHBvaW50cyBieSBkZXB0aAogICAgdmFyIHNvcnREZXB0aCA9IGZ1bmN0aW9uIHNvcnREZXB0aChhLCBiKSB7CiAgICAgIHJldHVybiBiLmRpc3QgLSBhLmRpc3Q7CiAgICB9OwogICAgdGhpcy5kYXRhUG9pbnRzLnNvcnQoc29ydERlcHRoKTsKCiAgICAvLyBkcmF3IHRoZSBkYXRhcG9pbnRzIGFzIGNvbG9yZWQgY2lyY2xlcwogICAgdmFyIGRvdFNpemUgPSB0aGlzLmZyYW1lLmNsaWVudFdpZHRoICogMC4wMjsgLy8gcHgKICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmRhdGFQb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHBvaW50ID0gdGhpcy5kYXRhUG9pbnRzW2ldOwoKICAgICAgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuRE9UTElORSkgewogICAgICAgIC8vIGRyYXcgYSB2ZXJ0aWNhbCBsaW5lIGZyb20gdGhlIGJvdHRvbSB0byB0aGUgZ3JhcGggdmFsdWUKICAgICAgICAvL3ZhciBmcm9tID0gdGhpcy5fY29udmVydDNEdG8yRChuZXcgUG9pbnQzZChwb2ludC5wb2ludC54LCBwb2ludC5wb2ludC55LCB0aGlzLnpNaW4pKTsKICAgICAgICB2YXIgZnJvbSA9IHRoaXMuX2NvbnZlcnQzRHRvMkQocG9pbnQuYm90dG9tKTsKICAgICAgICBjdHgubGluZVdpZHRoID0gMTsKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yR3JpZDsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyhmcm9tLngsIGZyb20ueSk7CiAgICAgICAgY3R4LmxpbmVUbyhwb2ludC5zY3JlZW4ueCwgcG9pbnQuc2NyZWVuLnkpOwogICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgfQoKICAgICAgLy8gY2FsY3VsYXRlIHJhZGl1cyBmb3IgdGhlIGNpcmNsZQogICAgICB2YXIgc2l6ZTsKICAgICAgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuRE9UU0laRSkgewogICAgICAgIHNpemUgPSBkb3RTaXplIC8gMiArIDIgKiBkb3RTaXplICogKHBvaW50LnBvaW50LnZhbHVlIC0gdGhpcy52YWx1ZU1pbikgLyAodGhpcy52YWx1ZU1heCAtIHRoaXMudmFsdWVNaW4pOwogICAgICB9IGVsc2UgewogICAgICAgIHNpemUgPSBkb3RTaXplOwogICAgICB9CgogICAgICB2YXIgcmFkaXVzOwogICAgICBpZiAodGhpcy5zaG93UGVyc3BlY3RpdmUpIHsKICAgICAgICByYWRpdXMgPSBzaXplIC8gLXBvaW50LnRyYW5zLno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmFkaXVzID0gc2l6ZSAqIC0odGhpcy5leWUueiAvIHRoaXMuY2FtZXJhLmdldEFybUxlbmd0aCgpKTsKICAgICAgfQogICAgICBpZiAocmFkaXVzIDwgMCkgewogICAgICAgIHJhZGl1cyA9IDA7CiAgICAgIH0KCiAgICAgIHZhciBodWUsIGNvbG9yLCBib3JkZXJDb2xvcjsKICAgICAgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuRE9UQ09MT1IpIHsKICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIGNvbG9yIGJhc2VkIG9uIHRoZSB2YWx1ZQogICAgICAgIGh1ZSA9ICgxIC0gKHBvaW50LnBvaW50LnZhbHVlIC0gdGhpcy52YWx1ZU1pbikgKiB0aGlzLnNjYWxlLnZhbHVlKSAqIDI0MDsKICAgICAgICBjb2xvciA9IHRoaXMuX2hzdjJyZ2IoaHVlLCAxLCAxKTsKICAgICAgICBib3JkZXJDb2xvciA9IHRoaXMuX2hzdjJyZ2IoaHVlLCAxLCAwLjgpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuRE9UU0laRSkgewogICAgICAgIGNvbG9yID0gdGhpcy5jb2xvckRvdDsKICAgICAgICBib3JkZXJDb2xvciA9IHRoaXMuY29sb3JEb3RCb3JkZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gY2FsY3VsYXRlIEh1ZSBmcm9tIHRoZSBjdXJyZW50IHZhbHVlLiBBdCB6TWluIHRoZSBodWUgaXMgMjQwLCBhdCB6TWF4IHRoZSBodWUgaXMgMAogICAgICAgIGh1ZSA9ICgxIC0gKHBvaW50LnBvaW50LnogLSB0aGlzLnpNaW4pICogdGhpcy5zY2FsZS56IC8gdGhpcy52ZXJ0aWNhbFJhdGlvKSAqIDI0MDsKICAgICAgICBjb2xvciA9IHRoaXMuX2hzdjJyZ2IoaHVlLCAxLCAxKTsKICAgICAgICBib3JkZXJDb2xvciA9IHRoaXMuX2hzdjJyZ2IoaHVlLCAxLCAwLjgpOwogICAgICB9CgogICAgICAvLyBkcmF3IHRoZSBjaXJjbGUKICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7CiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IGJvcmRlckNvbG9yOwogICAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7CiAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgY3R4LmFyYyhwb2ludC5zY3JlZW4ueCwgcG9pbnQuc2NyZWVuLnksIHJhZGl1cywgMCwgTWF0aC5QSSAqIDIsIHRydWUpOwogICAgICBjdHguZmlsbCgpOwogICAgICBjdHguc3Ryb2tlKCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogRHJhdyBhbGwgZGF0YXBvaW50cyBhcyBiYXJzLgogICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIHVzZWQgd2hlbiB0aGUgc3R5bGUgaXMgJ2JhcicsICdiYXItY29sb3InLCBvciAnYmFyLXNpemUnCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX3JlZHJhd0RhdGFCYXIgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgY2FudmFzID0gdGhpcy5mcmFtZS5jYW52YXM7CiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICB2YXIgaSwgaiwgc3VyZmFjZSwgY29ybmVyczsKCiAgICBpZiAodGhpcy5kYXRhUG9pbnRzID09PSB1bmRlZmluZWQgfHwgdGhpcy5kYXRhUG9pbnRzLmxlbmd0aCA8PSAwKSByZXR1cm47IC8vIFRPRE86IHRocm93IGV4Y2VwdGlvbj8KCiAgICAvLyBjYWxjdWxhdGUgdGhlIHRyYW5zbGF0aW9ucyBvZiBhbGwgcG9pbnRzCiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5kYXRhUG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciB0cmFucyA9IHRoaXMuX2NvbnZlcnRQb2ludFRvVHJhbnNsYXRpb24odGhpcy5kYXRhUG9pbnRzW2ldLnBvaW50KTsKICAgICAgdmFyIHNjcmVlbiA9IHRoaXMuX2NvbnZlcnRUcmFuc2xhdGlvblRvU2NyZWVuKHRyYW5zKTsKICAgICAgdGhpcy5kYXRhUG9pbnRzW2ldLnRyYW5zID0gdHJhbnM7CiAgICAgIHRoaXMuZGF0YVBvaW50c1tpXS5zY3JlZW4gPSBzY3JlZW47CgogICAgICAvLyBjYWxjdWxhdGUgdGhlIGRpc3RhbmNlIGZyb20gdGhlIHBvaW50IGF0IHRoZSBib3R0b20gdG8gdGhlIGNhbWVyYQogICAgICB2YXIgdHJhbnNCb3R0b20gPSB0aGlzLl9jb252ZXJ0UG9pbnRUb1RyYW5zbGF0aW9uKHRoaXMuZGF0YVBvaW50c1tpXS5ib3R0b20pOwogICAgICB0aGlzLmRhdGFQb2ludHNbaV0uZGlzdCA9IHRoaXMuc2hvd1BlcnNwZWN0aXZlID8gdHJhbnNCb3R0b20ubGVuZ3RoKCkgOiAtdHJhbnNCb3R0b20uejsKICAgIH0KCiAgICAvLyBvcmRlciB0aGUgdHJhbnNsYXRlZCBwb2ludHMgYnkgZGVwdGgKICAgIHZhciBzb3J0RGVwdGggPSBmdW5jdGlvbiBzb3J0RGVwdGgoYSwgYikgewogICAgICByZXR1cm4gYi5kaXN0IC0gYS5kaXN0OwogICAgfTsKICAgIHRoaXMuZGF0YVBvaW50cy5zb3J0KHNvcnREZXB0aCk7CgogICAgLy8gZHJhdyB0aGUgZGF0YXBvaW50cyBhcyBiYXJzCiAgICB2YXIgeFdpZHRoID0gdGhpcy54QmFyV2lkdGggLyAyOwogICAgdmFyIHlXaWR0aCA9IHRoaXMueUJhcldpZHRoIC8gMjsKICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmRhdGFQb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHBvaW50ID0gdGhpcy5kYXRhUG9pbnRzW2ldOwoKICAgICAgLy8gZGV0ZXJtaW5lIGNvbG9yCiAgICAgIHZhciBodWUsIGNvbG9yLCBib3JkZXJDb2xvcjsKICAgICAgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuQkFSQ09MT1IpIHsKICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIGNvbG9yIGJhc2VkIG9uIHRoZSB2YWx1ZQogICAgICAgIGh1ZSA9ICgxIC0gKHBvaW50LnBvaW50LnZhbHVlIC0gdGhpcy52YWx1ZU1pbikgKiB0aGlzLnNjYWxlLnZhbHVlKSAqIDI0MDsKICAgICAgICBjb2xvciA9IHRoaXMuX2hzdjJyZ2IoaHVlLCAxLCAxKTsKICAgICAgICBib3JkZXJDb2xvciA9IHRoaXMuX2hzdjJyZ2IoaHVlLCAxLCAwLjgpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuQkFSU0laRSkgewogICAgICAgIGNvbG9yID0gdGhpcy5jb2xvckRvdDsKICAgICAgICBib3JkZXJDb2xvciA9IHRoaXMuY29sb3JEb3RCb3JkZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gY2FsY3VsYXRlIEh1ZSBmcm9tIHRoZSBjdXJyZW50IHZhbHVlLiBBdCB6TWluIHRoZSBodWUgaXMgMjQwLCBhdCB6TWF4IHRoZSBodWUgaXMgMAogICAgICAgIGh1ZSA9ICgxIC0gKHBvaW50LnBvaW50LnogLSB0aGlzLnpNaW4pICogdGhpcy5zY2FsZS56IC8gdGhpcy52ZXJ0aWNhbFJhdGlvKSAqIDI0MDsKICAgICAgICBjb2xvciA9IHRoaXMuX2hzdjJyZ2IoaHVlLCAxLCAxKTsKICAgICAgICBib3JkZXJDb2xvciA9IHRoaXMuX2hzdjJyZ2IoaHVlLCAxLCAwLjgpOwogICAgICB9CgogICAgICAvLyBjYWxjdWxhdGUgc2l6ZSBmb3IgdGhlIGJhcgogICAgICBpZiAodGhpcy5zdHlsZSA9PT0gR3JhcGgzZC5TVFlMRS5CQVJTSVpFKSB7CiAgICAgICAgeFdpZHRoID0gdGhpcy54QmFyV2lkdGggLyAyICogKChwb2ludC5wb2ludC52YWx1ZSAtIHRoaXMudmFsdWVNaW4pIC8gKHRoaXMudmFsdWVNYXggLSB0aGlzLnZhbHVlTWluKSAqIDAuOCArIDAuMik7CiAgICAgICAgeVdpZHRoID0gdGhpcy55QmFyV2lkdGggLyAyICogKChwb2ludC5wb2ludC52YWx1ZSAtIHRoaXMudmFsdWVNaW4pIC8gKHRoaXMudmFsdWVNYXggLSB0aGlzLnZhbHVlTWluKSAqIDAuOCArIDAuMik7CiAgICAgIH0KCiAgICAgIC8vIGNhbGN1bGF0ZSBhbGwgY29ybmVyIHBvaW50cwogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgcG9pbnQzZCA9IHBvaW50LnBvaW50OwogICAgICB2YXIgdG9wID0gW3sgcG9pbnQ6IG5ldyBQb2ludDNkKHBvaW50M2QueCAtIHhXaWR0aCwgcG9pbnQzZC55IC0geVdpZHRoLCBwb2ludDNkLnopIH0sIHsgcG9pbnQ6IG5ldyBQb2ludDNkKHBvaW50M2QueCArIHhXaWR0aCwgcG9pbnQzZC55IC0geVdpZHRoLCBwb2ludDNkLnopIH0sIHsgcG9pbnQ6IG5ldyBQb2ludDNkKHBvaW50M2QueCArIHhXaWR0aCwgcG9pbnQzZC55ICsgeVdpZHRoLCBwb2ludDNkLnopIH0sIHsgcG9pbnQ6IG5ldyBQb2ludDNkKHBvaW50M2QueCAtIHhXaWR0aCwgcG9pbnQzZC55ICsgeVdpZHRoLCBwb2ludDNkLnopIH1dOwogICAgICB2YXIgYm90dG9tID0gW3sgcG9pbnQ6IG5ldyBQb2ludDNkKHBvaW50M2QueCAtIHhXaWR0aCwgcG9pbnQzZC55IC0geVdpZHRoLCB0aGlzLnpNaW4pIH0sIHsgcG9pbnQ6IG5ldyBQb2ludDNkKHBvaW50M2QueCArIHhXaWR0aCwgcG9pbnQzZC55IC0geVdpZHRoLCB0aGlzLnpNaW4pIH0sIHsgcG9pbnQ6IG5ldyBQb2ludDNkKHBvaW50M2QueCArIHhXaWR0aCwgcG9pbnQzZC55ICsgeVdpZHRoLCB0aGlzLnpNaW4pIH0sIHsgcG9pbnQ6IG5ldyBQb2ludDNkKHBvaW50M2QueCAtIHhXaWR0aCwgcG9pbnQzZC55ICsgeVdpZHRoLCB0aGlzLnpNaW4pIH1dOwoKICAgICAgLy8gY2FsY3VsYXRlIHNjcmVlbiBsb2NhdGlvbiBvZiB0aGUgcG9pbnRzCiAgICAgIHRvcC5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHsKICAgICAgICBvYmouc2NyZWVuID0gbWUuX2NvbnZlcnQzRHRvMkQob2JqLnBvaW50KTsKICAgICAgfSk7CiAgICAgIGJvdHRvbS5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHsKICAgICAgICBvYmouc2NyZWVuID0gbWUuX2NvbnZlcnQzRHRvMkQob2JqLnBvaW50KTsKICAgICAgfSk7CgogICAgICAvLyBjcmVhdGUgZml2ZSBzaWRlcywgY2FsY3VsYXRlIGJvdGggY29ybmVyIHBvaW50cyBhbmQgY2VudGVyIHBvaW50cwogICAgICB2YXIgc3VyZmFjZXMgPSBbeyBjb3JuZXJzOiB0b3AsIGNlbnRlcjogUG9pbnQzZC5hdmcoYm90dG9tWzBdLnBvaW50LCBib3R0b21bMl0ucG9pbnQpIH0sIHsgY29ybmVyczogW3RvcFswXSwgdG9wWzFdLCBib3R0b21bMV0sIGJvdHRvbVswXV0sIGNlbnRlcjogUG9pbnQzZC5hdmcoYm90dG9tWzFdLnBvaW50LCBib3R0b21bMF0ucG9pbnQpIH0sIHsgY29ybmVyczogW3RvcFsxXSwgdG9wWzJdLCBib3R0b21bMl0sIGJvdHRvbVsxXV0sIGNlbnRlcjogUG9pbnQzZC5hdmcoYm90dG9tWzJdLnBvaW50LCBib3R0b21bMV0ucG9pbnQpIH0sIHsgY29ybmVyczogW3RvcFsyXSwgdG9wWzNdLCBib3R0b21bM10sIGJvdHRvbVsyXV0sIGNlbnRlcjogUG9pbnQzZC5hdmcoYm90dG9tWzNdLnBvaW50LCBib3R0b21bMl0ucG9pbnQpIH0sIHsgY29ybmVyczogW3RvcFszXSwgdG9wWzBdLCBib3R0b21bMF0sIGJvdHRvbVszXV0sIGNlbnRlcjogUG9pbnQzZC5hdmcoYm90dG9tWzBdLnBvaW50LCBib3R0b21bM10ucG9pbnQpIH1dOwogICAgICBwb2ludC5zdXJmYWNlcyA9IHN1cmZhY2VzOwoKICAgICAgLy8gY2FsY3VsYXRlIHRoZSBkaXN0YW5jZSBvZiBlYWNoIG9mIHRoZSBzdXJmYWNlIGNlbnRlcnMgdG8gdGhlIGNhbWVyYQogICAgICBmb3IgKGogPSAwOyBqIDwgc3VyZmFjZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICBzdXJmYWNlID0gc3VyZmFjZXNbal07CiAgICAgICAgdmFyIHRyYW5zQ2VudGVyID0gdGhpcy5fY29udmVydFBvaW50VG9UcmFuc2xhdGlvbihzdXJmYWNlLmNlbnRlcik7CiAgICAgICAgc3VyZmFjZS5kaXN0ID0gdGhpcy5zaG93UGVyc3BlY3RpdmUgPyB0cmFuc0NlbnRlci5sZW5ndGgoKSA6IC10cmFuc0NlbnRlci56OwogICAgICAgIC8vIFRPRE86IHRoaXMgZGVwdCBjYWxjdWxhdGlvbiBkb2Vzbid0IHdvcmsgMTAwJSBvZiB0aGUgY2FzZXMgZHVlIHRvIHBlcnNwZWN0aXZlLAogICAgICAgIC8vICAgICBidXQgdGhlIGN1cnJlbnQgc29sdXRpb24gaXMgZmFzdC9zaW1wbGUgYW5kIHdvcmtzIGluIDk5LjklIG9mIGFsbCBjYXNlcwogICAgICAgIC8vICAgICB0aGUgaXNzdWUgaXMgdmlzaWJsZSBpbiBleGFtcGxlIDE0LCB3aXRoIGdyYXBoLnNldENhbWVyYVBvc2l0aW9uKHtob3Jpem9udGFsOiAyLjk3LCB2ZXJ0aWNhbDogMC41LCBkaXN0YW5jZTogMC45fSkKICAgICAgfQoKICAgICAgLy8gb3JkZXIgdGhlIHN1cmZhY2VzIGJ5IHRoZWlyICh0cmFuc2xhdGVkKSBkZXB0aAogICAgICBzdXJmYWNlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGRpZmYgPSBiLmRpc3QgLSBhLmRpc3Q7CiAgICAgICAgaWYgKGRpZmYpIHJldHVybiBkaWZmOwoKICAgICAgICAvLyBpZiBlcXVhbCBkZXB0aCwgc29ydCB0aGUgdG9wIHN1cmZhY2UgbGFzdAogICAgICAgIGlmIChhLmNvcm5lcnMgPT09IHRvcCkgcmV0dXJuIDE7CiAgICAgICAgaWYgKGIuY29ybmVycyA9PT0gdG9wKSByZXR1cm4gLTE7CgogICAgICAgIC8vIGJvdGggYXJlIGVxdWFsCiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0pOwoKICAgICAgLy8gZHJhdyB0aGUgb3JkZXJlZCBzdXJmYWNlcwogICAgICBjdHgubGluZVdpZHRoID0gMTsKICAgICAgY3R4LnN0cm9rZVN0eWxlID0gYm9yZGVyQ29sb3I7CiAgICAgIGN0eC5maWxsU3R5bGUgPSBjb2xvcjsKICAgICAgLy8gTk9URTogd2Ugc3RhcnQgYXQgaj0yIGluc3RlYWQgb2Ygaj0wIGFzIHdlIGRvbid0IG5lZWQgdG8gZHJhdyB0aGUgdHdvIHN1cmZhY2VzIGF0IHRoZSBiYWNrc2lkZQogICAgICBmb3IgKGogPSAyOyBqIDwgc3VyZmFjZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICBzdXJmYWNlID0gc3VyZmFjZXNbal07CiAgICAgICAgY29ybmVycyA9IHN1cmZhY2UuY29ybmVyczsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyhjb3JuZXJzWzNdLnNjcmVlbi54LCBjb3JuZXJzWzNdLnNjcmVlbi55KTsKICAgICAgICBjdHgubGluZVRvKGNvcm5lcnNbMF0uc2NyZWVuLngsIGNvcm5lcnNbMF0uc2NyZWVuLnkpOwogICAgICAgIGN0eC5saW5lVG8oY29ybmVyc1sxXS5zY3JlZW4ueCwgY29ybmVyc1sxXS5zY3JlZW4ueSk7CiAgICAgICAgY3R4LmxpbmVUbyhjb3JuZXJzWzJdLnNjcmVlbi54LCBjb3JuZXJzWzJdLnNjcmVlbi55KTsKICAgICAgICBjdHgubGluZVRvKGNvcm5lcnNbM10uc2NyZWVuLngsIGNvcm5lcnNbM10uc2NyZWVuLnkpOwogICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogRHJhdyBhIGxpbmUgdGhyb3VnaCBhbGwgZGF0YXBvaW50cy4KICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBiZSB1c2VkIHdoZW4gdGhlIHN0eWxlIGlzICdsaW5lJwogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9yZWRyYXdEYXRhTGluZSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBjYW52YXMgPSB0aGlzLmZyYW1lLmNhbnZhcywKICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSwKICAgICAgICBwb2ludCwKICAgICAgICBpOwoKICAgIGlmICh0aGlzLmRhdGFQb2ludHMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLmRhdGFQb2ludHMubGVuZ3RoIDw9IDApIHJldHVybjsgLy8gVE9ETzogdGhyb3cgZXhjZXB0aW9uPwoKICAgIC8vIGNhbGN1bGF0ZSB0aGUgdHJhbnNsYXRpb25zIG9mIGFsbCBwb2ludHMKICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmRhdGFQb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHRyYW5zID0gdGhpcy5fY29udmVydFBvaW50VG9UcmFuc2xhdGlvbih0aGlzLmRhdGFQb2ludHNbaV0ucG9pbnQpOwogICAgICB2YXIgc2NyZWVuID0gdGhpcy5fY29udmVydFRyYW5zbGF0aW9uVG9TY3JlZW4odHJhbnMpOwoKICAgICAgdGhpcy5kYXRhUG9pbnRzW2ldLnRyYW5zID0gdHJhbnM7CiAgICAgIHRoaXMuZGF0YVBvaW50c1tpXS5zY3JlZW4gPSBzY3JlZW47CiAgICB9CgogICAgLy8gc3RhcnQgdGhlIGxpbmUKICAgIGlmICh0aGlzLmRhdGFQb2ludHMubGVuZ3RoID4gMCkgewogICAgICBwb2ludCA9IHRoaXMuZGF0YVBvaW50c1swXTsKCiAgICAgIGN0eC5saW5lV2lkdGggPSAxOyAvLyBUT0RPOiBtYWtlIGN1c3RvbWl6YWJsZQogICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnYmx1ZSc7IC8vIFRPRE86IG1ha2UgY3VzdG9taXphYmxlCiAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgY3R4Lm1vdmVUbyhwb2ludC5zY3JlZW4ueCwgcG9pbnQuc2NyZWVuLnkpOwogICAgfQoKICAgIC8vIGRyYXcgdGhlIGRhdGFwb2ludHMgYXMgY29sb3JlZCBjaXJjbGVzCiAgICBmb3IgKGkgPSAxOyBpIDwgdGhpcy5kYXRhUG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHBvaW50ID0gdGhpcy5kYXRhUG9pbnRzW2ldOwogICAgICBjdHgubGluZVRvKHBvaW50LnNjcmVlbi54LCBwb2ludC5zY3JlZW4ueSk7CiAgICB9CgogICAgLy8gZmluaXNoIHRoZSBsaW5lCiAgICBpZiAodGhpcy5kYXRhUG9pbnRzLmxlbmd0aCA+IDApIHsKICAgICAgY3R4LnN0cm9rZSgpOwogICAgfQogIH07CgogIC8qKgogICAqIFN0YXJ0IGEgbW92aW5nIG9wZXJhdGlvbiBpbnNpZGUgdGhlIHByb3ZpZGVkIHBhcmVudCBlbGVtZW50CiAgICogQHBhcmFtIHtFdmVudH0gICAgIGV2ZW50ICAgICBUaGUgZXZlbnQgdGhhdCBvY2N1cnJlZCAocmVxdWlyZWQgZm9yCiAgICogICAgICAgICAgICAgICAgICByZXRyaWV2aW5nIHRoZSAgbW91c2UgcG9zaXRpb24pCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX29uTW91c2VEb3duID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBldmVudCA9IGV2ZW50IHx8IHdpbmRvdy5ldmVudDsKCiAgICAvLyBjaGVjayBpZiBtb3VzZSBpcyBzdGlsbCBkb3duIChtYXkgYmUgdXAgd2hlbiBmb2N1cyBpcyBsb3N0IGZvciBleGFtcGxlCiAgICAvLyBpbiBhbiBpZnJhbWUpCiAgICBpZiAodGhpcy5sZWZ0QnV0dG9uRG93bikgewogICAgICB0aGlzLl9vbk1vdXNlVXAoZXZlbnQpOwogICAgfQoKICAgIC8vIG9ubHkgcmVhY3Qgb24gbGVmdCBtb3VzZSBidXR0b24gZG93bgogICAgdGhpcy5sZWZ0QnV0dG9uRG93biA9IGV2ZW50LndoaWNoID8gZXZlbnQud2hpY2ggPT09IDEgOiBldmVudC5idXR0b24gPT09IDE7CiAgICBpZiAoIXRoaXMubGVmdEJ1dHRvbkRvd24gJiYgIXRoaXMudG91Y2hEb3duKSByZXR1cm47CgogICAgLy8gZ2V0IG1vdXNlIHBvc2l0aW9uIChkaWZmZXJlbnQgY29kZSBmb3IgSUUgYW5kIGFsbCBvdGhlciBicm93c2VycykKICAgIHRoaXMuc3RhcnRNb3VzZVggPSBnZXRNb3VzZVgoZXZlbnQpOwogICAgdGhpcy5zdGFydE1vdXNlWSA9IGdldE1vdXNlWShldmVudCk7CgogICAgdGhpcy5zdGFydFN0YXJ0ID0gbmV3IERhdGUodGhpcy5zdGFydCk7CiAgICB0aGlzLnN0YXJ0RW5kID0gbmV3IERhdGUodGhpcy5lbmQpOwogICAgdGhpcy5zdGFydEFybVJvdGF0aW9uID0gdGhpcy5jYW1lcmEuZ2V0QXJtUm90YXRpb24oKTsKCiAgICB0aGlzLmZyYW1lLnN0eWxlLmN1cnNvciA9ICdtb3ZlJzsKCiAgICAvLyBhZGQgZXZlbnQgbGlzdGVuZXJzIHRvIGhhbmRsZSBtb3ZpbmcgdGhlIGNvbnRlbnRzCiAgICAvLyB3ZSBzdG9yZSB0aGUgZnVuY3Rpb24gb25tb3VzZW1vdmUgYW5kIG9ubW91c2V1cCBpbiB0aGUgZ3JhcGgsIHNvIHdlIGNhbgogICAgLy8gcmVtb3ZlIHRoZSBldmVudGxpc3RlbmVycyBsYXRlcm9uIGluIHRoZSBmdW5jdGlvbiBtb3VzZVVwKCkKICAgIHZhciBtZSA9IHRoaXM7CiAgICB0aGlzLm9ubW91c2Vtb3ZlID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIG1lLl9vbk1vdXNlTW92ZShldmVudCk7CiAgICB9OwogICAgdGhpcy5vbm1vdXNldXAgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgbWUuX29uTW91c2VVcChldmVudCk7CiAgICB9OwogICAgdXRpbC5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LCAnbW91c2Vtb3ZlJywgbWUub25tb3VzZW1vdmUpOwogICAgdXRpbC5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LCAnbW91c2V1cCcsIG1lLm9ubW91c2V1cCk7CiAgICB1dGlsLnByZXZlbnREZWZhdWx0KGV2ZW50KTsKICB9OwoKICAvKioKICAgKiBQZXJmb3JtIG1vdmluZyBvcGVyYXRpbmcuCiAgICogVGhpcyBmdW5jdGlvbiBhY3RpdmF0ZWQgZnJvbSB3aXRoaW4gdGhlIGZ1bmNpb24gR3JhcGgubW91c2VEb3duKCkuCiAgICogQHBhcmFtIHtFdmVudH0gICBldmVudCAgV2VsbCwgZWVoaCwgdGhlIGV2ZW50CiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX29uTW91c2VNb3ZlID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBldmVudCA9IGV2ZW50IHx8IHdpbmRvdy5ldmVudDsKCiAgICAvLyBjYWxjdWxhdGUgY2hhbmdlIGluIG1vdXNlIHBvc2l0aW9uCiAgICB2YXIgZGlmZlggPSBwYXJzZUZsb2F0KGdldE1vdXNlWChldmVudCkpIC0gdGhpcy5zdGFydE1vdXNlWDsKICAgIHZhciBkaWZmWSA9IHBhcnNlRmxvYXQoZ2V0TW91c2VZKGV2ZW50KSkgLSB0aGlzLnN0YXJ0TW91c2VZOwoKICAgIHZhciBob3Jpem9udGFsTmV3ID0gdGhpcy5zdGFydEFybVJvdGF0aW9uLmhvcml6b250YWwgKyBkaWZmWCAvIDIwMDsKICAgIHZhciB2ZXJ0aWNhbE5ldyA9IHRoaXMuc3RhcnRBcm1Sb3RhdGlvbi52ZXJ0aWNhbCArIGRpZmZZIC8gMjAwOwoKICAgIHZhciBzbmFwQW5nbGUgPSA0OyAvLyBkZWdyZWVzCiAgICB2YXIgc25hcFZhbHVlID0gTWF0aC5zaW4oc25hcEFuZ2xlIC8gMzYwICogMiAqIE1hdGguUEkpOwoKICAgIC8vIHNuYXAgaG9yaXpvbnRhbGx5IHRvIG5pY2UgYW5nbGVzIGF0IDBwaSwgMC41cGksIDFwaSwgMS41cGksIGV0Yy4uLgogICAgLy8gdGhlIC0wLjAwMSBpcyB0byB0YWtlIGNhcmUgdGhhdCB0aGUgdmVydGljYWwgYXhpcyBpcyBhbHdheXMgZHJhd24gYXQgdGhlIGxlZnQgZnJvbnQgY29ybmVyCiAgICBpZiAoTWF0aC5hYnMoTWF0aC5zaW4oaG9yaXpvbnRhbE5ldykpIDwgc25hcFZhbHVlKSB7CiAgICAgIGhvcml6b250YWxOZXcgPSBNYXRoLnJvdW5kKGhvcml6b250YWxOZXcgLyBNYXRoLlBJKSAqIE1hdGguUEkgLSAwLjAwMTsKICAgIH0KICAgIGlmIChNYXRoLmFicyhNYXRoLmNvcyhob3Jpem9udGFsTmV3KSkgPCBzbmFwVmFsdWUpIHsKICAgICAgaG9yaXpvbnRhbE5ldyA9IChNYXRoLnJvdW5kKGhvcml6b250YWxOZXcgLyBNYXRoLlBJIC0gMC41KSArIDAuNSkgKiBNYXRoLlBJIC0gMC4wMDE7CiAgICB9CgogICAgLy8gc25hcCB2ZXJ0aWNhbGx5IHRvIG5pY2UgYW5nbGVzCiAgICBpZiAoTWF0aC5hYnMoTWF0aC5zaW4odmVydGljYWxOZXcpKSA8IHNuYXBWYWx1ZSkgewogICAgICB2ZXJ0aWNhbE5ldyA9IE1hdGgucm91bmQodmVydGljYWxOZXcgLyBNYXRoLlBJKSAqIE1hdGguUEk7CiAgICB9CiAgICBpZiAoTWF0aC5hYnMoTWF0aC5jb3ModmVydGljYWxOZXcpKSA8IHNuYXBWYWx1ZSkgewogICAgICB2ZXJ0aWNhbE5ldyA9IChNYXRoLnJvdW5kKHZlcnRpY2FsTmV3IC8gTWF0aC5QSSAtIDAuNSkgKyAwLjUpICogTWF0aC5QSTsKICAgIH0KCiAgICB0aGlzLmNhbWVyYS5zZXRBcm1Sb3RhdGlvbihob3Jpem9udGFsTmV3LCB2ZXJ0aWNhbE5ldyk7CiAgICB0aGlzLnJlZHJhdygpOwoKICAgIC8vIGZpcmUgYSBjYW1lcmFQb3NpdGlvbkNoYW5nZSBldmVudAogICAgdmFyIHBhcmFtZXRlcnMgPSB0aGlzLmdldENhbWVyYVBvc2l0aW9uKCk7CiAgICB0aGlzLmVtaXQoJ2NhbWVyYVBvc2l0aW9uQ2hhbmdlJywgcGFyYW1ldGVycyk7CgogICAgdXRpbC5wcmV2ZW50RGVmYXVsdChldmVudCk7CiAgfTsKCiAgLyoqCiAgICogU3RvcCBtb3Zpbmcgb3BlcmF0aW5nLgogICAqIFRoaXMgZnVuY3Rpb24gYWN0aXZhdGVkIGZyb20gd2l0aGluIHRoZSBmdW5jaW9uIEdyYXBoLm1vdXNlRG93bigpLgogICAqIEBwYXJhbSB7ZXZlbnR9ICBldmVudCAgIFRoZSBldmVudAogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9vbk1vdXNlVXAgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHRoaXMuZnJhbWUuc3R5bGUuY3Vyc29yID0gJ2F1dG8nOwogICAgdGhpcy5sZWZ0QnV0dG9uRG93biA9IGZhbHNlOwoKICAgIC8vIHJlbW92ZSBldmVudCBsaXN0ZW5lcnMgaGVyZQogICAgdXRpbC5yZW1vdmVFdmVudExpc3RlbmVyKGRvY3VtZW50LCAnbW91c2Vtb3ZlJywgdGhpcy5vbm1vdXNlbW92ZSk7CiAgICB1dGlsLnJlbW92ZUV2ZW50TGlzdGVuZXIoZG9jdW1lbnQsICdtb3VzZXVwJywgdGhpcy5vbm1vdXNldXApOwogICAgdXRpbC5wcmV2ZW50RGVmYXVsdChldmVudCk7CiAgfTsKCiAgLyoqCiAgICogQWZ0ZXIgaGF2aW5nIG1vdmVkIHRoZSBtb3VzZSwgYSB0b29sdGlwIHNob3VsZCBwb3AgdXAgd2hlbiB0aGUgbW91c2UgaXMgcmVzdGluZyBvbiBhIGRhdGEgcG9pbnQKICAgKiBAcGFyYW0ge0V2ZW50fSAgZXZlbnQgICBBIG1vdXNlIG1vdmUgZXZlbnQKICAgKi8KICBHcmFwaDNkLnByb3RvdHlwZS5fb25Ub29sdGlwID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICB2YXIgZGVsYXkgPSAzMDA7IC8vIG1zCiAgICB2YXIgYm91bmRpbmdSZWN0ID0gdGhpcy5mcmFtZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIHZhciBtb3VzZVggPSBnZXRNb3VzZVgoZXZlbnQpIC0gYm91bmRpbmdSZWN0LmxlZnQ7CiAgICB2YXIgbW91c2VZID0gZ2V0TW91c2VZKGV2ZW50KSAtIGJvdW5kaW5nUmVjdC50b3A7CgogICAgaWYgKCF0aGlzLnNob3dUb29sdGlwKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAodGhpcy50b29sdGlwVGltZW91dCkgewogICAgICBjbGVhclRpbWVvdXQodGhpcy50b29sdGlwVGltZW91dCk7CiAgICB9CgogICAgLy8gKGRlbGF5ZWQpIGRpc3BsYXkgb2YgYSB0b29sdGlwIG9ubHkgaWYgbm8gbW91c2UgYnV0dG9uIGlzIGRvd24KICAgIGlmICh0aGlzLmxlZnRCdXR0b25Eb3duKSB7CiAgICAgIHRoaXMuX2hpZGVUb29sdGlwKCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAodGhpcy50b29sdGlwICYmIHRoaXMudG9vbHRpcC5kYXRhUG9pbnQpIHsKICAgICAgLy8gdG9vbHRpcCBpcyBjdXJyZW50bHkgdmlzaWJsZQogICAgICB2YXIgZGF0YVBvaW50ID0gdGhpcy5fZGF0YVBvaW50RnJvbVhZKG1vdXNlWCwgbW91c2VZKTsKICAgICAgaWYgKGRhdGFQb2ludCAhPT0gdGhpcy50b29sdGlwLmRhdGFQb2ludCkgewogICAgICAgIC8vIGRhdGFwb2ludCBjaGFuZ2VkCiAgICAgICAgaWYgKGRhdGFQb2ludCkgewogICAgICAgICAgdGhpcy5fc2hvd1Rvb2x0aXAoZGF0YVBvaW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5faGlkZVRvb2x0aXAoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIHRvb2x0aXAgaXMgY3VycmVudGx5IG5vdCB2aXNpYmxlCiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHRoaXMudG9vbHRpcFRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBtZS50b29sdGlwVGltZW91dCA9IG51bGw7CgogICAgICAgIC8vIHNob3cgYSB0b29sdGlwIGlmIHdlIGhhdmUgYSBkYXRhIHBvaW50CiAgICAgICAgdmFyIGRhdGFQb2ludCA9IG1lLl9kYXRhUG9pbnRGcm9tWFkobW91c2VYLCBtb3VzZVkpOwogICAgICAgIGlmIChkYXRhUG9pbnQpIHsKICAgICAgICAgIG1lLl9zaG93VG9vbHRpcChkYXRhUG9pbnQpOwogICAgICAgIH0KICAgICAgfSwgZGVsYXkpOwogICAgfQogIH07CgogIC8qKgogICAqIEV2ZW50IGhhbmRsZXIgZm9yIHRvdWNoc3RhcnQgZXZlbnQgb24gbW9iaWxlIGRldmljZXMKICAgKi8KICBHcmFwaDNkLnByb3RvdHlwZS5fb25Ub3VjaFN0YXJ0ID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICB0aGlzLnRvdWNoRG93biA9IHRydWU7CgogICAgdmFyIG1lID0gdGhpczsKICAgIHRoaXMub250b3VjaG1vdmUgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgbWUuX29uVG91Y2hNb3ZlKGV2ZW50KTsKICAgIH07CiAgICB0aGlzLm9udG91Y2hlbmQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgbWUuX29uVG91Y2hFbmQoZXZlbnQpOwogICAgfTsKICAgIHV0aWwuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudCwgJ3RvdWNobW92ZScsIG1lLm9udG91Y2htb3ZlKTsKICAgIHV0aWwuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudCwgJ3RvdWNoZW5kJywgbWUub250b3VjaGVuZCk7CgogICAgdGhpcy5fb25Nb3VzZURvd24oZXZlbnQpOwogIH07CgogIC8qKgogICAqIEV2ZW50IGhhbmRsZXIgZm9yIHRvdWNobW92ZSBldmVudCBvbiBtb2JpbGUgZGV2aWNlcwogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9vblRvdWNoTW92ZSA9IGZ1bmN0aW9uIChldmVudCkgewogICAgdGhpcy5fb25Nb3VzZU1vdmUoZXZlbnQpOwogIH07CgogIC8qKgogICAqIEV2ZW50IGhhbmRsZXIgZm9yIHRvdWNoZW5kIGV2ZW50IG9uIG1vYmlsZSBkZXZpY2VzCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX29uVG91Y2hFbmQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHRoaXMudG91Y2hEb3duID0gZmFsc2U7CgogICAgdXRpbC5yZW1vdmVFdmVudExpc3RlbmVyKGRvY3VtZW50LCAndG91Y2htb3ZlJywgdGhpcy5vbnRvdWNobW92ZSk7CiAgICB1dGlsLnJlbW92ZUV2ZW50TGlzdGVuZXIoZG9jdW1lbnQsICd0b3VjaGVuZCcsIHRoaXMub250b3VjaGVuZCk7CgogICAgdGhpcy5fb25Nb3VzZVVwKGV2ZW50KTsKICB9OwoKICAvKioKICAgKiBFdmVudCBoYW5kbGVyIGZvciBtb3VzZSB3aGVlbCBldmVudCwgdXNlZCB0byB6b29tIHRoZSBncmFwaAogICAqIENvZGUgZnJvbSBodHRwOi8vYWRvbWFzLm9yZy9qYXZhc2NyaXB0LW1vdXNlLXdoZWVsLwogICAqIEBwYXJhbSB7ZXZlbnR9ICBldmVudCAgIFRoZSBldmVudAogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9vbldoZWVsID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZiAoIWV2ZW50KSAvKiBGb3IgSUUuICovCiAgICAgIGV2ZW50ID0gd2luZG93LmV2ZW50OwoKICAgIC8vIHJldHJpZXZlIGRlbHRhCiAgICB2YXIgZGVsdGEgPSAwOwogICAgaWYgKGV2ZW50LndoZWVsRGVsdGEpIHsKICAgICAgLyogSUUvT3BlcmEuICovCiAgICAgIGRlbHRhID0gZXZlbnQud2hlZWxEZWx0YSAvIDEyMDsKICAgIH0gZWxzZSBpZiAoZXZlbnQuZGV0YWlsKSB7CiAgICAgIC8qIE1vemlsbGEgY2FzZS4gKi8KICAgICAgLy8gSW4gTW96aWxsYSwgc2lnbiBvZiBkZWx0YSBpcyBkaWZmZXJlbnQgdGhhbiBpbiBJRS4KICAgICAgLy8gQWxzbywgZGVsdGEgaXMgbXVsdGlwbGUgb2YgMy4KICAgICAgZGVsdGEgPSAtZXZlbnQuZGV0YWlsIC8gMzsKICAgIH0KCiAgICAvLyBJZiBkZWx0YSBpcyBub256ZXJvLCBoYW5kbGUgaXQuCiAgICAvLyBCYXNpY2FsbHksIGRlbHRhIGlzIG5vdyBwb3NpdGl2ZSBpZiB3aGVlbCB3YXMgc2Nyb2xsZWQgdXAsCiAgICAvLyBhbmQgbmVnYXRpdmUsIGlmIHdoZWVsIHdhcyBzY3JvbGxlZCBkb3duLgogICAgaWYgKGRlbHRhKSB7CiAgICAgIHZhciBvbGRMZW5ndGggPSB0aGlzLmNhbWVyYS5nZXRBcm1MZW5ndGgoKTsKICAgICAgdmFyIG5ld0xlbmd0aCA9IG9sZExlbmd0aCAqICgxIC0gZGVsdGEgLyAxMCk7CgogICAgICB0aGlzLmNhbWVyYS5zZXRBcm1MZW5ndGgobmV3TGVuZ3RoKTsKICAgICAgdGhpcy5yZWRyYXcoKTsKCiAgICAgIHRoaXMuX2hpZGVUb29sdGlwKCk7CiAgICB9CgogICAgLy8gZmlyZSBhIGNhbWVyYVBvc2l0aW9uQ2hhbmdlIGV2ZW50CiAgICB2YXIgcGFyYW1ldGVycyA9IHRoaXMuZ2V0Q2FtZXJhUG9zaXRpb24oKTsKICAgIHRoaXMuZW1pdCgnY2FtZXJhUG9zaXRpb25DaGFuZ2UnLCBwYXJhbWV0ZXJzKTsKCiAgICAvLyBQcmV2ZW50IGRlZmF1bHQgYWN0aW9ucyBjYXVzZWQgYnkgbW91c2Ugd2hlZWwuCiAgICAvLyBUaGF0IG1pZ2h0IGJlIHVnbHksIGJ1dCB3ZSBoYW5kbGUgc2Nyb2xscyBzb21laG93CiAgICAvLyBhbnl3YXksIHNvIGRvbid0IGJvdGhlciBoZXJlLi4KICAgIHV0aWwucHJldmVudERlZmF1bHQoZXZlbnQpOwogIH07CgogIC8qKgogICAqIFRlc3Qgd2hldGhlciBhIHBvaW50IGxpZXMgaW5zaWRlIGdpdmVuIDJEIHRyaWFuZ2xlCiAgICogQHBhcmFtIHtQb2ludDJkfSBwb2ludAogICAqIEBwYXJhbSB7UG9pbnQyZFtdfSB0cmlhbmdsZQogICAqIEByZXR1cm4ge2Jvb2xlYW59IFJldHVybnMgdHJ1ZSBpZiBnaXZlbiBwb2ludCBsaWVzIGluc2lkZSBvciBvbiB0aGUgZWRnZSBvZiB0aGUgdHJpYW5nbGUKICAgKiBAcHJpdmF0ZQogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9pbnNpZGVUcmlhbmdsZSA9IGZ1bmN0aW9uIChwb2ludCwgdHJpYW5nbGUpIHsKICAgIHZhciBhID0gdHJpYW5nbGVbMF0sCiAgICAgICAgYiA9IHRyaWFuZ2xlWzFdLAogICAgICAgIGMgPSB0cmlhbmdsZVsyXTsKCiAgICBmdW5jdGlvbiBzaWduKHgpIHsKICAgICAgcmV0dXJuIHggPiAwID8gMSA6IHggPCAwID8gLTEgOiAwOwogICAgfQoKICAgIHZhciBhcyA9IHNpZ24oKGIueCAtIGEueCkgKiAocG9pbnQueSAtIGEueSkgLSAoYi55IC0gYS55KSAqIChwb2ludC54IC0gYS54KSk7CiAgICB2YXIgYnMgPSBzaWduKChjLnggLSBiLngpICogKHBvaW50LnkgLSBiLnkpIC0gKGMueSAtIGIueSkgKiAocG9pbnQueCAtIGIueCkpOwogICAgdmFyIGNzID0gc2lnbigoYS54IC0gYy54KSAqIChwb2ludC55IC0gYy55KSAtIChhLnkgLSBjLnkpICogKHBvaW50LnggLSBjLngpKTsKCiAgICAvLyBlYWNoIG9mIHRoZSB0aHJlZSBzaWducyBtdXN0IGJlIGVpdGhlciBlcXVhbCB0byBlYWNoIG90aGVyIG9yIHplcm8KICAgIHJldHVybiAoYXMgPT0gMCB8fCBicyA9PSAwIHx8IGFzID09IGJzKSAmJiAoYnMgPT0gMCB8fCBjcyA9PSAwIHx8IGJzID09IGNzKSAmJiAoYXMgPT0gMCB8fCBjcyA9PSAwIHx8IGFzID09IGNzKTsKICB9OwoKICAvKioKICAgKiBGaW5kIGEgZGF0YSBwb2ludCBjbG9zZSB0byBnaXZlbiBzY3JlZW4gcG9zaXRpb24gKHgsIHkpCiAgICogQHBhcmFtIHtOdW1iZXJ9IHgKICAgKiBAcGFyYW0ge051bWJlcn0geQogICAqIEByZXR1cm4ge09iamVjdCB8IG51bGx9IFRoZSBjbG9zZXN0IGRhdGEgcG9pbnQgb3IgbnVsbCBpZiBub3QgY2xvc2UgdG8gYW55IGRhdGEgcG9pbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9kYXRhUG9pbnRGcm9tWFkgPSBmdW5jdGlvbiAoeCwgeSkgewogICAgdmFyIGksCiAgICAgICAgZGlzdE1heCA9IDEwMCwKICAgICAgICAvLyBweAogICAgZGF0YVBvaW50ID0gbnVsbCwKICAgICAgICBjbG9zZXN0RGF0YVBvaW50ID0gbnVsbCwKICAgICAgICBjbG9zZXN0RGlzdCA9IG51bGwsCiAgICAgICAgY2VudGVyID0gbmV3IFBvaW50MmQoeCwgeSk7CgogICAgaWYgKHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuQkFSIHx8IHRoaXMuc3R5bGUgPT09IEdyYXBoM2QuU1RZTEUuQkFSQ09MT1IgfHwgdGhpcy5zdHlsZSA9PT0gR3JhcGgzZC5TVFlMRS5CQVJTSVpFKSB7CiAgICAgIC8vIHRoZSBkYXRhIHBvaW50cyBhcmUgb3JkZXJlZCBmcm9tIGZhciBhd2F5IHRvIGNsb3Nlc3QKICAgICAgZm9yIChpID0gdGhpcy5kYXRhUG9pbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgZGF0YVBvaW50ID0gdGhpcy5kYXRhUG9pbnRzW2ldOwogICAgICAgIHZhciBzdXJmYWNlcyA9IGRhdGFQb2ludC5zdXJmYWNlczsKICAgICAgICBpZiAoc3VyZmFjZXMpIHsKICAgICAgICAgIGZvciAodmFyIHMgPSBzdXJmYWNlcy5sZW5ndGggLSAxOyBzID49IDA7IHMtLSkgewogICAgICAgICAgICAvLyBzcGxpdCBlYWNoIHN1cmZhY2UgaW4gdHdvIHRyaWFuZ2xlcywgYW5kIHNlZSBpZiB0aGUgY2VudGVyIHBvaW50IGlzIGluc2lkZSBvbmUgb2YgdGhlc2UKICAgICAgICAgICAgdmFyIHN1cmZhY2UgPSBzdXJmYWNlc1tzXTsKICAgICAgICAgICAgdmFyIGNvcm5lcnMgPSBzdXJmYWNlLmNvcm5lcnM7CiAgICAgICAgICAgIHZhciB0cmlhbmdsZTEgPSBbY29ybmVyc1swXS5zY3JlZW4sIGNvcm5lcnNbMV0uc2NyZWVuLCBjb3JuZXJzWzJdLnNjcmVlbl07CiAgICAgICAgICAgIHZhciB0cmlhbmdsZTIgPSBbY29ybmVyc1syXS5zY3JlZW4sIGNvcm5lcnNbM10uc2NyZWVuLCBjb3JuZXJzWzBdLnNjcmVlbl07CiAgICAgICAgICAgIGlmICh0aGlzLl9pbnNpZGVUcmlhbmdsZShjZW50ZXIsIHRyaWFuZ2xlMSkgfHwgdGhpcy5faW5zaWRlVHJpYW5nbGUoY2VudGVyLCB0cmlhbmdsZTIpKSB7CiAgICAgICAgICAgICAgLy8gcmV0dXJuIGltbWVkaWF0ZWx5IGF0IHRoZSBmaXJzdCBoaXQKICAgICAgICAgICAgICByZXR1cm4gZGF0YVBvaW50OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBmaW5kIHRoZSBjbG9zZXN0IGRhdGEgcG9pbnQsIHVzaW5nIGRpc3RhbmNlIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHBvaW50IG9uIDJkIHNjcmVlbgogICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5kYXRhUG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZGF0YVBvaW50ID0gdGhpcy5kYXRhUG9pbnRzW2ldOwogICAgICAgIHZhciBwb2ludCA9IGRhdGFQb2ludC5zY3JlZW47CiAgICAgICAgaWYgKHBvaW50KSB7CiAgICAgICAgICB2YXIgZGlzdFggPSBNYXRoLmFicyh4IC0gcG9pbnQueCk7CiAgICAgICAgICB2YXIgZGlzdFkgPSBNYXRoLmFicyh5IC0gcG9pbnQueSk7CiAgICAgICAgICB2YXIgZGlzdCA9IE1hdGguc3FydChkaXN0WCAqIGRpc3RYICsgZGlzdFkgKiBkaXN0WSk7CgogICAgICAgICAgaWYgKChjbG9zZXN0RGlzdCA9PT0gbnVsbCB8fCBkaXN0IDwgY2xvc2VzdERpc3QpICYmIGRpc3QgPCBkaXN0TWF4KSB7CiAgICAgICAgICAgIGNsb3Nlc3REaXN0ID0gZGlzdDsKICAgICAgICAgICAgY2xvc2VzdERhdGFQb2ludCA9IGRhdGFQb2ludDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gY2xvc2VzdERhdGFQb2ludDsKICB9OwoKICAvKioKICAgKiBEaXNwbGF5IGEgdG9vbHRpcCBmb3IgZ2l2ZW4gZGF0YSBwb2ludAogICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhUG9pbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIEdyYXBoM2QucHJvdG90eXBlLl9zaG93VG9vbHRpcCA9IGZ1bmN0aW9uIChkYXRhUG9pbnQpIHsKICAgIHZhciBjb250ZW50LCBsaW5lLCBkb3Q7CgogICAgaWYgKCF0aGlzLnRvb2x0aXApIHsKICAgICAgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBjb250ZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKICAgICAgY29udGVudC5zdHlsZS5wYWRkaW5nID0gJzEwcHgnOwogICAgICBjb250ZW50LnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgIzRkNGQ0ZCc7CiAgICAgIGNvbnRlbnQuc3R5bGUuY29sb3IgPSAnIzFhMWExYSc7CiAgICAgIGNvbnRlbnQuc3R5bGUuYmFja2dyb3VuZCA9ICdyZ2JhKDI1NSwyNTUsMjU1LDAuNyknOwogICAgICBjb250ZW50LnN0eWxlLmJvcmRlclJhZGl1cyA9ICcycHgnOwogICAgICBjb250ZW50LnN0eWxlLmJveFNoYWRvdyA9ICc1cHggNXB4IDEwcHggcmdiYSgxMjgsMTI4LDEyOCwwLjUpJzsKCiAgICAgIGxpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgbGluZS5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICAgIGxpbmUuc3R5bGUuaGVpZ2h0ID0gJzQwcHgnOwogICAgICBsaW5lLnN0eWxlLndpZHRoID0gJzAnOwogICAgICBsaW5lLnN0eWxlLmJvcmRlckxlZnQgPSAnMXB4IHNvbGlkICM0ZDRkNGQnOwoKICAgICAgZG90ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGRvdC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICAgIGRvdC5zdHlsZS5oZWlnaHQgPSAnMCc7CiAgICAgIGRvdC5zdHlsZS53aWR0aCA9ICcwJzsKICAgICAgZG90LnN0eWxlLmJvcmRlciA9ICc1cHggc29saWQgIzRkNGQ0ZCc7CiAgICAgIGRvdC5zdHlsZS5ib3JkZXJSYWRpdXMgPSAnNXB4JzsKCiAgICAgIHRoaXMudG9vbHRpcCA9IHsKICAgICAgICBkYXRhUG9pbnQ6IG51bGwsCiAgICAgICAgZG9tOiB7CiAgICAgICAgICBjb250ZW50OiBjb250ZW50LAogICAgICAgICAgbGluZTogbGluZSwKICAgICAgICAgIGRvdDogZG90CiAgICAgICAgfQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgY29udGVudCA9IHRoaXMudG9vbHRpcC5kb20uY29udGVudDsKICAgICAgbGluZSA9IHRoaXMudG9vbHRpcC5kb20ubGluZTsKICAgICAgZG90ID0gdGhpcy50b29sdGlwLmRvbS5kb3Q7CiAgICB9CgogICAgdGhpcy5faGlkZVRvb2x0aXAoKTsKCiAgICB0aGlzLnRvb2x0aXAuZGF0YVBvaW50ID0gZGF0YVBvaW50OwogICAgaWYgKHR5cGVvZiB0aGlzLnNob3dUb29sdGlwID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gdGhpcy5zaG93VG9vbHRpcChkYXRhUG9pbnQucG9pbnQpOwogICAgfSBlbHNlIHsKICAgICAgY29udGVudC5pbm5lckhUTUwgPSAnPHRhYmxlPicgKyAnPHRyPjx0ZD54OjwvdGQ+PHRkPicgKyBkYXRhUG9pbnQucG9pbnQueCArICc8L3RkPjwvdHI+JyArICc8dHI+PHRkPnk6PC90ZD48dGQ+JyArIGRhdGFQb2ludC5wb2ludC55ICsgJzwvdGQ+PC90cj4nICsgJzx0cj48dGQ+ejo8L3RkPjx0ZD4nICsgZGF0YVBvaW50LnBvaW50LnogKyAnPC90ZD48L3RyPicgKyAnPC90YWJsZT4nOwogICAgfQoKICAgIGNvbnRlbnQuc3R5bGUubGVmdCA9ICcwJzsKICAgIGNvbnRlbnQuc3R5bGUudG9wID0gJzAnOwogICAgdGhpcy5mcmFtZS5hcHBlbmRDaGlsZChjb250ZW50KTsKICAgIHRoaXMuZnJhbWUuYXBwZW5kQ2hpbGQobGluZSk7CiAgICB0aGlzLmZyYW1lLmFwcGVuZENoaWxkKGRvdCk7CgogICAgLy8gY2FsY3VsYXRlIHNpemVzCiAgICB2YXIgY29udGVudFdpZHRoID0gY29udGVudC5vZmZzZXRXaWR0aDsKICAgIHZhciBjb250ZW50SGVpZ2h0ID0gY29udGVudC5vZmZzZXRIZWlnaHQ7CiAgICB2YXIgbGluZUhlaWdodCA9IGxpbmUub2Zmc2V0SGVpZ2h0OwogICAgdmFyIGRvdFdpZHRoID0gZG90Lm9mZnNldFdpZHRoOwogICAgdmFyIGRvdEhlaWdodCA9IGRvdC5vZmZzZXRIZWlnaHQ7CgogICAgdmFyIGxlZnQgPSBkYXRhUG9pbnQuc2NyZWVuLnggLSBjb250ZW50V2lkdGggLyAyOwogICAgbGVmdCA9IE1hdGgubWluKE1hdGgubWF4KGxlZnQsIDEwKSwgdGhpcy5mcmFtZS5jbGllbnRXaWR0aCAtIDEwIC0gY29udGVudFdpZHRoKTsKCiAgICBsaW5lLnN0eWxlLmxlZnQgPSBkYXRhUG9pbnQuc2NyZWVuLnggKyAncHgnOwogICAgbGluZS5zdHlsZS50b3AgPSBkYXRhUG9pbnQuc2NyZWVuLnkgLSBsaW5lSGVpZ2h0ICsgJ3B4JzsKICAgIGNvbnRlbnQuc3R5bGUubGVmdCA9IGxlZnQgKyAncHgnOwogICAgY29udGVudC5zdHlsZS50b3AgPSBkYXRhUG9pbnQuc2NyZWVuLnkgLSBsaW5lSGVpZ2h0IC0gY29udGVudEhlaWdodCArICdweCc7CiAgICBkb3Quc3R5bGUubGVmdCA9IGRhdGFQb2ludC5zY3JlZW4ueCAtIGRvdFdpZHRoIC8gMiArICdweCc7CiAgICBkb3Quc3R5bGUudG9wID0gZGF0YVBvaW50LnNjcmVlbi55IC0gZG90SGVpZ2h0IC8gMiArICdweCc7CiAgfTsKCiAgLyoqCiAgICogSGlkZSB0aGUgdG9vbHRpcCB3aGVuIGRpc3BsYXllZAogICAqIEBwcml2YXRlCiAgICovCiAgR3JhcGgzZC5wcm90b3R5cGUuX2hpZGVUb29sdGlwID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMudG9vbHRpcCkgewogICAgICB0aGlzLnRvb2x0aXAuZGF0YVBvaW50ID0gbnVsbDsKCiAgICAgIGZvciAodmFyIHByb3AgaW4gdGhpcy50b29sdGlwLmRvbSkgewogICAgICAgIGlmICh0aGlzLnRvb2x0aXAuZG9tLmhhc093blByb3BlcnR5KHByb3ApKSB7CiAgICAgICAgICB2YXIgZWxlbSA9IHRoaXMudG9vbHRpcC5kb21bcHJvcF07CiAgICAgICAgICBpZiAoZWxlbSAmJiBlbGVtLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8qKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKiovCgogIC8qKgogICAqIEdldCB0aGUgaG9yaXpvbnRhbCBtb3VzZSBwb3NpdGlvbiBmcm9tIGEgbW91c2UgZXZlbnQKICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudAogICAqIEByZXR1cm4ge051bWJlcn0gbW91c2UgeAogICAqLwogIGZ1bmN0aW9uIGdldE1vdXNlWChldmVudCkgewogICAgaWYgKCdjbGllbnRYJyBpbiBldmVudCkgcmV0dXJuIGV2ZW50LmNsaWVudFg7CiAgICByZXR1cm4gZXZlbnQudGFyZ2V0VG91Y2hlc1swXSAmJiBldmVudC50YXJnZXRUb3VjaGVzWzBdLmNsaWVudFggfHwgMDsKICB9CgogIC8qKgogICAqIEdldCB0aGUgdmVydGljYWwgbW91c2UgcG9zaXRpb24gZnJvbSBhIG1vdXNlIGV2ZW50CiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcmV0dXJuIHtOdW1iZXJ9IG1vdXNlIHkKICAgKi8KICBmdW5jdGlvbiBnZXRNb3VzZVkoZXZlbnQpIHsKICAgIGlmICgnY2xpZW50WScgaW4gZXZlbnQpIHJldHVybiBldmVudC5jbGllbnRZOwogICAgcmV0dXJuIGV2ZW50LnRhcmdldFRvdWNoZXNbMF0gJiYgZXZlbnQudGFyZ2V0VG91Y2hlc1swXS5jbGllbnRZIHx8IDA7CiAgfQoKICBtb2R1bGUuZXhwb3J0cyA9IEdyYXBoM2Q7CgogIC8vIHVzZSB1c2UgZGVmYXVsdHMKCi8qKiovIH0sCi8qIDEyICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKICAvKioKICAgKiBAcHJvdG90eXBlIFBvaW50MmQKICAgKiBAcGFyYW0ge051bWJlcn0gW3hdCiAgICogQHBhcmFtIHtOdW1iZXJ9IFt5XQogICAqLwogICJ1c2Ugc3RyaWN0IjsKCiAgZnVuY3Rpb24gUG9pbnQyZCh4LCB5KSB7CiAgICB0aGlzLnggPSB4ICE9PSB1bmRlZmluZWQgPyB4IDogMDsKICAgIHRoaXMueSA9IHkgIT09IHVuZGVmaW5lZCA/IHkgOiAwOwogIH0KCiAgbW9kdWxlLmV4cG9ydHMgPSBQb2ludDJkOwoKLyoqKi8gfSwKLyogMTMgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgogIAogIC8qKgogICAqIEV4cG9zZSBgRW1pdHRlcmAuCiAgICovCgogIG1vZHVsZS5leHBvcnRzID0gRW1pdHRlcjsKCiAgLyoqCiAgICogSW5pdGlhbGl6ZSBhIG5ldyBgRW1pdHRlcmAuCiAgICoKICAgKiBAYXBpIHB1YmxpYwogICAqLwoKICBmdW5jdGlvbiBFbWl0dGVyKG9iaikgewogICAgaWYgKG9iaikgcmV0dXJuIG1peGluKG9iaik7CiAgfTsKCiAgLyoqCiAgICogTWl4aW4gdGhlIGVtaXR0ZXIgcHJvcGVydGllcy4KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmoKICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICogQGFwaSBwcml2YXRlCiAgICovCgogIGZ1bmN0aW9uIG1peGluKG9iaikgewogICAgZm9yICh2YXIga2V5IGluIEVtaXR0ZXIucHJvdG90eXBlKSB7CiAgICAgIG9ialtrZXldID0gRW1pdHRlci5wcm90b3R5cGVba2V5XTsKICAgIH0KICAgIHJldHVybiBvYmo7CiAgfQoKICAvKioKICAgKiBMaXN0ZW4gb24gdGhlIGdpdmVuIGBldmVudGAgd2l0aCBgZm5gLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICAgKiBAcmV0dXJuIHtFbWl0dGVyfQogICAqIEBhcGkgcHVibGljCiAgICovCgogIEVtaXR0ZXIucHJvdG90eXBlLm9uID0KICBFbWl0dGVyLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oZXZlbnQsIGZuKXsKICAgIHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fTsKICAgICh0aGlzLl9jYWxsYmFja3NbZXZlbnRdID0gdGhpcy5fY2FsbGJhY2tzW2V2ZW50XSB8fCBbXSkKICAgICAgLnB1c2goZm4pOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLyoqCiAgICogQWRkcyBhbiBgZXZlbnRgIGxpc3RlbmVyIHRoYXQgd2lsbCBiZSBpbnZva2VkIGEgc2luZ2xlCiAgICogdGltZSB0aGVuIGF1dG9tYXRpY2FsbHkgcmVtb3ZlZC4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudAogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAgICogQHJldHVybiB7RW1pdHRlcn0KICAgKiBAYXBpIHB1YmxpYwogICAqLwoKICBFbWl0dGVyLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24oZXZlbnQsIGZuKXsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fTsKCiAgICBmdW5jdGlvbiBvbigpIHsKICAgICAgc2VsZi5vZmYoZXZlbnQsIG9uKTsKICAgICAgZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KCiAgICBvbi5mbiA9IGZuOwogICAgdGhpcy5vbihldmVudCwgb24pOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLyoqCiAgICogUmVtb3ZlIHRoZSBnaXZlbiBjYWxsYmFjayBmb3IgYGV2ZW50YCBvciBhbGwKICAgKiByZWdpc3RlcmVkIGNhbGxiYWNrcy4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudAogICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuCiAgICogQHJldHVybiB7RW1pdHRlcn0KICAgKiBAYXBpIHB1YmxpYwogICAqLwoKICBFbWl0dGVyLnByb3RvdHlwZS5vZmYgPQogIEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyID0KICBFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPQogIEVtaXR0ZXIucHJvdG90eXBlLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihldmVudCwgZm4pewogICAgdGhpcy5fY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzIHx8IHt9OwoKICAgIC8vIGFsbAogICAgaWYgKDAgPT0gYXJndW1lbnRzLmxlbmd0aCkgewogICAgICB0aGlzLl9jYWxsYmFja3MgPSB7fTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgLy8gc3BlY2lmaWMgZXZlbnQKICAgIHZhciBjYWxsYmFja3MgPSB0aGlzLl9jYWxsYmFja3NbZXZlbnRdOwogICAgaWYgKCFjYWxsYmFja3MpIHJldHVybiB0aGlzOwoKICAgIC8vIHJlbW92ZSBhbGwgaGFuZGxlcnMKICAgIGlmICgxID09IGFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgZGVsZXRlIHRoaXMuX2NhbGxiYWNrc1tldmVudF07CiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIC8vIHJlbW92ZSBzcGVjaWZpYyBoYW5kbGVyCiAgICB2YXIgY2I7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkrKykgewogICAgICBjYiA9IGNhbGxiYWNrc1tpXTsKICAgICAgaWYgKGNiID09PSBmbiB8fCBjYi5mbiA9PT0gZm4pIHsKICAgICAgICBjYWxsYmFja3Muc3BsaWNlKGksIDEpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvKioKICAgKiBFbWl0IGBldmVudGAgd2l0aCB0aGUgZ2l2ZW4gYXJncy4KICAgKgogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudAogICAqIEBwYXJhbSB7TWl4ZWR9IC4uLgogICAqIEByZXR1cm4ge0VtaXR0ZXJ9CiAgICovCgogIEVtaXR0ZXIucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbihldmVudCl7CiAgICB0aGlzLl9jYWxsYmFja3MgPSB0aGlzLl9jYWxsYmFja3MgfHwge307CiAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKQogICAgICAsIGNhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrc1tldmVudF07CgogICAgaWYgKGNhbGxiYWNrcykgewogICAgICBjYWxsYmFja3MgPSBjYWxsYmFja3Muc2xpY2UoMCk7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBjYWxsYmFja3MubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICBjYWxsYmFja3NbaV0uYXBwbHkodGhpcywgYXJncyk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvKioKICAgKiBSZXR1cm4gYXJyYXkgb2YgY2FsbGJhY2tzIGZvciBgZXZlbnRgLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICogQHJldHVybiB7QXJyYXl9CiAgICogQGFwaSBwdWJsaWMKICAgKi8KCiAgRW1pdHRlci5wcm90b3R5cGUubGlzdGVuZXJzID0gZnVuY3Rpb24oZXZlbnQpewogICAgdGhpcy5fY2FsbGJhY2tzID0gdGhpcy5fY2FsbGJhY2tzIHx8IHt9OwogICAgcmV0dXJuIHRoaXMuX2NhbGxiYWNrc1tldmVudF0gfHwgW107CiAgfTsKCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhpcyBlbWl0dGVyIGhhcyBgZXZlbnRgIGhhbmRsZXJzLgogICAqCiAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50CiAgICogQHJldHVybiB7Qm9vbGVhbn0KICAgKiBAYXBpIHB1YmxpYwogICAqLwoKICBFbWl0dGVyLnByb3RvdHlwZS5oYXNMaXN0ZW5lcnMgPSBmdW5jdGlvbihldmVudCl7CiAgICByZXR1cm4gISEgdGhpcy5saXN0ZW5lcnMoZXZlbnQpLmxlbmd0aDsKICB9OwoKCi8qKiovIH0sCi8qIDE0ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKICAvKioKICAgKiBAcHJvdG90eXBlIFBvaW50M2QKICAgKiBAcGFyYW0ge051bWJlcn0gW3hdCiAgICogQHBhcmFtIHtOdW1iZXJ9IFt5XQogICAqIEBwYXJhbSB7TnVtYmVyfSBbel0KICAgKi8KICAidXNlIHN0cmljdCI7CgogIGZ1bmN0aW9uIFBvaW50M2QoeCwgeSwgeikgewogICAgdGhpcy54ID0geCAhPT0gdW5kZWZpbmVkID8geCA6IDA7CiAgICB0aGlzLnkgPSB5ICE9PSB1bmRlZmluZWQgPyB5IDogMDsKICAgIHRoaXMueiA9IHogIT09IHVuZGVmaW5lZCA/IHogOiAwOwogIH07CgogIC8qKgogICAqIFN1YnRyYWN0IHRoZSB0d28gcHJvdmlkZWQgcG9pbnRzLCByZXR1cm5zIGEtYgogICAqIEBwYXJhbSB7UG9pbnQzZH0gYQogICAqIEBwYXJhbSB7UG9pbnQzZH0gYgogICAqIEByZXR1cm4ge1BvaW50M2R9IGEtYgogICAqLwogIFBvaW50M2Quc3VidHJhY3QgPSBmdW5jdGlvbiAoYSwgYikgewogICAgdmFyIHN1YiA9IG5ldyBQb2ludDNkKCk7CiAgICBzdWIueCA9IGEueCAtIGIueDsKICAgIHN1Yi55ID0gYS55IC0gYi55OwogICAgc3ViLnogPSBhLnogLSBiLno7CiAgICByZXR1cm4gc3ViOwogIH07CgogIC8qKgogICAqIEFkZCB0aGUgdHdvIHByb3ZpZGVkIHBvaW50cywgcmV0dXJucyBhK2IKICAgKiBAcGFyYW0ge1BvaW50M2R9IGEKICAgKiBAcGFyYW0ge1BvaW50M2R9IGIKICAgKiBAcmV0dXJuIHtQb2ludDNkfSBhK2IKICAgKi8KICBQb2ludDNkLmFkZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICB2YXIgc3VtID0gbmV3IFBvaW50M2QoKTsKICAgIHN1bS54ID0gYS54ICsgYi54OwogICAgc3VtLnkgPSBhLnkgKyBiLnk7CiAgICBzdW0ueiA9IGEueiArIGIuejsKICAgIHJldHVybiBzdW07CiAgfTsKCiAgLyoqCiAgICogQ2FsY3VsYXRlIHRoZSBhdmVyYWdlIG9mIHR3byAzZCBwb2ludHMKICAgKiBAcGFyYW0ge1BvaW50M2R9IGEKICAgKiBAcGFyYW0ge1BvaW50M2R9IGIKICAgKiBAcmV0dXJuIHtQb2ludDNkfSBUaGUgYXZlcmFnZSwgKGErYikvMgogICAqLwogIFBvaW50M2QuYXZnID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgIHJldHVybiBuZXcgUG9pbnQzZCgoYS54ICsgYi54KSAvIDIsIChhLnkgKyBiLnkpIC8gMiwgKGEueiArIGIueikgLyAyKTsKICB9OwoKICAvKioKICAgKiBDYWxjdWxhdGUgdGhlIGNyb3NzIHByb2R1Y3Qgb2YgdGhlIHR3byBwcm92aWRlZCBwb2ludHMsIHJldHVybnMgYXhiCiAgICogRG9jdW1lbnRhdGlvbjogaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Dcm9zc19wcm9kdWN0CiAgICogQHBhcmFtIHtQb2ludDNkfSBhCiAgICogQHBhcmFtIHtQb2ludDNkfSBiCiAgICogQHJldHVybiB7UG9pbnQzZH0gY3Jvc3MgcHJvZHVjdCBheGIKICAgKi8KICBQb2ludDNkLmNyb3NzUHJvZHVjdCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICB2YXIgY3Jvc3Nwcm9kdWN0ID0gbmV3IFBvaW50M2QoKTsKCiAgICBjcm9zc3Byb2R1Y3QueCA9IGEueSAqIGIueiAtIGEueiAqIGIueTsKICAgIGNyb3NzcHJvZHVjdC55ID0gYS56ICogYi54IC0gYS54ICogYi56OwogICAgY3Jvc3Nwcm9kdWN0LnogPSBhLnggKiBiLnkgLSBhLnkgKiBiLng7CgogICAgcmV0dXJuIGNyb3NzcHJvZHVjdDsKICB9OwoKICAvKioKICAgKiBSdHJpZXZlIHRoZSBsZW5ndGggb2YgdGhlIHZlY3RvciAob3IgdGhlIGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byB0aGUgb3JpZ2luCiAgICogQHJldHVybiB7TnVtYmVyfSAgbGVuZ3RoCiAgICovCiAgUG9pbnQzZC5wcm90b3R5cGUubGVuZ3RoID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnopOwogIH07CgogIG1vZHVsZS5leHBvcnRzID0gUG9pbnQzZDsKCi8qKiovIH0sCi8qIDE1ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciBQb2ludDNkID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNCk7CgogIC8qKgogICAqIEBjbGFzcyBDYW1lcmEKICAgKiBUaGUgY2FtZXJhIGlzIG1vdW50ZWQgb24gYSAodmlydHVhbCkgY2FtZXJhIGFybS4gVGhlIGNhbWVyYSBhcm0gY2FuIHJvdGF0ZQogICAqIFRoZSBjYW1lcmEgaXMgYWx3YXlzIGxvb2tpbmcgaW4gdGhlIGRpcmVjdGlvbiBvZiB0aGUgb3JpZ2luIG9mIHRoZSBhcm0uCiAgICogVGhpcyB3YXksIHRoZSBjYW1lcmEgYWx3YXlzIHJvdGF0ZXMgYXJvdW5kIG9uZSBmaXhlZCBwb2ludCwgdGhlIGxvY2F0aW9uCiAgICogb2YgdGhlIGNhbWVyYSBhcm0uCiAgICoKICAgKiBEb2N1bWVudGF0aW9uOgogICAqICAgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS8zRF9wcm9qZWN0aW9uCiAgICovCiAgZnVuY3Rpb24gQ2FtZXJhKCkgewogICAgdGhpcy5hcm1Mb2NhdGlvbiA9IG5ldyBQb2ludDNkKCk7CiAgICB0aGlzLmFybVJvdGF0aW9uID0ge307CiAgICB0aGlzLmFybVJvdGF0aW9uLmhvcml6b250YWwgPSAwOwogICAgdGhpcy5hcm1Sb3RhdGlvbi52ZXJ0aWNhbCA9IDA7CiAgICB0aGlzLmFybUxlbmd0aCA9IDEuNzsKCiAgICB0aGlzLmNhbWVyYUxvY2F0aW9uID0gbmV3IFBvaW50M2QoKTsKICAgIHRoaXMuY2FtZXJhUm90YXRpb24gPSBuZXcgUG9pbnQzZCgwLjUgKiBNYXRoLlBJLCAwLCAwKTsKCiAgICB0aGlzLmNhbGN1bGF0ZUNhbWVyYU9yaWVudGF0aW9uKCk7CiAgfQoKICAvKioKICAgKiBTZXQgdGhlIGxvY2F0aW9uIChvcmlnaW4pIG9mIHRoZSBhcm0KICAgKiBAcGFyYW0ge051bWJlcn0geCAgTm9ybWFsaXplZCB2YWx1ZSBvZiB4CiAgICogQHBhcmFtIHtOdW1iZXJ9IHkgIE5vcm1hbGl6ZWQgdmFsdWUgb2YgeQogICAqIEBwYXJhbSB7TnVtYmVyfSB6ICBOb3JtYWxpemVkIHZhbHVlIG9mIHoKICAgKi8KICBDYW1lcmEucHJvdG90eXBlLnNldEFybUxvY2F0aW9uID0gZnVuY3Rpb24gKHgsIHksIHopIHsKICAgIHRoaXMuYXJtTG9jYXRpb24ueCA9IHg7CiAgICB0aGlzLmFybUxvY2F0aW9uLnkgPSB5OwogICAgdGhpcy5hcm1Mb2NhdGlvbi56ID0gejsKCiAgICB0aGlzLmNhbGN1bGF0ZUNhbWVyYU9yaWVudGF0aW9uKCk7CiAgfTsKCiAgLyoqCiAgICogU2V0IHRoZSByb3RhdGlvbiBvZiB0aGUgY2FtZXJhIGFybQogICAqIEBwYXJhbSB7TnVtYmVyfSBob3Jpem9udGFsICAgVGhlIGhvcml6b250YWwgcm90YXRpb24sIGJldHdlZW4gMCBhbmQgMipQSS4KICAgKiAgICAgICAgICAgICAgICBPcHRpb25hbCwgY2FuIGJlIGxlZnQgdW5kZWZpbmVkLgogICAqIEBwYXJhbSB7TnVtYmVyfSB2ZXJ0aWNhbCAgIFRoZSB2ZXJ0aWNhbCByb3RhdGlvbiwgYmV0d2VlbiAwIGFuZCAwLjUqUEkKICAgKiAgICAgICAgICAgICAgICBpZiB2ZXJ0aWNhbD0wLjUqUEksIHRoZSBncmFwaCBpcyBzaG93biBmcm9tIHRoZQogICAqICAgICAgICAgICAgICAgIHRvcC4gT3B0aW9uYWwsIGNhbiBiZSBsZWZ0IHVuZGVmaW5lZC4KICAgKi8KICBDYW1lcmEucHJvdG90eXBlLnNldEFybVJvdGF0aW9uID0gZnVuY3Rpb24gKGhvcml6b250YWwsIHZlcnRpY2FsKSB7CiAgICBpZiAoaG9yaXpvbnRhbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuYXJtUm90YXRpb24uaG9yaXpvbnRhbCA9IGhvcml6b250YWw7CiAgICB9CgogICAgaWYgKHZlcnRpY2FsICE9PSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy5hcm1Sb3RhdGlvbi52ZXJ0aWNhbCA9IHZlcnRpY2FsOwogICAgICBpZiAodGhpcy5hcm1Sb3RhdGlvbi52ZXJ0aWNhbCA8IDApIHRoaXMuYXJtUm90YXRpb24udmVydGljYWwgPSAwOwogICAgICBpZiAodGhpcy5hcm1Sb3RhdGlvbi52ZXJ0aWNhbCA+IDAuNSAqIE1hdGguUEkpIHRoaXMuYXJtUm90YXRpb24udmVydGljYWwgPSAwLjUgKiBNYXRoLlBJOwogICAgfQoKICAgIGlmIChob3Jpem9udGFsICE9PSB1bmRlZmluZWQgfHwgdmVydGljYWwgIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLmNhbGN1bGF0ZUNhbWVyYU9yaWVudGF0aW9uKCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmV0cmlldmUgdGhlIGN1cnJlbnQgYXJtIHJvdGF0aW9uCiAgICogQHJldHVybiB7b2JqZWN0fSAgIEFuIG9iamVjdCB3aXRoIHBhcmFtZXRlcnMgaG9yaXpvbnRhbCBhbmQgdmVydGljYWwKICAgKi8KICBDYW1lcmEucHJvdG90eXBlLmdldEFybVJvdGF0aW9uID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHJvdCA9IHt9OwogICAgcm90Lmhvcml6b250YWwgPSB0aGlzLmFybVJvdGF0aW9uLmhvcml6b250YWw7CiAgICByb3QudmVydGljYWwgPSB0aGlzLmFybVJvdGF0aW9uLnZlcnRpY2FsOwoKICAgIHJldHVybiByb3Q7CiAgfTsKCiAgLyoqCiAgICogU2V0IHRoZSAobm9ybWFsaXplZCkgbGVuZ3RoIG9mIHRoZSBjYW1lcmEgYXJtLgogICAqIEBwYXJhbSB7TnVtYmVyfSBsZW5ndGggQSBsZW5ndGggYmV0d2VlbiAwLjcxIGFuZCA1LjAKICAgKi8KICBDYW1lcmEucHJvdG90eXBlLnNldEFybUxlbmd0aCA9IGZ1bmN0aW9uIChsZW5ndGgpIHsKICAgIGlmIChsZW5ndGggPT09IHVuZGVmaW5lZCkgcmV0dXJuOwoKICAgIHRoaXMuYXJtTGVuZ3RoID0gbGVuZ3RoOwoKICAgIC8vIFJhZGl1cyBtdXN0IGJlIGxhcmdlciB0aGFuIHRoZSBjb3JuZXIgb2YgdGhlIGdyYXBoLAogICAgLy8gd2hpY2ggaGFzIGEgZGlzdGFuY2Ugb2Ygc3FydCgwLjVeMiswLjVeMikgPSAwLjcxIGZyb20gdGhlIGNlbnRlciBvZiB0aGUKICAgIC8vIGdyYXBoCiAgICBpZiAodGhpcy5hcm1MZW5ndGggPCAwLjcxKSB0aGlzLmFybUxlbmd0aCA9IDAuNzE7CiAgICBpZiAodGhpcy5hcm1MZW5ndGggPiA1KSB0aGlzLmFybUxlbmd0aCA9IDU7CgogICAgdGhpcy5jYWxjdWxhdGVDYW1lcmFPcmllbnRhdGlvbigpOwogIH07CgogIC8qKgogICAqIFJldHJpZXZlIHRoZSBhcm0gbGVuZ3RoCiAgICogQHJldHVybiB7TnVtYmVyfSBsZW5ndGgKICAgKi8KICBDYW1lcmEucHJvdG90eXBlLmdldEFybUxlbmd0aCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmFybUxlbmd0aDsKICB9OwoKICAvKioKICAgKiBSZXRyaWV2ZSB0aGUgY2FtZXJhIGxvY2F0aW9uCiAgICogQHJldHVybiB7UG9pbnQzZH0gY2FtZXJhTG9jYXRpb24KICAgKi8KICBDYW1lcmEucHJvdG90eXBlLmdldENhbWVyYUxvY2F0aW9uID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuY2FtZXJhTG9jYXRpb247CiAgfTsKCiAgLyoqCiAgICogUmV0cmlldmUgdGhlIGNhbWVyYSByb3RhdGlvbgogICAqIEByZXR1cm4ge1BvaW50M2R9IGNhbWVyYVJvdGF0aW9uCiAgICovCiAgQ2FtZXJhLnByb3RvdHlwZS5nZXRDYW1lcmFSb3RhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmNhbWVyYVJvdGF0aW9uOwogIH07CgogIC8qKgogICAqIENhbGN1bGF0ZSB0aGUgbG9jYXRpb24gYW5kIHJvdGF0aW9uIG9mIHRoZSBjYW1lcmEgYmFzZWQgb24gdGhlCiAgICogcG9zaXRpb24gYW5kIG9yaWVudGF0aW9uIG9mIHRoZSBjYW1lcmEgYXJtCiAgICovCiAgQ2FtZXJhLnByb3RvdHlwZS5jYWxjdWxhdGVDYW1lcmFPcmllbnRhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIGNhbGN1bGF0ZSBsb2NhdGlvbiBvZiB0aGUgY2FtZXJhCiAgICB0aGlzLmNhbWVyYUxvY2F0aW9uLnggPSB0aGlzLmFybUxvY2F0aW9uLnggLSB0aGlzLmFybUxlbmd0aCAqIE1hdGguc2luKHRoaXMuYXJtUm90YXRpb24uaG9yaXpvbnRhbCkgKiBNYXRoLmNvcyh0aGlzLmFybVJvdGF0aW9uLnZlcnRpY2FsKTsKICAgIHRoaXMuY2FtZXJhTG9jYXRpb24ueSA9IHRoaXMuYXJtTG9jYXRpb24ueSAtIHRoaXMuYXJtTGVuZ3RoICogTWF0aC5jb3ModGhpcy5hcm1Sb3RhdGlvbi5ob3Jpem9udGFsKSAqIE1hdGguY29zKHRoaXMuYXJtUm90YXRpb24udmVydGljYWwpOwogICAgdGhpcy5jYW1lcmFMb2NhdGlvbi56ID0gdGhpcy5hcm1Mb2NhdGlvbi56ICsgdGhpcy5hcm1MZW5ndGggKiBNYXRoLnNpbih0aGlzLmFybVJvdGF0aW9uLnZlcnRpY2FsKTsKCiAgICAvLyBjYWxjdWxhdGUgcm90YXRpb24gb2YgdGhlIGNhbWVyYQogICAgdGhpcy5jYW1lcmFSb3RhdGlvbi54ID0gTWF0aC5QSSAvIDIgLSB0aGlzLmFybVJvdGF0aW9uLnZlcnRpY2FsOwogICAgdGhpcy5jYW1lcmFSb3RhdGlvbi55ID0gMDsKICAgIHRoaXMuY2FtZXJhUm90YXRpb24ueiA9IC10aGlzLmFybVJvdGF0aW9uLmhvcml6b250YWw7CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBDYW1lcmE7CgovKioqLyB9LAovKiAxNiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgRGF0YVZpZXcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKCiAgLyoqCiAgICogQGNsYXNzIEZpbHRlcgogICAqCiAgICogQHBhcmFtIHtEYXRhU2V0fSBkYXRhIFRoZSBnb29nbGUgZGF0YSB0YWJsZQogICAqIEBwYXJhbSB7TnVtYmVyfSAgY29sdW1uICAgICAgICAgICAgIFRoZSBpbmRleCBvZiB0aGUgY29sdW1uIHRvIGJlIGZpbHRlcmVkCiAgICogQHBhcmFtIHtHcmFwaH0gZ3JhcGggICAgICAgICAgIFRoZSBncmFwaAogICAqLwogIGZ1bmN0aW9uIEZpbHRlcihkYXRhLCBjb2x1bW4sIGdyYXBoKSB7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5jb2x1bW4gPSBjb2x1bW47CiAgICB0aGlzLmdyYXBoID0gZ3JhcGg7IC8vIHRoZSBwYXJlbnQgZ3JhcGgKCiAgICB0aGlzLmluZGV4ID0gdW5kZWZpbmVkOwogICAgdGhpcy52YWx1ZSA9IHVuZGVmaW5lZDsKCiAgICAvLyByZWFkIGFsbCBkaXN0aW5jdCB2YWx1ZXMgYW5kIHNlbGVjdCB0aGUgZmlyc3Qgb25lCiAgICB0aGlzLnZhbHVlcyA9IGdyYXBoLmdldERpc3RpbmN0VmFsdWVzKGRhdGEuZ2V0KCksIHRoaXMuY29sdW1uKTsKCiAgICAvLyBzb3J0IGJvdGggbnVtZXJpYyBhbmQgc3RyaW5nIHZhbHVlcyBjb3JyZWN0bHkKICAgIHRoaXMudmFsdWVzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgcmV0dXJuIGEgPiBiID8gMSA6IGEgPCBiID8gLTEgOiAwOwogICAgfSk7CgogICAgaWYgKHRoaXMudmFsdWVzLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy5zZWxlY3RWYWx1ZSgwKTsKICAgIH0KCiAgICAvLyBjcmVhdGUgYW4gYXJyYXkgd2l0aCB0aGUgZmlsdGVyZWQgZGF0YXBvaW50cy4gdGhpcyB3aWxsIGJlIGxvYWRlZCBhZnRlcndhcmRzCiAgICB0aGlzLmRhdGFQb2ludHMgPSBbXTsKCiAgICB0aGlzLmxvYWRlZCA9IGZhbHNlOwogICAgdGhpcy5vbkxvYWRDYWxsYmFjayA9IHVuZGVmaW5lZDsKCiAgICBpZiAoZ3JhcGguYW5pbWF0aW9uUHJlbG9hZCkgewogICAgICB0aGlzLmxvYWRlZCA9IGZhbHNlOwogICAgICB0aGlzLmxvYWRJbkJhY2tncm91bmQoKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubG9hZGVkID0gdHJ1ZTsKICAgIH0KICB9OwoKICAvKioKICAgKiBSZXR1cm4gdGhlIGxhYmVsCiAgICogQHJldHVybiB7c3RyaW5nfSBsYWJlbAogICAqLwogIEZpbHRlci5wcm90b3R5cGUuaXNMb2FkZWQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5sb2FkZWQ7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJuIHRoZSBsb2FkZWQgcHJvZ3Jlc3MKICAgKiBAcmV0dXJuIHtOdW1iZXJ9IHBlcmNlbnRhZ2UgYmV0d2VlbiAwIGFuZCAxMDAKICAgKi8KICBGaWx0ZXIucHJvdG90eXBlLmdldExvYWRlZFByb2dyZXNzID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGxlbiA9IHRoaXMudmFsdWVzLmxlbmd0aDsKCiAgICB2YXIgaSA9IDA7CiAgICB3aGlsZSAodGhpcy5kYXRhUG9pbnRzW2ldKSB7CiAgICAgIGkrKzsKICAgIH0KCiAgICByZXR1cm4gTWF0aC5yb3VuZChpIC8gbGVuICogMTAwKTsKICB9OwoKICAvKioKICAgKiBSZXR1cm4gdGhlIGxhYmVsCiAgICogQHJldHVybiB7c3RyaW5nfSBsYWJlbAogICAqLwogIEZpbHRlci5wcm90b3R5cGUuZ2V0TGFiZWwgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5ncmFwaC5maWx0ZXJMYWJlbDsKICB9OwoKICAvKioKICAgKiBSZXR1cm4gdGhlIGNvbHVtbkluZGV4IG9mIHRoZSBmaWx0ZXIKICAgKiBAcmV0dXJuIHtOdW1iZXJ9IGNvbHVtbkluZGV4CiAgICovCiAgRmlsdGVyLnByb3RvdHlwZS5nZXRDb2x1bW4gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5jb2x1bW47CiAgfTsKCiAgLyoqCiAgICogUmV0dXJuIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgdmFsdWUuIFJldHVybnMgdW5kZWZpbmVkIGlmIHRoZXJlIGlzIG5vIHNlbGVjdGlvbgogICAqIEByZXR1cm4geyp9IHZhbHVlCiAgICovCiAgRmlsdGVyLnByb3RvdHlwZS5nZXRTZWxlY3RlZFZhbHVlID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuaW5kZXggPT09IHVuZGVmaW5lZCkgcmV0dXJuIHVuZGVmaW5lZDsKCiAgICByZXR1cm4gdGhpcy52YWx1ZXNbdGhpcy5pbmRleF07CiAgfTsKCiAgLyoqCiAgICogUmV0cmlldmUgYWxsIHZhbHVlcyBvZiB0aGUgZmlsdGVyCiAgICogQHJldHVybiB7QXJyYXl9IHZhbHVlcwogICAqLwogIEZpbHRlci5wcm90b3R5cGUuZ2V0VmFsdWVzID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMudmFsdWVzOwogIH07CgogIC8qKgogICAqIFJldHJpZXZlIG9uZSB2YWx1ZSBvZiB0aGUgZmlsdGVyCiAgICogQHBhcmFtIHtOdW1iZXJ9ICBpbmRleAogICAqIEByZXR1cm4geyp9IHZhbHVlCiAgICovCiAgRmlsdGVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIChpbmRleCkgewogICAgaWYgKGluZGV4ID49IHRoaXMudmFsdWVzLmxlbmd0aCkgdGhyb3cgJ0Vycm9yOiBpbmRleCBvdXQgb2YgcmFuZ2UnOwoKICAgIHJldHVybiB0aGlzLnZhbHVlc1tpbmRleF07CiAgfTsKCiAgLyoqCiAgICogUmV0cmlldmUgdGhlIChmaWx0ZXJlZCkgZGF0YVBvaW50cyBmb3IgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBmaWx0ZXIgaW5kZXgKICAgKiBAcGFyYW0ge051bWJlcn0gW2luZGV4XSAob3B0aW9uYWwpCiAgICogQHJldHVybiB7QXJyYXl9IGRhdGFQb2ludHMKICAgKi8KICBGaWx0ZXIucHJvdG90eXBlLl9nZXREYXRhUG9pbnRzID0gZnVuY3Rpb24gKGluZGV4KSB7CiAgICBpZiAoaW5kZXggPT09IHVuZGVmaW5lZCkgaW5kZXggPSB0aGlzLmluZGV4OwoKICAgIGlmIChpbmRleCA9PT0gdW5kZWZpbmVkKSByZXR1cm4gW107CgogICAgdmFyIGRhdGFQb2ludHM7CiAgICBpZiAodGhpcy5kYXRhUG9pbnRzW2luZGV4XSkgewogICAgICBkYXRhUG9pbnRzID0gdGhpcy5kYXRhUG9pbnRzW2luZGV4XTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBmID0ge307CiAgICAgIGYuY29sdW1uID0gdGhpcy5jb2x1bW47CiAgICAgIGYudmFsdWUgPSB0aGlzLnZhbHVlc1tpbmRleF07CgogICAgICB2YXIgZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy5kYXRhLCB7IGZpbHRlcjogZnVuY3Rpb24gZmlsdGVyKGl0ZW0pIHsKICAgICAgICAgIHJldHVybiBpdGVtW2YuY29sdW1uXSA9PSBmLnZhbHVlOwogICAgICAgIH0gfSkuZ2V0KCk7CiAgICAgIGRhdGFQb2ludHMgPSB0aGlzLmdyYXBoLl9nZXREYXRhUG9pbnRzKGRhdGFWaWV3KTsKCiAgICAgIHRoaXMuZGF0YVBvaW50c1tpbmRleF0gPSBkYXRhUG9pbnRzOwogICAgfQoKICAgIHJldHVybiBkYXRhUG9pbnRzOwogIH07CgogIC8qKgogICAqIFNldCBhIGNhbGxiYWNrIGZ1bmN0aW9uIHdoZW4gdGhlIGZpbHRlciBpcyBmdWxseSBsb2FkZWQuCiAgICovCiAgRmlsdGVyLnByb3RvdHlwZS5zZXRPbkxvYWRDYWxsYmFjayA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgdGhpcy5vbkxvYWRDYWxsYmFjayA9IGNhbGxiYWNrOwogIH07CgogIC8qKgogICAqIEFkZCBhIHZhbHVlIHRvIHRoZSBsaXN0IHdpdGggYXZhaWxhYmxlIHZhbHVlcyBmb3IgdGhpcyBmaWx0ZXIKICAgKiBObyBkb3VibGUgZW50cmllcyB3aWxsIGJlIGNyZWF0ZWQuCiAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4CiAgICovCiAgRmlsdGVyLnByb3RvdHlwZS5zZWxlY3RWYWx1ZSA9IGZ1bmN0aW9uIChpbmRleCkgewogICAgaWYgKGluZGV4ID49IHRoaXMudmFsdWVzLmxlbmd0aCkgdGhyb3cgJ0Vycm9yOiBpbmRleCBvdXQgb2YgcmFuZ2UnOwoKICAgIHRoaXMuaW5kZXggPSBpbmRleDsKICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlc1tpbmRleF07CiAgfTsKCiAgLyoqCiAgICogTG9hZCBhbGwgZmlsdGVyZWQgcm93cyBpbiB0aGUgYmFja2dyb3VuZCBvbmUgYnkgb25lCiAgICogU3RhcnQgdGhpcyBtZXRob2Qgd2l0aG91dCBwcm92aWRpbmcgYW4gaW5kZXghCiAgICovCiAgRmlsdGVyLnByb3RvdHlwZS5sb2FkSW5CYWNrZ3JvdW5kID0gZnVuY3Rpb24gKGluZGV4KSB7CiAgICBpZiAoaW5kZXggPT09IHVuZGVmaW5lZCkgaW5kZXggPSAwOwoKICAgIHZhciBmcmFtZSA9IHRoaXMuZ3JhcGguZnJhbWU7CgogICAgaWYgKGluZGV4IDwgdGhpcy52YWx1ZXMubGVuZ3RoKSB7CiAgICAgIHZhciBkYXRhUG9pbnRzVGVtcCA9IHRoaXMuX2dldERhdGFQb2ludHMoaW5kZXgpOwogICAgICAvL3RoaXMuZ3JhcGgucmVkcmF3SW5mbygpOyAvLyBUT0RPOiBub3QgbmVhdAoKICAgICAgLy8gY3JlYXRlIGEgcHJvZ3Jlc3MgYm94CiAgICAgIGlmIChmcmFtZS5wcm9ncmVzcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZnJhbWUucHJvZ3Jlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdESVYnKTsKICAgICAgICBmcmFtZS5wcm9ncmVzcy5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICAgICAgZnJhbWUucHJvZ3Jlc3Muc3R5bGUuY29sb3IgPSAnZ3JheSc7CiAgICAgICAgZnJhbWUuYXBwZW5kQ2hpbGQoZnJhbWUucHJvZ3Jlc3MpOwogICAgICB9CiAgICAgIHZhciBwcm9ncmVzcyA9IHRoaXMuZ2V0TG9hZGVkUHJvZ3Jlc3MoKTsKICAgICAgZnJhbWUucHJvZ3Jlc3MuaW5uZXJIVE1MID0gJ0xvYWRpbmcgYW5pbWF0aW9uLi4uICcgKyBwcm9ncmVzcyArICclJzsKICAgICAgLy8gVE9ETzogdGhpcyBpcyBubyBuaWNlIHNvbHV0aW9uLi4uCiAgICAgIGZyYW1lLnByb2dyZXNzLnN0eWxlLmJvdHRvbSA9IDYwICsgJ3B4JzsgLy8gVE9ETzogdXNlIGhlaWdodCBvZiBzbGlkZXIKICAgICAgZnJhbWUucHJvZ3Jlc3Muc3R5bGUubGVmdCA9IDEwICsgJ3B4JzsKCiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIG1lLmxvYWRJbkJhY2tncm91bmQoaW5kZXggKyAxKTsKICAgICAgfSwgMTApOwogICAgICB0aGlzLmxvYWRlZCA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5sb2FkZWQgPSB0cnVlOwoKICAgICAgLy8gcmVtb3ZlIHRoZSBwcm9ncmVzcyBib3gKICAgICAgaWYgKGZyYW1lLnByb2dyZXNzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBmcmFtZS5yZW1vdmVDaGlsZChmcmFtZS5wcm9ncmVzcyk7CiAgICAgICAgZnJhbWUucHJvZ3Jlc3MgPSB1bmRlZmluZWQ7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLm9uTG9hZENhbGxiYWNrKSB0aGlzLm9uTG9hZENhbGxiYWNrKCk7CiAgICB9CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBGaWx0ZXI7CgovKioqLyB9LAovKiAxNyAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogIC8qKgogICAqIEBjb25zdHJ1Y3RvciBTbGlkZXIKICAgKgogICAqIEFuIGh0bWwgc2xpZGVyIGNvbnRyb2wgd2l0aCBzdGFydC9zdG9wL3ByZXYvbmV4dCBidXR0b25zCiAgICogQHBhcmFtIHtFbGVtZW50fSBjb250YWluZXIgIFRoZSBlbGVtZW50IHdoZXJlIHRoZSBzbGlkZXIgd2lsbCBiZSBjcmVhdGVkCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICBBdmFpbGFibGUgb3B0aW9uczoKICAgKiAgICAgICAgICAgICAgICAge2Jvb2xlYW59IHZpc2libGUgICBJZiB0cnVlIChkZWZhdWx0KSB0aGUKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlciBpcyB2aXNpYmxlLgogICAqLwogIGZ1bmN0aW9uIFNsaWRlcihjb250YWluZXIsIG9wdGlvbnMpIHsKICAgIGlmIChjb250YWluZXIgPT09IHVuZGVmaW5lZCkgewogICAgICB0aHJvdyAnRXJyb3I6IE5vIGNvbnRhaW5lciBlbGVtZW50IGRlZmluZWQnOwogICAgfQogICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7CiAgICB0aGlzLnZpc2libGUgPSBvcHRpb25zICYmIG9wdGlvbnMudmlzaWJsZSAhPSB1bmRlZmluZWQgPyBvcHRpb25zLnZpc2libGUgOiB0cnVlOwoKICAgIGlmICh0aGlzLnZpc2libGUpIHsKICAgICAgdGhpcy5mcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0RJVicpOwogICAgICAvL3RoaXMuZnJhbWUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNFNUU1RTUnOwogICAgICB0aGlzLmZyYW1lLnN0eWxlLndpZHRoID0gJzEwMCUnOwogICAgICB0aGlzLmZyYW1lLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsKICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5mcmFtZSk7CgogICAgICB0aGlzLmZyYW1lLnByZXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdJTlBVVCcpOwogICAgICB0aGlzLmZyYW1lLnByZXYudHlwZSA9ICdCVVRUT04nOwogICAgICB0aGlzLmZyYW1lLnByZXYudmFsdWUgPSAnUHJldic7CiAgICAgIHRoaXMuZnJhbWUuYXBwZW5kQ2hpbGQodGhpcy5mcmFtZS5wcmV2KTsKCiAgICAgIHRoaXMuZnJhbWUucGxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0lOUFVUJyk7CiAgICAgIHRoaXMuZnJhbWUucGxheS50eXBlID0gJ0JVVFRPTic7CiAgICAgIHRoaXMuZnJhbWUucGxheS52YWx1ZSA9ICdQbGF5JzsKICAgICAgdGhpcy5mcmFtZS5hcHBlbmRDaGlsZCh0aGlzLmZyYW1lLnBsYXkpOwoKICAgICAgdGhpcy5mcmFtZS5uZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnSU5QVVQnKTsKICAgICAgdGhpcy5mcmFtZS5uZXh0LnR5cGUgPSAnQlVUVE9OJzsKICAgICAgdGhpcy5mcmFtZS5uZXh0LnZhbHVlID0gJ05leHQnOwogICAgICB0aGlzLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuZnJhbWUubmV4dCk7CgogICAgICB0aGlzLmZyYW1lLmJhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0lOUFVUJyk7CiAgICAgIHRoaXMuZnJhbWUuYmFyLnR5cGUgPSAnQlVUVE9OJzsKICAgICAgdGhpcy5mcmFtZS5iYXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgICB0aGlzLmZyYW1lLmJhci5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkIHJlZCc7CiAgICAgIHRoaXMuZnJhbWUuYmFyLnN0eWxlLndpZHRoID0gJzEwMHB4JzsKICAgICAgdGhpcy5mcmFtZS5iYXIuc3R5bGUuaGVpZ2h0ID0gJzZweCc7CiAgICAgIHRoaXMuZnJhbWUuYmFyLnN0eWxlLmJvcmRlclJhZGl1cyA9ICcycHgnOwogICAgICB0aGlzLmZyYW1lLmJhci5zdHlsZS5Nb3pCb3JkZXJSYWRpdXMgPSAnMnB4JzsKICAgICAgdGhpcy5mcmFtZS5iYXIuc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCAjN0Y3RjdGJzsKICAgICAgdGhpcy5mcmFtZS5iYXIuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNFNUU1RTUnOwogICAgICB0aGlzLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuZnJhbWUuYmFyKTsKCiAgICAgIHRoaXMuZnJhbWUuc2xpZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdJTlBVVCcpOwogICAgICB0aGlzLmZyYW1lLnNsaWRlLnR5cGUgPSAnQlVUVE9OJzsKICAgICAgdGhpcy5mcmFtZS5zbGlkZS5zdHlsZS5tYXJnaW4gPSAnMHB4JzsKICAgICAgdGhpcy5mcmFtZS5zbGlkZS52YWx1ZSA9ICcgJzsKICAgICAgdGhpcy5mcmFtZS5zbGlkZS5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7CiAgICAgIHRoaXMuZnJhbWUuc2xpZGUuc3R5bGUubGVmdCA9ICctMTAwcHgnOwogICAgICB0aGlzLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuZnJhbWUuc2xpZGUpOwoKICAgICAgLy8gY3JlYXRlIGV2ZW50cwogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB0aGlzLmZyYW1lLnNsaWRlLm9ubW91c2Vkb3duID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgbWUuX29uTW91c2VEb3duKGV2ZW50KTsKICAgICAgfTsKICAgICAgdGhpcy5mcmFtZS5wcmV2Lm9uY2xpY2sgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBtZS5wcmV2KGV2ZW50KTsKICAgICAgfTsKICAgICAgdGhpcy5mcmFtZS5wbGF5Lm9uY2xpY2sgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBtZS50b2dnbGVQbGF5KGV2ZW50KTsKICAgICAgfTsKICAgICAgdGhpcy5mcmFtZS5uZXh0Lm9uY2xpY2sgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBtZS5uZXh0KGV2ZW50KTsKICAgICAgfTsKICAgIH0KCiAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sgPSB1bmRlZmluZWQ7CgogICAgdGhpcy52YWx1ZXMgPSBbXTsKICAgIHRoaXMuaW5kZXggPSB1bmRlZmluZWQ7CgogICAgdGhpcy5wbGF5VGltZW91dCA9IHVuZGVmaW5lZDsKICAgIHRoaXMucGxheUludGVydmFsID0gMTAwMDsgLy8gbWlsbGlzZWNvbmRzCiAgICB0aGlzLnBsYXlMb29wID0gdHJ1ZTsKICB9CgogIC8qKgogICAqIFNlbGVjdCB0aGUgcHJldmlvdXMgaW5kZXgKICAgKi8KICBTbGlkZXIucHJvdG90eXBlLnByZXYgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaW5kZXggPSB0aGlzLmdldEluZGV4KCk7CiAgICBpZiAoaW5kZXggPiAwKSB7CiAgICAgIGluZGV4LS07CiAgICAgIHRoaXMuc2V0SW5kZXgoaW5kZXgpOwogICAgfQogIH07CgogIC8qKgogICAqIFNlbGVjdCB0aGUgbmV4dCBpbmRleAogICAqLwogIFNsaWRlci5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBpbmRleCA9IHRoaXMuZ2V0SW5kZXgoKTsKICAgIGlmIChpbmRleCA8IHRoaXMudmFsdWVzLmxlbmd0aCAtIDEpIHsKICAgICAgaW5kZXgrKzsKICAgICAgdGhpcy5zZXRJbmRleChpbmRleCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU2VsZWN0IHRoZSBuZXh0IGluZGV4CiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5wbGF5TmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKCk7CgogICAgdmFyIGluZGV4ID0gdGhpcy5nZXRJbmRleCgpOwogICAgaWYgKGluZGV4IDwgdGhpcy52YWx1ZXMubGVuZ3RoIC0gMSkgewogICAgICBpbmRleCsrOwogICAgICB0aGlzLnNldEluZGV4KGluZGV4KTsKICAgIH0gZWxzZSBpZiAodGhpcy5wbGF5TG9vcCkgewogICAgICAvLyBqdW1wIHRvIHRoZSBzdGFydAogICAgICBpbmRleCA9IDA7CiAgICAgIHRoaXMuc2V0SW5kZXgoaW5kZXgpOwogICAgfQoKICAgIHZhciBlbmQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIGRpZmYgPSBlbmQgLSBzdGFydDsKCiAgICAvLyBjYWxjdWxhdGUgaG93IG11Y2ggdGltZSBpdCB0byB0byBzZXQgdGhlIGluZGV4IGFuZCB0byBleGVjdXRlIHRoZSBjYWxsYmFjawogICAgLy8gZnVuY3Rpb24uCiAgICB2YXIgaW50ZXJ2YWwgPSBNYXRoLm1heCh0aGlzLnBsYXlJbnRlcnZhbCAtIGRpZmYsIDApOwogICAgLy8gZG9jdW1lbnQudGl0bGUgPSBkaWZmIC8vIFRPRE86IGNsZWFudXAKCiAgICB2YXIgbWUgPSB0aGlzOwogICAgdGhpcy5wbGF5VGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBtZS5wbGF5TmV4dCgpOwogICAgfSwgaW50ZXJ2YWwpOwogIH07CgogIC8qKgogICAqIFRvZ2dsZSBzdGFydCBvciBzdG9wIHBsYXlpbmcKICAgKi8KICBTbGlkZXIucHJvdG90eXBlLnRvZ2dsZVBsYXkgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5wbGF5VGltZW91dCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMucGxheSgpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5zdG9wKCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU3RhcnQgcGxheWluZwogICAqLwogIFNsaWRlci5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIFRlc3Qgd2hldGhlciBhbHJlYWR5IHBsYXlpbmcKICAgIGlmICh0aGlzLnBsYXlUaW1lb3V0KSByZXR1cm47CgogICAgdGhpcy5wbGF5TmV4dCgpOwoKICAgIGlmICh0aGlzLmZyYW1lKSB7CiAgICAgIHRoaXMuZnJhbWUucGxheS52YWx1ZSA9ICdTdG9wJzsKICAgIH0KICB9OwoKICAvKioKICAgKiBTdG9wIHBsYXlpbmcKICAgKi8KICBTbGlkZXIucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAoKSB7CiAgICBjbGVhckludGVydmFsKHRoaXMucGxheVRpbWVvdXQpOwogICAgdGhpcy5wbGF5VGltZW91dCA9IHVuZGVmaW5lZDsKCiAgICBpZiAodGhpcy5mcmFtZSkgewogICAgICB0aGlzLmZyYW1lLnBsYXkudmFsdWUgPSAnUGxheSc7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU2V0IGEgY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggd2lsbCBiZSB0cmlnZ2VyZWQgd2hlbiB0aGUgdmFsdWUgb2YgdGhlCiAgICogc2xpZGVyIGJhciBoYXMgY2hhbmdlZC4KICAgKi8KICBTbGlkZXIucHJvdG90eXBlLnNldE9uQ2hhbmdlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgIHRoaXMub25DaGFuZ2VDYWxsYmFjayA9IGNhbGxiYWNrOwogIH07CgogIC8qKgogICAqIFNldCB0aGUgaW50ZXJ2YWwgZm9yIHBsYXlpbmcgdGhlIGxpc3QKICAgKiBAcGFyYW0ge051bWJlcn0gaW50ZXJ2YWwgICBUaGUgaW50ZXJ2YWwgaW4gbWlsbGlzZWNvbmRzCiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5zZXRQbGF5SW50ZXJ2YWwgPSBmdW5jdGlvbiAoaW50ZXJ2YWwpIHsKICAgIHRoaXMucGxheUludGVydmFsID0gaW50ZXJ2YWw7CiAgfTsKCiAgLyoqCiAgICogUmV0cmlldmUgdGhlIGN1cnJlbnQgcGxheSBpbnRlcnZhbAogICAqIEByZXR1cm4ge051bWJlcn0gaW50ZXJ2YWwgICBUaGUgaW50ZXJ2YWwgaW4gbWlsbGlzZWNvbmRzCiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5nZXRQbGF5SW50ZXJ2YWwgPSBmdW5jdGlvbiAoaW50ZXJ2YWwpIHsKICAgIHJldHVybiB0aGlzLnBsYXlJbnRlcnZhbDsKICB9OwoKICAvKioKICAgKiBTZXQgbG9vcGluZyBvbiBvciBvZmYKICAgKiBAcGFyYXJtIHtib29sZWFufSBkb0xvb3AgIElmIHRydWUsIHRoZSBzbGlkZXIgd2lsbCBqdW1wIHRvIHRoZSBzdGFydCB3aGVuCiAgICogICAgICAgICAgICAgICB0aGUgZW5kIGlzIHBhc3NlZCwgYW5kIHdpbGwganVtcCB0byB0aGUgZW5kCiAgICogICAgICAgICAgICAgICB3aGVuIHRoZSBzdGFydCBpcyBwYXNzZWQuCiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5zZXRQbGF5TG9vcCA9IGZ1bmN0aW9uIChkb0xvb3ApIHsKICAgIHRoaXMucGxheUxvb3AgPSBkb0xvb3A7CiAgfTsKCiAgLyoqCiAgICogRXhlY3V0ZSB0aGUgb25jaGFuZ2UgY2FsbGJhY2sgZnVuY3Rpb24KICAgKi8KICBTbGlkZXIucHJvdG90eXBlLm9uQ2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMub25DaGFuZ2VDYWxsYmFjayAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMub25DaGFuZ2VDYWxsYmFjaygpOwogICAgfQogIH07CgogIC8qKgogICAqIHJlZHJhdyB0aGUgc2xpZGVyIG9uIHRoZSBjb3JyZWN0IHBsYWNlCiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5mcmFtZSkgewogICAgICAvLyByZXNpemUgdGhlIGJhcgogICAgICB0aGlzLmZyYW1lLmJhci5zdHlsZS50b3AgPSB0aGlzLmZyYW1lLmNsaWVudEhlaWdodCAvIDIgLSB0aGlzLmZyYW1lLmJhci5vZmZzZXRIZWlnaHQgLyAyICsgJ3B4JzsKICAgICAgdGhpcy5mcmFtZS5iYXIuc3R5bGUud2lkdGggPSB0aGlzLmZyYW1lLmNsaWVudFdpZHRoIC0gdGhpcy5mcmFtZS5wcmV2LmNsaWVudFdpZHRoIC0gdGhpcy5mcmFtZS5wbGF5LmNsaWVudFdpZHRoIC0gdGhpcy5mcmFtZS5uZXh0LmNsaWVudFdpZHRoIC0gMzAgKyAncHgnOwoKICAgICAgLy8gcG9zaXRpb24gdGhlIHNsaWRlciBidXR0b24KICAgICAgdmFyIGxlZnQgPSB0aGlzLmluZGV4VG9MZWZ0KHRoaXMuaW5kZXgpOwogICAgICB0aGlzLmZyYW1lLnNsaWRlLnN0eWxlLmxlZnQgPSBsZWZ0ICsgJ3B4JzsKICAgIH0KICB9OwoKICAvKioKICAgKiBTZXQgdGhlIGxpc3Qgd2l0aCB2YWx1ZXMgZm9yIHRoZSBzbGlkZXIKICAgKiBAcGFyYW0ge0FycmF5fSB2YWx1ZXMgICBBIGphdmFzY3JpcHQgYXJyYXkgd2l0aCB2YWx1ZXMgKGFueSB0eXBlKQogICAqLwogIFNsaWRlci5wcm90b3R5cGUuc2V0VmFsdWVzID0gZnVuY3Rpb24gKHZhbHVlcykgewogICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXM7CgogICAgaWYgKHRoaXMudmFsdWVzLmxlbmd0aCA+IDApIHRoaXMuc2V0SW5kZXgoMCk7ZWxzZSB0aGlzLmluZGV4ID0gdW5kZWZpbmVkOwogIH07CgogIC8qKgogICAqIFNlbGVjdCBhIHZhbHVlIGJ5IGl0cyBpbmRleAogICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleAogICAqLwogIFNsaWRlci5wcm90b3R5cGUuc2V0SW5kZXggPSBmdW5jdGlvbiAoaW5kZXgpIHsKICAgIGlmIChpbmRleCA8IHRoaXMudmFsdWVzLmxlbmd0aCkgewogICAgICB0aGlzLmluZGV4ID0gaW5kZXg7CgogICAgICB0aGlzLnJlZHJhdygpOwogICAgICB0aGlzLm9uQ2hhbmdlKCk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyAnRXJyb3I6IGluZGV4IG91dCBvZiByYW5nZSc7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogcmV0cmlldmUgdGhlIGluZGV4IG9mIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgdmF1ZQogICAqIEByZXR1cm4ge051bWJlcn0gaW5kZXgKICAgKi8KICBTbGlkZXIucHJvdG90eXBlLmdldEluZGV4ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuaW5kZXg7CiAgfTsKCiAgLyoqCiAgICogcmV0cmlldmUgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCB2YWx1ZQogICAqIEByZXR1cm4geyp9IHZhbHVlCiAgICovCiAgU2xpZGVyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy52YWx1ZXNbdGhpcy5pbmRleF07CiAgfTsKCiAgU2xpZGVyLnByb3RvdHlwZS5fb25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIC8vIG9ubHkgcmVhY3Qgb24gbGVmdCBtb3VzZSBidXR0b24gZG93bgogICAgdmFyIGxlZnRCdXR0b25Eb3duID0gZXZlbnQud2hpY2ggPyBldmVudC53aGljaCA9PT0gMSA6IGV2ZW50LmJ1dHRvbiA9PT0gMTsKICAgIGlmICghbGVmdEJ1dHRvbkRvd24pIHJldHVybjsKCiAgICB0aGlzLnN0YXJ0Q2xpZW50WCA9IGV2ZW50LmNsaWVudFg7CiAgICB0aGlzLnN0YXJ0U2xpZGVYID0gcGFyc2VGbG9hdCh0aGlzLmZyYW1lLnNsaWRlLnN0eWxlLmxlZnQpOwoKICAgIHRoaXMuZnJhbWUuc3R5bGUuY3Vyc29yID0gJ21vdmUnOwoKICAgIC8vIGFkZCBldmVudCBsaXN0ZW5lcnMgdG8gaGFuZGxlIG1vdmluZyB0aGUgY29udGVudHMKICAgIC8vIHdlIHN0b3JlIHRoZSBmdW5jdGlvbiBvbm1vdXNlbW92ZSBhbmQgb25tb3VzZXVwIGluIHRoZSBncmFwaCwgc28gd2UgY2FuCiAgICAvLyByZW1vdmUgdGhlIGV2ZW50bGlzdGVuZXJzIGxhdGVyb24gaW4gdGhlIGZ1bmN0aW9uIG1vdXNlVXAoKQogICAgdmFyIG1lID0gdGhpczsKICAgIHRoaXMub25tb3VzZW1vdmUgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgbWUuX29uTW91c2VNb3ZlKGV2ZW50KTsKICAgIH07CiAgICB0aGlzLm9ubW91c2V1cCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICBtZS5fb25Nb3VzZVVwKGV2ZW50KTsKICAgIH07CiAgICB1dGlsLmFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQsICdtb3VzZW1vdmUnLCB0aGlzLm9ubW91c2Vtb3ZlKTsKICAgIHV0aWwuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudCwgJ21vdXNldXAnLCB0aGlzLm9ubW91c2V1cCk7CiAgICB1dGlsLnByZXZlbnREZWZhdWx0KGV2ZW50KTsKICB9OwoKICBTbGlkZXIucHJvdG90eXBlLmxlZnRUb0luZGV4ID0gZnVuY3Rpb24gKGxlZnQpIHsKICAgIHZhciB3aWR0aCA9IHBhcnNlRmxvYXQodGhpcy5mcmFtZS5iYXIuc3R5bGUud2lkdGgpIC0gdGhpcy5mcmFtZS5zbGlkZS5jbGllbnRXaWR0aCAtIDEwOwogICAgdmFyIHggPSBsZWZ0IC0gMzsKCiAgICB2YXIgaW5kZXggPSBNYXRoLnJvdW5kKHggLyB3aWR0aCAqICh0aGlzLnZhbHVlcy5sZW5ndGggLSAxKSk7CiAgICBpZiAoaW5kZXggPCAwKSBpbmRleCA9IDA7CiAgICBpZiAoaW5kZXggPiB0aGlzLnZhbHVlcy5sZW5ndGggLSAxKSBpbmRleCA9IHRoaXMudmFsdWVzLmxlbmd0aCAtIDE7CgogICAgcmV0dXJuIGluZGV4OwogIH07CgogIFNsaWRlci5wcm90b3R5cGUuaW5kZXhUb0xlZnQgPSBmdW5jdGlvbiAoaW5kZXgpIHsKICAgIHZhciB3aWR0aCA9IHBhcnNlRmxvYXQodGhpcy5mcmFtZS5iYXIuc3R5bGUud2lkdGgpIC0gdGhpcy5mcmFtZS5zbGlkZS5jbGllbnRXaWR0aCAtIDEwOwoKICAgIHZhciB4ID0gaW5kZXggLyAodGhpcy52YWx1ZXMubGVuZ3RoIC0gMSkgKiB3aWR0aDsKICAgIHZhciBsZWZ0ID0geCArIDM7CgogICAgcmV0dXJuIGxlZnQ7CiAgfTsKCiAgU2xpZGVyLnByb3RvdHlwZS5fb25Nb3VzZU1vdmUgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHZhciBkaWZmID0gZXZlbnQuY2xpZW50WCAtIHRoaXMuc3RhcnRDbGllbnRYOwogICAgdmFyIHggPSB0aGlzLnN0YXJ0U2xpZGVYICsgZGlmZjsKCiAgICB2YXIgaW5kZXggPSB0aGlzLmxlZnRUb0luZGV4KHgpOwoKICAgIHRoaXMuc2V0SW5kZXgoaW5kZXgpOwoKICAgIHV0aWwucHJldmVudERlZmF1bHQoKTsKICB9OwoKICBTbGlkZXIucHJvdG90eXBlLl9vbk1vdXNlVXAgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHRoaXMuZnJhbWUuc3R5bGUuY3Vyc29yID0gJ2F1dG8nOwoKICAgIC8vIHJlbW92ZSBldmVudCBsaXN0ZW5lcnMKICAgIHV0aWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihkb2N1bWVudCwgJ21vdXNlbW92ZScsIHRoaXMub25tb3VzZW1vdmUpOwogICAgdXRpbC5yZW1vdmVFdmVudExpc3RlbmVyKGRvY3VtZW50LCAnbW91c2V1cCcsIHRoaXMub25tb3VzZXVwKTsKCiAgICB1dGlsLnByZXZlbnREZWZhdWx0KCk7CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBTbGlkZXI7CgovKioqLyB9LAovKiAxOCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgLyoqCiAgICogQHByb3RvdHlwZSBTdGVwTnVtYmVyCiAgICogVGhlIGNsYXNzIFN0ZXBOdW1iZXIgaXMgYW4gaXRlcmF0b3IgZm9yIE51bWJlcnMuIFlvdSBwcm92aWRlIGEgc3RhcnQgYW5kIGVuZAogICAqIHZhbHVlLCBhbmQgYSBiZXN0IHN0ZXAgc2l6ZS4gU3RlcE51bWJlciBpdHNlbGYgcm91bmRzIHRvIGZpeGVkIHZhbHVlcyBhbmQKICAgKiBhIGZpbmRzIHRoZSBzdGVwIHRoYXQgYmVzdCBmaXRzIHRoZSBwcm92aWRlZCBzdGVwLgogICAqCiAgICogSWYgcHJldHR5U3RlcCBpcyB0cnVlLCB0aGUgc3RlcCBzaXplIGlzIGNob3NlbiBhcyBjbG9zZSBhcyBwb3NzaWJsZSB0byB0aGUKICAgKiBwcm92aWRlZCBzdGVwLCBidXQgYmVpbmcgYSByb3VuZCB2YWx1ZSBsaWtlIDEsIDIsIDUsIDEwLCAyMCwgNTAsIC4uLi4KICAgKgogICAqIEV4YW1wbGUgdXNhZ2U6CiAgICogICB2YXIgc3RlcCA9IG5ldyBTdGVwTnVtYmVyKDAsIDEwLCAyLjUsIHRydWUpOwogICAqICAgc3RlcC5zdGFydCgpOwogICAqICAgd2hpbGUgKCFzdGVwLmVuZCgpKSB7CiAgICogICBhbGVydChzdGVwLmdldEN1cnJlbnQoKSk7CiAgICogICBzdGVwLm5leHQoKTsKICAgKiAgIH0KICAgKgogICAqIFZlcnNpb246IDEuMAogICAqCiAgICogQHBhcmFtIHtOdW1iZXJ9IHN0YXJ0ICAgICBUaGUgc3RhcnQgdmFsdWUKICAgKiBAcGFyYW0ge051bWJlcn0gZW5kICAgICBUaGUgZW5kIHZhbHVlCiAgICogQHBhcmFtIHtOdW1iZXJ9IHN0ZXAgICAgT3B0aW9uYWwuIFN0ZXAgc2l6ZS4gTXVzdCBiZSBhIHBvc2l0aXZlIHZhbHVlLgogICAqIEBwYXJhbSB7Ym9vbGVhbn0gcHJldHR5U3RlcCBPcHRpb25hbC4gSWYgdHJ1ZSwgdGhlIHN0ZXAgc2l6ZSBpcyByb3VuZGVkCiAgICogICAgICAgICAgICAgICBUbyBhIHByZXR0eSBzdGVwIHNpemUgKGxpa2UgMSwgMiwgNSwgMTAsIDIwLCA1MCwgLi4uKQogICAqLwogICJ1c2Ugc3RyaWN0IjsKCiAgZnVuY3Rpb24gU3RlcE51bWJlcihzdGFydCwgZW5kLCBzdGVwLCBwcmV0dHlTdGVwKSB7CiAgICAvLyBzZXQgZGVmYXVsdCB2YWx1ZXMKICAgIHRoaXMuX3N0YXJ0ID0gMDsKICAgIHRoaXMuX2VuZCA9IDA7CiAgICB0aGlzLl9zdGVwID0gMTsKICAgIHRoaXMucHJldHR5U3RlcCA9IHRydWU7CiAgICB0aGlzLnByZWNpc2lvbiA9IDU7CgogICAgdGhpcy5fY3VycmVudCA9IDA7CiAgICB0aGlzLnNldFJhbmdlKHN0YXJ0LCBlbmQsIHN0ZXAsIHByZXR0eVN0ZXApOwogIH07CgogIC8qKgogICAqIFNldCBhIG5ldyByYW5nZTogc3RhcnQsIGVuZCBhbmQgc3RlcC4KICAgKgogICAqIEBwYXJhbSB7TnVtYmVyfSBzdGFydCAgICAgVGhlIHN0YXJ0IHZhbHVlCiAgICogQHBhcmFtIHtOdW1iZXJ9IGVuZCAgICAgVGhlIGVuZCB2YWx1ZQogICAqIEBwYXJhbSB7TnVtYmVyfSBzdGVwICAgIE9wdGlvbmFsLiBTdGVwIHNpemUuIE11c3QgYmUgYSBwb3NpdGl2ZSB2YWx1ZS4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IHByZXR0eVN0ZXAgT3B0aW9uYWwuIElmIHRydWUsIHRoZSBzdGVwIHNpemUgaXMgcm91bmRlZAogICAqICAgICAgICAgICAgICAgVG8gYSBwcmV0dHkgc3RlcCBzaXplIChsaWtlIDEsIDIsIDUsIDEwLCAyMCwgNTAsIC4uLikKICAgKi8KICBTdGVwTnVtYmVyLnByb3RvdHlwZS5zZXRSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCwgZW5kLCBzdGVwLCBwcmV0dHlTdGVwKSB7CiAgICB0aGlzLl9zdGFydCA9IHN0YXJ0ID8gc3RhcnQgOiAwOwogICAgdGhpcy5fZW5kID0gZW5kID8gZW5kIDogMDsKCiAgICB0aGlzLnNldFN0ZXAoc3RlcCwgcHJldHR5U3RlcCk7CiAgfTsKCiAgLyoqCiAgICogU2V0IGEgbmV3IHN0ZXAgc2l6ZQogICAqIEBwYXJhbSB7TnVtYmVyfSBzdGVwICAgIE5ldyBzdGVwIHNpemUuIE11c3QgYmUgYSBwb3NpdGl2ZSB2YWx1ZQogICAqIEBwYXJhbSB7Ym9vbGVhbn0gcHJldHR5U3RlcCBPcHRpb25hbC4gSWYgdHJ1ZSwgdGhlIHByb3ZpZGVkIHN0ZXAgaXMgcm91bmRlZAogICAqICAgICAgICAgICAgICAgdG8gYSBwcmV0dHkgc3RlcCBzaXplIChsaWtlIDEsIDIsIDUsIDEwLCAyMCwgNTAsIC4uLikKICAgKi8KICBTdGVwTnVtYmVyLnByb3RvdHlwZS5zZXRTdGVwID0gZnVuY3Rpb24gKHN0ZXAsIHByZXR0eVN0ZXApIHsKICAgIGlmIChzdGVwID09PSB1bmRlZmluZWQgfHwgc3RlcCA8PSAwKSByZXR1cm47CgogICAgaWYgKHByZXR0eVN0ZXAgIT09IHVuZGVmaW5lZCkgdGhpcy5wcmV0dHlTdGVwID0gcHJldHR5U3RlcDsKCiAgICBpZiAodGhpcy5wcmV0dHlTdGVwID09PSB0cnVlKSB0aGlzLl9zdGVwID0gU3RlcE51bWJlci5jYWxjdWxhdGVQcmV0dHlTdGVwKHN0ZXApO2Vsc2UgdGhpcy5fc3RlcCA9IHN0ZXA7CiAgfTsKCiAgLyoqCiAgICogQ2FsY3VsYXRlIGEgbmljZSBzdGVwIHNpemUsIGNsb3Nlc3QgdG8gdGhlIGRlc2lyZWQgc3RlcCBzaXplLgogICAqIFJldHVybnMgYSB2YWx1ZSBpbiBvbmUgb2YgdGhlIHJhbmdlcyAxKjEwXm4sIDIqMTBebiwgb3IgNSoxMF5uLCB3aGVyZSBuIGlzIGFuCiAgICogaW50ZWdlciBOdW1iZXIuIEZvciBleGFtcGxlIDEsIDIsIDUsIDEwLCAyMCwgNTAsIGV0Yy4uLgogICAqIEBwYXJhbSB7TnVtYmVyfSAgc3RlcCAgRGVzaXJlZCBzdGVwIHNpemUKICAgKiBAcmV0dXJuIHtOdW1iZXJ9ICAgICBOaWNlIHN0ZXAgc2l6ZQogICAqLwogIFN0ZXBOdW1iZXIuY2FsY3VsYXRlUHJldHR5U3RlcCA9IGZ1bmN0aW9uIChzdGVwKSB7CiAgICB2YXIgbG9nMTAgPSBmdW5jdGlvbiBsb2cxMCh4KSB7CiAgICAgIHJldHVybiBNYXRoLmxvZyh4KSAvIE1hdGguTE4xMDsKICAgIH07CgogICAgLy8gdHJ5IHRocmVlIHN0ZXBzIChtdWx0aXBsZSBvZiAxLCAyLCBvciA1CiAgICB2YXIgc3RlcDEgPSBNYXRoLnBvdygxMCwgTWF0aC5yb3VuZChsb2cxMChzdGVwKSkpLAogICAgICAgIHN0ZXAyID0gMiAqIE1hdGgucG93KDEwLCBNYXRoLnJvdW5kKGxvZzEwKHN0ZXAgLyAyKSkpLAogICAgICAgIHN0ZXA1ID0gNSAqIE1hdGgucG93KDEwLCBNYXRoLnJvdW5kKGxvZzEwKHN0ZXAgLyA1KSkpOwoKICAgIC8vIGNob29zZSB0aGUgYmVzdCBzdGVwIChjbG9zZXN0IHRvIG1pbmltdW0gc3RlcCkKICAgIHZhciBwcmV0dHlTdGVwID0gc3RlcDE7CiAgICBpZiAoTWF0aC5hYnMoc3RlcDIgLSBzdGVwKSA8PSBNYXRoLmFicyhwcmV0dHlTdGVwIC0gc3RlcCkpIHByZXR0eVN0ZXAgPSBzdGVwMjsKICAgIGlmIChNYXRoLmFicyhzdGVwNSAtIHN0ZXApIDw9IE1hdGguYWJzKHByZXR0eVN0ZXAgLSBzdGVwKSkgcHJldHR5U3RlcCA9IHN0ZXA1OwoKICAgIC8vIGZvciBzYWZldHkKICAgIGlmIChwcmV0dHlTdGVwIDw9IDApIHsKICAgICAgcHJldHR5U3RlcCA9IDE7CiAgICB9CgogICAgcmV0dXJuIHByZXR0eVN0ZXA7CiAgfTsKCiAgLyoqCiAgICogcmV0dXJucyB0aGUgY3VycmVudCB2YWx1ZSBvZiB0aGUgc3RlcAogICAqIEByZXR1cm4ge051bWJlcn0gY3VycmVudCB2YWx1ZQogICAqLwogIFN0ZXBOdW1iZXIucHJvdG90eXBlLmdldEN1cnJlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gcGFyc2VGbG9hdCh0aGlzLl9jdXJyZW50LnRvUHJlY2lzaW9uKHRoaXMucHJlY2lzaW9uKSk7CiAgfTsKCiAgLyoqCiAgICogcmV0dXJucyB0aGUgY3VycmVudCBzdGVwIHNpemUKICAgKiBAcmV0dXJuIHtOdW1iZXJ9IGN1cnJlbnQgc3RlcCBzaXplCiAgICovCiAgU3RlcE51bWJlci5wcm90b3R5cGUuZ2V0U3RlcCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLl9zdGVwOwogIH07CgogIC8qKgogICAqIFNldCB0aGUgY3VycmVudCB2YWx1ZSB0byB0aGUgbGFyZ2VzdCB2YWx1ZSBzbWFsbGVyIHRoYW4gc3RhcnQsIHdoaWNoCiAgICogaXMgYSBtdWx0aXBsZSBvZiB0aGUgc3RlcCBzaXplCiAgICovCiAgU3RlcE51bWJlci5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5fc3RhcnQgLSB0aGlzLl9zdGFydCAlIHRoaXMuX3N0ZXA7CiAgfTsKCiAgLyoqCiAgICogRG8gYSBzdGVwLCBhZGQgdGhlIHN0ZXAgc2l6ZSB0byB0aGUgY3VycmVudCB2YWx1ZQogICAqLwogIFN0ZXBOdW1iZXIucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLl9jdXJyZW50ICs9IHRoaXMuX3N0ZXA7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJucyB0cnVlIHdoZXRoZXIgdGhlIGVuZCBpcyByZWFjaGVkCiAgICogQHJldHVybiB7Ym9vbGVhbn0gIFRydWUgaWYgdGhlIGN1cnJlbnQgdmFsdWUgaGFzIHBhc3NlZCB0aGUgZW5kIHZhbHVlLgogICAqLwogIFN0ZXBOdW1iZXIucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLl9jdXJyZW50ID4gdGhpcy5fZW5kOwogIH07CgogIG1vZHVsZS5leHBvcnRzID0gU3RlcE51bWJlcjsKCi8qKiovIH0sCi8qIDE5ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciBFbWl0dGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7CiAgdmFyIEhhbW1lciA9IF9fd2VicGFja19yZXF1aXJlX18oMjMpOwogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKICB2YXIgRGF0YVNldCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7CiAgdmFyIERhdGFWaWV3ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7CiAgdmFyIFJhbmdlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNyk7CiAgdmFyIENvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMwKTsKICB2YXIgVGltZUF4aXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxKTsKICB2YXIgQ3VycmVudFRpbWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwKTsKICB2YXIgQ3VzdG9tVGltZSA9IF9fd2VicGFja19yZXF1aXJlX18oNDQpOwogIHZhciBJdGVtU2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMSk7CgogIHZhciBDb25maWd1cmF0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1KTsKICB2YXIgVmFsaWRhdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NylbJ2RlZmF1bHQnXTsKICB2YXIgcHJpbnRTdHlsZSA9IF9fd2VicGFja19yZXF1aXJlX18oNDcpLnByaW50U3R5bGU7CiAgdmFyIGFsbE9wdGlvbnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4KS5hbGxPcHRpb25zOwogIHZhciBjb25maWd1cmVPcHRpb25zID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0OCkuY29uZmlndXJlT3B0aW9uczsKCiAgLyoqCiAgICogQ3JlYXRlIGEgdGltZWxpbmUgdmlzdWFsaXphdGlvbgogICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGNvbnRhaW5lcgogICAqIEBwYXJhbSB7dmlzLkRhdGFTZXQgfCB2aXMuRGF0YVZpZXcgfCBBcnJheX0gW2l0ZW1zXQogICAqIEBwYXJhbSB7dmlzLkRhdGFTZXQgfCB2aXMuRGF0YVZpZXcgfCBBcnJheX0gW2dyb3Vwc10KICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICBTZWUgVGltZWxpbmUuc2V0T3B0aW9ucyBmb3IgdGhlIGF2YWlsYWJsZSBvcHRpb25zLgogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBleHRlbmRzIENvcmUKICAgKi8KICBmdW5jdGlvbiBUaW1lbGluZShjb250YWluZXIsIGl0ZW1zLCBncm91cHMsIG9wdGlvbnMpIHsKICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBUaW1lbGluZSkpIHsKICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCdDb25zdHJ1Y3RvciBtdXN0IGJlIGNhbGxlZCB3aXRoIHRoZSBuZXcgb3BlcmF0b3InKTsKICAgIH0KCiAgICAvLyBpZiB0aGUgdGhpcmQgZWxlbWVudCBpcyBvcHRpb25zLCB0aGUgZm9ydGggaXMgZ3JvdXBzIChvcHRpb25hbGx5KTsKICAgIGlmICghKEFycmF5LmlzQXJyYXkoZ3JvdXBzKSB8fCBncm91cHMgaW5zdGFuY2VvZiBEYXRhU2V0IHx8IGdyb3VwcyBpbnN0YW5jZW9mIERhdGFWaWV3KSAmJiBncm91cHMgaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgdmFyIGZvcnRoQXJndW1lbnQgPSBvcHRpb25zOwogICAgICBvcHRpb25zID0gZ3JvdXBzOwogICAgICBncm91cHMgPSBmb3J0aEFyZ3VtZW50OwogICAgfQoKICAgIHZhciBtZSA9IHRoaXM7CiAgICB0aGlzLmRlZmF1bHRPcHRpb25zID0gewogICAgICBzdGFydDogbnVsbCwKICAgICAgZW5kOiBudWxsLAoKICAgICAgYXV0b1Jlc2l6ZTogdHJ1ZSwKCiAgICAgIG9yaWVudGF0aW9uOiB7CiAgICAgICAgYXhpczogJ2JvdHRvbScsIC8vIGF4aXMgb3JpZW50YXRpb246ICdib3R0b20nLCAndG9wJywgb3IgJ2JvdGgnCiAgICAgICAgaXRlbTogJ2JvdHRvbScgLy8gbm90IHJlbGV2YW50CiAgICAgIH0sCgogICAgICB3aWR0aDogbnVsbCwKICAgICAgaGVpZ2h0OiBudWxsLAogICAgICBtYXhIZWlnaHQ6IG51bGwsCiAgICAgIG1pbkhlaWdodDogbnVsbAogICAgfTsKICAgIHRoaXMub3B0aW9ucyA9IHV0aWwuZGVlcEV4dGVuZCh7fSwgdGhpcy5kZWZhdWx0T3B0aW9ucyk7CgogICAgLy8gQ3JlYXRlIHRoZSBET00sIHByb3BzLCBhbmQgZW1pdHRlcgogICAgdGhpcy5fY3JlYXRlKGNvbnRhaW5lcik7CgogICAgLy8gYWxsIGNvbXBvbmVudHMgbGlzdGVkIGhlcmUgd2lsbCBiZSByZXBhaW50ZWQgYXV0b21hdGljYWxseQogICAgdGhpcy5jb21wb25lbnRzID0gW107CgogICAgdGhpcy5ib2R5ID0gewogICAgICBkb206IHRoaXMuZG9tLAogICAgICBkb21Qcm9wczogdGhpcy5wcm9wcywKICAgICAgZW1pdHRlcjogewogICAgICAgIG9uOiB0aGlzLm9uLmJpbmQodGhpcyksCiAgICAgICAgb2ZmOiB0aGlzLm9mZi5iaW5kKHRoaXMpLAogICAgICAgIGVtaXQ6IHRoaXMuZW1pdC5iaW5kKHRoaXMpCiAgICAgIH0sCiAgICAgIGhpZGRlbkRhdGVzOiBbXSwKICAgICAgdXRpbDogewogICAgICAgIGdldFNjYWxlOiBmdW5jdGlvbiBnZXRTY2FsZSgpIHsKICAgICAgICAgIHJldHVybiBtZS50aW1lQXhpcy5zdGVwLnNjYWxlOwogICAgICAgIH0sCiAgICAgICAgZ2V0U3RlcDogZnVuY3Rpb24gZ2V0U3RlcCgpIHsKICAgICAgICAgIHJldHVybiBtZS50aW1lQXhpcy5zdGVwLnN0ZXA7CiAgICAgICAgfSwKCiAgICAgICAgdG9TY3JlZW46IG1lLl90b1NjcmVlbi5iaW5kKG1lKSwKICAgICAgICB0b0dsb2JhbFNjcmVlbjogbWUuX3RvR2xvYmFsU2NyZWVuLmJpbmQobWUpLCAvLyB0aGlzIHJlZmVycyB0byB0aGUgcm9vdC53aWR0aAogICAgICAgIHRvVGltZTogbWUuX3RvVGltZS5iaW5kKG1lKSwKICAgICAgICB0b0dsb2JhbFRpbWU6IG1lLl90b0dsb2JhbFRpbWUuYmluZChtZSkKICAgICAgfQogICAgfTsKCiAgICAvLyByYW5nZQogICAgdGhpcy5yYW5nZSA9IG5ldyBSYW5nZSh0aGlzLmJvZHkpOwogICAgdGhpcy5jb21wb25lbnRzLnB1c2godGhpcy5yYW5nZSk7CiAgICB0aGlzLmJvZHkucmFuZ2UgPSB0aGlzLnJhbmdlOwoKICAgIC8vIHRpbWUgYXhpcwogICAgdGhpcy50aW1lQXhpcyA9IG5ldyBUaW1lQXhpcyh0aGlzLmJvZHkpOwogICAgdGhpcy50aW1lQXhpczIgPSBudWxsOyAvLyB1c2VkIGluIGNhc2Ugb2Ygb3JpZW50YXRpb24gb3B0aW9uICdib3RoJwogICAgdGhpcy5jb21wb25lbnRzLnB1c2godGhpcy50aW1lQXhpcyk7CgogICAgLy8gY3VycmVudCB0aW1lIGJhcgogICAgdGhpcy5jdXJyZW50VGltZSA9IG5ldyBDdXJyZW50VGltZSh0aGlzLmJvZHkpOwogICAgdGhpcy5jb21wb25lbnRzLnB1c2godGhpcy5jdXJyZW50VGltZSk7CgogICAgLy8gaXRlbSBzZXQKICAgIHRoaXMuaXRlbVNldCA9IG5ldyBJdGVtU2V0KHRoaXMuYm9keSk7CiAgICB0aGlzLmNvbXBvbmVudHMucHVzaCh0aGlzLml0ZW1TZXQpOwoKICAgIHRoaXMuaXRlbXNEYXRhID0gbnVsbDsgLy8gRGF0YVNldAogICAgdGhpcy5ncm91cHNEYXRhID0gbnVsbDsgLy8gRGF0YVNldAoKICAgIHRoaXMub24oJ3RhcCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBtZS5lbWl0KCdjbGljaycsIG1lLmdldEV2ZW50UHJvcGVydGllcyhldmVudCkpOwogICAgfSk7CiAgICB0aGlzLm9uKCdkb3VibGV0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgbWUuZW1pdCgnZG91YmxlQ2xpY2snLCBtZS5nZXRFdmVudFByb3BlcnRpZXMoZXZlbnQpKTsKICAgIH0pOwogICAgdGhpcy5kb20ucm9vdC5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIG1lLmVtaXQoJ2NvbnRleHRtZW51JywgbWUuZ2V0RXZlbnRQcm9wZXJ0aWVzKGV2ZW50KSk7CiAgICB9OwoKICAgIC8vIGFwcGx5IG9wdGlvbnMKICAgIGlmIChvcHRpb25zKSB7CiAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTsKICAgIH0KCiAgICAvLyBJTVBPUlRBTlQ6IFRISVMgSEFQUEVOUyBCRUZPUkUgU0VUIElURU1TIQogICAgaWYgKGdyb3VwcykgewogICAgICB0aGlzLnNldEdyb3Vwcyhncm91cHMpOwogICAgfQoKICAgIC8vIGNyZWF0ZSBpdGVtc2V0CiAgICBpZiAoaXRlbXMpIHsKICAgICAgdGhpcy5zZXRJdGVtcyhpdGVtcyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9yZWRyYXcoKTsKICAgIH0KICB9CgogIC8vIEV4dGVuZCB0aGUgZnVuY3Rpb25hbGl0eSBmcm9tIENvcmUKICBUaW1lbGluZS5wcm90b3R5cGUgPSBuZXcgQ29yZSgpOwoKICAvKioKICAgKiBMb2FkIGEgY29uZmlndXJhdG9yCiAgICogQHJldHVybiB7T2JqZWN0fQogICAqIEBwcml2YXRlCiAgICovCiAgVGltZWxpbmUucHJvdG90eXBlLl9jcmVhdGVDb25maWd1cmF0b3IgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gbmV3IENvbmZpZ3VyYXRvcih0aGlzLCB0aGlzLmRvbS5jb250YWluZXIsIGNvbmZpZ3VyZU9wdGlvbnMpOwogIH07CgogIC8qKgogICAqIEZvcmNlIGEgcmVkcmF3LiBUaGUgc2l6ZSBvZiBhbGwgaXRlbXMgd2lsbCBiZSByZWNhbGN1bGF0ZWQuCiAgICogQ2FuIGJlIHVzZWZ1bCB0byBtYW51YWxseSByZWRyYXcgd2hlbiBvcHRpb24gYXV0b1Jlc2l6ZT1mYWxzZSBhbmQgdGhlIHdpbmRvdwogICAqIGhhcyBiZWVuIHJlc2l6ZWQsIG9yIHdoZW4gdGhlIGl0ZW1zIENTUyBoYXMgYmVlbiBjaGFuZ2VkLgogICAqLwogIFRpbWVsaW5lLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLml0ZW1TZXQgJiYgdGhpcy5pdGVtU2V0Lm1hcmtEaXJ0eSh7IHJlZnJlc2hJdGVtczogdHJ1ZSB9KTsKICAgIHRoaXMuX3JlZHJhdygpOwogIH07CgogIFRpbWVsaW5lLnByb3RvdHlwZS5zZXRPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIC8vIHZhbGlkYXRlIG9wdGlvbnMKICAgIHZhciBlcnJvckZvdW5kID0gVmFsaWRhdG9yLnZhbGlkYXRlKG9wdGlvbnMsIGFsbE9wdGlvbnMpOwogICAgaWYgKGVycm9yRm91bmQgPT09IHRydWUpIHsKICAgICAgY29uc29sZS5sb2coJyVjRXJyb3JzIGhhdmUgYmVlbiBmb3VuZCBpbiB0aGUgc3VwcGxpZWQgb3B0aW9ucyBvYmplY3QuJywgcHJpbnRTdHlsZSk7CiAgICB9CgogICAgQ29yZS5wcm90b3R5cGUuc2V0T3B0aW9ucy5jYWxsKHRoaXMsIG9wdGlvbnMpOwoKICAgIGlmICgndHlwZScgaW4gb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucy50eXBlICE9PSB0aGlzLm9wdGlvbnMudHlwZSkgewogICAgICAgIHRoaXMub3B0aW9ucy50eXBlID0gb3B0aW9ucy50eXBlOwoKICAgICAgICAvLyBmb3JjZSByZWNyZWF0aW9uIG9mIGFsbCBpdGVtcwogICAgICAgIHZhciBpdGVtc0RhdGEgPSB0aGlzLml0ZW1zRGF0YTsKICAgICAgICBpZiAoaXRlbXNEYXRhKSB7CiAgICAgICAgICB2YXIgc2VsZWN0aW9uID0gdGhpcy5nZXRTZWxlY3Rpb24oKTsKICAgICAgICAgIHRoaXMuc2V0SXRlbXMobnVsbCk7IC8vIHJlbW92ZSBhbGwKICAgICAgICAgIHRoaXMuc2V0SXRlbXMoaXRlbXNEYXRhKTsgLy8gYWRkIGFsbAogICAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24oc2VsZWN0aW9uKTsgLy8gcmVzdG9yZSBzZWxlY3Rpb24KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBTZXQgaXRlbXMKICAgKiBAcGFyYW0ge3Zpcy5EYXRhU2V0IHwgQXJyYXkgfCBudWxsfSBpdGVtcwogICAqLwogIFRpbWVsaW5lLnByb3RvdHlwZS5zZXRJdGVtcyA9IGZ1bmN0aW9uIChpdGVtcykgewogICAgdmFyIGluaXRpYWxMb2FkID0gdGhpcy5pdGVtc0RhdGEgPT0gbnVsbDsKCiAgICAvLyBjb252ZXJ0IHRvIHR5cGUgRGF0YVNldCB3aGVuIG5lZWRlZAogICAgdmFyIG5ld0RhdGFTZXQ7CiAgICBpZiAoIWl0ZW1zKSB7CiAgICAgIG5ld0RhdGFTZXQgPSBudWxsOwogICAgfSBlbHNlIGlmIChpdGVtcyBpbnN0YW5jZW9mIERhdGFTZXQgfHwgaXRlbXMgaW5zdGFuY2VvZiBEYXRhVmlldykgewogICAgICBuZXdEYXRhU2V0ID0gaXRlbXM7CiAgICB9IGVsc2UgewogICAgICAvLyB0dXJuIGFuIGFycmF5IGludG8gYSBkYXRhc2V0CiAgICAgIG5ld0RhdGFTZXQgPSBuZXcgRGF0YVNldChpdGVtcywgewogICAgICAgIHR5cGU6IHsKICAgICAgICAgIHN0YXJ0OiAnRGF0ZScsCiAgICAgICAgICBlbmQ6ICdEYXRlJwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgLy8gc2V0IGl0ZW1zCiAgICB0aGlzLml0ZW1zRGF0YSA9IG5ld0RhdGFTZXQ7CiAgICB0aGlzLml0ZW1TZXQgJiYgdGhpcy5pdGVtU2V0LnNldEl0ZW1zKG5ld0RhdGFTZXQpOwoKICAgIGlmIChpbml0aWFsTG9hZCkgewogICAgICBpZiAodGhpcy5vcHRpb25zLnN0YXJ0ICE9IHVuZGVmaW5lZCB8fCB0aGlzLm9wdGlvbnMuZW5kICE9IHVuZGVmaW5lZCkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc3RhcnQgPT0gdW5kZWZpbmVkIHx8IHRoaXMub3B0aW9ucy5lbmQgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgcmFuZ2UgPSB0aGlzLmdldEl0ZW1SYW5nZSgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5vcHRpb25zLnN0YXJ0ICE9IHVuZGVmaW5lZCA/IHRoaXMub3B0aW9ucy5zdGFydCA6IHJhbmdlLm1pbjsKICAgICAgICB2YXIgZW5kID0gdGhpcy5vcHRpb25zLmVuZCAhPSB1bmRlZmluZWQgPyB0aGlzLm9wdGlvbnMuZW5kIDogcmFuZ2UubWF4OwoKICAgICAgICB0aGlzLnNldFdpbmRvdyhzdGFydCwgZW5kLCB7IGFuaW1hdGlvbjogZmFsc2UgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maXQoeyBhbmltYXRpb246IGZhbHNlIH0pOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU2V0IGdyb3VwcwogICAqIEBwYXJhbSB7dmlzLkRhdGFTZXQgfCBBcnJheX0gZ3JvdXBzCiAgICovCiAgVGltZWxpbmUucHJvdG90eXBlLnNldEdyb3VwcyA9IGZ1bmN0aW9uIChncm91cHMpIHsKICAgIC8vIGNvbnZlcnQgdG8gdHlwZSBEYXRhU2V0IHdoZW4gbmVlZGVkCiAgICB2YXIgbmV3RGF0YVNldDsKICAgIGlmICghZ3JvdXBzKSB7CiAgICAgIG5ld0RhdGFTZXQgPSBudWxsOwogICAgfSBlbHNlIGlmIChncm91cHMgaW5zdGFuY2VvZiBEYXRhU2V0IHx8IGdyb3VwcyBpbnN0YW5jZW9mIERhdGFWaWV3KSB7CiAgICAgIG5ld0RhdGFTZXQgPSBncm91cHM7CiAgICB9IGVsc2UgewogICAgICAvLyB0dXJuIGFuIGFycmF5IGludG8gYSBkYXRhc2V0CiAgICAgIG5ld0RhdGFTZXQgPSBuZXcgRGF0YVNldChncm91cHMpOwogICAgfQoKICAgIHRoaXMuZ3JvdXBzRGF0YSA9IG5ld0RhdGFTZXQ7CiAgICB0aGlzLml0ZW1TZXQuc2V0R3JvdXBzKG5ld0RhdGFTZXQpOwogIH07CgogIC8qKgogICAqIFNldCBib3RoIGl0ZW1zIGFuZCBncm91cHMgaW4gb25lIGdvCiAgICogQHBhcmFtIHt7aXRlbXM6IEFycmF5IHwgdmlzLkRhdGFTZXQsIGdyb3VwczogQXJyYXkgfCB2aXMuRGF0YVNldH19IGRhdGEKICAgKi8KICBUaW1lbGluZS5wcm90b3R5cGUuc2V0RGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICBpZiAoZGF0YSAmJiBkYXRhLmdyb3VwcykgewogICAgICB0aGlzLnNldEdyb3VwcyhkYXRhLmdyb3Vwcyk7CiAgICB9CgogICAgaWYgKGRhdGEgJiYgZGF0YS5pdGVtcykgewogICAgICB0aGlzLnNldEl0ZW1zKGRhdGEuaXRlbXMpOwogICAgfQogIH07CgogIC8qKgogICAqIFNldCBzZWxlY3RlZCBpdGVtcyBieSB0aGVpciBpZC4gUmVwbGFjZXMgdGhlIGN1cnJlbnQgc2VsZWN0aW9uCiAgICogVW5rbm93biBpZCdzIGFyZSBzaWxlbnRseSBpZ25vcmVkLgogICAqIEBwYXJhbSB7c3RyaW5nW10gfCBzdHJpbmd9IFtpZHNdICBBbiBhcnJheSB3aXRoIHplcm8gb3IgbW9yZSBpZCdzIG9mIHRoZSBpdGVtcyB0byBiZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZC4gSWYgaWRzIGlzIGFuIGVtcHR5IGFycmF5LCBhbGwgaXRlbXMgd2lsbCBiZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNlbGVjdGVkLgogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gICAgICBBdmFpbGFibGUgb3B0aW9uczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGZvY3VzOiBib29sZWFuYAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgdHJ1ZSwgZm9jdXMgd2lsbCBiZSBzZXQgdG8gdGhlIHNlbGVjdGVkIGl0ZW0ocykKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGFuaW1hdGlvbjogYm9vbGVhbiB8IHtkdXJhdGlvbjogbnVtYmVyLCBlYXNpbmdGdW5jdGlvbjogc3RyaW5nfWAKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIHRydWUgKGRlZmF1bHQpLCB0aGUgcmFuZ2UgaXMgYW5pbWF0ZWQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtb290aGx5IHRvIHRoZSBuZXcgd2luZG93LiBBbiBvYmplY3QgY2FuIGJlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZCB0byBzcGVjaWZ5IGR1cmF0aW9uIGFuZCBlYXNpbmcgZnVuY3Rpb24uCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IGR1cmF0aW9uIGlzIDUwMCBtcywgYW5kIGRlZmF1bHQgZWFzaW5nCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBpcyAnZWFzZUluT3V0UXVhZCcuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPbmx5IGFwcGxpY2FibGUgd2hlbiBvcHRpb24gZm9jdXMgaXMgdHJ1ZS4KICAgKi8KICBUaW1lbGluZS5wcm90b3R5cGUuc2V0U2VsZWN0aW9uID0gZnVuY3Rpb24gKGlkcywgb3B0aW9ucykgewogICAgdGhpcy5pdGVtU2V0ICYmIHRoaXMuaXRlbVNldC5zZXRTZWxlY3Rpb24oaWRzKTsKCiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmZvY3VzKSB7CiAgICAgIHRoaXMuZm9jdXMoaWRzLCBvcHRpb25zKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBHZXQgdGhlIHNlbGVjdGVkIGl0ZW1zIGJ5IHRoZWlyIGlkCiAgICogQHJldHVybiB7QXJyYXl9IGlkcyAgVGhlIGlkcyBvZiB0aGUgc2VsZWN0ZWQgaXRlbXMKICAgKi8KICBUaW1lbGluZS5wcm90b3R5cGUuZ2V0U2VsZWN0aW9uID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuaXRlbVNldCAmJiB0aGlzLml0ZW1TZXQuZ2V0U2VsZWN0aW9uKCkgfHwgW107CiAgfTsKCiAgLyoqCiAgICogQWRqdXN0IHRoZSB2aXNpYmxlIHdpbmRvdyBzdWNoIHRoYXQgdGhlIHNlbGVjdGVkIGl0ZW0gKG9yIG11bHRpcGxlIGl0ZW1zKQogICAqIGFyZSBjZW50ZXJlZCBvbiBzY3JlZW4uCiAgICogQHBhcmFtIHtTdHJpbmcgfCBTdHJpbmdbXX0gaWQgICAgIEFuIGl0ZW0gaWQgb3IgYXJyYXkgd2l0aCBpdGVtIGlkcwogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gICAgICBBdmFpbGFibGUgb3B0aW9uczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGFuaW1hdGlvbjogYm9vbGVhbiB8IHtkdXJhdGlvbjogbnVtYmVyLCBlYXNpbmdGdW5jdGlvbjogc3RyaW5nfWAKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIHRydWUgKGRlZmF1bHQpLCB0aGUgcmFuZ2UgaXMgYW5pbWF0ZWQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtb290aGx5IHRvIHRoZSBuZXcgd2luZG93LiBBbiBvYmplY3QgY2FuIGJlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZCB0byBzcGVjaWZ5IGR1cmF0aW9uIGFuZCBlYXNpbmcgZnVuY3Rpb24uCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IGR1cmF0aW9uIGlzIDUwMCBtcywgYW5kIGRlZmF1bHQgZWFzaW5nCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBpcyAnZWFzZUluT3V0UXVhZCcuCiAgICovCiAgVGltZWxpbmUucHJvdG90eXBlLmZvY3VzID0gZnVuY3Rpb24gKGlkLCBvcHRpb25zKSB7CiAgICBpZiAoIXRoaXMuaXRlbXNEYXRhIHx8IGlkID09IHVuZGVmaW5lZCkgcmV0dXJuOwoKICAgIHZhciBpZHMgPSBBcnJheS5pc0FycmF5KGlkKSA/IGlkIDogW2lkXTsKCiAgICAvLyBnZXQgdGhlIHNwZWNpZmllZCBpdGVtKHMpCiAgICB2YXIgaXRlbXNEYXRhID0gdGhpcy5pdGVtc0RhdGEuZ2V0RGF0YVNldCgpLmdldChpZHMsIHsKICAgICAgdHlwZTogewogICAgICAgIHN0YXJ0OiAnRGF0ZScsCiAgICAgICAgZW5kOiAnRGF0ZScKICAgICAgfQogICAgfSk7CgogICAgLy8gY2FsY3VsYXRlIG1pbmltdW0gc3RhcnQgYW5kIG1heGltdW0gZW5kIG9mIHNwZWNpZmllZCBpdGVtcwogICAgdmFyIHN0YXJ0ID0gbnVsbDsKICAgIHZhciBlbmQgPSBudWxsOwogICAgaXRlbXNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW1EYXRhKSB7CiAgICAgIHZhciBzID0gaXRlbURhdGEuc3RhcnQudmFsdWVPZigpOwogICAgICB2YXIgZSA9ICdlbmQnIGluIGl0ZW1EYXRhID8gaXRlbURhdGEuZW5kLnZhbHVlT2YoKSA6IGl0ZW1EYXRhLnN0YXJ0LnZhbHVlT2YoKTsKCiAgICAgIGlmIChzdGFydCA9PT0gbnVsbCB8fCBzIDwgc3RhcnQpIHsKICAgICAgICBzdGFydCA9IHM7CiAgICAgIH0KCiAgICAgIGlmIChlbmQgPT09IG51bGwgfHwgZSA+IGVuZCkgewogICAgICAgIGVuZCA9IGU7CiAgICAgIH0KICAgIH0pOwoKICAgIGlmIChzdGFydCAhPT0gbnVsbCAmJiBlbmQgIT09IG51bGwpIHsKICAgICAgLy8gY2FsY3VsYXRlIHRoZSBuZXcgbWlkZGxlIGFuZCBpbnRlcnZhbCBmb3IgdGhlIHdpbmRvdwogICAgICB2YXIgbWlkZGxlID0gKHN0YXJ0ICsgZW5kKSAvIDI7CiAgICAgIHZhciBpbnRlcnZhbCA9IE1hdGgubWF4KHRoaXMucmFuZ2UuZW5kIC0gdGhpcy5yYW5nZS5zdGFydCwgKGVuZCAtIHN0YXJ0KSAqIDEuMSk7CgogICAgICB2YXIgYW5pbWF0aW9uID0gb3B0aW9ucyAmJiBvcHRpb25zLmFuaW1hdGlvbiAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5hbmltYXRpb24gOiB0cnVlOwogICAgICB0aGlzLnJhbmdlLnNldFJhbmdlKG1pZGRsZSAtIGludGVydmFsIC8gMiwgbWlkZGxlICsgaW50ZXJ2YWwgLyAyLCBhbmltYXRpb24pOwogICAgfQogIH07CgogIC8qKgogICAqIFNldCBUaW1lbGluZSB3aW5kb3cgc3VjaCB0aGF0IGl0IGZpdHMgYWxsIGl0ZW1zCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgQXZhaWxhYmxlIG9wdGlvbnM6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBhbmltYXRpb246IGJvb2xlYW4gfCB7ZHVyYXRpb246IG51bWJlciwgZWFzaW5nRnVuY3Rpb246IHN0cmluZ31gCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZiB0cnVlIChkZWZhdWx0KSwgdGhlIHJhbmdlIGlzIGFuaW1hdGVkCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbW9vdGhseSB0byB0aGUgbmV3IHdpbmRvdy4gQW4gb2JqZWN0IGNhbiBiZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWQgdG8gc3BlY2lmeSBkdXJhdGlvbiBhbmQgZWFzaW5nIGZ1bmN0aW9uLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCBkdXJhdGlvbiBpcyA1MDAgbXMsIGFuZCBkZWZhdWx0IGVhc2luZwogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gaXMgJ2Vhc2VJbk91dFF1YWQnLgogICAqLwogIFRpbWVsaW5lLnByb3RvdHlwZS5maXQgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgdmFyIGFuaW1hdGlvbiA9IG9wdGlvbnMgJiYgb3B0aW9ucy5hbmltYXRpb24gIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYW5pbWF0aW9uIDogdHJ1ZTsKICAgIHZhciByYW5nZSA9IHRoaXMuZ2V0SXRlbVJhbmdlKCk7CiAgICB0aGlzLnJhbmdlLnNldFJhbmdlKHJhbmdlLm1pbiwgcmFuZ2UubWF4LCBhbmltYXRpb24pOwogIH07CgogIC8qKgogICAqIERldGVybWluZSB0aGUgcmFuZ2Ugb2YgdGhlIGl0ZW1zLCB0YWtpbmcgaW50byBhY2NvdW50IHRoZWlyIGFjdHVhbCB3aWR0aAogICAqIGFuZCBhIG1hcmdpbiBvZiAxMCBwaXhlbHMgb24gYm90aCBzaWRlcy4KICAgKiBAcmV0dXJuIHt7bWluOiBEYXRlIHwgbnVsbCwgbWF4OiBEYXRlIHwgbnVsbH19CiAgICovCiAgVGltZWxpbmUucHJvdG90eXBlLmdldEl0ZW1SYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgLy8gZ2V0IGEgcm91Z2ggYXBwcm94aW1hdGlvbiBmb3IgdGhlIHJhbmdlIGJhc2VkIG9uIHRoZSBpdGVtcyBzdGFydCBhbmQgZW5kIGRhdGVzCiAgICB2YXIgcmFuZ2UgPSB0aGlzLmdldERhdGFSYW5nZSgpOwogICAgdmFyIG1pbiA9IHJhbmdlLm1pbjsKICAgIHZhciBtYXggPSByYW5nZS5tYXg7CiAgICB2YXIgbWluSXRlbSA9IG51bGw7CiAgICB2YXIgbWF4SXRlbSA9IG51bGw7CgogICAgaWYgKG1pbiAhPSBudWxsICYmIG1heCAhPSBudWxsKSB7CiAgICAgIHZhciBpbnRlcnZhbDsKICAgICAgdmFyIGZhY3RvcjsKICAgICAgdmFyIGxoczsKICAgICAgdmFyIHJoczsKICAgICAgdmFyIGRlbHRhOwoKICAgICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZ2V0U3RhcnQgPSBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgcmV0dXJuIHV0aWwuY29udmVydChpdGVtLmRhdGEuc3RhcnQsICdEYXRlJykudmFsdWVPZigpOwogICAgICAgIH07CgogICAgICAgIHZhciBnZXRFbmQgPSBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgdmFyIGVuZCA9IGl0ZW0uZGF0YS5lbmQgIT0gdW5kZWZpbmVkID8gaXRlbS5kYXRhLmVuZCA6IGl0ZW0uZGF0YS5zdGFydDsKICAgICAgICAgIHJldHVybiB1dGlsLmNvbnZlcnQoZW5kLCAnRGF0ZScpLnZhbHVlT2YoKTsKICAgICAgICB9OwoKICAgICAgICBpbnRlcnZhbCA9IG1heCAtIG1pbjsKICAgICAgICAvLyBtcwogICAgICAgIGlmIChpbnRlcnZhbCA8PSAwKSB7CiAgICAgICAgICBpbnRlcnZhbCA9IDEwOwogICAgICAgIH0KICAgICAgICBmYWN0b3IgPSBpbnRlcnZhbCAvIF90aGlzLnByb3BzLmNlbnRlci53aWR0aDsKCiAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSBkYXRlIG9mIHRoZSBsZWZ0IHNpZGUgYW5kIHJpZ2h0IHNpZGUgb2YgdGhlIGl0ZW1zIGdpdmVuCiAgICAgICAgdXRpbC5mb3JFYWNoKF90aGlzLml0ZW1TZXQuaXRlbXMsIChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgaXRlbS5zaG93KCk7CgogICAgICAgICAgdmFyIHN0YXJ0ID0gZ2V0U3RhcnQoaXRlbSk7CiAgICAgICAgICB2YXIgZW5kID0gZ2V0RW5kKGl0ZW0pOwoKICAgICAgICAgIHZhciBsZWZ0ID0gbmV3IERhdGUoc3RhcnQgLSAoaXRlbS5nZXRXaWR0aExlZnQoKSArIDEwKSAqIGZhY3Rvcik7CiAgICAgICAgICB2YXIgcmlnaHQgPSBuZXcgRGF0ZShlbmQgKyAoaXRlbS5nZXRXaWR0aFJpZ2h0KCkgKyAxMCkgKiBmYWN0b3IpOwoKICAgICAgICAgIGlmIChsZWZ0IDwgbWluKSB7CiAgICAgICAgICAgIG1pbiA9IGxlZnQ7CiAgICAgICAgICAgIG1pbkl0ZW0gPSBpdGVtOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHJpZ2h0ID4gbWF4KSB7CiAgICAgICAgICAgIG1heCA9IHJpZ2h0OwogICAgICAgICAgICBtYXhJdGVtID0gaXRlbTsKICAgICAgICAgIH0KICAgICAgICB9KS5iaW5kKF90aGlzKSk7CgogICAgICAgIGlmIChtaW5JdGVtICYmIG1heEl0ZW0pIHsKICAgICAgICAgIGxocyA9IG1pbkl0ZW0uZ2V0V2lkdGhMZWZ0KCkgKyAxMDsKICAgICAgICAgIHJocyA9IG1heEl0ZW0uZ2V0V2lkdGhSaWdodCgpICsgMTA7CiAgICAgICAgICBkZWx0YSA9IF90aGlzLnByb3BzLmNlbnRlci53aWR0aCAtIGxocyAtIHJoczsKICAgICAgICAgIC8vIHB4CgogICAgICAgICAgaWYgKGRlbHRhID4gMCkgewogICAgICAgICAgICBtaW4gPSBnZXRTdGFydChtaW5JdGVtKSAtIGxocyAqIGludGVydmFsIC8gZGVsdGE7IC8vIG1zCiAgICAgICAgICAgIG1heCA9IGdldEVuZChtYXhJdGVtKSArIHJocyAqIGludGVydmFsIC8gZGVsdGE7IC8vIG1zCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KSgpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIG1pbjogbWluICE9IG51bGwgPyBuZXcgRGF0ZShtaW4pIDogbnVsbCwKICAgICAgbWF4OiBtYXggIT0gbnVsbCA/IG5ldyBEYXRlKG1heCkgOiBudWxsCiAgICB9OwogIH07CgogIC8qKgogICAqIENhbGN1bGF0ZSB0aGUgZGF0YSByYW5nZSBvZiB0aGUgaXRlbXMgc3RhcnQgYW5kIGVuZCBkYXRlcwogICAqIEByZXR1cm5zIHt7bWluOiBEYXRlIHwgbnVsbCwgbWF4OiBEYXRlIHwgbnVsbH19CiAgICovCiAgVGltZWxpbmUucHJvdG90eXBlLmdldERhdGFSYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBtaW4gPSBudWxsOwogICAgdmFyIG1heCA9IG51bGw7CgogICAgdmFyIGRhdGFzZXQgPSB0aGlzLml0ZW1zRGF0YSAmJiB0aGlzLml0ZW1zRGF0YS5nZXREYXRhU2V0KCk7CiAgICBpZiAoZGF0YXNldCkgewogICAgICBkYXRhc2V0LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICB2YXIgc3RhcnQgPSB1dGlsLmNvbnZlcnQoaXRlbS5zdGFydCwgJ0RhdGUnKS52YWx1ZU9mKCk7CiAgICAgICAgdmFyIGVuZCA9IHV0aWwuY29udmVydChpdGVtLmVuZCAhPSB1bmRlZmluZWQgPyBpdGVtLmVuZCA6IGl0ZW0uc3RhcnQsICdEYXRlJykudmFsdWVPZigpOwogICAgICAgIGlmIChtaW4gPT09IG51bGwgfHwgc3RhcnQgPCBtaW4pIHsKICAgICAgICAgIG1pbiA9IHN0YXJ0OwogICAgICAgIH0KICAgICAgICBpZiAobWF4ID09PSBudWxsIHx8IGVuZCA+IG1heCkgewogICAgICAgICAgbWF4ID0gc3RhcnQ7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBtaW46IG1pbiAhPSBudWxsID8gbmV3IERhdGUobWluKSA6IG51bGwsCiAgICAgIG1heDogbWF4ICE9IG51bGwgPyBuZXcgRGF0ZShtYXgpIDogbnVsbAogICAgfTsKICB9OwoKICAvKioKICAgKiBHZW5lcmF0ZSBUaW1lbGluZSByZWxhdGVkIGluZm9ybWF0aW9uIGZyb20gYW4gZXZlbnQKICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudAogICAqIEByZXR1cm4ge09iamVjdH0gQW4gb2JqZWN0IHdpdGggcmVsYXRlZCBpbmZvcm1hdGlvbiwgbGlrZSBvbiB3aGljaCBhcmVhCiAgICogICAgICAgICAgICAgICAgICBUaGUgZXZlbnQgaGFwcGVuZWQsIHdoZXRoZXIgY2xpY2tlZCBvbiBhbiBpdGVtLCBldGMuCiAgICovCiAgVGltZWxpbmUucHJvdG90eXBlLmdldEV2ZW50UHJvcGVydGllcyA9IGZ1bmN0aW9uIChldmVudCkgewogICAgdmFyIGNsaWVudFggPSBldmVudC5jZW50ZXIgPyBldmVudC5jZW50ZXIueCA6IGV2ZW50LmNsaWVudFg7CiAgICB2YXIgY2xpZW50WSA9IGV2ZW50LmNlbnRlciA/IGV2ZW50LmNlbnRlci55IDogZXZlbnQuY2xpZW50WTsKICAgIHZhciB4ID0gY2xpZW50WCAtIHV0aWwuZ2V0QWJzb2x1dGVMZWZ0KHRoaXMuZG9tLmNlbnRlckNvbnRhaW5lcik7CiAgICB2YXIgeSA9IGNsaWVudFkgLSB1dGlsLmdldEFic29sdXRlVG9wKHRoaXMuZG9tLmNlbnRlckNvbnRhaW5lcik7CgogICAgdmFyIGl0ZW0gPSB0aGlzLml0ZW1TZXQuaXRlbUZyb21UYXJnZXQoZXZlbnQpOwogICAgdmFyIGdyb3VwID0gdGhpcy5pdGVtU2V0Lmdyb3VwRnJvbVRhcmdldChldmVudCk7CiAgICB2YXIgY3VzdG9tVGltZSA9IEN1c3RvbVRpbWUuY3VzdG9tVGltZUZyb21UYXJnZXQoZXZlbnQpOwoKICAgIHZhciBzbmFwID0gdGhpcy5pdGVtU2V0Lm9wdGlvbnMuc25hcCB8fCBudWxsOwogICAgdmFyIHNjYWxlID0gdGhpcy5ib2R5LnV0aWwuZ2V0U2NhbGUoKTsKICAgIHZhciBzdGVwID0gdGhpcy5ib2R5LnV0aWwuZ2V0U3RlcCgpOwogICAgdmFyIHRpbWUgPSB0aGlzLl90b1RpbWUoeCk7CiAgICB2YXIgc25hcHBlZFRpbWUgPSBzbmFwID8gc25hcCh0aW1lLCBzY2FsZSwgc3RlcCkgOiB0aW1lOwoKICAgIHZhciBlbGVtZW50ID0gdXRpbC5nZXRUYXJnZXQoZXZlbnQpOwogICAgdmFyIHdoYXQgPSBudWxsOwogICAgaWYgKGl0ZW0gIT0gbnVsbCkgewogICAgICB3aGF0ID0gJ2l0ZW0nOwogICAgfSBlbHNlIGlmIChjdXN0b21UaW1lICE9IG51bGwpIHsKICAgICAgd2hhdCA9ICdjdXN0b20tdGltZSc7CiAgICB9IGVsc2UgaWYgKHV0aWwuaGFzUGFyZW50KGVsZW1lbnQsIHRoaXMudGltZUF4aXMuZG9tLmZvcmVncm91bmQpKSB7CiAgICAgIHdoYXQgPSAnYXhpcyc7CiAgICB9IGVsc2UgaWYgKHRoaXMudGltZUF4aXMyICYmIHV0aWwuaGFzUGFyZW50KGVsZW1lbnQsIHRoaXMudGltZUF4aXMyLmRvbS5mb3JlZ3JvdW5kKSkgewogICAgICB3aGF0ID0gJ2F4aXMnOwogICAgfSBlbHNlIGlmICh1dGlsLmhhc1BhcmVudChlbGVtZW50LCB0aGlzLml0ZW1TZXQuZG9tLmxhYmVsU2V0KSkgewogICAgICB3aGF0ID0gJ2dyb3VwLWxhYmVsJzsKICAgIH0gZWxzZSBpZiAodXRpbC5oYXNQYXJlbnQoZWxlbWVudCwgdGhpcy5jdXJyZW50VGltZS5iYXIpKSB7CiAgICAgIHdoYXQgPSAnY3VycmVudC10aW1lJzsKICAgIH0gZWxzZSBpZiAodXRpbC5oYXNQYXJlbnQoZWxlbWVudCwgdGhpcy5kb20uY2VudGVyKSkgewogICAgICB3aGF0ID0gJ2JhY2tncm91bmQnOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIGV2ZW50OiBldmVudCwKICAgICAgaXRlbTogaXRlbSA/IGl0ZW0uaWQgOiBudWxsLAogICAgICBncm91cDogZ3JvdXAgPyBncm91cC5ncm91cElkIDogbnVsbCwKICAgICAgd2hhdDogd2hhdCwKICAgICAgcGFnZVg6IGV2ZW50LnNyY0V2ZW50ID8gZXZlbnQuc3JjRXZlbnQucGFnZVggOiBldmVudC5wYWdlWCwKICAgICAgcGFnZVk6IGV2ZW50LnNyY0V2ZW50ID8gZXZlbnQuc3JjRXZlbnQucGFnZVkgOiBldmVudC5wYWdlWSwKICAgICAgeDogeCwKICAgICAgeTogeSwKICAgICAgdGltZTogdGltZSwKICAgICAgc25hcHBlZFRpbWU6IHNuYXBwZWRUaW1lCiAgICB9OwogIH07CgogIG1vZHVsZS5leHBvcnRzID0gVGltZWxpbmU7CgovKioqLyB9LAovKiAyMCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CiAgdmFyIENvbXBvbmVudCA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpOwogIHZhciBtb21lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwogIHZhciBsb2NhbGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMik7CgogIC8qKgogICAqIEEgY3VycmVudCB0aW1lIGJhcgogICAqIEBwYXJhbSB7e3JhbmdlOiBSYW5nZSwgZG9tOiBPYmplY3QsIGRvbVByb3BzOiBPYmplY3R9fSBib2R5CiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgICAgICAgQXZhaWxhYmxlIHBhcmFtZXRlcnM6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge0Jvb2xlYW59IFtzaG93Q3VycmVudFRpbWVdCiAgICogQGNvbnN0cnVjdG9yIEN1cnJlbnRUaW1lCiAgICogQGV4dGVuZHMgQ29tcG9uZW50CiAgICovCiAgZnVuY3Rpb24gQ3VycmVudFRpbWUoYm9keSwgb3B0aW9ucykgewogICAgdGhpcy5ib2R5ID0gYm9keTsKCiAgICAvLyBkZWZhdWx0IG9wdGlvbnMKICAgIHRoaXMuZGVmYXVsdE9wdGlvbnMgPSB7CiAgICAgIHNob3dDdXJyZW50VGltZTogdHJ1ZSwKCiAgICAgIGxvY2FsZXM6IGxvY2FsZXMsCiAgICAgIGxvY2FsZTogJ2VuJwogICAgfTsKICAgIHRoaXMub3B0aW9ucyA9IHV0aWwuZXh0ZW5kKHt9LCB0aGlzLmRlZmF1bHRPcHRpb25zKTsKICAgIHRoaXMub2Zmc2V0ID0gMDsKCiAgICB0aGlzLl9jcmVhdGUoKTsKCiAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgfQoKICBDdXJyZW50VGltZS5wcm90b3R5cGUgPSBuZXcgQ29tcG9uZW50KCk7CgogIC8qKgogICAqIENyZWF0ZSB0aGUgSFRNTCBET00gZm9yIHRoZSBjdXJyZW50IHRpbWUgYmFyCiAgICogQHByaXZhdGUKICAgKi8KICBDdXJyZW50VGltZS5wcm90b3R5cGUuX2NyZWF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBiYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGJhci5jbGFzc05hbWUgPSAndmlzLWN1cnJlbnQtdGltZSc7CiAgICBiYXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgYmFyLnN0eWxlLnRvcCA9ICcwcHgnOwogICAgYmFyLnN0eWxlLmhlaWdodCA9ICcxMDAlJzsKCiAgICB0aGlzLmJhciA9IGJhcjsKICB9OwoKICAvKioKICAgKiBEZXN0cm95IHRoZSBDdXJyZW50VGltZSBiYXIKICAgKi8KICBDdXJyZW50VGltZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMub3B0aW9ucy5zaG93Q3VycmVudFRpbWUgPSBmYWxzZTsKICAgIHRoaXMucmVkcmF3KCk7IC8vIHdpbGwgcmVtb3ZlIHRoZSBiYXIgZnJvbSB0aGUgRE9NIGFuZCBzdG9wIHJlZnJlc2hpbmcKCiAgICB0aGlzLmJvZHkgPSBudWxsOwogIH07CgogIC8qKgogICAqIFNldCBvcHRpb25zIGZvciB0aGUgY29tcG9uZW50LiBPcHRpb25zIHdpbGwgYmUgbWVyZ2VkIGluIGN1cnJlbnQgb3B0aW9ucy4KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgQXZhaWxhYmxlIHBhcmFtZXRlcnM6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgIHtib29sZWFufSBbc2hvd0N1cnJlbnRUaW1lXQogICAqLwogIEN1cnJlbnRUaW1lLnByb3RvdHlwZS5zZXRPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIGlmIChvcHRpb25zKSB7CiAgICAgIC8vIGNvcHkgYWxsIG9wdGlvbnMgdGhhdCB3ZSBrbm93CiAgICAgIHV0aWwuc2VsZWN0aXZlRXh0ZW5kKFsnc2hvd0N1cnJlbnRUaW1lJywgJ2xvY2FsZScsICdsb2NhbGVzJ10sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmVwYWludCB0aGUgY29tcG9uZW50CiAgICogQHJldHVybiB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBjb21wb25lbnQgaXMgcmVzaXplZAogICAqLwogIEN1cnJlbnRUaW1lLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5vcHRpb25zLnNob3dDdXJyZW50VGltZSkgewogICAgICB2YXIgcGFyZW50ID0gdGhpcy5ib2R5LmRvbS5iYWNrZ3JvdW5kVmVydGljYWw7CiAgICAgIGlmICh0aGlzLmJhci5wYXJlbnROb2RlICE9IHBhcmVudCkgewogICAgICAgIC8vIGF0dGFjaCB0byB0aGUgZG9tCiAgICAgICAgaWYgKHRoaXMuYmFyLnBhcmVudE5vZGUpIHsKICAgICAgICAgIHRoaXMuYmFyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5iYXIpOwogICAgICAgIH0KICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5iYXIpOwoKICAgICAgICB0aGlzLnN0YXJ0KCk7CiAgICAgIH0KCiAgICAgIHZhciBub3cgPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLnZhbHVlT2YoKSArIHRoaXMub2Zmc2V0KTsKICAgICAgdmFyIHggPSB0aGlzLmJvZHkudXRpbC50b1NjcmVlbihub3cpOwoKICAgICAgdmFyIGxvY2FsZSA9IHRoaXMub3B0aW9ucy5sb2NhbGVzW3RoaXMub3B0aW9ucy5sb2NhbGVdOwogICAgICBpZiAoIWxvY2FsZSkgewogICAgICAgIGlmICghdGhpcy53YXJuZWQpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdXQVJOSU5HOiBvcHRpb25zLmxvY2FsZXNbXCcnICsgdGhpcy5vcHRpb25zLmxvY2FsZSArICdcJ10gbm90IGZvdW5kLiBTZWUgaHR0cDovL3Zpc2pzLm9yZy9kb2NzL3RpbWVsaW5lLmh0bWwjTG9jYWxpemF0aW9uJyk7CiAgICAgICAgICB0aGlzLndhcm5lZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGxvY2FsZSA9IHRoaXMub3B0aW9ucy5sb2NhbGVzWydlbiddOyAvLyBmYWxsIGJhY2sgb24gZW5nbGlzaCB3aGVuIG5vdCBhdmFpbGFibGUKICAgICAgfQogICAgICB2YXIgdGl0bGUgPSBsb2NhbGUuY3VycmVudCArICcgJyArIGxvY2FsZS50aW1lICsgJzogJyArIG1vbWVudChub3cpLmZvcm1hdCgnZGRkZCwgTU1NTSBEbyBZWVlZLCBIOm1tOnNzJyk7CiAgICAgIHRpdGxlID0gdGl0bGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0aXRsZS5zdWJzdHJpbmcoMSk7CgogICAgICB0aGlzLmJhci5zdHlsZS5sZWZ0ID0geCArICdweCc7CiAgICAgIHRoaXMuYmFyLnRpdGxlID0gdGl0bGU7CiAgICB9IGVsc2UgewogICAgICAvLyByZW1vdmUgdGhlIGxpbmUgZnJvbSB0aGUgRE9NCiAgICAgIGlmICh0aGlzLmJhci5wYXJlbnROb2RlKSB7CiAgICAgICAgdGhpcy5iYXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmJhcik7CiAgICAgIH0KICAgICAgdGhpcy5zdG9wKCk7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIC8qKgogICAqIFN0YXJ0IGF1dG8gcmVmcmVzaGluZyB0aGUgY3VycmVudCB0aW1lIGJhcgogICAqLwogIEN1cnJlbnRUaW1lLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBtZSA9IHRoaXM7CgogICAgZnVuY3Rpb24gdXBkYXRlKCkgewogICAgICBtZS5zdG9wKCk7CgogICAgICAvLyBkZXRlcm1pbmUgaW50ZXJ2YWwgdG8gcmVmcmVzaAogICAgICB2YXIgc2NhbGUgPSBtZS5ib2R5LnJhbmdlLmNvbnZlcnNpb24obWUuYm9keS5kb21Qcm9wcy5jZW50ZXIud2lkdGgpLnNjYWxlOwogICAgICB2YXIgaW50ZXJ2YWwgPSAxIC8gc2NhbGUgLyAxMDsKICAgICAgaWYgKGludGVydmFsIDwgMzApIGludGVydmFsID0gMzA7CiAgICAgIGlmIChpbnRlcnZhbCA+IDEwMDApIGludGVydmFsID0gMTAwMDsKCiAgICAgIG1lLnJlZHJhdygpOwoKICAgICAgLy8gc3RhcnQgYSByZW5kZXJUaW1lciB0byBhZGp1c3QgZm9yIHRoZSBuZXcgdGltZQogICAgICBtZS5jdXJyZW50VGltZVRpbWVyID0gc2V0VGltZW91dCh1cGRhdGUsIGludGVydmFsKTsKICAgIH0KCiAgICB1cGRhdGUoKTsKICB9OwoKICAvKioKICAgKiBTdG9wIGF1dG8gcmVmcmVzaGluZyB0aGUgY3VycmVudCB0aW1lIGJhcgogICAqLwogIEN1cnJlbnRUaW1lLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuY3VycmVudFRpbWVUaW1lciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLmN1cnJlbnRUaW1lVGltZXIpOwogICAgICBkZWxldGUgdGhpcy5jdXJyZW50VGltZVRpbWVyOwogICAgfQogIH07CgogIC8qKgogICAqIFNldCBhIGN1cnJlbnQgdGltZS4gVGhpcyBjYW4gYmUgdXNlZCBmb3IgZXhhbXBsZSB0byBlbnN1cmUgdGhhdCBhIGNsaWVudCdzCiAgICogdGltZSBpcyBzeW5jaHJvbml6ZWQgd2l0aCBhIHNoYXJlZCBzZXJ2ZXIgdGltZS4KICAgKiBAcGFyYW0ge0RhdGUgfCBTdHJpbmcgfCBOdW1iZXJ9IHRpbWUgICAgIEEgRGF0ZSwgdW5peCB0aW1lc3RhbXAsIG9yCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJU08gZGF0ZSBzdHJpbmcuCiAgICovCiAgQ3VycmVudFRpbWUucHJvdG90eXBlLnNldEN1cnJlbnRUaW1lID0gZnVuY3Rpb24gKHRpbWUpIHsKICAgIHZhciB0ID0gdXRpbC5jb252ZXJ0KHRpbWUsICdEYXRlJykudmFsdWVPZigpOwogICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkudmFsdWVPZigpOwogICAgdGhpcy5vZmZzZXQgPSB0IC0gbm93OwogICAgdGhpcy5yZWRyYXcoKTsKICB9OwoKICAvKioKICAgKiBHZXQgdGhlIGN1cnJlbnQgdGltZS4KICAgKiBAcmV0dXJuIHtEYXRlfSBSZXR1cm5zIHRoZSBjdXJyZW50IHRpbWUuCiAgICovCiAgQ3VycmVudFRpbWUucHJvdG90eXBlLmdldEN1cnJlbnRUaW1lID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIG5ldyBEYXRlKG5ldyBEYXRlKCkudmFsdWVPZigpICsgdGhpcy5vZmZzZXQpOwogIH07CgogIG1vZHVsZS5leHBvcnRzID0gQ3VycmVudFRpbWU7CgovKioqLyB9LAovKiAyMSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgLyoqCiAgICogUHJvdG90eXBlIGZvciB2aXN1YWwgY29tcG9uZW50cwogICAqIEBwYXJhbSB7e2RvbTogT2JqZWN0LCBkb21Qcm9wczogT2JqZWN0LCBlbWl0dGVyOiBFbWl0dGVyLCByYW5nZTogUmFuZ2V9fSBbYm9keV0KICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdCiAgICovCiAgInVzZSBzdHJpY3QiOwoKICBmdW5jdGlvbiBDb21wb25lbnQoYm9keSwgb3B0aW9ucykgewogICAgdGhpcy5vcHRpb25zID0gbnVsbDsKICAgIHRoaXMucHJvcHMgPSBudWxsOwogIH0KCiAgLyoqCiAgICogU2V0IG9wdGlvbnMgZm9yIHRoZSBjb21wb25lbnQuIFRoZSBuZXcgb3B0aW9ucyB3aWxsIGJlIG1lcmdlZCBpbnRvIHRoZQogICAqIGN1cnJlbnQgb3B0aW9ucy4KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqLwogIENvbXBvbmVudC5wcm90b3R5cGUuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICBpZiAob3B0aW9ucykgewogICAgICB1dGlsLmV4dGVuZCh0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgfQogIH07CgogIC8qKgogICAqIFJlcGFpbnQgdGhlIGNvbXBvbmVudAogICAqIEByZXR1cm4ge2Jvb2xlYW59IFJldHVybnMgdHJ1ZSBpZiB0aGUgY29tcG9uZW50IGlzIHJlc2l6ZWQKICAgKi8KICBDb21wb25lbnQucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIHNob3VsZCBiZSBpbXBsZW1lbnRlZCBieSB0aGUgY29tcG9uZW50CiAgICByZXR1cm4gZmFsc2U7CiAgfTsKCiAgLyoqCiAgICogRGVzdHJveSB0aGUgY29tcG9uZW50LiBDbGVhbnVwIERPTSBhbmQgZXZlbnQgbGlzdGVuZXJzCiAgICovCiAgQ29tcG9uZW50LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge307CgogIC8qKgogICAqIFRlc3Qgd2hldGhlciB0aGUgY29tcG9uZW50IGlzIHJlc2l6ZWQgc2luY2UgdGhlIGxhc3QgdGltZSBfaXNSZXNpemVkKCkgd2FzCiAgICogY2FsbGVkLgogICAqIEByZXR1cm4ge0Jvb2xlYW59IFJldHVybnMgdHJ1ZSBpZiB0aGUgY29tcG9uZW50IGlzIHJlc2l6ZWQKICAgKiBAcHJvdGVjdGVkCiAgICovCiAgQ29tcG9uZW50LnByb3RvdHlwZS5faXNSZXNpemVkID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHJlc2l6ZWQgPSB0aGlzLnByb3BzLl9wcmV2aW91c1dpZHRoICE9PSB0aGlzLnByb3BzLndpZHRoIHx8IHRoaXMucHJvcHMuX3ByZXZpb3VzSGVpZ2h0ICE9PSB0aGlzLnByb3BzLmhlaWdodDsKCiAgICB0aGlzLnByb3BzLl9wcmV2aW91c1dpZHRoID0gdGhpcy5wcm9wcy53aWR0aDsKICAgIHRoaXMucHJvcHMuX3ByZXZpb3VzSGVpZ2h0ID0gdGhpcy5wcm9wcy5oZWlnaHQ7CgogICAgcmV0dXJuIHJlc2l6ZWQ7CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBDb21wb25lbnQ7CgogIC8vIHNob3VsZCBiZSBpbXBsZW1lbnRlZCBieSB0aGUgY29tcG9uZW50CgovKioqLyB9LAovKiAyMiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgLy8gRW5nbGlzaAogICd1c2Ugc3RyaWN0JzsKCiAgZXhwb3J0c1snZW4nXSA9IHsKICAgIGN1cnJlbnQ6ICdjdXJyZW50JywKICAgIHRpbWU6ICd0aW1lJwogIH07CiAgZXhwb3J0c1snZW5fRU4nXSA9IGV4cG9ydHNbJ2VuJ107CiAgZXhwb3J0c1snZW5fVVMnXSA9IGV4cG9ydHNbJ2VuJ107CgogIC8vIER1dGNoCiAgZXhwb3J0c1snbmwnXSA9IHsKICAgIGN1cnJlbnQ6ICdodWlkaWdlJywKICAgIHRpbWU6ICd0aWpkJwogIH07CiAgZXhwb3J0c1snbmxfTkwnXSA9IGV4cG9ydHNbJ25sJ107CiAgZXhwb3J0c1snbmxfQkUnXSA9IGV4cG9ydHNbJ25sJ107CgovKioqLyB9LAovKiAyMyAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgLy8gT25seSBsb2FkIGhhbW1lci5qcyB3aGVuIGluIGEgYnJvd3NlciBlbnZpcm9ubWVudAogIC8vIChsb2FkaW5nIGhhbW1lci5qcyBpbiBhIG5vZGUuanMgZW52aXJvbm1lbnQgZ2l2ZXMgZXJyb3JzKQogICd1c2Ugc3RyaWN0JzsKCiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICB2YXIgcHJvcGFnYXRpbmcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0KTsKICAgIHZhciBIYW1tZXIgPSB3aW5kb3dbJ0hhbW1lciddIHx8IF9fd2VicGFja19yZXF1aXJlX18oMjUpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBwcm9wYWdhdGluZyhIYW1tZXIsIHsKICAgICAgcHJldmVudERlZmF1bHQ6ICdtb3VzZScKICAgIH0pOwogIH0gZWxzZSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhyb3cgRXJyb3IoJ2hhbW1lci5qcyBpcyBvbmx5IGF2YWlsYWJsZSBpbiBhIGJyb3dzZXIsIG5vdCBpbiBub2RlLmpzLicpOwogICAgfTsKICB9CgovKioqLyB9LAovKiAyNCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgdmFyIF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXywgX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXywgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX187J3VzZSBzdHJpY3QnOwoKICAoZnVuY3Rpb24gKGZhY3RvcnkpIHsKICAgIGlmICh0cnVlKSB7CiAgICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KICAgICAgIShfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fID0gW10sIF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXyA9IChmYWN0b3J5KSwgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gPSAodHlwZW9mIF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXyA9PT0gJ2Z1bmN0aW9uJyA/IChfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18uYXBwbHkoZXhwb3J0cywgX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXykpIDogX19XRUJQQUNLX0FNRF9ERUZJTkVfRkFDVE9SWV9fKSwgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gIT09IHVuZGVmaW5lZCAmJiAobW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXykpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpIHsKICAgICAgLy8gTm9kZS4gRG9lcyBub3Qgd29yayB3aXRoIHN0cmljdCBDb21tb25KUywgYnV0CiAgICAgIC8vIG9ubHkgQ29tbW9uSlMtbGlrZSBlbnZpcm9ubWVudHMgdGhhdCBzdXBwb3J0IG1vZHVsZS5leHBvcnRzLAogICAgICAvLyBsaWtlIE5vZGUuCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwogICAgfSBlbHNlIHsKICAgICAgLy8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdykKICAgICAgd2luZG93LnByb3BhZ2F0aW5nID0gZmFjdG9yeSgpOwogICAgfQogIH0oZnVuY3Rpb24gKCkgewogICAgdmFyIF9maXJzdFRhcmdldCA9IG51bGw7IC8vIHNpbmdsZXRvbiwgd2lsbCBjb250YWluIHRoZSB0YXJnZXQgZWxlbWVudCB3aGVyZSB0aGUgdG91Y2ggZXZlbnQgc3RhcnRlZAogICAgdmFyIF9wcm9jZXNzaW5nID0gZmFsc2U7IC8vIHNpbmdsZXRvbiwgdHJ1ZSB3aGVuIGEgdG91Y2ggZXZlbnQgaXMgYmVpbmcgaGFuZGxlZAoKICAgIC8qKgogICAgICogRXh0ZW5kIGFuIEhhbW1lci5qcyBpbnN0YW5jZSB3aXRoIGV2ZW50IHByb3BhZ2F0aW9uLgogICAgICoKICAgICAqIEZlYXR1cmVzOgogICAgICogLSBFdmVudHMgZW1pdHRlZCBieSBoYW1tZXIgd2lsbCBwcm9wYWdhdGUgaW4gb3JkZXIgZnJvbSBjaGlsZCB0byBwYXJlbnQKICAgICAqICAgZWxlbWVudHMuCiAgICAgKiAtIEV2ZW50cyBhcmUgZXh0ZW5kZWQgd2l0aCBhIGZ1bmN0aW9uIGBldmVudC5zdG9wUHJvcGFnYXRpb24oKWAgdG8gc3RvcAogICAgICogICBwcm9wYWdhdGlvbiB0byBwYXJlbnQgZWxlbWVudHMuCiAgICAgKiAtIEFuIG9wdGlvbiBgcHJldmVudERlZmF1bHRgIHRvIHN0b3AgYWxsIGRlZmF1bHQgYnJvd3NlciBiZWhhdmlvci4KICAgICAqCiAgICAgKiBVc2FnZToKICAgICAqICAgdmFyIGhhbW1lciA9IHByb3BhZ2F0aW5nSGFtbWVyKG5ldyBIYW1tZXIoZWxlbWVudCkpOwogICAgICogICB2YXIgaGFtbWVyID0gcHJvcGFnYXRpbmdIYW1tZXIobmV3IEhhbW1lcihlbGVtZW50KSwge3ByZXZlbnREZWZhdWx0OiB0cnVlfSk7CiAgICAgKgogICAgICogQHBhcmFtIHtIYW1tZXIuTWFuYWdlcn0gaGFtbWVyICAgQW4gaGFtbWVyIGluc3RhbmNlLgogICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgICAgICAgQXZhaWxhYmxlIG9wdGlvbnM6CiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIGBwcmV2ZW50RGVmYXVsdDogdHJ1ZSB8ICdtb3VzZScgfCAndG91Y2gnIHwgJ3BlbidgLgogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmZvcmNlIHByZXZlbnRpbmcgdGhlIGRlZmF1bHQgYnJvd3NlciBiZWhhdmlvci4KICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2Fubm90IGJlIHNldCB0byBgZmFsc2VgLgogICAgICogQHJldHVybiB7SGFtbWVyLk1hbmFnZXJ9IFJldHVybnMgdGhlIHNhbWUgaGFtbWVyIGluc3RhbmNlIHdpdGggZXh0ZW5kZWQKICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbmFsaXR5CiAgICAgKi8KICAgIHJldHVybiBmdW5jdGlvbiBwcm9wYWdhdGluZyhoYW1tZXIsIG9wdGlvbnMpIHsKICAgICAgdmFyIF9vcHRpb25zID0gb3B0aW9ucyB8fCB7CiAgICAgICAgcHJldmVudERlZmF1bHQ6IGZhbHNlCiAgICAgIH07CgogICAgICBpZiAoaGFtbWVyLk1hbmFnZXIpIHsKICAgICAgICAvLyBUaGlzIGxvb2tzIGxpa2UgdGhlIEhhbW1lciBjb25zdHJ1Y3Rvci4KICAgICAgICAvLyBPdmVybG9hZCB0aGUgY29uc3RydWN0b3JzIHdpdGggb3VyIG93bi4KICAgICAgICB2YXIgSGFtbWVyID0gaGFtbWVyOwoKICAgICAgICB2YXIgUHJvcGFnYXRpbmdIYW1tZXIgPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7CiAgICAgICAgICB2YXIgbyA9IE9iamVjdC5jcmVhdGUoX29wdGlvbnMpOwogICAgICAgICAgaWYgKG9wdGlvbnMpIEhhbW1lci5leHRlbmQobywgb3B0aW9ucyk7CiAgICAgICAgICByZXR1cm4gcHJvcGFnYXRpbmcobmV3IEhhbW1lcihlbGVtZW50LCBvKSwgbyk7CiAgICAgICAgfTsKICAgICAgICBIYW1tZXIuZXh0ZW5kKFByb3BhZ2F0aW5nSGFtbWVyLCBIYW1tZXIpOwoKICAgICAgICBQcm9wYWdhdGluZ0hhbW1lci5NYW5hZ2VyID0gZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBvID0gT2JqZWN0LmNyZWF0ZShfb3B0aW9ucyk7CiAgICAgICAgICBpZiAob3B0aW9ucykgSGFtbWVyLmV4dGVuZChvLCBvcHRpb25zKTsKICAgICAgICAgIHJldHVybiBwcm9wYWdhdGluZyhuZXcgSGFtbWVyLk1hbmFnZXIoZWxlbWVudCwgbyksIG8pOwogICAgICAgIH07CgogICAgICAgIHJldHVybiBQcm9wYWdhdGluZ0hhbW1lcjsKICAgICAgfQoKICAgICAgLy8gY3JlYXRlIGEgd3JhcHBlciBvYmplY3Qgd2hpY2ggd2lsbCBvdmVycmlkZSB0aGUgZnVuY3Rpb25zCiAgICAgIC8vIGBvbmAsIGBvZmZgLCBgZGVzdHJveWAsIGFuZCBgZW1pdGAgb2YgdGhlIGhhbW1lciBpbnN0YW5jZQogICAgICB2YXIgd3JhcHBlciA9IE9iamVjdC5jcmVhdGUoaGFtbWVyKTsKCiAgICAgIC8vIGF0dGFjaCB0byBET00gZWxlbWVudAogICAgICB2YXIgZWxlbWVudCA9IGhhbW1lci5lbGVtZW50OwogICAgICBlbGVtZW50LmhhbW1lciA9IHdyYXBwZXI7CgogICAgICAvLyByZWdpc3RlciBhbiBldmVudCB0byBjYXRjaCB0aGUgc3RhcnQgb2YgYSBnZXN0dXJlIGFuZCBzdG9yZSB0aGUKICAgICAgLy8gdGFyZ2V0IGluIGEgc2luZ2xldG9uCiAgICAgIGhhbW1lci5vbignaGFtbWVyLmlucHV0JywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgaWYgKF9vcHRpb25zLnByZXZlbnREZWZhdWx0ID09PSB0cnVlIHx8IChfb3B0aW9ucy5wcmV2ZW50RGVmYXVsdCA9PT0gZXZlbnQucG9pbnRlclR5cGUpKSB7CiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KICAgICAgICBpZiAoZXZlbnQuaXNGaXJzdCkgewogICAgICAgICAgX2ZpcnN0VGFyZ2V0ID0gZXZlbnQudGFyZ2V0OwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvKiogQHR5cGUge09iamVjdC48U3RyaW5nLCBBcnJheS48ZnVuY3Rpb24+Pn0gKi8KICAgICAgd3JhcHBlci5faGFuZGxlcnMgPSB7fTsKCiAgICAgIC8qKgogICAgICAgKiBSZWdpc3RlciBhIGhhbmRsZXIgZm9yIG9uZSBvciBtdWx0aXBsZSBldmVudHMKICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50cyAgICBBIHNwYWNlIHNlcGFyYXRlZCBzdHJpbmcgd2l0aCBldmVudHMKICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gaGFuZGxlciBBIGNhbGxiYWNrIGZ1bmN0aW9uLCBjYWxsZWQgYXMgaGFuZGxlcihldmVudCkKICAgICAgICogQHJldHVybnMge0hhbW1lci5NYW5hZ2VyfSBSZXR1cm5zIHRoZSBoYW1tZXIgaW5zdGFuY2UKICAgICAgICovCiAgICAgIHdyYXBwZXIub24gPSBmdW5jdGlvbiAoZXZlbnRzLCBoYW5kbGVyKSB7CiAgICAgICAgLy8gcmVnaXN0ZXIgdGhlIGhhbmRsZXIKICAgICAgICBzcGxpdChldmVudHMpLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICB2YXIgX2hhbmRsZXJzID0gd3JhcHBlci5faGFuZGxlcnNbZXZlbnRdOwogICAgICAgICAgaWYgKCFfaGFuZGxlcnMpIHsKICAgICAgICAgICAgd3JhcHBlci5faGFuZGxlcnNbZXZlbnRdID0gX2hhbmRsZXJzID0gW107CgogICAgICAgICAgICAvLyByZWdpc3RlciB0aGUgc3RhdGljLCBwcm9wYWdhdGVkIGhhbmRsZXIKICAgICAgICAgICAgaGFtbWVyLm9uKGV2ZW50LCBwcm9wYWdhdGVkSGFuZGxlcik7CiAgICAgICAgICB9CiAgICAgICAgICBfaGFuZGxlcnMucHVzaChoYW5kbGVyKTsKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHdyYXBwZXI7CiAgICAgIH07CgogICAgICAvKioKICAgICAgICogVW5yZWdpc3RlciBhIGhhbmRsZXIgZm9yIG9uZSBvciBtdWx0aXBsZSBldmVudHMKICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50cyAgICAgIEEgc3BhY2Ugc2VwYXJhdGVkIHN0cmluZyB3aXRoIGV2ZW50cwogICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbaGFuZGxlcl0gT3B0aW9uYWwuIFRoZSByZWdpc3RlcmVkIGhhbmRsZXIuIElmIG5vdAogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWQsIGFsbCBoYW5kbGVycyBmb3IgZ2l2ZW4gZXZlbnRzCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmUgcmVtb3ZlZC4KICAgICAgICogQHJldHVybnMge0hhbW1lci5NYW5hZ2VyfSAgIFJldHVybnMgdGhlIGhhbW1lciBpbnN0YW5jZQogICAgICAgKi8KICAgICAgd3JhcHBlci5vZmYgPSBmdW5jdGlvbiAoZXZlbnRzLCBoYW5kbGVyKSB7CiAgICAgICAgLy8gdW5yZWdpc3RlciB0aGUgaGFuZGxlcgogICAgICAgIHNwbGl0KGV2ZW50cykuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIHZhciBfaGFuZGxlcnMgPSB3cmFwcGVyLl9oYW5kbGVyc1tldmVudF07CiAgICAgICAgICBpZiAoX2hhbmRsZXJzKSB7CiAgICAgICAgICAgIF9oYW5kbGVycyA9IGhhbmRsZXIgPyBfaGFuZGxlcnMuZmlsdGVyKGZ1bmN0aW9uIChoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGggIT09IGhhbmRsZXI7CiAgICAgICAgICAgIH0pIDogW107CgogICAgICAgICAgICBpZiAoX2hhbmRsZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICB3cmFwcGVyLl9oYW5kbGVyc1tldmVudF0gPSBfaGFuZGxlcnM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgLy8gcmVtb3ZlIHN0YXRpYywgcHJvcGFnYXRlZCBoYW5kbGVyCiAgICAgICAgICAgICAgaGFtbWVyLm9mZihldmVudCwgcHJvcGFnYXRlZEhhbmRsZXIpOwogICAgICAgICAgICAgIGRlbGV0ZSB3cmFwcGVyLl9oYW5kbGVyc1tldmVudF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHdyYXBwZXI7CiAgICAgIH07CgogICAgICAvKioKICAgICAgICogRW1pdCB0byB0aGUgZXZlbnQgbGlzdGVuZXJzCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUKICAgICAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgICAgICovCiAgICAgIHdyYXBwZXIuZW1pdCA9IGZ1bmN0aW9uKGV2ZW50VHlwZSwgZXZlbnQpIHsKICAgICAgICBfZmlyc3RUYXJnZXQgPSBldmVudC50YXJnZXQ7CiAgICAgICAgaGFtbWVyLmVtaXQoZXZlbnRUeXBlLCBldmVudCk7CiAgICAgIH07CgogICAgICB3cmFwcGVyLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gRGV0YWNoIGZyb20gRE9NIGVsZW1lbnQKICAgICAgICBkZWxldGUgaGFtbWVyLmVsZW1lbnQuaGFtbWVyOwoKICAgICAgICAvLyBjbGVhciBhbGwgaGFuZGxlcnMKICAgICAgICB3cmFwcGVyLl9oYW5kbGVycyA9IHt9OwoKICAgICAgICAvLyBjYWxsIG9yaWdpbmFsIGhhbW1lciBkZXN0cm95CiAgICAgICAgaGFtbWVyLmRlc3Ryb3koKTsKICAgICAgfTsKCiAgICAgIC8vIHNwbGl0IGEgc3RyaW5nIHdpdGggc3BhY2Ugc2VwYXJhdGVkIHdvcmRzCiAgICAgIGZ1bmN0aW9uIHNwbGl0KGV2ZW50cykgewogICAgICAgIHJldHVybiBldmVudHMubWF0Y2goL1teIF0rL2cpOwogICAgICB9CgogICAgICAvKioKICAgICAgICogQSBzdGF0aWMgZXZlbnQgaGFuZGxlciwgYXBwbHlpbmcgZXZlbnQgcHJvcGFnYXRpb24uCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudAogICAgICAgKi8KICAgICAgZnVuY3Rpb24gcHJvcGFnYXRlZEhhbmRsZXIoZXZlbnQpIHsKICAgICAgICAvLyBsZXQgb25seSBhIHNpbmdsZSBoYW1tZXIgaW5zdGFuY2UgaGFuZGxlIHRoaXMgZXZlbnQKICAgICAgICBpZiAoZXZlbnQudHlwZSAhPT0gJ2hhbW1lci5pbnB1dCcpIHsKICAgICAgICAgIC8vIGl0IGlzIHBvc3NpYmxlIHRoYXQgdGhlIHNhbWUgc3JjRXZlbnQgaXMgdXNlZCB3aXRoIG11bHRpcGxlIGhhbW1lciBldmVudHMsCiAgICAgICAgICAvLyB3ZSBrZWVwIHRyYWNrIG9uIHdoaWNoIGV2ZW50cyBhcmUgaGFuZGxlZCBpbiBhbiBvYmplY3QgX2hhbmRsZWQKICAgICAgICAgIGlmICghZXZlbnQuc3JjRXZlbnQuX2hhbmRsZWQpIHsKICAgICAgICAgICAgZXZlbnQuc3JjRXZlbnQuX2hhbmRsZWQgPSB7fTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZXZlbnQuc3JjRXZlbnQuX2hhbmRsZWRbZXZlbnQudHlwZV0pIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGV2ZW50LnNyY0V2ZW50Ll9oYW5kbGVkW2V2ZW50LnR5cGVdID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGF0dGFjaCBhIHN0b3BQcm9wYWdhdGlvbiBmdW5jdGlvbiB0byB0aGUgZXZlbnQKICAgICAgICB2YXIgc3RvcHBlZCA9IGZhbHNlOwogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHN0b3BwZWQgPSB0cnVlOwogICAgICAgIH07CgogICAgICAgIC8vIGF0dGFjaCBmaXJzdFRhcmdldCBwcm9wZXJ0eSB0byB0aGUgZXZlbnQKICAgICAgICBldmVudC5maXJzdFRhcmdldCA9IF9maXJzdFRhcmdldDsKCiAgICAgICAgLy8gcHJvcGFnYXRlIG92ZXIgYWxsIGVsZW1lbnRzICh1bnRpbCBzdG9wcGVkKQogICAgICAgIHZhciBlbGVtID0gX2ZpcnN0VGFyZ2V0OwogICAgICAgIHdoaWxlIChlbGVtICYmICFzdG9wcGVkKSB7CiAgICAgICAgICB2YXIgX2hhbmRsZXJzID0gZWxlbS5oYW1tZXIgJiYgZWxlbS5oYW1tZXIuX2hhbmRsZXJzW2V2ZW50LnR5cGVdOwogICAgICAgICAgaWYgKF9oYW5kbGVycykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IF9oYW5kbGVycy5sZW5ndGggJiYgIXN0b3BwZWQ7IGkrKykgewogICAgICAgICAgICAgIF9oYW5kbGVyc1tpXShldmVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBlbGVtID0gZWxlbS5wYXJlbnROb2RlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHdyYXBwZXI7CiAgICB9OwogIH0pKTsKCgovKioqLyB9LAovKiAyNSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgdmFyIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fOy8qISBIYW1tZXIuSlMgLSB2Mi4wLjQgLSAyMDE0LTA5LTI4CiAgICogaHR0cDovL2hhbW1lcmpzLmdpdGh1Yi5pby8KICAgKgogICAqIENvcHlyaWdodCAoYykgMjAxNCBKb3JpayBUYW5nZWxkZXI7CiAgICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlICovCiAgKGZ1bmN0aW9uKHdpbmRvdywgZG9jdW1lbnQsIGV4cG9ydE5hbWUsIHVuZGVmaW5lZCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgVkVORE9SX1BSRUZJWEVTID0gWycnLCAnd2Via2l0JywgJ21veicsICdNUycsICdtcycsICdvJ107CiAgdmFyIFRFU1RfRUxFTUVOVCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoKICB2YXIgVFlQRV9GVU5DVElPTiA9ICdmdW5jdGlvbic7CgogIHZhciByb3VuZCA9IE1hdGgucm91bmQ7CiAgdmFyIGFicyA9IE1hdGguYWJzOwogIHZhciBub3cgPSBEYXRlLm5vdzsKCiAgLyoqCiAgICogc2V0IGEgdGltZW91dCB3aXRoIGEgZ2l2ZW4gc2NvcGUKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lb3V0CiAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHQKICAgKiBAcmV0dXJucyB7bnVtYmVyfQogICAqLwogIGZ1bmN0aW9uIHNldFRpbWVvdXRDb250ZXh0KGZuLCB0aW1lb3V0LCBjb250ZXh0KSB7CiAgICAgIHJldHVybiBzZXRUaW1lb3V0KGJpbmRGbihmbiwgY29udGV4dCksIHRpbWVvdXQpOwogIH0KCiAgLyoqCiAgICogaWYgdGhlIGFyZ3VtZW50IGlzIGFuIGFycmF5LCB3ZSB3YW50IHRvIGV4ZWN1dGUgdGhlIGZuIG9uIGVhY2ggZW50cnkKICAgKiBpZiBpdCBhaW50IGFuIGFycmF5IHdlIGRvbid0IHdhbnQgdG8gZG8gYSB0aGluZy4KICAgKiB0aGlzIGlzIHVzZWQgYnkgYWxsIHRoZSBtZXRob2RzIHRoYXQgYWNjZXB0IGEgc2luZ2xlIGFuZCBhcnJheSBhcmd1bWVudC4KICAgKiBAcGFyYW0geyp8QXJyYXl9IGFyZwogICAqIEBwYXJhbSB7U3RyaW5nfSBmbgogICAqIEBwYXJhbSB7T2JqZWN0fSBbY29udGV4dF0KICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0KICAgKi8KICBmdW5jdGlvbiBpbnZva2VBcnJheUFyZyhhcmcsIGZuLCBjb250ZXh0KSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGFyZykpIHsKICAgICAgICAgIGVhY2goYXJnLCBjb250ZXh0W2ZuXSwgY29udGV4dCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvKioKICAgKiB3YWxrIG9iamVjdHMgYW5kIGFycmF5cwogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRvcgogICAqIEBwYXJhbSB7T2JqZWN0fSBjb250ZXh0CiAgICovCiAgZnVuY3Rpb24gZWFjaChvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICAgIHZhciBpOwoKICAgICAgaWYgKCFvYmopIHsKICAgICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKG9iai5mb3JFYWNoKSB7CiAgICAgICAgICBvYmouZm9yRWFjaChpdGVyYXRvciwgY29udGV4dCk7CiAgICAgIH0gZWxzZSBpZiAob2JqLmxlbmd0aCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpID0gMDsKICAgICAgICAgIHdoaWxlIChpIDwgb2JqLmxlbmd0aCkgewogICAgICAgICAgICAgIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqW2ldLCBpLCBvYmopOwogICAgICAgICAgICAgIGkrKzsKICAgICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZvciAoaSBpbiBvYmopIHsKICAgICAgICAgICAgICBvYmouaGFzT3duUHJvcGVydHkoaSkgJiYgaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpbaV0sIGksIG9iaik7CiAgICAgICAgICB9CiAgICAgIH0KICB9CgogIC8qKgogICAqIGV4dGVuZCBvYmplY3QuCiAgICogbWVhbnMgdGhhdCBwcm9wZXJ0aWVzIGluIGRlc3Qgd2lsbCBiZSBvdmVyd3JpdHRlbiBieSB0aGUgb25lcyBpbiBzcmMuCiAgICogQHBhcmFtIHtPYmplY3R9IGRlc3QKICAgKiBAcGFyYW0ge09iamVjdH0gc3JjCiAgICogQHBhcmFtIHtCb29sZWFufSBbbWVyZ2VdCiAgICogQHJldHVybnMge09iamVjdH0gZGVzdAogICAqLwogIGZ1bmN0aW9uIGV4dGVuZChkZXN0LCBzcmMsIG1lcmdlKSB7CiAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoc3JjKTsKICAgICAgdmFyIGkgPSAwOwogICAgICB3aGlsZSAoaSA8IGtleXMubGVuZ3RoKSB7CiAgICAgICAgICBpZiAoIW1lcmdlIHx8IChtZXJnZSAmJiBkZXN0W2tleXNbaV1dID09PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICAgICAgZGVzdFtrZXlzW2ldXSA9IHNyY1trZXlzW2ldXTsKICAgICAgICAgIH0KICAgICAgICAgIGkrKzsKICAgICAgfQogICAgICByZXR1cm4gZGVzdDsKICB9CgogIC8qKgogICAqIG1lcmdlIHRoZSB2YWx1ZXMgZnJvbSBzcmMgaW4gdGhlIGRlc3QuCiAgICogbWVhbnMgdGhhdCBwcm9wZXJ0aWVzIHRoYXQgZXhpc3QgaW4gZGVzdCB3aWxsIG5vdCBiZSBvdmVyd3JpdHRlbiBieSBzcmMKICAgKiBAcGFyYW0ge09iamVjdH0gZGVzdAogICAqIEBwYXJhbSB7T2JqZWN0fSBzcmMKICAgKiBAcmV0dXJucyB7T2JqZWN0fSBkZXN0CiAgICovCiAgZnVuY3Rpb24gbWVyZ2UoZGVzdCwgc3JjKSB7CiAgICAgIHJldHVybiBleHRlbmQoZGVzdCwgc3JjLCB0cnVlKTsKICB9CgogIC8qKgogICAqIHNpbXBsZSBjbGFzcyBpbmhlcml0YW5jZQogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNoaWxkCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gYmFzZQogICAqIEBwYXJhbSB7T2JqZWN0fSBbcHJvcGVydGllc10KICAgKi8KICBmdW5jdGlvbiBpbmhlcml0KGNoaWxkLCBiYXNlLCBwcm9wZXJ0aWVzKSB7CiAgICAgIHZhciBiYXNlUCA9IGJhc2UucHJvdG90eXBlLAogICAgICAgICAgY2hpbGRQOwoKICAgICAgY2hpbGRQID0gY2hpbGQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShiYXNlUCk7CiAgICAgIGNoaWxkUC5jb25zdHJ1Y3RvciA9IGNoaWxkOwogICAgICBjaGlsZFAuX3N1cGVyID0gYmFzZVA7CgogICAgICBpZiAocHJvcGVydGllcykgewogICAgICAgICAgZXh0ZW5kKGNoaWxkUCwgcHJvcGVydGllcyk7CiAgICAgIH0KICB9CgogIC8qKgogICAqIHNpbXBsZSBmdW5jdGlvbiBiaW5kCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4KICAgKiBAcGFyYW0ge09iamVjdH0gY29udGV4dAogICAqIEByZXR1cm5zIHtGdW5jdGlvbn0KICAgKi8KICBmdW5jdGlvbiBiaW5kRm4oZm4sIGNvbnRleHQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIGJvdW5kRm4oKSB7CiAgICAgICAgICByZXR1cm4gZm4uYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTsKICAgICAgfTsKICB9CgogIC8qKgogICAqIGxldCBhIGJvb2xlYW4gdmFsdWUgYWxzbyBiZSBhIGZ1bmN0aW9uIHRoYXQgbXVzdCByZXR1cm4gYSBib29sZWFuCiAgICogdGhpcyBmaXJzdCBpdGVtIGluIGFyZ3Mgd2lsbCBiZSB1c2VkIGFzIHRoZSBjb250ZXh0CiAgICogQHBhcmFtIHtCb29sZWFufEZ1bmN0aW9ufSB2YWwKICAgKiBAcGFyYW0ge0FycmF5fSBbYXJnc10KICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0KICAgKi8KICBmdW5jdGlvbiBib29sT3JGbih2YWwsIGFyZ3MpIHsKICAgICAgaWYgKHR5cGVvZiB2YWwgPT0gVFlQRV9GVU5DVElPTikgewogICAgICAgICAgcmV0dXJuIHZhbC5hcHBseShhcmdzID8gYXJnc1swXSB8fCB1bmRlZmluZWQgOiB1bmRlZmluZWQsIGFyZ3MpOwogICAgICB9CiAgICAgIHJldHVybiB2YWw7CiAgfQoKICAvKioKICAgKiB1c2UgdGhlIHZhbDIgd2hlbiB2YWwxIGlzIHVuZGVmaW5lZAogICAqIEBwYXJhbSB7Kn0gdmFsMQogICAqIEBwYXJhbSB7Kn0gdmFsMgogICAqIEByZXR1cm5zIHsqfQogICAqLwogIGZ1bmN0aW9uIGlmVW5kZWZpbmVkKHZhbDEsIHZhbDIpIHsKICAgICAgcmV0dXJuICh2YWwxID09PSB1bmRlZmluZWQpID8gdmFsMiA6IHZhbDE7CiAgfQoKICAvKioKICAgKiBhZGRFdmVudExpc3RlbmVyIHdpdGggbXVsdGlwbGUgZXZlbnRzIGF0IG9uY2UKICAgKiBAcGFyYW0ge0V2ZW50VGFyZ2V0fSB0YXJnZXQKICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZXMKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyCiAgICovCiAgZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcnModGFyZ2V0LCB0eXBlcywgaGFuZGxlcikgewogICAgICBlYWNoKHNwbGl0U3RyKHR5cGVzKSwgZnVuY3Rpb24odHlwZSkgewogICAgICAgICAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgZmFsc2UpOwogICAgICB9KTsKICB9CgogIC8qKgogICAqIHJlbW92ZUV2ZW50TGlzdGVuZXIgd2l0aCBtdWx0aXBsZSBldmVudHMgYXQgb25jZQogICAqIEBwYXJhbSB7RXZlbnRUYXJnZXR9IHRhcmdldAogICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlcwogICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIKICAgKi8KICBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVycyh0YXJnZXQsIHR5cGVzLCBoYW5kbGVyKSB7CiAgICAgIGVhY2goc3BsaXRTdHIodHlwZXMpLCBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICB0YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBoYW5kbGVyLCBmYWxzZSk7CiAgICAgIH0pOwogIH0KCiAgLyoqCiAgICogZmluZCBpZiBhIG5vZGUgaXMgaW4gdGhlIGdpdmVuIHBhcmVudAogICAqIEBtZXRob2QgaGFzUGFyZW50CiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gbm9kZQogICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IHBhcmVudAogICAqIEByZXR1cm4ge0Jvb2xlYW59IGZvdW5kCiAgICovCiAgZnVuY3Rpb24gaGFzUGFyZW50KG5vZGUsIHBhcmVudCkgewogICAgICB3aGlsZSAobm9kZSkgewogICAgICAgICAgaWYgKG5vZGUgPT0gcGFyZW50KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8qKgogICAqIHNtYWxsIGluZGV4T2Ygd3JhcHBlcgogICAqIEBwYXJhbSB7U3RyaW5nfSBzdHIKICAgKiBAcGFyYW0ge1N0cmluZ30gZmluZAogICAqIEByZXR1cm5zIHtCb29sZWFufSBmb3VuZAogICAqLwogIGZ1bmN0aW9uIGluU3RyKHN0ciwgZmluZCkgewogICAgICByZXR1cm4gc3RyLmluZGV4T2YoZmluZCkgPiAtMTsKICB9CgogIC8qKgogICAqIHNwbGl0IHN0cmluZyBvbiB3aGl0ZXNwYWNlCiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cgogICAqIEByZXR1cm5zIHtBcnJheX0gd29yZHMKICAgKi8KICBmdW5jdGlvbiBzcGxpdFN0cihzdHIpIHsKICAgICAgcmV0dXJuIHN0ci50cmltKCkuc3BsaXQoL1xzKy9nKTsKICB9CgogIC8qKgogICAqIGZpbmQgaWYgYSBhcnJheSBjb250YWlucyB0aGUgb2JqZWN0IHVzaW5nIGluZGV4T2Ygb3IgYSBzaW1wbGUgcG9seUZpbGwKICAgKiBAcGFyYW0ge0FycmF5fSBzcmMKICAgKiBAcGFyYW0ge1N0cmluZ30gZmluZAogICAqIEBwYXJhbSB7U3RyaW5nfSBbZmluZEJ5S2V5XQogICAqIEByZXR1cm4ge0Jvb2xlYW58TnVtYmVyfSBmYWxzZSB3aGVuIG5vdCBmb3VuZCwgb3IgdGhlIGluZGV4CiAgICovCiAgZnVuY3Rpb24gaW5BcnJheShzcmMsIGZpbmQsIGZpbmRCeUtleSkgewogICAgICBpZiAoc3JjLmluZGV4T2YgJiYgIWZpbmRCeUtleSkgewogICAgICAgICAgcmV0dXJuIHNyYy5pbmRleE9mKGZpbmQpOwogICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGkgPSAwOwogICAgICAgICAgd2hpbGUgKGkgPCBzcmMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgaWYgKChmaW5kQnlLZXkgJiYgc3JjW2ldW2ZpbmRCeUtleV0gPT0gZmluZCkgfHwgKCFmaW5kQnlLZXkgJiYgc3JjW2ldID09PSBmaW5kKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgfQoKICAvKioKICAgKiBjb252ZXJ0IGFycmF5LWxpa2Ugb2JqZWN0cyB0byByZWFsIGFycmF5cwogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmoKICAgKiBAcmV0dXJucyB7QXJyYXl9CiAgICovCiAgZnVuY3Rpb24gdG9BcnJheShvYmopIHsKICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKG9iaiwgMCk7CiAgfQoKICAvKioKICAgKiB1bmlxdWUgYXJyYXkgd2l0aCBvYmplY3RzIGJhc2VkIG9uIGEga2V5IChsaWtlICdpZCcpIG9yIGp1c3QgYnkgdGhlIGFycmF5J3MgdmFsdWUKICAgKiBAcGFyYW0ge0FycmF5fSBzcmMgW3tpZDoxfSx7aWQ6Mn0se2lkOjF9XQogICAqIEBwYXJhbSB7U3RyaW5nfSBba2V5XQogICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3NvcnQ9RmFsc2VdCiAgICogQHJldHVybnMge0FycmF5fSBbe2lkOjF9LHtpZDoyfV0KICAgKi8KICBmdW5jdGlvbiB1bmlxdWVBcnJheShzcmMsIGtleSwgc29ydCkgewogICAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgICB2YXIgdmFsdWVzID0gW107CiAgICAgIHZhciBpID0gMDsKCiAgICAgIHdoaWxlIChpIDwgc3JjLmxlbmd0aCkgewogICAgICAgICAgdmFyIHZhbCA9IGtleSA/IHNyY1tpXVtrZXldIDogc3JjW2ldOwogICAgICAgICAgaWYgKGluQXJyYXkodmFsdWVzLCB2YWwpIDwgMCkgewogICAgICAgICAgICAgIHJlc3VsdHMucHVzaChzcmNbaV0pOwogICAgICAgICAgfQogICAgICAgICAgdmFsdWVzW2ldID0gdmFsOwogICAgICAgICAgaSsrOwogICAgICB9CgogICAgICBpZiAoc29ydCkgewogICAgICAgICAgaWYgKCFrZXkpIHsKICAgICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5zb3J0KCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLnNvcnQoZnVuY3Rpb24gc29ydFVuaXF1ZUFycmF5KGEsIGIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGFba2V5XSA+IGJba2V5XTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICAvKioKICAgKiBnZXQgdGhlIHByZWZpeGVkIHByb3BlcnR5CiAgICogQHBhcmFtIHtPYmplY3R9IG9iagogICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wZXJ0eQogICAqIEByZXR1cm5zIHtTdHJpbmd8VW5kZWZpbmVkfSBwcmVmaXhlZAogICAqLwogIGZ1bmN0aW9uIHByZWZpeGVkKG9iaiwgcHJvcGVydHkpIHsKICAgICAgdmFyIHByZWZpeCwgcHJvcDsKICAgICAgdmFyIGNhbWVsUHJvcCA9IHByb3BlcnR5WzBdLnRvVXBwZXJDYXNlKCkgKyBwcm9wZXJ0eS5zbGljZSgxKTsKCiAgICAgIHZhciBpID0gMDsKICAgICAgd2hpbGUgKGkgPCBWRU5ET1JfUFJFRklYRVMubGVuZ3RoKSB7CiAgICAgICAgICBwcmVmaXggPSBWRU5ET1JfUFJFRklYRVNbaV07CiAgICAgICAgICBwcm9wID0gKHByZWZpeCkgPyBwcmVmaXggKyBjYW1lbFByb3AgOiBwcm9wZXJ0eTsKCiAgICAgICAgICBpZiAocHJvcCBpbiBvYmopIHsKICAgICAgICAgICAgICByZXR1cm4gcHJvcDsKICAgICAgICAgIH0KICAgICAgICAgIGkrKzsKICAgICAgfQogICAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KCiAgLyoqCiAgICogZ2V0IGEgdW5pcXVlIGlkCiAgICogQHJldHVybnMge251bWJlcn0gdW5pcXVlSWQKICAgKi8KICB2YXIgX3VuaXF1ZUlkID0gMTsKICBmdW5jdGlvbiB1bmlxdWVJZCgpIHsKICAgICAgcmV0dXJuIF91bmlxdWVJZCsrOwogIH0KCiAgLyoqCiAgICogZ2V0IHRoZSB3aW5kb3cgb2JqZWN0IG9mIGFuIGVsZW1lbnQKICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50CiAgICogQHJldHVybnMge0RvY3VtZW50Vmlld3xXaW5kb3d9CiAgICovCiAgZnVuY3Rpb24gZ2V0V2luZG93Rm9yRWxlbWVudChlbGVtZW50KSB7CiAgICAgIHZhciBkb2MgPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQ7CiAgICAgIHJldHVybiAoZG9jLmRlZmF1bHRWaWV3IHx8IGRvYy5wYXJlbnRXaW5kb3cpOwogIH0KCiAgdmFyIE1PQklMRV9SRUdFWCA9IC9tb2JpbGV8dGFibGV0fGlwKGFkfGhvbmV8b2QpfGFuZHJvaWQvaTsKCiAgdmFyIFNVUFBPUlRfVE9VQ0ggPSAoJ29udG91Y2hzdGFydCcgaW4gd2luZG93KTsKICB2YXIgU1VQUE9SVF9QT0lOVEVSX0VWRU5UUyA9IHByZWZpeGVkKHdpbmRvdywgJ1BvaW50ZXJFdmVudCcpICE9PSB1bmRlZmluZWQ7CiAgdmFyIFNVUFBPUlRfT05MWV9UT1VDSCA9IFNVUFBPUlRfVE9VQ0ggJiYgTU9CSUxFX1JFR0VYLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7CgogIHZhciBJTlBVVF9UWVBFX1RPVUNIID0gJ3RvdWNoJzsKICB2YXIgSU5QVVRfVFlQRV9QRU4gPSAncGVuJzsKICB2YXIgSU5QVVRfVFlQRV9NT1VTRSA9ICdtb3VzZSc7CiAgdmFyIElOUFVUX1RZUEVfS0lORUNUID0gJ2tpbmVjdCc7CgogIHZhciBDT01QVVRFX0lOVEVSVkFMID0gMjU7CgogIHZhciBJTlBVVF9TVEFSVCA9IDE7CiAgdmFyIElOUFVUX01PVkUgPSAyOwogIHZhciBJTlBVVF9FTkQgPSA0OwogIHZhciBJTlBVVF9DQU5DRUwgPSA4OwoKICB2YXIgRElSRUNUSU9OX05PTkUgPSAxOwogIHZhciBESVJFQ1RJT05fTEVGVCA9IDI7CiAgdmFyIERJUkVDVElPTl9SSUdIVCA9IDQ7CiAgdmFyIERJUkVDVElPTl9VUCA9IDg7CiAgdmFyIERJUkVDVElPTl9ET1dOID0gMTY7CgogIHZhciBESVJFQ1RJT05fSE9SSVpPTlRBTCA9IERJUkVDVElPTl9MRUZUIHwgRElSRUNUSU9OX1JJR0hUOwogIHZhciBESVJFQ1RJT05fVkVSVElDQUwgPSBESVJFQ1RJT05fVVAgfCBESVJFQ1RJT05fRE9XTjsKICB2YXIgRElSRUNUSU9OX0FMTCA9IERJUkVDVElPTl9IT1JJWk9OVEFMIHwgRElSRUNUSU9OX1ZFUlRJQ0FMOwoKICB2YXIgUFJPUFNfWFkgPSBbJ3gnLCAneSddOwogIHZhciBQUk9QU19DTElFTlRfWFkgPSBbJ2NsaWVudFgnLCAnY2xpZW50WSddOwoKICAvKioKICAgKiBjcmVhdGUgbmV3IGlucHV0IHR5cGUgbWFuYWdlcgogICAqIEBwYXJhbSB7TWFuYWdlcn0gbWFuYWdlcgogICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiAgICogQHJldHVybnMge0lucHV0fQogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIElucHV0KG1hbmFnZXIsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdGhpcy5tYW5hZ2VyID0gbWFuYWdlcjsKICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICB0aGlzLmVsZW1lbnQgPSBtYW5hZ2VyLmVsZW1lbnQ7CiAgICAgIHRoaXMudGFyZ2V0ID0gbWFuYWdlci5vcHRpb25zLmlucHV0VGFyZ2V0OwoKICAgICAgLy8gc21hbGxlciB3cmFwcGVyIGFyb3VuZCB0aGUgaGFuZGxlciwgZm9yIHRoZSBzY29wZSBhbmQgdGhlIGVuYWJsZWQgc3RhdGUgb2YgdGhlIG1hbmFnZXIsCiAgICAgIC8vIHNvIHdoZW4gZGlzYWJsZWQgdGhlIGlucHV0IGV2ZW50cyBhcmUgY29tcGxldGVseSBieXBhc3NlZC4KICAgICAgdGhpcy5kb21IYW5kbGVyID0gZnVuY3Rpb24oZXYpIHsKICAgICAgICAgIGlmIChib29sT3JGbihtYW5hZ2VyLm9wdGlvbnMuZW5hYmxlLCBbbWFuYWdlcl0pKSB7CiAgICAgICAgICAgICAgc2VsZi5oYW5kbGVyKGV2KTsKICAgICAgICAgIH0KICAgICAgfTsKCiAgICAgIHRoaXMuaW5pdCgpOwoKICB9CgogIElucHV0LnByb3RvdHlwZSA9IHsKICAgICAgLyoqCiAgICAgICAqIHNob3VsZCBoYW5kbGUgdGhlIGlucHV0RXZlbnQgZGF0YSBhbmQgdHJpZ2dlciB0aGUgY2FsbGJhY2sKICAgICAgICogQHZpcnR1YWwKICAgICAgICovCiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKCkgeyB9LAoKICAgICAgLyoqCiAgICAgICAqIGJpbmQgdGhlIGV2ZW50cwogICAgICAgKi8KICAgICAgaW5pdDogZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aGlzLmV2RWwgJiYgYWRkRXZlbnRMaXN0ZW5lcnModGhpcy5lbGVtZW50LCB0aGlzLmV2RWwsIHRoaXMuZG9tSGFuZGxlcik7CiAgICAgICAgICB0aGlzLmV2VGFyZ2V0ICYmIGFkZEV2ZW50TGlzdGVuZXJzKHRoaXMudGFyZ2V0LCB0aGlzLmV2VGFyZ2V0LCB0aGlzLmRvbUhhbmRsZXIpOwogICAgICAgICAgdGhpcy5ldldpbiAmJiBhZGRFdmVudExpc3RlbmVycyhnZXRXaW5kb3dGb3JFbGVtZW50KHRoaXMuZWxlbWVudCksIHRoaXMuZXZXaW4sIHRoaXMuZG9tSGFuZGxlcik7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogdW5iaW5kIHRoZSBldmVudHMKICAgICAgICovCiAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpcy5ldkVsICYmIHJlbW92ZUV2ZW50TGlzdGVuZXJzKHRoaXMuZWxlbWVudCwgdGhpcy5ldkVsLCB0aGlzLmRvbUhhbmRsZXIpOwogICAgICAgICAgdGhpcy5ldlRhcmdldCAmJiByZW1vdmVFdmVudExpc3RlbmVycyh0aGlzLnRhcmdldCwgdGhpcy5ldlRhcmdldCwgdGhpcy5kb21IYW5kbGVyKTsKICAgICAgICAgIHRoaXMuZXZXaW4gJiYgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoZ2V0V2luZG93Rm9yRWxlbWVudCh0aGlzLmVsZW1lbnQpLCB0aGlzLmV2V2luLCB0aGlzLmRvbUhhbmRsZXIpOwogICAgICB9CiAgfTsKCiAgLyoqCiAgICogY3JlYXRlIG5ldyBpbnB1dCB0eXBlIG1hbmFnZXIKICAgKiBjYWxsZWQgYnkgdGhlIE1hbmFnZXIgY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge0hhbW1lcn0gbWFuYWdlcgogICAqIEByZXR1cm5zIHtJbnB1dH0KICAgKi8KICBmdW5jdGlvbiBjcmVhdGVJbnB1dEluc3RhbmNlKG1hbmFnZXIpIHsKICAgICAgdmFyIFR5cGU7CiAgICAgIHZhciBpbnB1dENsYXNzID0gbWFuYWdlci5vcHRpb25zLmlucHV0Q2xhc3M7CgogICAgICBpZiAoaW5wdXRDbGFzcykgewogICAgICAgICAgVHlwZSA9IGlucHV0Q2xhc3M7CiAgICAgIH0gZWxzZSBpZiAoU1VQUE9SVF9QT0lOVEVSX0VWRU5UUykgewogICAgICAgICAgVHlwZSA9IFBvaW50ZXJFdmVudElucHV0OwogICAgICB9IGVsc2UgaWYgKFNVUFBPUlRfT05MWV9UT1VDSCkgewogICAgICAgICAgVHlwZSA9IFRvdWNoSW5wdXQ7CiAgICAgIH0gZWxzZSBpZiAoIVNVUFBPUlRfVE9VQ0gpIHsKICAgICAgICAgIFR5cGUgPSBNb3VzZUlucHV0OwogICAgICB9IGVsc2UgewogICAgICAgICAgVHlwZSA9IFRvdWNoTW91c2VJbnB1dDsKICAgICAgfQogICAgICByZXR1cm4gbmV3IChUeXBlKShtYW5hZ2VyLCBpbnB1dEhhbmRsZXIpOwogIH0KCiAgLyoqCiAgICogaGFuZGxlIGlucHV0IGV2ZW50cwogICAqIEBwYXJhbSB7TWFuYWdlcn0gbWFuYWdlcgogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudFR5cGUKICAgKiBAcGFyYW0ge09iamVjdH0gaW5wdXQKICAgKi8KICBmdW5jdGlvbiBpbnB1dEhhbmRsZXIobWFuYWdlciwgZXZlbnRUeXBlLCBpbnB1dCkgewogICAgICB2YXIgcG9pbnRlcnNMZW4gPSBpbnB1dC5wb2ludGVycy5sZW5ndGg7CiAgICAgIHZhciBjaGFuZ2VkUG9pbnRlcnNMZW4gPSBpbnB1dC5jaGFuZ2VkUG9pbnRlcnMubGVuZ3RoOwogICAgICB2YXIgaXNGaXJzdCA9IChldmVudFR5cGUgJiBJTlBVVF9TVEFSVCAmJiAocG9pbnRlcnNMZW4gLSBjaGFuZ2VkUG9pbnRlcnNMZW4gPT09IDApKTsKICAgICAgdmFyIGlzRmluYWwgPSAoZXZlbnRUeXBlICYgKElOUFVUX0VORCB8IElOUFVUX0NBTkNFTCkgJiYgKHBvaW50ZXJzTGVuIC0gY2hhbmdlZFBvaW50ZXJzTGVuID09PSAwKSk7CgogICAgICBpbnB1dC5pc0ZpcnN0ID0gISFpc0ZpcnN0OwogICAgICBpbnB1dC5pc0ZpbmFsID0gISFpc0ZpbmFsOwoKICAgICAgaWYgKGlzRmlyc3QpIHsKICAgICAgICAgIG1hbmFnZXIuc2Vzc2lvbiA9IHt9OwogICAgICB9CgogICAgICAvLyBzb3VyY2UgZXZlbnQgaXMgdGhlIG5vcm1hbGl6ZWQgdmFsdWUgb2YgdGhlIGRvbUV2ZW50cwogICAgICAvLyBsaWtlICd0b3VjaHN0YXJ0LCBtb3VzZXVwLCBwb2ludGVyZG93bicKICAgICAgaW5wdXQuZXZlbnRUeXBlID0gZXZlbnRUeXBlOwoKICAgICAgLy8gY29tcHV0ZSBzY2FsZSwgcm90YXRpb24gZXRjCiAgICAgIGNvbXB1dGVJbnB1dERhdGEobWFuYWdlciwgaW5wdXQpOwoKICAgICAgLy8gZW1pdCBzZWNyZXQgZXZlbnQKICAgICAgbWFuYWdlci5lbWl0KCdoYW1tZXIuaW5wdXQnLCBpbnB1dCk7CgogICAgICBtYW5hZ2VyLnJlY29nbml6ZShpbnB1dCk7CiAgICAgIG1hbmFnZXIuc2Vzc2lvbi5wcmV2SW5wdXQgPSBpbnB1dDsKICB9CgogIC8qKgogICAqIGV4dGVuZCB0aGUgZGF0YSB3aXRoIHNvbWUgdXNhYmxlIHByb3BlcnRpZXMgbGlrZSBzY2FsZSwgcm90YXRlLCB2ZWxvY2l0eSBldGMKICAgKiBAcGFyYW0ge09iamVjdH0gbWFuYWdlcgogICAqIEBwYXJhbSB7T2JqZWN0fSBpbnB1dAogICAqLwogIGZ1bmN0aW9uIGNvbXB1dGVJbnB1dERhdGEobWFuYWdlciwgaW5wdXQpIHsKICAgICAgdmFyIHNlc3Npb24gPSBtYW5hZ2VyLnNlc3Npb247CiAgICAgIHZhciBwb2ludGVycyA9IGlucHV0LnBvaW50ZXJzOwogICAgICB2YXIgcG9pbnRlcnNMZW5ndGggPSBwb2ludGVycy5sZW5ndGg7CgogICAgICAvLyBzdG9yZSB0aGUgZmlyc3QgaW5wdXQgdG8gY2FsY3VsYXRlIHRoZSBkaXN0YW5jZSBhbmQgZGlyZWN0aW9uCiAgICAgIGlmICghc2Vzc2lvbi5maXJzdElucHV0KSB7CiAgICAgICAgICBzZXNzaW9uLmZpcnN0SW5wdXQgPSBzaW1wbGVDbG9uZUlucHV0RGF0YShpbnB1dCk7CiAgICAgIH0KCiAgICAgIC8vIHRvIGNvbXB1dGUgc2NhbGUgYW5kIHJvdGF0aW9uIHdlIG5lZWQgdG8gc3RvcmUgdGhlIG11bHRpcGxlIHRvdWNoZXMKICAgICAgaWYgKHBvaW50ZXJzTGVuZ3RoID4gMSAmJiAhc2Vzc2lvbi5maXJzdE11bHRpcGxlKSB7CiAgICAgICAgICBzZXNzaW9uLmZpcnN0TXVsdGlwbGUgPSBzaW1wbGVDbG9uZUlucHV0RGF0YShpbnB1dCk7CiAgICAgIH0gZWxzZSBpZiAocG9pbnRlcnNMZW5ndGggPT09IDEpIHsKICAgICAgICAgIHNlc3Npb24uZmlyc3RNdWx0aXBsZSA9IGZhbHNlOwogICAgICB9CgogICAgICB2YXIgZmlyc3RJbnB1dCA9IHNlc3Npb24uZmlyc3RJbnB1dDsKICAgICAgdmFyIGZpcnN0TXVsdGlwbGUgPSBzZXNzaW9uLmZpcnN0TXVsdGlwbGU7CiAgICAgIHZhciBvZmZzZXRDZW50ZXIgPSBmaXJzdE11bHRpcGxlID8gZmlyc3RNdWx0aXBsZS5jZW50ZXIgOiBmaXJzdElucHV0LmNlbnRlcjsKCiAgICAgIHZhciBjZW50ZXIgPSBpbnB1dC5jZW50ZXIgPSBnZXRDZW50ZXIocG9pbnRlcnMpOwogICAgICBpbnB1dC50aW1lU3RhbXAgPSBub3coKTsKICAgICAgaW5wdXQuZGVsdGFUaW1lID0gaW5wdXQudGltZVN0YW1wIC0gZmlyc3RJbnB1dC50aW1lU3RhbXA7CgogICAgICBpbnB1dC5hbmdsZSA9IGdldEFuZ2xlKG9mZnNldENlbnRlciwgY2VudGVyKTsKICAgICAgaW5wdXQuZGlzdGFuY2UgPSBnZXREaXN0YW5jZShvZmZzZXRDZW50ZXIsIGNlbnRlcik7CgogICAgICBjb21wdXRlRGVsdGFYWShzZXNzaW9uLCBpbnB1dCk7CiAgICAgIGlucHV0Lm9mZnNldERpcmVjdGlvbiA9IGdldERpcmVjdGlvbihpbnB1dC5kZWx0YVgsIGlucHV0LmRlbHRhWSk7CgogICAgICBpbnB1dC5zY2FsZSA9IGZpcnN0TXVsdGlwbGUgPyBnZXRTY2FsZShmaXJzdE11bHRpcGxlLnBvaW50ZXJzLCBwb2ludGVycykgOiAxOwogICAgICBpbnB1dC5yb3RhdGlvbiA9IGZpcnN0TXVsdGlwbGUgPyBnZXRSb3RhdGlvbihmaXJzdE11bHRpcGxlLnBvaW50ZXJzLCBwb2ludGVycykgOiAwOwoKICAgICAgY29tcHV0ZUludGVydmFsSW5wdXREYXRhKHNlc3Npb24sIGlucHV0KTsKCiAgICAgIC8vIGZpbmQgdGhlIGNvcnJlY3QgdGFyZ2V0CiAgICAgIHZhciB0YXJnZXQgPSBtYW5hZ2VyLmVsZW1lbnQ7CiAgICAgIGlmIChoYXNQYXJlbnQoaW5wdXQuc3JjRXZlbnQudGFyZ2V0LCB0YXJnZXQpKSB7CiAgICAgICAgICB0YXJnZXQgPSBpbnB1dC5zcmNFdmVudC50YXJnZXQ7CiAgICAgIH0KICAgICAgaW5wdXQudGFyZ2V0ID0gdGFyZ2V0OwogIH0KCiAgZnVuY3Rpb24gY29tcHV0ZURlbHRhWFkoc2Vzc2lvbiwgaW5wdXQpIHsKICAgICAgdmFyIGNlbnRlciA9IGlucHV0LmNlbnRlcjsKICAgICAgdmFyIG9mZnNldCA9IHNlc3Npb24ub2Zmc2V0RGVsdGEgfHwge307CiAgICAgIHZhciBwcmV2RGVsdGEgPSBzZXNzaW9uLnByZXZEZWx0YSB8fCB7fTsKICAgICAgdmFyIHByZXZJbnB1dCA9IHNlc3Npb24ucHJldklucHV0IHx8IHt9OwoKICAgICAgaWYgKGlucHV0LmV2ZW50VHlwZSA9PT0gSU5QVVRfU1RBUlQgfHwgcHJldklucHV0LmV2ZW50VHlwZSA9PT0gSU5QVVRfRU5EKSB7CiAgICAgICAgICBwcmV2RGVsdGEgPSBzZXNzaW9uLnByZXZEZWx0YSA9IHsKICAgICAgICAgICAgICB4OiBwcmV2SW5wdXQuZGVsdGFYIHx8IDAsCiAgICAgICAgICAgICAgeTogcHJldklucHV0LmRlbHRhWSB8fCAwCiAgICAgICAgICB9OwoKICAgICAgICAgIG9mZnNldCA9IHNlc3Npb24ub2Zmc2V0RGVsdGEgPSB7CiAgICAgICAgICAgICAgeDogY2VudGVyLngsCiAgICAgICAgICAgICAgeTogY2VudGVyLnkKICAgICAgICAgIH07CiAgICAgIH0KCiAgICAgIGlucHV0LmRlbHRhWCA9IHByZXZEZWx0YS54ICsgKGNlbnRlci54IC0gb2Zmc2V0LngpOwogICAgICBpbnB1dC5kZWx0YVkgPSBwcmV2RGVsdGEueSArIChjZW50ZXIueSAtIG9mZnNldC55KTsKICB9CgogIC8qKgogICAqIHZlbG9jaXR5IGlzIGNhbGN1bGF0ZWQgZXZlcnkgeCBtcwogICAqIEBwYXJhbSB7T2JqZWN0fSBzZXNzaW9uCiAgICogQHBhcmFtIHtPYmplY3R9IGlucHV0CiAgICovCiAgZnVuY3Rpb24gY29tcHV0ZUludGVydmFsSW5wdXREYXRhKHNlc3Npb24sIGlucHV0KSB7CiAgICAgIHZhciBsYXN0ID0gc2Vzc2lvbi5sYXN0SW50ZXJ2YWwgfHwgaW5wdXQsCiAgICAgICAgICBkZWx0YVRpbWUgPSBpbnB1dC50aW1lU3RhbXAgLSBsYXN0LnRpbWVTdGFtcCwKICAgICAgICAgIHZlbG9jaXR5LCB2ZWxvY2l0eVgsIHZlbG9jaXR5WSwgZGlyZWN0aW9uOwoKICAgICAgaWYgKGlucHV0LmV2ZW50VHlwZSAhPSBJTlBVVF9DQU5DRUwgJiYgKGRlbHRhVGltZSA+IENPTVBVVEVfSU5URVJWQUwgfHwgbGFzdC52ZWxvY2l0eSA9PT0gdW5kZWZpbmVkKSkgewogICAgICAgICAgdmFyIGRlbHRhWCA9IGxhc3QuZGVsdGFYIC0gaW5wdXQuZGVsdGFYOwogICAgICAgICAgdmFyIGRlbHRhWSA9IGxhc3QuZGVsdGFZIC0gaW5wdXQuZGVsdGFZOwoKICAgICAgICAgIHZhciB2ID0gZ2V0VmVsb2NpdHkoZGVsdGFUaW1lLCBkZWx0YVgsIGRlbHRhWSk7CiAgICAgICAgICB2ZWxvY2l0eVggPSB2Lng7CiAgICAgICAgICB2ZWxvY2l0eVkgPSB2Lnk7CiAgICAgICAgICB2ZWxvY2l0eSA9IChhYnModi54KSA+IGFicyh2LnkpKSA/IHYueCA6IHYueTsKICAgICAgICAgIGRpcmVjdGlvbiA9IGdldERpcmVjdGlvbihkZWx0YVgsIGRlbHRhWSk7CgogICAgICAgICAgc2Vzc2lvbi5sYXN0SW50ZXJ2YWwgPSBpbnB1dDsKICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIHVzZSBsYXRlc3QgdmVsb2NpdHkgaW5mbyBpZiBpdCBkb2Vzbid0IG92ZXJ0YWtlIGEgbWluaW11bSBwZXJpb2QKICAgICAgICAgIHZlbG9jaXR5ID0gbGFzdC52ZWxvY2l0eTsKICAgICAgICAgIHZlbG9jaXR5WCA9IGxhc3QudmVsb2NpdHlYOwogICAgICAgICAgdmVsb2NpdHlZID0gbGFzdC52ZWxvY2l0eVk7CiAgICAgICAgICBkaXJlY3Rpb24gPSBsYXN0LmRpcmVjdGlvbjsKICAgICAgfQoKICAgICAgaW5wdXQudmVsb2NpdHkgPSB2ZWxvY2l0eTsKICAgICAgaW5wdXQudmVsb2NpdHlYID0gdmVsb2NpdHlYOwogICAgICBpbnB1dC52ZWxvY2l0eVkgPSB2ZWxvY2l0eVk7CiAgICAgIGlucHV0LmRpcmVjdGlvbiA9IGRpcmVjdGlvbjsKICB9CgogIC8qKgogICAqIGNyZWF0ZSBhIHNpbXBsZSBjbG9uZSBmcm9tIHRoZSBpbnB1dCB1c2VkIGZvciBzdG9yYWdlIG9mIGZpcnN0SW5wdXQgYW5kIGZpcnN0TXVsdGlwbGUKICAgKiBAcGFyYW0ge09iamVjdH0gaW5wdXQKICAgKiBAcmV0dXJucyB7T2JqZWN0fSBjbG9uZWRJbnB1dERhdGEKICAgKi8KICBmdW5jdGlvbiBzaW1wbGVDbG9uZUlucHV0RGF0YShpbnB1dCkgewogICAgICAvLyBtYWtlIGEgc2ltcGxlIGNvcHkgb2YgdGhlIHBvaW50ZXJzIGJlY2F1c2Ugd2Ugd2lsbCBnZXQgYSByZWZlcmVuY2UgaWYgd2UgZG9uJ3QKICAgICAgLy8gd2Ugb25seSBuZWVkIGNsaWVudFhZIGZvciB0aGUgY2FsY3VsYXRpb25zCiAgICAgIHZhciBwb2ludGVycyA9IFtdOwogICAgICB2YXIgaSA9IDA7CiAgICAgIHdoaWxlIChpIDwgaW5wdXQucG9pbnRlcnMubGVuZ3RoKSB7CiAgICAgICAgICBwb2ludGVyc1tpXSA9IHsKICAgICAgICAgICAgICBjbGllbnRYOiByb3VuZChpbnB1dC5wb2ludGVyc1tpXS5jbGllbnRYKSwKICAgICAgICAgICAgICBjbGllbnRZOiByb3VuZChpbnB1dC5wb2ludGVyc1tpXS5jbGllbnRZKQogICAgICAgICAgfTsKICAgICAgICAgIGkrKzsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRpbWVTdGFtcDogbm93KCksCiAgICAgICAgICBwb2ludGVyczogcG9pbnRlcnMsCiAgICAgICAgICBjZW50ZXI6IGdldENlbnRlcihwb2ludGVycyksCiAgICAgICAgICBkZWx0YVg6IGlucHV0LmRlbHRhWCwKICAgICAgICAgIGRlbHRhWTogaW5wdXQuZGVsdGFZCiAgICAgIH07CiAgfQoKICAvKioKICAgKiBnZXQgdGhlIGNlbnRlciBvZiBhbGwgdGhlIHBvaW50ZXJzCiAgICogQHBhcmFtIHtBcnJheX0gcG9pbnRlcnMKICAgKiBAcmV0dXJuIHtPYmplY3R9IGNlbnRlciBjb250YWlucyBgeGAgYW5kIGB5YCBwcm9wZXJ0aWVzCiAgICovCiAgZnVuY3Rpb24gZ2V0Q2VudGVyKHBvaW50ZXJzKSB7CiAgICAgIHZhciBwb2ludGVyc0xlbmd0aCA9IHBvaW50ZXJzLmxlbmd0aDsKCiAgICAgIC8vIG5vIG5lZWQgdG8gbG9vcCB3aGVuIG9ubHkgb25lIHRvdWNoCiAgICAgIGlmIChwb2ludGVyc0xlbmd0aCA9PT0gMSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB4OiByb3VuZChwb2ludGVyc1swXS5jbGllbnRYKSwKICAgICAgICAgICAgICB5OiByb3VuZChwb2ludGVyc1swXS5jbGllbnRZKQogICAgICAgICAgfTsKICAgICAgfQoKICAgICAgdmFyIHggPSAwLCB5ID0gMCwgaSA9IDA7CiAgICAgIHdoaWxlIChpIDwgcG9pbnRlcnNMZW5ndGgpIHsKICAgICAgICAgIHggKz0gcG9pbnRlcnNbaV0uY2xpZW50WDsKICAgICAgICAgIHkgKz0gcG9pbnRlcnNbaV0uY2xpZW50WTsKICAgICAgICAgIGkrKzsKICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICAgIHg6IHJvdW5kKHggLyBwb2ludGVyc0xlbmd0aCksCiAgICAgICAgICB5OiByb3VuZCh5IC8gcG9pbnRlcnNMZW5ndGgpCiAgICAgIH07CiAgfQoKICAvKioKICAgKiBjYWxjdWxhdGUgdGhlIHZlbG9jaXR5IGJldHdlZW4gdHdvIHBvaW50cy4gdW5pdCBpcyBpbiBweCBwZXIgbXMuCiAgICogQHBhcmFtIHtOdW1iZXJ9IGRlbHRhVGltZQogICAqIEBwYXJhbSB7TnVtYmVyfSB4CiAgICogQHBhcmFtIHtOdW1iZXJ9IHkKICAgKiBAcmV0dXJuIHtPYmplY3R9IHZlbG9jaXR5IGB4YCBhbmQgYHlgCiAgICovCiAgZnVuY3Rpb24gZ2V0VmVsb2NpdHkoZGVsdGFUaW1lLCB4LCB5KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgICB4OiB4IC8gZGVsdGFUaW1lIHx8IDAsCiAgICAgICAgICB5OiB5IC8gZGVsdGFUaW1lIHx8IDAKICAgICAgfTsKICB9CgogIC8qKgogICAqIGdldCB0aGUgZGlyZWN0aW9uIGJldHdlZW4gdHdvIHBvaW50cwogICAqIEBwYXJhbSB7TnVtYmVyfSB4CiAgICogQHBhcmFtIHtOdW1iZXJ9IHkKICAgKiBAcmV0dXJuIHtOdW1iZXJ9IGRpcmVjdGlvbgogICAqLwogIGZ1bmN0aW9uIGdldERpcmVjdGlvbih4LCB5KSB7CiAgICAgIGlmICh4ID09PSB5KSB7CiAgICAgICAgICByZXR1cm4gRElSRUNUSU9OX05PTkU7CiAgICAgIH0KCiAgICAgIGlmIChhYnMoeCkgPj0gYWJzKHkpKSB7CiAgICAgICAgICByZXR1cm4geCA+IDAgPyBESVJFQ1RJT05fTEVGVCA6IERJUkVDVElPTl9SSUdIVDsKICAgICAgfQogICAgICByZXR1cm4geSA+IDAgPyBESVJFQ1RJT05fVVAgOiBESVJFQ1RJT05fRE9XTjsKICB9CgogIC8qKgogICAqIGNhbGN1bGF0ZSB0aGUgYWJzb2x1dGUgZGlzdGFuY2UgYmV0d2VlbiB0d28gcG9pbnRzCiAgICogQHBhcmFtIHtPYmplY3R9IHAxIHt4LCB5fQogICAqIEBwYXJhbSB7T2JqZWN0fSBwMiB7eCwgeX0KICAgKiBAcGFyYW0ge0FycmF5fSBbcHJvcHNdIGNvbnRhaW5pbmcgeCBhbmQgeSBrZXlzCiAgICogQHJldHVybiB7TnVtYmVyfSBkaXN0YW5jZQogICAqLwogIGZ1bmN0aW9uIGdldERpc3RhbmNlKHAxLCBwMiwgcHJvcHMpIHsKICAgICAgaWYgKCFwcm9wcykgewogICAgICAgICAgcHJvcHMgPSBQUk9QU19YWTsKICAgICAgfQogICAgICB2YXIgeCA9IHAyW3Byb3BzWzBdXSAtIHAxW3Byb3BzWzBdXSwKICAgICAgICAgIHkgPSBwMltwcm9wc1sxXV0gLSBwMVtwcm9wc1sxXV07CgogICAgICByZXR1cm4gTWF0aC5zcXJ0KCh4ICogeCkgKyAoeSAqIHkpKTsKICB9CgogIC8qKgogICAqIGNhbGN1bGF0ZSB0aGUgYW5nbGUgYmV0d2VlbiB0d28gY29vcmRpbmF0ZXMKICAgKiBAcGFyYW0ge09iamVjdH0gcDEKICAgKiBAcGFyYW0ge09iamVjdH0gcDIKICAgKiBAcGFyYW0ge0FycmF5fSBbcHJvcHNdIGNvbnRhaW5pbmcgeCBhbmQgeSBrZXlzCiAgICogQHJldHVybiB7TnVtYmVyfSBhbmdsZQogICAqLwogIGZ1bmN0aW9uIGdldEFuZ2xlKHAxLCBwMiwgcHJvcHMpIHsKICAgICAgaWYgKCFwcm9wcykgewogICAgICAgICAgcHJvcHMgPSBQUk9QU19YWTsKICAgICAgfQogICAgICB2YXIgeCA9IHAyW3Byb3BzWzBdXSAtIHAxW3Byb3BzWzBdXSwKICAgICAgICAgIHkgPSBwMltwcm9wc1sxXV0gLSBwMVtwcm9wc1sxXV07CiAgICAgIHJldHVybiBNYXRoLmF0YW4yKHksIHgpICogMTgwIC8gTWF0aC5QSTsKICB9CgogIC8qKgogICAqIGNhbGN1bGF0ZSB0aGUgcm90YXRpb24gZGVncmVlcyBiZXR3ZWVuIHR3byBwb2ludGVyc2V0cwogICAqIEBwYXJhbSB7QXJyYXl9IHN0YXJ0IGFycmF5IG9mIHBvaW50ZXJzCiAgICogQHBhcmFtIHtBcnJheX0gZW5kIGFycmF5IG9mIHBvaW50ZXJzCiAgICogQHJldHVybiB7TnVtYmVyfSByb3RhdGlvbgogICAqLwogIGZ1bmN0aW9uIGdldFJvdGF0aW9uKHN0YXJ0LCBlbmQpIHsKICAgICAgcmV0dXJuIGdldEFuZ2xlKGVuZFsxXSwgZW5kWzBdLCBQUk9QU19DTElFTlRfWFkpIC0gZ2V0QW5nbGUoc3RhcnRbMV0sIHN0YXJ0WzBdLCBQUk9QU19DTElFTlRfWFkpOwogIH0KCiAgLyoqCiAgICogY2FsY3VsYXRlIHRoZSBzY2FsZSBmYWN0b3IgYmV0d2VlbiB0d28gcG9pbnRlcnNldHMKICAgKiBubyBzY2FsZSBpcyAxLCBhbmQgZ29lcyBkb3duIHRvIDAgd2hlbiBwaW5jaGVkIHRvZ2V0aGVyLCBhbmQgYmlnZ2VyIHdoZW4gcGluY2hlZCBvdXQKICAgKiBAcGFyYW0ge0FycmF5fSBzdGFydCBhcnJheSBvZiBwb2ludGVycwogICAqIEBwYXJhbSB7QXJyYXl9IGVuZCBhcnJheSBvZiBwb2ludGVycwogICAqIEByZXR1cm4ge051bWJlcn0gc2NhbGUKICAgKi8KICBmdW5jdGlvbiBnZXRTY2FsZShzdGFydCwgZW5kKSB7CiAgICAgIHJldHVybiBnZXREaXN0YW5jZShlbmRbMF0sIGVuZFsxXSwgUFJPUFNfQ0xJRU5UX1hZKSAvIGdldERpc3RhbmNlKHN0YXJ0WzBdLCBzdGFydFsxXSwgUFJPUFNfQ0xJRU5UX1hZKTsKICB9CgogIHZhciBNT1VTRV9JTlBVVF9NQVAgPSB7CiAgICAgIG1vdXNlZG93bjogSU5QVVRfU1RBUlQsCiAgICAgIG1vdXNlbW92ZTogSU5QVVRfTU9WRSwKICAgICAgbW91c2V1cDogSU5QVVRfRU5ECiAgfTsKCiAgdmFyIE1PVVNFX0VMRU1FTlRfRVZFTlRTID0gJ21vdXNlZG93bic7CiAgdmFyIE1PVVNFX1dJTkRPV19FVkVOVFMgPSAnbW91c2Vtb3ZlIG1vdXNldXAnOwoKICAvKioKICAgKiBNb3VzZSBldmVudHMgaW5wdXQKICAgKiBAY29uc3RydWN0b3IKICAgKiBAZXh0ZW5kcyBJbnB1dAogICAqLwogIGZ1bmN0aW9uIE1vdXNlSW5wdXQoKSB7CiAgICAgIHRoaXMuZXZFbCA9IE1PVVNFX0VMRU1FTlRfRVZFTlRTOwogICAgICB0aGlzLmV2V2luID0gTU9VU0VfV0lORE9XX0VWRU5UUzsKCiAgICAgIHRoaXMuYWxsb3cgPSB0cnVlOyAvLyB1c2VkIGJ5IElucHV0LlRvdWNoTW91c2UgdG8gZGlzYWJsZSBtb3VzZSBldmVudHMKICAgICAgdGhpcy5wcmVzc2VkID0gZmFsc2U7IC8vIG1vdXNlZG93biBzdGF0ZQoKICAgICAgSW5wdXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9CgogIGluaGVyaXQoTW91c2VJbnB1dCwgSW5wdXQsIHsKICAgICAgLyoqCiAgICAgICAqIGhhbmRsZSBtb3VzZSBldmVudHMKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2CiAgICAgICAqLwogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBNRWhhbmRsZXIoZXYpIHsKICAgICAgICAgIHZhciBldmVudFR5cGUgPSBNT1VTRV9JTlBVVF9NQVBbZXYudHlwZV07CgogICAgICAgICAgLy8gb24gc3RhcnQgd2Ugd2FudCB0byBoYXZlIHRoZSBsZWZ0IG1vdXNlIGJ1dHRvbiBkb3duCiAgICAgICAgICBpZiAoZXZlbnRUeXBlICYgSU5QVVRfU1RBUlQgJiYgZXYuYnV0dG9uID09PSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5wcmVzc2VkID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZXZlbnRUeXBlICYgSU5QVVRfTU9WRSAmJiBldi53aGljaCAhPT0gMSkgewogICAgICAgICAgICAgIGV2ZW50VHlwZSA9IElOUFVUX0VORDsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBtb3VzZSBtdXN0IGJlIGRvd24sIGFuZCBtb3VzZSBldmVudHMgYXJlIGFsbG93ZWQgKHNlZSB0aGUgVG91Y2hNb3VzZSBpbnB1dCkKICAgICAgICAgIGlmICghdGhpcy5wcmVzc2VkIHx8ICF0aGlzLmFsbG93KSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChldmVudFR5cGUgJiBJTlBVVF9FTkQpIHsKICAgICAgICAgICAgICB0aGlzLnByZXNzZWQgPSBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHRoaXMubWFuYWdlciwgZXZlbnRUeXBlLCB7CiAgICAgICAgICAgICAgcG9pbnRlcnM6IFtldl0sCiAgICAgICAgICAgICAgY2hhbmdlZFBvaW50ZXJzOiBbZXZdLAogICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBJTlBVVF9UWVBFX01PVVNFLAogICAgICAgICAgICAgIHNyY0V2ZW50OiBldgogICAgICAgICAgfSk7CiAgICAgIH0KICB9KTsKCiAgdmFyIFBPSU5URVJfSU5QVVRfTUFQID0gewogICAgICBwb2ludGVyZG93bjogSU5QVVRfU1RBUlQsCiAgICAgIHBvaW50ZXJtb3ZlOiBJTlBVVF9NT1ZFLAogICAgICBwb2ludGVydXA6IElOUFVUX0VORCwKICAgICAgcG9pbnRlcmNhbmNlbDogSU5QVVRfQ0FOQ0VMLAogICAgICBwb2ludGVyb3V0OiBJTlBVVF9DQU5DRUwKICB9OwoKICAvLyBpbiBJRTEwIHRoZSBwb2ludGVyIHR5cGVzIGlzIGRlZmluZWQgYXMgYW4gZW51bQogIHZhciBJRTEwX1BPSU5URVJfVFlQRV9FTlVNID0gewogICAgICAyOiBJTlBVVF9UWVBFX1RPVUNILAogICAgICAzOiBJTlBVVF9UWVBFX1BFTiwKICAgICAgNDogSU5QVVRfVFlQRV9NT1VTRSwKICAgICAgNTogSU5QVVRfVFlQRV9LSU5FQ1QgLy8gc2VlIGh0dHBzOi8vdHdpdHRlci5jb20vamFjb2Jyb3NzaS9zdGF0dXMvNDgwNTk2NDM4NDg5ODkwODE2CiAgfTsKCiAgdmFyIFBPSU5URVJfRUxFTUVOVF9FVkVOVFMgPSAncG9pbnRlcmRvd24nOwogIHZhciBQT0lOVEVSX1dJTkRPV19FVkVOVFMgPSAncG9pbnRlcm1vdmUgcG9pbnRlcnVwIHBvaW50ZXJjYW5jZWwnOwoKICAvLyBJRTEwIGhhcyBwcmVmaXhlZCBzdXBwb3J0LCBhbmQgY2FzZS1zZW5zaXRpdmUKICBpZiAod2luZG93Lk1TUG9pbnRlckV2ZW50KSB7CiAgICAgIFBPSU5URVJfRUxFTUVOVF9FVkVOVFMgPSAnTVNQb2ludGVyRG93bic7CiAgICAgIFBPSU5URVJfV0lORE9XX0VWRU5UUyA9ICdNU1BvaW50ZXJNb3ZlIE1TUG9pbnRlclVwIE1TUG9pbnRlckNhbmNlbCc7CiAgfQoKICAvKioKICAgKiBQb2ludGVyIGV2ZW50cyBpbnB1dAogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBleHRlbmRzIElucHV0CiAgICovCiAgZnVuY3Rpb24gUG9pbnRlckV2ZW50SW5wdXQoKSB7CiAgICAgIHRoaXMuZXZFbCA9IFBPSU5URVJfRUxFTUVOVF9FVkVOVFM7CiAgICAgIHRoaXMuZXZXaW4gPSBQT0lOVEVSX1dJTkRPV19FVkVOVFM7CgogICAgICBJbnB1dC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICAgICAgdGhpcy5zdG9yZSA9ICh0aGlzLm1hbmFnZXIuc2Vzc2lvbi5wb2ludGVyRXZlbnRzID0gW10pOwogIH0KCiAgaW5oZXJpdChQb2ludGVyRXZlbnRJbnB1dCwgSW5wdXQsIHsKICAgICAgLyoqCiAgICAgICAqIGhhbmRsZSBtb3VzZSBldmVudHMKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGV2CiAgICAgICAqLwogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBQRWhhbmRsZXIoZXYpIHsKICAgICAgICAgIHZhciBzdG9yZSA9IHRoaXMuc3RvcmU7CiAgICAgICAgICB2YXIgcmVtb3ZlUG9pbnRlciA9IGZhbHNlOwoKICAgICAgICAgIHZhciBldmVudFR5cGVOb3JtYWxpemVkID0gZXYudHlwZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJ21zJywgJycpOwogICAgICAgICAgdmFyIGV2ZW50VHlwZSA9IFBPSU5URVJfSU5QVVRfTUFQW2V2ZW50VHlwZU5vcm1hbGl6ZWRdOwogICAgICAgICAgdmFyIHBvaW50ZXJUeXBlID0gSUUxMF9QT0lOVEVSX1RZUEVfRU5VTVtldi5wb2ludGVyVHlwZV0gfHwgZXYucG9pbnRlclR5cGU7CgogICAgICAgICAgdmFyIGlzVG91Y2ggPSAocG9pbnRlclR5cGUgPT0gSU5QVVRfVFlQRV9UT1VDSCk7CgogICAgICAgICAgLy8gZ2V0IGluZGV4IG9mIHRoZSBldmVudCBpbiB0aGUgc3RvcmUKICAgICAgICAgIHZhciBzdG9yZUluZGV4ID0gaW5BcnJheShzdG9yZSwgZXYucG9pbnRlcklkLCAncG9pbnRlcklkJyk7CgogICAgICAgICAgLy8gc3RhcnQgYW5kIG1vdXNlIG11c3QgYmUgZG93bgogICAgICAgICAgaWYgKGV2ZW50VHlwZSAmIElOUFVUX1NUQVJUICYmIChldi5idXR0b24gPT09IDAgfHwgaXNUb3VjaCkpIHsKICAgICAgICAgICAgICBpZiAoc3RvcmVJbmRleCA8IDApIHsKICAgICAgICAgICAgICAgICAgc3RvcmUucHVzaChldik7CiAgICAgICAgICAgICAgICAgIHN0b3JlSW5kZXggPSBzdG9yZS5sZW5ndGggLSAxOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnRUeXBlICYgKElOUFVUX0VORCB8IElOUFVUX0NBTkNFTCkpIHsKICAgICAgICAgICAgICByZW1vdmVQb2ludGVyID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBpdCBub3QgZm91bmQsIHNvIHRoZSBwb2ludGVyIGhhc24ndCBiZWVuIGRvd24gKHNvIGl0J3MgcHJvYmFibHkgYSBob3ZlcikKICAgICAgICAgIGlmIChzdG9yZUluZGV4IDwgMCkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyB1cGRhdGUgdGhlIGV2ZW50IGluIHRoZSBzdG9yZQogICAgICAgICAgc3RvcmVbc3RvcmVJbmRleF0gPSBldjsKCiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHRoaXMubWFuYWdlciwgZXZlbnRUeXBlLCB7CiAgICAgICAgICAgICAgcG9pbnRlcnM6IHN0b3JlLAogICAgICAgICAgICAgIGNoYW5nZWRQb2ludGVyczogW2V2XSwKICAgICAgICAgICAgICBwb2ludGVyVHlwZTogcG9pbnRlclR5cGUsCiAgICAgICAgICAgICAgc3JjRXZlbnQ6IGV2CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAocmVtb3ZlUG9pbnRlcikgewogICAgICAgICAgICAgIC8vIHJlbW92ZSBmcm9tIHRoZSBzdG9yZQogICAgICAgICAgICAgIHN0b3JlLnNwbGljZShzdG9yZUluZGV4LCAxKTsKICAgICAgICAgIH0KICAgICAgfQogIH0pOwoKICB2YXIgU0lOR0xFX1RPVUNIX0lOUFVUX01BUCA9IHsKICAgICAgdG91Y2hzdGFydDogSU5QVVRfU1RBUlQsCiAgICAgIHRvdWNobW92ZTogSU5QVVRfTU9WRSwKICAgICAgdG91Y2hlbmQ6IElOUFVUX0VORCwKICAgICAgdG91Y2hjYW5jZWw6IElOUFVUX0NBTkNFTAogIH07CgogIHZhciBTSU5HTEVfVE9VQ0hfVEFSR0VUX0VWRU5UUyA9ICd0b3VjaHN0YXJ0JzsKICB2YXIgU0lOR0xFX1RPVUNIX1dJTkRPV19FVkVOVFMgPSAndG91Y2hzdGFydCB0b3VjaG1vdmUgdG91Y2hlbmQgdG91Y2hjYW5jZWwnOwoKICAvKioKICAgKiBUb3VjaCBldmVudHMgaW5wdXQKICAgKiBAY29uc3RydWN0b3IKICAgKiBAZXh0ZW5kcyBJbnB1dAogICAqLwogIGZ1bmN0aW9uIFNpbmdsZVRvdWNoSW5wdXQoKSB7CiAgICAgIHRoaXMuZXZUYXJnZXQgPSBTSU5HTEVfVE9VQ0hfVEFSR0VUX0VWRU5UUzsKICAgICAgdGhpcy5ldldpbiA9IFNJTkdMRV9UT1VDSF9XSU5ET1dfRVZFTlRTOwogICAgICB0aGlzLnN0YXJ0ZWQgPSBmYWxzZTsKCiAgICAgIElucHV0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICBpbmhlcml0KFNpbmdsZVRvdWNoSW5wdXQsIElucHV0LCB7CiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIFRFaGFuZGxlcihldikgewogICAgICAgICAgdmFyIHR5cGUgPSBTSU5HTEVfVE9VQ0hfSU5QVVRfTUFQW2V2LnR5cGVdOwoKICAgICAgICAgIC8vIHNob3VsZCB3ZSBoYW5kbGUgdGhlIHRvdWNoIGV2ZW50cz8KICAgICAgICAgIGlmICh0eXBlID09PSBJTlBVVF9TVEFSVCkgewogICAgICAgICAgICAgIHRoaXMuc3RhcnRlZCA9IHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCF0aGlzLnN0YXJ0ZWQpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHRvdWNoZXMgPSBub3JtYWxpemVTaW5nbGVUb3VjaGVzLmNhbGwodGhpcywgZXYsIHR5cGUpOwoKICAgICAgICAgIC8vIHdoZW4gZG9uZSwgcmVzZXQgdGhlIHN0YXJ0ZWQgc3RhdGUKICAgICAgICAgIGlmICh0eXBlICYgKElOUFVUX0VORCB8IElOUFVUX0NBTkNFTCkgJiYgdG91Y2hlc1swXS5sZW5ndGggLSB0b3VjaGVzWzFdLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIHRoaXMuc3RhcnRlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY2FsbGJhY2sodGhpcy5tYW5hZ2VyLCB0eXBlLCB7CiAgICAgICAgICAgICAgcG9pbnRlcnM6IHRvdWNoZXNbMF0sCiAgICAgICAgICAgICAgY2hhbmdlZFBvaW50ZXJzOiB0b3VjaGVzWzFdLAogICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBJTlBVVF9UWVBFX1RPVUNILAogICAgICAgICAgICAgIHNyY0V2ZW50OiBldgogICAgICAgICAgfSk7CiAgICAgIH0KICB9KTsKCiAgLyoqCiAgICogQHRoaXMge1RvdWNoSW5wdXR9CiAgICogQHBhcmFtIHtPYmplY3R9IGV2CiAgICogQHBhcmFtIHtOdW1iZXJ9IHR5cGUgZmxhZwogICAqIEByZXR1cm5zIHt1bmRlZmluZWR8QXJyYXl9IFthbGwsIGNoYW5nZWRdCiAgICovCiAgZnVuY3Rpb24gbm9ybWFsaXplU2luZ2xlVG91Y2hlcyhldiwgdHlwZSkgewogICAgICB2YXIgYWxsID0gdG9BcnJheShldi50b3VjaGVzKTsKICAgICAgdmFyIGNoYW5nZWQgPSB0b0FycmF5KGV2LmNoYW5nZWRUb3VjaGVzKTsKCiAgICAgIGlmICh0eXBlICYgKElOUFVUX0VORCB8IElOUFVUX0NBTkNFTCkpIHsKICAgICAgICAgIGFsbCA9IHVuaXF1ZUFycmF5KGFsbC5jb25jYXQoY2hhbmdlZCksICdpZGVudGlmaWVyJywgdHJ1ZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBbYWxsLCBjaGFuZ2VkXTsKICB9CgogIHZhciBUT1VDSF9JTlBVVF9NQVAgPSB7CiAgICAgIHRvdWNoc3RhcnQ6IElOUFVUX1NUQVJULAogICAgICB0b3VjaG1vdmU6IElOUFVUX01PVkUsCiAgICAgIHRvdWNoZW5kOiBJTlBVVF9FTkQsCiAgICAgIHRvdWNoY2FuY2VsOiBJTlBVVF9DQU5DRUwKICB9OwoKICB2YXIgVE9VQ0hfVEFSR0VUX0VWRU5UUyA9ICd0b3VjaHN0YXJ0IHRvdWNobW92ZSB0b3VjaGVuZCB0b3VjaGNhbmNlbCc7CgogIC8qKgogICAqIE11bHRpLXVzZXIgdG91Y2ggZXZlbnRzIGlucHV0CiAgICogQGNvbnN0cnVjdG9yCiAgICogQGV4dGVuZHMgSW5wdXQKICAgKi8KICBmdW5jdGlvbiBUb3VjaElucHV0KCkgewogICAgICB0aGlzLmV2VGFyZ2V0ID0gVE9VQ0hfVEFSR0VUX0VWRU5UUzsKICAgICAgdGhpcy50YXJnZXRJZHMgPSB7fTsKCiAgICAgIElucHV0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICBpbmhlcml0KFRvdWNoSW5wdXQsIElucHV0LCB7CiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIE1URWhhbmRsZXIoZXYpIHsKICAgICAgICAgIHZhciB0eXBlID0gVE9VQ0hfSU5QVVRfTUFQW2V2LnR5cGVdOwogICAgICAgICAgdmFyIHRvdWNoZXMgPSBnZXRUb3VjaGVzLmNhbGwodGhpcywgZXYsIHR5cGUpOwogICAgICAgICAgaWYgKCF0b3VjaGVzKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuY2FsbGJhY2sodGhpcy5tYW5hZ2VyLCB0eXBlLCB7CiAgICAgICAgICAgICAgcG9pbnRlcnM6IHRvdWNoZXNbMF0sCiAgICAgICAgICAgICAgY2hhbmdlZFBvaW50ZXJzOiB0b3VjaGVzWzFdLAogICAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBJTlBVVF9UWVBFX1RPVUNILAogICAgICAgICAgICAgIHNyY0V2ZW50OiBldgogICAgICAgICAgfSk7CiAgICAgIH0KICB9KTsKCiAgLyoqCiAgICogQHRoaXMge1RvdWNoSW5wdXR9CiAgICogQHBhcmFtIHtPYmplY3R9IGV2CiAgICogQHBhcmFtIHtOdW1iZXJ9IHR5cGUgZmxhZwogICAqIEByZXR1cm5zIHt1bmRlZmluZWR8QXJyYXl9IFthbGwsIGNoYW5nZWRdCiAgICovCiAgZnVuY3Rpb24gZ2V0VG91Y2hlcyhldiwgdHlwZSkgewogICAgICB2YXIgYWxsVG91Y2hlcyA9IHRvQXJyYXkoZXYudG91Y2hlcyk7CiAgICAgIHZhciB0YXJnZXRJZHMgPSB0aGlzLnRhcmdldElkczsKCiAgICAgIC8vIHdoZW4gdGhlcmUgaXMgb25seSBvbmUgdG91Y2gsIHRoZSBwcm9jZXNzIGNhbiBiZSBzaW1wbGlmaWVkCiAgICAgIGlmICh0eXBlICYgKElOUFVUX1NUQVJUIHwgSU5QVVRfTU9WRSkgJiYgYWxsVG91Y2hlcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIHRhcmdldElkc1thbGxUb3VjaGVzWzBdLmlkZW50aWZpZXJdID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiBbYWxsVG91Y2hlcywgYWxsVG91Y2hlc107CiAgICAgIH0KCiAgICAgIHZhciBpLAogICAgICAgICAgdGFyZ2V0VG91Y2hlcywKICAgICAgICAgIGNoYW5nZWRUb3VjaGVzID0gdG9BcnJheShldi5jaGFuZ2VkVG91Y2hlcyksCiAgICAgICAgICBjaGFuZ2VkVGFyZ2V0VG91Y2hlcyA9IFtdLAogICAgICAgICAgdGFyZ2V0ID0gdGhpcy50YXJnZXQ7CgogICAgICAvLyBnZXQgdGFyZ2V0IHRvdWNoZXMgZnJvbSB0b3VjaGVzCiAgICAgIHRhcmdldFRvdWNoZXMgPSBhbGxUb3VjaGVzLmZpbHRlcihmdW5jdGlvbih0b3VjaCkgewogICAgICAgICAgcmV0dXJuIGhhc1BhcmVudCh0b3VjaC50YXJnZXQsIHRhcmdldCk7CiAgICAgIH0pOwoKICAgICAgLy8gY29sbGVjdCB0b3VjaGVzCiAgICAgIGlmICh0eXBlID09PSBJTlBVVF9TVEFSVCkgewogICAgICAgICAgaSA9IDA7CiAgICAgICAgICB3aGlsZSAoaSA8IHRhcmdldFRvdWNoZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdGFyZ2V0SWRzW3RhcmdldFRvdWNoZXNbaV0uaWRlbnRpZmllcl0gPSB0cnVlOwogICAgICAgICAgICAgIGkrKzsKICAgICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gZmlsdGVyIGNoYW5nZWQgdG91Y2hlcyB0byBvbmx5IGNvbnRhaW4gdG91Y2hlcyB0aGF0IGV4aXN0IGluIHRoZSBjb2xsZWN0ZWQgdGFyZ2V0IGlkcwogICAgICBpID0gMDsKICAgICAgd2hpbGUgKGkgPCBjaGFuZ2VkVG91Y2hlcy5sZW5ndGgpIHsKICAgICAgICAgIGlmICh0YXJnZXRJZHNbY2hhbmdlZFRvdWNoZXNbaV0uaWRlbnRpZmllcl0pIHsKICAgICAgICAgICAgICBjaGFuZ2VkVGFyZ2V0VG91Y2hlcy5wdXNoKGNoYW5nZWRUb3VjaGVzW2ldKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBjbGVhbnVwIHJlbW92ZWQgdG91Y2hlcwogICAgICAgICAgaWYgKHR5cGUgJiAoSU5QVVRfRU5EIHwgSU5QVVRfQ0FOQ0VMKSkgewogICAgICAgICAgICAgIGRlbGV0ZSB0YXJnZXRJZHNbY2hhbmdlZFRvdWNoZXNbaV0uaWRlbnRpZmllcl07CiAgICAgICAgICB9CiAgICAgICAgICBpKys7CiAgICAgIH0KCiAgICAgIGlmICghY2hhbmdlZFRhcmdldFRvdWNoZXMubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJldHVybiBbCiAgICAgICAgICAvLyBtZXJnZSB0YXJnZXRUb3VjaGVzIHdpdGggY2hhbmdlZFRhcmdldFRvdWNoZXMgc28gaXQgY29udGFpbnMgQUxMIHRvdWNoZXMsIGluY2x1ZGluZyAnZW5kJyBhbmQgJ2NhbmNlbCcKICAgICAgICAgIHVuaXF1ZUFycmF5KHRhcmdldFRvdWNoZXMuY29uY2F0KGNoYW5nZWRUYXJnZXRUb3VjaGVzKSwgJ2lkZW50aWZpZXInLCB0cnVlKSwKICAgICAgICAgIGNoYW5nZWRUYXJnZXRUb3VjaGVzCiAgICAgIF07CiAgfQoKICAvKioKICAgKiBDb21iaW5lZCB0b3VjaCBhbmQgbW91c2UgaW5wdXQKICAgKgogICAqIFRvdWNoIGhhcyBhIGhpZ2hlciBwcmlvcml0eSB0aGVuIG1vdXNlLCBhbmQgd2hpbGUgdG91Y2hpbmcgbm8gbW91c2UgZXZlbnRzIGFyZSBhbGxvd2VkLgogICAqIFRoaXMgYmVjYXVzZSB0b3VjaCBkZXZpY2VzIGFsc28gZW1pdCBtb3VzZSBldmVudHMgd2hpbGUgZG9pbmcgYSB0b3VjaC4KICAgKgogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBleHRlbmRzIElucHV0CiAgICovCiAgZnVuY3Rpb24gVG91Y2hNb3VzZUlucHV0KCkgewogICAgICBJbnB1dC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICAgICAgdmFyIGhhbmRsZXIgPSBiaW5kRm4odGhpcy5oYW5kbGVyLCB0aGlzKTsKICAgICAgdGhpcy50b3VjaCA9IG5ldyBUb3VjaElucHV0KHRoaXMubWFuYWdlciwgaGFuZGxlcik7CiAgICAgIHRoaXMubW91c2UgPSBuZXcgTW91c2VJbnB1dCh0aGlzLm1hbmFnZXIsIGhhbmRsZXIpOwogIH0KCiAgaW5oZXJpdChUb3VjaE1vdXNlSW5wdXQsIElucHV0LCB7CiAgICAgIC8qKgogICAgICAgKiBoYW5kbGUgbW91c2UgYW5kIHRvdWNoIGV2ZW50cwogICAgICAgKiBAcGFyYW0ge0hhbW1lcn0gbWFuYWdlcgogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXRFdmVudAogICAgICAgKiBAcGFyYW0ge09iamVjdH0gaW5wdXREYXRhCiAgICAgICAqLwogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBUTUVoYW5kbGVyKG1hbmFnZXIsIGlucHV0RXZlbnQsIGlucHV0RGF0YSkgewogICAgICAgICAgdmFyIGlzVG91Y2ggPSAoaW5wdXREYXRhLnBvaW50ZXJUeXBlID09IElOUFVUX1RZUEVfVE9VQ0gpLAogICAgICAgICAgICAgIGlzTW91c2UgPSAoaW5wdXREYXRhLnBvaW50ZXJUeXBlID09IElOUFVUX1RZUEVfTU9VU0UpOwoKICAgICAgICAgIC8vIHdoZW4gd2UncmUgaW4gYSB0b3VjaCBldmVudCwgc28gIGJsb2NrIGFsbCB1cGNvbWluZyBtb3VzZSBldmVudHMKICAgICAgICAgIC8vIG1vc3QgbW9iaWxlIGJyb3dzZXIgYWxzbyBlbWl0IG1vdXNlZXZlbnRzLCByaWdodCBhZnRlciB0b3VjaHN0YXJ0CiAgICAgICAgICBpZiAoaXNUb3VjaCkgewogICAgICAgICAgICAgIHRoaXMubW91c2UuYWxsb3cgPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSBpZiAoaXNNb3VzZSAmJiAhdGhpcy5tb3VzZS5hbGxvdykgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyByZXNldCB0aGUgYWxsb3dNb3VzZSB3aGVuIHdlJ3JlIGRvbmUKICAgICAgICAgIGlmIChpbnB1dEV2ZW50ICYgKElOUFVUX0VORCB8IElOUFVUX0NBTkNFTCkpIHsKICAgICAgICAgICAgICB0aGlzLm1vdXNlLmFsbG93ID0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNhbGxiYWNrKG1hbmFnZXIsIGlucHV0RXZlbnQsIGlucHV0RGF0YSk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogcmVtb3ZlIHRoZSBldmVudCBsaXN0ZW5lcnMKICAgICAgICovCiAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICB0aGlzLnRvdWNoLmRlc3Ryb3koKTsKICAgICAgICAgIHRoaXMubW91c2UuZGVzdHJveSgpOwogICAgICB9CiAgfSk7CgogIHZhciBQUkVGSVhFRF9UT1VDSF9BQ1RJT04gPSBwcmVmaXhlZChURVNUX0VMRU1FTlQuc3R5bGUsICd0b3VjaEFjdGlvbicpOwogIHZhciBOQVRJVkVfVE9VQ0hfQUNUSU9OID0gUFJFRklYRURfVE9VQ0hfQUNUSU9OICE9PSB1bmRlZmluZWQ7CgogIC8vIG1hZ2ljYWwgdG91Y2hBY3Rpb24gdmFsdWUKICB2YXIgVE9VQ0hfQUNUSU9OX0NPTVBVVEUgPSAnY29tcHV0ZSc7CiAgdmFyIFRPVUNIX0FDVElPTl9BVVRPID0gJ2F1dG8nOwogIHZhciBUT1VDSF9BQ1RJT05fTUFOSVBVTEFUSU9OID0gJ21hbmlwdWxhdGlvbic7IC8vIG5vdCBpbXBsZW1lbnRlZAogIHZhciBUT1VDSF9BQ1RJT05fTk9ORSA9ICdub25lJzsKICB2YXIgVE9VQ0hfQUNUSU9OX1BBTl9YID0gJ3Bhbi14JzsKICB2YXIgVE9VQ0hfQUNUSU9OX1BBTl9ZID0gJ3Bhbi15JzsKCiAgLyoqCiAgICogVG91Y2ggQWN0aW9uCiAgICogc2V0cyB0aGUgdG91Y2hBY3Rpb24gcHJvcGVydHkgb3IgdXNlcyB0aGUganMgYWx0ZXJuYXRpdmUKICAgKiBAcGFyYW0ge01hbmFnZXJ9IG1hbmFnZXIKICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUKICAgKiBAY29uc3RydWN0b3IKICAgKi8KICBmdW5jdGlvbiBUb3VjaEFjdGlvbihtYW5hZ2VyLCB2YWx1ZSkgewogICAgICB0aGlzLm1hbmFnZXIgPSBtYW5hZ2VyOwogICAgICB0aGlzLnNldCh2YWx1ZSk7CiAgfQoKICBUb3VjaEFjdGlvbi5wcm90b3R5cGUgPSB7CiAgICAgIC8qKgogICAgICAgKiBzZXQgdGhlIHRvdWNoQWN0aW9uIHZhbHVlIG9uIHRoZSBlbGVtZW50IG9yIGVuYWJsZSB0aGUgcG9seWZpbGwKICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlCiAgICAgICAqLwogICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAvLyBmaW5kIG91dCB0aGUgdG91Y2gtYWN0aW9uIGJ5IHRoZSBldmVudCBoYW5kbGVycwogICAgICAgICAgaWYgKHZhbHVlID09IFRPVUNIX0FDVElPTl9DT01QVVRFKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmNvbXB1dGUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoTkFUSVZFX1RPVUNIX0FDVElPTikgewogICAgICAgICAgICAgIHRoaXMubWFuYWdlci5lbGVtZW50LnN0eWxlW1BSRUZJWEVEX1RPVUNIX0FDVElPTl0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYWN0aW9ucyA9IHZhbHVlLnRvTG93ZXJDYXNlKCkudHJpbSgpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIGp1c3QgcmUtc2V0IHRoZSB0b3VjaEFjdGlvbiB2YWx1ZQogICAgICAgKi8KICAgICAgdXBkYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMuc2V0KHRoaXMubWFuYWdlci5vcHRpb25zLnRvdWNoQWN0aW9uKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBjb21wdXRlIHRoZSB2YWx1ZSBmb3IgdGhlIHRvdWNoQWN0aW9uIHByb3BlcnR5IGJhc2VkIG9uIHRoZSByZWNvZ25pemVyJ3Mgc2V0dGluZ3MKICAgICAgICogQHJldHVybnMge1N0cmluZ30gdmFsdWUKICAgICAgICovCiAgICAgIGNvbXB1dGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGFjdGlvbnMgPSBbXTsKICAgICAgICAgIGVhY2godGhpcy5tYW5hZ2VyLnJlY29nbml6ZXJzLCBmdW5jdGlvbihyZWNvZ25pemVyKSB7CiAgICAgICAgICAgICAgaWYgKGJvb2xPckZuKHJlY29nbml6ZXIub3B0aW9ucy5lbmFibGUsIFtyZWNvZ25pemVyXSkpIHsKICAgICAgICAgICAgICAgICAgYWN0aW9ucyA9IGFjdGlvbnMuY29uY2F0KHJlY29nbml6ZXIuZ2V0VG91Y2hBY3Rpb24oKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICByZXR1cm4gY2xlYW5Ub3VjaEFjdGlvbnMoYWN0aW9ucy5qb2luKCcgJykpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIHRoaXMgbWV0aG9kIGlzIGNhbGxlZCBvbiBlYWNoIGlucHV0IGN5Y2xlIGFuZCBwcm92aWRlcyB0aGUgcHJldmVudGluZyBvZiB0aGUgYnJvd3NlciBiZWhhdmlvcgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gaW5wdXQKICAgICAgICovCiAgICAgIHByZXZlbnREZWZhdWx0czogZnVuY3Rpb24oaW5wdXQpIHsKICAgICAgICAgIC8vIG5vdCBuZWVkZWQgd2l0aCBuYXRpdmUgc3VwcG9ydCBmb3IgdGhlIHRvdWNoQWN0aW9uIHByb3BlcnR5CiAgICAgICAgICBpZiAoTkFUSVZFX1RPVUNIX0FDVElPTikgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgc3JjRXZlbnQgPSBpbnB1dC5zcmNFdmVudDsKICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSBpbnB1dC5vZmZzZXREaXJlY3Rpb247CgogICAgICAgICAgLy8gaWYgdGhlIHRvdWNoIGFjdGlvbiBkaWQgcHJldmVudGVkIG9uY2UgdGhpcyBzZXNzaW9uCiAgICAgICAgICBpZiAodGhpcy5tYW5hZ2VyLnNlc3Npb24ucHJldmVudGVkKSB7CiAgICAgICAgICAgICAgc3JjRXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGFjdGlvbnMgPSB0aGlzLmFjdGlvbnM7CiAgICAgICAgICB2YXIgaGFzTm9uZSA9IGluU3RyKGFjdGlvbnMsIFRPVUNIX0FDVElPTl9OT05FKTsKICAgICAgICAgIHZhciBoYXNQYW5ZID0gaW5TdHIoYWN0aW9ucywgVE9VQ0hfQUNUSU9OX1BBTl9ZKTsKICAgICAgICAgIHZhciBoYXNQYW5YID0gaW5TdHIoYWN0aW9ucywgVE9VQ0hfQUNUSU9OX1BBTl9YKTsKCiAgICAgICAgICBpZiAoaGFzTm9uZSB8fAogICAgICAgICAgICAgIChoYXNQYW5ZICYmIGRpcmVjdGlvbiAmIERJUkVDVElPTl9IT1JJWk9OVEFMKSB8fAogICAgICAgICAgICAgIChoYXNQYW5YICYmIGRpcmVjdGlvbiAmIERJUkVDVElPTl9WRVJUSUNBTCkpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wcmV2ZW50U3JjKHNyY0V2ZW50KTsKICAgICAgICAgIH0KICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBjYWxsIHByZXZlbnREZWZhdWx0IHRvIHByZXZlbnQgdGhlIGJyb3dzZXIncyBkZWZhdWx0IGJlaGF2aW9yIChzY3JvbGxpbmcgaW4gbW9zdCBjYXNlcykKICAgICAgICogQHBhcmFtIHtPYmplY3R9IHNyY0V2ZW50CiAgICAgICAqLwogICAgICBwcmV2ZW50U3JjOiBmdW5jdGlvbihzcmNFdmVudCkgewogICAgICAgICAgdGhpcy5tYW5hZ2VyLnNlc3Npb24ucHJldmVudGVkID0gdHJ1ZTsKICAgICAgICAgIHNyY0V2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICB9OwoKICAvKioKICAgKiB3aGVuIHRoZSB0b3VjaEFjdGlvbnMgYXJlIGNvbGxlY3RlZCB0aGV5IGFyZSBub3QgYSB2YWxpZCB2YWx1ZSwgc28gd2UgbmVlZCB0byBjbGVhbiB0aGluZ3MgdXAuICoKICAgKiBAcGFyYW0ge1N0cmluZ30gYWN0aW9ucwogICAqIEByZXR1cm5zIHsqfQogICAqLwogIGZ1bmN0aW9uIGNsZWFuVG91Y2hBY3Rpb25zKGFjdGlvbnMpIHsKICAgICAgLy8gbm9uZQogICAgICBpZiAoaW5TdHIoYWN0aW9ucywgVE9VQ0hfQUNUSU9OX05PTkUpKSB7CiAgICAgICAgICByZXR1cm4gVE9VQ0hfQUNUSU9OX05PTkU7CiAgICAgIH0KCiAgICAgIHZhciBoYXNQYW5YID0gaW5TdHIoYWN0aW9ucywgVE9VQ0hfQUNUSU9OX1BBTl9YKTsKICAgICAgdmFyIGhhc1BhblkgPSBpblN0cihhY3Rpb25zLCBUT1VDSF9BQ1RJT05fUEFOX1kpOwoKICAgICAgLy8gcGFuLXggYW5kIHBhbi15IGNhbiBiZSBjb21iaW5lZAogICAgICBpZiAoaGFzUGFuWCAmJiBoYXNQYW5ZKSB7CiAgICAgICAgICByZXR1cm4gVE9VQ0hfQUNUSU9OX1BBTl9YICsgJyAnICsgVE9VQ0hfQUNUSU9OX1BBTl9ZOwogICAgICB9CgogICAgICAvLyBwYW4teCBPUiBwYW4teQogICAgICBpZiAoaGFzUGFuWCB8fCBoYXNQYW5ZKSB7CiAgICAgICAgICByZXR1cm4gaGFzUGFuWCA/IFRPVUNIX0FDVElPTl9QQU5fWCA6IFRPVUNIX0FDVElPTl9QQU5fWTsKICAgICAgfQoKICAgICAgLy8gbWFuaXB1bGF0aW9uCiAgICAgIGlmIChpblN0cihhY3Rpb25zLCBUT1VDSF9BQ1RJT05fTUFOSVBVTEFUSU9OKSkgewogICAgICAgICAgcmV0dXJuIFRPVUNIX0FDVElPTl9NQU5JUFVMQVRJT047CiAgICAgIH0KCiAgICAgIHJldHVybiBUT1VDSF9BQ1RJT05fQVVUTzsKICB9CgogIC8qKgogICAqIFJlY29nbml6ZXIgZmxvdyBleHBsYWluZWQ7ICoKICAgKiBBbGwgcmVjb2duaXplcnMgaGF2ZSB0aGUgaW5pdGlhbCBzdGF0ZSBvZiBQT1NTSUJMRSB3aGVuIGEgaW5wdXQgc2Vzc2lvbiBzdGFydHMuCiAgICogVGhlIGRlZmluaXRpb24gb2YgYSBpbnB1dCBzZXNzaW9uIGlzIGZyb20gdGhlIGZpcnN0IGlucHV0IHVudGlsIHRoZSBsYXN0IGlucHV0LCB3aXRoIGFsbCBpdCdzIG1vdmVtZW50IGluIGl0LiAqCiAgICogRXhhbXBsZSBzZXNzaW9uIGZvciBtb3VzZS1pbnB1dDogbW91c2Vkb3duIC0+IG1vdXNlbW92ZSAtPiBtb3VzZXVwCiAgICoKICAgKiBPbiBlYWNoIHJlY29nbml6aW5nIGN5Y2xlIChzZWUgTWFuYWdlci5yZWNvZ25pemUpIHRoZSAucmVjb2duaXplKCkgbWV0aG9kIGlzIGV4ZWN1dGVkCiAgICogd2hpY2ggZGV0ZXJtaW5lcyB3aXRoIHN0YXRlIGl0IHNob3VsZCBiZS4KICAgKgogICAqIElmIHRoZSByZWNvZ25pemVyIGhhcyB0aGUgc3RhdGUgRkFJTEVELCBDQU5DRUxMRUQgb3IgUkVDT0dOSVpFRCAoZXF1YWxzIEVOREVEKSwgaXQgaXMgcmVzZXQgdG8KICAgKiBQT1NTSUJMRSB0byBnaXZlIGl0IGFub3RoZXIgY2hhbmdlIG9uIHRoZSBuZXh0IGN5Y2xlLgogICAqCiAgICogICAgICAgICAgICAgICBQb3NzaWJsZQogICAqICAgICAgICAgICAgICAgICAgfAogICAqICAgICAgICAgICAgKy0tLS0tKy0tLS0tLS0tLS0tLS0tLSsKICAgKiAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICB8CiAgICogICAgICArLS0tLS0rLS0tLS0rICAgICAgICAgICAgICAgfAogICAqICAgICAgfCAgICAgICAgICAgfCAgICAgICAgICAgICAgIHwKICAgKiAgIEZhaWxlZCAgICAgIENhbmNlbGxlZCAgICAgICAgICB8CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICstLS0tLS0tKy0tLS0tLSsKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgICAgICAgICAgfAogICAqICAgICAgICAgICAgICAgICAgICAgIFJlY29nbml6ZWQgICAgICAgQmVnYW4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaGFuZ2VkCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmRlZC9SZWNvZ25pemVkCiAgICovCiAgdmFyIFNUQVRFX1BPU1NJQkxFID0gMTsKICB2YXIgU1RBVEVfQkVHQU4gPSAyOwogIHZhciBTVEFURV9DSEFOR0VEID0gNDsKICB2YXIgU1RBVEVfRU5ERUQgPSA4OwogIHZhciBTVEFURV9SRUNPR05JWkVEID0gU1RBVEVfRU5ERUQ7CiAgdmFyIFNUQVRFX0NBTkNFTExFRCA9IDE2OwogIHZhciBTVEFURV9GQUlMRUQgPSAzMjsKCiAgLyoqCiAgICogUmVjb2duaXplcgogICAqIEV2ZXJ5IHJlY29nbml6ZXIgbmVlZHMgdG8gZXh0ZW5kIGZyb20gdGhpcyBjbGFzcy4KICAgKiBAY29uc3RydWN0b3IKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqLwogIGZ1bmN0aW9uIFJlY29nbml6ZXIob3B0aW9ucykgewogICAgICB0aGlzLmlkID0gdW5pcXVlSWQoKTsKCiAgICAgIHRoaXMubWFuYWdlciA9IG51bGw7CiAgICAgIHRoaXMub3B0aW9ucyA9IG1lcmdlKG9wdGlvbnMgfHwge30sIHRoaXMuZGVmYXVsdHMpOwoKICAgICAgLy8gZGVmYXVsdCBpcyBlbmFibGUgdHJ1ZQogICAgICB0aGlzLm9wdGlvbnMuZW5hYmxlID0gaWZVbmRlZmluZWQodGhpcy5vcHRpb25zLmVuYWJsZSwgdHJ1ZSk7CgogICAgICB0aGlzLnN0YXRlID0gU1RBVEVfUE9TU0lCTEU7CgogICAgICB0aGlzLnNpbXVsdGFuZW91cyA9IHt9OwogICAgICB0aGlzLnJlcXVpcmVGYWlsID0gW107CiAgfQoKICBSZWNvZ25pemVyLnByb3RvdHlwZSA9IHsKICAgICAgLyoqCiAgICAgICAqIEB2aXJ0dWFsCiAgICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgICAqLwogICAgICBkZWZhdWx0czoge30sCgogICAgICAvKioKICAgICAgICogc2V0IG9wdGlvbnMKICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgICAgICogQHJldHVybiB7UmVjb2duaXplcn0KICAgICAgICovCiAgICAgIHNldDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgZXh0ZW5kKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CgogICAgICAgICAgLy8gYWxzbyB1cGRhdGUgdGhlIHRvdWNoQWN0aW9uLCBpbiBjYXNlIHNvbWV0aGluZyBjaGFuZ2VkIGFib3V0IHRoZSBkaXJlY3Rpb25zL2VuYWJsZWQgc3RhdGUKICAgICAgICAgIHRoaXMubWFuYWdlciAmJiB0aGlzLm1hbmFnZXIudG91Y2hBY3Rpb24udXBkYXRlKCk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiByZWNvZ25pemUgc2ltdWx0YW5lb3VzIHdpdGggYW4gb3RoZXIgcmVjb2duaXplci4KICAgICAgICogQHBhcmFtIHtSZWNvZ25pemVyfSBvdGhlclJlY29nbml6ZXIKICAgICAgICogQHJldHVybnMge1JlY29nbml6ZXJ9IHRoaXMKICAgICAgICovCiAgICAgIHJlY29nbml6ZVdpdGg6IGZ1bmN0aW9uKG90aGVyUmVjb2duaXplcikgewogICAgICAgICAgaWYgKGludm9rZUFycmF5QXJnKG90aGVyUmVjb2duaXplciwgJ3JlY29nbml6ZVdpdGgnLCB0aGlzKSkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzaW11bHRhbmVvdXMgPSB0aGlzLnNpbXVsdGFuZW91czsKICAgICAgICAgIG90aGVyUmVjb2duaXplciA9IGdldFJlY29nbml6ZXJCeU5hbWVJZk1hbmFnZXIob3RoZXJSZWNvZ25pemVyLCB0aGlzKTsKICAgICAgICAgIGlmICghc2ltdWx0YW5lb3VzW290aGVyUmVjb2duaXplci5pZF0pIHsKICAgICAgICAgICAgICBzaW11bHRhbmVvdXNbb3RoZXJSZWNvZ25pemVyLmlkXSA9IG90aGVyUmVjb2duaXplcjsKICAgICAgICAgICAgICBvdGhlclJlY29nbml6ZXIucmVjb2duaXplV2l0aCh0aGlzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIGRyb3AgdGhlIHNpbXVsdGFuZW91cyBsaW5rLiBpdCBkb2VzbnQgcmVtb3ZlIHRoZSBsaW5rIG9uIHRoZSBvdGhlciByZWNvZ25pemVyLgogICAgICAgKiBAcGFyYW0ge1JlY29nbml6ZXJ9IG90aGVyUmVjb2duaXplcgogICAgICAgKiBAcmV0dXJucyB7UmVjb2duaXplcn0gdGhpcwogICAgICAgKi8KICAgICAgZHJvcFJlY29nbml6ZVdpdGg6IGZ1bmN0aW9uKG90aGVyUmVjb2duaXplcikgewogICAgICAgICAgaWYgKGludm9rZUFycmF5QXJnKG90aGVyUmVjb2duaXplciwgJ2Ryb3BSZWNvZ25pemVXaXRoJywgdGhpcykpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0KCiAgICAgICAgICBvdGhlclJlY29nbml6ZXIgPSBnZXRSZWNvZ25pemVyQnlOYW1lSWZNYW5hZ2VyKG90aGVyUmVjb2duaXplciwgdGhpcyk7CiAgICAgICAgICBkZWxldGUgdGhpcy5zaW11bHRhbmVvdXNbb3RoZXJSZWNvZ25pemVyLmlkXTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIHJlY29nbml6ZXIgY2FuIG9ubHkgcnVuIHdoZW4gYW4gb3RoZXIgaXMgZmFpbGluZwogICAgICAgKiBAcGFyYW0ge1JlY29nbml6ZXJ9IG90aGVyUmVjb2duaXplcgogICAgICAgKiBAcmV0dXJucyB7UmVjb2duaXplcn0gdGhpcwogICAgICAgKi8KICAgICAgcmVxdWlyZUZhaWx1cmU6IGZ1bmN0aW9uKG90aGVyUmVjb2duaXplcikgewogICAgICAgICAgaWYgKGludm9rZUFycmF5QXJnKG90aGVyUmVjb2duaXplciwgJ3JlcXVpcmVGYWlsdXJlJywgdGhpcykpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVxdWlyZUZhaWwgPSB0aGlzLnJlcXVpcmVGYWlsOwogICAgICAgICAgb3RoZXJSZWNvZ25pemVyID0gZ2V0UmVjb2duaXplckJ5TmFtZUlmTWFuYWdlcihvdGhlclJlY29nbml6ZXIsIHRoaXMpOwogICAgICAgICAgaWYgKGluQXJyYXkocmVxdWlyZUZhaWwsIG90aGVyUmVjb2duaXplcikgPT09IC0xKSB7CiAgICAgICAgICAgICAgcmVxdWlyZUZhaWwucHVzaChvdGhlclJlY29nbml6ZXIpOwogICAgICAgICAgICAgIG90aGVyUmVjb2duaXplci5yZXF1aXJlRmFpbHVyZSh0aGlzKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIGRyb3AgdGhlIHJlcXVpcmVGYWlsdXJlIGxpbmsuIGl0IGRvZXMgbm90IHJlbW92ZSB0aGUgbGluayBvbiB0aGUgb3RoZXIgcmVjb2duaXplci4KICAgICAgICogQHBhcmFtIHtSZWNvZ25pemVyfSBvdGhlclJlY29nbml6ZXIKICAgICAgICogQHJldHVybnMge1JlY29nbml6ZXJ9IHRoaXMKICAgICAgICovCiAgICAgIGRyb3BSZXF1aXJlRmFpbHVyZTogZnVuY3Rpb24ob3RoZXJSZWNvZ25pemVyKSB7CiAgICAgICAgICBpZiAoaW52b2tlQXJyYXlBcmcob3RoZXJSZWNvZ25pemVyLCAnZHJvcFJlcXVpcmVGYWlsdXJlJywgdGhpcykpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0KCiAgICAgICAgICBvdGhlclJlY29nbml6ZXIgPSBnZXRSZWNvZ25pemVyQnlOYW1lSWZNYW5hZ2VyKG90aGVyUmVjb2duaXplciwgdGhpcyk7CiAgICAgICAgICB2YXIgaW5kZXggPSBpbkFycmF5KHRoaXMucmVxdWlyZUZhaWwsIG90aGVyUmVjb2duaXplcik7CiAgICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgICAgIHRoaXMucmVxdWlyZUZhaWwuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIGhhcyByZXF1aXJlIGZhaWx1cmVzIGJvb2xlYW4KICAgICAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICAgICAqLwogICAgICBoYXNSZXF1aXJlRmFpbHVyZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWlyZUZhaWwubGVuZ3RoID4gMDsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBpZiB0aGUgcmVjb2duaXplciBjYW4gcmVjb2duaXplIHNpbXVsdGFuZW91cyB3aXRoIGFuIG90aGVyIHJlY29nbml6ZXIKICAgICAgICogQHBhcmFtIHtSZWNvZ25pemVyfSBvdGhlclJlY29nbml6ZXIKICAgICAgICogQHJldHVybnMge0Jvb2xlYW59CiAgICAgICAqLwogICAgICBjYW5SZWNvZ25pemVXaXRoOiBmdW5jdGlvbihvdGhlclJlY29nbml6ZXIpIHsKICAgICAgICAgIHJldHVybiAhIXRoaXMuc2ltdWx0YW5lb3VzW290aGVyUmVjb2duaXplci5pZF07CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogWW91IHNob3VsZCB1c2UgYHRyeUVtaXRgIGluc3RlYWQgb2YgYGVtaXRgIGRpcmVjdGx5IHRvIGNoZWNrCiAgICAgICAqIHRoYXQgYWxsIHRoZSBuZWVkZWQgcmVjb2duaXplcnMgaGFzIGZhaWxlZCBiZWZvcmUgZW1pdHRpbmcuCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbnB1dAogICAgICAgKi8KICAgICAgZW1pdDogZnVuY3Rpb24oaW5wdXQpIHsKICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgIHZhciBzdGF0ZSA9IHRoaXMuc3RhdGU7CgogICAgICAgICAgZnVuY3Rpb24gZW1pdCh3aXRoU3RhdGUpIHsKICAgICAgICAgICAgICBzZWxmLm1hbmFnZXIuZW1pdChzZWxmLm9wdGlvbnMuZXZlbnQgKyAod2l0aFN0YXRlID8gc3RhdGVTdHIoc3RhdGUpIDogJycpLCBpbnB1dCk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gJ3BhbnN0YXJ0JyBhbmQgJ3Bhbm1vdmUnCiAgICAgICAgICBpZiAoc3RhdGUgPCBTVEFURV9FTkRFRCkgewogICAgICAgICAgICAgIGVtaXQodHJ1ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZW1pdCgpOyAvLyBzaW1wbGUgJ2V2ZW50TmFtZScgZXZlbnRzCgogICAgICAgICAgLy8gcGFuZW5kIGFuZCBwYW5jYW5jZWwKICAgICAgICAgIGlmIChzdGF0ZSA+PSBTVEFURV9FTkRFRCkgewogICAgICAgICAgICAgIGVtaXQodHJ1ZSk7CiAgICAgICAgICB9CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogQ2hlY2sgdGhhdCBhbGwgdGhlIHJlcXVpcmUgZmFpbHVyZSByZWNvZ25pemVycyBoYXMgZmFpbGVkLAogICAgICAgKiBpZiB0cnVlLCBpdCBlbWl0cyBhIGdlc3R1cmUgZXZlbnQsCiAgICAgICAqIG90aGVyd2lzZSwgc2V0dXAgdGhlIHN0YXRlIHRvIEZBSUxFRC4KICAgICAgICogQHBhcmFtIHtPYmplY3R9IGlucHV0CiAgICAgICAqLwogICAgICB0cnlFbWl0OiBmdW5jdGlvbihpbnB1dCkgewogICAgICAgICAgaWYgKHRoaXMuY2FuRW1pdCgpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW1pdChpbnB1dCk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBpdCdzIGZhaWxpbmcgYW55d2F5CiAgICAgICAgICB0aGlzLnN0YXRlID0gU1RBVEVfRkFJTEVEOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIGNhbiB3ZSBlbWl0PwogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAgICovCiAgICAgIGNhbkVtaXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGkgPSAwOwogICAgICAgICAgd2hpbGUgKGkgPCB0aGlzLnJlcXVpcmVGYWlsLmxlbmd0aCkgewogICAgICAgICAgICAgIGlmICghKHRoaXMucmVxdWlyZUZhaWxbaV0uc3RhdGUgJiAoU1RBVEVfRkFJTEVEIHwgU1RBVEVfUE9TU0lCTEUpKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGkrKzsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIHVwZGF0ZSB0aGUgcmVjb2duaXplcgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gaW5wdXREYXRhCiAgICAgICAqLwogICAgICByZWNvZ25pemU6IGZ1bmN0aW9uKGlucHV0RGF0YSkgewogICAgICAgICAgLy8gbWFrZSBhIG5ldyBjb3B5IG9mIHRoZSBpbnB1dERhdGEKICAgICAgICAgIC8vIHNvIHdlIGNhbiBjaGFuZ2UgdGhlIGlucHV0RGF0YSB3aXRob3V0IG1lc3NpbmcgdXAgdGhlIG90aGVyIHJlY29nbml6ZXJzCiAgICAgICAgICB2YXIgaW5wdXREYXRhQ2xvbmUgPSBleHRlbmQoe30sIGlucHV0RGF0YSk7CgogICAgICAgICAgLy8gaXMgaXMgZW5hYmxlZCBhbmQgYWxsb3cgcmVjb2duaXppbmc/CiAgICAgICAgICBpZiAoIWJvb2xPckZuKHRoaXMub3B0aW9ucy5lbmFibGUsIFt0aGlzLCBpbnB1dERhdGFDbG9uZV0pKSB7CiAgICAgICAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBTVEFURV9GQUlMRUQ7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIHJlc2V0IHdoZW4gd2UndmUgcmVhY2hlZCB0aGUgZW5kCiAgICAgICAgICBpZiAodGhpcy5zdGF0ZSAmIChTVEFURV9SRUNPR05JWkVEIHwgU1RBVEVfQ0FOQ0VMTEVEIHwgU1RBVEVfRkFJTEVEKSkgewogICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBTVEFURV9QT1NTSUJMRTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnN0YXRlID0gdGhpcy5wcm9jZXNzKGlucHV0RGF0YUNsb25lKTsKCiAgICAgICAgICAvLyB0aGUgcmVjb2duaXplciBoYXMgcmVjb2duaXplZCBhIGdlc3R1cmUKICAgICAgICAgIC8vIHNvIHRyaWdnZXIgYW4gZXZlbnQKICAgICAgICAgIGlmICh0aGlzLnN0YXRlICYgKFNUQVRFX0JFR0FOIHwgU1RBVEVfQ0hBTkdFRCB8IFNUQVRFX0VOREVEIHwgU1RBVEVfQ0FOQ0VMTEVEKSkgewogICAgICAgICAgICAgIHRoaXMudHJ5RW1pdChpbnB1dERhdGFDbG9uZSk7CiAgICAgICAgICB9CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogcmV0dXJuIHRoZSBzdGF0ZSBvZiB0aGUgcmVjb2duaXplcgogICAgICAgKiB0aGUgYWN0dWFsIHJlY29nbml6aW5nIGhhcHBlbnMgaW4gdGhpcyBtZXRob2QKICAgICAgICogQHZpcnR1YWwKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGlucHV0RGF0YQogICAgICAgKiBAcmV0dXJucyB7Q29uc3R9IFNUQVRFCiAgICAgICAqLwogICAgICBwcm9jZXNzOiBmdW5jdGlvbihpbnB1dERhdGEpIHsgfSwgLy8ganNoaW50IGlnbm9yZTpsaW5lCgogICAgICAvKioKICAgICAgICogcmV0dXJuIHRoZSBwcmVmZXJyZWQgdG91Y2gtYWN0aW9uCiAgICAgICAqIEB2aXJ0dWFsCiAgICAgICAqIEByZXR1cm5zIHtBcnJheX0KICAgICAgICovCiAgICAgIGdldFRvdWNoQWN0aW9uOiBmdW5jdGlvbigpIHsgfSwKCiAgICAgIC8qKgogICAgICAgKiBjYWxsZWQgd2hlbiB0aGUgZ2VzdHVyZSBpc24ndCBhbGxvd2VkIHRvIHJlY29nbml6ZQogICAgICAgKiBsaWtlIHdoZW4gYW5vdGhlciBpcyBiZWluZyByZWNvZ25pemVkIG9yIGl0IGlzIGRpc2FibGVkCiAgICAgICAqIEB2aXJ0dWFsCiAgICAgICAqLwogICAgICByZXNldDogZnVuY3Rpb24oKSB7IH0KICB9OwoKICAvKioKICAgKiBnZXQgYSB1c2FibGUgc3RyaW5nLCB1c2VkIGFzIGV2ZW50IHBvc3RmaXgKICAgKiBAcGFyYW0ge0NvbnN0fSBzdGF0ZQogICAqIEByZXR1cm5zIHtTdHJpbmd9IHN0YXRlCiAgICovCiAgZnVuY3Rpb24gc3RhdGVTdHIoc3RhdGUpIHsKICAgICAgaWYgKHN0YXRlICYgU1RBVEVfQ0FOQ0VMTEVEKSB7CiAgICAgICAgICByZXR1cm4gJ2NhbmNlbCc7CiAgICAgIH0gZWxzZSBpZiAoc3RhdGUgJiBTVEFURV9FTkRFRCkgewogICAgICAgICAgcmV0dXJuICdlbmQnOwogICAgICB9IGVsc2UgaWYgKHN0YXRlICYgU1RBVEVfQ0hBTkdFRCkgewogICAgICAgICAgcmV0dXJuICdtb3ZlJzsKICAgICAgfSBlbHNlIGlmIChzdGF0ZSAmIFNUQVRFX0JFR0FOKSB7CiAgICAgICAgICByZXR1cm4gJ3N0YXJ0JzsKICAgICAgfQogICAgICByZXR1cm4gJyc7CiAgfQoKICAvKioKICAgKiBkaXJlY3Rpb24gY29ucyB0byBzdHJpbmcKICAgKiBAcGFyYW0ge0NvbnN0fSBkaXJlY3Rpb24KICAgKiBAcmV0dXJucyB7U3RyaW5nfQogICAqLwogIGZ1bmN0aW9uIGRpcmVjdGlvblN0cihkaXJlY3Rpb24pIHsKICAgICAgaWYgKGRpcmVjdGlvbiA9PSBESVJFQ1RJT05fRE9XTikgewogICAgICAgICAgcmV0dXJuICdkb3duJzsKICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT0gRElSRUNUSU9OX1VQKSB7CiAgICAgICAgICByZXR1cm4gJ3VwJzsKICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT0gRElSRUNUSU9OX0xFRlQpIHsKICAgICAgICAgIHJldHVybiAnbGVmdCc7CiAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09IERJUkVDVElPTl9SSUdIVCkgewogICAgICAgICAgcmV0dXJuICdyaWdodCc7CiAgICAgIH0KICAgICAgcmV0dXJuICcnOwogIH0KCiAgLyoqCiAgICogZ2V0IGEgcmVjb2duaXplciBieSBuYW1lIGlmIGl0IGlzIGJvdW5kIHRvIGEgbWFuYWdlcgogICAqIEBwYXJhbSB7UmVjb2duaXplcnxTdHJpbmd9IG90aGVyUmVjb2duaXplcgogICAqIEBwYXJhbSB7UmVjb2duaXplcn0gcmVjb2duaXplcgogICAqIEByZXR1cm5zIHtSZWNvZ25pemVyfQogICAqLwogIGZ1bmN0aW9uIGdldFJlY29nbml6ZXJCeU5hbWVJZk1hbmFnZXIob3RoZXJSZWNvZ25pemVyLCByZWNvZ25pemVyKSB7CiAgICAgIHZhciBtYW5hZ2VyID0gcmVjb2duaXplci5tYW5hZ2VyOwogICAgICBpZiAobWFuYWdlcikgewogICAgICAgICAgcmV0dXJuIG1hbmFnZXIuZ2V0KG90aGVyUmVjb2duaXplcik7CiAgICAgIH0KICAgICAgcmV0dXJuIG90aGVyUmVjb2duaXplcjsKICB9CgogIC8qKgogICAqIFRoaXMgcmVjb2duaXplciBpcyBqdXN0IHVzZWQgYXMgYSBiYXNlIGZvciB0aGUgc2ltcGxlIGF0dHJpYnV0ZSByZWNvZ25pemVycy4KICAgKiBAY29uc3RydWN0b3IKICAgKiBAZXh0ZW5kcyBSZWNvZ25pemVyCiAgICovCiAgZnVuY3Rpb24gQXR0clJlY29nbml6ZXIoKSB7CiAgICAgIFJlY29nbml6ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9CgogIGluaGVyaXQoQXR0clJlY29nbml6ZXIsIFJlY29nbml6ZXIsIHsKICAgICAgLyoqCiAgICAgICAqIEBuYW1lc3BhY2UKICAgICAgICogQG1lbWJlcm9mIEF0dHJSZWNvZ25pemVyCiAgICAgICAqLwogICAgICBkZWZhdWx0czogewogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfQogICAgICAgICAgICogQGRlZmF1bHQgMQogICAgICAgICAgICovCiAgICAgICAgICBwb2ludGVyczogMQogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIFVzZWQgdG8gY2hlY2sgaWYgaXQgdGhlIHJlY29nbml6ZXIgcmVjZWl2ZXMgdmFsaWQgaW5wdXQsIGxpa2UgaW5wdXQuZGlzdGFuY2UgPiAxMC4KICAgICAgICogQG1lbWJlcm9mIEF0dHJSZWNvZ25pemVyCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbnB1dAogICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gcmVjb2duaXplZAogICAgICAgKi8KICAgICAgYXR0clRlc3Q6IGZ1bmN0aW9uKGlucHV0KSB7CiAgICAgICAgICB2YXIgb3B0aW9uUG9pbnRlcnMgPSB0aGlzLm9wdGlvbnMucG9pbnRlcnM7CiAgICAgICAgICByZXR1cm4gb3B0aW9uUG9pbnRlcnMgPT09IDAgfHwgaW5wdXQucG9pbnRlcnMubGVuZ3RoID09PSBvcHRpb25Qb2ludGVyczsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBQcm9jZXNzIHRoZSBpbnB1dCBhbmQgcmV0dXJuIHRoZSBzdGF0ZSBmb3IgdGhlIHJlY29nbml6ZXIKICAgICAgICogQG1lbWJlcm9mIEF0dHJSZWNvZ25pemVyCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbnB1dAogICAgICAgKiBAcmV0dXJucyB7Kn0gU3RhdGUKICAgICAgICovCiAgICAgIHByb2Nlc3M6IGZ1bmN0aW9uKGlucHV0KSB7CiAgICAgICAgICB2YXIgc3RhdGUgPSB0aGlzLnN0YXRlOwogICAgICAgICAgdmFyIGV2ZW50VHlwZSA9IGlucHV0LmV2ZW50VHlwZTsKCiAgICAgICAgICB2YXIgaXNSZWNvZ25pemVkID0gc3RhdGUgJiAoU1RBVEVfQkVHQU4gfCBTVEFURV9DSEFOR0VEKTsKICAgICAgICAgIHZhciBpc1ZhbGlkID0gdGhpcy5hdHRyVGVzdChpbnB1dCk7CgogICAgICAgICAgLy8gb24gY2FuY2VsIGlucHV0IGFuZCB3ZSd2ZSByZWNvZ25pemVkIGJlZm9yZSwgcmV0dXJuIFNUQVRFX0NBTkNFTExFRAogICAgICAgICAgaWYgKGlzUmVjb2duaXplZCAmJiAoZXZlbnRUeXBlICYgSU5QVVRfQ0FOQ0VMIHx8ICFpc1ZhbGlkKSkgewogICAgICAgICAgICAgIHJldHVybiBzdGF0ZSB8IFNUQVRFX0NBTkNFTExFRDsKICAgICAgICAgIH0gZWxzZSBpZiAoaXNSZWNvZ25pemVkIHx8IGlzVmFsaWQpIHsKICAgICAgICAgICAgICBpZiAoZXZlbnRUeXBlICYgSU5QVVRfRU5EKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZSB8IFNUQVRFX0VOREVEOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoIShzdGF0ZSAmIFNUQVRFX0JFR0FOKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gU1RBVEVfQkVHQU47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBzdGF0ZSB8IFNUQVRFX0NIQU5HRUQ7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gU1RBVEVfRkFJTEVEOwogICAgICB9CiAgfSk7CgogIC8qKgogICAqIFBhbgogICAqIFJlY29nbml6ZWQgd2hlbiB0aGUgcG9pbnRlciBpcyBkb3duIGFuZCBtb3ZlZCBpbiB0aGUgYWxsb3dlZCBkaXJlY3Rpb24uCiAgICogQGNvbnN0cnVjdG9yCiAgICogQGV4dGVuZHMgQXR0clJlY29nbml6ZXIKICAgKi8KICBmdW5jdGlvbiBQYW5SZWNvZ25pemVyKCkgewogICAgICBBdHRyUmVjb2duaXplci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICAgICAgdGhpcy5wWCA9IG51bGw7CiAgICAgIHRoaXMucFkgPSBudWxsOwogIH0KCiAgaW5oZXJpdChQYW5SZWNvZ25pemVyLCBBdHRyUmVjb2duaXplciwgewogICAgICAvKioKICAgICAgICogQG5hbWVzcGFjZQogICAgICAgKiBAbWVtYmVyb2YgUGFuUmVjb2duaXplcgogICAgICAgKi8KICAgICAgZGVmYXVsdHM6IHsKICAgICAgICAgIGV2ZW50OiAncGFuJywKICAgICAgICAgIHRocmVzaG9sZDogMTAsCiAgICAgICAgICBwb2ludGVyczogMSwKICAgICAgICAgIGRpcmVjdGlvbjogRElSRUNUSU9OX0FMTAogICAgICB9LAoKICAgICAgZ2V0VG91Y2hBY3Rpb246IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRpcmVjdGlvbiA9IHRoaXMub3B0aW9ucy5kaXJlY3Rpb247CiAgICAgICAgICB2YXIgYWN0aW9ucyA9IFtdOwogICAgICAgICAgaWYgKGRpcmVjdGlvbiAmIERJUkVDVElPTl9IT1JJWk9OVEFMKSB7CiAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKFRPVUNIX0FDVElPTl9QQU5fWSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZGlyZWN0aW9uICYgRElSRUNUSU9OX1ZFUlRJQ0FMKSB7CiAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKFRPVUNIX0FDVElPTl9QQU5fWCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYWN0aW9uczsKICAgICAgfSwKCiAgICAgIGRpcmVjdGlvblRlc3Q6IGZ1bmN0aW9uKGlucHV0KSB7CiAgICAgICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKICAgICAgICAgIHZhciBoYXNNb3ZlZCA9IHRydWU7CiAgICAgICAgICB2YXIgZGlzdGFuY2UgPSBpbnB1dC5kaXN0YW5jZTsKICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSBpbnB1dC5kaXJlY3Rpb247CiAgICAgICAgICB2YXIgeCA9IGlucHV0LmRlbHRhWDsKICAgICAgICAgIHZhciB5ID0gaW5wdXQuZGVsdGFZOwoKICAgICAgICAgIC8vIGxvY2sgdG8gYXhpcz8KICAgICAgICAgIGlmICghKGRpcmVjdGlvbiAmIG9wdGlvbnMuZGlyZWN0aW9uKSkgewogICAgICAgICAgICAgIGlmIChvcHRpb25zLmRpcmVjdGlvbiAmIERJUkVDVElPTl9IT1JJWk9OVEFMKSB7CiAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9ICh4ID09PSAwKSA/IERJUkVDVElPTl9OT05FIDogKHggPCAwKSA/IERJUkVDVElPTl9MRUZUIDogRElSRUNUSU9OX1JJR0hUOwogICAgICAgICAgICAgICAgICBoYXNNb3ZlZCA9IHggIT0gdGhpcy5wWDsKICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBNYXRoLmFicyhpbnB1dC5kZWx0YVgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9ICh5ID09PSAwKSA/IERJUkVDVElPTl9OT05FIDogKHkgPCAwKSA/IERJUkVDVElPTl9VUCA6IERJUkVDVElPTl9ET1dOOwogICAgICAgICAgICAgICAgICBoYXNNb3ZlZCA9IHkgIT0gdGhpcy5wWTsKICAgICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBNYXRoLmFicyhpbnB1dC5kZWx0YVkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlucHV0LmRpcmVjdGlvbiA9IGRpcmVjdGlvbjsKICAgICAgICAgIHJldHVybiBoYXNNb3ZlZCAmJiBkaXN0YW5jZSA+IG9wdGlvbnMudGhyZXNob2xkICYmIGRpcmVjdGlvbiAmIG9wdGlvbnMuZGlyZWN0aW9uOwogICAgICB9LAoKICAgICAgYXR0clRlc3Q6IGZ1bmN0aW9uKGlucHV0KSB7CiAgICAgICAgICByZXR1cm4gQXR0clJlY29nbml6ZXIucHJvdG90eXBlLmF0dHJUZXN0LmNhbGwodGhpcywgaW5wdXQpICYmCiAgICAgICAgICAgICAgKHRoaXMuc3RhdGUgJiBTVEFURV9CRUdBTiB8fCAoISh0aGlzLnN0YXRlICYgU1RBVEVfQkVHQU4pICYmIHRoaXMuZGlyZWN0aW9uVGVzdChpbnB1dCkpKTsKICAgICAgfSwKCiAgICAgIGVtaXQ6IGZ1bmN0aW9uKGlucHV0KSB7CiAgICAgICAgICB0aGlzLnBYID0gaW5wdXQuZGVsdGFYOwogICAgICAgICAgdGhpcy5wWSA9IGlucHV0LmRlbHRhWTsKCiAgICAgICAgICB2YXIgZGlyZWN0aW9uID0gZGlyZWN0aW9uU3RyKGlucHV0LmRpcmVjdGlvbik7CiAgICAgICAgICBpZiAoZGlyZWN0aW9uKSB7CiAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLmVtaXQodGhpcy5vcHRpb25zLmV2ZW50ICsgZGlyZWN0aW9uLCBpbnB1dCk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5fc3VwZXIuZW1pdC5jYWxsKHRoaXMsIGlucHV0KTsKICAgICAgfQogIH0pOwoKICAvKioKICAgKiBQaW5jaAogICAqIFJlY29nbml6ZWQgd2hlbiB0d28gb3IgbW9yZSBwb2ludGVycyBhcmUgbW92aW5nIHRvd2FyZCAoem9vbS1pbikgb3IgYXdheSBmcm9tIGVhY2ggb3RoZXIgKHpvb20tb3V0KS4KICAgKiBAY29uc3RydWN0b3IKICAgKiBAZXh0ZW5kcyBBdHRyUmVjb2duaXplcgogICAqLwogIGZ1bmN0aW9uIFBpbmNoUmVjb2duaXplcigpIHsKICAgICAgQXR0clJlY29nbml6ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9CgogIGluaGVyaXQoUGluY2hSZWNvZ25pemVyLCBBdHRyUmVjb2duaXplciwgewogICAgICAvKioKICAgICAgICogQG5hbWVzcGFjZQogICAgICAgKiBAbWVtYmVyb2YgUGluY2hSZWNvZ25pemVyCiAgICAgICAqLwogICAgICBkZWZhdWx0czogewogICAgICAgICAgZXZlbnQ6ICdwaW5jaCcsCiAgICAgICAgICB0aHJlc2hvbGQ6IDAsCiAgICAgICAgICBwb2ludGVyczogMgogICAgICB9LAoKICAgICAgZ2V0VG91Y2hBY3Rpb246IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIFtUT1VDSF9BQ1RJT05fTk9ORV07CiAgICAgIH0sCgogICAgICBhdHRyVGVzdDogZnVuY3Rpb24oaW5wdXQpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9zdXBlci5hdHRyVGVzdC5jYWxsKHRoaXMsIGlucHV0KSAmJgogICAgICAgICAgICAgIChNYXRoLmFicyhpbnB1dC5zY2FsZSAtIDEpID4gdGhpcy5vcHRpb25zLnRocmVzaG9sZCB8fCB0aGlzLnN0YXRlICYgU1RBVEVfQkVHQU4pOwogICAgICB9LAoKICAgICAgZW1pdDogZnVuY3Rpb24oaW5wdXQpIHsKICAgICAgICAgIHRoaXMuX3N1cGVyLmVtaXQuY2FsbCh0aGlzLCBpbnB1dCk7CiAgICAgICAgICBpZiAoaW5wdXQuc2NhbGUgIT09IDEpIHsKICAgICAgICAgICAgICB2YXIgaW5PdXQgPSBpbnB1dC5zY2FsZSA8IDEgPyAnaW4nIDogJ291dCc7CiAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLmVtaXQodGhpcy5vcHRpb25zLmV2ZW50ICsgaW5PdXQsIGlucHV0KTsKICAgICAgICAgIH0KICAgICAgfQogIH0pOwoKICAvKioKICAgKiBQcmVzcwogICAqIFJlY29nbml6ZWQgd2hlbiB0aGUgcG9pbnRlciBpcyBkb3duIGZvciB4IG1zIHdpdGhvdXQgYW55IG1vdmVtZW50LgogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBleHRlbmRzIFJlY29nbml6ZXIKICAgKi8KICBmdW5jdGlvbiBQcmVzc1JlY29nbml6ZXIoKSB7CiAgICAgIFJlY29nbml6ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCiAgICAgIHRoaXMuX3RpbWVyID0gbnVsbDsKICAgICAgdGhpcy5faW5wdXQgPSBudWxsOwogIH0KCiAgaW5oZXJpdChQcmVzc1JlY29nbml6ZXIsIFJlY29nbml6ZXIsIHsKICAgICAgLyoqCiAgICAgICAqIEBuYW1lc3BhY2UKICAgICAgICogQG1lbWJlcm9mIFByZXNzUmVjb2duaXplcgogICAgICAgKi8KICAgICAgZGVmYXVsdHM6IHsKICAgICAgICAgIGV2ZW50OiAncHJlc3MnLAogICAgICAgICAgcG9pbnRlcnM6IDEsCiAgICAgICAgICB0aW1lOiA1MDAsIC8vIG1pbmltYWwgdGltZSBvZiB0aGUgcG9pbnRlciB0byBiZSBwcmVzc2VkCiAgICAgICAgICB0aHJlc2hvbGQ6IDUgLy8gYSBtaW5pbWFsIG1vdmVtZW50IGlzIG9rLCBidXQga2VlcCBpdCBsb3cKICAgICAgfSwKCiAgICAgIGdldFRvdWNoQWN0aW9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBbVE9VQ0hfQUNUSU9OX0FVVE9dOwogICAgICB9LAoKICAgICAgcHJvY2VzczogZnVuY3Rpb24oaW5wdXQpIHsKICAgICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zOwogICAgICAgICAgdmFyIHZhbGlkUG9pbnRlcnMgPSBpbnB1dC5wb2ludGVycy5sZW5ndGggPT09IG9wdGlvbnMucG9pbnRlcnM7CiAgICAgICAgICB2YXIgdmFsaWRNb3ZlbWVudCA9IGlucHV0LmRpc3RhbmNlIDwgb3B0aW9ucy50aHJlc2hvbGQ7CiAgICAgICAgICB2YXIgdmFsaWRUaW1lID0gaW5wdXQuZGVsdGFUaW1lID4gb3B0aW9ucy50aW1lOwoKICAgICAgICAgIHRoaXMuX2lucHV0ID0gaW5wdXQ7CgogICAgICAgICAgLy8gd2Ugb25seSBhbGxvdyBsaXR0bGUgbW92ZW1lbnQKICAgICAgICAgIC8vIGFuZCB3ZSd2ZSByZWFjaGVkIGFuIGVuZCBldmVudCwgc28gYSB0YXAgaXMgcG9zc2libGUKICAgICAgICAgIGlmICghdmFsaWRNb3ZlbWVudCB8fCAhdmFsaWRQb2ludGVycyB8fCAoaW5wdXQuZXZlbnRUeXBlICYgKElOUFVUX0VORCB8IElOUFVUX0NBTkNFTCkgJiYgIXZhbGlkVGltZSkpIHsKICAgICAgICAgICAgICB0aGlzLnJlc2V0KCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGlucHV0LmV2ZW50VHlwZSAmIElOUFVUX1NUQVJUKSB7CiAgICAgICAgICAgICAgdGhpcy5yZXNldCgpOwogICAgICAgICAgICAgIHRoaXMuX3RpbWVyID0gc2V0VGltZW91dENvbnRleHQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBTVEFURV9SRUNPR05JWkVEOwogICAgICAgICAgICAgICAgICB0aGlzLnRyeUVtaXQoKTsKICAgICAgICAgICAgICB9LCBvcHRpb25zLnRpbWUsIHRoaXMpOwogICAgICAgICAgfSBlbHNlIGlmIChpbnB1dC5ldmVudFR5cGUgJiBJTlBVVF9FTkQpIHsKICAgICAgICAgICAgICByZXR1cm4gU1RBVEVfUkVDT0dOSVpFRDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBTVEFURV9GQUlMRUQ7CiAgICAgIH0sCgogICAgICByZXNldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fdGltZXIpOwogICAgICB9LAoKICAgICAgZW1pdDogZnVuY3Rpb24oaW5wdXQpIHsKICAgICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSBTVEFURV9SRUNPR05JWkVEKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpbnB1dCAmJiAoaW5wdXQuZXZlbnRUeXBlICYgSU5QVVRfRU5EKSkgewogICAgICAgICAgICAgIHRoaXMubWFuYWdlci5lbWl0KHRoaXMub3B0aW9ucy5ldmVudCArICd1cCcsIGlucHV0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5faW5wdXQudGltZVN0YW1wID0gbm93KCk7CiAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLmVtaXQodGhpcy5vcHRpb25zLmV2ZW50LCB0aGlzLl9pbnB1dCk7CiAgICAgICAgICB9CiAgICAgIH0KICB9KTsKCiAgLyoqCiAgICogUm90YXRlCiAgICogUmVjb2duaXplZCB3aGVuIHR3byBvciBtb3JlIHBvaW50ZXIgYXJlIG1vdmluZyBpbiBhIGNpcmN1bGFyIG1vdGlvbi4KICAgKiBAY29uc3RydWN0b3IKICAgKiBAZXh0ZW5kcyBBdHRyUmVjb2duaXplcgogICAqLwogIGZ1bmN0aW9uIFJvdGF0ZVJlY29nbml6ZXIoKSB7CiAgICAgIEF0dHJSZWNvZ25pemVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICBpbmhlcml0KFJvdGF0ZVJlY29nbml6ZXIsIEF0dHJSZWNvZ25pemVyLCB7CiAgICAgIC8qKgogICAgICAgKiBAbmFtZXNwYWNlCiAgICAgICAqIEBtZW1iZXJvZiBSb3RhdGVSZWNvZ25pemVyCiAgICAgICAqLwogICAgICBkZWZhdWx0czogewogICAgICAgICAgZXZlbnQ6ICdyb3RhdGUnLAogICAgICAgICAgdGhyZXNob2xkOiAwLAogICAgICAgICAgcG9pbnRlcnM6IDIKICAgICAgfSwKCiAgICAgIGdldFRvdWNoQWN0aW9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBbVE9VQ0hfQUNUSU9OX05PTkVdOwogICAgICB9LAoKICAgICAgYXR0clRlc3Q6IGZ1bmN0aW9uKGlucHV0KSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fc3VwZXIuYXR0clRlc3QuY2FsbCh0aGlzLCBpbnB1dCkgJiYKICAgICAgICAgICAgICAoTWF0aC5hYnMoaW5wdXQucm90YXRpb24pID4gdGhpcy5vcHRpb25zLnRocmVzaG9sZCB8fCB0aGlzLnN0YXRlICYgU1RBVEVfQkVHQU4pOwogICAgICB9CiAgfSk7CgogIC8qKgogICAqIFN3aXBlCiAgICogUmVjb2duaXplZCB3aGVuIHRoZSBwb2ludGVyIGlzIG1vdmluZyBmYXN0ICh2ZWxvY2l0eSksIHdpdGggZW5vdWdoIGRpc3RhbmNlIGluIHRoZSBhbGxvd2VkIGRpcmVjdGlvbi4KICAgKiBAY29uc3RydWN0b3IKICAgKiBAZXh0ZW5kcyBBdHRyUmVjb2duaXplcgogICAqLwogIGZ1bmN0aW9uIFN3aXBlUmVjb2duaXplcigpIHsKICAgICAgQXR0clJlY29nbml6ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9CgogIGluaGVyaXQoU3dpcGVSZWNvZ25pemVyLCBBdHRyUmVjb2duaXplciwgewogICAgICAvKioKICAgICAgICogQG5hbWVzcGFjZQogICAgICAgKiBAbWVtYmVyb2YgU3dpcGVSZWNvZ25pemVyCiAgICAgICAqLwogICAgICBkZWZhdWx0czogewogICAgICAgICAgZXZlbnQ6ICdzd2lwZScsCiAgICAgICAgICB0aHJlc2hvbGQ6IDEwLAogICAgICAgICAgdmVsb2NpdHk6IDAuNjUsCiAgICAgICAgICBkaXJlY3Rpb246IERJUkVDVElPTl9IT1JJWk9OVEFMIHwgRElSRUNUSU9OX1ZFUlRJQ0FMLAogICAgICAgICAgcG9pbnRlcnM6IDEKICAgICAgfSwKCiAgICAgIGdldFRvdWNoQWN0aW9uOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBQYW5SZWNvZ25pemVyLnByb3RvdHlwZS5nZXRUb3VjaEFjdGlvbi5jYWxsKHRoaXMpOwogICAgICB9LAoKICAgICAgYXR0clRlc3Q6IGZ1bmN0aW9uKGlucHV0KSB7CiAgICAgICAgICB2YXIgZGlyZWN0aW9uID0gdGhpcy5vcHRpb25zLmRpcmVjdGlvbjsKICAgICAgICAgIHZhciB2ZWxvY2l0eTsKCiAgICAgICAgICBpZiAoZGlyZWN0aW9uICYgKERJUkVDVElPTl9IT1JJWk9OVEFMIHwgRElSRUNUSU9OX1ZFUlRJQ0FMKSkgewogICAgICAgICAgICAgIHZlbG9jaXR5ID0gaW5wdXQudmVsb2NpdHk7CiAgICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiAmIERJUkVDVElPTl9IT1JJWk9OVEFMKSB7CiAgICAgICAgICAgICAgdmVsb2NpdHkgPSBpbnB1dC52ZWxvY2l0eVg7CiAgICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiAmIERJUkVDVElPTl9WRVJUSUNBTCkgewogICAgICAgICAgICAgIHZlbG9jaXR5ID0gaW5wdXQudmVsb2NpdHlZOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aGlzLl9zdXBlci5hdHRyVGVzdC5jYWxsKHRoaXMsIGlucHV0KSAmJgogICAgICAgICAgICAgIGRpcmVjdGlvbiAmIGlucHV0LmRpcmVjdGlvbiAmJgogICAgICAgICAgICAgIGlucHV0LmRpc3RhbmNlID4gdGhpcy5vcHRpb25zLnRocmVzaG9sZCAmJgogICAgICAgICAgICAgIGFicyh2ZWxvY2l0eSkgPiB0aGlzLm9wdGlvbnMudmVsb2NpdHkgJiYgaW5wdXQuZXZlbnRUeXBlICYgSU5QVVRfRU5EOwogICAgICB9LAoKICAgICAgZW1pdDogZnVuY3Rpb24oaW5wdXQpIHsKICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSBkaXJlY3Rpb25TdHIoaW5wdXQuZGlyZWN0aW9uKTsKICAgICAgICAgIGlmIChkaXJlY3Rpb24pIHsKICAgICAgICAgICAgICB0aGlzLm1hbmFnZXIuZW1pdCh0aGlzLm9wdGlvbnMuZXZlbnQgKyBkaXJlY3Rpb24sIGlucHV0KTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLm1hbmFnZXIuZW1pdCh0aGlzLm9wdGlvbnMuZXZlbnQsIGlucHV0KTsKICAgICAgfQogIH0pOwoKICAvKioKICAgKiBBIHRhcCBpcyBlY29nbml6ZWQgd2hlbiB0aGUgcG9pbnRlciBpcyBkb2luZyBhIHNtYWxsIHRhcC9jbGljay4gTXVsdGlwbGUgdGFwcyBhcmUgcmVjb2duaXplZCBpZiB0aGV5IG9jY3VyCiAgICogYmV0d2VlbiB0aGUgZ2l2ZW4gaW50ZXJ2YWwgYW5kIHBvc2l0aW9uLiBUaGUgZGVsYXkgb3B0aW9uIGNhbiBiZSB1c2VkIHRvIHJlY29nbml6ZSBtdWx0aS10YXBzIHdpdGhvdXQgZmlyaW5nCiAgICogYSBzaW5nbGUgdGFwLgogICAqCiAgICogVGhlIGV2ZW50RGF0YSBmcm9tIHRoZSBlbWl0dGVkIGV2ZW50IGNvbnRhaW5zIHRoZSBwcm9wZXJ0eSBgdGFwQ291bnRgLCB3aGljaCBjb250YWlucyB0aGUgYW1vdW50IG9mCiAgICogbXVsdGktdGFwcyBiZWluZyByZWNvZ25pemVkLgogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBleHRlbmRzIFJlY29nbml6ZXIKICAgKi8KICBmdW5jdGlvbiBUYXBSZWNvZ25pemVyKCkgewogICAgICBSZWNvZ25pemVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgogICAgICAvLyBwcmV2aW91cyB0aW1lIGFuZCBjZW50ZXIsCiAgICAgIC8vIHVzZWQgZm9yIHRhcCBjb3VudGluZwogICAgICB0aGlzLnBUaW1lID0gZmFsc2U7CiAgICAgIHRoaXMucENlbnRlciA9IGZhbHNlOwoKICAgICAgdGhpcy5fdGltZXIgPSBudWxsOwogICAgICB0aGlzLl9pbnB1dCA9IG51bGw7CiAgICAgIHRoaXMuY291bnQgPSAwOwogIH0KCiAgaW5oZXJpdChUYXBSZWNvZ25pemVyLCBSZWNvZ25pemVyLCB7CiAgICAgIC8qKgogICAgICAgKiBAbmFtZXNwYWNlCiAgICAgICAqIEBtZW1iZXJvZiBQaW5jaFJlY29nbml6ZXIKICAgICAgICovCiAgICAgIGRlZmF1bHRzOiB7CiAgICAgICAgICBldmVudDogJ3RhcCcsCiAgICAgICAgICBwb2ludGVyczogMSwKICAgICAgICAgIHRhcHM6IDEsCiAgICAgICAgICBpbnRlcnZhbDogMzAwLCAvLyBtYXggdGltZSBiZXR3ZWVuIHRoZSBtdWx0aS10YXAgdGFwcwogICAgICAgICAgdGltZTogMjUwLCAvLyBtYXggdGltZSBvZiB0aGUgcG9pbnRlciB0byBiZSBkb3duIChsaWtlIGZpbmdlciBvbiB0aGUgc2NyZWVuKQogICAgICAgICAgdGhyZXNob2xkOiAyLCAvLyBhIG1pbmltYWwgbW92ZW1lbnQgaXMgb2ssIGJ1dCBrZWVwIGl0IGxvdwogICAgICAgICAgcG9zVGhyZXNob2xkOiAxMCAvLyBhIG11bHRpLXRhcCBjYW4gYmUgYSBiaXQgb2ZmIHRoZSBpbml0aWFsIHBvc2l0aW9uCiAgICAgIH0sCgogICAgICBnZXRUb3VjaEFjdGlvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gW1RPVUNIX0FDVElPTl9NQU5JUFVMQVRJT05dOwogICAgICB9LAoKICAgICAgcHJvY2VzczogZnVuY3Rpb24oaW5wdXQpIHsKICAgICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zOwoKICAgICAgICAgIHZhciB2YWxpZFBvaW50ZXJzID0gaW5wdXQucG9pbnRlcnMubGVuZ3RoID09PSBvcHRpb25zLnBvaW50ZXJzOwogICAgICAgICAgdmFyIHZhbGlkTW92ZW1lbnQgPSBpbnB1dC5kaXN0YW5jZSA8IG9wdGlvbnMudGhyZXNob2xkOwogICAgICAgICAgdmFyIHZhbGlkVG91Y2hUaW1lID0gaW5wdXQuZGVsdGFUaW1lIDwgb3B0aW9ucy50aW1lOwoKICAgICAgICAgIHRoaXMucmVzZXQoKTsKCiAgICAgICAgICBpZiAoKGlucHV0LmV2ZW50VHlwZSAmIElOUFVUX1NUQVJUKSAmJiAodGhpcy5jb3VudCA9PT0gMCkpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mYWlsVGltZW91dCgpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIHdlIG9ubHkgYWxsb3cgbGl0dGxlIG1vdmVtZW50CiAgICAgICAgICAvLyBhbmQgd2UndmUgcmVhY2hlZCBhbiBlbmQgZXZlbnQsIHNvIGEgdGFwIGlzIHBvc3NpYmxlCiAgICAgICAgICBpZiAodmFsaWRNb3ZlbWVudCAmJiB2YWxpZFRvdWNoVGltZSAmJiB2YWxpZFBvaW50ZXJzKSB7CiAgICAgICAgICAgICAgaWYgKGlucHV0LmV2ZW50VHlwZSAhPSBJTlBVVF9FTkQpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmFpbFRpbWVvdXQoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciB2YWxpZEludGVydmFsID0gdGhpcy5wVGltZSA/IChpbnB1dC50aW1lU3RhbXAgLSB0aGlzLnBUaW1lIDwgb3B0aW9ucy5pbnRlcnZhbCkgOiB0cnVlOwogICAgICAgICAgICAgIHZhciB2YWxpZE11bHRpVGFwID0gIXRoaXMucENlbnRlciB8fCBnZXREaXN0YW5jZSh0aGlzLnBDZW50ZXIsIGlucHV0LmNlbnRlcikgPCBvcHRpb25zLnBvc1RocmVzaG9sZDsKCiAgICAgICAgICAgICAgdGhpcy5wVGltZSA9IGlucHV0LnRpbWVTdGFtcDsKICAgICAgICAgICAgICB0aGlzLnBDZW50ZXIgPSBpbnB1dC5jZW50ZXI7CgogICAgICAgICAgICAgIGlmICghdmFsaWRNdWx0aVRhcCB8fCAhdmFsaWRJbnRlcnZhbCkgewogICAgICAgICAgICAgICAgICB0aGlzLmNvdW50ID0gMTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLmNvdW50ICs9IDE7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLl9pbnB1dCA9IGlucHV0OwoKICAgICAgICAgICAgICAvLyBpZiB0YXAgY291bnQgbWF0Y2hlcyB3ZSBoYXZlIHJlY29nbml6ZWQgaXQsCiAgICAgICAgICAgICAgLy8gZWxzZSBpdCBoYXMgYmVnYW4gcmVjb2duaXppbmcuLi4KICAgICAgICAgICAgICB2YXIgdGFwQ291bnQgPSB0aGlzLmNvdW50ICUgb3B0aW9ucy50YXBzOwogICAgICAgICAgICAgIGlmICh0YXBDb3VudCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAvLyBubyBmYWlsaW5nIHJlcXVpcmVtZW50cywgaW1tZWRpYXRlbHkgdHJpZ2dlciB0aGUgdGFwIGV2ZW50CiAgICAgICAgICAgICAgICAgIC8vIG9yIHdhaXQgYXMgbG9uZyBhcyB0aGUgbXVsdGl0YXAgaW50ZXJ2YWwgdG8gdHJpZ2dlcgogICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaGFzUmVxdWlyZUZhaWx1cmVzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTVEFURV9SRUNPR05JWkVEOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGltZXIgPSBzZXRUaW1lb3V0Q29udGV4dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlID0gU1RBVEVfUkVDT0dOSVpFRDsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyeUVtaXQoKTsKICAgICAgICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMuaW50ZXJ2YWwsIHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNUQVRFX0JFR0FOOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFNUQVRFX0ZBSUxFRDsKICAgICAgfSwKCiAgICAgIGZhaWxUaW1lb3V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMuX3RpbWVyID0gc2V0VGltZW91dENvbnRleHQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFNUQVRFX0ZBSUxFRDsKICAgICAgICAgIH0sIHRoaXMub3B0aW9ucy5pbnRlcnZhbCwgdGhpcyk7CiAgICAgICAgICByZXR1cm4gU1RBVEVfRkFJTEVEOwogICAgICB9LAoKICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVyKTsKICAgICAgfSwKCiAgICAgIGVtaXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT0gU1RBVEVfUkVDT0dOSVpFRCApIHsKICAgICAgICAgICAgICB0aGlzLl9pbnB1dC50YXBDb3VudCA9IHRoaXMuY291bnQ7CiAgICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLmVtaXQodGhpcy5vcHRpb25zLmV2ZW50LCB0aGlzLl9pbnB1dCk7CiAgICAgICAgICB9CiAgICAgIH0KICB9KTsKCiAgLyoqCiAgICogU2ltcGxlIHdheSB0byBjcmVhdGUgYW4gbWFuYWdlciB3aXRoIGEgZGVmYXVsdCBzZXQgb2YgcmVjb2duaXplcnMuCiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZWxlbWVudAogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10KICAgKiBAY29uc3RydWN0b3IKICAgKi8KICBmdW5jdGlvbiBIYW1tZXIoZWxlbWVudCwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgb3B0aW9ucy5yZWNvZ25pemVycyA9IGlmVW5kZWZpbmVkKG9wdGlvbnMucmVjb2duaXplcnMsIEhhbW1lci5kZWZhdWx0cy5wcmVzZXQpOwogICAgICByZXR1cm4gbmV3IE1hbmFnZXIoZWxlbWVudCwgb3B0aW9ucyk7CiAgfQoKICAvKioKICAgKiBAY29uc3Qge3N0cmluZ30KICAgKi8KICBIYW1tZXIuVkVSU0lPTiA9ICcyLjAuNCc7CgogIC8qKgogICAqIGRlZmF1bHQgc2V0dGluZ3MKICAgKiBAbmFtZXNwYWNlCiAgICovCiAgSGFtbWVyLmRlZmF1bHRzID0gewogICAgICAvKioKICAgICAgICogc2V0IGlmIERPTSBldmVudHMgYXJlIGJlaW5nIHRyaWdnZXJlZC4KICAgICAgICogQnV0IHRoaXMgaXMgc2xvd2VyIGFuZCB1bnVzZWQgYnkgc2ltcGxlIGltcGxlbWVudGF0aW9ucywgc28gZGlzYWJsZWQgYnkgZGVmYXVsdC4KICAgICAgICogQHR5cGUge0Jvb2xlYW59CiAgICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgICAqLwogICAgICBkb21FdmVudHM6IGZhbHNlLAoKICAgICAgLyoqCiAgICAgICAqIFRoZSB2YWx1ZSBmb3IgdGhlIHRvdWNoQWN0aW9uIHByb3BlcnR5L2ZhbGxiYWNrLgogICAgICAgKiBXaGVuIHNldCB0byBgY29tcHV0ZWAgaXQgd2lsbCBtYWdpY2FsbHkgc2V0IHRoZSBjb3JyZWN0IHZhbHVlIGJhc2VkIG9uIHRoZSBhZGRlZCByZWNvZ25pemVycy4KICAgICAgICogQHR5cGUge1N0cmluZ30KICAgICAgICogQGRlZmF1bHQgY29tcHV0ZQogICAgICAgKi8KICAgICAgdG91Y2hBY3Rpb246IFRPVUNIX0FDVElPTl9DT01QVVRFLAoKICAgICAgLyoqCiAgICAgICAqIEB0eXBlIHtCb29sZWFufQogICAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgICAqLwogICAgICBlbmFibGU6IHRydWUsCgogICAgICAvKioKICAgICAgICogRVhQRVJJTUVOVEFMIEZFQVRVUkUgLS0gY2FuIGJlIHJlbW92ZWQvY2hhbmdlZAogICAgICAgKiBDaGFuZ2UgdGhlIHBhcmVudCBpbnB1dCB0YXJnZXQgZWxlbWVudC4KICAgICAgICogSWYgTnVsbCwgdGhlbiBpdCBpcyBiZWluZyBzZXQgdGhlIHRvIG1haW4gZWxlbWVudC4KICAgICAgICogQHR5cGUge051bGx8RXZlbnRUYXJnZXR9CiAgICAgICAqIEBkZWZhdWx0IG51bGwKICAgICAgICovCiAgICAgIGlucHV0VGFyZ2V0OiBudWxsLAoKICAgICAgLyoqCiAgICAgICAqIGZvcmNlIGFuIGlucHV0IGNsYXNzCiAgICAgICAqIEB0eXBlIHtOdWxsfEZ1bmN0aW9ufQogICAgICAgKiBAZGVmYXVsdCBudWxsCiAgICAgICAqLwogICAgICBpbnB1dENsYXNzOiBudWxsLAoKICAgICAgLyoqCiAgICAgICAqIERlZmF1bHQgcmVjb2duaXplciBzZXR1cCB3aGVuIGNhbGxpbmcgYEhhbW1lcigpYAogICAgICAgKiBXaGVuIGNyZWF0aW5nIGEgbmV3IE1hbmFnZXIgdGhlc2Ugd2lsbCBiZSBza2lwcGVkLgogICAgICAgKiBAdHlwZSB7QXJyYXl9CiAgICAgICAqLwogICAgICBwcmVzZXQ6IFsKICAgICAgICAgIC8vIFJlY29nbml6ZXJDbGFzcywgb3B0aW9ucywgW3JlY29nbml6ZVdpdGgsIC4uLl0sIFtyZXF1aXJlRmFpbHVyZSwgLi4uXQogICAgICAgICAgW1JvdGF0ZVJlY29nbml6ZXIsIHsgZW5hYmxlOiBmYWxzZSB9XSwKICAgICAgICAgIFtQaW5jaFJlY29nbml6ZXIsIHsgZW5hYmxlOiBmYWxzZSB9LCBbJ3JvdGF0ZSddXSwKICAgICAgICAgIFtTd2lwZVJlY29nbml6ZXIseyBkaXJlY3Rpb246IERJUkVDVElPTl9IT1JJWk9OVEFMIH1dLAogICAgICAgICAgW1BhblJlY29nbml6ZXIsIHsgZGlyZWN0aW9uOiBESVJFQ1RJT05fSE9SSVpPTlRBTCB9LCBbJ3N3aXBlJ11dLAogICAgICAgICAgW1RhcFJlY29nbml6ZXJdLAogICAgICAgICAgW1RhcFJlY29nbml6ZXIsIHsgZXZlbnQ6ICdkb3VibGV0YXAnLCB0YXBzOiAyIH0sIFsndGFwJ11dLAogICAgICAgICAgW1ByZXNzUmVjb2duaXplcl0KICAgICAgXSwKCiAgICAgIC8qKgogICAgICAgKiBTb21lIENTUyBwcm9wZXJ0aWVzIGNhbiBiZSB1c2VkIHRvIGltcHJvdmUgdGhlIHdvcmtpbmcgb2YgSGFtbWVyLgogICAgICAgKiBBZGQgdGhlbSB0byB0aGlzIG1ldGhvZCBhbmQgdGhleSB3aWxsIGJlIHNldCB3aGVuIGNyZWF0aW5nIGEgbmV3IE1hbmFnZXIuCiAgICAgICAqIEBuYW1lc3BhY2UKICAgICAgICovCiAgICAgIGNzc1Byb3BzOiB7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIERpc2FibGVzIHRleHQgc2VsZWN0aW9uIHRvIGltcHJvdmUgdGhlIGRyYWdnaW5nIGdlc3R1cmUuIE1haW5seSBmb3IgZGVza3RvcCBicm93c2Vycy4KICAgICAgICAgICAqIEB0eXBlIHtTdHJpbmd9CiAgICAgICAgICAgKiBAZGVmYXVsdCAnbm9uZScKICAgICAgICAgICAqLwogICAgICAgICAgdXNlclNlbGVjdDogJ25vbmUnLAoKICAgICAgICAgIC8qKgogICAgICAgICAgICogRGlzYWJsZSB0aGUgV2luZG93cyBQaG9uZSBncmlwcGVycyB3aGVuIHByZXNzaW5nIGFuIGVsZW1lbnQuCiAgICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfQogICAgICAgICAgICogQGRlZmF1bHQgJ25vbmUnCiAgICAgICAgICAgKi8KICAgICAgICAgIHRvdWNoU2VsZWN0OiAnbm9uZScsCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBEaXNhYmxlcyB0aGUgZGVmYXVsdCBjYWxsb3V0IHNob3duIHdoZW4geW91IHRvdWNoIGFuZCBob2xkIGEgdG91Y2ggdGFyZ2V0LgogICAgICAgICAgICogT24gaU9TLCB3aGVuIHlvdSB0b3VjaCBhbmQgaG9sZCBhIHRvdWNoIHRhcmdldCBzdWNoIGFzIGEgbGluaywgU2FmYXJpIGRpc3BsYXlzCiAgICAgICAgICAgKiBhIGNhbGxvdXQgY29udGFpbmluZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgbGluay4gVGhpcyBwcm9wZXJ0eSBhbGxvd3MgeW91IHRvIGRpc2FibGUgdGhhdCBjYWxsb3V0LgogICAgICAgICAgICogQHR5cGUge1N0cmluZ30KICAgICAgICAgICAqIEBkZWZhdWx0ICdub25lJwogICAgICAgICAgICovCiAgICAgICAgICB0b3VjaENhbGxvdXQ6ICdub25lJywKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFNwZWNpZmllcyB3aGV0aGVyIHpvb21pbmcgaXMgZW5hYmxlZC4gVXNlZCBieSBJRTEwPgogICAgICAgICAgICogQHR5cGUge1N0cmluZ30KICAgICAgICAgICAqIEBkZWZhdWx0ICdub25lJwogICAgICAgICAgICovCiAgICAgICAgICBjb250ZW50Wm9vbWluZzogJ25vbmUnLAoKICAgICAgICAgIC8qKgogICAgICAgICAgICogU3BlY2lmaWVzIHRoYXQgYW4gZW50aXJlIGVsZW1lbnQgc2hvdWxkIGJlIGRyYWdnYWJsZSBpbnN0ZWFkIG9mIGl0cyBjb250ZW50cy4gTWFpbmx5IGZvciBkZXNrdG9wIGJyb3dzZXJzLgogICAgICAgICAgICogQHR5cGUge1N0cmluZ30KICAgICAgICAgICAqIEBkZWZhdWx0ICdub25lJwogICAgICAgICAgICovCiAgICAgICAgICB1c2VyRHJhZzogJ25vbmUnLAoKICAgICAgICAgIC8qKgogICAgICAgICAgICogT3ZlcnJpZGVzIHRoZSBoaWdobGlnaHQgY29sb3Igc2hvd24gd2hlbiB0aGUgdXNlciB0YXBzIGEgbGluayBvciBhIEphdmFTY3JpcHQKICAgICAgICAgICAqIGNsaWNrYWJsZSBlbGVtZW50IGluIGlPUy4gVGhpcyBwcm9wZXJ0eSBvYmV5cyB0aGUgYWxwaGEgdmFsdWUsIGlmIHNwZWNpZmllZC4KICAgICAgICAgICAqIEB0eXBlIHtTdHJpbmd9CiAgICAgICAgICAgKiBAZGVmYXVsdCAncmdiYSgwLDAsMCwwKScKICAgICAgICAgICAqLwogICAgICAgICAgdGFwSGlnaGxpZ2h0Q29sb3I6ICdyZ2JhKDAsMCwwLDApJwogICAgICB9CiAgfTsKCiAgdmFyIFNUT1AgPSAxOwogIHZhciBGT1JDRURfU1RPUCA9IDI7CgogIC8qKgogICAqIE1hbmFnZXIKICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50CiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXQogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIE1hbmFnZXIoZWxlbWVudCwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCiAgICAgIHRoaXMub3B0aW9ucyA9IG1lcmdlKG9wdGlvbnMsIEhhbW1lci5kZWZhdWx0cyk7CiAgICAgIHRoaXMub3B0aW9ucy5pbnB1dFRhcmdldCA9IHRoaXMub3B0aW9ucy5pbnB1dFRhcmdldCB8fCBlbGVtZW50OwoKICAgICAgdGhpcy5oYW5kbGVycyA9IHt9OwogICAgICB0aGlzLnNlc3Npb24gPSB7fTsKICAgICAgdGhpcy5yZWNvZ25pemVycyA9IFtdOwoKICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgICAgdGhpcy5pbnB1dCA9IGNyZWF0ZUlucHV0SW5zdGFuY2UodGhpcyk7CiAgICAgIHRoaXMudG91Y2hBY3Rpb24gPSBuZXcgVG91Y2hBY3Rpb24odGhpcywgdGhpcy5vcHRpb25zLnRvdWNoQWN0aW9uKTsKCiAgICAgIHRvZ2dsZUNzc1Byb3BzKHRoaXMsIHRydWUpOwoKICAgICAgZWFjaChvcHRpb25zLnJlY29nbml6ZXJzLCBmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICB2YXIgcmVjb2duaXplciA9IHRoaXMuYWRkKG5ldyAoaXRlbVswXSkoaXRlbVsxXSkpOwogICAgICAgICAgaXRlbVsyXSAmJiByZWNvZ25pemVyLnJlY29nbml6ZVdpdGgoaXRlbVsyXSk7CiAgICAgICAgICBpdGVtWzNdICYmIHJlY29nbml6ZXIucmVxdWlyZUZhaWx1cmUoaXRlbVszXSk7CiAgICAgIH0sIHRoaXMpOwogIH0KCiAgTWFuYWdlci5wcm90b3R5cGUgPSB7CiAgICAgIC8qKgogICAgICAgKiBzZXQgb3B0aW9ucwogICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgKiBAcmV0dXJucyB7TWFuYWdlcn0KICAgICAgICovCiAgICAgIHNldDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgZXh0ZW5kKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CgogICAgICAgICAgLy8gT3B0aW9ucyB0aGF0IG5lZWQgYSBsaXR0bGUgbW9yZSBzZXR1cAogICAgICAgICAgaWYgKG9wdGlvbnMudG91Y2hBY3Rpb24pIHsKICAgICAgICAgICAgICB0aGlzLnRvdWNoQWN0aW9uLnVwZGF0ZSgpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9wdGlvbnMuaW5wdXRUYXJnZXQpIHsKICAgICAgICAgICAgICAvLyBDbGVhbiB1cCBleGlzdGluZyBldmVudCBsaXN0ZW5lcnMgYW5kIHJlaW5pdGlhbGl6ZQogICAgICAgICAgICAgIHRoaXMuaW5wdXQuZGVzdHJveSgpOwogICAgICAgICAgICAgIHRoaXMuaW5wdXQudGFyZ2V0ID0gb3B0aW9ucy5pbnB1dFRhcmdldDsKICAgICAgICAgICAgICB0aGlzLmlucHV0LmluaXQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIHN0b3AgcmVjb2duaXppbmcgZm9yIHRoaXMgc2Vzc2lvbi4KICAgICAgICogVGhpcyBzZXNzaW9uIHdpbGwgYmUgZGlzY2FyZGVkLCB3aGVuIGEgbmV3IFtpbnB1dF1zdGFydCBldmVudCBpcyBmaXJlZC4KICAgICAgICogV2hlbiBmb3JjZWQsIHRoZSByZWNvZ25pemVyIGN5Y2xlIGlzIHN0b3BwZWQgaW1tZWRpYXRlbHkuCiAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2ZvcmNlXQogICAgICAgKi8KICAgICAgc3RvcDogZnVuY3Rpb24oZm9yY2UpIHsKICAgICAgICAgIHRoaXMuc2Vzc2lvbi5zdG9wcGVkID0gZm9yY2UgPyBGT1JDRURfU1RPUCA6IFNUT1A7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogcnVuIHRoZSByZWNvZ25pemVycyEKICAgICAgICogY2FsbGVkIGJ5IHRoZSBpbnB1dEhhbmRsZXIgZnVuY3Rpb24gb24gZXZlcnkgbW92ZW1lbnQgb2YgdGhlIHBvaW50ZXJzICh0b3VjaGVzKQogICAgICAgKiBpdCB3YWxrcyB0aHJvdWdoIGFsbCB0aGUgcmVjb2duaXplcnMgYW5kIHRyaWVzIHRvIGRldGVjdCB0aGUgZ2VzdHVyZSB0aGF0IGlzIGJlaW5nIG1hZGUKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGlucHV0RGF0YQogICAgICAgKi8KICAgICAgcmVjb2duaXplOiBmdW5jdGlvbihpbnB1dERhdGEpIHsKICAgICAgICAgIHZhciBzZXNzaW9uID0gdGhpcy5zZXNzaW9uOwogICAgICAgICAgaWYgKHNlc3Npb24uc3RvcHBlZCkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBydW4gdGhlIHRvdWNoLWFjdGlvbiBwb2x5ZmlsbAogICAgICAgICAgdGhpcy50b3VjaEFjdGlvbi5wcmV2ZW50RGVmYXVsdHMoaW5wdXREYXRhKTsKCiAgICAgICAgICB2YXIgcmVjb2duaXplcjsKICAgICAgICAgIHZhciByZWNvZ25pemVycyA9IHRoaXMucmVjb2duaXplcnM7CgogICAgICAgICAgLy8gdGhpcyBob2xkcyB0aGUgcmVjb2duaXplciB0aGF0IGlzIGJlaW5nIHJlY29nbml6ZWQuCiAgICAgICAgICAvLyBzbyB0aGUgcmVjb2duaXplcidzIHN0YXRlIG5lZWRzIHRvIGJlIEJFR0FOLCBDSEFOR0VELCBFTkRFRCBvciBSRUNPR05JWkVECiAgICAgICAgICAvLyBpZiBubyByZWNvZ25pemVyIGlzIGRldGVjdGluZyBhIHRoaW5nLCBpdCBpcyBzZXQgdG8gYG51bGxgCiAgICAgICAgICB2YXIgY3VyUmVjb2duaXplciA9IHNlc3Npb24uY3VyUmVjb2duaXplcjsKCiAgICAgICAgICAvLyByZXNldCB3aGVuIHRoZSBsYXN0IHJlY29nbml6ZXIgaXMgcmVjb2duaXplZAogICAgICAgICAgLy8gb3Igd2hlbiB3ZSdyZSBpbiBhIG5ldyBzZXNzaW9uCiAgICAgICAgICBpZiAoIWN1clJlY29nbml6ZXIgfHwgKGN1clJlY29nbml6ZXIgJiYgY3VyUmVjb2duaXplci5zdGF0ZSAmIFNUQVRFX1JFQ09HTklaRUQpKSB7CiAgICAgICAgICAgICAgY3VyUmVjb2duaXplciA9IHNlc3Npb24uY3VyUmVjb2duaXplciA9IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGkgPSAwOwogICAgICAgICAgd2hpbGUgKGkgPCByZWNvZ25pemVycy5sZW5ndGgpIHsKICAgICAgICAgICAgICByZWNvZ25pemVyID0gcmVjb2duaXplcnNbaV07CgogICAgICAgICAgICAgIC8vIGZpbmQgb3V0IGlmIHdlIGFyZSBhbGxvd2VkIHRyeSB0byByZWNvZ25pemUgdGhlIGlucHV0IGZvciB0aGlzIG9uZS4KICAgICAgICAgICAgICAvLyAxLiAgIGFsbG93IGlmIHRoZSBzZXNzaW9uIGlzIE5PVCBmb3JjZWQgc3RvcHBlZCAoc2VlIHRoZSAuc3RvcCgpIG1ldGhvZCkKICAgICAgICAgICAgICAvLyAyLiAgIGFsbG93IGlmIHdlIHN0aWxsIGhhdmVuJ3QgcmVjb2duaXplZCBhIGdlc3R1cmUgaW4gdGhpcyBzZXNzaW9uLCBvciB0aGUgdGhpcyByZWNvZ25pemVyIGlzIHRoZSBvbmUKICAgICAgICAgICAgICAvLyAgICAgIHRoYXQgaXMgYmVpbmcgcmVjb2duaXplZC4KICAgICAgICAgICAgICAvLyAzLiAgIGFsbG93IGlmIHRoZSByZWNvZ25pemVyIGlzIGFsbG93ZWQgdG8gcnVuIHNpbXVsdGFuZW91cyB3aXRoIHRoZSBjdXJyZW50IHJlY29nbml6ZWQgcmVjb2duaXplci4KICAgICAgICAgICAgICAvLyAgICAgIHRoaXMgY2FuIGJlIHNldHVwIHdpdGggdGhlIGByZWNvZ25pemVXaXRoKClgIG1ldGhvZCBvbiB0aGUgcmVjb2duaXplci4KICAgICAgICAgICAgICBpZiAoc2Vzc2lvbi5zdG9wcGVkICE9PSBGT1JDRURfU1RPUCAmJiAoIC8vIDEKICAgICAgICAgICAgICAgICAgICAgICFjdXJSZWNvZ25pemVyIHx8IHJlY29nbml6ZXIgPT0gY3VyUmVjb2duaXplciB8fCAvLyAyCiAgICAgICAgICAgICAgICAgICAgICByZWNvZ25pemVyLmNhblJlY29nbml6ZVdpdGgoY3VyUmVjb2duaXplcikpKSB7IC8vIDMKICAgICAgICAgICAgICAgICAgcmVjb2duaXplci5yZWNvZ25pemUoaW5wdXREYXRhKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZWNvZ25pemVyLnJlc2V0KCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAvLyBpZiB0aGUgcmVjb2duaXplciBoYXMgYmVlbiByZWNvZ25pemluZyB0aGUgaW5wdXQgYXMgYSB2YWxpZCBnZXN0dXJlLCB3ZSB3YW50IHRvIHN0b3JlIHRoaXMgb25lIGFzIHRoZQogICAgICAgICAgICAgIC8vIGN1cnJlbnQgYWN0aXZlIHJlY29nbml6ZXIuIGJ1dCBvbmx5IGlmIHdlIGRvbid0IGFscmVhZHkgaGF2ZSBhbiBhY3RpdmUgcmVjb2duaXplcgogICAgICAgICAgICAgIGlmICghY3VyUmVjb2duaXplciAmJiByZWNvZ25pemVyLnN0YXRlICYgKFNUQVRFX0JFR0FOIHwgU1RBVEVfQ0hBTkdFRCB8IFNUQVRFX0VOREVEKSkgewogICAgICAgICAgICAgICAgICBjdXJSZWNvZ25pemVyID0gc2Vzc2lvbi5jdXJSZWNvZ25pemVyID0gcmVjb2duaXplcjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgfQogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIGdldCBhIHJlY29nbml6ZXIgYnkgaXRzIGV2ZW50IG5hbWUuCiAgICAgICAqIEBwYXJhbSB7UmVjb2duaXplcnxTdHJpbmd9IHJlY29nbml6ZXIKICAgICAgICogQHJldHVybnMge1JlY29nbml6ZXJ8TnVsbH0KICAgICAgICovCiAgICAgIGdldDogZnVuY3Rpb24ocmVjb2duaXplcikgewogICAgICAgICAgaWYgKHJlY29nbml6ZXIgaW5zdGFuY2VvZiBSZWNvZ25pemVyKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlY29nbml6ZXI7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHJlY29nbml6ZXJzID0gdGhpcy5yZWNvZ25pemVyczsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVjb2duaXplcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBpZiAocmVjb2duaXplcnNbaV0ub3B0aW9ucy5ldmVudCA9PSByZWNvZ25pemVyKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiByZWNvZ25pemVyc1tpXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBhZGQgYSByZWNvZ25pemVyIHRvIHRoZSBtYW5hZ2VyCiAgICAgICAqIGV4aXN0aW5nIHJlY29nbml6ZXJzIHdpdGggdGhlIHNhbWUgZXZlbnQgbmFtZSB3aWxsIGJlIHJlbW92ZWQKICAgICAgICogQHBhcmFtIHtSZWNvZ25pemVyfSByZWNvZ25pemVyCiAgICAgICAqIEByZXR1cm5zIHtSZWNvZ25pemVyfE1hbmFnZXJ9CiAgICAgICAqLwogICAgICBhZGQ6IGZ1bmN0aW9uKHJlY29nbml6ZXIpIHsKICAgICAgICAgIGlmIChpbnZva2VBcnJheUFyZyhyZWNvZ25pemVyLCAnYWRkJywgdGhpcykpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyByZW1vdmUgZXhpc3RpbmcKICAgICAgICAgIHZhciBleGlzdGluZyA9IHRoaXMuZ2V0KHJlY29nbml6ZXIub3B0aW9ucy5ldmVudCk7CiAgICAgICAgICBpZiAoZXhpc3RpbmcpIHsKICAgICAgICAgICAgICB0aGlzLnJlbW92ZShleGlzdGluZyk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5yZWNvZ25pemVycy5wdXNoKHJlY29nbml6ZXIpOwogICAgICAgICAgcmVjb2duaXplci5tYW5hZ2VyID0gdGhpczsKCiAgICAgICAgICB0aGlzLnRvdWNoQWN0aW9uLnVwZGF0ZSgpOwogICAgICAgICAgcmV0dXJuIHJlY29nbml6ZXI7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogcmVtb3ZlIGEgcmVjb2duaXplciBieSBuYW1lIG9yIGluc3RhbmNlCiAgICAgICAqIEBwYXJhbSB7UmVjb2duaXplcnxTdHJpbmd9IHJlY29nbml6ZXIKICAgICAgICogQHJldHVybnMge01hbmFnZXJ9CiAgICAgICAqLwogICAgICByZW1vdmU6IGZ1bmN0aW9uKHJlY29nbml6ZXIpIHsKICAgICAgICAgIGlmIChpbnZva2VBcnJheUFyZyhyZWNvZ25pemVyLCAncmVtb3ZlJywgdGhpcykpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVjb2duaXplcnMgPSB0aGlzLnJlY29nbml6ZXJzOwogICAgICAgICAgcmVjb2duaXplciA9IHRoaXMuZ2V0KHJlY29nbml6ZXIpOwogICAgICAgICAgcmVjb2duaXplcnMuc3BsaWNlKGluQXJyYXkocmVjb2duaXplcnMsIHJlY29nbml6ZXIpLCAxKTsKCiAgICAgICAgICB0aGlzLnRvdWNoQWN0aW9uLnVwZGF0ZSgpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogYmluZCBldmVudAogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnRzCiAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIKICAgICAgICogQHJldHVybnMge0V2ZW50RW1pdHRlcn0gdGhpcwogICAgICAgKi8KICAgICAgb246IGZ1bmN0aW9uKGV2ZW50cywgaGFuZGxlcikgewogICAgICAgICAgdmFyIGhhbmRsZXJzID0gdGhpcy5oYW5kbGVyczsKICAgICAgICAgIGVhY2goc3BsaXRTdHIoZXZlbnRzKSwgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICBoYW5kbGVyc1tldmVudF0gPSBoYW5kbGVyc1tldmVudF0gfHwgW107CiAgICAgICAgICAgICAgaGFuZGxlcnNbZXZlbnRdLnB1c2goaGFuZGxlcik7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIHVuYmluZCBldmVudCwgbGVhdmUgZW1pdCBibGFuayB0byByZW1vdmUgYWxsIGhhbmRsZXJzCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudHMKICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2hhbmRsZXJdCiAgICAgICAqIEByZXR1cm5zIHtFdmVudEVtaXR0ZXJ9IHRoaXMKICAgICAgICovCiAgICAgIG9mZjogZnVuY3Rpb24oZXZlbnRzLCBoYW5kbGVyKSB7CiAgICAgICAgICB2YXIgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzOwogICAgICAgICAgZWFjaChzcGxpdFN0cihldmVudHMpLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgIGlmICghaGFuZGxlcikgewogICAgICAgICAgICAgICAgICBkZWxldGUgaGFuZGxlcnNbZXZlbnRdOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGhhbmRsZXJzW2V2ZW50XS5zcGxpY2UoaW5BcnJheShoYW5kbGVyc1tldmVudF0sIGhhbmRsZXIpLCAxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIGVtaXQgZXZlbnQgdG8gdGhlIGxpc3RlbmVycwogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnQKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEKICAgICAgICovCiAgICAgIGVtaXQ6IGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7CiAgICAgICAgICAvLyB3ZSBhbHNvIHdhbnQgdG8gdHJpZ2dlciBkb20gZXZlbnRzCiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRvbUV2ZW50cykgewogICAgICAgICAgICAgIHRyaWdnZXJEb21FdmVudChldmVudCwgZGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gbm8gaGFuZGxlcnMsIHNvIHNraXAgaXQgYWxsCiAgICAgICAgICB2YXIgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzW2V2ZW50XSAmJiB0aGlzLmhhbmRsZXJzW2V2ZW50XS5zbGljZSgpOwogICAgICAgICAgaWYgKCFoYW5kbGVycyB8fCAhaGFuZGxlcnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGRhdGEudHlwZSA9IGV2ZW50OwogICAgICAgICAgZGF0YS5wcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGRhdGEuc3JjRXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIGkgPSAwOwogICAgICAgICAgd2hpbGUgKGkgPCBoYW5kbGVycy5sZW5ndGgpIHsKICAgICAgICAgICAgICBoYW5kbGVyc1tpXShkYXRhKTsKICAgICAgICAgICAgICBpKys7CiAgICAgICAgICB9CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogZGVzdHJveSB0aGUgbWFuYWdlciBhbmQgdW5iaW5kcyBhbGwgZXZlbnRzCiAgICAgICAqIGl0IGRvZXNuJ3QgdW5iaW5kIGRvbSBldmVudHMsIHRoYXQgaXMgdGhlIHVzZXIgb3duIHJlc3BvbnNpYmlsaXR5CiAgICAgICAqLwogICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMuZWxlbWVudCAmJiB0b2dnbGVDc3NQcm9wcyh0aGlzLCBmYWxzZSk7CgogICAgICAgICAgdGhpcy5oYW5kbGVycyA9IHt9OwogICAgICAgICAgdGhpcy5zZXNzaW9uID0ge307CiAgICAgICAgICB0aGlzLmlucHV0LmRlc3Ryb3koKTsKICAgICAgICAgIHRoaXMuZWxlbWVudCA9IG51bGw7CiAgICAgIH0KICB9OwoKICAvKioKICAgKiBhZGQvcmVtb3ZlIHRoZSBjc3MgcHJvcGVydGllcyBhcyBkZWZpbmVkIGluIG1hbmFnZXIub3B0aW9ucy5jc3NQcm9wcwogICAqIEBwYXJhbSB7TWFuYWdlcn0gbWFuYWdlcgogICAqIEBwYXJhbSB7Qm9vbGVhbn0gYWRkCiAgICovCiAgZnVuY3Rpb24gdG9nZ2xlQ3NzUHJvcHMobWFuYWdlciwgYWRkKSB7CiAgICAgIHZhciBlbGVtZW50ID0gbWFuYWdlci5lbGVtZW50OwogICAgICBlYWNoKG1hbmFnZXIub3B0aW9ucy5jc3NQcm9wcywgZnVuY3Rpb24odmFsdWUsIG5hbWUpIHsKICAgICAgICAgIGVsZW1lbnQuc3R5bGVbcHJlZml4ZWQoZWxlbWVudC5zdHlsZSwgbmFtZSldID0gYWRkID8gdmFsdWUgOiAnJzsKICAgICAgfSk7CiAgfQoKICAvKioKICAgKiB0cmlnZ2VyIGRvbSBldmVudAogICAqIEBwYXJhbSB7U3RyaW5nfSBldmVudAogICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhCiAgICovCiAgZnVuY3Rpb24gdHJpZ2dlckRvbUV2ZW50KGV2ZW50LCBkYXRhKSB7CiAgICAgIHZhciBnZXN0dXJlRXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnQnKTsKICAgICAgZ2VzdHVyZUV2ZW50LmluaXRFdmVudChldmVudCwgdHJ1ZSwgdHJ1ZSk7CiAgICAgIGdlc3R1cmVFdmVudC5nZXN0dXJlID0gZGF0YTsKICAgICAgZGF0YS50YXJnZXQuZGlzcGF0Y2hFdmVudChnZXN0dXJlRXZlbnQpOwogIH0KCiAgZXh0ZW5kKEhhbW1lciwgewogICAgICBJTlBVVF9TVEFSVDogSU5QVVRfU1RBUlQsCiAgICAgIElOUFVUX01PVkU6IElOUFVUX01PVkUsCiAgICAgIElOUFVUX0VORDogSU5QVVRfRU5ELAogICAgICBJTlBVVF9DQU5DRUw6IElOUFVUX0NBTkNFTCwKCiAgICAgIFNUQVRFX1BPU1NJQkxFOiBTVEFURV9QT1NTSUJMRSwKICAgICAgU1RBVEVfQkVHQU46IFNUQVRFX0JFR0FOLAogICAgICBTVEFURV9DSEFOR0VEOiBTVEFURV9DSEFOR0VELAogICAgICBTVEFURV9FTkRFRDogU1RBVEVfRU5ERUQsCiAgICAgIFNUQVRFX1JFQ09HTklaRUQ6IFNUQVRFX1JFQ09HTklaRUQsCiAgICAgIFNUQVRFX0NBTkNFTExFRDogU1RBVEVfQ0FOQ0VMTEVELAogICAgICBTVEFURV9GQUlMRUQ6IFNUQVRFX0ZBSUxFRCwKCiAgICAgIERJUkVDVElPTl9OT05FOiBESVJFQ1RJT05fTk9ORSwKICAgICAgRElSRUNUSU9OX0xFRlQ6IERJUkVDVElPTl9MRUZULAogICAgICBESVJFQ1RJT05fUklHSFQ6IERJUkVDVElPTl9SSUdIVCwKICAgICAgRElSRUNUSU9OX1VQOiBESVJFQ1RJT05fVVAsCiAgICAgIERJUkVDVElPTl9ET1dOOiBESVJFQ1RJT05fRE9XTiwKICAgICAgRElSRUNUSU9OX0hPUklaT05UQUw6IERJUkVDVElPTl9IT1JJWk9OVEFMLAogICAgICBESVJFQ1RJT05fVkVSVElDQUw6IERJUkVDVElPTl9WRVJUSUNBTCwKICAgICAgRElSRUNUSU9OX0FMTDogRElSRUNUSU9OX0FMTCwKCiAgICAgIE1hbmFnZXI6IE1hbmFnZXIsCiAgICAgIElucHV0OiBJbnB1dCwKICAgICAgVG91Y2hBY3Rpb246IFRvdWNoQWN0aW9uLAoKICAgICAgVG91Y2hJbnB1dDogVG91Y2hJbnB1dCwKICAgICAgTW91c2VJbnB1dDogTW91c2VJbnB1dCwKICAgICAgUG9pbnRlckV2ZW50SW5wdXQ6IFBvaW50ZXJFdmVudElucHV0LAogICAgICBUb3VjaE1vdXNlSW5wdXQ6IFRvdWNoTW91c2VJbnB1dCwKICAgICAgU2luZ2xlVG91Y2hJbnB1dDogU2luZ2xlVG91Y2hJbnB1dCwKCiAgICAgIFJlY29nbml6ZXI6IFJlY29nbml6ZXIsCiAgICAgIEF0dHJSZWNvZ25pemVyOiBBdHRyUmVjb2duaXplciwKICAgICAgVGFwOiBUYXBSZWNvZ25pemVyLAogICAgICBQYW46IFBhblJlY29nbml6ZXIsCiAgICAgIFN3aXBlOiBTd2lwZVJlY29nbml6ZXIsCiAgICAgIFBpbmNoOiBQaW5jaFJlY29nbml6ZXIsCiAgICAgIFJvdGF0ZTogUm90YXRlUmVjb2duaXplciwKICAgICAgUHJlc3M6IFByZXNzUmVjb2duaXplciwKCiAgICAgIG9uOiBhZGRFdmVudExpc3RlbmVycywKICAgICAgb2ZmOiByZW1vdmVFdmVudExpc3RlbmVycywKICAgICAgZWFjaDogZWFjaCwKICAgICAgbWVyZ2U6IG1lcmdlLAogICAgICBleHRlbmQ6IGV4dGVuZCwKICAgICAgaW5oZXJpdDogaW5oZXJpdCwKICAgICAgYmluZEZuOiBiaW5kRm4sCiAgICAgIHByZWZpeGVkOiBwcmVmaXhlZAogIH0pOwoKICBpZiAoImZ1bmN0aW9uIiA9PSBUWVBFX0ZVTkNUSU9OICYmIF9fd2VicGFja19yZXF1aXJlX18oMjYpKSB7CiAgICAgICEoX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBIYW1tZXI7CiAgICAgIH0uY2FsbChleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fLCBleHBvcnRzLCBtb2R1bGUpLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyAhPT0gdW5kZWZpbmVkICYmIChtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fKSk7CiAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgIG1vZHVsZS5leHBvcnRzID0gSGFtbWVyOwogIH0gZWxzZSB7CiAgICAgIHdpbmRvd1tleHBvcnROYW1lXSA9IEhhbW1lcjsKICB9CgogIH0pKHdpbmRvdywgZG9jdW1lbnQsICdIYW1tZXInKTsKCgovKioqLyB9LAovKiAyNiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKF9fd2VicGFja19hbWRfb3B0aW9uc19fKSB7bW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfYW1kX29wdGlvbnNfXzsKCiAgLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKGV4cG9ydHMsIHt9KSkKCi8qKiovIH0sCi8qIDI3ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKICB2YXIgaGFtbWVyVXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMjgpOwogIHZhciBtb21lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwogIHZhciBDb21wb25lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKTsKICB2YXIgRGF0ZVV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5KTsKCiAgLyoqCiAgICogQGNvbnN0cnVjdG9yIFJhbmdlCiAgICogQSBSYW5nZSBjb250cm9scyBhIG51bWVyaWMgcmFuZ2Ugd2l0aCBhIHN0YXJ0IGFuZCBlbmQgdmFsdWUuCiAgICogVGhlIFJhbmdlIGFkanVzdHMgdGhlIHJhbmdlIGJhc2VkIG9uIG1vdXNlIGV2ZW50cyBvciBwcm9ncmFtbWF0aWMgY2hhbmdlcywKICAgKiBhbmQgdHJpZ2dlcnMgZXZlbnRzIHdoZW4gdGhlIHJhbmdlIGlzIGNoYW5naW5nIG9yIGhhcyBiZWVuIGNoYW5nZWQuCiAgICogQHBhcmFtIHt7ZG9tOiBPYmplY3QsIGRvbVByb3BzOiBPYmplY3QsIGVtaXR0ZXI6IEVtaXR0ZXJ9fSBib2R5CiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgICBTZWUgZGVzY3JpcHRpb24gYXQgUmFuZ2Uuc2V0T3B0aW9ucwogICAqLwogIGZ1bmN0aW9uIFJhbmdlKGJvZHksIG9wdGlvbnMpIHsKICAgIHZhciBub3cgPSBtb21lbnQoKS5ob3VycygwKS5taW51dGVzKDApLnNlY29uZHMoMCkubWlsbGlzZWNvbmRzKDApOwogICAgdGhpcy5zdGFydCA9IG5vdy5jbG9uZSgpLmFkZCgtMywgJ2RheXMnKS52YWx1ZU9mKCk7IC8vIE51bWJlcgogICAgdGhpcy5lbmQgPSBub3cuY2xvbmUoKS5hZGQoNCwgJ2RheXMnKS52YWx1ZU9mKCk7IC8vIE51bWJlcgoKICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICB0aGlzLmRlbHRhRGlmZmVyZW5jZSA9IDA7CiAgICB0aGlzLnNjYWxlT2Zmc2V0ID0gMDsKICAgIHRoaXMuc3RhcnRUb0Zyb250ID0gZmFsc2U7CiAgICB0aGlzLmVuZFRvRnJvbnQgPSB0cnVlOwoKICAgIC8vIGRlZmF1bHQgb3B0aW9ucwogICAgdGhpcy5kZWZhdWx0T3B0aW9ucyA9IHsKICAgICAgc3RhcnQ6IG51bGwsCiAgICAgIGVuZDogbnVsbCwKICAgICAgZGlyZWN0aW9uOiAnaG9yaXpvbnRhbCcsIC8vICdob3Jpem9udGFsJyBvciAndmVydGljYWwnCiAgICAgIG1vdmVhYmxlOiB0cnVlLAogICAgICB6b29tYWJsZTogdHJ1ZSwKICAgICAgbWluOiBudWxsLAogICAgICBtYXg6IG51bGwsCiAgICAgIHpvb21NaW46IDEwLCAvLyBtaWxsaXNlY29uZHMKICAgICAgem9vbU1heDogMTAwMCAqIDYwICogNjAgKiAyNCAqIDM2NSAqIDEwMDAwIC8vIG1pbGxpc2Vjb25kcwogICAgfTsKICAgIHRoaXMub3B0aW9ucyA9IHV0aWwuZXh0ZW5kKHt9LCB0aGlzLmRlZmF1bHRPcHRpb25zKTsKCiAgICB0aGlzLnByb3BzID0gewogICAgICB0b3VjaDoge30KICAgIH07CiAgICB0aGlzLmFuaW1hdGlvblRpbWVyID0gbnVsbDsKCiAgICAvLyBkcmFnIGxpc3RlbmVycyBmb3IgZHJhZ2dpbmcKICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdwYW5zdGFydCcsIHRoaXMuX29uRHJhZ1N0YXJ0LmJpbmQodGhpcykpOwogICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ3Bhbm1vdmUnLCB0aGlzLl9vbkRyYWcuYmluZCh0aGlzKSk7CiAgICB0aGlzLmJvZHkuZW1pdHRlci5vbigncGFuZW5kJywgdGhpcy5fb25EcmFnRW5kLmJpbmQodGhpcykpOwoKICAgIC8vIG1vdXNlIHdoZWVsIGZvciB6b29taW5nCiAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignbW91c2V3aGVlbCcsIHRoaXMuX29uTW91c2VXaGVlbC5iaW5kKHRoaXMpKTsKCiAgICAvLyBwaW5jaCB0byB6b29tCiAgICB0aGlzLmJvZHkuZW1pdHRlci5vbigndG91Y2gnLCB0aGlzLl9vblRvdWNoLmJpbmQodGhpcykpOwogICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ3BpbmNoJywgdGhpcy5fb25QaW5jaC5iaW5kKHRoaXMpKTsKCiAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgfQoKICBSYW5nZS5wcm90b3R5cGUgPSBuZXcgQ29tcG9uZW50KCk7CgogIC8qKgogICAqIFNldCBvcHRpb25zIGZvciB0aGUgcmFuZ2UgY29udHJvbGxlcgogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgICAgQXZhaWxhYmxlIG9wdGlvbnM6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7TnVtYmVyIHwgRGF0ZSB8IFN0cmluZ30gc3RhcnQgIFN0YXJ0IGRhdGUgZm9yIHRoZSByYW5nZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge051bWJlciB8IERhdGUgfCBTdHJpbmd9IGVuZCAgICBFbmQgZGF0ZSBmb3IgdGhlIHJhbmdlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7TnVtYmVyfSBtaW4gICAgTWluaW11bSB2YWx1ZSBmb3Igc3RhcnQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtOdW1iZXJ9IG1heCAgICBNYXhpbXVtIHZhbHVlIGZvciBlbmQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtOdW1iZXJ9IHpvb21NaW4gICAgU2V0IGEgbWluaW11bSB2YWx1ZSBmb3IKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGVuZCAtIHN0YXJ0KS4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtOdW1iZXJ9IHpvb21NYXggICAgU2V0IGEgbWF4aW11bSB2YWx1ZSBmb3IKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGVuZCAtIHN0YXJ0KS4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtCb29sZWFufSBtb3ZlYWJsZSBFbmFibGUgbW92aW5nIG9mIHRoZSByYW5nZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5IGRyYWdnaW5nLiBUcnVlIGJ5IGRlZmF1bHQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtCb29sZWFufSB6b29tYWJsZSBFbmFibGUgem9vbWluZyBvZiB0aGUgcmFuZ2UKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBieSBwaW5jaGluZy9zY3JvbGxpbmcuIFRydWUgYnkgZGVmYXVsdAogICAqLwogIFJhbmdlLnByb3RvdHlwZS5zZXRPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIGlmIChvcHRpb25zKSB7CiAgICAgIC8vIGNvcHkgdGhlIG9wdGlvbnMgdGhhdCB3ZSBrbm93CiAgICAgIHZhciBmaWVsZHMgPSBbJ2RpcmVjdGlvbicsICdtaW4nLCAnbWF4JywgJ3pvb21NaW4nLCAnem9vbU1heCcsICdtb3ZlYWJsZScsICd6b29tYWJsZScsICdhY3RpdmF0ZScsICdoaWRkZW5EYXRlcyddOwogICAgICB1dGlsLnNlbGVjdGl2ZUV4dGVuZChmaWVsZHMsIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CgogICAgICBpZiAoJ3N0YXJ0JyBpbiBvcHRpb25zIHx8ICdlbmQnIGluIG9wdGlvbnMpIHsKICAgICAgICAvLyBhcHBseSBhIG5ldyByYW5nZS4gYm90aCBzdGFydCBhbmQgZW5kIGFyZSBvcHRpb25hbAogICAgICAgIHRoaXMuc2V0UmFuZ2Uob3B0aW9ucy5zdGFydCwgb3B0aW9ucy5lbmQpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogVGVzdCB3aGV0aGVyIGRpcmVjdGlvbiBoYXMgYSB2YWxpZCB2YWx1ZQogICAqIEBwYXJhbSB7U3RyaW5nfSBkaXJlY3Rpb24gICAgJ2hvcml6b250YWwnIG9yICd2ZXJ0aWNhbCcKICAgKi8KICBmdW5jdGlvbiB2YWxpZGF0ZURpcmVjdGlvbihkaXJlY3Rpb24pIHsKICAgIGlmIChkaXJlY3Rpb24gIT0gJ2hvcml6b250YWwnICYmIGRpcmVjdGlvbiAhPSAndmVydGljYWwnKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1Vua25vd24gZGlyZWN0aW9uICInICsgZGlyZWN0aW9uICsgJyIuICcgKyAnQ2hvb3NlICJob3Jpem9udGFsIiBvciAidmVydGljYWwiLicpOwogICAgfQogIH0KCiAgLyoqCiAgICogU2V0IGEgbmV3IHN0YXJ0IGFuZCBlbmQgcmFuZ2UKICAgKiBAcGFyYW0ge0RhdGUgfCBOdW1iZXIgfCBTdHJpbmd9IFtzdGFydF0KICAgKiBAcGFyYW0ge0RhdGUgfCBOdW1iZXIgfCBTdHJpbmd9IFtlbmRdCiAgICogQHBhcmFtIHtib29sZWFuIHwge2R1cmF0aW9uOiBudW1iZXIsIGVhc2luZ0Z1bmN0aW9uOiBzdHJpbmd9fSBbYW5pbWF0aW9uPWZhbHNlXQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgdHJ1ZSAoZGVmYXVsdCksIHRoZSByYW5nZSBpcyBhbmltYXRlZAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc21vb3RobHkgdG8gdGhlIG5ldyB3aW5kb3cuIEFuIG9iamVjdCBjYW4gYmUKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVkIHRvIHNwZWNpZnkgZHVyYXRpb24gYW5kIGVhc2luZyBmdW5jdGlvbi4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQgZHVyYXRpb24gaXMgNTAwIG1zLCBhbmQgZGVmYXVsdCBlYXNpbmcKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGlzICdlYXNlSW5PdXRRdWFkJy4KICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtieVVzZXI9ZmFsc2VdCiAgICoKICAgKi8KICBSYW5nZS5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCwgYW5pbWF0aW9uLCBieVVzZXIpIHsKICAgIGlmIChieVVzZXIgIT09IHRydWUpIHsKICAgICAgYnlVc2VyID0gZmFsc2U7CiAgICB9CiAgICB2YXIgZmluYWxTdGFydCA9IHN0YXJ0ICE9IHVuZGVmaW5lZCA/IHV0aWwuY29udmVydChzdGFydCwgJ0RhdGUnKS52YWx1ZU9mKCkgOiBudWxsOwogICAgdmFyIGZpbmFsRW5kID0gZW5kICE9IHVuZGVmaW5lZCA/IHV0aWwuY29udmVydChlbmQsICdEYXRlJykudmFsdWVPZigpIDogbnVsbDsKICAgIHRoaXMuX2NhbmNlbEFuaW1hdGlvbigpOwoKICAgIGlmIChhbmltYXRpb24pIHsKICAgICAgLy8gdHJ1ZSBvciBhbiBPYmplY3QKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGluaXRTdGFydCA9IHRoaXMuc3RhcnQ7CiAgICAgIHZhciBpbml0RW5kID0gdGhpcy5lbmQ7CiAgICAgIHZhciBkdXJhdGlvbiA9IHR5cGVvZiBhbmltYXRpb24gPT09ICdvYmplY3QnICYmICdkdXJhdGlvbicgaW4gYW5pbWF0aW9uID8gYW5pbWF0aW9uLmR1cmF0aW9uIDogNTAwOwogICAgICB2YXIgZWFzaW5nTmFtZSA9IHR5cGVvZiBhbmltYXRpb24gPT09ICdvYmplY3QnICYmICdlYXNpbmdGdW5jdGlvbicgaW4gYW5pbWF0aW9uID8gYW5pbWF0aW9uLmVhc2luZ0Z1bmN0aW9uIDogJ2Vhc2VJbk91dFF1YWQnOwogICAgICB2YXIgZWFzaW5nRnVuY3Rpb24gPSB1dGlsLmVhc2luZ0Z1bmN0aW9uc1tlYXNpbmdOYW1lXTsKICAgICAgaWYgKCFlYXNpbmdGdW5jdGlvbikgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVW5rbm93biBlYXNpbmcgZnVuY3Rpb24gJyArIEpTT04uc3RyaW5naWZ5KGVhc2luZ05hbWUpICsgJy4gJyArICdDaG9vc2UgZnJvbTogJyArIE9iamVjdC5rZXlzKHV0aWwuZWFzaW5nRnVuY3Rpb25zKS5qb2luKCcsICcpKTsKICAgICAgfQoKICAgICAgdmFyIGluaXRUaW1lID0gbmV3IERhdGUoKS52YWx1ZU9mKCk7CiAgICAgIHZhciBhbnlDaGFuZ2VkID0gZmFsc2U7CgogICAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICAgaWYgKCFtZS5wcm9wcy50b3VjaC5kcmFnZ2luZykgewogICAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkudmFsdWVPZigpOwogICAgICAgICAgdmFyIHRpbWUgPSBub3cgLSBpbml0VGltZTsKICAgICAgICAgIHZhciBlYXNlID0gZWFzaW5nRnVuY3Rpb24odGltZSAvIGR1cmF0aW9uKTsKICAgICAgICAgIHZhciBkb25lID0gdGltZSA+IGR1cmF0aW9uOwogICAgICAgICAgdmFyIHMgPSBkb25lIHx8IGZpbmFsU3RhcnQgPT09IG51bGwgPyBmaW5hbFN0YXJ0IDogaW5pdFN0YXJ0ICsgKGZpbmFsU3RhcnQgLSBpbml0U3RhcnQpICogZWFzZTsKICAgICAgICAgIHZhciBlID0gZG9uZSB8fCBmaW5hbEVuZCA9PT0gbnVsbCA/IGZpbmFsRW5kIDogaW5pdEVuZCArIChmaW5hbEVuZCAtIGluaXRFbmQpICogZWFzZTsKCiAgICAgICAgICBjaGFuZ2VkID0gbWUuX2FwcGx5UmFuZ2UocywgZSk7CiAgICAgICAgICBEYXRlVXRpbC51cGRhdGVIaWRkZW5EYXRlcyhtZS5ib2R5LCBtZS5vcHRpb25zLmhpZGRlbkRhdGVzKTsKICAgICAgICAgIGFueUNoYW5nZWQgPSBhbnlDaGFuZ2VkIHx8IGNoYW5nZWQ7CiAgICAgICAgICBpZiAoY2hhbmdlZCkgewogICAgICAgICAgICBtZS5ib2R5LmVtaXR0ZXIuZW1pdCgncmFuZ2VjaGFuZ2UnLCB7IHN0YXJ0OiBuZXcgRGF0ZShtZS5zdGFydCksIGVuZDogbmV3IERhdGUobWUuZW5kKSwgYnlVc2VyOiBieVVzZXIgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgaWYgKGFueUNoYW5nZWQpIHsKICAgICAgICAgICAgICBtZS5ib2R5LmVtaXR0ZXIuZW1pdCgncmFuZ2VjaGFuZ2VkJywgeyBzdGFydDogbmV3IERhdGUobWUuc3RhcnQpLCBlbmQ6IG5ldyBEYXRlKG1lLmVuZCksIGJ5VXNlcjogYnlVc2VyIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBhbmltYXRlIHdpdGggYXMgaGlnaCBhcyBwb3NzaWJsZSBmcmFtZSByYXRlLCBsZWF2ZSAyMCBtcyBpbiBiZXR3ZWVuCiAgICAgICAgICAgIC8vIGVhY2ggdG8gcHJldmVudCB0aGUgYnJvd3NlciBmcm9tIGJsb2NraW5nCiAgICAgICAgICAgIG1lLmFuaW1hdGlvblRpbWVyID0gc2V0VGltZW91dChuZXh0LCAyMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwoKICAgICAgcmV0dXJuIG5leHQoKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBjaGFuZ2VkID0gdGhpcy5fYXBwbHlSYW5nZShmaW5hbFN0YXJ0LCBmaW5hbEVuZCk7CiAgICAgIERhdGVVdGlsLnVwZGF0ZUhpZGRlbkRhdGVzKHRoaXMuYm9keSwgdGhpcy5vcHRpb25zLmhpZGRlbkRhdGVzKTsKICAgICAgaWYgKGNoYW5nZWQpIHsKICAgICAgICB2YXIgcGFyYW1zID0geyBzdGFydDogbmV3IERhdGUodGhpcy5zdGFydCksIGVuZDogbmV3IERhdGUodGhpcy5lbmQpLCBieVVzZXI6IGJ5VXNlciB9OwogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ3JhbmdlY2hhbmdlJywgcGFyYW1zKTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdyYW5nZWNoYW5nZWQnLCBwYXJhbXMpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU3RvcCBhbiBhbmltYXRpb24KICAgKiBAcHJpdmF0ZQogICAqLwogIFJhbmdlLnByb3RvdHlwZS5fY2FuY2VsQW5pbWF0aW9uID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuYW5pbWF0aW9uVGltZXIpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuYW5pbWF0aW9uVGltZXIpOwogICAgICB0aGlzLmFuaW1hdGlvblRpbWVyID0gbnVsbDsKICAgIH0KICB9OwoKICAvKioKICAgKiBTZXQgYSBuZXcgc3RhcnQgYW5kIGVuZCByYW5nZS4gVGhpcyBtZXRob2QgaXMgdGhlIHNhbWUgYXMgc2V0UmFuZ2UsIGJ1dAogICAqIGRvZXMgbm90IHRyaWdnZXIgYSByYW5nZSBjaGFuZ2UgYW5kIHJhbmdlIGNoYW5nZWQgZXZlbnQsIGFuZCBpdCByZXR1cm5zCiAgICogdHJ1ZSB3aGVuIHRoZSByYW5nZSBpcyBjaGFuZ2VkCiAgICogQHBhcmFtIHtOdW1iZXJ9IFtzdGFydF0KICAgKiBAcGFyYW0ge051bWJlcn0gW2VuZF0KICAgKiBAcmV0dXJuIHtCb29sZWFufSBjaGFuZ2VkCiAgICogQHByaXZhdGUKICAgKi8KICBSYW5nZS5wcm90b3R5cGUuX2FwcGx5UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewogICAgdmFyIG5ld1N0YXJ0ID0gc3RhcnQgIT0gbnVsbCA/IHV0aWwuY29udmVydChzdGFydCwgJ0RhdGUnKS52YWx1ZU9mKCkgOiB0aGlzLnN0YXJ0LAogICAgICAgIG5ld0VuZCA9IGVuZCAhPSBudWxsID8gdXRpbC5jb252ZXJ0KGVuZCwgJ0RhdGUnKS52YWx1ZU9mKCkgOiB0aGlzLmVuZCwKICAgICAgICBtYXggPSB0aGlzLm9wdGlvbnMubWF4ICE9IG51bGwgPyB1dGlsLmNvbnZlcnQodGhpcy5vcHRpb25zLm1heCwgJ0RhdGUnKS52YWx1ZU9mKCkgOiBudWxsLAogICAgICAgIG1pbiA9IHRoaXMub3B0aW9ucy5taW4gIT0gbnVsbCA/IHV0aWwuY29udmVydCh0aGlzLm9wdGlvbnMubWluLCAnRGF0ZScpLnZhbHVlT2YoKSA6IG51bGwsCiAgICAgICAgZGlmZjsKCiAgICAvLyBjaGVjayBmb3IgdmFsaWQgbnVtYmVyCiAgICBpZiAoaXNOYU4obmV3U3RhcnQpIHx8IG5ld1N0YXJ0ID09PSBudWxsKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBzdGFydCAiJyArIHN0YXJ0ICsgJyInKTsKICAgIH0KICAgIGlmIChpc05hTihuZXdFbmQpIHx8IG5ld0VuZCA9PT0gbnVsbCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW5kICInICsgZW5kICsgJyInKTsKICAgIH0KCiAgICAvLyBwcmV2ZW50IHN0YXJ0IDwgZW5kCiAgICBpZiAobmV3RW5kIDwgbmV3U3RhcnQpIHsKICAgICAgbmV3RW5kID0gbmV3U3RhcnQ7CiAgICB9CgogICAgLy8gcHJldmVudCBzdGFydCA8IG1pbgogICAgaWYgKG1pbiAhPT0gbnVsbCkgewogICAgICBpZiAobmV3U3RhcnQgPCBtaW4pIHsKICAgICAgICBkaWZmID0gbWluIC0gbmV3U3RhcnQ7CiAgICAgICAgbmV3U3RhcnQgKz0gZGlmZjsKICAgICAgICBuZXdFbmQgKz0gZGlmZjsKCiAgICAgICAgLy8gcHJldmVudCBlbmQgPiBtYXgKICAgICAgICBpZiAobWF4ICE9IG51bGwpIHsKICAgICAgICAgIGlmIChuZXdFbmQgPiBtYXgpIHsKICAgICAgICAgICAgbmV3RW5kID0gbWF4OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8vIHByZXZlbnQgZW5kID4gbWF4CiAgICBpZiAobWF4ICE9PSBudWxsKSB7CiAgICAgIGlmIChuZXdFbmQgPiBtYXgpIHsKICAgICAgICBkaWZmID0gbmV3RW5kIC0gbWF4OwogICAgICAgIG5ld1N0YXJ0IC09IGRpZmY7CiAgICAgICAgbmV3RW5kIC09IGRpZmY7CgogICAgICAgIC8vIHByZXZlbnQgc3RhcnQgPCBtaW4KICAgICAgICBpZiAobWluICE9IG51bGwpIHsKICAgICAgICAgIGlmIChuZXdTdGFydCA8IG1pbikgewogICAgICAgICAgICBuZXdTdGFydCA9IG1pbjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBwcmV2ZW50IChlbmQtc3RhcnQpIDwgem9vbU1pbgogICAgaWYgKHRoaXMub3B0aW9ucy56b29tTWluICE9PSBudWxsKSB7CiAgICAgIHZhciB6b29tTWluID0gcGFyc2VGbG9hdCh0aGlzLm9wdGlvbnMuem9vbU1pbik7CiAgICAgIGlmICh6b29tTWluIDwgMCkgewogICAgICAgIHpvb21NaW4gPSAwOwogICAgICB9CiAgICAgIGlmIChuZXdFbmQgLSBuZXdTdGFydCA8IHpvb21NaW4pIHsKICAgICAgICBpZiAodGhpcy5lbmQgLSB0aGlzLnN0YXJ0ID09PSB6b29tTWluICYmIG5ld1N0YXJ0ID4gdGhpcy5zdGFydCAmJiBuZXdFbmQgPCB0aGlzLmVuZCkgewogICAgICAgICAgLy8gaWdub3JlIHRoaXMgYWN0aW9uLCB3ZSBhcmUgYWxyZWFkeSB6b29tZWQgdG8gdGhlIG1pbmltdW0KICAgICAgICAgIG5ld1N0YXJ0ID0gdGhpcy5zdGFydDsKICAgICAgICAgIG5ld0VuZCA9IHRoaXMuZW5kOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyB6b29tIHRvIHRoZSBtaW5pbXVtCiAgICAgICAgICBkaWZmID0gem9vbU1pbiAtIChuZXdFbmQgLSBuZXdTdGFydCk7CiAgICAgICAgICBuZXdTdGFydCAtPSBkaWZmIC8gMjsKICAgICAgICAgIG5ld0VuZCArPSBkaWZmIC8gMjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBwcmV2ZW50IChlbmQtc3RhcnQpID4gem9vbU1heAogICAgaWYgKHRoaXMub3B0aW9ucy56b29tTWF4ICE9PSBudWxsKSB7CiAgICAgIHZhciB6b29tTWF4ID0gcGFyc2VGbG9hdCh0aGlzLm9wdGlvbnMuem9vbU1heCk7CiAgICAgIGlmICh6b29tTWF4IDwgMCkgewogICAgICAgIHpvb21NYXggPSAwOwogICAgICB9CgogICAgICBpZiAobmV3RW5kIC0gbmV3U3RhcnQgPiB6b29tTWF4KSB7CiAgICAgICAgaWYgKHRoaXMuZW5kIC0gdGhpcy5zdGFydCA9PT0gem9vbU1heCAmJiBuZXdTdGFydCA8IHRoaXMuc3RhcnQgJiYgbmV3RW5kID4gdGhpcy5lbmQpIHsKICAgICAgICAgIC8vIGlnbm9yZSB0aGlzIGFjdGlvbiwgd2UgYXJlIGFscmVhZHkgem9vbWVkIHRvIHRoZSBtYXhpbXVtCiAgICAgICAgICBuZXdTdGFydCA9IHRoaXMuc3RhcnQ7CiAgICAgICAgICBuZXdFbmQgPSB0aGlzLmVuZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gem9vbSB0byB0aGUgbWF4aW11bQogICAgICAgICAgZGlmZiA9IG5ld0VuZCAtIG5ld1N0YXJ0IC0gem9vbU1heDsKICAgICAgICAgIG5ld1N0YXJ0ICs9IGRpZmYgLyAyOwogICAgICAgICAgbmV3RW5kIC09IGRpZmYgLyAyOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHZhciBjaGFuZ2VkID0gdGhpcy5zdGFydCAhPSBuZXdTdGFydCB8fCB0aGlzLmVuZCAhPSBuZXdFbmQ7CgogICAgLy8gaWYgdGhlIG5ldyByYW5nZSBkb2VzIE5PVCBvdmVybGFwIHdpdGggdGhlIG9sZCByYW5nZSwgZW1pdCBjaGVja1JhbmdlZEl0ZW1zIHRvIGF2b2lkIG5vdCBzaG93aW5nIHJhbmdlZCBpdGVtcyAocmFuZ2VkIG1lYW5pbmcgaGFzIGVuZCB0aW1lLCBub3QgbmVjZXNzYXJpbHkgb2YgdHlwZSBSYW5nZSkKICAgIGlmICghKG5ld1N0YXJ0ID49IHRoaXMuc3RhcnQgJiYgbmV3U3RhcnQgPD0gdGhpcy5lbmQgfHwgbmV3RW5kID49IHRoaXMuc3RhcnQgJiYgbmV3RW5kIDw9IHRoaXMuZW5kKSAmJiAhKHRoaXMuc3RhcnQgPj0gbmV3U3RhcnQgJiYgdGhpcy5zdGFydCA8PSBuZXdFbmQgfHwgdGhpcy5lbmQgPj0gbmV3U3RhcnQgJiYgdGhpcy5lbmQgPD0gbmV3RW5kKSkgewogICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdjaGVja1JhbmdlZEl0ZW1zJyk7CiAgICB9CgogICAgdGhpcy5zdGFydCA9IG5ld1N0YXJ0OwogICAgdGhpcy5lbmQgPSBuZXdFbmQ7CiAgICByZXR1cm4gY2hhbmdlZDsKICB9OwoKICAvKioKICAgKiBSZXRyaWV2ZSB0aGUgY3VycmVudCByYW5nZS4KICAgKiBAcmV0dXJuIHtPYmplY3R9IEFuIG9iamVjdCB3aXRoIHN0YXJ0IGFuZCBlbmQgcHJvcGVydGllcwogICAqLwogIFJhbmdlLnByb3RvdHlwZS5nZXRSYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgIHN0YXJ0OiB0aGlzLnN0YXJ0LAogICAgICBlbmQ6IHRoaXMuZW5kCiAgICB9OwogIH07CgogIC8qKgogICAqIENhbGN1bGF0ZSB0aGUgY29udmVyc2lvbiBvZmZzZXQgYW5kIHNjYWxlIGZvciBjdXJyZW50IHJhbmdlLCBiYXNlZCBvbgogICAqIHRoZSBwcm92aWRlZCB3aWR0aAogICAqIEBwYXJhbSB7TnVtYmVyfSB3aWR0aAogICAqIEByZXR1cm5zIHt7b2Zmc2V0OiBudW1iZXIsIHNjYWxlOiBudW1iZXJ9fSBjb252ZXJzaW9uCiAgICovCiAgUmFuZ2UucHJvdG90eXBlLmNvbnZlcnNpb24gPSBmdW5jdGlvbiAod2lkdGgsIHRvdGFsSGlkZGVuKSB7CiAgICByZXR1cm4gUmFuZ2UuY29udmVyc2lvbih0aGlzLnN0YXJ0LCB0aGlzLmVuZCwgd2lkdGgsIHRvdGFsSGlkZGVuKTsKICB9OwoKICAvKioKICAgKiBTdGF0aWMgbWV0aG9kIHRvIGNhbGN1bGF0ZSB0aGUgY29udmVyc2lvbiBvZmZzZXQgYW5kIHNjYWxlIGZvciBhIHJhbmdlLAogICAqIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBzdGFydCwgZW5kLCBhbmQgd2lkdGgKICAgKiBAcGFyYW0ge051bWJlcn0gc3RhcnQKICAgKiBAcGFyYW0ge051bWJlcn0gZW5kCiAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoCiAgICogQHJldHVybnMge3tvZmZzZXQ6IG51bWJlciwgc2NhbGU6IG51bWJlcn19IGNvbnZlcnNpb24KICAgKi8KICBSYW5nZS5jb252ZXJzaW9uID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIHdpZHRoLCB0b3RhbEhpZGRlbikgewogICAgaWYgKHRvdGFsSGlkZGVuID09PSB1bmRlZmluZWQpIHsKICAgICAgdG90YWxIaWRkZW4gPSAwOwogICAgfQogICAgaWYgKHdpZHRoICE9IDAgJiYgZW5kIC0gc3RhcnQgIT0gMCkgewogICAgICByZXR1cm4gewogICAgICAgIG9mZnNldDogc3RhcnQsCiAgICAgICAgc2NhbGU6IHdpZHRoIC8gKGVuZCAtIHN0YXJ0IC0gdG90YWxIaWRkZW4pCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gewogICAgICAgIG9mZnNldDogMCwKICAgICAgICBzY2FsZTogMQogICAgICB9OwogICAgfQogIH07CgogIC8qKgogICAqIFN0YXJ0IGRyYWdnaW5nIGhvcml6b250YWxseSBvciB2ZXJ0aWNhbGx5CiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIFJhbmdlLnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHRoaXMuZGVsdGFEaWZmZXJlbmNlID0gMDsKICAgIHRoaXMucHJldmlvdXNEZWx0YSA9IDA7CiAgICAvLyBvbmx5IGFsbG93IGRyYWdnaW5nIHdoZW4gY29uZmlndXJlZCBhcyBtb3ZhYmxlCiAgICBpZiAoIXRoaXMub3B0aW9ucy5tb3ZlYWJsZSkgcmV0dXJuOwoKICAgIC8vIHJlZnVzZSB0byBkcmFnIHdoZW4gd2Ugd2hlcmUgcGluY2hpbmcgdG8gcHJldmVudCB0aGUgdGltZWxpbmUgbWFrZSBhIGp1bXAKICAgIC8vIHdoZW4gcmVsZWFzaW5nIHRoZSBmaW5nZXJzIGluIG9wcG9zaXRlIG9yZGVyIGZyb20gdGhlIHRvdWNoIHNjcmVlbgogICAgaWYgKCF0aGlzLnByb3BzLnRvdWNoLmFsbG93RHJhZ2dpbmcpIHJldHVybjsKCiAgICB0aGlzLnByb3BzLnRvdWNoLnN0YXJ0ID0gdGhpcy5zdGFydDsKICAgIHRoaXMucHJvcHMudG91Y2guZW5kID0gdGhpcy5lbmQ7CiAgICB0aGlzLnByb3BzLnRvdWNoLmRyYWdnaW5nID0gdHJ1ZTsKCiAgICBpZiAodGhpcy5ib2R5LmRvbS5yb290KSB7CiAgICAgIHRoaXMuYm9keS5kb20ucm9vdC5zdHlsZS5jdXJzb3IgPSAnbW92ZSc7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUGVyZm9ybSBkcmFnZ2luZyBvcGVyYXRpb24KICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudAogICAqIEBwcml2YXRlCiAgICovCiAgUmFuZ2UucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIC8vIG9ubHkgYWxsb3cgZHJhZ2dpbmcgd2hlbiBjb25maWd1cmVkIGFzIG1vdmFibGUKICAgIGlmICghdGhpcy5vcHRpb25zLm1vdmVhYmxlKSByZXR1cm47CgogICAgLy8gVE9ETzogdGhpcyBtYXkgYmUgcmVkdW5kYW50IGluIGhhbW1lcmpzMgogICAgLy8gcmVmdXNlIHRvIGRyYWcgd2hlbiB3ZSB3aGVyZSBwaW5jaGluZyB0byBwcmV2ZW50IHRoZSB0aW1lbGluZSBtYWtlIGEganVtcAogICAgLy8gd2hlbiByZWxlYXNpbmcgdGhlIGZpbmdlcnMgaW4gb3Bwb3NpdGUgb3JkZXIgZnJvbSB0aGUgdG91Y2ggc2NyZWVuCiAgICBpZiAoIXRoaXMucHJvcHMudG91Y2guYWxsb3dEcmFnZ2luZykgcmV0dXJuOwoKICAgIHZhciBkaXJlY3Rpb24gPSB0aGlzLm9wdGlvbnMuZGlyZWN0aW9uOwogICAgdmFsaWRhdGVEaXJlY3Rpb24oZGlyZWN0aW9uKTsKICAgIHZhciBkZWx0YSA9IGRpcmVjdGlvbiA9PSAnaG9yaXpvbnRhbCcgPyBldmVudC5kZWx0YVggOiBldmVudC5kZWx0YVk7CiAgICBkZWx0YSAtPSB0aGlzLmRlbHRhRGlmZmVyZW5jZTsKICAgIHZhciBpbnRlcnZhbCA9IHRoaXMucHJvcHMudG91Y2guZW5kIC0gdGhpcy5wcm9wcy50b3VjaC5zdGFydDsKCiAgICAvLyBub3JtYWxpemUgZHJhZ2dpbmcgc3BlZWQgaWYgY3V0b3V0IGlzIGluIGJldHdlZW4uCiAgICB2YXIgZHVyYXRpb24gPSBEYXRlVXRpbC5nZXRIaWRkZW5EdXJhdGlvbkJldHdlZW4odGhpcy5ib2R5LmhpZGRlbkRhdGVzLCB0aGlzLnN0YXJ0LCB0aGlzLmVuZCk7CiAgICBpbnRlcnZhbCAtPSBkdXJhdGlvbjsKCiAgICB2YXIgd2lkdGggPSBkaXJlY3Rpb24gPT0gJ2hvcml6b250YWwnID8gdGhpcy5ib2R5LmRvbVByb3BzLmNlbnRlci53aWR0aCA6IHRoaXMuYm9keS5kb21Qcm9wcy5jZW50ZXIuaGVpZ2h0OwogICAgdmFyIGRpZmZSYW5nZSA9IC1kZWx0YSAvIHdpZHRoICogaW50ZXJ2YWw7CiAgICB2YXIgbmV3U3RhcnQgPSB0aGlzLnByb3BzLnRvdWNoLnN0YXJ0ICsgZGlmZlJhbmdlOwogICAgdmFyIG5ld0VuZCA9IHRoaXMucHJvcHMudG91Y2guZW5kICsgZGlmZlJhbmdlOwoKICAgIC8vIHNuYXBwaW5nIHRpbWVzIGF3YXkgZnJvbSBoaWRkZW4gem9uZXMKICAgIHZhciBzYWZlU3RhcnQgPSBEYXRlVXRpbC5zbmFwQXdheUZyb21IaWRkZW4odGhpcy5ib2R5LmhpZGRlbkRhdGVzLCBuZXdTdGFydCwgdGhpcy5wcmV2aW91c0RlbHRhIC0gZGVsdGEsIHRydWUpOwogICAgdmFyIHNhZmVFbmQgPSBEYXRlVXRpbC5zbmFwQXdheUZyb21IaWRkZW4odGhpcy5ib2R5LmhpZGRlbkRhdGVzLCBuZXdFbmQsIHRoaXMucHJldmlvdXNEZWx0YSAtIGRlbHRhLCB0cnVlKTsKICAgIGlmIChzYWZlU3RhcnQgIT0gbmV3U3RhcnQgfHwgc2FmZUVuZCAhPSBuZXdFbmQpIHsKICAgICAgdGhpcy5kZWx0YURpZmZlcmVuY2UgKz0gZGVsdGE7CiAgICAgIHRoaXMucHJvcHMudG91Y2guc3RhcnQgPSBzYWZlU3RhcnQ7CiAgICAgIHRoaXMucHJvcHMudG91Y2guZW5kID0gc2FmZUVuZDsKICAgICAgdGhpcy5fb25EcmFnKGV2ZW50KTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRoaXMucHJldmlvdXNEZWx0YSA9IGRlbHRhOwogICAgdGhpcy5fYXBwbHlSYW5nZShuZXdTdGFydCwgbmV3RW5kKTsKCiAgICAvLyBmaXJlIGEgcmFuZ2VjaGFuZ2UgZXZlbnQKICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ3JhbmdlY2hhbmdlJywgewogICAgICBzdGFydDogbmV3IERhdGUodGhpcy5zdGFydCksCiAgICAgIGVuZDogbmV3IERhdGUodGhpcy5lbmQpLAogICAgICBieVVzZXI6IHRydWUKICAgIH0pOwogIH07CgogIC8qKgogICAqIFN0b3AgZHJhZ2dpbmcgb3BlcmF0aW9uCiAgICogQHBhcmFtIHtldmVudH0gZXZlbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIFJhbmdlLnByb3RvdHlwZS5fb25EcmFnRW5kID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAvLyBvbmx5IGFsbG93IGRyYWdnaW5nIHdoZW4gY29uZmlndXJlZCBhcyBtb3ZhYmxlCiAgICBpZiAoIXRoaXMub3B0aW9ucy5tb3ZlYWJsZSkgcmV0dXJuOwoKICAgIC8vIFRPRE86IHRoaXMgbWF5IGJlIHJlZHVuZGFudCBpbiBoYW1tZXJqczIKICAgIC8vIHJlZnVzZSB0byBkcmFnIHdoZW4gd2Ugd2hlcmUgcGluY2hpbmcgdG8gcHJldmVudCB0aGUgdGltZWxpbmUgbWFrZSBhIGp1bXAKICAgIC8vIHdoZW4gcmVsZWFzaW5nIHRoZSBmaW5nZXJzIGluIG9wcG9zaXRlIG9yZGVyIGZyb20gdGhlIHRvdWNoIHNjcmVlbgogICAgaWYgKCF0aGlzLnByb3BzLnRvdWNoLmFsbG93RHJhZ2dpbmcpIHJldHVybjsKCiAgICB0aGlzLnByb3BzLnRvdWNoLmRyYWdnaW5nID0gZmFsc2U7CiAgICBpZiAodGhpcy5ib2R5LmRvbS5yb290KSB7CiAgICAgIHRoaXMuYm9keS5kb20ucm9vdC5zdHlsZS5jdXJzb3IgPSAnYXV0byc7CiAgICB9CgogICAgLy8gZmlyZSBhIHJhbmdlY2hhbmdlZCBldmVudAogICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgncmFuZ2VjaGFuZ2VkJywgewogICAgICBzdGFydDogbmV3IERhdGUodGhpcy5zdGFydCksCiAgICAgIGVuZDogbmV3IERhdGUodGhpcy5lbmQpLAogICAgICBieVVzZXI6IHRydWUKICAgIH0pOwogIH07CgogIC8qKgogICAqIEV2ZW50IGhhbmRsZXIgZm9yIG1vdXNlIHdoZWVsIGV2ZW50LCB1c2VkIHRvIHpvb20KICAgKiBDb2RlIGZyb20gaHR0cDovL2Fkb21hcy5vcmcvamF2YXNjcmlwdC1tb3VzZS13aGVlbC8KICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudAogICAqIEBwcml2YXRlCiAgICovCiAgUmFuZ2UucHJvdG90eXBlLl9vbk1vdXNlV2hlZWwgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIC8vIG9ubHkgYWxsb3cgem9vbWluZyB3aGVuIGNvbmZpZ3VyZWQgYXMgem9vbWFibGUgYW5kIG1vdmVhYmxlCiAgICBpZiAoISh0aGlzLm9wdGlvbnMuem9vbWFibGUgJiYgdGhpcy5vcHRpb25zLm1vdmVhYmxlKSkgcmV0dXJuOwoKICAgIC8vIHJldHJpZXZlIGRlbHRhCiAgICB2YXIgZGVsdGEgPSAwOwogICAgaWYgKGV2ZW50LndoZWVsRGVsdGEpIHsKICAgICAgLyogSUUvT3BlcmEuICovCiAgICAgIGRlbHRhID0gZXZlbnQud2hlZWxEZWx0YSAvIDEyMDsKICAgIH0gZWxzZSBpZiAoZXZlbnQuZGV0YWlsKSB7CiAgICAgIC8qIE1vemlsbGEgY2FzZS4gKi8KICAgICAgLy8gSW4gTW96aWxsYSwgc2lnbiBvZiBkZWx0YSBpcyBkaWZmZXJlbnQgdGhhbiBpbiBJRS4KICAgICAgLy8gQWxzbywgZGVsdGEgaXMgbXVsdGlwbGUgb2YgMy4KICAgICAgZGVsdGEgPSAtZXZlbnQuZGV0YWlsIC8gMzsKICAgIH0KCiAgICAvLyBJZiBkZWx0YSBpcyBub256ZXJvLCBoYW5kbGUgaXQuCiAgICAvLyBCYXNpY2FsbHksIGRlbHRhIGlzIG5vdyBwb3NpdGl2ZSBpZiB3aGVlbCB3YXMgc2Nyb2xsZWQgdXAsCiAgICAvLyBhbmQgbmVnYXRpdmUsIGlmIHdoZWVsIHdhcyBzY3JvbGxlZCBkb3duLgogICAgaWYgKGRlbHRhKSB7CiAgICAgIC8vIHBlcmZvcm0gdGhlIHpvb20gYWN0aW9uLiBEZWx0YSBpcyBub3JtYWxseSAxIG9yIC0xCgogICAgICAvLyBhZGp1c3QgYSBuZWdhdGl2ZSBkZWx0YSBzdWNoIHRoYXQgem9vbWluZyBpbiB3aXRoIGRlbHRhIDAuMQogICAgICAvLyBlcXVhbHMgem9vbWluZyBvdXQgd2l0aCBhIGRlbHRhIC0wLjEKICAgICAgdmFyIHNjYWxlOwogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgc2NhbGUgPSAxIC0gZGVsdGEgLyA1OwogICAgICB9IGVsc2UgewogICAgICAgIHNjYWxlID0gMSAvICgxICsgZGVsdGEgLyA1KTsKICAgICAgfQoKICAgICAgLy8gY2FsY3VsYXRlIGNlbnRlciwgdGhlIGRhdGUgdG8gem9vbSBhcm91bmQKICAgICAgdmFyIHBvaW50ZXIgPSBnZXRQb2ludGVyKHsgeDogZXZlbnQuY2xpZW50WCwgeTogZXZlbnQuY2xpZW50WSB9LCB0aGlzLmJvZHkuZG9tLmNlbnRlcik7CiAgICAgIHZhciBwb2ludGVyRGF0ZSA9IHRoaXMuX3BvaW50ZXJUb0RhdGUocG9pbnRlcik7CgogICAgICB0aGlzLnpvb20oc2NhbGUsIHBvaW50ZXJEYXRlLCBkZWx0YSk7CiAgICB9CgogICAgLy8gUHJldmVudCBkZWZhdWx0IGFjdGlvbnMgY2F1c2VkIGJ5IG1vdXNlIHdoZWVsCiAgICAvLyAoZWxzZSB0aGUgcGFnZSBhbmQgdGltZWxpbmUgYm90aCB6b29tIGFuZCBzY3JvbGwpCiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogIH07CgogIC8qKgogICAqIFN0YXJ0IG9mIGEgdG91Y2ggZ2VzdHVyZQogICAqIEBwcml2YXRlCiAgICovCiAgUmFuZ2UucHJvdG90eXBlLl9vblRvdWNoID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICB0aGlzLnByb3BzLnRvdWNoLnN0YXJ0ID0gdGhpcy5zdGFydDsKICAgIHRoaXMucHJvcHMudG91Y2guZW5kID0gdGhpcy5lbmQ7CiAgICB0aGlzLnByb3BzLnRvdWNoLmFsbG93RHJhZ2dpbmcgPSB0cnVlOwogICAgdGhpcy5wcm9wcy50b3VjaC5jZW50ZXIgPSBudWxsOwogICAgdGhpcy5zY2FsZU9mZnNldCA9IDA7CiAgICB0aGlzLmRlbHRhRGlmZmVyZW5jZSA9IDA7CiAgfTsKCiAgLyoqCiAgICogSGFuZGxlIHBpbmNoIGV2ZW50CiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIFJhbmdlLnByb3RvdHlwZS5fb25QaW5jaCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgLy8gb25seSBhbGxvdyB6b29taW5nIHdoZW4gY29uZmlndXJlZCBhcyB6b29tYWJsZSBhbmQgbW92ZWFibGUKICAgIGlmICghKHRoaXMub3B0aW9ucy56b29tYWJsZSAmJiB0aGlzLm9wdGlvbnMubW92ZWFibGUpKSByZXR1cm47CgogICAgdGhpcy5wcm9wcy50b3VjaC5hbGxvd0RyYWdnaW5nID0gZmFsc2U7CgogICAgaWYgKCF0aGlzLnByb3BzLnRvdWNoLmNlbnRlcikgewogICAgICB0aGlzLnByb3BzLnRvdWNoLmNlbnRlciA9IGdldFBvaW50ZXIoZXZlbnQuY2VudGVyLCB0aGlzLmJvZHkuZG9tLmNlbnRlcik7CiAgICB9CgogICAgdmFyIHNjYWxlID0gMSAvIChldmVudC5zY2FsZSArIHRoaXMuc2NhbGVPZmZzZXQpOwogICAgdmFyIGNlbnRlckRhdGUgPSB0aGlzLl9wb2ludGVyVG9EYXRlKHRoaXMucHJvcHMudG91Y2guY2VudGVyKTsKCiAgICB2YXIgaGlkZGVuRHVyYXRpb24gPSBEYXRlVXRpbC5nZXRIaWRkZW5EdXJhdGlvbkJldHdlZW4odGhpcy5ib2R5LmhpZGRlbkRhdGVzLCB0aGlzLnN0YXJ0LCB0aGlzLmVuZCk7CiAgICB2YXIgaGlkZGVuRHVyYXRpb25CZWZvcmUgPSBEYXRlVXRpbC5nZXRIaWRkZW5EdXJhdGlvbkJlZm9yZSh0aGlzLmJvZHkuaGlkZGVuRGF0ZXMsIHRoaXMsIGNlbnRlckRhdGUpOwogICAgdmFyIGhpZGRlbkR1cmF0aW9uQWZ0ZXIgPSBoaWRkZW5EdXJhdGlvbiAtIGhpZGRlbkR1cmF0aW9uQmVmb3JlOwoKICAgIC8vIGNhbGN1bGF0ZSBuZXcgc3RhcnQgYW5kIGVuZAogICAgdmFyIG5ld1N0YXJ0ID0gY2VudGVyRGF0ZSAtIGhpZGRlbkR1cmF0aW9uQmVmb3JlICsgKHRoaXMucHJvcHMudG91Y2guc3RhcnQgLSAoY2VudGVyRGF0ZSAtIGhpZGRlbkR1cmF0aW9uQmVmb3JlKSkgKiBzY2FsZTsKICAgIHZhciBuZXdFbmQgPSBjZW50ZXJEYXRlICsgaGlkZGVuRHVyYXRpb25BZnRlciArICh0aGlzLnByb3BzLnRvdWNoLmVuZCAtIChjZW50ZXJEYXRlICsgaGlkZGVuRHVyYXRpb25BZnRlcikpICogc2NhbGU7CgogICAgLy8gc25hcHBpbmcgdGltZXMgYXdheSBmcm9tIGhpZGRlbiB6b25lcwogICAgdGhpcy5zdGFydFRvRnJvbnQgPSAxIC0gc2NhbGUgPD0gMDsgLy8gdXNlZCB0byBkbyB0aGUgcmlnaHQgYXV0byBjb3JyZWN0aW9uIHdpdGggcGVyaW9kaWMgaGlkZGVuIHRpbWVzCiAgICB0aGlzLmVuZFRvRnJvbnQgPSBzY2FsZSAtIDEgPD0gMDsgLy8gdXNlZCB0byBkbyB0aGUgcmlnaHQgYXV0byBjb3JyZWN0aW9uIHdpdGggcGVyaW9kaWMgaGlkZGVuIHRpbWVzCgogICAgdmFyIHNhZmVTdGFydCA9IERhdGVVdGlsLnNuYXBBd2F5RnJvbUhpZGRlbih0aGlzLmJvZHkuaGlkZGVuRGF0ZXMsIG5ld1N0YXJ0LCAxIC0gc2NhbGUsIHRydWUpOwogICAgdmFyIHNhZmVFbmQgPSBEYXRlVXRpbC5zbmFwQXdheUZyb21IaWRkZW4odGhpcy5ib2R5LmhpZGRlbkRhdGVzLCBuZXdFbmQsIHNjYWxlIC0gMSwgdHJ1ZSk7CiAgICBpZiAoc2FmZVN0YXJ0ICE9IG5ld1N0YXJ0IHx8IHNhZmVFbmQgIT0gbmV3RW5kKSB7CiAgICAgIHRoaXMucHJvcHMudG91Y2guc3RhcnQgPSBzYWZlU3RhcnQ7CiAgICAgIHRoaXMucHJvcHMudG91Y2guZW5kID0gc2FmZUVuZDsKICAgICAgdGhpcy5zY2FsZU9mZnNldCA9IDEgLSBldmVudC5zY2FsZTsKICAgICAgbmV3U3RhcnQgPSBzYWZlU3RhcnQ7CiAgICAgIG5ld0VuZCA9IHNhZmVFbmQ7CiAgICB9CgogICAgdGhpcy5zZXRSYW5nZShuZXdTdGFydCwgbmV3RW5kLCBmYWxzZSwgdHJ1ZSk7CgogICAgdGhpcy5zdGFydFRvRnJvbnQgPSBmYWxzZTsgLy8gcmV2ZXJ0IHRvIGRlZmF1bHQKICAgIHRoaXMuZW5kVG9Gcm9udCA9IHRydWU7IC8vIHJldmVydCB0byBkZWZhdWx0CiAgfTsKCiAgLyoqCiAgICogSGVscGVyIGZ1bmN0aW9uIHRvIGNhbGN1bGF0ZSB0aGUgY2VudGVyIGRhdGUgZm9yIHpvb21pbmcKICAgKiBAcGFyYW0ge3t4OiBOdW1iZXIsIHk6IE51bWJlcn19IHBvaW50ZXIKICAgKiBAcmV0dXJuIHtudW1iZXJ9IGRhdGUKICAgKiBAcHJpdmF0ZQogICAqLwogIFJhbmdlLnByb3RvdHlwZS5fcG9pbnRlclRvRGF0ZSA9IGZ1bmN0aW9uIChwb2ludGVyKSB7CiAgICB2YXIgY29udmVyc2lvbjsKICAgIHZhciBkaXJlY3Rpb24gPSB0aGlzLm9wdGlvbnMuZGlyZWN0aW9uOwoKICAgIHZhbGlkYXRlRGlyZWN0aW9uKGRpcmVjdGlvbik7CgogICAgaWYgKGRpcmVjdGlvbiA9PSAnaG9yaXpvbnRhbCcpIHsKICAgICAgcmV0dXJuIHRoaXMuYm9keS51dGlsLnRvVGltZShwb2ludGVyLngpLnZhbHVlT2YoKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmJvZHkuZG9tUHJvcHMuY2VudGVyLmhlaWdodDsKICAgICAgY29udmVyc2lvbiA9IHRoaXMuY29udmVyc2lvbihoZWlnaHQpOwogICAgICByZXR1cm4gcG9pbnRlci55IC8gY29udmVyc2lvbi5zY2FsZSArIGNvbnZlcnNpb24ub2Zmc2V0OwogICAgfQogIH07CgogIC8qKgogICAqIEdldCB0aGUgcG9pbnRlciBsb2NhdGlvbiByZWxhdGl2ZSB0byB0aGUgbG9jYXRpb24gb2YgdGhlIGRvbSBlbGVtZW50CiAgICogQHBhcmFtIHt7eDogTnVtYmVyLCB5OiBOdW1iZXJ9fSB0b3VjaAogICAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCAgIEhUTUwgRE9NIGVsZW1lbnQKICAgKiBAcmV0dXJuIHt7eDogTnVtYmVyLCB5OiBOdW1iZXJ9fSBwb2ludGVyCiAgICogQHByaXZhdGUKICAgKi8KICBmdW5jdGlvbiBnZXRQb2ludGVyKHRvdWNoLCBlbGVtZW50KSB7CiAgICByZXR1cm4gewogICAgICB4OiB0b3VjaC54IC0gdXRpbC5nZXRBYnNvbHV0ZUxlZnQoZWxlbWVudCksCiAgICAgIHk6IHRvdWNoLnkgLSB1dGlsLmdldEFic29sdXRlVG9wKGVsZW1lbnQpCiAgICB9OwogIH0KCiAgLyoqCiAgICogWm9vbSB0aGUgcmFuZ2UgdGhlIGdpdmVuIHNjYWxlIGluIG9yIG91dC4gU3RhcnQgYW5kIGVuZCBkYXRlIHdpbGwKICAgKiBiZSBhZGp1c3RlZCwgYW5kIHRoZSB0aW1lbGluZSB3aWxsIGJlIHJlZHJhd24uIFlvdSBjYW4gb3B0aW9uYWxseSBnaXZlIGEKICAgKiBkYXRlIGFyb3VuZCB3aGljaCB0byB6b29tLgogICAqIEZvciBleGFtcGxlLCB0cnkgc2NhbGUgPSAwLjkgb3IgMS4xCiAgICogQHBhcmFtIHtOdW1iZXJ9IHNjYWxlICAgICAgU2NhbGluZyBmYWN0b3IuIFZhbHVlcyBhYm92ZSAxIHdpbGwgem9vbSBvdXQsCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzIGJlbG93IDEgd2lsbCB6b29tIGluLgogICAqIEBwYXJhbSB7TnVtYmVyfSBbY2VudGVyXSAgIFZhbHVlIHJlcHJlc2VudGluZyBhIGRhdGUgYXJvdW5kIHdoaWNoIHdpbGwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZSB6b29tZWQuCiAgICovCiAgUmFuZ2UucHJvdG90eXBlLnpvb20gPSBmdW5jdGlvbiAoc2NhbGUsIGNlbnRlciwgZGVsdGEpIHsKICAgIC8vIGlmIGNlbnRlckRhdGUgaXMgbm90IHByb3ZpZGVkLCB0YWtlIGl0IGhhbGYgYmV0d2VlbiBzdGFydCBEYXRlIGFuZCBlbmQgRGF0ZQogICAgaWYgKGNlbnRlciA9PSBudWxsKSB7CiAgICAgIGNlbnRlciA9ICh0aGlzLnN0YXJ0ICsgdGhpcy5lbmQpIC8gMjsKICAgIH0KCiAgICB2YXIgaGlkZGVuRHVyYXRpb24gPSBEYXRlVXRpbC5nZXRIaWRkZW5EdXJhdGlvbkJldHdlZW4odGhpcy5ib2R5LmhpZGRlbkRhdGVzLCB0aGlzLnN0YXJ0LCB0aGlzLmVuZCk7CiAgICB2YXIgaGlkZGVuRHVyYXRpb25CZWZvcmUgPSBEYXRlVXRpbC5nZXRIaWRkZW5EdXJhdGlvbkJlZm9yZSh0aGlzLmJvZHkuaGlkZGVuRGF0ZXMsIHRoaXMsIGNlbnRlcik7CiAgICB2YXIgaGlkZGVuRHVyYXRpb25BZnRlciA9IGhpZGRlbkR1cmF0aW9uIC0gaGlkZGVuRHVyYXRpb25CZWZvcmU7CgogICAgLy8gY2FsY3VsYXRlIG5ldyBzdGFydCBhbmQgZW5kCiAgICB2YXIgbmV3U3RhcnQgPSBjZW50ZXIgLSBoaWRkZW5EdXJhdGlvbkJlZm9yZSArICh0aGlzLnN0YXJ0IC0gKGNlbnRlciAtIGhpZGRlbkR1cmF0aW9uQmVmb3JlKSkgKiBzY2FsZTsKICAgIHZhciBuZXdFbmQgPSBjZW50ZXIgKyBoaWRkZW5EdXJhdGlvbkFmdGVyICsgKHRoaXMuZW5kIC0gKGNlbnRlciArIGhpZGRlbkR1cmF0aW9uQWZ0ZXIpKSAqIHNjYWxlOwoKICAgIC8vIHNuYXBwaW5nIHRpbWVzIGF3YXkgZnJvbSBoaWRkZW4gem9uZXMKICAgIHRoaXMuc3RhcnRUb0Zyb250ID0gZGVsdGEgPiAwID8gZmFsc2UgOiB0cnVlOyAvLyB1c2VkIHRvIGRvIHRoZSByaWdodCBhdXRvY29ycmVjdGlvbiB3aXRoIHBlcmlvZGljIGhpZGRlbiB0aW1lcwogICAgdGhpcy5lbmRUb0Zyb250ID0gLWRlbHRhID4gMCA/IGZhbHNlIDogdHJ1ZTsgLy8gdXNlZCB0byBkbyB0aGUgcmlnaHQgYXV0b2NvcnJlY3Rpb24gd2l0aCBwZXJpb2RpYyBoaWRkZW4gdGltZXMKICAgIHZhciBzYWZlU3RhcnQgPSBEYXRlVXRpbC5zbmFwQXdheUZyb21IaWRkZW4odGhpcy5ib2R5LmhpZGRlbkRhdGVzLCBuZXdTdGFydCwgZGVsdGEsIHRydWUpOwogICAgdmFyIHNhZmVFbmQgPSBEYXRlVXRpbC5zbmFwQXdheUZyb21IaWRkZW4odGhpcy5ib2R5LmhpZGRlbkRhdGVzLCBuZXdFbmQsIC1kZWx0YSwgdHJ1ZSk7CiAgICBpZiAoc2FmZVN0YXJ0ICE9IG5ld1N0YXJ0IHx8IHNhZmVFbmQgIT0gbmV3RW5kKSB7CiAgICAgIG5ld1N0YXJ0ID0gc2FmZVN0YXJ0OwogICAgICBuZXdFbmQgPSBzYWZlRW5kOwogICAgfQoKICAgIHRoaXMuc2V0UmFuZ2UobmV3U3RhcnQsIG5ld0VuZCwgZmFsc2UsIHRydWUpOwoKICAgIHRoaXMuc3RhcnRUb0Zyb250ID0gZmFsc2U7IC8vIHJldmVydCB0byBkZWZhdWx0CiAgICB0aGlzLmVuZFRvRnJvbnQgPSB0cnVlOyAvLyByZXZlcnQgdG8gZGVmYXVsdAogIH07CgogIC8qKgogICAqIE1vdmUgdGhlIHJhbmdlIHdpdGggYSBnaXZlbiBkZWx0YSB0byB0aGUgbGVmdCBvciByaWdodC4gU3RhcnQgYW5kIGVuZAogICAqIHZhbHVlIHdpbGwgYmUgYWRqdXN0ZWQuIEZvciBleGFtcGxlLCB0cnkgZGVsdGEgPSAwLjEgb3IgLTAuMQogICAqIEBwYXJhbSB7TnVtYmVyfSAgZGVsdGEgICAgIE1vdmluZyBhbW91bnQuIFBvc2l0aXZlIHZhbHVlIHdpbGwgbW92ZSByaWdodCwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZWdhdGl2ZSB2YWx1ZSB3aWxsIG1vdmUgbGVmdAogICAqLwogIFJhbmdlLnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24gKGRlbHRhKSB7CiAgICAvLyB6b29tIHN0YXJ0IERhdGUgYW5kIGVuZCBEYXRlIHJlbGF0aXZlIHRvIHRoZSBjZW50ZXJEYXRlCiAgICB2YXIgZGlmZiA9IHRoaXMuZW5kIC0gdGhpcy5zdGFydDsKCiAgICAvLyBhcHBseSBuZXcgdmFsdWVzCiAgICB2YXIgbmV3U3RhcnQgPSB0aGlzLnN0YXJ0ICsgZGlmZiAqIGRlbHRhOwogICAgdmFyIG5ld0VuZCA9IHRoaXMuZW5kICsgZGlmZiAqIGRlbHRhOwoKICAgIC8vIFRPRE86IHJlY2tvbiB3aXRoIG1pbiBhbmQgbWF4IHJhbmdlCgogICAgdGhpcy5zdGFydCA9IG5ld1N0YXJ0OwogICAgdGhpcy5lbmQgPSBuZXdFbmQ7CiAgfTsKCiAgLyoqCiAgICogTW92ZSB0aGUgcmFuZ2UgdG8gYSBuZXcgY2VudGVyIHBvaW50CiAgICogQHBhcmFtIHtOdW1iZXJ9IG1vdmVUbyAgICAgIE5ldyBjZW50ZXIgcG9pbnQgb2YgdGhlIHJhbmdlCiAgICovCiAgUmFuZ2UucHJvdG90eXBlLm1vdmVUbyA9IGZ1bmN0aW9uIChtb3ZlVG8pIHsKICAgIHZhciBjZW50ZXIgPSAodGhpcy5zdGFydCArIHRoaXMuZW5kKSAvIDI7CgogICAgdmFyIGRpZmYgPSBjZW50ZXIgLSBtb3ZlVG87CgogICAgLy8gY2FsY3VsYXRlIG5ldyBzdGFydCBhbmQgZW5kCiAgICB2YXIgbmV3U3RhcnQgPSB0aGlzLnN0YXJ0IC0gZGlmZjsKICAgIHZhciBuZXdFbmQgPSB0aGlzLmVuZCAtIGRpZmY7CgogICAgdGhpcy5zZXRSYW5nZShuZXdTdGFydCwgbmV3RW5kKTsKICB9OwoKICBtb2R1bGUuZXhwb3J0cyA9IFJhbmdlOwoKLyoqKi8gfSwKLyogMjggKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIEhhbW1lciA9IF9fd2VicGFja19yZXF1aXJlX18oMjMpOwoKICAvKioKICAgKiBSZWdpc3RlciBhIHRvdWNoIGV2ZW50LCB0YWtpbmcgcGxhY2UgYmVmb3JlIGEgZ2VzdHVyZQogICAqIEBwYXJhbSB7SGFtbWVyfSBoYW1tZXIgICAgICAgQSBoYW1tZXIgaW5zdGFuY2UKICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAgIENhbGxiYWNrLCBjYWxsZWQgYXMgY2FsbGJhY2soZXZlbnQpCiAgICovCiAgZXhwb3J0cy5vblRvdWNoID0gZnVuY3Rpb24gKGhhbW1lciwgY2FsbGJhY2spIHsKICAgIGNhbGxiYWNrLmlucHV0SGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoZXZlbnQuaXNGaXJzdCAmJiAhaXNUb3VjaGluZykgewogICAgICAgIGNhbGxiYWNrKGV2ZW50KTsKCiAgICAgICAgaXNUb3VjaGluZyA9IHRydWU7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpc1RvdWNoaW5nID0gZmFsc2U7CiAgICAgICAgfSwgMCk7CiAgICAgIH0KICAgIH07CgogICAgaGFtbWVyLm9uKCdoYW1tZXIuaW5wdXQnLCBjYWxsYmFjay5pbnB1dEhhbmRsZXIpOwogIH07CgogIC8vIGlzVG91Y2hpbmcgaXMgdHJ1ZSB3aGlsZSBhIHRvdWNoIGFjdGlvbiBpcyBiZWluZyBlbWl0dGVkCiAgLy8gdGhpcyBpcyBhIGhhY2sgdG8gcHJldmVudCBgdG91Y2hgIGZyb20gYmVpbmcgZmlyZWQgdHdpY2UKICB2YXIgaXNUb3VjaGluZyA9IGZhbHNlOwoKICAvKioKICAgKiBSZWdpc3RlciBhIHJlbGVhc2UgZXZlbnQsIHRha2luZyBwbGFjZSBhZnRlciBhIGdlc3R1cmUKICAgKiBAcGFyYW0ge0hhbW1lcn0gaGFtbWVyICAgICAgIEEgaGFtbWVyIGluc3RhbmNlCiAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgICBDYWxsYmFjaywgY2FsbGVkIGFzIGNhbGxiYWNrKGV2ZW50KQogICAqLwogIGV4cG9ydHMub25SZWxlYXNlID0gZnVuY3Rpb24gKGhhbW1lciwgY2FsbGJhY2spIHsKICAgIGNhbGxiYWNrLmlucHV0SGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoZXZlbnQuaXNGaW5hbCAmJiAhaXNSZWxlYXNpbmcpIHsKICAgICAgICBjYWxsYmFjayhldmVudCk7CgogICAgICAgIGlzUmVsZWFzaW5nID0gdHJ1ZTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlzUmVsZWFzaW5nID0gZmFsc2U7CiAgICAgICAgfSwgMCk7CiAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIGhhbW1lci5vbignaGFtbWVyLmlucHV0JywgY2FsbGJhY2suaW5wdXRIYW5kbGVyKTsKICB9OwoKICAvLyBpc1JlbGVhc2luZyBpcyB0cnVlIHdoaWxlIGEgcmVsZWFzZSBhY3Rpb24gaXMgYmVpbmcgZW1pdHRlZAogIC8vIHRoaXMgaXMgYSBoYWNrIHRvIHByZXZlbnQgYHJlbGVhc2VgIGZyb20gYmVpbmcgZmlyZWQgdHdpY2UKICB2YXIgaXNSZWxlYXNpbmcgPSBmYWxzZTsKCiAgLyoqCiAgICogVW5yZWdpc3RlciBhIHRvdWNoIGV2ZW50LCB0YWtpbmcgcGxhY2UgYmVmb3JlIGEgZ2VzdHVyZQogICAqIEBwYXJhbSB7SGFtbWVyfSBoYW1tZXIgICAgICAgQSBoYW1tZXIgaW5zdGFuY2UKICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAgIENhbGxiYWNrLCBjYWxsZWQgYXMgY2FsbGJhY2soZXZlbnQpCiAgICovCiAgZXhwb3J0cy5vZmZUb3VjaCA9IGZ1bmN0aW9uIChoYW1tZXIsIGNhbGxiYWNrKSB7CiAgICBoYW1tZXIub2ZmKCdoYW1tZXIuaW5wdXQnLCBjYWxsYmFjay5pbnB1dEhhbmRsZXIpOwogIH07CgogIC8qKgogICAqIFVucmVnaXN0ZXIgYSByZWxlYXNlIGV2ZW50LCB0YWtpbmcgcGxhY2UgYmVmb3JlIGEgZ2VzdHVyZQogICAqIEBwYXJhbSB7SGFtbWVyfSBoYW1tZXIgICAgICAgQSBoYW1tZXIgaW5zdGFuY2UKICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayAgIENhbGxiYWNrLCBjYWxsZWQgYXMgY2FsbGJhY2soZXZlbnQpCiAgICovCiAgZXhwb3J0cy5vZmZSZWxlYXNlID0gZXhwb3J0cy5vZmZUb3VjaDsKCi8qKiovIH0sCi8qIDI5ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAidXNlIHN0cmljdCI7CgogIHZhciBtb21lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwoKICAvKioKICAgKiB1c2VkIGluIENvcmUgdG8gY29udmVydCB0aGUgb3B0aW9ucyBpbnRvIGEgdm9sYXRpbGUgdmFyaWFibGUKICAgKiAKICAgKiBAcGFyYW0gQ29yZQogICAqLwogIGV4cG9ydHMuY29udmVydEhpZGRlbk9wdGlvbnMgPSBmdW5jdGlvbiAoYm9keSwgaGlkZGVuRGF0ZXMpIHsKICAgIGJvZHkuaGlkZGVuRGF0ZXMgPSBbXTsKICAgIGlmIChoaWRkZW5EYXRlcykgewogICAgICBpZiAoQXJyYXkuaXNBcnJheShoaWRkZW5EYXRlcykgPT0gdHJ1ZSkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGlkZGVuRGF0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChoaWRkZW5EYXRlc1tpXS5yZXBlYXQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB2YXIgZGF0ZUl0ZW0gPSB7fTsKICAgICAgICAgICAgZGF0ZUl0ZW0uc3RhcnQgPSBtb21lbnQoaGlkZGVuRGF0ZXNbaV0uc3RhcnQpLnRvRGF0ZSgpLnZhbHVlT2YoKTsKICAgICAgICAgICAgZGF0ZUl0ZW0uZW5kID0gbW9tZW50KGhpZGRlbkRhdGVzW2ldLmVuZCkudG9EYXRlKCkudmFsdWVPZigpOwogICAgICAgICAgICBib2R5LmhpZGRlbkRhdGVzLnB1c2goZGF0ZUl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBib2R5LmhpZGRlbkRhdGVzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhLnN0YXJ0IC0gYi5zdGFydDsKICAgICAgICB9KTsgLy8gc29ydCBieSBzdGFydCB0aW1lCiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBjcmVhdGUgbmV3IGVudHJlZXMgZm9yIHRoZSByZXBlYXRpbmcgaGlkZGVuIGRhdGVzCiAgICogQHBhcmFtIGJvZHkKICAgKiBAcGFyYW0gaGlkZGVuRGF0ZXMKICAgKi8KICBleHBvcnRzLnVwZGF0ZUhpZGRlbkRhdGVzID0gZnVuY3Rpb24gKGJvZHksIGhpZGRlbkRhdGVzKSB7CiAgICBpZiAoaGlkZGVuRGF0ZXMgJiYgYm9keS5kb21Qcm9wcy5jZW50ZXJDb250YWluZXIud2lkdGggIT09IHVuZGVmaW5lZCkgewogICAgICBleHBvcnRzLmNvbnZlcnRIaWRkZW5PcHRpb25zKGJvZHksIGhpZGRlbkRhdGVzKTsKCiAgICAgIHZhciBzdGFydCA9IG1vbWVudChib2R5LnJhbmdlLnN0YXJ0KTsKICAgICAgdmFyIGVuZCA9IG1vbWVudChib2R5LnJhbmdlLmVuZCk7CgogICAgICB2YXIgdG90YWxSYW5nZSA9IGJvZHkucmFuZ2UuZW5kIC0gYm9keS5yYW5nZS5zdGFydDsKICAgICAgdmFyIHBpeGVsVGltZSA9IHRvdGFsUmFuZ2UgLyBib2R5LmRvbVByb3BzLmNlbnRlckNvbnRhaW5lci53aWR0aDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGlkZGVuRGF0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaGlkZGVuRGF0ZXNbaV0ucmVwZWF0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBzdGFydERhdGUgPSBtb21lbnQoaGlkZGVuRGF0ZXNbaV0uc3RhcnQpOwogICAgICAgICAgdmFyIGVuZERhdGUgPSBtb21lbnQoaGlkZGVuRGF0ZXNbaV0uZW5kKTsKCiAgICAgICAgICBpZiAoc3RhcnREYXRlLl9kID09ICJJbnZhbGlkIERhdGUiKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiU3VwcGxpZWQgc3RhcnQgZGF0ZSBpcyBub3QgdmFsaWQ6ICIgKyBoaWRkZW5EYXRlc1tpXS5zdGFydCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZW5kRGF0ZS5fZCA9PSAiSW52YWxpZCBEYXRlIikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlN1cHBsaWVkIGVuZCBkYXRlIGlzIG5vdCB2YWxpZDogIiArIGhpZGRlbkRhdGVzW2ldLmVuZCk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGR1cmF0aW9uID0gZW5kRGF0ZSAtIHN0YXJ0RGF0ZTsKICAgICAgICAgIGlmIChkdXJhdGlvbiA+PSA0ICogcGl4ZWxUaW1lKSB7CgogICAgICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKICAgICAgICAgICAgdmFyIHJ1blVudGlsID0gZW5kLmNsb25lKCk7CiAgICAgICAgICAgIHN3aXRjaCAoaGlkZGVuRGF0ZXNbaV0ucmVwZWF0KSB7CiAgICAgICAgICAgICAgY2FzZSAiZGFpbHkiOgogICAgICAgICAgICAgICAgLy8gY2FzZSBvZiB0aW1lCiAgICAgICAgICAgICAgICBpZiAoc3RhcnREYXRlLmRheSgpICE9IGVuZERhdGUuZGF5KCkpIHsKICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS5kYXlPZlllYXIoc3RhcnQuZGF5T2ZZZWFyKCkpOwogICAgICAgICAgICAgICAgc3RhcnREYXRlLnllYXIoc3RhcnQueWVhcigpKTsKICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS5zdWJ0cmFjdCg3LCAiZGF5cyIpOwoKICAgICAgICAgICAgICAgIGVuZERhdGUuZGF5T2ZZZWFyKHN0YXJ0LmRheU9mWWVhcigpKTsKICAgICAgICAgICAgICAgIGVuZERhdGUueWVhcihzdGFydC55ZWFyKCkpOwogICAgICAgICAgICAgICAgZW5kRGF0ZS5zdWJ0cmFjdCg3IC0gb2Zmc2V0LCAiZGF5cyIpOwoKICAgICAgICAgICAgICAgIHJ1blVudGlsLmFkZCgxLCAid2Vla3MiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIndlZWtseSI6CiAgICAgICAgICAgICAgICB2YXIgZGF5T2Zmc2V0ID0gZW5kRGF0ZS5kaWZmKHN0YXJ0RGF0ZSwgImRheXMiKTsKICAgICAgICAgICAgICAgIHZhciBkYXkgPSBzdGFydERhdGUuZGF5KCk7CgogICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBzdGFydCBkYXRlIHRvIHRoZSByYW5nZS5zdGFydAogICAgICAgICAgICAgICAgc3RhcnREYXRlLmRhdGUoc3RhcnQuZGF0ZSgpKTsKICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS5tb250aChzdGFydC5tb250aCgpKTsKICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS55ZWFyKHN0YXJ0LnllYXIoKSk7CiAgICAgICAgICAgICAgICBlbmREYXRlID0gc3RhcnREYXRlLmNsb25lKCk7CgogICAgICAgICAgICAgICAgLy8gZm9yY2UKICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS5kYXkoZGF5KTsKICAgICAgICAgICAgICAgIGVuZERhdGUuZGF5KGRheSk7CiAgICAgICAgICAgICAgICBlbmREYXRlLmFkZChkYXlPZmZzZXQsICJkYXlzIik7CgogICAgICAgICAgICAgICAgc3RhcnREYXRlLnN1YnRyYWN0KDEsICJ3ZWVrcyIpOwogICAgICAgICAgICAgICAgZW5kRGF0ZS5zdWJ0cmFjdCgxLCAid2Vla3MiKTsKCiAgICAgICAgICAgICAgICBydW5VbnRpbC5hZGQoMSwgIndlZWtzIik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlICJtb250aGx5IjoKICAgICAgICAgICAgICAgIGlmIChzdGFydERhdGUubW9udGgoKSAhPSBlbmREYXRlLm1vbnRoKCkpIHsKICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS5tb250aChzdGFydC5tb250aCgpKTsKICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS55ZWFyKHN0YXJ0LnllYXIoKSk7CiAgICAgICAgICAgICAgICBzdGFydERhdGUuc3VidHJhY3QoMSwgIm1vbnRocyIpOwoKICAgICAgICAgICAgICAgIGVuZERhdGUubW9udGgoc3RhcnQubW9udGgoKSk7CiAgICAgICAgICAgICAgICBlbmREYXRlLnllYXIoc3RhcnQueWVhcigpKTsKICAgICAgICAgICAgICAgIGVuZERhdGUuc3VidHJhY3QoMSwgIm1vbnRocyIpOwogICAgICAgICAgICAgICAgZW5kRGF0ZS5hZGQob2Zmc2V0LCAibW9udGhzIik7CgogICAgICAgICAgICAgICAgcnVuVW50aWwuYWRkKDEsICJtb250aHMiKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgInllYXJseSI6CiAgICAgICAgICAgICAgICBpZiAoc3RhcnREYXRlLnllYXIoKSAhPSBlbmREYXRlLnllYXIoKSkgewogICAgICAgICAgICAgICAgICBvZmZzZXQgPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhcnREYXRlLnllYXIoc3RhcnQueWVhcigpKTsKICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS5zdWJ0cmFjdCgxLCAieWVhcnMiKTsKICAgICAgICAgICAgICAgIGVuZERhdGUueWVhcihzdGFydC55ZWFyKCkpOwogICAgICAgICAgICAgICAgZW5kRGF0ZS5zdWJ0cmFjdCgxLCAieWVhcnMiKTsKICAgICAgICAgICAgICAgIGVuZERhdGUuYWRkKG9mZnNldCwgInllYXJzIik7CgogICAgICAgICAgICAgICAgcnVuVW50aWwuYWRkKDEsICJ5ZWFycyIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJXcm9uZyByZXBlYXQgZm9ybWF0LCBhbGxvd2VkIGFyZTogZGFpbHksIHdlZWtseSwgbW9udGhseSwgeWVhcmx5LiBHaXZlbjoiLCBoaWRkZW5EYXRlc1tpXS5yZXBlYXQpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdoaWxlIChzdGFydERhdGUgPCBydW5VbnRpbCkgewogICAgICAgICAgICAgIGJvZHkuaGlkZGVuRGF0ZXMucHVzaCh7IHN0YXJ0OiBzdGFydERhdGUudmFsdWVPZigpLCBlbmQ6IGVuZERhdGUudmFsdWVPZigpIH0pOwogICAgICAgICAgICAgIHN3aXRjaCAoaGlkZGVuRGF0ZXNbaV0ucmVwZWF0KSB7CiAgICAgICAgICAgICAgICBjYXNlICJkYWlseSI6CiAgICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZS5hZGQoMSwgImRheXMiKTsKICAgICAgICAgICAgICAgICAgZW5kRGF0ZS5hZGQoMSwgImRheXMiKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJ3ZWVrbHkiOgogICAgICAgICAgICAgICAgICBzdGFydERhdGUuYWRkKDEsICJ3ZWVrcyIpOwogICAgICAgICAgICAgICAgICBlbmREYXRlLmFkZCgxLCAid2Vla3MiKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJtb250aGx5IjoKICAgICAgICAgICAgICAgICAgc3RhcnREYXRlLmFkZCgxLCAibW9udGhzIik7CiAgICAgICAgICAgICAgICAgIGVuZERhdGUuYWRkKDEsICJtb250aHMiKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJ5ZWFybHkiOgogICAgICAgICAgICAgICAgICBzdGFydERhdGUuYWRkKDEsICJ5Iik7CiAgICAgICAgICAgICAgICAgIGVuZERhdGUuYWRkKDEsICJ5Iik7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIldyb25nIHJlcGVhdCBmb3JtYXQsIGFsbG93ZWQgYXJlOiBkYWlseSwgd2Vla2x5LCBtb250aGx5LCB5ZWFybHkuIEdpdmVuOiIsIGhpZGRlbkRhdGVzW2ldLnJlcGVhdCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYm9keS5oaWRkZW5EYXRlcy5wdXNoKHsgc3RhcnQ6IHN0YXJ0RGF0ZS52YWx1ZU9mKCksIGVuZDogZW5kRGF0ZS52YWx1ZU9mKCkgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIHJlbW92ZSBkdXBsaWNhdGVzLCBtZXJnZSB3aGVyZSBwb3NzaWJsZQogICAgICBleHBvcnRzLnJlbW92ZUR1cGxpY2F0ZXMoYm9keSk7CiAgICAgIC8vIGVuc3VyZSB0aGUgbmV3IHBvc2l0aW9ucyBhcmUgbm90IG9uIGhpZGRlbiBkYXRlcwogICAgICB2YXIgc3RhcnRIaWRkZW4gPSBleHBvcnRzLmlzSGlkZGVuKGJvZHkucmFuZ2Uuc3RhcnQsIGJvZHkuaGlkZGVuRGF0ZXMpOwogICAgICB2YXIgZW5kSGlkZGVuID0gZXhwb3J0cy5pc0hpZGRlbihib2R5LnJhbmdlLmVuZCwgYm9keS5oaWRkZW5EYXRlcyk7CiAgICAgIHZhciByYW5nZVN0YXJ0ID0gYm9keS5yYW5nZS5zdGFydDsKICAgICAgdmFyIHJhbmdlRW5kID0gYm9keS5yYW5nZS5lbmQ7CiAgICAgIGlmIChzdGFydEhpZGRlbi5oaWRkZW4gPT0gdHJ1ZSkgewogICAgICAgIHJhbmdlU3RhcnQgPSBib2R5LnJhbmdlLnN0YXJ0VG9Gcm9udCA9PSB0cnVlID8gc3RhcnRIaWRkZW4uc3RhcnREYXRlIC0gMSA6IHN0YXJ0SGlkZGVuLmVuZERhdGUgKyAxOwogICAgICB9CiAgICAgIGlmIChlbmRIaWRkZW4uaGlkZGVuID09IHRydWUpIHsKICAgICAgICByYW5nZUVuZCA9IGJvZHkucmFuZ2UuZW5kVG9Gcm9udCA9PSB0cnVlID8gZW5kSGlkZGVuLnN0YXJ0RGF0ZSAtIDEgOiBlbmRIaWRkZW4uZW5kRGF0ZSArIDE7CiAgICAgIH0KICAgICAgaWYgKHN0YXJ0SGlkZGVuLmhpZGRlbiA9PSB0cnVlIHx8IGVuZEhpZGRlbi5oaWRkZW4gPT0gdHJ1ZSkgewogICAgICAgIGJvZHkucmFuZ2UuX2FwcGx5UmFuZ2UocmFuZ2VTdGFydCwgcmFuZ2VFbmQpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogcmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSB0aGUgaGlkZGVuIGRhdGVzIGxpc3QuIER1cGxpY2F0ZXMgYXJlIGV2aWwuIFRoZXkgbWVzcyBldmVyeXRoaW5nIHVwLgogICAqIFNjYWxlcyB3aXRoIE5eMgogICAqIEBwYXJhbSBib2R5CiAgICovCiAgZXhwb3J0cy5yZW1vdmVEdXBsaWNhdGVzID0gZnVuY3Rpb24gKGJvZHkpIHsKICAgIHZhciBoaWRkZW5EYXRlcyA9IGJvZHkuaGlkZGVuRGF0ZXM7CiAgICB2YXIgc2FmZURhdGVzID0gW107CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhpZGRlbkRhdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaGlkZGVuRGF0ZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICBpZiAoaSAhPSBqICYmIGhpZGRlbkRhdGVzW2pdLnJlbW92ZSAhPSB0cnVlICYmIGhpZGRlbkRhdGVzW2ldLnJlbW92ZSAhPSB0cnVlKSB7CiAgICAgICAgICAvLyBqIGluc2lkZSBpCiAgICAgICAgICBpZiAoaGlkZGVuRGF0ZXNbal0uc3RhcnQgPj0gaGlkZGVuRGF0ZXNbaV0uc3RhcnQgJiYgaGlkZGVuRGF0ZXNbal0uZW5kIDw9IGhpZGRlbkRhdGVzW2ldLmVuZCkgewogICAgICAgICAgICBoaWRkZW5EYXRlc1tqXS5yZW1vdmUgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgLy8gaiBzdGFydCBpbnNpZGUgaQogICAgICAgICAgZWxzZSBpZiAoaGlkZGVuRGF0ZXNbal0uc3RhcnQgPj0gaGlkZGVuRGF0ZXNbaV0uc3RhcnQgJiYgaGlkZGVuRGF0ZXNbal0uc3RhcnQgPD0gaGlkZGVuRGF0ZXNbaV0uZW5kKSB7CiAgICAgICAgICAgIGhpZGRlbkRhdGVzW2ldLmVuZCA9IGhpZGRlbkRhdGVzW2pdLmVuZDsKICAgICAgICAgICAgaGlkZGVuRGF0ZXNbal0ucmVtb3ZlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGogZW5kIGluc2lkZSBpCiAgICAgICAgICBlbHNlIGlmIChoaWRkZW5EYXRlc1tqXS5lbmQgPj0gaGlkZGVuRGF0ZXNbaV0uc3RhcnQgJiYgaGlkZGVuRGF0ZXNbal0uZW5kIDw9IGhpZGRlbkRhdGVzW2ldLmVuZCkgewogICAgICAgICAgICBoaWRkZW5EYXRlc1tpXS5zdGFydCA9IGhpZGRlbkRhdGVzW2pdLnN0YXJ0OwogICAgICAgICAgICBoaWRkZW5EYXRlc1tqXS5yZW1vdmUgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGlkZGVuRGF0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGhpZGRlbkRhdGVzW2ldLnJlbW92ZSAhPT0gdHJ1ZSkgewogICAgICAgIHNhZmVEYXRlcy5wdXNoKGhpZGRlbkRhdGVzW2ldKTsKICAgICAgfQogICAgfQoKICAgIGJvZHkuaGlkZGVuRGF0ZXMgPSBzYWZlRGF0ZXM7CiAgICBib2R5LmhpZGRlbkRhdGVzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgcmV0dXJuIGEuc3RhcnQgLSBiLnN0YXJ0OwogICAgfSk7IC8vIHNvcnQgYnkgc3RhcnQgdGltZQogIH07CgogIGV4cG9ydHMucHJpbnREYXRlcyA9IGZ1bmN0aW9uIChkYXRlcykgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRlcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zb2xlLmxvZyhpLCBuZXcgRGF0ZShkYXRlc1tpXS5zdGFydCksIG5ldyBEYXRlKGRhdGVzW2ldLmVuZCksIGRhdGVzW2ldLnN0YXJ0LCBkYXRlc1tpXS5lbmQsIGRhdGVzW2ldLnJlbW92ZSk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogVXNlZCBpbiBUaW1lU3RlcCB0byBhdm9pZCB0aGUgaGlkZGVuIHRpbWVzLgogICAqIEBwYXJhbSB0aW1lU3RlcAogICAqIEBwYXJhbSBwcmV2aW91c1RpbWUKICAgKi8KICBleHBvcnRzLnN0ZXBPdmVySGlkZGVuRGF0ZXMgPSBmdW5jdGlvbiAodGltZVN0ZXAsIHByZXZpb3VzVGltZSkgewogICAgdmFyIHN0ZXBJbkhpZGRlbiA9IGZhbHNlOwogICAgdmFyIGN1cnJlbnRWYWx1ZSA9IHRpbWVTdGVwLmN1cnJlbnQudmFsdWVPZigpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aW1lU3RlcC5oaWRkZW5EYXRlcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc3RhcnREYXRlID0gdGltZVN0ZXAuaGlkZGVuRGF0ZXNbaV0uc3RhcnQ7CiAgICAgIHZhciBlbmREYXRlID0gdGltZVN0ZXAuaGlkZGVuRGF0ZXNbaV0uZW5kOwogICAgICBpZiAoY3VycmVudFZhbHVlID49IHN0YXJ0RGF0ZSAmJiBjdXJyZW50VmFsdWUgPCBlbmREYXRlKSB7CiAgICAgICAgc3RlcEluSGlkZGVuID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQoKICAgIGlmIChzdGVwSW5IaWRkZW4gPT0gdHJ1ZSAmJiBjdXJyZW50VmFsdWUgPCB0aW1lU3RlcC5fZW5kLnZhbHVlT2YoKSAmJiBjdXJyZW50VmFsdWUgIT0gcHJldmlvdXNUaW1lKSB7CiAgICAgIHZhciBwcmV2VmFsdWUgPSBtb21lbnQocHJldmlvdXNUaW1lKTsKICAgICAgdmFyIG5ld1ZhbHVlID0gbW9tZW50KGVuZERhdGUpOwogICAgICAvL2NoZWNrIGlmIHRoZSBuZXh0IHN0ZXAgc2hvdWxkIGJlIG1ham9yCiAgICAgIGlmIChwcmV2VmFsdWUueWVhcigpICE9IG5ld1ZhbHVlLnllYXIoKSkgewogICAgICAgIHRpbWVTdGVwLnN3aXRjaGVkWWVhciA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAocHJldlZhbHVlLm1vbnRoKCkgIT0gbmV3VmFsdWUubW9udGgoKSkgewogICAgICAgIHRpbWVTdGVwLnN3aXRjaGVkTW9udGggPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKHByZXZWYWx1ZS5kYXlPZlllYXIoKSAhPSBuZXdWYWx1ZS5kYXlPZlllYXIoKSkgewogICAgICAgIHRpbWVTdGVwLnN3aXRjaGVkRGF5ID0gdHJ1ZTsKICAgICAgfQoKICAgICAgdGltZVN0ZXAuY3VycmVudCA9IG5ld1ZhbHVlLnRvRGF0ZSgpOwogICAgfQogIH07CgogIC8vLyoqCiAgLy8gKiBVc2VkIGluIFRpbWVTdGVwIHRvIGF2b2lkIHRoZSBoaWRkZW4gdGltZXMuCiAgLy8gKiBAcGFyYW0gdGltZVN0ZXAKICAvLyAqIEBwYXJhbSBwcmV2aW91c1RpbWUKICAvLyAqLwogIC8vZXhwb3J0cy5jaGVja0ZpcnN0U3RlcCA9IGZ1bmN0aW9uKHRpbWVTdGVwKSB7CiAgLy8gIHZhciBzdGVwSW5IaWRkZW4gPSBmYWxzZTsKICAvLyAgdmFyIGN1cnJlbnRWYWx1ZSA9IHRpbWVTdGVwLmN1cnJlbnQudmFsdWVPZigpOwogIC8vICBmb3IgKHZhciBpID0gMDsgaSA8IHRpbWVTdGVwLmhpZGRlbkRhdGVzLmxlbmd0aDsgaSsrKSB7CiAgLy8gICAgdmFyIHN0YXJ0RGF0ZSA9IHRpbWVTdGVwLmhpZGRlbkRhdGVzW2ldLnN0YXJ0OwogIC8vICAgIHZhciBlbmREYXRlID0gdGltZVN0ZXAuaGlkZGVuRGF0ZXNbaV0uZW5kOwogIC8vICAgIGlmIChjdXJyZW50VmFsdWUgPj0gc3RhcnREYXRlICYmIGN1cnJlbnRWYWx1ZSA8IGVuZERhdGUpIHsKICAvLyAgICAgIHN0ZXBJbkhpZGRlbiA9IHRydWU7CiAgLy8gICAgICBicmVhazsKICAvLyAgICB9CiAgLy8gIH0KICAvLwogIC8vICBpZiAoc3RlcEluSGlkZGVuID09IHRydWUgJiYgY3VycmVudFZhbHVlIDw9IHRpbWVTdGVwLl9lbmQudmFsdWVPZigpKSB7CiAgLy8gICAgdmFyIG5ld1ZhbHVlID0gbW9tZW50KGVuZERhdGUpOwogIC8vICAgIHRpbWVTdGVwLmN1cnJlbnQgPSBuZXdWYWx1ZS50b0RhdGUoKTsKICAvLyAgfQogIC8vfTsKCiAgLyoqCiAgICogcmVwbGFjZXMgdGhlIENvcmUgdG9TY3JlZW4gbWV0aG9kcwogICAqIEBwYXJhbSBDb3JlCiAgICogQHBhcmFtIHRpbWUKICAgKiBAcGFyYW0gd2lkdGgKICAgKiBAcmV0dXJucyB7bnVtYmVyfQogICAqLwogIGV4cG9ydHMudG9TY3JlZW4gPSBmdW5jdGlvbiAoQ29yZSwgdGltZSwgd2lkdGgpIHsKICAgIGlmIChDb3JlLmJvZHkuaGlkZGVuRGF0ZXMubGVuZ3RoID09IDApIHsKICAgICAgdmFyIGNvbnZlcnNpb24gPSBDb3JlLnJhbmdlLmNvbnZlcnNpb24od2lkdGgpOwogICAgICByZXR1cm4gKHRpbWUudmFsdWVPZigpIC0gY29udmVyc2lvbi5vZmZzZXQpICogY29udmVyc2lvbi5zY2FsZTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBoaWRkZW4gPSBleHBvcnRzLmlzSGlkZGVuKHRpbWUsIENvcmUuYm9keS5oaWRkZW5EYXRlcyk7CiAgICAgIGlmIChoaWRkZW4uaGlkZGVuID09IHRydWUpIHsKICAgICAgICB0aW1lID0gaGlkZGVuLnN0YXJ0RGF0ZTsKICAgICAgfQoKICAgICAgdmFyIGR1cmF0aW9uID0gZXhwb3J0cy5nZXRIaWRkZW5EdXJhdGlvbkJldHdlZW4oQ29yZS5ib2R5LmhpZGRlbkRhdGVzLCBDb3JlLnJhbmdlLnN0YXJ0LCBDb3JlLnJhbmdlLmVuZCk7CiAgICAgIHRpbWUgPSBleHBvcnRzLmNvcnJlY3RUaW1lRm9ySGlkZGVuKENvcmUuYm9keS5oaWRkZW5EYXRlcywgQ29yZS5yYW5nZSwgdGltZSk7CgogICAgICB2YXIgY29udmVyc2lvbiA9IENvcmUucmFuZ2UuY29udmVyc2lvbih3aWR0aCwgZHVyYXRpb24pOwogICAgICByZXR1cm4gKHRpbWUudmFsdWVPZigpIC0gY29udmVyc2lvbi5vZmZzZXQpICogY29udmVyc2lvbi5zY2FsZTsKICAgIH0KICB9OwoKICAvKioKICAgKiBSZXBsYWNlcyB0aGUgY29yZSB0b1RpbWUgbWV0aG9kcwogICAqIEBwYXJhbSBib2R5CiAgICogQHBhcmFtIHJhbmdlCiAgICogQHBhcmFtIHgKICAgKiBAcGFyYW0gd2lkdGgKICAgKiBAcmV0dXJucyB7RGF0ZX0KICAgKi8KICBleHBvcnRzLnRvVGltZSA9IGZ1bmN0aW9uIChDb3JlLCB4LCB3aWR0aCkgewogICAgaWYgKENvcmUuYm9keS5oaWRkZW5EYXRlcy5sZW5ndGggPT0gMCkgewogICAgICB2YXIgY29udmVyc2lvbiA9IENvcmUucmFuZ2UuY29udmVyc2lvbih3aWR0aCk7CiAgICAgIHJldHVybiBuZXcgRGF0ZSh4IC8gY29udmVyc2lvbi5zY2FsZSArIGNvbnZlcnNpb24ub2Zmc2V0KTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBoaWRkZW5EdXJhdGlvbiA9IGV4cG9ydHMuZ2V0SGlkZGVuRHVyYXRpb25CZXR3ZWVuKENvcmUuYm9keS5oaWRkZW5EYXRlcywgQ29yZS5yYW5nZS5zdGFydCwgQ29yZS5yYW5nZS5lbmQpOwogICAgICB2YXIgdG90YWxEdXJhdGlvbiA9IENvcmUucmFuZ2UuZW5kIC0gQ29yZS5yYW5nZS5zdGFydCAtIGhpZGRlbkR1cmF0aW9uOwogICAgICB2YXIgcGFydGlhbER1cmF0aW9uID0gdG90YWxEdXJhdGlvbiAqIHggLyB3aWR0aDsKICAgICAgdmFyIGFjY3VtdWxhdGVkSGlkZGVuRHVyYXRpb24gPSBleHBvcnRzLmdldEFjY3VtdWxhdGVkSGlkZGVuRHVyYXRpb24oQ29yZS5ib2R5LmhpZGRlbkRhdGVzLCBDb3JlLnJhbmdlLCBwYXJ0aWFsRHVyYXRpb24pOwoKICAgICAgdmFyIG5ld1RpbWUgPSBuZXcgRGF0ZShhY2N1bXVsYXRlZEhpZGRlbkR1cmF0aW9uICsgcGFydGlhbER1cmF0aW9uICsgQ29yZS5yYW5nZS5zdGFydCk7CiAgICAgIHJldHVybiBuZXdUaW1lOwogICAgfQogIH07CgogIC8qKgogICAqIFN1cHBvcnQgZnVuY3Rpb24KICAgKgogICAqIEBwYXJhbSBoaWRkZW5EYXRlcwogICAqIEBwYXJhbSByYW5nZQogICAqIEByZXR1cm5zIHtudW1iZXJ9CiAgICovCiAgZXhwb3J0cy5nZXRIaWRkZW5EdXJhdGlvbkJldHdlZW4gPSBmdW5jdGlvbiAoaGlkZGVuRGF0ZXMsIHN0YXJ0LCBlbmQpIHsKICAgIHZhciBkdXJhdGlvbiA9IDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhpZGRlbkRhdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzdGFydERhdGUgPSBoaWRkZW5EYXRlc1tpXS5zdGFydDsKICAgICAgdmFyIGVuZERhdGUgPSBoaWRkZW5EYXRlc1tpXS5lbmQ7CiAgICAgIC8vIGlmIHRpbWUgYWZ0ZXIgdGhlIGN1dG91dCwgYW5kIHRoZQogICAgICBpZiAoc3RhcnREYXRlID49IHN0YXJ0ICYmIGVuZERhdGUgPCBlbmQpIHsKICAgICAgICBkdXJhdGlvbiArPSBlbmREYXRlIC0gc3RhcnREYXRlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZHVyYXRpb247CiAgfTsKCiAgLyoqCiAgICogU3VwcG9ydCBmdW5jdGlvbgogICAqIEBwYXJhbSBoaWRkZW5EYXRlcwogICAqIEBwYXJhbSByYW5nZQogICAqIEBwYXJhbSB0aW1lCiAgICogQHJldHVybnMge3tkdXJhdGlvbjogbnVtYmVyLCB0aW1lOiAqLCBvZmZzZXQ6IG51bWJlcn19CiAgICovCiAgZXhwb3J0cy5jb3JyZWN0VGltZUZvckhpZGRlbiA9IGZ1bmN0aW9uIChoaWRkZW5EYXRlcywgcmFuZ2UsIHRpbWUpIHsKICAgIHRpbWUgPSBtb21lbnQodGltZSkudG9EYXRlKCkudmFsdWVPZigpOwogICAgdGltZSAtPSBleHBvcnRzLmdldEhpZGRlbkR1cmF0aW9uQmVmb3JlKGhpZGRlbkRhdGVzLCByYW5nZSwgdGltZSk7CiAgICByZXR1cm4gdGltZTsKICB9OwoKICBleHBvcnRzLmdldEhpZGRlbkR1cmF0aW9uQmVmb3JlID0gZnVuY3Rpb24gKGhpZGRlbkRhdGVzLCByYW5nZSwgdGltZSkgewogICAgdmFyIHRpbWVPZmZzZXQgPSAwOwogICAgdGltZSA9IG1vbWVudCh0aW1lKS50b0RhdGUoKS52YWx1ZU9mKCk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoaWRkZW5EYXRlcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc3RhcnREYXRlID0gaGlkZGVuRGF0ZXNbaV0uc3RhcnQ7CiAgICAgIHZhciBlbmREYXRlID0gaGlkZGVuRGF0ZXNbaV0uZW5kOwogICAgICAvLyBpZiB0aW1lIGFmdGVyIHRoZSBjdXRvdXQsIGFuZCB0aGUKICAgICAgaWYgKHN0YXJ0RGF0ZSA+PSByYW5nZS5zdGFydCAmJiBlbmREYXRlIDwgcmFuZ2UuZW5kKSB7CiAgICAgICAgaWYgKHRpbWUgPj0gZW5kRGF0ZSkgewogICAgICAgICAgdGltZU9mZnNldCArPSBlbmREYXRlIC0gc3RhcnREYXRlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRpbWVPZmZzZXQ7CiAgfTsKCiAgLyoqCiAgICogc3VtIHRoZSBkdXJhdGlvbiBmcm9tIHN0YXJ0IHRvIGZpbmlzaCwgaW5jbHVkaW5nIHRoZSBoaWRkZW4gZHVyYXRpb24sCiAgICogdW50aWwgdGhlIHJlcXVpcmVkIGFtb3VudCBoYXMgYmVlbiByZWFjaGVkLCByZXR1cm4gdGhlIGFjY3VtdWxhdGVkIGhpZGRlbiBkdXJhdGlvbgogICAqIEBwYXJhbSBoaWRkZW5EYXRlcwogICAqIEBwYXJhbSByYW5nZQogICAqIEBwYXJhbSB0aW1lCiAgICogQHJldHVybnMge3tkdXJhdGlvbjogbnVtYmVyLCB0aW1lOiAqLCBvZmZzZXQ6IG51bWJlcn19CiAgICovCiAgZXhwb3J0cy5nZXRBY2N1bXVsYXRlZEhpZGRlbkR1cmF0aW9uID0gZnVuY3Rpb24gKGhpZGRlbkRhdGVzLCByYW5nZSwgcmVxdWlyZWREdXJhdGlvbikgewogICAgdmFyIGhpZGRlbkR1cmF0aW9uID0gMDsKICAgIHZhciBkdXJhdGlvbiA9IDA7CiAgICB2YXIgcHJldmlvdXNQb2ludCA9IHJhbmdlLnN0YXJ0OwogICAgLy9leHBvcnRzLnByaW50RGF0ZXMoaGlkZGVuRGF0ZXMpCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhpZGRlbkRhdGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzdGFydERhdGUgPSBoaWRkZW5EYXRlc1tpXS5zdGFydDsKICAgICAgdmFyIGVuZERhdGUgPSBoaWRkZW5EYXRlc1tpXS5lbmQ7CiAgICAgIC8vIGlmIHRpbWUgYWZ0ZXIgdGhlIGN1dG91dCwgYW5kIHRoZQogICAgICBpZiAoc3RhcnREYXRlID49IHJhbmdlLnN0YXJ0ICYmIGVuZERhdGUgPCByYW5nZS5lbmQpIHsKICAgICAgICBkdXJhdGlvbiArPSBzdGFydERhdGUgLSBwcmV2aW91c1BvaW50OwogICAgICAgIHByZXZpb3VzUG9pbnQgPSBlbmREYXRlOwogICAgICAgIGlmIChkdXJhdGlvbiA+PSByZXF1aXJlZER1cmF0aW9uKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaGlkZGVuRHVyYXRpb24gKz0gZW5kRGF0ZSAtIHN0YXJ0RGF0ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gaGlkZGVuRHVyYXRpb247CiAgfTsKCiAgLyoqCiAgICogdXNlZCB0byBzdGVwIG92ZXIgdG8gZWl0aGVyIHNpZGUgb2YgYSBoaWRkZW4gYmxvY2suIENvcnJlY3Rpb24gaXMgZGlzYWJsZWQgb24gdGFibGV0cywgbWlnaHQgYmUgc2V0IHRvIHRydWUKICAgKiBAcGFyYW0gaGlkZGVuRGF0ZXMKICAgKiBAcGFyYW0gdGltZQogICAqIEBwYXJhbSBkaXJlY3Rpb24KICAgKiBAcGFyYW0gY29ycmVjdGlvbkVuYWJsZWQKICAgKiBAcmV0dXJucyB7Kn0KICAgKi8KICBleHBvcnRzLnNuYXBBd2F5RnJvbUhpZGRlbiA9IGZ1bmN0aW9uIChoaWRkZW5EYXRlcywgdGltZSwgZGlyZWN0aW9uLCBjb3JyZWN0aW9uRW5hYmxlZCkgewogICAgdmFyIGlzSGlkZGVuID0gZXhwb3J0cy5pc0hpZGRlbih0aW1lLCBoaWRkZW5EYXRlcyk7CiAgICBpZiAoaXNIaWRkZW4uaGlkZGVuID09IHRydWUpIHsKICAgICAgaWYgKGRpcmVjdGlvbiA8IDApIHsKICAgICAgICBpZiAoY29ycmVjdGlvbkVuYWJsZWQgPT0gdHJ1ZSkgewogICAgICAgICAgcmV0dXJuIGlzSGlkZGVuLnN0YXJ0RGF0ZSAtIChpc0hpZGRlbi5lbmREYXRlIC0gdGltZSkgLSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gaXNIaWRkZW4uc3RhcnREYXRlIC0gMTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGNvcnJlY3Rpb25FbmFibGVkID09IHRydWUpIHsKICAgICAgICAgIHJldHVybiBpc0hpZGRlbi5lbmREYXRlICsgKHRpbWUgLSBpc0hpZGRlbi5zdGFydERhdGUpICsgMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGlzSGlkZGVuLmVuZERhdGUgKyAxOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRpbWU7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ2hlY2sgaWYgYSB0aW1lIGlzIGhpZGRlbgogICAqCiAgICogQHBhcmFtIHRpbWUKICAgKiBAcGFyYW0gaGlkZGVuRGF0ZXMKICAgKiBAcmV0dXJucyB7e2hpZGRlbjogYm9vbGVhbiwgc3RhcnREYXRlOiBXaW5kb3cuc3RhcnQsIGVuZERhdGU6ICp9fQogICAqLwogIGV4cG9ydHMuaXNIaWRkZW4gPSBmdW5jdGlvbiAodGltZSwgaGlkZGVuRGF0ZXMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGlkZGVuRGF0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHN0YXJ0RGF0ZSA9IGhpZGRlbkRhdGVzW2ldLnN0YXJ0OwogICAgICB2YXIgZW5kRGF0ZSA9IGhpZGRlbkRhdGVzW2ldLmVuZDsKCiAgICAgIGlmICh0aW1lID49IHN0YXJ0RGF0ZSAmJiB0aW1lIDwgZW5kRGF0ZSkgewogICAgICAgIC8vIGlmIHRoZSBzdGFydCBpcyBlbnRlcmluZyBhIGhpZGRlbiB6b25lCiAgICAgICAgcmV0dXJuIHsgaGlkZGVuOiB0cnVlLCBzdGFydERhdGU6IHN0YXJ0RGF0ZSwgZW5kRGF0ZTogZW5kRGF0ZSB9OwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4geyBoaWRkZW46IGZhbHNlLCBzdGFydERhdGU6IHN0YXJ0RGF0ZSwgZW5kRGF0ZTogZW5kRGF0ZSB9OwogIH07CgovKioqLyB9LAovKiAzMCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgRW1pdHRlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTMpOwogIHZhciBIYW1tZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKTsKICB2YXIgaGFtbWVyVXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMjgpOwogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKICB2YXIgRGF0YVNldCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7CiAgdmFyIERhdGFWaWV3ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7CiAgdmFyIFJhbmdlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNyk7CiAgdmFyIEl0ZW1TZXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMxKTsKICB2YXIgVGltZUF4aXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxKTsKICB2YXIgQWN0aXZhdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Mik7CiAgdmFyIERhdGVVdGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOSk7CiAgdmFyIEN1c3RvbVRpbWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ0KTsKCiAgLyoqCiAgICogQ3JlYXRlIGEgdGltZWxpbmUgdmlzdWFsaXphdGlvbgogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIENvcmUoKSB7fQoKICAvLyB0dXJuIENvcmUgaW50byBhbiBldmVudCBlbWl0dGVyCiAgRW1pdHRlcihDb3JlLnByb3RvdHlwZSk7CgogIC8qKgogICAqIENyZWF0ZSB0aGUgbWFpbiBET00gZm9yIHRoZSBDb3JlOiBhIHJvb3QgcGFuZWwgY29udGFpbmluZyBsZWZ0LCByaWdodCwKICAgKiB0b3AsIGJvdHRvbSwgY29udGVudCwgYW5kIGJhY2tncm91bmQgcGFuZWwuCiAgICogQHBhcmFtIHtFbGVtZW50fSBjb250YWluZXIgIFRoZSBjb250YWluZXIgZWxlbWVudCB3aGVyZSB0aGUgQ29yZSB3aWxsCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlIGF0dGFjaGVkLgogICAqIEBwcm90ZWN0ZWQKICAgKi8KICBDb3JlLnByb3RvdHlwZS5fY3JlYXRlID0gZnVuY3Rpb24gKGNvbnRhaW5lcikgewogICAgdGhpcy5kb20gPSB7fTsKCiAgICB0aGlzLmRvbS5jb250YWluZXIgPSBjb250YWluZXI7CgogICAgdGhpcy5kb20ucm9vdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20uYmFja2dyb3VuZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20uYmFja2dyb3VuZFZlcnRpY2FsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5iYWNrZ3JvdW5kSG9yaXpvbnRhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20uY2VudGVyQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5sZWZ0Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5yaWdodENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20uY2VudGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5sZWZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5yaWdodCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20udG9wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5ib3R0b20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHRoaXMuZG9tLnNoYWRvd1RvcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20uc2hhZG93Qm90dG9tID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5zaGFkb3dUb3BMZWZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5zaGFkb3dCb3R0b21MZWZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5zaGFkb3dUb3BSaWdodCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20uc2hhZG93Qm90dG9tUmlnaHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCiAgICB0aGlzLmRvbS5yb290LmNsYXNzTmFtZSA9ICd2aXMtdGltZWxpbmUnOwogICAgdGhpcy5kb20uYmFja2dyb3VuZC5jbGFzc05hbWUgPSAndmlzLXBhbmVsIHZpcy1iYWNrZ3JvdW5kJzsKICAgIHRoaXMuZG9tLmJhY2tncm91bmRWZXJ0aWNhbC5jbGFzc05hbWUgPSAndmlzLXBhbmVsIHZpcy1iYWNrZ3JvdW5kIHZpcy12ZXJ0aWNhbCc7CiAgICB0aGlzLmRvbS5iYWNrZ3JvdW5kSG9yaXpvbnRhbC5jbGFzc05hbWUgPSAndmlzLXBhbmVsIHZpcy1iYWNrZ3JvdW5kIHZpcy1ob3Jpem9udGFsJzsKICAgIHRoaXMuZG9tLmNlbnRlckNvbnRhaW5lci5jbGFzc05hbWUgPSAndmlzLXBhbmVsIHZpcy1jZW50ZXInOwogICAgdGhpcy5kb20ubGVmdENvbnRhaW5lci5jbGFzc05hbWUgPSAndmlzLXBhbmVsIHZpcy1sZWZ0JzsKICAgIHRoaXMuZG9tLnJpZ2h0Q29udGFpbmVyLmNsYXNzTmFtZSA9ICd2aXMtcGFuZWwgdmlzLXJpZ2h0JzsKICAgIHRoaXMuZG9tLnRvcC5jbGFzc05hbWUgPSAndmlzLXBhbmVsIHZpcy10b3AnOwogICAgdGhpcy5kb20uYm90dG9tLmNsYXNzTmFtZSA9ICd2aXMtcGFuZWwgdmlzLWJvdHRvbSc7CiAgICB0aGlzLmRvbS5sZWZ0LmNsYXNzTmFtZSA9ICd2aXMtY29udGVudCc7CiAgICB0aGlzLmRvbS5jZW50ZXIuY2xhc3NOYW1lID0gJ3Zpcy1jb250ZW50JzsKICAgIHRoaXMuZG9tLnJpZ2h0LmNsYXNzTmFtZSA9ICd2aXMtY29udGVudCc7CiAgICB0aGlzLmRvbS5zaGFkb3dUb3AuY2xhc3NOYW1lID0gJ3Zpcy1zaGFkb3cgdmlzLXRvcCc7CiAgICB0aGlzLmRvbS5zaGFkb3dCb3R0b20uY2xhc3NOYW1lID0gJ3Zpcy1zaGFkb3cgdmlzLWJvdHRvbSc7CiAgICB0aGlzLmRvbS5zaGFkb3dUb3BMZWZ0LmNsYXNzTmFtZSA9ICd2aXMtc2hhZG93IHZpcy10b3AnOwogICAgdGhpcy5kb20uc2hhZG93Qm90dG9tTGVmdC5jbGFzc05hbWUgPSAndmlzLXNoYWRvdyB2aXMtYm90dG9tJzsKICAgIHRoaXMuZG9tLnNoYWRvd1RvcFJpZ2h0LmNsYXNzTmFtZSA9ICd2aXMtc2hhZG93IHZpcy10b3AnOwogICAgdGhpcy5kb20uc2hhZG93Qm90dG9tUmlnaHQuY2xhc3NOYW1lID0gJ3Zpcy1zaGFkb3cgdmlzLWJvdHRvbSc7CgogICAgdGhpcy5kb20ucm9vdC5hcHBlbmRDaGlsZCh0aGlzLmRvbS5iYWNrZ3JvdW5kKTsKICAgIHRoaXMuZG9tLnJvb3QuYXBwZW5kQ2hpbGQodGhpcy5kb20uYmFja2dyb3VuZFZlcnRpY2FsKTsKICAgIHRoaXMuZG9tLnJvb3QuYXBwZW5kQ2hpbGQodGhpcy5kb20uYmFja2dyb3VuZEhvcml6b250YWwpOwogICAgdGhpcy5kb20ucm9vdC5hcHBlbmRDaGlsZCh0aGlzLmRvbS5jZW50ZXJDb250YWluZXIpOwogICAgdGhpcy5kb20ucm9vdC5hcHBlbmRDaGlsZCh0aGlzLmRvbS5sZWZ0Q29udGFpbmVyKTsKICAgIHRoaXMuZG9tLnJvb3QuYXBwZW5kQ2hpbGQodGhpcy5kb20ucmlnaHRDb250YWluZXIpOwogICAgdGhpcy5kb20ucm9vdC5hcHBlbmRDaGlsZCh0aGlzLmRvbS50b3ApOwogICAgdGhpcy5kb20ucm9vdC5hcHBlbmRDaGlsZCh0aGlzLmRvbS5ib3R0b20pOwoKICAgIHRoaXMuZG9tLmNlbnRlckNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmRvbS5jZW50ZXIpOwogICAgdGhpcy5kb20ubGVmdENvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmRvbS5sZWZ0KTsKICAgIHRoaXMuZG9tLnJpZ2h0Q29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZG9tLnJpZ2h0KTsKCiAgICB0aGlzLmRvbS5jZW50ZXJDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5kb20uc2hhZG93VG9wKTsKICAgIHRoaXMuZG9tLmNlbnRlckNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmRvbS5zaGFkb3dCb3R0b20pOwogICAgdGhpcy5kb20ubGVmdENvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmRvbS5zaGFkb3dUb3BMZWZ0KTsKICAgIHRoaXMuZG9tLmxlZnRDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5kb20uc2hhZG93Qm90dG9tTGVmdCk7CiAgICB0aGlzLmRvbS5yaWdodENvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmRvbS5zaGFkb3dUb3BSaWdodCk7CiAgICB0aGlzLmRvbS5yaWdodENvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmRvbS5zaGFkb3dCb3R0b21SaWdodCk7CgogICAgdGhpcy5vbigncmFuZ2VjaGFuZ2UnLCB0aGlzLnJlZHJhdy5iaW5kKHRoaXMpKTsKICAgIHRoaXMub24oJ3RvdWNoJywgdGhpcy5fb25Ub3VjaC5iaW5kKHRoaXMpKTsKICAgIHRoaXMub24oJ3BhbicsIHRoaXMuX29uRHJhZy5iaW5kKHRoaXMpKTsKCiAgICB2YXIgbWUgPSB0aGlzOwogICAgdGhpcy5vbignY2hhbmdlJywgZnVuY3Rpb24gKHByb3BlcnRpZXMpIHsKICAgICAgaWYgKHByb3BlcnRpZXMgJiYgcHJvcGVydGllcy5xdWV1ZSA9PSB0cnVlKSB7CiAgICAgICAgLy8gcmVkcmF3IG9uY2Ugb24gbmV4dCB0aWNrCiAgICAgICAgaWYgKCFtZS5fcmVkcmF3VGltZXIpIHsKICAgICAgICAgIG1lLl9yZWRyYXdUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBtZS5fcmVkcmF3VGltZXIgPSBudWxsOwogICAgICAgICAgICBtZS5fcmVkcmF3KCk7CiAgICAgICAgICB9LCAwKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gcmVkcmF3IGltbWVkaWF0ZWx5CiAgICAgICAgbWUuX3JlZHJhdygpOwogICAgICB9CiAgICB9KTsKCiAgICAvLyBjcmVhdGUgZXZlbnQgbGlzdGVuZXJzIGZvciBhbGwgaW50ZXJlc3RpbmcgZXZlbnRzLCB0aGVzZSBldmVudHMgd2lsbCBiZQogICAgLy8gZW1pdHRlZCB2aWEgZW1pdHRlcgogICAgdGhpcy5oYW1tZXIgPSBuZXcgSGFtbWVyKHRoaXMuZG9tLnJvb3QpOwogICAgdGhpcy5oYW1tZXIuZ2V0KCdwaW5jaCcpLnNldCh7IGVuYWJsZTogdHJ1ZSB9KTsKICAgIHRoaXMubGlzdGVuZXJzID0ge307CgogICAgdmFyIGV2ZW50cyA9IFsndGFwJywgJ2RvdWJsZXRhcCcsICdwcmVzcycsICdwaW5jaCcsICdwYW4nLCAncGFuc3RhcnQnLCAncGFubW92ZScsICdwYW5lbmQnCiAgICAvLyBUT0RPOiBjbGVhbnVwCiAgICAvLyd0b3VjaCcsICdwaW5jaCcsCiAgICAvLyd0YXAnLCAnZG91YmxldGFwJywgJ2hvbGQnLAogICAgLy8nZHJhZ3N0YXJ0JywgJ2RyYWcnLCAnZHJhZ2VuZCcsCiAgICAvLydtb3VzZXdoZWVsJywgJ0RPTU1vdXNlU2Nyb2xsJyAvLyBET01Nb3VzZVNjcm9sbCBpcyBuZWVkZWQgZm9yIEZpcmVmb3gKICAgIF07CiAgICBldmVudHMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkgewogICAgICB2YXIgbGlzdGVuZXIgPSBmdW5jdGlvbiBsaXN0ZW5lcihldmVudCkgewogICAgICAgIGlmIChtZS5pc0FjdGl2ZSgpKSB7CiAgICAgICAgICBtZS5lbWl0KHR5cGUsIGV2ZW50KTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIG1lLmhhbW1lci5vbih0eXBlLCBsaXN0ZW5lcik7CiAgICAgIG1lLmxpc3RlbmVyc1t0eXBlXSA9IGxpc3RlbmVyOwogICAgfSk7CgogICAgLy8gZW11bGF0ZSBhIHRvdWNoIGV2ZW50IChlbWl0dGVkIGJlZm9yZSB0aGUgc3RhcnQgb2YgYSBwYW4sIHBpbmNoLCB0YXAsIG9yIHByZXNzKQogICAgaGFtbWVyVXRpbC5vblRvdWNoKHRoaXMuaGFtbWVyLCAoZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIG1lLmVtaXQoJ3RvdWNoJywgZXZlbnQpOwogICAgfSkuYmluZCh0aGlzKSk7CgogICAgLy8gZW11bGF0ZSBhIHJlbGVhc2UgZXZlbnQgKGVtaXR0ZWQgYWZ0ZXIgYSBwYW4sIHBpbmNoLCB0YXAsIG9yIHByZXNzKQogICAgaGFtbWVyVXRpbC5vblJlbGVhc2UodGhpcy5oYW1tZXIsIChmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgbWUuZW1pdCgncmVsZWFzZScsIGV2ZW50KTsKICAgIH0pLmJpbmQodGhpcykpOwoKICAgIGZ1bmN0aW9uIG9uTW91c2VXaGVlbChldmVudCkgewogICAgICBpZiAobWUuaXNBY3RpdmUoKSkgewogICAgICAgIG1lLmVtaXQoJ21vdXNld2hlZWwnLCBldmVudCk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZG9tLnJvb3QuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V3aGVlbCcsIG9uTW91c2VXaGVlbCk7CiAgICB0aGlzLmRvbS5yb290LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU1vdXNlU2Nyb2xsJywgb25Nb3VzZVdoZWVsKTsKCiAgICAvLyBzaXplIHByb3BlcnRpZXMgb2YgZWFjaCBvZiB0aGUgcGFuZWxzCiAgICB0aGlzLnByb3BzID0gewogICAgICByb290OiB7fSwKICAgICAgYmFja2dyb3VuZDoge30sCiAgICAgIGNlbnRlckNvbnRhaW5lcjoge30sCiAgICAgIGxlZnRDb250YWluZXI6IHt9LAogICAgICByaWdodENvbnRhaW5lcjoge30sCiAgICAgIGNlbnRlcjoge30sCiAgICAgIGxlZnQ6IHt9LAogICAgICByaWdodDoge30sCiAgICAgIHRvcDoge30sCiAgICAgIGJvdHRvbToge30sCiAgICAgIGJvcmRlcjoge30sCiAgICAgIHNjcm9sbFRvcDogMCwKICAgICAgc2Nyb2xsVG9wTWluOiAwCiAgICB9OwoKICAgIHRoaXMuY3VzdG9tVGltZXMgPSBbXTsKCiAgICAvLyBzdG9yZSBzdGF0ZSBpbmZvcm1hdGlvbiBuZWVkZWQgZm9yIHRvdWNoIGV2ZW50cwogICAgdGhpcy50b3VjaCA9IHt9OwoKICAgIHRoaXMucmVkcmF3Q291bnQgPSAwOwoKICAgIC8vIGF0dGFjaCB0aGUgcm9vdCBwYW5lbCB0byB0aGUgcHJvdmlkZWQgY29udGFpbmVyCiAgICBpZiAoIWNvbnRhaW5lcikgdGhyb3cgbmV3IEVycm9yKCdObyBjb250YWluZXIgcHJvdmlkZWQnKTsKICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmRvbS5yb290KTsKICB9OwoKICAvKioKICAgKiBTZXQgb3B0aW9ucy4gT3B0aW9ucyB3aWxsIGJlIHBhc3NlZCB0byBhbGwgY29tcG9uZW50cyBsb2FkZWQgaW4gdGhlIFRpbWVsaW5lLgogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmd9IG9yaWVudGF0aW9uCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWZXJ0aWNhbCBvcmllbnRhdGlvbiBmb3IgdGhlIFRpbWVsaW5lLAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FuIGJlICdib3R0b20nIChkZWZhdWx0KSBvciAndG9wJy4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmcgfCBOdW1iZXJ9IHdpZHRoCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXaWR0aCBmb3IgdGhlIHRpbWVsaW5lLCBhIG51bWJlciBpbiBwaXhlbHMgb3IKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgY3NzIHN0cmluZyBsaWtlICcxMDAwcHgnIG9yICc3NSUnLiAnMTAwJScgYnkgZGVmYXVsdC4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmcgfCBOdW1iZXJ9IGhlaWdodAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRml4ZWQgaGVpZ2h0IGZvciB0aGUgVGltZWxpbmUsIGEgbnVtYmVyIGluIHBpeGVscyBvcgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYSBjc3Mgc3RyaW5nIGxpa2UgJzQwMHB4JyBvciAnNzUlJy4gSWYgdW5kZWZpbmVkLAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhlIFRpbWVsaW5lIHdpbGwgYXV0b21hdGljYWxseSBzaXplIHN1Y2ggdGhhdAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRzIGNvbnRlbnRzIGZpdC4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmcgfCBOdW1iZXJ9IG1pbkhlaWdodAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWluaW11bSBoZWlnaHQgZm9yIHRoZSBUaW1lbGluZSwgYSBudW1iZXIgaW4gcGl4ZWxzIG9yCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhIGNzcyBzdHJpbmcgbGlrZSAnNDAwcHgnIG9yICc3NSUnLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAge1N0cmluZyB8IE51bWJlcn0gbWF4SGVpZ2h0CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXhpbXVtIGhlaWdodCBmb3IgdGhlIFRpbWVsaW5lLCBhIG51bWJlciBpbiBwaXhlbHMgb3IKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEgY3NzIHN0cmluZyBsaWtlICc0MDBweCcgb3IgJzc1JScuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB7TnVtYmVyIHwgRGF0ZSB8IFN0cmluZ30gc3RhcnQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0IGRhdGUgZm9yIHRoZSB2aXNpYmxlIHdpbmRvdwogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAge051bWJlciB8IERhdGUgfCBTdHJpbmd9IGVuZAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRW5kIGRhdGUgZm9yIHRoZSB2aXNpYmxlIHdpbmRvdwogICAqLwogIENvcmUucHJvdG90eXBlLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMpIHsKICAgICAgLy8gY29weSB0aGUga25vd24gb3B0aW9ucwogICAgICB2YXIgZmllbGRzID0gWyd3aWR0aCcsICdoZWlnaHQnLCAnbWluSGVpZ2h0JywgJ21heEhlaWdodCcsICdhdXRvUmVzaXplJywgJ3N0YXJ0JywgJ2VuZCcsICdjbGlja1RvVXNlJywgJ2RhdGFBdHRyaWJ1dGVzJywgJ2hpZGRlbkRhdGVzJ107CiAgICAgIHV0aWwuc2VsZWN0aXZlRXh0ZW5kKGZpZWxkcywgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKCiAgICAgIGlmICgnb3JpZW50YXRpb24nIGluIG9wdGlvbnMpIHsKICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMub3JpZW50YXRpb24gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICB0aGlzLm9wdGlvbnMub3JpZW50YXRpb24gPSB7CiAgICAgICAgICAgIGl0ZW06IG9wdGlvbnMub3JpZW50YXRpb24sCiAgICAgICAgICAgIGF4aXM6IG9wdGlvbnMub3JpZW50YXRpb24KICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucy5vcmllbnRhdGlvbiA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIGlmICgnaXRlbScgaW4gb3B0aW9ucy5vcmllbnRhdGlvbikgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMub3JpZW50YXRpb24uaXRlbSA9IG9wdGlvbnMub3JpZW50YXRpb24uaXRlbTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICgnYXhpcycgaW4gb3B0aW9ucy5vcmllbnRhdGlvbikgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMub3JpZW50YXRpb24uYXhpcyA9IG9wdGlvbnMub3JpZW50YXRpb24uYXhpczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLm9wdGlvbnMub3JpZW50YXRpb24uYXhpcyA9PT0gJ2JvdGgnKSB7CiAgICAgICAgaWYgKCF0aGlzLnRpbWVBeGlzMikgewogICAgICAgICAgdmFyIHRpbWVBeGlzMiA9IHRoaXMudGltZUF4aXMyID0gbmV3IFRpbWVBeGlzKHRoaXMuYm9keSk7CiAgICAgICAgICB0aW1lQXhpczIuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBfb3B0aW9ucyA9IG9wdGlvbnMgPyB1dGlsLmV4dGVuZCh7fSwgb3B0aW9ucykgOiB7fTsKICAgICAgICAgICAgX29wdGlvbnMub3JpZW50YXRpb24gPSAndG9wJzsgLy8gb3ZlcnJpZGUgdGhlIG9yaWVudGF0aW9uIG9wdGlvbiwgYWx3YXlzIHRvcAogICAgICAgICAgICBUaW1lQXhpcy5wcm90b3R5cGUuc2V0T3B0aW9ucy5jYWxsKHRpbWVBeGlzMiwgX29wdGlvbnMpOwogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMuY29tcG9uZW50cy5wdXNoKHRpbWVBeGlzMik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0aGlzLnRpbWVBeGlzMikgewogICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5jb21wb25lbnRzLmluZGV4T2YodGhpcy50aW1lQXhpczIpOwogICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgICB0aGlzLmNvbXBvbmVudHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMudGltZUF4aXMyLmRlc3Ryb3koKTsKICAgICAgICAgIHRoaXMudGltZUF4aXMyID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICgnaGlkZGVuRGF0ZXMnIGluIHRoaXMub3B0aW9ucykgewogICAgICAgIERhdGVVdGlsLmNvbnZlcnRIaWRkZW5PcHRpb25zKHRoaXMuYm9keSwgdGhpcy5vcHRpb25zLmhpZGRlbkRhdGVzKTsKICAgICAgfQoKICAgICAgaWYgKCdjbGlja1RvVXNlJyBpbiBvcHRpb25zKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuY2xpY2tUb1VzZSkgewogICAgICAgICAgaWYgKCF0aGlzLmFjdGl2YXRvcikgewogICAgICAgICAgICB0aGlzLmFjdGl2YXRvciA9IG5ldyBBY3RpdmF0b3IodGhpcy5kb20ucm9vdCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0aGlzLmFjdGl2YXRvcikgewogICAgICAgICAgICB0aGlzLmFjdGl2YXRvci5kZXN0cm95KCk7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmFjdGl2YXRvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICgnc2hvd0N1c3RvbVRpbWUnIGluIG9wdGlvbnMpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ09wdGlvbiBgc2hvd0N1c3RvbVRpbWVgIGlzIGRlcHJlY2F0ZWQuIENyZWF0ZSBhIGN1c3RvbSB0aW1lIGJhciB2aWEgdGltZWxpbmUuYWRkQ3VzdG9tVGltZSh0aW1lIFssIGlkXSknKTsKICAgICAgfQoKICAgICAgLy8gZW5hYmxlL2Rpc2FibGUgYXV0b1Jlc2l6ZQogICAgICB0aGlzLl9pbml0QXV0b1Jlc2l6ZSgpOwogICAgfQoKICAgIC8vIHByb3BhZ2F0ZSBvcHRpb25zIHRvIGFsbCBjb21wb25lbnRzCiAgICB0aGlzLmNvbXBvbmVudHMuZm9yRWFjaChmdW5jdGlvbiAoY29tcG9uZW50KSB7CiAgICAgIHJldHVybiBjb21wb25lbnQuc2V0T3B0aW9ucyhvcHRpb25zKTsKICAgIH0pOwoKICAgIC8vIGVuYWJsZS9kaXNhYmxlIGNvbmZpZ3VyZQogICAgaWYgKCdjb25maWd1cmUnIGluIG9wdGlvbnMpIHsKICAgICAgaWYgKCF0aGlzLmNvbmZpZ3VyYXRvcikgewogICAgICAgIHRoaXMuY29uZmlndXJhdG9yID0gdGhpcy5fY3JlYXRlQ29uZmlndXJhdG9yKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY29uZmlndXJhdG9yLnNldE9wdGlvbnMob3B0aW9ucy5jb25maWd1cmUpOwoKICAgICAgLy8gY29sbGVjdCB0aGUgc2V0dGluZ3Mgb2YgYWxsIGNvbXBvbmVudHMsIGFuZCBwYXNzIHRoZW0gdG8gdGhlIGNvbmZpZ3VyYXRpb24gc3lzdGVtCiAgICAgIHZhciBhcHBsaWVkT3B0aW9ucyA9IHV0aWwuZGVlcEV4dGVuZCh7fSwgdGhpcy5vcHRpb25zKTsKICAgICAgdGhpcy5jb21wb25lbnRzLmZvckVhY2goZnVuY3Rpb24gKGNvbXBvbmVudCkgewogICAgICAgIHV0aWwuZGVlcEV4dGVuZChhcHBsaWVkT3B0aW9ucywgY29tcG9uZW50Lm9wdGlvbnMpOwogICAgICB9KTsKICAgICAgdGhpcy5jb25maWd1cmF0b3Iuc2V0TW9kdWxlT3B0aW9ucyh7IGdsb2JhbDogYXBwbGllZE9wdGlvbnMgfSk7CiAgICB9CgogICAgLy8gcmVkcmF3IGV2ZXJ5dGhpbmcKICAgIHRoaXMuX3JlZHJhdygpOwogIH07CgogIC8qKgogICAqIFJldHVybnMgdHJ1ZSB3aGVuIHRoZSBUaW1lbGluZSBpcyBhY3RpdmUuCiAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICovCiAgQ29yZS5wcm90b3R5cGUuaXNBY3RpdmUgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gIXRoaXMuYWN0aXZhdG9yIHx8IHRoaXMuYWN0aXZhdG9yLmFjdGl2ZTsKICB9OwoKICAvKioKICAgKiBEZXN0cm95IHRoZSBDb3JlLCBjbGVhbiB1cCBhbGwgRE9NIGVsZW1lbnRzIGFuZCBldmVudCBsaXN0ZW5lcnMuCiAgICovCiAgQ29yZS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIHVuYmluZCBkYXRhc2V0cwogICAgdGhpcy5zZXRJdGVtcyhudWxsKTsKICAgIHRoaXMuc2V0R3JvdXBzKG51bGwpOwoKICAgIC8vIHJlbW92ZSBhbGwgZXZlbnQgbGlzdGVuZXJzCiAgICB0aGlzLm9mZigpOwoKICAgIC8vIHN0b3AgY2hlY2tpbmcgZm9yIGNoYW5nZWQgc2l6ZQogICAgdGhpcy5fc3RvcEF1dG9SZXNpemUoKTsKCiAgICAvLyByZW1vdmUgZnJvbSBET00KICAgIGlmICh0aGlzLmRvbS5yb290LnBhcmVudE5vZGUpIHsKICAgICAgdGhpcy5kb20ucm9vdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZG9tLnJvb3QpOwogICAgfQogICAgdGhpcy5kb20gPSBudWxsOwoKICAgIC8vIHJlbW92ZSBBY3RpdmF0b3IKICAgIGlmICh0aGlzLmFjdGl2YXRvcikgewogICAgICB0aGlzLmFjdGl2YXRvci5kZXN0cm95KCk7CiAgICAgIGRlbGV0ZSB0aGlzLmFjdGl2YXRvcjsKICAgIH0KCiAgICAvLyBjbGVhbnVwIGhhbW1lciB0b3VjaCBldmVudHMKICAgIGZvciAodmFyIGV2ZW50IGluIHRoaXMubGlzdGVuZXJzKSB7CiAgICAgIGlmICh0aGlzLmxpc3RlbmVycy5oYXNPd25Qcm9wZXJ0eShldmVudCkpIHsKICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNbZXZlbnRdOwogICAgICB9CiAgICB9CiAgICB0aGlzLmxpc3RlbmVycyA9IG51bGw7CiAgICB0aGlzLmhhbW1lciA9IG51bGw7CgogICAgLy8gZ2l2ZSBhbGwgY29tcG9uZW50cyB0aGUgb3Bwb3J0dW5pdHkgdG8gY2xlYW51cAogICAgdGhpcy5jb21wb25lbnRzLmZvckVhY2goZnVuY3Rpb24gKGNvbXBvbmVudCkgewogICAgICByZXR1cm4gY29tcG9uZW50LmRlc3Ryb3koKTsKICAgIH0pOwoKICAgIHRoaXMuYm9keSA9IG51bGw7CiAgfTsKCiAgLyoqCiAgICogU2V0IGEgY3VzdG9tIHRpbWUgYmFyCiAgICogQHBhcmFtIHtEYXRlfSB0aW1lCiAgICogQHBhcmFtIHtudW1iZXJ9IFtpZD11bmRlZmluZWRdIE9wdGlvbmFsIGlkIG9mIHRoZSBjdXN0b20gdGltZSBiYXIgdG8gYmUgYWRqdXN0ZWQuCiAgICovCiAgQ29yZS5wcm90b3R5cGUuc2V0Q3VzdG9tVGltZSA9IGZ1bmN0aW9uICh0aW1lLCBpZCkgewogICAgdmFyIGN1c3RvbVRpbWVzID0gdGhpcy5jdXN0b21UaW1lcy5maWx0ZXIoZnVuY3Rpb24gKGNvbXBvbmVudCkgewogICAgICByZXR1cm4gaWQgPT09IGNvbXBvbmVudC5vcHRpb25zLmlkOwogICAgfSk7CgogICAgaWYgKGN1c3RvbVRpbWVzLmxlbmd0aCA9PT0gMCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGN1c3RvbSB0aW1lIGJhciBmb3VuZCB3aXRoIGlkICcgKyBKU09OLnN0cmluZ2lmeShpZCkpOwogICAgfQoKICAgIGlmIChjdXN0b21UaW1lcy5sZW5ndGggPiAwKSB7CiAgICAgIGN1c3RvbVRpbWVzWzBdLnNldEN1c3RvbVRpbWUodGltZSk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmV0cmlldmUgdGhlIGN1cnJlbnQgY3VzdG9tIHRpbWUuCiAgICogQHBhcmFtIHtudW1iZXJ9IFtpZD11bmRlZmluZWRdICAgIElkIG9mIHRoZSBjdXN0b20gdGltZSBiYXIuCiAgICogQHJldHVybiB7RGF0ZSB8IHVuZGVmaW5lZH0gY3VzdG9tVGltZQogICAqLwogIENvcmUucHJvdG90eXBlLmdldEN1c3RvbVRpbWUgPSBmdW5jdGlvbiAoaWQpIHsKICAgIHZhciBjdXN0b21UaW1lcyA9IHRoaXMuY3VzdG9tVGltZXMuZmlsdGVyKGZ1bmN0aW9uIChjb21wb25lbnQpIHsKICAgICAgcmV0dXJuIGNvbXBvbmVudC5vcHRpb25zLmlkID09PSBpZDsKICAgIH0pOwoKICAgIGlmIChjdXN0b21UaW1lcy5sZW5ndGggPT09IDApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBjdXN0b20gdGltZSBiYXIgZm91bmQgd2l0aCBpZCAnICsgSlNPTi5zdHJpbmdpZnkoaWQpKTsKICAgIH0KICAgIHJldHVybiBjdXN0b21UaW1lc1swXS5nZXRDdXN0b21UaW1lKCk7CiAgfTsKCiAgLyoqCiAgICogQWRkIGN1c3RvbSB2ZXJ0aWNhbCBiYXIKICAgKiBAcGFyYW0ge0RhdGUgfCBTdHJpbmcgfCBOdW1iZXJ9IFt0aW1lXSAgQSBEYXRlLCB1bml4IHRpbWVzdGFtcCwgb3IKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSVNPIGRhdGUgc3RyaW5nLiBUaW1lIHBvaW50IHdoZXJlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBuZXcgYmFyIHNob3VsZCBiZSBwbGFjZWQuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIG5vdCBwcm92aWRlZCwgYG5ldyBEYXRlKClgIHdpbGwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmUgdXNlZC4KICAgKiBAcGFyYW0ge051bWJlciB8IFN0cmluZ30gW2lkPXVuZGVmaW5lZF0gSWQgb2YgdGhlIG5ldyBiYXIuIE9wdGlvbmFsCiAgICogQHJldHVybiB7TnVtYmVyIHwgU3RyaW5nfSAgICAgICAgICAgICAgIFJldHVybnMgdGhlIGlkIG9mIHRoZSBuZXcgYmFyCiAgICovCiAgQ29yZS5wcm90b3R5cGUuYWRkQ3VzdG9tVGltZSA9IGZ1bmN0aW9uICh0aW1lLCBpZCkgewogICAgdmFyIHRpbWVzdGFtcCA9IHRpbWUgIT09IHVuZGVmaW5lZCA/IHV0aWwuY29udmVydCh0aW1lLCAnRGF0ZScpLnZhbHVlT2YoKSA6IG5ldyBEYXRlKCk7CgogICAgdmFyIGV4aXN0cyA9IHRoaXMuY3VzdG9tVGltZXMuc29tZShmdW5jdGlvbiAoY3VzdG9tVGltZSkgewogICAgICByZXR1cm4gY3VzdG9tVGltZS5vcHRpb25zLmlkID09PSBpZDsKICAgIH0pOwogICAgaWYgKGV4aXN0cykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0EgY3VzdG9tIHRpbWUgd2l0aCBpZCAnICsgSlNPTi5zdHJpbmdpZnkoaWQpICsgJyBhbHJlYWR5IGV4aXN0cycpOwogICAgfQoKICAgIHZhciBjdXN0b21UaW1lID0gbmV3IEN1c3RvbVRpbWUodGhpcy5ib2R5LCB7CiAgICAgIHRpbWU6IHRpbWVzdGFtcCwKICAgICAgaWQ6IGlkCiAgICB9KTsKCiAgICB0aGlzLmN1c3RvbVRpbWVzLnB1c2goY3VzdG9tVGltZSk7CiAgICB0aGlzLmNvbXBvbmVudHMucHVzaChjdXN0b21UaW1lKTsKICAgIHRoaXMucmVkcmF3KCk7CgogICAgcmV0dXJuIGlkOwogIH07CgogIC8qKgogICAqIFJlbW92ZSBwcmV2aW91c2x5IGFkZGVkIGN1c3RvbSBiYXIKICAgKiBAcGFyYW0ge2ludH0gaWQgSUQgb2YgdGhlIGN1c3RvbSBiYXIgdG8gYmUgcmVtb3ZlZAogICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGJhciBleGlzdHMgYW5kIGlzIHJlbW92ZWQsIGZhbHNlIG90aGVyd2lzZQogICAqLwogIENvcmUucHJvdG90eXBlLnJlbW92ZUN1c3RvbVRpbWUgPSBmdW5jdGlvbiAoaWQpIHsKICAgIHZhciBjdXN0b21UaW1lcyA9IHRoaXMuY3VzdG9tVGltZXMuZmlsdGVyKGZ1bmN0aW9uIChiYXIpIHsKICAgICAgcmV0dXJuIGJhci5vcHRpb25zLmlkID09PSBpZDsKICAgIH0pOwoKICAgIGlmIChjdXN0b21UaW1lcy5sZW5ndGggPT09IDApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBjdXN0b20gdGltZSBiYXIgZm91bmQgd2l0aCBpZCAnICsgSlNPTi5zdHJpbmdpZnkoaWQpKTsKICAgIH0KCiAgICBjdXN0b21UaW1lcy5mb3JFYWNoKChmdW5jdGlvbiAoY3VzdG9tVGltZSkgewogICAgICB0aGlzLmN1c3RvbVRpbWVzLnNwbGljZSh0aGlzLmN1c3RvbVRpbWVzLmluZGV4T2YoY3VzdG9tVGltZSksIDEpOwogICAgICB0aGlzLmNvbXBvbmVudHMuc3BsaWNlKHRoaXMuY29tcG9uZW50cy5pbmRleE9mKGN1c3RvbVRpbWUpLCAxKTsKICAgICAgY3VzdG9tVGltZS5kZXN0cm95KCk7CiAgICB9KS5iaW5kKHRoaXMpKTsKICB9OwoKICAvKioKICAgKiBHZXQgdGhlIGlkJ3Mgb2YgdGhlIGN1cnJlbnRseSB2aXNpYmxlIGl0ZW1zLgogICAqIEByZXR1cm5zIHtBcnJheX0gVGhlIGlkcyBvZiB0aGUgdmlzaWJsZSBpdGVtcwogICAqLwogIENvcmUucHJvdG90eXBlLmdldFZpc2libGVJdGVtcyA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLml0ZW1TZXQgJiYgdGhpcy5pdGVtU2V0LmdldFZpc2libGVJdGVtcygpIHx8IFtdOwogIH07CgogIC8qKgogICAqIFNldCBDb3JlIHdpbmRvdyBzdWNoIHRoYXQgaXQgZml0cyBhbGwgaXRlbXMKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICBBdmFpbGFibGUgb3B0aW9uczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGFuaW1hdGlvbjogYm9vbGVhbiB8IHtkdXJhdGlvbjogbnVtYmVyLCBlYXNpbmdGdW5jdGlvbjogc3RyaW5nfWAKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIHRydWUgKGRlZmF1bHQpLCB0aGUgcmFuZ2UgaXMgYW5pbWF0ZWQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtb290aGx5IHRvIHRoZSBuZXcgd2luZG93LiBBbiBvYmplY3QgY2FuIGJlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZCB0byBzcGVjaWZ5IGR1cmF0aW9uIGFuZCBlYXNpbmcgZnVuY3Rpb24uCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IGR1cmF0aW9uIGlzIDUwMCBtcywgYW5kIGRlZmF1bHQgZWFzaW5nCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBpcyAnZWFzZUluT3V0UXVhZCcuCiAgICovCiAgQ29yZS5wcm90b3R5cGUuZml0ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIHZhciByYW5nZSA9IHRoaXMuZ2V0RGF0YVJhbmdlKCk7CgogICAgLy8gc2tpcCByYW5nZSBzZXQgaWYgdGhlcmUgaXMgbm8gbWluIGFuZCBtYXggZGF0ZQogICAgaWYgKHJhbmdlLm1pbiA9PT0gbnVsbCAmJiByYW5nZS5tYXggPT09IG51bGwpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIGFwcGx5IGEgbWFyZ2luIG9mIDElIGxlZnQgYW5kIHJpZ2h0IG9mIHRoZSBkYXRhCiAgICB2YXIgaW50ZXJ2YWwgPSByYW5nZS5tYXggLSByYW5nZS5taW47CiAgICB2YXIgbWluID0gbmV3IERhdGUocmFuZ2UubWluLnZhbHVlT2YoKSAtIGludGVydmFsICogMC4wMSk7CiAgICB2YXIgbWF4ID0gbmV3IERhdGUocmFuZ2UubWF4LnZhbHVlT2YoKSArIGludGVydmFsICogMC4wMSk7CgogICAgdmFyIGFuaW1hdGlvbiA9IG9wdGlvbnMgJiYgb3B0aW9ucy5hbmltYXRpb24gIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYW5pbWF0aW9uIDogdHJ1ZTsKICAgIHRoaXMucmFuZ2Uuc2V0UmFuZ2UobWluLCBtYXgsIGFuaW1hdGlvbik7CiAgfTsKCiAgLyoqCiAgICogQ2FsY3VsYXRlIHRoZSBkYXRhIHJhbmdlIG9mIHRoZSBpdGVtcyBzdGFydCBhbmQgZW5kIGRhdGVzCiAgICogQHJldHVybnMge3ttaW46IERhdGUgfCBudWxsLCBtYXg6IERhdGUgfCBudWxsfX0KICAgKiBAcHJvdGVjdGVkCiAgICovCiAgQ29yZS5wcm90b3R5cGUuZ2V0RGF0YVJhbmdlID0gZnVuY3Rpb24gKCkgewogICAgLy8gbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBUaW1lbGluZSBhbmQgR3JhcGgyZAogICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgaW52b2tlIGFic3RyYWN0IG1ldGhvZCBnZXREYXRhUmFuZ2UnKTsKICB9OwoKICAvKioKICAgKiBTZXQgdGhlIHZpc2libGUgd2luZG93LiBCb3RoIHBhcmFtZXRlcnMgYXJlIG9wdGlvbmFsLCB5b3UgY2FuIGNoYW5nZSBvbmx5CiAgICogc3RhcnQgb3Igb25seSBlbmQuIFN5bnRheDoKICAgKgogICAqICAgICBUaW1lTGluZS5zZXRXaW5kb3coc3RhcnQsIGVuZCkKICAgKiAgICAgVGltZUxpbmUuc2V0V2luZG93KHN0YXJ0LCBlbmQsIG9wdGlvbnMpCiAgICogICAgIFRpbWVMaW5lLnNldFdpbmRvdyhyYW5nZSkKICAgKgogICAqIFdoZXJlIHN0YXJ0IGFuZCBlbmQgY2FuIGJlIGEgRGF0ZSwgbnVtYmVyLCBvciBzdHJpbmcsIGFuZCByYW5nZSBpcyBhbgogICAqIG9iamVjdCB3aXRoIHByb3BlcnRpZXMgc3RhcnQgYW5kIGVuZC4KICAgKgogICAqIEBwYXJhbSB7RGF0ZSB8IE51bWJlciB8IFN0cmluZyB8IE9iamVjdH0gW3N0YXJ0XSBTdGFydCBkYXRlIG9mIHZpc2libGUgd2luZG93CiAgICogQHBhcmFtIHtEYXRlIHwgTnVtYmVyIHwgU3RyaW5nfSBbZW5kXSAgICAgICAgICAgIEVuZCBkYXRlIG9mIHZpc2libGUgd2luZG93CiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgQXZhaWxhYmxlIG9wdGlvbnM6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBhbmltYXRpb246IGJvb2xlYW4gfCB7ZHVyYXRpb246IG51bWJlciwgZWFzaW5nRnVuY3Rpb246IHN0cmluZ31gCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZiB0cnVlIChkZWZhdWx0KSwgdGhlIHJhbmdlIGlzIGFuaW1hdGVkCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbW9vdGhseSB0byB0aGUgbmV3IHdpbmRvdy4gQW4gb2JqZWN0IGNhbiBiZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZWQgdG8gc3BlY2lmeSBkdXJhdGlvbiBhbmQgZWFzaW5nIGZ1bmN0aW9uLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCBkdXJhdGlvbiBpcyA1MDAgbXMsIGFuZCBkZWZhdWx0IGVhc2luZwogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gaXMgJ2Vhc2VJbk91dFF1YWQnLgogICAqLwogIENvcmUucHJvdG90eXBlLnNldFdpbmRvdyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kLCBvcHRpb25zKSB7CiAgICB2YXIgYW5pbWF0aW9uOwogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgewogICAgICB2YXIgcmFuZ2UgPSBhcmd1bWVudHNbMF07CiAgICAgIGFuaW1hdGlvbiA9IHJhbmdlLmFuaW1hdGlvbiAhPT0gdW5kZWZpbmVkID8gcmFuZ2UuYW5pbWF0aW9uIDogdHJ1ZTsKICAgICAgdGhpcy5yYW5nZS5zZXRSYW5nZShyYW5nZS5zdGFydCwgcmFuZ2UuZW5kLCBhbmltYXRpb24pOwogICAgfSBlbHNlIHsKICAgICAgYW5pbWF0aW9uID0gb3B0aW9ucyAmJiBvcHRpb25zLmFuaW1hdGlvbiAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5hbmltYXRpb24gOiB0cnVlOwogICAgICB0aGlzLnJhbmdlLnNldFJhbmdlKHN0YXJ0LCBlbmQsIGFuaW1hdGlvbik7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogTW92ZSB0aGUgd2luZG93IHN1Y2ggdGhhdCBnaXZlbiB0aW1lIGlzIGNlbnRlcmVkIG9uIHNjcmVlbi4KICAgKiBAcGFyYW0ge0RhdGUgfCBOdW1iZXIgfCBTdHJpbmd9IHRpbWUKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICBBdmFpbGFibGUgb3B0aW9uczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGFuaW1hdGlvbjogYm9vbGVhbiB8IHtkdXJhdGlvbjogbnVtYmVyLCBlYXNpbmdGdW5jdGlvbjogc3RyaW5nfWAKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIHRydWUgKGRlZmF1bHQpLCB0aGUgcmFuZ2UgaXMgYW5pbWF0ZWQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNtb290aGx5IHRvIHRoZSBuZXcgd2luZG93LiBBbiBvYmplY3QgY2FuIGJlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlZCB0byBzcGVjaWZ5IGR1cmF0aW9uIGFuZCBlYXNpbmcgZnVuY3Rpb24uCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IGR1cmF0aW9uIGlzIDUwMCBtcywgYW5kIGRlZmF1bHQgZWFzaW5nCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBpcyAnZWFzZUluT3V0UXVhZCcuCiAgICovCiAgQ29yZS5wcm90b3R5cGUubW92ZVRvID0gZnVuY3Rpb24gKHRpbWUsIG9wdGlvbnMpIHsKICAgIHZhciBpbnRlcnZhbCA9IHRoaXMucmFuZ2UuZW5kIC0gdGhpcy5yYW5nZS5zdGFydDsKICAgIHZhciB0ID0gdXRpbC5jb252ZXJ0KHRpbWUsICdEYXRlJykudmFsdWVPZigpOwoKICAgIHZhciBzdGFydCA9IHQgLSBpbnRlcnZhbCAvIDI7CiAgICB2YXIgZW5kID0gdCArIGludGVydmFsIC8gMjsKICAgIHZhciBhbmltYXRpb24gPSBvcHRpb25zICYmIG9wdGlvbnMuYW5pbWF0aW9uICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmFuaW1hdGlvbiA6IHRydWU7CgogICAgdGhpcy5yYW5nZS5zZXRSYW5nZShzdGFydCwgZW5kLCBhbmltYXRpb24pOwogIH07CgogIC8qKgogICAqIEdldCB0aGUgdmlzaWJsZSB3aW5kb3cKICAgKiBAcmV0dXJuIHt7c3RhcnQ6IERhdGUsIGVuZDogRGF0ZX19ICAgVmlzaWJsZSByYW5nZQogICAqLwogIENvcmUucHJvdG90eXBlLmdldFdpbmRvdyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciByYW5nZSA9IHRoaXMucmFuZ2UuZ2V0UmFuZ2UoKTsKICAgIHJldHVybiB7CiAgICAgIHN0YXJ0OiBuZXcgRGF0ZShyYW5nZS5zdGFydCksCiAgICAgIGVuZDogbmV3IERhdGUocmFuZ2UuZW5kKQogICAgfTsKICB9OwoKICAvKioKICAgKiBGb3JjZSBhIHJlZHJhdy4gQ2FuIGJlIG92ZXJyaWRkZW4gYnkgaW1wbGVtZW50YXRpb25zIG9mIENvcmUKICAgKi8KICBDb3JlLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLl9yZWRyYXcoKTsKICB9OwoKICAvKioKICAgKiBSZWRyYXcgZm9yIGludGVybmFsIHVzZS4gUmVkcmF3cyBhbGwgY29tcG9uZW50cy4gU2VlIGFsc28gdGhlIHB1YmxpYwogICAqIG1ldGhvZCByZWRyYXcuCiAgICogQHByb3RlY3RlZAogICAqLwogIENvcmUucHJvdG90eXBlLl9yZWRyYXcgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgcmVzaXplZCA9IGZhbHNlOwogICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CiAgICB2YXIgcHJvcHMgPSB0aGlzLnByb3BzOwogICAgdmFyIGRvbSA9IHRoaXMuZG9tOwoKICAgIGlmICghZG9tKSByZXR1cm47IC8vIHdoZW4gZGVzdHJveWVkCgogICAgRGF0ZVV0aWwudXBkYXRlSGlkZGVuRGF0ZXModGhpcy5ib2R5LCB0aGlzLm9wdGlvbnMuaGlkZGVuRGF0ZXMpOwoKICAgIC8vIHVwZGF0ZSBjbGFzcyBuYW1lcwogICAgaWYgKG9wdGlvbnMub3JpZW50YXRpb24gPT0gJ3RvcCcpIHsKICAgICAgdXRpbC5hZGRDbGFzc05hbWUoZG9tLnJvb3QsICd2aXMtdG9wJyk7CiAgICAgIHV0aWwucmVtb3ZlQ2xhc3NOYW1lKGRvbS5yb290LCAndmlzLWJvdHRvbScpOwogICAgfSBlbHNlIHsKICAgICAgdXRpbC5yZW1vdmVDbGFzc05hbWUoZG9tLnJvb3QsICd2aXMtdG9wJyk7CiAgICAgIHV0aWwuYWRkQ2xhc3NOYW1lKGRvbS5yb290LCAndmlzLWJvdHRvbScpOwogICAgfQoKICAgIC8vIHVwZGF0ZSByb290IHdpZHRoIGFuZCBoZWlnaHQgb3B0aW9ucwogICAgZG9tLnJvb3Quc3R5bGUubWF4SGVpZ2h0ID0gdXRpbC5vcHRpb24uYXNTaXplKG9wdGlvbnMubWF4SGVpZ2h0LCAnJyk7CiAgICBkb20ucm9vdC5zdHlsZS5taW5IZWlnaHQgPSB1dGlsLm9wdGlvbi5hc1NpemUob3B0aW9ucy5taW5IZWlnaHQsICcnKTsKICAgIGRvbS5yb290LnN0eWxlLndpZHRoID0gdXRpbC5vcHRpb24uYXNTaXplKG9wdGlvbnMud2lkdGgsICcnKTsKCiAgICAvLyBjYWxjdWxhdGUgYm9yZGVyIHdpZHRocwogICAgcHJvcHMuYm9yZGVyLmxlZnQgPSAoZG9tLmNlbnRlckNvbnRhaW5lci5vZmZzZXRXaWR0aCAtIGRvbS5jZW50ZXJDb250YWluZXIuY2xpZW50V2lkdGgpIC8gMjsKICAgIHByb3BzLmJvcmRlci5yaWdodCA9IHByb3BzLmJvcmRlci5sZWZ0OwogICAgcHJvcHMuYm9yZGVyLnRvcCA9IChkb20uY2VudGVyQ29udGFpbmVyLm9mZnNldEhlaWdodCAtIGRvbS5jZW50ZXJDb250YWluZXIuY2xpZW50SGVpZ2h0KSAvIDI7CiAgICBwcm9wcy5ib3JkZXIuYm90dG9tID0gcHJvcHMuYm9yZGVyLnRvcDsKICAgIHZhciBib3JkZXJSb290SGVpZ2h0ID0gZG9tLnJvb3Qub2Zmc2V0SGVpZ2h0IC0gZG9tLnJvb3QuY2xpZW50SGVpZ2h0OwogICAgdmFyIGJvcmRlclJvb3RXaWR0aCA9IGRvbS5yb290Lm9mZnNldFdpZHRoIC0gZG9tLnJvb3QuY2xpZW50V2lkdGg7CgogICAgLy8gd29ya2Fyb3VuZCBmb3IgYSBidWcgaW4gSUU6IHRoZSBjbGllbnRXaWR0aCBvZiBhbiBlbGVtZW50IHdpdGgKICAgIC8vIGEgaGVpZ2h0OjBweCBhbmQgb3ZlcmZsb3c6aGlkZGVuIGlzIG5vdCBjYWxjdWxhdGVkIGFuZCBhbHdheXMgaGFzIHZhbHVlIDAKICAgIGlmIChkb20uY2VudGVyQ29udGFpbmVyLmNsaWVudEhlaWdodCA9PT0gMCkgewogICAgICBwcm9wcy5ib3JkZXIubGVmdCA9IHByb3BzLmJvcmRlci50b3A7CiAgICAgIHByb3BzLmJvcmRlci5yaWdodCA9IHByb3BzLmJvcmRlci5sZWZ0OwogICAgfQogICAgaWYgKGRvbS5yb290LmNsaWVudEhlaWdodCA9PT0gMCkgewogICAgICBib3JkZXJSb290V2lkdGggPSBib3JkZXJSb290SGVpZ2h0OwogICAgfQoKICAgIC8vIGNhbGN1bGF0ZSB0aGUgaGVpZ2h0cy4gSWYgYW55IG9mIHRoZSBzaWRlIHBhbmVscyBpcyBlbXB0eSwgd2Ugc2V0IHRoZSBoZWlnaHQgdG8KICAgIC8vIG1pbnVzIHRoZSBib3JkZXIgd2lkdGgsIHN1Y2ggdGhhdCB0aGUgYm9yZGVyIHdpbGwgYmUgaW52aXNpYmxlCiAgICBwcm9wcy5jZW50ZXIuaGVpZ2h0ID0gZG9tLmNlbnRlci5vZmZzZXRIZWlnaHQ7CiAgICBwcm9wcy5sZWZ0LmhlaWdodCA9IGRvbS5sZWZ0Lm9mZnNldEhlaWdodDsKICAgIHByb3BzLnJpZ2h0LmhlaWdodCA9IGRvbS5yaWdodC5vZmZzZXRIZWlnaHQ7CiAgICBwcm9wcy50b3AuaGVpZ2h0ID0gZG9tLnRvcC5jbGllbnRIZWlnaHQgfHwgLXByb3BzLmJvcmRlci50b3A7CiAgICBwcm9wcy5ib3R0b20uaGVpZ2h0ID0gZG9tLmJvdHRvbS5jbGllbnRIZWlnaHQgfHwgLXByb3BzLmJvcmRlci5ib3R0b207CgogICAgLy8gVE9ETzogY29tcGVuc2F0ZSBib3JkZXJzIHdoZW4gYW55IG9mIHRoZSBwYW5lbHMgaXMgZW1wdHkuCgogICAgLy8gYXBwbHkgYXV0byBoZWlnaHQKICAgIC8vIFRPRE86IG9ubHkgY2FsY3VsYXRlIGF1dG9IZWlnaHQgd2hlbiBuZWVkZWQgKGVsc2Ugd2UgY2F1c2UgYW4gZXh0cmEgcmVmbG93L3JlcGFpbnQgb2YgdGhlIERPTSkKICAgIHZhciBjb250ZW50SGVpZ2h0ID0gTWF0aC5tYXgocHJvcHMubGVmdC5oZWlnaHQsIHByb3BzLmNlbnRlci5oZWlnaHQsIHByb3BzLnJpZ2h0LmhlaWdodCk7CiAgICB2YXIgYXV0b0hlaWdodCA9IHByb3BzLnRvcC5oZWlnaHQgKyBjb250ZW50SGVpZ2h0ICsgcHJvcHMuYm90dG9tLmhlaWdodCArIGJvcmRlclJvb3RIZWlnaHQgKyBwcm9wcy5ib3JkZXIudG9wICsgcHJvcHMuYm9yZGVyLmJvdHRvbTsKICAgIGRvbS5yb290LnN0eWxlLmhlaWdodCA9IHV0aWwub3B0aW9uLmFzU2l6ZShvcHRpb25zLmhlaWdodCwgYXV0b0hlaWdodCArICdweCcpOwoKICAgIC8vIGNhbGN1bGF0ZSBoZWlnaHRzIG9mIHRoZSBjb250ZW50IHBhbmVscwogICAgcHJvcHMucm9vdC5oZWlnaHQgPSBkb20ucm9vdC5vZmZzZXRIZWlnaHQ7CiAgICBwcm9wcy5iYWNrZ3JvdW5kLmhlaWdodCA9IHByb3BzLnJvb3QuaGVpZ2h0IC0gYm9yZGVyUm9vdEhlaWdodDsKICAgIHZhciBjb250YWluZXJIZWlnaHQgPSBwcm9wcy5yb290LmhlaWdodCAtIHByb3BzLnRvcC5oZWlnaHQgLSBwcm9wcy5ib3R0b20uaGVpZ2h0IC0gYm9yZGVyUm9vdEhlaWdodDsKICAgIHByb3BzLmNlbnRlckNvbnRhaW5lci5oZWlnaHQgPSBjb250YWluZXJIZWlnaHQ7CiAgICBwcm9wcy5sZWZ0Q29udGFpbmVyLmhlaWdodCA9IGNvbnRhaW5lckhlaWdodDsKICAgIHByb3BzLnJpZ2h0Q29udGFpbmVyLmhlaWdodCA9IHByb3BzLmxlZnRDb250YWluZXIuaGVpZ2h0OwoKICAgIC8vIGNhbGN1bGF0ZSB0aGUgd2lkdGhzIG9mIHRoZSBwYW5lbHMKICAgIHByb3BzLnJvb3Qud2lkdGggPSBkb20ucm9vdC5vZmZzZXRXaWR0aDsKICAgIHByb3BzLmJhY2tncm91bmQud2lkdGggPSBwcm9wcy5yb290LndpZHRoIC0gYm9yZGVyUm9vdFdpZHRoOwogICAgcHJvcHMubGVmdC53aWR0aCA9IGRvbS5sZWZ0Q29udGFpbmVyLmNsaWVudFdpZHRoIHx8IC1wcm9wcy5ib3JkZXIubGVmdDsKICAgIHByb3BzLmxlZnRDb250YWluZXIud2lkdGggPSBwcm9wcy5sZWZ0LndpZHRoOwogICAgcHJvcHMucmlnaHQud2lkdGggPSBkb20ucmlnaHRDb250YWluZXIuY2xpZW50V2lkdGggfHwgLXByb3BzLmJvcmRlci5yaWdodDsKICAgIHByb3BzLnJpZ2h0Q29udGFpbmVyLndpZHRoID0gcHJvcHMucmlnaHQud2lkdGg7CiAgICB2YXIgY2VudGVyV2lkdGggPSBwcm9wcy5yb290LndpZHRoIC0gcHJvcHMubGVmdC53aWR0aCAtIHByb3BzLnJpZ2h0LndpZHRoIC0gYm9yZGVyUm9vdFdpZHRoOwogICAgcHJvcHMuY2VudGVyLndpZHRoID0gY2VudGVyV2lkdGg7CiAgICBwcm9wcy5jZW50ZXJDb250YWluZXIud2lkdGggPSBjZW50ZXJXaWR0aDsKICAgIHByb3BzLnRvcC53aWR0aCA9IGNlbnRlcldpZHRoOwogICAgcHJvcHMuYm90dG9tLndpZHRoID0gY2VudGVyV2lkdGg7CgogICAgLy8gcmVzaXplIHRoZSBwYW5lbHMKICAgIGRvbS5iYWNrZ3JvdW5kLnN0eWxlLmhlaWdodCA9IHByb3BzLmJhY2tncm91bmQuaGVpZ2h0ICsgJ3B4JzsKICAgIGRvbS5iYWNrZ3JvdW5kVmVydGljYWwuc3R5bGUuaGVpZ2h0ID0gcHJvcHMuYmFja2dyb3VuZC5oZWlnaHQgKyAncHgnOwogICAgZG9tLmJhY2tncm91bmRIb3Jpem9udGFsLnN0eWxlLmhlaWdodCA9IHByb3BzLmNlbnRlckNvbnRhaW5lci5oZWlnaHQgKyAncHgnOwogICAgZG9tLmNlbnRlckNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBwcm9wcy5jZW50ZXJDb250YWluZXIuaGVpZ2h0ICsgJ3B4JzsKICAgIGRvbS5sZWZ0Q29udGFpbmVyLnN0eWxlLmhlaWdodCA9IHByb3BzLmxlZnRDb250YWluZXIuaGVpZ2h0ICsgJ3B4JzsKICAgIGRvbS5yaWdodENvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBwcm9wcy5yaWdodENvbnRhaW5lci5oZWlnaHQgKyAncHgnOwoKICAgIGRvbS5iYWNrZ3JvdW5kLnN0eWxlLndpZHRoID0gcHJvcHMuYmFja2dyb3VuZC53aWR0aCArICdweCc7CiAgICBkb20uYmFja2dyb3VuZFZlcnRpY2FsLnN0eWxlLndpZHRoID0gcHJvcHMuY2VudGVyQ29udGFpbmVyLndpZHRoICsgJ3B4JzsKICAgIGRvbS5iYWNrZ3JvdW5kSG9yaXpvbnRhbC5zdHlsZS53aWR0aCA9IHByb3BzLmJhY2tncm91bmQud2lkdGggKyAncHgnOwogICAgZG9tLmNlbnRlckNvbnRhaW5lci5zdHlsZS53aWR0aCA9IHByb3BzLmNlbnRlci53aWR0aCArICdweCc7CiAgICBkb20udG9wLnN0eWxlLndpZHRoID0gcHJvcHMudG9wLndpZHRoICsgJ3B4JzsKICAgIGRvbS5ib3R0b20uc3R5bGUud2lkdGggPSBwcm9wcy5ib3R0b20ud2lkdGggKyAncHgnOwoKICAgIC8vIHJlcG9zaXRpb24gdGhlIHBhbmVscwogICAgZG9tLmJhY2tncm91bmQuc3R5bGUubGVmdCA9ICcwJzsKICAgIGRvbS5iYWNrZ3JvdW5kLnN0eWxlLnRvcCA9ICcwJzsKICAgIGRvbS5iYWNrZ3JvdW5kVmVydGljYWwuc3R5bGUubGVmdCA9IHByb3BzLmxlZnQud2lkdGggKyBwcm9wcy5ib3JkZXIubGVmdCArICdweCc7CiAgICBkb20uYmFja2dyb3VuZFZlcnRpY2FsLnN0eWxlLnRvcCA9ICcwJzsKICAgIGRvbS5iYWNrZ3JvdW5kSG9yaXpvbnRhbC5zdHlsZS5sZWZ0ID0gJzAnOwogICAgZG9tLmJhY2tncm91bmRIb3Jpem9udGFsLnN0eWxlLnRvcCA9IHByb3BzLnRvcC5oZWlnaHQgKyAncHgnOwogICAgZG9tLmNlbnRlckNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gcHJvcHMubGVmdC53aWR0aCArICdweCc7CiAgICBkb20uY2VudGVyQ29udGFpbmVyLnN0eWxlLnRvcCA9IHByb3BzLnRvcC5oZWlnaHQgKyAncHgnOwogICAgZG9tLmxlZnRDb250YWluZXIuc3R5bGUubGVmdCA9ICcwJzsKICAgIGRvbS5sZWZ0Q29udGFpbmVyLnN0eWxlLnRvcCA9IHByb3BzLnRvcC5oZWlnaHQgKyAncHgnOwogICAgZG9tLnJpZ2h0Q29udGFpbmVyLnN0eWxlLmxlZnQgPSBwcm9wcy5sZWZ0LndpZHRoICsgcHJvcHMuY2VudGVyLndpZHRoICsgJ3B4JzsKICAgIGRvbS5yaWdodENvbnRhaW5lci5zdHlsZS50b3AgPSBwcm9wcy50b3AuaGVpZ2h0ICsgJ3B4JzsKICAgIGRvbS50b3Auc3R5bGUubGVmdCA9IHByb3BzLmxlZnQud2lkdGggKyAncHgnOwogICAgZG9tLnRvcC5zdHlsZS50b3AgPSAnMCc7CiAgICBkb20uYm90dG9tLnN0eWxlLmxlZnQgPSBwcm9wcy5sZWZ0LndpZHRoICsgJ3B4JzsKICAgIGRvbS5ib3R0b20uc3R5bGUudG9wID0gcHJvcHMudG9wLmhlaWdodCArIHByb3BzLmNlbnRlckNvbnRhaW5lci5oZWlnaHQgKyAncHgnOwoKICAgIC8vIHVwZGF0ZSB0aGUgc2Nyb2xsVG9wLCBmZWFzaWJsZSByYW5nZSBmb3IgdGhlIG9mZnNldCBjYW4gYmUgY2hhbmdlZAogICAgLy8gd2hlbiB0aGUgaGVpZ2h0IG9mIHRoZSBDb3JlIG9yIG9mIHRoZSBjb250ZW50cyBvZiB0aGUgY2VudGVyIGNoYW5nZWQKICAgIHRoaXMuX3VwZGF0ZVNjcm9sbFRvcCgpOwoKICAgIC8vIHJlcG9zaXRpb24gdGhlIHNjcm9sbGFibGUgY29udGVudHMKICAgIHZhciBvZmZzZXQgPSB0aGlzLnByb3BzLnNjcm9sbFRvcDsKICAgIGlmIChvcHRpb25zLm9yaWVudGF0aW9uLml0ZW0gIT0gJ3RvcCcpIHsKICAgICAgb2Zmc2V0ICs9IE1hdGgubWF4KHRoaXMucHJvcHMuY2VudGVyQ29udGFpbmVyLmhlaWdodCAtIHRoaXMucHJvcHMuY2VudGVyLmhlaWdodCAtIHRoaXMucHJvcHMuYm9yZGVyLnRvcCAtIHRoaXMucHJvcHMuYm9yZGVyLmJvdHRvbSwgMCk7CiAgICB9CiAgICBkb20uY2VudGVyLnN0eWxlLmxlZnQgPSAnMCc7CiAgICBkb20uY2VudGVyLnN0eWxlLnRvcCA9IG9mZnNldCArICdweCc7CiAgICBkb20ubGVmdC5zdHlsZS5sZWZ0ID0gJzAnOwogICAgZG9tLmxlZnQuc3R5bGUudG9wID0gb2Zmc2V0ICsgJ3B4JzsKICAgIGRvbS5yaWdodC5zdHlsZS5sZWZ0ID0gJzAnOwogICAgZG9tLnJpZ2h0LnN0eWxlLnRvcCA9IG9mZnNldCArICdweCc7CgogICAgLy8gc2hvdyBzaGFkb3dzIHdoZW4gdmVydGljYWwgc2Nyb2xsaW5nIGlzIGF2YWlsYWJsZQogICAgdmFyIHZpc2liaWxpdHlUb3AgPSB0aGlzLnByb3BzLnNjcm9sbFRvcCA9PSAwID8gJ2hpZGRlbicgOiAnJzsKICAgIHZhciB2aXNpYmlsaXR5Qm90dG9tID0gdGhpcy5wcm9wcy5zY3JvbGxUb3AgPT0gdGhpcy5wcm9wcy5zY3JvbGxUb3BNaW4gPyAnaGlkZGVuJyA6ICcnOwogICAgZG9tLnNoYWRvd1RvcC5zdHlsZS52aXNpYmlsaXR5ID0gdmlzaWJpbGl0eVRvcDsKICAgIGRvbS5zaGFkb3dCb3R0b20uc3R5bGUudmlzaWJpbGl0eSA9IHZpc2liaWxpdHlCb3R0b207CiAgICBkb20uc2hhZG93VG9wTGVmdC5zdHlsZS52aXNpYmlsaXR5ID0gdmlzaWJpbGl0eVRvcDsKICAgIGRvbS5zaGFkb3dCb3R0b21MZWZ0LnN0eWxlLnZpc2liaWxpdHkgPSB2aXNpYmlsaXR5Qm90dG9tOwogICAgZG9tLnNoYWRvd1RvcFJpZ2h0LnN0eWxlLnZpc2liaWxpdHkgPSB2aXNpYmlsaXR5VG9wOwogICAgZG9tLnNoYWRvd0JvdHRvbVJpZ2h0LnN0eWxlLnZpc2liaWxpdHkgPSB2aXNpYmlsaXR5Qm90dG9tOwoKICAgIC8vIHJlZHJhdyBhbGwgY29tcG9uZW50cwogICAgdGhpcy5jb21wb25lbnRzLmZvckVhY2goZnVuY3Rpb24gKGNvbXBvbmVudCkgewogICAgICByZXNpemVkID0gY29tcG9uZW50LnJlZHJhdygpIHx8IHJlc2l6ZWQ7CiAgICB9KTsKICAgIGlmIChyZXNpemVkKSB7CiAgICAgIC8vIGtlZXAgcmVwYWludGluZyB1bnRpbCBhbGwgc2l6ZXMgYXJlIHNldHRsZWQKICAgICAgdmFyIE1BWF9SRURSQVdTID0gMzsgLy8gbWF4aW11bSBudW1iZXIgb2YgY29uc2VjdXRpdmUgcmVkcmF3cwogICAgICBpZiAodGhpcy5yZWRyYXdDb3VudCA8IE1BWF9SRURSQVdTKSB7CiAgICAgICAgdGhpcy5yZWRyYXdDb3VudCsrOwogICAgICAgIHRoaXMuX3JlZHJhdygpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCdXQVJOSU5HOiBpbmZpbml0ZSBsb29wIGluIHJlZHJhdz8nKTsKICAgICAgfQogICAgICB0aGlzLnJlZHJhd0NvdW50ID0gMDsKICAgIH0KICB9OwoKICAvLyBUT0RPOiBkZXByZWNhdGVkIHNpbmNlIHZlcnNpb24gMS4xLjAsIHJlbW92ZSBzb21lIGRheQogIENvcmUucHJvdG90eXBlLnJlcGFpbnQgPSBmdW5jdGlvbiAoKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Z1bmN0aW9uIHJlcGFpbnQgaXMgZGVwcmVjYXRlZC4gVXNlIHJlZHJhdyBpbnN0ZWFkLicpOwogIH07CgogIC8qKgogICAqIFNldCBhIGN1cnJlbnQgdGltZS4gVGhpcyBjYW4gYmUgdXNlZCBmb3IgZXhhbXBsZSB0byBlbnN1cmUgdGhhdCBhIGNsaWVudCdzCiAgICogdGltZSBpcyBzeW5jaHJvbml6ZWQgd2l0aCBhIHNoYXJlZCBzZXJ2ZXIgdGltZS4KICAgKiBPbmx5IGFwcGxpY2FibGUgd2hlbiBvcHRpb24gYHNob3dDdXJyZW50VGltZWAgaXMgdHJ1ZS4KICAgKiBAcGFyYW0ge0RhdGUgfCBTdHJpbmcgfCBOdW1iZXJ9IHRpbWUgICAgIEEgRGF0ZSwgdW5peCB0aW1lc3RhbXAsIG9yCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJU08gZGF0ZSBzdHJpbmcuCiAgICovCiAgQ29yZS5wcm90b3R5cGUuc2V0Q3VycmVudFRpbWUgPSBmdW5jdGlvbiAodGltZSkgewogICAgaWYgKCF0aGlzLmN1cnJlbnRUaW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignT3B0aW9uIHNob3dDdXJyZW50VGltZSBtdXN0IGJlIHRydWUnKTsKICAgIH0KCiAgICB0aGlzLmN1cnJlbnRUaW1lLnNldEN1cnJlbnRUaW1lKHRpbWUpOwogIH07CgogIC8qKgogICAqIEdldCB0aGUgY3VycmVudCB0aW1lLgogICAqIE9ubHkgYXBwbGljYWJsZSB3aGVuIG9wdGlvbiBgc2hvd0N1cnJlbnRUaW1lYCBpcyB0cnVlLgogICAqIEByZXR1cm4ge0RhdGV9IFJldHVybnMgdGhlIGN1cnJlbnQgdGltZS4KICAgKi8KICBDb3JlLnByb3RvdHlwZS5nZXRDdXJyZW50VGltZSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5jdXJyZW50VGltZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ09wdGlvbiBzaG93Q3VycmVudFRpbWUgbXVzdCBiZSB0cnVlJyk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMuY3VycmVudFRpbWUuZ2V0Q3VycmVudFRpbWUoKTsKICB9OwoKICAvKioKICAgKiBDb252ZXJ0IGEgcG9zaXRpb24gb24gc2NyZWVuIChwaXhlbHMpIHRvIGEgZGF0ZXRpbWUKICAgKiBAcGFyYW0ge2ludH0gICAgIHggICAgUG9zaXRpb24gb24gdGhlIHNjcmVlbiBpbiBwaXhlbHMKICAgKiBAcmV0dXJuIHtEYXRlfSAgIHRpbWUgVGhlIGRhdGV0aW1lIHRoZSBjb3JyZXNwb25kcyB3aXRoIGdpdmVuIHBvc2l0aW9uIHgKICAgKiBAcHJvdGVjdGVkCiAgICovCiAgLy8gVE9ETzogbW92ZSB0aGlzIGZ1bmN0aW9uIHRvIFJhbmdlCiAgQ29yZS5wcm90b3R5cGUuX3RvVGltZSA9IGZ1bmN0aW9uICh4KSB7CiAgICByZXR1cm4gRGF0ZVV0aWwudG9UaW1lKHRoaXMsIHgsIHRoaXMucHJvcHMuY2VudGVyLndpZHRoKTsKICB9OwoKICAvKioKICAgKiBDb252ZXJ0IGEgcG9zaXRpb24gb24gdGhlIGdsb2JhbCBzY3JlZW4gKHBpeGVscykgdG8gYSBkYXRldGltZQogICAqIEBwYXJhbSB7aW50fSAgICAgeCAgICBQb3NpdGlvbiBvbiB0aGUgc2NyZWVuIGluIHBpeGVscwogICAqIEByZXR1cm4ge0RhdGV9ICAgdGltZSBUaGUgZGF0ZXRpbWUgdGhlIGNvcnJlc3BvbmRzIHdpdGggZ2l2ZW4gcG9zaXRpb24geAogICAqIEBwcm90ZWN0ZWQKICAgKi8KICAvLyBUT0RPOiBtb3ZlIHRoaXMgZnVuY3Rpb24gdG8gUmFuZ2UKICBDb3JlLnByb3RvdHlwZS5fdG9HbG9iYWxUaW1lID0gZnVuY3Rpb24gKHgpIHsKICAgIHJldHVybiBEYXRlVXRpbC50b1RpbWUodGhpcywgeCwgdGhpcy5wcm9wcy5yb290LndpZHRoKTsKICAgIC8vdmFyIGNvbnZlcnNpb24gPSB0aGlzLnJhbmdlLmNvbnZlcnNpb24odGhpcy5wcm9wcy5yb290LndpZHRoKTsKICAgIC8vcmV0dXJuIG5ldyBEYXRlKHggLyBjb252ZXJzaW9uLnNjYWxlICsgY29udmVyc2lvbi5vZmZzZXQpOwogIH07CgogIC8qKgogICAqIENvbnZlcnQgYSBkYXRldGltZSAoRGF0ZSBvYmplY3QpIGludG8gYSBwb3NpdGlvbiBvbiB0aGUgc2NyZWVuCiAgICogQHBhcmFtIHtEYXRlfSAgIHRpbWUgQSBkYXRlCiAgICogQHJldHVybiB7aW50fSAgIHggICAgVGhlIHBvc2l0aW9uIG9uIHRoZSBzY3JlZW4gaW4gcGl4ZWxzIHdoaWNoIGNvcnJlc3BvbmRzCiAgICogICAgICAgICAgICAgICAgICAgICAgd2l0aCB0aGUgZ2l2ZW4gZGF0ZS4KICAgKiBAcHJvdGVjdGVkCiAgICovCiAgLy8gVE9ETzogbW92ZSB0aGlzIGZ1bmN0aW9uIHRvIFJhbmdlCiAgQ29yZS5wcm90b3R5cGUuX3RvU2NyZWVuID0gZnVuY3Rpb24gKHRpbWUpIHsKICAgIHJldHVybiBEYXRlVXRpbC50b1NjcmVlbih0aGlzLCB0aW1lLCB0aGlzLnByb3BzLmNlbnRlci53aWR0aCk7CiAgfTsKCiAgLyoqCiAgICogQ29udmVydCBhIGRhdGV0aW1lIChEYXRlIG9iamVjdCkgaW50byBhIHBvc2l0aW9uIG9uIHRoZSByb290CiAgICogVGhpcyBpcyB1c2VkIHRvIGdldCB0aGUgcGl4ZWwgZGVuc2l0eSBlc3RpbWF0ZSBmb3IgdGhlIHNjcmVlbiwgbm90IHRoZSBjZW50ZXIgcGFuZWwKICAgKiBAcGFyYW0ge0RhdGV9ICAgdGltZSBBIGRhdGUKICAgKiBAcmV0dXJuIHtpbnR9ICAgeCAgICBUaGUgcG9zaXRpb24gb24gcm9vdCBpbiBwaXhlbHMgd2hpY2ggY29ycmVzcG9uZHMKICAgKiAgICAgICAgICAgICAgICAgICAgICB3aXRoIHRoZSBnaXZlbiBkYXRlLgogICAqIEBwcm90ZWN0ZWQKICAgKi8KICAvLyBUT0RPOiBtb3ZlIHRoaXMgZnVuY3Rpb24gdG8gUmFuZ2UKICBDb3JlLnByb3RvdHlwZS5fdG9HbG9iYWxTY3JlZW4gPSBmdW5jdGlvbiAodGltZSkgewogICAgcmV0dXJuIERhdGVVdGlsLnRvU2NyZWVuKHRoaXMsIHRpbWUsIHRoaXMucHJvcHMucm9vdC53aWR0aCk7CiAgICAvL3ZhciBjb252ZXJzaW9uID0gdGhpcy5yYW5nZS5jb252ZXJzaW9uKHRoaXMucHJvcHMucm9vdC53aWR0aCk7CiAgICAvL3JldHVybiAodGltZS52YWx1ZU9mKCkgLSBjb252ZXJzaW9uLm9mZnNldCkgKiBjb252ZXJzaW9uLnNjYWxlOwogIH07CgogIC8qKgogICAqIEluaXRpYWxpemUgd2F0Y2hpbmcgd2hlbiBvcHRpb24gYXV0b1Jlc2l6ZSBpcyB0cnVlCiAgICogQHByaXZhdGUKICAgKi8KICBDb3JlLnByb3RvdHlwZS5faW5pdEF1dG9SZXNpemUgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5vcHRpb25zLmF1dG9SZXNpemUgPT0gdHJ1ZSkgewogICAgICB0aGlzLl9zdGFydEF1dG9SZXNpemUoKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX3N0b3BBdXRvUmVzaXplKCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogV2F0Y2ggZm9yIGNoYW5nZXMgaW4gdGhlIHNpemUgb2YgdGhlIGNvbnRhaW5lci4gT24gcmVzaXplLCB0aGUgUGFuZWwgd2lsbAogICAqIGF1dG9tYXRpY2FsbHkgcmVkcmF3IGl0c2VsZi4KICAgKiBAcHJpdmF0ZQogICAqLwogIENvcmUucHJvdG90eXBlLl9zdGFydEF1dG9SZXNpemUgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgbWUgPSB0aGlzOwoKICAgIHRoaXMuX3N0b3BBdXRvUmVzaXplKCk7CgogICAgdGhpcy5fb25SZXNpemUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChtZS5vcHRpb25zLmF1dG9SZXNpemUgIT0gdHJ1ZSkgewogICAgICAgIC8vIHN0b3Agd2F0Y2hpbmcgd2hlbiB0aGUgb3B0aW9uIGF1dG9SZXNpemUgaXMgY2hhbmdlZCB0byBmYWxzZQogICAgICAgIG1lLl9zdG9wQXV0b1Jlc2l6ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKG1lLmRvbS5yb290KSB7CiAgICAgICAgLy8gY2hlY2sgd2hldGhlciB0aGUgZnJhbWUgaXMgcmVzaXplZAogICAgICAgIC8vIE5vdGU6IHdlIGNvbXBhcmUgb2Zmc2V0V2lkdGggaGVyZSwgbm90IGNsaWVudFdpZHRoLiBGb3Igc29tZSByZWFzb24sCiAgICAgICAgLy8gSUUgZG9lcyBub3QgcmVzdG9yZSB0aGUgY2xpZW50V2lkdGggZnJvbSAwIHRvIHRoZSBhY3R1YWwgd2lkdGggYWZ0ZXIKICAgICAgICAvLyBjaGFuZ2luZyB0aGUgdGltZWxpbmUncyBjb250YWluZXIgZGlzcGxheSBzdHlsZSBmcm9tIG5vbmUgdG8gdmlzaWJsZQogICAgICAgIGlmIChtZS5kb20ucm9vdC5vZmZzZXRXaWR0aCAhPSBtZS5wcm9wcy5sYXN0V2lkdGggfHwgbWUuZG9tLnJvb3Qub2Zmc2V0SGVpZ2h0ICE9IG1lLnByb3BzLmxhc3RIZWlnaHQpIHsKICAgICAgICAgIG1lLnByb3BzLmxhc3RXaWR0aCA9IG1lLmRvbS5yb290Lm9mZnNldFdpZHRoOwogICAgICAgICAgbWUucHJvcHMubGFzdEhlaWdodCA9IG1lLmRvbS5yb290Lm9mZnNldEhlaWdodDsKCiAgICAgICAgICBtZS5lbWl0KCdjaGFuZ2UnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgLy8gYWRkIGV2ZW50IGxpc3RlbmVyIHRvIHdpbmRvdyByZXNpemUKICAgIHV0aWwuYWRkRXZlbnRMaXN0ZW5lcih3aW5kb3csICdyZXNpemUnLCB0aGlzLl9vblJlc2l6ZSk7CgogICAgdGhpcy53YXRjaFRpbWVyID0gc2V0SW50ZXJ2YWwodGhpcy5fb25SZXNpemUsIDEwMDApOwogIH07CgogIC8qKgogICAqIFN0b3Agd2F0Y2hpbmcgZm9yIGEgcmVzaXplIG9mIHRoZSBmcmFtZS4KICAgKiBAcHJpdmF0ZQogICAqLwogIENvcmUucHJvdG90eXBlLl9zdG9wQXV0b1Jlc2l6ZSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLndhdGNoVGltZXIpIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLndhdGNoVGltZXIpOwogICAgICB0aGlzLndhdGNoVGltZXIgPSB1bmRlZmluZWQ7CiAgICB9CgogICAgLy8gcmVtb3ZlIGV2ZW50IGxpc3RlbmVyIG9uIHdpbmRvdy5yZXNpemUKICAgIHV0aWwucmVtb3ZlRXZlbnRMaXN0ZW5lcih3aW5kb3csICdyZXNpemUnLCB0aGlzLl9vblJlc2l6ZSk7CiAgICB0aGlzLl9vblJlc2l6ZSA9IG51bGw7CiAgfTsKCiAgLyoqCiAgICogU3RhcnQgbW92aW5nIHRoZSB0aW1lbGluZSB2ZXJ0aWNhbGx5CiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIENvcmUucHJvdG90eXBlLl9vblRvdWNoID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICB0aGlzLnRvdWNoLmFsbG93RHJhZ2dpbmcgPSB0cnVlOwogICAgdGhpcy50b3VjaC5pbml0aWFsU2Nyb2xsVG9wID0gdGhpcy5wcm9wcy5zY3JvbGxUb3A7CiAgfTsKCiAgLyoqCiAgICogU3RhcnQgbW92aW5nIHRoZSB0aW1lbGluZSB2ZXJ0aWNhbGx5CiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIENvcmUucHJvdG90eXBlLl9vblBpbmNoID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICB0aGlzLnRvdWNoLmFsbG93RHJhZ2dpbmcgPSBmYWxzZTsKICB9OwoKICAvKioKICAgKiBNb3ZlIHRoZSB0aW1lbGluZSB2ZXJ0aWNhbGx5CiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIENvcmUucHJvdG90eXBlLl9vbkRyYWcgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIC8vIHJlZnVzZSB0byBkcmFnIHdoZW4gd2Ugd2hlcmUgcGluY2hpbmcgdG8gcHJldmVudCB0aGUgdGltZWxpbmUgbWFrZSBhIGp1bXAKICAgIC8vIHdoZW4gcmVsZWFzaW5nIHRoZSBmaW5nZXJzIGluIG9wcG9zaXRlIG9yZGVyIGZyb20gdGhlIHRvdWNoIHNjcmVlbgogICAgaWYgKCF0aGlzLnRvdWNoLmFsbG93RHJhZ2dpbmcpIHJldHVybjsKCiAgICB2YXIgZGVsdGEgPSBldmVudC5kZWx0YVk7CgogICAgdmFyIG9sZFNjcm9sbFRvcCA9IHRoaXMuX2dldFNjcm9sbFRvcCgpOwogICAgdmFyIG5ld1Njcm9sbFRvcCA9IHRoaXMuX3NldFNjcm9sbFRvcCh0aGlzLnRvdWNoLmluaXRpYWxTY3JvbGxUb3AgKyBkZWx0YSk7CgogICAgaWYgKG5ld1Njcm9sbFRvcCAhPSBvbGRTY3JvbGxUb3ApIHsKICAgICAgdGhpcy5fcmVkcmF3KCk7IC8vIFRPRE86IHRoaXMgY2F1c2VzIHR3byByZWRyYXdzIHdoZW4gZHJhZ2dpbmcsIHRoZSBvdGhlciBpcyB0cmlnZ2VyZWQgYnkgcmFuZ2VjaGFuZ2UgYWxyZWFkeQogICAgICB0aGlzLmVtaXQoJ3ZlcnRpY2FsRHJhZycpOwogICAgfQogIH07CgogIC8qKgogICAqIEFwcGx5IGEgc2Nyb2xsVG9wCiAgICogQHBhcmFtIHtOdW1iZXJ9IHNjcm9sbFRvcAogICAqIEByZXR1cm5zIHtOdW1iZXJ9IHNjcm9sbFRvcCAgUmV0dXJucyB0aGUgYXBwbGllZCBzY3JvbGxUb3AKICAgKiBAcHJpdmF0ZQogICAqLwogIENvcmUucHJvdG90eXBlLl9zZXRTY3JvbGxUb3AgPSBmdW5jdGlvbiAoc2Nyb2xsVG9wKSB7CiAgICB0aGlzLnByb3BzLnNjcm9sbFRvcCA9IHNjcm9sbFRvcDsKICAgIHRoaXMuX3VwZGF0ZVNjcm9sbFRvcCgpOwogICAgcmV0dXJuIHRoaXMucHJvcHMuc2Nyb2xsVG9wOwogIH07CgogIC8qKgogICAqIFVwZGF0ZSB0aGUgY3VycmVudCBzY3JvbGxUb3Agd2hlbiB0aGUgaGVpZ2h0IG9mICB0aGUgY29udGFpbmVycyBoYXMgYmVlbiBjaGFuZ2VkCiAgICogQHJldHVybnMge051bWJlcn0gc2Nyb2xsVG9wICBSZXR1cm5zIHRoZSBhcHBsaWVkIHNjcm9sbFRvcAogICAqIEBwcml2YXRlCiAgICovCiAgQ29yZS5wcm90b3R5cGUuX3VwZGF0ZVNjcm9sbFRvcCA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIHJlY2FsY3VsYXRlIHRoZSBzY3JvbGxUb3BNaW4KICAgIHZhciBzY3JvbGxUb3BNaW4gPSBNYXRoLm1pbih0aGlzLnByb3BzLmNlbnRlckNvbnRhaW5lci5oZWlnaHQgLSB0aGlzLnByb3BzLmNlbnRlci5oZWlnaHQsIDApOyAvLyBpcyBuZWdhdGl2ZSBvciB6ZXJvCiAgICBpZiAoc2Nyb2xsVG9wTWluICE9IHRoaXMucHJvcHMuc2Nyb2xsVG9wTWluKSB7CiAgICAgIC8vIGluIGNhc2Ugb2YgYm90dG9tIG9yaWVudGF0aW9uLCBjaGFuZ2UgdGhlIHNjcm9sbFRvcCBzdWNoIHRoYXQgdGhlIGNvbnRlbnRzCiAgICAgIC8vIGRvIG5vdCBtb3ZlIHJlbGF0aXZlIHRvIHRoZSB0aW1lIGF4aXMgYXQgdGhlIGJvdHRvbQogICAgICBpZiAodGhpcy5vcHRpb25zLm9yaWVudGF0aW9uLml0ZW0gIT0gJ3RvcCcpIHsKICAgICAgICB0aGlzLnByb3BzLnNjcm9sbFRvcCArPSBzY3JvbGxUb3BNaW4gLSB0aGlzLnByb3BzLnNjcm9sbFRvcE1pbjsKICAgICAgfQogICAgICB0aGlzLnByb3BzLnNjcm9sbFRvcE1pbiA9IHNjcm9sbFRvcE1pbjsKICAgIH0KCiAgICAvLyBsaW1pdCB0aGUgc2Nyb2xsVG9wIHRvIHRoZSBmZWFzaWJsZSBzY3JvbGwgcmFuZ2UKICAgIGlmICh0aGlzLnByb3BzLnNjcm9sbFRvcCA+IDApIHRoaXMucHJvcHMuc2Nyb2xsVG9wID0gMDsKICAgIGlmICh0aGlzLnByb3BzLnNjcm9sbFRvcCA8IHNjcm9sbFRvcE1pbikgdGhpcy5wcm9wcy5zY3JvbGxUb3AgPSBzY3JvbGxUb3BNaW47CgogICAgcmV0dXJuIHRoaXMucHJvcHMuc2Nyb2xsVG9wOwogIH07CgogIC8qKgogICAqIEdldCB0aGUgY3VycmVudCBzY3JvbGxUb3AKICAgKiBAcmV0dXJucyB7bnVtYmVyfSBzY3JvbGxUb3AKICAgKiBAcHJpdmF0ZQogICAqLwogIENvcmUucHJvdG90eXBlLl9nZXRTY3JvbGxUb3AgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5wcm9wcy5zY3JvbGxUb3A7CiAgfTsKCiAgLyoqCiAgICogTG9hZCBhIGNvbmZpZ3VyYXRvcgogICAqIEByZXR1cm4ge09iamVjdH0KICAgKiBAcHJpdmF0ZQogICAqLwogIENvcmUucHJvdG90eXBlLl9jcmVhdGVDb25maWd1cmF0b3IgPSBmdW5jdGlvbiAoKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBpbnZva2UgYWJzdHJhY3QgbWV0aG9kIF9jcmVhdGVDb25maWd1cmF0b3InKTsKICB9OwoKICBtb2R1bGUuZXhwb3J0cyA9IENvcmU7CgovKioqLyB9LAovKiAzMSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgSGFtbWVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMyk7CiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwogIHZhciBEYXRhU2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKICB2YXIgRGF0YVZpZXcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKICB2YXIgVGltZVN0ZXAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM2KTsKICB2YXIgQ29tcG9uZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMSk7CiAgdmFyIEdyb3VwID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMik7CiAgdmFyIEJhY2tncm91bmRHcm91cCA9IF9fd2VicGFja19yZXF1aXJlX18oMzcpOwogIHZhciBCb3hJdGVtID0gX193ZWJwYWNrX3JlcXVpcmVfXygzOCk7CiAgdmFyIFBvaW50SXRlbSA9IF9fd2VicGFja19yZXF1aXJlX18oMzkpOwogIHZhciBSYW5nZUl0ZW0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM0KTsKICB2YXIgQmFja2dyb3VuZEl0ZW0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQwKTsKCiAgdmFyIFVOR1JPVVBFRCA9ICdfX3VuZ3JvdXBlZF9fJzsgLy8gcmVzZXJ2ZWQgZ3JvdXAgaWQgZm9yIHVuZ3JvdXBlZCBpdGVtcwogIHZhciBCQUNLR1JPVU5EID0gJ19fYmFja2dyb3VuZF9fJzsgLy8gcmVzZXJ2ZWQgZ3JvdXAgaWQgZm9yIGJhY2tncm91bmQgaXRlbXMgd2l0aG91dCBncm91cAoKICAvKioKICAgKiBBbiBJdGVtU2V0IGhvbGRzIGEgc2V0IG9mIGl0ZW1zIGFuZCByYW5nZXMgd2hpY2ggY2FuIGJlIGRpc3BsYXllZCBpbiBhCiAgICogcmFuZ2UuIFRoZSB3aWR0aCBpcyBkZXRlcm1pbmVkIGJ5IHRoZSBwYXJlbnQgb2YgdGhlIEl0ZW1TZXQsIGFuZCB0aGUgaGVpZ2h0CiAgICogaXMgZGV0ZXJtaW5lZCBieSB0aGUgc2l6ZSBvZiB0aGUgaXRlbXMuCiAgICogQHBhcmFtIHt7ZG9tOiBPYmplY3QsIGRvbVByb3BzOiBPYmplY3QsIGVtaXR0ZXI6IEVtaXR0ZXIsIHJhbmdlOiBSYW5nZX19IGJvZHkKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICAgICAgU2VlIEl0ZW1TZXQuc2V0T3B0aW9ucyBmb3IgdGhlIGF2YWlsYWJsZSBvcHRpb25zLgogICAqIEBjb25zdHJ1Y3RvciBJdGVtU2V0CiAgICogQGV4dGVuZHMgQ29tcG9uZW50CiAgICovCiAgZnVuY3Rpb24gSXRlbVNldChib2R5LCBvcHRpb25zKSB7CiAgICB0aGlzLmJvZHkgPSBib2R5OwoKICAgIHRoaXMuZGVmYXVsdE9wdGlvbnMgPSB7CiAgICAgIHR5cGU6IG51bGwsIC8vICdib3gnLCAncG9pbnQnLCAncmFuZ2UnLCAnYmFja2dyb3VuZCcKICAgICAgb3JpZW50YXRpb246IHsKICAgICAgICBpdGVtOiAnYm90dG9tJyAvLyBpdGVtIG9yaWVudGF0aW9uOiAndG9wJyBvciAnYm90dG9tJwogICAgICB9LAogICAgICBhbGlnbjogJ2F1dG8nLCAvLyBhbGlnbm1lbnQgb2YgYm94IGl0ZW1zCiAgICAgIHN0YWNrOiB0cnVlLAogICAgICBncm91cE9yZGVyOiBudWxsLAoKICAgICAgc2VsZWN0YWJsZTogdHJ1ZSwKICAgICAgbXVsdGlzZWxlY3Q6IGZhbHNlLAoKICAgICAgZWRpdGFibGU6IHsKICAgICAgICB1cGRhdGVUaW1lOiBmYWxzZSwKICAgICAgICB1cGRhdGVHcm91cDogZmFsc2UsCiAgICAgICAgYWRkOiBmYWxzZSwKICAgICAgICByZW1vdmU6IGZhbHNlCiAgICAgIH0sCgogICAgICBzbmFwOiBUaW1lU3RlcC5zbmFwLAoKICAgICAgb25BZGQ6IGZ1bmN0aW9uIG9uQWRkKGl0ZW0sIGNhbGxiYWNrKSB7CiAgICAgICAgY2FsbGJhY2soaXRlbSk7CiAgICAgIH0sCiAgICAgIG9uVXBkYXRlOiBmdW5jdGlvbiBvblVwZGF0ZShpdGVtLCBjYWxsYmFjaykgewogICAgICAgIGNhbGxiYWNrKGl0ZW0pOwogICAgICB9LAogICAgICBvbk1vdmU6IGZ1bmN0aW9uIG9uTW92ZShpdGVtLCBjYWxsYmFjaykgewogICAgICAgIGNhbGxiYWNrKGl0ZW0pOwogICAgICB9LAogICAgICBvblJlbW92ZTogZnVuY3Rpb24gb25SZW1vdmUoaXRlbSwgY2FsbGJhY2spIHsKICAgICAgICBjYWxsYmFjayhpdGVtKTsKICAgICAgfSwKICAgICAgb25Nb3Zpbmc6IGZ1bmN0aW9uIG9uTW92aW5nKGl0ZW0sIGNhbGxiYWNrKSB7CiAgICAgICAgY2FsbGJhY2soaXRlbSk7CiAgICAgIH0sCgogICAgICBtYXJnaW46IHsKICAgICAgICBpdGVtOiB7CiAgICAgICAgICBob3Jpem9udGFsOiAxMCwKICAgICAgICAgIHZlcnRpY2FsOiAxMAogICAgICAgIH0sCiAgICAgICAgYXhpczogMjAKICAgICAgfQogICAgfTsKCiAgICAvLyBvcHRpb25zIGlzIHNoYXJlZCBieSB0aGlzIEl0ZW1TZXQgYW5kIGFsbCBpdHMgaXRlbXMKICAgIHRoaXMub3B0aW9ucyA9IHV0aWwuZXh0ZW5kKHt9LCB0aGlzLmRlZmF1bHRPcHRpb25zKTsKCiAgICAvLyBvcHRpb25zIGZvciBnZXR0aW5nIGl0ZW1zIGZyb20gdGhlIERhdGFTZXQgd2l0aCB0aGUgY29ycmVjdCB0eXBlCiAgICB0aGlzLml0ZW1PcHRpb25zID0gewogICAgICB0eXBlOiB7IHN0YXJ0OiAnRGF0ZScsIGVuZDogJ0RhdGUnIH0KICAgIH07CgogICAgdGhpcy5jb252ZXJzaW9uID0gewogICAgICB0b1NjcmVlbjogYm9keS51dGlsLnRvU2NyZWVuLAogICAgICB0b1RpbWU6IGJvZHkudXRpbC50b1RpbWUKICAgIH07CiAgICB0aGlzLmRvbSA9IHt9OwogICAgdGhpcy5wcm9wcyA9IHt9OwogICAgdGhpcy5oYW1tZXIgPSBudWxsOwoKICAgIHZhciBtZSA9IHRoaXM7CiAgICB0aGlzLml0ZW1zRGF0YSA9IG51bGw7IC8vIERhdGFTZXQKICAgIHRoaXMuZ3JvdXBzRGF0YSA9IG51bGw7IC8vIERhdGFTZXQKCiAgICAvLyBsaXN0ZW5lcnMgZm9yIHRoZSBEYXRhU2V0IG9mIHRoZSBpdGVtcwogICAgdGhpcy5pdGVtTGlzdGVuZXJzID0gewogICAgICAnYWRkJzogZnVuY3Rpb24gYWRkKGV2ZW50LCBwYXJhbXMsIHNlbmRlcklkKSB7CiAgICAgICAgbWUuX29uQWRkKHBhcmFtcy5pdGVtcyk7CiAgICAgIH0sCiAgICAgICd1cGRhdGUnOiBmdW5jdGlvbiB1cGRhdGUoZXZlbnQsIHBhcmFtcywgc2VuZGVySWQpIHsKICAgICAgICBtZS5fb25VcGRhdGUocGFyYW1zLml0ZW1zKTsKICAgICAgfSwKICAgICAgJ3JlbW92ZSc6IGZ1bmN0aW9uIHJlbW92ZShldmVudCwgcGFyYW1zLCBzZW5kZXJJZCkgewogICAgICAgIG1lLl9vblJlbW92ZShwYXJhbXMuaXRlbXMpOwogICAgICB9CiAgICB9OwoKICAgIC8vIGxpc3RlbmVycyBmb3IgdGhlIERhdGFTZXQgb2YgdGhlIGdyb3VwcwogICAgdGhpcy5ncm91cExpc3RlbmVycyA9IHsKICAgICAgJ2FkZCc6IGZ1bmN0aW9uIGFkZChldmVudCwgcGFyYW1zLCBzZW5kZXJJZCkgewogICAgICAgIG1lLl9vbkFkZEdyb3VwcyhwYXJhbXMuaXRlbXMpOwogICAgICB9LAogICAgICAndXBkYXRlJzogZnVuY3Rpb24gdXBkYXRlKGV2ZW50LCBwYXJhbXMsIHNlbmRlcklkKSB7CiAgICAgICAgbWUuX29uVXBkYXRlR3JvdXBzKHBhcmFtcy5pdGVtcyk7CiAgICAgIH0sCiAgICAgICdyZW1vdmUnOiBmdW5jdGlvbiByZW1vdmUoZXZlbnQsIHBhcmFtcywgc2VuZGVySWQpIHsKICAgICAgICBtZS5fb25SZW1vdmVHcm91cHMocGFyYW1zLml0ZW1zKTsKICAgICAgfQogICAgfTsKCiAgICB0aGlzLml0ZW1zID0ge307IC8vIG9iamVjdCB3aXRoIGFuIEl0ZW0gZm9yIGV2ZXJ5IGRhdGEgaXRlbQogICAgdGhpcy5ncm91cHMgPSB7fTsgLy8gR3JvdXAgb2JqZWN0IGZvciBldmVyeSBncm91cAogICAgdGhpcy5ncm91cElkcyA9IFtdOwoKICAgIHRoaXMuc2VsZWN0aW9uID0gW107IC8vIGxpc3Qgd2l0aCB0aGUgaWRzIG9mIGFsbCBzZWxlY3RlZCBub2RlcwogICAgdGhpcy5zdGFja0RpcnR5ID0gdHJ1ZTsgLy8gaWYgdHJ1ZSwgYWxsIGl0ZW1zIHdpbGwgYmUgcmVzdGFja2VkIG9uIG5leHQgcmVkcmF3CgogICAgdGhpcy50b3VjaFBhcmFtcyA9IHt9OyAvLyBzdG9yZXMgcHJvcGVydGllcyB3aGlsZSBkcmFnZ2luZwogICAgLy8gY3JlYXRlIHRoZSBIVE1MIERPTQoKICAgIHRoaXMuX2NyZWF0ZSgpOwoKICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTsKICB9CgogIEl0ZW1TZXQucHJvdG90eXBlID0gbmV3IENvbXBvbmVudCgpOwoKICAvLyBhdmFpbGFibGUgaXRlbSB0eXBlcyB3aWxsIGJlIHJlZ2lzdGVyZWQgaGVyZQogIEl0ZW1TZXQudHlwZXMgPSB7CiAgICBiYWNrZ3JvdW5kOiBCYWNrZ3JvdW5kSXRlbSwKICAgIGJveDogQm94SXRlbSwKICAgIHJhbmdlOiBSYW5nZUl0ZW0sCiAgICBwb2ludDogUG9pbnRJdGVtCiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlIHRoZSBIVE1MIERPTSBmb3IgdGhlIEl0ZW1TZXQKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5fY3JlYXRlID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBmcmFtZS5jbGFzc05hbWUgPSAndmlzLWl0ZW1zZXQnOwogICAgZnJhbWVbJ3RpbWVsaW5lLWl0ZW1zZXQnXSA9IHRoaXM7CiAgICB0aGlzLmRvbS5mcmFtZSA9IGZyYW1lOwoKICAgIC8vIGNyZWF0ZSBiYWNrZ3JvdW5kIHBhbmVsCiAgICB2YXIgYmFja2dyb3VuZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgYmFja2dyb3VuZC5jbGFzc05hbWUgPSAndmlzLWJhY2tncm91bmQnOwogICAgZnJhbWUuYXBwZW5kQ2hpbGQoYmFja2dyb3VuZCk7CiAgICB0aGlzLmRvbS5iYWNrZ3JvdW5kID0gYmFja2dyb3VuZDsKCiAgICAvLyBjcmVhdGUgZm9yZWdyb3VuZCBwYW5lbAogICAgdmFyIGZvcmVncm91bmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGZvcmVncm91bmQuY2xhc3NOYW1lID0gJ3Zpcy1mb3JlZ3JvdW5kJzsKICAgIGZyYW1lLmFwcGVuZENoaWxkKGZvcmVncm91bmQpOwogICAgdGhpcy5kb20uZm9yZWdyb3VuZCA9IGZvcmVncm91bmQ7CgogICAgLy8gY3JlYXRlIGF4aXMgcGFuZWwKICAgIHZhciBheGlzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBheGlzLmNsYXNzTmFtZSA9ICd2aXMtYXhpcyc7CiAgICB0aGlzLmRvbS5heGlzID0gYXhpczsKCiAgICAvLyBjcmVhdGUgbGFiZWxzZXQKICAgIHZhciBsYWJlbFNldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgbGFiZWxTZXQuY2xhc3NOYW1lID0gJ3Zpcy1sYWJlbHNldCc7CiAgICB0aGlzLmRvbS5sYWJlbFNldCA9IGxhYmVsU2V0OwoKICAgIC8vIGNyZWF0ZSB1bmdyb3VwZWQgR3JvdXAKICAgIHRoaXMuX3VwZGF0ZVVuZ3JvdXBlZCgpOwoKICAgIC8vIGNyZWF0ZSBiYWNrZ3JvdW5kIEdyb3VwCiAgICB2YXIgYmFja2dyb3VuZEdyb3VwID0gbmV3IEJhY2tncm91bmRHcm91cChCQUNLR1JPVU5ELCBudWxsLCB0aGlzKTsKICAgIGJhY2tncm91bmRHcm91cC5zaG93KCk7CiAgICB0aGlzLmdyb3Vwc1tCQUNLR1JPVU5EXSA9IGJhY2tncm91bmRHcm91cDsKCiAgICAvLyBhdHRhY2ggZXZlbnQgbGlzdGVuZXJzCiAgICAvLyBOb3RlOiB3ZSBiaW5kIHRvIHRoZSBjZW50ZXJDb250YWluZXIgZm9yIHRoZSBjYXNlIHdoZXJlIHRoZSBoZWlnaHQKICAgIC8vICAgICAgIG9mIHRoZSBjZW50ZXIgY29udGFpbmVyIGlzIGxhcmdlciB0aGFuIG9mIHRoZSBJdGVtU2V0LCBzbyB3ZQogICAgLy8gICAgICAgY2FuIGNsaWNrIGluIHRoZSBlbXB0eSBhcmVhIHRvIGNyZWF0ZSBhIG5ldyBpdGVtIG9yIGRlc2VsZWN0IGFuIGl0ZW0uCiAgICB0aGlzLmhhbW1lciA9IG5ldyBIYW1tZXIodGhpcy5ib2R5LmRvbS5jZW50ZXJDb250YWluZXIpOwoKICAgIC8vIGRyYWcgaXRlbXMgd2hlbiBzZWxlY3RlZAogICAgdGhpcy5oYW1tZXIub24oJ2hhbW1lci5pbnB1dCcsIChmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50LmlzRmlyc3QpIHsKICAgICAgICB0aGlzLl9vblRvdWNoKGV2ZW50KTsKICAgICAgfQogICAgfSkuYmluZCh0aGlzKSk7CiAgICB0aGlzLmhhbW1lci5vbigncGFuc3RhcnQnLCB0aGlzLl9vbkRyYWdTdGFydC5iaW5kKHRoaXMpKTsKICAgIHRoaXMuaGFtbWVyLm9uKCdwYW5tb3ZlJywgdGhpcy5fb25EcmFnLmJpbmQodGhpcykpOwogICAgdGhpcy5oYW1tZXIub24oJ3BhbmVuZCcsIHRoaXMuX29uRHJhZ0VuZC5iaW5kKHRoaXMpKTsKCiAgICAvLyBzaW5nbGUgc2VsZWN0IChvciB1bnNlbGVjdCkgd2hlbiB0YXBwaW5nIGFuIGl0ZW0KICAgIHRoaXMuaGFtbWVyLm9uKCd0YXAnLCB0aGlzLl9vblNlbGVjdEl0ZW0uYmluZCh0aGlzKSk7CgogICAgLy8gbXVsdGkgc2VsZWN0IHdoZW4gaG9sZGluZyBtb3VzZS90b3VjaCwgb3Igb24gY3RybCtjbGljawogICAgdGhpcy5oYW1tZXIub24oJ3ByZXNzJywgdGhpcy5fb25NdWx0aVNlbGVjdEl0ZW0uYmluZCh0aGlzKSk7CgogICAgLy8gYWRkIGl0ZW0gb24gZG91YmxldGFwCiAgICB0aGlzLmhhbW1lci5vbignZG91YmxldGFwJywgdGhpcy5fb25BZGRJdGVtLmJpbmQodGhpcykpOwoKICAgIC8vIGF0dGFjaCB0byB0aGUgRE9NCiAgICB0aGlzLnNob3coKTsKICB9OwoKICAvKioKICAgKiBTZXQgb3B0aW9ucyBmb3IgdGhlIEl0ZW1TZXQuIEV4aXN0aW5nIG9wdGlvbnMgd2lsbCBiZSBleHRlbmRlZC9vdmVyd3JpdHRlbi4KICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIFRoZSBmb2xsb3dpbmcgb3B0aW9ucyBhcmUgYXZhaWxhYmxlOgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAge1N0cmluZ30gdHlwZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCB0eXBlIGZvciB0aGUgaXRlbXMuIENob29zZSBmcm9tICdib3gnCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZGVmYXVsdCksICdwb2ludCcsICdyYW5nZScsIG9yICdiYWNrZ3JvdW5kJy4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBkZWZhdWx0IHN0eWxlIGNhbiBiZSBvdmVyd3JpdHRlbiBieQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kaXZpZHVhbCBpdGVtcy4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmd9IGFsaWduCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGlnbm1lbnQgZm9yIHRoZSBpdGVtcywgb25seSBhcHBsaWNhYmxlIGZvcgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm94SXRlbS4gQ2hvb3NlICdjZW50ZXInIChkZWZhdWx0KSwgJ2xlZnQnLCBvcgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JpZ2h0Jy4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmd9IG9yaWVudGF0aW9uLml0ZW0KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9yaWVudGF0aW9uIG9mIHRoZSBpdGVtIHNldC4gQ2hvb3NlICd0b3AnIG9yCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm90dG9tJyAoZGVmYXVsdCkuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB7RnVuY3Rpb259IGdyb3VwT3JkZXIKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEEgc29ydGluZyBmdW5jdGlvbiBmb3Igb3JkZXJpbmcgZ3JvdXBzCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB7Qm9vbGVhbn0gc3RhY2sKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIHRydWUgKGRlZmF1bHQpLCBpdGVtcyB3aWxsIGJlIHN0YWNrZWQgb24KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcCBvZiBlYWNoIG90aGVyLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAge051bWJlcn0gbWFyZ2luLmF4aXMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hcmdpbiBiZXR3ZWVuIHRoZSBheGlzIGFuZCB0aGUgaXRlbXMgaW4gcGl4ZWxzLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCBpcyAyMC4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtOdW1iZXJ9IG1hcmdpbi5pdGVtLmhvcml6b250YWwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhvcml6b250YWwgbWFyZ2luIGJldHdlZW4gaXRlbXMgaW4gcGl4ZWxzLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCBpcyAxMC4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtOdW1iZXJ9IG1hcmdpbi5pdGVtLnZlcnRpY2FsCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWZXJ0aWNhbCBNYXJnaW4gYmV0d2VlbiBpdGVtcyBpbiBwaXhlbHMuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWZhdWx0IGlzIDEwLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAge051bWJlcn0gbWFyZ2luLml0ZW0KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hcmdpbiBiZXR3ZWVuIGl0ZW1zIGluIHBpeGVscyBpbiBib3RoIGhvcml6b250YWwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCB2ZXJ0aWNhbCBkaXJlY3Rpb24uIERlZmF1bHQgaXMgMTAuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB7TnVtYmVyfSBtYXJnaW4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldCBtYXJnaW4gZm9yIGJvdGggYXhpcyBhbmQgaXRlbXMgaW4gcGl4ZWxzLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAge0Jvb2xlYW59IHNlbGVjdGFibGUKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIHRydWUgKGRlZmF1bHQpLCBpdGVtcyBjYW4gYmUgc2VsZWN0ZWQuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB7Qm9vbGVhbn0gbXVsdGlzZWxlY3QKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIHRydWUsIG11bHRpcGxlIGl0ZW1zIGNhbiBiZSBzZWxlY3RlZC4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhbHNlIGJ5IGRlZmF1bHQuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB7Qm9vbGVhbn0gZWRpdGFibGUKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldCBhbGwgZWRpdGFibGUgb3B0aW9ucyB0byB0cnVlIG9yIGZhbHNlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB7Qm9vbGVhbn0gZWRpdGFibGUudXBkYXRlVGltZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxsb3cgZHJhZ2dpbmcgYW4gaXRlbSB0byBhbiBvdGhlciBtb21lbnQgaW4gdGltZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAge0Jvb2xlYW59IGVkaXRhYmxlLnVwZGF0ZUdyb3VwCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxvdyBkcmFnZ2luZyBhbiBpdGVtIHRvIGFuIG90aGVyIGdyb3VwCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB7Qm9vbGVhbn0gZWRpdGFibGUuYWRkCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbGxvdyBjcmVhdGluZyBuZXcgaXRlbXMgb24gZG91YmxlIHRhcAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAge0Jvb2xlYW59IGVkaXRhYmxlLnJlbW92ZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxsb3cgcmVtb3ZpbmcgaXRlbXMgYnkgY2xpY2tpbmcgdGhlIGRlbGV0ZSBidXR0b24KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcCByaWdodCBvZiBhIHNlbGVjdGVkIGl0ZW0uCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB7RnVuY3Rpb24oaXRlbTogSXRlbSwgY2FsbGJhY2s6IEZ1bmN0aW9uKX0gb25BZGQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhbGxiYWNrIGZ1bmN0aW9uIHRyaWdnZXJlZCB3aGVuIGFuIGl0ZW0gaXMgYWJvdXQgdG8gYmUgYWRkZWQ6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGVuIHRoZSB1c2VyIGRvdWJsZSB0YXBzIGFuIGVtcHR5IHNwYWNlIGluIHRoZSBUaW1lbGluZS4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtGdW5jdGlvbihpdGVtOiBJdGVtLCBjYWxsYmFjazogRnVuY3Rpb24pfSBvblVwZGF0ZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FsbGJhY2sgZnVuY3Rpb24gZmlyZWQgd2hlbiBhbiBpdGVtIGlzIGFib3V0IHRvIGJlIHVwZGF0ZWQuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIGZ1bmN0aW9uIHR5cGljYWxseSBoYXMgdG8gc2hvdyBhIGRpYWxvZyB3aGVyZSB0aGUgdXNlcgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlIHRoZSBpdGVtLiBJZiBub3QgaW1wbGVtZW50ZWQsIG5vdGhpbmcgaGFwcGVucy4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIHtGdW5jdGlvbihpdGVtOiBJdGVtLCBjYWxsYmFjazogRnVuY3Rpb24pfSBvbk1vdmUKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpcmVkIHdoZW4gYW4gaXRlbSBoYXMgYmVlbiBtb3ZlZC4gSWYgbm90IGltcGxlbWVudGVkLAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIG1vdmUgYWN0aW9uIHdpbGwgYmUgYWNjZXB0ZWQuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICB7RnVuY3Rpb24oaXRlbTogSXRlbSwgY2FsbGJhY2s6IEZ1bmN0aW9uKX0gb25SZW1vdmUKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpcmVkIHdoZW4gYW4gaXRlbSBpcyBhYm91dCB0byBiZSBkZWxldGVkLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgbm90IGltcGxlbWVudGVkLCB0aGUgaXRlbSB3aWxsIGJlIGFsd2F5cyByZW1vdmVkLgogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMpIHsKICAgICAgLy8gY29weSBhbGwgb3B0aW9ucyB0aGF0IHdlIGtub3cKICAgICAgdmFyIGZpZWxkcyA9IFsndHlwZScsICdhbGlnbicsICdvcmRlcicsICdzdGFjaycsICdzZWxlY3RhYmxlJywgJ211bHRpc2VsZWN0JywgJ2dyb3VwT3JkZXInLCAnZGF0YUF0dHJpYnV0ZXMnLCAndGVtcGxhdGUnLCAnaGlkZScsICdzbmFwJ107CiAgICAgIHV0aWwuc2VsZWN0aXZlRXh0ZW5kKGZpZWxkcywgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKCiAgICAgIGlmICgnb3JpZW50YXRpb24nIGluIG9wdGlvbnMpIHsKICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMub3JpZW50YXRpb24gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICB0aGlzLm9wdGlvbnMub3JpZW50YXRpb24uaXRlbSA9IG9wdGlvbnMub3JpZW50YXRpb24gPT09ICd0b3AnID8gJ3RvcCcgOiAnYm90dG9tJzsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zLm9yaWVudGF0aW9uID09PSAnb2JqZWN0JyAmJiAnaXRlbScgaW4gb3B0aW9ucy5vcmllbnRhdGlvbikgewogICAgICAgICAgdGhpcy5vcHRpb25zLm9yaWVudGF0aW9uLml0ZW0gPSBvcHRpb25zLm9yaWVudGF0aW9uLml0ZW07CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoJ21hcmdpbicgaW4gb3B0aW9ucykgewogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5tYXJnaW4gPT09ICdudW1iZXInKSB7CiAgICAgICAgICB0aGlzLm9wdGlvbnMubWFyZ2luLmF4aXMgPSBvcHRpb25zLm1hcmdpbjsKICAgICAgICAgIHRoaXMub3B0aW9ucy5tYXJnaW4uaXRlbS5ob3Jpem9udGFsID0gb3B0aW9ucy5tYXJnaW47CiAgICAgICAgICB0aGlzLm9wdGlvbnMubWFyZ2luLml0ZW0udmVydGljYWwgPSBvcHRpb25zLm1hcmdpbjsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zLm1hcmdpbiA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIHV0aWwuc2VsZWN0aXZlRXh0ZW5kKFsnYXhpcyddLCB0aGlzLm9wdGlvbnMubWFyZ2luLCBvcHRpb25zLm1hcmdpbik7CiAgICAgICAgICBpZiAoJ2l0ZW0nIGluIG9wdGlvbnMubWFyZ2luKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5tYXJnaW4uaXRlbSA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMubWFyZ2luLml0ZW0uaG9yaXpvbnRhbCA9IG9wdGlvbnMubWFyZ2luLml0ZW07CiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1hcmdpbi5pdGVtLnZlcnRpY2FsID0gb3B0aW9ucy5tYXJnaW4uaXRlbTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucy5tYXJnaW4uaXRlbSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICB1dGlsLnNlbGVjdGl2ZUV4dGVuZChbJ2hvcml6b250YWwnLCAndmVydGljYWwnXSwgdGhpcy5vcHRpb25zLm1hcmdpbi5pdGVtLCBvcHRpb25zLm1hcmdpbi5pdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCdlZGl0YWJsZScgaW4gb3B0aW9ucykgewogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5lZGl0YWJsZSA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgICB0aGlzLm9wdGlvbnMuZWRpdGFibGUudXBkYXRlVGltZSA9IG9wdGlvbnMuZWRpdGFibGU7CiAgICAgICAgICB0aGlzLm9wdGlvbnMuZWRpdGFibGUudXBkYXRlR3JvdXAgPSBvcHRpb25zLmVkaXRhYmxlOwogICAgICAgICAgdGhpcy5vcHRpb25zLmVkaXRhYmxlLmFkZCA9IG9wdGlvbnMuZWRpdGFibGU7CiAgICAgICAgICB0aGlzLm9wdGlvbnMuZWRpdGFibGUucmVtb3ZlID0gb3B0aW9ucy5lZGl0YWJsZTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zLmVkaXRhYmxlID09PSAnb2JqZWN0JykgewogICAgICAgICAgdXRpbC5zZWxlY3RpdmVFeHRlbmQoWyd1cGRhdGVUaW1lJywgJ3VwZGF0ZUdyb3VwJywgJ2FkZCcsICdyZW1vdmUnXSwgdGhpcy5vcHRpb25zLmVkaXRhYmxlLCBvcHRpb25zLmVkaXRhYmxlKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIGNhbGxiYWNrIGZ1bmN0aW9ucwogICAgICB2YXIgYWRkQ2FsbGJhY2sgPSAoZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICB2YXIgZm4gPSBvcHRpb25zW25hbWVdOwogICAgICAgIGlmIChmbikgewogICAgICAgICAgaWYgKCEoZm4gaW5zdGFuY2VvZiBGdW5jdGlvbikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdvcHRpb24gJyArIG5hbWUgKyAnIG11c3QgYmUgYSBmdW5jdGlvbiAnICsgbmFtZSArICcoaXRlbSwgY2FsbGJhY2spJyk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm9wdGlvbnNbbmFtZV0gPSBmbjsKICAgICAgICB9CiAgICAgIH0pLmJpbmQodGhpcyk7CiAgICAgIFsnb25BZGQnLCAnb25VcGRhdGUnLCAnb25SZW1vdmUnLCAnb25Nb3ZlJywgJ29uTW92aW5nJ10uZm9yRWFjaChhZGRDYWxsYmFjayk7CgogICAgICAvLyBmb3JjZSB0aGUgaXRlbVNldCB0byByZWZyZXNoOiBvcHRpb25zIGxpa2Ugb3JpZW50YXRpb24gYW5kIG1hcmdpbnMgbWF5IGJlIGNoYW5nZWQKICAgICAgdGhpcy5tYXJrRGlydHkoKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBNYXJrIHRoZSBJdGVtU2V0IGRpcnR5IHNvIGl0IHdpbGwgcmVmcmVzaCBldmVyeXRoaW5nIHdpdGggbmV4dCByZWRyYXcuCiAgICogT3B0aW9uYWxseSwgYWxsIGl0ZW1zIGNhbiBiZSBtYXJrZWQgYXMgZGlydHkgYW5kIGJlIHJlZnJlc2hlZC4KICAgKiBAcGFyYW0ge3tyZWZyZXNoSXRlbXM6IGJvb2xlYW59fSBbb3B0aW9uc10KICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5tYXJrRGlydHkgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgdGhpcy5ncm91cElkcyA9IFtdOwogICAgdGhpcy5zdGFja0RpcnR5ID0gdHJ1ZTsKCiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnJlZnJlc2hJdGVtcykgewogICAgICB1dGlsLmZvckVhY2godGhpcy5pdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpdGVtLmRpcnR5ID0gdHJ1ZTsKICAgICAgICBpZiAoaXRlbS5kaXNwbGF5ZWQpIGl0ZW0ucmVkcmF3KCk7CiAgICAgIH0pOwogICAgfQogIH07CgogIC8qKgogICAqIERlc3Ryb3kgdGhlIEl0ZW1TZXQKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5oaWRlKCk7CiAgICB0aGlzLnNldEl0ZW1zKG51bGwpOwogICAgdGhpcy5zZXRHcm91cHMobnVsbCk7CgogICAgdGhpcy5oYW1tZXIgPSBudWxsOwoKICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICB0aGlzLmNvbnZlcnNpb24gPSBudWxsOwogIH07CgogIC8qKgogICAqIEhpZGUgdGhlIGNvbXBvbmVudCBmcm9tIHRoZSBET00KICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewogICAgLy8gcmVtb3ZlIHRoZSBmcmFtZSBjb250YWluaW5nIHRoZSBpdGVtcwogICAgaWYgKHRoaXMuZG9tLmZyYW1lLnBhcmVudE5vZGUpIHsKICAgICAgdGhpcy5kb20uZnJhbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmRvbS5mcmFtZSk7CiAgICB9CgogICAgLy8gcmVtb3ZlIHRoZSBheGlzIHdpdGggZG90cwogICAgaWYgKHRoaXMuZG9tLmF4aXMucGFyZW50Tm9kZSkgewogICAgICB0aGlzLmRvbS5heGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5kb20uYXhpcyk7CiAgICB9CgogICAgLy8gcmVtb3ZlIHRoZSBsYWJlbHNldCBjb250YWluaW5nIGFsbCBncm91cCBsYWJlbHMKICAgIGlmICh0aGlzLmRvbS5sYWJlbFNldC5wYXJlbnROb2RlKSB7CiAgICAgIHRoaXMuZG9tLmxhYmVsU2V0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5kb20ubGFiZWxTZXQpOwogICAgfQogIH07CgogIC8qKgogICAqIFNob3cgdGhlIGNvbXBvbmVudCBpbiB0aGUgRE9NICh3aGVuIG5vdCBhbHJlYWR5IHZpc2libGUpLgogICAqIEByZXR1cm4ge0Jvb2xlYW59IGNoYW5nZWQKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkgewogICAgLy8gc2hvdyBmcmFtZSBjb250YWluaW5nIHRoZSBpdGVtcwogICAgaWYgKCF0aGlzLmRvbS5mcmFtZS5wYXJlbnROb2RlKSB7CiAgICAgIHRoaXMuYm9keS5kb20uY2VudGVyLmFwcGVuZENoaWxkKHRoaXMuZG9tLmZyYW1lKTsKICAgIH0KCiAgICAvLyBzaG93IGF4aXMgd2l0aCBkb3RzCiAgICBpZiAoIXRoaXMuZG9tLmF4aXMucGFyZW50Tm9kZSkgewogICAgICB0aGlzLmJvZHkuZG9tLmJhY2tncm91bmRWZXJ0aWNhbC5hcHBlbmRDaGlsZCh0aGlzLmRvbS5heGlzKTsKICAgIH0KCiAgICAvLyBzaG93IGxhYmVsc2V0IGNvbnRhaW5pbmcgbGFiZWxzCiAgICBpZiAoIXRoaXMuZG9tLmxhYmVsU2V0LnBhcmVudE5vZGUpIHsKICAgICAgdGhpcy5ib2R5LmRvbS5sZWZ0LmFwcGVuZENoaWxkKHRoaXMuZG9tLmxhYmVsU2V0KTsKICAgIH0KICB9OwoKICAvKioKICAgKiBTZXQgc2VsZWN0ZWQgaXRlbXMgYnkgdGhlaXIgaWQuIFJlcGxhY2VzIHRoZSBjdXJyZW50IHNlbGVjdGlvbgogICAqIFVua25vd24gaWQncyBhcmUgc2lsZW50bHkgaWdub3JlZC4KICAgKiBAcGFyYW0ge3N0cmluZ1tdIHwgc3RyaW5nfSBbaWRzXSBBbiBhcnJheSB3aXRoIHplcm8gb3IgbW9yZSBpZCdzIG9mIHRoZSBpdGVtcyB0byBiZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkLCBvciBhIHNpbmdsZSBpdGVtIGlkLiBJZiBpZHMgaXMgdW5kZWZpbmVkCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgYW4gZW1wdHkgYXJyYXksIGFsbCBpdGVtcyB3aWxsIGJlIHVuc2VsZWN0ZWQuCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuc2V0U2VsZWN0aW9uID0gZnVuY3Rpb24gKGlkcykgewogICAgdmFyIGksIGlpLCBpZCwgaXRlbTsKCiAgICBpZiAoaWRzID09IHVuZGVmaW5lZCkgaWRzID0gW107CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoaWRzKSkgaWRzID0gW2lkc107CgogICAgLy8gdW5zZWxlY3QgY3VycmVudGx5IHNlbGVjdGVkIGl0ZW1zCiAgICBmb3IgKGkgPSAwLCBpaSA9IHRoaXMuc2VsZWN0aW9uLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgaWQgPSB0aGlzLnNlbGVjdGlvbltpXTsKICAgICAgaXRlbSA9IHRoaXMuaXRlbXNbaWRdOwogICAgICBpZiAoaXRlbSkgaXRlbS51bnNlbGVjdCgpOwogICAgfQoKICAgIC8vIHNlbGVjdCBpdGVtcwogICAgdGhpcy5zZWxlY3Rpb24gPSBbXTsKICAgIGZvciAoaSA9IDAsIGlpID0gaWRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgaWQgPSBpZHNbaV07CiAgICAgIGl0ZW0gPSB0aGlzLml0ZW1zW2lkXTsKICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICB0aGlzLnNlbGVjdGlvbi5wdXNoKGlkKTsKICAgICAgICBpdGVtLnNlbGVjdCgpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogR2V0IHRoZSBzZWxlY3RlZCBpdGVtcyBieSB0aGVpciBpZAogICAqIEByZXR1cm4ge0FycmF5fSBpZHMgIFRoZSBpZHMgb2YgdGhlIHNlbGVjdGVkIGl0ZW1zCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuZ2V0U2VsZWN0aW9uID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uLmNvbmNhdChbXSk7CiAgfTsKCiAgLyoqCiAgICogR2V0IHRoZSBpZCdzIG9mIHRoZSBjdXJyZW50bHkgdmlzaWJsZSBpdGVtcy4KICAgKiBAcmV0dXJucyB7QXJyYXl9IFRoZSBpZHMgb2YgdGhlIHZpc2libGUgaXRlbXMKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5nZXRWaXNpYmxlSXRlbXMgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgcmFuZ2UgPSB0aGlzLmJvZHkucmFuZ2UuZ2V0UmFuZ2UoKTsKICAgIHZhciBsZWZ0ID0gdGhpcy5ib2R5LnV0aWwudG9TY3JlZW4ocmFuZ2Uuc3RhcnQpOwogICAgdmFyIHJpZ2h0ID0gdGhpcy5ib2R5LnV0aWwudG9TY3JlZW4ocmFuZ2UuZW5kKTsKCiAgICB2YXIgaWRzID0gW107CiAgICBmb3IgKHZhciBncm91cElkIGluIHRoaXMuZ3JvdXBzKSB7CiAgICAgIGlmICh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShncm91cElkKSkgewogICAgICAgIHZhciBncm91cCA9IHRoaXMuZ3JvdXBzW2dyb3VwSWRdOwogICAgICAgIHZhciByYXdWaXNpYmxlSXRlbXMgPSBncm91cC52aXNpYmxlSXRlbXM7CgogICAgICAgIC8vIGZpbHRlciB0aGUgInJhdyIgc2V0IHdpdGggdmlzaWJsZUl0ZW1zIGludG8gYSBzZXQgd2hpY2ggaXMgcmVhbGx5CiAgICAgICAgLy8gdmlzaWJsZSBieSBwaXhlbHMKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhd1Zpc2libGVJdGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGl0ZW0gPSByYXdWaXNpYmxlSXRlbXNbaV07CiAgICAgICAgICAvLyBUT0RPOiBhbHNvIGNoZWNrIHdoZXRoZXIgdmlzaWJsZSB2ZXJ0aWNhbGx5CiAgICAgICAgICBpZiAoaXRlbS5sZWZ0IDwgcmlnaHQgJiYgaXRlbS5sZWZ0ICsgaXRlbS53aWR0aCA+IGxlZnQpIHsKICAgICAgICAgICAgaWRzLnB1c2goaXRlbS5pZCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGlkczsKICB9OwoKICAvKioKICAgKiBEZXNlbGVjdCBhIHNlbGVjdGVkIGl0ZW0KICAgKiBAcGFyYW0ge1N0cmluZyB8IE51bWJlcn0gaWQKICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl9kZXNlbGVjdCA9IGZ1bmN0aW9uIChpZCkgewogICAgdmFyIHNlbGVjdGlvbiA9IHRoaXMuc2VsZWN0aW9uOwogICAgZm9yICh2YXIgaSA9IDAsIGlpID0gc2VsZWN0aW9uLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgaWYgKHNlbGVjdGlvbltpXSA9PSBpZCkgewogICAgICAgIC8vIG5vbi1zdHJpY3QgY29tcGFyaXNvbiEKICAgICAgICBzZWxlY3Rpb24uc3BsaWNlKGksIDEpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmVwYWludCB0aGUgY29tcG9uZW50CiAgICogQHJldHVybiB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBjb21wb25lbnQgaXMgcmVzaXplZAogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBtYXJnaW4gPSB0aGlzLm9wdGlvbnMubWFyZ2luLAogICAgICAgIHJhbmdlID0gdGhpcy5ib2R5LnJhbmdlLAogICAgICAgIGFzU2l6ZSA9IHV0aWwub3B0aW9uLmFzU2l6ZSwKICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgIG9yaWVudGF0aW9uID0gb3B0aW9ucy5vcmllbnRhdGlvbi5pdGVtLAogICAgICAgIHJlc2l6ZWQgPSBmYWxzZSwKICAgICAgICBmcmFtZSA9IHRoaXMuZG9tLmZyYW1lOwoKICAgIC8vIHJlY2FsY3VsYXRlIGFic29sdXRlIHBvc2l0aW9uIChiZWZvcmUgcmVkcmF3aW5nIGdyb3VwcykKICAgIHRoaXMucHJvcHMudG9wID0gdGhpcy5ib2R5LmRvbVByb3BzLnRvcC5oZWlnaHQgKyB0aGlzLmJvZHkuZG9tUHJvcHMuYm9yZGVyLnRvcDsKICAgIHRoaXMucHJvcHMubGVmdCA9IHRoaXMuYm9keS5kb21Qcm9wcy5sZWZ0LndpZHRoICsgdGhpcy5ib2R5LmRvbVByb3BzLmJvcmRlci5sZWZ0OwoKICAgIC8vIHVwZGF0ZSBjbGFzcyBuYW1lCiAgICBmcmFtZS5jbGFzc05hbWUgPSAndmlzLWl0ZW1zZXQnOwoKICAgIC8vIHJlb3JkZXIgdGhlIGdyb3VwcyAoaWYgbmVlZGVkKQogICAgcmVzaXplZCA9IHRoaXMuX29yZGVyR3JvdXBzKCkgfHwgcmVzaXplZDsKCiAgICAvLyBjaGVjayB3aGV0aGVyIHpvb21lZCAoaW4gdGhhdCBjYXNlIHdlIG5lZWQgdG8gcmUtc3RhY2sgZXZlcnl0aGluZykKICAgIC8vIFRPRE86IHdvdWxkIGJlIG5pY2VyIHRvIGdldCB0aGlzIGFzIGEgdHJpZ2dlciBmcm9tIFJhbmdlCiAgICB2YXIgdmlzaWJsZUludGVydmFsID0gcmFuZ2UuZW5kIC0gcmFuZ2Uuc3RhcnQ7CiAgICB2YXIgem9vbWVkID0gdmlzaWJsZUludGVydmFsICE9IHRoaXMubGFzdFZpc2libGVJbnRlcnZhbCB8fCB0aGlzLnByb3BzLndpZHRoICE9IHRoaXMucHJvcHMubGFzdFdpZHRoOwogICAgaWYgKHpvb21lZCkgdGhpcy5zdGFja0RpcnR5ID0gdHJ1ZTsKICAgIHRoaXMubGFzdFZpc2libGVJbnRlcnZhbCA9IHZpc2libGVJbnRlcnZhbDsKICAgIHRoaXMucHJvcHMubGFzdFdpZHRoID0gdGhpcy5wcm9wcy53aWR0aDsKCiAgICB2YXIgcmVzdGFjayA9IHRoaXMuc3RhY2tEaXJ0eTsKICAgIHZhciBmaXJzdEdyb3VwID0gdGhpcy5fZmlyc3RHcm91cCgpOwogICAgdmFyIGZpcnN0TWFyZ2luID0gewogICAgICBpdGVtOiBtYXJnaW4uaXRlbSwKICAgICAgYXhpczogbWFyZ2luLmF4aXMKICAgIH07CiAgICB2YXIgbm9uRmlyc3RNYXJnaW4gPSB7CiAgICAgIGl0ZW06IG1hcmdpbi5pdGVtLAogICAgICBheGlzOiBtYXJnaW4uaXRlbS52ZXJ0aWNhbCAvIDIKICAgIH07CiAgICB2YXIgaGVpZ2h0ID0gMDsKICAgIHZhciBtaW5IZWlnaHQgPSBtYXJnaW4uYXhpcyArIG1hcmdpbi5pdGVtLnZlcnRpY2FsOwoKICAgIC8vIHJlZHJhdyB0aGUgYmFja2dyb3VuZCBncm91cAogICAgdGhpcy5ncm91cHNbQkFDS0dST1VORF0ucmVkcmF3KHJhbmdlLCBub25GaXJzdE1hcmdpbiwgcmVzdGFjayk7CgogICAgLy8gcmVkcmF3IGFsbCByZWd1bGFyIGdyb3VwcwogICAgdXRpbC5mb3JFYWNoKHRoaXMuZ3JvdXBzLCBmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgdmFyIGdyb3VwTWFyZ2luID0gZ3JvdXAgPT0gZmlyc3RHcm91cCA/IGZpcnN0TWFyZ2luIDogbm9uRmlyc3RNYXJnaW47CiAgICAgIHZhciBncm91cFJlc2l6ZWQgPSBncm91cC5yZWRyYXcocmFuZ2UsIGdyb3VwTWFyZ2luLCByZXN0YWNrKTsKICAgICAgcmVzaXplZCA9IGdyb3VwUmVzaXplZCB8fCByZXNpemVkOwogICAgICBoZWlnaHQgKz0gZ3JvdXAuaGVpZ2h0OwogICAgfSk7CiAgICBoZWlnaHQgPSBNYXRoLm1heChoZWlnaHQsIG1pbkhlaWdodCk7CiAgICB0aGlzLnN0YWNrRGlydHkgPSBmYWxzZTsKCiAgICAvLyB1cGRhdGUgZnJhbWUgaGVpZ2h0CiAgICBmcmFtZS5zdHlsZS5oZWlnaHQgPSBhc1NpemUoaGVpZ2h0KTsKCiAgICAvLyBjYWxjdWxhdGUgYWN0dWFsIHNpemUKICAgIHRoaXMucHJvcHMud2lkdGggPSBmcmFtZS5vZmZzZXRXaWR0aDsKICAgIHRoaXMucHJvcHMuaGVpZ2h0ID0gaGVpZ2h0OwoKICAgIC8vIHJlcG9zaXRpb24gYXhpcwogICAgdGhpcy5kb20uYXhpcy5zdHlsZS50b3AgPSBhc1NpemUob3JpZW50YXRpb24gPT0gJ3RvcCcgPyB0aGlzLmJvZHkuZG9tUHJvcHMudG9wLmhlaWdodCArIHRoaXMuYm9keS5kb21Qcm9wcy5ib3JkZXIudG9wIDogdGhpcy5ib2R5LmRvbVByb3BzLnRvcC5oZWlnaHQgKyB0aGlzLmJvZHkuZG9tUHJvcHMuY2VudGVyQ29udGFpbmVyLmhlaWdodCk7CiAgICB0aGlzLmRvbS5heGlzLnN0eWxlLmxlZnQgPSAnMCc7CgogICAgLy8gY2hlY2sgaWYgdGhpcyBjb21wb25lbnQgaXMgcmVzaXplZAogICAgcmVzaXplZCA9IHRoaXMuX2lzUmVzaXplZCgpIHx8IHJlc2l6ZWQ7CgogICAgcmV0dXJuIHJlc2l6ZWQ7CiAgfTsKCiAgLyoqCiAgICogR2V0IHRoZSBmaXJzdCBncm91cCwgYWxpZ25lZCB3aXRoIHRoZSBheGlzCiAgICogQHJldHVybiB7R3JvdXAgfCBudWxsfSBmaXJzdEdyb3VwCiAgICogQHByaXZhdGUKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5fZmlyc3RHcm91cCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBmaXJzdEdyb3VwSW5kZXggPSB0aGlzLm9wdGlvbnMub3JpZW50YXRpb24uaXRlbSA9PSAndG9wJyA/IDAgOiB0aGlzLmdyb3VwSWRzLmxlbmd0aCAtIDE7CiAgICB2YXIgZmlyc3RHcm91cElkID0gdGhpcy5ncm91cElkc1tmaXJzdEdyb3VwSW5kZXhdOwogICAgdmFyIGZpcnN0R3JvdXAgPSB0aGlzLmdyb3Vwc1tmaXJzdEdyb3VwSWRdIHx8IHRoaXMuZ3JvdXBzW1VOR1JPVVBFRF07CgogICAgcmV0dXJuIGZpcnN0R3JvdXAgfHwgbnVsbDsKICB9OwoKICAvKioKICAgKiBDcmVhdGUgb3IgZGVsZXRlIHRoZSBncm91cCBob2xkaW5nIGFsbCB1bmdyb3VwZWQgaXRlbXMuIFRoaXMgZ3JvdXAgaXMgdXNlZCB3aGVuCiAgICogdGhlcmUgYXJlIG5vIGdyb3VwcyBzcGVjaWZpZWQuCiAgICogQHByb3RlY3RlZAogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl91cGRhdGVVbmdyb3VwZWQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgdW5ncm91cGVkID0gdGhpcy5ncm91cHNbVU5HUk9VUEVEXTsKICAgIHZhciBiYWNrZ3JvdW5kID0gdGhpcy5ncm91cHNbQkFDS0dST1VORF07CiAgICB2YXIgaXRlbSwgaXRlbUlkOwoKICAgIGlmICh0aGlzLmdyb3Vwc0RhdGEpIHsKICAgICAgLy8gcmVtb3ZlIHRoZSBncm91cCBob2xkaW5nIGFsbCB1bmdyb3VwZWQgaXRlbXMKICAgICAgaWYgKHVuZ3JvdXBlZCkgewogICAgICAgIHVuZ3JvdXBlZC5oaWRlKCk7CiAgICAgICAgZGVsZXRlIHRoaXMuZ3JvdXBzW1VOR1JPVVBFRF07CgogICAgICAgIGZvciAoaXRlbUlkIGluIHRoaXMuaXRlbXMpIHsKICAgICAgICAgIGlmICh0aGlzLml0ZW1zLmhhc093blByb3BlcnR5KGl0ZW1JZCkpIHsKICAgICAgICAgICAgaXRlbSA9IHRoaXMuaXRlbXNbaXRlbUlkXTsKICAgICAgICAgICAgaXRlbS5wYXJlbnQgJiYgaXRlbS5wYXJlbnQucmVtb3ZlKGl0ZW0pOwogICAgICAgICAgICB2YXIgZ3JvdXBJZCA9IHRoaXMuX2dldEdyb3VwSWQoaXRlbS5kYXRhKTsKICAgICAgICAgICAgdmFyIGdyb3VwID0gdGhpcy5ncm91cHNbZ3JvdXBJZF07CiAgICAgICAgICAgIGdyb3VwICYmIGdyb3VwLmFkZChpdGVtKSB8fCBpdGVtLmhpZGUoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIGNyZWF0ZSBhIGdyb3VwIGhvbGRpbmcgYWxsICh1bmZpbHRlcmVkKSBpdGVtcwogICAgICBpZiAoIXVuZ3JvdXBlZCkgewogICAgICAgIHZhciBpZCA9IG51bGw7CiAgICAgICAgdmFyIGRhdGEgPSBudWxsOwogICAgICAgIHVuZ3JvdXBlZCA9IG5ldyBHcm91cChpZCwgZGF0YSwgdGhpcyk7CiAgICAgICAgdGhpcy5ncm91cHNbVU5HUk9VUEVEXSA9IHVuZ3JvdXBlZDsKCiAgICAgICAgZm9yIChpdGVtSWQgaW4gdGhpcy5pdGVtcykgewogICAgICAgICAgaWYgKHRoaXMuaXRlbXMuaGFzT3duUHJvcGVydHkoaXRlbUlkKSkgewogICAgICAgICAgICBpdGVtID0gdGhpcy5pdGVtc1tpdGVtSWRdOwogICAgICAgICAgICB1bmdyb3VwZWQuYWRkKGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdW5ncm91cGVkLnNob3coKTsKICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIEdldCB0aGUgZWxlbWVudCBmb3IgdGhlIGxhYmVsc2V0CiAgICogQHJldHVybiB7SFRNTEVsZW1lbnR9IGxhYmVsU2V0CiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuZ2V0TGFiZWxTZXQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5kb20ubGFiZWxTZXQ7CiAgfTsKCiAgLyoqCiAgICogU2V0IGl0ZW1zCiAgICogQHBhcmFtIHt2aXMuRGF0YVNldCB8IG51bGx9IGl0ZW1zCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuc2V0SXRlbXMgPSBmdW5jdGlvbiAoaXRlbXMpIHsKICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgaWRzLAogICAgICAgIG9sZEl0ZW1zRGF0YSA9IHRoaXMuaXRlbXNEYXRhOwoKICAgIC8vIHJlcGxhY2UgdGhlIGRhdGFzZXQKICAgIGlmICghaXRlbXMpIHsKICAgICAgdGhpcy5pdGVtc0RhdGEgPSBudWxsOwogICAgfSBlbHNlIGlmIChpdGVtcyBpbnN0YW5jZW9mIERhdGFTZXQgfHwgaXRlbXMgaW5zdGFuY2VvZiBEYXRhVmlldykgewogICAgICB0aGlzLml0ZW1zRGF0YSA9IGl0ZW1zOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRGF0YSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIERhdGFTZXQgb3IgRGF0YVZpZXcnKTsKICAgIH0KCiAgICBpZiAob2xkSXRlbXNEYXRhKSB7CiAgICAgIC8vIHVuc3Vic2NyaWJlIGZyb20gb2xkIGRhdGFzZXQKICAgICAgdXRpbC5mb3JFYWNoKHRoaXMuaXRlbUxpc3RlbmVycywgZnVuY3Rpb24gKGNhbGxiYWNrLCBldmVudCkgewogICAgICAgIG9sZEl0ZW1zRGF0YS5vZmYoZXZlbnQsIGNhbGxiYWNrKTsKICAgICAgfSk7CgogICAgICAvLyByZW1vdmUgYWxsIGRyYXduIGl0ZW1zCiAgICAgIGlkcyA9IG9sZEl0ZW1zRGF0YS5nZXRJZHMoKTsKICAgICAgdGhpcy5fb25SZW1vdmUoaWRzKTsKICAgIH0KCiAgICBpZiAodGhpcy5pdGVtc0RhdGEpIHsKICAgICAgLy8gc3Vic2NyaWJlIHRvIG5ldyBkYXRhc2V0CiAgICAgIHZhciBpZCA9IHRoaXMuaWQ7CiAgICAgIHV0aWwuZm9yRWFjaCh0aGlzLml0ZW1MaXN0ZW5lcnMsIGZ1bmN0aW9uIChjYWxsYmFjaywgZXZlbnQpIHsKICAgICAgICBtZS5pdGVtc0RhdGEub24oZXZlbnQsIGNhbGxiYWNrLCBpZCk7CiAgICAgIH0pOwoKICAgICAgLy8gYWRkIGFsbCBuZXcgaXRlbXMKICAgICAgaWRzID0gdGhpcy5pdGVtc0RhdGEuZ2V0SWRzKCk7CiAgICAgIHRoaXMuX29uQWRkKGlkcyk7CgogICAgICAvLyB1cGRhdGUgdGhlIGdyb3VwIGhvbGRpbmcgYWxsIHVuZ3JvdXBlZCBpdGVtcwogICAgICB0aGlzLl91cGRhdGVVbmdyb3VwZWQoKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBHZXQgdGhlIGN1cnJlbnQgaXRlbXMKICAgKiBAcmV0dXJucyB7dmlzLkRhdGFTZXQgfCBudWxsfQogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLmdldEl0ZW1zID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuaXRlbXNEYXRhOwogIH07CgogIC8qKgogICAqIFNldCBncm91cHMKICAgKiBAcGFyYW0ge3Zpcy5EYXRhU2V0fSBncm91cHMKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5zZXRHcm91cHMgPSBmdW5jdGlvbiAoZ3JvdXBzKSB7CiAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgIGlkczsKCiAgICAvLyB1bnN1YnNjcmliZSBmcm9tIGN1cnJlbnQgZGF0YXNldAogICAgaWYgKHRoaXMuZ3JvdXBzRGF0YSkgewogICAgICB1dGlsLmZvckVhY2godGhpcy5ncm91cExpc3RlbmVycywgZnVuY3Rpb24gKGNhbGxiYWNrLCBldmVudCkgewogICAgICAgIG1lLmdyb3Vwc0RhdGEub2ZmKGV2ZW50LCBjYWxsYmFjayk7CiAgICAgIH0pOwoKICAgICAgLy8gcmVtb3ZlIGFsbCBkcmF3biBncm91cHMKICAgICAgaWRzID0gdGhpcy5ncm91cHNEYXRhLmdldElkcygpOwogICAgICB0aGlzLmdyb3Vwc0RhdGEgPSBudWxsOwogICAgICB0aGlzLl9vblJlbW92ZUdyb3VwcyhpZHMpOyAvLyBub3RlOiB0aGlzIHdpbGwgY2F1c2UgYSByZWRyYXcKICAgIH0KCiAgICAvLyByZXBsYWNlIHRoZSBkYXRhc2V0CiAgICBpZiAoIWdyb3VwcykgewogICAgICB0aGlzLmdyb3Vwc0RhdGEgPSBudWxsOwogICAgfSBlbHNlIGlmIChncm91cHMgaW5zdGFuY2VvZiBEYXRhU2V0IHx8IGdyb3VwcyBpbnN0YW5jZW9mIERhdGFWaWV3KSB7CiAgICAgIHRoaXMuZ3JvdXBzRGF0YSA9IGdyb3VwczsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0RhdGEgbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiBEYXRhU2V0IG9yIERhdGFWaWV3Jyk7CiAgICB9CgogICAgaWYgKHRoaXMuZ3JvdXBzRGF0YSkgewogICAgICAvLyBzdWJzY3JpYmUgdG8gbmV3IGRhdGFzZXQKICAgICAgdmFyIGlkID0gdGhpcy5pZDsKICAgICAgdXRpbC5mb3JFYWNoKHRoaXMuZ3JvdXBMaXN0ZW5lcnMsIGZ1bmN0aW9uIChjYWxsYmFjaywgZXZlbnQpIHsKICAgICAgICBtZS5ncm91cHNEYXRhLm9uKGV2ZW50LCBjYWxsYmFjaywgaWQpOwogICAgICB9KTsKCiAgICAgIC8vIGRyYXcgYWxsIG1zCiAgICAgIGlkcyA9IHRoaXMuZ3JvdXBzRGF0YS5nZXRJZHMoKTsKICAgICAgdGhpcy5fb25BZGRHcm91cHMoaWRzKTsKICAgIH0KCiAgICAvLyB1cGRhdGUgdGhlIGdyb3VwIGhvbGRpbmcgYWxsIHVuZ3JvdXBlZCBpdGVtcwogICAgdGhpcy5fdXBkYXRlVW5ncm91cGVkKCk7CgogICAgLy8gdXBkYXRlIHRoZSBvcmRlciBvZiBhbGwgaXRlbXMgaW4gZWFjaCBncm91cAogICAgdGhpcy5fb3JkZXIoKTsKCiAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdjaGFuZ2UnLCB7IHF1ZXVlOiB0cnVlIH0pOwogIH07CgogIC8qKgogICAqIEdldCB0aGUgY3VycmVudCBncm91cHMKICAgKiBAcmV0dXJucyB7dmlzLkRhdGFTZXQgfCBudWxsfSBncm91cHMKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5nZXRHcm91cHMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5ncm91cHNEYXRhOwogIH07CgogIC8qKgogICAqIFJlbW92ZSBhbiBpdGVtIGJ5IGl0cyBpZAogICAqIEBwYXJhbSB7U3RyaW5nIHwgTnVtYmVyfSBpZAogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLnJlbW92ZUl0ZW0gPSBmdW5jdGlvbiAoaWQpIHsKICAgIHZhciBpdGVtID0gdGhpcy5pdGVtc0RhdGEuZ2V0KGlkKSwKICAgICAgICBkYXRhc2V0ID0gdGhpcy5pdGVtc0RhdGEuZ2V0RGF0YVNldCgpOwoKICAgIGlmIChpdGVtKSB7CiAgICAgIC8vIGNvbmZpcm0gZGVsZXRpb24KICAgICAgdGhpcy5vcHRpb25zLm9uUmVtb3ZlKGl0ZW0sIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgIC8vIHJlbW92ZSBieSBpZCBoZXJlLCBpdCBpcyBwb3NzaWJsZSB0aGF0IGFuIGl0ZW0gaGFzIG5vIGlkIGRlZmluZWQKICAgICAgICAgIC8vIGl0c2VsZiwgc28gYmV0dGVyIG5vdCBkZWxldGUgYnkgdGhlIGl0ZW0gaXRzZWxmCiAgICAgICAgICBkYXRhc2V0LnJlbW92ZShpZCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9OwoKICAvKioKICAgKiBHZXQgdGhlIHRpbWUgb2YgYW4gaXRlbSBiYXNlZCBvbiBpdCdzIGRhdGEgYW5kIG9wdGlvbnMudHlwZQogICAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtRGF0YQogICAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHR5cGUKICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl9nZXRUeXBlID0gZnVuY3Rpb24gKGl0ZW1EYXRhKSB7CiAgICByZXR1cm4gaXRlbURhdGEudHlwZSB8fCB0aGlzLm9wdGlvbnMudHlwZSB8fCAoaXRlbURhdGEuZW5kID8gJ3JhbmdlJyA6ICdib3gnKTsKICB9OwoKICAvKioKICAgKiBHZXQgdGhlIGdyb3VwIGlkIGZvciBhbiBpdGVtCiAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW1EYXRhCiAgICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgZ3JvdXBJZAogICAqIEBwcml2YXRlCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuX2dldEdyb3VwSWQgPSBmdW5jdGlvbiAoaXRlbURhdGEpIHsKICAgIHZhciB0eXBlID0gdGhpcy5fZ2V0VHlwZShpdGVtRGF0YSk7CiAgICBpZiAodHlwZSA9PSAnYmFja2dyb3VuZCcgJiYgaXRlbURhdGEuZ3JvdXAgPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiBCQUNLR1JPVU5EOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHRoaXMuZ3JvdXBzRGF0YSA/IGl0ZW1EYXRhLmdyb3VwIDogVU5HUk9VUEVEOwogICAgfQogIH07CgogIC8qKgogICAqIEhhbmRsZSB1cGRhdGVkIGl0ZW1zCiAgICogQHBhcmFtIHtOdW1iZXJbXX0gaWRzCiAgICogQHByb3RlY3RlZAogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl9vblVwZGF0ZSA9IGZ1bmN0aW9uIChpZHMpIHsKICAgIHZhciBtZSA9IHRoaXM7CgogICAgaWRzLmZvckVhY2goKGZ1bmN0aW9uIChpZCkgewogICAgICB2YXIgaXRlbURhdGEgPSBtZS5pdGVtc0RhdGEuZ2V0KGlkLCBtZS5pdGVtT3B0aW9ucyk7CiAgICAgIHZhciBpdGVtID0gbWUuaXRlbXNbaWRdOwogICAgICB2YXIgdHlwZSA9IG1lLl9nZXRUeXBlKGl0ZW1EYXRhKTsKCiAgICAgIHZhciBjb25zdHJ1Y3RvciA9IEl0ZW1TZXQudHlwZXNbdHlwZV07CiAgICAgIHZhciBzZWxlY3RlZDsKCiAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgLy8gdXBkYXRlIGl0ZW0KICAgICAgICBpZiAoIWNvbnN0cnVjdG9yIHx8ICEoaXRlbSBpbnN0YW5jZW9mIGNvbnN0cnVjdG9yKSkgewogICAgICAgICAgLy8gaXRlbSB0eXBlIGhhcyBjaGFuZ2VkLCBkZWxldGUgdGhlIGl0ZW0gYW5kIHJlY3JlYXRlIGl0CiAgICAgICAgICBzZWxlY3RlZCA9IGl0ZW0uc2VsZWN0ZWQ7IC8vIHByZXNlcnZlIHNlbGVjdGlvbiBvZiB0aGlzIGl0ZW0KICAgICAgICAgIG1lLl9yZW1vdmVJdGVtKGl0ZW0pOwogICAgICAgICAgaXRlbSA9IG51bGw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1lLl91cGRhdGVJdGVtKGl0ZW0sIGl0ZW1EYXRhKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaXRlbSkgewogICAgICAgIC8vIGNyZWF0ZSBpdGVtCiAgICAgICAgaWYgKGNvbnN0cnVjdG9yKSB7CiAgICAgICAgICBpdGVtID0gbmV3IGNvbnN0cnVjdG9yKGl0ZW1EYXRhLCBtZS5jb252ZXJzaW9uLCBtZS5vcHRpb25zKTsKICAgICAgICAgIGl0ZW0uaWQgPSBpZDsgLy8gVE9ETzogbm90IHNvIG5pY2Ugc2V0dGluZyBpZCBhZnRlcndhcmRzCiAgICAgICAgICBtZS5fYWRkSXRlbShpdGVtKTsKICAgICAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgICB0aGlzLnNlbGVjdGlvbi5wdXNoKGlkKTsKICAgICAgICAgICAgaXRlbS5zZWxlY3QoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gJ3Jhbmdlb3ZlcmZsb3cnKSB7CiAgICAgICAgICAvLyBUT0RPOiBkZXByZWNhdGVkIHNpbmNlIHZlcnNpb24gMi4xLjAgKG9yIDMuMC4wPykuIGNsZWFudXAgc29tZSBkYXkKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0l0ZW0gdHlwZSAicmFuZ2VvdmVyZmxvdyIgaXMgZGVwcmVjYXRlZC4gVXNlIGNzcyBzdHlsaW5nIGluc3RlYWQ6ICcgKyAnLnZpcy1pdGVtLnZpcy1yYW5nZSAudmlzLWl0ZW0tY29udGVudCB7b3ZlcmZsb3c6IHZpc2libGU7fScpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdVbmtub3duIGl0ZW0gdHlwZSAiJyArIHR5cGUgKyAnIicpOwogICAgICAgIH0KICAgICAgfQogICAgfSkuYmluZCh0aGlzKSk7CgogICAgdGhpcy5fb3JkZXIoKTsKICAgIHRoaXMuc3RhY2tEaXJ0eSA9IHRydWU7IC8vIGZvcmNlIHJlLXN0YWNraW5nIG9mIGFsbCBpdGVtcyBuZXh0IHJlZHJhdwogICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnY2hhbmdlJywgeyBxdWV1ZTogdHJ1ZSB9KTsKICB9OwoKICAvKioKICAgKiBIYW5kbGUgYWRkZWQgaXRlbXMKICAgKiBAcGFyYW0ge051bWJlcltdfSBpZHMKICAgKiBAcHJvdGVjdGVkCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuX29uQWRkID0gSXRlbVNldC5wcm90b3R5cGUuX29uVXBkYXRlOwoKICAvKioKICAgKiBIYW5kbGUgcmVtb3ZlZCBpdGVtcwogICAqIEBwYXJhbSB7TnVtYmVyW119IGlkcwogICAqIEBwcm90ZWN0ZWQKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5fb25SZW1vdmUgPSBmdW5jdGlvbiAoaWRzKSB7CiAgICB2YXIgY291bnQgPSAwOwogICAgdmFyIG1lID0gdGhpczsKICAgIGlkcy5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgICB2YXIgaXRlbSA9IG1lLml0ZW1zW2lkXTsKICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICBjb3VudCsrOwogICAgICAgIG1lLl9yZW1vdmVJdGVtKGl0ZW0pOwogICAgICB9CiAgICB9KTsKCiAgICBpZiAoY291bnQpIHsKICAgICAgLy8gdXBkYXRlIG9yZGVyCiAgICAgIHRoaXMuX29yZGVyKCk7CiAgICAgIHRoaXMuc3RhY2tEaXJ0eSA9IHRydWU7IC8vIGZvcmNlIHJlLXN0YWNraW5nIG9mIGFsbCBpdGVtcyBuZXh0IHJlZHJhdwogICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdjaGFuZ2UnLCB7IHF1ZXVlOiB0cnVlIH0pOwogICAgfQogIH07CgogIC8qKgogICAqIFVwZGF0ZSB0aGUgb3JkZXIgb2YgaXRlbSBpbiBhbGwgZ3JvdXBzCiAgICogQHByaXZhdGUKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5fb3JkZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAvLyByZW9yZGVyIHRoZSBpdGVtcyBpbiBhbGwgZ3JvdXBzCiAgICAvLyBUT0RPOiBvcHRpbWl6YXRpb246IG9ubHkgcmVvcmRlciBncm91cHMgYWZmZWN0ZWQgYnkgdGhlIGNoYW5nZWQgaXRlbXMKICAgIHV0aWwuZm9yRWFjaCh0aGlzLmdyb3VwcywgZnVuY3Rpb24gKGdyb3VwKSB7CiAgICAgIGdyb3VwLm9yZGVyKCk7CiAgICB9KTsKICB9OwoKICAvKioKICAgKiBIYW5kbGUgdXBkYXRlZCBncm91cHMKICAgKiBAcGFyYW0ge051bWJlcltdfSBpZHMKICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl9vblVwZGF0ZUdyb3VwcyA9IGZ1bmN0aW9uIChpZHMpIHsKICAgIHRoaXMuX29uQWRkR3JvdXBzKGlkcyk7CiAgfTsKCiAgLyoqCiAgICogSGFuZGxlIGNoYW5nZWQgZ3JvdXBzIChhZGRlZCBvciB1cGRhdGVkKQogICAqIEBwYXJhbSB7TnVtYmVyW119IGlkcwogICAqIEBwcml2YXRlCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuX29uQWRkR3JvdXBzID0gZnVuY3Rpb24gKGlkcykgewogICAgdmFyIG1lID0gdGhpczsKCiAgICBpZHMuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHsKICAgICAgdmFyIGdyb3VwRGF0YSA9IG1lLmdyb3Vwc0RhdGEuZ2V0KGlkKTsKICAgICAgdmFyIGdyb3VwID0gbWUuZ3JvdXBzW2lkXTsKCiAgICAgIGlmICghZ3JvdXApIHsKICAgICAgICAvLyBjaGVjayBmb3IgcmVzZXJ2ZWQgaWRzCiAgICAgICAgaWYgKGlkID09IFVOR1JPVVBFRCB8fCBpZCA9PSBCQUNLR1JPVU5EKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0lsbGVnYWwgZ3JvdXAgaWQuICcgKyBpZCArICcgaXMgYSByZXNlcnZlZCBpZC4nKTsKICAgICAgICB9CgogICAgICAgIHZhciBncm91cE9wdGlvbnMgPSBPYmplY3QuY3JlYXRlKG1lLm9wdGlvbnMpOwogICAgICAgIHV0aWwuZXh0ZW5kKGdyb3VwT3B0aW9ucywgewogICAgICAgICAgaGVpZ2h0OiBudWxsCiAgICAgICAgfSk7CgogICAgICAgIGdyb3VwID0gbmV3IEdyb3VwKGlkLCBncm91cERhdGEsIG1lKTsKICAgICAgICBtZS5ncm91cHNbaWRdID0gZ3JvdXA7CgogICAgICAgIC8vIGFkZCBpdGVtcyB3aXRoIHRoaXMgZ3JvdXBJZCB0byB0aGUgbmV3IGdyb3VwCiAgICAgICAgZm9yICh2YXIgaXRlbUlkIGluIG1lLml0ZW1zKSB7CiAgICAgICAgICBpZiAobWUuaXRlbXMuaGFzT3duUHJvcGVydHkoaXRlbUlkKSkgewogICAgICAgICAgICB2YXIgaXRlbSA9IG1lLml0ZW1zW2l0ZW1JZF07CiAgICAgICAgICAgIGlmIChpdGVtLmRhdGEuZ3JvdXAgPT0gaWQpIHsKICAgICAgICAgICAgICBncm91cC5hZGQoaXRlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGdyb3VwLm9yZGVyKCk7CiAgICAgICAgZ3JvdXAuc2hvdygpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHVwZGF0ZSBncm91cAogICAgICAgIGdyb3VwLnNldERhdGEoZ3JvdXBEYXRhKTsKICAgICAgfQogICAgfSk7CgogICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnY2hhbmdlJywgeyBxdWV1ZTogdHJ1ZSB9KTsKICB9OwoKICAvKioKICAgKiBIYW5kbGUgcmVtb3ZlZCBncm91cHMKICAgKiBAcGFyYW0ge051bWJlcltdfSBpZHMKICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl9vblJlbW92ZUdyb3VwcyA9IGZ1bmN0aW9uIChpZHMpIHsKICAgIHZhciBncm91cHMgPSB0aGlzLmdyb3VwczsKICAgIGlkcy5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgICB2YXIgZ3JvdXAgPSBncm91cHNbaWRdOwoKICAgICAgaWYgKGdyb3VwKSB7CiAgICAgICAgZ3JvdXAuaGlkZSgpOwogICAgICAgIGRlbGV0ZSBncm91cHNbaWRdOwogICAgICB9CiAgICB9KTsKCiAgICB0aGlzLm1hcmtEaXJ0eSgpOwoKICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ2NoYW5nZScsIHsgcXVldWU6IHRydWUgfSk7CiAgfTsKCiAgLyoqCiAgICogUmVvcmRlciB0aGUgZ3JvdXBzIGlmIG5lZWRlZAogICAqIEByZXR1cm4ge2Jvb2xlYW59IGNoYW5nZWQKICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl9vcmRlckdyb3VwcyA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmdyb3Vwc0RhdGEpIHsKICAgICAgLy8gcmVvcmRlciB0aGUgZ3JvdXBzCiAgICAgIHZhciBncm91cElkcyA9IHRoaXMuZ3JvdXBzRGF0YS5nZXRJZHMoewogICAgICAgIG9yZGVyOiB0aGlzLm9wdGlvbnMuZ3JvdXBPcmRlcgogICAgICB9KTsKCiAgICAgIHZhciBjaGFuZ2VkID0gIXV0aWwuZXF1YWxBcnJheShncm91cElkcywgdGhpcy5ncm91cElkcyk7CiAgICAgIGlmIChjaGFuZ2VkKSB7CiAgICAgICAgLy8gaGlkZSBhbGwgZ3JvdXBzLCByZW1vdmVzIHRoZW0gZnJvbSB0aGUgRE9NCiAgICAgICAgdmFyIGdyb3VwcyA9IHRoaXMuZ3JvdXBzOwogICAgICAgIGdyb3VwSWRzLmZvckVhY2goZnVuY3Rpb24gKGdyb3VwSWQpIHsKICAgICAgICAgIGdyb3Vwc1tncm91cElkXS5oaWRlKCk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIHNob3cgdGhlIGdyb3VwcyBhZ2FpbiwgYXR0YWNoIHRoZW0gdG8gdGhlIERPTSBpbiBjb3JyZWN0IG9yZGVyCiAgICAgICAgZ3JvdXBJZHMuZm9yRWFjaChmdW5jdGlvbiAoZ3JvdXBJZCkgewogICAgICAgICAgZ3JvdXBzW2dyb3VwSWRdLnNob3coKTsKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5ncm91cElkcyA9IGdyb3VwSWRzOwogICAgICB9CgogICAgICByZXR1cm4gY2hhbmdlZDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9OwoKICAvKioKICAgKiBBZGQgYSBuZXcgaXRlbQogICAqIEBwYXJhbSB7SXRlbX0gaXRlbQogICAqIEBwcml2YXRlCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuX2FkZEl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkgewogICAgdGhpcy5pdGVtc1tpdGVtLmlkXSA9IGl0ZW07CgogICAgLy8gYWRkIHRvIGdyb3VwCiAgICB2YXIgZ3JvdXBJZCA9IHRoaXMuX2dldEdyb3VwSWQoaXRlbS5kYXRhKTsKICAgIHZhciBncm91cCA9IHRoaXMuZ3JvdXBzW2dyb3VwSWRdOwogICAgaWYgKGdyb3VwKSBncm91cC5hZGQoaXRlbSk7CiAgfTsKCiAgLyoqCiAgICogVXBkYXRlIGFuIGV4aXN0aW5nIGl0ZW0KICAgKiBAcGFyYW0ge0l0ZW19IGl0ZW0KICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbURhdGEKICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl91cGRhdGVJdGVtID0gZnVuY3Rpb24gKGl0ZW0sIGl0ZW1EYXRhKSB7CiAgICB2YXIgb2xkR3JvdXBJZCA9IGl0ZW0uZGF0YS5ncm91cDsKICAgIHZhciBvbGRTdWJHcm91cElkID0gaXRlbS5kYXRhLnN1Ymdyb3VwOwoKICAgIC8vIHVwZGF0ZSB0aGUgaXRlbXMgZGF0YSAod2lsbCByZWRyYXcgdGhlIGl0ZW0gd2hlbiBkaXNwbGF5ZWQpCiAgICBpdGVtLnNldERhdGEoaXRlbURhdGEpOwoKICAgIC8vIHVwZGF0ZSBncm91cAogICAgaWYgKG9sZEdyb3VwSWQgIT0gaXRlbS5kYXRhLmdyb3VwIHx8IG9sZFN1Ykdyb3VwSWQgIT0gaXRlbS5kYXRhLnN1Ymdyb3VwKSB7CiAgICAgIHZhciBvbGRHcm91cCA9IHRoaXMuZ3JvdXBzW29sZEdyb3VwSWRdOwogICAgICBpZiAob2xkR3JvdXApIG9sZEdyb3VwLnJlbW92ZShpdGVtKTsKCiAgICAgIHZhciBncm91cElkID0gdGhpcy5fZ2V0R3JvdXBJZChpdGVtLmRhdGEpOwogICAgICB2YXIgZ3JvdXAgPSB0aGlzLmdyb3Vwc1tncm91cElkXTsKICAgICAgaWYgKGdyb3VwKSBncm91cC5hZGQoaXRlbSk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogRGVsZXRlIGFuIGl0ZW0gZnJvbSB0aGUgSXRlbVNldDogcmVtb3ZlIGl0IGZyb20gdGhlIERPTSwgZnJvbSB0aGUgbWFwCiAgICogd2l0aCBpdGVtcywgYW5kIGZyb20gdGhlIG1hcCB3aXRoIHZpc2libGUgaXRlbXMsIGFuZCBmcm9tIHRoZSBzZWxlY3Rpb24KICAgKiBAcGFyYW0ge0l0ZW19IGl0ZW0KICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl9yZW1vdmVJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHsKICAgIC8vIHJlbW92ZSBmcm9tIERPTQogICAgaXRlbS5oaWRlKCk7CgogICAgLy8gcmVtb3ZlIGZyb20gaXRlbXMKICAgIGRlbGV0ZSB0aGlzLml0ZW1zW2l0ZW0uaWRdOwoKICAgIC8vIHJlbW92ZSBmcm9tIHNlbGVjdGlvbgogICAgdmFyIGluZGV4ID0gdGhpcy5zZWxlY3Rpb24uaW5kZXhPZihpdGVtLmlkKTsKICAgIGlmIChpbmRleCAhPSAtMSkgdGhpcy5zZWxlY3Rpb24uc3BsaWNlKGluZGV4LCAxKTsKCiAgICAvLyByZW1vdmUgZnJvbSBncm91cAogICAgaXRlbS5wYXJlbnQgJiYgaXRlbS5wYXJlbnQucmVtb3ZlKGl0ZW0pOwogIH07CgogIC8qKgogICAqIENyZWF0ZSBhbiBhcnJheSBjb250YWluaW5nIGFsbCBpdGVtcyBiZWluZyBhIHJhbmdlIChoYXZpbmcgYW4gZW5kIGRhdGUpCiAgICogQHBhcmFtIGFycmF5CiAgICogQHJldHVybnMge0FycmF5fQogICAqIEBwcml2YXRlCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuX2NvbnN0cnVjdEJ5RW5kQXJyYXkgPSBmdW5jdGlvbiAoYXJyYXkpIHsKICAgIHZhciBlbmRBcnJheSA9IFtdOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGFycmF5W2ldIGluc3RhbmNlb2YgUmFuZ2VJdGVtKSB7CiAgICAgICAgZW5kQXJyYXkucHVzaChhcnJheVtpXSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbmRBcnJheTsKICB9OwoKICAvKioKICAgKiBSZWdpc3RlciB0aGUgY2xpY2tlZCBpdGVtIG9uIHRvdWNoLCBiZWZvcmUgZHJhZ1N0YXJ0IGlzIGluaXRpYXRlZC4KICAgKgogICAqIGRyYWdTdGFydCBpcyBpbml0aWF0ZWQgZnJvbSBhIG1vdXNlbW92ZSBldmVudCwgQUZURVIgdGhlIG1vdXNlL3RvdWNoIGlzCiAgICogYWxyZWFkeSBtb3ZpbmcuIFRoZXJlZm9yZSwgdGhlIG1vdXNlL3RvdWNoIGNhbiBzb21ldGltZXMgYmUgYWJvdmUgYW4gb3RoZXIKICAgKiBET00gZWxlbWVudCB0aGFuIHRoZSBpdGVtIGl0c2VsZi4KICAgKgogICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50CiAgICogQHByaXZhdGUKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5fb25Ub3VjaCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgLy8gc3RvcmUgdGhlIHRvdWNoZWQgaXRlbSwgdXNlZCBpbiBfb25EcmFnU3RhcnQKICAgIHRoaXMudG91Y2hQYXJhbXMuaXRlbSA9IHRoaXMuaXRlbUZyb21UYXJnZXQoZXZlbnQpOwogICAgdGhpcy50b3VjaFBhcmFtcy5kcmFnTGVmdEl0ZW0gPSBldmVudC50YXJnZXQuZHJhZ0xlZnRJdGVtIHx8IGZhbHNlOwogICAgdGhpcy50b3VjaFBhcmFtcy5kcmFnUmlnaHRJdGVtID0gZXZlbnQudGFyZ2V0LmRyYWdSaWdodEl0ZW0gfHwgZmFsc2U7CiAgICB0aGlzLnRvdWNoUGFyYW1zLml0ZW1Qcm9wcyA9IG51bGw7CiAgfTsKCiAgLyoqCiAgICogU3RhcnQgZHJhZ2dpbmcgdGhlIHNlbGVjdGVkIGV2ZW50cwogICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50CiAgICogQHByaXZhdGUKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5fb25EcmFnU3RhcnQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHZhciBpdGVtID0gdGhpcy50b3VjaFBhcmFtcy5pdGVtIHx8IG51bGw7CiAgICB2YXIgbWUgPSB0aGlzOwogICAgdmFyIHByb3BzOwoKICAgIGlmIChpdGVtICYmIGl0ZW0uc2VsZWN0ZWQpIHsKCiAgICAgIGlmICghdGhpcy5vcHRpb25zLmVkaXRhYmxlLnVwZGF0ZVRpbWUgJiYgIXRoaXMub3B0aW9ucy5lZGl0YWJsZS51cGRhdGVHcm91cCAmJiAhaXRlbS5lZGl0YWJsZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gb3ZlcnJpZGUgb3B0aW9ucy5lZGl0YWJsZQogICAgICBpZiAoaXRlbS5lZGl0YWJsZSA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBkcmFnTGVmdEl0ZW0gPSB0aGlzLnRvdWNoUGFyYW1zLmRyYWdMZWZ0SXRlbTsKICAgICAgdmFyIGRyYWdSaWdodEl0ZW0gPSB0aGlzLnRvdWNoUGFyYW1zLmRyYWdSaWdodEl0ZW07CgogICAgICBpZiAoZHJhZ0xlZnRJdGVtKSB7CiAgICAgICAgcHJvcHMgPSB7CiAgICAgICAgICBpdGVtOiBkcmFnTGVmdEl0ZW0sCiAgICAgICAgICBpbml0aWFsWDogZXZlbnQuY2VudGVyLngsCiAgICAgICAgICBkcmFnTGVmdDogdHJ1ZSwKICAgICAgICAgIGRhdGE6IHV0aWwuZXh0ZW5kKHt9LCBpdGVtLmRhdGEpIC8vIGNsb25lIHRoZSBpdGVtcyBkYXRhCiAgICAgICAgfTsKCiAgICAgICAgdGhpcy50b3VjaFBhcmFtcy5pdGVtUHJvcHMgPSBbcHJvcHNdOwogICAgICB9IGVsc2UgaWYgKGRyYWdSaWdodEl0ZW0pIHsKICAgICAgICBwcm9wcyA9IHsKICAgICAgICAgIGl0ZW06IGRyYWdSaWdodEl0ZW0sCiAgICAgICAgICBpbml0aWFsWDogZXZlbnQuY2VudGVyLngsCiAgICAgICAgICBkcmFnUmlnaHQ6IHRydWUsCiAgICAgICAgICBkYXRhOiB1dGlsLmV4dGVuZCh7fSwgaXRlbS5kYXRhKSAvLyBjbG9uZSB0aGUgaXRlbXMgZGF0YQogICAgICAgIH07CgogICAgICAgIHRoaXMudG91Y2hQYXJhbXMuaXRlbVByb3BzID0gW3Byb3BzXTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRvdWNoUGFyYW1zLml0ZW1Qcm9wcyA9IHRoaXMuZ2V0U2VsZWN0aW9uKCkubWFwKGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgdmFyIGl0ZW0gPSBtZS5pdGVtc1tpZF07CiAgICAgICAgICB2YXIgcHJvcHMgPSB7CiAgICAgICAgICAgIGl0ZW06IGl0ZW0sCiAgICAgICAgICAgIGluaXRpYWxYOiBldmVudC5jZW50ZXIueCwKICAgICAgICAgICAgZGF0YTogdXRpbC5leHRlbmQoe30sIGl0ZW0uZGF0YSkgLy8gY2xvbmUgdGhlIGl0ZW1zIGRhdGEKICAgICAgICAgIH07CgogICAgICAgICAgcmV0dXJuIHByb3BzOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLmVkaXRhYmxlLmFkZCAmJiAoZXZlbnQuc3JjRXZlbnQuY3RybEtleSB8fCBldmVudC5zcmNFdmVudC5tZXRhS2V5KSkgewogICAgICAvLyBjcmVhdGUgYSBuZXcgcmFuZ2UgaXRlbSB3aGVuIGRyYWdnaW5nIHdpdGggY3RybCBrZXkgZG93bgogICAgICB0aGlzLl9vbkRyYWdTdGFydEFkZEl0ZW0oZXZlbnQpOwogICAgfQogIH07CgogIC8qKgogICAqIFN0YXJ0IGNyZWF0aW5nIGEgbmV3IHJhbmdlIGl0ZW0gYnkgZHJhZ2dpbmcuCiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl9vbkRyYWdTdGFydEFkZEl0ZW0gPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHZhciBzbmFwID0gdGhpcy5vcHRpb25zLnNuYXAgfHwgbnVsbDsKICAgIHZhciB4QWJzID0gdXRpbC5nZXRBYnNvbHV0ZUxlZnQodGhpcy5kb20uZnJhbWUpOwogICAgdmFyIHggPSBldmVudC5jZW50ZXIueCAtIHhBYnMgLSAxMDsgLy8gbWludXMgMTAgdG8gY29tcGVuc2F0ZSBmb3IgdGhlIGRyYWcgc3RhcnRpbmcgYXMgc29vbiBhcyB5b3UndmUgbW92ZWQgMTBweAogICAgdmFyIHRpbWUgPSB0aGlzLmJvZHkudXRpbC50b1RpbWUoeCk7CiAgICB2YXIgc2NhbGUgPSB0aGlzLmJvZHkudXRpbC5nZXRTY2FsZSgpOwogICAgdmFyIHN0ZXAgPSB0aGlzLmJvZHkudXRpbC5nZXRTdGVwKCk7CiAgICB2YXIgc3RhcnQgPSBzbmFwID8gc25hcCh0aW1lLCBzY2FsZSwgc3RlcCkgOiBzdGFydDsKICAgIHZhciBlbmQgPSBzdGFydDsKCiAgICB2YXIgaXRlbURhdGEgPSB7CiAgICAgIHR5cGU6ICdyYW5nZScsCiAgICAgIHN0YXJ0OiBzdGFydCwKICAgICAgZW5kOiBlbmQsCiAgICAgIGNvbnRlbnQ6ICduZXcgaXRlbScKICAgIH07CgogICAgdmFyIGlkID0gdXRpbC5yYW5kb21VVUlEKCk7CiAgICBpdGVtRGF0YVt0aGlzLml0ZW1zRGF0YS5fZmllbGRJZF0gPSBpZDsKCiAgICB2YXIgZ3JvdXAgPSB0aGlzLmdyb3VwRnJvbVRhcmdldChldmVudCk7CiAgICBpZiAoZ3JvdXApIHsKICAgICAgaXRlbURhdGEuZ3JvdXAgPSBncm91cC5ncm91cElkOwogICAgfQoKICAgIHZhciBuZXdJdGVtID0gbmV3IFJhbmdlSXRlbShpdGVtRGF0YSwgdGhpcy5jb252ZXJzaW9uLCB0aGlzLm9wdGlvbnMpOwogICAgbmV3SXRlbS5pZCA9IGlkOyAvLyBUT0RPOiBub3Qgc28gbmljZSBzZXR0aW5nIGlkIGFmdGVyd2FyZHMKICAgIG5ld0l0ZW0uZGF0YSA9IGl0ZW1EYXRhOwogICAgdGhpcy5fYWRkSXRlbShuZXdJdGVtKTsKCiAgICB2YXIgcHJvcHMgPSB7CiAgICAgIGl0ZW06IG5ld0l0ZW0sCiAgICAgIGRyYWdSaWdodDogdHJ1ZSwKICAgICAgaW5pdGlhbFg6IGV2ZW50LmNlbnRlci54LAogICAgICBkYXRhOiB1dGlsLmV4dGVuZCh7fSwgaXRlbURhdGEpCiAgICB9OwogICAgdGhpcy50b3VjaFBhcmFtcy5pdGVtUHJvcHMgPSBbcHJvcHNdOwoKICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogIH07CgogIC8qKgogICAqIERyYWcgc2VsZWN0ZWQgaXRlbXMKICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudAogICAqIEBwcml2YXRlCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuX29uRHJhZyA9IGZ1bmN0aW9uIChldmVudCkgewogICAgaWYgKHRoaXMudG91Y2hQYXJhbXMuaXRlbVByb3BzKSB7CiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHNuYXAgPSB0aGlzLm9wdGlvbnMuc25hcCB8fCBudWxsOwogICAgICB2YXIgeE9mZnNldCA9IHRoaXMuYm9keS5kb20ucm9vdC5vZmZzZXRMZWZ0ICsgdGhpcy5ib2R5LmRvbVByb3BzLmxlZnQud2lkdGg7CiAgICAgIHZhciBzY2FsZSA9IHRoaXMuYm9keS51dGlsLmdldFNjYWxlKCk7CiAgICAgIHZhciBzdGVwID0gdGhpcy5ib2R5LnV0aWwuZ2V0U3RlcCgpOwoKICAgICAgLy8gbW92ZQogICAgICB0aGlzLnRvdWNoUGFyYW1zLml0ZW1Qcm9wcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wcykgewogICAgICAgIHZhciBuZXdQcm9wcyA9IHt9OwogICAgICAgIHZhciBjdXJyZW50ID0gbWUuYm9keS51dGlsLnRvVGltZShldmVudC5jZW50ZXIueCAtIHhPZmZzZXQpOwogICAgICAgIHZhciBpbml0aWFsID0gbWUuYm9keS51dGlsLnRvVGltZShwcm9wcy5pbml0aWFsWCAtIHhPZmZzZXQpOwogICAgICAgIHZhciBvZmZzZXQgPSBjdXJyZW50IC0gaW5pdGlhbDsKCiAgICAgICAgdmFyIGl0ZW1EYXRhID0gdXRpbC5leHRlbmQoe30sIHByb3BzLml0ZW0uZGF0YSk7IC8vIGNsb25lIHRoZSBkYXRhCgogICAgICAgIGlmIChwcm9wcy5pdGVtLmVkaXRhYmxlID09PSBmYWxzZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHVwZGF0ZVRpbWVBbGxvd2VkID0gbWUub3B0aW9ucy5lZGl0YWJsZS51cGRhdGVUaW1lIHx8IHByb3BzLml0ZW0uZWRpdGFibGUgPT09IHRydWU7CgogICAgICAgIGlmICh1cGRhdGVUaW1lQWxsb3dlZCkgewogICAgICAgICAgaWYgKHByb3BzLmRyYWdMZWZ0KSB7CiAgICAgICAgICAgIC8vIGRyYWcgbGVmdCBzaWRlIG9mIGEgcmFuZ2UgaXRlbQogICAgICAgICAgICBpZiAoaXRlbURhdGEuc3RhcnQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdmFyIGluaXRpYWxTdGFydCA9IHV0aWwuY29udmVydChwcm9wcy5kYXRhLnN0YXJ0LCAnRGF0ZScpOwogICAgICAgICAgICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKGluaXRpYWxTdGFydC52YWx1ZU9mKCkgKyBvZmZzZXQpOwogICAgICAgICAgICAgIGl0ZW1EYXRhLnN0YXJ0ID0gc25hcCA/IHNuYXAoc3RhcnQsIHNjYWxlLCBzdGVwKSA6IHN0YXJ0OwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHByb3BzLmRyYWdSaWdodCkgewogICAgICAgICAgICAvLyBkcmFnIHJpZ2h0IHNpZGUgb2YgYSByYW5nZSBpdGVtCiAgICAgICAgICAgIGlmIChpdGVtRGF0YS5lbmQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdmFyIGluaXRpYWxFbmQgPSB1dGlsLmNvbnZlcnQocHJvcHMuZGF0YS5lbmQsICdEYXRlJyk7CiAgICAgICAgICAgICAgdmFyIGVuZCA9IG5ldyBEYXRlKGluaXRpYWxFbmQudmFsdWVPZigpICsgb2Zmc2V0KTsKICAgICAgICAgICAgICBpdGVtRGF0YS5lbmQgPSBzbmFwID8gc25hcChlbmQsIHNjYWxlLCBzdGVwKSA6IGVuZDsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gZHJhZyBib3RoIHN0YXJ0IGFuZCBlbmQKICAgICAgICAgICAgaWYgKGl0ZW1EYXRhLnN0YXJ0ICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHZhciBpbml0aWFsU3RhcnQgPSB1dGlsLmNvbnZlcnQocHJvcHMuZGF0YS5zdGFydCwgJ0RhdGUnKS52YWx1ZU9mKCk7CiAgICAgICAgICAgICAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoaW5pdGlhbFN0YXJ0ICsgb2Zmc2V0KTsKCiAgICAgICAgICAgICAgaWYgKGl0ZW1EYXRhLmVuZCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZhciBpbml0aWFsRW5kID0gdXRpbC5jb252ZXJ0KHByb3BzLmRhdGEuZW5kLCAnRGF0ZScpOwogICAgICAgICAgICAgICAgdmFyIGR1cmF0aW9uID0gaW5pdGlhbEVuZC52YWx1ZU9mKCkgLSBpbml0aWFsU3RhcnQudmFsdWVPZigpOwoKICAgICAgICAgICAgICAgIGl0ZW1EYXRhLnN0YXJ0ID0gc25hcCA/IHNuYXAoc3RhcnQsIHNjYWxlLCBzdGVwKSA6IHN0YXJ0OwogICAgICAgICAgICAgICAgaXRlbURhdGEuZW5kID0gbmV3IERhdGUoaXRlbURhdGEuc3RhcnQudmFsdWVPZigpICsgZHVyYXRpb24pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpdGVtRGF0YS5zdGFydCA9IHNuYXAgPyBzbmFwKHN0YXJ0LCBzY2FsZSwgc3RlcCkgOiBzdGFydDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciB1cGRhdGVHcm91cEFsbG93ZWQgPSBtZS5vcHRpb25zLmVkaXRhYmxlLnVwZGF0ZUdyb3VwIHx8IHByb3BzLml0ZW0uZWRpdGFibGUgPT09IHRydWU7CgogICAgICAgIGlmICh1cGRhdGVHcm91cEFsbG93ZWQgJiYgKCFwcm9wcy5kcmFnTGVmdCAmJiAhcHJvcHMuZHJhZ1JpZ2h0KSkgewogICAgICAgICAgaWYgKGl0ZW1EYXRhLmdyb3VwICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyBkcmFnIGZyb20gb25lIGdyb3VwIHRvIGFub3RoZXIKICAgICAgICAgICAgdmFyIGdyb3VwID0gbWUuZ3JvdXBGcm9tVGFyZ2V0KGV2ZW50KTsKICAgICAgICAgICAgaWYgKGdyb3VwKSB7CiAgICAgICAgICAgICAgaXRlbURhdGEuZ3JvdXAgPSBncm91cC5ncm91cElkOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjb25maXJtIG1vdmluZyB0aGUgaXRlbQogICAgICAgIG1lLm9wdGlvbnMub25Nb3ZpbmcoaXRlbURhdGEsIGZ1bmN0aW9uIChpdGVtRGF0YSkgewogICAgICAgICAgaWYgKGl0ZW1EYXRhKSB7CiAgICAgICAgICAgIHByb3BzLml0ZW0uc2V0RGF0YShpdGVtRGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgdGhpcy5zdGFja0RpcnR5ID0gdHJ1ZTsgLy8gZm9yY2UgcmUtc3RhY2tpbmcgb2YgYWxsIGl0ZW1zIG5leHQgcmVkcmF3CiAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ2NoYW5nZScpOwogICAgfQogIH07CgogIC8qKgogICAqIE1vdmUgYW4gaXRlbSB0byBhbm90aGVyIGdyb3VwCiAgICogQHBhcmFtIHtJdGVtfSBpdGVtCiAgICogQHBhcmFtIHtTdHJpbmcgfCBOdW1iZXJ9IGdyb3VwSWQKICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLl9tb3ZlVG9Hcm91cCA9IGZ1bmN0aW9uIChpdGVtLCBncm91cElkKSB7CiAgICB2YXIgZ3JvdXAgPSB0aGlzLmdyb3Vwc1tncm91cElkXTsKICAgIGlmIChncm91cCAmJiBncm91cC5ncm91cElkICE9IGl0ZW0uZGF0YS5ncm91cCkgewogICAgICB2YXIgb2xkR3JvdXAgPSBpdGVtLnBhcmVudDsKICAgICAgb2xkR3JvdXAucmVtb3ZlKGl0ZW0pOwogICAgICBvbGRHcm91cC5vcmRlcigpOwogICAgICBncm91cC5hZGQoaXRlbSk7CiAgICAgIGdyb3VwLm9yZGVyKCk7CgogICAgICBpdGVtLmRhdGEuZ3JvdXAgPSBncm91cC5ncm91cElkOwogICAgfQogIH07CgogIC8qKgogICAqIEVuZCBvZiBkcmFnZ2luZyBzZWxlY3RlZCBpdGVtcwogICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50CiAgICogQHByaXZhdGUKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5fb25EcmFnRW5kID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZiAodGhpcy50b3VjaFBhcmFtcy5pdGVtUHJvcHMpIHsKICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CgogICAgICAvLyBwcmVwYXJlIGEgY2hhbmdlIHNldCBmb3IgdGhlIGNoYW5nZWQgaXRlbXMKICAgICAgdmFyIGNoYW5nZXMgPSBbXTsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGRhdGFzZXQgPSB0aGlzLml0ZW1zRGF0YS5nZXREYXRhU2V0KCk7CgogICAgICB2YXIgaXRlbVByb3BzID0gdGhpcy50b3VjaFBhcmFtcy5pdGVtUHJvcHM7CiAgICAgIHRoaXMudG91Y2hQYXJhbXMuaXRlbVByb3BzID0gbnVsbDsKICAgICAgaXRlbVByb3BzLmZvckVhY2goZnVuY3Rpb24gKHByb3BzKSB7CiAgICAgICAgdmFyIGlkID0gcHJvcHMuaXRlbS5pZDsKICAgICAgICB2YXIgZXhpc3RzID0gbWUuaXRlbXNEYXRhLmdldChpZCwgbWUuaXRlbU9wdGlvbnMpICE9IG51bGw7CgogICAgICAgIGlmICghZXhpc3RzKSB7CiAgICAgICAgICAvLyBhZGQgYSBuZXcgaXRlbQogICAgICAgICAgbWUub3B0aW9ucy5vbkFkZChwcm9wcy5pdGVtLmRhdGEsIGZ1bmN0aW9uIChpdGVtRGF0YSkgewogICAgICAgICAgICBtZS5fcmVtb3ZlSXRlbShwcm9wcy5pdGVtKTsgLy8gcmVtb3ZlIHRlbXBvcmFyeSBpdGVtCiAgICAgICAgICAgIGlmIChpdGVtRGF0YSkgewogICAgICAgICAgICAgIG1lLml0ZW1zRGF0YS5nZXREYXRhU2V0KCkuYWRkKGl0ZW1EYXRhKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZm9yY2UgcmUtc3RhY2tpbmcgb2YgYWxsIGl0ZW1zIG5leHQgcmVkcmF3CiAgICAgICAgICAgIG1lLnN0YWNrRGlydHkgPSB0cnVlOwogICAgICAgICAgICBtZS5ib2R5LmVtaXR0ZXIuZW1pdCgnY2hhbmdlJyk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gdXBkYXRlIGV4aXN0aW5nIGl0ZW0KICAgICAgICAgIHZhciBpdGVtRGF0YSA9IHV0aWwuZXh0ZW5kKHt9LCBwcm9wcy5pdGVtLmRhdGEpOyAvLyBjbG9uZSB0aGUgZGF0YQogICAgICAgICAgbWUub3B0aW9ucy5vbk1vdmUoaXRlbURhdGEsIGZ1bmN0aW9uIChpdGVtRGF0YSkgewogICAgICAgICAgICBpZiAoaXRlbURhdGEpIHsKICAgICAgICAgICAgICAvLyBhcHBseSBjaGFuZ2VzCiAgICAgICAgICAgICAgaXRlbURhdGFbZGF0YXNldC5fZmllbGRJZF0gPSBpZDsgLy8gZW5zdXJlIHRoZSBpdGVtIGNvbnRhaW5zIGl0cyBpZCAoY2FuIGJlIHVuZGVmaW5lZCkKICAgICAgICAgICAgICBjaGFuZ2VzLnB1c2goaXRlbURhdGEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIHJlc3RvcmUgb3JpZ2luYWwgdmFsdWVzCiAgICAgICAgICAgICAgcHJvcHMuaXRlbS5zZXREYXRhKHByb3BzLmRhdGEpOwoKICAgICAgICAgICAgICBtZS5zdGFja0RpcnR5ID0gdHJ1ZTsgLy8gZm9yY2UgcmUtc3RhY2tpbmcgb2YgYWxsIGl0ZW1zIG5leHQgcmVkcmF3CiAgICAgICAgICAgICAgbWUuYm9keS5lbWl0dGVyLmVtaXQoJ2NoYW5nZScpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8gYXBwbHkgdGhlIGNoYW5nZXMgdG8gdGhlIGRhdGEgKGlmIHRoZXJlIGFyZSBjaGFuZ2VzKQogICAgICBpZiAoY2hhbmdlcy5sZW5ndGgpIHsKICAgICAgICBkYXRhc2V0LnVwZGF0ZShjaGFuZ2VzKTsKICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIEhhbmRsZSBzZWxlY3RpbmcvZGVzZWxlY3RpbmcgYW4gaXRlbSB3aGVuIHRhcHBpbmcgaXQKICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudAogICAqIEBwcml2YXRlCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuX29uU2VsZWN0SXRlbSA9IGZ1bmN0aW9uIChldmVudCkgewogICAgaWYgKCF0aGlzLm9wdGlvbnMuc2VsZWN0YWJsZSkgcmV0dXJuOwoKICAgIHZhciBjdHJsS2V5ID0gZXZlbnQuc3JjRXZlbnQgJiYgKGV2ZW50LnNyY0V2ZW50LmN0cmxLZXkgfHwgZXZlbnQuc3JjRXZlbnQubWV0YUtleSk7CiAgICB2YXIgc2hpZnRLZXkgPSBldmVudC5zcmNFdmVudCAmJiBldmVudC5zcmNFdmVudC5zaGlmdEtleTsKICAgIGlmIChjdHJsS2V5IHx8IHNoaWZ0S2V5KSB7CiAgICAgIHRoaXMuX29uTXVsdGlTZWxlY3RJdGVtKGV2ZW50KTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBvbGRTZWxlY3Rpb24gPSB0aGlzLmdldFNlbGVjdGlvbigpOwoKICAgIHZhciBpdGVtID0gdGhpcy5pdGVtRnJvbVRhcmdldChldmVudCk7CiAgICB2YXIgc2VsZWN0aW9uID0gaXRlbSA/IFtpdGVtLmlkXSA6IFtdOwogICAgdGhpcy5zZXRTZWxlY3Rpb24oc2VsZWN0aW9uKTsKCiAgICB2YXIgbmV3U2VsZWN0aW9uID0gdGhpcy5nZXRTZWxlY3Rpb24oKTsKCiAgICAvLyBlbWl0IGEgc2VsZWN0IGV2ZW50LAogICAgLy8gZXhjZXB0IHdoZW4gb2xkIHNlbGVjdGlvbiBpcyBlbXB0eSBhbmQgbmV3IHNlbGVjdGlvbiBpcyBzdGlsbCBlbXB0eQogICAgaWYgKG5ld1NlbGVjdGlvbi5sZW5ndGggPiAwIHx8IG9sZFNlbGVjdGlvbi5sZW5ndGggPiAwKSB7CiAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ3NlbGVjdCcsIHsKICAgICAgICBpdGVtczogbmV3U2VsZWN0aW9uLAogICAgICAgIGV2ZW50OiBldmVudAogICAgICB9KTsKICAgIH0KICB9OwoKICAvKioKICAgKiBIYW5kbGUgY3JlYXRpb24gYW5kIHVwZGF0ZXMgb2YgYW4gaXRlbSBvbiBkb3VibGUgdGFwCiAgICogQHBhcmFtIGV2ZW50CiAgICogQHByaXZhdGUKICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5fb25BZGRJdGVtID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZiAoIXRoaXMub3B0aW9ucy5zZWxlY3RhYmxlKSByZXR1cm47CiAgICBpZiAoIXRoaXMub3B0aW9ucy5lZGl0YWJsZS5hZGQpIHJldHVybjsKCiAgICB2YXIgbWUgPSB0aGlzOwogICAgdmFyIHNuYXAgPSB0aGlzLm9wdGlvbnMuc25hcCB8fCBudWxsOwogICAgdmFyIGl0ZW0gPSB0aGlzLml0ZW1Gcm9tVGFyZ2V0KGV2ZW50KTsKCiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCiAgICBpZiAoaXRlbSkgewogICAgICAvLyB1cGRhdGUgaXRlbQoKICAgICAgLy8gZXhlY3V0ZSBhc3luYyBoYW5kbGVyIHRvIHVwZGF0ZSB0aGUgaXRlbSAob3IgY2FuY2VsIGl0KQogICAgICB2YXIgaXRlbURhdGEgPSBtZS5pdGVtc0RhdGEuZ2V0KGl0ZW0uaWQpOyAvLyBnZXQgYSBjbG9uZSBvZiB0aGUgZGF0YSBmcm9tIHRoZSBkYXRhc2V0CiAgICAgIHRoaXMub3B0aW9ucy5vblVwZGF0ZShpdGVtRGF0YSwgZnVuY3Rpb24gKGl0ZW1EYXRhKSB7CiAgICAgICAgaWYgKGl0ZW1EYXRhKSB7CiAgICAgICAgICBtZS5pdGVtc0RhdGEuZ2V0RGF0YVNldCgpLnVwZGF0ZShpdGVtRGF0YSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGFkZCBpdGVtCiAgICAgIHZhciB4QWJzID0gdXRpbC5nZXRBYnNvbHV0ZUxlZnQodGhpcy5kb20uZnJhbWUpOwogICAgICB2YXIgeCA9IGV2ZW50LmNlbnRlci54IC0geEFiczsKICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5ib2R5LnV0aWwudG9UaW1lKHgpOwogICAgICB2YXIgc2NhbGUgPSB0aGlzLmJvZHkudXRpbC5nZXRTY2FsZSgpOwogICAgICB2YXIgc3RlcCA9IHRoaXMuYm9keS51dGlsLmdldFN0ZXAoKTsKCiAgICAgIHZhciBuZXdJdGVtID0gewogICAgICAgIHN0YXJ0OiBzbmFwID8gc25hcChzdGFydCwgc2NhbGUsIHN0ZXApIDogc3RhcnQsCiAgICAgICAgY29udGVudDogJ25ldyBpdGVtJwogICAgICB9OwoKICAgICAgLy8gd2hlbiBkZWZhdWx0IHR5cGUgaXMgYSByYW5nZSwgYWRkIGEgZGVmYXVsdCBlbmQgZGF0ZSB0byB0aGUgbmV3IGl0ZW0KICAgICAgaWYgKHRoaXMub3B0aW9ucy50eXBlID09PSAncmFuZ2UnKSB7CiAgICAgICAgdmFyIGVuZCA9IHRoaXMuYm9keS51dGlsLnRvVGltZSh4ICsgdGhpcy5wcm9wcy53aWR0aCAvIDUpOwogICAgICAgIG5ld0l0ZW0uZW5kID0gc25hcCA/IHNuYXAoZW5kLCBzY2FsZSwgc3RlcCkgOiBlbmQ7CiAgICAgIH0KCiAgICAgIG5ld0l0ZW1bdGhpcy5pdGVtc0RhdGEuX2ZpZWxkSWRdID0gdXRpbC5yYW5kb21VVUlEKCk7CgogICAgICB2YXIgZ3JvdXAgPSB0aGlzLmdyb3VwRnJvbVRhcmdldChldmVudCk7CiAgICAgIGlmIChncm91cCkgewogICAgICAgIG5ld0l0ZW0uZ3JvdXAgPSBncm91cC5ncm91cElkOwogICAgICB9CgogICAgICAvLyBleGVjdXRlIGFzeW5jIGhhbmRsZXIgdG8gY3VzdG9taXplIChvciBjYW5jZWwpIGFkZGluZyBhbiBpdGVtCiAgICAgIHRoaXMub3B0aW9ucy5vbkFkZChuZXdJdGVtLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICBtZS5pdGVtc0RhdGEuZ2V0RGF0YVNldCgpLmFkZChpdGVtKTsKICAgICAgICAgIC8vIFRPRE86IG5lZWQgdG8gdHJpZ2dlciBhIHJlZHJhdz8KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH07CgogIC8qKgogICAqIEhhbmRsZSBzZWxlY3RpbmcvZGVzZWxlY3RpbmcgbXVsdGlwbGUgaXRlbXMgd2hlbiBob2xkaW5nIGFuIGl0ZW0KICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudAogICAqIEBwcml2YXRlCiAgICovCiAgSXRlbVNldC5wcm90b3R5cGUuX29uTXVsdGlTZWxlY3RJdGVtID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZiAoIXRoaXMub3B0aW9ucy5zZWxlY3RhYmxlKSByZXR1cm47CgogICAgdmFyIGl0ZW0gPSB0aGlzLml0ZW1Gcm9tVGFyZ2V0KGV2ZW50KTsKCiAgICBpZiAoaXRlbSkgewogICAgICAvLyBtdWx0aSBzZWxlY3QgaXRlbXMgKGlmIGFsbG93ZWQpCgogICAgICB2YXIgc2VsZWN0aW9uID0gdGhpcy5vcHRpb25zLm11bHRpc2VsZWN0ID8gdGhpcy5nZXRTZWxlY3Rpb24oKSAvLyB0YWtlIGN1cnJlbnQgc2VsZWN0aW9uCiAgICAgIDogW107IC8vIGRlc2VsZWN0IGN1cnJlbnQgc2VsZWN0aW9uCgogICAgICB2YXIgc2hpZnRLZXkgPSBldmVudC5zcmNFdmVudCAmJiBldmVudC5zcmNFdmVudC5zaGlmdEtleSB8fCBmYWxzZTsKCiAgICAgIGlmIChzaGlmdEtleSAmJiB0aGlzLm9wdGlvbnMubXVsdGlzZWxlY3QpIHsKICAgICAgICAvLyBzZWxlY3QgYWxsIGl0ZW1zIGJldHdlZW4gdGhlIG9sZCBzZWxlY3Rpb24gYW5kIHRoZSB0YXBwZWQgaXRlbQoKICAgICAgICAvLyBkZXRlcm1pbmUgdGhlIHNlbGVjdGlvbiByYW5nZQogICAgICAgIHNlbGVjdGlvbi5wdXNoKGl0ZW0uaWQpOwogICAgICAgIHZhciByYW5nZSA9IEl0ZW1TZXQuX2dldEl0ZW1SYW5nZSh0aGlzLml0ZW1zRGF0YS5nZXQoc2VsZWN0aW9uLCB0aGlzLml0ZW1PcHRpb25zKSk7CgogICAgICAgIC8vIHNlbGVjdCBhbGwgaXRlbXMgd2l0aGluIHRoZSBzZWxlY3Rpb24gcmFuZ2UKICAgICAgICBzZWxlY3Rpb24gPSBbXTsKICAgICAgICBmb3IgKHZhciBpZCBpbiB0aGlzLml0ZW1zKSB7CiAgICAgICAgICBpZiAodGhpcy5pdGVtcy5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgICAgdmFyIF9pdGVtID0gdGhpcy5pdGVtc1tpZF07CiAgICAgICAgICAgIHZhciBzdGFydCA9IF9pdGVtLmRhdGEuc3RhcnQ7CiAgICAgICAgICAgIHZhciBlbmQgPSBfaXRlbS5kYXRhLmVuZCAhPT0gdW5kZWZpbmVkID8gX2l0ZW0uZGF0YS5lbmQgOiBzdGFydDsKCiAgICAgICAgICAgIGlmIChzdGFydCA+PSByYW5nZS5taW4gJiYgZW5kIDw9IHJhbmdlLm1heCAmJiAhKF9pdGVtIGluc3RhbmNlb2YgQmFja2dyb3VuZEl0ZW0pKSB7CiAgICAgICAgICAgICAgc2VsZWN0aW9uLnB1c2goX2l0ZW0uaWQpOyAvLyBkbyBub3QgdXNlIGlkIGJ1dCBpdGVtLmlkLCBpZCBpdHNlbGYgaXMgc3RyaW5naWZpZWQKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBhZGQvcmVtb3ZlIHRoaXMgaXRlbSBmcm9tIHRoZSBjdXJyZW50IHNlbGVjdGlvbgogICAgICAgIHZhciBpbmRleCA9IHNlbGVjdGlvbi5pbmRleE9mKGl0ZW0uaWQpOwogICAgICAgIGlmIChpbmRleCA9PSAtMSkgewogICAgICAgICAgLy8gaXRlbSBpcyBub3QgeWV0IHNlbGVjdGVkIC0+IHNlbGVjdCBpdAogICAgICAgICAgc2VsZWN0aW9uLnB1c2goaXRlbS5pZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGl0ZW0gaXMgYWxyZWFkeSBzZWxlY3RlZCAtPiBkZXNlbGVjdCBpdAogICAgICAgICAgc2VsZWN0aW9uLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnNldFNlbGVjdGlvbihzZWxlY3Rpb24pOwoKICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnc2VsZWN0JywgewogICAgICAgIGl0ZW1zOiB0aGlzLmdldFNlbGVjdGlvbigpLAogICAgICAgIGV2ZW50OiBldmVudAogICAgICB9KTsKICAgIH0KICB9OwoKICAvKioKICAgKiBDYWxjdWxhdGUgdGhlIHRpbWUgcmFuZ2Ugb2YgYSBsaXN0IG9mIGl0ZW1zCiAgICogQHBhcmFtIHtBcnJheS48T2JqZWN0Pn0gaXRlbXNEYXRhCiAgICogQHJldHVybiB7e21pbjogRGF0ZSwgbWF4OiBEYXRlfX0gUmV0dXJucyB0aGUgcmFuZ2Ugb2YgdGhlIHByb3ZpZGVkIGl0ZW1zCiAgICogQHByaXZhdGUKICAgKi8KICBJdGVtU2V0Ll9nZXRJdGVtUmFuZ2UgPSBmdW5jdGlvbiAoaXRlbXNEYXRhKSB7CiAgICB2YXIgbWF4ID0gbnVsbDsKICAgIHZhciBtaW4gPSBudWxsOwoKICAgIGl0ZW1zRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIGlmIChtaW4gPT0gbnVsbCB8fCBkYXRhLnN0YXJ0IDwgbWluKSB7CiAgICAgICAgbWluID0gZGF0YS5zdGFydDsKICAgICAgfQoKICAgICAgaWYgKGRhdGEuZW5kICE9IHVuZGVmaW5lZCkgewogICAgICAgIGlmIChtYXggPT0gbnVsbCB8fCBkYXRhLmVuZCA+IG1heCkgewogICAgICAgICAgbWF4ID0gZGF0YS5lbmQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChtYXggPT0gbnVsbCB8fCBkYXRhLnN0YXJ0ID4gbWF4KSB7CiAgICAgICAgICBtYXggPSBkYXRhLnN0YXJ0OwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIHsKICAgICAgbWluOiBtaW4sCiAgICAgIG1heDogbWF4CiAgICB9OwogIH07CgogIC8qKgogICAqIEZpbmQgYW4gaXRlbSBmcm9tIGFuIGV2ZW50IHRhcmdldDoKICAgKiBzZWFyY2hlcyBmb3IgdGhlIGF0dHJpYnV0ZSAndGltZWxpbmUtaXRlbScgaW4gdGhlIGV2ZW50IHRhcmdldCdzIGVsZW1lbnQgdHJlZQogICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50CiAgICogQHJldHVybiB7SXRlbSB8IG51bGx9IGl0ZW0KICAgKi8KICBJdGVtU2V0LnByb3RvdHlwZS5pdGVtRnJvbVRhcmdldCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDsKICAgIHdoaWxlICh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldC5oYXNPd25Qcm9wZXJ0eSgndGltZWxpbmUtaXRlbScpKSB7CiAgICAgICAgcmV0dXJuIHRhcmdldFsndGltZWxpbmUtaXRlbSddOwogICAgICB9CiAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlOwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH07CgogIC8qKgogICAqIEZpbmQgdGhlIEdyb3VwIGZyb20gYW4gZXZlbnQgdGFyZ2V0OgogICAqIHNlYXJjaGVzIGZvciB0aGUgYXR0cmlidXRlICd0aW1lbGluZS1ncm91cCcgaW4gdGhlIGV2ZW50IHRhcmdldCdzIGVsZW1lbnQgdHJlZQogICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50CiAgICogQHJldHVybiB7R3JvdXAgfCBudWxsfSBncm91cAogICAqLwogIEl0ZW1TZXQucHJvdG90eXBlLmdyb3VwRnJvbVRhcmdldCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgdmFyIGNsaWVudFkgPSBldmVudC5jZW50ZXIgPyBldmVudC5jZW50ZXIueSA6IGV2ZW50LmNsaWVudFk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZ3JvdXBJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGdyb3VwSWQgPSB0aGlzLmdyb3VwSWRzW2ldOwogICAgICB2YXIgZ3JvdXAgPSB0aGlzLmdyb3Vwc1tncm91cElkXTsKICAgICAgdmFyIGZvcmVncm91bmQgPSBncm91cC5kb20uZm9yZWdyb3VuZDsKICAgICAgdmFyIHRvcCA9IHV0aWwuZ2V0QWJzb2x1dGVUb3AoZm9yZWdyb3VuZCk7CiAgICAgIGlmIChjbGllbnRZID4gdG9wICYmIGNsaWVudFkgPCB0b3AgKyBmb3JlZ3JvdW5kLm9mZnNldEhlaWdodCkgewogICAgICAgIHJldHVybiBncm91cDsKICAgICAgfQoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5vcmllbnRhdGlvbi5pdGVtID09PSAndG9wJykgewogICAgICAgIGlmIChpID09PSB0aGlzLmdyb3VwSWRzLmxlbmd0aCAtIDEgJiYgY2xpZW50WSA+IHRvcCkgewogICAgICAgICAgcmV0dXJuIGdyb3VwOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoaSA9PT0gMCAmJiBjbGllbnRZIDwgdG9wICsgZm9yZWdyb3VuZC5vZmZzZXQpIHsKICAgICAgICAgIHJldHVybiBncm91cDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9OwoKICAvKioKICAgKiBGaW5kIHRoZSBJdGVtU2V0IGZyb20gYW4gZXZlbnQgdGFyZ2V0OgogICAqIHNlYXJjaGVzIGZvciB0aGUgYXR0cmlidXRlICd0aW1lbGluZS1pdGVtc2V0JyBpbiB0aGUgZXZlbnQgdGFyZ2V0J3MgZWxlbWVudCB0cmVlCiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcmV0dXJuIHtJdGVtU2V0IHwgbnVsbH0gaXRlbQogICAqLwogIEl0ZW1TZXQuaXRlbVNldEZyb21UYXJnZXQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7CiAgICB3aGlsZSAodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQuaGFzT3duUHJvcGVydHkoJ3RpbWVsaW5lLWl0ZW1zZXQnKSkgewogICAgICAgIHJldHVybiB0YXJnZXRbJ3RpbWVsaW5lLWl0ZW1zZXQnXTsKICAgICAgfQogICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZTsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9OwoKICBtb2R1bGUuZXhwb3J0cyA9IEl0ZW1TZXQ7CgovKioqLyB9LAovKiAzMiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CiAgdmFyIHN0YWNrID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMyk7CiAgdmFyIFJhbmdlSXRlbSA9IF9fd2VicGFja19yZXF1aXJlX18oMzQpOwoKICAvKioKICAgKiBAY29uc3RydWN0b3IgR3JvdXAKICAgKiBAcGFyYW0ge051bWJlciB8IFN0cmluZ30gZ3JvdXBJZAogICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhCiAgICogQHBhcmFtIHtJdGVtU2V0fSBpdGVtU2V0CiAgICovCiAgZnVuY3Rpb24gR3JvdXAoZ3JvdXBJZCwgZGF0YSwgaXRlbVNldCkgewogICAgdGhpcy5ncm91cElkID0gZ3JvdXBJZDsKICAgIHRoaXMuc3ViZ3JvdXBzID0ge307CiAgICB0aGlzLnN1Ymdyb3VwSW5kZXggPSAwOwogICAgdGhpcy5zdWJncm91cE9yZGVyZXIgPSBkYXRhICYmIGRhdGEuc3ViZ3JvdXBPcmRlcjsKICAgIHRoaXMuaXRlbVNldCA9IGl0ZW1TZXQ7CgogICAgdGhpcy5kb20gPSB7fTsKICAgIHRoaXMucHJvcHMgPSB7CiAgICAgIGxhYmVsOiB7CiAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgaGVpZ2h0OiAwCiAgICAgIH0KICAgIH07CiAgICB0aGlzLmNsYXNzTmFtZSA9IG51bGw7CgogICAgdGhpcy5pdGVtcyA9IHt9OyAvLyBpdGVtcyBmaWx0ZXJlZCBieSBncm91cElkIG9mIHRoaXMgZ3JvdXAKICAgIHRoaXMudmlzaWJsZUl0ZW1zID0gW107IC8vIGl0ZW1zIGN1cnJlbnRseSB2aXNpYmxlIGluIHdpbmRvdwogICAgdGhpcy5vcmRlcmVkSXRlbXMgPSB7CiAgICAgIGJ5U3RhcnQ6IFtdLAogICAgICBieUVuZDogW10KICAgIH07CiAgICB0aGlzLmNoZWNrUmFuZ2VkSXRlbXMgPSBmYWxzZTsgLy8gbmVlZGVkIHRvIHJlZnJlc2ggdGhlIHJhbmdlZCBpdGVtcyBpZiB0aGUgd2luZG93IGlzIHByb2dyYW1hdGljYWxseSBjaGFuZ2VkIHdpdGggTk8gb3ZlcmxhcC4KICAgIHZhciBtZSA9IHRoaXM7CiAgICB0aGlzLml0ZW1TZXQuYm9keS5lbWl0dGVyLm9uKCdjaGVja1JhbmdlZEl0ZW1zJywgZnVuY3Rpb24gKCkgewogICAgICBtZS5jaGVja1JhbmdlZEl0ZW1zID0gdHJ1ZTsKICAgIH0pOwoKICAgIHRoaXMuX2NyZWF0ZSgpOwoKICAgIHRoaXMuc2V0RGF0YShkYXRhKTsKICB9CgogIC8qKgogICAqIENyZWF0ZSBET00gZWxlbWVudHMgZm9yIHRoZSBncm91cAogICAqIEBwcml2YXRlCiAgICovCiAgR3JvdXAucHJvdG90eXBlLl9jcmVhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGxhYmVsLmNsYXNzTmFtZSA9ICd2aXMtbGFiZWwnOwogICAgdGhpcy5kb20ubGFiZWwgPSBsYWJlbDsKCiAgICB2YXIgaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGlubmVyLmNsYXNzTmFtZSA9ICd2aXMtaW5uZXInOwogICAgbGFiZWwuYXBwZW5kQ2hpbGQoaW5uZXIpOwogICAgdGhpcy5kb20uaW5uZXIgPSBpbm5lcjsKCiAgICB2YXIgZm9yZWdyb3VuZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgZm9yZWdyb3VuZC5jbGFzc05hbWUgPSAndmlzLWdyb3VwJzsKICAgIGZvcmVncm91bmRbJ3RpbWVsaW5lLWdyb3VwJ10gPSB0aGlzOwogICAgdGhpcy5kb20uZm9yZWdyb3VuZCA9IGZvcmVncm91bmQ7CgogICAgdGhpcy5kb20uYmFja2dyb3VuZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20uYmFja2dyb3VuZC5jbGFzc05hbWUgPSAndmlzLWdyb3VwJzsKCiAgICB0aGlzLmRvbS5heGlzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5heGlzLmNsYXNzTmFtZSA9ICd2aXMtZ3JvdXAnOwoKICAgIC8vIGNyZWF0ZSBhIGhpZGRlbiBtYXJrZXIgdG8gZGV0ZWN0IHdoZW4gdGhlIFRpbWVsaW5lcyBjb250YWluZXIgaXMgYXR0YWNoZWQKICAgIC8vIHRvIHRoZSBET00sIG9yIHRoZSBzdHlsZSBvZiBhIHBhcmVudCBvZiB0aGUgVGltZWxpbmUgaXMgY2hhbmdlZCBmcm9tCiAgICAvLyBkaXNwbGF5Om5vbmUgaXMgY2hhbmdlZCB0byB2aXNpYmxlLgogICAgdGhpcy5kb20ubWFya2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5tYXJrZXIuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOwogICAgdGhpcy5kb20ubWFya2VyLmlubmVySFRNTCA9ICc/JzsKICAgIHRoaXMuZG9tLmJhY2tncm91bmQuYXBwZW5kQ2hpbGQodGhpcy5kb20ubWFya2VyKTsKICB9OwoKICAvKioKICAgKiBTZXQgdGhlIGdyb3VwIGRhdGEgZm9yIHRoaXMgZ3JvdXAKICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSAgIEdyb3VwIGRhdGEsIGNhbiBjb250YWluIHByb3BlcnRpZXMgY29udGVudCBhbmQgY2xhc3NOYW1lCiAgICovCiAgR3JvdXAucHJvdG90eXBlLnNldERhdGEgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgLy8gdXBkYXRlIGNvbnRlbnRzCiAgICB2YXIgY29udGVudCA9IGRhdGEgJiYgZGF0YS5jb250ZW50OwogICAgaWYgKGNvbnRlbnQgaW5zdGFuY2VvZiBFbGVtZW50KSB7CiAgICAgIHRoaXMuZG9tLmlubmVyLmFwcGVuZENoaWxkKGNvbnRlbnQpOwogICAgfSBlbHNlIGlmIChjb250ZW50ICE9PSB1bmRlZmluZWQgJiYgY29udGVudCAhPT0gbnVsbCkgewogICAgICB0aGlzLmRvbS5pbm5lci5pbm5lckhUTUwgPSBjb250ZW50OwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kb20uaW5uZXIuaW5uZXJIVE1MID0gdGhpcy5ncm91cElkIHx8ICcnOyAvLyBncm91cElkIGNhbiBiZSBudWxsCiAgICB9CgogICAgLy8gdXBkYXRlIHRpdGxlCiAgICB0aGlzLmRvbS5sYWJlbC50aXRsZSA9IGRhdGEgJiYgZGF0YS50aXRsZSB8fCAnJzsKCiAgICBpZiAoIXRoaXMuZG9tLmlubmVyLmZpcnN0Q2hpbGQpIHsKICAgICAgdXRpbC5hZGRDbGFzc05hbWUodGhpcy5kb20uaW5uZXIsICd2aXMtaGlkZGVuJyk7CiAgICB9IGVsc2UgewogICAgICB1dGlsLnJlbW92ZUNsYXNzTmFtZSh0aGlzLmRvbS5pbm5lciwgJ3Zpcy1oaWRkZW4nKTsKICAgIH0KCiAgICAvLyB1cGRhdGUgY2xhc3NOYW1lCiAgICB2YXIgY2xhc3NOYW1lID0gZGF0YSAmJiBkYXRhLmNsYXNzTmFtZSB8fCBudWxsOwogICAgaWYgKGNsYXNzTmFtZSAhPSB0aGlzLmNsYXNzTmFtZSkgewogICAgICBpZiAodGhpcy5jbGFzc05hbWUpIHsKICAgICAgICB1dGlsLnJlbW92ZUNsYXNzTmFtZSh0aGlzLmRvbS5sYWJlbCwgdGhpcy5jbGFzc05hbWUpOwogICAgICAgIHV0aWwucmVtb3ZlQ2xhc3NOYW1lKHRoaXMuZG9tLmZvcmVncm91bmQsIHRoaXMuY2xhc3NOYW1lKTsKICAgICAgICB1dGlsLnJlbW92ZUNsYXNzTmFtZSh0aGlzLmRvbS5iYWNrZ3JvdW5kLCB0aGlzLmNsYXNzTmFtZSk7CiAgICAgICAgdXRpbC5yZW1vdmVDbGFzc05hbWUodGhpcy5kb20uYXhpcywgdGhpcy5jbGFzc05hbWUpOwogICAgICB9CiAgICAgIHV0aWwuYWRkQ2xhc3NOYW1lKHRoaXMuZG9tLmxhYmVsLCBjbGFzc05hbWUpOwogICAgICB1dGlsLmFkZENsYXNzTmFtZSh0aGlzLmRvbS5mb3JlZ3JvdW5kLCBjbGFzc05hbWUpOwogICAgICB1dGlsLmFkZENsYXNzTmFtZSh0aGlzLmRvbS5iYWNrZ3JvdW5kLCBjbGFzc05hbWUpOwogICAgICB1dGlsLmFkZENsYXNzTmFtZSh0aGlzLmRvbS5heGlzLCBjbGFzc05hbWUpOwogICAgICB0aGlzLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsKICAgIH0KCiAgICAvLyB1cGRhdGUgc3R5bGUKICAgIGlmICh0aGlzLnN0eWxlKSB7CiAgICAgIHV0aWwucmVtb3ZlQ3NzVGV4dCh0aGlzLmRvbS5sYWJlbCwgJ3Zpcy0nICsgdGhpcy5zdHlsZSk7CiAgICAgIHRoaXMuc3R5bGUgPSBudWxsOwogICAgfQogICAgaWYgKGRhdGEgJiYgZGF0YS5zdHlsZSkgewogICAgICB1dGlsLmFkZENzc1RleHQodGhpcy5kb20ubGFiZWwsICd2aXMtJyArIGRhdGEuc3R5bGUpOwogICAgICB0aGlzLnN0eWxlID0gZGF0YS5zdHlsZTsKICAgIH0KICB9OwoKICAvKioKICAgKiBHZXQgdGhlIHdpZHRoIG9mIHRoZSBncm91cCBsYWJlbAogICAqIEByZXR1cm4ge251bWJlcn0gd2lkdGgKICAgKi8KICBHcm91cC5wcm90b3R5cGUuZ2V0TGFiZWxXaWR0aCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLnByb3BzLmxhYmVsLndpZHRoOwogIH07CgogIC8qKgogICAqIFJlcGFpbnQgdGhpcyBncm91cAogICAqIEBwYXJhbSB7e3N0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyfX0gcmFuZ2UKICAgKiBAcGFyYW0ge3tpdGVtOiB7aG9yaXpvbnRhbDogbnVtYmVyLCB2ZXJ0aWNhbDogbnVtYmVyfSwgYXhpczogbnVtYmVyfX0gbWFyZ2luCiAgICogQHBhcmFtIHtib29sZWFufSBbcmVzdGFjaz1mYWxzZV0gIEZvcmNlIHJlc3RhY2tpbmcgb2YgYWxsIGl0ZW1zCiAgICogQHJldHVybiB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBncm91cCBpcyByZXNpemVkCiAgICovCiAgR3JvdXAucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uIChyYW5nZSwgbWFyZ2luLCByZXN0YWNrKSB7CiAgICB2YXIgcmVzaXplZCA9IGZhbHNlOwoKICAgIC8vIGZvcmNlIHJlY2FsY3VsYXRpb24gb2YgdGhlIGhlaWdodCBvZiB0aGUgaXRlbXMgd2hlbiB0aGUgbWFya2VyIGhlaWdodCBjaGFuZ2VkCiAgICAvLyAoZHVlIHRvIHRoZSBUaW1lbGluZSBiZWluZyBhdHRhY2hlZCB0byB0aGUgRE9NIG9yIGNoYW5nZWQgZnJvbSBkaXNwbGF5Om5vbmUgdG8gdmlzaWJsZSkKICAgIHZhciBtYXJrZXJIZWlnaHQgPSB0aGlzLmRvbS5tYXJrZXIuY2xpZW50SGVpZ2h0OwogICAgaWYgKG1hcmtlckhlaWdodCAhPSB0aGlzLmxhc3RNYXJrZXJIZWlnaHQpIHsKICAgICAgdGhpcy5sYXN0TWFya2VySGVpZ2h0ID0gbWFya2VySGVpZ2h0OwoKICAgICAgdXRpbC5mb3JFYWNoKHRoaXMuaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgaXRlbS5kaXJ0eSA9IHRydWU7CiAgICAgICAgaWYgKGl0ZW0uZGlzcGxheWVkKSBpdGVtLnJlZHJhdygpOwogICAgICB9KTsKCiAgICAgIHJlc3RhY2sgPSB0cnVlOwogICAgfQoKICAgIC8vIHJlcG9zaXRpb24gdmlzaWJsZSBpdGVtcyB2ZXJ0aWNhbGx5CiAgICBpZiAodHlwZW9mIHRoaXMuaXRlbVNldC5vcHRpb25zLm9yZGVyID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIC8vIGEgY3VzdG9tIG9yZGVyIGZ1bmN0aW9uCgogICAgICBpZiAocmVzdGFjaykgewogICAgICAgIC8vIGJydXRlIGZvcmNlIHJlc3RhY2sgb2YgYWxsIGl0ZW1zCgogICAgICAgIC8vIHNob3cgYWxsIGl0ZW1zCiAgICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgICB2YXIgbGltaXRTaXplID0gZmFsc2U7CiAgICAgICAgdXRpbC5mb3JFYWNoKHRoaXMuaXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBpZiAoIWl0ZW0uZGlzcGxheWVkKSB7CiAgICAgICAgICAgIGl0ZW0ucmVkcmF3KCk7CiAgICAgICAgICAgIG1lLnZpc2libGVJdGVtcy5wdXNoKGl0ZW0pOwogICAgICAgICAgfQogICAgICAgICAgaXRlbS5yZXBvc2l0aW9uWChsaW1pdFNpemUpOwogICAgICAgIH0pOwoKICAgICAgICAvLyBvcmRlciBhbGwgaXRlbXMgYW5kIGZvcmNlIGEgcmVzdGFja2luZwogICAgICAgIHZhciBjdXN0b21PcmRlcmVkSXRlbXMgPSB0aGlzLm9yZGVyZWRJdGVtcy5ieVN0YXJ0LnNsaWNlKCkuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgcmV0dXJuIG1lLml0ZW1TZXQub3B0aW9ucy5vcmRlcihhLmRhdGEsIGIuZGF0YSk7CiAgICAgICAgfSk7CiAgICAgICAgc3RhY2suc3RhY2soY3VzdG9tT3JkZXJlZEl0ZW1zLCBtYXJnaW4sIHRydWUgLyogcmVzdGFjaz10cnVlICovKTsKICAgICAgfQoKICAgICAgdGhpcy52aXNpYmxlSXRlbXMgPSB0aGlzLl91cGRhdGVWaXNpYmxlSXRlbXModGhpcy5vcmRlcmVkSXRlbXMsIHRoaXMudmlzaWJsZUl0ZW1zLCByYW5nZSk7CiAgICB9IGVsc2UgewogICAgICAvLyBubyBjdXN0b20gb3JkZXIgZnVuY3Rpb24sIGxhenkgc3RhY2tpbmcKICAgICAgdGhpcy52aXNpYmxlSXRlbXMgPSB0aGlzLl91cGRhdGVWaXNpYmxlSXRlbXModGhpcy5vcmRlcmVkSXRlbXMsIHRoaXMudmlzaWJsZUl0ZW1zLCByYW5nZSk7CgogICAgICBpZiAodGhpcy5pdGVtU2V0Lm9wdGlvbnMuc3RhY2spIHsKICAgICAgICAvLyBUT0RPOiB1Z2x5IHdheSB0byBhY2Nlc3Mgb3B0aW9ucy4uLgogICAgICAgIHN0YWNrLnN0YWNrKHRoaXMudmlzaWJsZUl0ZW1zLCBtYXJnaW4sIHJlc3RhY2spOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIG5vIHN0YWNraW5nCiAgICAgICAgc3RhY2subm9zdGFjayh0aGlzLnZpc2libGVJdGVtcywgbWFyZ2luLCB0aGlzLnN1Ymdyb3Vwcyk7CiAgICAgIH0KICAgIH0KCiAgICAvLyByZWNhbGN1bGF0ZSB0aGUgaGVpZ2h0IG9mIHRoZSBncm91cAogICAgdmFyIGhlaWdodCA9IHRoaXMuX2NhbGN1bGF0ZUhlaWdodChtYXJnaW4pOwoKICAgIC8vIGNhbGN1bGF0ZSBhY3R1YWwgc2l6ZSBhbmQgcG9zaXRpb24KICAgIHZhciBmb3JlZ3JvdW5kID0gdGhpcy5kb20uZm9yZWdyb3VuZDsKICAgIHRoaXMudG9wID0gZm9yZWdyb3VuZC5vZmZzZXRUb3A7CiAgICB0aGlzLmxlZnQgPSBmb3JlZ3JvdW5kLm9mZnNldExlZnQ7CiAgICB0aGlzLndpZHRoID0gZm9yZWdyb3VuZC5vZmZzZXRXaWR0aDsKICAgIHJlc2l6ZWQgPSB1dGlsLnVwZGF0ZVByb3BlcnR5KHRoaXMsICdoZWlnaHQnLCBoZWlnaHQpIHx8IHJlc2l6ZWQ7CgogICAgLy8gcmVjYWxjdWxhdGUgc2l6ZSBvZiBsYWJlbAogICAgcmVzaXplZCA9IHV0aWwudXBkYXRlUHJvcGVydHkodGhpcy5wcm9wcy5sYWJlbCwgJ3dpZHRoJywgdGhpcy5kb20uaW5uZXIuY2xpZW50V2lkdGgpIHx8IHJlc2l6ZWQ7CiAgICByZXNpemVkID0gdXRpbC51cGRhdGVQcm9wZXJ0eSh0aGlzLnByb3BzLmxhYmVsLCAnaGVpZ2h0JywgdGhpcy5kb20uaW5uZXIuY2xpZW50SGVpZ2h0KSB8fCByZXNpemVkOwoKICAgIC8vIGFwcGx5IG5ldyBoZWlnaHQKICAgIHRoaXMuZG9tLmJhY2tncm91bmQuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgJ3B4JzsKICAgIHRoaXMuZG9tLmZvcmVncm91bmQuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgJ3B4JzsKICAgIHRoaXMuZG9tLmxhYmVsLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7CgogICAgLy8gdXBkYXRlIHZlcnRpY2FsIHBvc2l0aW9uIG9mIGl0ZW1zIGFmdGVyIHRoZXkgYXJlIHJlLXN0YWNrZWQgYW5kIHRoZSBoZWlnaHQgb2YgdGhlIGdyb3VwIGlzIGNhbGN1bGF0ZWQKICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHRoaXMudmlzaWJsZUl0ZW1zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgdmFyIGl0ZW0gPSB0aGlzLnZpc2libGVJdGVtc1tpXTsKICAgICAgaXRlbS5yZXBvc2l0aW9uWShtYXJnaW4pOwogICAgfQoKICAgIHJldHVybiByZXNpemVkOwogIH07CgogIC8qKgogICAqIHJlY2FsY3VsYXRlIHRoZSBoZWlnaHQgb2YgdGhlIGdyb3VwCiAgICogQHBhcmFtIHt7aXRlbToge2hvcml6b250YWw6IG51bWJlciwgdmVydGljYWw6IG51bWJlcn0sIGF4aXM6IG51bWJlcn19IG1hcmdpbgogICAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGhlaWdodAogICAqIEBwcml2YXRlCiAgICovCiAgR3JvdXAucHJvdG90eXBlLl9jYWxjdWxhdGVIZWlnaHQgPSBmdW5jdGlvbiAobWFyZ2luKSB7CiAgICAvLyByZWNhbGN1bGF0ZSB0aGUgaGVpZ2h0IG9mIHRoZSBncm91cAogICAgdmFyIGhlaWdodDsKICAgIHZhciB2aXNpYmxlSXRlbXMgPSB0aGlzLnZpc2libGVJdGVtczsKICAgIC8vdmFyIHZpc2libGVTdWJncm91cHMgPSBbXTsKICAgIC8vdGhpcy52aXNpYmxlU3ViZ3JvdXBzID0gMDsKICAgIHRoaXMucmVzZXRTdWJncm91cHMoKTsKICAgIHZhciBtZSA9IHRoaXM7CiAgICBpZiAodmlzaWJsZUl0ZW1zLmxlbmd0aCA+IDApIHsKICAgICAgdmFyIG1pbiA9IHZpc2libGVJdGVtc1swXS50b3A7CiAgICAgIHZhciBtYXggPSB2aXNpYmxlSXRlbXNbMF0udG9wICsgdmlzaWJsZUl0ZW1zWzBdLmhlaWdodDsKICAgICAgdXRpbC5mb3JFYWNoKHZpc2libGVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBtaW4gPSBNYXRoLm1pbihtaW4sIGl0ZW0udG9wKTsKICAgICAgICBtYXggPSBNYXRoLm1heChtYXgsIGl0ZW0udG9wICsgaXRlbS5oZWlnaHQpOwogICAgICAgIGlmIChpdGVtLmRhdGEuc3ViZ3JvdXAgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgbWUuc3ViZ3JvdXBzW2l0ZW0uZGF0YS5zdWJncm91cF0uaGVpZ2h0ID0gTWF0aC5tYXgobWUuc3ViZ3JvdXBzW2l0ZW0uZGF0YS5zdWJncm91cF0uaGVpZ2h0LCBpdGVtLmhlaWdodCk7CiAgICAgICAgICBtZS5zdWJncm91cHNbaXRlbS5kYXRhLnN1Ymdyb3VwXS52aXNpYmxlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBpZiAobWluID4gbWFyZ2luLmF4aXMpIHsKICAgICAgICAvLyB0aGVyZSBpcyBhbiBlbXB0eSBnYXAgYmV0d2VlbiB0aGUgbG93ZXN0IGl0ZW0gYW5kIHRoZSBheGlzCiAgICAgICAgdmFyIG9mZnNldCA9IG1pbiAtIG1hcmdpbi5heGlzOwogICAgICAgIG1heCAtPSBvZmZzZXQ7CiAgICAgICAgdXRpbC5mb3JFYWNoKHZpc2libGVJdGVtcywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGl0ZW0udG9wIC09IG9mZnNldDsKICAgICAgICB9KTsKICAgICAgfQogICAgICBoZWlnaHQgPSBtYXggKyBtYXJnaW4uaXRlbS52ZXJ0aWNhbCAvIDI7CiAgICB9IGVsc2UgewogICAgICBoZWlnaHQgPSAwOwogICAgfQogICAgaGVpZ2h0ID0gTWF0aC5tYXgoaGVpZ2h0LCB0aGlzLnByb3BzLmxhYmVsLmhlaWdodCk7CgogICAgcmV0dXJuIGhlaWdodDsKICB9OwoKICAvKioKICAgKiBTaG93IHRoaXMgZ3JvdXA6IGF0dGFjaCB0byB0aGUgRE9NCiAgICovCiAgR3JvdXAucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXRoaXMuZG9tLmxhYmVsLnBhcmVudE5vZGUpIHsKICAgICAgdGhpcy5pdGVtU2V0LmRvbS5sYWJlbFNldC5hcHBlbmRDaGlsZCh0aGlzLmRvbS5sYWJlbCk7CiAgICB9CgogICAgaWYgKCF0aGlzLmRvbS5mb3JlZ3JvdW5kLnBhcmVudE5vZGUpIHsKICAgICAgdGhpcy5pdGVtU2V0LmRvbS5mb3JlZ3JvdW5kLmFwcGVuZENoaWxkKHRoaXMuZG9tLmZvcmVncm91bmQpOwogICAgfQoKICAgIGlmICghdGhpcy5kb20uYmFja2dyb3VuZC5wYXJlbnROb2RlKSB7CiAgICAgIHRoaXMuaXRlbVNldC5kb20uYmFja2dyb3VuZC5hcHBlbmRDaGlsZCh0aGlzLmRvbS5iYWNrZ3JvdW5kKTsKICAgIH0KCiAgICBpZiAoIXRoaXMuZG9tLmF4aXMucGFyZW50Tm9kZSkgewogICAgICB0aGlzLml0ZW1TZXQuZG9tLmF4aXMuYXBwZW5kQ2hpbGQodGhpcy5kb20uYXhpcyk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogSGlkZSB0aGlzIGdyb3VwOiByZW1vdmUgZnJvbSB0aGUgRE9NCiAgICovCiAgR3JvdXAucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgbGFiZWwgPSB0aGlzLmRvbS5sYWJlbDsKICAgIGlmIChsYWJlbC5wYXJlbnROb2RlKSB7CiAgICAgIGxhYmVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobGFiZWwpOwogICAgfQoKICAgIHZhciBmb3JlZ3JvdW5kID0gdGhpcy5kb20uZm9yZWdyb3VuZDsKICAgIGlmIChmb3JlZ3JvdW5kLnBhcmVudE5vZGUpIHsKICAgICAgZm9yZWdyb3VuZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGZvcmVncm91bmQpOwogICAgfQoKICAgIHZhciBiYWNrZ3JvdW5kID0gdGhpcy5kb20uYmFja2dyb3VuZDsKICAgIGlmIChiYWNrZ3JvdW5kLnBhcmVudE5vZGUpIHsKICAgICAgYmFja2dyb3VuZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGJhY2tncm91bmQpOwogICAgfQoKICAgIHZhciBheGlzID0gdGhpcy5kb20uYXhpczsKICAgIGlmIChheGlzLnBhcmVudE5vZGUpIHsKICAgICAgYXhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGF4aXMpOwogICAgfQogIH07CgogIC8qKgogICAqIEFkZCBhbiBpdGVtIHRvIHRoZSBncm91cAogICAqIEBwYXJhbSB7SXRlbX0gaXRlbQogICAqLwogIEdyb3VwLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAoaXRlbSkgewogICAgdGhpcy5pdGVtc1tpdGVtLmlkXSA9IGl0ZW07CiAgICBpdGVtLnNldFBhcmVudCh0aGlzKTsKCiAgICAvLyBhZGQgdG8KICAgIGlmIChpdGVtLmRhdGEuc3ViZ3JvdXAgIT09IHVuZGVmaW5lZCkgewogICAgICBpZiAodGhpcy5zdWJncm91cHNbaXRlbS5kYXRhLnN1Ymdyb3VwXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5zdWJncm91cHNbaXRlbS5kYXRhLnN1Ymdyb3VwXSA9IHsgaGVpZ2h0OiAwLCB2aXNpYmxlOiBmYWxzZSwgaW5kZXg6IHRoaXMuc3ViZ3JvdXBJbmRleCwgaXRlbXM6IFtdIH07CiAgICAgICAgdGhpcy5zdWJncm91cEluZGV4Kys7CiAgICAgIH0KICAgICAgdGhpcy5zdWJncm91cHNbaXRlbS5kYXRhLnN1Ymdyb3VwXS5pdGVtcy5wdXNoKGl0ZW0pOwogICAgfQogICAgdGhpcy5vcmRlclN1Ymdyb3VwcygpOwoKICAgIGlmICh0aGlzLnZpc2libGVJdGVtcy5pbmRleE9mKGl0ZW0pID09IC0xKSB7CiAgICAgIHZhciByYW5nZSA9IHRoaXMuaXRlbVNldC5ib2R5LnJhbmdlOyAvLyBUT0RPOiBub3QgbmljZSBhY2Nlc3NpbmcgdGhlIHJhbmdlIGxpa2UgdGhpcwogICAgICB0aGlzLl9jaGVja0lmVmlzaWJsZShpdGVtLCB0aGlzLnZpc2libGVJdGVtcywgcmFuZ2UpOwogICAgfQogIH07CgogIEdyb3VwLnByb3RvdHlwZS5vcmRlclN1Ymdyb3VwcyA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLnN1Ymdyb3VwT3JkZXJlciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhciBzb3J0QXJyYXkgPSBbXTsKICAgICAgaWYgKHR5cGVvZiB0aGlzLnN1Ymdyb3VwT3JkZXJlciA9PSAnc3RyaW5nJykgewogICAgICAgIGZvciAodmFyIHN1Ymdyb3VwIGluIHRoaXMuc3ViZ3JvdXBzKSB7CiAgICAgICAgICBzb3J0QXJyYXkucHVzaCh7IHN1Ymdyb3VwOiBzdWJncm91cCwgc29ydEZpZWxkOiB0aGlzLnN1Ymdyb3Vwc1tzdWJncm91cF0uaXRlbXNbMF0uZGF0YVt0aGlzLnN1Ymdyb3VwT3JkZXJlcl0gfSk7CiAgICAgICAgfQogICAgICAgIHNvcnRBcnJheS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS5zb3J0RmllbGQgLSBiLnNvcnRGaWVsZDsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy5zdWJncm91cE9yZGVyZXIgPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGZvciAodmFyIHN1Ymdyb3VwIGluIHRoaXMuc3ViZ3JvdXBzKSB7CiAgICAgICAgICBzb3J0QXJyYXkucHVzaCh0aGlzLnN1Ymdyb3Vwc1tzdWJncm91cF0uaXRlbXNbMF0uZGF0YSk7CiAgICAgICAgfQogICAgICAgIHNvcnRBcnJheS5zb3J0KHRoaXMuc3ViZ3JvdXBPcmRlcmVyKTsKICAgICAgfQoKICAgICAgaWYgKHNvcnRBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3J0QXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHRoaXMuc3ViZ3JvdXBzW3NvcnRBcnJheVtpXS5zdWJncm91cF0uaW5kZXggPSBpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIEdyb3VwLnByb3RvdHlwZS5yZXNldFN1Ymdyb3VwcyA9IGZ1bmN0aW9uICgpIHsKICAgIGZvciAodmFyIHN1Ymdyb3VwIGluIHRoaXMuc3ViZ3JvdXBzKSB7CiAgICAgIGlmICh0aGlzLnN1Ymdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShzdWJncm91cCkpIHsKICAgICAgICB0aGlzLnN1Ymdyb3Vwc1tzdWJncm91cF0udmlzaWJsZSA9IGZhbHNlOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmVtb3ZlIGFuIGl0ZW0gZnJvbSB0aGUgZ3JvdXAKICAgKiBAcGFyYW0ge0l0ZW19IGl0ZW0KICAgKi8KICBHcm91cC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKGl0ZW0pIHsKICAgIGRlbGV0ZSB0aGlzLml0ZW1zW2l0ZW0uaWRdOwogICAgaXRlbS5zZXRQYXJlbnQobnVsbCk7CgogICAgLy8gcmVtb3ZlIGZyb20gdmlzaWJsZSBpdGVtcwogICAgdmFyIGluZGV4ID0gdGhpcy52aXNpYmxlSXRlbXMuaW5kZXhPZihpdGVtKTsKICAgIGlmIChpbmRleCAhPSAtMSkgdGhpcy52aXNpYmxlSXRlbXMuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAvLyBUT0RPOiBhbHNvIHJlbW92ZSBmcm9tIG9yZGVyZWQgaXRlbXM/CiAgfTsKCiAgLyoqCiAgICogUmVtb3ZlIGFuIGl0ZW0gZnJvbSB0aGUgY29ycmVzcG9uZGluZyBEYXRhU2V0CiAgICogQHBhcmFtIHtJdGVtfSBpdGVtCiAgICovCiAgR3JvdXAucHJvdG90eXBlLnJlbW92ZUZyb21EYXRhU2V0ID0gZnVuY3Rpb24gKGl0ZW0pIHsKICAgIHRoaXMuaXRlbVNldC5yZW1vdmVJdGVtKGl0ZW0uaWQpOwogIH07CgogIC8qKgogICAqIFJlb3JkZXIgdGhlIGl0ZW1zCiAgICovCiAgR3JvdXAucHJvdG90eXBlLm9yZGVyID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGFycmF5ID0gdXRpbC50b0FycmF5KHRoaXMuaXRlbXMpOwogICAgdmFyIHN0YXJ0QXJyYXkgPSBbXTsKICAgIHZhciBlbmRBcnJheSA9IFtdOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGFycmF5W2ldLmRhdGEuZW5kICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBlbmRBcnJheS5wdXNoKGFycmF5W2ldKTsKICAgICAgfQogICAgICBzdGFydEFycmF5LnB1c2goYXJyYXlbaV0pOwogICAgfQogICAgdGhpcy5vcmRlcmVkSXRlbXMgPSB7CiAgICAgIGJ5U3RhcnQ6IHN0YXJ0QXJyYXksCiAgICAgIGJ5RW5kOiBlbmRBcnJheQogICAgfTsKCiAgICBzdGFjay5vcmRlckJ5U3RhcnQodGhpcy5vcmRlcmVkSXRlbXMuYnlTdGFydCk7CiAgICBzdGFjay5vcmRlckJ5RW5kKHRoaXMub3JkZXJlZEl0ZW1zLmJ5RW5kKTsKICB9OwoKICAvKioKICAgKiBVcGRhdGUgdGhlIHZpc2libGUgaXRlbXMKICAgKiBAcGFyYW0ge3tieVN0YXJ0OiBJdGVtW10sIGJ5RW5kOiBJdGVtW119fSBvcmRlcmVkSXRlbXMgICBBbGwgaXRlbXMgb3JkZXJlZCBieSBzdGFydCBkYXRlIGFuZCBieSBlbmQgZGF0ZQogICAqIEBwYXJhbSB7SXRlbVtdfSB2aXNpYmxlSXRlbXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBwcmV2aW91c2x5IHZpc2libGUgaXRlbXMuCiAgICogQHBhcmFtIHt7c3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXJ9fSByYW5nZSAgICAgICAgICAgICAgVmlzaWJsZSByYW5nZQogICAqIEByZXR1cm4ge0l0ZW1bXX0gdmlzaWJsZUl0ZW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBuZXcgdmlzaWJsZSBpdGVtcy4KICAgKiBAcHJpdmF0ZQogICAqLwogIEdyb3VwLnByb3RvdHlwZS5fdXBkYXRlVmlzaWJsZUl0ZW1zID0gZnVuY3Rpb24gKG9yZGVyZWRJdGVtcywgb2xkVmlzaWJsZUl0ZW1zLCByYW5nZSkgewogICAgdmFyIHZpc2libGVJdGVtcyA9IFtdOwogICAgdmFyIHZpc2libGVJdGVtc0xvb2t1cCA9IHt9OyAvLyB3ZSBrZWVwIHRoaXMgdG8gcXVpY2tseSBsb29rIHVwIGlmIGFuIGl0ZW0gYWxyZWFkeSBleGlzdHMgaW4gdGhlIGxpc3Qgd2l0aG91dCB1c2luZyBpbmRleE9mIG9uIHZpc2libGVJdGVtcwogICAgdmFyIGludGVydmFsID0gKHJhbmdlLmVuZCAtIHJhbmdlLnN0YXJ0KSAvIDQ7CiAgICB2YXIgbG93ZXJCb3VuZCA9IHJhbmdlLnN0YXJ0IC0gaW50ZXJ2YWw7CiAgICB2YXIgdXBwZXJCb3VuZCA9IHJhbmdlLmVuZCArIGludGVydmFsOwogICAgdmFyIGl0ZW0sIGk7CgogICAgLy8gdGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGRvIHRoZSBiaW5hcnkgc2VhcmNoLgogICAgdmFyIHNlYXJjaEZ1bmN0aW9uID0gZnVuY3Rpb24gc2VhcmNoRnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKHZhbHVlIDwgbG93ZXJCb3VuZCkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA8PSB1cHBlckJvdW5kKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICAgIH0KICAgIH07CgogICAgLy8gZmlyc3QgY2hlY2sgaWYgdGhlIGl0ZW1zIHRoYXQgd2VyZSBpbiB2aWV3IHByZXZpb3VzbHkgYXJlIHN0aWxsIGluIHZpZXcuCiAgICAvLyBJTVBPUlRBTlQ6IHRoaXMgaGFuZGxlcyB0aGUgY2FzZSBmb3IgdGhlIGl0ZW1zIHdpdGggc3RhcnRkYXRlIGJlZm9yZSB0aGUgd2luZG93IGFuZCBlbmRkYXRlIGFmdGVyIHRoZSB3aW5kb3chCiAgICAvLyBhbHNvIGNsZWFucyB1cCBpbnZpc2libGUgaXRlbXMuCiAgICBpZiAob2xkVmlzaWJsZUl0ZW1zLmxlbmd0aCA+IDApIHsKICAgICAgZm9yIChpID0gMDsgaSA8IG9sZFZpc2libGVJdGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuX2NoZWNrSWZWaXNpYmxlV2l0aFJlZmVyZW5jZShvbGRWaXNpYmxlSXRlbXNbaV0sIHZpc2libGVJdGVtcywgdmlzaWJsZUl0ZW1zTG9va3VwLCByYW5nZSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyB3ZSBkbyBhIGJpbmFyeSBzZWFyY2ggZm9yIHRoZSBpdGVtcyB0aGF0IGhhdmUgb25seSBzdGFydCB2YWx1ZXMuCiAgICB2YXIgaW5pdGlhbFBvc0J5U3RhcnQgPSB1dGlsLmJpbmFyeVNlYXJjaEN1c3RvbShvcmRlcmVkSXRlbXMuYnlTdGFydCwgc2VhcmNoRnVuY3Rpb24sICdkYXRhJywgJ3N0YXJ0Jyk7CgogICAgLy8gdHJhY2UgdGhlIHZpc2libGUgaXRlbXMgZnJvbSB0aGUgaW5pdGFsIHN0YXJ0IHBvcyBib3RoIHdheXMgdW50aWwgYW4gaW52aXNpYmxlIGl0ZW0gaXMgZm91bmQsIHdlIG9ubHkgbG9vayBhdCB0aGUgc3RhcnQgdmFsdWVzLgogICAgdGhpcy5fdHJhY2VWaXNpYmxlKGluaXRpYWxQb3NCeVN0YXJ0LCBvcmRlcmVkSXRlbXMuYnlTdGFydCwgdmlzaWJsZUl0ZW1zLCB2aXNpYmxlSXRlbXNMb29rdXAsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIHJldHVybiBpdGVtLmRhdGEuc3RhcnQgPCBsb3dlckJvdW5kIHx8IGl0ZW0uZGF0YS5zdGFydCA+IHVwcGVyQm91bmQ7CiAgICB9KTsKCiAgICAvLyBpZiB0aGUgd2luZG93IGhhcyBjaGFuZ2VkIHByb2dyYW1tYXRpY2FsbHkgd2l0aG91dCBvdmVybGFwcGluZyB0aGUgb2xkIHdpbmRvdywgdGhlIHJhbmdlZCBpdGVtcyB3aXRoIHN0YXJ0IDwgbG93ZXJCb3VuZCBhbmQgZW5kID4gdXBwZXJib3VuZCBhcmUgbm90IHNob3duLgogICAgLy8gV2UgdGhlcmVmb3JlIGhhdmUgdG8gYnJ1dGUgZm9yY2UgY2hlY2sgYWxsIGl0ZW1zIGluIHRoZSBieUVuZCBsaXN0CiAgICBpZiAodGhpcy5jaGVja1JhbmdlZEl0ZW1zID09IHRydWUpIHsKICAgICAgdGhpcy5jaGVja1JhbmdlZEl0ZW1zID0gZmFsc2U7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBvcmRlcmVkSXRlbXMuYnlFbmQubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLl9jaGVja0lmVmlzaWJsZVdpdGhSZWZlcmVuY2Uob3JkZXJlZEl0ZW1zLmJ5RW5kW2ldLCB2aXNpYmxlSXRlbXMsIHZpc2libGVJdGVtc0xvb2t1cCwgcmFuZ2UpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyB3ZSBkbyBhIGJpbmFyeSBzZWFyY2ggZm9yIHRoZSBpdGVtcyB0aGF0IGhhdmUgZGVmaW5lZCBlbmQgdGltZXMuCiAgICAgIHZhciBpbml0aWFsUG9zQnlFbmQgPSB1dGlsLmJpbmFyeVNlYXJjaEN1c3RvbShvcmRlcmVkSXRlbXMuYnlFbmQsIHNlYXJjaEZ1bmN0aW9uLCAnZGF0YScsICdlbmQnKTsKCiAgICAgIC8vIHRyYWNlIHRoZSB2aXNpYmxlIGl0ZW1zIGZyb20gdGhlIGluaXRhbCBzdGFydCBwb3MgYm90aCB3YXlzIHVudGlsIGFuIGludmlzaWJsZSBpdGVtIGlzIGZvdW5kLCB3ZSBvbmx5IGxvb2sgYXQgdGhlIGVuZCB2YWx1ZXMuCiAgICAgIHRoaXMuX3RyYWNlVmlzaWJsZShpbml0aWFsUG9zQnlFbmQsIG9yZGVyZWRJdGVtcy5ieUVuZCwgdmlzaWJsZUl0ZW1zLCB2aXNpYmxlSXRlbXNMb29rdXAsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0uZGF0YS5lbmQgPCBsb3dlckJvdW5kIHx8IGl0ZW0uZGF0YS5lbmQgPiB1cHBlckJvdW5kOwogICAgICB9KTsKICAgIH0KCiAgICAvLyBmaW5hbGx5LCB3ZSByZXBvc2l0aW9uIGFsbCB0aGUgdmlzaWJsZSBpdGVtcy4KICAgIGZvciAoaSA9IDA7IGkgPCB2aXNpYmxlSXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgaXRlbSA9IHZpc2libGVJdGVtc1tpXTsKICAgICAgaWYgKCFpdGVtLmRpc3BsYXllZCkgaXRlbS5zaG93KCk7CiAgICAgIC8vIHJlcG9zaXRpb24gaXRlbSBob3Jpem9udGFsbHkKICAgICAgaXRlbS5yZXBvc2l0aW9uWCgpOwogICAgfQoKICAgIC8vIGRlYnVnCiAgICAvL2NvbnNvbGUubG9nKCJuZXcgbGluZSIpCiAgICAvL2lmICh0aGlzLmdyb3VwSWQgPT0gbnVsbCkgewogICAgLy8gIGZvciAoaSA9IDA7IGkgPCBvcmRlcmVkSXRlbXMuYnlTdGFydC5sZW5ndGg7IGkrKykgewogICAgLy8gICAgaXRlbSA9IG9yZGVyZWRJdGVtcy5ieVN0YXJ0W2ldLmRhdGE7CiAgICAvLyAgICBjb25zb2xlLmxvZygnc3RhcnQnLGksaW5pdGlhbFBvc0J5U3RhcnQsIGl0ZW0uc3RhcnQudmFsdWVPZigpLCBpdGVtLmNvbnRlbnQsIGl0ZW0uc3RhcnQgPj0gbG93ZXJCb3VuZCAmJiBpdGVtLnN0YXJ0IDw9IHVwcGVyQm91bmQsaSA9PSBpbml0aWFsUG9zQnlTdGFydCA/ICI8LS0tLS0tLS0tLS0tLS0tLS0tLSBIRVJFRUVFIiA6ICIiKQogICAgLy8gIH0KICAgIC8vICBmb3IgKGkgPSAwOyBpIDwgb3JkZXJlZEl0ZW1zLmJ5RW5kLmxlbmd0aDsgaSsrKSB7CiAgICAvLyAgICBpdGVtID0gb3JkZXJlZEl0ZW1zLmJ5RW5kW2ldLmRhdGE7CiAgICAvLyAgICBjb25zb2xlLmxvZygncmFuZ2VFbmQnLGksaW5pdGlhbFBvc0J5RW5kLCBpdGVtLmVuZC52YWx1ZU9mKCksIGl0ZW0uY29udGVudCwgaXRlbS5lbmQgPj0gcmFuZ2Uuc3RhcnQgJiYgaXRlbS5lbmQgPD0gcmFuZ2UuZW5kLGkgPT0gaW5pdGlhbFBvc0J5RW5kID8gIjwtLS0tLS0tLS0tLS0tLS0tLS0tIEhFUkVFRUUiIDogIiIpCiAgICAvLyAgfQogICAgLy99CgogICAgcmV0dXJuIHZpc2libGVJdGVtczsKICB9OwoKICBHcm91cC5wcm90b3R5cGUuX3RyYWNlVmlzaWJsZSA9IGZ1bmN0aW9uIChpbml0aWFsUG9zLCBpdGVtcywgdmlzaWJsZUl0ZW1zLCB2aXNpYmxlSXRlbXNMb29rdXAsIGJyZWFrQ29uZGl0aW9uKSB7CiAgICB2YXIgaXRlbTsKICAgIHZhciBpOwoKICAgIGlmIChpbml0aWFsUG9zICE9IC0xKSB7CiAgICAgIGZvciAoaSA9IGluaXRpYWxQb3M7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgaXRlbSA9IGl0ZW1zW2ldOwogICAgICAgIGlmIChicmVha0NvbmRpdGlvbihpdGVtKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh2aXNpYmxlSXRlbXNMb29rdXBbaXRlbS5pZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB2aXNpYmxlSXRlbXNMb29rdXBbaXRlbS5pZF0gPSB0cnVlOwogICAgICAgICAgICB2aXNpYmxlSXRlbXMucHVzaChpdGVtKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAoaSA9IGluaXRpYWxQb3MgKyAxOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpdGVtID0gaXRlbXNbaV07CiAgICAgICAgaWYgKGJyZWFrQ29uZGl0aW9uKGl0ZW0pKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHZpc2libGVJdGVtc0xvb2t1cFtpdGVtLmlkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZpc2libGVJdGVtc0xvb2t1cFtpdGVtLmlkXSA9IHRydWU7CiAgICAgICAgICAgIHZpc2libGVJdGVtcy5wdXNoKGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIHRoaXMgZnVuY3Rpb24gaXMgdmVyeSBzaW1pbGFyIHRvIHRoZSBfY2hlY2tJZkludmlzaWJsZSgpIGJ1dCBpdCBkb2VzIG5vdAogICAqIHJldHVybiBib29sZWFucywgaGlkZXMgdGhlIGl0ZW0gaWYgaXQgc2hvdWxkIG5vdCBiZSBzZWVuIGFuZCBhbHdheXMgYWRkcyB0bwogICAqIHRoZSB2aXNpYmxlSXRlbXMuCiAgICogdGhpcyBvbmUgaXMgZm9yIGJydXRlIGZvcmNpbmcgYW5kIGhpZGluZy4KICAgKgogICAqIEBwYXJhbSB7SXRlbX0gaXRlbQogICAqIEBwYXJhbSB7QXJyYXl9IHZpc2libGVJdGVtcwogICAqIEBwYXJhbSB7e3N0YXJ0Om51bWJlciwgZW5kOm51bWJlcn19IHJhbmdlCiAgICogQHByaXZhdGUKICAgKi8KICBHcm91cC5wcm90b3R5cGUuX2NoZWNrSWZWaXNpYmxlID0gZnVuY3Rpb24gKGl0ZW0sIHZpc2libGVJdGVtcywgcmFuZ2UpIHsKICAgIGlmIChpdGVtLmlzVmlzaWJsZShyYW5nZSkpIHsKICAgICAgaWYgKCFpdGVtLmRpc3BsYXllZCkgaXRlbS5zaG93KCk7CiAgICAgIC8vIHJlcG9zaXRpb24gaXRlbSBob3Jpem9udGFsbHkKICAgICAgaXRlbS5yZXBvc2l0aW9uWCgpOwogICAgICB2aXNpYmxlSXRlbXMucHVzaChpdGVtKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChpdGVtLmRpc3BsYXllZCkgaXRlbS5oaWRlKCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogdGhpcyBmdW5jdGlvbiBpcyB2ZXJ5IHNpbWlsYXIgdG8gdGhlIF9jaGVja0lmSW52aXNpYmxlKCkgYnV0IGl0IGRvZXMgbm90CiAgICogcmV0dXJuIGJvb2xlYW5zLCBoaWRlcyB0aGUgaXRlbSBpZiBpdCBzaG91bGQgbm90IGJlIHNlZW4gYW5kIGFsd2F5cyBhZGRzIHRvCiAgICogdGhlIHZpc2libGVJdGVtcy4KICAgKiB0aGlzIG9uZSBpcyBmb3IgYnJ1dGUgZm9yY2luZyBhbmQgaGlkaW5nLgogICAqCiAgICogQHBhcmFtIHtJdGVtfSBpdGVtCiAgICogQHBhcmFtIHtBcnJheX0gdmlzaWJsZUl0ZW1zCiAgICogQHBhcmFtIHt7c3RhcnQ6bnVtYmVyLCBlbmQ6bnVtYmVyfX0gcmFuZ2UKICAgKiBAcHJpdmF0ZQogICAqLwogIEdyb3VwLnByb3RvdHlwZS5fY2hlY2tJZlZpc2libGVXaXRoUmVmZXJlbmNlID0gZnVuY3Rpb24gKGl0ZW0sIHZpc2libGVJdGVtcywgdmlzaWJsZUl0ZW1zTG9va3VwLCByYW5nZSkgewogICAgaWYgKGl0ZW0uaXNWaXNpYmxlKHJhbmdlKSkgewogICAgICBpZiAodmlzaWJsZUl0ZW1zTG9va3VwW2l0ZW0uaWRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICB2aXNpYmxlSXRlbXNMb29rdXBbaXRlbS5pZF0gPSB0cnVlOwogICAgICAgIHZpc2libGVJdGVtcy5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAoaXRlbS5kaXNwbGF5ZWQpIGl0ZW0uaGlkZSgpOwogICAgfQogIH07CgogIG1vZHVsZS5leHBvcnRzID0gR3JvdXA7CgovKioqLyB9LAovKiAzMyAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgLy8gVXRpbGl0eSBmdW5jdGlvbnMgZm9yIG9yZGVyaW5nIGFuZCBzdGFja2luZyBvZiBpdGVtcwogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIEVQU0lMT04gPSAwLjAwMTsgLy8gdXNlZCB3aGVuIGNoZWNraW5nIGNvbGxpc2lvbnMsIHRvIHByZXZlbnQgcm91bmQtb2ZmIGVycm9ycwoKICAvKioKICAgKiBPcmRlciBpdGVtcyBieSB0aGVpciBzdGFydCBkYXRhCiAgICogQHBhcmFtIHtJdGVtW119IGl0ZW1zCiAgICovCiAgZXhwb3J0cy5vcmRlckJ5U3RhcnQgPSBmdW5jdGlvbiAoaXRlbXMpIHsKICAgIGl0ZW1zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgcmV0dXJuIGEuZGF0YS5zdGFydCAtIGIuZGF0YS5zdGFydDsKICAgIH0pOwogIH07CgogIC8qKgogICAqIE9yZGVyIGl0ZW1zIGJ5IHRoZWlyIGVuZCBkYXRlLiBJZiB0aGV5IGhhdmUgbm8gZW5kIGRhdGUsIHRoZWlyIHN0YXJ0IGRhdGUKICAgKiBpcyB1c2VkLgogICAqIEBwYXJhbSB7SXRlbVtdfSBpdGVtcwogICAqLwogIGV4cG9ydHMub3JkZXJCeUVuZCA9IGZ1bmN0aW9uIChpdGVtcykgewogICAgaXRlbXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICB2YXIgYVRpbWUgPSAnZW5kJyBpbiBhLmRhdGEgPyBhLmRhdGEuZW5kIDogYS5kYXRhLnN0YXJ0LAogICAgICAgICAgYlRpbWUgPSAnZW5kJyBpbiBiLmRhdGEgPyBiLmRhdGEuZW5kIDogYi5kYXRhLnN0YXJ0OwoKICAgICAgcmV0dXJuIGFUaW1lIC0gYlRpbWU7CiAgICB9KTsKICB9OwoKICAvKioKICAgKiBBZGp1c3QgdmVydGljYWwgcG9zaXRpb25zIG9mIHRoZSBpdGVtcyBzdWNoIHRoYXQgdGhleSBkb24ndCBvdmVybGFwIGVhY2gKICAgKiBvdGhlci4KICAgKiBAcGFyYW0ge0l0ZW1bXX0gaXRlbXMKICAgKiAgICAgICAgICAgIEFsbCB2aXNpYmxlIGl0ZW1zCiAgICogQHBhcmFtIHt7aXRlbToge2hvcml6b250YWw6IG51bWJlciwgdmVydGljYWw6IG51bWJlcn0sIGF4aXM6IG51bWJlcn19IG1hcmdpbgogICAqICAgICAgICAgICAgTWFyZ2lucyBiZXR3ZWVuIGl0ZW1zIGFuZCBiZXR3ZWVuIGl0ZW1zIGFuZCB0aGUgYXhpcy4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtmb3JjZT1mYWxzZV0KICAgKiAgICAgICAgICAgIElmIHRydWUsIGFsbCBpdGVtcyB3aWxsIGJlIHJlcG9zaXRpb25lZC4gSWYgZmFsc2UgKGRlZmF1bHQpLCBvbmx5CiAgICogICAgICAgICAgICBpdGVtcyBoYXZpbmcgYSB0b3A9PT1udWxsIHdpbGwgYmUgcmUtc3RhY2tlZAogICAqLwogIGV4cG9ydHMuc3RhY2sgPSBmdW5jdGlvbiAoaXRlbXMsIG1hcmdpbiwgZm9yY2UpIHsKICAgIHZhciBpLCBpTWF4OwoKICAgIGlmIChmb3JjZSkgewogICAgICAvLyByZXNldCB0b3AgcG9zaXRpb24gb2YgYWxsIGl0ZW1zCiAgICAgIGZvciAoaSA9IDAsIGlNYXggPSBpdGVtcy5sZW5ndGg7IGkgPCBpTWF4OyBpKyspIHsKICAgICAgICBpdGVtc1tpXS50b3AgPSBudWxsOwogICAgICB9CiAgICB9CgogICAgLy8gY2FsY3VsYXRlIG5ldywgbm9uLW92ZXJsYXBwaW5nIHBvc2l0aW9ucwogICAgZm9yIChpID0gMCwgaU1heCA9IGl0ZW1zLmxlbmd0aDsgaSA8IGlNYXg7IGkrKykgewogICAgICB2YXIgaXRlbSA9IGl0ZW1zW2ldOwogICAgICBpZiAoaXRlbS5zdGFjayAmJiBpdGVtLnRvcCA9PT0gbnVsbCkgewogICAgICAgIC8vIGluaXRpYWxpemUgdG9wIHBvc2l0aW9uCiAgICAgICAgaXRlbS50b3AgPSBtYXJnaW4uYXhpczsKCiAgICAgICAgZG8gewogICAgICAgICAgLy8gVE9ETzogb3B0aW1pemUgY2hlY2tpbmcgZm9yIG92ZXJsYXAuIHdoZW4gdGhlcmUgaXMgYSBnYXAgd2l0aG91dCBpdGVtcywKICAgICAgICAgIC8vICAgICAgIHlvdSBvbmx5IG5lZWQgdG8gY2hlY2sgZm9yIGl0ZW1zIGZyb20gdGhlIG5leHQgaXRlbSBvbiwgbm90IGZyb20gemVybwogICAgICAgICAgdmFyIGNvbGxpZGluZ0l0ZW0gPSBudWxsOwogICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gaXRlbXMubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICB2YXIgb3RoZXIgPSBpdGVtc1tqXTsKICAgICAgICAgICAgaWYgKG90aGVyLnRvcCAhPT0gbnVsbCAmJiBvdGhlciAhPT0gaXRlbSAmJiBvdGhlci5zdGFjayAmJiBleHBvcnRzLmNvbGxpc2lvbihpdGVtLCBvdGhlciwgbWFyZ2luLml0ZW0pKSB7CiAgICAgICAgICAgICAgY29sbGlkaW5nSXRlbSA9IG90aGVyOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNvbGxpZGluZ0l0ZW0gIT0gbnVsbCkgewogICAgICAgICAgICAvLyBUaGVyZSBpcyBhIGNvbGxpc2lvbi4gUmVwb3NpdGlvbiB0aGUgaXRlbXMgYWJvdmUgdGhlIGNvbGxpZGluZyBlbGVtZW50CiAgICAgICAgICAgIGl0ZW0udG9wID0gY29sbGlkaW5nSXRlbS50b3AgKyBjb2xsaWRpbmdJdGVtLmhlaWdodCArIG1hcmdpbi5pdGVtLnZlcnRpY2FsOwogICAgICAgICAgfQogICAgICAgIH0gd2hpbGUgKGNvbGxpZGluZ0l0ZW0pOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQWRqdXN0IHZlcnRpY2FsIHBvc2l0aW9ucyBvZiB0aGUgaXRlbXMgd2l0aG91dCBzdGFja2luZyB0aGVtCiAgICogQHBhcmFtIHtJdGVtW119IGl0ZW1zCiAgICogICAgICAgICAgICBBbGwgdmlzaWJsZSBpdGVtcwogICAqIEBwYXJhbSB7e2l0ZW06IHtob3Jpem9udGFsOiBudW1iZXIsIHZlcnRpY2FsOiBudW1iZXJ9LCBheGlzOiBudW1iZXJ9fSBtYXJnaW4KICAgKiAgICAgICAgICAgIE1hcmdpbnMgYmV0d2VlbiBpdGVtcyBhbmQgYmV0d2VlbiBpdGVtcyBhbmQgdGhlIGF4aXMuCiAgICovCiAgZXhwb3J0cy5ub3N0YWNrID0gZnVuY3Rpb24gKGl0ZW1zLCBtYXJnaW4sIHN1Ymdyb3VwcykgewogICAgdmFyIGksIGlNYXgsIG5ld1RvcDsKCiAgICAvLyByZXNldCB0b3AgcG9zaXRpb24gb2YgYWxsIGl0ZW1zCiAgICBmb3IgKGkgPSAwLCBpTWF4ID0gaXRlbXMubGVuZ3RoOyBpIDwgaU1heDsgaSsrKSB7CiAgICAgIGlmIChpdGVtc1tpXS5kYXRhLnN1Ymdyb3VwICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBuZXdUb3AgPSBtYXJnaW4uYXhpczsKICAgICAgICBmb3IgKHZhciBzdWJncm91cCBpbiBzdWJncm91cHMpIHsKICAgICAgICAgIGlmIChzdWJncm91cHMuaGFzT3duUHJvcGVydHkoc3ViZ3JvdXApKSB7CiAgICAgICAgICAgIGlmIChzdWJncm91cHNbc3ViZ3JvdXBdLnZpc2libGUgPT0gdHJ1ZSAmJiBzdWJncm91cHNbc3ViZ3JvdXBdLmluZGV4IDwgc3ViZ3JvdXBzW2l0ZW1zW2ldLmRhdGEuc3ViZ3JvdXBdLmluZGV4KSB7CiAgICAgICAgICAgICAgbmV3VG9wICs9IHN1Ymdyb3Vwc1tzdWJncm91cF0uaGVpZ2h0ICsgbWFyZ2luLml0ZW0udmVydGljYWw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaXRlbXNbaV0udG9wID0gbmV3VG9wOwogICAgICB9IGVsc2UgewogICAgICAgIGl0ZW1zW2ldLnRvcCA9IG1hcmdpbi5heGlzOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogVGVzdCBpZiB0aGUgdHdvIHByb3ZpZGVkIGl0ZW1zIGNvbGxpZGUKICAgKiBUaGUgaXRlbXMgbXVzdCBoYXZlIHBhcmFtZXRlcnMgbGVmdCwgd2lkdGgsIHRvcCwgYW5kIGhlaWdodC4KICAgKiBAcGFyYW0ge0l0ZW19IGEgICAgICAgICAgVGhlIGZpcnN0IGl0ZW0KICAgKiBAcGFyYW0ge0l0ZW19IGIgICAgICAgICAgVGhlIHNlY29uZCBpdGVtCiAgICogQHBhcmFtIHt7aG9yaXpvbnRhbDogbnVtYmVyLCB2ZXJ0aWNhbDogbnVtYmVyfX0gbWFyZ2luCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgIEFuIG9iamVjdCBjb250YWluaW5nIGEgaG9yaXpvbnRhbCBhbmQgdmVydGljYWwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgbWluaW11bSByZXF1aXJlZCBtYXJnaW4uCiAgICogQHJldHVybiB7Ym9vbGVhbn0gICAgICAgIHRydWUgaWYgYSBhbmQgYiBjb2xsaWRlLCBlbHNlIGZhbHNlCiAgICovCiAgZXhwb3J0cy5jb2xsaXNpb24gPSBmdW5jdGlvbiAoYSwgYiwgbWFyZ2luKSB7CiAgICByZXR1cm4gYS5sZWZ0IC0gbWFyZ2luLmhvcml6b250YWwgKyBFUFNJTE9OIDwgYi5sZWZ0ICsgYi53aWR0aCAmJiBhLmxlZnQgKyBhLndpZHRoICsgbWFyZ2luLmhvcml6b250YWwgLSBFUFNJTE9OID4gYi5sZWZ0ICYmIGEudG9wIC0gbWFyZ2luLnZlcnRpY2FsICsgRVBTSUxPTiA8IGIudG9wICsgYi5oZWlnaHQgJiYgYS50b3AgKyBhLmhlaWdodCArIG1hcmdpbi52ZXJ0aWNhbCAtIEVQU0lMT04gPiBiLnRvcDsKICB9OwoKLyoqKi8gfSwKLyogMzQgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIEhhbW1lciA9IF9fd2VicGFja19yZXF1aXJlX18oMjMpOwogIHZhciBJdGVtID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNSk7CgogIC8qKgogICAqIEBjb25zdHJ1Y3RvciBSYW5nZUl0ZW0KICAgKiBAZXh0ZW5kcyBJdGVtCiAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgICAgICAgICAgICAgT2JqZWN0IGNvbnRhaW5pbmcgcGFyYW1ldGVycyBzdGFydCwgZW5kCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCwgY2xhc3NOYW1lLgogICAqIEBwYXJhbSB7e3RvU2NyZWVuOiBmdW5jdGlvbiwgdG9UaW1lOiBmdW5jdGlvbn19IGNvbnZlcnNpb24KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb252ZXJzaW9uIGZ1bmN0aW9ucyBmcm9tIHRpbWUgdG8gc2NyZWVuIGFuZCB2aWNlIHZlcnNhCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgICAgICAgQ29uZmlndXJhdGlvbiBvcHRpb25zCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogZGVzY3JpYmUgb3B0aW9ucwogICAqLwogIGZ1bmN0aW9uIFJhbmdlSXRlbShkYXRhLCBjb252ZXJzaW9uLCBvcHRpb25zKSB7CiAgICB0aGlzLnByb3BzID0gewogICAgICBjb250ZW50OiB7CiAgICAgICAgd2lkdGg6IDAKICAgICAgfQogICAgfTsKICAgIHRoaXMub3ZlcmZsb3cgPSBmYWxzZTsgLy8gaWYgY29udGVudHMgY2FuIG92ZXJmbG93IChjc3Mgc3R5bGluZyksIHRoaXMgZmxhZyBpcyBzZXQgdG8gdHJ1ZQoKICAgIC8vIHZhbGlkYXRlIGRhdGEKICAgIGlmIChkYXRhKSB7CiAgICAgIGlmIChkYXRhLnN0YXJ0ID09IHVuZGVmaW5lZCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignUHJvcGVydHkgInN0YXJ0IiBtaXNzaW5nIGluIGl0ZW0gJyArIGRhdGEuaWQpOwogICAgICB9CiAgICAgIGlmIChkYXRhLmVuZCA9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Byb3BlcnR5ICJlbmQiIG1pc3NpbmcgaW4gaXRlbSAnICsgZGF0YS5pZCk7CiAgICAgIH0KICAgIH0KCiAgICBJdGVtLmNhbGwodGhpcywgZGF0YSwgY29udmVyc2lvbiwgb3B0aW9ucyk7CiAgfQoKICBSYW5nZUl0ZW0ucHJvdG90eXBlID0gbmV3IEl0ZW0obnVsbCwgbnVsbCwgbnVsbCk7CgogIFJhbmdlSXRlbS5wcm90b3R5cGUuYmFzZUNsYXNzTmFtZSA9ICd2aXMtaXRlbSB2aXMtcmFuZ2UnOwoKICAvKioKICAgKiBDaGVjayB3aGV0aGVyIHRoaXMgaXRlbSBpcyB2aXNpYmxlIGluc2lkZSBnaXZlbiByYW5nZQogICAqIEByZXR1cm5zIHt7c3RhcnQ6IE51bWJlciwgZW5kOiBOdW1iZXJ9fSByYW5nZSB3aXRoIGEgdGltZXN0YW1wIGZvciBzdGFydCBhbmQgZW5kCiAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdmlzaWJsZQogICAqLwogIFJhbmdlSXRlbS5wcm90b3R5cGUuaXNWaXNpYmxlID0gZnVuY3Rpb24gKHJhbmdlKSB7CiAgICAvLyBkZXRlcm1pbmUgdmlzaWJpbGl0eQogICAgcmV0dXJuIHRoaXMuZGF0YS5zdGFydCA8IHJhbmdlLmVuZCAmJiB0aGlzLmRhdGEuZW5kID4gcmFuZ2Uuc3RhcnQ7CiAgfTsKCiAgLyoqCiAgICogUmVwYWludCB0aGUgaXRlbQogICAqLwogIFJhbmdlSXRlbS5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGRvbSA9IHRoaXMuZG9tOwogICAgaWYgKCFkb20pIHsKICAgICAgLy8gY3JlYXRlIERPTQogICAgICB0aGlzLmRvbSA9IHt9OwogICAgICBkb20gPSB0aGlzLmRvbTsKCiAgICAgIC8vIGJhY2tncm91bmQgYm94CiAgICAgIGRvbS5ib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgLy8gY2xhc3NOYW1lIGlzIHVwZGF0ZWQgaW4gcmVkcmF3KCkKCiAgICAgIC8vIGZyYW1lIGJveCAodG8gcHJldmVudCB0aGUgaXRlbSBjb250ZW50cyBmcm9tIG92ZXJmbG93aW5nCiAgICAgIGRvbS5mcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBkb20uZnJhbWUuY2xhc3NOYW1lID0gJ3Zpcy1pdGVtLW92ZXJmbG93JzsKICAgICAgZG9tLmJveC5hcHBlbmRDaGlsZChkb20uZnJhbWUpOwoKICAgICAgLy8gY29udGVudHMgYm94CiAgICAgIGRvbS5jb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGRvbS5jb250ZW50LmNsYXNzTmFtZSA9ICd2aXMtaXRlbS1jb250ZW50JzsKICAgICAgZG9tLmZyYW1lLmFwcGVuZENoaWxkKGRvbS5jb250ZW50KTsKCiAgICAgIC8vIGF0dGFjaCB0aGlzIGl0ZW0gYXMgYXR0cmlidXRlCiAgICAgIGRvbS5ib3hbJ3RpbWVsaW5lLWl0ZW0nXSA9IHRoaXM7CgogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBhcHBlbmQgRE9NIHRvIHBhcmVudCBET00KICAgIGlmICghdGhpcy5wYXJlbnQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgcmVkcmF3IGl0ZW06IG5vIHBhcmVudCBhdHRhY2hlZCcpOwogICAgfQogICAgaWYgKCFkb20uYm94LnBhcmVudE5vZGUpIHsKICAgICAgdmFyIGZvcmVncm91bmQgPSB0aGlzLnBhcmVudC5kb20uZm9yZWdyb3VuZDsKICAgICAgaWYgKCFmb3JlZ3JvdW5kKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgcmVkcmF3IGl0ZW06IHBhcmVudCBoYXMgbm8gZm9yZWdyb3VuZCBjb250YWluZXIgZWxlbWVudCcpOwogICAgICB9CiAgICAgIGZvcmVncm91bmQuYXBwZW5kQ2hpbGQoZG9tLmJveCk7CiAgICB9CiAgICB0aGlzLmRpc3BsYXllZCA9IHRydWU7CgogICAgLy8gVXBkYXRlIERPTSB3aGVuIGl0ZW0gaXMgbWFya2VkIGRpcnR5LiBBbiBpdGVtIGlzIG1hcmtlZCBkaXJ0eSB3aGVuOgogICAgLy8gLSB0aGUgaXRlbSBpcyBub3QgeWV0IHJlbmRlcmVkCiAgICAvLyAtIHRoZSBpdGVtJ3MgZGF0YSBpcyBjaGFuZ2VkCiAgICAvLyAtIHRoZSBpdGVtIGlzIHNlbGVjdGVkL2Rlc2VsZWN0ZWQKICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgIHRoaXMuX3VwZGF0ZUNvbnRlbnRzKHRoaXMuZG9tLmNvbnRlbnQpOwogICAgICB0aGlzLl91cGRhdGVUaXRsZSh0aGlzLmRvbS5ib3gpOwogICAgICB0aGlzLl91cGRhdGVEYXRhQXR0cmlidXRlcyh0aGlzLmRvbS5ib3gpOwogICAgICB0aGlzLl91cGRhdGVTdHlsZSh0aGlzLmRvbS5ib3gpOwoKICAgICAgdmFyIGVkaXRhYmxlID0gKHRoaXMub3B0aW9ucy5lZGl0YWJsZS51cGRhdGVUaW1lIHx8IHRoaXMub3B0aW9ucy5lZGl0YWJsZS51cGRhdGVHcm91cCB8fCB0aGlzLmVkaXRhYmxlID09PSB0cnVlKSAmJiB0aGlzLmVkaXRhYmxlICE9PSBmYWxzZTsKCiAgICAgIC8vIHVwZGF0ZSBjbGFzcwogICAgICB2YXIgY2xhc3NOYW1lID0gKHRoaXMuZGF0YS5jbGFzc05hbWUgPyAnICcgKyB0aGlzLmRhdGEuY2xhc3NOYW1lIDogJycpICsgKHRoaXMuc2VsZWN0ZWQgPyAnIHZpcy1zZWxlY3RlZCcgOiAnJykgKyAoZWRpdGFibGUgPyAnIHZpcy1lZGl0YWJsZScgOiAnIHZpcy1yZWFkb25seScpOwogICAgICBkb20uYm94LmNsYXNzTmFtZSA9IHRoaXMuYmFzZUNsYXNzTmFtZSArIGNsYXNzTmFtZTsKCiAgICAgIC8vIGRldGVybWluZSBmcm9tIGNzcyB3aGV0aGVyIHRoaXMgYm94IGhhcyBvdmVyZmxvdwogICAgICB0aGlzLm92ZXJmbG93ID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZG9tLmZyYW1lKS5vdmVyZmxvdyAhPT0gJ2hpZGRlbic7CgogICAgICAvLyByZWNhbGN1bGF0ZSBzaXplCiAgICAgIC8vIHR1cm4gb2ZmIG1heC13aWR0aCB0byBiZSBhYmxlIHRvIGNhbGN1bGF0ZSB0aGUgcmVhbCB3aWR0aAogICAgICAvLyB0aGlzIGNhdXNlcyBhbiBleHRyYSBicm93c2VyIHJlcGFpbnQvcmVmbG93LCBidXQgc28gYmUgaXQKICAgICAgdGhpcy5kb20uY29udGVudC5zdHlsZS5tYXhXaWR0aCA9ICdub25lJzsKICAgICAgdGhpcy5wcm9wcy5jb250ZW50LndpZHRoID0gdGhpcy5kb20uY29udGVudC5vZmZzZXRXaWR0aDsKICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLmRvbS5ib3gub2Zmc2V0SGVpZ2h0OwogICAgICB0aGlzLmRvbS5jb250ZW50LnN0eWxlLm1heFdpZHRoID0gJyc7CgogICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICB9CgogICAgdGhpcy5fcmVwYWludERlbGV0ZUJ1dHRvbihkb20uYm94KTsKICAgIHRoaXMuX3JlcGFpbnREcmFnTGVmdCgpOwogICAgdGhpcy5fcmVwYWludERyYWdSaWdodCgpOwogIH07CgogIC8qKgogICAqIFNob3cgdGhlIGl0ZW0gaW4gdGhlIERPTSAod2hlbiBub3QgYWxyZWFkeSB2aXNpYmxlKS4gVGhlIGl0ZW1zIERPTSB3aWxsCiAgICogYmUgY3JlYXRlZCB3aGVuIG5lZWRlZC4KICAgKi8KICBSYW5nZUl0ZW0ucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXRoaXMuZGlzcGxheWVkKSB7CiAgICAgIHRoaXMucmVkcmF3KCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogSGlkZSB0aGUgaXRlbSBmcm9tIHRoZSBET00gKHdoZW4gdmlzaWJsZSkKICAgKiBAcmV0dXJuIHtCb29sZWFufSBjaGFuZ2VkCiAgICovCiAgUmFuZ2VJdGVtLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuZGlzcGxheWVkKSB7CiAgICAgIHZhciBib3ggPSB0aGlzLmRvbS5ib3g7CgogICAgICBpZiAoYm94LnBhcmVudE5vZGUpIHsKICAgICAgICBib3gucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChib3gpOwogICAgICB9CgogICAgICB0aGlzLmRpc3BsYXllZCA9IGZhbHNlOwogICAgfQogIH07CgogIC8qKgogICAqIFJlcG9zaXRpb24gdGhlIGl0ZW0gaG9yaXpvbnRhbGx5CiAgICogQHBhcmFtIHtib29sZWFufSBbbGltaXRTaXplPXRydWVdIElmIHRydWUgKGRlZmF1bHQpLCB0aGUgd2lkdGggb2YgdGhlIHJhbmdlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gd2lsbCBiZSBsaW1pdGVkLCBhcyB0aGUgYnJvd3NlciBjYW5ub3QKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheSB2ZXJ5IHdpZGUgZGl2cy4gVGhpcyBtZWFucyB0aG91Z2gKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhhdCB0aGUgYXBwbGllZCBsZWZ0IGFuZCB3aWR0aCBtYXkKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90IGNvcnJlc3BvbmQgdG8gdGhlIHJhbmdlcyBzdGFydCBhbmQgZW5kCiAgICogQE92ZXJyaWRlCiAgICovCiAgUmFuZ2VJdGVtLnByb3RvdHlwZS5yZXBvc2l0aW9uWCA9IGZ1bmN0aW9uIChsaW1pdFNpemUpIHsKICAgIHZhciBwYXJlbnRXaWR0aCA9IHRoaXMucGFyZW50LndpZHRoOwogICAgdmFyIHN0YXJ0ID0gdGhpcy5jb252ZXJzaW9uLnRvU2NyZWVuKHRoaXMuZGF0YS5zdGFydCk7CiAgICB2YXIgZW5kID0gdGhpcy5jb252ZXJzaW9uLnRvU2NyZWVuKHRoaXMuZGF0YS5lbmQpOwogICAgdmFyIGNvbnRlbnRMZWZ0OwogICAgdmFyIGNvbnRlbnRXaWR0aDsKCiAgICAvLyBsaW1pdCB0aGUgd2lkdGggb2YgdGhlIHJhbmdlLCBhcyBicm93c2VycyBjYW5ub3QgZHJhdyB2ZXJ5IHdpZGUgZGl2cwogICAgaWYgKGxpbWl0U2l6ZSA9PT0gdW5kZWZpbmVkIHx8IGxpbWl0U2l6ZSA9PT0gdHJ1ZSkgewogICAgICBpZiAoc3RhcnQgPCAtcGFyZW50V2lkdGgpIHsKICAgICAgICBzdGFydCA9IC1wYXJlbnRXaWR0aDsKICAgICAgfQogICAgICBpZiAoZW5kID4gMiAqIHBhcmVudFdpZHRoKSB7CiAgICAgICAgZW5kID0gMiAqIHBhcmVudFdpZHRoOwogICAgICB9CiAgICB9CiAgICB2YXIgYm94V2lkdGggPSBNYXRoLm1heChlbmQgLSBzdGFydCwgMSk7CgogICAgaWYgKHRoaXMub3ZlcmZsb3cpIHsKICAgICAgdGhpcy5sZWZ0ID0gc3RhcnQ7CiAgICAgIHRoaXMud2lkdGggPSBib3hXaWR0aCArIHRoaXMucHJvcHMuY29udGVudC53aWR0aDsKICAgICAgY29udGVudFdpZHRoID0gdGhpcy5wcm9wcy5jb250ZW50LndpZHRoOwoKICAgICAgLy8gTm90ZTogVGhlIGNhbGN1bGF0aW9uIG9mIHdpZHRoIGlzIGFuIG9wdGltaXN0aWMgY2FsY3VsYXRpb24sIGdpdmluZwogICAgICAvLyAgICAgICBhIHdpZHRoIHdoaWNoIHdpbGwgbm90IGNoYW5nZSB3aGVuIG1vdmluZyB0aGUgVGltZWxpbmUKICAgICAgLy8gICAgICAgU28gbm8gcmUtc3RhY2tpbmcgbmVlZGVkLCB3aGljaCBpcyBuaWNlciBmb3IgdGhlIGV5ZTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubGVmdCA9IHN0YXJ0OwogICAgICB0aGlzLndpZHRoID0gYm94V2lkdGg7CiAgICAgIGNvbnRlbnRXaWR0aCA9IE1hdGgubWluKGVuZCAtIHN0YXJ0LCB0aGlzLnByb3BzLmNvbnRlbnQud2lkdGgpOwogICAgfQoKICAgIHRoaXMuZG9tLmJveC5zdHlsZS5sZWZ0ID0gdGhpcy5sZWZ0ICsgJ3B4JzsKICAgIHRoaXMuZG9tLmJveC5zdHlsZS53aWR0aCA9IGJveFdpZHRoICsgJ3B4JzsKCiAgICBzd2l0Y2ggKHRoaXMub3B0aW9ucy5hbGlnbikgewogICAgICBjYXNlICdsZWZ0JzoKICAgICAgICB0aGlzLmRvbS5jb250ZW50LnN0eWxlLmxlZnQgPSAnMCc7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdyaWdodCc6CiAgICAgICAgdGhpcy5kb20uY29udGVudC5zdHlsZS5sZWZ0ID0gTWF0aC5tYXgoYm94V2lkdGggLSBjb250ZW50V2lkdGgsIDApICsgJ3B4JzsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2NlbnRlcic6CiAgICAgICAgdGhpcy5kb20uY29udGVudC5zdHlsZS5sZWZ0ID0gTWF0aC5tYXgoKGJveFdpZHRoIC0gY29udGVudFdpZHRoKSAvIDIsIDApICsgJ3B4JzsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgLy8gJ2F1dG8nCiAgICAgICAgLy8gd2hlbiByYW5nZSBleGNlZWRzIGxlZnQgb2YgdGhlIHdpbmRvdywgcG9zaXRpb24gdGhlIGNvbnRlbnRzIGF0IHRoZSBsZWZ0IG9mIHRoZSB2aXNpYmxlIGFyZWEKICAgICAgICBpZiAodGhpcy5vdmVyZmxvdykgewogICAgICAgICAgaWYgKGVuZCA+IDApIHsKICAgICAgICAgICAgY29udGVudExlZnQgPSBNYXRoLm1heCgtc3RhcnQsIDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29udGVudExlZnQgPSAtY29udGVudFdpZHRoOyAvLyBlbnN1cmUgaXQncyBub3QgdmlzaWJsZSBhbnltb3JlCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChzdGFydCA8IDApIHsKICAgICAgICAgICAgY29udGVudExlZnQgPSAtc3RhcnQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb250ZW50TGVmdCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuZG9tLmNvbnRlbnQuc3R5bGUubGVmdCA9IGNvbnRlbnRMZWZ0ICsgJ3B4JzsKICAgIH0KICB9OwoKICAvKioKICAgKiBSZXBvc2l0aW9uIHRoZSBpdGVtIHZlcnRpY2FsbHkKICAgKiBAT3ZlcnJpZGUKICAgKi8KICBSYW5nZUl0ZW0ucHJvdG90eXBlLnJlcG9zaXRpb25ZID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG9yaWVudGF0aW9uID0gdGhpcy5vcHRpb25zLm9yaWVudGF0aW9uLml0ZW07CiAgICB2YXIgYm94ID0gdGhpcy5kb20uYm94OwoKICAgIGlmIChvcmllbnRhdGlvbiA9PSAndG9wJykgewogICAgICBib3guc3R5bGUudG9wID0gdGhpcy50b3AgKyAncHgnOwogICAgfSBlbHNlIHsKICAgICAgYm94LnN0eWxlLnRvcCA9IHRoaXMucGFyZW50LmhlaWdodCAtIHRoaXMudG9wIC0gdGhpcy5oZWlnaHQgKyAncHgnOwogICAgfQogIH07CgogIC8qKgogICAqIFJlcGFpbnQgYSBkcmFnIGFyZWEgb24gdGhlIGxlZnQgc2lkZSBvZiB0aGUgcmFuZ2Ugd2hlbiB0aGUgcmFuZ2UgaXMgc2VsZWN0ZWQKICAgKiBAcHJvdGVjdGVkCiAgICovCiAgUmFuZ2VJdGVtLnByb3RvdHlwZS5fcmVwYWludERyYWdMZWZ0ID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuc2VsZWN0ZWQgJiYgdGhpcy5vcHRpb25zLmVkaXRhYmxlLnVwZGF0ZVRpbWUgJiYgIXRoaXMuZG9tLmRyYWdMZWZ0KSB7CiAgICAgIC8vIGNyZWF0ZSBhbmQgc2hvdyBkcmFnIGFyZWEKICAgICAgdmFyIGRyYWdMZWZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGRyYWdMZWZ0LmNsYXNzTmFtZSA9ICd2aXMtZHJhZy1sZWZ0JzsKICAgICAgZHJhZ0xlZnQuZHJhZ0xlZnRJdGVtID0gdGhpczsKCiAgICAgIHRoaXMuZG9tLmJveC5hcHBlbmRDaGlsZChkcmFnTGVmdCk7CiAgICAgIHRoaXMuZG9tLmRyYWdMZWZ0ID0gZHJhZ0xlZnQ7CiAgICB9IGVsc2UgaWYgKCF0aGlzLnNlbGVjdGVkICYmIHRoaXMuZG9tLmRyYWdMZWZ0KSB7CiAgICAgIC8vIGRlbGV0ZSBkcmFnIGFyZWEKICAgICAgaWYgKHRoaXMuZG9tLmRyYWdMZWZ0LnBhcmVudE5vZGUpIHsKICAgICAgICB0aGlzLmRvbS5kcmFnTGVmdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZG9tLmRyYWdMZWZ0KTsKICAgICAgfQogICAgICB0aGlzLmRvbS5kcmFnTGVmdCA9IG51bGw7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogUmVwYWludCBhIGRyYWcgYXJlYSBvbiB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgcmFuZ2Ugd2hlbiB0aGUgcmFuZ2UgaXMgc2VsZWN0ZWQKICAgKiBAcHJvdGVjdGVkCiAgICovCiAgUmFuZ2VJdGVtLnByb3RvdHlwZS5fcmVwYWludERyYWdSaWdodCA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLnNlbGVjdGVkICYmIHRoaXMub3B0aW9ucy5lZGl0YWJsZS51cGRhdGVUaW1lICYmICF0aGlzLmRvbS5kcmFnUmlnaHQpIHsKICAgICAgLy8gY3JlYXRlIGFuZCBzaG93IGRyYWcgYXJlYQogICAgICB2YXIgZHJhZ1JpZ2h0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGRyYWdSaWdodC5jbGFzc05hbWUgPSAndmlzLWRyYWctcmlnaHQnOwogICAgICBkcmFnUmlnaHQuZHJhZ1JpZ2h0SXRlbSA9IHRoaXM7CgogICAgICB0aGlzLmRvbS5ib3guYXBwZW5kQ2hpbGQoZHJhZ1JpZ2h0KTsKICAgICAgdGhpcy5kb20uZHJhZ1JpZ2h0ID0gZHJhZ1JpZ2h0OwogICAgfSBlbHNlIGlmICghdGhpcy5zZWxlY3RlZCAmJiB0aGlzLmRvbS5kcmFnUmlnaHQpIHsKICAgICAgLy8gZGVsZXRlIGRyYWcgYXJlYQogICAgICBpZiAodGhpcy5kb20uZHJhZ1JpZ2h0LnBhcmVudE5vZGUpIHsKICAgICAgICB0aGlzLmRvbS5kcmFnUmlnaHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmRvbS5kcmFnUmlnaHQpOwogICAgICB9CiAgICAgIHRoaXMuZG9tLmRyYWdSaWdodCA9IG51bGw7CiAgICB9CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBSYW5nZUl0ZW07CgovKioqLyB9LAovKiAzNSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgSGFtbWVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMyk7CiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICAvKioKICAgKiBAY29uc3RydWN0b3IgSXRlbQogICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhICAgICAgICAgICAgIE9iamVjdCBjb250YWluaW5nIChvcHRpb25hbCkgcGFyYW1ldGVycyB0eXBlLAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0LCBlbmQsIGNvbnRlbnQsIGdyb3VwLCBjbGFzc05hbWUuCiAgICogQHBhcmFtIHt7dG9TY3JlZW46IGZ1bmN0aW9uLCB0b1RpbWU6IGZ1bmN0aW9ufX0gY29udmVyc2lvbgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnZlcnNpb24gZnVuY3Rpb25zIGZyb20gdGltZSB0byBzY3JlZW4gYW5kIHZpY2UgdmVyc2EKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgICAgICAgICBDb25maWd1cmF0aW9uIG9wdGlvbnMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBkZXNjcmliZSBhdmFpbGFibGUgb3B0aW9ucwogICAqLwogIGZ1bmN0aW9uIEl0ZW0oZGF0YSwgY29udmVyc2lvbiwgb3B0aW9ucykgewogICAgdGhpcy5pZCA9IG51bGw7CiAgICB0aGlzLnBhcmVudCA9IG51bGw7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5kb20gPSBudWxsOwogICAgdGhpcy5jb252ZXJzaW9uID0gY29udmVyc2lvbiB8fCB7fTsKICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlOwogICAgdGhpcy5kaXNwbGF5ZWQgPSBmYWxzZTsKICAgIHRoaXMuZGlydHkgPSB0cnVlOwoKICAgIHRoaXMudG9wID0gbnVsbDsKICAgIHRoaXMubGVmdCA9IG51bGw7CiAgICB0aGlzLndpZHRoID0gbnVsbDsKICAgIHRoaXMuaGVpZ2h0ID0gbnVsbDsKCiAgICB0aGlzLmVkaXRhYmxlID0gbnVsbDsKICAgIGlmICh0aGlzLmRhdGEgJiYgdGhpcy5kYXRhLmhhc093blByb3BlcnR5KCdlZGl0YWJsZScpICYmIHR5cGVvZiB0aGlzLmRhdGEuZWRpdGFibGUgPT09ICdib29sZWFuJykgewogICAgICB0aGlzLmVkaXRhYmxlID0gZGF0YS5lZGl0YWJsZTsKICAgIH0KICB9CgogIEl0ZW0ucHJvdG90eXBlLnN0YWNrID0gdHJ1ZTsKCiAgLyoqCiAgICogU2VsZWN0IGN1cnJlbnQgaXRlbQogICAqLwogIEl0ZW0ucHJvdG90eXBlLnNlbGVjdCA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuc2VsZWN0ZWQgPSB0cnVlOwogICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICBpZiAodGhpcy5kaXNwbGF5ZWQpIHRoaXMucmVkcmF3KCk7CiAgfTsKCiAgLyoqCiAgICogVW5zZWxlY3QgY3VycmVudCBpdGVtCiAgICovCiAgSXRlbS5wcm90b3R5cGUudW5zZWxlY3QgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLnNlbGVjdGVkID0gZmFsc2U7CiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIGlmICh0aGlzLmRpc3BsYXllZCkgdGhpcy5yZWRyYXcoKTsKICB9OwoKICAvKioKICAgKiBTZXQgZGF0YSBmb3IgdGhlIGl0ZW0uIEV4aXN0aW5nIGRhdGEgd2lsbCBiZSB1cGRhdGVkLiBUaGUgaWQgc2hvdWxkIG5vdAogICAqIGJlIGNoYW5nZWQuIFdoZW4gdGhlIGl0ZW0gaXMgZGlzcGxheWVkLCBpdCB3aWxsIGJlIHJlZHJhd24gaW1tZWRpYXRlbHkuCiAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEKICAgKi8KICBJdGVtLnByb3RvdHlwZS5zZXREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBncm91cENoYW5nZWQgPSBkYXRhLmdyb3VwICE9IHVuZGVmaW5lZCAmJiB0aGlzLmRhdGEuZ3JvdXAgIT0gZGF0YS5ncm91cDsKICAgIGlmIChncm91cENoYW5nZWQpIHsKICAgICAgdGhpcy5wYXJlbnQuaXRlbVNldC5fbW92ZVRvR3JvdXAodGhpcywgZGF0YS5ncm91cCk7CiAgICB9CgogICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoJ2VkaXRhYmxlJykgJiYgdHlwZW9mIGRhdGEuZWRpdGFibGUgPT09ICdib29sZWFuJykgewogICAgICB0aGlzLmVkaXRhYmxlID0gZGF0YS5lZGl0YWJsZTsKICAgIH0KCiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICBpZiAodGhpcy5kaXNwbGF5ZWQpIHRoaXMucmVkcmF3KCk7CiAgfTsKCiAgLyoqCiAgICogU2V0IGEgcGFyZW50IGZvciB0aGUgaXRlbQogICAqIEBwYXJhbSB7SXRlbVNldCB8IEdyb3VwfSBwYXJlbnQKICAgKi8KICBJdGVtLnByb3RvdHlwZS5zZXRQYXJlbnQgPSBmdW5jdGlvbiAocGFyZW50KSB7CiAgICBpZiAodGhpcy5kaXNwbGF5ZWQpIHsKICAgICAgdGhpcy5oaWRlKCk7CiAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50OwogICAgICBpZiAodGhpcy5wYXJlbnQpIHsKICAgICAgICB0aGlzLnNob3coKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ2hlY2sgd2hldGhlciB0aGlzIGl0ZW0gaXMgdmlzaWJsZSBpbnNpZGUgZ2l2ZW4gcmFuZ2UKICAgKiBAcmV0dXJucyB7e3N0YXJ0OiBOdW1iZXIsIGVuZDogTnVtYmVyfX0gcmFuZ2Ugd2l0aCBhIHRpbWVzdGFtcCBmb3Igc3RhcnQgYW5kIGVuZAogICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHZpc2libGUKICAgKi8KICBJdGVtLnByb3RvdHlwZS5pc1Zpc2libGUgPSBmdW5jdGlvbiAocmFuZ2UpIHsKICAgIC8vIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBieSBJdGVtIGltcGxlbWVudGF0aW9ucwogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIC8qKgogICAqIFNob3cgdGhlIEl0ZW0gaW4gdGhlIERPTSAod2hlbiBub3QgYWxyZWFkeSB2aXNpYmxlKQogICAqIEByZXR1cm4ge0Jvb2xlYW59IGNoYW5nZWQKICAgKi8KICBJdGVtLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH07CgogIC8qKgogICAqIEhpZGUgdGhlIEl0ZW0gZnJvbSB0aGUgRE9NICh3aGVuIHZpc2libGUpCiAgICogQHJldHVybiB7Qm9vbGVhbn0gY2hhbmdlZAogICAqLwogIEl0ZW0ucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfTsKCiAgLyoqCiAgICogUmVwYWludCB0aGUgaXRlbQogICAqLwogIEl0ZW0ucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHt9OwoKICAvKioKICAgKiBSZXBvc2l0aW9uIHRoZSBJdGVtIGhvcml6b250YWxseQogICAqLwogIEl0ZW0ucHJvdG90eXBlLnJlcG9zaXRpb25YID0gZnVuY3Rpb24gKCkge307CgogIC8qKgogICAqIFJlcG9zaXRpb24gdGhlIEl0ZW0gdmVydGljYWxseQogICAqLwogIEl0ZW0ucHJvdG90eXBlLnJlcG9zaXRpb25ZID0gZnVuY3Rpb24gKCkge307CgogIC8qKgogICAqIFJlcGFpbnQgYSBkZWxldGUgYnV0dG9uIG9uIHRoZSB0b3AgcmlnaHQgb2YgdGhlIGl0ZW0gd2hlbiB0aGUgaXRlbSBpcyBzZWxlY3RlZAogICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGFuY2hvcgogICAqIEBwcm90ZWN0ZWQKICAgKi8KICBJdGVtLnByb3RvdHlwZS5fcmVwYWludERlbGV0ZUJ1dHRvbiA9IGZ1bmN0aW9uIChhbmNob3IpIHsKICAgIHZhciBlZGl0YWJsZSA9ICh0aGlzLm9wdGlvbnMuZWRpdGFibGUucmVtb3ZlIHx8IHRoaXMuZGF0YS5lZGl0YWJsZSA9PT0gdHJ1ZSkgJiYgdGhpcy5kYXRhLmVkaXRhYmxlICE9PSBmYWxzZTsKCiAgICBpZiAodGhpcy5zZWxlY3RlZCAmJiBlZGl0YWJsZSAmJiAhdGhpcy5kb20uZGVsZXRlQnV0dG9uKSB7CiAgICAgIC8vIGNyZWF0ZSBhbmQgc2hvdyBidXR0b24KICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHZhciBkZWxldGVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgZGVsZXRlQnV0dG9uLmNsYXNzTmFtZSA9ICd2aXMtZGVsZXRlJzsKICAgICAgZGVsZXRlQnV0dG9uLnRpdGxlID0gJ0RlbGV0ZSB0aGlzIGl0ZW0nOwoKICAgICAgLy8gVE9ETzogYmUgYWJsZSB0byBkZXN0cm95IHRoZSBkZWxldGUgYnV0dG9uCiAgICAgIG5ldyBIYW1tZXIoZGVsZXRlQnV0dG9uKS5vbigndGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgbWUucGFyZW50LnJlbW92ZUZyb21EYXRhU2V0KG1lKTsKICAgICAgfSk7CgogICAgICBhbmNob3IuYXBwZW5kQ2hpbGQoZGVsZXRlQnV0dG9uKTsKICAgICAgdGhpcy5kb20uZGVsZXRlQnV0dG9uID0gZGVsZXRlQnV0dG9uOwogICAgfSBlbHNlIGlmICghdGhpcy5zZWxlY3RlZCAmJiB0aGlzLmRvbS5kZWxldGVCdXR0b24pIHsKICAgICAgLy8gcmVtb3ZlIGJ1dHRvbgogICAgICBpZiAodGhpcy5kb20uZGVsZXRlQnV0dG9uLnBhcmVudE5vZGUpIHsKICAgICAgICB0aGlzLmRvbS5kZWxldGVCdXR0b24ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmRvbS5kZWxldGVCdXR0b24pOwogICAgICB9CiAgICAgIHRoaXMuZG9tLmRlbGV0ZUJ1dHRvbiA9IG51bGw7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU2V0IEhUTUwgY29udGVudHMgZm9yIHRoZSBpdGVtCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50ICAgSFRNTCBlbGVtZW50IHRvIGZpbGwgd2l0aCB0aGUgY29udGVudHMKICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW0ucHJvdG90eXBlLl91cGRhdGVDb250ZW50cyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICB2YXIgY29udGVudDsKICAgIGlmICh0aGlzLm9wdGlvbnMudGVtcGxhdGUpIHsKICAgICAgdmFyIGl0ZW1EYXRhID0gdGhpcy5wYXJlbnQuaXRlbVNldC5pdGVtc0RhdGEuZ2V0KHRoaXMuaWQpOyAvLyBnZXQgYSBjbG9uZSBvZiB0aGUgZGF0YSBmcm9tIHRoZSBkYXRhc2V0CiAgICAgIGNvbnRlbnQgPSB0aGlzLm9wdGlvbnMudGVtcGxhdGUoaXRlbURhdGEpOwogICAgfSBlbHNlIHsKICAgICAgY29udGVudCA9IHRoaXMuZGF0YS5jb250ZW50OwogICAgfQoKICAgIHZhciBjaGFuZ2VkID0gdGhpcy5fY29udGVudFRvU3RyaW5nKHRoaXMuY29udGVudCkgIT09IHRoaXMuX2NvbnRlbnRUb1N0cmluZyhjb250ZW50KTsKICAgIGlmIChjaGFuZ2VkKSB7CiAgICAgIC8vIG9ubHkgcmVwbGFjZSB0aGUgY29udGVudCB3aGVuIGNoYW5nZWQKICAgICAgaWYgKGNvbnRlbnQgaW5zdGFuY2VvZiBFbGVtZW50KSB7CiAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSAnJzsKICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGNvbnRlbnQpOwogICAgICB9IGVsc2UgaWYgKGNvbnRlbnQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBjb250ZW50OwogICAgICB9IGVsc2UgewogICAgICAgIGlmICghKHRoaXMuZGF0YS50eXBlID09ICdiYWNrZ3JvdW5kJyAmJiB0aGlzLmRhdGEuY29udGVudCA9PT0gdW5kZWZpbmVkKSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQcm9wZXJ0eSAiY29udGVudCIgbWlzc2luZyBpbiBpdGVtICcgKyB0aGlzLmlkKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuY29udGVudCA9IGNvbnRlbnQ7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU2V0IEhUTUwgY29udGVudHMgZm9yIHRoZSBpdGVtCiAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50ICAgSFRNTCBlbGVtZW50IHRvIGZpbGwgd2l0aCB0aGUgY29udGVudHMKICAgKiBAcHJpdmF0ZQogICAqLwogIEl0ZW0ucHJvdG90eXBlLl91cGRhdGVUaXRsZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICBpZiAodGhpcy5kYXRhLnRpdGxlICE9IG51bGwpIHsKICAgICAgZWxlbWVudC50aXRsZSA9IHRoaXMuZGF0YS50aXRsZSB8fCAnJzsKICAgIH0gZWxzZSB7CiAgICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCd2aXMtdGl0bGUnKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBQcm9jZXNzIGRhdGFBdHRyaWJ1dGVzIHRpbWVsaW5lIG9wdGlvbiBhbmQgc2V0IGFzIGRhdGEtIGF0dHJpYnV0ZXMgb24gZG9tLmNvbnRlbnQKICAgKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgICBIVE1MIGVsZW1lbnQgdG8gd2hpY2ggdGhlIGF0dHJpYnV0ZXMgd2lsbCBiZSBhdHRhY2hlZAogICAqIEBwcml2YXRlCiAgICovCiAgSXRlbS5wcm90b3R5cGUuX3VwZGF0ZURhdGFBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgIGlmICh0aGlzLm9wdGlvbnMuZGF0YUF0dHJpYnV0ZXMgJiYgdGhpcy5vcHRpb25zLmRhdGFBdHRyaWJ1dGVzLmxlbmd0aCA+IDApIHsKICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBbXTsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMub3B0aW9ucy5kYXRhQXR0cmlidXRlcykpIHsKICAgICAgICBhdHRyaWJ1dGVzID0gdGhpcy5vcHRpb25zLmRhdGFBdHRyaWJ1dGVzOwogICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5kYXRhQXR0cmlidXRlcyA9PSAnYWxsJykgewogICAgICAgIGF0dHJpYnV0ZXMgPSBPYmplY3Qua2V5cyh0aGlzLmRhdGEpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIG5hbWUgPSBhdHRyaWJ1dGVzW2ldOwogICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZGF0YVtuYW1lXTsKCiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHsKICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLScgKyBuYW1lLCB2YWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdkYXRhLScgKyBuYW1lKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBVcGRhdGUgY3VzdG9tIHN0eWxlcyBvZiB0aGUgZWxlbWVudAogICAqIEBwYXJhbSBlbGVtZW50CiAgICogQHByaXZhdGUKICAgKi8KICBJdGVtLnByb3RvdHlwZS5fdXBkYXRlU3R5bGUgPSBmdW5jdGlvbiAoZWxlbWVudCkgewogICAgLy8gcmVtb3ZlIG9sZCBzdHlsZXMKICAgIGlmICh0aGlzLnN0eWxlKSB7CiAgICAgIHV0aWwucmVtb3ZlQ3NzVGV4dChlbGVtZW50LCB0aGlzLnN0eWxlKTsKICAgICAgdGhpcy5zdHlsZSA9IG51bGw7CiAgICB9CgogICAgLy8gYXBwZW5kIG5ldyBzdHlsZXMKICAgIGlmICh0aGlzLmRhdGEuc3R5bGUpIHsKICAgICAgdXRpbC5hZGRDc3NUZXh0KGVsZW1lbnQsIHRoaXMuZGF0YS5zdHlsZSk7CiAgICAgIHRoaXMuc3R5bGUgPSB0aGlzLmRhdGEuc3R5bGU7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU3RyaW5naWZ5IHRoZSBpdGVtcyBjb250ZW50cwogICAqIEBwYXJhbSB7c3RyaW5nIHwgRWxlbWVudCB8IHVuZGVmaW5lZH0gY29udGVudAogICAqIEByZXR1cm5zIHtzdHJpbmcgfCB1bmRlZmluZWR9CiAgICogQHByaXZhdGUKICAgKi8KICBJdGVtLnByb3RvdHlwZS5fY29udGVudFRvU3RyaW5nID0gZnVuY3Rpb24gKGNvbnRlbnQpIHsKICAgIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ3N0cmluZycpIHJldHVybiBjb250ZW50OwogICAgaWYgKGNvbnRlbnQgJiYgJ291dGVySFRNTCcgaW4gY29udGVudCkgcmV0dXJuIGNvbnRlbnQub3V0ZXJIVE1MOwogICAgcmV0dXJuIGNvbnRlbnQ7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJuIHRoZSB3aWR0aCBvZiB0aGUgaXRlbSBsZWZ0IGZyb20gaXRzIHN0YXJ0IGRhdGUKICAgKiBAcmV0dXJuIHtudW1iZXJ9CiAgICovCiAgSXRlbS5wcm90b3R5cGUuZ2V0V2lkdGhMZWZ0ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIDA7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJuIHRoZSB3aWR0aCBvZiB0aGUgaXRlbSByaWdodCBmcm9tIHRoZSBtYXggb2YgaXRzIHN0YXJ0IGFuZCBlbmQgZGF0ZQogICAqIEByZXR1cm4ge251bWJlcn0KICAgKi8KICBJdGVtLnByb3RvdHlwZS5nZXRXaWR0aFJpZ2h0ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIDA7CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBJdGVtOwoKICAvLyBzaG91bGQgYmUgaW1wbGVtZW50ZWQgYnkgdGhlIGl0ZW0KCiAgLy8gc2hvdWxkIGJlIGltcGxlbWVudGVkIGJ5IHRoZSBpdGVtCgogIC8vIHNob3VsZCBiZSBpbXBsZW1lbnRlZCBieSB0aGUgaXRlbQoKLyoqKi8gfSwKLyogMzYgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIG1vbWVudCA9IF9fd2VicGFja19yZXF1aXJlX18oMik7CiAgdmFyIERhdGVVdGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOSk7CiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICAvKioKICAgKiBAY29uc3RydWN0b3IgIFRpbWVTdGVwCiAgICogVGhlIGNsYXNzIFRpbWVTdGVwIGlzIGFuIGl0ZXJhdG9yIGZvciBkYXRlcy4gWW91IHByb3ZpZGUgYSBzdGFydCBkYXRlIGFuZCBhbgogICAqIGVuZCBkYXRlLiBUaGUgY2xhc3MgaXRzZWxmIGRldGVybWluZXMgdGhlIGJlc3Qgc2NhbGUgKHN0ZXAgc2l6ZSkgYmFzZWQgb24gdGhlCiAgICogcHJvdmlkZWQgc3RhcnQgRGF0ZSwgZW5kIERhdGUsIGFuZCBtaW5pbXVtU3RlcC4KICAgKgogICAqIElmIG1pbmltdW1TdGVwIGlzIHByb3ZpZGVkLCB0aGUgc3RlcCBzaXplIGlzIGNob3NlbiBhcyBjbG9zZSBhcyBwb3NzaWJsZQogICAqIHRvIHRoZSBtaW5pbXVtU3RlcCBidXQgbGFyZ2VyIHRoYW4gbWluaW11bVN0ZXAuIElmIG1pbmltdW1TdGVwIGlzIG5vdAogICAqIHByb3ZpZGVkLCB0aGUgc2NhbGUgaXMgc2V0IHRvIDEgREFZLgogICAqIFRoZSBtaW5pbXVtU3RlcCBzaG91bGQgY29ycmVzcG9uZCB3aXRoIHRoZSBvbnNjcmVlbiBzaXplIG9mIGFib3V0IDYgY2hhcmFjdGVycwogICAqCiAgICogQWx0ZXJuYXRpdmVseSwgeW91IGNhbiBzZXQgYSBzY2FsZSBieSBoYW5kLgogICAqIEFmdGVyIGNyZWF0aW9uLCB5b3UgY2FuIGluaXRpYWxpemUgdGhlIGNsYXNzIGJ5IGV4ZWN1dGluZyBmaXJzdCgpLiBUaGVuIHlvdQogICAqIGNhbiBpdGVyYXRlIGZyb20gdGhlIHN0YXJ0IGRhdGUgdG8gdGhlIGVuZCBkYXRlIHZpYSBuZXh0KCkuIFlvdSBjYW4gY2hlY2sgaWYKICAgKiB0aGUgZW5kIGRhdGUgaXMgcmVhY2hlZCB3aXRoIHRoZSBmdW5jdGlvbiBoYXNOZXh0KCkuIEFmdGVyIGVhY2ggc3RlcCwgeW91IGNhbgogICAqIHJldHJpZXZlIHRoZSBjdXJyZW50IGRhdGUgdmlhIGdldEN1cnJlbnQoKS4KICAgKiBUaGUgVGltZVN0ZXAgaGFzIHNjYWxlcyByYW5naW5nIGZyb20gbWlsbGlzZWNvbmRzLCBzZWNvbmRzLCBtaW51dGVzLCBob3VycywKICAgKiBkYXlzLCB0byB5ZWFycy4KICAgKgogICAqIFZlcnNpb246IDEuMgogICAqCiAgICogQHBhcmFtIHtEYXRlfSBbc3RhcnRdICAgICAgICAgVGhlIHN0YXJ0IGRhdGUsIGZvciBleGFtcGxlIG5ldyBEYXRlKDIwMTAsIDksIDIxKQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIG5ldyBEYXRlKDIwMTAsIDksIDIxLCAyMywgNDUsIDAwKQogICAqIEBwYXJhbSB7RGF0ZX0gW2VuZF0gICAgICAgICAgIFRoZSBlbmQgZGF0ZQogICAqIEBwYXJhbSB7TnVtYmVyfSBbbWluaW11bVN0ZXBdIE9wdGlvbmFsLiBNaW5pbXVtIHN0ZXAgc2l6ZSBpbiBtaWxsaXNlY29uZHMKICAgKi8KICBmdW5jdGlvbiBUaW1lU3RlcChzdGFydCwgZW5kLCBtaW5pbXVtU3RlcCwgaGlkZGVuRGF0ZXMpIHsKICAgIC8vIHZhcmlhYmxlcwogICAgdGhpcy5jdXJyZW50ID0gbmV3IERhdGUoKTsKICAgIHRoaXMuX3N0YXJ0ID0gbmV3IERhdGUoKTsKICAgIHRoaXMuX2VuZCA9IG5ldyBEYXRlKCk7CgogICAgdGhpcy5hdXRvU2NhbGUgPSB0cnVlOwogICAgdGhpcy5zY2FsZSA9ICdkYXknOwogICAgdGhpcy5zdGVwID0gMTsKCiAgICAvLyBpbml0aWFsaXplIHRoZSByYW5nZQogICAgdGhpcy5zZXRSYW5nZShzdGFydCwgZW5kLCBtaW5pbXVtU3RlcCk7CgogICAgLy8gaGlkZGVuIERhdGVzIG9wdGlvbnMKICAgIHRoaXMuc3dpdGNoZWREYXkgPSBmYWxzZTsKICAgIHRoaXMuc3dpdGNoZWRNb250aCA9IGZhbHNlOwogICAgdGhpcy5zd2l0Y2hlZFllYXIgPSBmYWxzZTsKICAgIHRoaXMuaGlkZGVuRGF0ZXMgPSBoaWRkZW5EYXRlczsKICAgIGlmIChoaWRkZW5EYXRlcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuaGlkZGVuRGF0ZXMgPSBbXTsKICAgIH0KCiAgICB0aGlzLmZvcm1hdCA9IFRpbWVTdGVwLkZPUk1BVDsgLy8gZGVmYXVsdCBmb3JtYXR0aW5nCiAgfQoKICAvLyBUaW1lIGZvcm1hdHRpbmcKICBUaW1lU3RlcC5GT1JNQVQgPSB7CiAgICBtaW5vckxhYmVsczogewogICAgICBtaWxsaXNlY29uZDogJ1NTUycsCiAgICAgIHNlY29uZDogJ3MnLAogICAgICBtaW51dGU6ICdISDptbScsCiAgICAgIGhvdXI6ICdISDptbScsCiAgICAgIHdlZWtkYXk6ICdkZGQgRCcsCiAgICAgIGRheTogJ0QnLAogICAgICBtb250aDogJ01NTScsCiAgICAgIHllYXI6ICdZWVlZJwogICAgfSwKICAgIG1ham9yTGFiZWxzOiB7CiAgICAgIG1pbGxpc2Vjb25kOiAnSEg6bW06c3MnLAogICAgICBzZWNvbmQ6ICdEIE1NTU0gSEg6bW0nLAogICAgICBtaW51dGU6ICdkZGQgRCBNTU1NJywKICAgICAgaG91cjogJ2RkZCBEIE1NTU0nLAogICAgICB3ZWVrZGF5OiAnTU1NTSBZWVlZJywKICAgICAgZGF5OiAnTU1NTSBZWVlZJywKICAgICAgbW9udGg6ICdZWVlZJywKICAgICAgeWVhcjogJycKICAgIH0KICB9OwoKICAvKioKICAgKiBTZXQgY3VzdG9tIGZvcm1hdHRpbmcgZm9yIHRoZSBtaW5vciBhbiBtYWpvciBsYWJlbHMgb2YgdGhlIFRpbWVTdGVwLgogICAqIEJvdGggYG1pbm9yTGFiZWxzYCBhbmQgYG1ham9yTGFiZWxzYCBhcmUgYW4gT2JqZWN0IHdpdGggcHJvcGVydGllczoKICAgKiAnbWlsbGlzZWNvbmQnLCAnc2Vjb25kJywgJ21pbnV0ZScsICdob3VyJywgJ3dlZWtkYXknLCAnZGF5JywgJ21vbnRoJywgJ3llYXInLgogICAqIEBwYXJhbSB7e21pbm9yTGFiZWxzOiBPYmplY3QsIG1ham9yTGFiZWxzOiBPYmplY3R9fSBmb3JtYXQKICAgKi8KICBUaW1lU3RlcC5wcm90b3R5cGUuc2V0Rm9ybWF0ID0gZnVuY3Rpb24gKGZvcm1hdCkgewogICAgdmFyIGRlZmF1bHRGb3JtYXQgPSB1dGlsLmRlZXBFeHRlbmQoe30sIFRpbWVTdGVwLkZPUk1BVCk7CiAgICB0aGlzLmZvcm1hdCA9IHV0aWwuZGVlcEV4dGVuZChkZWZhdWx0Rm9ybWF0LCBmb3JtYXQpOwogIH07CgogIC8qKgogICAqIFNldCBhIG5ldyByYW5nZQogICAqIElmIG1pbmltdW1TdGVwIGlzIHByb3ZpZGVkLCB0aGUgc3RlcCBzaXplIGlzIGNob3NlbiBhcyBjbG9zZSBhcyBwb3NzaWJsZQogICAqIHRvIHRoZSBtaW5pbXVtU3RlcCBidXQgbGFyZ2VyIHRoYW4gbWluaW11bVN0ZXAuIElmIG1pbmltdW1TdGVwIGlzIG5vdAogICAqIHByb3ZpZGVkLCB0aGUgc2NhbGUgaXMgc2V0IHRvIDEgREFZLgogICAqIFRoZSBtaW5pbXVtU3RlcCBzaG91bGQgY29ycmVzcG9uZCB3aXRoIHRoZSBvbnNjcmVlbiBzaXplIG9mIGFib3V0IDYgY2hhcmFjdGVycwogICAqIEBwYXJhbSB7RGF0ZX0gW3N0YXJ0XSAgICAgIFRoZSBzdGFydCBkYXRlIGFuZCB0aW1lLgogICAqIEBwYXJhbSB7RGF0ZX0gW2VuZF0gICAgICAgIFRoZSBlbmQgZGF0ZSBhbmQgdGltZS4KICAgKiBAcGFyYW0ge2ludH0gW21pbmltdW1TdGVwXSBPcHRpb25hbC4gTWluaW11bSBzdGVwIHNpemUgaW4gbWlsbGlzZWNvbmRzCiAgICovCiAgVGltZVN0ZXAucHJvdG90eXBlLnNldFJhbmdlID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIG1pbmltdW1TdGVwKSB7CiAgICBpZiAoIShzdGFydCBpbnN0YW5jZW9mIERhdGUpIHx8ICEoZW5kIGluc3RhbmNlb2YgRGF0ZSkpIHsKICAgICAgdGhyb3cgJ05vIGxlZ2FsIHN0YXJ0IG9yIGVuZCBkYXRlIGluIG1ldGhvZCBzZXRSYW5nZSc7CiAgICB9CgogICAgdGhpcy5fc3RhcnQgPSBzdGFydCAhPSB1bmRlZmluZWQgPyBuZXcgRGF0ZShzdGFydC52YWx1ZU9mKCkpIDogbmV3IERhdGUoKTsKICAgIHRoaXMuX2VuZCA9IGVuZCAhPSB1bmRlZmluZWQgPyBuZXcgRGF0ZShlbmQudmFsdWVPZigpKSA6IG5ldyBEYXRlKCk7CgogICAgaWYgKHRoaXMuYXV0b1NjYWxlKSB7CiAgICAgIHRoaXMuc2V0TWluaW11bVN0ZXAobWluaW11bVN0ZXApOwogICAgfQogIH07CgogIC8qKgogICAqIFNldCB0aGUgcmFuZ2UgaXRlcmF0b3IgdG8gdGhlIHN0YXJ0IGRhdGUuCiAgICovCiAgVGltZVN0ZXAucHJvdG90eXBlLmZpcnN0ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5jdXJyZW50ID0gbmV3IERhdGUodGhpcy5fc3RhcnQudmFsdWVPZigpKTsKICAgIHRoaXMucm91bmRUb01pbm9yKCk7CiAgfTsKCiAgLyoqCiAgICogUm91bmQgdGhlIGN1cnJlbnQgZGF0ZSB0byB0aGUgZmlyc3QgbWlub3IgZGF0ZSB2YWx1ZQogICAqIFRoaXMgbXVzdCBiZSBleGVjdXRlZCBvbmNlIHdoZW4gdGhlIGN1cnJlbnQgZGF0ZSBpcyBzZXQgdG8gc3RhcnQgRGF0ZQogICAqLwogIFRpbWVTdGVwLnByb3RvdHlwZS5yb3VuZFRvTWlub3IgPSBmdW5jdGlvbiAoKSB7CiAgICAvLyByb3VuZCB0byBmbG9vcgogICAgLy8gSU1QT1JUQU5UOiB3ZSBoYXZlIG5vIGJyZWFrcyBpbiB0aGlzIHN3aXRjaCEgKHRoaXMgaXMgbm8gYnVnKQogICAgLy8gbm9pbnNwZWN0aW9uIEZhbGxUaHJvdWdoSW5Td2l0Y2hTdGF0ZW1lbnRKUwogICAgc3dpdGNoICh0aGlzLnNjYWxlKSB7CiAgICAgIGNhc2UgJ3llYXInOgogICAgICAgIHRoaXMuY3VycmVudC5zZXRGdWxsWWVhcih0aGlzLnN0ZXAgKiBNYXRoLmZsb29yKHRoaXMuY3VycmVudC5nZXRGdWxsWWVhcigpIC8gdGhpcy5zdGVwKSk7CiAgICAgICAgdGhpcy5jdXJyZW50LnNldE1vbnRoKDApOwogICAgICBjYXNlICdtb250aCc6CiAgICAgICAgdGhpcy5jdXJyZW50LnNldERhdGUoMSk7CiAgICAgIGNhc2UgJ2RheSc6IC8vIGludGVudGlvbmFsIGZhbGwgdGhyb3VnaAogICAgICBjYXNlICd3ZWVrZGF5JzoKICAgICAgICB0aGlzLmN1cnJlbnQuc2V0SG91cnMoMCk7CiAgICAgIGNhc2UgJ2hvdXInOgogICAgICAgIHRoaXMuY3VycmVudC5zZXRNaW51dGVzKDApOwogICAgICBjYXNlICdtaW51dGUnOgogICAgICAgIHRoaXMuY3VycmVudC5zZXRTZWNvbmRzKDApOwogICAgICBjYXNlICdzZWNvbmQnOgogICAgICAgIHRoaXMuY3VycmVudC5zZXRNaWxsaXNlY29uZHMoMCk7CiAgICAgICAgLy9jYXNlICdtaWxsaXNlY29uZCc6IC8vIG5vdGhpbmcgdG8gZG8gZm9yIG1pbGxpc2Vjb25kcwogICAgfQoKICAgIGlmICh0aGlzLnN0ZXAgIT0gMSkgewogICAgICAvLyByb3VuZCBkb3duIHRvIHRoZSBmaXJzdCBtaW5vciB2YWx1ZSB0aGF0IGlzIGEgbXVsdGlwbGUgb2YgdGhlIGN1cnJlbnQgc3RlcCBzaXplCiAgICAgIHN3aXRjaCAodGhpcy5zY2FsZSkgewogICAgICAgIGNhc2UgJ21pbGxpc2Vjb25kJzoKICAgICAgICAgIHRoaXMuY3VycmVudC5zZXRNaWxsaXNlY29uZHModGhpcy5jdXJyZW50LmdldE1pbGxpc2Vjb25kcygpIC0gdGhpcy5jdXJyZW50LmdldE1pbGxpc2Vjb25kcygpICUgdGhpcy5zdGVwKTticmVhazsKICAgICAgICBjYXNlICdzZWNvbmQnOgogICAgICAgICAgdGhpcy5jdXJyZW50LnNldFNlY29uZHModGhpcy5jdXJyZW50LmdldFNlY29uZHMoKSAtIHRoaXMuY3VycmVudC5nZXRTZWNvbmRzKCkgJSB0aGlzLnN0ZXApO2JyZWFrOwogICAgICAgIGNhc2UgJ21pbnV0ZSc6CiAgICAgICAgICB0aGlzLmN1cnJlbnQuc2V0TWludXRlcyh0aGlzLmN1cnJlbnQuZ2V0TWludXRlcygpIC0gdGhpcy5jdXJyZW50LmdldE1pbnV0ZXMoKSAlIHRoaXMuc3RlcCk7YnJlYWs7CiAgICAgICAgY2FzZSAnaG91cic6CiAgICAgICAgICB0aGlzLmN1cnJlbnQuc2V0SG91cnModGhpcy5jdXJyZW50LmdldEhvdXJzKCkgLSB0aGlzLmN1cnJlbnQuZ2V0SG91cnMoKSAlIHRoaXMuc3RlcCk7YnJlYWs7CiAgICAgICAgY2FzZSAnd2Vla2RheSc6IC8vIGludGVudGlvbmFsIGZhbGwgdGhyb3VnaAogICAgICAgIGNhc2UgJ2RheSc6CiAgICAgICAgICB0aGlzLmN1cnJlbnQuc2V0RGF0ZSh0aGlzLmN1cnJlbnQuZ2V0RGF0ZSgpIC0gMSAtICh0aGlzLmN1cnJlbnQuZ2V0RGF0ZSgpIC0gMSkgJSB0aGlzLnN0ZXAgKyAxKTticmVhazsKICAgICAgICBjYXNlICdtb250aCc6CiAgICAgICAgICB0aGlzLmN1cnJlbnQuc2V0TW9udGgodGhpcy5jdXJyZW50LmdldE1vbnRoKCkgLSB0aGlzLmN1cnJlbnQuZ2V0TW9udGgoKSAlIHRoaXMuc3RlcCk7YnJlYWs7CiAgICAgICAgY2FzZSAneWVhcic6CiAgICAgICAgICB0aGlzLmN1cnJlbnQuc2V0RnVsbFllYXIodGhpcy5jdXJyZW50LmdldEZ1bGxZZWFyKCkgLSB0aGlzLmN1cnJlbnQuZ2V0RnVsbFllYXIoKSAlIHRoaXMuc3RlcCk7YnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIHRoZXJlIGlzIGEgbmV4dCBzdGVwCiAgICogQHJldHVybiB7Ym9vbGVhbn0gIHRydWUgaWYgdGhlIGN1cnJlbnQgZGF0ZSBoYXMgbm90IHBhc3NlZCB0aGUgZW5kIGRhdGUKICAgKi8KICBUaW1lU3RlcC5wcm90b3R5cGUuaGFzTmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmN1cnJlbnQudmFsdWVPZigpIDw9IHRoaXMuX2VuZC52YWx1ZU9mKCk7CiAgfTsKCiAgLyoqCiAgICogRG8gdGhlIG5leHQgc3RlcAogICAqLwogIFRpbWVTdGVwLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHByZXYgPSB0aGlzLmN1cnJlbnQudmFsdWVPZigpOwoKICAgIC8vIFR3byBjYXNlcywgbmVlZGVkIHRvIHByZXZlbnQgaXNzdWVzIHdpdGggc3dpdGNoaW5nIGRheWxpZ2h0IHNhdmluZ3MKICAgIC8vIChlbmQgb2YgTWFyY2ggYW5kIGVuZCBvZiBPY3RvYmVyKQogICAgaWYgKHRoaXMuY3VycmVudC5nZXRNb250aCgpIDwgNikgewogICAgICBzd2l0Y2ggKHRoaXMuc2NhbGUpIHsKICAgICAgICBjYXNlICdtaWxsaXNlY29uZCc6CgogICAgICAgICAgdGhpcy5jdXJyZW50ID0gbmV3IERhdGUodGhpcy5jdXJyZW50LnZhbHVlT2YoKSArIHRoaXMuc3RlcCk7YnJlYWs7CiAgICAgICAgY2FzZSAnc2Vjb25kJzoKICAgICAgICAgIHRoaXMuY3VycmVudCA9IG5ldyBEYXRlKHRoaXMuY3VycmVudC52YWx1ZU9mKCkgKyB0aGlzLnN0ZXAgKiAxMDAwKTticmVhazsKICAgICAgICBjYXNlICdtaW51dGUnOgogICAgICAgICAgdGhpcy5jdXJyZW50ID0gbmV3IERhdGUodGhpcy5jdXJyZW50LnZhbHVlT2YoKSArIHRoaXMuc3RlcCAqIDEwMDAgKiA2MCk7YnJlYWs7CiAgICAgICAgY2FzZSAnaG91cic6CiAgICAgICAgICB0aGlzLmN1cnJlbnQgPSBuZXcgRGF0ZSh0aGlzLmN1cnJlbnQudmFsdWVPZigpICsgdGhpcy5zdGVwICogMTAwMCAqIDYwICogNjApOwogICAgICAgICAgLy8gaW4gY2FzZSBvZiBza2lwcGluZyBhbiBob3VyIGZvciBkYXlsaWdodCBzYXZpbmdzLCBhZGp1c3QgdGhlIGhvdXIgYWdhaW4gKGVsc2UgeW91IGdldDogMGggNWggOWggLi4uIGluc3RlYWQgb2YgMGggNGggOGggLi4uKQogICAgICAgICAgdmFyIGggPSB0aGlzLmN1cnJlbnQuZ2V0SG91cnMoKTsKICAgICAgICAgIHRoaXMuY3VycmVudC5zZXRIb3VycyhoIC0gaCAlIHRoaXMuc3RlcCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICd3ZWVrZGF5JzogLy8gaW50ZW50aW9uYWwgZmFsbCB0aHJvdWdoCiAgICAgICAgY2FzZSAnZGF5JzoKICAgICAgICAgIHRoaXMuY3VycmVudC5zZXREYXRlKHRoaXMuY3VycmVudC5nZXREYXRlKCkgKyB0aGlzLnN0ZXApO2JyZWFrOwogICAgICAgIGNhc2UgJ21vbnRoJzoKICAgICAgICAgIHRoaXMuY3VycmVudC5zZXRNb250aCh0aGlzLmN1cnJlbnQuZ2V0TW9udGgoKSArIHRoaXMuc3RlcCk7YnJlYWs7CiAgICAgICAgY2FzZSAneWVhcic6CiAgICAgICAgICB0aGlzLmN1cnJlbnQuc2V0RnVsbFllYXIodGhpcy5jdXJyZW50LmdldEZ1bGxZZWFyKCkgKyB0aGlzLnN0ZXApO2JyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgc3dpdGNoICh0aGlzLnNjYWxlKSB7CiAgICAgICAgY2FzZSAnbWlsbGlzZWNvbmQnOgogICAgICAgICAgdGhpcy5jdXJyZW50ID0gbmV3IERhdGUodGhpcy5jdXJyZW50LnZhbHVlT2YoKSArIHRoaXMuc3RlcCk7YnJlYWs7CiAgICAgICAgY2FzZSAnc2Vjb25kJzoKICAgICAgICAgIHRoaXMuY3VycmVudC5zZXRTZWNvbmRzKHRoaXMuY3VycmVudC5nZXRTZWNvbmRzKCkgKyB0aGlzLnN0ZXApO2JyZWFrOwogICAgICAgIGNhc2UgJ21pbnV0ZSc6CiAgICAgICAgICB0aGlzLmN1cnJlbnQuc2V0TWludXRlcyh0aGlzLmN1cnJlbnQuZ2V0TWludXRlcygpICsgdGhpcy5zdGVwKTticmVhazsKICAgICAgICBjYXNlICdob3VyJzoKICAgICAgICAgIHRoaXMuY3VycmVudC5zZXRIb3Vycyh0aGlzLmN1cnJlbnQuZ2V0SG91cnMoKSArIHRoaXMuc3RlcCk7YnJlYWs7CiAgICAgICAgY2FzZSAnd2Vla2RheSc6IC8vIGludGVudGlvbmFsIGZhbGwgdGhyb3VnaAogICAgICAgIGNhc2UgJ2RheSc6CiAgICAgICAgICB0aGlzLmN1cnJlbnQuc2V0RGF0ZSh0aGlzLmN1cnJlbnQuZ2V0RGF0ZSgpICsgdGhpcy5zdGVwKTticmVhazsKICAgICAgICBjYXNlICdtb250aCc6CiAgICAgICAgICB0aGlzLmN1cnJlbnQuc2V0TW9udGgodGhpcy5jdXJyZW50LmdldE1vbnRoKCkgKyB0aGlzLnN0ZXApO2JyZWFrOwogICAgICAgIGNhc2UgJ3llYXInOgogICAgICAgICAgdGhpcy5jdXJyZW50LnNldEZ1bGxZZWFyKHRoaXMuY3VycmVudC5nZXRGdWxsWWVhcigpICsgdGhpcy5zdGVwKTticmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KCiAgICBpZiAodGhpcy5zdGVwICE9IDEpIHsKICAgICAgLy8gcm91bmQgZG93biB0byB0aGUgY29ycmVjdCBtYWpvciB2YWx1ZQogICAgICBzd2l0Y2ggKHRoaXMuc2NhbGUpIHsKICAgICAgICBjYXNlICdtaWxsaXNlY29uZCc6CiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50LmdldE1pbGxpc2Vjb25kcygpIDwgdGhpcy5zdGVwKSB0aGlzLmN1cnJlbnQuc2V0TWlsbGlzZWNvbmRzKDApO2JyZWFrOwogICAgICAgIGNhc2UgJ3NlY29uZCc6CiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50LmdldFNlY29uZHMoKSA8IHRoaXMuc3RlcCkgdGhpcy5jdXJyZW50LnNldFNlY29uZHMoMCk7YnJlYWs7CiAgICAgICAgY2FzZSAnbWludXRlJzoKICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQuZ2V0TWludXRlcygpIDwgdGhpcy5zdGVwKSB0aGlzLmN1cnJlbnQuc2V0TWludXRlcygwKTticmVhazsKICAgICAgICBjYXNlICdob3VyJzoKICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnQuZ2V0SG91cnMoKSA8IHRoaXMuc3RlcCkgdGhpcy5jdXJyZW50LnNldEhvdXJzKDApO2JyZWFrOwogICAgICAgIGNhc2UgJ3dlZWtkYXknOiAvLyBpbnRlbnRpb25hbCBmYWxsIHRocm91Z2gKICAgICAgICBjYXNlICdkYXknOgogICAgICAgICAgaWYgKHRoaXMuY3VycmVudC5nZXREYXRlKCkgPCB0aGlzLnN0ZXAgKyAxKSB0aGlzLmN1cnJlbnQuc2V0RGF0ZSgxKTticmVhazsKICAgICAgICBjYXNlICdtb250aCc6CiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50LmdldE1vbnRoKCkgPCB0aGlzLnN0ZXApIHRoaXMuY3VycmVudC5zZXRNb250aCgwKTticmVhazsKICAgICAgICBjYXNlICd5ZWFyJzoKICAgICAgICAgIGJyZWFrOyAvLyBub3RoaW5nIHRvIGRvIGZvciB5ZWFyCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CgogICAgLy8gc2FmZXR5IG1lY2hhbmlzbTogaWYgY3VycmVudCB0aW1lIGlzIHN0aWxsIHVuY2hhbmdlZCwgbW92ZSB0byB0aGUgZW5kCiAgICBpZiAodGhpcy5jdXJyZW50LnZhbHVlT2YoKSA9PSBwcmV2KSB7CiAgICAgIHRoaXMuY3VycmVudCA9IG5ldyBEYXRlKHRoaXMuX2VuZC52YWx1ZU9mKCkpOwogICAgfQoKICAgIERhdGVVdGlsLnN0ZXBPdmVySGlkZGVuRGF0ZXModGhpcywgcHJldik7CiAgfTsKCiAgLyoqCiAgICogR2V0IHRoZSBjdXJyZW50IGRhdGV0aW1lCiAgICogQHJldHVybiB7RGF0ZX0gIGN1cnJlbnQgVGhlIGN1cnJlbnQgZGF0ZQogICAqLwogIFRpbWVTdGVwLnByb3RvdHlwZS5nZXRDdXJyZW50ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuY3VycmVudDsKICB9OwoKICAvKioKICAgKiBTZXQgYSBjdXN0b20gc2NhbGUuIEF1dG9zY2FsaW5nIHdpbGwgYmUgZGlzYWJsZWQuCiAgICogRm9yIGV4YW1wbGUgc2V0U2NhbGUoJ21pbnV0ZScsIDUpIHdpbGwgcmVzdWx0CiAgICogaW4gbWlub3Igc3RlcHMgb2YgNSBtaW51dGVzLCBhbmQgbWFqb3Igc3RlcHMgb2YgYW4gaG91ci4KICAgKgogICAqIEBwYXJhbSB7e3NjYWxlOiBzdHJpbmcsIHN0ZXA6IG51bWJlcn19IHBhcmFtcwogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFuIG9iamVjdCBjb250YWluaW5nIHR3byBwcm9wZXJ0aWVzOgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0gQSBzdHJpbmcgJ3NjYWxlJy4gQ2hvb3NlIGZyb20gJ21pbGxpc2Vjb25kJywgJ3NlY29uZCcsCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWludXRlJywgJ2hvdXInLCAnd2Vla2RheScsICdkYXknLCAnbW9udGgnLCAneWVhcicuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBBIG51bWJlciAnc3RlcCcuIEEgc3RlcCBzaXplLCBieSBkZWZhdWx0IDEuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDaG9vc2UgZm9yIGV4YW1wbGUgMSwgMiwgNSwgb3IgMTAuCiAgICovCiAgVGltZVN0ZXAucHJvdG90eXBlLnNldFNjYWxlID0gZnVuY3Rpb24gKHBhcmFtcykgewogICAgaWYgKHBhcmFtcyAmJiB0eXBlb2YgcGFyYW1zLnNjYWxlID09ICdzdHJpbmcnKSB7CiAgICAgIHRoaXMuc2NhbGUgPSBwYXJhbXMuc2NhbGU7CiAgICAgIHRoaXMuc3RlcCA9IHBhcmFtcy5zdGVwID4gMCA/IHBhcmFtcy5zdGVwIDogMTsKICAgICAgdGhpcy5hdXRvU2NhbGUgPSBmYWxzZTsKICAgIH0KICB9OwoKICAvKioKICAgKiBFbmFibGUgb3IgZGlzYWJsZSBhdXRvc2NhbGluZwogICAqIEBwYXJhbSB7Ym9vbGVhbn0gZW5hYmxlICBJZiB0cnVlLCBhdXRvYXNjYWxpbmcgaXMgc2V0IHRydWUKICAgKi8KICBUaW1lU3RlcC5wcm90b3R5cGUuc2V0QXV0b1NjYWxlID0gZnVuY3Rpb24gKGVuYWJsZSkgewogICAgdGhpcy5hdXRvU2NhbGUgPSBlbmFibGU7CiAgfTsKCiAgLyoqCiAgICogQXV0b21hdGljYWxseSBkZXRlcm1pbmUgdGhlIHNjYWxlIHRoYXQgYmVzdHMgZml0cyB0aGUgcHJvdmlkZWQgbWluaW11bSBzdGVwCiAgICogQHBhcmFtIHtOdW1iZXJ9IFttaW5pbXVtU3RlcF0gIFRoZSBtaW5pbXVtIHN0ZXAgc2l6ZSBpbiBtaWxsaXNlY29uZHMKICAgKi8KICBUaW1lU3RlcC5wcm90b3R5cGUuc2V0TWluaW11bVN0ZXAgPSBmdW5jdGlvbiAobWluaW11bVN0ZXApIHsKICAgIGlmIChtaW5pbXVtU3RlcCA9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vdmFyIGIgPSBhc2MgKyBkczsKCiAgICB2YXIgc3RlcFllYXIgPSAxMDAwICogNjAgKiA2MCAqIDI0ICogMzAgKiAxMjsKICAgIHZhciBzdGVwTW9udGggPSAxMDAwICogNjAgKiA2MCAqIDI0ICogMzA7CiAgICB2YXIgc3RlcERheSA9IDEwMDAgKiA2MCAqIDYwICogMjQ7CiAgICB2YXIgc3RlcEhvdXIgPSAxMDAwICogNjAgKiA2MDsKICAgIHZhciBzdGVwTWludXRlID0gMTAwMCAqIDYwOwogICAgdmFyIHN0ZXBTZWNvbmQgPSAxMDAwOwogICAgdmFyIHN0ZXBNaWxsaXNlY29uZCA9IDE7CgogICAgLy8gZmluZCB0aGUgc21hbGxlc3Qgc3RlcCB0aGF0IGlzIGxhcmdlciB0aGFuIHRoZSBwcm92aWRlZCBtaW5pbXVtU3RlcAogICAgaWYgKHN0ZXBZZWFyICogMTAwMCA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAneWVhcic7dGhpcy5zdGVwID0gMTAwMDsKICAgIH0KICAgIGlmIChzdGVwWWVhciAqIDUwMCA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAneWVhcic7dGhpcy5zdGVwID0gNTAwOwogICAgfQogICAgaWYgKHN0ZXBZZWFyICogMTAwID4gbWluaW11bVN0ZXApIHsKICAgICAgdGhpcy5zY2FsZSA9ICd5ZWFyJzt0aGlzLnN0ZXAgPSAxMDA7CiAgICB9CiAgICBpZiAoc3RlcFllYXIgKiA1MCA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAneWVhcic7dGhpcy5zdGVwID0gNTA7CiAgICB9CiAgICBpZiAoc3RlcFllYXIgKiAxMCA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAneWVhcic7dGhpcy5zdGVwID0gMTA7CiAgICB9CiAgICBpZiAoc3RlcFllYXIgKiA1ID4gbWluaW11bVN0ZXApIHsKICAgICAgdGhpcy5zY2FsZSA9ICd5ZWFyJzt0aGlzLnN0ZXAgPSA1OwogICAgfQogICAgaWYgKHN0ZXBZZWFyID4gbWluaW11bVN0ZXApIHsKICAgICAgdGhpcy5zY2FsZSA9ICd5ZWFyJzt0aGlzLnN0ZXAgPSAxOwogICAgfQogICAgaWYgKHN0ZXBNb250aCAqIDMgPiBtaW5pbXVtU3RlcCkgewogICAgICB0aGlzLnNjYWxlID0gJ21vbnRoJzt0aGlzLnN0ZXAgPSAzOwogICAgfQogICAgaWYgKHN0ZXBNb250aCA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAnbW9udGgnO3RoaXMuc3RlcCA9IDE7CiAgICB9CiAgICBpZiAoc3RlcERheSAqIDUgPiBtaW5pbXVtU3RlcCkgewogICAgICB0aGlzLnNjYWxlID0gJ2RheSc7dGhpcy5zdGVwID0gNTsKICAgIH0KICAgIGlmIChzdGVwRGF5ICogMiA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAnZGF5Jzt0aGlzLnN0ZXAgPSAyOwogICAgfQogICAgaWYgKHN0ZXBEYXkgPiBtaW5pbXVtU3RlcCkgewogICAgICB0aGlzLnNjYWxlID0gJ2RheSc7dGhpcy5zdGVwID0gMTsKICAgIH0KICAgIGlmIChzdGVwRGF5IC8gMiA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAnd2Vla2RheSc7dGhpcy5zdGVwID0gMTsKICAgIH0KICAgIGlmIChzdGVwSG91ciAqIDQgPiBtaW5pbXVtU3RlcCkgewogICAgICB0aGlzLnNjYWxlID0gJ2hvdXInO3RoaXMuc3RlcCA9IDQ7CiAgICB9CiAgICBpZiAoc3RlcEhvdXIgPiBtaW5pbXVtU3RlcCkgewogICAgICB0aGlzLnNjYWxlID0gJ2hvdXInO3RoaXMuc3RlcCA9IDE7CiAgICB9CiAgICBpZiAoc3RlcE1pbnV0ZSAqIDE1ID4gbWluaW11bVN0ZXApIHsKICAgICAgdGhpcy5zY2FsZSA9ICdtaW51dGUnO3RoaXMuc3RlcCA9IDE1OwogICAgfQogICAgaWYgKHN0ZXBNaW51dGUgKiAxMCA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAnbWludXRlJzt0aGlzLnN0ZXAgPSAxMDsKICAgIH0KICAgIGlmIChzdGVwTWludXRlICogNSA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAnbWludXRlJzt0aGlzLnN0ZXAgPSA1OwogICAgfQogICAgaWYgKHN0ZXBNaW51dGUgPiBtaW5pbXVtU3RlcCkgewogICAgICB0aGlzLnNjYWxlID0gJ21pbnV0ZSc7dGhpcy5zdGVwID0gMTsKICAgIH0KICAgIGlmIChzdGVwU2Vjb25kICogMTUgPiBtaW5pbXVtU3RlcCkgewogICAgICB0aGlzLnNjYWxlID0gJ3NlY29uZCc7dGhpcy5zdGVwID0gMTU7CiAgICB9CiAgICBpZiAoc3RlcFNlY29uZCAqIDEwID4gbWluaW11bVN0ZXApIHsKICAgICAgdGhpcy5zY2FsZSA9ICdzZWNvbmQnO3RoaXMuc3RlcCA9IDEwOwogICAgfQogICAgaWYgKHN0ZXBTZWNvbmQgKiA1ID4gbWluaW11bVN0ZXApIHsKICAgICAgdGhpcy5zY2FsZSA9ICdzZWNvbmQnO3RoaXMuc3RlcCA9IDU7CiAgICB9CiAgICBpZiAoc3RlcFNlY29uZCA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAnc2Vjb25kJzt0aGlzLnN0ZXAgPSAxOwogICAgfQogICAgaWYgKHN0ZXBNaWxsaXNlY29uZCAqIDIwMCA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAnbWlsbGlzZWNvbmQnO3RoaXMuc3RlcCA9IDIwMDsKICAgIH0KICAgIGlmIChzdGVwTWlsbGlzZWNvbmQgKiAxMDAgPiBtaW5pbXVtU3RlcCkgewogICAgICB0aGlzLnNjYWxlID0gJ21pbGxpc2Vjb25kJzt0aGlzLnN0ZXAgPSAxMDA7CiAgICB9CiAgICBpZiAoc3RlcE1pbGxpc2Vjb25kICogNTAgPiBtaW5pbXVtU3RlcCkgewogICAgICB0aGlzLnNjYWxlID0gJ21pbGxpc2Vjb25kJzt0aGlzLnN0ZXAgPSA1MDsKICAgIH0KICAgIGlmIChzdGVwTWlsbGlzZWNvbmQgKiAxMCA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAnbWlsbGlzZWNvbmQnO3RoaXMuc3RlcCA9IDEwOwogICAgfQogICAgaWYgKHN0ZXBNaWxsaXNlY29uZCAqIDUgPiBtaW5pbXVtU3RlcCkgewogICAgICB0aGlzLnNjYWxlID0gJ21pbGxpc2Vjb25kJzt0aGlzLnN0ZXAgPSA1OwogICAgfQogICAgaWYgKHN0ZXBNaWxsaXNlY29uZCA+IG1pbmltdW1TdGVwKSB7CiAgICAgIHRoaXMuc2NhbGUgPSAnbWlsbGlzZWNvbmQnO3RoaXMuc3RlcCA9IDE7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU25hcCBhIGRhdGUgdG8gYSByb3VuZGVkIHZhbHVlLgogICAqIFRoZSBzbmFwIGludGVydmFscyBhcmUgZGVwZW5kZW50IG9uIHRoZSBjdXJyZW50IHNjYWxlIGFuZCBzdGVwLgogICAqIFN0YXRpYyBmdW5jdGlvbgogICAqIEBwYXJhbSB7RGF0ZX0gZGF0ZSAgICB0aGUgZGF0ZSB0byBiZSBzbmFwcGVkLgogICAqIEBwYXJhbSB7c3RyaW5nfSBzY2FsZSBDdXJyZW50IHNjYWxlLCBjYW4gYmUgJ21pbGxpc2Vjb25kJywgJ3NlY29uZCcsCiAgICogICAgICAgICAgICAgICAgICAgICAgICdtaW51dGUnLCAnaG91cicsICd3ZWVrZGF5LCAnZGF5JywgJ21vbnRoJywgJ3llYXInLgogICAqIEBwYXJhbSB7bnVtYmVyfSBzdGVwICBDdXJyZW50IHN0ZXAgKDEsIDIsIDQsIDUsIC4uLgogICAqIEByZXR1cm4ge0RhdGV9IHNuYXBwZWREYXRlCiAgICovCiAgVGltZVN0ZXAuc25hcCA9IGZ1bmN0aW9uIChkYXRlLCBzY2FsZSwgc3RlcCkgewogICAgdmFyIGNsb25lID0gbmV3IERhdGUoZGF0ZS52YWx1ZU9mKCkpOwoKICAgIGlmIChzY2FsZSA9PSAneWVhcicpIHsKICAgICAgdmFyIHllYXIgPSBjbG9uZS5nZXRGdWxsWWVhcigpICsgTWF0aC5yb3VuZChjbG9uZS5nZXRNb250aCgpIC8gMTIpOwogICAgICBjbG9uZS5zZXRGdWxsWWVhcihNYXRoLnJvdW5kKHllYXIgLyBzdGVwKSAqIHN0ZXApOwogICAgICBjbG9uZS5zZXRNb250aCgwKTsKICAgICAgY2xvbmUuc2V0RGF0ZSgwKTsKICAgICAgY2xvbmUuc2V0SG91cnMoMCk7CiAgICAgIGNsb25lLnNldE1pbnV0ZXMoMCk7CiAgICAgIGNsb25lLnNldFNlY29uZHMoMCk7CiAgICAgIGNsb25lLnNldE1pbGxpc2Vjb25kcygwKTsKICAgIH0gZWxzZSBpZiAoc2NhbGUgPT0gJ21vbnRoJykgewogICAgICBpZiAoY2xvbmUuZ2V0RGF0ZSgpID4gMTUpIHsKICAgICAgICBjbG9uZS5zZXREYXRlKDEpOwogICAgICAgIGNsb25lLnNldE1vbnRoKGNsb25lLmdldE1vbnRoKCkgKyAxKTsKICAgICAgICAvLyBpbXBvcnRhbnQ6IGZpcnN0IHNldCBEYXRlIHRvIDEsIGFmdGVyIHRoYXQgY2hhbmdlIHRoZSBtb250aC4KICAgICAgfSBlbHNlIHsKICAgICAgICBjbG9uZS5zZXREYXRlKDEpOwogICAgICB9CgogICAgICBjbG9uZS5zZXRIb3VycygwKTsKICAgICAgY2xvbmUuc2V0TWludXRlcygwKTsKICAgICAgY2xvbmUuc2V0U2Vjb25kcygwKTsKICAgICAgY2xvbmUuc2V0TWlsbGlzZWNvbmRzKDApOwogICAgfSBlbHNlIGlmIChzY2FsZSA9PSAnZGF5JykgewogICAgICAvL25vaW5zcGVjdGlvbiBGYWxsdGhyb3VnaEluU3dpdGNoU3RhdGVtZW50SlMKICAgICAgc3dpdGNoIChzdGVwKSB7CiAgICAgICAgY2FzZSA1OgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGNsb25lLnNldEhvdXJzKE1hdGgucm91bmQoY2xvbmUuZ2V0SG91cnMoKSAvIDI0KSAqIDI0KTticmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgY2xvbmUuc2V0SG91cnMoTWF0aC5yb3VuZChjbG9uZS5nZXRIb3VycygpIC8gMTIpICogMTIpO2JyZWFrOwogICAgICB9CiAgICAgIGNsb25lLnNldE1pbnV0ZXMoMCk7CiAgICAgIGNsb25lLnNldFNlY29uZHMoMCk7CiAgICAgIGNsb25lLnNldE1pbGxpc2Vjb25kcygwKTsKICAgIH0gZWxzZSBpZiAoc2NhbGUgPT0gJ3dlZWtkYXknKSB7CiAgICAgIC8vbm9pbnNwZWN0aW9uIEZhbGx0aHJvdWdoSW5Td2l0Y2hTdGF0ZW1lbnRKUwogICAgICBzd2l0Y2ggKHN0ZXApIHsKICAgICAgICBjYXNlIDU6CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgY2xvbmUuc2V0SG91cnMoTWF0aC5yb3VuZChjbG9uZS5nZXRIb3VycygpIC8gMTIpICogMTIpO2JyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBjbG9uZS5zZXRIb3VycyhNYXRoLnJvdW5kKGNsb25lLmdldEhvdXJzKCkgLyA2KSAqIDYpO2JyZWFrOwogICAgICB9CiAgICAgIGNsb25lLnNldE1pbnV0ZXMoMCk7CiAgICAgIGNsb25lLnNldFNlY29uZHMoMCk7CiAgICAgIGNsb25lLnNldE1pbGxpc2Vjb25kcygwKTsKICAgIH0gZWxzZSBpZiAoc2NhbGUgPT0gJ2hvdXInKSB7CiAgICAgIHN3aXRjaCAoc3RlcCkgewogICAgICAgIGNhc2UgNDoKICAgICAgICAgIGNsb25lLnNldE1pbnV0ZXMoTWF0aC5yb3VuZChjbG9uZS5nZXRNaW51dGVzKCkgLyA2MCkgKiA2MCk7YnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGNsb25lLnNldE1pbnV0ZXMoTWF0aC5yb3VuZChjbG9uZS5nZXRNaW51dGVzKCkgLyAzMCkgKiAzMCk7YnJlYWs7CiAgICAgIH0KICAgICAgY2xvbmUuc2V0U2Vjb25kcygwKTsKICAgICAgY2xvbmUuc2V0TWlsbGlzZWNvbmRzKDApOwogICAgfSBlbHNlIGlmIChzY2FsZSA9PSAnbWludXRlJykgewogICAgICAvL25vaW5zcGVjdGlvbiBGYWxsdGhyb3VnaEluU3dpdGNoU3RhdGVtZW50SlMKICAgICAgc3dpdGNoIChzdGVwKSB7CiAgICAgICAgY2FzZSAxNToKICAgICAgICBjYXNlIDEwOgogICAgICAgICAgY2xvbmUuc2V0TWludXRlcyhNYXRoLnJvdW5kKGNsb25lLmdldE1pbnV0ZXMoKSAvIDUpICogNSk7CiAgICAgICAgICBjbG9uZS5zZXRTZWNvbmRzKDApOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA1OgogICAgICAgICAgY2xvbmUuc2V0U2Vjb25kcyhNYXRoLnJvdW5kKGNsb25lLmdldFNlY29uZHMoKSAvIDYwKSAqIDYwKTticmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgY2xvbmUuc2V0U2Vjb25kcyhNYXRoLnJvdW5kKGNsb25lLmdldFNlY29uZHMoKSAvIDMwKSAqIDMwKTticmVhazsKICAgICAgfQogICAgICBjbG9uZS5zZXRNaWxsaXNlY29uZHMoMCk7CiAgICB9IGVsc2UgaWYgKHNjYWxlID09ICdzZWNvbmQnKSB7CiAgICAgIC8vbm9pbnNwZWN0aW9uIEZhbGx0aHJvdWdoSW5Td2l0Y2hTdGF0ZW1lbnRKUwogICAgICBzd2l0Y2ggKHN0ZXApIHsKICAgICAgICBjYXNlIDE1OgogICAgICAgIGNhc2UgMTA6CiAgICAgICAgICBjbG9uZS5zZXRTZWNvbmRzKE1hdGgucm91bmQoY2xvbmUuZ2V0U2Vjb25kcygpIC8gNSkgKiA1KTsKICAgICAgICAgIGNsb25lLnNldE1pbGxpc2Vjb25kcygwKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNToKICAgICAgICAgIGNsb25lLnNldE1pbGxpc2Vjb25kcyhNYXRoLnJvdW5kKGNsb25lLmdldE1pbGxpc2Vjb25kcygpIC8gMTAwMCkgKiAxMDAwKTticmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgY2xvbmUuc2V0TWlsbGlzZWNvbmRzKE1hdGgucm91bmQoY2xvbmUuZ2V0TWlsbGlzZWNvbmRzKCkgLyA1MDApICogNTAwKTticmVhazsKICAgICAgfQogICAgfSBlbHNlIGlmIChzY2FsZSA9PSAnbWlsbGlzZWNvbmQnKSB7CiAgICAgIHZhciBfc3RlcCA9IHN0ZXAgPiA1ID8gc3RlcCAvIDIgOiAxOwogICAgICBjbG9uZS5zZXRNaWxsaXNlY29uZHMoTWF0aC5yb3VuZChjbG9uZS5nZXRNaWxsaXNlY29uZHMoKSAvIF9zdGVwKSAqIF9zdGVwKTsKICAgIH0KCiAgICByZXR1cm4gY2xvbmU7CiAgfTsKCiAgLyoqCiAgICogQ2hlY2sgaWYgdGhlIGN1cnJlbnQgdmFsdWUgaXMgYSBtYWpvciB2YWx1ZSAoZm9yIGV4YW1wbGUgd2hlbiB0aGUgc3RlcAogICAqIGlzIERBWSwgYSBtYWpvciB2YWx1ZSBpcyBlYWNoIGZpcnN0IGRheSBvZiB0aGUgTU9OVEgpCiAgICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZSBpZiBjdXJyZW50IGRhdGUgaXMgbWFqb3IsIGVsc2UgZmFsc2UuCiAgICovCiAgVGltZVN0ZXAucHJvdG90eXBlLmlzTWFqb3IgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5zd2l0Y2hlZFllYXIgPT0gdHJ1ZSkgewogICAgICB0aGlzLnN3aXRjaGVkWWVhciA9IGZhbHNlOwogICAgICBzd2l0Y2ggKHRoaXMuc2NhbGUpIHsKICAgICAgICBjYXNlICd5ZWFyJzoKICAgICAgICBjYXNlICdtb250aCc6CiAgICAgICAgY2FzZSAnd2Vla2RheSc6CiAgICAgICAgY2FzZSAnZGF5JzoKICAgICAgICBjYXNlICdob3VyJzoKICAgICAgICBjYXNlICdtaW51dGUnOgogICAgICAgIGNhc2UgJ3NlY29uZCc6CiAgICAgICAgY2FzZSAnbWlsbGlzZWNvbmQnOgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSBlbHNlIGlmICh0aGlzLnN3aXRjaGVkTW9udGggPT0gdHJ1ZSkgewogICAgICB0aGlzLnN3aXRjaGVkTW9udGggPSBmYWxzZTsKICAgICAgc3dpdGNoICh0aGlzLnNjYWxlKSB7CiAgICAgICAgY2FzZSAnd2Vla2RheSc6CiAgICAgICAgY2FzZSAnZGF5JzoKICAgICAgICBjYXNlICdob3VyJzoKICAgICAgICBjYXNlICdtaW51dGUnOgogICAgICAgIGNhc2UgJ3NlY29uZCc6CiAgICAgICAgY2FzZSAnbWlsbGlzZWNvbmQnOgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSBlbHNlIGlmICh0aGlzLnN3aXRjaGVkRGF5ID09IHRydWUpIHsKICAgICAgdGhpcy5zd2l0Y2hlZERheSA9IGZhbHNlOwogICAgICBzd2l0Y2ggKHRoaXMuc2NhbGUpIHsKICAgICAgICBjYXNlICdtaWxsaXNlY29uZCc6CiAgICAgICAgY2FzZSAnc2Vjb25kJzoKICAgICAgICBjYXNlICdtaW51dGUnOgogICAgICAgIGNhc2UgJ2hvdXInOgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIHN3aXRjaCAodGhpcy5zY2FsZSkgewogICAgICBjYXNlICdtaWxsaXNlY29uZCc6CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudC5nZXRNaWxsaXNlY29uZHMoKSA9PSAwOwogICAgICBjYXNlICdzZWNvbmQnOgogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnQuZ2V0U2Vjb25kcygpID09IDA7CiAgICAgIGNhc2UgJ21pbnV0ZSc6CiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudC5nZXRIb3VycygpID09IDAgJiYgdGhpcy5jdXJyZW50LmdldE1pbnV0ZXMoKSA9PSAwOwogICAgICBjYXNlICdob3VyJzoKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50LmdldEhvdXJzKCkgPT0gMDsKICAgICAgY2FzZSAnd2Vla2RheSc6IC8vIGludGVudGlvbmFsIGZhbGwgdGhyb3VnaAogICAgICBjYXNlICdkYXknOgogICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnQuZ2V0RGF0ZSgpID09IDE7CiAgICAgIGNhc2UgJ21vbnRoJzoKICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50LmdldE1vbnRoKCkgPT0gMDsKICAgICAgY2FzZSAneWVhcic6CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9OwoKICAvKioKICAgKiBSZXR1cm5zIGZvcm1hdHRlZCB0ZXh0IGZvciB0aGUgbWlub3IgYXhpc2xhYmVsLCBkZXBlbmRpbmcgb24gdGhlIGN1cnJlbnQKICAgKiBkYXRlIGFuZCB0aGUgc2NhbGUuIEZvciBleGFtcGxlIHdoZW4gc2NhbGUgaXMgTUlOVVRFLCB0aGUgY3VycmVudCB0aW1lIGlzCiAgICogZm9ybWF0dGVkIGFzICJoaDptbSIuCiAgICogQHBhcmFtIHtEYXRlfSBbZGF0ZV0gY3VzdG9tIGRhdGUuIGlmIG5vdCBwcm92aWRlZCwgY3VycmVudCBkYXRlIGlzIHRha2VuCiAgICovCiAgVGltZVN0ZXAucHJvdG90eXBlLmdldExhYmVsTWlub3IgPSBmdW5jdGlvbiAoZGF0ZSkgewogICAgaWYgKGRhdGUgPT0gdW5kZWZpbmVkKSB7CiAgICAgIGRhdGUgPSB0aGlzLmN1cnJlbnQ7CiAgICB9CgogICAgdmFyIGZvcm1hdCA9IHRoaXMuZm9ybWF0Lm1pbm9yTGFiZWxzW3RoaXMuc2NhbGVdOwogICAgcmV0dXJuIGZvcm1hdCAmJiBmb3JtYXQubGVuZ3RoID4gMCA/IG1vbWVudChkYXRlKS5mb3JtYXQoZm9ybWF0KSA6ICcnOwogIH07CgogIC8qKgogICAqIFJldHVybnMgZm9ybWF0dGVkIHRleHQgZm9yIHRoZSBtYWpvciBheGlzIGxhYmVsLCBkZXBlbmRpbmcgb24gdGhlIGN1cnJlbnQKICAgKiBkYXRlIGFuZCB0aGUgc2NhbGUuIEZvciBleGFtcGxlIHdoZW4gc2NhbGUgaXMgTUlOVVRFLCB0aGUgbWFqb3Igc2NhbGUgaXMKICAgKiBob3VycywgYW5kIHRoZSBob3VyIHdpbGwgYmUgZm9ybWF0dGVkIGFzICJoaCIuCiAgICogQHBhcmFtIHtEYXRlfSBbZGF0ZV0gY3VzdG9tIGRhdGUuIGlmIG5vdCBwcm92aWRlZCwgY3VycmVudCBkYXRlIGlzIHRha2VuCiAgICovCiAgVGltZVN0ZXAucHJvdG90eXBlLmdldExhYmVsTWFqb3IgPSBmdW5jdGlvbiAoZGF0ZSkgewogICAgaWYgKGRhdGUgPT0gdW5kZWZpbmVkKSB7CiAgICAgIGRhdGUgPSB0aGlzLmN1cnJlbnQ7CiAgICB9CgogICAgdmFyIGZvcm1hdCA9IHRoaXMuZm9ybWF0Lm1ham9yTGFiZWxzW3RoaXMuc2NhbGVdOwogICAgcmV0dXJuIGZvcm1hdCAmJiBmb3JtYXQubGVuZ3RoID4gMCA/IG1vbWVudChkYXRlKS5mb3JtYXQoZm9ybWF0KSA6ICcnOwogIH07CgogIFRpbWVTdGVwLnByb3RvdHlwZS5nZXRDbGFzc05hbWUgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgbSA9IG1vbWVudCh0aGlzLmN1cnJlbnQpOwogICAgdmFyIGRhdGUgPSBtLmxvY2FsZSA/IG0ubG9jYWxlKCdlbicpIDogbS5sYW5nKCdlbicpOyAvLyBvbGQgdmVyc2lvbnMgb2YgbW9tZW50IGhhdmUgLmxhbmcoKSBmdW5jdGlvbgogICAgdmFyIHN0ZXAgPSB0aGlzLnN0ZXA7CgogICAgZnVuY3Rpb24gZXZlbih2YWx1ZSkgewogICAgICByZXR1cm4gdmFsdWUgLyBzdGVwICUgMiA9PSAwID8gJyB2aXMtZXZlbicgOiAnIHZpcy1vZGQnOwogICAgfQoKICAgIGZ1bmN0aW9uIHRvZGF5KGRhdGUpIHsKICAgICAgaWYgKGRhdGUuaXNTYW1lKG5ldyBEYXRlKCksICdkYXknKSkgewogICAgICAgIHJldHVybiAnIHZpcy10b2RheSc7CiAgICAgIH0KICAgICAgaWYgKGRhdGUuaXNTYW1lKG1vbWVudCgpLmFkZCgxLCAnZGF5JyksICdkYXknKSkgewogICAgICAgIHJldHVybiAnIHZpcy10b21vcnJvdyc7CiAgICAgIH0KICAgICAgaWYgKGRhdGUuaXNTYW1lKG1vbWVudCgpLmFkZCgtMSwgJ2RheScpLCAnZGF5JykpIHsKICAgICAgICByZXR1cm4gJyB2aXMteWVzdGVyZGF5JzsKICAgICAgfQogICAgICByZXR1cm4gJyc7CiAgICB9CgogICAgZnVuY3Rpb24gY3VycmVudFdlZWsoZGF0ZSkgewogICAgICByZXR1cm4gZGF0ZS5pc1NhbWUobmV3IERhdGUoKSwgJ3dlZWsnKSA/ICcgdmlzLWN1cnJlbnQtd2VlaycgOiAnJzsKICAgIH0KCiAgICBmdW5jdGlvbiBjdXJyZW50TW9udGgoZGF0ZSkgewogICAgICByZXR1cm4gZGF0ZS5pc1NhbWUobmV3IERhdGUoKSwgJ21vbnRoJykgPyAnIHZpcy1jdXJyZW50LW1vbnRoJyA6ICcnOwogICAgfQoKICAgIGZ1bmN0aW9uIGN1cnJlbnRZZWFyKGRhdGUpIHsKICAgICAgcmV0dXJuIGRhdGUuaXNTYW1lKG5ldyBEYXRlKCksICd5ZWFyJykgPyAnIHZpcy1jdXJyZW50LXllYXInIDogJyc7CiAgICB9CgogICAgc3dpdGNoICh0aGlzLnNjYWxlKSB7CiAgICAgIGNhc2UgJ21pbGxpc2Vjb25kJzoKICAgICAgICByZXR1cm4gZXZlbihkYXRlLm1pbGxpc2Vjb25kcygpKS50cmltKCk7CgogICAgICBjYXNlICdzZWNvbmQnOgogICAgICAgIHJldHVybiBldmVuKGRhdGUuc2Vjb25kcygpKS50cmltKCk7CgogICAgICBjYXNlICdtaW51dGUnOgogICAgICAgIHJldHVybiBldmVuKGRhdGUubWludXRlcygpKS50cmltKCk7CgogICAgICBjYXNlICdob3VyJzoKICAgICAgICB2YXIgaG91cnMgPSBkYXRlLmhvdXJzKCk7CiAgICAgICAgaWYgKHRoaXMuc3RlcCA9PSA0KSB7CiAgICAgICAgICBob3VycyA9IGhvdXJzICsgJy1oJyArIChob3VycyArIDQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJ3Zpcy1oJyArIGhvdXJzICsgdG9kYXkoZGF0ZSkgKyBldmVuKGRhdGUuaG91cnMoKSk7CgogICAgICBjYXNlICd3ZWVrZGF5JzoKICAgICAgICByZXR1cm4gJ3Zpcy0nICsgZGF0ZS5mb3JtYXQoJ2RkZGQnKS50b0xvd2VyQ2FzZSgpICsgdG9kYXkoZGF0ZSkgKyBjdXJyZW50V2VlayhkYXRlKSArIGV2ZW4oZGF0ZS5kYXRlKCkpOwoKICAgICAgY2FzZSAnZGF5JzoKICAgICAgICB2YXIgZGF5ID0gZGF0ZS5kYXRlKCk7CiAgICAgICAgdmFyIG1vbnRoID0gZGF0ZS5mb3JtYXQoJ01NTU0nKS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHJldHVybiAndmlzLWRheScgKyBkYXkgKyAnIHZpcy0nICsgbW9udGggKyBjdXJyZW50TW9udGgoZGF0ZSkgKyBldmVuKGRheSAtIDEpOwoKICAgICAgY2FzZSAnbW9udGgnOgogICAgICAgIHJldHVybiAndmlzLScgKyBkYXRlLmZvcm1hdCgnTU1NTScpLnRvTG93ZXJDYXNlKCkgKyBjdXJyZW50TW9udGgoZGF0ZSkgKyBldmVuKGRhdGUubW9udGgoKSk7CgogICAgICBjYXNlICd5ZWFyJzoKICAgICAgICB2YXIgeWVhciA9IGRhdGUueWVhcigpOwogICAgICAgIHJldHVybiAndmlzLXllYXInICsgeWVhciArIGN1cnJlbnRZZWFyKGRhdGUpICsgZXZlbih5ZWFyKTsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuICcnOwogICAgfQogIH07CgogIG1vZHVsZS5leHBvcnRzID0gVGltZVN0ZXA7CgovKioqLyB9LAovKiAzNyAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CiAgdmFyIEdyb3VwID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMik7CgogIC8qKgogICAqIEBjb25zdHJ1Y3RvciBCYWNrZ3JvdW5kR3JvdXAKICAgKiBAcGFyYW0ge051bWJlciB8IFN0cmluZ30gZ3JvdXBJZAogICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhCiAgICogQHBhcmFtIHtJdGVtU2V0fSBpdGVtU2V0CiAgICovCiAgZnVuY3Rpb24gQmFja2dyb3VuZEdyb3VwKGdyb3VwSWQsIGRhdGEsIGl0ZW1TZXQpIHsKICAgIEdyb3VwLmNhbGwodGhpcywgZ3JvdXBJZCwgZGF0YSwgaXRlbVNldCk7CgogICAgdGhpcy53aWR0aCA9IDA7CiAgICB0aGlzLmhlaWdodCA9IDA7CiAgICB0aGlzLnRvcCA9IDA7CiAgICB0aGlzLmxlZnQgPSAwOwogIH0KCiAgQmFja2dyb3VuZEdyb3VwLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoR3JvdXAucHJvdG90eXBlKTsKCiAgLyoqCiAgICogUmVwYWludCB0aGlzIGdyb3VwCiAgICogQHBhcmFtIHt7c3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXJ9fSByYW5nZQogICAqIEBwYXJhbSB7e2l0ZW06IHtob3Jpem9udGFsOiBudW1iZXIsIHZlcnRpY2FsOiBudW1iZXJ9LCBheGlzOiBudW1iZXJ9fSBtYXJnaW4KICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtyZXN0YWNrPWZhbHNlXSAgRm9yY2UgcmVzdGFja2luZyBvZiBhbGwgaXRlbXMKICAgKiBAcmV0dXJuIHtib29sZWFufSBSZXR1cm5zIHRydWUgaWYgdGhlIGdyb3VwIGlzIHJlc2l6ZWQKICAgKi8KICBCYWNrZ3JvdW5kR3JvdXAucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uIChyYW5nZSwgbWFyZ2luLCByZXN0YWNrKSB7CiAgICB2YXIgcmVzaXplZCA9IGZhbHNlOwoKICAgIHRoaXMudmlzaWJsZUl0ZW1zID0gdGhpcy5fdXBkYXRlVmlzaWJsZUl0ZW1zKHRoaXMub3JkZXJlZEl0ZW1zLCB0aGlzLnZpc2libGVJdGVtcywgcmFuZ2UpOwoKICAgIC8vIGNhbGN1bGF0ZSBhY3R1YWwgc2l6ZQogICAgdGhpcy53aWR0aCA9IHRoaXMuZG9tLmJhY2tncm91bmQub2Zmc2V0V2lkdGg7CgogICAgLy8gYXBwbHkgbmV3IGhlaWdodCAoanVzdCBhbHdheXMgemVybyBmb3IgQmFja2dyb3VuZEdyb3VwCiAgICB0aGlzLmRvbS5iYWNrZ3JvdW5kLnN0eWxlLmhlaWdodCA9ICcwJzsKCiAgICAvLyB1cGRhdGUgdmVydGljYWwgcG9zaXRpb24gb2YgaXRlbXMgYWZ0ZXIgdGhleSBhcmUgcmUtc3RhY2tlZCBhbmQgdGhlIGhlaWdodCBvZiB0aGUgZ3JvdXAgaXMgY2FsY3VsYXRlZAogICAgZm9yICh2YXIgaSA9IDAsIGlpID0gdGhpcy52aXNpYmxlSXRlbXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICB2YXIgaXRlbSA9IHRoaXMudmlzaWJsZUl0ZW1zW2ldOwogICAgICBpdGVtLnJlcG9zaXRpb25ZKG1hcmdpbik7CiAgICB9CgogICAgcmV0dXJuIHJlc2l6ZWQ7CiAgfTsKCiAgLyoqCiAgICogU2hvdyB0aGlzIGdyb3VwOiBhdHRhY2ggdG8gdGhlIERPTQogICAqLwogIEJhY2tncm91bmRHcm91cC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5kb20uYmFja2dyb3VuZC5wYXJlbnROb2RlKSB7CiAgICAgIHRoaXMuaXRlbVNldC5kb20uYmFja2dyb3VuZC5hcHBlbmRDaGlsZCh0aGlzLmRvbS5iYWNrZ3JvdW5kKTsKICAgIH0KICB9OwoKICBtb2R1bGUuZXhwb3J0cyA9IEJhY2tncm91bmRHcm91cDsKCi8qKiovIH0sCi8qIDM4ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciBJdGVtID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNSk7CiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICAvKioKICAgKiBAY29uc3RydWN0b3IgQm94SXRlbQogICAqIEBleHRlbmRzIEl0ZW0KICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSAgICAgICAgICAgICBPYmplY3QgY29udGFpbmluZyBwYXJhbWV0ZXJzIHN0YXJ0CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCwgY2xhc3NOYW1lLgogICAqIEBwYXJhbSB7e3RvU2NyZWVuOiBmdW5jdGlvbiwgdG9UaW1lOiBmdW5jdGlvbn19IGNvbnZlcnNpb24KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb252ZXJzaW9uIGZ1bmN0aW9ucyBmcm9tIHRpbWUgdG8gc2NyZWVuIGFuZCB2aWNlIHZlcnNhCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgICAgICAgQ29uZmlndXJhdGlvbiBvcHRpb25zCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogZGVzY3JpYmUgYXZhaWxhYmxlIG9wdGlvbnMKICAgKi8KICBmdW5jdGlvbiBCb3hJdGVtKGRhdGEsIGNvbnZlcnNpb24sIG9wdGlvbnMpIHsKICAgIHRoaXMucHJvcHMgPSB7CiAgICAgIGRvdDogewogICAgICAgIHdpZHRoOiAwLAogICAgICAgIGhlaWdodDogMAogICAgICB9LAogICAgICBsaW5lOiB7CiAgICAgICAgd2lkdGg6IDAsCiAgICAgICAgaGVpZ2h0OiAwCiAgICAgIH0KICAgIH07CgogICAgLy8gdmFsaWRhdGUgZGF0YQogICAgaWYgKGRhdGEpIHsKICAgICAgaWYgKGRhdGEuc3RhcnQgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQcm9wZXJ0eSAic3RhcnQiIG1pc3NpbmcgaW4gaXRlbSAnICsgZGF0YSk7CiAgICAgIH0KICAgIH0KCiAgICBJdGVtLmNhbGwodGhpcywgZGF0YSwgY29udmVyc2lvbiwgb3B0aW9ucyk7CiAgfQoKICBCb3hJdGVtLnByb3RvdHlwZSA9IG5ldyBJdGVtKG51bGwsIG51bGwsIG51bGwpOwoKICAvKioKICAgKiBDaGVjayB3aGV0aGVyIHRoaXMgaXRlbSBpcyB2aXNpYmxlIGluc2lkZSBnaXZlbiByYW5nZQogICAqIEByZXR1cm5zIHt7c3RhcnQ6IE51bWJlciwgZW5kOiBOdW1iZXJ9fSByYW5nZSB3aXRoIGEgdGltZXN0YW1wIGZvciBzdGFydCBhbmQgZW5kCiAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdmlzaWJsZQogICAqLwogIEJveEl0ZW0ucHJvdG90eXBlLmlzVmlzaWJsZSA9IGZ1bmN0aW9uIChyYW5nZSkgewogICAgLy8gZGV0ZXJtaW5lIHZpc2liaWxpdHkKICAgIC8vIFRPRE86IGFjY291bnQgZm9yIHRoZSByZWFsIHdpZHRoIG9mIHRoZSBpdGVtLiBSaWdodCBub3cgd2UganVzdCBhZGQgMS80IHRvIHRoZSB3aW5kb3cKICAgIHZhciBpbnRlcnZhbCA9IChyYW5nZS5lbmQgLSByYW5nZS5zdGFydCkgLyA0OwogICAgcmV0dXJuIHRoaXMuZGF0YS5zdGFydCA+IHJhbmdlLnN0YXJ0IC0gaW50ZXJ2YWwgJiYgdGhpcy5kYXRhLnN0YXJ0IDwgcmFuZ2UuZW5kICsgaW50ZXJ2YWw7CiAgfTsKCiAgLyoqCiAgICogUmVwYWludCB0aGUgaXRlbQogICAqLwogIEJveEl0ZW0ucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBkb20gPSB0aGlzLmRvbTsKICAgIGlmICghZG9tKSB7CiAgICAgIC8vIGNyZWF0ZSBET00KICAgICAgdGhpcy5kb20gPSB7fTsKICAgICAgZG9tID0gdGhpcy5kb207CgogICAgICAvLyBjcmVhdGUgbWFpbiBib3gKICAgICAgZG9tLmJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0RJVicpOwoKICAgICAgLy8gY29udGVudHMgYm94IChpbnNpZGUgdGhlIGJhY2tncm91bmQgYm94KS4gdXNlZCBmb3IgbWFraW5nIG1hcmdpbnMKICAgICAgZG9tLmNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdESVYnKTsKICAgICAgZG9tLmNvbnRlbnQuY2xhc3NOYW1lID0gJ3Zpcy1pdGVtLWNvbnRlbnQnOwogICAgICBkb20uYm94LmFwcGVuZENoaWxkKGRvbS5jb250ZW50KTsKCiAgICAgIC8vIGxpbmUgdG8gYXhpcwogICAgICBkb20ubGluZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0RJVicpOwogICAgICBkb20ubGluZS5jbGFzc05hbWUgPSAndmlzLWxpbmUnOwoKICAgICAgLy8gZG90IG9uIGF4aXMKICAgICAgZG9tLmRvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0RJVicpOwogICAgICBkb20uZG90LmNsYXNzTmFtZSA9ICd2aXMtZG90JzsKCiAgICAgIC8vIGF0dGFjaCB0aGlzIGl0ZW0gYXMgYXR0cmlidXRlCiAgICAgIGRvbS5ib3hbJ3RpbWVsaW5lLWl0ZW0nXSA9IHRoaXM7CgogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBhcHBlbmQgRE9NIHRvIHBhcmVudCBET00KICAgIGlmICghdGhpcy5wYXJlbnQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgcmVkcmF3IGl0ZW06IG5vIHBhcmVudCBhdHRhY2hlZCcpOwogICAgfQogICAgaWYgKCFkb20uYm94LnBhcmVudE5vZGUpIHsKICAgICAgdmFyIGZvcmVncm91bmQgPSB0aGlzLnBhcmVudC5kb20uZm9yZWdyb3VuZDsKICAgICAgaWYgKCFmb3JlZ3JvdW5kKSB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCByZWRyYXcgaXRlbTogcGFyZW50IGhhcyBubyBmb3JlZ3JvdW5kIGNvbnRhaW5lciBlbGVtZW50Jyk7CiAgICAgIGZvcmVncm91bmQuYXBwZW5kQ2hpbGQoZG9tLmJveCk7CiAgICB9CiAgICBpZiAoIWRvbS5saW5lLnBhcmVudE5vZGUpIHsKICAgICAgdmFyIGJhY2tncm91bmQgPSB0aGlzLnBhcmVudC5kb20uYmFja2dyb3VuZDsKICAgICAgaWYgKCFiYWNrZ3JvdW5kKSB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCByZWRyYXcgaXRlbTogcGFyZW50IGhhcyBubyBiYWNrZ3JvdW5kIGNvbnRhaW5lciBlbGVtZW50Jyk7CiAgICAgIGJhY2tncm91bmQuYXBwZW5kQ2hpbGQoZG9tLmxpbmUpOwogICAgfQogICAgaWYgKCFkb20uZG90LnBhcmVudE5vZGUpIHsKICAgICAgdmFyIGF4aXMgPSB0aGlzLnBhcmVudC5kb20uYXhpczsKICAgICAgaWYgKCFiYWNrZ3JvdW5kKSB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCByZWRyYXcgaXRlbTogcGFyZW50IGhhcyBubyBheGlzIGNvbnRhaW5lciBlbGVtZW50Jyk7CiAgICAgIGF4aXMuYXBwZW5kQ2hpbGQoZG9tLmRvdCk7CiAgICB9CiAgICB0aGlzLmRpc3BsYXllZCA9IHRydWU7CgogICAgLy8gVXBkYXRlIERPTSB3aGVuIGl0ZW0gaXMgbWFya2VkIGRpcnR5LiBBbiBpdGVtIGlzIG1hcmtlZCBkaXJ0eSB3aGVuOgogICAgLy8gLSB0aGUgaXRlbSBpcyBub3QgeWV0IHJlbmRlcmVkCiAgICAvLyAtIHRoZSBpdGVtJ3MgZGF0YSBpcyBjaGFuZ2VkCiAgICAvLyAtIHRoZSBpdGVtIGlzIHNlbGVjdGVkL2Rlc2VsZWN0ZWQKICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgIHRoaXMuX3VwZGF0ZUNvbnRlbnRzKHRoaXMuZG9tLmNvbnRlbnQpOwogICAgICB0aGlzLl91cGRhdGVUaXRsZSh0aGlzLmRvbS5ib3gpOwogICAgICB0aGlzLl91cGRhdGVEYXRhQXR0cmlidXRlcyh0aGlzLmRvbS5ib3gpOwogICAgICB0aGlzLl91cGRhdGVTdHlsZSh0aGlzLmRvbS5ib3gpOwoKICAgICAgdmFyIGVkaXRhYmxlID0gKHRoaXMub3B0aW9ucy5lZGl0YWJsZS51cGRhdGVUaW1lIHx8IHRoaXMub3B0aW9ucy5lZGl0YWJsZS51cGRhdGVHcm91cCB8fCB0aGlzLmVkaXRhYmxlID09PSB0cnVlKSAmJiB0aGlzLmVkaXRhYmxlICE9PSBmYWxzZTsKCiAgICAgIC8vIHVwZGF0ZSBjbGFzcwogICAgICB2YXIgY2xhc3NOYW1lID0gKHRoaXMuZGF0YS5jbGFzc05hbWUgPyAnICcgKyB0aGlzLmRhdGEuY2xhc3NOYW1lIDogJycpICsgKHRoaXMuc2VsZWN0ZWQgPyAnIHZpcy1zZWxlY3RlZCcgOiAnJykgKyAoZWRpdGFibGUgPyAnIHZpcy1lZGl0YWJsZScgOiAnIHZpcy1yZWFkb25seScpOwogICAgICBkb20uYm94LmNsYXNzTmFtZSA9ICd2aXMtaXRlbSB2aXMtYm94JyArIGNsYXNzTmFtZTsKICAgICAgZG9tLmxpbmUuY2xhc3NOYW1lID0gJ3Zpcy1pdGVtIHZpcy1saW5lJyArIGNsYXNzTmFtZTsKICAgICAgZG9tLmRvdC5jbGFzc05hbWUgPSAndmlzLWl0ZW0gdmlzLWRvdCcgKyBjbGFzc05hbWU7CgogICAgICAvLyByZWNhbGN1bGF0ZSBzaXplCiAgICAgIHRoaXMucHJvcHMuZG90LmhlaWdodCA9IGRvbS5kb3Qub2Zmc2V0SGVpZ2h0OwogICAgICB0aGlzLnByb3BzLmRvdC53aWR0aCA9IGRvbS5kb3Qub2Zmc2V0V2lkdGg7CiAgICAgIHRoaXMucHJvcHMubGluZS53aWR0aCA9IGRvbS5saW5lLm9mZnNldFdpZHRoOwogICAgICB0aGlzLndpZHRoID0gZG9tLmJveC5vZmZzZXRXaWR0aDsKICAgICAgdGhpcy5oZWlnaHQgPSBkb20uYm94Lm9mZnNldEhlaWdodDsKCiAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgIH0KCiAgICB0aGlzLl9yZXBhaW50RGVsZXRlQnV0dG9uKGRvbS5ib3gpOwogIH07CgogIC8qKgogICAqIFNob3cgdGhlIGl0ZW0gaW4gdGhlIERPTSAod2hlbiBub3QgYWxyZWFkeSBkaXNwbGF5ZWQpLiBUaGUgaXRlbXMgRE9NIHdpbGwKICAgKiBiZSBjcmVhdGVkIHdoZW4gbmVlZGVkLgogICAqLwogIEJveEl0ZW0ucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAoIXRoaXMuZGlzcGxheWVkKSB7CiAgICAgIHRoaXMucmVkcmF3KCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogSGlkZSB0aGUgaXRlbSBmcm9tIHRoZSBET00gKHdoZW4gdmlzaWJsZSkKICAgKi8KICBCb3hJdGVtLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuZGlzcGxheWVkKSB7CiAgICAgIHZhciBkb20gPSB0aGlzLmRvbTsKCiAgICAgIGlmIChkb20uYm94LnBhcmVudE5vZGUpIGRvbS5ib3gucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkb20uYm94KTsKICAgICAgaWYgKGRvbS5saW5lLnBhcmVudE5vZGUpIGRvbS5saW5lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZG9tLmxpbmUpOwogICAgICBpZiAoZG9tLmRvdC5wYXJlbnROb2RlKSBkb20uZG90LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZG9tLmRvdCk7CgogICAgICB0aGlzLmRpc3BsYXllZCA9IGZhbHNlOwogICAgfQogIH07CgogIC8qKgogICAqIFJlcG9zaXRpb24gdGhlIGl0ZW0gaG9yaXpvbnRhbGx5CiAgICogQE92ZXJyaWRlCiAgICovCiAgQm94SXRlbS5wcm90b3R5cGUucmVwb3NpdGlvblggPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc3RhcnQgPSB0aGlzLmNvbnZlcnNpb24udG9TY3JlZW4odGhpcy5kYXRhLnN0YXJ0KTsKICAgIHZhciBhbGlnbiA9IHRoaXMub3B0aW9ucy5hbGlnbjsKICAgIHZhciBsZWZ0OwoKICAgIC8vIGNhbGN1bGF0ZSBsZWZ0IHBvc2l0aW9uIG9mIHRoZSBib3gKICAgIGlmIChhbGlnbiA9PSAncmlnaHQnKSB7CiAgICAgIHRoaXMubGVmdCA9IHN0YXJ0IC0gdGhpcy53aWR0aDsKICAgIH0gZWxzZSBpZiAoYWxpZ24gPT0gJ2xlZnQnKSB7CiAgICAgIHRoaXMubGVmdCA9IHN0YXJ0OwogICAgfSBlbHNlIHsKICAgICAgLy8gZGVmYXVsdCBvciAnY2VudGVyJwogICAgICB0aGlzLmxlZnQgPSBzdGFydCAtIHRoaXMud2lkdGggLyAyOwogICAgfQoKICAgIC8vIHJlcG9zaXRpb24gYm94CiAgICB0aGlzLmRvbS5ib3guc3R5bGUubGVmdCA9IHRoaXMubGVmdCArICdweCc7CgogICAgLy8gcmVwb3NpdGlvbiBsaW5lCiAgICB0aGlzLmRvbS5saW5lLnN0eWxlLmxlZnQgPSBzdGFydCAtIHRoaXMucHJvcHMubGluZS53aWR0aCAvIDIgKyAncHgnOwoKICAgIC8vIHJlcG9zaXRpb24gZG90CiAgICB0aGlzLmRvbS5kb3Quc3R5bGUubGVmdCA9IHN0YXJ0IC0gdGhpcy5wcm9wcy5kb3Qud2lkdGggLyAyICsgJ3B4JzsKICB9OwoKICAvKioKICAgKiBSZXBvc2l0aW9uIHRoZSBpdGVtIHZlcnRpY2FsbHkKICAgKiBAT3ZlcnJpZGUKICAgKi8KICBCb3hJdGVtLnByb3RvdHlwZS5yZXBvc2l0aW9uWSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBvcmllbnRhdGlvbiA9IHRoaXMub3B0aW9ucy5vcmllbnRhdGlvbi5pdGVtOwogICAgdmFyIGJveCA9IHRoaXMuZG9tLmJveDsKICAgIHZhciBsaW5lID0gdGhpcy5kb20ubGluZTsKICAgIHZhciBkb3QgPSB0aGlzLmRvbS5kb3Q7CgogICAgaWYgKG9yaWVudGF0aW9uID09ICd0b3AnKSB7CiAgICAgIGJveC5zdHlsZS50b3AgPSAodGhpcy50b3AgfHwgMCkgKyAncHgnOwoKICAgICAgbGluZS5zdHlsZS50b3AgPSAnMCc7CiAgICAgIGxpbmUuc3R5bGUuaGVpZ2h0ID0gdGhpcy5wYXJlbnQudG9wICsgdGhpcy50b3AgKyAxICsgJ3B4JzsKICAgICAgbGluZS5zdHlsZS5ib3R0b20gPSAnJzsKICAgIH0gZWxzZSB7CiAgICAgIC8vIG9yaWVudGF0aW9uICdib3R0b20nCiAgICAgIHZhciBpdGVtU2V0SGVpZ2h0ID0gdGhpcy5wYXJlbnQuaXRlbVNldC5wcm9wcy5oZWlnaHQ7IC8vIFRPRE86IHRoaXMgaXMgbmFzdHkKICAgICAgdmFyIGxpbmVIZWlnaHQgPSBpdGVtU2V0SGVpZ2h0IC0gdGhpcy5wYXJlbnQudG9wIC0gdGhpcy5wYXJlbnQuaGVpZ2h0ICsgdGhpcy50b3A7CgogICAgICBib3guc3R5bGUudG9wID0gKHRoaXMucGFyZW50LmhlaWdodCAtIHRoaXMudG9wIC0gdGhpcy5oZWlnaHQgfHwgMCkgKyAncHgnOwogICAgICBsaW5lLnN0eWxlLnRvcCA9IGl0ZW1TZXRIZWlnaHQgLSBsaW5lSGVpZ2h0ICsgJ3B4JzsKICAgICAgbGluZS5zdHlsZS5ib3R0b20gPSAnMCc7CiAgICB9CgogICAgZG90LnN0eWxlLnRvcCA9IC10aGlzLnByb3BzLmRvdC5oZWlnaHQgLyAyICsgJ3B4JzsKICB9OwoKICAvKioKICAgKiBSZXR1cm4gdGhlIHdpZHRoIG9mIHRoZSBpdGVtIGxlZnQgZnJvbSBpdHMgc3RhcnQgZGF0ZQogICAqIEByZXR1cm4ge251bWJlcn0KICAgKi8KICBCb3hJdGVtLnByb3RvdHlwZS5nZXRXaWR0aExlZnQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy53aWR0aCAvIDI7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJuIHRoZSB3aWR0aCBvZiB0aGUgaXRlbSByaWdodCBmcm9tIGl0cyBzdGFydCBkYXRlCiAgICogQHJldHVybiB7bnVtYmVyfQogICAqLwogIEJveEl0ZW0ucHJvdG90eXBlLmdldFdpZHRoUmlnaHQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy53aWR0aCAvIDI7CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBCb3hJdGVtOwoKLyoqKi8gfSwKLyogMzkgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgdmFyIEl0ZW0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM1KTsKCiAgLyoqCiAgICogQGNvbnN0cnVjdG9yIFBvaW50SXRlbQogICAqIEBleHRlbmRzIEl0ZW0KICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSAgICAgICAgICAgICBPYmplY3QgY29udGFpbmluZyBwYXJhbWV0ZXJzIHN0YXJ0CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCwgY2xhc3NOYW1lLgogICAqIEBwYXJhbSB7e3RvU2NyZWVuOiBmdW5jdGlvbiwgdG9UaW1lOiBmdW5jdGlvbn19IGNvbnZlcnNpb24KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb252ZXJzaW9uIGZ1bmN0aW9ucyBmcm9tIHRpbWUgdG8gc2NyZWVuIGFuZCB2aWNlIHZlcnNhCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgICAgICAgQ29uZmlndXJhdGlvbiBvcHRpb25zCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogZGVzY3JpYmUgYXZhaWxhYmxlIG9wdGlvbnMKICAgKi8KICBmdW5jdGlvbiBQb2ludEl0ZW0oZGF0YSwgY29udmVyc2lvbiwgb3B0aW9ucykgewogICAgdGhpcy5wcm9wcyA9IHsKICAgICAgZG90OiB7CiAgICAgICAgdG9wOiAwLAogICAgICAgIHdpZHRoOiAwLAogICAgICAgIGhlaWdodDogMAogICAgICB9LAogICAgICBjb250ZW50OiB7CiAgICAgICAgaGVpZ2h0OiAwLAogICAgICAgIG1hcmdpbkxlZnQ6IDAKICAgICAgfQogICAgfTsKCiAgICAvLyB2YWxpZGF0ZSBkYXRhCiAgICBpZiAoZGF0YSkgewogICAgICBpZiAoZGF0YS5zdGFydCA9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Byb3BlcnR5ICJzdGFydCIgbWlzc2luZyBpbiBpdGVtICcgKyBkYXRhKTsKICAgICAgfQogICAgfQoKICAgIEl0ZW0uY2FsbCh0aGlzLCBkYXRhLCBjb252ZXJzaW9uLCBvcHRpb25zKTsKICB9CgogIFBvaW50SXRlbS5wcm90b3R5cGUgPSBuZXcgSXRlbShudWxsLCBudWxsLCBudWxsKTsKCiAgLyoqCiAgICogQ2hlY2sgd2hldGhlciB0aGlzIGl0ZW0gaXMgdmlzaWJsZSBpbnNpZGUgZ2l2ZW4gcmFuZ2UKICAgKiBAcmV0dXJucyB7e3N0YXJ0OiBOdW1iZXIsIGVuZDogTnVtYmVyfX0gcmFuZ2Ugd2l0aCBhIHRpbWVzdGFtcCBmb3Igc3RhcnQgYW5kIGVuZAogICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHZpc2libGUKICAgKi8KICBQb2ludEl0ZW0ucHJvdG90eXBlLmlzVmlzaWJsZSA9IGZ1bmN0aW9uIChyYW5nZSkgewogICAgLy8gZGV0ZXJtaW5lIHZpc2liaWxpdHkKICAgIC8vIFRPRE86IGFjY291bnQgZm9yIHRoZSByZWFsIHdpZHRoIG9mIHRoZSBpdGVtLiBSaWdodCBub3cgd2UganVzdCBhZGQgMS80IHRvIHRoZSB3aW5kb3cKICAgIHZhciBpbnRlcnZhbCA9IChyYW5nZS5lbmQgLSByYW5nZS5zdGFydCkgLyA0OwogICAgcmV0dXJuIHRoaXMuZGF0YS5zdGFydCA+IHJhbmdlLnN0YXJ0IC0gaW50ZXJ2YWwgJiYgdGhpcy5kYXRhLnN0YXJ0IDwgcmFuZ2UuZW5kICsgaW50ZXJ2YWw7CiAgfTsKCiAgLyoqCiAgICogUmVwYWludCB0aGUgaXRlbQogICAqLwogIFBvaW50SXRlbS5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGRvbSA9IHRoaXMuZG9tOwogICAgaWYgKCFkb20pIHsKICAgICAgLy8gY3JlYXRlIERPTQogICAgICB0aGlzLmRvbSA9IHt9OwogICAgICBkb20gPSB0aGlzLmRvbTsKCiAgICAgIC8vIGJhY2tncm91bmQgYm94CiAgICAgIGRvbS5wb2ludCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAvLyBjbGFzc05hbWUgaXMgdXBkYXRlZCBpbiByZWRyYXcoKQoKICAgICAgLy8gY29udGVudHMgYm94LCByaWdodCBmcm9tIHRoZSBkb3QKICAgICAgZG9tLmNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgZG9tLmNvbnRlbnQuY2xhc3NOYW1lID0gJ3Zpcy1pdGVtLWNvbnRlbnQnOwogICAgICBkb20ucG9pbnQuYXBwZW5kQ2hpbGQoZG9tLmNvbnRlbnQpOwoKICAgICAgLy8gZG90IGF0IHN0YXJ0CiAgICAgIGRvbS5kb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgZG9tLnBvaW50LmFwcGVuZENoaWxkKGRvbS5kb3QpOwoKICAgICAgLy8gYXR0YWNoIHRoaXMgaXRlbSBhcyBhdHRyaWJ1dGUKICAgICAgZG9tLnBvaW50Wyd0aW1lbGluZS1pdGVtJ10gPSB0aGlzOwoKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CgogICAgLy8gYXBwZW5kIERPTSB0byBwYXJlbnQgRE9NCiAgICBpZiAoIXRoaXMucGFyZW50KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHJlZHJhdyBpdGVtOiBubyBwYXJlbnQgYXR0YWNoZWQnKTsKICAgIH0KICAgIGlmICghZG9tLnBvaW50LnBhcmVudE5vZGUpIHsKICAgICAgdmFyIGZvcmVncm91bmQgPSB0aGlzLnBhcmVudC5kb20uZm9yZWdyb3VuZDsKICAgICAgaWYgKCFmb3JlZ3JvdW5kKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgcmVkcmF3IGl0ZW06IHBhcmVudCBoYXMgbm8gZm9yZWdyb3VuZCBjb250YWluZXIgZWxlbWVudCcpOwogICAgICB9CiAgICAgIGZvcmVncm91bmQuYXBwZW5kQ2hpbGQoZG9tLnBvaW50KTsKICAgIH0KICAgIHRoaXMuZGlzcGxheWVkID0gdHJ1ZTsKCiAgICAvLyBVcGRhdGUgRE9NIHdoZW4gaXRlbSBpcyBtYXJrZWQgZGlydHkuIEFuIGl0ZW0gaXMgbWFya2VkIGRpcnR5IHdoZW46CiAgICAvLyAtIHRoZSBpdGVtIGlzIG5vdCB5ZXQgcmVuZGVyZWQKICAgIC8vIC0gdGhlIGl0ZW0ncyBkYXRhIGlzIGNoYW5nZWQKICAgIC8vIC0gdGhlIGl0ZW0gaXMgc2VsZWN0ZWQvZGVzZWxlY3RlZAogICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgdGhpcy5fdXBkYXRlQ29udGVudHModGhpcy5kb20uY29udGVudCk7CiAgICAgIHRoaXMuX3VwZGF0ZVRpdGxlKHRoaXMuZG9tLnBvaW50KTsKICAgICAgdGhpcy5fdXBkYXRlRGF0YUF0dHJpYnV0ZXModGhpcy5kb20ucG9pbnQpOwogICAgICB0aGlzLl91cGRhdGVTdHlsZSh0aGlzLmRvbS5wb2ludCk7CgogICAgICB2YXIgZWRpdGFibGUgPSAodGhpcy5vcHRpb25zLmVkaXRhYmxlLnVwZGF0ZVRpbWUgfHwgdGhpcy5vcHRpb25zLmVkaXRhYmxlLnVwZGF0ZUdyb3VwIHx8IHRoaXMuZWRpdGFibGUgPT09IHRydWUpICYmIHRoaXMuZWRpdGFibGUgIT09IGZhbHNlOwoKICAgICAgLy8gdXBkYXRlIGNsYXNzCiAgICAgIHZhciBjbGFzc05hbWUgPSAodGhpcy5kYXRhLmNsYXNzTmFtZSA/ICcgJyArIHRoaXMuZGF0YS5jbGFzc05hbWUgOiAnJykgKyAodGhpcy5zZWxlY3RlZCA/ICcgdmlzLXNlbGVjdGVkJyA6ICcnKSArIChlZGl0YWJsZSA/ICcgdmlzLWVkaXRhYmxlJyA6ICcgdmlzLXJlYWRvbmx5Jyk7CiAgICAgIGRvbS5wb2ludC5jbGFzc05hbWUgPSAndmlzLWl0ZW0gdmlzLXBvaW50JyArIGNsYXNzTmFtZTsKICAgICAgZG9tLmRvdC5jbGFzc05hbWUgPSAndmlzLWl0ZW0gdmlzLWRvdCcgKyBjbGFzc05hbWU7CgogICAgICAvLyByZWNhbGN1bGF0ZSBzaXplIG9mIGRvdCBhbmQgY29udGVudHMKICAgICAgdGhpcy5wcm9wcy5kb3Qud2lkdGggPSBkb20uZG90Lm9mZnNldFdpZHRoOwogICAgICB0aGlzLnByb3BzLmRvdC5oZWlnaHQgPSBkb20uZG90Lm9mZnNldEhlaWdodDsKICAgICAgdGhpcy5wcm9wcy5jb250ZW50LmhlaWdodCA9IGRvbS5jb250ZW50Lm9mZnNldEhlaWdodDsKCiAgICAgIC8vIHJlc2l6ZSBjb250ZW50cwogICAgICBkb20uY29udGVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gMiAqIHRoaXMucHJvcHMuZG90LndpZHRoICsgJ3B4JzsKICAgICAgLy9kb20uY29udGVudC5zdHlsZS5tYXJnaW5SaWdodCA9IC4uLiArICdweCc7IC8vIFRPRE86IG1hcmdpbiByaWdodAoKICAgICAgZG9tLmRvdC5zdHlsZS50b3AgPSAodGhpcy5oZWlnaHQgLSB0aGlzLnByb3BzLmRvdC5oZWlnaHQpIC8gMiArICdweCc7CiAgICAgIGRvbS5kb3Quc3R5bGUubGVmdCA9IHRoaXMucHJvcHMuZG90LndpZHRoIC8gMiArICdweCc7CgogICAgICAvLyByZWNhbGN1bGF0ZSBzaXplCiAgICAgIHRoaXMud2lkdGggPSBkb20ucG9pbnQub2Zmc2V0V2lkdGg7CiAgICAgIHRoaXMuaGVpZ2h0ID0gZG9tLnBvaW50Lm9mZnNldEhlaWdodDsKCiAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgIH0KCiAgICB0aGlzLl9yZXBhaW50RGVsZXRlQnV0dG9uKGRvbS5wb2ludCk7CiAgfTsKCiAgLyoqCiAgICogU2hvdyB0aGUgaXRlbSBpbiB0aGUgRE9NICh3aGVuIG5vdCBhbHJlYWR5IHZpc2libGUpLiBUaGUgaXRlbXMgRE9NIHdpbGwKICAgKiBiZSBjcmVhdGVkIHdoZW4gbmVlZGVkLgogICAqLwogIFBvaW50SXRlbS5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICghdGhpcy5kaXNwbGF5ZWQpIHsKICAgICAgdGhpcy5yZWRyYXcoKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBIaWRlIHRoZSBpdGVtIGZyb20gdGhlIERPTSAod2hlbiB2aXNpYmxlKQogICAqLwogIFBvaW50SXRlbS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmRpc3BsYXllZCkgewogICAgICBpZiAodGhpcy5kb20ucG9pbnQucGFyZW50Tm9kZSkgewogICAgICAgIHRoaXMuZG9tLnBvaW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5kb20ucG9pbnQpOwogICAgICB9CgogICAgICB0aGlzLmRpc3BsYXllZCA9IGZhbHNlOwogICAgfQogIH07CgogIC8qKgogICAqIFJlcG9zaXRpb24gdGhlIGl0ZW0gaG9yaXpvbnRhbGx5CiAgICogQE92ZXJyaWRlCiAgICovCiAgUG9pbnRJdGVtLnByb3RvdHlwZS5yZXBvc2l0aW9uWCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzdGFydCA9IHRoaXMuY29udmVyc2lvbi50b1NjcmVlbih0aGlzLmRhdGEuc3RhcnQpOwoKICAgIHRoaXMubGVmdCA9IHN0YXJ0IC0gdGhpcy5wcm9wcy5kb3Qud2lkdGg7CgogICAgLy8gcmVwb3NpdGlvbiBwb2ludAogICAgdGhpcy5kb20ucG9pbnQuc3R5bGUubGVmdCA9IHRoaXMubGVmdCArICdweCc7CiAgfTsKCiAgLyoqCiAgICogUmVwb3NpdGlvbiB0aGUgaXRlbSB2ZXJ0aWNhbGx5CiAgICogQE92ZXJyaWRlCiAgICovCiAgUG9pbnRJdGVtLnByb3RvdHlwZS5yZXBvc2l0aW9uWSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBvcmllbnRhdGlvbiA9IHRoaXMub3B0aW9ucy5vcmllbnRhdGlvbi5pdGVtOwogICAgdmFyIHBvaW50ID0gdGhpcy5kb20ucG9pbnQ7CgogICAgaWYgKG9yaWVudGF0aW9uID09ICd0b3AnKSB7CiAgICAgIHBvaW50LnN0eWxlLnRvcCA9IHRoaXMudG9wICsgJ3B4JzsKICAgIH0gZWxzZSB7CiAgICAgIHBvaW50LnN0eWxlLnRvcCA9IHRoaXMucGFyZW50LmhlaWdodCAtIHRoaXMudG9wIC0gdGhpcy5oZWlnaHQgKyAncHgnOwogICAgfQogIH07CgogIC8qKgogICAqIFJldHVybiB0aGUgd2lkdGggb2YgdGhlIGl0ZW0gbGVmdCBmcm9tIGl0cyBzdGFydCBkYXRlCiAgICogQHJldHVybiB7bnVtYmVyfQogICAqLwogIFBvaW50SXRlbS5wcm90b3R5cGUuZ2V0V2lkdGhMZWZ0ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMucHJvcHMuZG90LndpZHRoOwogIH07CgogIC8qKgogICAqIFJldHVybiB0aGUgd2lkdGggb2YgdGhlIGl0ZW0gcmlnaHQgZnJvbSAgaXRzIHN0YXJ0IGRhdGUKICAgKiBAcmV0dXJuIHtudW1iZXJ9CiAgICovCiAgUG9pbnRJdGVtLnByb3RvdHlwZS5nZXRXaWR0aFJpZ2h0ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMud2lkdGggLSB0aGlzLnByb3BzLmRvdC53aWR0aDsKICB9OwoKICBtb2R1bGUuZXhwb3J0cyA9IFBvaW50SXRlbTsKCi8qKiovIH0sCi8qIDQwICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciBIYW1tZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKTsKICB2YXIgSXRlbSA9IF9fd2VicGFja19yZXF1aXJlX18oMzUpOwogIHZhciBCYWNrZ3JvdW5kR3JvdXAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM3KTsKICB2YXIgUmFuZ2VJdGVtID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNCk7CgogIC8qKgogICAqIEBjb25zdHJ1Y3RvciBCYWNrZ3JvdW5kSXRlbQogICAqIEBleHRlbmRzIEl0ZW0KICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSAgICAgICAgICAgICBPYmplY3QgY29udGFpbmluZyBwYXJhbWV0ZXJzIHN0YXJ0LCBlbmQKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50LCBjbGFzc05hbWUuCiAgICogQHBhcmFtIHt7dG9TY3JlZW46IGZ1bmN0aW9uLCB0b1RpbWU6IGZ1bmN0aW9ufX0gY29udmVyc2lvbgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnZlcnNpb24gZnVuY3Rpb25zIGZyb20gdGltZSB0byBzY3JlZW4gYW5kIHZpY2UgdmVyc2EKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICAgICAgICBDb25maWd1cmF0aW9uIG9wdGlvbnMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBkZXNjcmliZSBvcHRpb25zCiAgICovCiAgLy8gVE9ETzogaW1wbGVtZW50IHN1cHBvcnQgZm9yIHRoZSBCYWNrZ3JvdW5kSXRlbSBqdXN0IGhhdmluZyBhIHN0YXJ0LCB0aGVuIGJlaW5nIGRpc3BsYXllZCBhcyBhIHNvcnQgb2YgYW4gYW5ub3RhdGlvbgogIGZ1bmN0aW9uIEJhY2tncm91bmRJdGVtKGRhdGEsIGNvbnZlcnNpb24sIG9wdGlvbnMpIHsKICAgIHRoaXMucHJvcHMgPSB7CiAgICAgIGNvbnRlbnQ6IHsKICAgICAgICB3aWR0aDogMAogICAgICB9CiAgICB9OwogICAgdGhpcy5vdmVyZmxvdyA9IGZhbHNlOyAvLyBpZiBjb250ZW50cyBjYW4gb3ZlcmZsb3cgKGNzcyBzdHlsaW5nKSwgdGhpcyBmbGFnIGlzIHNldCB0byB0cnVlCgogICAgLy8gdmFsaWRhdGUgZGF0YQogICAgaWYgKGRhdGEpIHsKICAgICAgaWYgKGRhdGEuc3RhcnQgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQcm9wZXJ0eSAic3RhcnQiIG1pc3NpbmcgaW4gaXRlbSAnICsgZGF0YS5pZCk7CiAgICAgIH0KICAgICAgaWYgKGRhdGEuZW5kID09IHVuZGVmaW5lZCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignUHJvcGVydHkgImVuZCIgbWlzc2luZyBpbiBpdGVtICcgKyBkYXRhLmlkKTsKICAgICAgfQogICAgfQoKICAgIEl0ZW0uY2FsbCh0aGlzLCBkYXRhLCBjb252ZXJzaW9uLCBvcHRpb25zKTsKICB9CgogIEJhY2tncm91bmRJdGVtLnByb3RvdHlwZSA9IG5ldyBJdGVtKG51bGwsIG51bGwsIG51bGwpOwoKICBCYWNrZ3JvdW5kSXRlbS5wcm90b3R5cGUuYmFzZUNsYXNzTmFtZSA9ICd2aXMtaXRlbSB2aXMtYmFja2dyb3VuZCc7CiAgQmFja2dyb3VuZEl0ZW0ucHJvdG90eXBlLnN0YWNrID0gZmFsc2U7CgogIC8qKgogICAqIENoZWNrIHdoZXRoZXIgdGhpcyBpdGVtIGlzIHZpc2libGUgaW5zaWRlIGdpdmVuIHJhbmdlCiAgICogQHJldHVybnMge3tzdGFydDogTnVtYmVyLCBlbmQ6IE51bWJlcn19IHJhbmdlIHdpdGggYSB0aW1lc3RhbXAgZm9yIHN0YXJ0IGFuZCBlbmQKICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB2aXNpYmxlCiAgICovCiAgQmFja2dyb3VuZEl0ZW0ucHJvdG90eXBlLmlzVmlzaWJsZSA9IGZ1bmN0aW9uIChyYW5nZSkgewogICAgLy8gZGV0ZXJtaW5lIHZpc2liaWxpdHkKICAgIHJldHVybiB0aGlzLmRhdGEuc3RhcnQgPCByYW5nZS5lbmQgJiYgdGhpcy5kYXRhLmVuZCA+IHJhbmdlLnN0YXJ0OwogIH07CgogIC8qKgogICAqIFJlcGFpbnQgdGhlIGl0ZW0KICAgKi8KICBCYWNrZ3JvdW5kSXRlbS5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGRvbSA9IHRoaXMuZG9tOwogICAgaWYgKCFkb20pIHsKICAgICAgLy8gY3JlYXRlIERPTQogICAgICB0aGlzLmRvbSA9IHt9OwogICAgICBkb20gPSB0aGlzLmRvbTsKCiAgICAgIC8vIGJhY2tncm91bmQgYm94CiAgICAgIGRvbS5ib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgLy8gY2xhc3NOYW1lIGlzIHVwZGF0ZWQgaW4gcmVkcmF3KCkKCiAgICAgIC8vIGZyYW1lIGJveCAodG8gcHJldmVudCB0aGUgaXRlbSBjb250ZW50cyBmcm9tIG92ZXJmbG93aW5nCiAgICAgIGRvbS5mcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBkb20uZnJhbWUuY2xhc3NOYW1lID0gJ3Zpcy1pdGVtLW92ZXJmbG93JzsKICAgICAgZG9tLmJveC5hcHBlbmRDaGlsZChkb20uZnJhbWUpOwoKICAgICAgLy8gY29udGVudHMgYm94CiAgICAgIGRvbS5jb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGRvbS5jb250ZW50LmNsYXNzTmFtZSA9ICd2aXMtaXRlbS1jb250ZW50JzsKICAgICAgZG9tLmZyYW1lLmFwcGVuZENoaWxkKGRvbS5jb250ZW50KTsKCiAgICAgIC8vIE5vdGU6IHdlIGRvIE5PVCBhdHRhY2ggdGhpcyBpdGVtIGFzIGF0dHJpYnV0ZSB0byB0aGUgRE9NLAogICAgICAvLyAgICAgICBzdWNoIHRoYXQgYmFja2dyb3VuZCBpdGVtcyBjYW5ub3QgYmUgc2VsZWN0ZWQKICAgICAgLy9kb20uYm94Wyd0aW1lbGluZS1pdGVtJ10gPSB0aGlzOwoKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CgogICAgLy8gYXBwZW5kIERPTSB0byBwYXJlbnQgRE9NCiAgICBpZiAoIXRoaXMucGFyZW50KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHJlZHJhdyBpdGVtOiBubyBwYXJlbnQgYXR0YWNoZWQnKTsKICAgIH0KICAgIGlmICghZG9tLmJveC5wYXJlbnROb2RlKSB7CiAgICAgIHZhciBiYWNrZ3JvdW5kID0gdGhpcy5wYXJlbnQuZG9tLmJhY2tncm91bmQ7CiAgICAgIGlmICghYmFja2dyb3VuZCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHJlZHJhdyBpdGVtOiBwYXJlbnQgaGFzIG5vIGJhY2tncm91bmQgY29udGFpbmVyIGVsZW1lbnQnKTsKICAgICAgfQogICAgICBiYWNrZ3JvdW5kLmFwcGVuZENoaWxkKGRvbS5ib3gpOwogICAgfQogICAgdGhpcy5kaXNwbGF5ZWQgPSB0cnVlOwoKICAgIC8vIFVwZGF0ZSBET00gd2hlbiBpdGVtIGlzIG1hcmtlZCBkaXJ0eS4gQW4gaXRlbSBpcyBtYXJrZWQgZGlydHkgd2hlbjoKICAgIC8vIC0gdGhlIGl0ZW0gaXMgbm90IHlldCByZW5kZXJlZAogICAgLy8gLSB0aGUgaXRlbSdzIGRhdGEgaXMgY2hhbmdlZAogICAgLy8gLSB0aGUgaXRlbSBpcyBzZWxlY3RlZC9kZXNlbGVjdGVkCiAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICB0aGlzLl91cGRhdGVDb250ZW50cyh0aGlzLmRvbS5jb250ZW50KTsKICAgICAgdGhpcy5fdXBkYXRlVGl0bGUodGhpcy5kb20uY29udGVudCk7CiAgICAgIHRoaXMuX3VwZGF0ZURhdGFBdHRyaWJ1dGVzKHRoaXMuZG9tLmNvbnRlbnQpOwogICAgICB0aGlzLl91cGRhdGVTdHlsZSh0aGlzLmRvbS5ib3gpOwoKICAgICAgLy8gdXBkYXRlIGNsYXNzCiAgICAgIHZhciBjbGFzc05hbWUgPSAodGhpcy5kYXRhLmNsYXNzTmFtZSA/ICcgJyArIHRoaXMuZGF0YS5jbGFzc05hbWUgOiAnJykgKyAodGhpcy5zZWxlY3RlZCA/ICcgdmlzLXNlbGVjdGVkJyA6ICcnKTsKICAgICAgZG9tLmJveC5jbGFzc05hbWUgPSB0aGlzLmJhc2VDbGFzc05hbWUgKyBjbGFzc05hbWU7CgogICAgICAvLyBkZXRlcm1pbmUgZnJvbSBjc3Mgd2hldGhlciB0aGlzIGJveCBoYXMgb3ZlcmZsb3cKICAgICAgdGhpcy5vdmVyZmxvdyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGRvbS5jb250ZW50KS5vdmVyZmxvdyAhPT0gJ2hpZGRlbic7CgogICAgICAvLyByZWNhbGN1bGF0ZSBzaXplCiAgICAgIHRoaXMucHJvcHMuY29udGVudC53aWR0aCA9IHRoaXMuZG9tLmNvbnRlbnQub2Zmc2V0V2lkdGg7CiAgICAgIHRoaXMuaGVpZ2h0ID0gMDsgLy8gc2V0IGhlaWdodCB6ZXJvLCBzbyB0aGlzIGl0ZW0gd2lsbCBiZSBpZ25vcmVkIHdoZW4gc3RhY2tpbmcgaXRlbXMKCiAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgIH0KICB9OwoKICAvKioKICAgKiBTaG93IHRoZSBpdGVtIGluIHRoZSBET00gKHdoZW4gbm90IGFscmVhZHkgdmlzaWJsZSkuIFRoZSBpdGVtcyBET00gd2lsbAogICAqIGJlIGNyZWF0ZWQgd2hlbiBuZWVkZWQuCiAgICovCiAgQmFja2dyb3VuZEl0ZW0ucHJvdG90eXBlLnNob3cgPSBSYW5nZUl0ZW0ucHJvdG90eXBlLnNob3c7CgogIC8qKgogICAqIEhpZGUgdGhlIGl0ZW0gZnJvbSB0aGUgRE9NICh3aGVuIHZpc2libGUpCiAgICogQHJldHVybiB7Qm9vbGVhbn0gY2hhbmdlZAogICAqLwogIEJhY2tncm91bmRJdGVtLnByb3RvdHlwZS5oaWRlID0gUmFuZ2VJdGVtLnByb3RvdHlwZS5oaWRlOwoKICAvKioKICAgKiBSZXBvc2l0aW9uIHRoZSBpdGVtIGhvcml6b250YWxseQogICAqIEBPdmVycmlkZQogICAqLwogIEJhY2tncm91bmRJdGVtLnByb3RvdHlwZS5yZXBvc2l0aW9uWCA9IFJhbmdlSXRlbS5wcm90b3R5cGUucmVwb3NpdGlvblg7CgogIC8qKgogICAqIFJlcG9zaXRpb24gdGhlIGl0ZW0gdmVydGljYWxseQogICAqIEBPdmVycmlkZQogICAqLwogIEJhY2tncm91bmRJdGVtLnByb3RvdHlwZS5yZXBvc2l0aW9uWSA9IGZ1bmN0aW9uIChtYXJnaW4pIHsKICAgIHZhciBvblRvcCA9IHRoaXMub3B0aW9ucy5vcmllbnRhdGlvbi5pdGVtID09PSAndG9wJzsKICAgIHRoaXMuZG9tLmNvbnRlbnQuc3R5bGUudG9wID0gb25Ub3AgPyAnJyA6ICcwJzsKICAgIHRoaXMuZG9tLmNvbnRlbnQuc3R5bGUuYm90dG9tID0gb25Ub3AgPyAnMCcgOiAnJzsKICAgIHZhciBoZWlnaHQ7CgogICAgLy8gc3BlY2lhbCBwb3NpdGlvbmluZyBmb3Igc3ViZ3JvdXBzCiAgICBpZiAodGhpcy5kYXRhLnN1Ymdyb3VwICE9PSB1bmRlZmluZWQpIHsKICAgICAgLy8gVE9ETzogaW5zdGVhZCBvZiBjYWxjdWxhdGluZyB0aGUgdG9wIHBvc2l0aW9uIG9mIHRoZSBzdWJncm91cHMgaGVyZSBmb3IgZXZlcnkgQmFja2dyb3VuZEl0ZW0sIGNhbGN1bGF0ZSB0aGUgdG9wIG9mIHRoZSBzdWJncm91cCBvbmNlIGluIEl0ZW1zZXQKCiAgICAgIHZhciBpdGVtU3ViZ3JvdXAgPSB0aGlzLmRhdGEuc3ViZ3JvdXA7CiAgICAgIHZhciBzdWJncm91cHMgPSB0aGlzLnBhcmVudC5zdWJncm91cHM7CiAgICAgIHZhciBzdWJncm91cEluZGV4ID0gc3ViZ3JvdXBzW2l0ZW1TdWJncm91cF0uaW5kZXg7CiAgICAgIC8vIGlmIHRoZSBvcmllbnRhdGlvbiBpcyB0b3AsIHdlIG5lZWQgdG8gdGFrZSB0aGUgZGlmZmVyZW5jZSBpbiBoZWlnaHQgaW50byBhY2NvdW50LgogICAgICBpZiAob25Ub3AgPT0gdHJ1ZSkgewogICAgICAgIC8vIHRoZSBmaXJzdCBzdWJncm91cCB3aWxsIGhhdmUgdG8gYWNjb3VudCBmb3IgdGhlIGRpc3RhbmNlIGZyb20gdGhlIHRvcCB0byB0aGUgZmlyc3QgaXRlbS4KICAgICAgICBoZWlnaHQgPSB0aGlzLnBhcmVudC5zdWJncm91cHNbaXRlbVN1Ymdyb3VwXS5oZWlnaHQgKyBtYXJnaW4uaXRlbS52ZXJ0aWNhbDsKICAgICAgICBoZWlnaHQgKz0gc3ViZ3JvdXBJbmRleCA9PSAwID8gbWFyZ2luLmF4aXMgLSAwLjUgKiBtYXJnaW4uaXRlbS52ZXJ0aWNhbCA6IDA7CiAgICAgICAgdmFyIG5ld1RvcCA9IHRoaXMucGFyZW50LnRvcDsKICAgICAgICBmb3IgKHZhciBzdWJncm91cCBpbiBzdWJncm91cHMpIHsKICAgICAgICAgIGlmIChzdWJncm91cHMuaGFzT3duUHJvcGVydHkoc3ViZ3JvdXApKSB7CiAgICAgICAgICAgIGlmIChzdWJncm91cHNbc3ViZ3JvdXBdLnZpc2libGUgPT0gdHJ1ZSAmJiBzdWJncm91cHNbc3ViZ3JvdXBdLmluZGV4IDwgc3ViZ3JvdXBJbmRleCkgewogICAgICAgICAgICAgIG5ld1RvcCArPSBzdWJncm91cHNbc3ViZ3JvdXBdLmhlaWdodCArIG1hcmdpbi5pdGVtLnZlcnRpY2FsOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyB0aGUgb3RoZXJzIHdpbGwgaGF2ZSB0byBiZSBvZmZzZXQgZG93bndhcmRzIHdpdGggdGhpcyBzYW1lIGRpc3RhbmNlLgogICAgICAgIG5ld1RvcCArPSBzdWJncm91cEluZGV4ICE9IDAgPyBtYXJnaW4uYXhpcyAtIDAuNSAqIG1hcmdpbi5pdGVtLnZlcnRpY2FsIDogMDsKICAgICAgICB0aGlzLmRvbS5ib3guc3R5bGUudG9wID0gbmV3VG9wICsgJ3B4JzsKICAgICAgICB0aGlzLmRvbS5ib3guc3R5bGUuYm90dG9tID0gJyc7CiAgICAgIH0KICAgICAgLy8gYW5kIHdoZW4gdGhlIG9yaWVudGF0aW9uIGlzIGJvdHRvbToKICAgICAgZWxzZSB7CiAgICAgICAgdmFyIG5ld1RvcCA9IHRoaXMucGFyZW50LnRvcDsKICAgICAgICB2YXIgdG90YWxIZWlnaHQgPSAwOwogICAgICAgIGZvciAodmFyIHN1Ymdyb3VwIGluIHN1Ymdyb3VwcykgewogICAgICAgICAgaWYgKHN1Ymdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShzdWJncm91cCkpIHsKICAgICAgICAgICAgaWYgKHN1Ymdyb3Vwc1tzdWJncm91cF0udmlzaWJsZSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIG5ld0hlaWdodCA9IHN1Ymdyb3Vwc1tzdWJncm91cF0uaGVpZ2h0ICsgbWFyZ2luLml0ZW0udmVydGljYWw7CiAgICAgICAgICAgICAgdG90YWxIZWlnaHQgKz0gbmV3SGVpZ2h0OwogICAgICAgICAgICAgIGlmIChzdWJncm91cHNbc3ViZ3JvdXBdLmluZGV4ID4gc3ViZ3JvdXBJbmRleCkgewogICAgICAgICAgICAgICAgbmV3VG9wICs9IG5ld0hlaWdodDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaGVpZ2h0ID0gdGhpcy5wYXJlbnQuc3ViZ3JvdXBzW2l0ZW1TdWJncm91cF0uaGVpZ2h0ICsgbWFyZ2luLml0ZW0udmVydGljYWw7CiAgICAgICAgdGhpcy5kb20uYm94LnN0eWxlLnRvcCA9IHRoaXMucGFyZW50LmhlaWdodCAtIHRvdGFsSGVpZ2h0ICsgbmV3VG9wICsgJ3B4JzsKICAgICAgICB0aGlzLmRvbS5ib3guc3R5bGUuYm90dG9tID0gJyc7CiAgICAgIH0KICAgIH0KICAgIC8vIGFuZCBpbiB0aGUgY2FzZSBvZiBubyBzdWJncm91cHM6CiAgICBlbHNlIHsKICAgICAgLy8gd2Ugd2FudCBiYWNrZ3JvdW5kcyB3aXRoIGdyb3VwcyB0byBvbmx5IHNob3cgaW4gZ3JvdXBzLgogICAgICBpZiAodGhpcy5wYXJlbnQgaW5zdGFuY2VvZiBCYWNrZ3JvdW5kR3JvdXApIHsKICAgICAgICAvLyBpZiB0aGUgaXRlbSBpcyBub3QgaW4gYSBncm91cDoKICAgICAgICBoZWlnaHQgPSBNYXRoLm1heCh0aGlzLnBhcmVudC5oZWlnaHQsIHRoaXMucGFyZW50Lml0ZW1TZXQuYm9keS5kb21Qcm9wcy5jZW50ZXIuaGVpZ2h0LCB0aGlzLnBhcmVudC5pdGVtU2V0LmJvZHkuZG9tUHJvcHMuY2VudGVyQ29udGFpbmVyLmhlaWdodCk7CiAgICAgICAgdGhpcy5kb20uYm94LnN0eWxlLnRvcCA9IG9uVG9wID8gJzAnIDogJyc7CiAgICAgICAgdGhpcy5kb20uYm94LnN0eWxlLmJvdHRvbSA9IG9uVG9wID8gJycgOiAnMCc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaGVpZ2h0ID0gdGhpcy5wYXJlbnQuaGVpZ2h0OwogICAgICAgIC8vIHNhbWUgYWxpZ25tZW50IGZvciBpdGVtcyB3aGVuIG9yaWVudGF0aW9uIGlzIHRvcCBvciBib3R0b20KICAgICAgICB0aGlzLmRvbS5ib3guc3R5bGUudG9wID0gdGhpcy5wYXJlbnQudG9wICsgJ3B4JzsKICAgICAgICB0aGlzLmRvbS5ib3guc3R5bGUuYm90dG9tID0gJyc7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZG9tLmJveC5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyAncHgnOwogIH07CgogIG1vZHVsZS5leHBvcnRzID0gQmFja2dyb3VuZEl0ZW07CgovKioqLyB9LAovKiA0MSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CiAgdmFyIENvbXBvbmVudCA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpOwogIHZhciBUaW1lU3RlcCA9IF9fd2VicGFja19yZXF1aXJlX18oMzYpOwogIHZhciBEYXRlVXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMjkpOwogIHZhciBtb21lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwoKICAvKioKICAgKiBBIGhvcml6b250YWwgdGltZSBheGlzCiAgICogQHBhcmFtIHt7ZG9tOiBPYmplY3QsIGRvbVByb3BzOiBPYmplY3QsIGVtaXR0ZXI6IEVtaXR0ZXIsIHJhbmdlOiBSYW5nZX19IGJvZHkKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICAgICAgICBTZWUgVGltZUF4aXMuc2V0T3B0aW9ucyBmb3IgdGhlIGF2YWlsYWJsZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuCiAgICogQGNvbnN0cnVjdG9yIFRpbWVBeGlzCiAgICogQGV4dGVuZHMgQ29tcG9uZW50CiAgICovCiAgZnVuY3Rpb24gVGltZUF4aXMoYm9keSwgb3B0aW9ucykgewogICAgdGhpcy5kb20gPSB7CiAgICAgIGZvcmVncm91bmQ6IG51bGwsCiAgICAgIGxpbmVzOiBbXSwKICAgICAgbWFqb3JUZXh0czogW10sCiAgICAgIG1pbm9yVGV4dHM6IFtdLAogICAgICByZWR1bmRhbnQ6IHsKICAgICAgICBsaW5lczogW10sCiAgICAgICAgbWFqb3JUZXh0czogW10sCiAgICAgICAgbWlub3JUZXh0czogW10KICAgICAgfQogICAgfTsKICAgIHRoaXMucHJvcHMgPSB7CiAgICAgIHJhbmdlOiB7CiAgICAgICAgc3RhcnQ6IDAsCiAgICAgICAgZW5kOiAwLAogICAgICAgIG1pbmltdW1TdGVwOiAwCiAgICAgIH0sCiAgICAgIGxpbmVUb3A6IDAKICAgIH07CgogICAgdGhpcy5kZWZhdWx0T3B0aW9ucyA9IHsKICAgICAgb3JpZW50YXRpb246IHsKICAgICAgICBheGlzOiAnYm90dG9tJwogICAgICB9LCAvLyBheGlzIG9yaWVudGF0aW9uOiAndG9wJyBvciAnYm90dG9tJwogICAgICBzaG93TWlub3JMYWJlbHM6IHRydWUsCiAgICAgIHNob3dNYWpvckxhYmVsczogdHJ1ZSwKICAgICAgZm9ybWF0OiBUaW1lU3RlcC5GT1JNQVQsCiAgICAgIHRpbWVBeGlzOiBudWxsCiAgICB9OwogICAgdGhpcy5vcHRpb25zID0gdXRpbC5leHRlbmQoe30sIHRoaXMuZGVmYXVsdE9wdGlvbnMpOwoKICAgIHRoaXMuYm9keSA9IGJvZHk7CgogICAgLy8gY3JlYXRlIHRoZSBIVE1MIERPTQogICAgdGhpcy5fY3JlYXRlKCk7CgogICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpOwogIH0KCiAgVGltZUF4aXMucHJvdG90eXBlID0gbmV3IENvbXBvbmVudCgpOwoKICAvKioKICAgKiBTZXQgb3B0aW9ucyBmb3IgdGhlIFRpbWVBeGlzLgogICAqIFBhcmFtZXRlcnMgd2lsbCBiZSBtZXJnZWQgaW4gY3VycmVudCBvcHRpb25zLgogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICBBdmFpbGFibGUgb3B0aW9uczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAge3N0cmluZ30gW29yaWVudGF0aW9uLmF4aXNdCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgIHtib29sZWFufSBbc2hvd01pbm9yTGFiZWxzXQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICB7Ym9vbGVhbn0gW3Nob3dNYWpvckxhYmVsc10KICAgKi8KICBUaW1lQXhpcy5wcm90b3R5cGUuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICBpZiAob3B0aW9ucykgewogICAgICAvLyBjb3B5IGFsbCBvcHRpb25zIHRoYXQgd2Uga25vdwogICAgICB1dGlsLnNlbGVjdGl2ZUV4dGVuZChbJ3Nob3dNaW5vckxhYmVscycsICdzaG93TWFqb3JMYWJlbHMnLCAnaGlkZGVuRGF0ZXMnLCAndGltZUF4aXMnXSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKCiAgICAgIC8vIGRlZXAgY29weSB0aGUgZm9ybWF0IG9wdGlvbnMKICAgICAgdXRpbC5zZWxlY3RpdmVEZWVwRXh0ZW5kKFsnZm9ybWF0J10sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CgogICAgICBpZiAoJ29yaWVudGF0aW9uJyBpbiBvcHRpb25zKSB7CiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLm9yaWVudGF0aW9uID09PSAnc3RyaW5nJykgewogICAgICAgICAgdGhpcy5vcHRpb25zLm9yaWVudGF0aW9uLmF4aXMgPSBvcHRpb25zLm9yaWVudGF0aW9uOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9wdGlvbnMub3JpZW50YXRpb24gPT09ICdvYmplY3QnICYmICdheGlzJyBpbiBvcHRpb25zLm9yaWVudGF0aW9uKSB7CiAgICAgICAgICB0aGlzLm9wdGlvbnMub3JpZW50YXRpb24uYXhpcyA9IG9wdGlvbnMub3JpZW50YXRpb24uYXhpczsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIGFwcGx5IGxvY2FsZSB0byBtb21lbnQuanMKICAgICAgLy8gVE9ETzogbm90IHNvIG5pY2UsIHRoaXMgaXMgYXBwbGllZCBnbG9iYWxseSB0byBtb21lbnQuanMKICAgICAgaWYgKCdsb2NhbGUnIGluIG9wdGlvbnMpIHsKICAgICAgICBpZiAodHlwZW9mIG1vbWVudC5sb2NhbGUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIC8vIG1vbWVudC5qcyAyLjguMSsKICAgICAgICAgIG1vbWVudC5sb2NhbGUob3B0aW9ucy5sb2NhbGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtb21lbnQubGFuZyhvcHRpb25zLmxvY2FsZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlIHRoZSBIVE1MIERPTSBmb3IgdGhlIFRpbWVBeGlzCiAgICovCiAgVGltZUF4aXMucHJvdG90eXBlLl9jcmVhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmRvbS5mb3JlZ3JvdW5kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5iYWNrZ3JvdW5kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgogICAgdGhpcy5kb20uZm9yZWdyb3VuZC5jbGFzc05hbWUgPSAndmlzLXRpbWUtYXhpcyB2aXMtZm9yZWdyb3VuZCc7CiAgICB0aGlzLmRvbS5iYWNrZ3JvdW5kLmNsYXNzTmFtZSA9ICd2aXMtdGltZS1heGlzIHZpcy1iYWNrZ3JvdW5kJzsKICB9OwoKICAvKioKICAgKiBEZXN0cm95IHRoZSBUaW1lQXhpcwogICAqLwogIFRpbWVBeGlzLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgLy8gcmVtb3ZlIGZyb20gRE9NCiAgICBpZiAodGhpcy5kb20uZm9yZWdyb3VuZC5wYXJlbnROb2RlKSB7CiAgICAgIHRoaXMuZG9tLmZvcmVncm91bmQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmRvbS5mb3JlZ3JvdW5kKTsKICAgIH0KICAgIGlmICh0aGlzLmRvbS5iYWNrZ3JvdW5kLnBhcmVudE5vZGUpIHsKICAgICAgdGhpcy5kb20uYmFja2dyb3VuZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZG9tLmJhY2tncm91bmQpOwogICAgfQoKICAgIHRoaXMuYm9keSA9IG51bGw7CiAgfTsKCiAgLyoqCiAgICogUmVwYWludCB0aGUgY29tcG9uZW50CiAgICogQHJldHVybiB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBjb21wb25lbnQgaXMgcmVzaXplZAogICAqLwogIFRpbWVBeGlzLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgcHJvcHMgPSB0aGlzLnByb3BzOwogICAgdmFyIGZvcmVncm91bmQgPSB0aGlzLmRvbS5mb3JlZ3JvdW5kOwogICAgdmFyIGJhY2tncm91bmQgPSB0aGlzLmRvbS5iYWNrZ3JvdW5kOwoKICAgIC8vIGRldGVybWluZSB0aGUgY29ycmVjdCBwYXJlbnQgRE9NIGVsZW1lbnQgKGRlcGVuZGluZyBvbiBvcHRpb24gb3JpZW50YXRpb24pCiAgICB2YXIgcGFyZW50ID0gdGhpcy5vcHRpb25zLm9yaWVudGF0aW9uLmF4aXMgPT0gJ3RvcCcgPyB0aGlzLmJvZHkuZG9tLnRvcCA6IHRoaXMuYm9keS5kb20uYm90dG9tOwogICAgdmFyIHBhcmVudENoYW5nZWQgPSBmb3JlZ3JvdW5kLnBhcmVudE5vZGUgIT09IHBhcmVudDsKCiAgICAvLyBjYWxjdWxhdGUgY2hhcmFjdGVyIHdpZHRoIGFuZCBoZWlnaHQKICAgIHRoaXMuX2NhbGN1bGF0ZUNoYXJTaXplKCk7CgogICAgLy8gVE9ETzogcmVjYWxjdWxhdGUgc2l6ZXMgb25seSBuZWVkZWQgd2hlbiBwYXJlbnQgaXMgcmVzaXplZCBvciBvcHRpb25zIGlzIGNoYW5nZWQKICAgIHZhciBzaG93TWlub3JMYWJlbHMgPSB0aGlzLm9wdGlvbnMuc2hvd01pbm9yTGFiZWxzICYmIHRoaXMub3B0aW9ucy5vcmllbnRhdGlvbi5heGlzICE9PSAnbm9uZSc7CiAgICB2YXIgc2hvd01ham9yTGFiZWxzID0gdGhpcy5vcHRpb25zLnNob3dNYWpvckxhYmVscyAmJiB0aGlzLm9wdGlvbnMub3JpZW50YXRpb24uYXhpcyAhPT0gJ25vbmUnOwoKICAgIC8vIGRldGVybWluZSB0aGUgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgZWxlbWVucyBmb3IgdGhlIGF4aXMKICAgIHByb3BzLm1pbm9yTGFiZWxIZWlnaHQgPSBzaG93TWlub3JMYWJlbHMgPyBwcm9wcy5taW5vckNoYXJIZWlnaHQgOiAwOwogICAgcHJvcHMubWFqb3JMYWJlbEhlaWdodCA9IHNob3dNYWpvckxhYmVscyA/IHByb3BzLm1ham9yQ2hhckhlaWdodCA6IDA7CiAgICBwcm9wcy5oZWlnaHQgPSBwcm9wcy5taW5vckxhYmVsSGVpZ2h0ICsgcHJvcHMubWFqb3JMYWJlbEhlaWdodDsKICAgIHByb3BzLndpZHRoID0gZm9yZWdyb3VuZC5vZmZzZXRXaWR0aDsKCiAgICBwcm9wcy5taW5vckxpbmVIZWlnaHQgPSB0aGlzLmJvZHkuZG9tUHJvcHMucm9vdC5oZWlnaHQgLSBwcm9wcy5tYWpvckxhYmVsSGVpZ2h0IC0gKHRoaXMub3B0aW9ucy5vcmllbnRhdGlvbi5heGlzID09ICd0b3AnID8gdGhpcy5ib2R5LmRvbVByb3BzLmJvdHRvbS5oZWlnaHQgOiB0aGlzLmJvZHkuZG9tUHJvcHMudG9wLmhlaWdodCk7CiAgICBwcm9wcy5taW5vckxpbmVXaWR0aCA9IDE7IC8vIFRPRE86IHJlYWxseSBjYWxjdWxhdGUgd2lkdGgKICAgIHByb3BzLm1ham9yTGluZUhlaWdodCA9IHByb3BzLm1pbm9yTGluZUhlaWdodCArIHByb3BzLm1ham9yTGFiZWxIZWlnaHQ7CiAgICBwcm9wcy5tYWpvckxpbmVXaWR0aCA9IDE7IC8vIFRPRE86IHJlYWxseSBjYWxjdWxhdGUgd2lkdGgKCiAgICAvLyAgdGFrZSBmb3JlZ3JvdW5kIGFuZCBiYWNrZ3JvdW5kIG9mZmxpbmUgd2hpbGUgdXBkYXRpbmcgKGlzIGFsbW9zdCB0d2ljZSBhcyBmYXN0KQogICAgdmFyIGZvcmVncm91bmROZXh0U2libGluZyA9IGZvcmVncm91bmQubmV4dFNpYmxpbmc7CiAgICB2YXIgYmFja2dyb3VuZE5leHRTaWJsaW5nID0gYmFja2dyb3VuZC5uZXh0U2libGluZzsKICAgIGZvcmVncm91bmQucGFyZW50Tm9kZSAmJiBmb3JlZ3JvdW5kLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZm9yZWdyb3VuZCk7CiAgICBiYWNrZ3JvdW5kLnBhcmVudE5vZGUgJiYgYmFja2dyb3VuZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGJhY2tncm91bmQpOwoKICAgIGZvcmVncm91bmQuc3R5bGUuaGVpZ2h0ID0gdGhpcy5wcm9wcy5oZWlnaHQgKyAncHgnOwoKICAgIHRoaXMuX3JlcGFpbnRMYWJlbHMoKTsKCiAgICAvLyBwdXQgRE9NIG9ubGluZSBhZ2FpbiAoYXQgdGhlIHNhbWUgcGxhY2UpCiAgICBpZiAoZm9yZWdyb3VuZE5leHRTaWJsaW5nKSB7CiAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoZm9yZWdyb3VuZCwgZm9yZWdyb3VuZE5leHRTaWJsaW5nKTsKICAgIH0gZWxzZSB7CiAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChmb3JlZ3JvdW5kKTsKICAgIH0KICAgIGlmIChiYWNrZ3JvdW5kTmV4dFNpYmxpbmcpIHsKICAgICAgdGhpcy5ib2R5LmRvbS5iYWNrZ3JvdW5kVmVydGljYWwuaW5zZXJ0QmVmb3JlKGJhY2tncm91bmQsIGJhY2tncm91bmROZXh0U2libGluZyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmJvZHkuZG9tLmJhY2tncm91bmRWZXJ0aWNhbC5hcHBlbmRDaGlsZChiYWNrZ3JvdW5kKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5faXNSZXNpemVkKCkgfHwgcGFyZW50Q2hhbmdlZDsKICB9OwoKICAvKioKICAgKiBSZXBhaW50IG1ham9yIGFuZCBtaW5vciB0ZXh0IGxhYmVscyBhbmQgdmVydGljYWwgZ3JpZCBsaW5lcwogICAqIEBwcml2YXRlCiAgICovCiAgVGltZUF4aXMucHJvdG90eXBlLl9yZXBhaW50TGFiZWxzID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG9yaWVudGF0aW9uID0gdGhpcy5vcHRpb25zLm9yaWVudGF0aW9uLmF4aXM7CgogICAgLy8gY2FsY3VsYXRlIHJhbmdlIGFuZCBzdGVwIChzdGVwIHN1Y2ggdGhhdCB3ZSBoYXZlIHNwYWNlIGZvciA3IGNoYXJhY3RlcnMgcGVyIGxhYmVsKQogICAgdmFyIHN0YXJ0ID0gdXRpbC5jb252ZXJ0KHRoaXMuYm9keS5yYW5nZS5zdGFydCwgJ051bWJlcicpOwogICAgdmFyIGVuZCA9IHV0aWwuY29udmVydCh0aGlzLmJvZHkucmFuZ2UuZW5kLCAnTnVtYmVyJyk7CiAgICB2YXIgdGltZUxhYmVsc2l6ZSA9IHRoaXMuYm9keS51dGlsLnRvVGltZSgodGhpcy5wcm9wcy5taW5vckNoYXJXaWR0aCB8fCAxMCkgKiA3KS52YWx1ZU9mKCk7CiAgICB2YXIgbWluaW11bVN0ZXAgPSB0aW1lTGFiZWxzaXplIC0gRGF0ZVV0aWwuZ2V0SGlkZGVuRHVyYXRpb25CZWZvcmUodGhpcy5ib2R5LmhpZGRlbkRhdGVzLCB0aGlzLmJvZHkucmFuZ2UsIHRpbWVMYWJlbHNpemUpOwogICAgbWluaW11bVN0ZXAgLT0gdGhpcy5ib2R5LnV0aWwudG9UaW1lKDApLnZhbHVlT2YoKTsKCiAgICB2YXIgc3RlcCA9IG5ldyBUaW1lU3RlcChuZXcgRGF0ZShzdGFydCksIG5ldyBEYXRlKGVuZCksIG1pbmltdW1TdGVwLCB0aGlzLmJvZHkuaGlkZGVuRGF0ZXMpOwogICAgaWYgKHRoaXMub3B0aW9ucy5mb3JtYXQpIHsKICAgICAgc3RlcC5zZXRGb3JtYXQodGhpcy5vcHRpb25zLmZvcm1hdCk7CiAgICB9CiAgICBpZiAodGhpcy5vcHRpb25zLnRpbWVBeGlzKSB7CiAgICAgIHN0ZXAuc2V0U2NhbGUodGhpcy5vcHRpb25zLnRpbWVBeGlzKTsKICAgIH0KICAgIHRoaXMuc3RlcCA9IHN0ZXA7CgogICAgLy8gTW92ZSBhbGwgRE9NIGVsZW1lbnRzIHRvIGEgInJlZHVuZGFudCIgbGlzdCwgd2hlcmUgdGhleQogICAgLy8gY2FuIGJlIHBpY2tlZCBmb3IgcmUtdXNlLCBhbmQgY2xlYXIgdGhlIGxpc3RzIHdpdGggbGluZXMgYW5kIHRleHRzLgogICAgLy8gQXQgdGhlIGVuZCBvZiB0aGUgZnVuY3Rpb24gX3JlcGFpbnRMYWJlbHMsIGxlZnQgb3ZlciBlbGVtZW50cyB3aWxsIGJlIGNsZWFuZWQgdXAKICAgIHZhciBkb20gPSB0aGlzLmRvbTsKICAgIGRvbS5yZWR1bmRhbnQubGluZXMgPSBkb20ubGluZXM7CiAgICBkb20ucmVkdW5kYW50Lm1ham9yVGV4dHMgPSBkb20ubWFqb3JUZXh0czsKICAgIGRvbS5yZWR1bmRhbnQubWlub3JUZXh0cyA9IGRvbS5taW5vclRleHRzOwogICAgZG9tLmxpbmVzID0gW107CiAgICBkb20ubWFqb3JUZXh0cyA9IFtdOwogICAgZG9tLm1pbm9yVGV4dHMgPSBbXTsKCiAgICB2YXIgY3VyOwogICAgdmFyIHggPSAwOwogICAgdmFyIGlzTWFqb3I7CiAgICB2YXIgeFByZXYgPSAwOwogICAgdmFyIHdpZHRoID0gMDsKICAgIHZhciBwcmV2TGluZTsKICAgIHZhciB4Rmlyc3RNYWpvckxhYmVsID0gdW5kZWZpbmVkOwogICAgdmFyIG1heCA9IDA7CiAgICB2YXIgY2xhc3NOYW1lOwoKICAgIHN0ZXAuZmlyc3QoKTsKICAgIHdoaWxlIChzdGVwLmhhc05leHQoKSAmJiBtYXggPCAxMDAwKSB7CiAgICAgIG1heCsrOwoKICAgICAgY3VyID0gc3RlcC5nZXRDdXJyZW50KCk7CiAgICAgIGlzTWFqb3IgPSBzdGVwLmlzTWFqb3IoKTsKICAgICAgY2xhc3NOYW1lID0gc3RlcC5nZXRDbGFzc05hbWUoKTsKCiAgICAgIHhQcmV2ID0geDsKICAgICAgeCA9IHRoaXMuYm9keS51dGlsLnRvU2NyZWVuKGN1cik7CiAgICAgIHdpZHRoID0geCAtIHhQcmV2OwogICAgICBpZiAocHJldkxpbmUpIHsKICAgICAgICBwcmV2TGluZS5zdHlsZS53aWR0aCA9IHdpZHRoICsgJ3B4JzsKICAgICAgfQoKICAgICAgaWYgKHRoaXMub3B0aW9ucy5zaG93TWlub3JMYWJlbHMpIHsKICAgICAgICB0aGlzLl9yZXBhaW50TWlub3JUZXh0KHgsIHN0ZXAuZ2V0TGFiZWxNaW5vcigpLCBvcmllbnRhdGlvbiwgY2xhc3NOYW1lKTsKICAgICAgfQoKICAgICAgaWYgKGlzTWFqb3IgJiYgdGhpcy5vcHRpb25zLnNob3dNYWpvckxhYmVscykgewogICAgICAgIGlmICh4ID4gMCkgewogICAgICAgICAgaWYgKHhGaXJzdE1ham9yTGFiZWwgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHhGaXJzdE1ham9yTGFiZWwgPSB4OwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5fcmVwYWludE1ham9yVGV4dCh4LCBzdGVwLmdldExhYmVsTWFqb3IoKSwgb3JpZW50YXRpb24sIGNsYXNzTmFtZSk7CiAgICAgICAgfQogICAgICAgIHByZXZMaW5lID0gdGhpcy5fcmVwYWludE1ham9yTGluZSh4LCBvcmllbnRhdGlvbiwgY2xhc3NOYW1lKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwcmV2TGluZSA9IHRoaXMuX3JlcGFpbnRNaW5vckxpbmUoeCwgb3JpZW50YXRpb24sIGNsYXNzTmFtZSk7CiAgICAgIH0KCiAgICAgIHN0ZXAubmV4dCgpOwogICAgfQoKICAgIC8vIGNyZWF0ZSBhIG1ham9yIGxhYmVsIG9uIHRoZSBsZWZ0IHdoZW4gbmVlZGVkCiAgICBpZiAodGhpcy5vcHRpb25zLnNob3dNYWpvckxhYmVscykgewogICAgICB2YXIgbGVmdFRpbWUgPSB0aGlzLmJvZHkudXRpbC50b1RpbWUoMCksCiAgICAgICAgICBsZWZ0VGV4dCA9IHN0ZXAuZ2V0TGFiZWxNYWpvcihsZWZ0VGltZSksCiAgICAgICAgICB3aWR0aFRleHQgPSBsZWZ0VGV4dC5sZW5ndGggKiAodGhpcy5wcm9wcy5tYWpvckNoYXJXaWR0aCB8fCAxMCkgKyAxMDsgLy8gdXBwZXIgYm91bmQgZXN0aW1hdGlvbgoKICAgICAgaWYgKHhGaXJzdE1ham9yTGFiZWwgPT0gdW5kZWZpbmVkIHx8IHdpZHRoVGV4dCA8IHhGaXJzdE1ham9yTGFiZWwpIHsKICAgICAgICB0aGlzLl9yZXBhaW50TWFqb3JUZXh0KDAsIGxlZnRUZXh0LCBvcmllbnRhdGlvbiwgY2xhc3NOYW1lKTsKICAgICAgfQogICAgfQoKICAgIC8vIENsZWFudXAgbGVmdG92ZXIgRE9NIGVsZW1lbnRzIGZyb20gdGhlIHJlZHVuZGFudCBsaXN0CiAgICB1dGlsLmZvckVhY2godGhpcy5kb20ucmVkdW5kYW50LCBmdW5jdGlvbiAoYXJyKSB7CiAgICAgIHdoaWxlIChhcnIubGVuZ3RoKSB7CiAgICAgICAgdmFyIGVsZW0gPSBhcnIucG9wKCk7CiAgICAgICAgaWYgKGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlKSB7CiAgICAgICAgICBlbGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9OwoKICAvKioKICAgKiBDcmVhdGUgYSBtaW5vciBsYWJlbCBmb3IgdGhlIGF4aXMgYXQgcG9zaXRpb24geAogICAqIEBwYXJhbSB7TnVtYmVyfSB4CiAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQKICAgKiBAcGFyYW0ge1N0cmluZ30gb3JpZW50YXRpb24gICAidG9wIiBvciAiYm90dG9tIiAoZGVmYXVsdCkKICAgKiBAcGFyYW0ge1N0cmluZ30gY2xhc3NOYW1lCiAgICogQHByaXZhdGUKICAgKi8KICBUaW1lQXhpcy5wcm90b3R5cGUuX3JlcGFpbnRNaW5vclRleHQgPSBmdW5jdGlvbiAoeCwgdGV4dCwgb3JpZW50YXRpb24sIGNsYXNzTmFtZSkgewogICAgLy8gcmV1c2UgcmVkdW5kYW50IGxhYmVsCiAgICB2YXIgbGFiZWwgPSB0aGlzLmRvbS5yZWR1bmRhbnQubWlub3JUZXh0cy5zaGlmdCgpOwoKICAgIGlmICghbGFiZWwpIHsKICAgICAgLy8gY3JlYXRlIG5ldyBsYWJlbAogICAgICB2YXIgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnKTsKICAgICAgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgbGFiZWwuYXBwZW5kQ2hpbGQoY29udGVudCk7CiAgICAgIHRoaXMuZG9tLmZvcmVncm91bmQuYXBwZW5kQ2hpbGQobGFiZWwpOwogICAgfQogICAgdGhpcy5kb20ubWlub3JUZXh0cy5wdXNoKGxhYmVsKTsKCiAgICBsYWJlbC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9IHRleHQ7CgogICAgbGFiZWwuc3R5bGUudG9wID0gb3JpZW50YXRpb24gPT0gJ3RvcCcgPyB0aGlzLnByb3BzLm1ham9yTGFiZWxIZWlnaHQgKyAncHgnIDogJzAnOwogICAgbGFiZWwuc3R5bGUubGVmdCA9IHggKyAncHgnOwogICAgbGFiZWwuY2xhc3NOYW1lID0gJ3Zpcy10ZXh0IHZpcy1taW5vciAnICsgY2xhc3NOYW1lOwogICAgLy9sYWJlbC50aXRsZSA9IHRpdGxlOyAgLy8gVE9ETzogdGhpcyBpcyBhIGhlYXZ5IG9wZXJhdGlvbgogIH07CgogIC8qKgogICAqIENyZWF0ZSBhIE1ham9yIGxhYmVsIGZvciB0aGUgYXhpcyBhdCBwb3NpdGlvbiB4CiAgICogQHBhcmFtIHtOdW1iZXJ9IHgKICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dAogICAqIEBwYXJhbSB7U3RyaW5nfSBvcmllbnRhdGlvbiAgICJ0b3AiIG9yICJib3R0b20iIChkZWZhdWx0KQogICAqIEBwYXJhbSB7U3RyaW5nfSBjbGFzc05hbWUKICAgKiBAcHJpdmF0ZQogICAqLwogIFRpbWVBeGlzLnByb3RvdHlwZS5fcmVwYWludE1ham9yVGV4dCA9IGZ1bmN0aW9uICh4LCB0ZXh0LCBvcmllbnRhdGlvbiwgY2xhc3NOYW1lKSB7CiAgICAvLyByZXVzZSByZWR1bmRhbnQgbGFiZWwKICAgIHZhciBsYWJlbCA9IHRoaXMuZG9tLnJlZHVuZGFudC5tYWpvclRleHRzLnNoaWZ0KCk7CgogICAgaWYgKCFsYWJlbCkgewogICAgICAvLyBjcmVhdGUgbGFiZWwKICAgICAgdmFyIGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTsKICAgICAgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgbGFiZWwuYXBwZW5kQ2hpbGQoY29udGVudCk7CiAgICAgIHRoaXMuZG9tLmZvcmVncm91bmQuYXBwZW5kQ2hpbGQobGFiZWwpOwogICAgfQogICAgdGhpcy5kb20ubWFqb3JUZXh0cy5wdXNoKGxhYmVsKTsKCiAgICBsYWJlbC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9IHRleHQ7CiAgICBsYWJlbC5jbGFzc05hbWUgPSAndmlzLXRleHQgdmlzLW1ham9yICcgKyBjbGFzc05hbWU7CiAgICAvL2xhYmVsLnRpdGxlID0gdGl0bGU7IC8vIFRPRE86IHRoaXMgaXMgYSBoZWF2eSBvcGVyYXRpb24KCiAgICBsYWJlbC5zdHlsZS50b3AgPSBvcmllbnRhdGlvbiA9PSAndG9wJyA/ICcwJyA6IHRoaXMucHJvcHMubWlub3JMYWJlbEhlaWdodCArICdweCc7CiAgICBsYWJlbC5zdHlsZS5sZWZ0ID0geCArICdweCc7CiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlIGEgbWlub3IgbGluZSBmb3IgdGhlIGF4aXMgYXQgcG9zaXRpb24geAogICAqIEBwYXJhbSB7TnVtYmVyfSB4CiAgICogQHBhcmFtIHtTdHJpbmd9IG9yaWVudGF0aW9uICAgInRvcCIgb3IgImJvdHRvbSIgKGRlZmF1bHQpCiAgICogQHBhcmFtIHtTdHJpbmd9IGNsYXNzTmFtZQogICAqIEByZXR1cm4ge0VsZW1lbnR9IFJldHVybnMgdGhlIGNyZWF0ZWQgbGluZQogICAqIEBwcml2YXRlCiAgICovCiAgVGltZUF4aXMucHJvdG90eXBlLl9yZXBhaW50TWlub3JMaW5lID0gZnVuY3Rpb24gKHgsIG9yaWVudGF0aW9uLCBjbGFzc05hbWUpIHsKICAgIC8vIHJldXNlIHJlZHVuZGFudCBsaW5lCiAgICB2YXIgbGluZSA9IHRoaXMuZG9tLnJlZHVuZGFudC5saW5lcy5zaGlmdCgpOwogICAgaWYgKCFsaW5lKSB7CiAgICAgIC8vIGNyZWF0ZSB2ZXJ0aWNhbCBsaW5lCiAgICAgIGxpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgdGhpcy5kb20uYmFja2dyb3VuZC5hcHBlbmRDaGlsZChsaW5lKTsKICAgIH0KICAgIHRoaXMuZG9tLmxpbmVzLnB1c2gobGluZSk7CgogICAgdmFyIHByb3BzID0gdGhpcy5wcm9wczsKICAgIGlmIChvcmllbnRhdGlvbiA9PSAndG9wJykgewogICAgICBsaW5lLnN0eWxlLnRvcCA9IHByb3BzLm1ham9yTGFiZWxIZWlnaHQgKyAncHgnOwogICAgfSBlbHNlIHsKICAgICAgbGluZS5zdHlsZS50b3AgPSB0aGlzLmJvZHkuZG9tUHJvcHMudG9wLmhlaWdodCArICdweCc7CiAgICB9CiAgICBsaW5lLnN0eWxlLmhlaWdodCA9IHByb3BzLm1pbm9yTGluZUhlaWdodCArICdweCc7CiAgICBsaW5lLnN0eWxlLmxlZnQgPSB4IC0gcHJvcHMubWlub3JMaW5lV2lkdGggLyAyICsgJ3B4JzsKCiAgICBsaW5lLmNsYXNzTmFtZSA9ICd2aXMtZ3JpZCB2aXMtdmVydGljYWwgdmlzLW1pbm9yICcgKyBjbGFzc05hbWU7CgogICAgcmV0dXJuIGxpbmU7CiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlIGEgTWFqb3IgbGluZSBmb3IgdGhlIGF4aXMgYXQgcG9zaXRpb24geAogICAqIEBwYXJhbSB7TnVtYmVyfSB4CiAgICogQHBhcmFtIHtTdHJpbmd9IG9yaWVudGF0aW9uICAgInRvcCIgb3IgImJvdHRvbSIgKGRlZmF1bHQpCiAgICogQHBhcmFtIHtTdHJpbmd9IGNsYXNzTmFtZQogICAqIEByZXR1cm4ge0VsZW1lbnR9IFJldHVybnMgdGhlIGNyZWF0ZWQgbGluZQogICAqIEBwcml2YXRlCiAgICovCiAgVGltZUF4aXMucHJvdG90eXBlLl9yZXBhaW50TWFqb3JMaW5lID0gZnVuY3Rpb24gKHgsIG9yaWVudGF0aW9uLCBjbGFzc05hbWUpIHsKICAgIC8vIHJldXNlIHJlZHVuZGFudCBsaW5lCiAgICB2YXIgbGluZSA9IHRoaXMuZG9tLnJlZHVuZGFudC5saW5lcy5zaGlmdCgpOwogICAgaWYgKCFsaW5lKSB7CiAgICAgIC8vIGNyZWF0ZSB2ZXJ0aWNhbCBsaW5lCiAgICAgIGxpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgdGhpcy5kb20uYmFja2dyb3VuZC5hcHBlbmRDaGlsZChsaW5lKTsKICAgIH0KICAgIHRoaXMuZG9tLmxpbmVzLnB1c2gobGluZSk7CgogICAgdmFyIHByb3BzID0gdGhpcy5wcm9wczsKICAgIGlmIChvcmllbnRhdGlvbiA9PSAndG9wJykgewogICAgICBsaW5lLnN0eWxlLnRvcCA9ICcwJzsKICAgIH0gZWxzZSB7CiAgICAgIGxpbmUuc3R5bGUudG9wID0gdGhpcy5ib2R5LmRvbVByb3BzLnRvcC5oZWlnaHQgKyAncHgnOwogICAgfQogICAgbGluZS5zdHlsZS5sZWZ0ID0geCAtIHByb3BzLm1ham9yTGluZVdpZHRoIC8gMiArICdweCc7CiAgICBsaW5lLnN0eWxlLmhlaWdodCA9IHByb3BzLm1ham9yTGluZUhlaWdodCArICdweCc7CgogICAgbGluZS5jbGFzc05hbWUgPSAndmlzLWdyaWQgdmlzLXZlcnRpY2FsIHZpcy1tYWpvciAnICsgY2xhc3NOYW1lOwoKICAgIHJldHVybiBsaW5lOwogIH07CgogIC8qKgogICAqIERldGVybWluZSB0aGUgc2l6ZSBvZiB0ZXh0IG9uIHRoZSBheGlzIChib3RoIG1ham9yIGFuZCBtaW5vciBheGlzKS4KICAgKiBUaGUgc2l6ZSBpcyBjYWxjdWxhdGVkIG9ubHkgb25jZSBhbmQgdGhlbiBjYWNoZWQgaW4gdGhpcy5wcm9wcy4KICAgKiBAcHJpdmF0ZQogICAqLwogIFRpbWVBeGlzLnByb3RvdHlwZS5fY2FsY3VsYXRlQ2hhclNpemUgPSBmdW5jdGlvbiAoKSB7CiAgICAvLyBOb3RlOiBXZSBjYWxjdWxhdGUgY2hhciBzaXplIHdpdGggZXZlcnkgcmVkcmF3LiBTaXplIG1heSBjaGFuZ2UsIGZvcgogICAgLy8gZXhhbXBsZSB3aGVuIGFueSBvZiB0aGUgdGltZWxpbmVzIHBhcmVudHMgaGFkIGRpc3BsYXk6bm9uZSBmb3IgZXhhbXBsZS4KCiAgICAvLyBkZXRlcm1pbmUgdGhlIGNoYXIgd2lkdGggYW5kIGhlaWdodCBvbiB0aGUgbWlub3IgYXhpcwogICAgaWYgKCF0aGlzLmRvbS5tZWFzdXJlQ2hhck1pbm9yKSB7CiAgICAgIHRoaXMuZG9tLm1lYXN1cmVDaGFyTWlub3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdESVYnKTsKICAgICAgdGhpcy5kb20ubWVhc3VyZUNoYXJNaW5vci5jbGFzc05hbWUgPSAndmlzLXRleHQgdmlzLW1pbm9yIHZpcy1tZWFzdXJlJzsKICAgICAgdGhpcy5kb20ubWVhc3VyZUNoYXJNaW5vci5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CgogICAgICB0aGlzLmRvbS5tZWFzdXJlQ2hhck1pbm9yLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcwJykpOwogICAgICB0aGlzLmRvbS5mb3JlZ3JvdW5kLmFwcGVuZENoaWxkKHRoaXMuZG9tLm1lYXN1cmVDaGFyTWlub3IpOwogICAgfQogICAgdGhpcy5wcm9wcy5taW5vckNoYXJIZWlnaHQgPSB0aGlzLmRvbS5tZWFzdXJlQ2hhck1pbm9yLmNsaWVudEhlaWdodDsKICAgIHRoaXMucHJvcHMubWlub3JDaGFyV2lkdGggPSB0aGlzLmRvbS5tZWFzdXJlQ2hhck1pbm9yLmNsaWVudFdpZHRoOwoKICAgIC8vIGRldGVybWluZSB0aGUgY2hhciB3aWR0aCBhbmQgaGVpZ2h0IG9uIHRoZSBtYWpvciBheGlzCiAgICBpZiAoIXRoaXMuZG9tLm1lYXN1cmVDaGFyTWFqb3IpIHsKICAgICAgdGhpcy5kb20ubWVhc3VyZUNoYXJNYWpvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0RJVicpOwogICAgICB0aGlzLmRvbS5tZWFzdXJlQ2hhck1ham9yLmNsYXNzTmFtZSA9ICd2aXMtdGV4dCB2aXMtbWFqb3IgdmlzLW1lYXN1cmUnOwogICAgICB0aGlzLmRvbS5tZWFzdXJlQ2hhck1ham9yLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKCiAgICAgIHRoaXMuZG9tLm1lYXN1cmVDaGFyTWFqb3IuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJzAnKSk7CiAgICAgIHRoaXMuZG9tLmZvcmVncm91bmQuYXBwZW5kQ2hpbGQodGhpcy5kb20ubWVhc3VyZUNoYXJNYWpvcik7CiAgICB9CiAgICB0aGlzLnByb3BzLm1ham9yQ2hhckhlaWdodCA9IHRoaXMuZG9tLm1lYXN1cmVDaGFyTWFqb3IuY2xpZW50SGVpZ2h0OwogICAgdGhpcy5wcm9wcy5tYWpvckNoYXJXaWR0aCA9IHRoaXMuZG9tLm1lYXN1cmVDaGFyTWFqb3IuY2xpZW50V2lkdGg7CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBUaW1lQXhpczsKCi8qKiovIH0sCi8qIDQyICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciBrZXljaGFybSA9IF9fd2VicGFja19yZXF1aXJlX18oNDMpOwogIHZhciBFbWl0dGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7CiAgdmFyIEhhbW1lciA9IF9fd2VicGFja19yZXF1aXJlX18oMjMpOwogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgLyoqCiAgICogVHVybiBhbiBlbGVtZW50IGludG8gYW4gY2xpY2tUb1VzZSBlbGVtZW50LgogICAqIFdoZW4gbm90IGFjdGl2ZSwgdGhlIGVsZW1lbnQgaGFzIGEgdHJhbnNwYXJlbnQgb3ZlcmxheS4gV2hlbiB0aGUgb3ZlcmxheSBpcwogICAqIGNsaWNrZWQsIHRoZSBtb2RlIGlzIGNoYW5nZWQgdG8gYWN0aXZlLgogICAqIFdoZW4gYWN0aXZlLCB0aGUgZWxlbWVudCBpcyBkaXNwbGF5ZWQgd2l0aCBhIGJsdWUgYm9yZGVyIGFyb3VuZCBpdCwgYW5kCiAgICogdGhlIGludGVyYWN0aXZlIGNvbnRlbnRzIG9mIHRoZSBlbGVtZW50IGNhbiBiZSB1c2VkLiBXaGVuIGNsaWNrZWQgb3V0c2lkZQogICAqIHRoZSBlbGVtZW50LCB0aGUgZWxlbWVudHMgbW9kZSBpcyBjaGFuZ2VkIHRvIGluYWN0aXZlLgogICAqIEBwYXJhbSB7RWxlbWVudH0gY29udGFpbmVyCiAgICogQGNvbnN0cnVjdG9yCiAgICovCiAgZnVuY3Rpb24gQWN0aXZhdG9yKGNvbnRhaW5lcikgewogICAgdGhpcy5hY3RpdmUgPSBmYWxzZTsKCiAgICB0aGlzLmRvbSA9IHsKICAgICAgY29udGFpbmVyOiBjb250YWluZXIKICAgIH07CgogICAgdGhpcy5kb20ub3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20ub3ZlcmxheS5jbGFzc05hbWUgPSAndmlzLW92ZXJsYXknOwoKICAgIHRoaXMuZG9tLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmRvbS5vdmVybGF5KTsKCiAgICB0aGlzLmhhbW1lciA9IEhhbW1lcih0aGlzLmRvbS5vdmVybGF5KTsKICAgIHRoaXMuaGFtbWVyLm9uKCd0YXAnLCB0aGlzLl9vblRhcE92ZXJsYXkuYmluZCh0aGlzKSk7CgogICAgLy8gYmxvY2sgYWxsIHRvdWNoIGV2ZW50cyAoZXhjZXB0IHRhcCkKICAgIHZhciBtZSA9IHRoaXM7CiAgICB2YXIgZXZlbnRzID0gWyd0YXAnLCAnZG91YmxldGFwJywgJ3ByZXNzJywgJ3BpbmNoJywgJ3BhbicsICdwYW5zdGFydCcsICdwYW5tb3ZlJywgJ3BhbmVuZCddOwogICAgZXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIG1lLmhhbW1lci5vbihldmVudCwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIH0pOwogICAgfSk7CgogICAgLy8gYXR0YWNoIGEgY2xpY2sgZXZlbnQgdG8gdGhlIHdpbmRvdywgaW4gb3JkZXIgdG8gZGVhY3RpdmF0ZSB3aGVuIGNsaWNraW5nIG91dHNpZGUgdGhlIHRpbWVsaW5lCiAgICBpZiAoZG9jdW1lbnQgJiYgZG9jdW1lbnQuYm9keSkgewogICAgICB0aGlzLm9uQ2xpY2sgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBpZiAoIV9oYXNQYXJlbnQoZXZlbnQudGFyZ2V0LCBjb250YWluZXIpKSB7CiAgICAgICAgICBtZS5kZWFjdGl2YXRlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsaWNrKTsKICAgIH0KCiAgICBpZiAodGhpcy5rZXljaGFybSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHRoaXMua2V5Y2hhcm0uZGVzdHJveSgpOwogICAgfQogICAgdGhpcy5rZXljaGFybSA9IGtleWNoYXJtKCk7CgogICAgLy8ga2V5Y2hhcm0gbGlzdGVuZXIgb25seSBib3VuZGVkIHdoZW4gYWN0aXZlKQogICAgdGhpcy5lc2NMaXN0ZW5lciA9IHRoaXMuZGVhY3RpdmF0ZS5iaW5kKHRoaXMpOwogIH0KCiAgLy8gdHVybiBpbnRvIGFuIGV2ZW50IGVtaXR0ZXIKICBFbWl0dGVyKEFjdGl2YXRvci5wcm90b3R5cGUpOwoKICAvLyBUaGUgY3VycmVudGx5IGFjdGl2ZSBhY3RpdmF0b3IKICBBY3RpdmF0b3IuY3VycmVudCA9IG51bGw7CgogIC8qKgogICAqIERlc3Ryb3kgdGhlIGFjdGl2YXRvci4gQ2xlYW5zIHVwIGFsbCBjcmVhdGVkIERPTSBhbmQgZXZlbnQgbGlzdGVuZXJzCiAgICovCiAgQWN0aXZhdG9yLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5kZWFjdGl2YXRlKCk7CgogICAgLy8gcmVtb3ZlIGRvbQogICAgdGhpcy5kb20ub3ZlcmxheS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZG9tLm92ZXJsYXkpOwoKICAgIC8vIHJlbW92ZSBnbG9iYWwgZXZlbnQgbGlzdGVuZXIKICAgIGlmICh0aGlzLm9uQ2xpY2spIHsKICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbGljayk7CiAgICB9CgogICAgLy8gY2xlYW51cCBoYW1tZXIgaW5zdGFuY2VzCiAgICB0aGlzLmhhbW1lci5kZXN0cm95KCk7CiAgICB0aGlzLmhhbW1lciA9IG51bGw7CiAgICAvLyBGSVhNRTogY2xlYW5pbmcgdXAgaGFtbWVyIGluc3RhbmNlcyBkb2Vzbid0IHdvcmsgKFRpbWVsaW5lIG5vdCByZW1vdmVkIGZyb20gbWVtb3J5KQogIH07CgogIC8qKgogICAqIEFjdGl2YXRlIHRoZSBlbGVtZW50CiAgICogT3ZlcmxheSBpcyBoaWRkZW4sIGVsZW1lbnQgaXMgZGVjb3JhdGVkIHdpdGggYSBibHVlIHNoYWRvdyBib3JkZXIKICAgKi8KICBBY3RpdmF0b3IucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24gKCkgewogICAgLy8gd2UgYWxsb3cgb25seSBvbmUgYWN0aXZlIGFjdGl2YXRvciBhdCBhIHRpbWUKICAgIGlmIChBY3RpdmF0b3IuY3VycmVudCkgewogICAgICBBY3RpdmF0b3IuY3VycmVudC5kZWFjdGl2YXRlKCk7CiAgICB9CiAgICBBY3RpdmF0b3IuY3VycmVudCA9IHRoaXM7CgogICAgdGhpcy5hY3RpdmUgPSB0cnVlOwogICAgdGhpcy5kb20ub3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgdXRpbC5hZGRDbGFzc05hbWUodGhpcy5kb20uY29udGFpbmVyLCAndmlzLWFjdGl2ZScpOwoKICAgIHRoaXMuZW1pdCgnY2hhbmdlJyk7CiAgICB0aGlzLmVtaXQoJ2FjdGl2YXRlJyk7CgogICAgLy8gdWdseSBoYWNrOiBiaW5kIEVTQyBhZnRlciBlbWl0dGluZyB0aGUgZXZlbnRzLCBhcyB0aGUgTmV0d29yayByZWJpbmRzIGFsbAogICAgLy8ga2V5Ym9hcmQgZXZlbnRzIG9uIGEgJ2NoYW5nZScgZXZlbnQKICAgIHRoaXMua2V5Y2hhcm0uYmluZCgnZXNjJywgdGhpcy5lc2NMaXN0ZW5lcik7CiAgfTsKCiAgLyoqCiAgICogRGVhY3RpdmF0ZSB0aGUgZWxlbWVudAogICAqIE92ZXJsYXkgaXMgZGlzcGxheWVkIG9uIHRvcCBvZiB0aGUgZWxlbWVudAogICAqLwogIEFjdGl2YXRvci5wcm90b3R5cGUuZGVhY3RpdmF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuYWN0aXZlID0gZmFsc2U7CiAgICB0aGlzLmRvbS5vdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgIHV0aWwucmVtb3ZlQ2xhc3NOYW1lKHRoaXMuZG9tLmNvbnRhaW5lciwgJ3Zpcy1hY3RpdmUnKTsKICAgIHRoaXMua2V5Y2hhcm0udW5iaW5kKCdlc2MnLCB0aGlzLmVzY0xpc3RlbmVyKTsKCiAgICB0aGlzLmVtaXQoJ2NoYW5nZScpOwogICAgdGhpcy5lbWl0KCdkZWFjdGl2YXRlJyk7CiAgfTsKCiAgLyoqCiAgICogSGFuZGxlIGEgdGFwIGV2ZW50OiBhY3RpdmF0ZSB0aGUgY29udGFpbmVyCiAgICogQHBhcmFtIGV2ZW50CiAgICogQHByaXZhdGUKICAgKi8KICBBY3RpdmF0b3IucHJvdG90eXBlLl9vblRhcE92ZXJsYXkgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIC8vIGFjdGl2YXRlIHRoZSBjb250YWluZXIKICAgIHRoaXMuYWN0aXZhdGUoKTsKICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogIH07CgogIC8qKgogICAqIFRlc3Qgd2hldGhlciB0aGUgZWxlbWVudCBoYXMgdGhlIHJlcXVlc3RlZCBwYXJlbnQgZWxlbWVudCBzb21ld2hlcmUgaW4KICAgKiBpdHMgY2hhaW4gb2YgcGFyZW50IG5vZGVzLgogICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnQKICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBwYXJlbnQKICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIHdoZW4gdGhlIHBhcmVudCBpcyBmb3VuZCBzb21ld2hlcmUgaW4gdGhlCiAgICogICAgICAgICAgICAgICAgICAgIGNoYWluIG9mIHBhcmVudCBub2Rlcy4KICAgKiBAcHJpdmF0ZQogICAqLwogIGZ1bmN0aW9uIF9oYXNQYXJlbnQoZWxlbWVudCwgcGFyZW50KSB7CiAgICB3aGlsZSAoZWxlbWVudCkgewogICAgICBpZiAoZWxlbWVudCA9PT0gcGFyZW50KSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIG1vZHVsZS5leHBvcnRzID0gQWN0aXZhdG9yOwoKLyoqKi8gfSwKLyogNDMgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogIHZhciBfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18sIF9fV0VCUEFDS19BTURfREVGSU5FX0FSUkFZX18sIF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fOyJ1c2Ugc3RyaWN0IjsKICAvKioKICAgKiBDcmVhdGVkIGJ5IEFsZXggb24gMTEvNi8yMDE0LgogICAqLwoKICAvLyBodHRwczovL2dpdGh1Yi5jb20vdW1kanMvdW1kL2Jsb2IvbWFzdGVyL3JldHVybkV4cG9ydHMuanMjTDQwLUw2MAogIC8vIGlmIHRoZSBtb2R1bGUgaGFzIG5vIGRlcGVuZGVuY2llcywgdGhlIGFib3ZlIHBhdHRlcm4gY2FuIGJlIHNpbXBsaWZpZWQgdG8KICAoZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAgIGlmICh0cnVlKSB7CiAgICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KICAgICAgIShfX1dFQlBBQ0tfQU1EX0RFRklORV9BUlJBWV9fID0gW10sIF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXyA9IChmYWN0b3J5KSwgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gPSAodHlwZW9mIF9fV0VCUEFDS19BTURfREVGSU5FX0ZBQ1RPUllfXyA9PT0gJ2Z1bmN0aW9uJyA/IChfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18uYXBwbHkoZXhwb3J0cywgX19XRUJQQUNLX0FNRF9ERUZJTkVfQVJSQVlfXykpIDogX19XRUJQQUNLX0FNRF9ERUZJTkVfRkFDVE9SWV9fKSwgX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gIT09IHVuZGVmaW5lZCAmJiAobW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXykpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpIHsKICAgICAgLy8gTm9kZS4gRG9lcyBub3Qgd29yayB3aXRoIHN0cmljdCBDb21tb25KUywgYnV0CiAgICAgIC8vIG9ubHkgQ29tbW9uSlMtbGlrZSBlbnZpcm9ubWVudHMgdGhhdCBzdXBwb3J0IG1vZHVsZS5leHBvcnRzLAogICAgICAvLyBsaWtlIE5vZGUuCiAgICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwogICAgfSBlbHNlIHsKICAgICAgLy8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdykKICAgICAgcm9vdC5rZXljaGFybSA9IGZhY3RvcnkoKTsKICAgIH0KICB9KHRoaXMsIGZ1bmN0aW9uICgpIHsKCiAgICBmdW5jdGlvbiBrZXljaGFybShvcHRpb25zKSB7CiAgICAgIHZhciBwcmV2ZW50RGVmYXVsdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5wcmV2ZW50RGVmYXVsdCB8fCBmYWxzZTsKCiAgICAgIHZhciBjb250YWluZXIgPSBvcHRpb25zICYmIG9wdGlvbnMuY29udGFpbmVyIHx8IHdpbmRvdzsKCiAgICAgIHZhciBfZXhwb3J0RnVuY3Rpb25zID0ge307CiAgICAgIHZhciBfYm91bmQgPSB7a2V5ZG93bjp7fSwga2V5dXA6e319OwogICAgICB2YXIgX2tleXMgPSB7fTsKICAgICAgdmFyIGk7CgogICAgICAvLyBhIC0gegogICAgICBmb3IgKGkgPSA5NzsgaSA8PSAxMjI7IGkrKykge19rZXlzW1N0cmluZy5mcm9tQ2hhckNvZGUoaSldID0ge2NvZGU6NjUgKyAoaSAtIDk3KSwgc2hpZnQ6IGZhbHNlfTt9CiAgICAgIC8vIEEgLSBaCiAgICAgIGZvciAoaSA9IDY1OyBpIDw9IDkwOyBpKyspIHtfa2V5c1tTdHJpbmcuZnJvbUNoYXJDb2RlKGkpXSA9IHtjb2RlOmksIHNoaWZ0OiB0cnVlfTt9CiAgICAgIC8vIDAgLSA5CiAgICAgIGZvciAoaSA9IDA7ICBpIDw9IDk7ICAgaSsrKSB7X2tleXNbJycgKyBpXSA9IHtjb2RlOjQ4ICsgaSwgc2hpZnQ6IGZhbHNlfTt9CiAgICAgIC8vIEYxIC0gRjEyCiAgICAgIGZvciAoaSA9IDE7ICBpIDw9IDEyOyAgIGkrKykge19rZXlzWydGJyArIGldID0ge2NvZGU6MTExICsgaSwgc2hpZnQ6IGZhbHNlfTt9CiAgICAgIC8vIG51bTAgLSBudW05CiAgICAgIGZvciAoaSA9IDA7ICBpIDw9IDk7ICAgaSsrKSB7X2tleXNbJ251bScgKyBpXSA9IHtjb2RlOjk2ICsgaSwgc2hpZnQ6IGZhbHNlfTt9CgogICAgICAvLyBudW1wYWQgbWlzYwogICAgICBfa2V5c1snbnVtKiddID0ge2NvZGU6MTA2LCBzaGlmdDogZmFsc2V9OwogICAgICBfa2V5c1snbnVtKyddID0ge2NvZGU6MTA3LCBzaGlmdDogZmFsc2V9OwogICAgICBfa2V5c1snbnVtLSddID0ge2NvZGU6MTA5LCBzaGlmdDogZmFsc2V9OwogICAgICBfa2V5c1snbnVtLyddID0ge2NvZGU6MTExLCBzaGlmdDogZmFsc2V9OwogICAgICBfa2V5c1snbnVtLiddID0ge2NvZGU6MTEwLCBzaGlmdDogZmFsc2V9OwogICAgICAvLyBhcnJvd3MKICAgICAgX2tleXNbJ2xlZnQnXSAgPSB7Y29kZTozNywgc2hpZnQ6IGZhbHNlfTsKICAgICAgX2tleXNbJ3VwJ10gICAgPSB7Y29kZTozOCwgc2hpZnQ6IGZhbHNlfTsKICAgICAgX2tleXNbJ3JpZ2h0J10gPSB7Y29kZTozOSwgc2hpZnQ6IGZhbHNlfTsKICAgICAgX2tleXNbJ2Rvd24nXSAgPSB7Y29kZTo0MCwgc2hpZnQ6IGZhbHNlfTsKICAgICAgLy8gZXh0cmEga2V5cwogICAgICBfa2V5c1snc3BhY2UnXSA9IHtjb2RlOjMyLCBzaGlmdDogZmFsc2V9OwogICAgICBfa2V5c1snZW50ZXInXSA9IHtjb2RlOjEzLCBzaGlmdDogZmFsc2V9OwogICAgICBfa2V5c1snc2hpZnQnXSA9IHtjb2RlOjE2LCBzaGlmdDogdW5kZWZpbmVkfTsKICAgICAgX2tleXNbJ2VzYyddICAgPSB7Y29kZToyNywgc2hpZnQ6IGZhbHNlfTsKICAgICAgX2tleXNbJ2JhY2tzcGFjZSddID0ge2NvZGU6OCwgc2hpZnQ6IGZhbHNlfTsKICAgICAgX2tleXNbJ3RhYiddICAgICAgID0ge2NvZGU6OSwgc2hpZnQ6IGZhbHNlfTsKICAgICAgX2tleXNbJ2N0cmwnXSAgICAgID0ge2NvZGU6MTcsIHNoaWZ0OiBmYWxzZX07CiAgICAgIF9rZXlzWydhbHQnXSAgICAgICA9IHtjb2RlOjE4LCBzaGlmdDogZmFsc2V9OwogICAgICBfa2V5c1snZGVsZXRlJ10gICAgPSB7Y29kZTo0Niwgc2hpZnQ6IGZhbHNlfTsKICAgICAgX2tleXNbJ3BhZ2V1cCddICAgID0ge2NvZGU6MzMsIHNoaWZ0OiBmYWxzZX07CiAgICAgIF9rZXlzWydwYWdlZG93biddICA9IHtjb2RlOjM0LCBzaGlmdDogZmFsc2V9OwogICAgICAvLyBzeW1ib2xzCiAgICAgIF9rZXlzWyc9J10gICAgID0ge2NvZGU6MTg3LCBzaGlmdDogZmFsc2V9OwogICAgICBfa2V5c1snLSddICAgICA9IHtjb2RlOjE4OSwgc2hpZnQ6IGZhbHNlfTsKICAgICAgX2tleXNbJ10nXSAgICAgPSB7Y29kZToyMjEsIHNoaWZ0OiBmYWxzZX07CiAgICAgIF9rZXlzWydbJ10gICAgID0ge2NvZGU6MjE5LCBzaGlmdDogZmFsc2V9OwoKCgogICAgICB2YXIgZG93biA9IGZ1bmN0aW9uKGV2ZW50KSB7aGFuZGxlRXZlbnQoZXZlbnQsJ2tleWRvd24nKTt9OwogICAgICB2YXIgdXAgPSBmdW5jdGlvbihldmVudCkge2hhbmRsZUV2ZW50KGV2ZW50LCdrZXl1cCcpO307CgogICAgICAvLyBoYW5kbGUgdGhlIGFjdHVhbHkgYm91bmQga2V5IHdpdGggdGhlIGV2ZW50CiAgICAgIHZhciBoYW5kbGVFdmVudCA9IGZ1bmN0aW9uKGV2ZW50LHR5cGUpIHsKICAgICAgICBpZiAoX2JvdW5kW3R5cGVdW2V2ZW50LmtleUNvZGVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBib3VuZCA9IF9ib3VuZFt0eXBlXVtldmVudC5rZXlDb2RlXTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYm91bmQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGJvdW5kW2ldLnNoaWZ0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBib3VuZFtpXS5mbihldmVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoYm91bmRbaV0uc2hpZnQgPT0gdHJ1ZSAmJiBldmVudC5zaGlmdEtleSA9PSB0cnVlKSB7CiAgICAgICAgICAgICAgYm91bmRbaV0uZm4oZXZlbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGJvdW5kW2ldLnNoaWZ0ID09IGZhbHNlICYmIGV2ZW50LnNoaWZ0S2V5ID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgYm91bmRbaV0uZm4oZXZlbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHByZXZlbnREZWZhdWx0ID09IHRydWUpIHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICAvLyBiaW5kIGEga2V5IHRvIGEgY2FsbGJhY2sKICAgICAgX2V4cG9ydEZ1bmN0aW9ucy5iaW5kID0gZnVuY3Rpb24oa2V5LCBjYWxsYmFjaywgdHlwZSkgewogICAgICAgIGlmICh0eXBlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHR5cGUgPSAna2V5ZG93bic7CiAgICAgICAgfQogICAgICAgIGlmIChfa2V5c1trZXldID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5zdXBwb3J0ZWQga2V5OiAiICsga2V5KTsKICAgICAgICB9CiAgICAgICAgaWYgKF9ib3VuZFt0eXBlXVtfa2V5c1trZXldLmNvZGVdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIF9ib3VuZFt0eXBlXVtfa2V5c1trZXldLmNvZGVdID0gW107CiAgICAgICAgfQogICAgICAgIF9ib3VuZFt0eXBlXVtfa2V5c1trZXldLmNvZGVdLnB1c2goe2ZuOmNhbGxiYWNrLCBzaGlmdDpfa2V5c1trZXldLnNoaWZ0fSk7CiAgICAgIH07CgoKICAgICAgLy8gYmluZCBhbGwga2V5cyB0byBhIGNhbGwgYmFjayAoZGVtbyBwdXJwb3NlcykKICAgICAgX2V4cG9ydEZ1bmN0aW9ucy5iaW5kQWxsID0gZnVuY3Rpb24oY2FsbGJhY2ssIHR5cGUpIHsKICAgICAgICBpZiAodHlwZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0eXBlID0gJ2tleWRvd24nOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBrZXkgaW4gX2tleXMpIHsKICAgICAgICAgIGlmIChfa2V5cy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgIF9leHBvcnRGdW5jdGlvbnMuYmluZChrZXksY2FsbGJhY2ssdHlwZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwoKICAgICAgLy8gZ2V0IHRoZSBrZXkgbGFiZWwgZnJvbSBhbiBldmVudAogICAgICBfZXhwb3J0RnVuY3Rpb25zLmdldEtleSA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIF9rZXlzKSB7CiAgICAgICAgICBpZiAoX2tleXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkgPT0gdHJ1ZSAmJiBfa2V5c1trZXldLnNoaWZ0ID09IHRydWUgJiYgZXZlbnQua2V5Q29kZSA9PSBfa2V5c1trZXldLmNvZGUpIHsKICAgICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGV2ZW50LnNoaWZ0S2V5ID09IGZhbHNlICYmIF9rZXlzW2tleV0uc2hpZnQgPT0gZmFsc2UgJiYgZXZlbnQua2V5Q29kZSA9PSBfa2V5c1trZXldLmNvZGUpIHsKICAgICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT0gX2tleXNba2V5XS5jb2RlICYmIGtleSA9PSAnc2hpZnQnKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gInVua25vd24ga2V5LCBjdXJyZW50bHkgbm90IHN1cHBvcnRlZCI7CiAgICAgIH07CgogICAgICAvLyB1bmJpbmQgZWl0aGVyIGEgc3BlY2lmaWMgY2FsbGJhY2sgZnJvbSBhIGtleSBvciBhbGwgb2YgdGhlbSAoYnkgbGVhdmluZyBjYWxsYmFjayB1bmRlZmluZWQpCiAgICAgIF9leHBvcnRGdW5jdGlvbnMudW5iaW5kID0gZnVuY3Rpb24oa2V5LCBjYWxsYmFjaywgdHlwZSkgewogICAgICAgIGlmICh0eXBlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHR5cGUgPSAna2V5ZG93bic7CiAgICAgICAgfQogICAgICAgIGlmIChfa2V5c1trZXldID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5zdXBwb3J0ZWQga2V5OiAiICsga2V5KTsKICAgICAgICB9CiAgICAgICAgaWYgKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBuZXdCaW5kaW5ncyA9IFtdOwogICAgICAgICAgdmFyIGJvdW5kID0gX2JvdW5kW3R5cGVdW19rZXlzW2tleV0uY29kZV07CiAgICAgICAgICBpZiAoYm91bmQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJvdW5kLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKCEoYm91bmRbaV0uZm4gPT0gY2FsbGJhY2sgJiYgYm91bmRbaV0uc2hpZnQgPT0gX2tleXNba2V5XS5zaGlmdCkpIHsKICAgICAgICAgICAgICAgIG5ld0JpbmRpbmdzLnB1c2goX2JvdW5kW3R5cGVdW19rZXlzW2tleV0uY29kZV1baV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgX2JvdW5kW3R5cGVdW19rZXlzW2tleV0uY29kZV0gPSBuZXdCaW5kaW5nczsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBfYm91bmRbdHlwZV1bX2tleXNba2V5XS5jb2RlXSA9IFtdOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIC8vIHJlc2V0IGFsbCBib3VuZCB2YXJpYWJsZXMuCiAgICAgIF9leHBvcnRGdW5jdGlvbnMucmVzZXQgPSBmdW5jdGlvbigpIHsKICAgICAgICBfYm91bmQgPSB7a2V5ZG93bjp7fSwga2V5dXA6e319OwogICAgICB9OwoKICAgICAgLy8gdW5iaW5kIGFsbCBsaXN0ZW5lcnMgYW5kIHJlc2V0IGFsbCB2YXJpYWJsZXMuCiAgICAgIF9leHBvcnRGdW5jdGlvbnMuZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgIF9ib3VuZCA9IHtrZXlkb3duOnt9LCBrZXl1cDp7fX07CiAgICAgICAgY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBkb3duLCB0cnVlKTsKICAgICAgICBjb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAnLCB1cCwgdHJ1ZSk7CiAgICAgIH07CgogICAgICAvLyBjcmVhdGUgbGlzdGVuZXJzLgogICAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsZG93bix0cnVlKTsKICAgICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJyx1cCx0cnVlKTsKCiAgICAgIC8vIHJldHVybiB0aGUgcHVibGljIGZ1bmN0aW9ucy4KICAgICAgcmV0dXJuIF9leHBvcnRGdW5jdGlvbnM7CiAgICB9CgogICAgcmV0dXJuIGtleWNoYXJtOwogIH0pKTsKCgoKCi8qKiovIH0sCi8qIDQ0ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciBIYW1tZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKTsKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CiAgdmFyIENvbXBvbmVudCA9IF9fd2VicGFja19yZXF1aXJlX18oMjEpOwogIHZhciBtb21lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpOwogIHZhciBsb2NhbGVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMik7CgogIC8qKgogICAqIEEgY3VzdG9tIHRpbWUgYmFyCiAgICogQHBhcmFtIHt7cmFuZ2U6IFJhbmdlLCBkb206IE9iamVjdH19IGJvZHkKICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdICAgICAgICBBdmFpbGFibGUgcGFyYW1ldGVyczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bnVtYmVyIHwgc3RyaW5nfSBpZAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdHJpbmd9IGxvY2FsZXMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3RyaW5nfSBsb2NhbGUKICAgKiBAY29uc3RydWN0b3IgQ3VzdG9tVGltZQogICAqIEBleHRlbmRzIENvbXBvbmVudAogICAqLwoKICBmdW5jdGlvbiBDdXN0b21UaW1lKGJvZHksIG9wdGlvbnMpIHsKICAgIHRoaXMuYm9keSA9IGJvZHk7CgogICAgLy8gZGVmYXVsdCBvcHRpb25zCiAgICB0aGlzLmRlZmF1bHRPcHRpb25zID0gewogICAgICBsb2NhbGVzOiBsb2NhbGVzLAogICAgICBsb2NhbGU6ICdlbicsCiAgICAgIGlkOiB1bmRlZmluZWQKICAgIH07CiAgICB0aGlzLm9wdGlvbnMgPSB1dGlsLmV4dGVuZCh7fSwgdGhpcy5kZWZhdWx0T3B0aW9ucyk7CgogICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy50aW1lKSB7CiAgICAgIHRoaXMuY3VzdG9tVGltZSA9IG9wdGlvbnMudGltZTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY3VzdG9tVGltZSA9IG5ldyBEYXRlKCk7CiAgICB9CgogICAgdGhpcy5ldmVudFBhcmFtcyA9IHt9OyAvLyBzdG9yZXMgc3RhdGUgcGFyYW1ldGVycyB3aGlsZSBkcmFnZ2luZyB0aGUgYmFyCgogICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpOwoKICAgIC8vIGNyZWF0ZSB0aGUgRE9NCiAgICB0aGlzLl9jcmVhdGUoKTsKICB9CgogIEN1c3RvbVRpbWUucHJvdG90eXBlID0gbmV3IENvbXBvbmVudCgpOwoKICAvKioKICAgKiBTZXQgb3B0aW9ucyBmb3IgdGhlIGNvbXBvbmVudC4gT3B0aW9ucyB3aWxsIGJlIG1lcmdlZCBpbiBjdXJyZW50IG9wdGlvbnMuCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgIEF2YWlsYWJsZSBwYXJhbWV0ZXJzOgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtudW1iZXIgfCBzdHJpbmd9IGlkCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3N0cmluZ30gbG9jYWxlcwogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdHJpbmd9IGxvY2FsZQogICAqLwogIEN1c3RvbVRpbWUucHJvdG90eXBlLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMpIHsKICAgICAgLy8gY29weSBhbGwgb3B0aW9ucyB0aGF0IHdlIGtub3cKICAgICAgdXRpbC5zZWxlY3RpdmVFeHRlbmQoWydsb2NhbGUnLCAnbG9jYWxlcycsICdpZCddLCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgfQogIH07CgogIC8qKgogICAqIENyZWF0ZSB0aGUgRE9NIGZvciB0aGUgY3VzdG9tIHRpbWUKICAgKiBAcHJpdmF0ZQogICAqLwogIEN1c3RvbVRpbWUucHJvdG90eXBlLl9jcmVhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgYmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBiYXJbJ2N1c3RvbS10aW1lJ10gPSB0aGlzOwogICAgYmFyLmNsYXNzTmFtZSA9ICd2aXMtY3VzdG9tLXRpbWUgJyArICh0aGlzLm9wdGlvbnMuaWQgfHwgJycpOwogICAgYmFyLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKICAgIGJhci5zdHlsZS50b3AgPSAnMHB4JzsKICAgIGJhci5zdHlsZS5oZWlnaHQgPSAnMTAwJSc7CiAgICB0aGlzLmJhciA9IGJhcjsKCiAgICB2YXIgZHJhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgZHJhZy5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7CiAgICBkcmFnLnN0eWxlLnRvcCA9ICcwcHgnOwogICAgZHJhZy5zdHlsZS5sZWZ0ID0gJy0xMHB4JzsKICAgIGRyYWcuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnOwogICAgZHJhZy5zdHlsZS53aWR0aCA9ICcyMHB4JzsKICAgIGJhci5hcHBlbmRDaGlsZChkcmFnKTsKCiAgICAvLyBhdHRhY2ggZXZlbnQgbGlzdGVuZXJzCiAgICB0aGlzLmhhbW1lciA9IG5ldyBIYW1tZXIoZHJhZyk7CiAgICB0aGlzLmhhbW1lci5vbigncGFuc3RhcnQnLCB0aGlzLl9vbkRyYWdTdGFydC5iaW5kKHRoaXMpKTsKICAgIHRoaXMuaGFtbWVyLm9uKCdwYW5tb3ZlJywgdGhpcy5fb25EcmFnLmJpbmQodGhpcykpOwogICAgdGhpcy5oYW1tZXIub24oJ3BhbmVuZCcsIHRoaXMuX29uRHJhZ0VuZC5iaW5kKHRoaXMpKTsKICAgIC8vIFRPRE86IGNsZWFudXAKICAgIC8vdGhpcy5oYW1tZXIub24oJ3BhbicsICAgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAvLyAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIC8vfSk7CiAgfTsKCiAgLyoqCiAgICogRGVzdHJveSB0aGUgQ3VzdG9tVGltZSBiYXIKICAgKi8KICBDdXN0b21UaW1lLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5oaWRlKCk7CgogICAgdGhpcy5oYW1tZXIuZGVzdHJveSgpOwogICAgdGhpcy5oYW1tZXIgPSBudWxsOwoKICAgIHRoaXMuYm9keSA9IG51bGw7CiAgfTsKCiAgLyoqCiAgICogUmVwYWludCB0aGUgY29tcG9uZW50CiAgICogQHJldHVybiB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBjb21wb25lbnQgaXMgcmVzaXplZAogICAqLwogIEN1c3RvbVRpbWUucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBwYXJlbnQgPSB0aGlzLmJvZHkuZG9tLmJhY2tncm91bmRWZXJ0aWNhbDsKICAgIGlmICh0aGlzLmJhci5wYXJlbnROb2RlICE9IHBhcmVudCkgewogICAgICAvLyBhdHRhY2ggdG8gdGhlIGRvbQogICAgICBpZiAodGhpcy5iYXIucGFyZW50Tm9kZSkgewogICAgICAgIHRoaXMuYmFyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5iYXIpOwogICAgICB9CiAgICAgIHBhcmVudC5hcHBlbmRDaGlsZCh0aGlzLmJhcik7CiAgICB9CgogICAgdmFyIHggPSB0aGlzLmJvZHkudXRpbC50b1NjcmVlbih0aGlzLmN1c3RvbVRpbWUpOwoKICAgIHZhciBsb2NhbGUgPSB0aGlzLm9wdGlvbnMubG9jYWxlc1t0aGlzLm9wdGlvbnMubG9jYWxlXTsKICAgIGlmICghbG9jYWxlKSB7CiAgICAgIGlmICghdGhpcy53YXJuZWQpIHsKICAgICAgICBjb25zb2xlLmxvZygnV0FSTklORzogb3B0aW9ucy5sb2NhbGVzW1wnJyArIHRoaXMub3B0aW9ucy5sb2NhbGUgKyAnXCddIG5vdCBmb3VuZC4gU2VlIGh0dHA6Ly92aXNqcy5vcmcvZG9jcy90aW1lbGluZS5odG1sI0xvY2FsaXphdGlvbicpOwogICAgICAgIHRoaXMud2FybmVkID0gdHJ1ZTsKICAgICAgfQogICAgICBsb2NhbGUgPSB0aGlzLm9wdGlvbnMubG9jYWxlc1snZW4nXTsgLy8gZmFsbCBiYWNrIG9uIGVuZ2xpc2ggd2hlbiBub3QgYXZhaWxhYmxlCiAgICB9CiAgICB2YXIgdGl0bGUgPSBsb2NhbGUudGltZSArICc6ICcgKyBtb21lbnQodGhpcy5jdXN0b21UaW1lKS5mb3JtYXQoJ2RkZGQsIE1NTU0gRG8gWVlZWSwgSDptbTpzcycpOwogICAgdGl0bGUgPSB0aXRsZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHRpdGxlLnN1YnN0cmluZygxKTsKCiAgICB0aGlzLmJhci5zdHlsZS5sZWZ0ID0geCArICdweCc7CiAgICB0aGlzLmJhci50aXRsZSA9IHRpdGxlOwoKICAgIHJldHVybiBmYWxzZTsKICB9OwoKICAvKioKICAgKiBSZW1vdmUgdGhlIEN1c3RvbVRpbWUgZnJvbSB0aGUgRE9NCiAgICovCiAgQ3VzdG9tVGltZS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIHJlbW92ZSB0aGUgbGluZSBmcm9tIHRoZSBET00KICAgIGlmICh0aGlzLmJhci5wYXJlbnROb2RlKSB7CiAgICAgIHRoaXMuYmFyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5iYXIpOwogICAgfQogIH07CgogIC8qKgogICAqIFNldCBjdXN0b20gdGltZS4KICAgKiBAcGFyYW0ge0RhdGUgfCBudW1iZXIgfCBzdHJpbmd9IHRpbWUKICAgKi8KICBDdXN0b21UaW1lLnByb3RvdHlwZS5zZXRDdXN0b21UaW1lID0gZnVuY3Rpb24gKHRpbWUpIHsKICAgIHRoaXMuY3VzdG9tVGltZSA9IHV0aWwuY29udmVydCh0aW1lLCAnRGF0ZScpOwogICAgdGhpcy5yZWRyYXcoKTsKICB9OwoKICAvKioKICAgKiBSZXRyaWV2ZSB0aGUgY3VycmVudCBjdXN0b20gdGltZS4KICAgKiBAcmV0dXJuIHtEYXRlfSBjdXN0b21UaW1lCiAgICovCiAgQ3VzdG9tVGltZS5wcm90b3R5cGUuZ2V0Q3VzdG9tVGltZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLmN1c3RvbVRpbWUudmFsdWVPZigpKTsKICB9OwoKICAvKioKICAgKiBTdGFydCBtb3ZpbmcgaG9yaXpvbnRhbGx5CiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIEN1c3RvbVRpbWUucHJvdG90eXBlLl9vbkRyYWdTdGFydCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgdGhpcy5ldmVudFBhcmFtcy5kcmFnZ2luZyA9IHRydWU7CiAgICB0aGlzLmV2ZW50UGFyYW1zLmN1c3RvbVRpbWUgPSB0aGlzLmN1c3RvbVRpbWU7CgogICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgfTsKCiAgLyoqCiAgICogUGVyZm9ybSBtb3Zpbmcgb3BlcmF0aW5nLgogICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50CiAgICogQHByaXZhdGUKICAgKi8KICBDdXN0b21UaW1lLnByb3RvdHlwZS5fb25EcmFnID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICBpZiAoIXRoaXMuZXZlbnRQYXJhbXMuZHJhZ2dpbmcpIHJldHVybjsKCiAgICB2YXIgeCA9IHRoaXMuYm9keS51dGlsLnRvU2NyZWVuKHRoaXMuZXZlbnRQYXJhbXMuY3VzdG9tVGltZSkgKyBldmVudC5kZWx0YVg7CiAgICB2YXIgdGltZSA9IHRoaXMuYm9keS51dGlsLnRvVGltZSh4KTsKCiAgICB0aGlzLnNldEN1c3RvbVRpbWUodGltZSk7CgogICAgLy8gZmlyZSBhIHRpbWVjaGFuZ2UgZXZlbnQKICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ3RpbWVjaGFuZ2UnLCB7CiAgICAgIGlkOiB0aGlzLm9wdGlvbnMuaWQsCiAgICAgIHRpbWU6IG5ldyBEYXRlKHRoaXMuY3VzdG9tVGltZS52YWx1ZU9mKCkpCiAgICB9KTsKCiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICB9OwoKICAvKioKICAgKiBTdG9wIG1vdmluZyBvcGVyYXRpbmcuCiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcHJpdmF0ZQogICAqLwogIEN1c3RvbVRpbWUucHJvdG90eXBlLl9vbkRyYWdFbmQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIGlmICghdGhpcy5ldmVudFBhcmFtcy5kcmFnZ2luZykgcmV0dXJuOwoKICAgIC8vIGZpcmUgYSB0aW1lY2hhbmdlZCBldmVudAogICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgndGltZWNoYW5nZWQnLCB7CiAgICAgIGlkOiB0aGlzLm9wdGlvbnMuaWQsCiAgICAgIHRpbWU6IG5ldyBEYXRlKHRoaXMuY3VzdG9tVGltZS52YWx1ZU9mKCkpCiAgICB9KTsKCiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICB9OwoKICAvKioKICAgKiBGaW5kIGEgY3VzdG9tIHRpbWUgZnJvbSBhbiBldmVudCB0YXJnZXQ6CiAgICogc2VhcmNoZXMgZm9yIHRoZSBhdHRyaWJ1dGUgJ2N1c3RvbS10aW1lJyBpbiB0aGUgZXZlbnQgdGFyZ2V0J3MgZWxlbWVudCB0cmVlCiAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQKICAgKiBAcmV0dXJuIHtDdXN0b21UaW1lIHwgbnVsbH0gY3VzdG9tVGltZQogICAqLwogIEN1c3RvbVRpbWUuY3VzdG9tVGltZUZyb21UYXJnZXQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgIHZhciB0YXJnZXQgPSBldmVudC50YXJnZXQ7CiAgICB3aGlsZSAodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQuaGFzT3duUHJvcGVydHkoJ2N1c3RvbS10aW1lJykpIHsKICAgICAgICByZXR1cm4gdGFyZ2V0WydjdXN0b20tdGltZSddOwogICAgICB9CiAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlOwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH07CgogIG1vZHVsZS5leHBvcnRzID0gQ3VzdG9tVGltZTsKCi8qKiovIH0sCi8qIDQ1ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIHZhciBfQ29sb3JQaWNrZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2KTsKCiAgdmFyIF9Db2xvclBpY2tlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9Db2xvclBpY2tlcik7CgogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgLyoqCiAgICogVGhlIHdheSB0aGlzIHdvcmtzIGlzIGZvciBhbGwgcHJvcGVydGllcyBvZiB0aGlzLnBvc3NpYmxlIG9wdGlvbnMsIHlvdSBjYW4gc3VwcGx5IHRoZSBwcm9wZXJ0eSBuYW1lIGluIGFueSBmb3JtIHRvIGxpc3QgdGhlIG9wdGlvbnMuCiAgICogQm9vbGVhbiBvcHRpb25zIGFyZSByZWNvZ25pc2VkIGFzIEJvb2xlYW4KICAgKiBOdW1iZXIgb3B0aW9ucyBzaG91bGQgYmUgd3JpdHRlbiBhcyBhcnJheTogW2RlZmF1bHQgdmFsdWUsIG1pbiB2YWx1ZSwgbWF4IHZhbHVlLCBzdGVwc2l6ZV0KICAgKiBDb2xvcnMgc2hvdWxkIGJlIHdyaXR0ZW4gYXMgYXJyYXk6IFsnY29sb3InLCAnI2ZmZmZmZiddCiAgICogU3RyaW5ncyB3aXRoIHNob3VsZCBiZSB3cml0dGVuIGFzIGFycmF5OiBbb3B0aW9uMSwgb3B0aW9uMiwgb3B0aW9uMywgLi5dCiAgICoKICAgKiBUaGUgb3B0aW9ucyBhcmUgbWF0Y2hlZCB3aXRoIHRoZWlyIGNvdW50ZXJwYXJ0cyBpbiBlYWNoIG9mIHRoZSBtb2R1bGVzIGFuZCB0aGUgdmFsdWVzIHVzZWQgaW4gdGhlIGNvbmZpZ3VyYXRpb24gYXJlCiAgICoKICAgKiBAcGFyYW0gcGFyZW50TW9kdWxlICAgICAgICB8IHRoZSBsb2NhdGlvbiB3aGVyZSBwYXJlbnRNb2R1bGUuc2V0T3B0aW9ucygpIGNhbiBiZSBjYWxsZWQKICAgKiBAcGFyYW0gZGVmYXVsdENvbnRhaW5lciAgICB8IHRoZSBkZWZhdWx0IGNvbnRhaW5lciBvZiB0aGUgbW9kdWxlCiAgICogQHBhcmFtIGNvbmZpZ3VyZU9wdGlvbnMgICAgfCB0aGUgZnVsbHkgY29uZmlndXJlZCBhbmQgcHJlZGVmaW5lZCBvcHRpb25zIHNldCBmb3VuZCBpbiBhbGxPcHRpb25zLmpzCiAgICogQHBhcmFtIHBpeGVsUmF0aW8gICAgICAgICAgfCBjYW52YXMgcGl4ZWwgcmF0aW8KICAgKi8KCiAgdmFyIENvbmZpZ3VyYXRvciA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBDb25maWd1cmF0b3IocGFyZW50TW9kdWxlLCBkZWZhdWx0Q29udGFpbmVyLCBjb25maWd1cmVPcHRpb25zKSB7CiAgICAgIHZhciBwaXhlbFJhdGlvID0gYXJndW1lbnRzWzNdID09PSB1bmRlZmluZWQgPyAxIDogYXJndW1lbnRzWzNdOwoKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbmZpZ3VyYXRvcik7CgogICAgICB0aGlzLnBhcmVudCA9IHBhcmVudE1vZHVsZTsKICAgICAgdGhpcy5jaGFuZ2VkT3B0aW9ucyA9IFtdOwogICAgICB0aGlzLmNvbnRhaW5lciA9IGRlZmF1bHRDb250YWluZXI7CiAgICAgIHRoaXMuYWxsb3dDcmVhdGlvbiA9IGZhbHNlOwoKICAgICAgdGhpcy5vcHRpb25zID0ge307CiAgICAgIHRoaXMuZGVmYXVsdE9wdGlvbnMgPSB7CiAgICAgICAgZW5hYmxlZDogZmFsc2UsCiAgICAgICAgZmlsdGVyOiB0cnVlLAogICAgICAgIGNvbnRhaW5lcjogdW5kZWZpbmVkLAogICAgICAgIHNob3dCdXR0b246IHRydWUKICAgICAgfTsKICAgICAgdXRpbC5leHRlbmQodGhpcy5vcHRpb25zLCB0aGlzLmRlZmF1bHRPcHRpb25zKTsKCiAgICAgIHRoaXMuY29uZmlndXJlT3B0aW9ucyA9IGNvbmZpZ3VyZU9wdGlvbnM7CiAgICAgIHRoaXMubW9kdWxlT3B0aW9ucyA9IHt9OwogICAgICB0aGlzLmRvbUVsZW1lbnRzID0gW107CiAgICAgIHRoaXMuY29sb3JQaWNrZXIgPSBuZXcgX0NvbG9yUGlja2VyMlsnZGVmYXVsdCddKHBpeGVsUmF0aW8pOwogICAgICB0aGlzLndyYXBwZXIgPSB1bmRlZmluZWQ7CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKENvbmZpZ3VyYXRvciwgW3sKICAgICAga2V5OiAnc2V0T3B0aW9ucycsCgogICAgICAvKioKICAgICAgICogcmVmcmVzaCBhbGwgb3B0aW9ucy4KICAgICAgICogQmVjYXVzZSBhbGwgbW9kdWxlcyBwYXJzZSB0aGVpciBvcHRpb25zIGJ5IHRoZW1zZWx2ZXMsIHdlIGp1c3QgdXNlIHRoZWlyIG9wdGlvbnMuIFdlIGNvcHkgdGhlbSBoZXJlLgogICAgICAgKgogICAgICAgKiBAcGFyYW0gb3B0aW9ucwogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykgewogICAgICAgIGlmIChvcHRpb25zICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBlbmFibGVkID0gdHJ1ZTsKICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLmZpbHRlciA9IG9wdGlvbnM7CiAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMgaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMuZmlsdGVyID0gb3B0aW9ucy5qb2luKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnb2JqZWN0JykgewogICAgICAgICAgICBpZiAob3B0aW9ucy5jb250YWluZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5jb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5maWx0ZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5maWx0ZXIgPSBvcHRpb25zLmZpbHRlcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5zaG93QnV0dG9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd0J1dHRvbiA9IG9wdGlvbnMuc2hvd0J1dHRvbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5lbmFibGVkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBlbmFibGVkID0gb3B0aW9ucy5lbmFibGVkOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnYm9vbGVhbicpIHsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLmZpbHRlciA9IHRydWU7CiAgICAgICAgICAgIGVuYWJsZWQgPSBvcHRpb25zOwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMuZmlsdGVyID0gb3B0aW9uczsKICAgICAgICAgICAgZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmZpbHRlciA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgZW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMub3B0aW9ucy5lbmFibGVkID0gZW5hYmxlZDsKICAgICAgICB9CiAgICAgICAgdGhpcy5fY2xlYW4oKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzZXRNb2R1bGVPcHRpb25zJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldE1vZHVsZU9wdGlvbnMobW9kdWxlT3B0aW9ucykgewogICAgICAgIHRoaXMubW9kdWxlT3B0aW9ucyA9IG1vZHVsZU9wdGlvbnM7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5lbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLl9jbGVhbigpOwogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jb250YWluZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aGlzLmNvbnRhaW5lciA9IHRoaXMub3B0aW9ucy5jb250YWluZXI7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9jcmVhdGUoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2NyZWF0ZScsCgogICAgICAvKioKICAgICAgICogQ3JlYXRlIGFsbCBET00gZWxlbWVudHMKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHRoaXMuX2NsZWFuKCk7CiAgICAgICAgdGhpcy5jaGFuZ2VkT3B0aW9ucyA9IFtdOwoKICAgICAgICB2YXIgZmlsdGVyID0gdGhpcy5vcHRpb25zLmZpbHRlcjsKICAgICAgICB2YXIgY291bnRlciA9IDA7CiAgICAgICAgdmFyIHNob3cgPSBmYWxzZTsKICAgICAgICBmb3IgKHZhciBvcHRpb24gaW4gdGhpcy5jb25maWd1cmVPcHRpb25zKSB7CiAgICAgICAgICBpZiAodGhpcy5jb25maWd1cmVPcHRpb25zLmhhc093blByb3BlcnR5KG9wdGlvbikpIHsKICAgICAgICAgICAgdGhpcy5hbGxvd0NyZWF0aW9uID0gZmFsc2U7CiAgICAgICAgICAgIHNob3cgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBmaWx0ZXIgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICBzaG93ID0gZmlsdGVyKG9wdGlvbiwgW10pOwogICAgICAgICAgICAgIHNob3cgPSBzaG93IHx8IHRoaXMuX2hhbmRsZU9iamVjdCh0aGlzLmNvbmZpZ3VyZU9wdGlvbnNbb3B0aW9uXSwgW29wdGlvbl0sIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZpbHRlciA9PT0gdHJ1ZSB8fCBmaWx0ZXIuaW5kZXhPZihvcHRpb24pICE9PSAtMSkgewogICAgICAgICAgICAgIHNob3cgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2hvdyAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICB0aGlzLmFsbG93Q3JlYXRpb24gPSB0cnVlOwoKICAgICAgICAgICAgICAvLyBsaW5lYnJlYWsgYmV0d2VlbiBjYXRlZ29yaWVzCiAgICAgICAgICAgICAgaWYgKGNvdW50ZXIgPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9tYWtlSXRlbShbXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vIGEgaGVhZGVyIGZvciB0aGUgY2F0ZWdvcnkKICAgICAgICAgICAgICB0aGlzLl9tYWtlSGVhZGVyKG9wdGlvbik7CgogICAgICAgICAgICAgIC8vIGdldCB0aGUgc3Vib3B0aW9ucwogICAgICAgICAgICAgIHRoaXMuX2hhbmRsZU9iamVjdCh0aGlzLmNvbmZpZ3VyZU9wdGlvbnNbb3B0aW9uXSwgW29wdGlvbl0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvdW50ZXIrKzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2hvd0J1dHRvbiA9PT0gdHJ1ZSkgewogICAgICAgICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGdlbmVyYXRlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGdlbmVyYXRlQnV0dG9uLmNsYXNzTmFtZSA9ICd2aXMtbmV0d29yay1jb25maWd1cmF0aW9uIGJ1dHRvbic7CiAgICAgICAgICAgIGdlbmVyYXRlQnV0dG9uLmlubmVySFRNTCA9ICdnZW5lcmF0ZSBvcHRpb25zJzsKICAgICAgICAgICAgZ2VuZXJhdGVCdXR0b24ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpcy5fcHJpbnRPcHRpb25zKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGdlbmVyYXRlQnV0dG9uLm9ubW91c2VvdmVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGdlbmVyYXRlQnV0dG9uLmNsYXNzTmFtZSA9ICd2aXMtbmV0d29yay1jb25maWd1cmF0aW9uIGJ1dHRvbiBob3Zlcic7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGdlbmVyYXRlQnV0dG9uLm9ubW91c2VvdXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgZ2VuZXJhdGVCdXR0b24uY2xhc3NOYW1lID0gJ3Zpcy1uZXR3b3JrLWNvbmZpZ3VyYXRpb24gYnV0dG9uJzsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIF90aGlzLm9wdGlvbnNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgX3RoaXMub3B0aW9uc0NvbnRhaW5lci5jbGFzc05hbWUgPSAndmlzLW5ldHdvcmstY29uZmlndXJhdGlvbiB2aXMtb3B0aW9uLWNvbnRhaW5lcic7CgogICAgICAgICAgICBfdGhpcy5kb21FbGVtZW50cy5wdXNoKF90aGlzLm9wdGlvbnNDb250YWluZXIpOwogICAgICAgICAgICBfdGhpcy5kb21FbGVtZW50cy5wdXNoKGdlbmVyYXRlQnV0dG9uKTsKICAgICAgICAgIH0pKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9wdXNoKCk7CiAgICAgICAgdGhpcy5jb2xvclBpY2tlci5pbnNlcnRUbyh0aGlzLmNvbnRhaW5lcik7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3B1c2gnLAoKICAgICAgLyoqCiAgICAgICAqIGRyYXcgYWxsIERPTSBlbGVtZW50cyBvbiB0aGUgc2NyZWVuCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3B1c2goKSB7CiAgICAgICAgdGhpcy53cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdGhpcy53cmFwcGVyLmNsYXNzTmFtZSA9ICd2aXMtbmV0d29yay1jb25maWd1cmF0aW9uLXdyYXBwZXInOwogICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMud3JhcHBlcik7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRvbUVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB0aGlzLndyYXBwZXIuYXBwZW5kQ2hpbGQodGhpcy5kb21FbGVtZW50c1tpXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jbGVhbicsCgogICAgICAvKioKICAgICAgICogZGVsZXRlIGFsbCBET00gZWxlbWVudHMKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY2xlYW4oKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRvbUVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB0aGlzLndyYXBwZXIucmVtb3ZlQ2hpbGQodGhpcy5kb21FbGVtZW50c1tpXSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy53cmFwcGVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMud3JhcHBlcik7CiAgICAgICAgICB0aGlzLndyYXBwZXIgPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIHRoaXMuZG9tRWxlbWVudHMgPSBbXTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZ2V0VmFsdWUnLAoKICAgICAgLyoqCiAgICAgICAqIGdldCB0aGUgdmFsdWUgZnJvbSB0aGUgYWN0dWFsT3B0aW9ucyBpZiBpdCBleGlzdHMKICAgICAgICogQHBhcmFtIHthcnJheX0gcGF0aCAgICB8IHdoZXJlIHRvIGxvb2sgZm9yIHRoZSBhY3R1YWwgb3B0aW9uCiAgICAgICAqIEByZXR1cm5zIHsqfQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRWYWx1ZShwYXRoKSB7CiAgICAgICAgdmFyIGJhc2UgPSB0aGlzLm1vZHVsZU9wdGlvbnM7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoYmFzZVtwYXRoW2ldXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGJhc2UgPSBiYXNlW3BhdGhbaV1dOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYmFzZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBiYXNlOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19tYWtlSXRlbScsCgogICAgICAvKioKICAgICAgICogYWxsIG9wdGlvbiBlbGVtZW50cyBhcmUgd3JhcHBlZCBpbiBhbiBpdGVtCiAgICAgICAqIEBwYXJhbSBwYXRoCiAgICAgICAqIEBwYXJhbSBkb21FbGVtZW50cwogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9tYWtlSXRlbShwYXRoKSB7CiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBkb21FbGVtZW50cyA9IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICAgIGRvbUVsZW1lbnRzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmFsbG93Q3JlYXRpb24gPT09IHRydWUpIHsKICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gJ3Zpcy1uZXR3b3JrLWNvbmZpZ3VyYXRpb24gaXRlbSBzJyArIHBhdGgubGVuZ3RoOwogICAgICAgICAgICBkb21FbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgaXRlbS5hcHBlbmRDaGlsZChlbGVtZW50KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF90aGlzMi5kb21FbGVtZW50cy5wdXNoKGl0ZW0pOwogICAgICAgICAgfSkoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX21ha2VIZWFkZXInLAoKICAgICAgLyoqCiAgICAgICAqIGhlYWRlciBmb3IgbWFqb3Igc3ViamVjdHMKICAgICAgICogQHBhcmFtIG5hbWUKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfbWFrZUhlYWRlcihuYW1lKSB7CiAgICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGRpdi5jbGFzc05hbWUgPSAndmlzLW5ldHdvcmstY29uZmlndXJhdGlvbiBoZWFkZXInOwogICAgICAgIGRpdi5pbm5lckhUTUwgPSBuYW1lOwogICAgICAgIHRoaXMuX21ha2VJdGVtKFtdLCBkaXYpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19tYWtlTGFiZWwnLAoKICAgICAgLyoqCiAgICAgICAqIG1ha2UgYSBsYWJlbCwgaWYgaXQgaXMgYW4gb2JqZWN0IGxhYmVsLCBpdCBnZXRzIGRpZmZlcmVudCBzdHlsaW5nLgogICAgICAgKiBAcGFyYW0gbmFtZQogICAgICAgKiBAcGFyYW0gcGF0aAogICAgICAgKiBAcGFyYW0gb2JqZWN0TGFiZWwKICAgICAgICogQHJldHVybnMge0hUTUxFbGVtZW50fQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9tYWtlTGFiZWwobmFtZSwgcGF0aCkgewogICAgICAgIHZhciBvYmplY3RMYWJlbCA9IGFyZ3VtZW50c1syXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbMl07CgogICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBkaXYuY2xhc3NOYW1lID0gJ3Zpcy1uZXR3b3JrLWNvbmZpZ3VyYXRpb24gbGFiZWwgcycgKyBwYXRoLmxlbmd0aDsKICAgICAgICBpZiAob2JqZWN0TGFiZWwgPT09IHRydWUpIHsKICAgICAgICAgIGRpdi5pbm5lckhUTUwgPSAnPGk+PGI+JyArIG5hbWUgKyAnOjwvYj48L2k+JzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGl2LmlubmVySFRNTCA9IG5hbWUgKyAnOic7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkaXY7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX21ha2VEcm9wZG93bicsCgogICAgICAvKioKICAgICAgICogbWFrZSBhIGRyb3Bkb3duIGxpc3QgZm9yIG11bHRpcGxlIHBvc3NpYmxlIHN0cmluZyBvcHRvaW5zCiAgICAgICAqIEBwYXJhbSBhcnIKICAgICAgICogQHBhcmFtIHZhbHVlCiAgICAgICAqIEBwYXJhbSBwYXRoCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX21ha2VEcm9wZG93bihhcnIsIHZhbHVlLCBwYXRoKSB7CiAgICAgICAgdmFyIHNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpOwogICAgICAgIHNlbGVjdC5jbGFzc05hbWUgPSAndmlzLW5ldHdvcmstY29uZmlndXJhdGlvbiBzZWxlY3QnOwogICAgICAgIHZhciBzZWxlY3RlZFZhbHVlID0gMDsKICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKGFyci5pbmRleE9mKHZhbHVlKSAhPT0gLTEpIHsKICAgICAgICAgICAgc2VsZWN0ZWRWYWx1ZSA9IGFyci5pbmRleE9mKHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgICBvcHRpb24udmFsdWUgPSBhcnJbaV07CiAgICAgICAgICBpZiAoaSA9PT0gc2VsZWN0ZWRWYWx1ZSkgewogICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSAnc2VsZWN0ZWQnOwogICAgICAgICAgfQogICAgICAgICAgb3B0aW9uLmlubmVySFRNTCA9IGFycltpXTsKICAgICAgICAgIHNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgICBzZWxlY3Qub25jaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5fdXBkYXRlKHRoaXMudmFsdWUsIHBhdGgpOwogICAgICAgIH07CgogICAgICAgIHZhciBsYWJlbCA9IHRoaXMuX21ha2VMYWJlbChwYXRoW3BhdGgubGVuZ3RoIC0gMV0sIHBhdGgpOwogICAgICAgIHRoaXMuX21ha2VJdGVtKHBhdGgsIGxhYmVsLCBzZWxlY3QpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19tYWtlUmFuZ2UnLAoKICAgICAgLyoqCiAgICAgICAqIG1ha2UgYSByYW5nZSBvYmplY3QgZm9yIG51bWVyaWMgb3B0aW9ucwogICAgICAgKiBAcGFyYW0gYXJyCiAgICAgICAqIEBwYXJhbSB2YWx1ZQogICAgICAgKiBAcGFyYW0gcGF0aAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9tYWtlUmFuZ2UoYXJyLCB2YWx1ZSwgcGF0aCkgewogICAgICAgIHZhciBkZWZhdWx0VmFsdWUgPSBhcnJbMF07CiAgICAgICAgdmFyIG1pbiA9IGFyclsxXTsKICAgICAgICB2YXIgbWF4ID0gYXJyWzJdOwogICAgICAgIHZhciBzdGVwID0gYXJyWzNdOwogICAgICAgIHZhciByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgICAgICAgcmFuZ2UuY2xhc3NOYW1lID0gJ3Zpcy1uZXR3b3JrLWNvbmZpZ3VyYXRpb24gcmFuZ2UnOwogICAgICAgIHRyeSB7CiAgICAgICAgICByYW5nZS50eXBlID0gJ3JhbmdlJzsgLy8gbm90IHN1cHBvcnRlZCBvbiBJRTkKICAgICAgICAgIHJhbmdlLm1pbiA9IG1pbjsKICAgICAgICAgIHJhbmdlLm1heCA9IG1heDsKICAgICAgICB9IGNhdGNoIChlcnIpIHt9CiAgICAgICAgcmFuZ2Uuc3RlcCA9IHN0ZXA7CgogICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAodmFsdWUgPCAwICYmIHZhbHVlICogMiA8IG1pbikgewogICAgICAgICAgICByYW5nZS5taW4gPSB2YWx1ZSAqIDI7CiAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlICogMC4xIDwgbWluKSB7CiAgICAgICAgICAgIHJhbmdlLm1pbiA9IHZhbHVlIC8gMTA7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUgKiAyID4gbWF4ICYmIG1heCAhPT0gMSkgewogICAgICAgICAgICByYW5nZS5tYXggPSB2YWx1ZSAqIDI7CiAgICAgICAgICB9CiAgICAgICAgICByYW5nZS52YWx1ZSA9IHZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5nZS52YWx1ZSA9IGRlZmF1bHRWYWx1ZTsKICAgICAgICB9CgogICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgICAgICAgaW5wdXQuY2xhc3NOYW1lID0gJ3Zpcy1uZXR3b3JrLWNvbmZpZ3VyYXRpb24gcmFuZ2VpbnB1dCc7CiAgICAgICAgaW5wdXQudmFsdWUgPSByYW5nZS52YWx1ZTsKCiAgICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgICByYW5nZS5vbmNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlucHV0LnZhbHVlID0gdGhpcy52YWx1ZTttZS5fdXBkYXRlKE51bWJlcih0aGlzLnZhbHVlKSwgcGF0aCk7CiAgICAgICAgfTsKICAgICAgICByYW5nZS5vbmlucHV0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaW5wdXQudmFsdWUgPSB0aGlzLnZhbHVlOwogICAgICAgIH07CgogICAgICAgIHZhciBsYWJlbCA9IHRoaXMuX21ha2VMYWJlbChwYXRoW3BhdGgubGVuZ3RoIC0gMV0sIHBhdGgpOwogICAgICAgIHRoaXMuX21ha2VJdGVtKHBhdGgsIGxhYmVsLCByYW5nZSwgaW5wdXQpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19tYWtlQ2hlY2tib3gnLAoKICAgICAgLyoqCiAgICAgICAqIG1ha2UgYSBjaGVja2JveCBmb3IgYm9vbGVhbiBvcHRpb25zLgogICAgICAgKiBAcGFyYW0gZGVmYXVsdFZhbHVlCiAgICAgICAqIEBwYXJhbSB2YWx1ZQogICAgICAgKiBAcGFyYW0gcGF0aAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9tYWtlQ2hlY2tib3goZGVmYXVsdFZhbHVlLCB2YWx1ZSwgcGF0aCkgewogICAgICAgIHZhciBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgICAgICAgY2hlY2tib3gudHlwZSA9ICdjaGVja2JveCc7CiAgICAgICAgY2hlY2tib3guY2xhc3NOYW1lID0gJ3Zpcy1uZXR3b3JrLWNvbmZpZ3VyYXRpb24gY2hlY2tib3gnOwogICAgICAgIGNoZWNrYm94LmNoZWNrZWQgPSBkZWZhdWx0VmFsdWU7CiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNoZWNrYm94LmNoZWNrZWQgPSB2YWx1ZTsKICAgICAgICAgIGlmICh2YWx1ZSAhPT0gZGVmYXVsdFZhbHVlKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZGVmYXVsdFZhbHVlID09PSAnb2JqZWN0JykgewogICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gZGVmYXVsdFZhbHVlLmVuYWJsZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlZE9wdGlvbnMucHVzaCh7IHBhdGg6IHBhdGgsIHZhbHVlOiB2YWx1ZSB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VkT3B0aW9ucy5wdXNoKHsgcGF0aDogcGF0aCwgdmFsdWU6IHZhbHVlIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgbWUgPSB0aGlzOwogICAgICAgIGNoZWNrYm94Lm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgbWUuX3VwZGF0ZSh0aGlzLmNoZWNrZWQsIHBhdGgpOwogICAgICAgIH07CgogICAgICAgIHZhciBsYWJlbCA9IHRoaXMuX21ha2VMYWJlbChwYXRoW3BhdGgubGVuZ3RoIC0gMV0sIHBhdGgpOwogICAgICAgIHRoaXMuX21ha2VJdGVtKHBhdGgsIGxhYmVsLCBjaGVja2JveCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX21ha2VUZXh0SW5wdXQnLAoKICAgICAgLyoqCiAgICAgICAqIG1ha2UgYSB0ZXh0IGlucHV0IGZpZWxkIGZvciBzdHJpbmcgb3B0aW9ucy4KICAgICAgICogQHBhcmFtIGRlZmF1bHRWYWx1ZQogICAgICAgKiBAcGFyYW0gdmFsdWUKICAgICAgICogQHBhcmFtIHBhdGgKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfbWFrZVRleHRJbnB1dChkZWZhdWx0VmFsdWUsIHZhbHVlLCBwYXRoKSB7CiAgICAgICAgdmFyIGNoZWNrYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICBjaGVja2JveC50eXBlID0gJ3RleHQnOwogICAgICAgIGNoZWNrYm94LmNsYXNzTmFtZSA9ICd2aXMtbmV0d29yay1jb25maWd1cmF0aW9uIHRleHQnOwogICAgICAgIGNoZWNrYm94LnZhbHVlID0gdmFsdWU7CiAgICAgICAgaWYgKHZhbHVlICE9PSBkZWZhdWx0VmFsdWUpIHsKICAgICAgICAgIHRoaXMuY2hhbmdlZE9wdGlvbnMucHVzaCh7IHBhdGg6IHBhdGgsIHZhbHVlOiB2YWx1ZSB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgY2hlY2tib3gub25jaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5fdXBkYXRlKHRoaXMudmFsdWUsIHBhdGgpOwogICAgICAgIH07CgogICAgICAgIHZhciBsYWJlbCA9IHRoaXMuX21ha2VMYWJlbChwYXRoW3BhdGgubGVuZ3RoIC0gMV0sIHBhdGgpOwogICAgICAgIHRoaXMuX21ha2VJdGVtKHBhdGgsIGxhYmVsLCBjaGVja2JveCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX21ha2VDb2xvckZpZWxkJywKCiAgICAgIC8qKgogICAgICAgKiBtYWtlIGEgY29sb3IgZmllbGQgd2l0aCBhIGNvbG9yIHBpY2tlciBmb3IgY29sb3IgZmllbGRzCiAgICAgICAqIEBwYXJhbSBhcnIKICAgICAgICogQHBhcmFtIHZhbHVlCiAgICAgICAqIEBwYXJhbSBwYXRoCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX21ha2VDb2xvckZpZWxkKGFyciwgdmFsdWUsIHBhdGgpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgdmFyIGRlZmF1bHRDb2xvciA9IGFyclsxXTsKICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdmFsdWUgPSB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdENvbG9yIDogdmFsdWU7CgogICAgICAgIGlmICh2YWx1ZSAhPT0gJ25vbmUnKSB7CiAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gJ3Zpcy1uZXR3b3JrLWNvbmZpZ3VyYXRpb24gY29sb3JCbG9jayc7CiAgICAgICAgICBkaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gdmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRpdi5jbGFzc05hbWUgPSAndmlzLW5ldHdvcmstY29uZmlndXJhdGlvbiBjb2xvckJsb2NrIG5vbmUnOwogICAgICAgIH0KCiAgICAgICAgdmFsdWUgPSB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gZGVmYXVsdENvbG9yIDogdmFsdWU7CiAgICAgICAgZGl2Lm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczMuX3Nob3dDb2xvclBpY2tlcih2YWx1ZSwgZGl2LCBwYXRoKTsKICAgICAgICB9OwoKICAgICAgICB2YXIgbGFiZWwgPSB0aGlzLl9tYWtlTGFiZWwocGF0aFtwYXRoLmxlbmd0aCAtIDFdLCBwYXRoKTsKICAgICAgICB0aGlzLl9tYWtlSXRlbShwYXRoLCBsYWJlbCwgZGl2KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfc2hvd0NvbG9yUGlja2VyJywKCiAgICAgIC8qKgogICAgICAgKiB1c2VkIGJ5IHRoZSBjb2xvciBidXR0b25zIHRvIGNhbGwgdGhlIGNvbG9yIHBpY2tlci4KICAgICAgICogQHBhcmFtIGV2ZW50CiAgICAgICAqIEBwYXJhbSB2YWx1ZQogICAgICAgKiBAcGFyYW0gZGl2CiAgICAgICAqIEBwYXJhbSBwYXRoCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3Nob3dDb2xvclBpY2tlcih2YWx1ZSwgZGl2LCBwYXRoKSB7CiAgICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICAgIHZhciByZWN0ID0gZGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgIHZhciBib2R5UmVjdCA9IGRvY3VtZW50LmJvZHkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgdmFyIHBpY2tlclggPSByZWN0LmxlZnQgKyByZWN0LndpZHRoICsgNTsKICAgICAgICB2YXIgcGlja2VyWSA9IHJlY3QudG9wIC0gYm9keVJlY3QudG9wICsgcmVjdC5oZWlnaHQgKiAwLjU7CiAgICAgICAgdGhpcy5jb2xvclBpY2tlci5zaG93KHBpY2tlclgsIHBpY2tlclkpOwogICAgICAgIHRoaXMuY29sb3JQaWNrZXIuc2V0Q29sb3IodmFsdWUpOwogICAgICAgIHRoaXMuY29sb3JQaWNrZXIuc2V0Q2FsbGJhY2soZnVuY3Rpb24gKGNvbG9yKSB7CiAgICAgICAgICB2YXIgY29sb3JTdHJpbmcgPSAncmdiYSgnICsgY29sb3IuciArICcsJyArIGNvbG9yLmcgKyAnLCcgKyBjb2xvci5iICsgJywnICsgY29sb3IuYSArICcpJzsKICAgICAgICAgIGRpdi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvclN0cmluZzsKICAgICAgICAgIF90aGlzNC5fdXBkYXRlKGNvbG9yU3RyaW5nLCBwYXRoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfaGFuZGxlT2JqZWN0JywKCiAgICAgIC8qKgogICAgICAgKiBwYXJzZSBhbiBvYmplY3QgYW5kIGRyYXcgdGhlIGNvcnJlY3QgaXRlbXMKICAgICAgICogQHBhcmFtIG9iagogICAgICAgKiBAcGFyYW0gcGF0aAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9oYW5kbGVPYmplY3Qob2JqKSB7CiAgICAgICAgdmFyIHBhdGggPSBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IFtdIDogYXJndW1lbnRzWzFdOwogICAgICAgIHZhciBjaGVja09ubHkgPSBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzJdOwoKICAgICAgICB2YXIgc2hvdyA9IGZhbHNlOwogICAgICAgIHZhciBmaWx0ZXIgPSB0aGlzLm9wdGlvbnMuZmlsdGVyOwogICAgICAgIHZhciB2aXNpYmxlSW5TZXQgPSBmYWxzZTsKICAgICAgICBmb3IgKHZhciBzdWJPYmogaW4gb2JqKSB7CiAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHN1Yk9iaikpIHsKICAgICAgICAgICAgc2hvdyA9IHRydWU7CiAgICAgICAgICAgIHZhciBpdGVtID0gb2JqW3N1Yk9ial07CiAgICAgICAgICAgIHZhciBuZXdQYXRoID0gdXRpbC5jb3B5QW5kRXh0ZW5kQXJyYXkocGF0aCwgc3ViT2JqKTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBmaWx0ZXIgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICBzaG93ID0gZmlsdGVyKHN1Yk9iaiwgcGF0aCk7CgogICAgICAgICAgICAgIC8vIGlmIG5lZWRlZCB3ZSBtdXN0IGdvIGRlZXBlciBpbnRvIHRoZSBvYmplY3QuCiAgICAgICAgICAgICAgaWYgKHNob3cgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBpZiAoIShpdGVtIGluc3RhbmNlb2YgQXJyYXkpICYmIHR5cGVvZiBpdGVtICE9PSAnc3RyaW5nJyAmJiB0eXBlb2YgaXRlbSAhPT0gJ2Jvb2xlYW4nICYmIGl0ZW0gaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5hbGxvd0NyZWF0aW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHNob3cgPSB0aGlzLl9oYW5kbGVPYmplY3QoaXRlbSwgbmV3UGF0aCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuYWxsb3dDcmVhdGlvbiA9IGNoZWNrT25seSA9PT0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2hvdyAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICB2aXNpYmxlSW5TZXQgPSB0cnVlOwogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuX2dldFZhbHVlKG5ld1BhdGgpOwoKICAgICAgICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIEFycmF5KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVBcnJheShpdGVtLCB2YWx1ZSwgbmV3UGF0aCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIHRoaXMuX21ha2VUZXh0SW5wdXQoaXRlbSwgdmFsdWUsIG5ld1BhdGgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGl0ZW0gPT09ICdib29sZWFuJykgewogICAgICAgICAgICAgICAgdGhpcy5fbWFrZUNoZWNrYm94KGl0ZW0sIHZhbHVlLCBuZXdQYXRoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0gaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgICAgICAgICAgIC8vIGNvbGxhcHNlIHRoZSBwaHlzaWNzIG9wdGlvbnMgdGhhdCBhcmUgbm90IGVuYWJsZWQKICAgICAgICAgICAgICAgIHZhciBkcmF3ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChwYXRoLmluZGV4T2YoJ3BoeXNpY3MnKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kdWxlT3B0aW9ucy5waHlzaWNzLnNvbHZlciAhPT0gc3ViT2JqKSB7CiAgICAgICAgICAgICAgICAgICAgZHJhdyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGRyYXcgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgLy8gaW5pdGlhbGx5IGNvbGxhcHNlIG9wdGlvbnMgd2l0aCBhbiBkaXNhYmxlZCBlbmFibGVkIG9wdGlvbi4KICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVuYWJsZWRQYXRoID0gdXRpbC5jb3B5QW5kRXh0ZW5kQXJyYXkobmV3UGF0aCwgJ2VuYWJsZWQnKTsKICAgICAgICAgICAgICAgICAgICB2YXIgZW5hYmxlZFZhbHVlID0gdGhpcy5fZ2V0VmFsdWUoZW5hYmxlZFBhdGgpOwogICAgICAgICAgICAgICAgICAgIGlmIChlbmFibGVkVmFsdWUgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9IHRoaXMuX21ha2VMYWJlbChzdWJPYmosIG5ld1BhdGgsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFrZUl0ZW0obmV3UGF0aCwgbGFiZWwpOwogICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZUluU2V0ID0gdGhpcy5faGFuZGxlT2JqZWN0KGl0ZW0sIG5ld1BhdGgpIHx8IHZpc2libGVJblNldDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFrZUNoZWNrYm94KGl0ZW0sIGVuYWJsZWRWYWx1ZSwgbmV3UGF0aCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHZhciBsYWJlbCA9IHRoaXMuX21ha2VMYWJlbChzdWJPYmosIG5ld1BhdGgsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX21ha2VJdGVtKG5ld1BhdGgsIGxhYmVsKTsKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlSW5TZXQgPSB0aGlzLl9oYW5kbGVPYmplY3QoaXRlbSwgbmV3UGF0aCkgfHwgdmlzaWJsZUluU2V0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2RvbnQga25vdyBob3cgdG8gaGFuZGxlJywgaXRlbSwgc3ViT2JqLCBuZXdQYXRoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZpc2libGVJblNldDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfaGFuZGxlQXJyYXknLAoKICAgICAgLyoqCiAgICAgICAqIGhhbmRsZSB0aGUgYXJyYXkgdHlwZSBvZiBvcHRpb24KICAgICAgICogQHBhcmFtIG9wdGlvbk5hbWUKICAgICAgICogQHBhcmFtIGFycgogICAgICAgKiBAcGFyYW0gdmFsdWUKICAgICAgICogQHBhcmFtIHBhdGgKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlQXJyYXkoYXJyLCB2YWx1ZSwgcGF0aCkgewogICAgICAgIGlmICh0eXBlb2YgYXJyWzBdID09PSAnc3RyaW5nJyAmJiBhcnJbMF0gPT09ICdjb2xvcicpIHsKICAgICAgICAgIHRoaXMuX21ha2VDb2xvckZpZWxkKGFyciwgdmFsdWUsIHBhdGgpOwogICAgICAgICAgaWYgKGFyclsxXSAhPT0gdmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5jaGFuZ2VkT3B0aW9ucy5wdXNoKHsgcGF0aDogcGF0aCwgdmFsdWU6IHZhbHVlIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyclswXSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHRoaXMuX21ha2VEcm9wZG93bihhcnIsIHZhbHVlLCBwYXRoKTsKICAgICAgICAgIGlmIChhcnJbMF0gIT09IHZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMuY2hhbmdlZE9wdGlvbnMucHVzaCh7IHBhdGg6IHBhdGgsIHZhbHVlOiB2YWx1ZSB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcnJbMF0gPT09ICdudW1iZXInKSB7CiAgICAgICAgICB0aGlzLl9tYWtlUmFuZ2UoYXJyLCB2YWx1ZSwgcGF0aCk7CiAgICAgICAgICBpZiAoYXJyWzBdICE9PSB2YWx1ZSkgewogICAgICAgICAgICB0aGlzLmNoYW5nZWRPcHRpb25zLnB1c2goeyBwYXRoOiBwYXRoLCB2YWx1ZTogTnVtYmVyKHZhbHVlKSB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3VwZGF0ZScsCgogICAgICAvKioKICAgICAgICogY2FsbGVkIHRvIHVwZGF0ZSB0aGUgbmV0d29yayB3aXRoIHRoZSBuZXcgc2V0dGluZ3MuCiAgICAgICAqIEBwYXJhbSB2YWx1ZQogICAgICAgKiBAcGFyYW0gcGF0aAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF91cGRhdGUodmFsdWUsIHBhdGgpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IHRoaXMuX2NvbnN0cnVjdE9wdGlvbnModmFsdWUsIHBhdGgpOwogICAgICAgIHRoaXMucGFyZW50LnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2NvbnN0cnVjdE9wdGlvbnMnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NvbnN0cnVjdE9wdGlvbnModmFsdWUsIHBhdGgpIHsKICAgICAgICB2YXIgb3B0aW9uc09iaiA9IGFyZ3VtZW50c1syXSA9PT0gdW5kZWZpbmVkID8ge30gOiBhcmd1bWVudHNbMl07CgogICAgICAgIHZhciBwb2ludGVyID0gb3B0aW9uc09iajsKCiAgICAgICAgLy8gd2hlbiBkcm9wZG93biBib3hlcyBjYW4gYmUgc3RyaW5nIG9yIGJvb2xlYW4sIHdlIHR5cGVjYXN0IGl0IGludG8gY29ycmVjdCB0eXBlcwogICAgICAgIHZhbHVlID0gdmFsdWUgPT09ICd0cnVlJyA/IHRydWUgOiB2YWx1ZTsKICAgICAgICB2YWx1ZSA9IHZhbHVlID09PSAnZmFsc2UnID8gZmFsc2UgOiB2YWx1ZTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAocGF0aFtpXSAhPT0gJ2dsb2JhbCcpIHsKICAgICAgICAgICAgaWYgKHBvaW50ZXJbcGF0aFtpXV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHBvaW50ZXJbcGF0aFtpXV0gPSB7fTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaSAhPT0gcGF0aC5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgcG9pbnRlciA9IHBvaW50ZXJbcGF0aFtpXV07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcG9pbnRlcltwYXRoW2ldXSA9IHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBvcHRpb25zT2JqOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19wcmludE9wdGlvbnMnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX3ByaW50T3B0aW9ucygpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IHt9OwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGFuZ2VkT3B0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdGhpcy5fY29uc3RydWN0T3B0aW9ucyh0aGlzLmNoYW5nZWRPcHRpb25zW2ldLnZhbHVlLCB0aGlzLmNoYW5nZWRPcHRpb25zW2ldLnBhdGgsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICB0aGlzLm9wdGlvbnNDb250YWluZXIuaW5uZXJIVE1MID0gJzxwcmU+dmFyIG9wdGlvbnMgPSAnICsgSlNPTi5zdHJpbmdpZnkob3B0aW9ucywgbnVsbCwgMikgKyAnPC9wcmU+JzsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBDb25maWd1cmF0b3I7CiAgfSkoKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gQ29uZmlndXJhdG9yOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogNDYgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIHZhciBIYW1tZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKTsKICB2YXIgaGFtbWVyVXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMjgpOwogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgdmFyIENvbG9yUGlja2VyID0gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIENvbG9yUGlja2VyKCkgewogICAgICB2YXIgcGl4ZWxSYXRpbyA9IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gMSA6IGFyZ3VtZW50c1swXTsKCiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDb2xvclBpY2tlcik7CgogICAgICB0aGlzLnBpeGVsUmF0aW8gPSBwaXhlbFJhdGlvOwogICAgICB0aGlzLmdlbmVyYXRlZCA9IGZhbHNlOwogICAgICB0aGlzLmNlbnRlckNvb3JkaW5hdGVzID0geyB4OiAyODkgLyAyLCB5OiAyODkgLyAyIH07CiAgICAgIHRoaXMuciA9IDI4OSAqIDAuNDk7CiAgICAgIHRoaXMuY29sb3IgPSB7IHI6IDI1NSwgZzogMjU1LCBiOiAyNTUsIGE6IDEgfTsKICAgICAgdGhpcy5odWVDaXJjbGUgPSB1bmRlZmluZWQ7CiAgICAgIHRoaXMuaW5pdGlhbENvbG9yID0geyByOiAyNTUsIGc6IDI1NSwgYjogMjU1LCBhOiAxIH07CiAgICAgIHRoaXMucHJldmlvdXNDb2xvciA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy5hcHBsaWVkID0gZmFsc2U7CgogICAgICAvLyBib3VuZCBieQogICAgICB0aGlzLnVwZGF0ZUNhbGxiYWNrID0gZnVuY3Rpb24gKCkge307CgogICAgICAvLyBjcmVhdGUgYWxsIERPTSBlbGVtZW50cwogICAgICB0aGlzLl9jcmVhdGUoKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoQ29sb3JQaWNrZXIsIFt7CiAgICAgIGtleTogJ2luc2VydFRvJywKCiAgICAgIC8qKgogICAgICAgKiB0aGlzIGluc2VydHMgdGhlIGNvbG9yUGlja2VyIGludG8gYSBkaXYgZnJvbSB0aGUgRE9NCiAgICAgICAqIEBwYXJhbSBjb250YWluZXIKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBpbnNlcnRUbyhjb250YWluZXIpIHsKICAgICAgICBpZiAodGhpcy5oYW1tZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5oYW1tZXIuZGVzdHJveSgpOwogICAgICAgICAgdGhpcy5oYW1tZXIgPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyOwogICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZnJhbWUpOwogICAgICAgIHRoaXMuX2JpbmRIYW1tZXIoKTsKCiAgICAgICAgdGhpcy5fc2V0U2l6ZSgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3NldENhbGxiYWNrJywKCiAgICAgIC8qKgogICAgICAgKiB0aGUgY2FsbGJhY2sgaXMgZXhlY3V0ZWQgb24gYXBwbHkgYW5kIHNhdmUuIEJpbmQgaXQgdG8gdGhlIGFwcGxpY2F0aW9uCiAgICAgICAqIEBwYXJhbSBjYWxsYmFjawogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldENhbGxiYWNrKGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdGhpcy51cGRhdGVDYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Z1bmN0aW9uIGF0dGVtcHRlZCB0byBzZXQgYXMgY29sb3JQaWNrZXIgY2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24uJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19pc0NvbG9yU3RyaW5nJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9pc0NvbG9yU3RyaW5nKGNvbG9yKSB7CiAgICAgICAgdmFyIGh0bWxDb2xvcnMgPSB7IGJsYWNrOiAnIzAwMDAwMCcsIG5hdnk6ICcjMDAwMDgwJywgZGFya2JsdWU6ICcjMDAwMDhCJywgbWVkaXVtYmx1ZTogJyMwMDAwQ0QnLCBibHVlOiAnIzAwMDBGRicsIGRhcmtncmVlbjogJyMwMDY0MDAnLCBncmVlbjogJyMwMDgwMDAnLCB0ZWFsOiAnIzAwODA4MCcsIGRhcmtjeWFuOiAnIzAwOEI4QicsIGRlZXBza3libHVlOiAnIzAwQkZGRicsIGRhcmt0dXJxdW9pc2U6ICcjMDBDRUQxJywgbWVkaXVtc3ByaW5nZ3JlZW46ICcjMDBGQTlBJywgbGltZTogJyMwMEZGMDAnLCBzcHJpbmdncmVlbjogJyMwMEZGN0YnLCBhcXVhOiAnIzAwRkZGRicsIGN5YW46ICcjMDBGRkZGJywgbWlkbmlnaHRibHVlOiAnIzE5MTk3MCcsIGRvZGdlcmJsdWU6ICcjMUU5MEZGJywgbGlnaHRzZWFncmVlbjogJyMyMEIyQUEnLCBmb3Jlc3RncmVlbjogJyMyMjhCMjInLCBzZWFncmVlbjogJyMyRThCNTcnLCBkYXJrc2xhdGVncmF5OiAnIzJGNEY0RicsIGxpbWVncmVlbjogJyMzMkNEMzInLCBtZWRpdW1zZWFncmVlbjogJyMzQ0IzNzEnLCB0dXJxdW9pc2U6ICcjNDBFMEQwJywgcm95YWxibHVlOiAnIzQxNjlFMScsIHN0ZWVsYmx1ZTogJyM0NjgyQjQnLCBkYXJrc2xhdGVibHVlOiAnIzQ4M0Q4QicsIG1lZGl1bXR1cnF1b2lzZTogJyM0OEQxQ0MnLCBpbmRpZ286ICcjNEIwMDgyJywgZGFya29saXZlZ3JlZW46ICcjNTU2QjJGJywgY2FkZXRibHVlOiAnIzVGOUVBMCcsIGNvcm5mbG93ZXJibHVlOiAnIzY0OTVFRCcsIG1lZGl1bWFxdWFtYXJpbmU6ICcjNjZDREFBJywgZGltZ3JheTogJyM2OTY5NjknLCBzbGF0ZWJsdWU6ICcjNkE1QUNEJywgb2xpdmVkcmFiOiAnIzZCOEUyMycsIHNsYXRlZ3JheTogJyM3MDgwOTAnLCBsaWdodHNsYXRlZ3JheTogJyM3Nzg4OTknLCBtZWRpdW1zbGF0ZWJsdWU6ICcjN0I2OEVFJywgbGF3bmdyZWVuOiAnIzdDRkMwMCcsIGNoYXJ0cmV1c2U6ICcjN0ZGRjAwJywgYXF1YW1hcmluZTogJyM3RkZGRDQnLCBtYXJvb246ICcjODAwMDAwJywgcHVycGxlOiAnIzgwMDA4MCcsIG9saXZlOiAnIzgwODAwMCcsIGdyYXk6ICcjODA4MDgwJywgc2t5Ymx1ZTogJyM4N0NFRUInLCBsaWdodHNreWJsdWU6ICcjODdDRUZBJywgYmx1ZXZpb2xldDogJyM4QTJCRTInLCBkYXJrcmVkOiAnIzhCMDAwMCcsIGRhcmttYWdlbnRhOiAnIzhCMDA4QicsIHNhZGRsZWJyb3duOiAnIzhCNDUxMycsIGRhcmtzZWFncmVlbjogJyM4RkJDOEYnLCBsaWdodGdyZWVuOiAnIzkwRUU5MCcsIG1lZGl1bXB1cnBsZTogJyM5MzcwRDgnLCBkYXJrdmlvbGV0OiAnIzk0MDBEMycsIHBhbGVncmVlbjogJyM5OEZCOTgnLCBkYXJrb3JjaGlkOiAnIzk5MzJDQycsIHllbGxvd2dyZWVuOiAnIzlBQ0QzMicsIHNpZW5uYTogJyNBMDUyMkQnLCBicm93bjogJyNBNTJBMkEnLCBkYXJrZ3JheTogJyNBOUE5QTknLCBsaWdodGJsdWU6ICcjQUREOEU2JywgZ3JlZW55ZWxsb3c6ICcjQURGRjJGJywgcGFsZXR1cnF1b2lzZTogJyNBRkVFRUUnLCBsaWdodHN0ZWVsYmx1ZTogJyNCMEM0REUnLCBwb3dkZXJibHVlOiAnI0IwRTBFNicsIGZpcmVicmljazogJyNCMjIyMjInLCBkYXJrZ29sZGVucm9kOiAnI0I4ODYwQicsIG1lZGl1bW9yY2hpZDogJyNCQTU1RDMnLCByb3N5YnJvd246ICcjQkM4RjhGJywgZGFya2toYWtpOiAnI0JEQjc2QicsIHNpbHZlcjogJyNDMEMwQzAnLCBtZWRpdW12aW9sZXRyZWQ6ICcjQzcxNTg1JywgaW5kaWFucmVkOiAnI0NENUM1QycsIHBlcnU6ICcjQ0Q4NTNGJywgY2hvY29sYXRlOiAnI0QyNjkxRScsIHRhbjogJyNEMkI0OEMnLCBsaWdodGdyZXk6ICcjRDNEM0QzJywgcGFsZXZpb2xldHJlZDogJyNEODcwOTMnLCB0aGlzdGxlOiAnI0Q4QkZEOCcsIG9yY2hpZDogJyNEQTcwRDYnLCBnb2xkZW5yb2Q6ICcjREFBNTIwJywgY3JpbXNvbjogJyNEQzE0M0MnLCBnYWluc2Jvcm86ICcjRENEQ0RDJywgcGx1bTogJyNEREEwREQnLCBidXJseXdvb2Q6ICcjREVCODg3JywgbGlnaHRjeWFuOiAnI0UwRkZGRicsIGxhdmVuZGVyOiAnI0U2RTZGQScsIGRhcmtzYWxtb246ICcjRTk5NjdBJywgdmlvbGV0OiAnI0VFODJFRScsIHBhbGVnb2xkZW5yb2Q6ICcjRUVFOEFBJywgbGlnaHRjb3JhbDogJyNGMDgwODAnLCBraGFraTogJyNGMEU2OEMnLCBhbGljZWJsdWU6ICcjRjBGOEZGJywgaG9uZXlkZXc6ICcjRjBGRkYwJywgYXp1cmU6ICcjRjBGRkZGJywgc2FuZHlicm93bjogJyNGNEE0NjAnLCB3aGVhdDogJyNGNURFQjMnLCBiZWlnZTogJyNGNUY1REMnLCB3aGl0ZXNtb2tlOiAnI0Y1RjVGNScsIG1pbnRjcmVhbTogJyNGNUZGRkEnLCBnaG9zdHdoaXRlOiAnI0Y4RjhGRicsIHNhbG1vbjogJyNGQTgwNzInLCBhbnRpcXVld2hpdGU6ICcjRkFFQkQ3JywgbGluZW46ICcjRkFGMEU2JywgbGlnaHRnb2xkZW5yb2R5ZWxsb3c6ICcjRkFGQUQyJywgb2xkbGFjZTogJyNGREY1RTYnLCByZWQ6ICcjRkYwMDAwJywgZnVjaHNpYTogJyNGRjAwRkYnLCBtYWdlbnRhOiAnI0ZGMDBGRicsIGRlZXBwaW5rOiAnI0ZGMTQ5MycsIG9yYW5nZXJlZDogJyNGRjQ1MDAnLCB0b21hdG86ICcjRkY2MzQ3JywgaG90cGluazogJyNGRjY5QjQnLCBjb3JhbDogJyNGRjdGNTAnLCBkYXJrb3JhbmdlOiAnI0ZGOEMwMCcsIGxpZ2h0c2FsbW9uOiAnI0ZGQTA3QScsIG9yYW5nZTogJyNGRkE1MDAnLCBsaWdodHBpbms6ICcjRkZCNkMxJywgcGluazogJyNGRkMwQ0InLCBnb2xkOiAnI0ZGRDcwMCcsIHBlYWNocHVmZjogJyNGRkRBQjknLCBuYXZham93aGl0ZTogJyNGRkRFQUQnLCBtb2NjYXNpbjogJyNGRkU0QjUnLCBiaXNxdWU6ICcjRkZFNEM0JywgbWlzdHlyb3NlOiAnI0ZGRTRFMScsIGJsYW5jaGVkYWxtb25kOiAnI0ZGRUJDRCcsIHBhcGF5YXdoaXA6ICcjRkZFRkQ1JywgbGF2ZW5kZXJibHVzaDogJyNGRkYwRjUnLCBzZWFzaGVsbDogJyNGRkY1RUUnLCBjb3Juc2lsazogJyNGRkY4REMnLCBsZW1vbmNoaWZmb246ICcjRkZGQUNEJywgZmxvcmFsd2hpdGU6ICcjRkZGQUYwJywgc25vdzogJyNGRkZBRkEnLCB5ZWxsb3c6ICcjRkZGRjAwJywgbGlnaHR5ZWxsb3c6ICcjRkZGRkUwJywgaXZvcnk6ICcjRkZGRkYwJywgd2hpdGU6ICcjRkZGRkZGJyB9OwogICAgICAgIGlmICh0eXBlb2YgY29sb3IgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICByZXR1cm4gaHRtbENvbG9yc1tjb2xvcl07CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3NldENvbG9yJywKCiAgICAgIC8qKgogICAgICAgKiBTZXQgdGhlIGNvbG9yIG9mIHRoZSBjb2xvclBpY2tlcgogICAgICAgKiBTdXBwb3J0ZWQgZm9ybWF0czoKICAgICAgICogJ3JlZCcgICAgICAgICAgICAgICAgICAgLS0+IEhUTUwgY29sb3Igc3RyaW5nCiAgICAgICAqICcjZmZmZmZmJyAgICAgICAgICAgICAgIC0tPiBoZXggc3RyaW5nCiAgICAgICAqICdyYmcoMjU1LDI1NSwyNTUpJyAgICAgIC0tPiByZ2Igc3RyaW5nCiAgICAgICAqICdyZ2JhKDI1NSwyNTUsMjU1LDEuMCknIC0tPiByZ2JhIHN0cmluZwogICAgICAgKiB7cjoyNTUsZzoyNTUsYjoyNTV9ICAgICAtLT4gcmdiIG9iamVjdAogICAgICAgKiB7cjoyNTUsZzoyNTUsYjoyNTUsYToxLjB9IC0tPiByZ2JhIG9iamVjdAogICAgICAgKiBAcGFyYW0gY29sb3IKICAgICAgICogQHBhcmFtIHNldEluaXRpYWwKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDb2xvcihjb2xvcikgewogICAgICAgIHZhciBzZXRJbml0aWFsID0gYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB0cnVlIDogYXJndW1lbnRzWzFdOwoKICAgICAgICBpZiAoY29sb3IgPT09ICdub25lJykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHJnYmEgPSB1bmRlZmluZWQ7CgogICAgICAgIC8vIGlmIGEgaHRtbCBjb2xvciBzaG9ydGhhbmQgaXMgdXNlZCwgY29udmVydCB0byBoZXgKICAgICAgICB2YXIgaHRtbENvbG9yID0gdGhpcy5faXNDb2xvclN0cmluZyhjb2xvcik7CiAgICAgICAgaWYgKGh0bWxDb2xvciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBjb2xvciA9IGh0bWxDb2xvcjsKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGZvcm1hdAogICAgICAgIGlmICh1dGlsLmlzU3RyaW5nKGNvbG9yKSA9PT0gdHJ1ZSkgewogICAgICAgICAgaWYgKHV0aWwuaXNWYWxpZFJHQihjb2xvcikgPT09IHRydWUpIHsKICAgICAgICAgICAgdmFyIHJnYmFBcnJheSA9IGNvbG9yLnN1YnN0cig0KS5zdWJzdHIoMCwgY29sb3IubGVuZ3RoIC0gNSkuc3BsaXQoJywnKTsKICAgICAgICAgICAgcmdiYSA9IHsgcjogcmdiYUFycmF5WzBdLCBnOiByZ2JhQXJyYXlbMV0sIGI6IHJnYmFBcnJheVsyXSwgYTogMSB9OwogICAgICAgICAgfSBlbHNlIGlmICh1dGlsLmlzVmFsaWRSR0JBKGNvbG9yKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgcmdiYUFycmF5ID0gY29sb3Iuc3Vic3RyKDUpLnN1YnN0cigwLCBjb2xvci5sZW5ndGggLSA2KS5zcGxpdCgnLCcpOwogICAgICAgICAgICByZ2JhID0geyByOiByZ2JhQXJyYXlbMF0sIGc6IHJnYmFBcnJheVsxXSwgYjogcmdiYUFycmF5WzJdLCBhOiByZ2JhQXJyYXlbM10gfTsKICAgICAgICAgIH0gZWxzZSBpZiAodXRpbC5pc1ZhbGlkSGV4KGNvbG9yKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgcmdiT2JqID0gdXRpbC5oZXhUb1JHQihjb2xvcik7CiAgICAgICAgICAgIHJnYmEgPSB7IHI6IHJnYk9iai5yLCBnOiByZ2JPYmouZywgYjogcmdiT2JqLmIsIGE6IDEgfTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGNvbG9yIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgICAgICAgIGlmIChjb2xvci5yICE9PSB1bmRlZmluZWQgJiYgY29sb3IuZyAhPT0gdW5kZWZpbmVkICYmIGNvbG9yLmIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHZhciBhbHBoYSA9IGNvbG9yLmEgIT09IHVuZGVmaW5lZCA/IGNvbG9yLmEgOiAnMS4wJzsKICAgICAgICAgICAgICByZ2JhID0geyByOiBjb2xvci5yLCBnOiBjb2xvci5nLCBiOiBjb2xvci5iLCBhOiBhbHBoYSB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBzZXQgY29sb3IKICAgICAgICBpZiAocmdiYSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gY29sb3IgcGFzc2VkIHRvIHRoZSBjb2xvclBpY2tlci4gU3VwcG9ydGVkIGFyZSBzdHJpbmdzOiByZ2IsIGhleCwgcmdiYS4gT2JqZWN0OiByZ2IgKHtyOnIsZzpnLGI6YixbYTphXX0pLiBTdXBwbGllZDogJyArIEpTT04uc3RyaW5naWZ5KGNvbG9yKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX3NldENvbG9yKHJnYmEsIHNldEluaXRpYWwpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzaG93JywKCiAgICAgIC8qKgogICAgICAgKiB0aGlzIHNob3dzIHRoZSBjb2xvciBwaWNrZXIgYXQgYSBsb2NhdGlvbi4gVGhlIGh1ZSBjaXJjbGUgaXMgY29uc3RydWN0ZWQgb25jZSBhbmQgc3RvcmVkLgogICAgICAgKiBAcGFyYW0geAogICAgICAgKiBAcGFyYW0geQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNob3coeCwgeSkgewogICAgICAgIHRoaXMuYXBwbGllZCA9IGZhbHNlOwogICAgICAgIHRoaXMuZnJhbWUuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgdGhpcy5mcmFtZS5zdHlsZS50b3AgPSB5ICsgJ3B4JzsKICAgICAgICB0aGlzLmZyYW1lLnN0eWxlLmxlZnQgPSB4ICsgJ3B4JzsKICAgICAgICB0aGlzLl9nZW5lcmF0ZUh1ZUNpcmNsZSgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19oaWRlJywKCiAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBQUklWQVRFIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vCgogICAgICAvKioKICAgICAgICogSGlkZSB0aGUgcGlja2VyLiBJcyBjYWxsZWQgYnkgdGhlIGNhbmNlbCBidXR0b24uCiAgICAgICAqIE9wdGlvbmFsIGJvb2xlYW4gdG8gc3RvcmUgdGhlIHByZXZpb3VzIGNvbG9yIGZvciBlYXN5IGFjY2VzcyBsYXRlciBvbi4KICAgICAgICogQHBhcmFtIHN0b3JlUHJldmlvdXMKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfaGlkZSgpIHsKICAgICAgICB2YXIgc3RvcmVQcmV2aW91cyA9IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGFyZ3VtZW50c1swXTsKCiAgICAgICAgLy8gc3RvcmUgdGhlIHByZXZpb3VzIGNvbG9yIGZvciBuZXh0IHRpbWU7CiAgICAgICAgaWYgKHN0b3JlUHJldmlvdXMgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMucHJldmlvdXNDb2xvciA9IHV0aWwuZXh0ZW5kKHt9LCB0aGlzLmNvbG9yKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmFwcGxpZWQgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMudXBkYXRlQ2FsbGJhY2sodGhpcy5pbml0aWFsQ29sb3IpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5mcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19zYXZlJywKCiAgICAgIC8qKgogICAgICAgKiBib3VuZCB0byB0aGUgc2F2ZSBidXR0b24uIFNhdmVzIGFuZCBoaWRlcy4KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc2F2ZSgpIHsKICAgICAgICB0aGlzLnVwZGF0ZUNhbGxiYWNrKHRoaXMuY29sb3IpOwogICAgICAgIHRoaXMuYXBwbGllZCA9IGZhbHNlOwogICAgICAgIHRoaXMuX2hpZGUoKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfYXBwbHknLAoKICAgICAgLyoqCiAgICAgICAqIEJvdW5kIHRvIGFwcGx5IGJ1dHRvbi4gU2F2ZXMgYnV0IGRvZXMgbm90IGNsb3NlLiBJcyB1bmRvbmUgYnkgdGhlIGNhbmNlbCBidXR0b24uCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2FwcGx5KCkgewogICAgICAgIHRoaXMuYXBwbGllZCA9IHRydWU7CiAgICAgICAgdGhpcy51cGRhdGVDYWxsYmFjayh0aGlzLmNvbG9yKTsKICAgICAgICB0aGlzLl91cGRhdGVQaWNrZXIodGhpcy5jb2xvcik7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2xvYWRMYXN0JywKCiAgICAgIC8qKgogICAgICAgKiBsb2FkIHRoZSBjb2xvciBmcm9tIHRoZSBwcmV2aW91cyBzZXNzaW9uLgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9sb2FkTGFzdCgpIHsKICAgICAgICBpZiAodGhpcy5wcmV2aW91c0NvbG9yICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuc2V0Q29sb3IodGhpcy5wcmV2aW91c0NvbG9yLCBmYWxzZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFsZXJ0KCdUaGVyZSBpcyBubyBsYXN0IGNvbG9yIHRvIGxvYWQuLi4nKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3NldENvbG9yJywKCiAgICAgIC8qKgogICAgICAgKiBzZXQgdGhlIGNvbG9yLCBwbGFjZSB0aGUgcGlja2VyCiAgICAgICAqIEBwYXJhbSByZ2JhCiAgICAgICAqIEBwYXJhbSBzZXRJbml0aWFsCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3NldENvbG9yKHJnYmEpIHsKICAgICAgICB2YXIgc2V0SW5pdGlhbCA9IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGFyZ3VtZW50c1sxXTsKCiAgICAgICAgLy8gc3RvcmUgdGhlIGluaXRpYWwgY29sb3IKICAgICAgICBpZiAoc2V0SW5pdGlhbCA9PT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy5pbml0aWFsQ29sb3IgPSB1dGlsLmV4dGVuZCh7fSwgcmdiYSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNvbG9yID0gcmdiYTsKICAgICAgICB2YXIgaHN2ID0gdXRpbC5SR0JUb0hTVihyZ2JhLnIsIHJnYmEuZywgcmdiYS5iKTsKCiAgICAgICAgdmFyIGFuZ2xlQ29udmVydCA9IDIgKiBNYXRoLlBJOwogICAgICAgIHZhciByYWRpdXMgPSB0aGlzLnIgKiBoc3YuczsKICAgICAgICB2YXIgeCA9IHRoaXMuY2VudGVyQ29vcmRpbmF0ZXMueCArIHJhZGl1cyAqIE1hdGguc2luKGFuZ2xlQ29udmVydCAqIGhzdi5oKTsKICAgICAgICB2YXIgeSA9IHRoaXMuY2VudGVyQ29vcmRpbmF0ZXMueSArIHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlQ29udmVydCAqIGhzdi5oKTsKCiAgICAgICAgdGhpcy5jb2xvclBpY2tlclNlbGVjdG9yLnN0eWxlLmxlZnQgPSB4IC0gMC41ICogdGhpcy5jb2xvclBpY2tlclNlbGVjdG9yLmNsaWVudFdpZHRoICsgJ3B4JzsKICAgICAgICB0aGlzLmNvbG9yUGlja2VyU2VsZWN0b3Iuc3R5bGUudG9wID0geSAtIDAuNSAqIHRoaXMuY29sb3JQaWNrZXJTZWxlY3Rvci5jbGllbnRIZWlnaHQgKyAncHgnOwoKICAgICAgICB0aGlzLl91cGRhdGVQaWNrZXIocmdiYSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3NldE9wYWNpdHknLAoKICAgICAgLyoqCiAgICAgICAqIGJvdW5kIHRvIG9wYWNpdHkgY29udHJvbAogICAgICAgKiBAcGFyYW0gdmFsdWUKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0T3BhY2l0eSh2YWx1ZSkgewogICAgICAgIHRoaXMuY29sb3IuYSA9IHZhbHVlIC8gMTAwOwogICAgICAgIHRoaXMuX3VwZGF0ZVBpY2tlcih0aGlzLmNvbG9yKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfc2V0QnJpZ2h0bmVzcycsCgogICAgICAvKioKICAgICAgICogYm91bmQgdG8gYnJpZ2h0bmVzcyBjb250cm9sCiAgICAgICAqIEBwYXJhbSB2YWx1ZQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXRCcmlnaHRuZXNzKHZhbHVlKSB7CiAgICAgICAgdmFyIGhzdiA9IHV0aWwuUkdCVG9IU1YodGhpcy5jb2xvci5yLCB0aGlzLmNvbG9yLmcsIHRoaXMuY29sb3IuYik7CiAgICAgICAgaHN2LnYgPSB2YWx1ZSAvIDEwMDsKICAgICAgICB2YXIgcmdiYSA9IHV0aWwuSFNWVG9SR0IoaHN2LmgsIGhzdi5zLCBoc3Yudik7CiAgICAgICAgcmdiYVsnYSddID0gdGhpcy5jb2xvci5hOwogICAgICAgIHRoaXMuY29sb3IgPSByZ2JhOwogICAgICAgIHRoaXMuX3VwZGF0ZVBpY2tlcigpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ191cGRhdGVQaWNrZXInLAoKICAgICAgLyoqCiAgICAgICAqIHVwZGF0ZSB0aGUgY29sb3JwaWNrZXIuIEEgYmxhY2sgY2lyY2xlIG92ZXJsYXlzIHRoZSBodWUgY2lyY2xlIHRvIG1pbWljIHRoZSBicmlnaHRuZXNzIGRlY3JlYXNpbmcuCiAgICAgICAqIEBwYXJhbSByZ2JhCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3VwZGF0ZVBpY2tlcigpIHsKICAgICAgICB2YXIgcmdiYSA9IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gdGhpcy5jb2xvciA6IGFyZ3VtZW50c1swXTsKCiAgICAgICAgdmFyIGhzdiA9IHV0aWwuUkdCVG9IU1YocmdiYS5yLCByZ2JhLmcsIHJnYmEuYik7CiAgICAgICAgdmFyIGN0eCA9IHRoaXMuY29sb3JQaWNrZXJDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBpZiAodGhpcy5waXhlbFJhdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnBpeGVsUmF0aW8gPSAod2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMSkgLyAoY3R4LndlYmtpdEJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgY3R4Lm1vekJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgY3R4Lm1zQmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHgub0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgY3R4LmJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgMSk7CiAgICAgICAgfQogICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0odGhpcy5waXhlbFJhdGlvLCAwLCAwLCB0aGlzLnBpeGVsUmF0aW8sIDAsIDApOwoKICAgICAgICAvLyBjbGVhciB0aGUgY2FudmFzCiAgICAgICAgdmFyIHcgPSB0aGlzLmNvbG9yUGlja2VyQ2FudmFzLmNsaWVudFdpZHRoOwogICAgICAgIHZhciBoID0gdGhpcy5jb2xvclBpY2tlckNhbnZhcy5jbGllbnRIZWlnaHQ7CiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3LCBoKTsKCiAgICAgICAgY3R4LnB1dEltYWdlRGF0YSh0aGlzLmh1ZUNpcmNsZSwgMCwgMCk7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2JhKDAsMCwwLCcgKyAoMSAtIGhzdi52KSArICcpJzsKICAgICAgICBjdHguY2lyY2xlKHRoaXMuY2VudGVyQ29vcmRpbmF0ZXMueCwgdGhpcy5jZW50ZXJDb29yZGluYXRlcy55LCB0aGlzLnIpOwogICAgICAgIGN0eC5maWxsKCk7CgogICAgICAgIHRoaXMuYnJpZ2h0bmVzc1JhbmdlLnZhbHVlID0gMTAwICogaHN2LnY7CiAgICAgICAgdGhpcy5vcGFjaXR5UmFuZ2UudmFsdWUgPSAxMDAgKiByZ2JhLmE7CgogICAgICAgIHRoaXMuaW5pdGlhbENvbG9yRGl2LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZ2JhKCcgKyB0aGlzLmluaXRpYWxDb2xvci5yICsgJywnICsgdGhpcy5pbml0aWFsQ29sb3IuZyArICcsJyArIHRoaXMuaW5pdGlhbENvbG9yLmIgKyAnLCcgKyB0aGlzLmluaXRpYWxDb2xvci5hICsgJyknOwogICAgICAgIHRoaXMubmV3Q29sb3JEaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3JnYmEoJyArIHRoaXMuY29sb3IuciArICcsJyArIHRoaXMuY29sb3IuZyArICcsJyArIHRoaXMuY29sb3IuYiArICcsJyArIHRoaXMuY29sb3IuYSArICcpJzsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfc2V0U2l6ZScsCgogICAgICAvKioKICAgICAgICogdXNlZCBieSBjcmVhdGUgdG8gc2V0IHRoZSBzaXplIG9mIHRoZSBjYW52YXMuCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3NldFNpemUoKSB7CiAgICAgICAgdGhpcy5jb2xvclBpY2tlckNhbnZhcy5zdHlsZS53aWR0aCA9ICcxMDAlJzsKICAgICAgICB0aGlzLmNvbG9yUGlja2VyQ2FudmFzLnN0eWxlLmhlaWdodCA9ICcxMDAlJzsKCiAgICAgICAgdGhpcy5jb2xvclBpY2tlckNhbnZhcy53aWR0aCA9IDI4OSAqIHRoaXMucGl4ZWxSYXRpbzsKICAgICAgICB0aGlzLmNvbG9yUGlja2VyQ2FudmFzLmhlaWdodCA9IDI4OSAqIHRoaXMucGl4ZWxSYXRpbzsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfY3JlYXRlJywKCiAgICAgIC8qKgogICAgICAgKiBjcmVhdGUgYWxsIGRvbSBlbGVtZW50cwogICAgICAgKiBUT0RPOiBjbGVhbnVwLCBsb3RzIG9mIHNpbWlsYXIgZG9tIGVsZW1lbnRzCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZSgpIHsKICAgICAgICB0aGlzLmZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdGhpcy5mcmFtZS5jbGFzc05hbWUgPSAndmlzLWNvbG9yLXBpY2tlcic7CgogICAgICAgIHRoaXMuY29sb3JQaWNrZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0aGlzLmNvbG9yUGlja2VyU2VsZWN0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0aGlzLmNvbG9yUGlja2VyU2VsZWN0b3IuY2xhc3NOYW1lID0gJ3Zpcy1zZWxlY3Rvcic7CiAgICAgICAgdGhpcy5jb2xvclBpY2tlckRpdi5hcHBlbmRDaGlsZCh0aGlzLmNvbG9yUGlja2VyU2VsZWN0b3IpOwoKICAgICAgICB0aGlzLmNvbG9yUGlja2VyQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgdGhpcy5jb2xvclBpY2tlckRpdi5hcHBlbmRDaGlsZCh0aGlzLmNvbG9yUGlja2VyQ2FudmFzKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbG9yUGlja2VyQ2FudmFzLmdldENvbnRleHQpIHsKICAgICAgICAgIHZhciBub0NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0RJVicpOwogICAgICAgICAgbm9DYW52YXMuc3R5bGUuY29sb3IgPSAncmVkJzsKICAgICAgICAgIG5vQ2FudmFzLnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7CiAgICAgICAgICBub0NhbnZhcy5zdHlsZS5wYWRkaW5nID0gJzEwcHgnOwogICAgICAgICAgbm9DYW52YXMuaW5uZXJIVE1MID0gJ0Vycm9yOiB5b3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBIVE1MIGNhbnZhcyc7CiAgICAgICAgICB0aGlzLmNvbG9yUGlja2VyQ2FudmFzLmFwcGVuZENoaWxkKG5vQ2FudmFzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGN0eCA9IHRoaXMuY29sb3JQaWNrZXJDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgIHRoaXMucGl4ZWxSYXRpbyA9ICh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxKSAvIChjdHgud2Via2l0QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHgubW96QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHgubXNCYWNraW5nU3RvcmVQaXhlbFJhdGlvIHx8IGN0eC5vQmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHguYmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCAxKTsKCiAgICAgICAgICB0aGlzLmNvbG9yUGlja2VyQ2FudmFzLmdldENvbnRleHQoJzJkJykuc2V0VHJhbnNmb3JtKHRoaXMucGl4ZWxSYXRpbywgMCwgMCwgdGhpcy5waXhlbFJhdGlvLCAwLCAwKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY29sb3JQaWNrZXJEaXYuY2xhc3NOYW1lID0gJ3Zpcy1jb2xvcic7CgogICAgICAgIHRoaXMub3BhY2l0eURpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHRoaXMub3BhY2l0eURpdi5jbGFzc05hbWUgPSAndmlzLW9wYWNpdHknOwoKICAgICAgICB0aGlzLmJyaWdodG5lc3NEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0aGlzLmJyaWdodG5lc3NEaXYuY2xhc3NOYW1lID0gJ3Zpcy1icmlnaHRuZXNzJzsKCiAgICAgICAgdGhpcy5hcnJvd0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHRoaXMuYXJyb3dEaXYuY2xhc3NOYW1lID0gJ3Zpcy1hcnJvdyc7CgogICAgICAgIHRoaXMub3BhY2l0eVJhbmdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgICB0cnkgewogICAgICAgICAgdGhpcy5vcGFjaXR5UmFuZ2UudHlwZSA9ICdyYW5nZSc7IC8vIE5vdCBzdXBwb3J0ZWQgb24gSUU5CiAgICAgICAgICB0aGlzLm9wYWNpdHlSYW5nZS5taW4gPSAnMCc7CiAgICAgICAgICB0aGlzLm9wYWNpdHlSYW5nZS5tYXggPSAnMTAwJzsKICAgICAgICB9IGNhdGNoIChlcnIpIHt9CiAgICAgICAgdGhpcy5vcGFjaXR5UmFuZ2UudmFsdWUgPSAnMTAwJzsKICAgICAgICB0aGlzLm9wYWNpdHlSYW5nZS5jbGFzc05hbWUgPSAndmlzLXJhbmdlJzsKCiAgICAgICAgdGhpcy5icmlnaHRuZXNzUmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLmJyaWdodG5lc3NSYW5nZS50eXBlID0gJ3JhbmdlJzsgLy8gTm90IHN1cHBvcnRlZCBvbiBJRTkKICAgICAgICAgIHRoaXMuYnJpZ2h0bmVzc1JhbmdlLm1pbiA9ICcwJzsKICAgICAgICAgIHRoaXMuYnJpZ2h0bmVzc1JhbmdlLm1heCA9ICcxMDAnOwogICAgICAgIH0gY2F0Y2ggKGVycikge30KICAgICAgICB0aGlzLmJyaWdodG5lc3NSYW5nZS52YWx1ZSA9ICcxMDAnOwogICAgICAgIHRoaXMuYnJpZ2h0bmVzc1JhbmdlLmNsYXNzTmFtZSA9ICd2aXMtcmFuZ2UnOwoKICAgICAgICB0aGlzLm9wYWNpdHlEaXYuYXBwZW5kQ2hpbGQodGhpcy5vcGFjaXR5UmFuZ2UpOwogICAgICAgIHRoaXMuYnJpZ2h0bmVzc0Rpdi5hcHBlbmRDaGlsZCh0aGlzLmJyaWdodG5lc3NSYW5nZSk7CgogICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgdGhpcy5vcGFjaXR5UmFuZ2Uub25jaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5fc2V0T3BhY2l0eSh0aGlzLnZhbHVlKTsKICAgICAgICB9OwogICAgICAgIHRoaXMub3BhY2l0eVJhbmdlLm9uaW5wdXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5fc2V0T3BhY2l0eSh0aGlzLnZhbHVlKTsKICAgICAgICB9OwogICAgICAgIHRoaXMuYnJpZ2h0bmVzc1JhbmdlLm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgbWUuX3NldEJyaWdodG5lc3ModGhpcy52YWx1ZSk7CiAgICAgICAgfTsKICAgICAgICB0aGlzLmJyaWdodG5lc3NSYW5nZS5vbmlucHV0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgbWUuX3NldEJyaWdodG5lc3ModGhpcy52YWx1ZSk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5icmlnaHRuZXNzTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0aGlzLmJyaWdodG5lc3NMYWJlbC5jbGFzc05hbWUgPSAndmlzLWxhYmVsIHZpcy1icmlnaHRuZXNzJzsKICAgICAgICB0aGlzLmJyaWdodG5lc3NMYWJlbC5pbm5lckhUTUwgPSAnYnJpZ2h0bmVzczonOwoKICAgICAgICB0aGlzLm9wYWNpdHlMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHRoaXMub3BhY2l0eUxhYmVsLmNsYXNzTmFtZSA9ICd2aXMtbGFiZWwgdmlzLW9wYWNpdHknOwogICAgICAgIHRoaXMub3BhY2l0eUxhYmVsLmlubmVySFRNTCA9ICdvcGFjaXR5Oic7CgogICAgICAgIHRoaXMubmV3Q29sb3JEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0aGlzLm5ld0NvbG9yRGl2LmNsYXNzTmFtZSA9ICd2aXMtbmV3LWNvbG9yJzsKICAgICAgICB0aGlzLm5ld0NvbG9yRGl2LmlubmVySFRNTCA9ICduZXcnOwoKICAgICAgICB0aGlzLmluaXRpYWxDb2xvckRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHRoaXMuaW5pdGlhbENvbG9yRGl2LmNsYXNzTmFtZSA9ICd2aXMtaW5pdGlhbC1jb2xvcic7CiAgICAgICAgdGhpcy5pbml0aWFsQ29sb3JEaXYuaW5uZXJIVE1MID0gJ2luaXRpYWwnOwoKICAgICAgICB0aGlzLmNhbmNlbEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHRoaXMuY2FuY2VsQnV0dG9uLmNsYXNzTmFtZSA9ICd2aXMtYnV0dG9uIHZpcy1jYW5jZWwnOwogICAgICAgIHRoaXMuY2FuY2VsQnV0dG9uLmlubmVySFRNTCA9ICdjYW5jZWwnOwogICAgICAgIHRoaXMuY2FuY2VsQnV0dG9uLm9uY2xpY2sgPSB0aGlzLl9oaWRlLmJpbmQodGhpcywgZmFsc2UpOwoKICAgICAgICB0aGlzLmFwcGx5QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdGhpcy5hcHBseUJ1dHRvbi5jbGFzc05hbWUgPSAndmlzLWJ1dHRvbiB2aXMtYXBwbHknOwogICAgICAgIHRoaXMuYXBwbHlCdXR0b24uaW5uZXJIVE1MID0gJ2FwcGx5JzsKICAgICAgICB0aGlzLmFwcGx5QnV0dG9uLm9uY2xpY2sgPSB0aGlzLl9hcHBseS5iaW5kKHRoaXMpOwoKICAgICAgICB0aGlzLnNhdmVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0aGlzLnNhdmVCdXR0b24uY2xhc3NOYW1lID0gJ3Zpcy1idXR0b24gdmlzLXNhdmUnOwogICAgICAgIHRoaXMuc2F2ZUJ1dHRvbi5pbm5lckhUTUwgPSAnc2F2ZSc7CiAgICAgICAgdGhpcy5zYXZlQnV0dG9uLm9uY2xpY2sgPSB0aGlzLl9zYXZlLmJpbmQodGhpcyk7CgogICAgICAgIHRoaXMubG9hZEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHRoaXMubG9hZEJ1dHRvbi5jbGFzc05hbWUgPSAndmlzLWJ1dHRvbiB2aXMtbG9hZCc7CiAgICAgICAgdGhpcy5sb2FkQnV0dG9uLmlubmVySFRNTCA9ICdsb2FkIGxhc3QnOwogICAgICAgIHRoaXMubG9hZEJ1dHRvbi5vbmNsaWNrID0gdGhpcy5fbG9hZExhc3QuYmluZCh0aGlzKTsKCiAgICAgICAgdGhpcy5mcmFtZS5hcHBlbmRDaGlsZCh0aGlzLmNvbG9yUGlja2VyRGl2KTsKICAgICAgICB0aGlzLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuYXJyb3dEaXYpOwogICAgICAgIHRoaXMuZnJhbWUuYXBwZW5kQ2hpbGQodGhpcy5icmlnaHRuZXNzTGFiZWwpOwogICAgICAgIHRoaXMuZnJhbWUuYXBwZW5kQ2hpbGQodGhpcy5icmlnaHRuZXNzRGl2KTsKICAgICAgICB0aGlzLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMub3BhY2l0eUxhYmVsKTsKICAgICAgICB0aGlzLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMub3BhY2l0eURpdik7CiAgICAgICAgdGhpcy5mcmFtZS5hcHBlbmRDaGlsZCh0aGlzLm5ld0NvbG9yRGl2KTsKICAgICAgICB0aGlzLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuaW5pdGlhbENvbG9yRGl2KTsKCiAgICAgICAgdGhpcy5mcmFtZS5hcHBlbmRDaGlsZCh0aGlzLmNhbmNlbEJ1dHRvbik7CiAgICAgICAgdGhpcy5mcmFtZS5hcHBlbmRDaGlsZCh0aGlzLmFwcGx5QnV0dG9uKTsKICAgICAgICB0aGlzLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuc2F2ZUJ1dHRvbik7CiAgICAgICAgdGhpcy5mcmFtZS5hcHBlbmRDaGlsZCh0aGlzLmxvYWRCdXR0b24pOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19iaW5kSGFtbWVyJywKCiAgICAgIC8qKgogICAgICAgKiBiaW5kIGhhbW1lciB0byB0aGUgY29sb3IgcGlja2VyCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2JpbmRIYW1tZXIoKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdGhpcy5kcmFnID0ge307CiAgICAgICAgdGhpcy5waW5jaCA9IHt9OwogICAgICAgIHRoaXMuaGFtbWVyID0gbmV3IEhhbW1lcih0aGlzLmNvbG9yUGlja2VyQ2FudmFzKTsKICAgICAgICB0aGlzLmhhbW1lci5nZXQoJ3BpbmNoJykuc2V0KHsgZW5hYmxlOiB0cnVlIH0pOwoKICAgICAgICBoYW1tZXJVdGlsLm9uVG91Y2godGhpcy5oYW1tZXIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgX3RoaXMuX21vdmVTZWxlY3RvcihldmVudCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5oYW1tZXIub24oJ3RhcCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgX3RoaXMuX21vdmVTZWxlY3RvcihldmVudCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5oYW1tZXIub24oJ3BhbnN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBfdGhpcy5fbW92ZVNlbGVjdG9yKGV2ZW50KTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmhhbW1lci5vbigncGFubW92ZScsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgX3RoaXMuX21vdmVTZWxlY3RvcihldmVudCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5oYW1tZXIub24oJ3BhbmVuZCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgX3RoaXMuX21vdmVTZWxlY3RvcihldmVudCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2dlbmVyYXRlSHVlQ2lyY2xlJywKCiAgICAgIC8qKgogICAgICAgKiBnZW5lcmF0ZSB0aGUgaHVlIGNpcmNsZS4gVGhpcyBpcyByZWxhdGl2ZWx5IGhlYXZ5ICgyMDBtcykgYW5kIGlzIGRvbmUgb25seSBvbmNlIG9uIHRoZSBmaXJzdCB0aW1lIGl0IGlzIHNob3duLgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZW5lcmF0ZUh1ZUNpcmNsZSgpIHsKICAgICAgICBpZiAodGhpcy5nZW5lcmF0ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5jb2xvclBpY2tlckNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgaWYgKHRoaXMucGl4ZWxSYXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aGlzLnBpeGVsUmF0aW8gPSAod2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMSkgLyAoY3R4LndlYmtpdEJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgY3R4Lm1vekJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgY3R4Lm1zQmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHgub0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgY3R4LmJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgMSk7CiAgICAgICAgICB9CiAgICAgICAgICBjdHguc2V0VHJhbnNmb3JtKHRoaXMucGl4ZWxSYXRpbywgMCwgMCwgdGhpcy5waXhlbFJhdGlvLCAwLCAwKTsKCiAgICAgICAgICAvLyBjbGVhciB0aGUgY2FudmFzCiAgICAgICAgICB2YXIgdyA9IHRoaXMuY29sb3JQaWNrZXJDYW52YXMuY2xpZW50V2lkdGg7CiAgICAgICAgICB2YXIgaCA9IHRoaXMuY29sb3JQaWNrZXJDYW52YXMuY2xpZW50SGVpZ2h0OwogICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3LCBoKTsKCiAgICAgICAgICAvLyBkcmF3IGh1ZSBjaXJjbGUKICAgICAgICAgIHZhciB4ID0gdW5kZWZpbmVkLAogICAgICAgICAgICAgIHkgPSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgaHVlID0gdW5kZWZpbmVkLAogICAgICAgICAgICAgIHNhdCA9IHVuZGVmaW5lZDsKICAgICAgICAgIHRoaXMuY2VudGVyQ29vcmRpbmF0ZXMgPSB7IHg6IHcgKiAwLjUsIHk6IGggKiAwLjUgfTsKICAgICAgICAgIHRoaXMuciA9IDAuNDkgKiB3OwogICAgICAgICAgdmFyIGFuZ2xlQ29udmVydCA9IDIgKiBNYXRoLlBJIC8gMzYwOwogICAgICAgICAgdmFyIGhmYWMgPSAxIC8gMzYwOwogICAgICAgICAgdmFyIHNmYWMgPSAxIC8gdGhpcy5yOwogICAgICAgICAgdmFyIHJnYiA9IHVuZGVmaW5lZDsKICAgICAgICAgIGZvciAoaHVlID0gMDsgaHVlIDwgMzYwOyBodWUrKykgewogICAgICAgICAgICBmb3IgKHNhdCA9IDA7IHNhdCA8IHRoaXMucjsgc2F0KyspIHsKICAgICAgICAgICAgICB4ID0gdGhpcy5jZW50ZXJDb29yZGluYXRlcy54ICsgc2F0ICogTWF0aC5zaW4oYW5nbGVDb252ZXJ0ICogaHVlKTsKICAgICAgICAgICAgICB5ID0gdGhpcy5jZW50ZXJDb29yZGluYXRlcy55ICsgc2F0ICogTWF0aC5jb3MoYW5nbGVDb252ZXJ0ICogaHVlKTsKICAgICAgICAgICAgICByZ2IgPSB1dGlsLkhTVlRvUkdCKGh1ZSAqIGhmYWMsIHNhdCAqIHNmYWMsIDEpOwogICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiKCcgKyByZ2IuciArICcsJyArIHJnYi5nICsgJywnICsgcmdiLmIgKyAnKSc7CiAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHggLSAwLjUsIHkgLSAwLjUsIDIsIDIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgwLDAsMCwxKSc7CiAgICAgICAgICBjdHguY2lyY2xlKHRoaXMuY2VudGVyQ29vcmRpbmF0ZXMueCwgdGhpcy5jZW50ZXJDb29yZGluYXRlcy55LCB0aGlzLnIpOwogICAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICAgIHRoaXMuaHVlQ2lyY2xlID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCB3LCBoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5nZW5lcmF0ZWQgPSB0cnVlOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19tb3ZlU2VsZWN0b3InLAoKICAgICAgLyoqCiAgICAgICAqIG1vdmUgdGhlIHNlbGVjdG9yLiBUaGlzIGlzIGNhbGxlZCBieSBoYW1tZXIgZnVuY3Rpb25zLgogICAgICAgKgogICAgICAgKiBAcGFyYW0gZXZlbnQKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfbW92ZVNlbGVjdG9yKGV2ZW50KSB7CiAgICAgICAgdmFyIHJlY3QgPSB0aGlzLmNvbG9yUGlja2VyRGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgIHZhciBsZWZ0ID0gZXZlbnQuY2VudGVyLnggLSByZWN0LmxlZnQ7CiAgICAgICAgdmFyIHRvcCA9IGV2ZW50LmNlbnRlci55IC0gcmVjdC50b3A7CgogICAgICAgIHZhciBjZW50ZXJZID0gMC41ICogdGhpcy5jb2xvclBpY2tlckRpdi5jbGllbnRIZWlnaHQ7CiAgICAgICAgdmFyIGNlbnRlclggPSAwLjUgKiB0aGlzLmNvbG9yUGlja2VyRGl2LmNsaWVudFdpZHRoOwoKICAgICAgICB2YXIgeCA9IGxlZnQgLSBjZW50ZXJYOwogICAgICAgIHZhciB5ID0gdG9wIC0gY2VudGVyWTsKCiAgICAgICAgdmFyIGFuZ2xlID0gTWF0aC5hdGFuMih4LCB5KTsKICAgICAgICB2YXIgcmFkaXVzID0gMC45OCAqIE1hdGgubWluKE1hdGguc3FydCh4ICogeCArIHkgKiB5KSwgY2VudGVyWCk7CgogICAgICAgIHZhciBuZXdUb3AgPSBNYXRoLmNvcyhhbmdsZSkgKiByYWRpdXMgKyBjZW50ZXJZOwogICAgICAgIHZhciBuZXdMZWZ0ID0gTWF0aC5zaW4oYW5nbGUpICogcmFkaXVzICsgY2VudGVyWDsKCiAgICAgICAgdGhpcy5jb2xvclBpY2tlclNlbGVjdG9yLnN0eWxlLnRvcCA9IG5ld1RvcCAtIDAuNSAqIHRoaXMuY29sb3JQaWNrZXJTZWxlY3Rvci5jbGllbnRIZWlnaHQgKyAncHgnOwogICAgICAgIHRoaXMuY29sb3JQaWNrZXJTZWxlY3Rvci5zdHlsZS5sZWZ0ID0gbmV3TGVmdCAtIDAuNSAqIHRoaXMuY29sb3JQaWNrZXJTZWxlY3Rvci5jbGllbnRXaWR0aCArICdweCc7CgogICAgICAgIC8vIHNldCBjb2xvcgogICAgICAgIHZhciBoID0gYW5nbGUgLyAoMiAqIE1hdGguUEkpOwogICAgICAgIGggPSBoIDwgMCA/IGggKyAxIDogaDsKICAgICAgICB2YXIgcyA9IHJhZGl1cyAvIHRoaXMucjsKICAgICAgICB2YXIgaHN2ID0gdXRpbC5SR0JUb0hTVih0aGlzLmNvbG9yLnIsIHRoaXMuY29sb3IuZywgdGhpcy5jb2xvci5iKTsKICAgICAgICBoc3YuaCA9IGg7CiAgICAgICAgaHN2LnMgPSBzOwogICAgICAgIHZhciByZ2JhID0gdXRpbC5IU1ZUb1JHQihoc3YuaCwgaHN2LnMsIGhzdi52KTsKICAgICAgICByZ2JhWydhJ10gPSB0aGlzLmNvbG9yLmE7CiAgICAgICAgdGhpcy5jb2xvciA9IHJnYmE7CgogICAgICAgIC8vIHVwZGF0ZSBwcmV2aWV3cwogICAgICAgIHRoaXMuaW5pdGlhbENvbG9yRGl2LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZ2JhKCcgKyB0aGlzLmluaXRpYWxDb2xvci5yICsgJywnICsgdGhpcy5pbml0aWFsQ29sb3IuZyArICcsJyArIHRoaXMuaW5pdGlhbENvbG9yLmIgKyAnLCcgKyB0aGlzLmluaXRpYWxDb2xvci5hICsgJyknOwogICAgICAgIHRoaXMubmV3Q29sb3JEaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJ3JnYmEoJyArIHRoaXMuY29sb3IuciArICcsJyArIHRoaXMuY29sb3IuZyArICcsJyArIHRoaXMuY29sb3IuYiArICcsJyArIHRoaXMuY29sb3IuYSArICcpJzsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBDb2xvclBpY2tlcjsKICB9KSgpOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBDb2xvclBpY2tlcjsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDQ3ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogIHZhciBlcnJvckZvdW5kID0gZmFsc2U7CiAgdmFyIGFsbE9wdGlvbnMgPSB1bmRlZmluZWQ7CiAgdmFyIHByaW50U3R5bGUgPSAnYmFja2dyb3VuZDogI0ZGZWVlZTsgY29sb3I6ICNkZDAwMDAnOwogIC8qKgogICAqICBVc2VkIHRvIHZhbGlkYXRlIG9wdGlvbnMuCiAgICovCgogIHZhciBWYWxpZGF0b3IgPSAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gVmFsaWRhdG9yKCkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVmFsaWRhdG9yKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoVmFsaWRhdG9yLCBudWxsLCBbewogICAgICBrZXk6ICd2YWxpZGF0ZScsCgogICAgICAvKioKICAgICAgICogTWFpbiBmdW5jdGlvbiB0byBiZSBjYWxsZWQKICAgICAgICogQHBhcmFtIG9wdGlvbnMKICAgICAgICogQHBhcmFtIHN1Yk9iamVjdAogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWxpZGF0ZShvcHRpb25zLCByZWZlcmVuY2VPcHRpb25zLCBzdWJPYmplY3QpIHsKICAgICAgICBlcnJvckZvdW5kID0gZmFsc2U7CiAgICAgICAgYWxsT3B0aW9ucyA9IHJlZmVyZW5jZU9wdGlvbnM7CiAgICAgICAgdmFyIHVzZWRPcHRpb25zID0gcmVmZXJlbmNlT3B0aW9uczsKICAgICAgICBpZiAoc3ViT2JqZWN0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHVzZWRPcHRpb25zID0gcmVmZXJlbmNlT3B0aW9uc1tzdWJPYmplY3RdOwogICAgICAgIH0KICAgICAgICBWYWxpZGF0b3IucGFyc2Uob3B0aW9ucywgdXNlZE9wdGlvbnMsIFtdKTsKICAgICAgICByZXR1cm4gZXJyb3JGb3VuZDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdwYXJzZScsCgogICAgICAvKioKICAgICAgICogV2lsbCB0cmF2ZXJzZSBhbiBvYmplY3QgcmVjdXJzaXZlbHkgYW5kIGNoZWNrIGV2ZXJ5IHZhbHVlCiAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAqIEBwYXJhbSByZWZlcmVuY2VPcHRpb25zCiAgICAgICAqIEBwYXJhbSBwYXRoCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gcGFyc2Uob3B0aW9ucywgcmVmZXJlbmNlT3B0aW9ucywgcGF0aCkgewogICAgICAgIGZvciAodmFyIG9wdGlvbiBpbiBvcHRpb25zKSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShvcHRpb24pKSB7CiAgICAgICAgICAgIFZhbGlkYXRvci5jaGVjayhvcHRpb24sIG9wdGlvbnMsIHJlZmVyZW5jZU9wdGlvbnMsIHBhdGgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdjaGVjaycsCgogICAgICAvKioKICAgICAgICogQ2hlY2sgZXZlcnkgdmFsdWUuIElmIHRoZSB2YWx1ZSBpcyBhbiBvYmplY3QsIGNhbGwgdGhlIHBhcnNlIGZ1bmN0aW9uIG9uIHRoYXQgb2JqZWN0LgogICAgICAgKiBAcGFyYW0gb3B0aW9uCiAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAqIEBwYXJhbSByZWZlcmVuY2VPcHRpb25zCiAgICAgICAqIEBwYXJhbSBwYXRoCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2sob3B0aW9uLCBvcHRpb25zLCByZWZlcmVuY2VPcHRpb25zLCBwYXRoKSB7CiAgICAgICAgaWYgKHJlZmVyZW5jZU9wdGlvbnNbb3B0aW9uXSA9PT0gdW5kZWZpbmVkICYmIHJlZmVyZW5jZU9wdGlvbnMuX19hbnlfXyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBWYWxpZGF0b3IuZ2V0U3VnZ2VzdGlvbihvcHRpb24sIHJlZmVyZW5jZU9wdGlvbnMsIHBhdGgpOwogICAgICAgIH0gZWxzZSBpZiAocmVmZXJlbmNlT3B0aW9uc1tvcHRpb25dID09PSB1bmRlZmluZWQgJiYgcmVmZXJlbmNlT3B0aW9ucy5fX2FueV9fICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8vIF9fYW55X18gaXMgYSB3aWxkY2FyZC4gQW55IHZhbHVlIGlzIGFjY2VwdGVkIGFuZCB3aWxsIGJlIGZ1cnRoZXIgYW5hbHlzZWQgYnkgcmVmZXJlbmNlLgogICAgICAgICAgaWYgKFZhbGlkYXRvci5nZXRUeXBlKG9wdGlvbnNbb3B0aW9uXSkgPT09ICdvYmplY3QnICYmIHJlZmVyZW5jZU9wdGlvbnNbJ19fYW55X18nXS5fX3R5cGVfXyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIC8vIGlmIHRoZSBhbnkgc3ViZ3JvdXAgaXMgbm90IGEgcHJlZGVmaW5lZCBvYmplY3QgaW50IGhlIGNvbmZpZ3VyYXRvciB3ZSBkbyBub3QgbG9vayBkZWVwZXIgaW50byB0aGUgb2JqZWN0LgogICAgICAgICAgICBWYWxpZGF0b3IuY2hlY2tGaWVsZHMob3B0aW9uLCBvcHRpb25zLCByZWZlcmVuY2VPcHRpb25zLCAnX19hbnlfXycsIHJlZmVyZW5jZU9wdGlvbnNbJ19fYW55X18nXS5fX3R5cGVfXywgcGF0aCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBWYWxpZGF0b3IuY2hlY2tGaWVsZHMob3B0aW9uLCBvcHRpb25zLCByZWZlcmVuY2VPcHRpb25zLCAnX19hbnlfXycsIHJlZmVyZW5jZU9wdGlvbnNbJ19fYW55X18nXSwgcGF0aCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIFNpbmNlIGFsbCBvcHRpb25zIGluIHRoZSByZWZlcmVuY2UgYXJlIG9iamVjdHMsIHdlIGNhbiBjaGVjayB3aGV0aGVyIHRoZXkgYXJlIHN1cHBvc2VkIHRvIGJlIG9iamVjdCB0byBsb29rIGZvciB0aGUgX190eXBlX18gZmllbGQuCiAgICAgICAgICBpZiAocmVmZXJlbmNlT3B0aW9uc1tvcHRpb25dLl9fdHlwZV9fICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgLy8gaWYgdGhpcyBzaG91bGQgYmUgYW4gb2JqZWN0LCB3ZSBjaGVjayBpZiB0aGUgY29ycmVjdCB0eXBlIGhhcyBiZWVuIHN1cHBsaWVkIHRvIGFjY291bnQgZm9yIHNob3J0aGFuZCBvcHRpb25zLgogICAgICAgICAgICBWYWxpZGF0b3IuY2hlY2tGaWVsZHMob3B0aW9uLCBvcHRpb25zLCByZWZlcmVuY2VPcHRpb25zLCBvcHRpb24sIHJlZmVyZW5jZU9wdGlvbnNbb3B0aW9uXS5fX3R5cGVfXywgcGF0aCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBWYWxpZGF0b3IuY2hlY2tGaWVsZHMob3B0aW9uLCBvcHRpb25zLCByZWZlcmVuY2VPcHRpb25zLCBvcHRpb24sIHJlZmVyZW5jZU9wdGlvbnNbb3B0aW9uXSwgcGF0aCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2NoZWNrRmllbGRzJywKCiAgICAgIC8qKgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gIG9wdGlvbiAgICAgfCB0aGUgb3B0aW9uIHByb3BlcnR5CiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSAgb3B0aW9ucyAgICB8IFRoZSBzdXBwbGllZCBvcHRpb25zIG9iamVjdAogICAgICAgKiBAcGFyYW0ge09iamVjdH0gIHJlZmVyZW5jZU9wdGlvbnMgICAgfCBUaGUgcmVmZXJlbmNlIG9wdGlvbnMgY29udGFpbmluZyBhbGwgb3B0aW9ucyBhbmQgdGhlaXIgYWxsb3dlZCBmb3JtYXRzCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSAgcmVmZXJlbmNlT3B0aW9uICAgICB8IFVzdWFsbHkgdGhpcyBpcyB0aGUgc2FtZSBhcyBvcHRpb24sIGV4Y2VwdCB3aGVuIGhhbmRsaW5nIGFuIF9fYW55X18gdGFnLgogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gIHJlZk9wdGlvblR5cGUgICAgICAgfCBUaGlzIGlzIHRoZSB0eXBlIG9iamVjdCBmcm9tIHRoZSByZWZlcmVuY2Ugb3B0aW9ucwogICAgICAgKiBAcGFyYW0ge0FycmF5fSAgIHBhdGggICAgICB8IHdoZXJlIGluIHRoZSBvYmplY3QgaXMgdGhlIG9wdGlvbgogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrRmllbGRzKG9wdGlvbiwgb3B0aW9ucywgcmVmZXJlbmNlT3B0aW9ucywgcmVmZXJlbmNlT3B0aW9uLCByZWZPcHRpb25PYmosIHBhdGgpIHsKICAgICAgICB2YXIgb3B0aW9uVHlwZSA9IFZhbGlkYXRvci5nZXRUeXBlKG9wdGlvbnNbb3B0aW9uXSk7CiAgICAgICAgdmFyIHJlZk9wdGlvblR5cGUgPSByZWZPcHRpb25PYmpbb3B0aW9uVHlwZV07CiAgICAgICAgaWYgKHJlZk9wdGlvblR5cGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgLy8gaWYgdGhlIHR5cGUgaXMgY29ycmVjdCwgd2UgY2hlY2sgaWYgaXQgaXMgc3VwcG9zZWQgdG8gYmUgb25lIG9mIGEgZmV3IHNlbGVjdCB2YWx1ZXMKICAgICAgICAgIGlmIChWYWxpZGF0b3IuZ2V0VHlwZShyZWZPcHRpb25UeXBlKSA9PT0gJ2FycmF5JykgewogICAgICAgICAgICBpZiAocmVmT3B0aW9uVHlwZS5pbmRleE9mKG9wdGlvbnNbb3B0aW9uXSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coJyVjSW52YWxpZCBvcHRpb24gZGV0ZWN0ZWQgaW4gIicgKyBvcHRpb24gKyAnIi4nICsgJyBBbGxvd2VkIHZhbHVlcyBhcmU6JyArIFZhbGlkYXRvci5wcmludChyZWZPcHRpb25UeXBlKSArICcgbm90ICInICsgb3B0aW9uc1tvcHRpb25dICsgJyIuICcgKyBWYWxpZGF0b3IucHJpbnRMb2NhdGlvbihwYXRoLCBvcHRpb24pLCBwcmludFN0eWxlKTsKICAgICAgICAgICAgICBlcnJvckZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRpb25UeXBlID09PSAnb2JqZWN0JyAmJiByZWZlcmVuY2VPcHRpb24gIT09ICdfX2FueV9fJykgewogICAgICAgICAgICAgIHBhdGggPSB1dGlsLmNvcHlBbmRFeHRlbmRBcnJheShwYXRoLCBvcHRpb24pOwogICAgICAgICAgICAgIFZhbGlkYXRvci5wYXJzZShvcHRpb25zW29wdGlvbl0sIHJlZmVyZW5jZU9wdGlvbnNbcmVmZXJlbmNlT3B0aW9uXSwgcGF0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9uVHlwZSA9PT0gJ29iamVjdCcgJiYgcmVmZXJlbmNlT3B0aW9uICE9PSAnX19hbnlfXycpIHsKICAgICAgICAgICAgcGF0aCA9IHV0aWwuY29weUFuZEV4dGVuZEFycmF5KHBhdGgsIG9wdGlvbik7CiAgICAgICAgICAgIFZhbGlkYXRvci5wYXJzZShvcHRpb25zW29wdGlvbl0sIHJlZmVyZW5jZU9wdGlvbnNbcmVmZXJlbmNlT3B0aW9uXSwgcGF0aCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChyZWZPcHRpb25PYmpbJ2FueSddID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8vIHR5cGUgb2YgdGhlIGZpZWxkIGlzIGluY29ycmVjdCBhbmQgdGhlIGZpZWxkIGNhbm5vdCBiZSBhbnkKICAgICAgICAgIGNvbnNvbGUubG9nKCclY0ludmFsaWQgdHlwZSByZWNlaXZlZCBmb3IgIicgKyBvcHRpb24gKyAnIi4gRXhwZWN0ZWQ6ICcgKyBWYWxpZGF0b3IucHJpbnQoT2JqZWN0LmtleXMocmVmT3B0aW9uT2JqKSkgKyAnLiBSZWNlaXZlZCBbJyArIG9wdGlvblR5cGUgKyAnXSAiJyArIG9wdGlvbnNbb3B0aW9uXSArICciJyArIFZhbGlkYXRvci5wcmludExvY2F0aW9uKHBhdGgsIG9wdGlvbiksIHByaW50U3R5bGUpOwogICAgICAgICAgZXJyb3JGb3VuZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2dldFR5cGUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VHlwZShvYmplY3QpIHsKICAgICAgICB2YXIgdHlwZSA9IHR5cGVvZiBvYmplY3Q7CgogICAgICAgIGlmICh0eXBlID09PSAnb2JqZWN0JykgewogICAgICAgICAgaWYgKG9iamVjdCA9PT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gJ251bGwnOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIEJvb2xlYW4pIHsKICAgICAgICAgICAgcmV0dXJuICdib29sZWFuJzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBOdW1iZXIpIHsKICAgICAgICAgICAgcmV0dXJuICdudW1iZXInOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgICAgICByZXR1cm4gJ3N0cmluZyc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmplY3QpKSB7CiAgICAgICAgICAgIHJldHVybiAnYXJyYXknOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIERhdGUpIHsKICAgICAgICAgICAgcmV0dXJuICdkYXRlJzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvYmplY3Qubm9kZVR5cGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByZXR1cm4gJ2RvbSc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob2JqZWN0Ll9pc0FNb21lbnRPYmplY3QgPT09IHRydWUpIHsKICAgICAgICAgICAgcmV0dXJuICdtb21lbnQnOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICdvYmplY3QnOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ251bWJlcicpIHsKICAgICAgICAgIHJldHVybiAnbnVtYmVyJzsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdib29sZWFuJykgewogICAgICAgICAgcmV0dXJuICdib29sZWFuJzsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICByZXR1cm4gJ3N0cmluZyc7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybiAndW5kZWZpbmVkJzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHR5cGU7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZ2V0U3VnZ2VzdGlvbicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTdWdnZXN0aW9uKG9wdGlvbiwgb3B0aW9ucywgcGF0aCkgewogICAgICAgIHZhciBsb2NhbFNlYXJjaCA9IFZhbGlkYXRvci5maW5kSW5PcHRpb25zKG9wdGlvbiwgb3B0aW9ucywgcGF0aCwgZmFsc2UpOwogICAgICAgIHZhciBnbG9iYWxTZWFyY2ggPSBWYWxpZGF0b3IuZmluZEluT3B0aW9ucyhvcHRpb24sIGFsbE9wdGlvbnMsIFtdLCB0cnVlKTsKCiAgICAgICAgdmFyIGxvY2FsU2VhcmNoVGhyZXNob2xkID0gODsKICAgICAgICB2YXIgZ2xvYmFsU2VhcmNoVGhyZXNob2xkID0gNDsKCiAgICAgICAgaWYgKGxvY2FsU2VhcmNoLmluZGV4TWF0Y2ggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgY29uc29sZS5sb2coJyVjVW5rbm93biBvcHRpb24gZGV0ZWN0ZWQ6ICInICsgb3B0aW9uICsgJyIgaW4gJyArIFZhbGlkYXRvci5wcmludExvY2F0aW9uKGxvY2FsU2VhcmNoLnBhdGgsIG9wdGlvbiwgJycpICsgJ1BlcmhhcHMgaXQgd2FzIGluY29tcGxldGU/IERpZCB5b3UgbWVhbjogIicgKyBsb2NhbFNlYXJjaC5pbmRleE1hdGNoICsgJyI/XG5cbicsIHByaW50U3R5bGUpOwogICAgICAgIH0gZWxzZSBpZiAoZ2xvYmFsU2VhcmNoLmRpc3RhbmNlIDw9IGdsb2JhbFNlYXJjaFRocmVzaG9sZCAmJiBsb2NhbFNlYXJjaC5kaXN0YW5jZSA+IGdsb2JhbFNlYXJjaC5kaXN0YW5jZSkgewogICAgICAgICAgY29uc29sZS5sb2coJyVjVW5rbm93biBvcHRpb24gZGV0ZWN0ZWQ6ICInICsgb3B0aW9uICsgJyIgaW4gJyArIFZhbGlkYXRvci5wcmludExvY2F0aW9uKGxvY2FsU2VhcmNoLnBhdGgsIG9wdGlvbiwgJycpICsgJ1BlcmhhcHMgaXQgd2FzIG1pc3BsYWNlZD8gTWF0Y2hpbmcgb3B0aW9uIGZvdW5kIGF0OiAnICsgVmFsaWRhdG9yLnByaW50TG9jYXRpb24oZ2xvYmFsU2VhcmNoLnBhdGgsIGdsb2JhbFNlYXJjaC5jbG9zZXN0TWF0Y2gsICcnKSwgcHJpbnRTdHlsZSk7CiAgICAgICAgfSBlbHNlIGlmIChsb2NhbFNlYXJjaC5kaXN0YW5jZSA8PSBsb2NhbFNlYXJjaFRocmVzaG9sZCkgewogICAgICAgICAgY29uc29sZS5sb2coJyVjVW5rbm93biBvcHRpb24gZGV0ZWN0ZWQ6ICInICsgb3B0aW9uICsgJyIuIERpZCB5b3UgbWVhbiAiJyArIGxvY2FsU2VhcmNoLmNsb3Nlc3RNYXRjaCArICciPycgKyBWYWxpZGF0b3IucHJpbnRMb2NhdGlvbihsb2NhbFNlYXJjaC5wYXRoLCBvcHRpb24pLCBwcmludFN0eWxlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coJyVjVW5rbm93biBvcHRpb24gZGV0ZWN0ZWQ6ICInICsgb3B0aW9uICsgJyIuIERpZCB5b3UgbWVhbiBvbmUgb2YgdGhlc2U6ICcgKyBWYWxpZGF0b3IucHJpbnQoT2JqZWN0LmtleXMob3B0aW9ucykpICsgVmFsaWRhdG9yLnByaW50TG9jYXRpb24ocGF0aCwgb3B0aW9uKSwgcHJpbnRTdHlsZSk7CiAgICAgICAgfQoKICAgICAgICBlcnJvckZvdW5kID0gdHJ1ZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdmaW5kSW5PcHRpb25zJywKCiAgICAgIC8qKgogICAgICAgKiB0cmF2ZXJzZSB0aGUgb3B0aW9ucyBpbiBzZWFyY2ggZm9yIGEgbWF0Y2guCiAgICAgICAqIEBwYXJhbSBvcHRpb24KICAgICAgICogQHBhcmFtIG9wdGlvbnMKICAgICAgICogQHBhcmFtIHBhdGgKICAgICAgICogQHBhcmFtIHJlY3Vyc2l2ZQogICAgICAgKiBAcmV0dXJucyB7e2Nsb3Nlc3RNYXRjaDogc3RyaW5nLCBwYXRoOiBBcnJheSwgZGlzdGFuY2U6IG51bWJlcn19CiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZmluZEluT3B0aW9ucyhvcHRpb24sIG9wdGlvbnMsIHBhdGgpIHsKICAgICAgICB2YXIgcmVjdXJzaXZlID0gYXJndW1lbnRzWzNdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1szXTsKCiAgICAgICAgdmFyIG1pbiA9IDEwMDAwMDAwMDA7CiAgICAgICAgdmFyIGNsb3Nlc3RNYXRjaCA9ICcnOwogICAgICAgIHZhciBjbG9zZXN0TWF0Y2hQYXRoID0gW107CiAgICAgICAgdmFyIGxvd2VyQ2FzZU9wdGlvbiA9IG9wdGlvbi50b0xvd2VyQ2FzZSgpOwogICAgICAgIHZhciBpbmRleE1hdGNoID0gdW5kZWZpbmVkOwogICAgICAgIGZvciAodmFyIG9wIGluIG9wdGlvbnMpIHsKICAgICAgICAgIHZhciBkaXN0YW5jZSA9IHVuZGVmaW5lZDsKICAgICAgICAgIGlmIChvcHRpb25zW29wXS5fX3R5cGVfXyAhPT0gdW5kZWZpbmVkICYmIHJlY3Vyc2l2ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gVmFsaWRhdG9yLmZpbmRJbk9wdGlvbnMob3B0aW9uLCBvcHRpb25zW29wXSwgdXRpbC5jb3B5QW5kRXh0ZW5kQXJyYXkocGF0aCwgb3ApKTsKICAgICAgICAgICAgaWYgKG1pbiA+IHJlc3VsdC5kaXN0YW5jZSkgewogICAgICAgICAgICAgIGNsb3Nlc3RNYXRjaCA9IHJlc3VsdC5jbG9zZXN0TWF0Y2g7CiAgICAgICAgICAgICAgY2xvc2VzdE1hdGNoUGF0aCA9IHJlc3VsdC5wYXRoOwogICAgICAgICAgICAgIG1pbiA9IHJlc3VsdC5kaXN0YW5jZTsKICAgICAgICAgICAgICBpbmRleE1hdGNoID0gcmVzdWx0LmluZGV4TWF0Y2g7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChvcC50b0xvd2VyQ2FzZSgpLmluZGV4T2YobG93ZXJDYXNlT3B0aW9uKSAhPT0gLTEpIHsKICAgICAgICAgICAgICBpbmRleE1hdGNoID0gb3A7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGlzdGFuY2UgPSBWYWxpZGF0b3IubGV2ZW5zaHRlaW5EaXN0YW5jZShvcHRpb24sIG9wKTsKICAgICAgICAgICAgaWYgKG1pbiA+IGRpc3RhbmNlKSB7CiAgICAgICAgICAgICAgY2xvc2VzdE1hdGNoID0gb3A7CiAgICAgICAgICAgICAgY2xvc2VzdE1hdGNoUGF0aCA9IHV0aWwuY29weUFycmF5KHBhdGgpOwogICAgICAgICAgICAgIG1pbiA9IGRpc3RhbmNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB7IGNsb3Nlc3RNYXRjaDogY2xvc2VzdE1hdGNoLCBwYXRoOiBjbG9zZXN0TWF0Y2hQYXRoLCBkaXN0YW5jZTogbWluLCBpbmRleE1hdGNoOiBpbmRleE1hdGNoIH07CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAncHJpbnRMb2NhdGlvbicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBwcmludExvY2F0aW9uKHBhdGgsIG9wdGlvbikgewogICAgICAgIHZhciBwcmVmaXggPSBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/ICdQcm9ibGVtIHZhbHVlIGZvdW5kIGF0OiBcbicgOiBhcmd1bWVudHNbMl07CgogICAgICAgIHZhciBzdHIgPSAnXG5cbicgKyBwcmVmaXggKyAnb3B0aW9ucyA9IHtcbic7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGkgKyAxOyBqKyspIHsKICAgICAgICAgICAgc3RyICs9ICcgICc7CiAgICAgICAgICB9CiAgICAgICAgICBzdHIgKz0gcGF0aFtpXSArICc6IHtcbic7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcGF0aC5sZW5ndGggKyAxOyBqKyspIHsKICAgICAgICAgIHN0ciArPSAnICAnOwogICAgICAgIH0KICAgICAgICBzdHIgKz0gb3B0aW9uICsgJ1xuJzsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGgubGVuZ3RoICsgMTsgaSsrKSB7CiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHBhdGgubGVuZ3RoIC0gaTsgaisrKSB7CiAgICAgICAgICAgIHN0ciArPSAnICAnOwogICAgICAgICAgfQogICAgICAgICAgc3RyICs9ICd9XG4nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyICsgJ1xuXG4nOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3ByaW50JywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHByaW50KG9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob3B0aW9ucykucmVwbGFjZSgvKFwiKXwoXFspfChcXSl8KCwiX190eXBlX18iKS9nLCAnJykucmVwbGFjZSgvKFwsKS9nLCAnLCAnKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdsZXZlbnNodGVpbkRpc3RhbmNlJywKCiAgICAgIC8vIENvbXB1dGUgdGhlIGVkaXQgZGlzdGFuY2UgYmV0d2VlbiB0aGUgdHdvIGdpdmVuIHN0cmluZ3MKICAgICAgLy8gaHR0cDovL2VuLndpa2lib29rcy5vcmcvd2lraS9BbGdvcml0aG1fSW1wbGVtZW50YXRpb24vU3RyaW5ncy9MZXZlbnNodGVpbl9kaXN0YW5jZSNKYXZhU2NyaXB0CiAgICAgIC8qCiAgICAgICBDb3B5cmlnaHQgKGMpIDIwMTEgQW5kcmVpIE1hY2tlbnppZQogICAgICAgIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgogICAgICAgIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgogICAgICAgIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBsZXZlbnNodGVpbkRpc3RhbmNlKGEsIGIpIHsKICAgICAgICBpZiAoYS5sZW5ndGggPT09IDApIHJldHVybiBiLmxlbmd0aDsKICAgICAgICBpZiAoYi5sZW5ndGggPT09IDApIHJldHVybiBhLmxlbmd0aDsKCiAgICAgICAgdmFyIG1hdHJpeCA9IFtdOwoKICAgICAgICAvLyBpbmNyZW1lbnQgYWxvbmcgdGhlIGZpcnN0IGNvbHVtbiBvZiBlYWNoIHJvdwogICAgICAgIHZhciBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPD0gYi5sZW5ndGg7IGkrKykgewogICAgICAgICAgbWF0cml4W2ldID0gW2ldOwogICAgICAgIH0KCiAgICAgICAgLy8gaW5jcmVtZW50IGVhY2ggY29sdW1uIGluIHRoZSBmaXJzdCByb3cKICAgICAgICB2YXIgajsKICAgICAgICBmb3IgKGogPSAwOyBqIDw9IGEubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIG1hdHJpeFswXVtqXSA9IGo7CiAgICAgICAgfQoKICAgICAgICAvLyBGaWxsIGluIHRoZSByZXN0IG9mIHRoZSBtYXRyaXgKICAgICAgICBmb3IgKGkgPSAxOyBpIDw9IGIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGZvciAoaiA9IDE7IGogPD0gYS5sZW5ndGg7IGorKykgewogICAgICAgICAgICBpZiAoYi5jaGFyQXQoaSAtIDEpID09IGEuY2hhckF0KGogLSAxKSkgewogICAgICAgICAgICAgIG1hdHJpeFtpXVtqXSA9IG1hdHJpeFtpIC0gMV1baiAtIDFdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1hdHJpeFtpXVtqXSA9IE1hdGgubWluKG1hdHJpeFtpIC0gMV1baiAtIDFdICsgMSwgLy8gc3Vic3RpdHV0aW9uCiAgICAgICAgICAgICAgTWF0aC5taW4obWF0cml4W2ldW2ogLSAxXSArIDEsIC8vIGluc2VydGlvbgogICAgICAgICAgICAgIG1hdHJpeFtpIC0gMV1bal0gKyAxKSk7IC8vIGRlbGV0aW9uCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBtYXRyaXhbYi5sZW5ndGhdW2EubGVuZ3RoXTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBWYWxpZGF0b3I7CiAgfSkoKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gVmFsaWRhdG9yOwogIGV4cG9ydHMucHJpbnRTdHlsZSA9IHByaW50U3R5bGU7CgovKioqLyB9LAovKiA0OCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgLyoqCiAgICogVGhpcyBvYmplY3QgY29udGFpbnMgYWxsIHBvc3NpYmxlIG9wdGlvbnMuIEl0IHdpbGwgY2hlY2sgaWYgdGhlIHR5cGVzIGFyZSBjb3JyZWN0LCBpZiByZXF1aXJlZCBpZiB0aGUgb3B0aW9uIGlzIG9uZQogICAqIG9mIHRoZSBhbGxvd2VkIHZhbHVlcy4KICAgKgogICAqIF9fYW55X18gbWVhbnMgdGhhdCB0aGUgbmFtZSBvZiB0aGUgcHJvcGVydHkgZG9lcyBub3QgbWF0dGVyLgogICAqIF9fdHlwZV9fIGlzIGEgcmVxdWlyZWQgZmllbGQgZm9yIGFsbCBvYmplY3RzIGFuZCBjb250YWlucyB0aGUgYWxsb3dlZCB0eXBlcyBvZiBhbGwgb2JqZWN0cwogICAqLwogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKICB2YXIgc3RyaW5nID0gJ3N0cmluZyc7CiAgdmFyIGJvb2xlYW4gPSAnYm9vbGVhbic7CiAgdmFyIG51bWJlciA9ICdudW1iZXInOwogIHZhciBhcnJheSA9ICdhcnJheSc7CiAgdmFyIGRhdGUgPSAnZGF0ZSc7CiAgdmFyIG9iamVjdCA9ICdvYmplY3QnOyAvLyBzaG91bGQgb25seSBiZSBpbiBhIF9fdHlwZV9fIHByb3BlcnR5CiAgdmFyIGRvbSA9ICdkb20nOwogIHZhciBtb21lbnQgPSAnbW9tZW50JzsKICB2YXIgYW55ID0gJ2FueSc7CgogIHZhciBhbGxPcHRpb25zID0gewogICAgY29uZmlndXJlOiB7CiAgICAgIGVuYWJsZWQ6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBmaWx0ZXI6IHsgYm9vbGVhbjogYm9vbGVhbiwgJ2Z1bmN0aW9uJzogJ2Z1bmN0aW9uJyB9LAogICAgICBjb250YWluZXI6IHsgZG9tOiBkb20gfSwKICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QsIGJvb2xlYW46IGJvb2xlYW4sICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfQogICAgfSwKCiAgICAvL2dsb2JhbHMgOgogICAgYWxpZ246IHsgc3RyaW5nOiBzdHJpbmcgfSwKICAgIGF1dG9SZXNpemU6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgY2xpY2tUb1VzZTogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICBkYXRhQXR0cmlidXRlczogeyBzdHJpbmc6IHN0cmluZywgYXJyYXk6IGFycmF5IH0sCiAgICBlZGl0YWJsZTogewogICAgICBhZGQ6IHsgYm9vbGVhbjogYm9vbGVhbiwgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIHJlbW92ZTogeyBib29sZWFuOiBib29sZWFuLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgdXBkYXRlR3JvdXA6IHsgYm9vbGVhbjogYm9vbGVhbiwgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIHVwZGF0ZVRpbWU6IHsgYm9vbGVhbjogYm9vbGVhbiwgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIF9fdHlwZV9fOiB7IGJvb2xlYW46IGJvb2xlYW4sIG9iamVjdDogb2JqZWN0IH0KICAgIH0sCiAgICBlbmQ6IHsgbnVtYmVyOiBudW1iZXIsIGRhdGU6IGRhdGUsIHN0cmluZzogc3RyaW5nLCBtb21lbnQ6IG1vbWVudCB9LAogICAgZm9ybWF0OiB7CiAgICAgIG1pbm9yTGFiZWxzOiB7CiAgICAgICAgbWlsbGlzZWNvbmQ6IHsgc3RyaW5nOiBzdHJpbmcsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICAgIHNlY29uZDogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgbWludXRlOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBob3VyOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICB3ZWVrZGF5OiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBkYXk6IHsgc3RyaW5nOiBzdHJpbmcsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICAgIG1vbnRoOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICB5ZWFyOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9CiAgICAgIH0sCiAgICAgIG1ham9yTGFiZWxzOiB7CiAgICAgICAgbWlsbGlzZWNvbmQ6IHsgc3RyaW5nOiBzdHJpbmcsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICAgIHNlY29uZDogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgbWludXRlOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBob3VyOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICB3ZWVrZGF5OiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBkYXk6IHsgc3RyaW5nOiBzdHJpbmcsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICAgIG1vbnRoOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICB5ZWFyOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9CiAgICAgIH0sCiAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICAgIH0sCiAgICBncm91cE9yZGVyOiB7IHN0cmluZzogc3RyaW5nLCAnZnVuY3Rpb24nOiAnZnVuY3Rpb24nIH0sCiAgICBoZWlnaHQ6IHsgc3RyaW5nOiBzdHJpbmcsIG51bWJlcjogbnVtYmVyIH0sCiAgICBoaWRkZW5EYXRlczogeyBvYmplY3Q6IG9iamVjdCwgYXJyYXk6IGFycmF5IH0sCiAgICBsb2NhbGU6IHsgc3RyaW5nOiBzdHJpbmcgfSwKICAgIGxvY2FsZXM6IHsKICAgICAgX19hbnlfXzogeyBhbnk6IGFueSB9LAogICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9CiAgICB9LAogICAgbWFyZ2luOiB7CiAgICAgIGF4aXM6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgaXRlbTogewogICAgICAgIGhvcml6b250YWw6IHsgbnVtYmVyOiBudW1iZXIsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICAgIHZlcnRpY2FsOiB7IG51bWJlcjogbnVtYmVyLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCwgbnVtYmVyOiBudW1iZXIgfQogICAgICB9LAogICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCwgbnVtYmVyOiBudW1iZXIgfQogICAgfSwKICAgIG1heDogeyBkYXRlOiBkYXRlLCBudW1iZXI6IG51bWJlciwgc3RyaW5nOiBzdHJpbmcsIG1vbWVudDogbW9tZW50IH0sCiAgICBtYXhIZWlnaHQ6IHsgbnVtYmVyOiBudW1iZXIsIHN0cmluZzogc3RyaW5nIH0sCiAgICBtaW46IHsgZGF0ZTogZGF0ZSwgbnVtYmVyOiBudW1iZXIsIHN0cmluZzogc3RyaW5nLCBtb21lbnQ6IG1vbWVudCB9LAogICAgbWluSGVpZ2h0OiB7IG51bWJlcjogbnVtYmVyLCBzdHJpbmc6IHN0cmluZyB9LAogICAgbW92ZWFibGU6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgbXVsdGlzZWxlY3Q6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgb25BZGQ6IHsgJ2Z1bmN0aW9uJzogJ2Z1bmN0aW9uJyB9LAogICAgb25VcGRhdGU6IHsgJ2Z1bmN0aW9uJzogJ2Z1bmN0aW9uJyB9LAogICAgb25Nb3ZlOiB7ICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfSwKICAgIG9uTW92aW5nOiB7ICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfSwKICAgIG9uUmVtb3ZlOiB7ICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfSwKICAgIG9yZGVyOiB7ICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfSwKICAgIG9yaWVudGF0aW9uOiB7CiAgICAgIGF4aXM6IHsgc3RyaW5nOiBzdHJpbmcsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICBpdGVtOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgX190eXBlX186IHsgc3RyaW5nOiBzdHJpbmcsIG9iamVjdDogb2JqZWN0IH0KICAgIH0sCiAgICBzZWxlY3RhYmxlOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIHNob3dDdXJyZW50VGltZTogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICBzaG93TWFqb3JMYWJlbHM6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgc2hvd01pbm9yTGFiZWxzOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIHN0YWNrOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIHNuYXA6IHsgJ2Z1bmN0aW9uJzogJ2Z1bmN0aW9uJywgJ251bGwnOiAnbnVsbCcgfSwKICAgIHN0YXJ0OiB7IGRhdGU6IGRhdGUsIG51bWJlcjogbnVtYmVyLCBzdHJpbmc6IHN0cmluZywgbW9tZW50OiBtb21lbnQgfSwKICAgIHRlbXBsYXRlOiB7ICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfSwKICAgIHRpbWVBeGlzOiB7CiAgICAgIHNjYWxlOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgc3RlcDogeyBudW1iZXI6IG51bWJlciwgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICAgIH0sCiAgICB0eXBlOiB7IHN0cmluZzogc3RyaW5nIH0sCiAgICB3aWR0aDogeyBzdHJpbmc6IHN0cmluZywgbnVtYmVyOiBudW1iZXIgfSwKICAgIHpvb21hYmxlOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIHpvb21NYXg6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgIHpvb21NaW46IHsgbnVtYmVyOiBudW1iZXIgfSwKCiAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9CiAgfTsKCiAgdmFyIGNvbmZpZ3VyZU9wdGlvbnMgPSB7CiAgICBnbG9iYWw6IHsKICAgICAgYWxpZ246IFsnY2VudGVyJywgJ2xlZnQnLCAncmlnaHQnXSwKICAgICAgYXV0b1Jlc2l6ZTogdHJ1ZSwKICAgICAgY2xpY2tUb1VzZTogZmFsc2UsCiAgICAgIC8vIGRhdGFBdHRyaWJ1dGVzOiBbJ2FsbCddLCAvLyBGSVhNRTogY2FuIGJlICdhbGwnIG9yIHN0cmluZ1tdCiAgICAgIGVkaXRhYmxlOiB7CiAgICAgICAgYWRkOiBmYWxzZSwKICAgICAgICByZW1vdmU6IGZhbHNlLAogICAgICAgIHVwZGF0ZUdyb3VwOiBmYWxzZSwKICAgICAgICB1cGRhdGVUaW1lOiBmYWxzZQogICAgICB9LAogICAgICBlbmQ6ICcnLAogICAgICBmb3JtYXQ6IHsKICAgICAgICBtaW5vckxhYmVsczogewogICAgICAgICAgbWlsbGlzZWNvbmQ6ICdTU1MnLAogICAgICAgICAgc2Vjb25kOiAncycsCiAgICAgICAgICBtaW51dGU6ICdISDptbScsCiAgICAgICAgICBob3VyOiAnSEg6bW0nLAogICAgICAgICAgd2Vla2RheTogJ2RkZCBEJywKICAgICAgICAgIGRheTogJ0QnLAogICAgICAgICAgbW9udGg6ICdNTU0nLAogICAgICAgICAgeWVhcjogJ1lZWVknCiAgICAgICAgfSwKICAgICAgICBtYWpvckxhYmVsczogewogICAgICAgICAgbWlsbGlzZWNvbmQ6ICdISDptbTpzcycsCiAgICAgICAgICBzZWNvbmQ6ICdEIE1NTU0gSEg6bW0nLAogICAgICAgICAgbWludXRlOiAnZGRkIEQgTU1NTScsCiAgICAgICAgICBob3VyOiAnZGRkIEQgTU1NTScsCiAgICAgICAgICB3ZWVrZGF5OiAnTU1NTSBZWVlZJywKICAgICAgICAgIGRheTogJ01NTU0gWVlZWScsCiAgICAgICAgICBtb250aDogJ1lZWVknLAogICAgICAgICAgeWVhcjogJycKICAgICAgICB9CiAgICAgIH0sCgogICAgICAvL2dyb3VwT3JkZXI6IHtzdHJpbmcsICdmdW5jdGlvbic6ICdmdW5jdGlvbid9LAogICAgICBoZWlnaHQ6ICcnLAogICAgICAvL2hpZGRlbkRhdGVzOiB7b2JqZWN0LCBhcnJheX0sCiAgICAgIGxvY2FsZTogJycsCiAgICAgIG1hcmdpbjogewogICAgICAgIGF4aXM6IFsyMCwgMCwgMTAwLCAxXSwKICAgICAgICBpdGVtOiB7CiAgICAgICAgICBob3Jpem9udGFsOiBbMTAsIDAsIDEwMCwgMV0sCiAgICAgICAgICB2ZXJ0aWNhbDogWzEwLCAwLCAxMDAsIDFdCiAgICAgICAgfQogICAgICB9LAogICAgICBtYXg6ICcnLAogICAgICBtYXhIZWlnaHQ6ICcnLAogICAgICBtaW46ICcnLAogICAgICBtaW5IZWlnaHQ6ICcnLAogICAgICBtb3ZlYWJsZTogZmFsc2UsCiAgICAgIG11bHRpc2VsZWN0OiBmYWxzZSwKICAgICAgLy9vbkFkZDogeydmdW5jdGlvbic6ICdmdW5jdGlvbid9LAogICAgICAvL29uVXBkYXRlOiB7J2Z1bmN0aW9uJzogJ2Z1bmN0aW9uJ30sCiAgICAgIC8vb25Nb3ZlOiB7J2Z1bmN0aW9uJzogJ2Z1bmN0aW9uJ30sCiAgICAgIC8vb25Nb3Zpbmc6IHsnZnVuY3Rpb24nOiAnZnVuY3Rpb24nfSwKICAgICAgLy9vblJlbmFtZTogeydmdW5jdGlvbic6ICdmdW5jdGlvbid9LAogICAgICAvL29yZGVyOiB7J2Z1bmN0aW9uJzogJ2Z1bmN0aW9uJ30sCiAgICAgIG9yaWVudGF0aW9uOiB7CiAgICAgICAgYXhpczogWydib3RoJywgJ2JvdHRvbScsICd0b3AnXSwKICAgICAgICBpdGVtOiBbJ2JvdHRvbScsICd0b3AnXQogICAgICB9LAogICAgICBzZWxlY3RhYmxlOiB0cnVlLAogICAgICBzaG93Q3VycmVudFRpbWU6IGZhbHNlLAogICAgICBzaG93TWFqb3JMYWJlbHM6IHRydWUsCiAgICAgIHNob3dNaW5vckxhYmVsczogdHJ1ZSwKICAgICAgc3RhY2s6IHRydWUsCiAgICAgIC8vc25hcDogeydmdW5jdGlvbic6ICdmdW5jdGlvbicsIG5hZGF9LAogICAgICBzdGFydDogJycsCiAgICAgIC8vdGVtcGxhdGU6IHsnZnVuY3Rpb24nOiAnZnVuY3Rpb24nfSwKICAgICAgLy90aW1lQXhpczogewogICAgICAvLyAgc2NhbGU6IFsnbWlsbGlzZWNvbmQnLCAnc2Vjb25kJywgJ21pbnV0ZScsICdob3VyJywgJ3dlZWtkYXknLCAnZGF5JywgJ21vbnRoJywgJ3llYXInXSwKICAgICAgLy8gIHN0ZXA6IFsxLCAxLCAxMCwgMV0KICAgICAgLy99LAogICAgICB0eXBlOiBbJ2JveCcsICdwb2ludCcsICdyYW5nZScsICdiYWNrZ3JvdW5kJ10sCiAgICAgIHdpZHRoOiAnMTAwJScsCiAgICAgIHpvb21hYmxlOiB0cnVlLAogICAgICB6b29tTWF4OiBbMzE1MzYwMDAwMDAwMDAwLCAxMCwgMzE1MzYwMDAwMDAwMDAwLCAxXSwKICAgICAgem9vbU1pbjogWzEwLCAxMCwgMzE1MzYwMDAwMDAwMDAwLCAxXQogICAgfQogIH07CgogIGV4cG9ydHMuYWxsT3B0aW9ucyA9IGFsbE9wdGlvbnM7CiAgZXhwb3J0cy5jb25maWd1cmVPcHRpb25zID0gY29uZmlndXJlT3B0aW9uczsKCi8qKiovIH0sCi8qIDQ5ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciBFbWl0dGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMyk7CiAgdmFyIEhhbW1lciA9IF9fd2VicGFja19yZXF1aXJlX18oMjMpOwogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKICB2YXIgRGF0YVNldCA9IF9fd2VicGFja19yZXF1aXJlX18oOCk7CiAgdmFyIERhdGFWaWV3ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMCk7CiAgdmFyIFJhbmdlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNyk7CiAgdmFyIENvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMwKTsKICB2YXIgVGltZUF4aXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxKTsKICB2YXIgQ3VycmVudFRpbWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwKTsKICB2YXIgQ3VzdG9tVGltZSA9IF9fd2VicGFja19yZXF1aXJlX18oNDQpOwogIHZhciBMaW5lR3JhcGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUwKTsKCiAgdmFyIENvbmZpZ3VyYXRvciA9IF9fd2VicGFja19yZXF1aXJlX18oNDUpOwogIHZhciBWYWxpZGF0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ3KVsnZGVmYXVsdCddOwogIHZhciBwcmludFN0eWxlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NykucHJpbnRTdHlsZTsKICB2YXIgYWxsT3B0aW9ucyA9IF9fd2VicGFja19yZXF1aXJlX18oNTgpLmFsbE9wdGlvbnM7CiAgdmFyIGNvbmZpZ3VyZU9wdGlvbnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU4KS5jb25maWd1cmVPcHRpb25zOwoKICAvKioKICAgKiBDcmVhdGUgYSB0aW1lbGluZSB2aXN1YWxpemF0aW9uCiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gY29udGFpbmVyCiAgICogQHBhcmFtIHt2aXMuRGF0YVNldCB8IEFycmF5fSBbaXRlbXNdCiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSAgU2VlIEdyYXBoMmQuc2V0T3B0aW9ucyBmb3IgdGhlIGF2YWlsYWJsZSBvcHRpb25zLgogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBleHRlbmRzIENvcmUKICAgKi8KICBmdW5jdGlvbiBHcmFwaDJkKGNvbnRhaW5lciwgaXRlbXMsIGdyb3Vwcywgb3B0aW9ucykgewogICAgLy8gaWYgdGhlIHRoaXJkIGVsZW1lbnQgaXMgb3B0aW9ucywgdGhlIGZvcnRoIGlzIGdyb3VwcyAob3B0aW9uYWxseSk7CiAgICBpZiAoIShBcnJheS5pc0FycmF5KGdyb3VwcykgfHwgZ3JvdXBzIGluc3RhbmNlb2YgRGF0YVNldCkgJiYgZ3JvdXBzIGluc3RhbmNlb2YgT2JqZWN0KSB7CiAgICAgIHZhciBmb3J0aEFyZ3VtZW50ID0gb3B0aW9uczsKICAgICAgb3B0aW9ucyA9IGdyb3VwczsKICAgICAgZ3JvdXBzID0gZm9ydGhBcmd1bWVudDsKICAgIH0KCiAgICB2YXIgbWUgPSB0aGlzOwogICAgdGhpcy5kZWZhdWx0T3B0aW9ucyA9IHsKICAgICAgc3RhcnQ6IG51bGwsCiAgICAgIGVuZDogbnVsbCwKCiAgICAgIGF1dG9SZXNpemU6IHRydWUsCgogICAgICBvcmllbnRhdGlvbjogewogICAgICAgIGF4aXM6ICdib3R0b20nLCAvLyBheGlzIG9yaWVudGF0aW9uOiAnYm90dG9tJywgJ3RvcCcsIG9yICdib3RoJwogICAgICAgIGl0ZW06ICdib3R0b20nIC8vIG5vdCByZWxldmFudCBmb3IgR3JhcGgyZAogICAgICB9LAoKICAgICAgd2lkdGg6IG51bGwsCiAgICAgIGhlaWdodDogbnVsbCwKICAgICAgbWF4SGVpZ2h0OiBudWxsLAogICAgICBtaW5IZWlnaHQ6IG51bGwKICAgIH07CiAgICB0aGlzLm9wdGlvbnMgPSB1dGlsLmRlZXBFeHRlbmQoe30sIHRoaXMuZGVmYXVsdE9wdGlvbnMpOwoKICAgIC8vIENyZWF0ZSB0aGUgRE9NLCBwcm9wcywgYW5kIGVtaXR0ZXIKICAgIHRoaXMuX2NyZWF0ZShjb250YWluZXIpOwoKICAgIC8vIGFsbCBjb21wb25lbnRzIGxpc3RlZCBoZXJlIHdpbGwgYmUgcmVwYWludGVkIGF1dG9tYXRpY2FsbHkKICAgIHRoaXMuY29tcG9uZW50cyA9IFtdOwoKICAgIHRoaXMuYm9keSA9IHsKICAgICAgZG9tOiB0aGlzLmRvbSwKICAgICAgZG9tUHJvcHM6IHRoaXMucHJvcHMsCiAgICAgIGVtaXR0ZXI6IHsKICAgICAgICBvbjogdGhpcy5vbi5iaW5kKHRoaXMpLAogICAgICAgIG9mZjogdGhpcy5vZmYuYmluZCh0aGlzKSwKICAgICAgICBlbWl0OiB0aGlzLmVtaXQuYmluZCh0aGlzKQogICAgICB9LAogICAgICBoaWRkZW5EYXRlczogW10sCiAgICAgIHV0aWw6IHsKICAgICAgICB0b1NjcmVlbjogbWUuX3RvU2NyZWVuLmJpbmQobWUpLAogICAgICAgIHRvR2xvYmFsU2NyZWVuOiBtZS5fdG9HbG9iYWxTY3JlZW4uYmluZChtZSksIC8vIHRoaXMgcmVmZXJzIHRvIHRoZSByb290LndpZHRoCiAgICAgICAgdG9UaW1lOiBtZS5fdG9UaW1lLmJpbmQobWUpLAogICAgICAgIHRvR2xvYmFsVGltZTogbWUuX3RvR2xvYmFsVGltZS5iaW5kKG1lKQogICAgICB9CiAgICB9OwoKICAgIC8vIHJhbmdlCiAgICB0aGlzLnJhbmdlID0gbmV3IFJhbmdlKHRoaXMuYm9keSk7CiAgICB0aGlzLmNvbXBvbmVudHMucHVzaCh0aGlzLnJhbmdlKTsKICAgIHRoaXMuYm9keS5yYW5nZSA9IHRoaXMucmFuZ2U7CgogICAgLy8gdGltZSBheGlzCiAgICB0aGlzLnRpbWVBeGlzID0gbmV3IFRpbWVBeGlzKHRoaXMuYm9keSk7CiAgICB0aGlzLmNvbXBvbmVudHMucHVzaCh0aGlzLnRpbWVBeGlzKTsKICAgIC8vdGhpcy5ib2R5LnV0aWwuc25hcCA9IHRoaXMudGltZUF4aXMuc25hcC5iaW5kKHRoaXMudGltZUF4aXMpOwoKICAgIC8vIGN1cnJlbnQgdGltZSBiYXIKICAgIHRoaXMuY3VycmVudFRpbWUgPSBuZXcgQ3VycmVudFRpbWUodGhpcy5ib2R5KTsKICAgIHRoaXMuY29tcG9uZW50cy5wdXNoKHRoaXMuY3VycmVudFRpbWUpOwoKICAgIC8vIGl0ZW0gc2V0CiAgICB0aGlzLmxpbmVncmFwaCA9IG5ldyBMaW5lR3JhcGgodGhpcy5ib2R5KTsKICAgIHRoaXMuY29tcG9uZW50cy5wdXNoKHRoaXMubGluZWdyYXBoKTsKCiAgICB0aGlzLml0ZW1zRGF0YSA9IG51bGw7IC8vIERhdGFTZXQKICAgIHRoaXMuZ3JvdXBzRGF0YSA9IG51bGw7IC8vIERhdGFTZXQKCiAgICB0aGlzLm9uKCd0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgbWUuZW1pdCgnY2xpY2snLCBtZS5nZXRFdmVudFByb3BlcnRpZXMoZXZlbnQpKTsKICAgIH0pOwogICAgdGhpcy5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIG1lLmVtaXQoJ2RvdWJsZUNsaWNrJywgbWUuZ2V0RXZlbnRQcm9wZXJ0aWVzKGV2ZW50KSk7CiAgICB9KTsKICAgIHRoaXMuZG9tLnJvb3Qub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICBtZS5lbWl0KCdjb250ZXh0bWVudScsIG1lLmdldEV2ZW50UHJvcGVydGllcyhldmVudCkpOwogICAgfTsKCiAgICAvLyBhcHBseSBvcHRpb25zCiAgICBpZiAob3B0aW9ucykgewogICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICB9CgogICAgLy8gSU1QT1JUQU5UOiBUSElTIEhBUFBFTlMgQkVGT1JFIFNFVCBJVEVNUyEKICAgIGlmIChncm91cHMpIHsKICAgICAgdGhpcy5zZXRHcm91cHMoZ3JvdXBzKTsKICAgIH0KCiAgICAvLyBjcmVhdGUgaXRlbXNldAogICAgaWYgKGl0ZW1zKSB7CiAgICAgIHRoaXMuc2V0SXRlbXMoaXRlbXMpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fcmVkcmF3KCk7CiAgICB9CiAgfQoKICAvLyBFeHRlbmQgdGhlIGZ1bmN0aW9uYWxpdHkgZnJvbSBDb3JlCiAgR3JhcGgyZC5wcm90b3R5cGUgPSBuZXcgQ29yZSgpOwoKICBHcmFwaDJkLnByb3RvdHlwZS5zZXRPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIC8vIHZhbGlkYXRlIG9wdGlvbnMKICAgIHZhciBlcnJvckZvdW5kID0gVmFsaWRhdG9yLnZhbGlkYXRlKG9wdGlvbnMsIGFsbE9wdGlvbnMpOwogICAgaWYgKGVycm9yRm91bmQgPT09IHRydWUpIHsKICAgICAgY29uc29sZS5sb2coJyVjRXJyb3JzIGhhdmUgYmVlbiBmb3VuZCBpbiB0aGUgc3VwcGxpZWQgb3B0aW9ucyBvYmplY3QuJywgcHJpbnRTdHlsZSk7CiAgICB9CgogICAgQ29yZS5wcm90b3R5cGUuc2V0T3B0aW9ucy5jYWxsKHRoaXMsIG9wdGlvbnMpOwogIH07CgogIC8qKgogICAqIFNldCBpdGVtcwogICAqIEBwYXJhbSB7dmlzLkRhdGFTZXQgfCBBcnJheSB8IG51bGx9IGl0ZW1zCiAgICovCiAgR3JhcGgyZC5wcm90b3R5cGUuc2V0SXRlbXMgPSBmdW5jdGlvbiAoaXRlbXMpIHsKICAgIHZhciBpbml0aWFsTG9hZCA9IHRoaXMuaXRlbXNEYXRhID09IG51bGw7CgogICAgLy8gY29udmVydCB0byB0eXBlIERhdGFTZXQgd2hlbiBuZWVkZWQKICAgIHZhciBuZXdEYXRhU2V0OwogICAgaWYgKCFpdGVtcykgewogICAgICBuZXdEYXRhU2V0ID0gbnVsbDsKICAgIH0gZWxzZSBpZiAoaXRlbXMgaW5zdGFuY2VvZiBEYXRhU2V0IHx8IGl0ZW1zIGluc3RhbmNlb2YgRGF0YVZpZXcpIHsKICAgICAgbmV3RGF0YVNldCA9IGl0ZW1zOwogICAgfSBlbHNlIHsKICAgICAgLy8gdHVybiBhbiBhcnJheSBpbnRvIGEgZGF0YXNldAogICAgICBuZXdEYXRhU2V0ID0gbmV3IERhdGFTZXQoaXRlbXMsIHsKICAgICAgICB0eXBlOiB7CiAgICAgICAgICBzdGFydDogJ0RhdGUnLAogICAgICAgICAgZW5kOiAnRGF0ZScKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIC8vIHNldCBpdGVtcwogICAgdGhpcy5pdGVtc0RhdGEgPSBuZXdEYXRhU2V0OwogICAgdGhpcy5saW5lZ3JhcGggJiYgdGhpcy5saW5lZ3JhcGguc2V0SXRlbXMobmV3RGF0YVNldCk7CgogICAgaWYgKGluaXRpYWxMb2FkKSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuc3RhcnQgIT0gdW5kZWZpbmVkIHx8IHRoaXMub3B0aW9ucy5lbmQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5vcHRpb25zLnN0YXJ0ICE9IHVuZGVmaW5lZCA/IHRoaXMub3B0aW9ucy5zdGFydCA6IG51bGw7CiAgICAgICAgdmFyIGVuZCA9IHRoaXMub3B0aW9ucy5lbmQgIT0gdW5kZWZpbmVkID8gdGhpcy5vcHRpb25zLmVuZCA6IG51bGw7CgogICAgICAgIHRoaXMuc2V0V2luZG93KHN0YXJ0LCBlbmQsIHsgYW5pbWF0aW9uOiBmYWxzZSB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpdCh7IGFuaW1hdGlvbjogZmFsc2UgfSk7CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBTZXQgZ3JvdXBzCiAgICogQHBhcmFtIHt2aXMuRGF0YVNldCB8IEFycmF5fSBncm91cHMKICAgKi8KICBHcmFwaDJkLnByb3RvdHlwZS5zZXRHcm91cHMgPSBmdW5jdGlvbiAoZ3JvdXBzKSB7CiAgICAvLyBjb252ZXJ0IHRvIHR5cGUgRGF0YVNldCB3aGVuIG5lZWRlZAogICAgdmFyIG5ld0RhdGFTZXQ7CiAgICBpZiAoIWdyb3VwcykgewogICAgICBuZXdEYXRhU2V0ID0gbnVsbDsKICAgIH0gZWxzZSBpZiAoZ3JvdXBzIGluc3RhbmNlb2YgRGF0YVNldCB8fCBncm91cHMgaW5zdGFuY2VvZiBEYXRhVmlldykgewogICAgICBuZXdEYXRhU2V0ID0gZ3JvdXBzOwogICAgfSBlbHNlIHsKICAgICAgLy8gdHVybiBhbiBhcnJheSBpbnRvIGEgZGF0YXNldAogICAgICBuZXdEYXRhU2V0ID0gbmV3IERhdGFTZXQoZ3JvdXBzKTsKICAgIH0KCiAgICB0aGlzLmdyb3Vwc0RhdGEgPSBuZXdEYXRhU2V0OwogICAgdGhpcy5saW5lZ3JhcGguc2V0R3JvdXBzKG5ld0RhdGFTZXQpOwogIH07CgogIC8qKgogICAqIFJldHVybnMgYW4gb2JqZWN0IGNvbnRhaW5pbmcgYW4gU1ZHIGVsZW1lbnQgd2l0aCB0aGUgaWNvbiBvZiB0aGUgZ3JvdXAgKHNpemUgZGV0ZXJtaW5lZCBieSBpY29uV2lkdGggYW5kIGljb25IZWlnaHQpLCB0aGUgbGFiZWwgb2YgdGhlIGdyb3VwIChjb250ZW50KSBhbmQgdGhlIHlBeGlzT3JpZW50YXRpb24gb2YgdGhlIGdyb3VwIChsZWZ0IG9yIHJpZ2h0KS4KICAgKiBAcGFyYW0gZ3JvdXBJZAogICAqIEBwYXJhbSB3aWR0aAogICAqIEBwYXJhbSBoZWlnaHQKICAgKi8KICBHcmFwaDJkLnByb3RvdHlwZS5nZXRMZWdlbmQgPSBmdW5jdGlvbiAoZ3JvdXBJZCwgd2lkdGgsIGhlaWdodCkgewogICAgaWYgKHdpZHRoID09PSB1bmRlZmluZWQpIHsKICAgICAgd2lkdGggPSAxNTsKICAgIH0KICAgIGlmIChoZWlnaHQgPT09IHVuZGVmaW5lZCkgewogICAgICBoZWlnaHQgPSAxNTsKICAgIH0KICAgIGlmICh0aGlzLmxpbmVncmFwaC5ncm91cHNbZ3JvdXBJZF0gIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdGhpcy5saW5lZ3JhcGguZ3JvdXBzW2dyb3VwSWRdLmdldExlZ2VuZCh3aWR0aCwgaGVpZ2h0KTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAnY2Fubm90IGZpbmQgZ3JvdXA6JyArIGdyb3VwSWQ7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogVGhpcyBjaGVja3MgaWYgdGhlIHZpc2libGUgb3B0aW9uIG9mIHRoZSBzdXBwbGllZCBncm91cCAoYnkgSUQpIGlzIHRydWUgb3IgZmFsc2UuCiAgICogQHBhcmFtIGdyb3VwSWQKICAgKiBAcmV0dXJucyB7Kn0KICAgKi8KICBHcmFwaDJkLnByb3RvdHlwZS5pc0dyb3VwVmlzaWJsZSA9IGZ1bmN0aW9uIChncm91cElkKSB7CiAgICBpZiAodGhpcy5saW5lZ3JhcGguZ3JvdXBzW2dyb3VwSWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHRoaXMubGluZWdyYXBoLmdyb3Vwc1tncm91cElkXS52aXNpYmxlICYmICh0aGlzLmxpbmVncmFwaC5vcHRpb25zLmdyb3Vwcy52aXNpYmlsaXR5W2dyb3VwSWRdID09PSB1bmRlZmluZWQgfHwgdGhpcy5saW5lZ3JhcGgub3B0aW9ucy5ncm91cHMudmlzaWJpbGl0eVtncm91cElkXSA9PSB0cnVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9OwoKICAvKioKICAgKiBHZXQgdGhlIGRhdGEgcmFuZ2Ugb2YgdGhlIGl0ZW0gc2V0LgogICAqIEByZXR1cm5zIHt7bWluOiBEYXRlLCBtYXg6IERhdGV9fSByYW5nZSAgQSByYW5nZSB3aXRoIGEgc3RhcnQgYW5kIGVuZCBEYXRlLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2hlbiBubyBtaW5pbXVtIGlzIGZvdW5kLCBtaW49PW51bGwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdoZW4gbm8gbWF4aW11bSBpcyBmb3VuZCwgbWF4PT1udWxsCiAgICovCiAgR3JhcGgyZC5wcm90b3R5cGUuZ2V0RGF0YVJhbmdlID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG1pbiA9IG51bGw7CiAgICB2YXIgbWF4ID0gbnVsbDsKCiAgICAvLyBjYWxjdWxhdGUgbWluIGZyb20gc3RhcnQgZmlsZWQKICAgIGZvciAodmFyIGdyb3VwSWQgaW4gdGhpcy5saW5lZ3JhcGguZ3JvdXBzKSB7CiAgICAgIGlmICh0aGlzLmxpbmVncmFwaC5ncm91cHMuaGFzT3duUHJvcGVydHkoZ3JvdXBJZCkpIHsKICAgICAgICBpZiAodGhpcy5saW5lZ3JhcGguZ3JvdXBzW2dyb3VwSWRdLnZpc2libGUgPT0gdHJ1ZSkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxpbmVncmFwaC5ncm91cHNbZ3JvdXBJZF0uaXRlbXNEYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcy5saW5lZ3JhcGguZ3JvdXBzW2dyb3VwSWRdLml0ZW1zRGF0YVtpXTsKICAgICAgICAgICAgdmFyIHZhbHVlID0gdXRpbC5jb252ZXJ0KGl0ZW0ueCwgJ0RhdGUnKS52YWx1ZU9mKCk7CiAgICAgICAgICAgIG1pbiA9IG1pbiA9PSBudWxsID8gdmFsdWUgOiBtaW4gPiB2YWx1ZSA/IHZhbHVlIDogbWluOwogICAgICAgICAgICBtYXggPSBtYXggPT0gbnVsbCA/IHZhbHVlIDogbWF4IDwgdmFsdWUgPyB2YWx1ZSA6IG1heDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICBtaW46IG1pbiAhPSBudWxsID8gbmV3IERhdGUobWluKSA6IG51bGwsCiAgICAgIG1heDogbWF4ICE9IG51bGwgPyBuZXcgRGF0ZShtYXgpIDogbnVsbAogICAgfTsKICB9OwoKICAvKioKICAgKiBHZW5lcmF0ZSBUaW1lbGluZSByZWxhdGVkIGluZm9ybWF0aW9uIGZyb20gYW4gZXZlbnQKICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudAogICAqIEByZXR1cm4ge09iamVjdH0gQW4gb2JqZWN0IHdpdGggcmVsYXRlZCBpbmZvcm1hdGlvbiwgbGlrZSBvbiB3aGljaCBhcmVhCiAgICogICAgICAgICAgICAgICAgICBUaGUgZXZlbnQgaGFwcGVuZWQsIHdoZXRoZXIgY2xpY2tlZCBvbiBhbiBpdGVtLCBldGMuCiAgICovCiAgR3JhcGgyZC5wcm90b3R5cGUuZ2V0RXZlbnRQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICB2YXIgY2xpZW50WCA9IGV2ZW50LmNlbnRlciA/IGV2ZW50LmNlbnRlci54IDogZXZlbnQuY2xpZW50WDsKICAgIHZhciBjbGllbnRZID0gZXZlbnQuY2VudGVyID8gZXZlbnQuY2VudGVyLnkgOiBldmVudC5jbGllbnRZOwogICAgdmFyIHggPSBjbGllbnRYIC0gdXRpbC5nZXRBYnNvbHV0ZUxlZnQodGhpcy5kb20uY2VudGVyQ29udGFpbmVyKTsKICAgIHZhciB5ID0gY2xpZW50WSAtIHV0aWwuZ2V0QWJzb2x1dGVUb3AodGhpcy5kb20uY2VudGVyQ29udGFpbmVyKTsKICAgIHZhciB0aW1lID0gdGhpcy5fdG9UaW1lKHgpOwoKICAgIHZhciBjdXN0b21UaW1lID0gQ3VzdG9tVGltZS5jdXN0b21UaW1lRnJvbVRhcmdldChldmVudCk7CgogICAgdmFyIGVsZW1lbnQgPSB1dGlsLmdldFRhcmdldChldmVudCk7CiAgICB2YXIgd2hhdCA9IG51bGw7CiAgICBpZiAodXRpbC5oYXNQYXJlbnQoZWxlbWVudCwgdGhpcy50aW1lQXhpcy5kb20uZm9yZWdyb3VuZCkpIHsKICAgICAgd2hhdCA9ICdheGlzJzsKICAgIH0gZWxzZSBpZiAodGhpcy50aW1lQXhpczIgJiYgdXRpbC5oYXNQYXJlbnQoZWxlbWVudCwgdGhpcy50aW1lQXhpczIuZG9tLmZvcmVncm91bmQpKSB7CiAgICAgIHdoYXQgPSAnYXhpcyc7CiAgICB9IGVsc2UgaWYgKHV0aWwuaGFzUGFyZW50KGVsZW1lbnQsIHRoaXMubGluZWdyYXBoLnlBeGlzTGVmdC5kb20uZnJhbWUpKSB7CiAgICAgIHdoYXQgPSAnZGF0YS1heGlzJzsKICAgIH0gZWxzZSBpZiAodXRpbC5oYXNQYXJlbnQoZWxlbWVudCwgdGhpcy5saW5lZ3JhcGgueUF4aXNSaWdodC5kb20uZnJhbWUpKSB7CiAgICAgIHdoYXQgPSAnZGF0YS1heGlzJzsKICAgIH0gZWxzZSBpZiAodXRpbC5oYXNQYXJlbnQoZWxlbWVudCwgdGhpcy5saW5lZ3JhcGgubGVnZW5kTGVmdC5kb20uZnJhbWUpKSB7CiAgICAgIHdoYXQgPSAnbGVnZW5kJzsKICAgIH0gZWxzZSBpZiAodXRpbC5oYXNQYXJlbnQoZWxlbWVudCwgdGhpcy5saW5lZ3JhcGgubGVnZW5kUmlnaHQuZG9tLmZyYW1lKSkgewogICAgICB3aGF0ID0gJ2xlZ2VuZCc7CiAgICB9IGVsc2UgaWYgKGN1c3RvbVRpbWUgIT0gbnVsbCkgewogICAgICB3aGF0ID0gJ2N1c3RvbS10aW1lJzsKICAgIH0gZWxzZSBpZiAodXRpbC5oYXNQYXJlbnQoZWxlbWVudCwgdGhpcy5jdXJyZW50VGltZS5iYXIpKSB7CiAgICAgIHdoYXQgPSAnY3VycmVudC10aW1lJzsKICAgIH0gZWxzZSBpZiAodXRpbC5oYXNQYXJlbnQoZWxlbWVudCwgdGhpcy5kb20uY2VudGVyKSkgewogICAgICB3aGF0ID0gJ2JhY2tncm91bmQnOwogICAgfQoKICAgIHZhciB2YWx1ZSA9IFtdOwogICAgdmFyIHlBeGlzTGVmdCA9IHRoaXMubGluZWdyYXBoLnlBeGlzTGVmdDsKICAgIHZhciB5QXhpc1JpZ2h0ID0gdGhpcy5saW5lZ3JhcGgueUF4aXNSaWdodDsKICAgIGlmICgheUF4aXNMZWZ0LmhpZGRlbikgewogICAgICB2YWx1ZS5wdXNoKHlBeGlzTGVmdC5zY3JlZW5Ub1ZhbHVlKHkpKTsKICAgIH0KICAgIGlmICgheUF4aXNSaWdodC5oaWRkZW4pIHsKICAgICAgdmFsdWUucHVzaCh5QXhpc1JpZ2h0LnNjcmVlblRvVmFsdWUoeSkpOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIGV2ZW50OiBldmVudCwKICAgICAgd2hhdDogd2hhdCwKICAgICAgcGFnZVg6IGV2ZW50LnNyY0V2ZW50ID8gZXZlbnQuc3JjRXZlbnQucGFnZVggOiBldmVudC5wYWdlWCwKICAgICAgcGFnZVk6IGV2ZW50LnNyY0V2ZW50ID8gZXZlbnQuc3JjRXZlbnQucGFnZVkgOiBldmVudC5wYWdlWSwKICAgICAgeDogeCwKICAgICAgeTogeSwKICAgICAgdGltZTogdGltZSwKICAgICAgdmFsdWU6IHZhbHVlCiAgICB9OwogIH07CgogIC8qKgogICAqIExvYWQgYSBjb25maWd1cmF0b3IKICAgKiBAcmV0dXJuIHtPYmplY3R9CiAgICogQHByaXZhdGUKICAgKi8KICBHcmFwaDJkLnByb3RvdHlwZS5fY3JlYXRlQ29uZmlndXJhdG9yID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIG5ldyBDb25maWd1cmF0b3IodGhpcywgdGhpcy5kb20uY29udGFpbmVyLCBjb25maWd1cmVPcHRpb25zKTsKICB9OwoKICBtb2R1bGUuZXhwb3J0cyA9IEdyYXBoMmQ7CgovKioqLyB9LAovKiA1MCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CiAgdmFyIERPTXV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOwogIHZhciBEYXRhU2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKICB2YXIgRGF0YVZpZXcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKICB2YXIgQ29tcG9uZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMSk7CiAgdmFyIERhdGFBeGlzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MSk7CiAgdmFyIEdyYXBoR3JvdXAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUzKTsKICB2YXIgTGVnZW5kID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1Nyk7CiAgdmFyIEJhckZ1bmN0aW9ucyA9IF9fd2VicGFja19yZXF1aXJlX18oNTYpOwogIHZhciBMaW5lRnVuY3Rpb25zID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1NCk7CgogIHZhciBVTkdST1VQRUQgPSAnX191bmdyb3VwZWRfXyc7IC8vIHJlc2VydmVkIGdyb3VwIGlkIGZvciB1bmdyb3VwZWQgaXRlbXMKCiAgLyoqCiAgICogVGhpcyBpcyB0aGUgY29uc3RydWN0b3Igb2YgdGhlIExpbmVHcmFwaC4gSXQgcmVxdWlyZXMgYSBUaW1lbGluZSBib2R5IGFuZCBvcHRpb25zLgogICAqCiAgICogQHBhcmFtIGJvZHkKICAgKiBAcGFyYW0gb3B0aW9ucwogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIExpbmVHcmFwaChib2R5LCBvcHRpb25zKSB7CiAgICB0aGlzLmlkID0gdXRpbC5yYW5kb21VVUlEKCk7CiAgICB0aGlzLmJvZHkgPSBib2R5OwoKICAgIHRoaXMuZGVmYXVsdE9wdGlvbnMgPSB7CiAgICAgIHlBeGlzT3JpZW50YXRpb246ICdsZWZ0JywKICAgICAgZGVmYXVsdEdyb3VwOiAnZGVmYXVsdCcsCiAgICAgIHNvcnQ6IHRydWUsCiAgICAgIHNhbXBsaW5nOiB0cnVlLAogICAgICBzdGFjazogZmFsc2UsCiAgICAgIGdyYXBoSGVpZ2h0OiAnNDAwcHgnLAogICAgICBzaGFkZWQ6IHsKICAgICAgICBlbmFibGVkOiBmYWxzZSwKICAgICAgICBvcmllbnRhdGlvbjogJ2JvdHRvbScgLy8gdG9wLCBib3R0b20KICAgICAgfSwKICAgICAgc3R5bGU6ICdsaW5lJywgLy8gbGluZSwgYmFyCiAgICAgIGJhckNoYXJ0OiB7CiAgICAgICAgd2lkdGg6IDUwLAogICAgICAgIHNpZGVCeVNpZGU6IGZhbHNlLAogICAgICAgIGFsaWduOiAnY2VudGVyJyAvLyBsZWZ0LCBjZW50ZXIsIHJpZ2h0CiAgICAgIH0sCiAgICAgIGludGVycG9sYXRpb246IHsKICAgICAgICBlbmFibGVkOiB0cnVlLAogICAgICAgIHBhcmFtZXRyaXphdGlvbjogJ2NlbnRyaXBldGFsJywgLy8gdW5pZm9ybSAoYWxwaGEgPSAwLjApLCBjaG9yZGFsIChhbHBoYSA9IDEuMCksIGNlbnRyaXBldGFsIChhbHBoYSA9IDAuNSkKICAgICAgICBhbHBoYTogMC41CiAgICAgIH0sCiAgICAgIGRyYXdQb2ludHM6IHsKICAgICAgICBlbmFibGVkOiB0cnVlLAogICAgICAgIHNpemU6IDYsCiAgICAgICAgc3R5bGU6ICdzcXVhcmUnIC8vIHNxdWFyZSwgY2lyY2xlCiAgICAgIH0sCiAgICAgIGRhdGFBeGlzOiB7CiAgICAgICAgc2hvd01pbm9yTGFiZWxzOiB0cnVlLAogICAgICAgIHNob3dNYWpvckxhYmVsczogdHJ1ZSwKICAgICAgICBpY29uczogZmFsc2UsCiAgICAgICAgd2lkdGg6ICc0MHB4JywKICAgICAgICB2aXNpYmxlOiB0cnVlLAogICAgICAgIGFsaWduWmVyb3M6IHRydWUsCiAgICAgICAgbGVmdDogewogICAgICAgICAgcmFuZ2U6IHsgbWluOiB1bmRlZmluZWQsIG1heDogdW5kZWZpbmVkIH0sCiAgICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uIGZvcm1hdCh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9LAogICAgICAgICAgdGl0bGU6IHsgdGV4dDogdW5kZWZpbmVkLCBzdHlsZTogdW5kZWZpbmVkIH0KICAgICAgICB9LAogICAgICAgIHJpZ2h0OiB7CiAgICAgICAgICByYW5nZTogeyBtaW46IHVuZGVmaW5lZCwgbWF4OiB1bmRlZmluZWQgfSwKICAgICAgICAgIGZvcm1hdDogZnVuY3Rpb24gZm9ybWF0KHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgIH0sCiAgICAgICAgICB0aXRsZTogeyB0ZXh0OiB1bmRlZmluZWQsIHN0eWxlOiB1bmRlZmluZWQgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgbGVnZW5kOiB7CiAgICAgICAgZW5hYmxlZDogZmFsc2UsCiAgICAgICAgaWNvbnM6IHRydWUsCiAgICAgICAgbGVmdDogewogICAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAndG9wLWxlZnQnIC8vIHRvcC9ib3R0b20gLSBsZWZ0LHJpZ2h0CiAgICAgICAgfSwKICAgICAgICByaWdodDogewogICAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiAndG9wLXJpZ2h0JyAvLyB0b3AvYm90dG9tIC0gbGVmdCxyaWdodAogICAgICAgIH0KICAgICAgfSwKICAgICAgZ3JvdXBzOiB7CiAgICAgICAgdmlzaWJpbGl0eToge30KICAgICAgfQogICAgfTsKCiAgICAvLyBvcHRpb25zIGlzIHNoYXJlZCBieSB0aGlzIEl0ZW1TZXQgYW5kIGFsbCBpdHMgaXRlbXMKICAgIHRoaXMub3B0aW9ucyA9IHV0aWwuZXh0ZW5kKHt9LCB0aGlzLmRlZmF1bHRPcHRpb25zKTsKICAgIHRoaXMuZG9tID0ge307CiAgICB0aGlzLnByb3BzID0ge307CiAgICB0aGlzLmhhbW1lciA9IG51bGw7CiAgICB0aGlzLmdyb3VwcyA9IHt9OwogICAgdGhpcy5hYm9ydGVkR3JhcGhVcGRhdGUgPSBmYWxzZTsKICAgIHRoaXMudXBkYXRlU1ZHaGVpZ2h0ID0gZmFsc2U7CiAgICB0aGlzLnVwZGF0ZVNWR2hlaWdodE9uUmVzaXplID0gZmFsc2U7CgogICAgdmFyIG1lID0gdGhpczsKICAgIHRoaXMuaXRlbXNEYXRhID0gbnVsbDsgLy8gRGF0YVNldAogICAgdGhpcy5ncm91cHNEYXRhID0gbnVsbDsgLy8gRGF0YVNldAoKICAgIC8vIGxpc3RlbmVycyBmb3IgdGhlIERhdGFTZXQgb2YgdGhlIGl0ZW1zCiAgICB0aGlzLml0ZW1MaXN0ZW5lcnMgPSB7CiAgICAgICdhZGQnOiBmdW5jdGlvbiBhZGQoZXZlbnQsIHBhcmFtcywgc2VuZGVySWQpIHsKICAgICAgICBtZS5fb25BZGQocGFyYW1zLml0ZW1zKTsKICAgICAgfSwKICAgICAgJ3VwZGF0ZSc6IGZ1bmN0aW9uIHVwZGF0ZShldmVudCwgcGFyYW1zLCBzZW5kZXJJZCkgewogICAgICAgIG1lLl9vblVwZGF0ZShwYXJhbXMuaXRlbXMpOwogICAgICB9LAogICAgICAncmVtb3ZlJzogZnVuY3Rpb24gcmVtb3ZlKGV2ZW50LCBwYXJhbXMsIHNlbmRlcklkKSB7CiAgICAgICAgbWUuX29uUmVtb3ZlKHBhcmFtcy5pdGVtcyk7CiAgICAgIH0KICAgIH07CgogICAgLy8gbGlzdGVuZXJzIGZvciB0aGUgRGF0YVNldCBvZiB0aGUgZ3JvdXBzCiAgICB0aGlzLmdyb3VwTGlzdGVuZXJzID0gewogICAgICAnYWRkJzogZnVuY3Rpb24gYWRkKGV2ZW50LCBwYXJhbXMsIHNlbmRlcklkKSB7CiAgICAgICAgbWUuX29uQWRkR3JvdXBzKHBhcmFtcy5pdGVtcyk7CiAgICAgIH0sCiAgICAgICd1cGRhdGUnOiBmdW5jdGlvbiB1cGRhdGUoZXZlbnQsIHBhcmFtcywgc2VuZGVySWQpIHsKICAgICAgICBtZS5fb25VcGRhdGVHcm91cHMocGFyYW1zLml0ZW1zKTsKICAgICAgfSwKICAgICAgJ3JlbW92ZSc6IGZ1bmN0aW9uIHJlbW92ZShldmVudCwgcGFyYW1zLCBzZW5kZXJJZCkgewogICAgICAgIG1lLl9vblJlbW92ZUdyb3VwcyhwYXJhbXMuaXRlbXMpOwogICAgICB9CiAgICB9OwoKICAgIHRoaXMuaXRlbXMgPSB7fTsgLy8gb2JqZWN0IHdpdGggYW4gSXRlbSBmb3IgZXZlcnkgZGF0YSBpdGVtCiAgICB0aGlzLnNlbGVjdGlvbiA9IFtdOyAvLyBsaXN0IHdpdGggdGhlIGlkcyBvZiBhbGwgc2VsZWN0ZWQgbm9kZXMKICAgIHRoaXMubGFzdFN0YXJ0ID0gdGhpcy5ib2R5LnJhbmdlLnN0YXJ0OwogICAgdGhpcy50b3VjaFBhcmFtcyA9IHt9OyAvLyBzdG9yZXMgcHJvcGVydGllcyB3aGlsZSBkcmFnZ2luZwoKICAgIHRoaXMuc3ZnRWxlbWVudHMgPSB7fTsKICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTsKICAgIHRoaXMuZ3JvdXBzVXNpbmdEZWZhdWx0U3R5bGVzID0gWzBdOwogICAgdGhpcy5DT1VOVEVSID0gMDsKICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdyYW5nZWNoYW5nZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIG1lLmxhc3RTdGFydCA9IG1lLmJvZHkucmFuZ2Uuc3RhcnQ7CiAgICAgIG1lLnN2Zy5zdHlsZS5sZWZ0ID0gdXRpbC5vcHRpb24uYXNTaXplKC1tZS5wcm9wcy53aWR0aCk7CiAgICAgIG1lLnJlZHJhdy5jYWxsKG1lLCB0cnVlKTsKICAgIH0pOwoKICAgIC8vIGNyZWF0ZSB0aGUgSFRNTCBET00KICAgIHRoaXMuX2NyZWF0ZSgpOwogICAgdGhpcy5mcmFtZXdvcmsgPSB7IHN2ZzogdGhpcy5zdmcsIHN2Z0VsZW1lbnRzOiB0aGlzLnN2Z0VsZW1lbnRzLCBvcHRpb25zOiB0aGlzLm9wdGlvbnMsIGdyb3VwczogdGhpcy5ncm91cHMgfTsKICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ2NoYW5nZScpOwogIH0KCiAgTGluZUdyYXBoLnByb3RvdHlwZSA9IG5ldyBDb21wb25lbnQoKTsKCiAgLyoqCiAgICogQ3JlYXRlIHRoZSBIVE1MIERPTSBmb3IgdGhlIEl0ZW1TZXQKICAgKi8KICBMaW5lR3JhcGgucHJvdG90eXBlLl9jcmVhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGZyYW1lLmNsYXNzTmFtZSA9ICd2aXMtbGluZS1ncmFwaCc7CiAgICB0aGlzLmRvbS5mcmFtZSA9IGZyYW1lOwoKICAgIC8vIGNyZWF0ZSBzdmcgZWxlbWVudCBmb3IgZ3JhcGggZHJhd2luZy4KICAgIHRoaXMuc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTsKICAgIHRoaXMuc3ZnLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsKICAgIHRoaXMuc3ZnLnN0eWxlLmhlaWdodCA9ICgnJyArIHRoaXMub3B0aW9ucy5ncmFwaEhlaWdodCkucmVwbGFjZSgncHgnLCAnJykgKyAncHgnOwogICAgdGhpcy5zdmcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICBmcmFtZS5hcHBlbmRDaGlsZCh0aGlzLnN2Zyk7CgogICAgLy8gZGF0YSBheGlzCiAgICB0aGlzLm9wdGlvbnMuZGF0YUF4aXMub3JpZW50YXRpb24gPSAnbGVmdCc7CiAgICB0aGlzLnlBeGlzTGVmdCA9IG5ldyBEYXRhQXhpcyh0aGlzLmJvZHksIHRoaXMub3B0aW9ucy5kYXRhQXhpcywgdGhpcy5zdmcsIHRoaXMub3B0aW9ucy5ncm91cHMpOwoKICAgIHRoaXMub3B0aW9ucy5kYXRhQXhpcy5vcmllbnRhdGlvbiA9ICdyaWdodCc7CiAgICB0aGlzLnlBeGlzUmlnaHQgPSBuZXcgRGF0YUF4aXModGhpcy5ib2R5LCB0aGlzLm9wdGlvbnMuZGF0YUF4aXMsIHRoaXMuc3ZnLCB0aGlzLm9wdGlvbnMuZ3JvdXBzKTsKICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMuZGF0YUF4aXMub3JpZW50YXRpb247CgogICAgLy8gbGVnZW5kcwogICAgdGhpcy5sZWdlbmRMZWZ0ID0gbmV3IExlZ2VuZCh0aGlzLmJvZHksIHRoaXMub3B0aW9ucy5sZWdlbmQsICdsZWZ0JywgdGhpcy5vcHRpb25zLmdyb3Vwcyk7CiAgICB0aGlzLmxlZ2VuZFJpZ2h0ID0gbmV3IExlZ2VuZCh0aGlzLmJvZHksIHRoaXMub3B0aW9ucy5sZWdlbmQsICdyaWdodCcsIHRoaXMub3B0aW9ucy5ncm91cHMpOwoKICAgIHRoaXMuc2hvdygpOwogIH07CgogIC8qKgogICAqIHNldCB0aGUgb3B0aW9ucyBvZiB0aGUgTGluZUdyYXBoLiB0aGUgbWVyZ2VPcHRpb25zIGlzIHVzZWQgZm9yIHN1Yk9iamVjdHMgdGhhdCBoYXZlIGFuIGVuYWJsZWQgZWxlbWVudC4KICAgKiBAcGFyYW0ge29iamVjdH0gb3B0aW9ucwogICAqLwogIExpbmVHcmFwaC5wcm90b3R5cGUuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICBpZiAob3B0aW9ucykgewogICAgICB2YXIgZmllbGRzID0gWydzYW1wbGluZycsICdkZWZhdWx0R3JvdXAnLCAnc3RhY2snLCAnaGVpZ2h0JywgJ2dyYXBoSGVpZ2h0JywgJ3lBeGlzT3JpZW50YXRpb24nLCAnc3R5bGUnLCAnYmFyQ2hhcnQnLCAnZGF0YUF4aXMnLCAnc29ydCcsICdncm91cHMnXTsKICAgICAgaWYgKG9wdGlvbnMuZ3JhcGhIZWlnaHQgPT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmhlaWdodCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuYm9keS5kb21Qcm9wcy5jZW50ZXJDb250YWluZXIuaGVpZ2h0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLnVwZGF0ZVNWR2hlaWdodCA9IHRydWU7CiAgICAgICAgdGhpcy51cGRhdGVTVkdoZWlnaHRPblJlc2l6ZSA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5ib2R5LmRvbVByb3BzLmNlbnRlckNvbnRhaW5lci5oZWlnaHQgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmdyYXBoSGVpZ2h0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAocGFyc2VJbnQoKG9wdGlvbnMuZ3JhcGhIZWlnaHQgKyAnJykucmVwbGFjZSgncHgnLCAnJykpIDwgdGhpcy5ib2R5LmRvbVByb3BzLmNlbnRlckNvbnRhaW5lci5oZWlnaHQpIHsKICAgICAgICAgIHRoaXMudXBkYXRlU1ZHaGVpZ2h0ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdXRpbC5zZWxlY3RpdmVEZWVwRXh0ZW5kKGZpZWxkcywgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKICAgICAgdXRpbC5tZXJnZU9wdGlvbnModGhpcy5vcHRpb25zLCBvcHRpb25zLCAnaW50ZXJwb2xhdGlvbicpOwogICAgICB1dGlsLm1lcmdlT3B0aW9ucyh0aGlzLm9wdGlvbnMsIG9wdGlvbnMsICdkcmF3UG9pbnRzJyk7CiAgICAgIHV0aWwubWVyZ2VPcHRpb25zKHRoaXMub3B0aW9ucywgb3B0aW9ucywgJ3NoYWRlZCcpOwogICAgICB1dGlsLm1lcmdlT3B0aW9ucyh0aGlzLm9wdGlvbnMsIG9wdGlvbnMsICdsZWdlbmQnKTsKCiAgICAgIGlmIChvcHRpb25zLmludGVycG9sYXRpb24pIHsKICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuaW50ZXJwb2xhdGlvbiA9PSAnb2JqZWN0JykgewogICAgICAgICAgaWYgKG9wdGlvbnMuaW50ZXJwb2xhdGlvbi5wYXJhbWV0cml6YXRpb24pIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuaW50ZXJwb2xhdGlvbi5wYXJhbWV0cml6YXRpb24gPT0gJ3VuaWZvcm0nKSB7CiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24uYWxwaGEgPSAwOwogICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuaW50ZXJwb2xhdGlvbi5wYXJhbWV0cml6YXRpb24gPT0gJ2Nob3JkYWwnKSB7CiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24uYWxwaGEgPSAxOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5pbnRlcnBvbGF0aW9uLnBhcmFtZXRyaXphdGlvbiA9ICdjZW50cmlwZXRhbCc7CiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24uYWxwaGEgPSAwLjU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnlBeGlzTGVmdCkgewogICAgICAgIGlmIChvcHRpb25zLmRhdGFBeGlzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMueUF4aXNMZWZ0LnNldE9wdGlvbnModGhpcy5vcHRpb25zLmRhdGFBeGlzKTsKICAgICAgICAgIHRoaXMueUF4aXNSaWdodC5zZXRPcHRpb25zKHRoaXMub3B0aW9ucy5kYXRhQXhpcyk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5sZWdlbmRMZWZ0KSB7CiAgICAgICAgaWYgKG9wdGlvbnMubGVnZW5kICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMubGVnZW5kTGVmdC5zZXRPcHRpb25zKHRoaXMub3B0aW9ucy5sZWdlbmQpOwogICAgICAgICAgdGhpcy5sZWdlbmRSaWdodC5zZXRPcHRpb25zKHRoaXMub3B0aW9ucy5sZWdlbmQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KFVOR1JPVVBFRCkpIHsKICAgICAgICB0aGlzLmdyb3Vwc1tVTkdST1VQRURdLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICAgIH0KICAgIH0KCiAgICAvLyB0aGlzIGlzIHVzZWQgdG8gcmVkcmF3IHRoZSBncmFwaCBpZiB0aGUgdmlzaWJpbGl0eSBvZiB0aGUgZ3JvdXBzIGlzIGNoYW5nZWQuCiAgICBpZiAodGhpcy5kb20uZnJhbWUpIHsKICAgICAgdGhpcy5yZWRyYXcodHJ1ZSk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogSGlkZSB0aGUgY29tcG9uZW50IGZyb20gdGhlIERPTQogICAqLwogIExpbmVHcmFwaC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIHJlbW92ZSB0aGUgZnJhbWUgY29udGFpbmluZyB0aGUgaXRlbXMKICAgIGlmICh0aGlzLmRvbS5mcmFtZS5wYXJlbnROb2RlKSB7CiAgICAgIHRoaXMuZG9tLmZyYW1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5kb20uZnJhbWUpOwogICAgfQogIH07CgogIC8qKgogICAqIFNob3cgdGhlIGNvbXBvbmVudCBpbiB0aGUgRE9NICh3aGVuIG5vdCBhbHJlYWR5IHZpc2libGUpLgogICAqIEByZXR1cm4ge0Jvb2xlYW59IGNoYW5nZWQKICAgKi8KICBMaW5lR3JhcGgucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbiAoKSB7CiAgICAvLyBzaG93IGZyYW1lIGNvbnRhaW5pbmcgdGhlIGl0ZW1zCiAgICBpZiAoIXRoaXMuZG9tLmZyYW1lLnBhcmVudE5vZGUpIHsKICAgICAgdGhpcy5ib2R5LmRvbS5jZW50ZXIuYXBwZW5kQ2hpbGQodGhpcy5kb20uZnJhbWUpOwogICAgfQogIH07CgogIC8qKgogICAqIFNldCBpdGVtcwogICAqIEBwYXJhbSB7dmlzLkRhdGFTZXQgfCBudWxsfSBpdGVtcwogICAqLwogIExpbmVHcmFwaC5wcm90b3R5cGUuc2V0SXRlbXMgPSBmdW5jdGlvbiAoaXRlbXMpIHsKICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgaWRzLAogICAgICAgIG9sZEl0ZW1zRGF0YSA9IHRoaXMuaXRlbXNEYXRhOwoKICAgIC8vIHJlcGxhY2UgdGhlIGRhdGFzZXQKICAgIGlmICghaXRlbXMpIHsKICAgICAgdGhpcy5pdGVtc0RhdGEgPSBudWxsOwogICAgfSBlbHNlIGlmIChpdGVtcyBpbnN0YW5jZW9mIERhdGFTZXQgfHwgaXRlbXMgaW5zdGFuY2VvZiBEYXRhVmlldykgewogICAgICB0aGlzLml0ZW1zRGF0YSA9IGl0ZW1zOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRGF0YSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIERhdGFTZXQgb3IgRGF0YVZpZXcnKTsKICAgIH0KCiAgICBpZiAob2xkSXRlbXNEYXRhKSB7CiAgICAgIC8vIHVuc3Vic2NyaWJlIGZyb20gb2xkIGRhdGFzZXQKICAgICAgdXRpbC5mb3JFYWNoKHRoaXMuaXRlbUxpc3RlbmVycywgZnVuY3Rpb24gKGNhbGxiYWNrLCBldmVudCkgewogICAgICAgIG9sZEl0ZW1zRGF0YS5vZmYoZXZlbnQsIGNhbGxiYWNrKTsKICAgICAgfSk7CgogICAgICAvLyByZW1vdmUgYWxsIGRyYXduIGl0ZW1zCiAgICAgIGlkcyA9IG9sZEl0ZW1zRGF0YS5nZXRJZHMoKTsKICAgICAgdGhpcy5fb25SZW1vdmUoaWRzKTsKICAgIH0KCiAgICBpZiAodGhpcy5pdGVtc0RhdGEpIHsKICAgICAgLy8gc3Vic2NyaWJlIHRvIG5ldyBkYXRhc2V0CiAgICAgIHZhciBpZCA9IHRoaXMuaWQ7CiAgICAgIHV0aWwuZm9yRWFjaCh0aGlzLml0ZW1MaXN0ZW5lcnMsIGZ1bmN0aW9uIChjYWxsYmFjaywgZXZlbnQpIHsKICAgICAgICBtZS5pdGVtc0RhdGEub24oZXZlbnQsIGNhbGxiYWNrLCBpZCk7CiAgICAgIH0pOwoKICAgICAgLy8gYWRkIGFsbCBuZXcgaXRlbXMKICAgICAgaWRzID0gdGhpcy5pdGVtc0RhdGEuZ2V0SWRzKCk7CiAgICAgIHRoaXMuX29uQWRkKGlkcyk7CiAgICB9CiAgICB0aGlzLl91cGRhdGVVbmdyb3VwZWQoKTsKICAgIC8vdGhpcy5fdXBkYXRlR3JhcGgoKTsKICAgIHRoaXMucmVkcmF3KHRydWUpOwogIH07CgogIC8qKgogICAqIFNldCBncm91cHMKICAgKiBAcGFyYW0ge3Zpcy5EYXRhU2V0fSBncm91cHMKICAgKi8KICBMaW5lR3JhcGgucHJvdG90eXBlLnNldEdyb3VwcyA9IGZ1bmN0aW9uIChncm91cHMpIHsKICAgIHZhciBtZSA9IHRoaXM7CiAgICB2YXIgaWRzOwoKICAgIC8vIHVuc3Vic2NyaWJlIGZyb20gY3VycmVudCBkYXRhc2V0CiAgICBpZiAodGhpcy5ncm91cHNEYXRhKSB7CiAgICAgIHV0aWwuZm9yRWFjaCh0aGlzLmdyb3VwTGlzdGVuZXJzLCBmdW5jdGlvbiAoY2FsbGJhY2ssIGV2ZW50KSB7CiAgICAgICAgbWUuZ3JvdXBzRGF0YS5vZmYoZXZlbnQsIGNhbGxiYWNrKTsKICAgICAgfSk7CgogICAgICAvLyByZW1vdmUgYWxsIGRyYXduIGdyb3VwcwogICAgICBpZHMgPSB0aGlzLmdyb3Vwc0RhdGEuZ2V0SWRzKCk7CiAgICAgIHRoaXMuZ3JvdXBzRGF0YSA9IG51bGw7CiAgICAgIHRoaXMuX29uUmVtb3ZlR3JvdXBzKGlkcyk7IC8vIG5vdGU6IHRoaXMgd2lsbCBjYXVzZSBhIHJlZHJhdwogICAgfQoKICAgIC8vIHJlcGxhY2UgdGhlIGRhdGFzZXQKICAgIGlmICghZ3JvdXBzKSB7CiAgICAgIHRoaXMuZ3JvdXBzRGF0YSA9IG51bGw7CiAgICB9IGVsc2UgaWYgKGdyb3VwcyBpbnN0YW5jZW9mIERhdGFTZXQgfHwgZ3JvdXBzIGluc3RhbmNlb2YgRGF0YVZpZXcpIHsKICAgICAgdGhpcy5ncm91cHNEYXRhID0gZ3JvdXBzOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignRGF0YSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIERhdGFTZXQgb3IgRGF0YVZpZXcnKTsKICAgIH0KCiAgICBpZiAodGhpcy5ncm91cHNEYXRhKSB7CiAgICAgIC8vIHN1YnNjcmliZSB0byBuZXcgZGF0YXNldAogICAgICB2YXIgaWQgPSB0aGlzLmlkOwogICAgICB1dGlsLmZvckVhY2godGhpcy5ncm91cExpc3RlbmVycywgZnVuY3Rpb24gKGNhbGxiYWNrLCBldmVudCkgewogICAgICAgIG1lLmdyb3Vwc0RhdGEub24oZXZlbnQsIGNhbGxiYWNrLCBpZCk7CiAgICAgIH0pOwoKICAgICAgLy8gZHJhdyBhbGwgbXMKICAgICAgaWRzID0gdGhpcy5ncm91cHNEYXRhLmdldElkcygpOwogICAgICB0aGlzLl9vbkFkZEdyb3VwcyhpZHMpOwogICAgfQogICAgdGhpcy5fb25VcGRhdGUoKTsKICB9OwoKICAvKioKICAgKiBVcGRhdGUgdGhlIGRhdGEKICAgKiBAcGFyYW0gW2lkc10KICAgKiBAcHJpdmF0ZQogICAqLwogIExpbmVHcmFwaC5wcm90b3R5cGUuX29uVXBkYXRlID0gZnVuY3Rpb24gKGlkcykgewogICAgdGhpcy5fdXBkYXRlVW5ncm91cGVkKCk7CiAgICB0aGlzLl91cGRhdGVBbGxHcm91cERhdGEoKTsKICAgIC8vdGhpcy5fdXBkYXRlR3JhcGgoKTsKICAgIHRoaXMucmVkcmF3KHRydWUpOwogIH07CiAgTGluZUdyYXBoLnByb3RvdHlwZS5fb25BZGQgPSBmdW5jdGlvbiAoaWRzKSB7CiAgICB0aGlzLl9vblVwZGF0ZShpZHMpOwogIH07CiAgTGluZUdyYXBoLnByb3RvdHlwZS5fb25SZW1vdmUgPSBmdW5jdGlvbiAoaWRzKSB7CiAgICB0aGlzLl9vblVwZGF0ZShpZHMpOwogIH07CiAgTGluZUdyYXBoLnByb3RvdHlwZS5fb25VcGRhdGVHcm91cHMgPSBmdW5jdGlvbiAoZ3JvdXBJZHMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGdyb3VwID0gdGhpcy5ncm91cHNEYXRhLmdldChncm91cElkc1tpXSk7CiAgICAgIHRoaXMuX3VwZGF0ZUdyb3VwKGdyb3VwLCBncm91cElkc1tpXSk7CiAgICB9CgogICAgLy90aGlzLl91cGRhdGVHcmFwaCgpOwogICAgdGhpcy5yZWRyYXcodHJ1ZSk7CiAgfTsKICBMaW5lR3JhcGgucHJvdG90eXBlLl9vbkFkZEdyb3VwcyA9IGZ1bmN0aW9uIChncm91cElkcykgewogICAgdGhpcy5fb25VcGRhdGVHcm91cHMoZ3JvdXBJZHMpOwogIH07CgogIC8qKgogICAqIHRoaXMgY2xlYW5zIHRoZSBncm91cCBvdXQgb2ZmIHRoZSBsZWdlbmRzIGFuZCB0aGUgZGF0YWF4aXMsIHVwZGF0ZXMgdGhlIHVuZ3JvdXBlZCBhbmQgdXBkYXRlcyB0aGUgZ3JhcGgKICAgKiBAcGFyYW0ge0FycmF5fSBncm91cElkcwogICAqIEBwcml2YXRlCiAgICovCiAgTGluZUdyYXBoLnByb3RvdHlwZS5fb25SZW1vdmVHcm91cHMgPSBmdW5jdGlvbiAoZ3JvdXBJZHMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KGdyb3VwSWRzW2ldKSkgewogICAgICAgIGlmICh0aGlzLmdyb3Vwc1tncm91cElkc1tpXV0ub3B0aW9ucy55QXhpc09yaWVudGF0aW9uID09ICdyaWdodCcpIHsKICAgICAgICAgIHRoaXMueUF4aXNSaWdodC5yZW1vdmVHcm91cChncm91cElkc1tpXSk7CiAgICAgICAgICB0aGlzLmxlZ2VuZFJpZ2h0LnJlbW92ZUdyb3VwKGdyb3VwSWRzW2ldKTsKICAgICAgICAgIHRoaXMubGVnZW5kUmlnaHQucmVkcmF3KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMueUF4aXNMZWZ0LnJlbW92ZUdyb3VwKGdyb3VwSWRzW2ldKTsKICAgICAgICAgIHRoaXMubGVnZW5kTGVmdC5yZW1vdmVHcm91cChncm91cElkc1tpXSk7CiAgICAgICAgICB0aGlzLmxlZ2VuZExlZnQucmVkcmF3KCk7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSB0aGlzLmdyb3Vwc1tncm91cElkc1tpXV07CiAgICAgIH0KICAgIH0KICAgIHRoaXMuX3VwZGF0ZVVuZ3JvdXBlZCgpOwogICAgLy90aGlzLl91cGRhdGVHcmFwaCgpOwogICAgdGhpcy5yZWRyYXcodHJ1ZSk7CiAgfTsKCiAgLyoqCiAgICogdXBkYXRlIGEgZ3JvdXAgb2JqZWN0IHdpdGggdGhlIGdyb3VwIGRhdGFzZXQgZW50cmVlCiAgICoKICAgKiBAcGFyYW0gZ3JvdXAKICAgKiBAcGFyYW0gZ3JvdXBJZAogICAqIEBwcml2YXRlCiAgICovCiAgTGluZUdyYXBoLnByb3RvdHlwZS5fdXBkYXRlR3JvdXAgPSBmdW5jdGlvbiAoZ3JvdXAsIGdyb3VwSWQpIHsKICAgIGlmICghdGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkoZ3JvdXBJZCkpIHsKICAgICAgdGhpcy5ncm91cHNbZ3JvdXBJZF0gPSBuZXcgR3JhcGhHcm91cChncm91cCwgZ3JvdXBJZCwgdGhpcy5vcHRpb25zLCB0aGlzLmdyb3Vwc1VzaW5nRGVmYXVsdFN0eWxlcyk7CiAgICAgIGlmICh0aGlzLmdyb3Vwc1tncm91cElkXS5vcHRpb25zLnlBeGlzT3JpZW50YXRpb24gPT0gJ3JpZ2h0JykgewogICAgICAgIHRoaXMueUF4aXNSaWdodC5hZGRHcm91cChncm91cElkLCB0aGlzLmdyb3Vwc1tncm91cElkXSk7CiAgICAgICAgdGhpcy5sZWdlbmRSaWdodC5hZGRHcm91cChncm91cElkLCB0aGlzLmdyb3Vwc1tncm91cElkXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy55QXhpc0xlZnQuYWRkR3JvdXAoZ3JvdXBJZCwgdGhpcy5ncm91cHNbZ3JvdXBJZF0pOwogICAgICAgIHRoaXMubGVnZW5kTGVmdC5hZGRHcm91cChncm91cElkLCB0aGlzLmdyb3Vwc1tncm91cElkXSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwSWRdLnVwZGF0ZShncm91cCk7CiAgICAgIGlmICh0aGlzLmdyb3Vwc1tncm91cElkXS5vcHRpb25zLnlBeGlzT3JpZW50YXRpb24gPT0gJ3JpZ2h0JykgewogICAgICAgIHRoaXMueUF4aXNSaWdodC51cGRhdGVHcm91cChncm91cElkLCB0aGlzLmdyb3Vwc1tncm91cElkXSk7CiAgICAgICAgdGhpcy5sZWdlbmRSaWdodC51cGRhdGVHcm91cChncm91cElkLCB0aGlzLmdyb3Vwc1tncm91cElkXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy55QXhpc0xlZnQudXBkYXRlR3JvdXAoZ3JvdXBJZCwgdGhpcy5ncm91cHNbZ3JvdXBJZF0pOwogICAgICAgIHRoaXMubGVnZW5kTGVmdC51cGRhdGVHcm91cChncm91cElkLCB0aGlzLmdyb3Vwc1tncm91cElkXSk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMubGVnZW5kTGVmdC5yZWRyYXcoKTsKICAgIHRoaXMubGVnZW5kUmlnaHQucmVkcmF3KCk7CiAgfTsKCiAgLyoqCiAgICogdGhpcyB1cGRhdGVzIGFsbCBncm91cHMsIGl0IGlzIHVzZWQgd2hlbiB0aGVyZSBpcyBhbiB1cGRhdGUgdGhlIHRoZSBpdGVtc2V0LgogICAqCiAgICogQHByaXZhdGUKICAgKi8KICBMaW5lR3JhcGgucHJvdG90eXBlLl91cGRhdGVBbGxHcm91cERhdGEgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5pdGVtc0RhdGEgIT0gbnVsbCkgewogICAgICB2YXIgZ3JvdXBzQ29udGVudCA9IHt9OwogICAgICB2YXIgZ3JvdXBJZDsKICAgICAgZm9yIChncm91cElkIGluIHRoaXMuZ3JvdXBzKSB7CiAgICAgICAgaWYgKHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KGdyb3VwSWQpKSB7CiAgICAgICAgICBncm91cHNDb250ZW50W2dyb3VwSWRdID0gW107CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAodmFyIGl0ZW1JZCBpbiB0aGlzLml0ZW1zRGF0YS5fZGF0YSkgewogICAgICAgIGlmICh0aGlzLml0ZW1zRGF0YS5fZGF0YS5oYXNPd25Qcm9wZXJ0eShpdGVtSWQpKSB7CiAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMuaXRlbXNEYXRhLl9kYXRhW2l0ZW1JZF07CiAgICAgICAgICBpZiAoZ3JvdXBzQ29udGVudFtpdGVtLmdyb3VwXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGZpbmQgcmVmZXJlbmNlZCBncm91cC4gUG9zc2libGUgcmVhc29uOiBpdGVtcyBhZGRlZCBiZWZvcmUgZ3JvdXBzPyBHcm91cHMgbmVlZCB0byBiZSBhZGRlZCBiZWZvcmUgaXRlbXMsIGFzIGl0ZW1zIHJlZmVyIHRvIGdyb3Vwcy4nKTsKICAgICAgICAgIH0KICAgICAgICAgIGl0ZW0ueCA9IHV0aWwuY29udmVydChpdGVtLngsICdEYXRlJyk7CiAgICAgICAgICBncm91cHNDb250ZW50W2l0ZW0uZ3JvdXBdLnB1c2goaXRlbSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvciAoZ3JvdXBJZCBpbiB0aGlzLmdyb3VwcykgewogICAgICAgIGlmICh0aGlzLmdyb3Vwcy5oYXNPd25Qcm9wZXJ0eShncm91cElkKSkgewogICAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBJZF0uc2V0SXRlbXMoZ3JvdXBzQ29udGVudFtncm91cElkXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlIG9yIGRlbGV0ZSB0aGUgZ3JvdXAgaG9sZGluZyBhbGwgdW5ncm91cGVkIGl0ZW1zLiBUaGlzIGdyb3VwIGlzIHVzZWQgd2hlbgogICAqIHRoZXJlIGFyZSBubyBncm91cHMgc3BlY2lmaWVkLiBUaGlzIGFub255bW91cyBncm91cCBpcyBjYWxsZWQgJ2dyYXBoJy4KICAgKiBAcHJvdGVjdGVkCiAgICovCiAgTGluZUdyYXBoLnByb3RvdHlwZS5fdXBkYXRlVW5ncm91cGVkID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMuaXRlbXNEYXRhICYmIHRoaXMuaXRlbXNEYXRhICE9IG51bGwpIHsKICAgICAgdmFyIHVuZ3JvdXBlZENvdW50ZXIgPSAwOwogICAgICBmb3IgKHZhciBpdGVtSWQgaW4gdGhpcy5pdGVtc0RhdGEuX2RhdGEpIHsKICAgICAgICBpZiAodGhpcy5pdGVtc0RhdGEuX2RhdGEuaGFzT3duUHJvcGVydHkoaXRlbUlkKSkgewogICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLml0ZW1zRGF0YS5fZGF0YVtpdGVtSWRdOwogICAgICAgICAgaWYgKGl0ZW0gIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGlmIChpdGVtLmhhc093blByb3BlcnR5KCdncm91cCcpKSB7CiAgICAgICAgICAgICAgaWYgKGl0ZW0uZ3JvdXAgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgaXRlbS5ncm91cCA9IFVOR1JPVVBFRDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaXRlbS5ncm91cCA9IFVOR1JPVVBFRDsKICAgICAgICAgICAgfQogICAgICAgICAgICB1bmdyb3VwZWRDb3VudGVyID0gaXRlbS5ncm91cCA9PSBVTkdST1VQRUQgPyB1bmdyb3VwZWRDb3VudGVyICsgMSA6IHVuZ3JvdXBlZENvdW50ZXI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodW5ncm91cGVkQ291bnRlciA9PSAwKSB7CiAgICAgICAgZGVsZXRlIHRoaXMuZ3JvdXBzW1VOR1JPVVBFRF07CiAgICAgICAgdGhpcy5sZWdlbmRMZWZ0LnJlbW92ZUdyb3VwKFVOR1JPVVBFRCk7CiAgICAgICAgdGhpcy5sZWdlbmRSaWdodC5yZW1vdmVHcm91cChVTkdST1VQRUQpOwogICAgICAgIHRoaXMueUF4aXNMZWZ0LnJlbW92ZUdyb3VwKFVOR1JPVVBFRCk7CiAgICAgICAgdGhpcy55QXhpc1JpZ2h0LnJlbW92ZUdyb3VwKFVOR1JPVVBFRCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGdyb3VwID0geyBpZDogVU5HUk9VUEVELCBjb250ZW50OiB0aGlzLm9wdGlvbnMuZGVmYXVsdEdyb3VwIH07CiAgICAgICAgdGhpcy5fdXBkYXRlR3JvdXAoZ3JvdXAsIFVOR1JPVVBFRCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGRlbGV0ZSB0aGlzLmdyb3Vwc1tVTkdST1VQRURdOwogICAgICB0aGlzLmxlZ2VuZExlZnQucmVtb3ZlR3JvdXAoVU5HUk9VUEVEKTsKICAgICAgdGhpcy5sZWdlbmRSaWdodC5yZW1vdmVHcm91cChVTkdST1VQRUQpOwogICAgICB0aGlzLnlBeGlzTGVmdC5yZW1vdmVHcm91cChVTkdST1VQRUQpOwogICAgICB0aGlzLnlBeGlzUmlnaHQucmVtb3ZlR3JvdXAoVU5HUk9VUEVEKTsKICAgIH0KCiAgICB0aGlzLmxlZ2VuZExlZnQucmVkcmF3KCk7CiAgICB0aGlzLmxlZ2VuZFJpZ2h0LnJlZHJhdygpOwogIH07CgogIC8qKgogICAqIFJlZHJhdyB0aGUgY29tcG9uZW50LCBtYW5kYXRvcnkgZnVuY3Rpb24KICAgKiBAcmV0dXJuIHtib29sZWFufSBSZXR1cm5zIHRydWUgaWYgdGhlIGNvbXBvbmVudCBpcyByZXNpemVkCiAgICovCiAgTGluZUdyYXBoLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoZm9yY2VHcmFwaFVwZGF0ZSkgewogICAgdmFyIHJlc2l6ZWQgPSBmYWxzZTsKCiAgICAvLyBjYWxjdWxhdGUgYWN0dWFsIHNpemUgYW5kIHBvc2l0aW9uCiAgICB0aGlzLnByb3BzLndpZHRoID0gdGhpcy5kb20uZnJhbWUub2Zmc2V0V2lkdGg7CiAgICB0aGlzLnByb3BzLmhlaWdodCA9IHRoaXMuYm9keS5kb21Qcm9wcy5jZW50ZXJDb250YWluZXIuaGVpZ2h0IC0gdGhpcy5ib2R5LmRvbVByb3BzLmJvcmRlci50b3AgLSB0aGlzLmJvZHkuZG9tUHJvcHMuYm9yZGVyLmJvdHRvbTsKCiAgICAvLyB1cGRhdGUgdGhlIGdyYXBoIGlmIHRoZXJlIGlzIG5vIGxhc3RXaWR0aCBvciB3aXRoLCB1c2VkIGZvciB0aGUgaW5pdGlhbCBkcmF3CiAgICBpZiAodGhpcy5sYXN0V2lkdGggPT09IHVuZGVmaW5lZCAmJiB0aGlzLnByb3BzLndpZHRoKSB7CiAgICAgIGZvcmNlR3JhcGhVcGRhdGUgPSB0cnVlOwogICAgfQoKICAgIC8vIGNoZWNrIGlmIHRoaXMgY29tcG9uZW50IGlzIHJlc2l6ZWQKICAgIHJlc2l6ZWQgPSB0aGlzLl9pc1Jlc2l6ZWQoKSB8fCByZXNpemVkOwoKICAgIC8vIGNoZWNrIHdoZXRoZXIgem9vbWVkIChpbiB0aGF0IGNhc2Ugd2UgbmVlZCB0byByZS1zdGFjayBldmVyeXRoaW5nKQogICAgdmFyIHZpc2libGVJbnRlcnZhbCA9IHRoaXMuYm9keS5yYW5nZS5lbmQgLSB0aGlzLmJvZHkucmFuZ2Uuc3RhcnQ7CiAgICB2YXIgem9vbWVkID0gdmlzaWJsZUludGVydmFsICE9IHRoaXMubGFzdFZpc2libGVJbnRlcnZhbDsKICAgIHRoaXMubGFzdFZpc2libGVJbnRlcnZhbCA9IHZpc2libGVJbnRlcnZhbDsKCiAgICAvLyB0aGUgc3ZnIGVsZW1lbnQgaXMgdGhyZWUgdGltZXMgYXMgYmlnIGFzIHRoZSB3aWR0aCwgdGhpcyBhbGxvd3MgZm9yIGZ1bGx5IGRyYWdnaW5nIGxlZnQgYW5kIHJpZ2h0CiAgICAvLyB3aXRob3V0IHJlbG9hZGluZyB0aGUgZ3JhcGguIHRoZSBjb250cm9scyBmb3IgdGhpcyBhcmUgYm91bmQgdG8gZXZlbnRzIGluIHRoZSBjb25zdHJ1Y3RvcgogICAgaWYgKHJlc2l6ZWQgPT0gdHJ1ZSkgewogICAgICB0aGlzLnN2Zy5zdHlsZS53aWR0aCA9IHV0aWwub3B0aW9uLmFzU2l6ZSgzICogdGhpcy5wcm9wcy53aWR0aCk7CiAgICAgIHRoaXMuc3ZnLnN0eWxlLmxlZnQgPSB1dGlsLm9wdGlvbi5hc1NpemUoLXRoaXMucHJvcHMud2lkdGgpOwoKICAgICAgLy8gaWYgdGhlIGhlaWdodCBvZiB0aGUgZ3JhcGggaXMgc2V0IGFzIHByb3BvcnRpb25hbCwgY2hhbmdlIHRoZSBoZWlnaHQgb2YgdGhlIHN2ZwogICAgICBpZiAoKHRoaXMub3B0aW9ucy5oZWlnaHQgKyAnJykuaW5kZXhPZignJScpICE9IC0xIHx8IHRoaXMudXBkYXRlU1ZHaGVpZ2h0T25SZXNpemUgPT0gdHJ1ZSkgewogICAgICAgIHRoaXMudXBkYXRlU1ZHaGVpZ2h0ID0gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIC8vIHVwZGF0ZSB0aGUgaGVpZ2h0IG9mIHRoZSBncmFwaCBvbiBlYWNoIHJlZHJhdyBvZiB0aGUgZ3JhcGguCiAgICBpZiAodGhpcy51cGRhdGVTVkdoZWlnaHQgPT0gdHJ1ZSkgewogICAgICBpZiAodGhpcy5vcHRpb25zLmdyYXBoSGVpZ2h0ICE9IHRoaXMucHJvcHMuaGVpZ2h0ICsgJ3B4JykgewogICAgICAgIHRoaXMub3B0aW9ucy5ncmFwaEhlaWdodCA9IHRoaXMucHJvcHMuaGVpZ2h0ICsgJ3B4JzsKICAgICAgICB0aGlzLnN2Zy5zdHlsZS5oZWlnaHQgPSB0aGlzLnByb3BzLmhlaWdodCArICdweCc7CiAgICAgIH0KICAgICAgdGhpcy51cGRhdGVTVkdoZWlnaHQgPSBmYWxzZTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuc3ZnLnN0eWxlLmhlaWdodCA9ICgnJyArIHRoaXMub3B0aW9ucy5ncmFwaEhlaWdodCkucmVwbGFjZSgncHgnLCAnJykgKyAncHgnOwogICAgfQoKICAgIC8vIHpvb21lZCBpcyBoZXJlIHRvIGVuc3VyZSB0aGF0IGFuaW1hdGlvbnMgYXJlIHNob3duIGNvcnJlY3RseS4KICAgIGlmIChyZXNpemVkID09IHRydWUgfHwgem9vbWVkID09IHRydWUgfHwgdGhpcy5hYm9ydGVkR3JhcGhVcGRhdGUgPT0gdHJ1ZSB8fCBmb3JjZUdyYXBoVXBkYXRlID09IHRydWUpIHsKICAgICAgcmVzaXplZCA9IHRoaXMuX3VwZGF0ZUdyYXBoKCkgfHwgcmVzaXplZDsKICAgIH0gZWxzZSB7CiAgICAgIC8vIG1vdmUgdGhlIHdob2xlIHN2ZyB3aGlsZSBkcmFnZ2luZwogICAgICBpZiAodGhpcy5sYXN0U3RhcnQgIT0gMCkgewogICAgICAgIHZhciBvZmZzZXQgPSB0aGlzLmJvZHkucmFuZ2Uuc3RhcnQgLSB0aGlzLmxhc3RTdGFydDsKICAgICAgICB2YXIgcmFuZ2UgPSB0aGlzLmJvZHkucmFuZ2UuZW5kIC0gdGhpcy5ib2R5LnJhbmdlLnN0YXJ0OwogICAgICAgIGlmICh0aGlzLnByb3BzLndpZHRoICE9IDApIHsKICAgICAgICAgIHZhciByYW5nZVBlclBpeGVsSW52ID0gdGhpcy5wcm9wcy53aWR0aCAvIHJhbmdlOwogICAgICAgICAgdmFyIHhPZmZzZXQgPSBvZmZzZXQgKiByYW5nZVBlclBpeGVsSW52OwogICAgICAgICAgdGhpcy5zdmcuc3R5bGUubGVmdCA9IC10aGlzLnByb3BzLndpZHRoIC0geE9mZnNldCArICdweCc7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdGhpcy5sZWdlbmRMZWZ0LnJlZHJhdygpOwogICAgdGhpcy5sZWdlbmRSaWdodC5yZWRyYXcoKTsKICAgIHJldHVybiByZXNpemVkOwogIH07CgogIC8qKgogICAqIFVwZGF0ZSBhbmQgcmVkcmF3IHRoZSBncmFwaC4KICAgKgogICAqLwogIExpbmVHcmFwaC5wcm90b3R5cGUuX3VwZGF0ZUdyYXBoID0gZnVuY3Rpb24gKCkgewogICAgLy8gcmVzZXQgdGhlIHN2ZyBlbGVtZW50cwogICAgRE9NdXRpbC5wcmVwYXJlRWxlbWVudHModGhpcy5zdmdFbGVtZW50cyk7CiAgICBpZiAodGhpcy5wcm9wcy53aWR0aCAhPSAwICYmIHRoaXMuaXRlbXNEYXRhICE9IG51bGwpIHsKICAgICAgdmFyIGdyb3VwLCBpOwogICAgICB2YXIgcHJlcHJvY2Vzc2VkR3JvdXBEYXRhID0ge307CiAgICAgIHZhciBwcm9jZXNzZWRHcm91cERhdGEgPSB7fTsKICAgICAgdmFyIGdyb3VwUmFuZ2VzID0ge307CiAgICAgIHZhciBjaGFuZ2VDYWxsZWQgPSBmYWxzZTsKCiAgICAgIC8vIGdldHRpbmcgZ3JvdXAgSWRzCiAgICAgIHZhciBncm91cElkcyA9IFtdOwogICAgICBmb3IgKHZhciBncm91cElkIGluIHRoaXMuZ3JvdXBzKSB7CiAgICAgICAgaWYgKHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KGdyb3VwSWQpKSB7CiAgICAgICAgICBncm91cCA9IHRoaXMuZ3JvdXBzW2dyb3VwSWRdOwogICAgICAgICAgaWYgKGdyb3VwLnZpc2libGUgPT0gdHJ1ZSAmJiAodGhpcy5vcHRpb25zLmdyb3Vwcy52aXNpYmlsaXR5W2dyb3VwSWRdID09PSB1bmRlZmluZWQgfHwgdGhpcy5vcHRpb25zLmdyb3Vwcy52aXNpYmlsaXR5W2dyb3VwSWRdID09IHRydWUpKSB7CiAgICAgICAgICAgIGdyb3VwSWRzLnB1c2goZ3JvdXBJZCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChncm91cElkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgLy8gdGhpcyBpcyB0aGUgcmFuZ2Ugb2YgdGhlIFNWRyBjYW52YXMKICAgICAgICB2YXIgbWluRGF0ZSA9IHRoaXMuYm9keS51dGlsLnRvR2xvYmFsVGltZSgtdGhpcy5ib2R5LmRvbVByb3BzLnJvb3Qud2lkdGgpOwogICAgICAgIHZhciBtYXhEYXRlID0gdGhpcy5ib2R5LnV0aWwudG9HbG9iYWxUaW1lKDIgKiB0aGlzLmJvZHkuZG9tUHJvcHMucm9vdC53aWR0aCk7CiAgICAgICAgdmFyIGdyb3Vwc0RhdGEgPSB7fTsKICAgICAgICAvLyBmaWxsIGdyb3VwcyBkYXRhLCB0aGlzIG9ubHkgbG9hZHMgdGhlIGRhdGEgd2UgcmVxdWlyZSBiYXNlZCBvbiB0aGUgdGltZXdpbmRvdwogICAgICAgIHRoaXMuX2dldFJlbGV2YW50RGF0YShncm91cElkcywgZ3JvdXBzRGF0YSwgbWluRGF0ZSwgbWF4RGF0ZSk7CgogICAgICAgIC8vIGFwcGx5IHNhbXBsaW5nLCBpZiBkaXNhYmxlZCwgaXQgd2lsbCBwYXNzIHRocm91Z2ggdGhpcyBmdW5jdGlvbi4KICAgICAgICB0aGlzLl9hcHBseVNhbXBsaW5nKGdyb3VwSWRzLCBncm91cHNEYXRhKTsKCiAgICAgICAgLy8gd2UgdHJhbnNmb3JtIHRoZSBYIGNvb3JkaW5hdGVzIHRvIGRldGVjdCBjb2xsaXNpb25zCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGdyb3VwSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBwcmVwcm9jZXNzZWRHcm91cERhdGFbZ3JvdXBJZHNbaV1dID0gdGhpcy5fY29udmVydFhjb29yZGluYXRlcyhncm91cHNEYXRhW2dyb3VwSWRzW2ldXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBub3cgYWxsIG5lZWRlZCBkYXRhIGhhcyBiZWVuIGNvbGxlY3RlZCB3ZSBzdGFydCB0aGUgcHJvY2Vzc2luZy4KICAgICAgICB0aGlzLl9nZXRZUmFuZ2VzKGdyb3VwSWRzLCBwcmVwcm9jZXNzZWRHcm91cERhdGEsIGdyb3VwUmFuZ2VzKTsKCiAgICAgICAgLy8gdXBkYXRlIHRoZSBZIGF4aXMgZmlyc3QsIHdlIHVzZSB0aGlzIGRhdGEgdG8gZHJhdyBhdCB0aGUgY29ycmVjdCBZIHBvaW50cwogICAgICAgIC8vIGNoYW5nZUNhbGxlZCBpcyByZXF1aXJlZCB0byBjbGVhbiB0aGUgU1ZHIG9uIGEgY2hhbmdlIGVtaXQuCiAgICAgICAgY2hhbmdlQ2FsbGVkID0gdGhpcy5fdXBkYXRlWUF4aXMoZ3JvdXBJZHMsIGdyb3VwUmFuZ2VzKTsKICAgICAgICB2YXIgTUFYX0NZQ0xFUyA9IDU7CiAgICAgICAgaWYgKGNoYW5nZUNhbGxlZCA9PSB0cnVlICYmIHRoaXMuQ09VTlRFUiA8IE1BWF9DWUNMRVMpIHsKICAgICAgICAgIERPTXV0aWwuY2xlYW51cEVsZW1lbnRzKHRoaXMuc3ZnRWxlbWVudHMpOwogICAgICAgICAgdGhpcy5hYm9ydGVkR3JhcGhVcGRhdGUgPSB0cnVlOwogICAgICAgICAgdGhpcy5DT1VOVEVSKys7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdjaGFuZ2UnKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5DT1VOVEVSID4gTUFYX0NZQ0xFUykgewogICAgICAgICAgICBjb25zb2xlLmxvZygnV0FSTklORzogdGhlcmUgbWF5IGJlIGFuIGluZmluaXRlIGxvb3AgaW4gdGhlIF91cGRhdGVHcmFwaCBlbWl0dGVyIGN5Y2xlLicpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5DT1VOVEVSID0gMDsKICAgICAgICAgIHRoaXMuYWJvcnRlZEdyYXBoVXBkYXRlID0gZmFsc2U7CgogICAgICAgICAgLy8gV2l0aCB0aGUgeUF4aXMgc2NhbGVkIGNvcnJlY3RseSwgdXNlIHRoaXMgdG8gZ2V0IHRoZSBZIHZhbHVlcyBvZiB0aGUgcG9pbnRzLgogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGdyb3VwSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGdyb3VwID0gdGhpcy5ncm91cHNbZ3JvdXBJZHNbaV1dOwogICAgICAgICAgICBwcm9jZXNzZWRHcm91cERhdGFbZ3JvdXBJZHNbaV1dID0gdGhpcy5fY29udmVydFljb29yZGluYXRlcyhncm91cHNEYXRhW2dyb3VwSWRzW2ldXSwgZ3JvdXApOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIGRyYXcgdGhlIGdyb3VwcwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGdyb3VwSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGdyb3VwID0gdGhpcy5ncm91cHNbZ3JvdXBJZHNbaV1dOwogICAgICAgICAgICBpZiAoZ3JvdXAub3B0aW9ucy5zdHlsZSAhPSAnYmFyJykgewogICAgICAgICAgICAgIC8vIGJhciBuZWVkcyB0byBiZSBkcmF3biBlbm1hc3NlCiAgICAgICAgICAgICAgZ3JvdXAuZHJhdyhwcm9jZXNzZWRHcm91cERhdGFbZ3JvdXBJZHNbaV1dLCBncm91cCwgdGhpcy5mcmFtZXdvcmspOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBCYXJGdW5jdGlvbnMuZHJhdyhncm91cElkcywgcHJvY2Vzc2VkR3JvdXBEYXRhLCB0aGlzLmZyYW1ld29yayk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gY2xlYW51cCB1bnVzZWQgc3ZnIGVsZW1lbnRzCiAgICBET011dGlsLmNsZWFudXBFbGVtZW50cyh0aGlzLnN2Z0VsZW1lbnRzKTsKICAgIHJldHVybiBmYWxzZTsKICB9OwoKICAvKioKICAgKiBmaXJzdCBzZWxlY3QgYW5kIHByZXByb2Nlc3MgdGhlIGRhdGEgZnJvbSB0aGUgZGF0YXNldHMuCiAgICogdGhlIGdyb3VwcyBoYXZlIHRoZWlyIHByZXNlbGVjdGlvbiBvZiBkYXRhLCB3ZSBub3cgbG9vcCBvdmVyIHRoaXMgZGF0YSB0byBzZWUKICAgKiB3aGF0IGRhdGEgd2UgbmVlZCB0byBkcmF3LiBTb3J0ZWQgZGF0YSBpcyBtdWNoIGZhc3Rlci4KICAgKiBtb3JlIG9wdGltaXphdGlvbiBpcyBwb3NzaWJsZSBieSBkb2luZyB0aGUgc2FtcGxpbmcgYmVmb3JlIGFuZCB1c2luZyB0aGUgYmluYXJ5IHNlYXJjaAogICAqIHRvIGZpbmQgdGhlIGVuZCBkYXRlIHRvIGRldGVybWluZSB0aGUgaW5jcmVtZW50LgogICAqCiAgICogQHBhcmFtIHthcnJheX0gIGdyb3VwSWRzCiAgICogQHBhcmFtIHtvYmplY3R9IGdyb3Vwc0RhdGEKICAgKiBAcGFyYW0ge2RhdGV9ICAgbWluRGF0ZQogICAqIEBwYXJhbSB7ZGF0ZX0gICBtYXhEYXRlCiAgICogQHByaXZhdGUKICAgKi8KICBMaW5lR3JhcGgucHJvdG90eXBlLl9nZXRSZWxldmFudERhdGEgPSBmdW5jdGlvbiAoZ3JvdXBJZHMsIGdyb3Vwc0RhdGEsIG1pbkRhdGUsIG1heERhdGUpIHsKICAgIHZhciBncm91cCwgaSwgaiwgaXRlbTsKICAgIGlmIChncm91cElkcy5sZW5ndGggPiAwKSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBncm91cElkcy5sZW5ndGg7IGkrKykgewogICAgICAgIGdyb3VwID0gdGhpcy5ncm91cHNbZ3JvdXBJZHNbaV1dOwogICAgICAgIGdyb3Vwc0RhdGFbZ3JvdXBJZHNbaV1dID0gW107CiAgICAgICAgdmFyIGRhdGFDb250YWluZXIgPSBncm91cHNEYXRhW2dyb3VwSWRzW2ldXTsKICAgICAgICAvLyBvcHRpbWl6YXRpb24gZm9yIHNvcnRlZCBkYXRhCiAgICAgICAgaWYgKGdyb3VwLm9wdGlvbnMuc29ydCA9PSB0cnVlKSB7CiAgICAgICAgICB2YXIgZ3Vlc3MgPSBNYXRoLm1heCgwLCB1dGlsLmJpbmFyeVNlYXJjaFZhbHVlKGdyb3VwLml0ZW1zRGF0YSwgbWluRGF0ZSwgJ3gnLCAnYmVmb3JlJykpOwogICAgICAgICAgZm9yIChqID0gZ3Vlc3M7IGogPCBncm91cC5pdGVtc0RhdGEubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgaXRlbSA9IGdyb3VwLml0ZW1zRGF0YVtqXTsKICAgICAgICAgICAgaWYgKGl0ZW0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGlmIChpdGVtLnggPiBtYXhEYXRlKSB7CiAgICAgICAgICAgICAgICBkYXRhQ29udGFpbmVyLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGF0YUNvbnRhaW5lci5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgZ3JvdXAuaXRlbXNEYXRhLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGl0ZW0gPSBncm91cC5pdGVtc0RhdGFbal07CiAgICAgICAgICAgIGlmIChpdGVtICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBpZiAoaXRlbS54ID4gbWluRGF0ZSAmJiBpdGVtLnggPCBtYXhEYXRlKSB7CiAgICAgICAgICAgICAgICBkYXRhQ29udGFpbmVyLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICoKICAgKiBAcGFyYW0gZ3JvdXBJZHMKICAgKiBAcGFyYW0gZ3JvdXBzRGF0YQogICAqIEBwcml2YXRlCiAgICovCiAgTGluZUdyYXBoLnByb3RvdHlwZS5fYXBwbHlTYW1wbGluZyA9IGZ1bmN0aW9uIChncm91cElkcywgZ3JvdXBzRGF0YSkgewogICAgdmFyIGdyb3VwOwogICAgaWYgKGdyb3VwSWRzLmxlbmd0aCA+IDApIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cElkcy5sZW5ndGg7IGkrKykgewogICAgICAgIGdyb3VwID0gdGhpcy5ncm91cHNbZ3JvdXBJZHNbaV1dOwogICAgICAgIGlmIChncm91cC5vcHRpb25zLnNhbXBsaW5nID09IHRydWUpIHsKICAgICAgICAgIHZhciBkYXRhQ29udGFpbmVyID0gZ3JvdXBzRGF0YVtncm91cElkc1tpXV07CiAgICAgICAgICBpZiAoZGF0YUNvbnRhaW5lci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBpbmNyZW1lbnQgPSAxOwogICAgICAgICAgICB2YXIgYW1vdW50T2ZQb2ludHMgPSBkYXRhQ29udGFpbmVyLmxlbmd0aDsKCiAgICAgICAgICAgIC8vIHRoZSBnbG9iYWwgc2NyZWVuIGlzIHVzZWQgYmVjYXVzZSBjaGFuZ2luZyB0aGUgd2lkdGggb2YgdGhlIHlBeGlzIG1heSBhZmZlY3QgdGhlIGluY3JlbWVudCwgcmVzdWx0aW5nIGluIGFuIGVuZGxlc3MgbG9vcAogICAgICAgICAgICAvLyBvZiB3aWR0aCBjaGFuZ2luZyBvZiB0aGUgeUF4aXMuCiAgICAgICAgICAgIHZhciB4RGlzdGFuY2UgPSB0aGlzLmJvZHkudXRpbC50b0dsb2JhbFNjcmVlbihkYXRhQ29udGFpbmVyW2RhdGFDb250YWluZXIubGVuZ3RoIC0gMV0ueCkgLSB0aGlzLmJvZHkudXRpbC50b0dsb2JhbFNjcmVlbihkYXRhQ29udGFpbmVyWzBdLngpOwogICAgICAgICAgICB2YXIgcG9pbnRzUGVyUGl4ZWwgPSBhbW91bnRPZlBvaW50cyAvIHhEaXN0YW5jZTsKICAgICAgICAgICAgaW5jcmVtZW50ID0gTWF0aC5taW4oTWF0aC5jZWlsKDAuMiAqIGFtb3VudE9mUG9pbnRzKSwgTWF0aC5tYXgoMSwgTWF0aC5yb3VuZChwb2ludHNQZXJQaXhlbCkpKTsKCiAgICAgICAgICAgIHZhciBzYW1wbGVkRGF0YSA9IFtdOwogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGFtb3VudE9mUG9pbnRzOyBqICs9IGluY3JlbWVudCkgewogICAgICAgICAgICAgIHNhbXBsZWREYXRhLnB1c2goZGF0YUNvbnRhaW5lcltqXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ3JvdXBzRGF0YVtncm91cElkc1tpXV0gPSBzYW1wbGVkRGF0YTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKgogICAqCiAgICogQHBhcmFtIHthcnJheX0gIGdyb3VwSWRzCiAgICogQHBhcmFtIHtvYmplY3R9IGdyb3Vwc0RhdGEKICAgKiBAcGFyYW0ge29iamVjdH0gZ3JvdXBSYW5nZXMgIHwgdGhpcyBpcyBiZWluZyBmaWxsZWQgaGVyZQogICAqIEBwcml2YXRlCiAgICovCiAgTGluZUdyYXBoLnByb3RvdHlwZS5fZ2V0WVJhbmdlcyA9IGZ1bmN0aW9uIChncm91cElkcywgZ3JvdXBzRGF0YSwgZ3JvdXBSYW5nZXMpIHsKICAgIHZhciBncm91cERhdGEsIGdyb3VwLCBpOwogICAgdmFyIGNvbWJpbmVkRGF0YUxlZnQgPSBbXTsKICAgIHZhciBjb21iaW5lZERhdGFSaWdodCA9IFtdOwogICAgdmFyIG9wdGlvbnM7CiAgICBpZiAoZ3JvdXBJZHMubGVuZ3RoID4gMCkgewogICAgICBmb3IgKGkgPSAwOyBpIDwgZ3JvdXBJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBncm91cERhdGEgPSBncm91cHNEYXRhW2dyb3VwSWRzW2ldXTsKICAgICAgICBvcHRpb25zID0gdGhpcy5ncm91cHNbZ3JvdXBJZHNbaV1dLm9wdGlvbnM7CiAgICAgICAgaWYgKGdyb3VwRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICBncm91cCA9IHRoaXMuZ3JvdXBzW2dyb3VwSWRzW2ldXTsKICAgICAgICAgIC8vIGlmIGJhciBncmFwaHMgYXJlIHN0YWNrZWQsIHRoZWlyIHJhbmdlIG5lZWQgdG8gYmUgaGFuZGxlZCBkaWZmZXJlbnRseSBhbmQgYWNjdW11bGF0ZWQgb3ZlciBhbGwgZ3JvdXBzLgogICAgICAgICAgaWYgKG9wdGlvbnMuc3RhY2sgPT09IHRydWUgJiYgb3B0aW9ucy5zdHlsZSA9PT0gJ2JhcicpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMueUF4aXNPcmllbnRhdGlvbiA9PT0gJ2xlZnQnKSB7CiAgICAgICAgICAgICAgY29tYmluZWREYXRhTGVmdCA9IGNvbWJpbmVkRGF0YUxlZnQuY29uY2F0KGdyb3VwLmdldERhdGEoZ3JvdXBEYXRhKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29tYmluZWREYXRhUmlnaHQgPSBjb21iaW5lZERhdGFSaWdodC5jb25jYXQoZ3JvdXAuZ2V0RGF0YShncm91cERhdGEpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ3JvdXBSYW5nZXNbZ3JvdXBJZHNbaV1dID0gZ3JvdXAuZ2V0WVJhbmdlKGdyb3VwRGF0YSwgZ3JvdXBJZHNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gaWYgYmFyIGdyYXBocyBhcmUgc3RhY2tlZCwgdGhlaXIgcmFuZ2UgbmVlZCB0byBiZSBoYW5kbGVkIGRpZmZlcmVudGx5IGFuZCBhY2N1bXVsYXRlZCBvdmVyIGFsbCBncm91cHMuCiAgICAgIEJhckZ1bmN0aW9ucy5nZXRTdGFja2VkWVJhbmdlKGNvbWJpbmVkRGF0YUxlZnQsIGdyb3VwUmFuZ2VzLCBncm91cElkcywgJ19fYmFyU3RhY2tMZWZ0JywgJ2xlZnQnKTsKICAgICAgQmFyRnVuY3Rpb25zLmdldFN0YWNrZWRZUmFuZ2UoY29tYmluZWREYXRhUmlnaHQsIGdyb3VwUmFuZ2VzLCBncm91cElkcywgJ19fYmFyU3RhY2tSaWdodCcsICdyaWdodCcpOwogICAgICAvLyBpZiBsaW5lIGdyYXBocyBhcmUgc3RhY2tlZCwgdGhlaXIgcmFuZ2UgbmVlZCB0byBiZSBoYW5kbGVkIGRpZmZlcmVudGx5IGFuZCBhY2N1bXVsYXRlZCBvdmVyIGFsbCBncm91cHMuCiAgICAgIC8vTGluZUZ1bmN0aW9ucy5nZXRTdGFja2VkWVJhbmdlKGNvbWJpbmVkRGF0YUxlZnQgLCBncm91cFJhbmdlcywgZ3JvdXBJZHMsICdfX2xpbmVTdGFja0xlZnQnICwgJ2xlZnQnICk7CiAgICAgIC8vTGluZUZ1bmN0aW9ucy5nZXRTdGFja2VkWVJhbmdlKGNvbWJpbmVkRGF0YVJpZ2h0LCBncm91cFJhbmdlcywgZ3JvdXBJZHMsICdfX2xpbmVTdGFja1JpZ2h0JywgJ3JpZ2h0Jyk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogdGhpcyBzZXRzIHRoZSBZIHJhbmdlcyBmb3IgdGhlIFkgYXhpcy4gSXQgYWxzbyBkZXRlcm1pbmVzIHdoaWNoIG9mIHRoZSBheGlzIHNob3VsZCBiZSBzaG93biBvciBoaWRkZW4uCiAgICogQHBhcmFtIHtBcnJheX0gZ3JvdXBJZHMKICAgKiBAcGFyYW0ge09iamVjdH0gZ3JvdXBSYW5nZXMKICAgKiBAcHJpdmF0ZQogICAqLwogIExpbmVHcmFwaC5wcm90b3R5cGUuX3VwZGF0ZVlBeGlzID0gZnVuY3Rpb24gKGdyb3VwSWRzLCBncm91cFJhbmdlcykgewogICAgdmFyIHJlc2l6ZWQgPSBmYWxzZTsKICAgIHZhciB5QXhpc0xlZnRVc2VkID0gZmFsc2U7CiAgICB2YXIgeUF4aXNSaWdodFVzZWQgPSBmYWxzZTsKICAgIHZhciBtaW5MZWZ0ID0gMTAwMDAwMDAwMCwKICAgICAgICBtaW5SaWdodCA9IDEwMDAwMDAwMDAsCiAgICAgICAgbWF4TGVmdCA9IC0xMDAwMDAwMDAwLAogICAgICAgIG1heFJpZ2h0ID0gLTEwMDAwMDAwMDAsCiAgICAgICAgbWluVmFsLAogICAgICAgIG1heFZhbDsKICAgIC8vIGlmIGdyb3VwcyBhcmUgcHJlc2VudAogICAgaWYgKGdyb3VwSWRzLmxlbmd0aCA+IDApIHsKICAgICAgLy8gdGhpcyBpcyBoZXJlIHRvIG1ha2Ugc3VyZSB0aGF0IGlmIHRoZXJlIGFyZSBubyBpdGVtcyBpbiB0aGUgYXhpcyBidXQgdGhlcmUgYXJlIGdyb3VwcywgdGhhdCB0aGVyZSBpcyBubyBpbmZpbml0ZSBkcmF3L3JlZHJhdyBsb29wLgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3VwSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGdyb3VwID0gdGhpcy5ncm91cHNbZ3JvdXBJZHNbaV1dOwogICAgICAgIGlmIChncm91cCAmJiBncm91cC5vcHRpb25zLnlBeGlzT3JpZW50YXRpb24gIT0gJ3JpZ2h0JykgewogICAgICAgICAgeUF4aXNMZWZ0VXNlZCA9IHRydWU7CiAgICAgICAgICBtaW5MZWZ0ID0gMDsKICAgICAgICAgIG1heExlZnQgPSAwOwogICAgICAgIH0gZWxzZSBpZiAoZ3JvdXAgJiYgZ3JvdXAub3B0aW9ucy55QXhpc09yaWVudGF0aW9uKSB7CiAgICAgICAgICB5QXhpc1JpZ2h0VXNlZCA9IHRydWU7CiAgICAgICAgICBtaW5SaWdodCA9IDA7CiAgICAgICAgICBtYXhSaWdodCA9IDA7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBpZiB0aGVyZSBhcmUgaXRlbXM6CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoZ3JvdXBSYW5nZXMuaGFzT3duUHJvcGVydHkoZ3JvdXBJZHNbaV0pKSB7CiAgICAgICAgICBpZiAoZ3JvdXBSYW5nZXNbZ3JvdXBJZHNbaV1dLmlnbm9yZSAhPT0gdHJ1ZSkgewogICAgICAgICAgICBtaW5WYWwgPSBncm91cFJhbmdlc1tncm91cElkc1tpXV0ubWluOwogICAgICAgICAgICBtYXhWYWwgPSBncm91cFJhbmdlc1tncm91cElkc1tpXV0ubWF4OwoKICAgICAgICAgICAgaWYgKGdyb3VwUmFuZ2VzW2dyb3VwSWRzW2ldXS55QXhpc09yaWVudGF0aW9uICE9ICdyaWdodCcpIHsKICAgICAgICAgICAgICB5QXhpc0xlZnRVc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICBtaW5MZWZ0ID0gbWluTGVmdCA+IG1pblZhbCA/IG1pblZhbCA6IG1pbkxlZnQ7CiAgICAgICAgICAgICAgbWF4TGVmdCA9IG1heExlZnQgPCBtYXhWYWwgPyBtYXhWYWwgOiBtYXhMZWZ0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHlBeGlzUmlnaHRVc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICBtaW5SaWdodCA9IG1pblJpZ2h0ID4gbWluVmFsID8gbWluVmFsIDogbWluUmlnaHQ7CiAgICAgICAgICAgICAgbWF4UmlnaHQgPSBtYXhSaWdodCA8IG1heFZhbCA/IG1heFZhbCA6IG1heFJpZ2h0OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoeUF4aXNMZWZ0VXNlZCA9PSB0cnVlKSB7CiAgICAgICAgdGhpcy55QXhpc0xlZnQuc2V0UmFuZ2UobWluTGVmdCwgbWF4TGVmdCk7CiAgICAgIH0KICAgICAgaWYgKHlBeGlzUmlnaHRVc2VkID09IHRydWUpIHsKICAgICAgICB0aGlzLnlBeGlzUmlnaHQuc2V0UmFuZ2UobWluUmlnaHQsIG1heFJpZ2h0KTsKICAgICAgfQogICAgfQogICAgcmVzaXplZCA9IHRoaXMuX3RvZ2dsZUF4aXNWaXNpYmxpdHkoeUF4aXNMZWZ0VXNlZCwgdGhpcy55QXhpc0xlZnQpIHx8IHJlc2l6ZWQ7CiAgICByZXNpemVkID0gdGhpcy5fdG9nZ2xlQXhpc1Zpc2libGl0eSh5QXhpc1JpZ2h0VXNlZCwgdGhpcy55QXhpc1JpZ2h0KSB8fCByZXNpemVkOwoKICAgIGlmICh5QXhpc1JpZ2h0VXNlZCA9PSB0cnVlICYmIHlBeGlzTGVmdFVzZWQgPT0gdHJ1ZSkgewogICAgICB0aGlzLnlBeGlzTGVmdC5kcmF3SWNvbnMgPSB0cnVlOwogICAgICB0aGlzLnlBeGlzUmlnaHQuZHJhd0ljb25zID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMueUF4aXNMZWZ0LmRyYXdJY29ucyA9IGZhbHNlOwogICAgICB0aGlzLnlBeGlzUmlnaHQuZHJhd0ljb25zID0gZmFsc2U7CiAgICB9CiAgICB0aGlzLnlBeGlzUmlnaHQubWFzdGVyID0gIXlBeGlzTGVmdFVzZWQ7CiAgICBpZiAodGhpcy55QXhpc1JpZ2h0Lm1hc3RlciA9PSBmYWxzZSkgewogICAgICBpZiAoeUF4aXNSaWdodFVzZWQgPT0gdHJ1ZSkgewogICAgICAgIHRoaXMueUF4aXNMZWZ0LmxpbmVPZmZzZXQgPSB0aGlzLnlBeGlzUmlnaHQud2lkdGg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy55QXhpc0xlZnQubGluZU9mZnNldCA9IDA7CiAgICAgIH0KCiAgICAgIHJlc2l6ZWQgPSB0aGlzLnlBeGlzTGVmdC5yZWRyYXcoKSB8fCByZXNpemVkOwogICAgICB0aGlzLnlBeGlzUmlnaHQuc3RlcFBpeGVscyA9IHRoaXMueUF4aXNMZWZ0LnN0ZXBQaXhlbHM7CiAgICAgIHRoaXMueUF4aXNSaWdodC56ZXJvQ3Jvc3NpbmcgPSB0aGlzLnlBeGlzTGVmdC56ZXJvQ3Jvc3Npbmc7CiAgICAgIHRoaXMueUF4aXNSaWdodC5hbW91bnRPZlN0ZXBzID0gdGhpcy55QXhpc0xlZnQuYW1vdW50T2ZTdGVwczsKICAgICAgcmVzaXplZCA9IHRoaXMueUF4aXNSaWdodC5yZWRyYXcoKSB8fCByZXNpemVkOwogICAgfSBlbHNlIHsKICAgICAgcmVzaXplZCA9IHRoaXMueUF4aXNSaWdodC5yZWRyYXcoKSB8fCByZXNpemVkOwogICAgfQoKICAgIC8vIGNsZWFuIHRoZSBhY2N1bXVsYXRlZCBsaXN0cwogICAgdmFyIHRlbXBHcm91cHMgPSBbJ19fYmFyU3RhY2tMZWZ0JywgJ19fYmFyU3RhY2tSaWdodCcsICdfX2xpbmVTdGFja0xlZnQnLCAnX19saW5lU3RhY2tSaWdodCddOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZW1wR3JvdXBzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChncm91cElkcy5pbmRleE9mKHRlbXBHcm91cHNbaV0pICE9IC0xKSB7CiAgICAgICAgZ3JvdXBJZHMuc3BsaWNlKGdyb3VwSWRzLmluZGV4T2YodGVtcEdyb3Vwc1tpXSksIDEpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHJlc2l6ZWQ7CiAgfTsKCiAgLyoqCiAgICogVGhpcyBzaG93cyBvciBoaWRlcyB0aGUgWSBheGlzIGlmIG5lZWRlZC4gSWYgdGhlcmUgaXMgYSBjaGFuZ2UsIHRoZSBjaGFuZ2VkIGV2ZW50IGlzIGVtaXR0ZWQgYnkgdGhlIHVwZGF0ZVlBeGlzIGZ1bmN0aW9uCiAgICoKICAgKiBAcGFyYW0ge2Jvb2xlYW59IGF4aXNVc2VkCiAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0gYXhpcwogICAqLwogIExpbmVHcmFwaC5wcm90b3R5cGUuX3RvZ2dsZUF4aXNWaXNpYmxpdHkgPSBmdW5jdGlvbiAoYXhpc1VzZWQsIGF4aXMpIHsKICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7CiAgICBpZiAoYXhpc1VzZWQgPT0gZmFsc2UpIHsKICAgICAgaWYgKGF4aXMuZG9tLmZyYW1lLnBhcmVudE5vZGUgJiYgYXhpcy5oaWRkZW4gPT0gZmFsc2UpIHsKICAgICAgICBheGlzLmhpZGUoKTsKICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKCFheGlzLmRvbS5mcmFtZS5wYXJlbnROb2RlICYmIGF4aXMuaGlkZGVuID09IHRydWUpIHsKICAgICAgICBheGlzLnNob3coKTsKICAgICAgICBjaGFuZ2VkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGNoYW5nZWQ7CiAgfTsKCiAgLyoqCiAgICogVGhpcyB1c2VzIHRoZSBEYXRhQXhpcyBvYmplY3QgdG8gZ2VuZXJhdGUgdGhlIGNvcnJlY3QgWCBjb29yZGluYXRlIG9uIHRoZSBTVkcgd2luZG93LiBJdCB1c2VzIHRoZQogICAqIHV0aWwgZnVuY3Rpb24gdG9TY3JlZW4gdG8gZ2V0IHRoZSB4IGNvb3JkaW5hdGUgZnJvbSB0aGUgdGltZXN0YW1wLiBJdCBhbHNvIHByZS1maWx0ZXJzIHRoZSBkYXRhIGFuZCBnZXQgdGhlIG1pbk1heCByYW5nZXMgZm9yCiAgICogdGhlIHlBeGlzLgogICAqCiAgICogQHBhcmFtIGRhdGFwb2ludHMKICAgKiBAcmV0dXJucyB7QXJyYXl9CiAgICogQHByaXZhdGUKICAgKi8KICBMaW5lR3JhcGgucHJvdG90eXBlLl9jb252ZXJ0WGNvb3JkaW5hdGVzID0gZnVuY3Rpb24gKGRhdGFwb2ludHMpIHsKICAgIHZhciBleHRyYWN0ZWREYXRhID0gW107CiAgICB2YXIgeFZhbHVlLCB5VmFsdWU7CiAgICB2YXIgdG9TY3JlZW4gPSB0aGlzLmJvZHkudXRpbC50b1NjcmVlbjsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGFwb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgeFZhbHVlID0gdG9TY3JlZW4oZGF0YXBvaW50c1tpXS54KSArIHRoaXMucHJvcHMud2lkdGg7CiAgICAgIHlWYWx1ZSA9IGRhdGFwb2ludHNbaV0ueTsKICAgICAgZXh0cmFjdGVkRGF0YS5wdXNoKHsgeDogeFZhbHVlLCB5OiB5VmFsdWUgfSk7CiAgICB9CgogICAgcmV0dXJuIGV4dHJhY3RlZERhdGE7CiAgfTsKCiAgLyoqCiAgICogVGhpcyB1c2VzIHRoZSBEYXRhQXhpcyBvYmplY3QgdG8gZ2VuZXJhdGUgdGhlIGNvcnJlY3QgWCBjb29yZGluYXRlIG9uIHRoZSBTVkcgd2luZG93LiBJdCB1c2VzIHRoZQogICAqIHV0aWwgZnVuY3Rpb24gdG9TY3JlZW4gdG8gZ2V0IHRoZSB4IGNvb3JkaW5hdGUgZnJvbSB0aGUgdGltZXN0YW1wLiBJdCBhbHNvIHByZS1maWx0ZXJzIHRoZSBkYXRhIGFuZCBnZXQgdGhlIG1pbk1heCByYW5nZXMgZm9yCiAgICogdGhlIHlBeGlzLgogICAqCiAgICogQHBhcmFtIGRhdGFwb2ludHMKICAgKiBAcGFyYW0gZ3JvdXAKICAgKiBAcmV0dXJucyB7QXJyYXl9CiAgICogQHByaXZhdGUKICAgKi8KICBMaW5lR3JhcGgucHJvdG90eXBlLl9jb252ZXJ0WWNvb3JkaW5hdGVzID0gZnVuY3Rpb24gKGRhdGFwb2ludHMsIGdyb3VwKSB7CiAgICB2YXIgZXh0cmFjdGVkRGF0YSA9IFtdOwogICAgdmFyIHhWYWx1ZSwgeVZhbHVlOwogICAgdmFyIHRvU2NyZWVuID0gdGhpcy5ib2R5LnV0aWwudG9TY3JlZW47CiAgICB2YXIgYXhpcyA9IHRoaXMueUF4aXNMZWZ0OwogICAgdmFyIHN2Z0hlaWdodCA9IE51bWJlcih0aGlzLnN2Zy5zdHlsZS5oZWlnaHQucmVwbGFjZSgncHgnLCAnJykpOwogICAgaWYgKGdyb3VwLm9wdGlvbnMueUF4aXNPcmllbnRhdGlvbiA9PSAncmlnaHQnKSB7CiAgICAgIGF4aXMgPSB0aGlzLnlBeGlzUmlnaHQ7CiAgICB9CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBsYWJlbFZhbHVlID0gZGF0YXBvaW50c1tpXS5sYWJlbCA/IGRhdGFwb2ludHNbaV0ubGFiZWwgOiBudWxsOwogICAgICB4VmFsdWUgPSB0b1NjcmVlbihkYXRhcG9pbnRzW2ldLngpICsgdGhpcy5wcm9wcy53aWR0aDsKICAgICAgeVZhbHVlID0gTWF0aC5yb3VuZChheGlzLmNvbnZlcnRWYWx1ZShkYXRhcG9pbnRzW2ldLnkpKTsKICAgICAgZXh0cmFjdGVkRGF0YS5wdXNoKHsgeDogeFZhbHVlLCB5OiB5VmFsdWUsIGxhYmVsOiBsYWJlbFZhbHVlIH0pOwogICAgfQoKICAgIGdyb3VwLnNldFplcm9Qb3NpdGlvbihNYXRoLm1pbihzdmdIZWlnaHQsIGF4aXMuY29udmVydFZhbHVlKDApKSk7CgogICAgcmV0dXJuIGV4dHJhY3RlZERhdGE7CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBMaW5lR3JhcGg7CgovKioqLyB9LAovKiA1MSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CiAgdmFyIERPTXV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOwogIHZhciBDb21wb25lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKTsKICB2YXIgRGF0YVN0ZXAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyKTsKCiAgLyoqCiAgICogQSBob3Jpem9udGFsIHRpbWUgYXhpcwogICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gICAgICAgIFNlZSBEYXRhQXhpcy5zZXRPcHRpb25zIGZvciB0aGUgYXZhaWxhYmxlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy4KICAgKiBAY29uc3RydWN0b3IgRGF0YUF4aXMKICAgKiBAZXh0ZW5kcyBDb21wb25lbnQKICAgKiBAcGFyYW0gYm9keQogICAqLwogIGZ1bmN0aW9uIERhdGFBeGlzKGJvZHksIG9wdGlvbnMsIHN2ZywgbGluZWdyYXBoT3B0aW9ucykgewogICAgdGhpcy5pZCA9IHV0aWwucmFuZG9tVVVJRCgpOwogICAgdGhpcy5ib2R5ID0gYm9keTsKCiAgICB0aGlzLmRlZmF1bHRPcHRpb25zID0gewogICAgICBvcmllbnRhdGlvbjogJ2xlZnQnLCAvLyBzdXBwb3J0ZWQ6ICdsZWZ0JywgJ3JpZ2h0JwogICAgICBzaG93TWlub3JMYWJlbHM6IHRydWUsCiAgICAgIHNob3dNYWpvckxhYmVsczogdHJ1ZSwKICAgICAgaWNvbnM6IHRydWUsCiAgICAgIG1ham9yTGluZXNPZmZzZXQ6IDcsCiAgICAgIG1pbm9yTGluZXNPZmZzZXQ6IDQsCiAgICAgIGxhYmVsT2Zmc2V0WDogMTAsCiAgICAgIGxhYmVsT2Zmc2V0WTogMiwKICAgICAgaWNvbldpZHRoOiAyMCwKICAgICAgd2lkdGg6ICc0MHB4JywKICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgYWxpZ25aZXJvczogdHJ1ZSwKICAgICAgbGVmdDogewogICAgICAgIHJhbmdlOiB7IG1pbjogdW5kZWZpbmVkLCBtYXg6IHVuZGVmaW5lZCB9LAogICAgICAgIGZvcm1hdDogZnVuY3Rpb24gZm9ybWF0KHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfSwKICAgICAgICB0aXRsZTogeyB0ZXh0OiB1bmRlZmluZWQsIHN0eWxlOiB1bmRlZmluZWQgfQogICAgICB9LAogICAgICByaWdodDogewogICAgICAgIHJhbmdlOiB7IG1pbjogdW5kZWZpbmVkLCBtYXg6IHVuZGVmaW5lZCB9LAogICAgICAgIGZvcm1hdDogZnVuY3Rpb24gZm9ybWF0KHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfSwKICAgICAgICB0aXRsZTogeyB0ZXh0OiB1bmRlZmluZWQsIHN0eWxlOiB1bmRlZmluZWQgfQogICAgICB9CiAgICB9OwoKICAgIHRoaXMubGluZWdyYXBoT3B0aW9ucyA9IGxpbmVncmFwaE9wdGlvbnM7CiAgICB0aGlzLmxpbmVncmFwaFNWRyA9IHN2ZzsKICAgIHRoaXMucHJvcHMgPSB7fTsKICAgIHRoaXMuRE9NZWxlbWVudHMgPSB7IC8vIGR5bmFtaWMgZWxlbWVudHMKICAgICAgbGluZXM6IHt9LAogICAgICBsYWJlbHM6IHt9LAogICAgICB0aXRsZToge30KICAgIH07CgogICAgdGhpcy5kb20gPSB7fTsKCiAgICB0aGlzLnJhbmdlID0geyBzdGFydDogMCwgZW5kOiAwIH07CgogICAgdGhpcy5vcHRpb25zID0gdXRpbC5leHRlbmQoe30sIHRoaXMuZGVmYXVsdE9wdGlvbnMpOwogICAgdGhpcy5jb252ZXJzaW9uRmFjdG9yID0gMTsKCiAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICB0aGlzLndpZHRoID0gTnVtYmVyKCgnJyArIHRoaXMub3B0aW9ucy53aWR0aCkucmVwbGFjZSgncHgnLCAnJykpOwogICAgdGhpcy5taW5XaWR0aCA9IHRoaXMud2lkdGg7CiAgICB0aGlzLmhlaWdodCA9IHRoaXMubGluZWdyYXBoU1ZHLm9mZnNldEhlaWdodDsKICAgIHRoaXMuaGlkZGVuID0gZmFsc2U7CgogICAgdGhpcy5zdGVwUGl4ZWxzID0gMjU7CiAgICB0aGlzLnplcm9Dcm9zc2luZyA9IC0xOwogICAgdGhpcy5hbW91bnRPZlN0ZXBzID0gLTE7CgogICAgdGhpcy5saW5lT2Zmc2V0ID0gMDsKICAgIHRoaXMubWFzdGVyID0gdHJ1ZTsKICAgIHRoaXMuc3ZnRWxlbWVudHMgPSB7fTsKICAgIHRoaXMuaWNvbnNSZW1vdmVkID0gZmFsc2U7CgogICAgdGhpcy5ncm91cHMgPSB7fTsKICAgIHRoaXMuYW1vdW50T2ZHcm91cHMgPSAwOwoKICAgIC8vIGNyZWF0ZSB0aGUgSFRNTCBET00KICAgIHRoaXMuX2NyZWF0ZSgpOwoKICAgIHZhciBtZSA9IHRoaXM7CiAgICB0aGlzLmJvZHkuZW1pdHRlci5vbigndmVydGljYWxEcmFnJywgZnVuY3Rpb24gKCkgewogICAgICBtZS5kb20ubGluZUNvbnRhaW5lci5zdHlsZS50b3AgPSBtZS5ib2R5LmRvbVByb3BzLnNjcm9sbFRvcCArICdweCc7CiAgICB9KTsKICB9CgogIERhdGFBeGlzLnByb3RvdHlwZSA9IG5ldyBDb21wb25lbnQoKTsKCiAgRGF0YUF4aXMucHJvdG90eXBlLmFkZEdyb3VwID0gZnVuY3Rpb24gKGxhYmVsLCBncmFwaE9wdGlvbnMpIHsKICAgIGlmICghdGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobGFiZWwpKSB7CiAgICAgIHRoaXMuZ3JvdXBzW2xhYmVsXSA9IGdyYXBoT3B0aW9uczsKICAgIH0KICAgIHRoaXMuYW1vdW50T2ZHcm91cHMgKz0gMTsKICB9OwoKICBEYXRhQXhpcy5wcm90b3R5cGUudXBkYXRlR3JvdXAgPSBmdW5jdGlvbiAobGFiZWwsIGdyYXBoT3B0aW9ucykgewogICAgdGhpcy5ncm91cHNbbGFiZWxdID0gZ3JhcGhPcHRpb25zOwogIH07CgogIERhdGFBeGlzLnByb3RvdHlwZS5yZW1vdmVHcm91cCA9IGZ1bmN0aW9uIChsYWJlbCkgewogICAgaWYgKHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KGxhYmVsKSkgewogICAgICBkZWxldGUgdGhpcy5ncm91cHNbbGFiZWxdOwogICAgICB0aGlzLmFtb3VudE9mR3JvdXBzIC09IDE7CiAgICB9CiAgfTsKCiAgRGF0YUF4aXMucHJvdG90eXBlLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMpIHsKICAgICAgdmFyIHJlZHJhdyA9IGZhbHNlOwogICAgICBpZiAodGhpcy5vcHRpb25zLm9yaWVudGF0aW9uICE9IG9wdGlvbnMub3JpZW50YXRpb24gJiYgb3B0aW9ucy5vcmllbnRhdGlvbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmVkcmF3ID0gdHJ1ZTsKICAgICAgfQogICAgICB2YXIgZmllbGRzID0gWydvcmllbnRhdGlvbicsICdzaG93TWlub3JMYWJlbHMnLCAnc2hvd01ham9yTGFiZWxzJywgJ2ljb25zJywgJ21ham9yTGluZXNPZmZzZXQnLCAnbWlub3JMaW5lc09mZnNldCcsICdsYWJlbE9mZnNldFgnLCAnbGFiZWxPZmZzZXRZJywgJ2ljb25XaWR0aCcsICd3aWR0aCcsICd2aXNpYmxlJywgJ2xlZnQnLCAncmlnaHQnLCAnYWxpZ25aZXJvcyddOwogICAgICB1dGlsLnNlbGVjdGl2ZUV4dGVuZChmaWVsZHMsIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CgogICAgICB0aGlzLm1pbldpZHRoID0gTnVtYmVyKCgnJyArIHRoaXMub3B0aW9ucy53aWR0aCkucmVwbGFjZSgncHgnLCAnJykpOwoKICAgICAgaWYgKHJlZHJhdyA9PT0gdHJ1ZSAmJiB0aGlzLmRvbS5mcmFtZSkgewogICAgICAgIHRoaXMuaGlkZSgpOwogICAgICAgIHRoaXMuc2hvdygpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlIHRoZSBIVE1MIERPTSBmb3IgdGhlIERhdGFBeGlzCiAgICovCiAgRGF0YUF4aXMucHJvdG90eXBlLl9jcmVhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmRvbS5mcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20uZnJhbWUuc3R5bGUud2lkdGggPSB0aGlzLm9wdGlvbnMud2lkdGg7CiAgICB0aGlzLmRvbS5mcmFtZS5zdHlsZS5oZWlnaHQgPSB0aGlzLmhlaWdodDsKCiAgICB0aGlzLmRvbS5saW5lQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB0aGlzLmRvbS5saW5lQ29udGFpbmVyLnN0eWxlLndpZHRoID0gJzEwMCUnOwogICAgdGhpcy5kb20ubGluZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgIHRoaXMuZG9tLmxpbmVDb250YWluZXIuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnOwoKICAgIC8vIGNyZWF0ZSBzdmcgZWxlbWVudCBmb3IgZ3JhcGggZHJhd2luZy4KICAgIHRoaXMuc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTsKICAgIHRoaXMuc3ZnLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKICAgIHRoaXMuc3ZnLnN0eWxlLnRvcCA9ICcwcHgnOwogICAgdGhpcy5zdmcuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnOwogICAgdGhpcy5zdmcuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICB0aGlzLnN2Zy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIHRoaXMuZG9tLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuc3ZnKTsKICB9OwoKICBEYXRhQXhpcy5wcm90b3R5cGUuX3JlZHJhd0dyb3VwSWNvbnMgPSBmdW5jdGlvbiAoKSB7CiAgICBET011dGlsLnByZXBhcmVFbGVtZW50cyh0aGlzLnN2Z0VsZW1lbnRzKTsKCiAgICB2YXIgeDsKICAgIHZhciBpY29uV2lkdGggPSB0aGlzLm9wdGlvbnMuaWNvbldpZHRoOwogICAgdmFyIGljb25IZWlnaHQgPSAxNTsKICAgIHZhciBpY29uT2Zmc2V0ID0gNDsKICAgIHZhciB5ID0gaWNvbk9mZnNldCArIDAuNSAqIGljb25IZWlnaHQ7CgogICAgaWYgKHRoaXMub3B0aW9ucy5vcmllbnRhdGlvbiA9PT0gJ2xlZnQnKSB7CiAgICAgIHggPSBpY29uT2Zmc2V0OwogICAgfSBlbHNlIHsKICAgICAgeCA9IHRoaXMud2lkdGggLSBpY29uV2lkdGggLSBpY29uT2Zmc2V0OwogICAgfQoKICAgIHZhciBncm91cEFycmF5ID0gT2JqZWN0LmtleXModGhpcy5ncm91cHMpOwogICAgZ3JvdXBBcnJheS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogMTsKICAgIH0pOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBBcnJheS5sZW5ndGg7IGkrKykgewogICAgICB2YXIgZ3JvdXBJZCA9IGdyb3VwQXJyYXlbaV07CiAgICAgIGlmICh0aGlzLmdyb3Vwc1tncm91cElkXS52aXNpYmxlID09PSB0cnVlICYmICh0aGlzLmxpbmVncmFwaE9wdGlvbnMudmlzaWJpbGl0eVtncm91cElkXSA9PT0gdW5kZWZpbmVkIHx8IHRoaXMubGluZWdyYXBoT3B0aW9ucy52aXNpYmlsaXR5W2dyb3VwSWRdID09PSB0cnVlKSkgewogICAgICAgIHRoaXMuZ3JvdXBzW2dyb3VwSWRdLmRyYXdJY29uKHgsIHksIHRoaXMuc3ZnRWxlbWVudHMsIHRoaXMuc3ZnLCBpY29uV2lkdGgsIGljb25IZWlnaHQpOwogICAgICAgIHkgKz0gaWNvbkhlaWdodCArIGljb25PZmZzZXQ7CiAgICAgIH0KICAgIH0KCiAgICBET011dGlsLmNsZWFudXBFbGVtZW50cyh0aGlzLnN2Z0VsZW1lbnRzKTsKICAgIHRoaXMuaWNvbnNSZW1vdmVkID0gZmFsc2U7CiAgfTsKCiAgRGF0YUF4aXMucHJvdG90eXBlLl9jbGVhbnVwSWNvbnMgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5pY29uc1JlbW92ZWQgPT09IGZhbHNlKSB7CiAgICAgIERPTXV0aWwucHJlcGFyZUVsZW1lbnRzKHRoaXMuc3ZnRWxlbWVudHMpOwogICAgICBET011dGlsLmNsZWFudXBFbGVtZW50cyh0aGlzLnN2Z0VsZW1lbnRzKTsKICAgICAgdGhpcy5pY29uc1JlbW92ZWQgPSB0cnVlOwogICAgfQogIH07CgogIC8qKgogICAqIENyZWF0ZSB0aGUgSFRNTCBET00gZm9yIHRoZSBEYXRhQXhpcwogICAqLwogIERhdGFBeGlzLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5oaWRkZW4gPSBmYWxzZTsKICAgIGlmICghdGhpcy5kb20uZnJhbWUucGFyZW50Tm9kZSkgewogICAgICBpZiAodGhpcy5vcHRpb25zLm9yaWVudGF0aW9uID09PSAnbGVmdCcpIHsKICAgICAgICB0aGlzLmJvZHkuZG9tLmxlZnQuYXBwZW5kQ2hpbGQodGhpcy5kb20uZnJhbWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm9keS5kb20ucmlnaHQuYXBwZW5kQ2hpbGQodGhpcy5kb20uZnJhbWUpOwogICAgICB9CiAgICB9CgogICAgaWYgKCF0aGlzLmRvbS5saW5lQ29udGFpbmVyLnBhcmVudE5vZGUpIHsKICAgICAgdGhpcy5ib2R5LmRvbS5iYWNrZ3JvdW5kSG9yaXpvbnRhbC5hcHBlbmRDaGlsZCh0aGlzLmRvbS5saW5lQ29udGFpbmVyKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBDcmVhdGUgdGhlIEhUTUwgRE9NIGZvciB0aGUgRGF0YUF4aXMKICAgKi8KICBEYXRhQXhpcy5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuaGlkZGVuID0gdHJ1ZTsKICAgIGlmICh0aGlzLmRvbS5mcmFtZS5wYXJlbnROb2RlKSB7CiAgICAgIHRoaXMuZG9tLmZyYW1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5kb20uZnJhbWUpOwogICAgfQoKICAgIGlmICh0aGlzLmRvbS5saW5lQ29udGFpbmVyLnBhcmVudE5vZGUpIHsKICAgICAgdGhpcy5kb20ubGluZUNvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZG9tLmxpbmVDb250YWluZXIpOwogICAgfQogIH07CgogIC8qKgogICAqIFNldCBhIHJhbmdlIChzdGFydCBhbmQgZW5kKQogICAqIEBwYXJhbSBlbmQKICAgKiBAcGFyYW0gc3RhcnQKICAgKiBAcGFyYW0gZW5kCiAgICovCiAgRGF0YUF4aXMucHJvdG90eXBlLnNldFJhbmdlID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHsKICAgIGlmICh0aGlzLm1hc3RlciA9PT0gZmFsc2UgJiYgdGhpcy5vcHRpb25zLmFsaWduWmVyb3MgPT09IHRydWUgJiYgdGhpcy56ZXJvQ3Jvc3NpbmcgIT0gLTEpIHsKICAgICAgaWYgKHN0YXJ0ID4gMCkgewogICAgICAgIHN0YXJ0ID0gMDsKICAgICAgfQogICAgfQogICAgdGhpcy5yYW5nZS5zdGFydCA9IHN0YXJ0OwogICAgdGhpcy5yYW5nZS5lbmQgPSBlbmQ7CiAgfTsKCiAgLyoqCiAgICogUmVwYWludCB0aGUgY29tcG9uZW50CiAgICogQHJldHVybiB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSBjb21wb25lbnQgaXMgcmVzaXplZAogICAqLwogIERhdGFBeGlzLnByb3RvdHlwZS5yZWRyYXcgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgcmVzaXplZCA9IGZhbHNlOwogICAgdmFyIGFjdGl2ZUdyb3VwcyA9IDA7CgogICAgLy8gTWFrZSBzdXJlIHRoZSBsaW5lIGNvbnRhaW5lciBhZGhlcmVzIHRvIHRoZSB2ZXJ0aWNhbCBzY3JvbGxpbmcuCiAgICB0aGlzLmRvbS5saW5lQ29udGFpbmVyLnN0eWxlLnRvcCA9IHRoaXMuYm9keS5kb21Qcm9wcy5zY3JvbGxUb3AgKyAncHgnOwoKICAgIGZvciAodmFyIGdyb3VwSWQgaW4gdGhpcy5ncm91cHMpIHsKICAgICAgaWYgKHRoaXMuZ3JvdXBzLmhhc093blByb3BlcnR5KGdyb3VwSWQpKSB7CiAgICAgICAgaWYgKHRoaXMuZ3JvdXBzW2dyb3VwSWRdLnZpc2libGUgPT09IHRydWUgJiYgKHRoaXMubGluZWdyYXBoT3B0aW9ucy52aXNpYmlsaXR5W2dyb3VwSWRdID09PSB1bmRlZmluZWQgfHwgdGhpcy5saW5lZ3JhcGhPcHRpb25zLnZpc2liaWxpdHlbZ3JvdXBJZF0gPT09IHRydWUpKSB7CiAgICAgICAgICBhY3RpdmVHcm91cHMrKzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLmFtb3VudE9mR3JvdXBzID09PSAwIHx8IGFjdGl2ZUdyb3VwcyA9PT0gMCkgewogICAgICB0aGlzLmhpZGUoKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuc2hvdygpOwogICAgICB0aGlzLmhlaWdodCA9IE51bWJlcih0aGlzLmxpbmVncmFwaFNWRy5zdHlsZS5oZWlnaHQucmVwbGFjZSgncHgnLCAnJykpOwoKICAgICAgLy8gc3ZnIG9mZnNldGhlaWdodCBkaWQgbm90IHdvcmsgaW4gZmlyZWZveCBhbmQgZXhwbG9yZXIuLi4KICAgICAgdGhpcy5kb20ubGluZUNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSB0aGlzLmhlaWdodCArICdweCc7CiAgICAgIHRoaXMud2lkdGggPSB0aGlzLm9wdGlvbnMudmlzaWJsZSA9PT0gdHJ1ZSA/IE51bWJlcigoJycgKyB0aGlzLm9wdGlvbnMud2lkdGgpLnJlcGxhY2UoJ3B4JywgJycpKSA6IDA7CgogICAgICB2YXIgcHJvcHMgPSB0aGlzLnByb3BzOwogICAgICB2YXIgZnJhbWUgPSB0aGlzLmRvbS5mcmFtZTsKCiAgICAgIC8vIHVwZGF0ZSBjbGFzc25hbWUKICAgICAgZnJhbWUuY2xhc3NOYW1lID0gJ3Zpcy1kYXRhLWF4aXMnOwoKICAgICAgLy8gY2FsY3VsYXRlIGNoYXJhY3RlciB3aWR0aCBhbmQgaGVpZ2h0CiAgICAgIHRoaXMuX2NhbGN1bGF0ZUNoYXJTaXplKCk7CgogICAgICB2YXIgb3JpZW50YXRpb24gPSB0aGlzLm9wdGlvbnMub3JpZW50YXRpb247CiAgICAgIHZhciBzaG93TWlub3JMYWJlbHMgPSB0aGlzLm9wdGlvbnMuc2hvd01pbm9yTGFiZWxzOwogICAgICB2YXIgc2hvd01ham9yTGFiZWxzID0gdGhpcy5vcHRpb25zLnNob3dNYWpvckxhYmVsczsKCiAgICAgIC8vIGRldGVybWluZSB0aGUgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgZWxlbWVudHMgZm9yIHRoZSBheGlzCiAgICAgIHByb3BzLm1pbm9yTGFiZWxIZWlnaHQgPSBzaG93TWlub3JMYWJlbHMgPyBwcm9wcy5taW5vckNoYXJIZWlnaHQgOiAwOwogICAgICBwcm9wcy5tYWpvckxhYmVsSGVpZ2h0ID0gc2hvd01ham9yTGFiZWxzID8gcHJvcHMubWFqb3JDaGFySGVpZ2h0IDogMDsKCiAgICAgIHByb3BzLm1pbm9yTGluZVdpZHRoID0gdGhpcy5ib2R5LmRvbS5iYWNrZ3JvdW5kSG9yaXpvbnRhbC5vZmZzZXRXaWR0aCAtIHRoaXMubGluZU9mZnNldCAtIHRoaXMud2lkdGggKyAyICogdGhpcy5vcHRpb25zLm1pbm9yTGluZXNPZmZzZXQ7CiAgICAgIHByb3BzLm1pbm9yTGluZUhlaWdodCA9IDE7CiAgICAgIHByb3BzLm1ham9yTGluZVdpZHRoID0gdGhpcy5ib2R5LmRvbS5iYWNrZ3JvdW5kSG9yaXpvbnRhbC5vZmZzZXRXaWR0aCAtIHRoaXMubGluZU9mZnNldCAtIHRoaXMud2lkdGggKyAyICogdGhpcy5vcHRpb25zLm1ham9yTGluZXNPZmZzZXQ7CiAgICAgIHByb3BzLm1ham9yTGluZUhlaWdodCA9IDE7CgogICAgICAvLyAgdGFrZSBmcmFtZSBvZmZsaW5lIHdoaWxlIHVwZGF0aW5nIChpcyBhbG1vc3QgdHdpY2UgYXMgZmFzdCkKICAgICAgaWYgKG9yaWVudGF0aW9uID09PSAnbGVmdCcpIHsKICAgICAgICBmcmFtZS5zdHlsZS50b3AgPSAnMCc7CiAgICAgICAgZnJhbWUuc3R5bGUubGVmdCA9ICcwJzsKICAgICAgICBmcmFtZS5zdHlsZS5ib3R0b20gPSAnJzsKICAgICAgICBmcmFtZS5zdHlsZS53aWR0aCA9IHRoaXMud2lkdGggKyAncHgnOwogICAgICAgIGZyYW1lLnN0eWxlLmhlaWdodCA9IHRoaXMuaGVpZ2h0ICsgJ3B4JzsKICAgICAgICB0aGlzLnByb3BzLndpZHRoID0gdGhpcy5ib2R5LmRvbVByb3BzLmxlZnQud2lkdGg7CiAgICAgICAgdGhpcy5wcm9wcy5oZWlnaHQgPSB0aGlzLmJvZHkuZG9tUHJvcHMubGVmdC5oZWlnaHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gcmlnaHQKICAgICAgICBmcmFtZS5zdHlsZS50b3AgPSAnJzsKICAgICAgICBmcmFtZS5zdHlsZS5ib3R0b20gPSAnMCc7CiAgICAgICAgZnJhbWUuc3R5bGUubGVmdCA9ICcwJzsKICAgICAgICBmcmFtZS5zdHlsZS53aWR0aCA9IHRoaXMud2lkdGggKyAncHgnOwogICAgICAgIGZyYW1lLnN0eWxlLmhlaWdodCA9IHRoaXMuaGVpZ2h0ICsgJ3B4JzsKICAgICAgICB0aGlzLnByb3BzLndpZHRoID0gdGhpcy5ib2R5LmRvbVByb3BzLnJpZ2h0LndpZHRoOwogICAgICAgIHRoaXMucHJvcHMuaGVpZ2h0ID0gdGhpcy5ib2R5LmRvbVByb3BzLnJpZ2h0LmhlaWdodDsKICAgICAgfQoKICAgICAgcmVzaXplZCA9IHRoaXMuX3JlZHJhd0xhYmVscygpOwogICAgICByZXNpemVkID0gdGhpcy5faXNSZXNpemVkKCkgfHwgcmVzaXplZDsKCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWNvbnMgPT09IHRydWUpIHsKICAgICAgICB0aGlzLl9yZWRyYXdHcm91cEljb25zKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fY2xlYW51cEljb25zKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuX3JlZHJhd1RpdGxlKG9yaWVudGF0aW9uKTsKICAgIH0KICAgIHJldHVybiByZXNpemVkOwogIH07CgogIC8qKgogICAqIFJlcGFpbnQgbWFqb3IgYW5kIG1pbm9yIHRleHQgbGFiZWxzIGFuZCB2ZXJ0aWNhbCBncmlkIGxpbmVzCiAgICogQHByaXZhdGUKICAgKi8KICBEYXRhQXhpcy5wcm90b3R5cGUuX3JlZHJhd0xhYmVscyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciByZXNpemVkID0gZmFsc2U7CiAgICBET011dGlsLnByZXBhcmVFbGVtZW50cyh0aGlzLkRPTWVsZW1lbnRzLmxpbmVzKTsKICAgIERPTXV0aWwucHJlcGFyZUVsZW1lbnRzKHRoaXMuRE9NZWxlbWVudHMubGFiZWxzKTsKICAgIHZhciBvcmllbnRhdGlvbiA9IHRoaXMub3B0aW9uc1snb3JpZW50YXRpb24nXTsKCiAgICAvLyBnZXQgdGhlIHJhbmdlIGZvciB0aGUgc2xhdmVkIGF4aXMKICAgIHZhciBzdGVwOwogICAgaWYgKHRoaXMubWFzdGVyID09PSBmYWxzZSkgewogICAgICB2YXIgc3RlcFNpemUsIHJhbmdlU3RhcnQsIHJhbmdlRW5kLCBtaW5pbXVtU3RlcDsKICAgICAgaWYgKHRoaXMuemVyb0Nyb3NzaW5nICE9PSAtMSAmJiB0aGlzLm9wdGlvbnMuYWxpZ25aZXJvcyA9PT0gdHJ1ZSkgewogICAgICAgIGlmICh0aGlzLnJhbmdlLmVuZCA+IDApIHsKICAgICAgICAgIHN0ZXBTaXplID0gdGhpcy5yYW5nZS5lbmQgLyB0aGlzLnplcm9Dcm9zc2luZzsgLy8gc2l6ZSBvZiBvbmUgc3RlcAogICAgICAgICAgcmFuZ2VTdGFydCA9IHRoaXMucmFuZ2UuZW5kIC0gdGhpcy5hbW91bnRPZlN0ZXBzICogc3RlcFNpemU7CiAgICAgICAgICByYW5nZUVuZCA9IHRoaXMucmFuZ2UuZW5kOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBhbGwgb2YgdGhlIHJhbmdlIChpbmNsdWRpbmcgc3RhcnQpIGhhcyB0byBiZSBkb25lIGJlZm9yZSB0aGUgemVybyBjcm9zc2luZy4KICAgICAgICAgIHN0ZXBTaXplID0gLTEgKiB0aGlzLnJhbmdlLnN0YXJ0IC8gKHRoaXMuYW1vdW50T2ZTdGVwcyAtIHRoaXMuemVyb0Nyb3NzaW5nKTsgLy8gYWJzb2x1dGUgc2l6ZSBvZiBhIHN0ZXAKICAgICAgICAgIHJhbmdlU3RhcnQgPSB0aGlzLnJhbmdlLnN0YXJ0OwogICAgICAgICAgcmFuZ2VFbmQgPSB0aGlzLnJhbmdlLnN0YXJ0ICsgc3RlcFNpemUgKiB0aGlzLmFtb3VudE9mU3RlcHM7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJhbmdlU3RhcnQgPSB0aGlzLnJhbmdlLnN0YXJ0OwogICAgICAgIHJhbmdlRW5kID0gdGhpcy5yYW5nZS5lbmQ7CiAgICAgIH0KICAgICAgbWluaW11bVN0ZXAgPSB0aGlzLnN0ZXBQaXhlbHM7CiAgICB9IGVsc2UgewogICAgICAvLyBjYWxjdWxhdGUgcmFuZ2UgYW5kIHN0ZXAgKHN0ZXAgc3VjaCB0aGF0IHdlIGhhdmUgc3BhY2UgZm9yIDcgY2hhcmFjdGVycyBwZXIgbGFiZWwpCiAgICAgIG1pbmltdW1TdGVwID0gdGhpcy5wcm9wcy5tYWpvckNoYXJIZWlnaHQ7CiAgICAgIHJhbmdlU3RhcnQgPSB0aGlzLnJhbmdlLnN0YXJ0OwogICAgICByYW5nZUVuZCA9IHRoaXMucmFuZ2UuZW5kOwogICAgfQoKICAgIHRoaXMuc3RlcCA9IHN0ZXAgPSBuZXcgRGF0YVN0ZXAocmFuZ2VTdGFydCwgcmFuZ2VFbmQsIG1pbmltdW1TdGVwLCB0aGlzLmRvbS5mcmFtZS5vZmZzZXRIZWlnaHQsIHRoaXMub3B0aW9uc1t0aGlzLm9wdGlvbnMub3JpZW50YXRpb25dLnJhbmdlLCB0aGlzLm9wdGlvbnNbdGhpcy5vcHRpb25zLm9yaWVudGF0aW9uXS5mb3JtYXQsIHRoaXMubWFzdGVyID09PSBmYWxzZSAmJiB0aGlzLm9wdGlvbnMuYWxpZ25aZXJvcyAvLyBkb2VzIHRoZSBzdGVwIGhhdmUgdG8gYWxpZ24gemVyb3M/IG9ubHkgaWYgbm90IG1hc3RlciBhbmQgdGhlIG9wdGlvbnMgaXMgb24KICAgICk7CgogICAgLy8gdGhlIHNsYXZlIGF4aXMgbmVlZHMgdG8gdXNlIHRoZSBzYW1lIGhvcml6b250YWwgbGluZXMgYXMgdGhlIG1hc3RlciBheGlzLgogICAgaWYgKHRoaXMubWFzdGVyID09PSB0cnVlKSB7CiAgICAgIHRoaXMuc3RlcFBpeGVscyA9IHRoaXMuZG9tLmZyYW1lLm9mZnNldEhlaWdodCAvIHN0ZXAubWFyZ2luUmFuZ2UgKiBzdGVwLnN0ZXA7CiAgICAgIHRoaXMuYW1vdW50T2ZTdGVwcyA9IE1hdGguY2VpbCh0aGlzLmRvbS5mcmFtZS5vZmZzZXRIZWlnaHQgLyB0aGlzLnN0ZXBQaXhlbHMpOwogICAgfSBlbHNlIHsKICAgICAgLy8gYWxpZ24gd2l0aCB6ZXJvCiAgICAgIGlmICh0aGlzLm9wdGlvbnMuYWxpZ25aZXJvcyA9PT0gdHJ1ZSAmJiB0aGlzLnplcm9Dcm9zc2luZyAhPT0gLTEpIHsKICAgICAgICAvLyBkaXN0YW5jZSBpcyB0aGUgYW1vdW50IG9mIHN0ZXBzIGF3YXkgZnJvbSB0aGUgemVybyBjcm9zc2luZyB3ZSBhcmUuCiAgICAgICAgdmFyIGRpc3RhbmNlID0gKHN0ZXAuY3VycmVudCAtIHRoaXMuemVyb0Nyb3NzaW5nICogc3RlcC5zdGVwKSAvIHN0ZXAuc3RlcDsKICAgICAgICB0aGlzLnN0ZXAuc2hpZnQoZGlzdGFuY2UpOwogICAgICB9CiAgICB9CgogICAgLy8gdmFsdWUgYXQgdGhlIGJvdHRvbSBvZiB0aGUgU1ZHCiAgICB0aGlzLnZhbHVlQXRCb3R0b20gPSBzdGVwLm1hcmdpbkVuZDsKCiAgICB0aGlzLm1heExhYmVsU2l6ZSA9IDA7CiAgICB2YXIgeSA9IDA7IC8vIGluaXQgdmFsdWUKICAgIHZhciBzdGVwSW5kZXggPSAwOyAvLyBpbml0IHZhbHVlCiAgICB2YXIgaXNNYWpvciA9IGZhbHNlOyAvLyBpbml0IHZhbHVlCiAgICB3aGlsZSAoc3RlcEluZGV4IDwgdGhpcy5hbW91bnRPZlN0ZXBzKSB7CiAgICAgIHkgPSBNYXRoLnJvdW5kKHN0ZXBJbmRleCAqIHRoaXMuc3RlcFBpeGVscyk7CiAgICAgIGlzTWFqb3IgPSBzdGVwLmlzTWFqb3IoKTsKCiAgICAgIGlmIChzdGVwSW5kZXggPiAwICYmIHN0ZXBJbmRleCAhPT0gdGhpcy5hbW91bnRPZlN0ZXBzKSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9uc1snc2hvd01pbm9yTGFiZWxzJ10gJiYgaXNNYWpvciA9PT0gZmFsc2UgfHwgdGhpcy5tYXN0ZXIgPT09IGZhbHNlICYmIHRoaXMub3B0aW9uc1snc2hvd01pbm9yTGFiZWxzJ10gPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuX3JlZHJhd0xhYmVsKHkgLSAyLCBzdGVwLmdldEN1cnJlbnQoKSwgb3JpZW50YXRpb24sICd2aXMteS1heGlzIHZpcy1taW5vcicsIHRoaXMucHJvcHMubWlub3JDaGFySGVpZ2h0KTsKICAgICAgICB9CgogICAgICAgIGlmIChpc01ham9yICYmIHRoaXMub3B0aW9uc1snc2hvd01ham9yTGFiZWxzJ10gJiYgdGhpcy5tYXN0ZXIgPT09IHRydWUgfHwgdGhpcy5vcHRpb25zWydzaG93TWlub3JMYWJlbHMnXSA9PT0gZmFsc2UgJiYgdGhpcy5tYXN0ZXIgPT09IGZhbHNlICYmIGlzTWFqb3IgPT09IHRydWUpIHsKICAgICAgICAgIGlmICh5ID49IDApIHsKICAgICAgICAgICAgdGhpcy5fcmVkcmF3TGFiZWwoeSAtIDIsIHN0ZXAuZ2V0Q3VycmVudCgpLCBvcmllbnRhdGlvbiwgJ3Zpcy15LWF4aXMgdmlzLW1ham9yJywgdGhpcy5wcm9wcy5tYWpvckNoYXJIZWlnaHQpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5fcmVkcmF3TGluZSh5LCBvcmllbnRhdGlvbiwgJ3Zpcy1ncmlkIHZpcy1ob3Jpem9udGFsIHZpcy1tYWpvcicsIHRoaXMub3B0aW9ucy5tYWpvckxpbmVzT2Zmc2V0LCB0aGlzLnByb3BzLm1ham9yTGluZVdpZHRoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5fcmVkcmF3TGluZSh5LCBvcmllbnRhdGlvbiwgJ3Zpcy1ncmlkIHZpcy1ob3Jpem9udGFsIHZpcy1taW5vcicsIHRoaXMub3B0aW9ucy5taW5vckxpbmVzT2Zmc2V0LCB0aGlzLnByb3BzLm1pbm9yTGluZVdpZHRoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIGdldCB6ZXJvIGNyb3NzaW5nCiAgICAgIGlmICh0aGlzLm1hc3RlciA9PT0gdHJ1ZSAmJiBzdGVwLmN1cnJlbnQgPT09IDApIHsKICAgICAgICB0aGlzLnplcm9Dcm9zc2luZyA9IHN0ZXBJbmRleDsKICAgICAgfQoKICAgICAgc3RlcC5uZXh0KCk7CiAgICAgIHN0ZXBJbmRleCArPSAxOwogICAgfQoKICAgIC8vIGdldCB6ZXJvIGNyb3NzaW5nIGlmIGl0J3MgdGhlIGxhc3Qgc3RlcAogICAgaWYgKHRoaXMubWFzdGVyID09PSB0cnVlICYmIHN0ZXAuY3VycmVudCA9PT0gMCkgewogICAgICB0aGlzLnplcm9Dcm9zc2luZyA9IHN0ZXBJbmRleDsKICAgIH0KCiAgICB0aGlzLmNvbnZlcnNpb25GYWN0b3IgPSB0aGlzLnN0ZXBQaXhlbHMgLyBzdGVwLnN0ZXA7CgogICAgLy8gTm90ZSB0aGF0IHRpdGxlIGlzIHJvdGF0ZWQsIHNvIHdlJ3JlIHVzaW5nIHRoZSBoZWlnaHQsIG5vdCB3aWR0aCEKICAgIHZhciB0aXRsZVdpZHRoID0gMDsKICAgIGlmICh0aGlzLm9wdGlvbnNbb3JpZW50YXRpb25dLnRpdGxlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5vcHRpb25zW29yaWVudGF0aW9uXS50aXRsZS50ZXh0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgdGl0bGVXaWR0aCA9IHRoaXMucHJvcHMudGl0bGVDaGFySGVpZ2h0OwogICAgfQogICAgdmFyIG9mZnNldCA9IHRoaXMub3B0aW9ucy5pY29ucyA9PT0gdHJ1ZSA/IE1hdGgubWF4KHRoaXMub3B0aW9ucy5pY29uV2lkdGgsIHRpdGxlV2lkdGgpICsgdGhpcy5vcHRpb25zLmxhYmVsT2Zmc2V0WCArIDE1IDogdGl0bGVXaWR0aCArIHRoaXMub3B0aW9ucy5sYWJlbE9mZnNldFggKyAxNTsKCiAgICAvLyB0aGlzIHdpbGwgcmVzaXplIHRoZSB5QXhpcyB0byBhY2NvbW1vZGF0ZSB0aGUgbGFiZWxzLgogICAgaWYgKHRoaXMubWF4TGFiZWxTaXplID4gdGhpcy53aWR0aCAtIG9mZnNldCAmJiB0aGlzLm9wdGlvbnMudmlzaWJsZSA9PT0gdHJ1ZSkgewogICAgICB0aGlzLndpZHRoID0gdGhpcy5tYXhMYWJlbFNpemUgKyBvZmZzZXQ7CiAgICAgIHRoaXMub3B0aW9ucy53aWR0aCA9IHRoaXMud2lkdGggKyAncHgnOwogICAgICBET011dGlsLmNsZWFudXBFbGVtZW50cyh0aGlzLkRPTWVsZW1lbnRzLmxpbmVzKTsKICAgICAgRE9NdXRpbC5jbGVhbnVwRWxlbWVudHModGhpcy5ET01lbGVtZW50cy5sYWJlbHMpOwogICAgICB0aGlzLnJlZHJhdygpOwogICAgICByZXNpemVkID0gdHJ1ZTsKICAgIH0KICAgIC8vIHRoaXMgd2lsbCByZXNpemUgdGhlIHlBeGlzIGlmIGl0IGlzIHRvbyBiaWcgZm9yIHRoZSBsYWJlbHMuCiAgICBlbHNlIGlmICh0aGlzLm1heExhYmVsU2l6ZSA8IHRoaXMud2lkdGggLSBvZmZzZXQgJiYgdGhpcy5vcHRpb25zLnZpc2libGUgPT09IHRydWUgJiYgdGhpcy53aWR0aCA+IHRoaXMubWluV2lkdGgpIHsKICAgICAgdGhpcy53aWR0aCA9IE1hdGgubWF4KHRoaXMubWluV2lkdGgsIHRoaXMubWF4TGFiZWxTaXplICsgb2Zmc2V0KTsKICAgICAgdGhpcy5vcHRpb25zLndpZHRoID0gdGhpcy53aWR0aCArICdweCc7CiAgICAgIERPTXV0aWwuY2xlYW51cEVsZW1lbnRzKHRoaXMuRE9NZWxlbWVudHMubGluZXMpOwogICAgICBET011dGlsLmNsZWFudXBFbGVtZW50cyh0aGlzLkRPTWVsZW1lbnRzLmxhYmVscyk7CiAgICAgIHRoaXMucmVkcmF3KCk7CiAgICAgIHJlc2l6ZWQgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgRE9NdXRpbC5jbGVhbnVwRWxlbWVudHModGhpcy5ET01lbGVtZW50cy5saW5lcyk7CiAgICAgIERPTXV0aWwuY2xlYW51cEVsZW1lbnRzKHRoaXMuRE9NZWxlbWVudHMubGFiZWxzKTsKICAgICAgcmVzaXplZCA9IGZhbHNlOwogICAgfQoKICAgIHJldHVybiByZXNpemVkOwogIH07CgogIERhdGFBeGlzLnByb3RvdHlwZS5jb252ZXJ0VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHZhciBpbnZlcnRlZFZhbHVlID0gdGhpcy52YWx1ZUF0Qm90dG9tIC0gdmFsdWU7CiAgICB2YXIgY29udmVydGVkVmFsdWUgPSBpbnZlcnRlZFZhbHVlICogdGhpcy5jb252ZXJzaW9uRmFjdG9yOwogICAgcmV0dXJuIGNvbnZlcnRlZFZhbHVlOwogIH07CgogIERhdGFBeGlzLnByb3RvdHlwZS5zY3JlZW5Ub1ZhbHVlID0gZnVuY3Rpb24gKHgpIHsKICAgIHJldHVybiB0aGlzLnZhbHVlQXRCb3R0b20gLSB4IC8gdGhpcy5jb252ZXJzaW9uRmFjdG9yOwogIH07CgogIC8qKgogICAqIENyZWF0ZSBhIGxhYmVsIGZvciB0aGUgYXhpcyBhdCBwb3NpdGlvbiB4CiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0geQogICAqIEBwYXJhbSB0ZXh0CiAgICogQHBhcmFtIG9yaWVudGF0aW9uCiAgICogQHBhcmFtIGNsYXNzTmFtZQogICAqIEBwYXJhbSBjaGFyYWN0ZXJIZWlnaHQKICAgKi8KICBEYXRhQXhpcy5wcm90b3R5cGUuX3JlZHJhd0xhYmVsID0gZnVuY3Rpb24gKHksIHRleHQsIG9yaWVudGF0aW9uLCBjbGFzc05hbWUsIGNoYXJhY3RlckhlaWdodCkgewogICAgLy8gcmV1c2UgcmVkdW5kYW50IGxhYmVsCiAgICB2YXIgbGFiZWwgPSBET011dGlsLmdldERPTUVsZW1lbnQoJ2RpdicsIHRoaXMuRE9NZWxlbWVudHMubGFiZWxzLCB0aGlzLmRvbS5mcmFtZSk7IC8vdGhpcy5kb20ucmVkdW5kYW50LmxhYmVscy5zaGlmdCgpOwogICAgbGFiZWwuY2xhc3NOYW1lID0gY2xhc3NOYW1lOwogICAgbGFiZWwuaW5uZXJIVE1MID0gdGV4dDsKICAgIGlmIChvcmllbnRhdGlvbiA9PT0gJ2xlZnQnKSB7CiAgICAgIGxhYmVsLnN0eWxlLmxlZnQgPSAnLScgKyB0aGlzLm9wdGlvbnMubGFiZWxPZmZzZXRYICsgJ3B4JzsKICAgICAgbGFiZWwuc3R5bGUudGV4dEFsaWduID0gJ3JpZ2h0JzsKICAgIH0gZWxzZSB7CiAgICAgIGxhYmVsLnN0eWxlLnJpZ2h0ID0gJy0nICsgdGhpcy5vcHRpb25zLmxhYmVsT2Zmc2V0WCArICdweCc7CiAgICAgIGxhYmVsLnN0eWxlLnRleHRBbGlnbiA9ICdsZWZ0JzsKICAgIH0KCiAgICBsYWJlbC5zdHlsZS50b3AgPSB5IC0gMC41ICogY2hhcmFjdGVySGVpZ2h0ICsgdGhpcy5vcHRpb25zLmxhYmVsT2Zmc2V0WSArICdweCc7CgogICAgdGV4dCArPSAnJzsKCiAgICB2YXIgbGFyZ2VzdFdpZHRoID0gTWF0aC5tYXgodGhpcy5wcm9wcy5tYWpvckNoYXJXaWR0aCwgdGhpcy5wcm9wcy5taW5vckNoYXJXaWR0aCk7CiAgICBpZiAodGhpcy5tYXhMYWJlbFNpemUgPCB0ZXh0Lmxlbmd0aCAqIGxhcmdlc3RXaWR0aCkgewogICAgICB0aGlzLm1heExhYmVsU2l6ZSA9IHRleHQubGVuZ3RoICogbGFyZ2VzdFdpZHRoOwogICAgfQogIH07CgogIC8qKgogICAqIENyZWF0ZSBhIG1pbm9yIGxpbmUgZm9yIHRoZSBheGlzIGF0IHBvc2l0aW9uIHkKICAgKiBAcGFyYW0geQogICAqIEBwYXJhbSBvcmllbnRhdGlvbgogICAqIEBwYXJhbSBjbGFzc05hbWUKICAgKiBAcGFyYW0gb2Zmc2V0CiAgICogQHBhcmFtIHdpZHRoCiAgICovCiAgRGF0YUF4aXMucHJvdG90eXBlLl9yZWRyYXdMaW5lID0gZnVuY3Rpb24gKHksIG9yaWVudGF0aW9uLCBjbGFzc05hbWUsIG9mZnNldCwgd2lkdGgpIHsKICAgIGlmICh0aGlzLm1hc3RlciA9PT0gdHJ1ZSkgewogICAgICB2YXIgbGluZSA9IERPTXV0aWwuZ2V0RE9NRWxlbWVudCgnZGl2JywgdGhpcy5ET01lbGVtZW50cy5saW5lcywgdGhpcy5kb20ubGluZUNvbnRhaW5lcik7IC8vdGhpcy5kb20ucmVkdW5kYW50LmxpbmVzLnNoaWZ0KCk7CiAgICAgIGxpbmUuY2xhc3NOYW1lID0gY2xhc3NOYW1lOwogICAgICBsaW5lLmlubmVySFRNTCA9ICcnOwoKICAgICAgaWYgKG9yaWVudGF0aW9uID09PSAnbGVmdCcpIHsKICAgICAgICBsaW5lLnN0eWxlLmxlZnQgPSB0aGlzLndpZHRoIC0gb2Zmc2V0ICsgJ3B4JzsKICAgICAgfSBlbHNlIHsKICAgICAgICBsaW5lLnN0eWxlLnJpZ2h0ID0gdGhpcy53aWR0aCAtIG9mZnNldCArICdweCc7CiAgICAgIH0KCiAgICAgIGxpbmUuc3R5bGUud2lkdGggPSB3aWR0aCArICdweCc7CiAgICAgIGxpbmUuc3R5bGUudG9wID0geSArICdweCc7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ3JlYXRlIGEgdGl0bGUgZm9yIHRoZSBheGlzCiAgICogQHByaXZhdGUKICAgKiBAcGFyYW0gb3JpZW50YXRpb24KICAgKi8KICBEYXRhQXhpcy5wcm90b3R5cGUuX3JlZHJhd1RpdGxlID0gZnVuY3Rpb24gKG9yaWVudGF0aW9uKSB7CiAgICBET011dGlsLnByZXBhcmVFbGVtZW50cyh0aGlzLkRPTWVsZW1lbnRzLnRpdGxlKTsKCiAgICAvLyBDaGVjayBpZiB0aGUgdGl0bGUgaXMgZGVmaW5lZCBmb3IgdGhpcyBheGVzCiAgICBpZiAodGhpcy5vcHRpb25zW29yaWVudGF0aW9uXS50aXRsZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMub3B0aW9uc1tvcmllbnRhdGlvbl0udGl0bGUudGV4dCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhciB0aXRsZSA9IERPTXV0aWwuZ2V0RE9NRWxlbWVudCgnZGl2JywgdGhpcy5ET01lbGVtZW50cy50aXRsZSwgdGhpcy5kb20uZnJhbWUpOwogICAgICB0aXRsZS5jbGFzc05hbWUgPSAndmlzLXktYXhpcyB2aXMtdGl0bGUgdmlzLScgKyBvcmllbnRhdGlvbjsKICAgICAgdGl0bGUuaW5uZXJIVE1MID0gdGhpcy5vcHRpb25zW29yaWVudGF0aW9uXS50aXRsZS50ZXh0OwoKICAgICAgLy8gQWRkIHN0eWxlIC0gaWYgcHJvdmlkZWQKICAgICAgaWYgKHRoaXMub3B0aW9uc1tvcmllbnRhdGlvbl0udGl0bGUuc3R5bGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHV0aWwuYWRkQ3NzVGV4dCh0aXRsZSwgdGhpcy5vcHRpb25zW29yaWVudGF0aW9uXS50aXRsZS5zdHlsZSk7CiAgICAgIH0KCiAgICAgIGlmIChvcmllbnRhdGlvbiA9PT0gJ2xlZnQnKSB7CiAgICAgICAgdGl0bGUuc3R5bGUubGVmdCA9IHRoaXMucHJvcHMudGl0bGVDaGFySGVpZ2h0ICsgJ3B4JzsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aXRsZS5zdHlsZS5yaWdodCA9IHRoaXMucHJvcHMudGl0bGVDaGFySGVpZ2h0ICsgJ3B4JzsKICAgICAgfQoKICAgICAgdGl0bGUuc3R5bGUud2lkdGggPSB0aGlzLmhlaWdodCArICdweCc7CiAgICB9CgogICAgLy8gd2UgbmVlZCB0byBjbGVhbiB1cCBpbiBjYXNlIHdlIGRpZCBub3QgdXNlIGFsbCBlbGVtZW50cy4KICAgIERPTXV0aWwuY2xlYW51cEVsZW1lbnRzKHRoaXMuRE9NZWxlbWVudHMudGl0bGUpOwogIH07CgogIC8qKgogICAqIERldGVybWluZSB0aGUgc2l6ZSBvZiB0ZXh0IG9uIHRoZSBheGlzIChib3RoIG1ham9yIGFuZCBtaW5vciBheGlzKS4KICAgKiBUaGUgc2l6ZSBpcyBjYWxjdWxhdGVkIG9ubHkgb25jZSBhbmQgdGhlbiBjYWNoZWQgaW4gdGhpcy5wcm9wcy4KICAgKiBAcHJpdmF0ZQogICAqLwogIERhdGFBeGlzLnByb3RvdHlwZS5fY2FsY3VsYXRlQ2hhclNpemUgPSBmdW5jdGlvbiAoKSB7CiAgICAvLyBkZXRlcm1pbmUgdGhlIGNoYXIgd2lkdGggYW5kIGhlaWdodCBvbiB0aGUgbWlub3IgYXhpcwogICAgaWYgKCEoJ21pbm9yQ2hhckhlaWdodCcgaW4gdGhpcy5wcm9wcykpIHsKICAgICAgdmFyIHRleHRNaW5vciA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcwJyk7CiAgICAgIHZhciBtZWFzdXJlQ2hhck1pbm9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIG1lYXN1cmVDaGFyTWlub3IuY2xhc3NOYW1lID0gJ3Zpcy15LWF4aXMgdmlzLW1pbm9yIHZpcy1tZWFzdXJlJzsKICAgICAgbWVhc3VyZUNoYXJNaW5vci5hcHBlbmRDaGlsZCh0ZXh0TWlub3IpOwogICAgICB0aGlzLmRvbS5mcmFtZS5hcHBlbmRDaGlsZChtZWFzdXJlQ2hhck1pbm9yKTsKCiAgICAgIHRoaXMucHJvcHMubWlub3JDaGFySGVpZ2h0ID0gbWVhc3VyZUNoYXJNaW5vci5jbGllbnRIZWlnaHQ7CiAgICAgIHRoaXMucHJvcHMubWlub3JDaGFyV2lkdGggPSBtZWFzdXJlQ2hhck1pbm9yLmNsaWVudFdpZHRoOwoKICAgICAgdGhpcy5kb20uZnJhbWUucmVtb3ZlQ2hpbGQobWVhc3VyZUNoYXJNaW5vcik7CiAgICB9CgogICAgaWYgKCEoJ21ham9yQ2hhckhlaWdodCcgaW4gdGhpcy5wcm9wcykpIHsKICAgICAgdmFyIHRleHRNYWpvciA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcwJyk7CiAgICAgIHZhciBtZWFzdXJlQ2hhck1ham9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIG1lYXN1cmVDaGFyTWFqb3IuY2xhc3NOYW1lID0gJ3Zpcy15LWF4aXMgdmlzLW1ham9yIHZpcy1tZWFzdXJlJzsKICAgICAgbWVhc3VyZUNoYXJNYWpvci5hcHBlbmRDaGlsZCh0ZXh0TWFqb3IpOwogICAgICB0aGlzLmRvbS5mcmFtZS5hcHBlbmRDaGlsZChtZWFzdXJlQ2hhck1ham9yKTsKCiAgICAgIHRoaXMucHJvcHMubWFqb3JDaGFySGVpZ2h0ID0gbWVhc3VyZUNoYXJNYWpvci5jbGllbnRIZWlnaHQ7CiAgICAgIHRoaXMucHJvcHMubWFqb3JDaGFyV2lkdGggPSBtZWFzdXJlQ2hhck1ham9yLmNsaWVudFdpZHRoOwoKICAgICAgdGhpcy5kb20uZnJhbWUucmVtb3ZlQ2hpbGQobWVhc3VyZUNoYXJNYWpvcik7CiAgICB9CgogICAgaWYgKCEoJ3RpdGxlQ2hhckhlaWdodCcgaW4gdGhpcy5wcm9wcykpIHsKICAgICAgdmFyIHRleHRUaXRsZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcwJyk7CiAgICAgIHZhciBtZWFzdXJlQ2hhclRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIG1lYXN1cmVDaGFyVGl0bGUuY2xhc3NOYW1lID0gJ3Zpcy15LWF4aXMgdmlzLXRpdGxlIHZpcy1tZWFzdXJlJzsKICAgICAgbWVhc3VyZUNoYXJUaXRsZS5hcHBlbmRDaGlsZCh0ZXh0VGl0bGUpOwogICAgICB0aGlzLmRvbS5mcmFtZS5hcHBlbmRDaGlsZChtZWFzdXJlQ2hhclRpdGxlKTsKCiAgICAgIHRoaXMucHJvcHMudGl0bGVDaGFySGVpZ2h0ID0gbWVhc3VyZUNoYXJUaXRsZS5jbGllbnRIZWlnaHQ7CiAgICAgIHRoaXMucHJvcHMudGl0bGVDaGFyV2lkdGggPSBtZWFzdXJlQ2hhclRpdGxlLmNsaWVudFdpZHRoOwoKICAgICAgdGhpcy5kb20uZnJhbWUucmVtb3ZlQ2hpbGQobWVhc3VyZUNoYXJUaXRsZSk7CiAgICB9CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBEYXRhQXhpczsKCi8qKiovIH0sCi8qIDUyICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKICAvKioKICAgKiBAY29uc3RydWN0b3IgIERhdGFTdGVwCiAgICogVGhlIGNsYXNzIERhdGFTdGVwIGlzIGFuIGl0ZXJhdG9yIGZvciBkYXRhIGZvciB0aGUgbGluZUdyYXBoLiBZb3UgcHJvdmlkZSBhIHN0YXJ0IGRhdGEgcG9pbnQgYW5kIGFuCiAgICogZW5kIGRhdGEgcG9pbnQuIFRoZSBjbGFzcyBpdHNlbGYgZGV0ZXJtaW5lcyB0aGUgYmVzdCBzY2FsZSAoc3RlcCBzaXplKSBiYXNlZCBvbiB0aGUKICAgKiBwcm92aWRlZCBzdGFydCBEYXRlLCBlbmQgRGF0ZSwgYW5kIG1pbmltdW1TdGVwLgogICAqCiAgICogSWYgbWluaW11bVN0ZXAgaXMgcHJvdmlkZWQsIHRoZSBzdGVwIHNpemUgaXMgY2hvc2VuIGFzIGNsb3NlIGFzIHBvc3NpYmxlCiAgICogdG8gdGhlIG1pbmltdW1TdGVwIGJ1dCBsYXJnZXIgdGhhbiBtaW5pbXVtU3RlcC4gSWYgbWluaW11bVN0ZXAgaXMgbm90CiAgICogcHJvdmlkZWQsIHRoZSBzY2FsZSBpcyBzZXQgdG8gMSBEQVkuCiAgICogVGhlIG1pbmltdW1TdGVwIHNob3VsZCBjb3JyZXNwb25kIHdpdGggdGhlIG9uc2NyZWVuIHNpemUgb2YgYWJvdXQgNiBjaGFyYWN0ZXJzCiAgICoKICAgKiBBbHRlcm5hdGl2ZWx5LCB5b3UgY2FuIHNldCBhIHNjYWxlIGJ5IGhhbmQuCiAgICogQWZ0ZXIgY3JlYXRpb24sIHlvdSBjYW4gaW5pdGlhbGl6ZSB0aGUgY2xhc3MgYnkgZXhlY3V0aW5nIGZpcnN0KCkuIFRoZW4geW91CiAgICogY2FuIGl0ZXJhdGUgZnJvbSB0aGUgc3RhcnQgZGF0ZSB0byB0aGUgZW5kIGRhdGUgdmlhIG5leHQoKS4gWW91IGNhbiBjaGVjayBpZgogICAqIHRoZSBlbmQgZGF0ZSBpcyByZWFjaGVkIHdpdGggdGhlIGZ1bmN0aW9uIGhhc05leHQoKS4gQWZ0ZXIgZWFjaCBzdGVwLCB5b3UgY2FuCiAgICogcmV0cmlldmUgdGhlIGN1cnJlbnQgZGF0ZSB2aWEgZ2V0Q3VycmVudCgpLgogICAqIFRoZSBEYXRhU3RlcCBoYXMgc2NhbGVzIHJhbmdpbmcgZnJvbSBtaWxsaXNlY29uZHMsIHNlY29uZHMsIG1pbnV0ZXMsIGhvdXJzLAogICAqIGRheXMsIHRvIHllYXJzLgogICAqCiAgICogVmVyc2lvbjogMS4yCiAgICoKICAgKiBAcGFyYW0ge0RhdGV9IFtzdGFydF0gICAgICAgICBUaGUgc3RhcnQgZGF0ZSwgZm9yIGV4YW1wbGUgbmV3IERhdGUoMjAxMCwgOSwgMjEpCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3IgbmV3IERhdGUoMjAxMCwgOSwgMjEsIDIzLCA0NSwgMDApCiAgICogQHBhcmFtIHtEYXRlfSBbZW5kXSAgICAgICAgICAgVGhlIGVuZCBkYXRlCiAgICogQHBhcmFtIHtOdW1iZXJ9IFttaW5pbXVtU3RlcF0gT3B0aW9uYWwuIE1pbmltdW0gc3RlcCBzaXplIGluIG1pbGxpc2Vjb25kcwogICAqLwogICd1c2Ugc3RyaWN0JzsKCiAgZnVuY3Rpb24gRGF0YVN0ZXAoc3RhcnQsIGVuZCwgbWluaW11bVN0ZXAsIGNvbnRhaW5lckhlaWdodCwgY3VzdG9tUmFuZ2UsIGZvcm1hdHRpbmdGdW5jdGlvbiwgYWxpZ25aZXJvcykgewogICAgLy8gdmFyaWFibGVzCiAgICB0aGlzLmN1cnJlbnQgPSAwOwoKICAgIHRoaXMuYXV0b1NjYWxlID0gdHJ1ZTsKICAgIHRoaXMuc3RlcEluZGV4ID0gMDsKICAgIHRoaXMuc3RlcCA9IDE7CiAgICB0aGlzLnNjYWxlID0gMTsKICAgIHRoaXMuZm9ybWF0dGluZ0Z1bmN0aW9uID0gZm9ybWF0dGluZ0Z1bmN0aW9uOwoKICAgIHRoaXMubWFyZ2luU3RhcnQ7CiAgICB0aGlzLm1hcmdpbkVuZDsKICAgIHRoaXMuZGVhZFNwYWNlID0gMDsKCiAgICB0aGlzLm1ham9yU3RlcHMgPSBbMSwgMiwgNSwgMTBdOwogICAgdGhpcy5taW5vclN0ZXBzID0gWzAuMjUsIDAuNSwgMSwgMl07CgogICAgdGhpcy5hbGlnblplcm9zID0gYWxpZ25aZXJvczsKCiAgICB0aGlzLnNldFJhbmdlKHN0YXJ0LCBlbmQsIG1pbmltdW1TdGVwLCBjb250YWluZXJIZWlnaHQsIGN1c3RvbVJhbmdlKTsKICB9CgogIC8qKgogICAqIFNldCBhIG5ldyByYW5nZQogICAqIElmIG1pbmltdW1TdGVwIGlzIHByb3ZpZGVkLCB0aGUgc3RlcCBzaXplIGlzIGNob3NlbiBhcyBjbG9zZSBhcyBwb3NzaWJsZQogICAqIHRvIHRoZSBtaW5pbXVtU3RlcCBidXQgbGFyZ2VyIHRoYW4gbWluaW11bVN0ZXAuIElmIG1pbmltdW1TdGVwIGlzIG5vdAogICAqIHByb3ZpZGVkLCB0aGUgc2NhbGUgaXMgc2V0IHRvIDEgREFZLgogICAqIFRoZSBtaW5pbXVtU3RlcCBzaG91bGQgY29ycmVzcG9uZCB3aXRoIHRoZSBvbnNjcmVlbiBzaXplIG9mIGFib3V0IDYgY2hhcmFjdGVycwogICAqIEBwYXJhbSB7TnVtYmVyfSBbc3RhcnRdICAgICAgVGhlIHN0YXJ0IGRhdGUgYW5kIHRpbWUuCiAgICogQHBhcmFtIHtOdW1iZXJ9IFtlbmRdICAgICAgICBUaGUgZW5kIGRhdGUgYW5kIHRpbWUuCiAgICogQHBhcmFtIHtOdW1iZXJ9IFttaW5pbXVtU3RlcF0gT3B0aW9uYWwuIE1pbmltdW0gc3RlcCBzaXplIGluIG1pbGxpc2Vjb25kcwogICAqLwogIERhdGFTdGVwLnByb3RvdHlwZS5zZXRSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCwgZW5kLCBtaW5pbXVtU3RlcCwgY29udGFpbmVySGVpZ2h0LCBjdXN0b21SYW5nZSkgewogICAgdGhpcy5fc3RhcnQgPSBjdXN0b21SYW5nZS5taW4gPT09IHVuZGVmaW5lZCA/IHN0YXJ0IDogY3VzdG9tUmFuZ2UubWluOwogICAgdGhpcy5fZW5kID0gY3VzdG9tUmFuZ2UubWF4ID09PSB1bmRlZmluZWQgPyBlbmQgOiBjdXN0b21SYW5nZS5tYXg7CiAgICBpZiAodGhpcy5fc3RhcnQgPT09IHRoaXMuX2VuZCkgewogICAgICB0aGlzLl9zdGFydCA9IGN1c3RvbVJhbmdlLm1pbiA9PT0gdW5kZWZpbmVkID8gdGhpcy5fc3RhcnQgLSAwLjc1IDogdGhpcy5fc3RhcnQ7CiAgICAgIHRoaXMuX2VuZCA9IGN1c3RvbVJhbmdlLm1heCA9PT0gdW5kZWZpbmVkID8gdGhpcy5fZW5kICsgMSA6IHRoaXMuX2VuZDs7CiAgICB9CgogICAgaWYgKHRoaXMuYXV0b1NjYWxlID09PSB0cnVlKSB7CiAgICAgIHRoaXMuc2V0TWluaW11bVN0ZXAobWluaW11bVN0ZXAsIGNvbnRhaW5lckhlaWdodCk7CiAgICB9CgogICAgdGhpcy5zZXRGaXJzdChjdXN0b21SYW5nZSk7CiAgfTsKCiAgLyoqCiAgICogQXV0b21hdGljYWxseSBkZXRlcm1pbmUgdGhlIHNjYWxlIHRoYXQgYmVzdHMgZml0cyB0aGUgcHJvdmlkZWQgbWluaW11bSBzdGVwCiAgICogQHBhcmFtIHtOdW1iZXJ9IFttaW5pbXVtU3RlcF0gIFRoZSBtaW5pbXVtIHN0ZXAgc2l6ZSBpbiBwaXhlbHMKICAgKi8KICBEYXRhU3RlcC5wcm90b3R5cGUuc2V0TWluaW11bVN0ZXAgPSBmdW5jdGlvbiAobWluaW11bVN0ZXAsIGNvbnRhaW5lckhlaWdodCkgewogICAgLy8gcm91bmQgdG8gZmxvb3IKICAgIHZhciByYW5nZSA9IHRoaXMuX2VuZCAtIHRoaXMuX3N0YXJ0OwogICAgdmFyIHNhZmVSYW5nZSA9IHJhbmdlICogMS4yOwogICAgdmFyIG1pbmltdW1TdGVwVmFsdWUgPSBtaW5pbXVtU3RlcCAqIChzYWZlUmFuZ2UgLyBjb250YWluZXJIZWlnaHQpOwogICAgdmFyIG9yZGVyT2ZNYWduaXR1ZGUgPSBNYXRoLnJvdW5kKE1hdGgubG9nKHNhZmVSYW5nZSkgLyBNYXRoLkxOMTApOwoKICAgIHZhciBtaW5vclN0ZXBJZHggPSAtMTsKICAgIHZhciBtYWduaXR1ZGVmYWN0b3IgPSBNYXRoLnBvdygxMCwgb3JkZXJPZk1hZ25pdHVkZSk7CgogICAgdmFyIHN0YXJ0ID0gMDsKICAgIGlmIChvcmRlck9mTWFnbml0dWRlIDwgMCkgewogICAgICBzdGFydCA9IG9yZGVyT2ZNYWduaXR1ZGU7CiAgICB9CgogICAgdmFyIHNvbHV0aW9uRm91bmQgPSBmYWxzZTsKICAgIGZvciAodmFyIGkgPSBzdGFydDsgTWF0aC5hYnMoaSkgPD0gTWF0aC5hYnMob3JkZXJPZk1hZ25pdHVkZSk7IGkrKykgewogICAgICBtYWduaXR1ZGVmYWN0b3IgPSBNYXRoLnBvdygxMCwgaSk7CiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5taW5vclN0ZXBzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgdmFyIHN0ZXBTaXplID0gbWFnbml0dWRlZmFjdG9yICogdGhpcy5taW5vclN0ZXBzW2pdOwogICAgICAgIGlmIChzdGVwU2l6ZSA+PSBtaW5pbXVtU3RlcFZhbHVlKSB7CiAgICAgICAgICBzb2x1dGlvbkZvdW5kID0gdHJ1ZTsKICAgICAgICAgIG1pbm9yU3RlcElkeCA9IGo7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHNvbHV0aW9uRm91bmQgPT09IHRydWUpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgdGhpcy5zdGVwSW5kZXggPSBtaW5vclN0ZXBJZHg7CiAgICB0aGlzLnNjYWxlID0gbWFnbml0dWRlZmFjdG9yOwogICAgdGhpcy5zdGVwID0gbWFnbml0dWRlZmFjdG9yICogdGhpcy5taW5vclN0ZXBzW21pbm9yU3RlcElkeF07CiAgfTsKCiAgLyoqCiAgICogUm91bmQgdGhlIGN1cnJlbnQgZGF0ZSB0byB0aGUgZmlyc3QgbWlub3IgZGF0ZSB2YWx1ZQogICAqIFRoaXMgbXVzdCBiZSBleGVjdXRlZCBvbmNlIHdoZW4gdGhlIGN1cnJlbnQgZGF0ZSBpcyBzZXQgdG8gc3RhcnQgRGF0ZQogICAqLwogIERhdGFTdGVwLnByb3RvdHlwZS5zZXRGaXJzdCA9IGZ1bmN0aW9uIChjdXN0b21SYW5nZSkgewogICAgaWYgKGN1c3RvbVJhbmdlID09PSB1bmRlZmluZWQpIHsKICAgICAgY3VzdG9tUmFuZ2UgPSB7fTsKICAgIH0KCiAgICB2YXIgbmljZVN0YXJ0ID0gY3VzdG9tUmFuZ2UubWluID09PSB1bmRlZmluZWQgPyB0aGlzLl9zdGFydCAtIHRoaXMuc2NhbGUgKiAyICogdGhpcy5taW5vclN0ZXBzW3RoaXMuc3RlcEluZGV4XSA6IGN1c3RvbVJhbmdlLm1pbjsKICAgIHZhciBuaWNlRW5kID0gY3VzdG9tUmFuZ2UubWF4ID09PSB1bmRlZmluZWQgPyB0aGlzLl9lbmQgKyB0aGlzLnNjYWxlICogdGhpcy5taW5vclN0ZXBzW3RoaXMuc3RlcEluZGV4XSA6IGN1c3RvbVJhbmdlLm1heDsKCiAgICB0aGlzLm1hcmdpbkVuZCA9IGN1c3RvbVJhbmdlLm1heCA9PT0gdW5kZWZpbmVkID8gdGhpcy5yb3VuZFRvTWlub3IobmljZUVuZCkgOiBjdXN0b21SYW5nZS5tYXg7CiAgICB0aGlzLm1hcmdpblN0YXJ0ID0gY3VzdG9tUmFuZ2UubWluID09PSB1bmRlZmluZWQgPyB0aGlzLnJvdW5kVG9NaW5vcihuaWNlU3RhcnQpIDogY3VzdG9tUmFuZ2UubWluOwoKICAgIC8vIGlmIHdlIG5lZWQgdG8gYWxpZ24gdGhlIHplcm8ncyB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZXJlIGlzIGEgemVybyB0byB1c2UuCiAgICBpZiAodGhpcy5hbGlnblplcm9zID09PSB0cnVlICYmICh0aGlzLm1hcmdpbkVuZCAtIHRoaXMubWFyZ2luU3RhcnQpICUgdGhpcy5zdGVwICE9IDApIHsKICAgICAgdGhpcy5tYXJnaW5FbmQgKz0gdGhpcy5tYXJnaW5FbmQgJSB0aGlzLnN0ZXA7CiAgICB9CgogICAgdGhpcy5kZWFkU3BhY2UgPSB0aGlzLnJvdW5kVG9NaW5vcihuaWNlRW5kKSAtIG5pY2VFbmQgKyB0aGlzLnJvdW5kVG9NaW5vcihuaWNlU3RhcnQpIC0gbmljZVN0YXJ0OwogICAgdGhpcy5tYXJnaW5SYW5nZSA9IHRoaXMubWFyZ2luRW5kIC0gdGhpcy5tYXJnaW5TdGFydDsKCiAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLm1hcmdpbkVuZDsKICB9OwoKICBEYXRhU3RlcC5wcm90b3R5cGUucm91bmRUb01pbm9yID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICB2YXIgcm91bmRlZCA9IHZhbHVlIC0gdmFsdWUgJSAodGhpcy5zY2FsZSAqIHRoaXMubWlub3JTdGVwc1t0aGlzLnN0ZXBJbmRleF0pOwogICAgaWYgKHZhbHVlICUgKHRoaXMuc2NhbGUgKiB0aGlzLm1pbm9yU3RlcHNbdGhpcy5zdGVwSW5kZXhdKSA+IDAuNSAqICh0aGlzLnNjYWxlICogdGhpcy5taW5vclN0ZXBzW3RoaXMuc3RlcEluZGV4XSkpIHsKICAgICAgcmV0dXJuIHJvdW5kZWQgKyB0aGlzLnNjYWxlICogdGhpcy5taW5vclN0ZXBzW3RoaXMuc3RlcEluZGV4XTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiByb3VuZGVkOwogICAgfQogIH07CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSB0aGVyZSBpcyBhIG5leHQgc3RlcAogICAqIEByZXR1cm4ge2Jvb2xlYW59ICB0cnVlIGlmIHRoZSBjdXJyZW50IGRhdGUgaGFzIG5vdCBwYXNzZWQgdGhlIGVuZCBkYXRlCiAgICovCiAgRGF0YVN0ZXAucHJvdG90eXBlLmhhc05leHQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5jdXJyZW50ID49IHRoaXMubWFyZ2luU3RhcnQ7CiAgfTsKCiAgLyoqCiAgICogRG8gdGhlIG5leHQgc3RlcAogICAqLwogIERhdGFTdGVwLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHByZXYgPSB0aGlzLmN1cnJlbnQ7CiAgICB0aGlzLmN1cnJlbnQgLT0gdGhpcy5zdGVwOwoKICAgIC8vIHNhZmV0eSBtZWNoYW5pc206IGlmIGN1cnJlbnQgdGltZSBpcyBzdGlsbCB1bmNoYW5nZWQsIG1vdmUgdG8gdGhlIGVuZAogICAgaWYgKHRoaXMuY3VycmVudCA9PT0gcHJldikgewogICAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLl9lbmQ7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogRG8gdGhlIG5leHQgc3RlcAogICAqLwogIERhdGFTdGVwLnByb3RvdHlwZS5wcmV2aW91cyA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuY3VycmVudCArPSB0aGlzLnN0ZXA7CiAgICB0aGlzLm1hcmdpbkVuZCArPSB0aGlzLnN0ZXA7CiAgICB0aGlzLm1hcmdpblJhbmdlID0gdGhpcy5tYXJnaW5FbmQgLSB0aGlzLm1hcmdpblN0YXJ0OwogIH07CgogIC8qKgogICAqIEdldCB0aGUgY3VycmVudCBkYXRldGltZQogICAqIEByZXR1cm4ge1N0cmluZ30gIGN1cnJlbnQgVGhlIGN1cnJlbnQgZGF0ZQogICAqLwogIERhdGFTdGVwLnByb3RvdHlwZS5nZXRDdXJyZW50ID0gZnVuY3Rpb24gKCkgewogICAgLy8gcHJldmVudCByb3VuZC1vZmYgZXJyb3JzIHdoZW4gY2xvc2UgdG8gemVybwogICAgdmFyIGN1cnJlbnQgPSBNYXRoLmFicyh0aGlzLmN1cnJlbnQpIDwgdGhpcy5zdGVwIC8gMiA/IDAgOiB0aGlzLmN1cnJlbnQ7CiAgICB2YXIgcmV0dXJuVmFsdWUgPSBjdXJyZW50LnRvUHJlY2lzaW9uKDUpOwogICAgaWYgKHR5cGVvZiB0aGlzLmZvcm1hdHRpbmdGdW5jdGlvbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICByZXR1cm5WYWx1ZSA9IHRoaXMuZm9ybWF0dGluZ0Z1bmN0aW9uKGN1cnJlbnQpOwogICAgfQoKICAgIGlmICh0eXBlb2YgcmV0dXJuVmFsdWUgPT09ICdudW1iZXInKSB7CiAgICAgIHJldHVybiAnJyArIHJldHVyblZhbHVlOwogICAgfSBlbHNlIGlmICh0eXBlb2YgcmV0dXJuVmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiByZXR1cm5WYWx1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBjdXJyZW50LnRvUHJlY2lzaW9uKDUpOwogICAgfQogIH07CgogIC8qKgogICAqIENoZWNrIGlmIHRoZSBjdXJyZW50IHZhbHVlIGlzIGEgbWFqb3IgdmFsdWUgKGZvciBleGFtcGxlIHdoZW4gdGhlIHN0ZXAKICAgKiBpcyBEQVksIGEgbWFqb3IgdmFsdWUgaXMgZWFjaCBmaXJzdCBkYXkgb2YgdGhlIE1PTlRIKQogICAqIEByZXR1cm4ge2Jvb2xlYW59IHRydWUgaWYgY3VycmVudCBkYXRlIGlzIG1ham9yLCBlbHNlIGZhbHNlLgogICAqLwogIERhdGFTdGVwLnByb3RvdHlwZS5pc01ham9yID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuY3VycmVudCAlICh0aGlzLnNjYWxlICogdGhpcy5tYWpvclN0ZXBzW3RoaXMuc3RlcEluZGV4XSkgPT09IDA7CiAgfTsKCiAgRGF0YVN0ZXAucHJvdG90eXBlLnNoaWZ0ID0gZnVuY3Rpb24gKHN0ZXBzKSB7CiAgICBpZiAoc3RlcHMgPCAwKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgLXN0ZXBzOyBpKyspIHsKICAgICAgICB0aGlzLnByZXZpb3VzKCk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoc3RlcHMgPiAwKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RlcHM7IGkrKykgewogICAgICAgIHRoaXMubmV4dCgpOwogICAgICB9CiAgICB9CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBEYXRhU3RlcDsKCi8qKiovIH0sCi8qIDUzICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKICB2YXIgRE9NdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7CiAgdmFyIExpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU0KTsKICB2YXIgQmFyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1Nik7CiAgdmFyIFBvaW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTUpOwoKICAvKioKICAgKiAvKioKICAgKiBAcGFyYW0ge29iamVjdH0gZ3JvdXAgICAgICAgICAgICB8IHRoZSBvYmplY3Qgb2YgdGhlIGdyb3VwIGZyb20gdGhlIGRhdGFzZXQKICAgKiBAcGFyYW0ge3N0cmluZ30gZ3JvdXBJZCAgICAgICAgICB8IElEIG9mIHRoZSBncm91cAogICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zICAgICAgICAgIHwgdGhlIGRlZmF1bHQgb3B0aW9ucwogICAqIEBwYXJhbSB7YXJyYXl9IGdyb3Vwc1VzaW5nRGVmYXVsdFN0eWxlcyAgfCB0aGlzIGFycmF5IGhhcyBvbmUgZW50cmVlLgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJdCBpcyBwYXNzZWQgYXMgYW4gYXJyYXkgc28gaXQgaXMgcGFzc2VkIGJ5IHJlZmVyZW5jZS4KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSXQgZW51bWVyYXRlcyB0aHJvdWdoIHRoZSBkZWZhdWx0IHN0eWxlcwogICAqIEBjb25zdHJ1Y3RvcgogICAqLwogIGZ1bmN0aW9uIEdyYXBoR3JvdXAoZ3JvdXAsIGdyb3VwSWQsIG9wdGlvbnMsIGdyb3Vwc1VzaW5nRGVmYXVsdFN0eWxlcykgewogICAgdGhpcy5pZCA9IGdyb3VwSWQ7CiAgICB2YXIgZmllbGRzID0gWydzYW1wbGluZycsICdzdHlsZScsICdzb3J0JywgJ3lBeGlzT3JpZW50YXRpb24nLCAnYmFyQ2hhcnQnLCAnZHJhd1BvaW50cycsICdzaGFkZWQnLCAnaW50ZXJwb2xhdGlvbiddOwogICAgdGhpcy5vcHRpb25zID0gdXRpbC5zZWxlY3RpdmVCcmlkZ2VPYmplY3QoZmllbGRzLCBvcHRpb25zKTsKICAgIHRoaXMudXNpbmdEZWZhdWx0U3R5bGUgPSBncm91cC5jbGFzc05hbWUgPT09IHVuZGVmaW5lZDsKICAgIHRoaXMuZ3JvdXBzVXNpbmdEZWZhdWx0U3R5bGVzID0gZ3JvdXBzVXNpbmdEZWZhdWx0U3R5bGVzOwogICAgdGhpcy56ZXJvUG9zaXRpb24gPSAwOwogICAgdGhpcy51cGRhdGUoZ3JvdXApOwogICAgaWYgKHRoaXMudXNpbmdEZWZhdWx0U3R5bGUgPT0gdHJ1ZSkgewogICAgICB0aGlzLmdyb3Vwc1VzaW5nRGVmYXVsdFN0eWxlc1swXSArPSAxOwogICAgfQogICAgdGhpcy5pdGVtc0RhdGEgPSBbXTsKICAgIHRoaXMudmlzaWJsZSA9IGdyb3VwLnZpc2libGUgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBncm91cC52aXNpYmxlOwogIH0KCiAgLyoqCiAgICogdGhpcyBsb2FkcyBhIHJlZmVyZW5jZSB0byBhbGwgaXRlbXMgaW4gdGhpcyBncm91cCBpbnRvIHRoaXMgZ3JvdXAuCiAgICogQHBhcmFtIHthcnJheX0gaXRlbXMKICAgKi8KICBHcmFwaEdyb3VwLnByb3RvdHlwZS5zZXRJdGVtcyA9IGZ1bmN0aW9uIChpdGVtcykgewogICAgaWYgKGl0ZW1zICE9IG51bGwpIHsKICAgICAgdGhpcy5pdGVtc0RhdGEgPSBpdGVtczsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5zb3J0ID09IHRydWUpIHsKICAgICAgICB0aGlzLml0ZW1zRGF0YS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS54IC0gYi54OwogICAgICAgIH0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLml0ZW1zRGF0YSA9IFtdOwogICAgfQogIH07CgogIC8qKgogICAqIHRoaXMgaXMgdXNlZCBmb3IgcGxvdHRpbmcgYmFyY2hhcnRzLCB0aGlzIHdheSwgd2Ugb25seSBoYXZlIHRvIGNhbGN1bGF0ZSBpdCBvbmNlLgogICAqIEBwYXJhbSBwb3MKICAgKi8KICBHcmFwaEdyb3VwLnByb3RvdHlwZS5zZXRaZXJvUG9zaXRpb24gPSBmdW5jdGlvbiAocG9zKSB7CiAgICB0aGlzLnplcm9Qb3NpdGlvbiA9IHBvczsKICB9OwoKICAvKioKICAgKiBzZXQgdGhlIG9wdGlvbnMgb2YgdGhlIGdyYXBoIGdyb3VwIG92ZXIgdGhlIGRlZmF1bHQgb3B0aW9ucy4KICAgKiBAcGFyYW0gb3B0aW9ucwogICAqLwogIEdyYXBoR3JvdXAucHJvdG90eXBlLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgaWYgKG9wdGlvbnMgIT09IHVuZGVmaW5lZCkgewogICAgICB2YXIgZmllbGRzID0gWydzYW1wbGluZycsICdzdHlsZScsICdzb3J0JywgJ3lBeGlzT3JpZW50YXRpb24nLCAnYmFyQ2hhcnQnXTsKICAgICAgdXRpbC5zZWxlY3RpdmVEZWVwRXh0ZW5kKGZpZWxkcywgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKCiAgICAgIHV0aWwubWVyZ2VPcHRpb25zKHRoaXMub3B0aW9ucywgb3B0aW9ucywgJ2ludGVycG9sYXRpb24nKTsKICAgICAgdXRpbC5tZXJnZU9wdGlvbnModGhpcy5vcHRpb25zLCBvcHRpb25zLCAnZHJhd1BvaW50cycpOwogICAgICB1dGlsLm1lcmdlT3B0aW9ucyh0aGlzLm9wdGlvbnMsIG9wdGlvbnMsICdzaGFkZWQnKTsKCiAgICAgIGlmIChvcHRpb25zLmludGVycG9sYXRpb24pIHsKICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuaW50ZXJwb2xhdGlvbiA9PSAnb2JqZWN0JykgewogICAgICAgICAgaWYgKG9wdGlvbnMuaW50ZXJwb2xhdGlvbi5wYXJhbWV0cml6YXRpb24pIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuaW50ZXJwb2xhdGlvbi5wYXJhbWV0cml6YXRpb24gPT0gJ3VuaWZvcm0nKSB7CiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24uYWxwaGEgPSAwOwogICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuaW50ZXJwb2xhdGlvbi5wYXJhbWV0cml6YXRpb24gPT0gJ2Nob3JkYWwnKSB7CiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24uYWxwaGEgPSAxOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5pbnRlcnBvbGF0aW9uLnBhcmFtZXRyaXphdGlvbiA9ICdjZW50cmlwZXRhbCc7CiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmludGVycG9sYXRpb24uYWxwaGEgPSAwLjU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAodGhpcy5vcHRpb25zLnN0eWxlID09ICdsaW5lJykgewogICAgICB0aGlzLnR5cGUgPSBuZXcgTGluZSh0aGlzLmlkLCB0aGlzLm9wdGlvbnMpOwogICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuc3R5bGUgPT0gJ2JhcicpIHsKICAgICAgdGhpcy50eXBlID0gbmV3IEJhcih0aGlzLmlkLCB0aGlzLm9wdGlvbnMpOwogICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuc3R5bGUgPT0gJ3BvaW50cycpIHsKICAgICAgdGhpcy50eXBlID0gbmV3IFBvaW50cyh0aGlzLmlkLCB0aGlzLm9wdGlvbnMpOwogICAgfQogIH07CgogIC8qKgogICAqIHRoaXMgdXBkYXRlcyB0aGUgY3VycmVudCBncm91cCBjbGFzcyB3aXRoIHRoZSBsYXRlc3QgZ3JvdXAgZGF0YXNldCBlbnRyZWUsIHVzZWQgaW4gX3VwZGF0ZUdyb3VwIGluIGxpbmVncmFwaAogICAqIEBwYXJhbSBncm91cAogICAqLwogIEdyYXBoR3JvdXAucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChncm91cCkgewogICAgdGhpcy5ncm91cCA9IGdyb3VwOwogICAgdGhpcy5jb250ZW50ID0gZ3JvdXAuY29udGVudCB8fCAnZ3JhcGgnOwogICAgdGhpcy5jbGFzc05hbWUgPSBncm91cC5jbGFzc05hbWUgfHwgdGhpcy5jbGFzc05hbWUgfHwgJ3Zpcy1ncmFwaC1ncm91cCcgKyB0aGlzLmdyb3Vwc1VzaW5nRGVmYXVsdFN0eWxlc1swXSAlIDEwOwogICAgdGhpcy52aXNpYmxlID0gZ3JvdXAudmlzaWJsZSA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGdyb3VwLnZpc2libGU7CiAgICB0aGlzLnN0eWxlID0gZ3JvdXAuc3R5bGU7CiAgICB0aGlzLnNldE9wdGlvbnMoZ3JvdXAub3B0aW9ucyk7CiAgfTsKCiAgLyoqCiAgICogZHJhdyB0aGUgaWNvbiBmb3IgdGhlIGxlZ2VuZC4KICAgKgogICAqIEBwYXJhbSB4CiAgICogQHBhcmFtIHkKICAgKiBAcGFyYW0gSlNPTmNvbnRhaW5lcgogICAqIEBwYXJhbSBTVkdjb250YWluZXIKICAgKiBAcGFyYW0gaWNvbldpZHRoCiAgICogQHBhcmFtIGljb25IZWlnaHQKICAgKi8KICBHcmFwaEdyb3VwLnByb3RvdHlwZS5kcmF3SWNvbiA9IGZ1bmN0aW9uICh4LCB5LCBKU09OY29udGFpbmVyLCBTVkdjb250YWluZXIsIGljb25XaWR0aCwgaWNvbkhlaWdodCkgewogICAgdmFyIGZpbGxIZWlnaHQgPSBpY29uSGVpZ2h0ICogMC41OwogICAgdmFyIHBhdGgsIGZpbGxQYXRoOwoKICAgIHZhciBvdXRsaW5lID0gRE9NdXRpbC5nZXRTVkdFbGVtZW50KCdyZWN0JywgSlNPTmNvbnRhaW5lciwgU1ZHY29udGFpbmVyKTsKICAgIG91dGxpbmUuc2V0QXR0cmlidXRlTlMobnVsbCwgJ3gnLCB4KTsKICAgIG91dGxpbmUuc2V0QXR0cmlidXRlTlMobnVsbCwgJ3knLCB5IC0gZmlsbEhlaWdodCk7CiAgICBvdXRsaW5lLnNldEF0dHJpYnV0ZU5TKG51bGwsICd3aWR0aCcsIGljb25XaWR0aCk7CiAgICBvdXRsaW5lLnNldEF0dHJpYnV0ZU5TKG51bGwsICdoZWlnaHQnLCAyICogZmlsbEhlaWdodCk7CiAgICBvdXRsaW5lLnNldEF0dHJpYnV0ZU5TKG51bGwsICdjbGFzcycsICd2aXMtb3V0bGluZScpOwoKICAgIGlmICh0aGlzLm9wdGlvbnMuc3R5bGUgPT0gJ2xpbmUnKSB7CiAgICAgIHBhdGggPSBET011dGlsLmdldFNWR0VsZW1lbnQoJ3BhdGgnLCBKU09OY29udGFpbmVyLCBTVkdjb250YWluZXIpOwogICAgICBwYXRoLnNldEF0dHJpYnV0ZU5TKG51bGwsICdjbGFzcycsIHRoaXMuY2xhc3NOYW1lKTsKICAgICAgaWYgKHRoaXMuc3R5bGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHBhdGguc2V0QXR0cmlidXRlTlMobnVsbCwgJ3N0eWxlJywgdGhpcy5zdHlsZSk7CiAgICAgIH0KCiAgICAgIHBhdGguc2V0QXR0cmlidXRlTlMobnVsbCwgJ2QnLCAnTScgKyB4ICsgJywnICsgeSArICcgTCcgKyAoeCArIGljb25XaWR0aCkgKyAnLCcgKyB5ICsgJycpOwogICAgICBpZiAodGhpcy5vcHRpb25zLnNoYWRlZC5lbmFibGVkID09IHRydWUpIHsKICAgICAgICBmaWxsUGF0aCA9IERPTXV0aWwuZ2V0U1ZHRWxlbWVudCgncGF0aCcsIEpTT05jb250YWluZXIsIFNWR2NvbnRhaW5lcik7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zaGFkZWQub3JpZW50YXRpb24gPT0gJ3RvcCcpIHsKICAgICAgICAgIGZpbGxQYXRoLnNldEF0dHJpYnV0ZU5TKG51bGwsICdkJywgJ00nICsgeCArICcsICcgKyAoeSAtIGZpbGxIZWlnaHQpICsgJ0wnICsgeCArICcsJyArIHkgKyAnIEwnICsgKHggKyBpY29uV2lkdGgpICsgJywnICsgeSArICcgTCcgKyAoeCArIGljb25XaWR0aCkgKyAnLCcgKyAoeSAtIGZpbGxIZWlnaHQpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZmlsbFBhdGguc2V0QXR0cmlidXRlTlMobnVsbCwgJ2QnLCAnTScgKyB4ICsgJywnICsgeSArICcgJyArICdMJyArIHggKyAnLCcgKyAoeSArIGZpbGxIZWlnaHQpICsgJyAnICsgJ0wnICsgKHggKyBpY29uV2lkdGgpICsgJywnICsgKHkgKyBmaWxsSGVpZ2h0KSArICdMJyArICh4ICsgaWNvbldpZHRoKSArICcsJyArIHkpOwogICAgICAgIH0KICAgICAgICBmaWxsUGF0aC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAnY2xhc3MnLCB0aGlzLmNsYXNzTmFtZSArICcgdmlzLWljb24tZmlsbCcpOwogICAgICB9CgogICAgICBpZiAodGhpcy5vcHRpb25zLmRyYXdQb2ludHMuZW5hYmxlZCA9PSB0cnVlKSB7CiAgICAgICAgRE9NdXRpbC5kcmF3UG9pbnQoeCArIDAuNSAqIGljb25XaWR0aCwgeSwgdGhpcywgSlNPTmNvbnRhaW5lciwgU1ZHY29udGFpbmVyKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIGJhcldpZHRoID0gTWF0aC5yb3VuZCgwLjMgKiBpY29uV2lkdGgpOwogICAgICB2YXIgYmFyMUhlaWdodCA9IE1hdGgucm91bmQoMC40ICogaWNvbkhlaWdodCk7CiAgICAgIHZhciBiYXIySGVpZ2h0ID0gTWF0aC5yb3VuZCgwLjc1ICogaWNvbkhlaWdodCk7CgogICAgICB2YXIgb2Zmc2V0ID0gTWF0aC5yb3VuZCgoaWNvbldpZHRoIC0gMiAqIGJhcldpZHRoKSAvIDMpOwoKICAgICAgRE9NdXRpbC5kcmF3QmFyKHggKyAwLjUgKiBiYXJXaWR0aCArIG9mZnNldCwgeSArIGZpbGxIZWlnaHQgLSBiYXIxSGVpZ2h0IC0gMSwgYmFyV2lkdGgsIGJhcjFIZWlnaHQsIHRoaXMuY2xhc3NOYW1lICsgJyB2aXMtYmFyJywgSlNPTmNvbnRhaW5lciwgU1ZHY29udGFpbmVyLCB0aGlzLnN0eWxlKTsKICAgICAgRE9NdXRpbC5kcmF3QmFyKHggKyAxLjUgKiBiYXJXaWR0aCArIG9mZnNldCArIDIsIHkgKyBmaWxsSGVpZ2h0IC0gYmFyMkhlaWdodCAtIDEsIGJhcldpZHRoLCBiYXIySGVpZ2h0LCB0aGlzLmNsYXNzTmFtZSArICcgdmlzLWJhcicsIEpTT05jb250YWluZXIsIFNWR2NvbnRhaW5lciwgdGhpcy5zdHlsZSk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogcmV0dXJuIHRoZSBsZWdlbmQgZW50cmVlIGZvciB0aGlzIGdyb3VwLgogICAqCiAgICogQHBhcmFtIGljb25XaWR0aAogICAqIEBwYXJhbSBpY29uSGVpZ2h0CiAgICogQHJldHVybnMge3tpY29uOiBIVE1MRWxlbWVudCwgbGFiZWw6IChncm91cC5jb250ZW50fCp8c3RyaW5nKSwgb3JpZW50YXRpb246ICgub3B0aW9ucy55QXhpc09yaWVudGF0aW9ufCopfX0KICAgKi8KICBHcmFwaEdyb3VwLnByb3RvdHlwZS5nZXRMZWdlbmQgPSBmdW5jdGlvbiAoaWNvbldpZHRoLCBpY29uSGVpZ2h0KSB7CiAgICB2YXIgc3ZnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTsKICAgIHRoaXMuZHJhd0ljb24oMCwgMC41ICogaWNvbkhlaWdodCwgW10sIHN2ZywgaWNvbldpZHRoLCBpY29uSGVpZ2h0KTsKICAgIHJldHVybiB7IGljb246IHN2ZywgbGFiZWw6IHRoaXMuY29udGVudCwgb3JpZW50YXRpb246IHRoaXMub3B0aW9ucy55QXhpc09yaWVudGF0aW9uIH07CiAgfTsKCiAgR3JhcGhHcm91cC5wcm90b3R5cGUuZ2V0WVJhbmdlID0gZnVuY3Rpb24gKGdyb3VwRGF0YSkgewogICAgcmV0dXJuIHRoaXMudHlwZS5nZXRZUmFuZ2UoZ3JvdXBEYXRhKTsKICB9OwoKICBHcmFwaEdyb3VwLnByb3RvdHlwZS5nZXREYXRhID0gZnVuY3Rpb24gKGdyb3VwRGF0YSkgewogICAgcmV0dXJuIHRoaXMudHlwZS5nZXREYXRhKGdyb3VwRGF0YSk7CiAgfTsKCiAgR3JhcGhHcm91cC5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uIChkYXRhc2V0LCBncm91cCwgZnJhbWV3b3JrKSB7CiAgICB0aGlzLnR5cGUuZHJhdyhkYXRhc2V0LCBncm91cCwgZnJhbWV3b3JrKTsKICB9OwoKICBtb2R1bGUuZXhwb3J0cyA9IEdyYXBoR3JvdXA7CgovKioqLyB9LAovKiA1NCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgRE9NdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7CiAgdmFyIFBvaW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTUpOwoKICBmdW5jdGlvbiBMaW5lKGdyb3VwSWQsIG9wdGlvbnMpIHsKICAgIHRoaXMuZ3JvdXBJZCA9IGdyb3VwSWQ7CiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogIH0KCiAgTGluZS5wcm90b3R5cGUuZ2V0RGF0YSA9IGZ1bmN0aW9uIChncm91cERhdGEpIHsKICAgIHZhciBjb21iaW5lZERhdGEgPSBbXTsKICAgIGZvciAodmFyIGogPSAwOyBqIDwgZ3JvdXBEYXRhLmxlbmd0aDsgaisrKSB7CiAgICAgIGNvbWJpbmVkRGF0YS5wdXNoKHsKICAgICAgICB4OiBncm91cERhdGFbal0ueCwKICAgICAgICB5OiBncm91cERhdGFbal0ueSwKICAgICAgICBncm91cElkOiB0aGlzLmdyb3VwSWQKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gY29tYmluZWREYXRhOwogIH07CgogIExpbmUucHJvdG90eXBlLmdldFlSYW5nZSA9IGZ1bmN0aW9uIChncm91cERhdGEpIHsKICAgIHZhciB5TWluID0gZ3JvdXBEYXRhWzBdLnk7CiAgICB2YXIgeU1heCA9IGdyb3VwRGF0YVswXS55OwogICAgZm9yICh2YXIgaiA9IDA7IGogPCBncm91cERhdGEubGVuZ3RoOyBqKyspIHsKICAgICAgeU1pbiA9IHlNaW4gPiBncm91cERhdGFbal0ueSA/IGdyb3VwRGF0YVtqXS55IDogeU1pbjsKICAgICAgeU1heCA9IHlNYXggPCBncm91cERhdGFbal0ueSA/IGdyb3VwRGF0YVtqXS55IDogeU1heDsKICAgIH0KICAgIHJldHVybiB7IG1pbjogeU1pbiwgbWF4OiB5TWF4LCB5QXhpc09yaWVudGF0aW9uOiB0aGlzLm9wdGlvbnMueUF4aXNPcmllbnRhdGlvbiB9OwogIH07CgogIExpbmUuZ2V0U3RhY2tlZFlSYW5nZSA9IGZ1bmN0aW9uIChjb21iaW5lZERhdGEsIGdyb3VwUmFuZ2VzLCBncm91cElkcywgZ3JvdXBMYWJlbCwgb3JpZW50YXRpb24pIHsKICAgIGlmIChjb21iaW5lZERhdGEubGVuZ3RoID4gMCkgewogICAgICAvLyBzb3J0IGJ5IHRpbWUgYW5kIGJ5IGdyb3VwCiAgICAgIGNvbWJpbmVkRGF0YS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKGEueCA9PT0gYi54KSB7CiAgICAgICAgICByZXR1cm4gYS5ncm91cElkIDwgYi5ncm91cElkID8gLTEgOiAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gYS54IC0gYi54OwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHZhciBpbnRlcnNlY3Rpb25zID0ge307CgogICAgICBMaW5lLl9nZXREYXRhSW50ZXJzZWN0aW9ucyhpbnRlcnNlY3Rpb25zLCBjb21iaW5lZERhdGEpOwogICAgICBncm91cFJhbmdlc1tncm91cExhYmVsXSA9IExpbmUuX2dldFN0YWNrZWRZUmFuZ2UoaW50ZXJzZWN0aW9ucywgY29tYmluZWREYXRhKTsKICAgICAgZ3JvdXBSYW5nZXNbZ3JvdXBMYWJlbF0ueUF4aXNPcmllbnRhdGlvbiA9IG9yaWVudGF0aW9uOwogICAgICBncm91cElkcy5wdXNoKGdyb3VwTGFiZWwpOwogICAgfQogIH07CgogIExpbmUuX2dldFN0YWNrZWRZUmFuZ2UgPSBmdW5jdGlvbiAoaW50ZXJzZWN0aW9ucywgY29tYmluZWREYXRhKSB7CiAgICB2YXIga2V5OwogICAgdmFyIHlNaW4gPSBjb21iaW5lZERhdGFbMF0ueTsKICAgIHZhciB5TWF4ID0gY29tYmluZWREYXRhWzBdLnk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbWJpbmVkRGF0YS5sZW5ndGg7IGkrKykgewogICAgICBrZXkgPSBjb21iaW5lZERhdGFbaV0ueDsKICAgICAgaWYgKGludGVyc2VjdGlvbnNba2V5XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgeU1pbiA9IHlNaW4gPiBjb21iaW5lZERhdGFbaV0ueSA/IGNvbWJpbmVkRGF0YVtpXS55IDogeU1pbjsKICAgICAgICB5TWF4ID0geU1heCA8IGNvbWJpbmVkRGF0YVtpXS55ID8gY29tYmluZWREYXRhW2ldLnkgOiB5TWF4OwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChjb21iaW5lZERhdGFbaV0ueSA8IDApIHsKICAgICAgICAgIGludGVyc2VjdGlvbnNba2V5XS5hY2N1bXVsYXRlZE5lZ2F0aXZlICs9IGNvbWJpbmVkRGF0YVtpXS55OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpbnRlcnNlY3Rpb25zW2tleV0uYWNjdW11bGF0ZWRQb3NpdGl2ZSArPSBjb21iaW5lZERhdGFbaV0ueTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZvciAodmFyIHhwb3MgaW4gaW50ZXJzZWN0aW9ucykgewogICAgICBpZiAoaW50ZXJzZWN0aW9ucy5oYXNPd25Qcm9wZXJ0eSh4cG9zKSkgewogICAgICAgIHlNaW4gPSB5TWluID4gaW50ZXJzZWN0aW9uc1t4cG9zXS5hY2N1bXVsYXRlZE5lZ2F0aXZlID8gaW50ZXJzZWN0aW9uc1t4cG9zXS5hY2N1bXVsYXRlZE5lZ2F0aXZlIDogeU1pbjsKICAgICAgICB5TWluID0geU1pbiA+IGludGVyc2VjdGlvbnNbeHBvc10uYWNjdW11bGF0ZWRQb3NpdGl2ZSA/IGludGVyc2VjdGlvbnNbeHBvc10uYWNjdW11bGF0ZWRQb3NpdGl2ZSA6IHlNaW47CiAgICAgICAgeU1heCA9IHlNYXggPCBpbnRlcnNlY3Rpb25zW3hwb3NdLmFjY3VtdWxhdGVkTmVnYXRpdmUgPyBpbnRlcnNlY3Rpb25zW3hwb3NdLmFjY3VtdWxhdGVkTmVnYXRpdmUgOiB5TWF4OwogICAgICAgIHlNYXggPSB5TWF4IDwgaW50ZXJzZWN0aW9uc1t4cG9zXS5hY2N1bXVsYXRlZFBvc2l0aXZlID8gaW50ZXJzZWN0aW9uc1t4cG9zXS5hY2N1bXVsYXRlZFBvc2l0aXZlIDogeU1heDsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB7IG1pbjogeU1pbiwgbWF4OiB5TWF4IH07CiAgfTsKCiAgLyoqCiAgICogRmlsbCB0aGUgaW50ZXJzZWN0aW9ucyBvYmplY3Qgd2l0aCBjb3VudGVycyBvZiBob3cgbWFueSBkYXRhcG9pbnRzIHNoYXJlIHRoZSBzYW1lIHggY29vcmRpbmF0ZXMKICAgKiBAcGFyYW0gaW50ZXJzZWN0aW9ucwogICAqIEBwYXJhbSBjb21iaW5lZERhdGEKICAgKiBAcHJpdmF0ZQogICAqLwogIExpbmUuX2dldERhdGFJbnRlcnNlY3Rpb25zID0gZnVuY3Rpb24gKGludGVyc2VjdGlvbnMsIGNvbWJpbmVkRGF0YSkgewogICAgLy8gZ2V0IGludGVyc2VjdGlvbnMKICAgIHZhciBjb3JlRGlzdGFuY2U7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbWJpbmVkRGF0YS5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaSArIDEgPCBjb21iaW5lZERhdGEubGVuZ3RoKSB7CiAgICAgICAgY29yZURpc3RhbmNlID0gTWF0aC5hYnMoY29tYmluZWREYXRhW2kgKyAxXS54IC0gY29tYmluZWREYXRhW2ldLngpOwogICAgICB9CiAgICAgIGlmIChpID4gMCkgewogICAgICAgIGNvcmVEaXN0YW5jZSA9IE1hdGgubWluKGNvcmVEaXN0YW5jZSwgTWF0aC5hYnMoY29tYmluZWREYXRhW2kgLSAxXS54IC0gY29tYmluZWREYXRhW2ldLngpKTsKICAgICAgfQogICAgICBpZiAoY29yZURpc3RhbmNlID09PSAwKSB7CiAgICAgICAgaWYgKGludGVyc2VjdGlvbnNbY29tYmluZWREYXRhW2ldLnhdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGludGVyc2VjdGlvbnNbY29tYmluZWREYXRhW2ldLnhdID0geyBhbW91bnQ6IDAsIHJlc29sdmVkOiAwLCBhY2N1bXVsYXRlZFBvc2l0aXZlOiAwLCBhY2N1bXVsYXRlZE5lZ2F0aXZlOiAwIH07CiAgICAgICAgfQogICAgICAgIGludGVyc2VjdGlvbnNbY29tYmluZWREYXRhW2ldLnhdLmFtb3VudCArPSAxOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogZHJhdyBhIGxpbmUgZ3JhcGgKICAgKgogICAqIEBwYXJhbSBkYXRhc2V0CiAgICogQHBhcmFtIGdyb3VwCiAgICovCiAgTGluZS5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uIChkYXRhc2V0LCBncm91cCwgZnJhbWV3b3JrKSB7CiAgICBpZiAoZGF0YXNldCAhPSBudWxsKSB7CiAgICAgIGlmIChkYXRhc2V0Lmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgcGF0aCwgZDsKICAgICAgICB2YXIgc3ZnSGVpZ2h0ID0gTnVtYmVyKGZyYW1ld29yay5zdmcuc3R5bGUuaGVpZ2h0LnJlcGxhY2UoJ3B4JywgJycpKTsKICAgICAgICBwYXRoID0gRE9NdXRpbC5nZXRTVkdFbGVtZW50KCdwYXRoJywgZnJhbWV3b3JrLnN2Z0VsZW1lbnRzLCBmcmFtZXdvcmsuc3ZnKTsKICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZU5TKG51bGwsICdjbGFzcycsIGdyb3VwLmNsYXNzTmFtZSk7CiAgICAgICAgaWYgKGdyb3VwLnN0eWxlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHBhdGguc2V0QXR0cmlidXRlTlMobnVsbCwgJ3N0eWxlJywgZ3JvdXAuc3R5bGUpOwogICAgICAgIH0KCiAgICAgICAgLy8gY29uc3RydWN0IHBhdGggZnJvbSBkYXRhc2V0CiAgICAgICAgaWYgKGdyb3VwLm9wdGlvbnMuaW50ZXJwb2xhdGlvbi5lbmFibGVkID09IHRydWUpIHsKICAgICAgICAgIGQgPSBMaW5lLl9jYXRtdWxsUm9tKGRhdGFzZXQsIGdyb3VwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZCA9IExpbmUuX2xpbmVhcihkYXRhc2V0KTsKICAgICAgICB9CgogICAgICAgIC8vIGFwcGVuZCB3aXRoIHBvaW50cyBmb3IgZmlsbCBhbmQgZmluYWxpemUgdGhlIHBhdGgKICAgICAgICBpZiAoZ3JvdXAub3B0aW9ucy5zaGFkZWQuZW5hYmxlZCA9PSB0cnVlKSB7CiAgICAgICAgICB2YXIgZmlsbFBhdGggPSBET011dGlsLmdldFNWR0VsZW1lbnQoJ3BhdGgnLCBmcmFtZXdvcmsuc3ZnRWxlbWVudHMsIGZyYW1ld29yay5zdmcpOwogICAgICAgICAgdmFyIGRGaWxsOwogICAgICAgICAgaWYgKGdyb3VwLm9wdGlvbnMuc2hhZGVkLm9yaWVudGF0aW9uID09ICd0b3AnKSB7CiAgICAgICAgICAgIGRGaWxsID0gJ00nICsgZGF0YXNldFswXS54ICsgJywnICsgMCArICcgJyArIGQgKyAnTCcgKyBkYXRhc2V0W2RhdGFzZXQubGVuZ3RoIC0gMV0ueCArICcsJyArIDA7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkRmlsbCA9ICdNJyArIGRhdGFzZXRbMF0ueCArICcsJyArIHN2Z0hlaWdodCArICcgJyArIGQgKyAnTCcgKyBkYXRhc2V0W2RhdGFzZXQubGVuZ3RoIC0gMV0ueCArICcsJyArIHN2Z0hlaWdodDsKICAgICAgICAgIH0KICAgICAgICAgIGZpbGxQYXRoLnNldEF0dHJpYnV0ZU5TKG51bGwsICdjbGFzcycsIGdyb3VwLmNsYXNzTmFtZSArICcgdmlzLWZpbGwnKTsKICAgICAgICAgIGlmIChncm91cC5vcHRpb25zLnNoYWRlZC5zdHlsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGZpbGxQYXRoLnNldEF0dHJpYnV0ZU5TKG51bGwsICdzdHlsZScsIGdyb3VwLm9wdGlvbnMuc2hhZGVkLnN0eWxlKTsKICAgICAgICAgIH0KICAgICAgICAgIGZpbGxQYXRoLnNldEF0dHJpYnV0ZU5TKG51bGwsICdkJywgZEZpbGwpOwogICAgICAgIH0KICAgICAgICAvLyBjb3B5IHByb3BlcnRpZXMgdG8gcGF0aCBmb3IgZHJhd2luZy4KICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZU5TKG51bGwsICdkJywgJ00nICsgZCk7CgogICAgICAgIC8vIGRyYXcgcG9pbnRzCiAgICAgICAgaWYgKGdyb3VwLm9wdGlvbnMuZHJhd1BvaW50cy5lbmFibGVkID09IHRydWUpIHsKICAgICAgICAgIFBvaW50cy5kcmF3KGRhdGFzZXQsIGdyb3VwLCBmcmFtZXdvcmspOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIFRoaXMgdXNlcyBhbiB1bmlmb3JtIHBhcmFtZXRyaXphdGlvbiBvZiB0aGUgaW50ZXJwb2xhdGlvbiBhbGdvcml0aG06CiAgICogJ09uIHRoZSBQYXJhbWV0ZXJpemF0aW9uIG9mIENhdG11bGwtUm9tIEN1cnZlcycgYnkgQ2VtIFl1a3NlbCBldCBhbC4KICAgKiBAcGFyYW0gZGF0YQogICAqIEByZXR1cm5zIHtzdHJpbmd9CiAgICogQHByaXZhdGUKICAgKi8KICBMaW5lLl9jYXRtdWxsUm9tVW5pZm9ybSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAvLyBjYXRtdWxsIHJvbQogICAgdmFyIHAwLCBwMSwgcDIsIHAzLCBicDEsIGJwMjsKICAgIHZhciBkID0gTWF0aC5yb3VuZChkYXRhWzBdLngpICsgJywnICsgTWF0aC5yb3VuZChkYXRhWzBdLnkpICsgJyAnOwogICAgdmFyIG5vcm1hbGl6YXRpb24gPSAxIC8gNjsKICAgIHZhciBsZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoIC0gMTsgaSsrKSB7CgogICAgICBwMCA9IGkgPT0gMCA/IGRhdGFbMF0gOiBkYXRhW2kgLSAxXTsKICAgICAgcDEgPSBkYXRhW2ldOwogICAgICBwMiA9IGRhdGFbaSArIDFdOwogICAgICBwMyA9IGkgKyAyIDwgbGVuZ3RoID8gZGF0YVtpICsgMl0gOiBwMjsKCiAgICAgIC8vIENhdG11bGwtUm9tIHRvIEN1YmljIEJlemllciBjb252ZXJzaW9uIG1hdHJpeAogICAgICAvLyAgICAwICAgICAgIDEgICAgICAgMCAgICAgICAwCiAgICAgIC8vICAtMS82ICAgICAgMSAgICAgIDEvNiAgICAgIDAKICAgICAgLy8gICAgMCAgICAgIDEvNiAgICAgIDEgICAgIC0xLzYKICAgICAgLy8gICAgMCAgICAgICAwICAgICAgIDEgICAgICAgMAoKICAgICAgLy8gICAgYnAwID0geyB4OiBwMS54LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBwMS55IH07CiAgICAgIGJwMSA9IHsgeDogKC1wMC54ICsgNiAqIHAxLnggKyBwMi54KSAqIG5vcm1hbGl6YXRpb24sIHk6ICgtcDAueSArIDYgKiBwMS55ICsgcDIueSkgKiBub3JtYWxpemF0aW9uIH07CiAgICAgIGJwMiA9IHsgeDogKHAxLnggKyA2ICogcDIueCAtIHAzLngpICogbm9ybWFsaXphdGlvbiwgeTogKHAxLnkgKyA2ICogcDIueSAtIHAzLnkpICogbm9ybWFsaXphdGlvbiB9OwogICAgICAvLyAgICBicDAgPSB7IHg6IHAyLngsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IHAyLnkgfTsKCiAgICAgIGQgKz0gJ0MnICsgYnAxLnggKyAnLCcgKyBicDEueSArICcgJyArIGJwMi54ICsgJywnICsgYnAyLnkgKyAnICcgKyBwMi54ICsgJywnICsgcDIueSArICcgJzsKICAgIH0KCiAgICByZXR1cm4gZDsKICB9OwoKICAvKioKICAgKiBUaGlzIHVzZXMgZWl0aGVyIHRoZSBjaG9yZGFsIG9yIGNlbnRyaXBldGFsIHBhcmFtZXRlcml6YXRpb24gb2YgdGhlIGNhdG11bGwtcm9tIGFsZ29yaXRobS4KICAgKiBCeSBkZWZhdWx0LCB0aGUgY2VudHJpcGV0YWwgcGFyYW1ldGVyaXphdGlvbiBpcyB1c2VkIGJlY2F1c2UgdGhpcyBnaXZlcyB0aGUgbmljZXN0IHJlc3VsdHMuCiAgICogVGhlc2UgcGFyYW1ldGVyaXphdGlvbnMgYXJlIHJlbGF0aXZlbHkgaGVhdnkgYmVjYXVzZSB0aGUgZGlzdGFuY2UgYmV0d2VlbiA0IHBvaW50cyBoYXZlIHRvIGJlIGNhbGN1bGF0ZWQuCiAgICoKICAgKiBPbmUgb3B0aW1pemF0aW9uIGNhbiBiZSB1c2VkIHRvIHJldXNlIGRpc3RhbmNlcyBzaW5jZSB0aGlzIGlzIGEgc2xpZGluZyB3aW5kb3cgYXBwcm9hY2guCiAgICogQHBhcmFtIGRhdGEKICAgKiBAcGFyYW0gZ3JvdXAKICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAqIEBwcml2YXRlCiAgICovCiAgTGluZS5fY2F0bXVsbFJvbSA9IGZ1bmN0aW9uIChkYXRhLCBncm91cCkgewogICAgdmFyIGFscGhhID0gZ3JvdXAub3B0aW9ucy5pbnRlcnBvbGF0aW9uLmFscGhhOwogICAgaWYgKGFscGhhID09IDAgfHwgYWxwaGEgPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdGhpcy5fY2F0bXVsbFJvbVVuaWZvcm0oZGF0YSk7CiAgICB9IGVsc2UgewogICAgICB2YXIgcDAsIHAxLCBwMiwgcDMsIGJwMSwgYnAyLCBkMSwgZDIsIGQzLCBBLCBCLCBOLCBNOwogICAgICB2YXIgZDNwb3dBLCBkMnBvd0EsIGQzcG93MkEsIGQycG93MkEsIGQxcG93MkEsIGQxcG93QTsKICAgICAgdmFyIGQgPSBNYXRoLnJvdW5kKGRhdGFbMF0ueCkgKyAnLCcgKyBNYXRoLnJvdW5kKGRhdGFbMF0ueSkgKyAnICc7CiAgICAgIHZhciBsZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGggLSAxOyBpKyspIHsKCiAgICAgICAgcDAgPSBpID09IDAgPyBkYXRhWzBdIDogZGF0YVtpIC0gMV07CiAgICAgICAgcDEgPSBkYXRhW2ldOwogICAgICAgIHAyID0gZGF0YVtpICsgMV07CiAgICAgICAgcDMgPSBpICsgMiA8IGxlbmd0aCA/IGRhdGFbaSArIDJdIDogcDI7CgogICAgICAgIGQxID0gTWF0aC5zcXJ0KE1hdGgucG93KHAwLnggLSBwMS54LCAyKSArIE1hdGgucG93KHAwLnkgLSBwMS55LCAyKSk7CiAgICAgICAgZDIgPSBNYXRoLnNxcnQoTWF0aC5wb3cocDEueCAtIHAyLngsIDIpICsgTWF0aC5wb3cocDEueSAtIHAyLnksIDIpKTsKICAgICAgICBkMyA9IE1hdGguc3FydChNYXRoLnBvdyhwMi54IC0gcDMueCwgMikgKyBNYXRoLnBvdyhwMi55IC0gcDMueSwgMikpOwoKICAgICAgICAvLyBDYXRtdWxsLVJvbSB0byBDdWJpYyBCZXppZXIgY29udmVyc2lvbiBtYXRyaXgKCiAgICAgICAgLy8gQSA9IDJkMV4yYSArIDNkMV5hICogZDJeYSArIGQzXjJhCiAgICAgICAgLy8gQiA9IDJkM14yYSArIDNkM15hICogZDJeYSArIGQyXjJhCgogICAgICAgIC8vIFsgICAwICAgICAgICAgICAgIDEgICAgICAgICAgICAwICAgICAgICAgIDAgICAgICAgICAgXQogICAgICAgIC8vIFsgICAtZDJeMmEgL04gICAgIEEvTiAgICAgICAgICBkMV4yYSAvTiAgIDAgICAgICAgICAgXQogICAgICAgIC8vIFsgICAwICAgICAgICAgICAgIGQzXjJhIC9NICAgICBCL00gICAgICAgIC1kMl4yYSAvTSAgXQogICAgICAgIC8vIFsgICAwICAgICAgICAgICAgIDAgICAgICAgICAgICAxICAgICAgICAgIDAgICAgICAgICAgXQoKICAgICAgICBkM3Bvd0EgPSBNYXRoLnBvdyhkMywgYWxwaGEpOwogICAgICAgIGQzcG93MkEgPSBNYXRoLnBvdyhkMywgMiAqIGFscGhhKTsKICAgICAgICBkMnBvd0EgPSBNYXRoLnBvdyhkMiwgYWxwaGEpOwogICAgICAgIGQycG93MkEgPSBNYXRoLnBvdyhkMiwgMiAqIGFscGhhKTsKICAgICAgICBkMXBvd0EgPSBNYXRoLnBvdyhkMSwgYWxwaGEpOwogICAgICAgIGQxcG93MkEgPSBNYXRoLnBvdyhkMSwgMiAqIGFscGhhKTsKCiAgICAgICAgQSA9IDIgKiBkMXBvdzJBICsgMyAqIGQxcG93QSAqIGQycG93QSArIGQycG93MkE7CiAgICAgICAgQiA9IDIgKiBkM3BvdzJBICsgMyAqIGQzcG93QSAqIGQycG93QSArIGQycG93MkE7CiAgICAgICAgTiA9IDMgKiBkMXBvd0EgKiAoZDFwb3dBICsgZDJwb3dBKTsKICAgICAgICBpZiAoTiA+IDApIHsKICAgICAgICAgIE4gPSAxIC8gTjsKICAgICAgICB9CiAgICAgICAgTSA9IDMgKiBkM3Bvd0EgKiAoZDNwb3dBICsgZDJwb3dBKTsKICAgICAgICBpZiAoTSA+IDApIHsKICAgICAgICAgIE0gPSAxIC8gTTsKICAgICAgICB9CgogICAgICAgIGJwMSA9IHsgeDogKC1kMnBvdzJBICogcDAueCArIEEgKiBwMS54ICsgZDFwb3cyQSAqIHAyLngpICogTiwKICAgICAgICAgIHk6ICgtZDJwb3cyQSAqIHAwLnkgKyBBICogcDEueSArIGQxcG93MkEgKiBwMi55KSAqIE4gfTsKCiAgICAgICAgYnAyID0geyB4OiAoZDNwb3cyQSAqIHAxLnggKyBCICogcDIueCAtIGQycG93MkEgKiBwMy54KSAqIE0sCiAgICAgICAgICB5OiAoZDNwb3cyQSAqIHAxLnkgKyBCICogcDIueSAtIGQycG93MkEgKiBwMy55KSAqIE0gfTsKCiAgICAgICAgaWYgKGJwMS54ID09IDAgJiYgYnAxLnkgPT0gMCkgewogICAgICAgICAgYnAxID0gcDE7CiAgICAgICAgfQogICAgICAgIGlmIChicDIueCA9PSAwICYmIGJwMi55ID09IDApIHsKICAgICAgICAgIGJwMiA9IHAyOwogICAgICAgIH0KICAgICAgICBkICs9ICdDJyArIGJwMS54ICsgJywnICsgYnAxLnkgKyAnICcgKyBicDIueCArICcsJyArIGJwMi55ICsgJyAnICsgcDIueCArICcsJyArIHAyLnkgKyAnICc7CiAgICAgIH0KCiAgICAgIHJldHVybiBkOwogICAgfQogIH07CgogIC8qKgogICAqIHRoaXMgZ2VuZXJhdGVzIHRoZSBTVkcgcGF0aCBmb3IgYSBsaW5lYXIgZHJhd2luZyBiZXR3ZWVuIGRhdGFwb2ludHMuCiAgICogQHBhcmFtIGRhdGEKICAgKiBAcmV0dXJucyB7c3RyaW5nfQogICAqIEBwcml2YXRlCiAgICovCiAgTGluZS5fbGluZWFyID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIC8vIGxpbmVhcgogICAgdmFyIGQgPSAnJzsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaSA9PSAwKSB7CiAgICAgICAgZCArPSBkYXRhW2ldLnggKyAnLCcgKyBkYXRhW2ldLnk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZCArPSAnICcgKyBkYXRhW2ldLnggKyAnLCcgKyBkYXRhW2ldLnk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkOwogIH07CgogIG1vZHVsZS5leHBvcnRzID0gTGluZTsKCi8qKiovIH0sCi8qIDU1ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIHZhciBET011dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3KTsKCiAgZnVuY3Rpb24gUG9pbnRzKGdyb3VwSWQsIG9wdGlvbnMpIHsKICAgIHRoaXMuZ3JvdXBJZCA9IGdyb3VwSWQ7CiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogIH0KCiAgUG9pbnRzLnByb3RvdHlwZS5nZXRZUmFuZ2UgPSBmdW5jdGlvbiAoZ3JvdXBEYXRhKSB7CiAgICB2YXIgeU1pbiA9IGdyb3VwRGF0YVswXS55OwogICAgdmFyIHlNYXggPSBncm91cERhdGFbMF0ueTsKICAgIGZvciAodmFyIGogPSAwOyBqIDwgZ3JvdXBEYXRhLmxlbmd0aDsgaisrKSB7CiAgICAgIHlNaW4gPSB5TWluID4gZ3JvdXBEYXRhW2pdLnkgPyBncm91cERhdGFbal0ueSA6IHlNaW47CiAgICAgIHlNYXggPSB5TWF4IDwgZ3JvdXBEYXRhW2pdLnkgPyBncm91cERhdGFbal0ueSA6IHlNYXg7CiAgICB9CiAgICByZXR1cm4geyBtaW46IHlNaW4sIG1heDogeU1heCwgeUF4aXNPcmllbnRhdGlvbjogdGhpcy5vcHRpb25zLnlBeGlzT3JpZW50YXRpb24gfTsKICB9OwoKICBQb2ludHMucHJvdG90eXBlLmRyYXcgPSBmdW5jdGlvbiAoZGF0YXNldCwgZ3JvdXAsIGZyYW1ld29yaywgb2Zmc2V0KSB7CiAgICBQb2ludHMuZHJhdyhkYXRhc2V0LCBncm91cCwgZnJhbWV3b3JrLCBvZmZzZXQpOwogIH07CgogIC8qKgogICAqIGRyYXcgdGhlIGRhdGEgcG9pbnRzCiAgICoKICAgKiBAcGFyYW0ge0FycmF5fSBkYXRhc2V0CiAgICogQHBhcmFtIHtPYmplY3R9IEpTT05jb250YWluZXIKICAgKiBAcGFyYW0ge09iamVjdH0gc3ZnICAgICAgICAgICAgfCBTVkcgRE9NIGVsZW1lbnQKICAgKiBAcGFyYW0ge0dyYXBoR3JvdXB9IGdyb3VwCiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvZmZzZXRdCiAgICovCiAgUG9pbnRzLmRyYXcgPSBmdW5jdGlvbiAoZGF0YXNldCwgZ3JvdXAsIGZyYW1ld29yaywgb2Zmc2V0KSB7CiAgICBpZiAob2Zmc2V0ID09PSB1bmRlZmluZWQpIHsKICAgICAgb2Zmc2V0ID0gMDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YXNldC5sZW5ndGg7IGkrKykgewogICAgICBET011dGlsLmRyYXdQb2ludChkYXRhc2V0W2ldLnggKyBvZmZzZXQsIGRhdGFzZXRbaV0ueSwgZ3JvdXAsIGZyYW1ld29yay5zdmdFbGVtZW50cywgZnJhbWV3b3JrLnN2ZywgZGF0YXNldFtpXS5sYWJlbCk7CiAgICB9CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBQb2ludHM7CgovKioqLyB9LAovKiA1NiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgRE9NdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oNyk7CiAgdmFyIFBvaW50cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTUpOwoKICBmdW5jdGlvbiBCYXJncmFwaChncm91cElkLCBvcHRpb25zKSB7CiAgICB0aGlzLmdyb3VwSWQgPSBncm91cElkOwogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICB9CgogIEJhcmdyYXBoLnByb3RvdHlwZS5nZXRZUmFuZ2UgPSBmdW5jdGlvbiAoZ3JvdXBEYXRhKSB7CiAgICB2YXIgeU1pbiA9IGdyb3VwRGF0YVswXS55OwogICAgdmFyIHlNYXggPSBncm91cERhdGFbMF0ueTsKICAgIGZvciAodmFyIGogPSAwOyBqIDwgZ3JvdXBEYXRhLmxlbmd0aDsgaisrKSB7CiAgICAgIHlNaW4gPSB5TWluID4gZ3JvdXBEYXRhW2pdLnkgPyBncm91cERhdGFbal0ueSA6IHlNaW47CiAgICAgIHlNYXggPSB5TWF4IDwgZ3JvdXBEYXRhW2pdLnkgPyBncm91cERhdGFbal0ueSA6IHlNYXg7CiAgICB9CiAgICByZXR1cm4geyBtaW46IHlNaW4sIG1heDogeU1heCwgeUF4aXNPcmllbnRhdGlvbjogdGhpcy5vcHRpb25zLnlBeGlzT3JpZW50YXRpb24gfTsKICB9OwoKICBCYXJncmFwaC5wcm90b3R5cGUuZ2V0RGF0YSA9IGZ1bmN0aW9uIChncm91cERhdGEpIHsKICAgIHZhciBjb21iaW5lZERhdGEgPSBbXTsKICAgIGZvciAodmFyIGogPSAwOyBqIDwgZ3JvdXBEYXRhLmxlbmd0aDsgaisrKSB7CiAgICAgIGNvbWJpbmVkRGF0YS5wdXNoKHsKICAgICAgICB4OiBncm91cERhdGFbal0ueCwKICAgICAgICB5OiBncm91cERhdGFbal0ueSwKICAgICAgICBncm91cElkOiB0aGlzLmdyb3VwSWQKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gY29tYmluZWREYXRhOwogIH07CgogIC8qKgogICAqIGRyYXcgYSBiYXIgZ3JhcGgKICAgKgogICAqIEBwYXJhbSBncm91cElkcwogICAqIEBwYXJhbSBwcm9jZXNzZWRHcm91cERhdGEKICAgKi8KICBCYXJncmFwaC5kcmF3ID0gZnVuY3Rpb24gKGdyb3VwSWRzLCBwcm9jZXNzZWRHcm91cERhdGEsIGZyYW1ld29yaykgewogICAgdmFyIGNvbWJpbmVkRGF0YSA9IFtdOwogICAgdmFyIGludGVyc2VjdGlvbnMgPSB7fTsKICAgIHZhciBjb3JlRGlzdGFuY2U7CiAgICB2YXIga2V5LCBkcmF3RGF0YTsKICAgIHZhciBncm91cDsKICAgIHZhciBpLCBqOwogICAgdmFyIGJhclBvaW50cyA9IDA7CgogICAgLy8gY29tYmluZSBhbGwgYmFyY2hhcnQgZGF0YQogICAgZm9yIChpID0gMDsgaSA8IGdyb3VwSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGdyb3VwID0gZnJhbWV3b3JrLmdyb3Vwc1tncm91cElkc1tpXV07CiAgICAgIGlmIChncm91cC5vcHRpb25zLnN0eWxlID09PSAnYmFyJykgewogICAgICAgIGlmIChncm91cC52aXNpYmxlID09PSB0cnVlICYmIChmcmFtZXdvcmsub3B0aW9ucy5ncm91cHMudmlzaWJpbGl0eVtncm91cElkc1tpXV0gPT09IHVuZGVmaW5lZCB8fCBmcmFtZXdvcmsub3B0aW9ucy5ncm91cHMudmlzaWJpbGl0eVtncm91cElkc1tpXV0gPT09IHRydWUpKSB7CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgcHJvY2Vzc2VkR3JvdXBEYXRhW2dyb3VwSWRzW2ldXS5sZW5ndGg7IGorKykgewogICAgICAgICAgICBjb21iaW5lZERhdGEucHVzaCh7CiAgICAgICAgICAgICAgeDogcHJvY2Vzc2VkR3JvdXBEYXRhW2dyb3VwSWRzW2ldXVtqXS54LAogICAgICAgICAgICAgIHk6IHByb2Nlc3NlZEdyb3VwRGF0YVtncm91cElkc1tpXV1bal0ueSwKICAgICAgICAgICAgICBncm91cElkOiBncm91cElkc1tpXSwKICAgICAgICAgICAgICBsYWJlbDogcHJvY2Vzc2VkR3JvdXBEYXRhW2dyb3VwSWRzW2ldXVtqXS5sYWJlbAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYmFyUG9pbnRzICs9IDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKGJhclBvaW50cyA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gc29ydCBieSB0aW1lIGFuZCBieSBncm91cAogICAgY29tYmluZWREYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgaWYgKGEueCA9PT0gYi54KSB7CiAgICAgICAgcmV0dXJuIGEuZ3JvdXBJZCA8IGIuZ3JvdXBJZCA/IC0xIDogMTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYS54IC0gYi54OwogICAgICB9CiAgICB9KTsKCiAgICAvLyBnZXQgaW50ZXJzZWN0aW9ucwogICAgQmFyZ3JhcGguX2dldERhdGFJbnRlcnNlY3Rpb25zKGludGVyc2VjdGlvbnMsIGNvbWJpbmVkRGF0YSk7CgogICAgLy8gcGxvdCBiYXJjaGFydAogICAgZm9yIChpID0gMDsgaSA8IGNvbWJpbmVkRGF0YS5sZW5ndGg7IGkrKykgewogICAgICBncm91cCA9IGZyYW1ld29yay5ncm91cHNbY29tYmluZWREYXRhW2ldLmdyb3VwSWRdOwogICAgICB2YXIgbWluV2lkdGggPSAwLjEgKiBncm91cC5vcHRpb25zLmJhckNoYXJ0LndpZHRoOwoKICAgICAga2V5ID0gY29tYmluZWREYXRhW2ldLng7CiAgICAgIHZhciBoZWlnaHRPZmZzZXQgPSAwOwogICAgICBpZiAoaW50ZXJzZWN0aW9uc1trZXldID09PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoaSArIDEgPCBjb21iaW5lZERhdGEubGVuZ3RoKSB7CiAgICAgICAgICBjb3JlRGlzdGFuY2UgPSBNYXRoLmFicyhjb21iaW5lZERhdGFbaSArIDFdLnggLSBrZXkpOwogICAgICAgIH0KICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgIGNvcmVEaXN0YW5jZSA9IE1hdGgubWluKGNvcmVEaXN0YW5jZSwgTWF0aC5hYnMoY29tYmluZWREYXRhW2kgLSAxXS54IC0ga2V5KSk7CiAgICAgICAgfQogICAgICAgIGRyYXdEYXRhID0gQmFyZ3JhcGguX2dldFNhZmVEcmF3RGF0YShjb3JlRGlzdGFuY2UsIGdyb3VwLCBtaW5XaWR0aCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIG5leHRLZXkgPSBpICsgKGludGVyc2VjdGlvbnNba2V5XS5hbW91bnQgLSBpbnRlcnNlY3Rpb25zW2tleV0ucmVzb2x2ZWQpOwogICAgICAgIHZhciBwcmV2S2V5ID0gaSAtIChpbnRlcnNlY3Rpb25zW2tleV0ucmVzb2x2ZWQgKyAxKTsKICAgICAgICBpZiAobmV4dEtleSA8IGNvbWJpbmVkRGF0YS5sZW5ndGgpIHsKICAgICAgICAgIGNvcmVEaXN0YW5jZSA9IE1hdGguYWJzKGNvbWJpbmVkRGF0YVtuZXh0S2V5XS54IC0ga2V5KTsKICAgICAgICB9CiAgICAgICAgaWYgKHByZXZLZXkgPiAwKSB7CiAgICAgICAgICBjb3JlRGlzdGFuY2UgPSBNYXRoLm1pbihjb3JlRGlzdGFuY2UsIE1hdGguYWJzKGNvbWJpbmVkRGF0YVtwcmV2S2V5XS54IC0ga2V5KSk7CiAgICAgICAgfQogICAgICAgIGRyYXdEYXRhID0gQmFyZ3JhcGguX2dldFNhZmVEcmF3RGF0YShjb3JlRGlzdGFuY2UsIGdyb3VwLCBtaW5XaWR0aCk7CiAgICAgICAgaW50ZXJzZWN0aW9uc1trZXldLnJlc29sdmVkICs9IDE7CgogICAgICAgIGlmIChncm91cC5vcHRpb25zLnN0YWNrID09PSB0cnVlKSB7CiAgICAgICAgICBpZiAoY29tYmluZWREYXRhW2ldLnkgPCBncm91cC56ZXJvUG9zaXRpb24pIHsKICAgICAgICAgICAgaGVpZ2h0T2Zmc2V0ID0gaW50ZXJzZWN0aW9uc1trZXldLmFjY3VtdWxhdGVkTmVnYXRpdmU7CiAgICAgICAgICAgIGludGVyc2VjdGlvbnNba2V5XS5hY2N1bXVsYXRlZE5lZ2F0aXZlICs9IGdyb3VwLnplcm9Qb3NpdGlvbiAtIGNvbWJpbmVkRGF0YVtpXS55OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaGVpZ2h0T2Zmc2V0ID0gaW50ZXJzZWN0aW9uc1trZXldLmFjY3VtdWxhdGVkUG9zaXRpdmU7CiAgICAgICAgICAgIGludGVyc2VjdGlvbnNba2V5XS5hY2N1bXVsYXRlZFBvc2l0aXZlICs9IGdyb3VwLnplcm9Qb3NpdGlvbiAtIGNvbWJpbmVkRGF0YVtpXS55OwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZ3JvdXAub3B0aW9ucy5iYXJDaGFydC5zaWRlQnlTaWRlID09PSB0cnVlKSB7CiAgICAgICAgICBkcmF3RGF0YS53aWR0aCA9IGRyYXdEYXRhLndpZHRoIC8gaW50ZXJzZWN0aW9uc1trZXldLmFtb3VudDsKICAgICAgICAgIGRyYXdEYXRhLm9mZnNldCArPSBpbnRlcnNlY3Rpb25zW2tleV0ucmVzb2x2ZWQgKiBkcmF3RGF0YS53aWR0aCAtIDAuNSAqIGRyYXdEYXRhLndpZHRoICogKGludGVyc2VjdGlvbnNba2V5XS5hbW91bnQgKyAxKTsKICAgICAgICAgIGlmIChncm91cC5vcHRpb25zLmJhckNoYXJ0LmFsaWduID09PSAnbGVmdCcpIHsKICAgICAgICAgICAgZHJhd0RhdGEub2Zmc2V0IC09IDAuNSAqIGRyYXdEYXRhLndpZHRoOwogICAgICAgICAgfSBlbHNlIGlmIChncm91cC5vcHRpb25zLmJhckNoYXJ0LmFsaWduID09PSAncmlnaHQnKSB7CiAgICAgICAgICAgIGRyYXdEYXRhLm9mZnNldCArPSAwLjUgKiBkcmF3RGF0YS53aWR0aDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgRE9NdXRpbC5kcmF3QmFyKGNvbWJpbmVkRGF0YVtpXS54ICsgZHJhd0RhdGEub2Zmc2V0LCBjb21iaW5lZERhdGFbaV0ueSAtIGhlaWdodE9mZnNldCwgZHJhd0RhdGEud2lkdGgsIGdyb3VwLnplcm9Qb3NpdGlvbiAtIGNvbWJpbmVkRGF0YVtpXS55LCBncm91cC5jbGFzc05hbWUgKyAnIHZpcy1iYXInLCBmcmFtZXdvcmsuc3ZnRWxlbWVudHMsIGZyYW1ld29yay5zdmcsIGdyb3VwLnN0eWxlKTsKICAgICAgLy8gZHJhdyBwb2ludHMKICAgICAgaWYgKGdyb3VwLm9wdGlvbnMuZHJhd1BvaW50cy5lbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgUG9pbnRzLmRyYXcoW2NvbWJpbmVkRGF0YVtpXV0sIGdyb3VwLCBmcmFtZXdvcmssIGRyYXdEYXRhLm9mZnNldCk7CiAgICAgICAgLy9ET011dGlsLmRyYXdQb2ludChjb21iaW5lZERhdGFbaV0ueCArIGRyYXdEYXRhLm9mZnNldCwgY29tYmluZWREYXRhW2ldLnksIGdyb3VwLCBmcmFtZXdvcmsuc3ZnRWxlbWVudHMsIGZyYW1ld29yay5zdmcpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogRmlsbCB0aGUgaW50ZXJzZWN0aW9ucyBvYmplY3Qgd2l0aCBjb3VudGVycyBvZiBob3cgbWFueSBkYXRhcG9pbnRzIHNoYXJlIHRoZSBzYW1lIHggY29vcmRpbmF0ZXMKICAgKiBAcGFyYW0gaW50ZXJzZWN0aW9ucwogICAqIEBwYXJhbSBjb21iaW5lZERhdGEKICAgKiBAcHJpdmF0ZQogICAqLwogIEJhcmdyYXBoLl9nZXREYXRhSW50ZXJzZWN0aW9ucyA9IGZ1bmN0aW9uIChpbnRlcnNlY3Rpb25zLCBjb21iaW5lZERhdGEpIHsKICAgIC8vIGdldCBpbnRlcnNlY3Rpb25zCiAgICB2YXIgY29yZURpc3RhbmNlOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb21iaW5lZERhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGkgKyAxIDwgY29tYmluZWREYXRhLmxlbmd0aCkgewogICAgICAgIGNvcmVEaXN0YW5jZSA9IE1hdGguYWJzKGNvbWJpbmVkRGF0YVtpICsgMV0ueCAtIGNvbWJpbmVkRGF0YVtpXS54KTsKICAgICAgfQogICAgICBpZiAoaSA+IDApIHsKICAgICAgICBjb3JlRGlzdGFuY2UgPSBNYXRoLm1pbihjb3JlRGlzdGFuY2UsIE1hdGguYWJzKGNvbWJpbmVkRGF0YVtpIC0gMV0ueCAtIGNvbWJpbmVkRGF0YVtpXS54KSk7CiAgICAgIH0KICAgICAgaWYgKGNvcmVEaXN0YW5jZSA9PT0gMCkgewogICAgICAgIGlmIChpbnRlcnNlY3Rpb25zW2NvbWJpbmVkRGF0YVtpXS54XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpbnRlcnNlY3Rpb25zW2NvbWJpbmVkRGF0YVtpXS54XSA9IHsgYW1vdW50OiAwLCByZXNvbHZlZDogMCwgYWNjdW11bGF0ZWRQb3NpdGl2ZTogMCwgYWNjdW11bGF0ZWROZWdhdGl2ZTogMCB9OwogICAgICAgIH0KICAgICAgICBpbnRlcnNlY3Rpb25zW2NvbWJpbmVkRGF0YVtpXS54XS5hbW91bnQgKz0gMTsKICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIEdldCB0aGUgd2lkdGggYW5kIG9mZnNldCBmb3IgYmFyZ3JhcGhzIGJhc2VkIG9uIHRoZSBjb3JlZGlzdGFuY2UgYmV0d2VlbiBkYXRhcG9pbnRzCiAgICoKICAgKiBAcGFyYW0gY29yZURpc3RhbmNlCiAgICogQHBhcmFtIGdyb3VwCiAgICogQHBhcmFtIG1pbldpZHRoCiAgICogQHJldHVybnMge3t3aWR0aDogTnVtYmVyLCBvZmZzZXQ6IE51bWJlcn19CiAgICogQHByaXZhdGUKICAgKi8KICBCYXJncmFwaC5fZ2V0U2FmZURyYXdEYXRhID0gZnVuY3Rpb24gKGNvcmVEaXN0YW5jZSwgZ3JvdXAsIG1pbldpZHRoKSB7CiAgICB2YXIgd2lkdGgsIG9mZnNldDsKICAgIGlmIChjb3JlRGlzdGFuY2UgPCBncm91cC5vcHRpb25zLmJhckNoYXJ0LndpZHRoICYmIGNvcmVEaXN0YW5jZSA+IDApIHsKICAgICAgd2lkdGggPSBjb3JlRGlzdGFuY2UgPCBtaW5XaWR0aCA/IG1pbldpZHRoIDogY29yZURpc3RhbmNlOwoKICAgICAgb2Zmc2V0ID0gMDsgLy8gcmVjYWxjdWxhdGUgb2Zmc2V0IHdpdGggdGhlIG5ldyB3aWR0aDsKICAgICAgaWYgKGdyb3VwLm9wdGlvbnMuYmFyQ2hhcnQuYWxpZ24gPT09ICdsZWZ0JykgewogICAgICAgIG9mZnNldCAtPSAwLjUgKiBjb3JlRGlzdGFuY2U7CiAgICAgIH0gZWxzZSBpZiAoZ3JvdXAub3B0aW9ucy5iYXJDaGFydC5hbGlnbiA9PT0gJ3JpZ2h0JykgewogICAgICAgIG9mZnNldCArPSAwLjUgKiBjb3JlRGlzdGFuY2U7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIGRlZmF1bHQgc2V0dGluZ3MKICAgICAgd2lkdGggPSBncm91cC5vcHRpb25zLmJhckNoYXJ0LndpZHRoOwogICAgICBvZmZzZXQgPSAwOwogICAgICBpZiAoZ3JvdXAub3B0aW9ucy5iYXJDaGFydC5hbGlnbiA9PT0gJ2xlZnQnKSB7CiAgICAgICAgb2Zmc2V0IC09IDAuNSAqIGdyb3VwLm9wdGlvbnMuYmFyQ2hhcnQud2lkdGg7CiAgICAgIH0gZWxzZSBpZiAoZ3JvdXAub3B0aW9ucy5iYXJDaGFydC5hbGlnbiA9PT0gJ3JpZ2h0JykgewogICAgICAgIG9mZnNldCArPSAwLjUgKiBncm91cC5vcHRpb25zLmJhckNoYXJ0LndpZHRoOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsgd2lkdGg6IHdpZHRoLCBvZmZzZXQ6IG9mZnNldCB9OwogIH07CgogIEJhcmdyYXBoLmdldFN0YWNrZWRZUmFuZ2UgPSBmdW5jdGlvbiAoY29tYmluZWREYXRhLCBncm91cFJhbmdlcywgZ3JvdXBJZHMsIGdyb3VwTGFiZWwsIG9yaWVudGF0aW9uKSB7CiAgICBpZiAoY29tYmluZWREYXRhLmxlbmd0aCA+IDApIHsKICAgICAgLy8gc29ydCBieSB0aW1lIGFuZCBieSBncm91cAogICAgICBjb21iaW5lZERhdGEuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGlmIChhLnggPT09IGIueCkgewogICAgICAgICAgcmV0dXJuIGEuZ3JvdXBJZCA8IGIuZ3JvdXBJZCA/IC0xIDogMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGEueCAtIGIueDsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB2YXIgaW50ZXJzZWN0aW9ucyA9IHt9OwoKICAgICAgQmFyZ3JhcGguX2dldERhdGFJbnRlcnNlY3Rpb25zKGludGVyc2VjdGlvbnMsIGNvbWJpbmVkRGF0YSk7CiAgICAgIGdyb3VwUmFuZ2VzW2dyb3VwTGFiZWxdID0gQmFyZ3JhcGguX2dldFN0YWNrZWRZUmFuZ2UoaW50ZXJzZWN0aW9ucywgY29tYmluZWREYXRhKTsKICAgICAgZ3JvdXBSYW5nZXNbZ3JvdXBMYWJlbF0ueUF4aXNPcmllbnRhdGlvbiA9IG9yaWVudGF0aW9uOwogICAgICBncm91cElkcy5wdXNoKGdyb3VwTGFiZWwpOwogICAgfQogIH07CgogIEJhcmdyYXBoLl9nZXRTdGFja2VkWVJhbmdlID0gZnVuY3Rpb24gKGludGVyc2VjdGlvbnMsIGNvbWJpbmVkRGF0YSkgewogICAgdmFyIGtleTsKICAgIHZhciB5TWluID0gY29tYmluZWREYXRhWzBdLnk7CiAgICB2YXIgeU1heCA9IGNvbWJpbmVkRGF0YVswXS55OwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb21iaW5lZERhdGEubGVuZ3RoOyBpKyspIHsKICAgICAga2V5ID0gY29tYmluZWREYXRhW2ldLng7CiAgICAgIGlmIChpbnRlcnNlY3Rpb25zW2tleV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIHlNaW4gPSB5TWluID4gY29tYmluZWREYXRhW2ldLnkgPyBjb21iaW5lZERhdGFbaV0ueSA6IHlNaW47CiAgICAgICAgeU1heCA9IHlNYXggPCBjb21iaW5lZERhdGFbaV0ueSA/IGNvbWJpbmVkRGF0YVtpXS55IDogeU1heDsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoY29tYmluZWREYXRhW2ldLnkgPCAwKSB7CiAgICAgICAgICBpbnRlcnNlY3Rpb25zW2tleV0uYWNjdW11bGF0ZWROZWdhdGl2ZSArPSBjb21iaW5lZERhdGFbaV0ueTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaW50ZXJzZWN0aW9uc1trZXldLmFjY3VtdWxhdGVkUG9zaXRpdmUgKz0gY29tYmluZWREYXRhW2ldLnk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmb3IgKHZhciB4cG9zIGluIGludGVyc2VjdGlvbnMpIHsKICAgICAgaWYgKGludGVyc2VjdGlvbnMuaGFzT3duUHJvcGVydHkoeHBvcykpIHsKICAgICAgICB5TWluID0geU1pbiA+IGludGVyc2VjdGlvbnNbeHBvc10uYWNjdW11bGF0ZWROZWdhdGl2ZSA/IGludGVyc2VjdGlvbnNbeHBvc10uYWNjdW11bGF0ZWROZWdhdGl2ZSA6IHlNaW47CiAgICAgICAgeU1pbiA9IHlNaW4gPiBpbnRlcnNlY3Rpb25zW3hwb3NdLmFjY3VtdWxhdGVkUG9zaXRpdmUgPyBpbnRlcnNlY3Rpb25zW3hwb3NdLmFjY3VtdWxhdGVkUG9zaXRpdmUgOiB5TWluOwogICAgICAgIHlNYXggPSB5TWF4IDwgaW50ZXJzZWN0aW9uc1t4cG9zXS5hY2N1bXVsYXRlZE5lZ2F0aXZlID8gaW50ZXJzZWN0aW9uc1t4cG9zXS5hY2N1bXVsYXRlZE5lZ2F0aXZlIDogeU1heDsKICAgICAgICB5TWF4ID0geU1heCA8IGludGVyc2VjdGlvbnNbeHBvc10uYWNjdW11bGF0ZWRQb3NpdGl2ZSA/IGludGVyc2VjdGlvbnNbeHBvc10uYWNjdW11bGF0ZWRQb3NpdGl2ZSA6IHlNYXg7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4geyBtaW46IHlNaW4sIG1heDogeU1heCB9OwogIH07CgogIG1vZHVsZS5leHBvcnRzID0gQmFyZ3JhcGg7CgovKioqLyB9LAovKiA1NyAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CiAgdmFyIERPTXV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcpOwogIHZhciBDb21wb25lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxKTsKCiAgLyoqCiAgICogTGVnZW5kIGZvciBHcmFwaDJkCiAgICovCiAgZnVuY3Rpb24gTGVnZW5kKGJvZHksIG9wdGlvbnMsIHNpZGUsIGxpbmVncmFwaE9wdGlvbnMpIHsKICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICB0aGlzLmRlZmF1bHRPcHRpb25zID0gewogICAgICBlbmFibGVkOiB0cnVlLAogICAgICBpY29uczogdHJ1ZSwKICAgICAgaWNvblNpemU6IDIwLAogICAgICBpY29uU3BhY2luZzogNiwKICAgICAgbGVmdDogewogICAgICAgIHZpc2libGU6IHRydWUsCiAgICAgICAgcG9zaXRpb246ICd0b3AtbGVmdCcgLy8gdG9wL2JvdHRvbSAtIGxlZnQsY2VudGVyLHJpZ2h0CiAgICAgIH0sCiAgICAgIHJpZ2h0OiB7CiAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICBwb3NpdGlvbjogJ3RvcC1sZWZ0JyAvLyB0b3AvYm90dG9tIC0gbGVmdCxjZW50ZXIscmlnaHQKICAgICAgfQogICAgfTsKICAgIHRoaXMuc2lkZSA9IHNpZGU7CiAgICB0aGlzLm9wdGlvbnMgPSB1dGlsLmV4dGVuZCh7fSwgdGhpcy5kZWZhdWx0T3B0aW9ucyk7CiAgICB0aGlzLmxpbmVncmFwaE9wdGlvbnMgPSBsaW5lZ3JhcGhPcHRpb25zOwoKICAgIHRoaXMuc3ZnRWxlbWVudHMgPSB7fTsKICAgIHRoaXMuZG9tID0ge307CiAgICB0aGlzLmdyb3VwcyA9IHt9OwogICAgdGhpcy5hbW91bnRPZkdyb3VwcyA9IDA7CiAgICB0aGlzLl9jcmVhdGUoKTsKCiAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgfQoKICBMZWdlbmQucHJvdG90eXBlID0gbmV3IENvbXBvbmVudCgpOwoKICBMZWdlbmQucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5ncm91cHMgPSB7fTsKICAgIHRoaXMuYW1vdW50T2ZHcm91cHMgPSAwOwogIH07CgogIExlZ2VuZC5wcm90b3R5cGUuYWRkR3JvdXAgPSBmdW5jdGlvbiAobGFiZWwsIGdyYXBoT3B0aW9ucykgewoKICAgIGlmICghdGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobGFiZWwpKSB7CiAgICAgIHRoaXMuZ3JvdXBzW2xhYmVsXSA9IGdyYXBoT3B0aW9uczsKICAgIH0KICAgIHRoaXMuYW1vdW50T2ZHcm91cHMgKz0gMTsKICB9OwoKICBMZWdlbmQucHJvdG90eXBlLnVwZGF0ZUdyb3VwID0gZnVuY3Rpb24gKGxhYmVsLCBncmFwaE9wdGlvbnMpIHsKICAgIHRoaXMuZ3JvdXBzW2xhYmVsXSA9IGdyYXBoT3B0aW9uczsKICB9OwoKICBMZWdlbmQucHJvdG90eXBlLnJlbW92ZUdyb3VwID0gZnVuY3Rpb24gKGxhYmVsKSB7CiAgICBpZiAodGhpcy5ncm91cHMuaGFzT3duUHJvcGVydHkobGFiZWwpKSB7CiAgICAgIGRlbGV0ZSB0aGlzLmdyb3Vwc1tsYWJlbF07CiAgICAgIHRoaXMuYW1vdW50T2ZHcm91cHMgLT0gMTsKICAgIH0KICB9OwoKICBMZWdlbmQucHJvdG90eXBlLl9jcmVhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmRvbS5mcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgdGhpcy5kb20uZnJhbWUuY2xhc3NOYW1lID0gJ3Zpcy1sZWdlbmQnOwogICAgdGhpcy5kb20uZnJhbWUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgdGhpcy5kb20uZnJhbWUuc3R5bGUudG9wID0gJzEwcHgnOwogICAgdGhpcy5kb20uZnJhbWUuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CgogICAgdGhpcy5kb20udGV4dEFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHRoaXMuZG9tLnRleHRBcmVhLmNsYXNzTmFtZSA9ICd2aXMtbGVnZW5kLXRleHQnOwogICAgdGhpcy5kb20udGV4dEFyZWEuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnOwogICAgdGhpcy5kb20udGV4dEFyZWEuc3R5bGUudG9wID0gJzBweCc7CgogICAgdGhpcy5zdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3N2ZycpOwogICAgdGhpcy5zdmcuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgdGhpcy5zdmcuc3R5bGUudG9wID0gMCArICdweCc7CiAgICB0aGlzLnN2Zy5zdHlsZS53aWR0aCA9IHRoaXMub3B0aW9ucy5pY29uU2l6ZSArIDUgKyAncHgnOwogICAgdGhpcy5zdmcuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnOwoKICAgIHRoaXMuZG9tLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuc3ZnKTsKICAgIHRoaXMuZG9tLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuZG9tLnRleHRBcmVhKTsKICB9OwoKICAvKioKICAgKiBIaWRlIHRoZSBjb21wb25lbnQgZnJvbSB0aGUgRE9NCiAgICovCiAgTGVnZW5kLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewogICAgLy8gcmVtb3ZlIHRoZSBmcmFtZSBjb250YWluaW5nIHRoZSBpdGVtcwogICAgaWYgKHRoaXMuZG9tLmZyYW1lLnBhcmVudE5vZGUpIHsKICAgICAgdGhpcy5kb20uZnJhbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmRvbS5mcmFtZSk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU2hvdyB0aGUgY29tcG9uZW50IGluIHRoZSBET00gKHdoZW4gbm90IGFscmVhZHkgdmlzaWJsZSkuCiAgICogQHJldHVybiB7Qm9vbGVhbn0gY2hhbmdlZAogICAqLwogIExlZ2VuZC5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHsKICAgIC8vIHNob3cgZnJhbWUgY29udGFpbmluZyB0aGUgaXRlbXMKICAgIGlmICghdGhpcy5kb20uZnJhbWUucGFyZW50Tm9kZSkgewogICAgICB0aGlzLmJvZHkuZG9tLmNlbnRlci5hcHBlbmRDaGlsZCh0aGlzLmRvbS5mcmFtZSk7CiAgICB9CiAgfTsKCiAgTGVnZW5kLnByb3RvdHlwZS5zZXRPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgIHZhciBmaWVsZHMgPSBbJ2VuYWJsZWQnLCAnb3JpZW50YXRpb24nLCAnaWNvbnMnLCAnbGVmdCcsICdyaWdodCddOwogICAgdXRpbC5zZWxlY3RpdmVEZWVwRXh0ZW5kKGZpZWxkcywgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKICB9OwoKICBMZWdlbmQucHJvdG90eXBlLnJlZHJhdyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBhY3RpdmVHcm91cHMgPSAwOwogICAgdmFyIGdyb3VwQXJyYXkgPSBPYmplY3Qua2V5cyh0aGlzLmdyb3Vwcyk7CiAgICBncm91cEFycmF5LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgcmV0dXJuIGEgPCBiID8gLTEgOiAxOwogICAgfSk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cEFycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBncm91cElkID0gZ3JvdXBBcnJheVtpXTsKICAgICAgaWYgKHRoaXMuZ3JvdXBzW2dyb3VwSWRdLnZpc2libGUgPT0gdHJ1ZSAmJiAodGhpcy5saW5lZ3JhcGhPcHRpb25zLnZpc2liaWxpdHlbZ3JvdXBJZF0gPT09IHVuZGVmaW5lZCB8fCB0aGlzLmxpbmVncmFwaE9wdGlvbnMudmlzaWJpbGl0eVtncm91cElkXSA9PSB0cnVlKSkgewogICAgICAgIGFjdGl2ZUdyb3VwcysrOwogICAgICB9CiAgICB9CgogICAgaWYgKHRoaXMub3B0aW9uc1t0aGlzLnNpZGVdLnZpc2libGUgPT0gZmFsc2UgfHwgdGhpcy5hbW91bnRPZkdyb3VwcyA9PSAwIHx8IHRoaXMub3B0aW9ucy5lbmFibGVkID09IGZhbHNlIHx8IGFjdGl2ZUdyb3VwcyA9PSAwKSB7CiAgICAgIHRoaXMuaGlkZSgpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5zaG93KCk7CiAgICAgIGlmICh0aGlzLm9wdGlvbnNbdGhpcy5zaWRlXS5wb3NpdGlvbiA9PSAndG9wLWxlZnQnIHx8IHRoaXMub3B0aW9uc1t0aGlzLnNpZGVdLnBvc2l0aW9uID09ICdib3R0b20tbGVmdCcpIHsKICAgICAgICB0aGlzLmRvbS5mcmFtZS5zdHlsZS5sZWZ0ID0gJzRweCc7CiAgICAgICAgdGhpcy5kb20uZnJhbWUuc3R5bGUudGV4dEFsaWduID0gJ2xlZnQnOwogICAgICAgIHRoaXMuZG9tLnRleHRBcmVhLnN0eWxlLnRleHRBbGlnbiA9ICdsZWZ0JzsKICAgICAgICB0aGlzLmRvbS50ZXh0QXJlYS5zdHlsZS5sZWZ0ID0gdGhpcy5vcHRpb25zLmljb25TaXplICsgMTUgKyAncHgnOwogICAgICAgIHRoaXMuZG9tLnRleHRBcmVhLnN0eWxlLnJpZ2h0ID0gJyc7CiAgICAgICAgdGhpcy5zdmcuc3R5bGUubGVmdCA9IDAgKyAncHgnOwogICAgICAgIHRoaXMuc3ZnLnN0eWxlLnJpZ2h0ID0gJyc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5kb20uZnJhbWUuc3R5bGUucmlnaHQgPSAnNHB4JzsKICAgICAgICB0aGlzLmRvbS5mcmFtZS5zdHlsZS50ZXh0QWxpZ24gPSAncmlnaHQnOwogICAgICAgIHRoaXMuZG9tLnRleHRBcmVhLnN0eWxlLnRleHRBbGlnbiA9ICdyaWdodCc7CiAgICAgICAgdGhpcy5kb20udGV4dEFyZWEuc3R5bGUucmlnaHQgPSB0aGlzLm9wdGlvbnMuaWNvblNpemUgKyAxNSArICdweCc7CiAgICAgICAgdGhpcy5kb20udGV4dEFyZWEuc3R5bGUubGVmdCA9ICcnOwogICAgICAgIHRoaXMuc3ZnLnN0eWxlLnJpZ2h0ID0gMCArICdweCc7CiAgICAgICAgdGhpcy5zdmcuc3R5bGUubGVmdCA9ICcnOwogICAgICB9CgogICAgICBpZiAodGhpcy5vcHRpb25zW3RoaXMuc2lkZV0ucG9zaXRpb24gPT0gJ3RvcC1sZWZ0JyB8fCB0aGlzLm9wdGlvbnNbdGhpcy5zaWRlXS5wb3NpdGlvbiA9PSAndG9wLXJpZ2h0JykgewogICAgICAgIHRoaXMuZG9tLmZyYW1lLnN0eWxlLnRvcCA9IDQgLSBOdW1iZXIodGhpcy5ib2R5LmRvbS5jZW50ZXIuc3R5bGUudG9wLnJlcGxhY2UoJ3B4JywgJycpKSArICdweCc7CiAgICAgICAgdGhpcy5kb20uZnJhbWUuc3R5bGUuYm90dG9tID0gJyc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHNjcm9sbGFibGVIZWlnaHQgPSB0aGlzLmJvZHkuZG9tUHJvcHMuY2VudGVyLmhlaWdodCAtIHRoaXMuYm9keS5kb21Qcm9wcy5jZW50ZXJDb250YWluZXIuaGVpZ2h0OwogICAgICAgIHRoaXMuZG9tLmZyYW1lLnN0eWxlLmJvdHRvbSA9IDQgKyBzY3JvbGxhYmxlSGVpZ2h0ICsgTnVtYmVyKHRoaXMuYm9keS5kb20uY2VudGVyLnN0eWxlLnRvcC5yZXBsYWNlKCdweCcsICcnKSkgKyAncHgnOwogICAgICAgIHRoaXMuZG9tLmZyYW1lLnN0eWxlLnRvcCA9ICcnOwogICAgICB9CgogICAgICBpZiAodGhpcy5vcHRpb25zLmljb25zID09IGZhbHNlKSB7CiAgICAgICAgdGhpcy5kb20uZnJhbWUuc3R5bGUud2lkdGggPSB0aGlzLmRvbS50ZXh0QXJlYS5vZmZzZXRXaWR0aCArIDEwICsgJ3B4JzsKICAgICAgICB0aGlzLmRvbS50ZXh0QXJlYS5zdHlsZS5yaWdodCA9ICcnOwogICAgICAgIHRoaXMuZG9tLnRleHRBcmVhLnN0eWxlLmxlZnQgPSAnJzsKICAgICAgICB0aGlzLnN2Zy5zdHlsZS53aWR0aCA9ICcwcHgnOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9tLmZyYW1lLnN0eWxlLndpZHRoID0gdGhpcy5vcHRpb25zLmljb25TaXplICsgMTUgKyB0aGlzLmRvbS50ZXh0QXJlYS5vZmZzZXRXaWR0aCArIDEwICsgJ3B4JzsKICAgICAgICB0aGlzLmRyYXdMZWdlbmRJY29ucygpOwogICAgICB9CgogICAgICB2YXIgY29udGVudCA9ICcnOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3VwQXJyYXkubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgZ3JvdXBJZCA9IGdyb3VwQXJyYXlbaV07CiAgICAgICAgaWYgKHRoaXMuZ3JvdXBzW2dyb3VwSWRdLnZpc2libGUgPT0gdHJ1ZSAmJiAodGhpcy5saW5lZ3JhcGhPcHRpb25zLnZpc2liaWxpdHlbZ3JvdXBJZF0gPT09IHVuZGVmaW5lZCB8fCB0aGlzLmxpbmVncmFwaE9wdGlvbnMudmlzaWJpbGl0eVtncm91cElkXSA9PSB0cnVlKSkgewogICAgICAgICAgY29udGVudCArPSB0aGlzLmdyb3Vwc1tncm91cElkXS5jb250ZW50ICsgJzxiciAvPic7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZG9tLnRleHRBcmVhLmlubmVySFRNTCA9IGNvbnRlbnQ7CiAgICAgIHRoaXMuZG9tLnRleHRBcmVhLnN0eWxlLmxpbmVIZWlnaHQgPSAwLjc1ICogdGhpcy5vcHRpb25zLmljb25TaXplICsgdGhpcy5vcHRpb25zLmljb25TcGFjaW5nICsgJ3B4JzsKICAgIH0KICB9OwoKICBMZWdlbmQucHJvdG90eXBlLmRyYXdMZWdlbmRJY29ucyA9IGZ1bmN0aW9uICgpIHsKICAgIGlmICh0aGlzLmRvbS5mcmFtZS5wYXJlbnROb2RlKSB7CiAgICAgIHZhciBncm91cEFycmF5ID0gT2JqZWN0LmtleXModGhpcy5ncm91cHMpOwogICAgICBncm91cEFycmF5LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYSA8IGIgPyAtMSA6IDE7CiAgICAgIH0pOwoKICAgICAgRE9NdXRpbC5wcmVwYXJlRWxlbWVudHModGhpcy5zdmdFbGVtZW50cyk7CiAgICAgIHZhciBwYWRkaW5nID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5kb20uZnJhbWUpLnBhZGRpbmdUb3A7CiAgICAgIHZhciBpY29uT2Zmc2V0ID0gTnVtYmVyKHBhZGRpbmcucmVwbGFjZSgncHgnLCAnJykpOwogICAgICB2YXIgeCA9IGljb25PZmZzZXQ7CiAgICAgIHZhciBpY29uV2lkdGggPSB0aGlzLm9wdGlvbnMuaWNvblNpemU7CiAgICAgIHZhciBpY29uSGVpZ2h0ID0gMC43NSAqIHRoaXMub3B0aW9ucy5pY29uU2l6ZTsKICAgICAgdmFyIHkgPSBpY29uT2Zmc2V0ICsgMC41ICogaWNvbkhlaWdodCArIDM7CgogICAgICB0aGlzLnN2Zy5zdHlsZS53aWR0aCA9IGljb25XaWR0aCArIDUgKyBpY29uT2Zmc2V0ICsgJ3B4JzsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBBcnJheS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBncm91cElkID0gZ3JvdXBBcnJheVtpXTsKICAgICAgICBpZiAodGhpcy5ncm91cHNbZ3JvdXBJZF0udmlzaWJsZSA9PSB0cnVlICYmICh0aGlzLmxpbmVncmFwaE9wdGlvbnMudmlzaWJpbGl0eVtncm91cElkXSA9PT0gdW5kZWZpbmVkIHx8IHRoaXMubGluZWdyYXBoT3B0aW9ucy52aXNpYmlsaXR5W2dyb3VwSWRdID09IHRydWUpKSB7CiAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cElkXS5kcmF3SWNvbih4LCB5LCB0aGlzLnN2Z0VsZW1lbnRzLCB0aGlzLnN2ZywgaWNvbldpZHRoLCBpY29uSGVpZ2h0KTsKICAgICAgICAgIHkgKz0gaWNvbkhlaWdodCArIHRoaXMub3B0aW9ucy5pY29uU3BhY2luZzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIERPTXV0aWwuY2xlYW51cEVsZW1lbnRzKHRoaXMuc3ZnRWxlbWVudHMpOwogICAgfQogIH07CgogIG1vZHVsZS5leHBvcnRzID0gTGVnZW5kOwoKLyoqKi8gfSwKLyogNTggKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgogIC8qKgogICAqIFRoaXMgb2JqZWN0IGNvbnRhaW5zIGFsbCBwb3NzaWJsZSBvcHRpb25zLiBJdCB3aWxsIGNoZWNrIGlmIHRoZSB0eXBlcyBhcmUgY29ycmVjdCwgaWYgcmVxdWlyZWQgaWYgdGhlIG9wdGlvbiBpcyBvbmUKICAgKiBvZiB0aGUgYWxsb3dlZCB2YWx1ZXMuCiAgICoKICAgKiBfX2FueV9fIG1lYW5zIHRoYXQgdGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5IGRvZXMgbm90IG1hdHRlci4KICAgKiBfX3R5cGVfXyBpcyBhIHJlcXVpcmVkIGZpZWxkIGZvciBhbGwgb2JqZWN0cyBhbmQgY29udGFpbnMgdGhlIGFsbG93ZWQgdHlwZXMgb2YgYWxsIG9iamVjdHMKICAgKi8KICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CiAgdmFyIHN0cmluZyA9ICdzdHJpbmcnOwogIHZhciBib29sZWFuID0gJ2Jvb2xlYW4nOwogIHZhciBudW1iZXIgPSAnbnVtYmVyJzsKICB2YXIgYXJyYXkgPSAnYXJyYXknOwogIHZhciBkYXRlID0gJ2RhdGUnOwogIHZhciBvYmplY3QgPSAnb2JqZWN0JzsgLy8gc2hvdWxkIG9ubHkgYmUgaW4gYSBfX3R5cGVfXyBwcm9wZXJ0eQogIHZhciBkb20gPSAnZG9tJzsKICB2YXIgbW9tZW50ID0gJ21vbWVudCc7CiAgdmFyIGFueSA9ICdhbnknOwoKICB2YXIgYWxsT3B0aW9ucyA9IHsKICAgIGNvbmZpZ3VyZTogewogICAgICBlbmFibGVkOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgZmlsdGVyOiB7IGJvb2xlYW46IGJvb2xlYW4sICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfSwKICAgICAgY29udGFpbmVyOiB7IGRvbTogZG9tIH0sCiAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0LCBib29sZWFuOiBib29sZWFuLCAnZnVuY3Rpb24nOiAnZnVuY3Rpb24nIH0KICAgIH0sCgogICAgLy9nbG9iYWxzIDoKICAgIHlBeGlzT3JpZW50YXRpb246IHsgc3RyaW5nOiBbJ2xlZnQnLCAncmlnaHQnXSB9LAogICAgZGVmYXVsdEdyb3VwOiB7IHN0cmluZzogc3RyaW5nIH0sCiAgICBzb3J0OiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIHNhbXBsaW5nOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIHN0YWNrOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIGdyYXBoSGVpZ2h0OiB7IHN0cmluZzogc3RyaW5nLCBudW1iZXI6IG51bWJlciB9LAogICAgc2hhZGVkOiB7CiAgICAgIGVuYWJsZWQ6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBvcmllbnRhdGlvbjogeyBzdHJpbmc6IFsnYm90dG9tJywgJ3RvcCddIH0sIC8vIHRvcCwgYm90dG9tCiAgICAgIF9fdHlwZV9fOiB7IGJvb2xlYW46IGJvb2xlYW4sIG9iamVjdDogb2JqZWN0IH0KICAgIH0sCiAgICBzdHlsZTogeyBzdHJpbmc6IFsnbGluZScsICdiYXInLCAncG9pbnRzJ10gfSwgLy8gbGluZSwgYmFyCiAgICBiYXJDaGFydDogewogICAgICB3aWR0aDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICBzaWRlQnlTaWRlOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgYWxpZ246IHsgc3RyaW5nOiBbJ2xlZnQnLCAnY2VudGVyJywgJ3JpZ2h0J10gfSwKICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgfSwKICAgIGludGVycG9sYXRpb246IHsKICAgICAgZW5hYmxlZDogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgIHBhcmFtZXRyaXphdGlvbjogeyBzdHJpbmc6IFsnY2VudHJpcGV0YWwnLCAnY2hvcmRhbCcsICd1bmlmb3JtJ10gfSwgLy8gdW5pZm9ybSAoYWxwaGEgPSAwLjApLCBjaG9yZGFsIChhbHBoYSA9IDEuMCksIGNlbnRyaXBldGFsIChhbHBoYSA9IDAuNSkKICAgICAgYWxwaGE6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QsIGJvb2xlYW46IGJvb2xlYW4gfQogICAgfSwKICAgIGRyYXdQb2ludHM6IHsKICAgICAgZW5hYmxlZDogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgIHNpemU6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgc3R5bGU6IHsgc3RyaW5nOiBbJ3NxdWFyZScsICdjaXJjbGUnXSB9LCAvLyBzcXVhcmUsIGNpcmNsZQogICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCwgYm9vbGVhbjogYm9vbGVhbiB9CiAgICB9LAogICAgZGF0YUF4aXM6IHsKICAgICAgc2hvd01pbm9yTGFiZWxzOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgc2hvd01ham9yTGFiZWxzOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgaWNvbnM6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICB3aWR0aDogeyBzdHJpbmc6IHN0cmluZywgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgdmlzaWJsZTogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgIGFsaWduWmVyb3M6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBsZWZ0OiB7CiAgICAgICAgcmFuZ2U6IHsgbWluOiB7IG51bWJlcjogbnVtYmVyIH0sIG1heDogeyBudW1iZXI6IG51bWJlciB9LCBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9IH0sCiAgICAgICAgZm9ybWF0OiB7ICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfSwKICAgICAgICB0aXRsZTogeyB0ZXh0OiB7IHN0cmluZzogc3RyaW5nLCBudW1iZXI6IG51bWJlciB9LCBzdHlsZTogeyBzdHJpbmc6IHN0cmluZyB9LCBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9IH0sCiAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgICB9LAogICAgICByaWdodDogewogICAgICAgIHJhbmdlOiB7IG1pbjogeyBudW1iZXI6IG51bWJlciB9LCBtYXg6IHsgbnVtYmVyOiBudW1iZXIgfSwgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfSB9LAogICAgICAgIGZvcm1hdDogeyAnZnVuY3Rpb24nOiAnZnVuY3Rpb24nIH0sCiAgICAgICAgdGl0bGU6IHsgdGV4dDogeyBzdHJpbmc6IHN0cmluZywgbnVtYmVyOiBudW1iZXIgfSwgc3R5bGU6IHsgc3RyaW5nOiBzdHJpbmcgfSwgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfSB9LAogICAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICAgICAgfSwKICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgfSwKICAgIGxlZ2VuZDogewogICAgICBlbmFibGVkOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgaWNvbnM6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBsZWZ0OiB7CiAgICAgICAgdmlzaWJsZTogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgICAgcG9zaXRpb246IHsgc3RyaW5nOiBbJ3RvcC1yaWdodCcsICdib3R0b20tcmlnaHQnLCAndG9wLWxlZnQnLCAnYm90dG9tLWxlZnQnXSB9LAogICAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICAgICAgfSwKICAgICAgcmlnaHQ6IHsKICAgICAgICB2aXNpYmxlOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgICBwb3NpdGlvbjogeyBzdHJpbmc6IFsndG9wLXJpZ2h0JywgJ2JvdHRvbS1yaWdodCcsICd0b3AtbGVmdCcsICdib3R0b20tbGVmdCddIH0sCiAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgICB9LAogICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCwgYm9vbGVhbjogYm9vbGVhbiB9CiAgICB9LAogICAgZ3JvdXBzOiB7CiAgICAgIHZpc2liaWxpdHk6IHsgYW55OiBhbnkgfSwKICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgfSwKCiAgICBhdXRvUmVzaXplOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIGNsaWNrVG9Vc2U6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgZW5kOiB7IG51bWJlcjogbnVtYmVyLCBkYXRlOiBkYXRlLCBzdHJpbmc6IHN0cmluZywgbW9tZW50OiBtb21lbnQgfSwKICAgIGZvcm1hdDogewogICAgICBtaW5vckxhYmVsczogewogICAgICAgIG1pbGxpc2Vjb25kOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBzZWNvbmQ6IHsgc3RyaW5nOiBzdHJpbmcsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICAgIG1pbnV0ZTogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgaG91cjogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgd2Vla2RheTogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgZGF5OiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBtb250aDogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgeWVhcjogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgICB9LAogICAgICBtYWpvckxhYmVsczogewogICAgICAgIG1pbGxpc2Vjb25kOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBzZWNvbmQ6IHsgc3RyaW5nOiBzdHJpbmcsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICAgIG1pbnV0ZTogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgaG91cjogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgd2Vla2RheTogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgZGF5OiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgICBtb250aDogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgeWVhcjogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgICB9LAogICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9CiAgICB9LAogICAgaGVpZ2h0OiB7IHN0cmluZzogc3RyaW5nLCBudW1iZXI6IG51bWJlciB9LAogICAgaGlkZGVuRGF0ZXM6IHsgb2JqZWN0OiBvYmplY3QsIGFycmF5OiBhcnJheSB9LAogICAgbG9jYWxlOiB7IHN0cmluZzogc3RyaW5nIH0sCiAgICBsb2NhbGVzOiB7CiAgICAgIF9fYW55X186IHsgYW55OiBhbnkgfSwKICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgfSwKICAgIG1heDogeyBkYXRlOiBkYXRlLCBudW1iZXI6IG51bWJlciwgc3RyaW5nOiBzdHJpbmcsIG1vbWVudDogbW9tZW50IH0sCiAgICBtYXhIZWlnaHQ6IHsgbnVtYmVyOiBudW1iZXIsIHN0cmluZzogc3RyaW5nIH0sCiAgICBtaW46IHsgZGF0ZTogZGF0ZSwgbnVtYmVyOiBudW1iZXIsIHN0cmluZzogc3RyaW5nLCBtb21lbnQ6IG1vbWVudCB9LAogICAgbWluSGVpZ2h0OiB7IG51bWJlcjogbnVtYmVyLCBzdHJpbmc6IHN0cmluZyB9LAogICAgbW92ZWFibGU6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgbXVsdGlzZWxlY3Q6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgb3JpZW50YXRpb246IHsgc3RyaW5nOiBzdHJpbmcgfSwKICAgIHNob3dDdXJyZW50VGltZTogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICBzaG93TWFqb3JMYWJlbHM6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgc2hvd01pbm9yTGFiZWxzOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIHN0YXJ0OiB7IGRhdGU6IGRhdGUsIG51bWJlcjogbnVtYmVyLCBzdHJpbmc6IHN0cmluZywgbW9tZW50OiBtb21lbnQgfSwKICAgIHRpbWVBeGlzOiB7CiAgICAgIHNjYWxlOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgc3RlcDogeyBudW1iZXI6IG51bWJlciwgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICAgIH0sCiAgICB3aWR0aDogeyBzdHJpbmc6IHN0cmluZywgbnVtYmVyOiBudW1iZXIgfSwKICAgIHpvb21hYmxlOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIHpvb21NYXg6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgIHpvb21NaW46IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICB9OwoKICB2YXIgY29uZmlndXJlT3B0aW9ucyA9IHsKICAgIGdsb2JhbDogewogICAgICAvL3lBeGlzT3JpZW50YXRpb246IFsnbGVmdCcsJ3JpZ2h0J10sIC8vIFRET086IGVuYWJsZSBhcyBzb29uIGFzIEdyYWhwMmQgZG9lc24ndCBjcmFzaCB3aGVuIGNoYW5naW5nIHRoaXMgb24gdGhlIGZseQogICAgICBzb3J0OiB0cnVlLAogICAgICBzYW1wbGluZzogdHJ1ZSwKICAgICAgc3RhY2s6IGZhbHNlLAogICAgICBzaGFkZWQ6IHsKICAgICAgICBlbmFibGVkOiBmYWxzZSwKICAgICAgICBvcmllbnRhdGlvbjogWyd0b3AnLCAnYm90dG9tJ10gLy8gdG9wLCBib3R0b20KICAgICAgfSwKICAgICAgc3R5bGU6IFsnbGluZScsICdiYXInLCAncG9pbnRzJ10sIC8vIGxpbmUsIGJhcgogICAgICBiYXJDaGFydDogewogICAgICAgIHdpZHRoOiBbNTAsIDUsIDEwMCwgNV0sCiAgICAgICAgc2lkZUJ5U2lkZTogZmFsc2UsCiAgICAgICAgYWxpZ246IFsnbGVmdCcsICdjZW50ZXInLCAncmlnaHQnXSAvLyBsZWZ0LCBjZW50ZXIsIHJpZ2h0CiAgICAgIH0sCiAgICAgIGludGVycG9sYXRpb246IHsKICAgICAgICBlbmFibGVkOiB0cnVlLAogICAgICAgIHBhcmFtZXRyaXphdGlvbjogWydjZW50cmlwZXRhbCcsICdjaG9yZGFsJywgJ3VuaWZvcm0nXSAvLyB1bmlmb3JtIChhbHBoYSA9IDAuMCksIGNob3JkYWwgKGFscGhhID0gMS4wKSwgY2VudHJpcGV0YWwgKGFscGhhID0gMC41KQogICAgICB9LAogICAgICBkcmF3UG9pbnRzOiB7CiAgICAgICAgZW5hYmxlZDogdHJ1ZSwKICAgICAgICBzaXplOiBbNiwgMiwgMzAsIDFdLAogICAgICAgIHN0eWxlOiBbJ3NxdWFyZScsICdjaXJjbGUnXSAvLyBzcXVhcmUsIGNpcmNsZQogICAgICB9LAogICAgICBkYXRhQXhpczogewogICAgICAgIHNob3dNaW5vckxhYmVsczogdHJ1ZSwKICAgICAgICBzaG93TWFqb3JMYWJlbHM6IHRydWUsCiAgICAgICAgaWNvbnM6IGZhbHNlLAogICAgICAgIHdpZHRoOiBbNDAsIDAsIDIwMCwgMV0sCiAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICBhbGlnblplcm9zOiB0cnVlLAogICAgICAgIGxlZnQ6IHsKICAgICAgICAgIC8vcmFuZ2U6IHttaW46J3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnaW5lZCxtYXg6J3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnaW5lZH0sCiAgICAgICAgICAvL2Zvcm1hdDogZnVuY3Rpb24gKHZhbHVlKSB7cmV0dXJuIHZhbHVlO30sCiAgICAgICAgICB0aXRsZTogeyB0ZXh0OiAnJywgc3R5bGU6ICcnIH0KICAgICAgICB9LAogICAgICAgIHJpZ2h0OiB7CiAgICAgICAgICAvL3JhbmdlOiB7bWluOid1bmRlZmluZWQnOiAndW5kZWZpbmVkJ2luZWQsbWF4Oid1bmRlZmluZWQnOiAndW5kZWZpbmVkJ2luZWR9LAogICAgICAgICAgLy9mb3JtYXQ6IGZ1bmN0aW9uICh2YWx1ZSkge3JldHVybiB2YWx1ZTt9LAogICAgICAgICAgdGl0bGU6IHsgdGV4dDogJycsIHN0eWxlOiAnJyB9CiAgICAgICAgfQogICAgICB9LAogICAgICBsZWdlbmQ6IHsKICAgICAgICBlbmFibGVkOiBmYWxzZSwKICAgICAgICBpY29uczogdHJ1ZSwKICAgICAgICBsZWZ0OiB7CiAgICAgICAgICB2aXNpYmxlOiB0cnVlLAogICAgICAgICAgcG9zaXRpb246IFsndG9wLXJpZ2h0JywgJ2JvdHRvbS1yaWdodCcsICd0b3AtbGVmdCcsICdib3R0b20tbGVmdCddIC8vIHRvcC9ib3R0b20gLSBsZWZ0LHJpZ2h0CiAgICAgICAgfSwKICAgICAgICByaWdodDogewogICAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICAgIHBvc2l0aW9uOiBbJ3RvcC1yaWdodCcsICdib3R0b20tcmlnaHQnLCAndG9wLWxlZnQnLCAnYm90dG9tLWxlZnQnXSAvLyB0b3AvYm90dG9tIC0gbGVmdCxyaWdodAogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGF1dG9SZXNpemU6IHRydWUsCiAgICAgIGNsaWNrVG9Vc2U6IGZhbHNlLAogICAgICBlbmQ6ICcnLAogICAgICBmb3JtYXQ6IHsKICAgICAgICBtaW5vckxhYmVsczogewogICAgICAgICAgbWlsbGlzZWNvbmQ6ICdTU1MnLAogICAgICAgICAgc2Vjb25kOiAncycsCiAgICAgICAgICBtaW51dGU6ICdISDptbScsCiAgICAgICAgICBob3VyOiAnSEg6bW0nLAogICAgICAgICAgd2Vla2RheTogJ2RkZCBEJywKICAgICAgICAgIGRheTogJ0QnLAogICAgICAgICAgbW9udGg6ICdNTU0nLAogICAgICAgICAgeWVhcjogJ1lZWVknCiAgICAgICAgfSwKICAgICAgICBtYWpvckxhYmVsczogewogICAgICAgICAgbWlsbGlzZWNvbmQ6ICdISDptbTpzcycsCiAgICAgICAgICBzZWNvbmQ6ICdEIE1NTU0gSEg6bW0nLAogICAgICAgICAgbWludXRlOiAnZGRkIEQgTU1NTScsCiAgICAgICAgICBob3VyOiAnZGRkIEQgTU1NTScsCiAgICAgICAgICB3ZWVrZGF5OiAnTU1NTSBZWVlZJywKICAgICAgICAgIGRheTogJ01NTU0gWVlZWScsCiAgICAgICAgICBtb250aDogJ1lZWVknLAogICAgICAgICAgeWVhcjogJycKICAgICAgICB9CiAgICAgIH0sCgogICAgICBoZWlnaHQ6ICcnLAogICAgICBsb2NhbGU6ICcnLAogICAgICBtYXg6ICcnLAogICAgICBtYXhIZWlnaHQ6ICcnLAogICAgICBtaW46ICcnLAogICAgICBtaW5IZWlnaHQ6ICcnLAogICAgICBtb3ZlYWJsZTogdHJ1ZSwKICAgICAgb3JpZW50YXRpb246IFsnYm90aCcsICdib3R0b20nLCAndG9wJ10sCiAgICAgIHNob3dDdXJyZW50VGltZTogZmFsc2UsCiAgICAgIHNob3dNYWpvckxhYmVsczogdHJ1ZSwKICAgICAgc2hvd01pbm9yTGFiZWxzOiB0cnVlLAogICAgICBzdGFydDogJycsCiAgICAgIHdpZHRoOiAnMTAwJScsCiAgICAgIHpvb21hYmxlOiB0cnVlLAogICAgICB6b29tTWF4OiBbMzE1MzYwMDAwMDAwMDAwLCAxMCwgMzE1MzYwMDAwMDAwMDAwLCAxXSwKICAgICAgem9vbU1pbjogWzEwLCAxMCwgMzE1MzYwMDAwMDAwMDAwLCAxXQogICAgfQogIH07CgogIGV4cG9ydHMuYWxsT3B0aW9ucyA9IGFsbE9wdGlvbnM7CiAgZXhwb3J0cy5jb25maWd1cmVPcHRpb25zID0gY29uZmlndXJlT3B0aW9uczsKCi8qKiovIH0sCi8qIDU5ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAvLyBMb2FkIGN1c3RvbSBzaGFwZXMgaW50byBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQKICAndXNlIHN0cmljdCc7CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgdmFyIF9tb2R1bGVzR3JvdXBzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MCk7CgogIHZhciBfbW9kdWxlc0dyb3VwczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tb2R1bGVzR3JvdXBzKTsKCiAgdmFyIF9tb2R1bGVzTm9kZXNIYW5kbGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MSk7CgogIHZhciBfbW9kdWxlc05vZGVzSGFuZGxlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tb2R1bGVzTm9kZXNIYW5kbGVyKTsKCiAgdmFyIF9tb2R1bGVzRWRnZXNIYW5kbGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4MSk7CgogIHZhciBfbW9kdWxlc0VkZ2VzSGFuZGxlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tb2R1bGVzRWRnZXNIYW5kbGVyKTsKCiAgdmFyIF9tb2R1bGVzUGh5c2ljc0VuZ2luZSA9IF9fd2VicGFja19yZXF1aXJlX18oODgpOwoKICB2YXIgX21vZHVsZXNQaHlzaWNzRW5naW5lMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX21vZHVsZXNQaHlzaWNzRW5naW5lKTsKCiAgdmFyIF9tb2R1bGVzQ2x1c3RlcmluZyA9IF9fd2VicGFja19yZXF1aXJlX18oOTcpOwoKICB2YXIgX21vZHVsZXNDbHVzdGVyaW5nMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX21vZHVsZXNDbHVzdGVyaW5nKTsKCiAgdmFyIF9tb2R1bGVzQ2FudmFzUmVuZGVyZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk5KTsKCiAgdmFyIF9tb2R1bGVzQ2FudmFzUmVuZGVyZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbW9kdWxlc0NhbnZhc1JlbmRlcmVyKTsKCiAgdmFyIF9tb2R1bGVzQ2FudmFzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMDApOwoKICB2YXIgX21vZHVsZXNDYW52YXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbW9kdWxlc0NhbnZhcyk7CgogIHZhciBfbW9kdWxlc1ZpZXcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwMSk7CgogIHZhciBfbW9kdWxlc1ZpZXcyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbW9kdWxlc1ZpZXcpOwoKICB2YXIgX21vZHVsZXNJbnRlcmFjdGlvbkhhbmRsZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwMik7CgogIHZhciBfbW9kdWxlc0ludGVyYWN0aW9uSGFuZGxlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tb2R1bGVzSW50ZXJhY3Rpb25IYW5kbGVyKTsKCiAgdmFyIF9tb2R1bGVzU2VsZWN0aW9uSGFuZGxlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTA1KTsKCiAgdmFyIF9tb2R1bGVzU2VsZWN0aW9uSGFuZGxlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tb2R1bGVzU2VsZWN0aW9uSGFuZGxlcik7CgogIHZhciBfbW9kdWxlc0xheW91dEVuZ2luZSA9IF9fd2VicGFja19yZXF1aXJlX18oMTA2KTsKCiAgdmFyIF9tb2R1bGVzTGF5b3V0RW5naW5lMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX21vZHVsZXNMYXlvdXRFbmdpbmUpOwoKICB2YXIgX21vZHVsZXNNYW5pcHVsYXRpb25TeXN0ZW0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwNyk7CgogIHZhciBfbW9kdWxlc01hbmlwdWxhdGlvblN5c3RlbTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9tb2R1bGVzTWFuaXB1bGF0aW9uU3lzdGVtKTsKCiAgdmFyIF9zaGFyZWRDb25maWd1cmF0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1KTsKCiAgdmFyIF9zaGFyZWRDb25maWd1cmF0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc2hhcmVkQ29uZmlndXJhdG9yKTsKCiAgdmFyIF9zaGFyZWRWYWxpZGF0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ3KTsKCiAgdmFyIF9zaGFyZWRWYWxpZGF0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc2hhcmVkVmFsaWRhdG9yKTsKCiAgdmFyIF9vcHRpb25zSnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwOCk7CgogIF9fd2VicGFja19yZXF1aXJlX18oMTA5KTsKCiAgdmFyIEVtaXR0ZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzKTsKICB2YXIgSGFtbWVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMyk7CiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwogIHZhciBEYXRhU2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKICB2YXIgRGF0YVZpZXcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKICB2YXIgZG90cGFyc2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMTApOwogIHZhciBnZXBoaVBhcnNlciA9IF9fd2VicGFja19yZXF1aXJlX18oMTExKTsKICB2YXIgSW1hZ2VzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMTIpOwogIHZhciBBY3RpdmF0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQyKTsKICB2YXIgbG9jYWxlcyA9IF9fd2VicGFja19yZXF1aXJlX18oMTEzKTsKCiAgLyoqCiAgICogQGNvbnN0cnVjdG9yIE5ldHdvcmsKICAgKiBDcmVhdGUgYSBuZXR3b3JrIHZpc3VhbGl6YXRpb24sIGRpc3BsYXlpbmcgbm9kZXMgYW5kIGVkZ2VzLgogICAqCiAgICogQHBhcmFtIHtFbGVtZW50fSBjb250YWluZXIgICBUaGUgRE9NIGVsZW1lbnQgaW4gd2hpY2ggdGhlIE5ldHdvcmsgd2lsbAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlIGNyZWF0ZWQuIE5vcm1hbGx5IGEgZGl2IGVsZW1lbnQuCiAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgICAgICAgICBBbiBvYmplY3QgY29udGFpbmluZyBwYXJhbWV0ZXJzCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7QXJyYXl9IG5vZGVzCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7QXJyYXl9IGVkZ2VzCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICAgICBPcHRpb25zCiAgICovCiAgZnVuY3Rpb24gTmV0d29yayhjb250YWluZXIsIGRhdGEsIG9wdGlvbnMpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIE5ldHdvcmspKSB7CiAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcignQ29uc3RydWN0b3IgbXVzdCBiZSBjYWxsZWQgd2l0aCB0aGUgbmV3IG9wZXJhdG9yJyk7CiAgICB9CgogICAgLy8gc2V0IGNvbnN0YW50IHZhbHVlcwogICAgdGhpcy5vcHRpb25zID0ge307CiAgICB0aGlzLmRlZmF1bHRPcHRpb25zID0gewogICAgICBsb2NhbGU6ICdlbicsCiAgICAgIGxvY2FsZXM6IGxvY2FsZXMsCiAgICAgIGNsaWNrVG9Vc2U6IGZhbHNlCiAgICB9OwogICAgdXRpbC5leHRlbmQodGhpcy5vcHRpb25zLCB0aGlzLmRlZmF1bHRPcHRpb25zKTsKCiAgICAvLyBjb250YWluZXJzIGZvciBub2RlcyBhbmQgZWRnZXMKICAgIHRoaXMuYm9keSA9IHsKICAgICAgY29udGFpbmVyOiBjb250YWluZXIsCiAgICAgIG5vZGVzOiB7fSwKICAgICAgbm9kZUluZGljZXM6IFtdLAogICAgICBlZGdlczoge30sCiAgICAgIGVkZ2VJbmRpY2VzOiBbXSwKICAgICAgZW1pdHRlcjogewogICAgICAgIG9uOiB0aGlzLm9uLmJpbmQodGhpcyksCiAgICAgICAgb2ZmOiB0aGlzLm9mZi5iaW5kKHRoaXMpLAogICAgICAgIGVtaXQ6IHRoaXMuZW1pdC5iaW5kKHRoaXMpLAogICAgICAgIG9uY2U6IHRoaXMub25jZS5iaW5kKHRoaXMpCiAgICAgIH0sCiAgICAgIGV2ZW50TGlzdGVuZXJzOiB7CiAgICAgICAgb25UYXA6IGZ1bmN0aW9uIG9uVGFwKCkge30sCiAgICAgICAgb25Ub3VjaDogZnVuY3Rpb24gb25Ub3VjaCgpIHt9LAogICAgICAgIG9uRG91YmxlVGFwOiBmdW5jdGlvbiBvbkRvdWJsZVRhcCgpIHt9LAogICAgICAgIG9uSG9sZDogZnVuY3Rpb24gb25Ib2xkKCkge30sCiAgICAgICAgb25EcmFnU3RhcnQ6IGZ1bmN0aW9uIG9uRHJhZ1N0YXJ0KCkge30sCiAgICAgICAgb25EcmFnOiBmdW5jdGlvbiBvbkRyYWcoKSB7fSwKICAgICAgICBvbkRyYWdFbmQ6IGZ1bmN0aW9uIG9uRHJhZ0VuZCgpIHt9LAogICAgICAgIG9uTW91c2VXaGVlbDogZnVuY3Rpb24gb25Nb3VzZVdoZWVsKCkge30sCiAgICAgICAgb25QaW5jaDogZnVuY3Rpb24gb25QaW5jaCgpIHt9LAogICAgICAgIG9uTW91c2VNb3ZlOiBmdW5jdGlvbiBvbk1vdXNlTW92ZSgpIHt9LAogICAgICAgIG9uUmVsZWFzZTogZnVuY3Rpb24gb25SZWxlYXNlKCkge30sCiAgICAgICAgb25Db250ZXh0OiBmdW5jdGlvbiBvbkNvbnRleHQoKSB7fQogICAgICB9LAogICAgICBkYXRhOiB7CiAgICAgICAgbm9kZXM6IG51bGwsIC8vIEEgRGF0YVNldCBvciBEYXRhVmlldwogICAgICAgIGVkZ2VzOiBudWxsIC8vIEEgRGF0YVNldCBvciBEYXRhVmlldwogICAgICB9LAogICAgICBmdW5jdGlvbnM6IHsKICAgICAgICBjcmVhdGVOb2RlOiBmdW5jdGlvbiBjcmVhdGVOb2RlKCkge30sCiAgICAgICAgY3JlYXRlRWRnZTogZnVuY3Rpb24gY3JlYXRlRWRnZSgpIHt9LAogICAgICAgIGdldFBvaW50ZXI6IGZ1bmN0aW9uIGdldFBvaW50ZXIoKSB7fQogICAgICB9LAogICAgICB2aWV3OiB7CiAgICAgICAgc2NhbGU6IDEsCiAgICAgICAgdHJhbnNsYXRpb246IHsgeDogMCwgeTogMCB9CiAgICAgIH0KICAgIH07CgogICAgLy8gYmluZCB0aGUgZXZlbnQgbGlzdGVuZXJzCiAgICB0aGlzLmJpbmRFdmVudExpc3RlbmVycygpOwoKICAgIC8vIHNldHRpbmcgdXAgYWxsIG1vZHVsZXMKICAgIHRoaXMuaW1hZ2VzID0gbmV3IEltYWdlcyhmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3JlcXVlc3RSZWRyYXcnKTsKICAgIH0pOyAvLyBvYmplY3Qgd2l0aCBpbWFnZXMKICAgIHRoaXMuZ3JvdXBzID0gbmV3IF9tb2R1bGVzR3JvdXBzMlsnZGVmYXVsdCddKCk7IC8vIG9iamVjdCB3aXRoIGdyb3VwcwogICAgdGhpcy5jYW52YXMgPSBuZXcgX21vZHVsZXNDYW52YXMyWydkZWZhdWx0J10odGhpcy5ib2R5KTsgLy8gRE9NIGhhbmRsZXIKICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlciA9IG5ldyBfbW9kdWxlc1NlbGVjdGlvbkhhbmRsZXIyWydkZWZhdWx0J10odGhpcy5ib2R5LCB0aGlzLmNhbnZhcyk7IC8vIFNlbGVjdGlvbiBoYW5kbGVyCiAgICB0aGlzLmludGVyYWN0aW9uSGFuZGxlciA9IG5ldyBfbW9kdWxlc0ludGVyYWN0aW9uSGFuZGxlcjJbJ2RlZmF1bHQnXSh0aGlzLmJvZHksIHRoaXMuY2FudmFzLCB0aGlzLnNlbGVjdGlvbkhhbmRsZXIpOyAvLyBJbnRlcmFjdGlvbiBoYW5kbGVyIGhhbmRsZXMgYWxsIHRoZSBoYW1tZXIgYmluZGluZ3MgKHRoYXQgYXJlIGJvdW5kIGJ5IGNhbnZhcyksIGtleQogICAgdGhpcy52aWV3ID0gbmV3IF9tb2R1bGVzVmlldzJbJ2RlZmF1bHQnXSh0aGlzLmJvZHksIHRoaXMuY2FudmFzKTsgLy8gY2FtZXJhIGhhbmRsZXIsIGRvZXMgYW5pbWF0aW9ucyBhbmQgem9vbXMKICAgIHRoaXMucmVuZGVyZXIgPSBuZXcgX21vZHVsZXNDYW52YXNSZW5kZXJlcjJbJ2RlZmF1bHQnXSh0aGlzLmJvZHksIHRoaXMuY2FudmFzKTsgLy8gcmVuZGVyZXIsIHN0YXJ0cyByZW5kZXJsb29wLCBoYXMgZXZlbnRzIHRoYXQgbW9kdWxlcyBjYW4gaG9vayBpbnRvCiAgICB0aGlzLnBoeXNpY3MgPSBuZXcgX21vZHVsZXNQaHlzaWNzRW5naW5lMlsnZGVmYXVsdCddKHRoaXMuYm9keSk7IC8vIHBoeXNpY3MgZW5naW5lLCBkb2VzIGFsbCB0aGUgc2ltdWxhdGlvbnMKICAgIHRoaXMubGF5b3V0RW5naW5lID0gbmV3IF9tb2R1bGVzTGF5b3V0RW5naW5lMlsnZGVmYXVsdCddKHRoaXMuYm9keSk7IC8vIGxheW91dCBlbmdpbmUgZm9yIGluaXRhbCBsYXlvdXQgYW5kIGhpZXJhcmNoaWNhbCBsYXlvdXQKICAgIHRoaXMuY2x1c3RlcmluZyA9IG5ldyBfbW9kdWxlc0NsdXN0ZXJpbmcyWydkZWZhdWx0J10odGhpcy5ib2R5KTsgLy8gY2x1c3RlcmluZyBhcGkKICAgIHRoaXMubWFuaXB1bGF0aW9uID0gbmV3IF9tb2R1bGVzTWFuaXB1bGF0aW9uU3lzdGVtMlsnZGVmYXVsdCddKHRoaXMuYm9keSwgdGhpcy5jYW52YXMsIHRoaXMuc2VsZWN0aW9uSGFuZGxlcik7IC8vIGRhdGEgbWFuaXB1bGF0aW9uIHN5c3RlbQoKICAgIHRoaXMubm9kZXNIYW5kbGVyID0gbmV3IF9tb2R1bGVzTm9kZXNIYW5kbGVyMlsnZGVmYXVsdCddKHRoaXMuYm9keSwgdGhpcy5pbWFnZXMsIHRoaXMuZ3JvdXBzLCB0aGlzLmxheW91dEVuZ2luZSk7IC8vIEhhbmRsZSBhZGRpbmcsIGRlbGV0aW5nIGFuZCB1cGRhdGluZyBvZiBub2RlcyBhcyB3ZWxsIGFzIGdsb2JhbCBvcHRpb25zCiAgICB0aGlzLmVkZ2VzSGFuZGxlciA9IG5ldyBfbW9kdWxlc0VkZ2VzSGFuZGxlcjJbJ2RlZmF1bHQnXSh0aGlzLmJvZHksIHRoaXMuaW1hZ2VzLCB0aGlzLmdyb3Vwcyk7IC8vIEhhbmRsZSBhZGRpbmcsIGRlbGV0aW5nIGFuZCB1cGRhdGluZyBvZiBlZGdlcyBhcyB3ZWxsIGFzIGdsb2JhbCBvcHRpb25zCgogICAgLy8gY3JlYXRlIHRoZSBET00gZWxlbWVudHMKICAgIHRoaXMuY2FudmFzLl9jcmVhdGUoKTsKCiAgICAvLyBhcHBseSBvcHRpb25zCiAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CgogICAgLy8gbG9hZCBkYXRhICh0aGUgZGlzYWJsZSBzdGFydCB2YXJpYWJsZSB3aWxsIGJlIHRoZSBzYW1lIGFzIHRoZSBlbmFibGVkIGNsdXN0ZXJpbmcpCiAgICB0aGlzLnNldERhdGEoZGF0YSk7CiAgfQoKICAvLyBFeHRlbmQgTmV0d29yayB3aXRoIGFuIEVtaXR0ZXIgbWl4aW4KICBFbWl0dGVyKE5ldHdvcmsucHJvdG90eXBlKTsKCiAgLyoqCiAgICogU2V0IG9wdGlvbnMKICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqLwogIE5ldHdvcmsucHJvdG90eXBlLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgaWYgKG9wdGlvbnMgIT09IHVuZGVmaW5lZCkgewoKICAgICAgdmFyIGVycm9yRm91bmQgPSBfc2hhcmVkVmFsaWRhdG9yMlsnZGVmYXVsdCddLnZhbGlkYXRlKG9wdGlvbnMsIF9vcHRpb25zSnMuYWxsT3B0aW9ucyk7CiAgICAgIGlmIChlcnJvckZvdW5kID09PSB0cnVlKSB7CiAgICAgICAgY29uc29sZS5sb2coJyVjRXJyb3JzIGhhdmUgYmVlbiBmb3VuZCBpbiB0aGUgc3VwcGxpZWQgb3B0aW9ucyBvYmplY3QuJywgX3NoYXJlZFZhbGlkYXRvci5wcmludFN0eWxlKTsKICAgICAgfQoKICAgICAgLy8gY29weSB0aGUgZ2xvYmFsIGZpZWxkcyBvdmVyCiAgICAgIHZhciBmaWVsZHMgPSBbJ2xvY2FsZScsICdsb2NhbGVzJywgJ2NsaWNrVG9Vc2UnXTsKICAgICAgdXRpbC5zZWxlY3RpdmVEZWVwRXh0ZW5kKGZpZWxkcywgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKCiAgICAgIC8vIHRoZSBoaWVyYXJjaGljYWwgc3lzdGVtIGNhbiBhZGFwdCB0aGUgZWRnZXMgYW5kIHRoZSBwaHlzaWNzIHRvIGl0J3Mgb3duIG9wdGlvbnMgYmVjYXVzZSBub3QgYWxsIGNvbWJpbmF0aW9ucyB3b3JrIHdpdGggdGhlIGhpZXJhcmljaGljYWwgc3lzdGVtLgogICAgICBvcHRpb25zID0gdGhpcy5sYXlvdXRFbmdpbmUuc2V0T3B0aW9ucyhvcHRpb25zLmxheW91dCwgb3B0aW9ucyk7CgogICAgICB0aGlzLmNhbnZhcy5zZXRPcHRpb25zKG9wdGlvbnMpOyAvLyBvcHRpb25zIGZvciBjYW52YXMgYXJlIGluIGdsb2JhbHMKCiAgICAgIC8vIHBhc3MgdGhlIG9wdGlvbnMgdG8gdGhlIG1vZHVsZXMKICAgICAgdGhpcy5ncm91cHMuc2V0T3B0aW9ucyhvcHRpb25zLmdyb3Vwcyk7CiAgICAgIHRoaXMubm9kZXNIYW5kbGVyLnNldE9wdGlvbnMob3B0aW9ucy5ub2Rlcyk7CiAgICAgIHRoaXMuZWRnZXNIYW5kbGVyLnNldE9wdGlvbnMob3B0aW9ucy5lZGdlcyk7CiAgICAgIHRoaXMucGh5c2ljcy5zZXRPcHRpb25zKG9wdGlvbnMucGh5c2ljcyk7CiAgICAgIHRoaXMubWFuaXB1bGF0aW9uLnNldE9wdGlvbnMob3B0aW9ucy5tYW5pcHVsYXRpb24sIG9wdGlvbnMsIHRoaXMub3B0aW9ucyk7IC8vIG1hbmlwdWxhdGlvbiB1c2VzIHRoZSBsb2NhbGVzIGluIHRoZSBnbG9iYWxzCgogICAgICB0aGlzLmludGVyYWN0aW9uSGFuZGxlci5zZXRPcHRpb25zKG9wdGlvbnMuaW50ZXJhY3Rpb24pOwogICAgICB0aGlzLnJlbmRlcmVyLnNldE9wdGlvbnMob3B0aW9ucy5pbnRlcmFjdGlvbik7IC8vIG9wdGlvbnMgZm9yIHJlbmRlcmluZyBhcmUgaW4gaW50ZXJhY3Rpb24KICAgICAgdGhpcy5zZWxlY3Rpb25IYW5kbGVyLnNldE9wdGlvbnMob3B0aW9ucy5pbnRlcmFjdGlvbik7IC8vIG9wdGlvbnMgZm9yIHNlbGVjdGlvbiBhcmUgaW4gaW50ZXJhY3Rpb24KCiAgICAgIC8vIHJlbG9hZCB0aGUgc2V0dGluZ3Mgb2YgdGhlIG5vZGVzIHRvIGFwcGx5IGNoYW5nZXMgaW4gZ3JvdXBzIHRoYXQgYXJlIG5vdCByZWZlcmVuY2VkIGJ5IHBvaW50ZXIuCiAgICAgIGlmIChvcHRpb25zLmdyb3VwcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgncmVmcmVzaE5vZGVzJyk7CiAgICAgIH0KICAgICAgLy8gdGhlc2UgdHdvIGRvIG5vdCBoYXZlIG9wdGlvbnMgYXQgdGhlIG1vbWVudCwgaGVyZSBmb3IgY29tcGxldGVuZXNzCiAgICAgIC8vdGhpcy52aWV3LnNldE9wdGlvbnMob3B0aW9ucy52aWV3KTsKICAgICAgLy90aGlzLmNsdXN0ZXJpbmcuc2V0T3B0aW9ucyhvcHRpb25zLmNsdXN0ZXJpbmcpOwoKICAgICAgaWYgKCdjb25maWd1cmUnIGluIG9wdGlvbnMpIHsKICAgICAgICBpZiAoIXRoaXMuY29uZmlndXJhdG9yKSB7CiAgICAgICAgICB0aGlzLmNvbmZpZ3VyYXRvciA9IG5ldyBfc2hhcmVkQ29uZmlndXJhdG9yMlsnZGVmYXVsdCddKHRoaXMsIHRoaXMuYm9keS5jb250YWluZXIsIF9vcHRpb25zSnMuY29uZmlndXJlT3B0aW9ucywgdGhpcy5jYW52YXMucGl4ZWxSYXRpbyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNvbmZpZ3VyYXRvci5zZXRPcHRpb25zKG9wdGlvbnMuY29uZmlndXJlKTsKICAgICAgfQoKICAgICAgLy8gaWYgdGhlIGNvbmZpZ3VyYXRpb24gc3lzdGVtIGlzIGVuYWJsZWQsIGNvcHkgYWxsIG9wdGlvbnMgYW5kIHB1dCB0aGVtIGludG8gdGhlIGNvbmZpZyBzeXN0ZW0KICAgICAgaWYgKHRoaXMuY29uZmlndXJhdG9yICYmIHRoaXMuY29uZmlndXJhdG9yLm9wdGlvbnMuZW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgIHZhciBuZXR3b3JrT3B0aW9ucyA9IHsgbm9kZXM6IHt9LCBlZGdlczoge30sIGxheW91dDoge30sIGludGVyYWN0aW9uOiB7fSwgbWFuaXB1bGF0aW9uOiB7fSwgcGh5c2ljczoge30sIGdsb2JhbDoge30gfTsKICAgICAgICB1dGlsLmRlZXBFeHRlbmQobmV0d29ya09wdGlvbnMubm9kZXMsIHRoaXMubm9kZXNIYW5kbGVyLm9wdGlvbnMpOwogICAgICAgIHV0aWwuZGVlcEV4dGVuZChuZXR3b3JrT3B0aW9ucy5lZGdlcywgdGhpcy5lZGdlc0hhbmRsZXIub3B0aW9ucyk7CiAgICAgICAgdXRpbC5kZWVwRXh0ZW5kKG5ldHdvcmtPcHRpb25zLmxheW91dCwgdGhpcy5sYXlvdXRFbmdpbmUub3B0aW9ucyk7CiAgICAgICAgLy8gbG9hZCB0aGUgc2VsZWN0aW9uSGFuZGxlciBhbmQgcmVuZGVyIGRlZmF1bHQgb3B0aW9ucyBpbiB0byB0aGUgaW50ZXJhY3Rpb24gZ3JvdXAKICAgICAgICB1dGlsLmRlZXBFeHRlbmQobmV0d29ya09wdGlvbnMuaW50ZXJhY3Rpb24sIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5vcHRpb25zKTsKICAgICAgICB1dGlsLmRlZXBFeHRlbmQobmV0d29ya09wdGlvbnMuaW50ZXJhY3Rpb24sIHRoaXMucmVuZGVyZXIub3B0aW9ucyk7CgogICAgICAgIHV0aWwuZGVlcEV4dGVuZChuZXR3b3JrT3B0aW9ucy5pbnRlcmFjdGlvbiwgdGhpcy5pbnRlcmFjdGlvbkhhbmRsZXIub3B0aW9ucyk7CiAgICAgICAgdXRpbC5kZWVwRXh0ZW5kKG5ldHdvcmtPcHRpb25zLm1hbmlwdWxhdGlvbiwgdGhpcy5tYW5pcHVsYXRpb24ub3B0aW9ucyk7CiAgICAgICAgdXRpbC5kZWVwRXh0ZW5kKG5ldHdvcmtPcHRpb25zLnBoeXNpY3MsIHRoaXMucGh5c2ljcy5vcHRpb25zKTsKCiAgICAgICAgLy8gbG9hZCBnbG9iYWxzIGludG8gdGhlIGdsb2JhbCBvYmplY3QKICAgICAgICB1dGlsLmRlZXBFeHRlbmQobmV0d29ya09wdGlvbnMuZ2xvYmFsLCB0aGlzLmNhbnZhcy5vcHRpb25zKTsKICAgICAgICB1dGlsLmRlZXBFeHRlbmQobmV0d29ya09wdGlvbnMuZ2xvYmFsLCB0aGlzLm9wdGlvbnMpOwoKICAgICAgICB0aGlzLmNvbmZpZ3VyYXRvci5zZXRNb2R1bGVPcHRpb25zKG5ldHdvcmtPcHRpb25zKTsKICAgICAgfQoKICAgICAgLy8gaGFuZGxlIG5ldHdvcmsgZ2xvYmFsIG9wdGlvbnMKICAgICAgaWYgKG9wdGlvbnMuY2xpY2tUb1VzZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuY2xpY2tUb1VzZSA9PT0gdHJ1ZSkgewogICAgICAgICAgaWYgKHRoaXMuYWN0aXZhdG9yID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5hY3RpdmF0b3IgPSBuZXcgQWN0aXZhdG9yKHRoaXMuY2FudmFzLmZyYW1lKTsKICAgICAgICAgICAgdGhpcy5hY3RpdmF0b3Iub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpczIuYm9keS5lbWl0dGVyLmVtaXQoJ2FjdGl2YXRlJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5hY3RpdmF0b3IgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aGlzLmFjdGl2YXRvci5kZXN0cm95KCk7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmFjdGl2YXRvcjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ2FjdGl2YXRlJyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ2FjdGl2YXRlJyk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FudmFzLnNldFNpemUoKTsKICAgICAgLy8gc3RhcnQgdGhlIHBoeXNpY3Mgc2ltdWxhdGlvbi4gQ2FuIGJlIHNhZmVseSBjYWxsZWQgbXVsdGlwbGUgdGltZXMuCiAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ3N0YXJ0U2ltdWxhdGlvbicpOwogICAgfQogIH07CgogIC8qKgogICAqIFVwZGF0ZSB0aGUgdGhpcy5ib2R5Lm5vZGVJbmRpY2VzIHdpdGggdGhlIG1vc3QgcmVjZW50IG5vZGUgaW5kZXggbGlzdAogICAqIEBwcml2YXRlCiAgICovCiAgTmV0d29yay5wcm90b3R5cGUuX3VwZGF0ZVZpc2libGVJbmRpY2VzID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG5vZGVzID0gdGhpcy5ib2R5Lm5vZGVzOwogICAgdmFyIGVkZ2VzID0gdGhpcy5ib2R5LmVkZ2VzOwogICAgdGhpcy5ib2R5Lm5vZGVJbmRpY2VzID0gW107CiAgICB0aGlzLmJvZHkuZWRnZUluZGljZXMgPSBbXTsKCiAgICBmb3IgKHZhciBub2RlSWQgaW4gbm9kZXMpIHsKICAgICAgaWYgKG5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICBpZiAobm9kZXNbbm9kZUlkXS5vcHRpb25zLmhpZGRlbiA9PT0gZmFsc2UpIHsKICAgICAgICAgIHRoaXMuYm9keS5ub2RlSW5kaWNlcy5wdXNoKG5vZGVJZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZm9yICh2YXIgZWRnZUlkIGluIGVkZ2VzKSB7CiAgICAgIGlmIChlZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgaWYgKGVkZ2VzW2VkZ2VJZF0ub3B0aW9ucy5oaWRkZW4gPT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLmJvZHkuZWRnZUluZGljZXMucHVzaChlZGdlSWQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIEJpbmQgYWxsIGV2ZW50cwogICAqLwogIE5ldHdvcmsucHJvdG90eXBlLmJpbmRFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgIC8vIHRoaXMgZXZlbnQgd2lsbCB0cmlnZ2VyIGEgcmVidWlsZGluZyBvZiB0aGUgY2FjaGUgZXZlcnl0aGluZy4gVXNlZCB3aGVuIG5vZGVzIG9yIGVkZ2VzIGhhdmUgYmVlbiBhZGRlZCBvciByZW1vdmVkLgogICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ19kYXRhQ2hhbmdlZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgLy8gdXBkYXRlIHNob3J0Y3V0IGxpc3RzCiAgICAgIF90aGlzMy5fdXBkYXRlVmlzaWJsZUluZGljZXMoKTsKICAgICAgX3RoaXMzLnBoeXNpY3MudXBkYXRlUGh5c2ljc0RhdGEoKTsKICAgICAgX3RoaXMzLmJvZHkuZW1pdHRlci5lbWl0KCdfcmVxdWVzdFJlZHJhdycpOwogICAgICAvLyBjYWxsIHRoZSBkYXRhVXBkYXRlZCBldmVudCBiZWNhdXNlIHRoZSBvbmx5IGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUgdHdvIGlzIHRoZSB1cGRhdGluZyBvZiB0aGUgaW5kaWNlcwogICAgICBfdGhpczMuYm9keS5lbWl0dGVyLmVtaXQoJ19kYXRhVXBkYXRlZCcpOwogICAgfSk7CgogICAgLy8gdGhpcyBpcyBjYWxsZWQgd2hlbiBvcHRpb25zIG9mIEVYSVNUSU5HIG5vZGVzIG9yIGVkZ2VzIGhhdmUgY2hhbmdlZC4KICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdfZGF0YVVwZGF0ZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIHVwZGF0ZSB2YWx1ZXMKICAgICAgX3RoaXMzLl91cGRhdGVWYWx1ZVJhbmdlKF90aGlzMy5ib2R5Lm5vZGVzKTsKICAgICAgX3RoaXMzLl91cGRhdGVWYWx1ZVJhbmdlKF90aGlzMy5ib2R5LmVkZ2VzKTsKICAgICAgLy8gc3RhcnQgc2ltdWxhdGlvbiAoY2FuIGJlIGNhbGxlZCBzYWZlbHksIGV2ZW4gaWYgYWxyZWFkeSBydW5uaW5nKQogICAgICBfdGhpczMuYm9keS5lbWl0dGVyLmVtaXQoJ3N0YXJ0U2ltdWxhdGlvbicpOwogICAgICBfdGhpczMuYm9keS5lbWl0dGVyLmVtaXQoJ19yZXF1ZXN0UmVkcmF3Jyk7CiAgICB9KTsKICB9OwoKICAvKioKICAgKiBTZXQgbm9kZXMgYW5kIGVkZ2VzLCBhbmQgb3B0aW9uYWxseSBvcHRpb25zIGFzIHdlbGwuCiAgICoKICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSAgICAgICAgICAgICAgT2JqZWN0IGNvbnRhaW5pbmcgcGFyYW1ldGVyczoKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge0FycmF5IHwgRGF0YVNldCB8IERhdGFWaWV3fSBbbm9kZXNdIEFycmF5IHdpdGggbm9kZXMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge0FycmF5IHwgRGF0YVNldCB8IERhdGFWaWV3fSBbZWRnZXNdIEFycmF5IHdpdGggZWRnZXMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1N0cmluZ30gW2RvdF0gU3RyaW5nIGNvbnRhaW5pbmcgZGF0YSBpbiBET1QgZm9ybWF0CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtTdHJpbmd9IFtnZXBoaV0gU3RyaW5nIGNvbnRhaW5pbmcgZGF0YSBpbiBnZXBoaSBKU09OIGZvcm1hdAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7T3B0aW9uc30gW29wdGlvbnNdIE9iamVjdCB3aXRoIG9wdGlvbnMKICAgKi8KICBOZXR3b3JrLnByb3RvdHlwZS5zZXREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIC8vIHJlc2V0IHRoZSBwaHlzaWNzIGVuZ2luZS4KICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ3Jlc2V0UGh5c2ljcycpOwogICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3Jlc2V0RGF0YScpOwoKICAgIC8vIHVuc2VsZWN0IGFsbCB0byBlbnN1cmUgbm8gc2VsZWN0aW9ucyBmcm9tIG9sZCBkYXRhIGFyZSBjYXJyaWVkIG92ZXIuCiAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIudW5zZWxlY3RBbGwoKTsKCiAgICBpZiAoZGF0YSAmJiBkYXRhLmRvdCAmJiAoZGF0YS5ub2RlcyB8fCBkYXRhLmVkZ2VzKSkgewogICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoJ0RhdGEgbXVzdCBjb250YWluIGVpdGhlciBwYXJhbWV0ZXIgImRvdCIgb3IgJyArICcgcGFyYW1ldGVyIHBhaXIgIm5vZGVzIiBhbmQgImVkZ2VzIiwgYnV0IG5vdCBib3RoLicpOwogICAgfQoKICAgIC8vIHNldCBvcHRpb25zCiAgICB0aGlzLnNldE9wdGlvbnMoZGF0YSAmJiBkYXRhLm9wdGlvbnMpOwogICAgLy8gc2V0IGFsbCBkYXRhCiAgICBpZiAoZGF0YSAmJiBkYXRhLmRvdCkgewogICAgICBjb25zb2xlLmxvZygnVGhlIGRvdCBwcm9wZXJ0eSBoYXMgYmVlbiBkZXByaWNhdGVkLiBQbGVhc2UgdXNlIHRoZSBzdGF0aWMgY29udmVydERvdCBtZXRob2QgdG8gY29udmVydCBET1QgaW50byB2aXMubmV0d29yayBmb3JtYXQgYW5kIHVzZSB0aGUgbm9ybWFsIGRhdGEgZm9ybWF0IHdpdGggbm9kZXMgYW5kIGVkZ2VzLiBUaGlzIGNvbnZlcnRlciBpcyB1c2VkIGxpa2UgdGhpczogdmFyIGRhdGEgPSB2aXMubmV0d29yay5jb252ZXJ0RG90KGRvdFN0cmluZyk7Jyk7CiAgICAgIC8vIHBhcnNlIERPVCBmaWxlCiAgICAgIHZhciBkb3REYXRhID0gZG90cGFyc2VyLkRPVFRvR3JhcGgoZGF0YS5kb3QpOwogICAgICB0aGlzLnNldERhdGEoZG90RGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0gZWxzZSBpZiAoZGF0YSAmJiBkYXRhLmdlcGhpKSB7CiAgICAgIC8vIHBhcnNlIERPVCBmaWxlCiAgICAgIGNvbnNvbGUubG9nKCdUaGUgZ2VwaGkgcHJvcGVydHkgaGFzIGJlZW4gZGVwcmljYXRlZC4gUGxlYXNlIHVzZSB0aGUgc3RhdGljIGNvbnZlcnRHZXBoaSBtZXRob2QgdG8gY29udmVydCBnZXBoaSBpbnRvIHZpcy5uZXR3b3JrIGZvcm1hdCBhbmQgdXNlIHRoZSBub3JtYWwgZGF0YSBmb3JtYXQgd2l0aCBub2RlcyBhbmQgZWRnZXMuIFRoaXMgY29udmVydGVyIGlzIHVzZWQgbGlrZSB0aGlzOiB2YXIgZGF0YSA9IHZpcy5uZXR3b3JrLmNvbnZlcnRHZXBoaShnZXBoaUpzb24pOycpOwogICAgICB2YXIgZ2VwaGlEYXRhID0gZ2VwaGlQYXJzZXIucGFyc2VHZXBoaShkYXRhLmdlcGhpKTsKICAgICAgdGhpcy5zZXREYXRhKGdlcGhpRGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubm9kZXNIYW5kbGVyLnNldERhdGEoZGF0YSAmJiBkYXRhLm5vZGVzLCB0cnVlKTsKICAgICAgdGhpcy5lZGdlc0hhbmRsZXIuc2V0RGF0YShkYXRhICYmIGRhdGEuZWRnZXMsIHRydWUpOwogICAgfQoKICAgIC8vIGVtaXQgY2hhbmdlIGluIGRhdGEKICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19kYXRhQ2hhbmdlZCcpOwoKICAgIC8vIGZpbmQgYSBzdGFibGUgcG9zaXRpb24gb3Igc3RhcnQgYW5pbWF0aW5nIHRvIGEgc3RhYmxlIHBvc2l0aW9uCiAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdpbml0UGh5c2ljcycpOwogIH07CgogIC8qKgogICAqIENsZWFucyB1cCBhbGwgYmluZGluZ3Mgb2YgdGhlIG5ldHdvcmssIHJlbW92aW5nIGl0IGZ1bGx5IGZyb20gdGhlIG1lbW9yeSBJRiB0aGUgdmFyaWFibGUgaXMgc2V0IHRvIG51bGwgYWZ0ZXIgY2FsbGluZyB0aGlzIGZ1bmN0aW9uLgogICAqIHZhciBuZXR3b3JrID0gbmV3IHZpcy5OZXR3b3JrKC4uKTsKICAgKiBuZXR3b3JrLmRlc3Ryb3koKTsKICAgKiBuZXR3b3JrID0gbnVsbDsKICAgKi8KICBOZXR3b3JrLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnZGVzdHJveScpOwogICAgLy8gY2xlYXIgZXZlbnRzCiAgICB0aGlzLmJvZHkuZW1pdHRlci5vZmYoKTsKICAgIHRoaXMub2ZmKCk7CgogICAgLy8gZGVsZXRlIG1vZHVsZXMKICAgIGRlbGV0ZSB0aGlzLmdyb3VwczsKICAgIGRlbGV0ZSB0aGlzLmNhbnZhczsKICAgIGRlbGV0ZSB0aGlzLnNlbGVjdGlvbkhhbmRsZXI7CiAgICBkZWxldGUgdGhpcy5pbnRlcmFjdGlvbkhhbmRsZXI7CiAgICBkZWxldGUgdGhpcy52aWV3OwogICAgZGVsZXRlIHRoaXMucmVuZGVyZXI7CiAgICBkZWxldGUgdGhpcy5waHlzaWNzOwogICAgZGVsZXRlIHRoaXMubGF5b3V0RW5naW5lOwogICAgZGVsZXRlIHRoaXMuY2x1c3RlcmluZzsKICAgIGRlbGV0ZSB0aGlzLm1hbmlwdWxhdGlvbjsKICAgIGRlbGV0ZSB0aGlzLm5vZGVzSGFuZGxlcjsKICAgIGRlbGV0ZSB0aGlzLmVkZ2VzSGFuZGxlcjsKICAgIGRlbGV0ZSB0aGlzLmNvbmZpZ3VyYXRvcjsKICAgIGRlbGV0ZSB0aGlzLmltYWdlczsKCiAgICBmb3IgKHZhciBub2RlSWQgaW4gdGhpcy5ib2R5Lm5vZGVzKSB7CiAgICAgIGRlbGV0ZSB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXTsKICAgIH0KICAgIGZvciAodmFyIGVkZ2VJZCBpbiB0aGlzLmJvZHkuZWRnZXMpIHsKICAgICAgZGVsZXRlIHRoaXMuYm9keS5lZGdlc1tlZGdlSWRdOwogICAgfQoKICAgIC8vIHJlbW92ZSB0aGUgY29udGFpbmVyIGFuZCBldmVyeXRoaW5nIGluc2lkZSBpdCByZWN1cnNpdmVseQogICAgdXRpbC5yZWN1cnNpdmVET01EZWxldGUodGhpcy5ib2R5LmNvbnRhaW5lcik7CiAgfTsKCiAgLyoqCiAgICogVXBkYXRlIHRoZSB2YWx1ZXMgb2YgYWxsIG9iamVjdCBpbiB0aGUgZ2l2ZW4gYXJyYXkgYWNjb3JkaW5nIHRvIHRoZSBjdXJyZW50CiAgICogdmFsdWUgcmFuZ2Ugb2YgdGhlIG9iamVjdHMgaW4gdGhlIGFycmF5LgogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmogICAgQW4gb2JqZWN0IGNvbnRhaW5pbmcgYSBzZXQgb2YgRWRnZXMgb3IgTm9kZXMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBvYmplY3RzIG11c3QgaGF2ZSBhIG1ldGhvZCBnZXRWYWx1ZSgpIGFuZAogICAqICAgICAgICAgICAgICAgICAgICAgICAgc2V0VmFsdWVSYW5nZShtaW4sIG1heCkuCiAgICogQHByaXZhdGUKICAgKi8KICBOZXR3b3JrLnByb3RvdHlwZS5fdXBkYXRlVmFsdWVSYW5nZSA9IGZ1bmN0aW9uIChvYmopIHsKICAgIHZhciBpZDsKCiAgICAvLyBkZXRlcm1pbmUgdGhlIHJhbmdlIG9mIHRoZSBvYmplY3RzCiAgICB2YXIgdmFsdWVNaW4gPSB1bmRlZmluZWQ7CiAgICB2YXIgdmFsdWVNYXggPSB1bmRlZmluZWQ7CiAgICB2YXIgdmFsdWVUb3RhbCA9IDA7CiAgICBmb3IgKGlkIGluIG9iaikgewogICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgIHZhciB2YWx1ZSA9IG9ialtpZF0uZ2V0VmFsdWUoKTsKICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdmFsdWVNaW4gPSB2YWx1ZU1pbiA9PT0gdW5kZWZpbmVkID8gdmFsdWUgOiBNYXRoLm1pbih2YWx1ZSwgdmFsdWVNaW4pOwogICAgICAgICAgdmFsdWVNYXggPSB2YWx1ZU1heCA9PT0gdW5kZWZpbmVkID8gdmFsdWUgOiBNYXRoLm1heCh2YWx1ZSwgdmFsdWVNYXgpOwogICAgICAgICAgdmFsdWVUb3RhbCArPSB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBhZGp1c3QgdGhlIHJhbmdlIG9mIGFsbCBvYmplY3RzCiAgICBpZiAodmFsdWVNaW4gIT09IHVuZGVmaW5lZCAmJiB2YWx1ZU1heCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGZvciAoaWQgaW4gb2JqKSB7CiAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgIG9ialtpZF0uc2V0VmFsdWVSYW5nZSh2YWx1ZU1pbiwgdmFsdWVNYXgsIHZhbHVlVG90YWwpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8qKgogICAqIFJldHVybnMgdHJ1ZSB3aGVuIHRoZSBOZXR3b3JrIGlzIGFjdGl2ZS4KICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgKi8KICBOZXR3b3JrLnByb3RvdHlwZS5pc0FjdGl2ZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAhdGhpcy5hY3RpdmF0b3IgfHwgdGhpcy5hY3RpdmF0b3IuYWN0aXZlOwogIH07CgogIE5ldHdvcmsucHJvdG90eXBlLnNldFNpemUgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5jYW52YXMuc2V0U2l6ZS5hcHBseSh0aGlzLmNhbnZhcywgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLmNhbnZhc1RvRE9NID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuY2FudmFzLmNhbnZhc1RvRE9NLmFwcGx5KHRoaXMuY2FudmFzLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuRE9NdG9DYW52YXMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5jYW52YXMuRE9NdG9DYW52YXModGhpcy5jYW52YXMsIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS5maW5kTm9kZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmNsdXN0ZXJpbmcuZmluZE5vZGUuYXBwbHkodGhpcy5jbHVzdGVyaW5nLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuaXNDbHVzdGVyID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuY2x1c3RlcmluZy5pc0NsdXN0ZXIuYXBwbHkodGhpcy5jbHVzdGVyaW5nLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUub3BlbkNsdXN0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5jbHVzdGVyaW5nLm9wZW5DbHVzdGVyLmFwcGx5KHRoaXMuY2x1c3RlcmluZywgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLmNsdXN0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5jbHVzdGVyaW5nLmNsdXN0ZXIuYXBwbHkodGhpcy5jbHVzdGVyaW5nLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuZ2V0Tm9kZXNJbkNsdXN0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5jbHVzdGVyaW5nLmdldE5vZGVzSW5DbHVzdGVyLmFwcGx5KHRoaXMuY2x1c3RlcmluZywgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLmNsdXN0ZXJCeUNvbm5lY3Rpb24gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5jbHVzdGVyaW5nLmNsdXN0ZXJCeUNvbm5lY3Rpb24uYXBwbHkodGhpcy5jbHVzdGVyaW5nLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuY2x1c3RlckJ5SHVic2l6ZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmNsdXN0ZXJpbmcuY2x1c3RlckJ5SHVic2l6ZS5hcHBseSh0aGlzLmNsdXN0ZXJpbmcsIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS5jbHVzdGVyT3V0bGllcnMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5jbHVzdGVyaW5nLmNsdXN0ZXJPdXRsaWVycy5hcHBseSh0aGlzLmNsdXN0ZXJpbmcsIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS5nZXRTZWVkID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMubGF5b3V0RW5naW5lLmdldFNlZWQuYXBwbHkodGhpcy5sYXlvdXRFbmdpbmUsIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS5lbmFibGVFZGl0TW9kZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLm1hbmlwdWxhdGlvbi5lbmFibGVFZGl0TW9kZS5hcHBseSh0aGlzLm1hbmlwdWxhdGlvbiwgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLmRpc2FibGVFZGl0TW9kZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLm1hbmlwdWxhdGlvbi5kaXNhYmxlRWRpdE1vZGUuYXBwbHkodGhpcy5tYW5pcHVsYXRpb24sIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS5hZGROb2RlTW9kZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLm1hbmlwdWxhdGlvbi5hZGROb2RlTW9kZS5hcHBseSh0aGlzLm1hbmlwdWxhdGlvbiwgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLmVkaXROb2RlID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMubWFuaXB1bGF0aW9uLmVkaXROb2RlLmFwcGx5KHRoaXMubWFuaXB1bGF0aW9uLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuZWRpdE5vZGVNb2RlID0gZnVuY3Rpb24gKCkgewogICAgY29uc29sZS5sb2coJ0RlcHJpY2F0ZWQ6IFBsZWFzZSB1c2UgZWRpdE5vZGUgaW5zdGVhZCBvZiBlZGl0Tm9kZU1vZGUuJyk7cmV0dXJuIHRoaXMubWFuaXB1bGF0aW9uLmVkaXROb2RlLmFwcGx5KHRoaXMubWFuaXB1bGF0aW9uLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuYWRkRWRnZU1vZGUgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5tYW5pcHVsYXRpb24uYWRkRWRnZU1vZGUuYXBwbHkodGhpcy5tYW5pcHVsYXRpb24sIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS5lZGl0RWRnZU1vZGUgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5tYW5pcHVsYXRpb24uZWRpdEVkZ2VNb2RlLmFwcGx5KHRoaXMubWFuaXB1bGF0aW9uLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuZGVsZXRlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5tYW5pcHVsYXRpb24uZGVsZXRlU2VsZWN0ZWQuYXBwbHkodGhpcy5tYW5pcHVsYXRpb24sIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS5nZXRQb3NpdGlvbnMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5ub2Rlc0hhbmRsZXIuZ2V0UG9zaXRpb25zLmFwcGx5KHRoaXMubm9kZXNIYW5kbGVyLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuc3RvcmVQb3NpdGlvbnMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5ub2Rlc0hhbmRsZXIuc3RvcmVQb3NpdGlvbnMuYXBwbHkodGhpcy5ub2Rlc0hhbmRsZXIsIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS5nZXRCb3VuZGluZ0JveCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLm5vZGVzSGFuZGxlci5nZXRCb3VuZGluZ0JveC5hcHBseSh0aGlzLm5vZGVzSGFuZGxlciwgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLmdldENvbm5lY3RlZE5vZGVzID0gZnVuY3Rpb24gKG9iamVjdElkKSB7CiAgICBpZiAodGhpcy5ib2R5Lm5vZGVzW29iamVjdElkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiB0aGlzLm5vZGVzSGFuZGxlci5nZXRDb25uZWN0ZWROb2Rlcy5hcHBseSh0aGlzLm5vZGVzSGFuZGxlciwgYXJndW1lbnRzKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB0aGlzLmVkZ2VzSGFuZGxlci5nZXRDb25uZWN0ZWROb2Rlcy5hcHBseSh0aGlzLmVkZ2VzSGFuZGxlciwgYXJndW1lbnRzKTsKICAgIH0KICB9OwogIE5ldHdvcmsucHJvdG90eXBlLmdldENvbm5lY3RlZEVkZ2VzID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMubm9kZXNIYW5kbGVyLmdldENvbm5lY3RlZEVkZ2VzLmFwcGx5KHRoaXMubm9kZXNIYW5kbGVyLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuc3RhcnRTaW11bGF0aW9uID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMucGh5c2ljcy5zdGFydFNpbXVsYXRpb24uYXBwbHkodGhpcy5waHlzaWNzLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuc3RvcFNpbXVsYXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5waHlzaWNzLnN0b3BTaW11bGF0aW9uLmFwcGx5KHRoaXMucGh5c2ljcywgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLnN0YWJpbGl6ZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLnBoeXNpY3Muc3RhYmlsaXplLmFwcGx5KHRoaXMucGh5c2ljcywgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLmdldFNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuZ2V0U2VsZWN0aW9uLmFwcGx5KHRoaXMuc2VsZWN0aW9uSGFuZGxlciwgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLmdldFNlbGVjdGVkTm9kZXMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLmdldFNlbGVjdGVkTm9kZXMuYXBwbHkodGhpcy5zZWxlY3Rpb25IYW5kbGVyLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuZ2V0U2VsZWN0ZWRFZGdlcyA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuZ2V0U2VsZWN0ZWRFZGdlcy5hcHBseSh0aGlzLnNlbGVjdGlvbkhhbmRsZXIsIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS5nZXROb2RlQXQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgbm9kZSA9IHRoaXMuc2VsZWN0aW9uSGFuZGxlci5nZXROb2RlQXQuYXBwbHkodGhpcy5zZWxlY3Rpb25IYW5kbGVyLCBhcmd1bWVudHMpOwogICAgaWYgKG5vZGUgIT09IHVuZGVmaW5lZCAmJiBub2RlLmlkICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIG5vZGUuaWQ7CiAgICB9CiAgICByZXR1cm4gbm9kZTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLmdldEVkZ2VBdCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBlZGdlID0gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLmdldEVkZ2VBdC5hcHBseSh0aGlzLnNlbGVjdGlvbkhhbmRsZXIsIGFyZ3VtZW50cyk7CiAgICBpZiAoZWRnZSAhPT0gdW5kZWZpbmVkICYmIGVkZ2UuaWQgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gZWRnZS5pZDsKICAgIH0KICAgIHJldHVybiBlZGdlOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuc2VsZWN0Tm9kZXMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLnNlbGVjdE5vZGVzLmFwcGx5KHRoaXMuc2VsZWN0aW9uSGFuZGxlciwgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLnNlbGVjdEVkZ2VzID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5zZWxlY3RFZGdlcy5hcHBseSh0aGlzLnNlbGVjdGlvbkhhbmRsZXIsIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS51bnNlbGVjdEFsbCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbkhhbmRsZXIudW5zZWxlY3RBbGwuYXBwbHkodGhpcy5zZWxlY3Rpb25IYW5kbGVyLCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUucmVkcmF3ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMucmVuZGVyZXIucmVkcmF3LmFwcGx5KHRoaXMucmVuZGVyZXIsIGFyZ3VtZW50cyk7CiAgfTsKICBOZXR3b3JrLnByb3RvdHlwZS5nZXRTY2FsZSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLnZpZXcuZ2V0U2NhbGUuYXBwbHkodGhpcy52aWV3LCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuZ2V0Vmlld1Bvc2l0aW9uID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMudmlldy5nZXRWaWV3UG9zaXRpb24uYXBwbHkodGhpcy52aWV3LCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuZml0ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMudmlldy5maXQuYXBwbHkodGhpcy52aWV3LCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUubW92ZVRvID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMudmlldy5tb3ZlVG8uYXBwbHkodGhpcy52aWV3LCBhcmd1bWVudHMpOwogIH07CiAgTmV0d29yay5wcm90b3R5cGUuZm9jdXMgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gdGhpcy52aWV3LmZvY3VzLmFwcGx5KHRoaXMudmlldywgYXJndW1lbnRzKTsKICB9OwogIE5ldHdvcmsucHJvdG90eXBlLnJlbGVhc2VOb2RlID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMudmlldy5yZWxlYXNlTm9kZS5hcHBseSh0aGlzLnZpZXcsIGFyZ3VtZW50cyk7CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBOZXR3b3JrOwoKLyoqKi8gfSwKLyogNjAgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICJ1c2Ugc3RyaWN0IjsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgLyoqCiAgICogQGNsYXNzIEdyb3VwcwogICAqIFRoaXMgY2xhc3MgY2FuIHN0b3JlIGdyb3VwcyBhbmQgb3B0aW9ucyBzcGVjaWZpYyBmb3IgZ3JvdXBzLgogICAqLwoKICB2YXIgR3JvdXBzID0gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEdyb3VwcygpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEdyb3Vwcyk7CgogICAgICB0aGlzLmNsZWFyKCk7CiAgICAgIHRoaXMuZGVmYXVsdEluZGV4ID0gMDsKICAgICAgdGhpcy5ncm91cHNBcnJheSA9IFtdOwogICAgICB0aGlzLmdyb3VwSW5kZXggPSAwOwoKICAgICAgdGhpcy5kZWZhdWx0R3JvdXBzID0gW3sgYm9yZGVyOiAiIzJCN0NFOSIsIGJhY2tncm91bmQ6ICIjOTdDMkZDIiwgaGlnaGxpZ2h0OiB7IGJvcmRlcjogIiMyQjdDRTkiLCBiYWNrZ3JvdW5kOiAiI0QyRTVGRiIgfSwgaG92ZXI6IHsgYm9yZGVyOiAiIzJCN0NFOSIsIGJhY2tncm91bmQ6ICIjRDJFNUZGIiB9IH0sIC8vIDA6IGJsdWUKICAgICAgeyBib3JkZXI6ICIjRkZBNTAwIiwgYmFja2dyb3VuZDogIiNGRkZGMDAiLCBoaWdobGlnaHQ6IHsgYm9yZGVyOiAiI0ZGQTUwMCIsIGJhY2tncm91bmQ6ICIjRkZGRkEzIiB9LCBob3ZlcjogeyBib3JkZXI6ICIjRkZBNTAwIiwgYmFja2dyb3VuZDogIiNGRkZGQTMiIH0gfSwgLy8gMTogeWVsbG93CiAgICAgIHsgYm9yZGVyOiAiI0ZBMEExMCIsIGJhY2tncm91bmQ6ICIjRkI3RTgxIiwgaGlnaGxpZ2h0OiB7IGJvcmRlcjogIiNGQTBBMTAiLCBiYWNrZ3JvdW5kOiAiI0ZGQUZCMSIgfSwgaG92ZXI6IHsgYm9yZGVyOiAiI0ZBMEExMCIsIGJhY2tncm91bmQ6ICIjRkZBRkIxIiB9IH0sIC8vIDI6IHJlZAogICAgICB7IGJvcmRlcjogIiM0MUE5MDYiLCBiYWNrZ3JvdW5kOiAiIzdCRTE0MSIsIGhpZ2hsaWdodDogeyBib3JkZXI6ICIjNDFBOTA2IiwgYmFja2dyb3VuZDogIiNBMUVDNzYiIH0sIGhvdmVyOiB7IGJvcmRlcjogIiM0MUE5MDYiLCBiYWNrZ3JvdW5kOiAiI0ExRUM3NiIgfSB9LCAvLyAzOiBncmVlbgogICAgICB7IGJvcmRlcjogIiNFMTI5RjAiLCBiYWNrZ3JvdW5kOiAiI0VCN0RGNCIsIGhpZ2hsaWdodDogeyBib3JkZXI6ICIjRTEyOUYwIiwgYmFja2dyb3VuZDogIiNGMEIzRjUiIH0sIGhvdmVyOiB7IGJvcmRlcjogIiNFMTI5RjAiLCBiYWNrZ3JvdW5kOiAiI0YwQjNGNSIgfSB9LCAvLyA0OiBtYWdlbnRhCiAgICAgIHsgYm9yZGVyOiAiIzdDMjlGMCIsIGJhY2tncm91bmQ6ICIjQUQ4NUU0IiwgaGlnaGxpZ2h0OiB7IGJvcmRlcjogIiM3QzI5RjAiLCBiYWNrZ3JvdW5kOiAiI0QzQkRGMCIgfSwgaG92ZXI6IHsgYm9yZGVyOiAiIzdDMjlGMCIsIGJhY2tncm91bmQ6ICIjRDNCREYwIiB9IH0sIC8vIDU6IHB1cnBsZQogICAgICB7IGJvcmRlcjogIiNDMzdGMDAiLCBiYWNrZ3JvdW5kOiAiI0ZGQTgwNyIsIGhpZ2hsaWdodDogeyBib3JkZXI6ICIjQzM3RjAwIiwgYmFja2dyb3VuZDogIiNGRkNBNjYiIH0sIGhvdmVyOiB7IGJvcmRlcjogIiNDMzdGMDAiLCBiYWNrZ3JvdW5kOiAiI0ZGQ0E2NiIgfSB9LCAvLyA2OiBvcmFuZ2UKICAgICAgeyBib3JkZXI6ICIjNDIyMEZCIiwgYmFja2dyb3VuZDogIiM2RTZFRkQiLCBoaWdobGlnaHQ6IHsgYm9yZGVyOiAiIzQyMjBGQiIsIGJhY2tncm91bmQ6ICIjOUI5QkZEIiB9LCBob3ZlcjogeyBib3JkZXI6ICIjNDIyMEZCIiwgYmFja2dyb3VuZDogIiM5QjlCRkQiIH0gfSwgLy8gNzogZGFya2JsdWUKICAgICAgeyBib3JkZXI6ICIjRkQ1QTc3IiwgYmFja2dyb3VuZDogIiNGRkMwQ0IiLCBoaWdobGlnaHQ6IHsgYm9yZGVyOiAiI0ZENUE3NyIsIGJhY2tncm91bmQ6ICIjRkZEMUQ5IiB9LCBob3ZlcjogeyBib3JkZXI6ICIjRkQ1QTc3IiwgYmFja2dyb3VuZDogIiNGRkQxRDkiIH0gfSwgLy8gODogcGluawogICAgICB7IGJvcmRlcjogIiM0QUQ2M0EiLCBiYWNrZ3JvdW5kOiAiI0MyRkFCQyIsIGhpZ2hsaWdodDogeyBib3JkZXI6ICIjNEFENjNBIiwgYmFja2dyb3VuZDogIiNFNkZGRTMiIH0sIGhvdmVyOiB7IGJvcmRlcjogIiM0QUQ2M0EiLCBiYWNrZ3JvdW5kOiAiI0U2RkZFMyIgfSB9LCAvLyA5OiBtaW50CgogICAgICB7IGJvcmRlcjogIiM5OTAwMDAiLCBiYWNrZ3JvdW5kOiAiI0VFMDAwMCIsIGhpZ2hsaWdodDogeyBib3JkZXI6ICIjQkIwMDAwIiwgYmFja2dyb3VuZDogIiNGRjMzMzMiIH0sIGhvdmVyOiB7IGJvcmRlcjogIiNCQjAwMDAiLCBiYWNrZ3JvdW5kOiAiI0ZGMzMzMyIgfSB9LCAvLyAxMDpicmlnaHQgcmVkCgogICAgICB7IGJvcmRlcjogIiNGRjYwMDAiLCBiYWNrZ3JvdW5kOiAiI0ZGNjAwMCIsIGhpZ2hsaWdodDogeyBib3JkZXI6ICIjRkY2MDAwIiwgYmFja2dyb3VuZDogIiNGRjYwMDAiIH0sIGhvdmVyOiB7IGJvcmRlcjogIiNGRjYwMDAiLCBiYWNrZ3JvdW5kOiAiI0ZGNjAwMCIgfSB9LCAvLyAxMjogcmVhbCBvcmFuZ2UKICAgICAgeyBib3JkZXI6ICIjOTdDMkZDIiwgYmFja2dyb3VuZDogIiMyQjdDRTkiLCBoaWdobGlnaHQ6IHsgYm9yZGVyOiAiI0QyRTVGRiIsIGJhY2tncm91bmQ6ICIjMkI3Q0U5IiB9LCBob3ZlcjogeyBib3JkZXI6ICIjRDJFNUZGIiwgYmFja2dyb3VuZDogIiMyQjdDRTkiIH0gfSwgLy8gMTM6IGJsdWUKICAgICAgeyBib3JkZXI6ICIjMzk5NjA1IiwgYmFja2dyb3VuZDogIiMyNTVDMDMiLCBoaWdobGlnaHQ6IHsgYm9yZGVyOiAiIzM5OTYwNSIsIGJhY2tncm91bmQ6ICIjMjU1QzAzIiB9LCBob3ZlcjogeyBib3JkZXI6ICIjMzk5NjA1IiwgYmFja2dyb3VuZDogIiMyNTVDMDMiIH0gfSwgLy8gMTQ6IGdyZWVuCiAgICAgIHsgYm9yZGVyOiAiI0I3MDA1NCIsIGJhY2tncm91bmQ6ICIjRkYwMDdFIiwgaGlnaGxpZ2h0OiB7IGJvcmRlcjogIiNCNzAwNTQiLCBiYWNrZ3JvdW5kOiAiI0ZGMDA3RSIgfSwgaG92ZXI6IHsgYm9yZGVyOiAiI0I3MDA1NCIsIGJhY2tncm91bmQ6ICIjRkYwMDdFIiB9IH0sIC8vIDE1OiBtYWdlbnRhCiAgICAgIHsgYm9yZGVyOiAiI0FEODVFNCIsIGJhY2tncm91bmQ6ICIjN0MyOUYwIiwgaGlnaGxpZ2h0OiB7IGJvcmRlcjogIiNEM0JERjAiLCBiYWNrZ3JvdW5kOiAiIzdDMjlGMCIgfSwgaG92ZXI6IHsgYm9yZGVyOiAiI0QzQkRGMCIsIGJhY2tncm91bmQ6ICIjN0MyOUYwIiB9IH0sIC8vIDE2OiBwdXJwbGUKICAgICAgeyBib3JkZXI6ICIjNDU1N0ZBIiwgYmFja2dyb3VuZDogIiMwMDBFQTEiLCBoaWdobGlnaHQ6IHsgYm9yZGVyOiAiIzZFNkVGRCIsIGJhY2tncm91bmQ6ICIjMDAwRUExIiB9LCBob3ZlcjogeyBib3JkZXI6ICIjNkU2RUZEIiwgYmFja2dyb3VuZDogIiMwMDBFQTEiIH0gfSwgLy8gMTc6IGRhcmtibHVlCiAgICAgIHsgYm9yZGVyOiAiI0ZGQzBDQiIsIGJhY2tncm91bmQ6ICIjRkQ1QTc3IiwgaGlnaGxpZ2h0OiB7IGJvcmRlcjogIiNGRkQxRDkiLCBiYWNrZ3JvdW5kOiAiI0ZENUE3NyIgfSwgaG92ZXI6IHsgYm9yZGVyOiAiI0ZGRDFEOSIsIGJhY2tncm91bmQ6ICIjRkQ1QTc3IiB9IH0sIC8vIDE4OiBwaW5rCiAgICAgIHsgYm9yZGVyOiAiI0MyRkFCQyIsIGJhY2tncm91bmQ6ICIjNzRENjZBIiwgaGlnaGxpZ2h0OiB7IGJvcmRlcjogIiNFNkZGRTMiLCBiYWNrZ3JvdW5kOiAiIzc0RDY2QSIgfSwgaG92ZXI6IHsgYm9yZGVyOiAiI0U2RkZFMyIsIGJhY2tncm91bmQ6ICIjNzRENjZBIiB9IH0sIC8vIDE5OiBtaW50CgogICAgICB7IGJvcmRlcjogIiNFRTAwMDAiLCBiYWNrZ3JvdW5kOiAiIzk5MDAwMCIsIGhpZ2hsaWdodDogeyBib3JkZXI6ICIjRkYzMzMzIiwgYmFja2dyb3VuZDogIiNCQjAwMDAiIH0sIGhvdmVyOiB7IGJvcmRlcjogIiNGRjMzMzMiLCBiYWNrZ3JvdW5kOiAiI0JCMDAwMCIgfSB9IC8vIDIwOmJyaWdodCByZWQKICAgICAgXTsKCiAgICAgIHRoaXMub3B0aW9ucyA9IHt9OwogICAgICB0aGlzLmRlZmF1bHRPcHRpb25zID0gewogICAgICAgIHVzZURlZmF1bHRHcm91cHM6IHRydWUKICAgICAgfTsKICAgICAgdXRpbC5leHRlbmQodGhpcy5vcHRpb25zLCB0aGlzLmRlZmF1bHRPcHRpb25zKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoR3JvdXBzLCBbewogICAgICBrZXk6ICJzZXRPcHRpb25zIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykgewogICAgICAgIHZhciBvcHRpb25GaWVsZHMgPSBbInVzZURlZmF1bHRHcm91cHMiXTsKCiAgICAgICAgaWYgKG9wdGlvbnMgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZm9yICh2YXIgZ3JvdXBOYW1lIGluIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuaGFzT3duUHJvcGVydHkoZ3JvdXBOYW1lKSkgewogICAgICAgICAgICAgIGlmIChvcHRpb25GaWVsZHMuaW5kZXhPZihncm91cE5hbWUpID09PSAtMSkgewogICAgICAgICAgICAgICAgdmFyIGdyb3VwID0gb3B0aW9uc1tncm91cE5hbWVdOwogICAgICAgICAgICAgICAgdGhpcy5hZGQoZ3JvdXBOYW1lLCBncm91cCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImNsZWFyIiwKCiAgICAgIC8qKgogICAgICAgKiBDbGVhciBhbGwgZ3JvdXBzCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYXIoKSB7CiAgICAgICAgdGhpcy5ncm91cHMgPSB7fTsKICAgICAgICB0aGlzLmdyb3Vwc0FycmF5ID0gW107CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0IiwKCiAgICAgIC8qKgogICAgICAgKiBnZXQgZ3JvdXAgb3B0aW9ucyBvZiBhIGdyb3VwbmFtZS4gSWYgZ3JvdXBuYW1lIGlzIG5vdCBmb3VuZCwgYSBuZXcgZ3JvdXAKICAgICAgICogaXMgYWRkZWQuCiAgICAgICAqIEBwYXJhbSB7Kn0gZ3JvdXBuYW1lICAgICAgICBDYW4gYmUgYSBudW1iZXIsIHN0cmluZywgRGF0ZSwgZXRjLgogICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IGdyb3VwICAgICAgVGhlIGNyZWF0ZWQgZ3JvdXAsIGNvbnRhaW5pbmcgYWxsIGdyb3VwIG9wdGlvbnMKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXQoZ3JvdXBuYW1lKSB7CiAgICAgICAgdmFyIGdyb3VwID0gdGhpcy5ncm91cHNbZ3JvdXBuYW1lXTsKICAgICAgICBpZiAoZ3JvdXAgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy51c2VEZWZhdWx0R3JvdXBzID09PSBmYWxzZSAmJiB0aGlzLmdyb3Vwc0FycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8gY3JlYXRlIG5ldyBncm91cAogICAgICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmdyb3VwSW5kZXggJSB0aGlzLmdyb3Vwc0FycmF5Lmxlbmd0aDsKICAgICAgICAgICAgdGhpcy5ncm91cEluZGV4Kys7CiAgICAgICAgICAgIGdyb3VwID0ge307CiAgICAgICAgICAgIGdyb3VwLmNvbG9yID0gdGhpcy5ncm91cHNbdGhpcy5ncm91cHNBcnJheVtpbmRleF1dOwogICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cG5hbWVdID0gZ3JvdXA7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBjcmVhdGUgbmV3IGdyb3VwCiAgICAgICAgICAgIHZhciBpbmRleCA9IHRoaXMuZGVmYXVsdEluZGV4ICUgdGhpcy5kZWZhdWx0R3JvdXBzLmxlbmd0aDsKICAgICAgICAgICAgdGhpcy5kZWZhdWx0SW5kZXgrKzsKICAgICAgICAgICAgZ3JvdXAgPSB7fTsKICAgICAgICAgICAgZ3JvdXAuY29sb3IgPSB0aGlzLmRlZmF1bHRHcm91cHNbaW5kZXhdOwogICAgICAgICAgICB0aGlzLmdyb3Vwc1tncm91cG5hbWVdID0gZ3JvdXA7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZ3JvdXA7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiYWRkIiwKCiAgICAgIC8qKgogICAgICAgKiBBZGQgYSBjdXN0b20gZ3JvdXAgc3R5bGUKICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGdyb3VwTmFtZQogICAgICAgKiBAcGFyYW0ge09iamVjdH0gc3R5bGUgICAgICAgQW4gb2JqZWN0IGNvbnRhaW5pbmcgYm9yZGVyQ29sb3IsCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3IsIGV0Yy4KICAgICAgICogQHJldHVybiB7T2JqZWN0fSBncm91cCAgICAgIFRoZSBjcmVhdGVkIGdyb3VwIG9iamVjdAogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFkZChncm91cE5hbWUsIHN0eWxlKSB7CiAgICAgICAgdGhpcy5ncm91cHNbZ3JvdXBOYW1lXSA9IHN0eWxlOwogICAgICAgIHRoaXMuZ3JvdXBzQXJyYXkucHVzaChncm91cE5hbWUpOwogICAgICAgIHJldHVybiBzdHlsZTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBHcm91cHM7CiAgfSkoKTsKCiAgZXhwb3J0c1siZGVmYXVsdCJdID0gR3JvdXBzOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOwoKLyoqKi8gfSwKLyogNjEgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgdmFyIF9jb21wb25lbnRzTm9kZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjIpOwoKICB2YXIgX2NvbXBvbmVudHNOb2RlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbXBvbmVudHNOb2RlKTsKCiAgdmFyIF9jb21wb25lbnRzU2hhcmVkTGFiZWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYzKTsKCiAgdmFyIF9jb21wb25lbnRzU2hhcmVkTGFiZWwyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY29tcG9uZW50c1NoYXJlZExhYmVsKTsKCiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwogIHZhciBEYXRhU2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKICB2YXIgRGF0YVZpZXcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKCiAgdmFyIE5vZGVzSGFuZGxlciA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBOb2Rlc0hhbmRsZXIoYm9keSwgaW1hZ2VzLCBncm91cHMsIGxheW91dEVuZ2luZSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE5vZGVzSGFuZGxlcik7CgogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLmltYWdlcyA9IGltYWdlczsKICAgICAgdGhpcy5ncm91cHMgPSBncm91cHM7CiAgICAgIHRoaXMubGF5b3V0RW5naW5lID0gbGF5b3V0RW5naW5lOwoKICAgICAgLy8gY3JlYXRlIHRoZSBub2RlIEFQSSBpbiB0aGUgYm9keSBjb250YWluZXIKICAgICAgdGhpcy5ib2R5LmZ1bmN0aW9ucy5jcmVhdGVOb2RlID0gdGhpcy5jcmVhdGUuYmluZCh0aGlzKTsKCiAgICAgIHRoaXMubm9kZXNMaXN0ZW5lcnMgPSB7CiAgICAgICAgYWRkOiBmdW5jdGlvbiBhZGQoZXZlbnQsIHBhcmFtcykgewogICAgICAgICAgX3RoaXMuYWRkKHBhcmFtcy5pdGVtcyk7CiAgICAgICAgfSwKICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShldmVudCwgcGFyYW1zKSB7CiAgICAgICAgICBfdGhpcy51cGRhdGUocGFyYW1zLml0ZW1zLCBwYXJhbXMuZGF0YSk7CiAgICAgICAgfSwKICAgICAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZShldmVudCwgcGFyYW1zKSB7CiAgICAgICAgICBfdGhpcy5yZW1vdmUocGFyYW1zLml0ZW1zKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICB0aGlzLm9wdGlvbnMgPSB7fTsKICAgICAgdGhpcy5kZWZhdWx0T3B0aW9ucyA9IHsKICAgICAgICBib3JkZXJXaWR0aDogMSwKICAgICAgICBib3JkZXJXaWR0aFNlbGVjdGVkOiAyLAogICAgICAgIGJyb2tlbkltYWdlOiB1bmRlZmluZWQsCiAgICAgICAgY29sb3I6IHsKICAgICAgICAgIGJvcmRlcjogJyMyQjdDRTknLAogICAgICAgICAgYmFja2dyb3VuZDogJyM5N0MyRkMnLAogICAgICAgICAgaGlnaGxpZ2h0OiB7CiAgICAgICAgICAgIGJvcmRlcjogJyMyQjdDRTknLAogICAgICAgICAgICBiYWNrZ3JvdW5kOiAnI0QyRTVGRicKICAgICAgICAgIH0sCiAgICAgICAgICBob3ZlcjogewogICAgICAgICAgICBib3JkZXI6ICcjMkI3Q0U5JywKICAgICAgICAgICAgYmFja2dyb3VuZDogJyNEMkU1RkYnCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBmaXhlZDogewogICAgICAgICAgeDogZmFsc2UsCiAgICAgICAgICB5OiBmYWxzZQogICAgICAgIH0sCiAgICAgICAgZm9udDogewogICAgICAgICAgY29sb3I6ICcjMzQzNDM0JywKICAgICAgICAgIHNpemU6IDE0LCAvLyBweAogICAgICAgICAgZmFjZTogJ2FyaWFsJywKICAgICAgICAgIGJhY2tncm91bmQ6ICdub25lJywKICAgICAgICAgIHN0cm9rZVdpZHRoOiAwLCAvLyBweAogICAgICAgICAgc3Ryb2tlQ29sb3I6ICcjZmZmZmZmJywKICAgICAgICAgIGFsaWduOiAnaG9yaXpvbnRhbCcKICAgICAgICB9LAogICAgICAgIGdyb3VwOiB1bmRlZmluZWQsCiAgICAgICAgaGlkZGVuOiBmYWxzZSwKICAgICAgICBpY29uOiB7CiAgICAgICAgICBmYWNlOiAnRm9udEF3ZXNvbWUnLCAvLydGb250QXdlc29tZScsCiAgICAgICAgICBjb2RlOiB1bmRlZmluZWQsIC8vJ1x1ZjAwNycsCiAgICAgICAgICBzaXplOiA1MCwgLy81MCwKICAgICAgICAgIGNvbG9yOiAnIzJCN0NFOScgLy8nI2FhMDBmZicKICAgICAgICB9LAogICAgICAgIGltYWdlOiB1bmRlZmluZWQsIC8vIC0tPiBVUkwKICAgICAgICBsYWJlbDogdW5kZWZpbmVkLAogICAgICAgIGxldmVsOiB1bmRlZmluZWQsCiAgICAgICAgbWFzczogMSwKICAgICAgICBwaHlzaWNzOiB0cnVlLAogICAgICAgIHNjYWxpbmc6IHsKICAgICAgICAgIG1pbjogMTAsCiAgICAgICAgICBtYXg6IDMwLAogICAgICAgICAgbGFiZWw6IHsKICAgICAgICAgICAgZW5hYmxlZDogZmFsc2UsCiAgICAgICAgICAgIG1pbjogMTQsCiAgICAgICAgICAgIG1heDogMzAsCiAgICAgICAgICAgIG1heFZpc2libGU6IDMwLAogICAgICAgICAgICBkcmF3VGhyZXNob2xkOiA1CiAgICAgICAgICB9LAogICAgICAgICAgY3VzdG9tU2NhbGluZ0Z1bmN0aW9uOiBmdW5jdGlvbiBjdXN0b21TY2FsaW5nRnVuY3Rpb24obWluLCBtYXgsIHRvdGFsLCB2YWx1ZSkgewogICAgICAgICAgICBpZiAobWF4ID09PSBtaW4pIHsKICAgICAgICAgICAgICByZXR1cm4gMC41OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBzY2FsZSA9IDEgLyAobWF4IC0gbWluKTsKICAgICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoMCwgKHZhbHVlIC0gbWluKSAqIHNjYWxlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2hhZG93OiB7CiAgICAgICAgICBlbmFibGVkOiBmYWxzZSwKICAgICAgICAgIHNpemU6IDEwLAogICAgICAgICAgeDogNSwKICAgICAgICAgIHk6IDUKICAgICAgICB9LAogICAgICAgIHNoYXBlOiAnZWxsaXBzZScsCiAgICAgICAgc2l6ZTogMjUsCiAgICAgICAgdGl0bGU6IHVuZGVmaW5lZCwKICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgIHg6IHVuZGVmaW5lZCwKICAgICAgICB5OiB1bmRlZmluZWQKICAgICAgfTsKICAgICAgdXRpbC5leHRlbmQodGhpcy5vcHRpb25zLCB0aGlzLmRlZmF1bHRPcHRpb25zKTsKCiAgICAgIHRoaXMuYmluZEV2ZW50TGlzdGVuZXJzKCk7CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKE5vZGVzSGFuZGxlciwgW3sKICAgICAga2V5OiAnYmluZEV2ZW50TGlzdGVuZXJzJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGJpbmRFdmVudExpc3RlbmVycygpIHsKICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgLy8gcmVmcmVzaCB0aGUgbm9kZXMuIFVzZWQgd2hlbiByZXZlcnRpbmcgZnJvbSBoaWVyYXJjaGljYWwgbGF5b3V0CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ3JlZnJlc2hOb2RlcycsIHRoaXMucmVmcmVzaC5iaW5kKHRoaXMpKTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbigncmVmcmVzaCcsIHRoaXMucmVmcmVzaC5iaW5kKHRoaXMpKTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignZGVzdHJveScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGRlbGV0ZSBfdGhpczIuYm9keS5mdW5jdGlvbnMuY3JlYXRlTm9kZTsKICAgICAgICAgIGRlbGV0ZSBfdGhpczIubm9kZXNMaXN0ZW5lcnMuYWRkOwogICAgICAgICAgZGVsZXRlIF90aGlzMi5ub2Rlc0xpc3RlbmVycy51cGRhdGU7CiAgICAgICAgICBkZWxldGUgX3RoaXMyLm5vZGVzTGlzdGVuZXJzLnJlbW92ZTsKICAgICAgICAgIGRlbGV0ZSBfdGhpczIubm9kZXNMaXN0ZW5lcnM7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc2V0T3B0aW9ucycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICBpZiAob3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBfY29tcG9uZW50c05vZGUyWydkZWZhdWx0J10ucGFyc2VPcHRpb25zKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CgogICAgICAgICAgLy8gdXBkYXRlIHRoZSBzaGFwZSBpbiBhbGwgbm9kZXMKICAgICAgICAgIGlmIChvcHRpb25zLnNoYXBlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgZm9yICh2YXIgbm9kZUlkIGluIHRoaXMuYm9keS5ub2RlcykgewogICAgICAgICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXMuaGFzT3duUHJvcGVydHkobm9kZUlkKSkgewogICAgICAgICAgICAgICAgdGhpcy5ib2R5Lm5vZGVzW25vZGVJZF0udXBkYXRlU2hhcGUoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyB1cGRhdGUgdGhlIHNoYXBlIHNpemUgaW4gYWxsIG5vZGVzCiAgICAgICAgICBpZiAob3B0aW9ucy5mb250ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgX2NvbXBvbmVudHNTaGFyZWRMYWJlbDJbJ2RlZmF1bHQnXS5wYXJzZU9wdGlvbnModGhpcy5vcHRpb25zLmZvbnQsIG9wdGlvbnMpOwogICAgICAgICAgICBmb3IgKHZhciBub2RlSWQgaW4gdGhpcy5ib2R5Lm5vZGVzKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYm9keS5ub2Rlcy5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXS51cGRhdGVMYWJlbE1vZHVsZSgpOwogICAgICAgICAgICAgICAgdGhpcy5ib2R5Lm5vZGVzW25vZGVJZF0uX3Jlc2V0KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gdXBkYXRlIHRoZSBzaGFwZSBzaXplIGluIGFsbCBub2RlcwogICAgICAgICAgaWYgKG9wdGlvbnMuc2l6ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiB0aGlzLmJvZHkubm9kZXMpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdLl9yZXNldCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgc3RhdGUgb2YgdGhlIGxldGlhYmxlcyBpZiBuZWVkZWQKICAgICAgICAgIGlmIChvcHRpb25zLmhpZGRlbiAhPT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMucGh5c2ljcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19kYXRhQ2hhbmdlZCcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzZXREYXRhJywKCiAgICAgIC8qKgogICAgICAgKiBTZXQgYSBkYXRhIHNldCB3aXRoIG5vZGVzIGZvciB0aGUgbmV0d29yawogICAgICAgKiBAcGFyYW0ge0FycmF5IHwgRGF0YVNldCB8IERhdGFWaWV3fSBub2RlcyAgICAgICAgIFRoZSBkYXRhIGNvbnRhaW5pbmcgdGhlIG5vZGVzLgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldERhdGEobm9kZXMpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgdmFyIGRvTm90RW1pdCA9IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbMV07CgogICAgICAgIHZhciBvbGROb2Rlc0RhdGEgPSB0aGlzLmJvZHkuZGF0YS5ub2RlczsKCiAgICAgICAgaWYgKG5vZGVzIGluc3RhbmNlb2YgRGF0YVNldCB8fCBub2RlcyBpbnN0YW5jZW9mIERhdGFWaWV3KSB7CiAgICAgICAgICB0aGlzLmJvZHkuZGF0YS5ub2RlcyA9IG5vZGVzOwogICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShub2RlcykpIHsKICAgICAgICAgIHRoaXMuYm9keS5kYXRhLm5vZGVzID0gbmV3IERhdGFTZXQoKTsKICAgICAgICAgIHRoaXMuYm9keS5kYXRhLm5vZGVzLmFkZChub2Rlcyk7CiAgICAgICAgfSBlbHNlIGlmICghbm9kZXMpIHsKICAgICAgICAgIHRoaXMuYm9keS5kYXRhLm5vZGVzID0gbmV3IERhdGFTZXQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQXJyYXkgb3IgRGF0YVNldCBleHBlY3RlZCcpOwogICAgICAgIH0KCiAgICAgICAgaWYgKG9sZE5vZGVzRGF0YSkgewogICAgICAgICAgLy8gdW5zdWJzY3JpYmUgZnJvbSBvbGQgZGF0YXNldAogICAgICAgICAgdXRpbC5mb3JFYWNoKHRoaXMubm9kZXNMaXN0ZW5lcnMsIGZ1bmN0aW9uIChjYWxsYmFjaywgZXZlbnQpIHsKICAgICAgICAgICAgb2xkTm9kZXNEYXRhLm9mZihldmVudCwgY2FsbGJhY2spOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyByZW1vdmUgZHJhd24gbm9kZXMKICAgICAgICB0aGlzLmJvZHkubm9kZXMgPSB7fTsKCiAgICAgICAgaWYgKHRoaXMuYm9keS5kYXRhLm5vZGVzKSB7CiAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyBzdWJzY3JpYmUgdG8gbmV3IGRhdGFzZXQKICAgICAgICAgICAgdmFyIG1lID0gX3RoaXMzOwogICAgICAgICAgICB1dGlsLmZvckVhY2goX3RoaXMzLm5vZGVzTGlzdGVuZXJzLCBmdW5jdGlvbiAoY2FsbGJhY2ssIGV2ZW50KSB7CiAgICAgICAgICAgICAgbWUuYm9keS5kYXRhLm5vZGVzLm9uKGV2ZW50LCBjYWxsYmFjayk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gZHJhdyBhbGwgbmV3IG5vZGVzCiAgICAgICAgICAgIHZhciBpZHMgPSBfdGhpczMuYm9keS5kYXRhLm5vZGVzLmdldElkcygpOwogICAgICAgICAgICBfdGhpczMuYWRkKGlkcywgdHJ1ZSk7CiAgICAgICAgICB9KSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRvTm90RW1pdCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19kYXRhQ2hhbmdlZCcpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdhZGQnLAoKICAgICAgLyoqCiAgICAgICAqIEFkZCBub2RlcwogICAgICAgKiBAcGFyYW0ge051bWJlcltdIHwgU3RyaW5nW119IGlkcwogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFkZChpZHMpIHsKICAgICAgICB2YXIgZG9Ob3RFbWl0ID0gYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1sxXTsKCiAgICAgICAgdmFyIGlkID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBuZXdOb2RlcyA9IFtdOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZCA9IGlkc1tpXTsKICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5ib2R5LmRhdGEubm9kZXMuZ2V0KGlkKTsKICAgICAgICAgIHZhciBub2RlID0gdGhpcy5jcmVhdGUocHJvcGVydGllcyk7CiAgICAgICAgICBuZXdOb2Rlcy5wdXNoKG5vZGUpOwogICAgICAgICAgdGhpcy5ib2R5Lm5vZGVzW2lkXSA9IG5vZGU7IC8vIG5vdGU6IHRoaXMgbWF5IHJlcGxhY2UgYW4gZXhpc3Rpbmcgbm9kZQogICAgICAgIH0KCiAgICAgICAgdGhpcy5sYXlvdXRFbmdpbmUucG9zaXRpb25Jbml0aWFsbHkobmV3Tm9kZXMpOwoKICAgICAgICBpZiAoZG9Ob3RFbWl0ID09PSBmYWxzZSkgewogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX2RhdGFDaGFuZ2VkJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3VwZGF0ZScsCgogICAgICAvKioKICAgICAgICogVXBkYXRlIGV4aXN0aW5nIG5vZGVzLCBvciBjcmVhdGUgdGhlbSB3aGVuIG5vdCB5ZXQgZXhpc3RpbmcKICAgICAgICogQHBhcmFtIHtOdW1iZXJbXSB8IFN0cmluZ1tdfSBpZHMKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGUoaWRzLCBjaGFuZ2VkRGF0YSkgewogICAgICAgIHZhciBub2RlcyA9IHRoaXMuYm9keS5ub2RlczsKICAgICAgICB2YXIgZGF0YUNoYW5nZWQgPSBmYWxzZTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGlkID0gaWRzW2ldOwogICAgICAgICAgdmFyIG5vZGUgPSBub2Rlc1tpZF07CiAgICAgICAgICB2YXIgZGF0YSA9IGNoYW5nZWREYXRhW2ldOwogICAgICAgICAgaWYgKG5vZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyB1cGRhdGUgbm9kZQogICAgICAgICAgICBkYXRhQ2hhbmdlZCA9IG5vZGUuc2V0T3B0aW9ucyhkYXRhKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRhdGFDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgLy8gY3JlYXRlIG5vZGUKICAgICAgICAgICAgbm9kZSA9IHRoaXMuY3JlYXRlKGRhdGEpOwogICAgICAgICAgICBub2Rlc1tpZF0gPSBub2RlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZGF0YUNoYW5nZWQgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19kYXRhQ2hhbmdlZCcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfZGF0YVVwZGF0ZWQnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAncmVtb3ZlJywKCiAgICAgIC8qKgogICAgICAgKiBSZW1vdmUgZXhpc3Rpbmcgbm9kZXMuIElmIG5vZGVzIGRvIG5vdCBleGlzdCwgdGhlIG1ldGhvZCB3aWxsIGp1c3QgaWdub3JlIGl0LgogICAgICAgKiBAcGFyYW0ge051bWJlcltdIHwgU3RyaW5nW119IGlkcwogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZShpZHMpIHsKICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLmJvZHkubm9kZXM7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgaWQgPSBpZHNbaV07CiAgICAgICAgICBkZWxldGUgbm9kZXNbaWRdOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX2RhdGFDaGFuZ2VkJyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnY3JlYXRlJywKCiAgICAgIC8qKgogICAgICAgKiBjcmVhdGUgYSBub2RlCiAgICAgICAqIEBwYXJhbSBwcm9wZXJ0aWVzCiAgICAgICAqIEBwYXJhbSBjb25zdHJ1Y3RvckNsYXNzCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHsKICAgICAgICB2YXIgY29uc3RydWN0b3JDbGFzcyA9IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gX2NvbXBvbmVudHNOb2RlMlsnZGVmYXVsdCddIDogYXJndW1lbnRzWzFdOwoKICAgICAgICByZXR1cm4gbmV3IGNvbnN0cnVjdG9yQ2xhc3MocHJvcGVydGllcywgdGhpcy5ib2R5LCB0aGlzLmltYWdlcywgdGhpcy5ncm91cHMsIHRoaXMub3B0aW9ucyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAncmVmcmVzaCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZWZyZXNoKCkgewogICAgICAgIHZhciBub2RlcyA9IHRoaXMuYm9keS5ub2RlczsKICAgICAgICBmb3IgKHZhciBub2RlSWQgaW4gbm9kZXMpIHsKICAgICAgICAgIHZhciBub2RlID0gdW5kZWZpbmVkOwogICAgICAgICAgaWYgKG5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgbm9kZSA9IG5vZGVzW25vZGVJZF07CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuYm9keS5kYXRhLm5vZGVzLl9kYXRhW25vZGVJZF07CiAgICAgICAgICBpZiAobm9kZSAhPT0gdW5kZWZpbmVkICYmIGRhdGEgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBub2RlLnNldE9wdGlvbnMoeyBmaXhlZDogZmFsc2UgfSk7CiAgICAgICAgICAgIG5vZGUuc2V0T3B0aW9ucyhkYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZ2V0UG9zaXRpb25zJywKCiAgICAgIC8qKgogICAgICAgKiBSZXR1cm5zIHRoZSBwb3NpdGlvbnMgb2YgdGhlIG5vZGVzLgogICAgICAgKiBAcGFyYW0gaWRzICAtLT4gb3B0aW9uYWwsIGNhbiBiZSBhcnJheSBvZiBub2RlSWRzLCBjYW4gYmUgc3RyaW5nCiAgICAgICAqIEByZXR1cm5zIHt7fX0KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQb3NpdGlvbnMoaWRzKSB7CiAgICAgICAgdmFyIGRhdGFBcnJheSA9IHt9OwogICAgICAgIGlmIChpZHMgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaWRzKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXNbaWRzW2ldXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuYm9keS5ub2Rlc1tpZHNbaV1dOwogICAgICAgICAgICAgICAgZGF0YUFycmF5W2lkc1tpXV0gPSB7IHg6IE1hdGgucm91bmQobm9kZS54KSwgeTogTWF0aC5yb3VuZChub2RlLnkpIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzW2lkc10gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHZhciBub2RlID0gdGhpcy5ib2R5Lm5vZGVzW2lkc107CiAgICAgICAgICAgICAgZGF0YUFycmF5W2lkc10gPSB7IHg6IE1hdGgucm91bmQobm9kZS54KSwgeTogTWF0aC5yb3VuZChub2RlLnkpIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yICh2YXIgbm9kZUlkIGluIHRoaXMuYm9keS5ub2RlcykgewogICAgICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdOwogICAgICAgICAgICAgIGRhdGFBcnJheVtub2RlSWRdID0geyB4OiBNYXRoLnJvdW5kKG5vZGUueCksIHk6IE1hdGgucm91bmQobm9kZS55KSB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBkYXRhQXJyYXk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc3RvcmVQb3NpdGlvbnMnLAoKICAgICAgLyoqCiAgICAgICAqIExvYWQgdGhlIFhZIHBvc2l0aW9ucyBvZiB0aGUgbm9kZXMgaW50byB0aGUgZGF0YXNldC4KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzdG9yZVBvc2l0aW9ucygpIHsKICAgICAgICAvLyB0b2RvOiBhZGQgc3VwcG9ydCBmb3IgY2x1c3RlcnMgYW5kIGhpZXJhcmNoaWNhbC4KICAgICAgICB2YXIgZGF0YUFycmF5ID0gW107CiAgICAgICAgdmFyIGRhdGFzZXQgPSB0aGlzLmJvZHkuZGF0YS5ub2Rlcy5nZXREYXRhU2V0KCk7CgogICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiBkYXRhc2V0Ll9kYXRhKSB7CiAgICAgICAgICBpZiAoZGF0YXNldC5fZGF0YS5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgIHZhciBub2RlID0gdGhpcy5ib2R5Lm5vZGVzW25vZGVJZF07CiAgICAgICAgICAgIGlmIChkYXRhc2V0Ll9kYXRhW25vZGVJZF0ueCAhPSBNYXRoLnJvdW5kKG5vZGUueCkgfHwgZGF0YXNldC5fZGF0YVtub2RlSWRdLnkgIT0gTWF0aC5yb3VuZChub2RlLnkpKSB7CiAgICAgICAgICAgICAgZGF0YUFycmF5LnB1c2goeyBpZDogbm9kZUlkLCB4OiBNYXRoLnJvdW5kKG5vZGUueCksIHk6IE1hdGgucm91bmQobm9kZS55KSB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkYXRhc2V0LnVwZGF0ZShkYXRhQXJyYXkpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2dldEJvdW5kaW5nQm94JywKCiAgICAgIC8qKgogICAgICAgKiBnZXQgdGhlIGJvdW5kaW5nIGJveCBvZiBhIG5vZGUuCiAgICAgICAqIEBwYXJhbSBub2RlSWQKICAgICAgICogQHJldHVybnMge2p8Kn0KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCb3VuZGluZ0JveChub2RlSWQpIHsKICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzW25vZGVJZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdLnNoYXBlLmJvdW5kaW5nQm94OwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdnZXRDb25uZWN0ZWROb2RlcycsCgogICAgICAvKioKICAgICAgICogR2V0IHRoZSBJZHMgb2Ygbm9kZXMgY29ubmVjdGVkIHRvIHRoaXMgbm9kZS4KICAgICAgICogQHBhcmFtIG5vZGVJZAogICAgICAgKiBAcmV0dXJucyB7QXJyYXl9CiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q29ubmVjdGVkTm9kZXMobm9kZUlkKSB7CiAgICAgICAgdmFyIG5vZGVMaXN0ID0gW107CiAgICAgICAgaWYgKHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBub2RlID0gdGhpcy5ib2R5Lm5vZGVzW25vZGVJZF07CiAgICAgICAgICB2YXIgbm9kZU9iaiA9IHt9OyAvLyB1c2VkIHRvIHF1aWNrbHkgY2hlY2sgaWYgbm9kZSBhbHJlYWR5IGV4aXN0cwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmVkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBlZGdlID0gbm9kZS5lZGdlc1tpXTsKICAgICAgICAgICAgaWYgKGVkZ2UudG9JZCA9PSBub2RlSWQpIHsKICAgICAgICAgICAgICAvLyB0aGVzZSBhcmUgZG91YmxlIGVxdWFscyBzaW5jZSBpZHMgY2FuIGJlIG51bWVyaWMgb3Igc3RyaW5nCiAgICAgICAgICAgICAgaWYgKG5vZGVPYmpbZWRnZS5mcm9tSWRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIG5vZGVMaXN0LnB1c2goZWRnZS5mcm9tSWQpOwogICAgICAgICAgICAgICAgbm9kZU9ialtlZGdlLmZyb21JZF0gPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChlZGdlLmZyb21JZCA9PSBub2RlSWQpIHsKICAgICAgICAgICAgICAvLyB0aGVzZSBhcmUgZG91YmxlIGVxdWFscyBzaW5jZSBpZHMgY2FuIGJlIG51bWVyaWMgb3Igc3RyaW5nCiAgICAgICAgICAgICAgaWYgKG5vZGVPYmpbZWRnZS50b0lkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBub2RlTGlzdC5wdXNoKGVkZ2UudG9JZCk7CiAgICAgICAgICAgICAgICBub2RlT2JqW2VkZ2UudG9JZF0gPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbm9kZUxpc3Q7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZ2V0Q29ubmVjdGVkRWRnZXMnLAoKICAgICAgLyoqCiAgICAgICAqIEdldCB0aGUgaWRzIG9mIHRoZSBlZGdlcyBjb25uZWN0ZWQgdG8gdGhpcyBub2RlLgogICAgICAgKiBAcGFyYW0gbm9kZUlkCiAgICAgICAqIEByZXR1cm5zIHsqfQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvbm5lY3RlZEVkZ2VzKG5vZGVJZCkgewogICAgICAgIHZhciBlZGdlTGlzdCA9IFtdOwogICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXNbbm9kZUlkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmVkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGVkZ2VMaXN0LnB1c2gobm9kZS5lZGdlc1tpXS5pZCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdOb2RlSWQgcHJvdmlkZWQgZm9yIGdldENvbm5lY3RlZEVkZ2VzIGRvZXMgbm90IGV4aXN0LiBQcm92aWRlZDogJywgbm9kZUlkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVkZ2VMaXN0OwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIE5vZGVzSGFuZGxlcjsKICB9KSgpOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBOb2Rlc0hhbmRsZXI7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiA2MiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKICB2YXIgX3NoYXJlZExhYmVsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Myk7CgogIHZhciBfc2hhcmVkTGFiZWwyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc2hhcmVkTGFiZWwpOwoKICB2YXIgX25vZGVzU2hhcGVzQm94ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NCk7CgogIHZhciBfbm9kZXNTaGFwZXNCb3gyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbm9kZXNTaGFwZXNCb3gpOwoKICB2YXIgX25vZGVzU2hhcGVzQ2lyY2xlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Nik7CgogIHZhciBfbm9kZXNTaGFwZXNDaXJjbGUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbm9kZXNTaGFwZXNDaXJjbGUpOwoKICB2YXIgX25vZGVzU2hhcGVzQ2lyY3VsYXJJbWFnZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjgpOwoKICB2YXIgX25vZGVzU2hhcGVzQ2lyY3VsYXJJbWFnZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9ub2Rlc1NoYXBlc0NpcmN1bGFySW1hZ2UpOwoKICB2YXIgX25vZGVzU2hhcGVzRGF0YWJhc2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY5KTsKCiAgdmFyIF9ub2Rlc1NoYXBlc0RhdGFiYXNlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX25vZGVzU2hhcGVzRGF0YWJhc2UpOwoKICB2YXIgX25vZGVzU2hhcGVzRGlhbW9uZCA9IF9fd2VicGFja19yZXF1aXJlX18oNzApOwoKICB2YXIgX25vZGVzU2hhcGVzRGlhbW9uZDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9ub2Rlc1NoYXBlc0RpYW1vbmQpOwoKICB2YXIgX25vZGVzU2hhcGVzRG90ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3Mik7CgogIHZhciBfbm9kZXNTaGFwZXNEb3QyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbm9kZXNTaGFwZXNEb3QpOwoKICB2YXIgX25vZGVzU2hhcGVzRWxsaXBzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNzMpOwoKICB2YXIgX25vZGVzU2hhcGVzRWxsaXBzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9ub2Rlc1NoYXBlc0VsbGlwc2UpOwoKICB2YXIgX25vZGVzU2hhcGVzSWNvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNzQpOwoKICB2YXIgX25vZGVzU2hhcGVzSWNvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9ub2Rlc1NoYXBlc0ljb24pOwoKICB2YXIgX25vZGVzU2hhcGVzSW1hZ2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc1KTsKCiAgdmFyIF9ub2Rlc1NoYXBlc0ltYWdlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX25vZGVzU2hhcGVzSW1hZ2UpOwoKICB2YXIgX25vZGVzU2hhcGVzU3F1YXJlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3Nik7CgogIHZhciBfbm9kZXNTaGFwZXNTcXVhcmUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbm9kZXNTaGFwZXNTcXVhcmUpOwoKICB2YXIgX25vZGVzU2hhcGVzU3RhciA9IF9fd2VicGFja19yZXF1aXJlX18oNzcpOwoKICB2YXIgX25vZGVzU2hhcGVzU3RhcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9ub2Rlc1NoYXBlc1N0YXIpOwoKICB2YXIgX25vZGVzU2hhcGVzVGV4dCA9IF9fd2VicGFja19yZXF1aXJlX18oNzgpOwoKICB2YXIgX25vZGVzU2hhcGVzVGV4dDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9ub2Rlc1NoYXBlc1RleHQpOwoKICB2YXIgX25vZGVzU2hhcGVzVHJpYW5nbGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc5KTsKCiAgdmFyIF9ub2Rlc1NoYXBlc1RyaWFuZ2xlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX25vZGVzU2hhcGVzVHJpYW5nbGUpOwoKICB2YXIgX25vZGVzU2hhcGVzVHJpYW5nbGVEb3duID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4MCk7CgogIHZhciBfbm9kZXNTaGFwZXNUcmlhbmdsZURvd24yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfbm9kZXNTaGFwZXNUcmlhbmdsZURvd24pOwoKICB2YXIgX3NoYXJlZFZhbGlkYXRvciA9IF9fd2VicGFja19yZXF1aXJlX18oNDcpOwoKICB2YXIgX3NoYXJlZFZhbGlkYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zaGFyZWRWYWxpZGF0b3IpOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogIC8qKgogICAqIEBjbGFzcyBOb2RlCiAgICogQSBub2RlLiBBIG5vZGUgY2FuIGJlIGNvbm5lY3RlZCB0byBvdGhlciBub2RlcyB2aWEgb25lIG9yIG11bHRpcGxlIGVkZ2VzLgogICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIEFuIG9iamVjdCBjb250YWluaW5nIG9wdGlvbnMgZm9yIHRoZSBub2RlLiBBbGwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zIGFyZSBvcHRpb25hbCwgZXhjZXB0IGZvciB0aGUgaWQuCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bnVtYmVyfSBpZCAgICAgSWQgb2YgdGhlIG5vZGUuIFJlcXVpcmVkCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3RyaW5nfSBsYWJlbCAgVGV4dCBsYWJlbCBmb3IgdGhlIG5vZGUKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtudW1iZXJ9IHggICAgICBIb3Jpem9udGFsIHBvc2l0aW9uIG9mIHRoZSBub2RlCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bnVtYmVyfSB5ICAgICAgVmVydGljYWwgcG9zaXRpb24gb2YgdGhlIG5vZGUKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdHJpbmd9IHNoYXBlICBOb2RlIHNoYXBlLCBhdmFpbGFibGU6CiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRhdGFiYXNlIiwgImNpcmNsZSIsICJlbGxpcHNlIiwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYm94IiwgImltYWdlIiwgInRleHQiLCAiZG90IiwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RhciIsICJ0cmlhbmdsZSIsICJ0cmlhbmdsZURvd24iLAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzcXVhcmUiLCAiaWNvbiIKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdHJpbmd9IGltYWdlICBBbiBpbWFnZSB1cmwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtzdHJpbmd9IHRpdGxlICBBbiB0aXRsZSB0ZXh0LCBjYW4gYmUgSFRNTAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2FueXR5cGV9IGdyb3VwIEEgZ3JvdXAgbmFtZSBvciBudW1iZXIKICAgKiBAcGFyYW0ge05ldHdvcmsuSW1hZ2VzfSBpbWFnZWxpc3QgICAgQSBsaXN0IHdpdGggaW1hZ2VzLiBPbmx5IG5lZWRlZAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGVuIHRoZSBub2RlIGhhcyBhbiBpbWFnZQogICAqIEBwYXJhbSB7TmV0d29yay5Hcm91cHN9IGdyb3VwbGlzdCAgICBBIGxpc3Qgd2l0aCBncm91cHMuIE5lZWRlZCBmb3IKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0cmlldmluZyBncm91cCBvcHRpb25zCiAgICogQHBhcmFtIHtPYmplY3R9ICAgICAgICAgICAgICAgY29uc3RhbnRzICAgIEFuIG9iamVjdCB3aXRoIGRlZmF1bHQgdmFsdWVzIGZvcgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGFtcGxlIGZvciB0aGUgY29sb3IKICAgKgogICAqLwoKICB2YXIgTm9kZSA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBOb2RlKG9wdGlvbnMsIGJvZHksIGltYWdlbGlzdCwgZ3JvdXBsaXN0LCBnbG9iYWxPcHRpb25zKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBOb2RlKTsKCiAgICAgIHRoaXMub3B0aW9ucyA9IHV0aWwuYnJpZGdlT2JqZWN0KGdsb2JhbE9wdGlvbnMpOwogICAgICB0aGlzLmJvZHkgPSBib2R5OwoKICAgICAgdGhpcy5lZGdlcyA9IFtdOyAvLyBhbGwgZWRnZXMgY29ubmVjdGVkIHRvIHRoaXMgbm9kZQoKICAgICAgLy8gc2V0IGRlZmF1bHRzIGZvciB0aGUgb3B0aW9ucwogICAgICB0aGlzLmlkID0gdW5kZWZpbmVkOwogICAgICB0aGlzLmltYWdlbGlzdCA9IGltYWdlbGlzdDsKICAgICAgdGhpcy5ncm91cGxpc3QgPSBncm91cGxpc3Q7CgogICAgICAvLyBzdGF0ZSBvcHRpb25zCiAgICAgIHRoaXMueCA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy55ID0gdW5kZWZpbmVkOwogICAgICB0aGlzLmJhc2VTaXplID0gdGhpcy5vcHRpb25zLnNpemU7CiAgICAgIHRoaXMuYmFzZUZvbnRTaXplID0gdGhpcy5vcHRpb25zLmZvbnQuc2l6ZTsKICAgICAgdGhpcy5wcmVkZWZpbmVkUG9zaXRpb24gPSBmYWxzZTsgLy8gdXNlZCB0byBjaGVjayBpZiBpbml0aWFsIGZpdCBzaG91bGQganVzdCB0YWtlIHRoZSByYW5nZSBvciBhcHByb3hpbWF0ZQogICAgICB0aGlzLnNlbGVjdGVkID0gZmFsc2U7CiAgICAgIHRoaXMuaG92ZXIgPSBmYWxzZTsKCiAgICAgIHRoaXMubGFiZWxNb2R1bGUgPSBuZXcgX3NoYXJlZExhYmVsMlsnZGVmYXVsdCddKHRoaXMuYm9keSwgdGhpcy5vcHRpb25zKTsKICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhOb2RlLCBbewogICAgICBrZXk6ICdhdHRhY2hFZGdlJywKCiAgICAgIC8qKgogICAgICAgKiBBdHRhY2ggYSBlZGdlIHRvIHRoZSBub2RlCiAgICAgICAqIEBwYXJhbSB7RWRnZX0gZWRnZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGF0dGFjaEVkZ2UoZWRnZSkgewogICAgICAgIGlmICh0aGlzLmVkZ2VzLmluZGV4T2YoZWRnZSkgPT09IC0xKSB7CiAgICAgICAgICB0aGlzLmVkZ2VzLnB1c2goZWRnZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RldGFjaEVkZ2UnLAoKICAgICAgLyoqCiAgICAgICAqIERldGFjaCBhIGVkZ2UgZnJvbSB0aGUgbm9kZQogICAgICAgKiBAcGFyYW0ge0VkZ2V9IGVkZ2UKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkZXRhY2hFZGdlKGVkZ2UpIHsKICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmVkZ2VzLmluZGV4T2YoZWRnZSk7CiAgICAgICAgaWYgKGluZGV4ICE9IC0xKSB7CiAgICAgICAgICB0aGlzLmVkZ2VzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3RvZ2dsZVBoeXNpY3MnLAoKICAgICAgLyoqCiAgICAgICAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSBwaHlzaWNzLgogICAgICAgKiBAcGFyYW0gc3RhdHVzCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gdG9nZ2xlUGh5c2ljcyhzdGF0dXMpIHsKICAgICAgICB0aGlzLm9wdGlvbnMucGh5c2ljcyA9IHN0YXR1czsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzZXRPcHRpb25zJywKCiAgICAgIC8qKgogICAgICAgKiBTZXQgb3Igb3ZlcndyaXRlIG9wdGlvbnMgZm9yIHRoZSBub2RlCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIGFuIG9iamVjdCB3aXRoIG9wdGlvbnMKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNvbnN0YW50cyAgYW5kIG9iamVjdCB3aXRoIGRlZmF1bHQsIGdsb2JhbCBvcHRpb25zCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgaWYgKCFvcHRpb25zKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIGJhc2ljIG9wdGlvbnMKICAgICAgICBpZiAob3B0aW9ucy5pZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLmlkID0gb3B0aW9ucy5pZDsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmlkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRocm93ICdOb2RlIG11c3QgaGF2ZSBhbiBpZCc7CiAgICAgICAgfQoKICAgICAgICAvLyBzZXQgdGhlc2Ugb3B0aW9ucyBsb2NhbGx5CiAgICAgICAgaWYgKG9wdGlvbnMueCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnggPSBwYXJzZUludChvcHRpb25zLngpO3RoaXMucHJlZGVmaW5lZFBvc2l0aW9uID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMueSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnkgPSBwYXJzZUludChvcHRpb25zLnkpO3RoaXMucHJlZGVmaW5lZFBvc2l0aW9uID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMuc2l6ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLmJhc2VTaXplID0gb3B0aW9ucy5zaXplOwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBvcHRpb25zLnZhbHVlID0gcGFyc2VGbG9hdChvcHRpb25zLnZhbHVlKTsKICAgICAgICB9CgogICAgICAgIC8vIGNvcHkgZ3JvdXAgb3B0aW9ucwogICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5ncm91cCA9PT0gJ251bWJlcicgfHwgdHlwZW9mIG9wdGlvbnMuZ3JvdXAgPT09ICdzdHJpbmcnICYmIG9wdGlvbnMuZ3JvdXAgIT0gJycpIHsKICAgICAgICAgIHZhciBncm91cE9iaiA9IHRoaXMuZ3JvdXBsaXN0LmdldChvcHRpb25zLmdyb3VwKTsKICAgICAgICAgIHV0aWwuZGVlcEV4dGVuZCh0aGlzLm9wdGlvbnMsIGdyb3VwT2JqKTsKICAgICAgICAgIC8vIHRoZSBjb2xvciBvYmplY3QgbmVlZHMgdG8gYmUgY29tcGxldGVseSBkZWZpbmVkLiBTaW5jZSBncm91cHMgY2FuIHBhcnRpYWxseSBvdmVyd3JpdGUgdGhlIGNvbG9ycywgd2UgcGFyc2UgaXQgYWdhaW4sIGp1c3QgaW4gY2FzZS4KICAgICAgICAgIHRoaXMub3B0aW9ucy5jb2xvciA9IHV0aWwucGFyc2VDb2xvcih0aGlzLm9wdGlvbnMuY29sb3IpOwogICAgICAgIH0KCiAgICAgICAgLy8gdGhpcyB0cmFuc2Zvcm1zIGFsbCBzaG9ydGhhbmRzIGludG8gZnVsbHkgZGVmaW5lZCBvcHRpb25zCiAgICAgICAgTm9kZS5wYXJzZU9wdGlvbnModGhpcy5vcHRpb25zLCBvcHRpb25zLCB0cnVlKTsKCiAgICAgICAgLy8gbG9hZCB0aGUgaW1hZ2VzCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbWFnZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMub3B0aW9ucy5pbWFnZSAhPSAnJykgewogICAgICAgICAgaWYgKHRoaXMuaW1hZ2VsaXN0KSB7CiAgICAgICAgICAgIHRoaXMuaW1hZ2VPYmogPSB0aGlzLmltYWdlbGlzdC5sb2FkKHRoaXMub3B0aW9ucy5pbWFnZSwgdGhpcy5vcHRpb25zLmJyb2tlbkltYWdlLCB0aGlzLmlkKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93ICdObyBpbWFnZWxpc3QgcHJvdmlkZWQnOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy51cGRhdGVTaGFwZSgpOwogICAgICAgIHRoaXMudXBkYXRlTGFiZWxNb2R1bGUoKTsKCiAgICAgICAgLy8gcmVzZXQgdGhlIHNpemUgb2YgdGhlIG5vZGUsIHRoaXMgY2FuIGJlIGNoYW5nZWQKICAgICAgICB0aGlzLl9yZXNldCgpOwoKICAgICAgICBpZiAob3B0aW9ucy5oaWRkZW4gIT09IHVuZGVmaW5lZCB8fCBvcHRpb25zLnBoeXNpY3MgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICd1cGRhdGVMYWJlbE1vZHVsZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVMYWJlbE1vZHVsZSgpIHsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxhYmVsID09PSB1bmRlZmluZWQgfHwgdGhpcy5vcHRpb25zLmxhYmVsID09PSBudWxsKSB7CiAgICAgICAgICB0aGlzLm9wdGlvbnMubGFiZWwgPSAnJzsKICAgICAgICB9CiAgICAgICAgdGhpcy5sYWJlbE1vZHVsZS5zZXRPcHRpb25zKHRoaXMub3B0aW9ucywgdHJ1ZSk7CiAgICAgICAgaWYgKHRoaXMubGFiZWxNb2R1bGUuYmFzZVNpemUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5iYXNlRm9udFNpemUgPSB0aGlzLmxhYmVsTW9kdWxlLmJhc2VTaXplOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICd1cGRhdGVTaGFwZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVTaGFwZSgpIHsKICAgICAgICAvLyBjaG9vc2UgZHJhdyBtZXRob2QgZGVwZW5kaW5nIG9uIHRoZSBzaGFwZQogICAgICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnNoYXBlKSB7CiAgICAgICAgICBjYXNlICdib3gnOgogICAgICAgICAgICB0aGlzLnNoYXBlID0gbmV3IF9ub2Rlc1NoYXBlc0JveDJbJ2RlZmF1bHQnXSh0aGlzLm9wdGlvbnMsIHRoaXMuYm9keSwgdGhpcy5sYWJlbE1vZHVsZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnY2lyY2xlJzoKICAgICAgICAgICAgdGhpcy5zaGFwZSA9IG5ldyBfbm9kZXNTaGFwZXNDaXJjbGUyWydkZWZhdWx0J10odGhpcy5vcHRpb25zLCB0aGlzLmJvZHksIHRoaXMubGFiZWxNb2R1bGUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ2NpcmN1bGFySW1hZ2UnOgogICAgICAgICAgICB0aGlzLnNoYXBlID0gbmV3IF9ub2Rlc1NoYXBlc0NpcmN1bGFySW1hZ2UyWydkZWZhdWx0J10odGhpcy5vcHRpb25zLCB0aGlzLmJvZHksIHRoaXMubGFiZWxNb2R1bGUsIHRoaXMuaW1hZ2VPYmopOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ2RhdGFiYXNlJzoKICAgICAgICAgICAgdGhpcy5zaGFwZSA9IG5ldyBfbm9kZXNTaGFwZXNEYXRhYmFzZTJbJ2RlZmF1bHQnXSh0aGlzLm9wdGlvbnMsIHRoaXMuYm9keSwgdGhpcy5sYWJlbE1vZHVsZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnZGlhbW9uZCc6CiAgICAgICAgICAgIHRoaXMuc2hhcGUgPSBuZXcgX25vZGVzU2hhcGVzRGlhbW9uZDJbJ2RlZmF1bHQnXSh0aGlzLm9wdGlvbnMsIHRoaXMuYm9keSwgdGhpcy5sYWJlbE1vZHVsZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnZG90JzoKICAgICAgICAgICAgdGhpcy5zaGFwZSA9IG5ldyBfbm9kZXNTaGFwZXNEb3QyWydkZWZhdWx0J10odGhpcy5vcHRpb25zLCB0aGlzLmJvZHksIHRoaXMubGFiZWxNb2R1bGUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ2VsbGlwc2UnOgogICAgICAgICAgICB0aGlzLnNoYXBlID0gbmV3IF9ub2Rlc1NoYXBlc0VsbGlwc2UyWydkZWZhdWx0J10odGhpcy5vcHRpb25zLCB0aGlzLmJvZHksIHRoaXMubGFiZWxNb2R1bGUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ2ljb24nOgogICAgICAgICAgICB0aGlzLnNoYXBlID0gbmV3IF9ub2Rlc1NoYXBlc0ljb24yWydkZWZhdWx0J10odGhpcy5vcHRpb25zLCB0aGlzLmJvZHksIHRoaXMubGFiZWxNb2R1bGUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ2ltYWdlJzoKICAgICAgICAgICAgdGhpcy5zaGFwZSA9IG5ldyBfbm9kZXNTaGFwZXNJbWFnZTJbJ2RlZmF1bHQnXSh0aGlzLm9wdGlvbnMsIHRoaXMuYm9keSwgdGhpcy5sYWJlbE1vZHVsZSwgdGhpcy5pbWFnZU9iaik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnc3F1YXJlJzoKICAgICAgICAgICAgdGhpcy5zaGFwZSA9IG5ldyBfbm9kZXNTaGFwZXNTcXVhcmUyWydkZWZhdWx0J10odGhpcy5vcHRpb25zLCB0aGlzLmJvZHksIHRoaXMubGFiZWxNb2R1bGUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ3N0YXInOgogICAgICAgICAgICB0aGlzLnNoYXBlID0gbmV3IF9ub2Rlc1NoYXBlc1N0YXIyWydkZWZhdWx0J10odGhpcy5vcHRpb25zLCB0aGlzLmJvZHksIHRoaXMubGFiZWxNb2R1bGUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ3RleHQnOgogICAgICAgICAgICB0aGlzLnNoYXBlID0gbmV3IF9ub2Rlc1NoYXBlc1RleHQyWydkZWZhdWx0J10odGhpcy5vcHRpb25zLCB0aGlzLmJvZHksIHRoaXMubGFiZWxNb2R1bGUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJ3RyaWFuZ2xlJzoKICAgICAgICAgICAgdGhpcy5zaGFwZSA9IG5ldyBfbm9kZXNTaGFwZXNUcmlhbmdsZTJbJ2RlZmF1bHQnXSh0aGlzLm9wdGlvbnMsIHRoaXMuYm9keSwgdGhpcy5sYWJlbE1vZHVsZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAndHJpYW5nbGVEb3duJzoKICAgICAgICAgICAgdGhpcy5zaGFwZSA9IG5ldyBfbm9kZXNTaGFwZXNUcmlhbmdsZURvd24yWydkZWZhdWx0J10odGhpcy5vcHRpb25zLCB0aGlzLmJvZHksIHRoaXMubGFiZWxNb2R1bGUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRoaXMuc2hhcGUgPSBuZXcgX25vZGVzU2hhcGVzRWxsaXBzZTJbJ2RlZmF1bHQnXSh0aGlzLm9wdGlvbnMsIHRoaXMuYm9keSwgdGhpcy5sYWJlbE1vZHVsZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0aGlzLl9yZXNldCgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3NlbGVjdCcsCgogICAgICAvKioKICAgICAgICogc2VsZWN0IHRoaXMgbm9kZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNlbGVjdCgpIHsKICAgICAgICB0aGlzLnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLl9yZXNldCgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3Vuc2VsZWN0JywKCiAgICAgIC8qKgogICAgICAgKiB1bnNlbGVjdCB0aGlzIG5vZGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1bnNlbGVjdCgpIHsKICAgICAgICB0aGlzLnNlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5fcmVzZXQoKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfcmVzZXQnLAoKICAgICAgLyoqCiAgICAgICAqIFJlc2V0IHRoZSBjYWxjdWxhdGVkIHNpemUgb2YgdGhlIG5vZGUsIGZvcmNlcyBpdCB0byByZWNhbGN1bGF0ZSBpdHMgc2l6ZQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZXNldCgpIHsKICAgICAgICB0aGlzLnNoYXBlLndpZHRoID0gdW5kZWZpbmVkOwogICAgICAgIHRoaXMuc2hhcGUuaGVpZ2h0ID0gdW5kZWZpbmVkOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2dldFRpdGxlJywKCiAgICAgIC8qKgogICAgICAgKiBnZXQgdGhlIHRpdGxlIG9mIHRoaXMgbm9kZS4KICAgICAgICogQHJldHVybiB7c3RyaW5nfSB0aXRsZSAgICBUaGUgdGl0bGUgb2YgdGhlIG5vZGUsIG9yIHVuZGVmaW5lZCB3aGVuIG5vIHRpdGxlCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzIGJlZW4gc2V0LgogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFRpdGxlKCkgewogICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMudGl0bGU7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZGlzdGFuY2VUb0JvcmRlcicsCgogICAgICAvKioKICAgICAgICogQ2FsY3VsYXRlIHRoZSBkaXN0YW5jZSB0byB0aGUgYm9yZGVyIG9mIHRoZSBOb2RlCiAgICAgICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSAgIGN0eAogICAgICAgKiBAcGFyYW0ge051bWJlcn0gYW5nbGUgICAgICAgIEFuZ2xlIGluIHJhZGlhbnMKICAgICAgICogQHJldHVybnMge251bWJlcn0gZGlzdGFuY2UgICBEaXN0YW5jZSB0byB0aGUgYm9yZGVyIGluIHBpeGVscwogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3RhbmNlVG9Cb3JkZXIoY3R4LCBhbmdsZSkgewogICAgICAgIHJldHVybiB0aGlzLnNoYXBlLmRpc3RhbmNlVG9Cb3JkZXIoY3R4LCBhbmdsZSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnaXNGaXhlZCcsCgogICAgICAvKioKICAgICAgICogQ2hlY2sgaWYgdGhpcyBub2RlIGhhcyBhIGZpeGVkIHggYW5kIHkgcG9zaXRpb24KICAgICAgICogQHJldHVybiB7Ym9vbGVhbn0gICAgICB0cnVlIGlmIGZpeGVkLCBmYWxzZSBpZiBub3QKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBpc0ZpeGVkKCkgewogICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuZml4ZWQueCAmJiB0aGlzLm9wdGlvbnMuZml4ZWQueTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdpc1NlbGVjdGVkJywKCiAgICAgIC8qKgogICAgICAgKiBjaGVjayBpZiB0aGlzIG5vZGUgaXMgc2VsZWN0ZQogICAgICAgKiBAcmV0dXJuIHtib29sZWFufSBzZWxlY3RlZCAgIFRydWUgaWYgbm9kZSBpcyBzZWxlY3RlZCwgZWxzZSBmYWxzZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzU2VsZWN0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZ2V0VmFsdWUnLAoKICAgICAgLyoqCiAgICAgICAqIFJldHJpZXZlIHRoZSB2YWx1ZSBvZiB0aGUgbm9kZS4gQ2FuIGJlIHVuZGVmaW5lZAogICAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IHZhbHVlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy52YWx1ZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzZXRWYWx1ZVJhbmdlJywKCiAgICAgIC8qKgogICAgICAgKiBBZGp1c3QgdGhlIHZhbHVlIHJhbmdlIG9mIHRoZSBub2RlLiBUaGUgbm9kZSB3aWxsIGFkanVzdCBpdCdzIHNpemUKICAgICAgICogYmFzZWQgb24gaXRzIHZhbHVlLgogICAgICAgKiBAcGFyYW0ge051bWJlcn0gbWluCiAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBtYXgKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZVJhbmdlKG1pbiwgbWF4LCB0b3RhbCkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMudmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdmFyIHNjYWxlID0gdGhpcy5vcHRpb25zLnNjYWxpbmcuY3VzdG9tU2NhbGluZ0Z1bmN0aW9uKG1pbiwgbWF4LCB0b3RhbCwgdGhpcy5vcHRpb25zLnZhbHVlKTsKICAgICAgICAgIHZhciBzaXplRGlmZiA9IHRoaXMub3B0aW9ucy5zY2FsaW5nLm1heCAtIHRoaXMub3B0aW9ucy5zY2FsaW5nLm1pbjsKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2NhbGluZy5sYWJlbC5lbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBmb250RGlmZiA9IHRoaXMub3B0aW9ucy5zY2FsaW5nLmxhYmVsLm1heCAtIHRoaXMub3B0aW9ucy5zY2FsaW5nLmxhYmVsLm1pbjsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLmZvbnQuc2l6ZSA9IHRoaXMub3B0aW9ucy5zY2FsaW5nLmxhYmVsLm1pbiArIHNjYWxlICogZm9udERpZmY7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm9wdGlvbnMuc2l6ZSA9IHRoaXMub3B0aW9ucy5zY2FsaW5nLm1pbiArIHNjYWxlICogc2l6ZURpZmY7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMub3B0aW9ucy5zaXplID0gdGhpcy5iYXNlU2l6ZTsKICAgICAgICAgIHRoaXMub3B0aW9ucy5mb250LnNpemUgPSB0aGlzLmJhc2VGb250U2l6ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZHJhdycsCgogICAgICAvKioKICAgICAgICogRHJhdyB0aGlzIG5vZGUgaW4gdGhlIGdpdmVuIGNhbnZhcwogICAgICAgKiBUaGUgMmQgY29udGV4dCBvZiBhIEhUTUwgY2FudmFzIGNhbiBiZSByZXRyaWV2ZWQgYnkgY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSAgIGN0eAogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRyYXcoY3R4KSB7CiAgICAgICAgdGhpcy5zaGFwZS5kcmF3KGN0eCwgdGhpcy54LCB0aGlzLnksIHRoaXMuc2VsZWN0ZWQsIHRoaXMuaG92ZXIpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3VwZGF0ZUJvdW5kaW5nQm94JywKCiAgICAgIC8qKgogICAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIGJveCBvZiB0aGUgc2hhcGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVCb3VuZGluZ0JveCgpIHsKICAgICAgICB0aGlzLnNoYXBlLnVwZGF0ZUJvdW5kaW5nQm94KHRoaXMueCwgdGhpcy55KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdyZXNpemUnLAoKICAgICAgLyoqCiAgICAgICAqIFJlY2FsY3VsYXRlIHRoZSBzaXplIG9mIHRoaXMgbm9kZSBpbiB0aGUgZ2l2ZW4gY2FudmFzCiAgICAgICAqIFRoZSAyZCBjb250ZXh0IG9mIGEgSFRNTCBjYW52YXMgY2FuIGJlIHJldHJpZXZlZCBieSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9ICAgY3R4CiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVzaXplKGN0eCkgewogICAgICAgIHRoaXMuc2hhcGUucmVzaXplKGN0eCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnaXNPdmVybGFwcGluZ1dpdGgnLAoKICAgICAgLyoqCiAgICAgICAqIENoZWNrIGlmIHRoaXMgb2JqZWN0IGlzIG92ZXJsYXBwaW5nIHdpdGggdGhlIHByb3ZpZGVkIG9iamVjdAogICAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqICAgYW4gb2JqZWN0IHdpdGggcGFyYW1ldGVycyBsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20KICAgICAgICogQHJldHVybiB7Ym9vbGVhbn0gICAgIFRydWUgaWYgbG9jYXRpb24gaXMgbG9jYXRlZCBvbiBub2RlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gaXNPdmVybGFwcGluZ1dpdGgob2JqKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2hhcGUubGVmdCA8IG9iai5yaWdodCAmJiB0aGlzLnNoYXBlLmxlZnQgKyB0aGlzLnNoYXBlLndpZHRoID4gb2JqLmxlZnQgJiYgdGhpcy5zaGFwZS50b3AgPCBvYmouYm90dG9tICYmIHRoaXMuc2hhcGUudG9wICsgdGhpcy5zaGFwZS5oZWlnaHQgPiBvYmoudG9wOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2lzQm91bmRpbmdCb3hPdmVybGFwcGluZ1dpdGgnLAoKICAgICAgLyoqCiAgICAgICAqIENoZWNrIGlmIHRoaXMgb2JqZWN0IGlzIG92ZXJsYXBwaW5nIHdpdGggdGhlIHByb3ZpZGVkIG9iamVjdAogICAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqICAgYW4gb2JqZWN0IHdpdGggcGFyYW1ldGVycyBsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20KICAgICAgICogQHJldHVybiB7Ym9vbGVhbn0gICAgIFRydWUgaWYgbG9jYXRpb24gaXMgbG9jYXRlZCBvbiBub2RlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gaXNCb3VuZGluZ0JveE92ZXJsYXBwaW5nV2l0aChvYmopIHsKICAgICAgICByZXR1cm4gdGhpcy5zaGFwZS5ib3VuZGluZ0JveC5sZWZ0IDwgb2JqLnJpZ2h0ICYmIHRoaXMuc2hhcGUuYm91bmRpbmdCb3gucmlnaHQgPiBvYmoubGVmdCAmJiB0aGlzLnNoYXBlLmJvdW5kaW5nQm94LnRvcCA8IG9iai5ib3R0b20gJiYgdGhpcy5zaGFwZS5ib3VuZGluZ0JveC5ib3R0b20gPiBvYmoudG9wOwogICAgICB9CiAgICB9XSwgW3sKICAgICAga2V5OiAncGFyc2VPcHRpb25zJywKCiAgICAgIC8qKgogICAgICAgKiBUaGlzIHByb2Nlc3MgYWxsIHBvc3NpYmxlIHNob3J0aGFuZHMgaW4gdGhlIG5ldyBvcHRpb25zIGFuZCBtYWtlcyBzdXJlIHRoYXQgdGhlIHBhcmVudE9wdGlvbnMgYXJlIGZ1bGx5IGRlZmluZWQuCiAgICAgICAqIFN0YXRpYyBzbyBpdCBjYW4gYWxzbyBiZSB1c2VkIGJ5IHRoZSBoYW5kbGVyLgogICAgICAgKiBAcGFyYW0gcGFyZW50T3B0aW9ucwogICAgICAgKiBAcGFyYW0gbmV3T3B0aW9ucwogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhcnNlT3B0aW9ucyhwYXJlbnRPcHRpb25zLCBuZXdPcHRpb25zKSB7CiAgICAgICAgdmFyIGFsbG93RGVsZXRpb24gPSBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzJdOwoKICAgICAgICB2YXIgZmllbGRzID0gWydjb2xvcicsICdmb250JywgJ2ZpeGVkJywgJ3NoYWRvdyddOwogICAgICAgIHV0aWwuc2VsZWN0aXZlTm90RGVlcEV4dGVuZChmaWVsZHMsIHBhcmVudE9wdGlvbnMsIG5ld09wdGlvbnMsIGFsbG93RGVsZXRpb24pOwoKICAgICAgICAvLyBtZXJnZSB0aGUgc2hhZG93IG9wdGlvbnMgaW50byB0aGUgcGFyZW50LgogICAgICAgIHV0aWwubWVyZ2VPcHRpb25zKHBhcmVudE9wdGlvbnMsIG5ld09wdGlvbnMsICdzaGFkb3cnKTsKCiAgICAgICAgLy8gaW5kaXZpZHVhbCBzaGFwZSBuZXdPcHRpb25zCiAgICAgICAgaWYgKG5ld09wdGlvbnMuY29sb3IgIT09IHVuZGVmaW5lZCAmJiBuZXdPcHRpb25zLmNvbG9yICE9PSBudWxsKSB7CiAgICAgICAgICB2YXIgcGFyc2VkQ29sb3IgPSB1dGlsLnBhcnNlQ29sb3IobmV3T3B0aW9ucy5jb2xvcik7CiAgICAgICAgICB1dGlsLmZpbGxJZkRlZmluZWQocGFyZW50T3B0aW9ucy5jb2xvciwgcGFyc2VkQ29sb3IpOwogICAgICAgIH0gZWxzZSBpZiAoYWxsb3dEZWxldGlvbiA9PT0gdHJ1ZSAmJiBuZXdPcHRpb25zLmNvbG9yID09PSBudWxsKSB7CiAgICAgICAgICBwYXJlbnRPcHRpb25zLmNvbG9yID0gdW5kZWZpbmVkOwogICAgICAgICAgZGVsZXRlIHBhcmVudE9wdGlvbnMuY29sb3I7CiAgICAgICAgfQoKICAgICAgICAvLyBoYW5kbGUgdGhlIGZpeGVkIG9wdGlvbnMKICAgICAgICBpZiAobmV3T3B0aW9ucy5maXhlZCAhPT0gdW5kZWZpbmVkICYmIG5ld09wdGlvbnMuZml4ZWQgIT09IG51bGwpIHsKICAgICAgICAgIGlmICh0eXBlb2YgbmV3T3B0aW9ucy5maXhlZCA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgICAgIHBhcmVudE9wdGlvbnMuZml4ZWQueCA9IG5ld09wdGlvbnMuZml4ZWQ7CiAgICAgICAgICAgIHBhcmVudE9wdGlvbnMuZml4ZWQueSA9IG5ld09wdGlvbnMuZml4ZWQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAobmV3T3B0aW9ucy5maXhlZC54ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIG5ld09wdGlvbnMuZml4ZWQueCA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgICAgICAgcGFyZW50T3B0aW9ucy5maXhlZC54ID0gbmV3T3B0aW9ucy5maXhlZC54OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXdPcHRpb25zLmZpeGVkLnkgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgbmV3T3B0aW9ucy5maXhlZC55ID09PSAnYm9vbGVhbicpIHsKICAgICAgICAgICAgICBwYXJlbnRPcHRpb25zLmZpeGVkLnkgPSBuZXdPcHRpb25zLmZpeGVkLnk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGhhbmRsZSB0aGUgZm9udCBvcHRpb25zCiAgICAgICAgaWYgKG5ld09wdGlvbnMuZm9udCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBfc2hhcmVkTGFiZWwyWydkZWZhdWx0J10ucGFyc2VPcHRpb25zKHBhcmVudE9wdGlvbnMuZm9udCwgbmV3T3B0aW9ucyk7CiAgICAgICAgfQoKICAgICAgICAvLyBoYW5kbGUgdGhlIHNjYWxpbmcgb3B0aW9ucywgc3BlY2lmaWNhbGx5IHRoZSBsYWJlbCBwYXJ0CiAgICAgICAgaWYgKG5ld09wdGlvbnMuc2NhbGluZyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB1dGlsLm1lcmdlT3B0aW9ucyhwYXJlbnRPcHRpb25zLnNjYWxpbmcsIG5ld09wdGlvbnMuc2NhbGluZywgJ2xhYmVsJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIE5vZGU7CiAgfSkoKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gTm9kZTsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDYzICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIGZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IHJldHVybiBhcnI7IH0gZWxzZSBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpKSB7IHZhciBfYXJyID0gW107IHZhciBfbiA9IHRydWU7IHZhciBfZCA9IGZhbHNlOyB2YXIgX2UgPSB1bmRlZmluZWQ7IHRyeSB7IGZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsgX2Fyci5wdXNoKF9zLnZhbHVlKTsgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOyB9IH0gY2F0Y2ggKGVycikgeyBfZCA9IHRydWU7IF9lID0gZXJyOyB9IGZpbmFsbHkgeyB0cnkgeyBpZiAoIV9uICYmIF9pWydyZXR1cm4nXSkgX2lbJ3JldHVybiddKCk7IH0gZmluYWxseSB7IGlmIChfZCkgdGhyb3cgX2U7IH0gfSByZXR1cm4gX2FycjsgfSBlbHNlIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZScpOyB9IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgdmFyIExhYmVsID0gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIExhYmVsKGJvZHksIG9wdGlvbnMpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIExhYmVsKTsKCiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CgogICAgICB0aGlzLnBvaW50VG9TZWxmID0gZmFsc2U7CiAgICAgIHRoaXMuYmFzZVNpemUgPSB1bmRlZmluZWQ7CiAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTsKICAgICAgdGhpcy5zaXplID0geyB0b3A6IDAsIGxlZnQ6IDAsIHdpZHRoOiAwLCBoZWlnaHQ6IDAsIHlMaW5lOiAwIH07IC8vIGNvdWxkIGJlIGNhY2hlZAogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhMYWJlbCwgW3sKICAgICAga2V5OiAnc2V0T3B0aW9ucycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICB2YXIgYWxsb3dEZWxldGlvbiA9IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbMV07CgogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CgogICAgICAgIGlmIChvcHRpb25zLmxhYmVsICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMubGFiZWxEaXJ0eSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5mb250ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIExhYmVsLnBhcnNlT3B0aW9ucyh0aGlzLm9wdGlvbnMuZm9udCwgb3B0aW9ucywgYWxsb3dEZWxldGlvbik7CiAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZm9udCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgdGhpcy5iYXNlU2l6ZSA9IHRoaXMub3B0aW9ucy5mb250LnNpemU7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zLmZvbnQgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmZvbnQuc2l6ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdGhpcy5iYXNlU2l6ZSA9IG9wdGlvbnMuZm9udC5zaXplOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RyYXcnLAoKICAgICAgLyoqCiAgICAgICAqIE1haW4gZnVuY3Rpb24uIFRoaXMgaXMgY2FsbGVkIGZyb20gYW55dGhpbmcgdGhhdCB3YW50cyB0byBkcmF3IGEgbGFiZWwuCiAgICAgICAqIEBwYXJhbSBjdHgKICAgICAgICogQHBhcmFtIHgKICAgICAgICogQHBhcmFtIHkKICAgICAgICogQHBhcmFtIHNlbGVjdGVkCiAgICAgICAqIEBwYXJhbSBiYXNlbGluZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRyYXcoY3R4LCB4LCB5LCBzZWxlY3RlZCkgewogICAgICAgIHZhciBiYXNlbGluZSA9IGFyZ3VtZW50c1s0XSA9PT0gdW5kZWZpbmVkID8gJ21pZGRsZScgOiBhcmd1bWVudHNbNF07CgogICAgICAgIC8vIGlmIG5vIGxhYmVsLCByZXR1cm4KICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxhYmVsID09PSB1bmRlZmluZWQpIHJldHVybjsKCiAgICAgICAgLy8gY2hlY2sgaWYgd2UgaGF2ZSB0byByZW5kZXIgdGhlIGxhYmVsCiAgICAgICAgdmFyIHZpZXdGb250U2l6ZSA9IHRoaXMub3B0aW9ucy5mb250LnNpemUgKiB0aGlzLmJvZHkudmlldy5zY2FsZTsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxhYmVsICYmIHZpZXdGb250U2l6ZSA8IHRoaXMub3B0aW9ucy5zY2FsaW5nLmxhYmVsLmRyYXdUaHJlc2hvbGQgLSAxKSByZXR1cm47CgogICAgICAgIC8vIHVwZGF0ZSB0aGUgc2l6ZSBjYWNoZSBpZiByZXF1aXJlZAogICAgICAgIHRoaXMuY2FsY3VsYXRlTGFiZWxTaXplKGN0eCwgc2VsZWN0ZWQsIHgsIHksIGJhc2VsaW5lKTsKCiAgICAgICAgLy8gY3JlYXRlIHRoZSBmb250ZmlsbCBiYWNrZ3JvdW5kCiAgICAgICAgdGhpcy5fZHJhd0JhY2tncm91bmQoY3R4KTsKICAgICAgICAvLyBkcmF3IHRleHQKICAgICAgICB0aGlzLl9kcmF3VGV4dChjdHgsIHNlbGVjdGVkLCB4LCB5LCBiYXNlbGluZSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2RyYXdCYWNrZ3JvdW5kJywKCiAgICAgIC8qKgogICAgICAgKiBEcmF3cyB0aGUgbGFiZWwgYmFja2dyb3VuZAogICAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2RyYXdCYWNrZ3JvdW5kKGN0eCkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZm9udC5iYWNrZ3JvdW5kICE9PSB1bmRlZmluZWQgJiYgdGhpcy5vcHRpb25zLmZvbnQuYmFja2dyb3VuZCAhPT0gJ25vbmUnKSB7CiAgICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5vcHRpb25zLmZvbnQuYmFja2dyb3VuZDsKCiAgICAgICAgICB2YXIgbGluZU1hcmdpbiA9IDI7CgogICAgICAgICAgc3dpdGNoICh0aGlzLm9wdGlvbnMuZm9udC5hbGlnbikgewogICAgICAgICAgICBjYXNlICdtaWRkbGUnOgogICAgICAgICAgICAgIGN0eC5maWxsUmVjdCgtdGhpcy5zaXplLndpZHRoICogMC41LCAtdGhpcy5zaXplLmhlaWdodCAqIDAuNSwgdGhpcy5zaXplLndpZHRoLCB0aGlzLnNpemUuaGVpZ2h0KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAndG9wJzoKICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoLXRoaXMuc2l6ZS53aWR0aCAqIDAuNSwgLSh0aGlzLnNpemUuaGVpZ2h0ICsgbGluZU1hcmdpbiksIHRoaXMuc2l6ZS53aWR0aCwgdGhpcy5zaXplLmhlaWdodCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6CiAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KC10aGlzLnNpemUud2lkdGggKiAwLjUsIGxpbmVNYXJnaW4sIHRoaXMuc2l6ZS53aWR0aCwgdGhpcy5zaXplLmhlaWdodCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHRoaXMuc2l6ZS5sZWZ0LCB0aGlzLnNpemUudG9wIC0gMC41ICogbGluZU1hcmdpbiwgdGhpcy5zaXplLndpZHRoLCB0aGlzLnNpemUuaGVpZ2h0KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2RyYXdUZXh0JywKCiAgICAgIC8qKgogICAgICAgKgogICAgICAgKiBAcGFyYW0gY3R4CiAgICAgICAqIEBwYXJhbSB4CiAgICAgICAqIEBwYXJhbSBiYXNlbGluZQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kcmF3VGV4dChjdHgsIHNlbGVjdGVkLCB4LCB5KSB7CiAgICAgICAgdmFyIGJhc2VsaW5lID0gYXJndW1lbnRzWzRdID09PSB1bmRlZmluZWQgPyAnbWlkZGxlJyA6IGFyZ3VtZW50c1s0XTsKCiAgICAgICAgdmFyIGZvbnRTaXplID0gdGhpcy5vcHRpb25zLmZvbnQuc2l6ZTsKICAgICAgICB2YXIgdmlld0ZvbnRTaXplID0gZm9udFNpemUgKiB0aGlzLmJvZHkudmlldy5zY2FsZTsKICAgICAgICAvLyB0aGlzIGVuc3VyZXMgdGhhdCB0aGVyZSB3aWxsIG5vdCBiZSBIVUdFIGxldHRlcnMgb24gc2NyZWVuIGJ5IHNldHRpbmcgYW4gdXBwZXIgbGltaXQgb24gdGhlIHZpc2libGUgdGV4dCBzaXplIChyZWdhcmRsZXNzIG9mIHpvb21MZXZlbCkKICAgICAgICBpZiAodmlld0ZvbnRTaXplID49IHRoaXMub3B0aW9ucy5zY2FsaW5nLmxhYmVsLm1heFZpc2libGUpIHsKICAgICAgICAgIGZvbnRTaXplID0gTnVtYmVyKHRoaXMub3B0aW9ucy5zY2FsaW5nLmxhYmVsLm1heFZpc2libGUpIC8gdGhpcy5ib2R5LnZpZXcuc2NhbGU7CiAgICAgICAgfQoKICAgICAgICB2YXIgeUxpbmUgPSB0aGlzLnNpemUueUxpbmU7CgogICAgICAgIHZhciBfZ2V0Q29sb3IyID0gdGhpcy5fZ2V0Q29sb3Iodmlld0ZvbnRTaXplKTsKCiAgICAgICAgdmFyIF9nZXRDb2xvcjIyID0gX3NsaWNlZFRvQXJyYXkoX2dldENvbG9yMiwgMik7CgogICAgICAgIHZhciBmb250Q29sb3IgPSBfZ2V0Q29sb3IyMlswXTsKICAgICAgICB2YXIgc3Ryb2tlQ29sb3IgPSBfZ2V0Q29sb3IyMlsxXTsKCiAgICAgICAgdmFyIF9zZXRBbGlnbm1lbnQyID0gdGhpcy5fc2V0QWxpZ25tZW50KGN0eCwgeCwgeUxpbmUsIGJhc2VsaW5lKTsKCiAgICAgICAgdmFyIF9zZXRBbGlnbm1lbnQyMiA9IF9zbGljZWRUb0FycmF5KF9zZXRBbGlnbm1lbnQyLCAyKTsKCiAgICAgICAgeCA9IF9zZXRBbGlnbm1lbnQyMlswXTsKICAgICAgICB5TGluZSA9IF9zZXRBbGlnbm1lbnQyMlsxXTsKCiAgICAgICAgLy8gY29uZmlndXJlIGNvbnRleHQgZm9yIGRyYXdpbmcgdGhlIHRleHQKICAgICAgICBjdHguZm9udCA9IChzZWxlY3RlZCA/ICdib2xkICcgOiAnJykgKyBmb250U2l6ZSArICdweCAnICsgdGhpcy5vcHRpb25zLmZvbnQuZmFjZTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gZm9udENvbG9yOwogICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsKCiAgICAgICAgLy8gc2V0IHRoZSBzdHJva2VXaWR0aAogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZm9udC5zdHJva2VXaWR0aCA+IDApIHsKICAgICAgICAgIGN0eC5saW5lV2lkdGggPSB0aGlzLm9wdGlvbnMuZm9udC5zdHJva2VXaWR0aDsKICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHN0cm9rZUNvbG9yOwogICAgICAgICAgY3R4LmxpbmVKb2luID0gJ3JvdW5kJzsKICAgICAgICB9CgogICAgICAgIC8vIGRyYXcgdGhlIHRleHQKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGluZUNvdW50OyBpKyspIHsKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZm9udC5zdHJva2VXaWR0aCA+IDApIHsKICAgICAgICAgICAgY3R4LnN0cm9rZVRleHQodGhpcy5saW5lc1tpXSwgeCwgeUxpbmUpOwogICAgICAgICAgfQogICAgICAgICAgY3R4LmZpbGxUZXh0KHRoaXMubGluZXNbaV0sIHgsIHlMaW5lKTsKICAgICAgICAgIHlMaW5lICs9IGZvbnRTaXplOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfc2V0QWxpZ25tZW50JywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXRBbGlnbm1lbnQoY3R4LCB4LCB5TGluZSwgYmFzZWxpbmUpIHsKICAgICAgICAvLyBjaGVjayBmb3IgbGFiZWwgYWxpZ25tZW50IChmb3IgZWRnZXMpCiAgICAgICAgLy8gVE9ETzogbWFrZSBhbGlnbm1lbnQgZm9yIG5vZGVzCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5mb250LmFsaWduICE9PSAnaG9yaXpvbnRhbCcgJiYgdGhpcy5wb2ludFRvU2VsZiA9PT0gZmFsc2UpIHsKICAgICAgICAgIHggPSAwOwogICAgICAgICAgeUxpbmUgPSAwOwoKICAgICAgICAgIHZhciBsaW5lTWFyZ2luID0gMjsKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZm9udC5hbGlnbiA9PT0gJ3RvcCcpIHsKICAgICAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdhbHBoYWJldGljJzsKICAgICAgICAgICAgeUxpbmUgLT0gMiAqIGxpbmVNYXJnaW47IC8vIGRpc3RhbmNlIGZyb20gZWRnZSwgcmVxdWlyZWQgYmVjYXVzZSB3ZSB1c2UgYWxwaGFiZXRpYy4gQWxwaGFiZXRpYyBoYXMgbGVzcyBkaWZmZXJlbmNlIGJldHdlZW4gYnJvd3NlcnMKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLmZvbnQuYWxpZ24gPT09ICdib3R0b20nKSB7CiAgICAgICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnaGFuZ2luZyc7CiAgICAgICAgICAgIHlMaW5lICs9IDIgKiBsaW5lTWFyZ2luOyAvLyBkaXN0YW5jZSBmcm9tIGVkZ2UsIHJlcXVpcmVkIGJlY2F1c2Ugd2UgdXNlIGhhbmdpbmcuIEhhbmdpbmcgaGFzIGxlc3MgZGlmZmVyZW5jZSBiZXR3ZWVuIGJyb3dzZXJzCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSBiYXNlbGluZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBbeCwgeUxpbmVdOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19nZXRDb2xvcicsCgogICAgICAvKioKICAgICAgICogZmFkZSBpbiB3aGVuIHJlbGF0aXZlIHNjYWxlIGlzIGJldHdlZW4gdGhyZXNob2xkIGFuZCB0aHJlc2hvbGQgLSAxLgogICAgICAgKiBJZiB0aGUgcmVsYXRpdmUgc2NhbGUgd291bGQgYmUgc21hbGxlciB0aGFuIHRocmVzaG9sZCAtMSB0aGUgZHJhdyBmdW5jdGlvbiB3b3VsZCBoYXZlIHJldHVybmVkIGJlZm9yZSBjb21pbmcgaGVyZS4KICAgICAgICoKICAgICAgICogQHBhcmFtIHZpZXdGb250U2l6ZQogICAgICAgKiBAcmV0dXJucyB7KltdfQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRDb2xvcih2aWV3Rm9udFNpemUpIHsKICAgICAgICB2YXIgZm9udENvbG9yID0gdGhpcy5vcHRpb25zLmZvbnQuY29sb3IgfHwgJyMwMDAwMDAnOwogICAgICAgIHZhciBzdHJva2VDb2xvciA9IHRoaXMub3B0aW9ucy5mb250LnN0cm9rZUNvbG9yIHx8ICcjZmZmZmZmJzsKICAgICAgICBpZiAodmlld0ZvbnRTaXplIDw9IHRoaXMub3B0aW9ucy5zY2FsaW5nLmxhYmVsLmRyYXdUaHJlc2hvbGQpIHsKICAgICAgICAgIHZhciBvcGFjaXR5ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgMSAtICh0aGlzLm9wdGlvbnMuc2NhbGluZy5sYWJlbC5kcmF3VGhyZXNob2xkIC0gdmlld0ZvbnRTaXplKSkpOwogICAgICAgICAgZm9udENvbG9yID0gdXRpbC5vdmVycmlkZU9wYWNpdHkoZm9udENvbG9yLCBvcGFjaXR5KTsKICAgICAgICAgIHN0cm9rZUNvbG9yID0gdXRpbC5vdmVycmlkZU9wYWNpdHkoc3Ryb2tlQ29sb3IsIG9wYWNpdHkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gW2ZvbnRDb2xvciwgc3Ryb2tlQ29sb3JdOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2dldFRleHRTaXplJywKCiAgICAgIC8qKgogICAgICAgKgogICAgICAgKiBAcGFyYW0gY3R4CiAgICAgICAqIEBwYXJhbSBzZWxlY3RlZAogICAgICAgKiBAcmV0dXJucyB7e3dpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyfX0KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRUZXh0U2l6ZShjdHgpIHsKICAgICAgICB2YXIgc2VsZWN0ZWQgPSBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzFdOwoKICAgICAgICB2YXIgc2l6ZSA9IHsKICAgICAgICAgIHdpZHRoOiB0aGlzLl9wcm9jZXNzTGFiZWwoY3R4LCBzZWxlY3RlZCksCiAgICAgICAgICBoZWlnaHQ6IHRoaXMub3B0aW9ucy5mb250LnNpemUgKiB0aGlzLmxpbmVDb3VudCwKICAgICAgICAgIGxpbmVDb3VudDogdGhpcy5saW5lQ291bnQKICAgICAgICB9OwogICAgICAgIHJldHVybiBzaXplOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2NhbGN1bGF0ZUxhYmVsU2l6ZScsCgogICAgICAvKioKICAgICAgICoKICAgICAgICogQHBhcmFtIGN0eAogICAgICAgKiBAcGFyYW0gc2VsZWN0ZWQKICAgICAgICogQHBhcmFtIHgKICAgICAgICogQHBhcmFtIHkKICAgICAgICogQHBhcmFtIGJhc2VsaW5lCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gY2FsY3VsYXRlTGFiZWxTaXplKGN0eCwgc2VsZWN0ZWQpIHsKICAgICAgICB2YXIgeCA9IGFyZ3VtZW50c1syXSA9PT0gdW5kZWZpbmVkID8gMCA6IGFyZ3VtZW50c1syXTsKICAgICAgICB2YXIgeSA9IGFyZ3VtZW50c1szXSA9PT0gdW5kZWZpbmVkID8gMCA6IGFyZ3VtZW50c1szXTsKICAgICAgICB2YXIgYmFzZWxpbmUgPSBhcmd1bWVudHNbNF0gPT09IHVuZGVmaW5lZCA/ICdtaWRkbGUnIDogYXJndW1lbnRzWzRdOwoKICAgICAgICBpZiAodGhpcy5sYWJlbERpcnR5ID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLnNpemUud2lkdGggPSB0aGlzLl9wcm9jZXNzTGFiZWwoY3R4LCBzZWxlY3RlZCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuc2l6ZS5oZWlnaHQgPSB0aGlzLm9wdGlvbnMuZm9udC5zaXplICogdGhpcy5saW5lQ291bnQ7CiAgICAgICAgdGhpcy5zaXplLmxlZnQgPSB4IC0gdGhpcy5zaXplLndpZHRoICogMC41OwogICAgICAgIHRoaXMuc2l6ZS50b3AgPSB5IC0gdGhpcy5zaXplLmhlaWdodCAqIDAuNTsKICAgICAgICB0aGlzLnNpemUueUxpbmUgPSB5ICsgKDEgLSB0aGlzLmxpbmVDb3VudCkgKiAwLjUgKiB0aGlzLm9wdGlvbnMuZm9udC5zaXplOwogICAgICAgIGlmIChiYXNlbGluZSA9PT0gJ2hhbmdpbmcnKSB7CiAgICAgICAgICB0aGlzLnNpemUudG9wICs9IDAuNSAqIHRoaXMub3B0aW9ucy5mb250LnNpemU7CiAgICAgICAgICB0aGlzLnNpemUudG9wICs9IDQ7IC8vIGRpc3RhbmNlIGZyb20gbm9kZSwgcmVxdWlyZWQgYmVjYXVzZSB3ZSB1c2UgaGFuZ2luZy4gSGFuZ2luZyBoYXMgbGVzcyBkaWZmZXJlbmNlIGJldHdlZW4gYnJvd3NlcnMKICAgICAgICAgIHRoaXMuc2l6ZS55TGluZSArPSA0OyAvLyBkaXN0YW5jZSBmcm9tIG5vZGUKICAgICAgICB9CgogICAgICAgIHRoaXMubGFiZWxEaXJ0eSA9IGZhbHNlOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19wcm9jZXNzTGFiZWwnLAoKICAgICAgLyoqCiAgICAgICAqIFRoaXMgY2FsY3VsYXRlcyB0aGUgd2lkdGggYXMgd2VsbCBhcyBleHBsb2RlcyB0aGUgbGFiZWwgc3RyaW5nIGFuZCBjYWxjdWxhdGVzIHRoZSBhbW91bnQgb2YgbGluZXMuCiAgICAgICAqIEBwYXJhbSBjdHgKICAgICAgICogQHBhcmFtIHNlbGVjdGVkCiAgICAgICAqIEByZXR1cm5zIHtudW1iZXJ9CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3Byb2Nlc3NMYWJlbChjdHgsIHNlbGVjdGVkKSB7CiAgICAgICAgdmFyIHdpZHRoID0gMDsKICAgICAgICB2YXIgbGluZXMgPSBbJyddOwogICAgICAgIHZhciBsaW5lQ291bnQgPSAwOwogICAgICAgIGlmICh0aGlzLm9wdGlvbnMubGFiZWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgbGluZXMgPSBTdHJpbmcodGhpcy5vcHRpb25zLmxhYmVsKS5zcGxpdCgnXG4nKTsKICAgICAgICAgIGxpbmVDb3VudCA9IGxpbmVzLmxlbmd0aDsKICAgICAgICAgIGN0eC5mb250ID0gKHNlbGVjdGVkID8gJ2JvbGQgJyA6ICcnKSArIHRoaXMub3B0aW9ucy5mb250LnNpemUgKyAncHggJyArIHRoaXMub3B0aW9ucy5mb250LmZhY2U7CiAgICAgICAgICB3aWR0aCA9IGN0eC5tZWFzdXJlVGV4dChsaW5lc1swXSkud2lkdGg7CiAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGxpbmVDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBsaW5lV2lkdGggPSBjdHgubWVhc3VyZVRleHQobGluZXNbaV0pLndpZHRoOwogICAgICAgICAgICB3aWR0aCA9IGxpbmVXaWR0aCA+IHdpZHRoID8gbGluZVdpZHRoIDogd2lkdGg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMubGluZXMgPSBsaW5lczsKICAgICAgICB0aGlzLmxpbmVDb3VudCA9IGxpbmVDb3VudDsKCiAgICAgICAgcmV0dXJuIHdpZHRoOwogICAgICB9CiAgICB9XSwgW3sKICAgICAga2V5OiAncGFyc2VPcHRpb25zJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhcnNlT3B0aW9ucyhwYXJlbnRPcHRpb25zLCBuZXdPcHRpb25zKSB7CiAgICAgICAgdmFyIGFsbG93RGVsZXRpb24gPSBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzJdOwoKICAgICAgICBpZiAodHlwZW9mIG5ld09wdGlvbnMuZm9udCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIHZhciBuZXdPcHRpb25zQXJyYXkgPSBuZXdPcHRpb25zLmZvbnQuc3BsaXQoJyAnKTsKICAgICAgICAgIHBhcmVudE9wdGlvbnMuc2l6ZSA9IG5ld09wdGlvbnNBcnJheVswXS5yZXBsYWNlKCdweCcsICcnKTsKICAgICAgICAgIHBhcmVudE9wdGlvbnMuZmFjZSA9IG5ld09wdGlvbnNBcnJheVsxXTsKICAgICAgICAgIHBhcmVudE9wdGlvbnMuY29sb3IgPSBuZXdPcHRpb25zQXJyYXlbMl07CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbmV3T3B0aW9ucy5mb250ID09PSAnb2JqZWN0JykgewogICAgICAgICAgdXRpbC5maWxsSWZEZWZpbmVkKHBhcmVudE9wdGlvbnMsIG5ld09wdGlvbnMuZm9udCwgYWxsb3dEZWxldGlvbik7CiAgICAgICAgfQogICAgICAgIHBhcmVudE9wdGlvbnMuc2l6ZSA9IE51bWJlcihwYXJlbnRPcHRpb25zLnNpemUpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIExhYmVsOwogIH0pKCk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IExhYmVsOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogNjQgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKICB2YXIgX3V0aWxOb2RlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjUpOwoKICB2YXIgX3V0aWxOb2RlQmFzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsTm9kZUJhc2UpOwoKICB2YXIgQm94ID0gKGZ1bmN0aW9uIChfTm9kZUJhc2UpIHsKICAgIGZ1bmN0aW9uIEJveChvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQm94KTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKEJveC5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKTsKICAgIH0KCiAgICBfaW5oZXJpdHMoQm94LCBfTm9kZUJhc2UpOwoKICAgIF9jcmVhdGVDbGFzcyhCb3gsIFt7CiAgICAgIGtleTogJ3Jlc2l6ZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXNpemUoY3R4LCBzZWxlY3RlZCkgewogICAgICAgIGlmICh0aGlzLndpZHRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBtYXJnaW4gPSA1OwogICAgICAgICAgdmFyIHRleHRTaXplID0gdGhpcy5sYWJlbE1vZHVsZS5nZXRUZXh0U2l6ZShjdHgsIHNlbGVjdGVkKTsKICAgICAgICAgIHRoaXMud2lkdGggPSB0ZXh0U2l6ZS53aWR0aCArIDIgKiBtYXJnaW47CiAgICAgICAgICB0aGlzLmhlaWdodCA9IHRleHRTaXplLmhlaWdodCArIDIgKiBtYXJnaW47CiAgICAgICAgICB0aGlzLnJhZGl1cyA9IDAuNSAqIHRoaXMud2lkdGg7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RyYXcnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZHJhdyhjdHgsIHgsIHksIHNlbGVjdGVkLCBob3ZlcikgewogICAgICAgIHRoaXMucmVzaXplKGN0eCwgc2VsZWN0ZWQpOwogICAgICAgIHRoaXMubGVmdCA9IHggLSB0aGlzLndpZHRoIC8gMjsKICAgICAgICB0aGlzLnRvcCA9IHkgLSB0aGlzLmhlaWdodCAvIDI7CgogICAgICAgIHZhciBib3JkZXJXaWR0aCA9IHRoaXMub3B0aW9ucy5ib3JkZXJXaWR0aDsKICAgICAgICB2YXIgc2VsZWN0aW9uTGluZVdpZHRoID0gdGhpcy5vcHRpb25zLmJvcmRlcldpZHRoU2VsZWN0ZWQgfHwgMiAqIHRoaXMub3B0aW9ucy5ib3JkZXJXaWR0aDsKCiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gc2VsZWN0ZWQgPyB0aGlzLm9wdGlvbnMuY29sb3IuaGlnaGxpZ2h0LmJvcmRlciA6IGhvdmVyID8gdGhpcy5vcHRpb25zLmNvbG9yLmhvdmVyLmJvcmRlciA6IHRoaXMub3B0aW9ucy5jb2xvci5ib3JkZXI7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IHNlbGVjdGVkID8gc2VsZWN0aW9uTGluZVdpZHRoIDogYm9yZGVyV2lkdGg7CiAgICAgICAgY3R4LmxpbmVXaWR0aCAvPSB0aGlzLmJvZHkudmlldy5zY2FsZTsKICAgICAgICBjdHgubGluZVdpZHRoID0gTWF0aC5taW4odGhpcy53aWR0aCwgY3R4LmxpbmVXaWR0aCk7CgogICAgICAgIGN0eC5maWxsU3R5bGUgPSBzZWxlY3RlZCA/IHRoaXMub3B0aW9ucy5jb2xvci5oaWdobGlnaHQuYmFja2dyb3VuZCA6IGhvdmVyID8gdGhpcy5vcHRpb25zLmNvbG9yLmhvdmVyLmJhY2tncm91bmQgOiB0aGlzLm9wdGlvbnMuY29sb3IuYmFja2dyb3VuZDsKCiAgICAgICAgdmFyIGJvcmRlclJhZGl1cyA9IDY7CiAgICAgICAgY3R4LnJvdW5kUmVjdCh0aGlzLmxlZnQsIHRoaXMudG9wLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgYm9yZGVyUmFkaXVzKTsKCiAgICAgICAgLy8gZHJhdyBzaGFkb3cgaWYgZW5hYmxlZAogICAgICAgIHRoaXMuZW5hYmxlU2hhZG93KGN0eCk7CiAgICAgICAgY3R4LmZpbGwoKTsKCiAgICAgICAgLy8gZGlzYWJsZSBzaGFkb3dzIGZvciBvdGhlciBlbGVtZW50cy4KICAgICAgICB0aGlzLmRpc2FibGVTaGFkb3coY3R4KTsKCiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nQm94KHgsIHkpOwogICAgICAgIHRoaXMubGFiZWxNb2R1bGUuZHJhdyhjdHgsIHgsIHksIHNlbGVjdGVkKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICd1cGRhdGVCb3VuZGluZ0JveCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVCb3VuZGluZ0JveCh4LCB5KSB7CiAgICAgICAgdGhpcy5sZWZ0ID0geCAtIHRoaXMud2lkdGggKiAwLjU7CiAgICAgICAgdGhpcy50b3AgPSB5IC0gdGhpcy5oZWlnaHQgKiAwLjU7CgogICAgICAgIHRoaXMuYm91bmRpbmdCb3gubGVmdCA9IHRoaXMubGVmdDsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnRvcCA9IHRoaXMudG9wOwogICAgICAgIHRoaXMuYm91bmRpbmdCb3guYm90dG9tID0gdGhpcy50b3AgKyB0aGlzLmhlaWdodDsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnJpZ2h0ID0gdGhpcy5sZWZ0ICsgdGhpcy53aWR0aDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdkaXN0YW5jZVRvQm9yZGVyJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3RhbmNlVG9Cb3JkZXIoY3R4LCBhbmdsZSkgewogICAgICAgIHRoaXMucmVzaXplKGN0eCk7CiAgICAgICAgdmFyIGEgPSB0aGlzLndpZHRoIC8gMjsKICAgICAgICB2YXIgYiA9IHRoaXMuaGVpZ2h0IC8gMjsKICAgICAgICB2YXIgdyA9IE1hdGguc2luKGFuZ2xlKSAqIGE7CiAgICAgICAgdmFyIGggPSBNYXRoLmNvcyhhbmdsZSkgKiBiOwogICAgICAgIHJldHVybiBhICogYiAvIE1hdGguc3FydCh3ICogdyArIGggKiBoKTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBCb3g7CiAgfSkoX3V0aWxOb2RlQmFzZTJbJ2RlZmF1bHQnXSk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IEJveDsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDY1ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKICB2YXIgTm9kZUJhc2UgPSAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gTm9kZUJhc2Uob3B0aW9ucywgYm9keSwgbGFiZWxNb2R1bGUpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE5vZGVCYXNlKTsKCiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMubGFiZWxNb2R1bGUgPSBsYWJlbE1vZHVsZTsKICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpOwogICAgICB0aGlzLnRvcCA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy5sZWZ0ID0gdW5kZWZpbmVkOwogICAgICB0aGlzLmhlaWdodCA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy53aWR0aCA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy5yYWRpdXMgPSB1bmRlZmluZWQ7CiAgICAgIHRoaXMuYm91bmRpbmdCb3ggPSB7IHRvcDogMCwgbGVmdDogMCwgcmlnaHQ6IDAsIGJvdHRvbTogMCB9OwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhOb2RlQmFzZSwgW3sKICAgICAga2V5OiAnc2V0T3B0aW9ucycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19kaXN0YW5jZVRvQm9yZGVyJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kaXN0YW5jZVRvQm9yZGVyKGFuZ2xlKSB7CiAgICAgICAgdmFyIGJvcmRlcldpZHRoID0gMTsKICAgICAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5hYnModGhpcy53aWR0aCAvIDIgLyBNYXRoLmNvcyhhbmdsZSkpLCBNYXRoLmFicyh0aGlzLmhlaWdodCAvIDIgLyBNYXRoLnNpbihhbmdsZSkpKSArIGJvcmRlcldpZHRoOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2VuYWJsZVNoYWRvdycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGVTaGFkb3coY3R4KSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zaGFkb3cuZW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gJ3JnYmEoMCwwLDAsMC41KSc7CiAgICAgICAgICBjdHguc2hhZG93Qmx1ciA9IHRoaXMub3B0aW9ucy5zaGFkb3cuc2l6ZTsKICAgICAgICAgIGN0eC5zaGFkb3dPZmZzZXRYID0gdGhpcy5vcHRpb25zLnNoYWRvdy54OwogICAgICAgICAgY3R4LnNoYWRvd09mZnNldFkgPSB0aGlzLm9wdGlvbnMuc2hhZG93Lnk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2Rpc2FibGVTaGFkb3cnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzYWJsZVNoYWRvdyhjdHgpIHsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNoYWRvdy5lbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgICBjdHguc2hhZG93Q29sb3IgPSAncmdiYSgwLDAsMCwwKSc7CiAgICAgICAgICBjdHguc2hhZG93Qmx1ciA9IDA7CiAgICAgICAgICBjdHguc2hhZG93T2Zmc2V0WCA9IDA7CiAgICAgICAgICBjdHguc2hhZG93T2Zmc2V0WSA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIE5vZGVCYXNlOwogIH0pKCk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IE5vZGVCYXNlOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogNjYgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKICB2YXIgX3V0aWxDaXJjbGVJbWFnZUJhc2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY3KTsKCiAgdmFyIF91dGlsQ2lyY2xlSW1hZ2VCYXNlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3V0aWxDaXJjbGVJbWFnZUJhc2UpOwoKICB2YXIgQ2lyY2xlID0gKGZ1bmN0aW9uIChfQ2lyY2xlSW1hZ2VCYXNlKSB7CiAgICBmdW5jdGlvbiBDaXJjbGUob3B0aW9ucywgYm9keSwgbGFiZWxNb2R1bGUpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENpcmNsZSk7CgogICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihDaXJjbGUucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7CiAgICB9CgogICAgX2luaGVyaXRzKENpcmNsZSwgX0NpcmNsZUltYWdlQmFzZSk7CgogICAgX2NyZWF0ZUNsYXNzKENpcmNsZSwgW3sKICAgICAga2V5OiAncmVzaXplJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2l6ZShjdHgsIHNlbGVjdGVkKSB7CiAgICAgICAgaWYgKHRoaXMud2lkdGggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdmFyIG1hcmdpbiA9IDU7CiAgICAgICAgICB2YXIgdGV4dFNpemUgPSB0aGlzLmxhYmVsTW9kdWxlLmdldFRleHRTaXplKGN0eCwgc2VsZWN0ZWQpOwogICAgICAgICAgdmFyIGRpYW1ldGVyID0gTWF0aC5tYXgodGV4dFNpemUud2lkdGgsIHRleHRTaXplLmhlaWdodCkgKyAyICogbWFyZ2luOwogICAgICAgICAgdGhpcy5vcHRpb25zLnNpemUgPSBkaWFtZXRlciAvIDI7CgogICAgICAgICAgdGhpcy53aWR0aCA9IGRpYW1ldGVyOwogICAgICAgICAgdGhpcy5oZWlnaHQgPSBkaWFtZXRlcjsKICAgICAgICAgIHRoaXMucmFkaXVzID0gMC41ICogdGhpcy53aWR0aDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZHJhdycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KGN0eCwgeCwgeSwgc2VsZWN0ZWQsIGhvdmVyKSB7CiAgICAgICAgdGhpcy5yZXNpemUoY3R4LCBzZWxlY3RlZCk7CiAgICAgICAgdGhpcy5sZWZ0ID0geCAtIHRoaXMud2lkdGggLyAyOwogICAgICAgIHRoaXMudG9wID0geSAtIHRoaXMuaGVpZ2h0IC8gMjsKCiAgICAgICAgdGhpcy5fZHJhd1Jhd0NpcmNsZShjdHgsIHgsIHksIHNlbGVjdGVkLCBob3ZlciwgdGhpcy5vcHRpb25zLnNpemUpOwoKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnRvcCA9IHkgLSB0aGlzLm9wdGlvbnMuc2l6ZTsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmxlZnQgPSB4IC0gdGhpcy5vcHRpb25zLnNpemU7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5yaWdodCA9IHggKyB0aGlzLm9wdGlvbnMuc2l6ZTsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmJvdHRvbSA9IHkgKyB0aGlzLm9wdGlvbnMuc2l6ZTsKCiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ0JveCh4LCB5KTsKICAgICAgICB0aGlzLmxhYmVsTW9kdWxlLmRyYXcoY3R4LCB4LCB5LCBzZWxlY3RlZCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAndXBkYXRlQm91bmRpbmdCb3gnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlQm91bmRpbmdCb3goeCwgeSkgewogICAgICAgIHRoaXMuYm91bmRpbmdCb3gudG9wID0geSAtIHRoaXMub3B0aW9ucy5zaXplOwogICAgICAgIHRoaXMuYm91bmRpbmdCb3gubGVmdCA9IHggLSB0aGlzLm9wdGlvbnMuc2l6ZTsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnJpZ2h0ID0geCArIHRoaXMub3B0aW9ucy5zaXplOwogICAgICAgIHRoaXMuYm91bmRpbmdCb3guYm90dG9tID0geSArIHRoaXMub3B0aW9ucy5zaXplOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2Rpc3RhbmNlVG9Cb3JkZXInLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzdGFuY2VUb0JvcmRlcihjdHgsIGFuZ2xlKSB7CiAgICAgICAgdGhpcy5yZXNpemUoY3R4KTsKICAgICAgICB2YXIgYSA9IHRoaXMud2lkdGggLyAyOwogICAgICAgIHZhciBiID0gdGhpcy5oZWlnaHQgLyAyOwogICAgICAgIHZhciB3ID0gTWF0aC5zaW4oYW5nbGUpICogYTsKICAgICAgICB2YXIgaCA9IE1hdGguY29zKGFuZ2xlKSAqIGI7CiAgICAgICAgcmV0dXJuIGEgKiBiIC8gTWF0aC5zcXJ0KHcgKiB3ICsgaCAqIGgpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIENpcmNsZTsKICB9KShfdXRpbENpcmNsZUltYWdlQmFzZTJbJ2RlZmF1bHQnXSk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IENpcmNsZTsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDY3ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIHZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyBfeCA9IHBhcmVudDsgX3gyID0gcHJvcGVydHk7IF94MyA9IHJlY2VpdmVyOyBfYWdhaW4gPSB0cnVlOyBjb250aW51ZSBfZnVuY3Rpb247IH0gfSBlbHNlIGlmICgndmFsdWUnIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCiAgdmFyIF91dGlsTm9kZUJhc2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY1KTsKCiAgdmFyIF91dGlsTm9kZUJhc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbE5vZGVCYXNlKTsKCiAgdmFyIENpcmNsZUltYWdlQmFzZSA9IChmdW5jdGlvbiAoX05vZGVCYXNlKSB7CiAgICBmdW5jdGlvbiBDaXJjbGVJbWFnZUJhc2Uob3B0aW9ucywgYm9keSwgbGFiZWxNb2R1bGUpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENpcmNsZUltYWdlQmFzZSk7CgogICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihDaXJjbGVJbWFnZUJhc2UucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7CiAgICAgIHRoaXMubGFiZWxPZmZzZXQgPSAwOwogICAgICB0aGlzLmltYWdlTG9hZGVkID0gZmFsc2U7CiAgICB9CgogICAgX2luaGVyaXRzKENpcmNsZUltYWdlQmFzZSwgX05vZGVCYXNlKTsKCiAgICBfY3JlYXRlQ2xhc3MoQ2lyY2xlSW1hZ2VCYXNlLCBbewogICAgICBrZXk6ICdfcmVzaXplSW1hZ2UnLAoKICAgICAgLyoqCiAgICAgICAqIFRoaXMgZnVuY3Rpb24gcmVzaXplcyB0aGUgaW1hZ2UgYnkgdGhlIG9wdGlvbnMgc2l6ZSB3aGVuIHRoZSBpbWFnZSBoYXMgbm90IHlldCBsb2FkZWQuIElmIHRoZSBpbWFnZSBoYXMgbG9hZGVkLCB3ZQogICAgICAgKiBmb3JjZSB0aGUgdXBkYXRlIG9mIHRoZSBzaXplIGFnYWluLgogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZXNpemVJbWFnZSgpIHsKICAgICAgICB2YXIgZm9yY2UgPSBmYWxzZTsKICAgICAgICBpZiAoIXRoaXMuaW1hZ2VPYmoud2lkdGggfHwgIXRoaXMuaW1hZ2VPYmouaGVpZ2h0KSB7CiAgICAgICAgICAvLyB1bmRlZmluZWQgb3IgMAogICAgICAgICAgdGhpcy5pbWFnZUxvYWRlZCA9IGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy5pbWFnZUxvYWRlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgIHRoaXMuaW1hZ2VMb2FkZWQgPSB0cnVlOwogICAgICAgICAgZm9yY2UgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0aGlzLndpZHRoIHx8ICF0aGlzLmhlaWdodCB8fCBmb3JjZSA9PT0gdHJ1ZSkgewogICAgICAgICAgLy8gdW5kZWZpbmVkIG9yIDAKICAgICAgICAgIHZhciB3aWR0aCwgaGVpZ2h0LCByYXRpbzsKICAgICAgICAgIGlmICh0aGlzLmltYWdlT2JqLndpZHRoICYmIHRoaXMuaW1hZ2VPYmouaGVpZ2h0KSB7CiAgICAgICAgICAgIC8vIG5vdCB1bmRlZmluZWQgb3IgMAogICAgICAgICAgICB3aWR0aCA9IDA7CiAgICAgICAgICAgIGhlaWdodCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5pbWFnZU9iai53aWR0aCA+IHRoaXMuaW1hZ2VPYmouaGVpZ2h0KSB7CiAgICAgICAgICAgIHJhdGlvID0gdGhpcy5pbWFnZU9iai53aWR0aCAvIHRoaXMuaW1hZ2VPYmouaGVpZ2h0OwogICAgICAgICAgICB3aWR0aCA9IHRoaXMub3B0aW9ucy5zaXplICogMiAqIHJhdGlvIHx8IHRoaXMuaW1hZ2VPYmoud2lkdGg7CiAgICAgICAgICAgIGhlaWdodCA9IHRoaXMub3B0aW9ucy5zaXplICogMiB8fCB0aGlzLmltYWdlT2JqLmhlaWdodDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0aGlzLmltYWdlT2JqLndpZHRoICYmIHRoaXMuaW1hZ2VPYmouaGVpZ2h0KSB7CiAgICAgICAgICAgICAgLy8gbm90IHVuZGVmaW5lZCBvciAwCiAgICAgICAgICAgICAgcmF0aW8gPSB0aGlzLmltYWdlT2JqLmhlaWdodCAvIHRoaXMuaW1hZ2VPYmoud2lkdGg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmF0aW8gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdpZHRoID0gdGhpcy5vcHRpb25zLnNpemUgKiAyIHx8IHRoaXMuaW1hZ2VPYmoud2lkdGg7CiAgICAgICAgICAgIGhlaWdodCA9IHRoaXMub3B0aW9ucy5zaXplICogMiAqIHJhdGlvIHx8IHRoaXMuaW1hZ2VPYmouaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICB0aGlzLnJhZGl1cyA9IDAuNSAqIHRoaXMud2lkdGg7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19kcmF3UmF3Q2lyY2xlJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kcmF3UmF3Q2lyY2xlKGN0eCwgeCwgeSwgc2VsZWN0ZWQsIGhvdmVyLCBzaXplKSB7CiAgICAgICAgdmFyIGJvcmRlcldpZHRoID0gdGhpcy5vcHRpb25zLmJvcmRlcldpZHRoOwogICAgICAgIHZhciBzZWxlY3Rpb25MaW5lV2lkdGggPSB0aGlzLm9wdGlvbnMuYm9yZGVyV2lkdGhTZWxlY3RlZCB8fCAyICogdGhpcy5vcHRpb25zLmJvcmRlcldpZHRoOwoKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBzZWxlY3RlZCA/IHRoaXMub3B0aW9ucy5jb2xvci5oaWdobGlnaHQuYm9yZGVyIDogaG92ZXIgPyB0aGlzLm9wdGlvbnMuY29sb3IuaG92ZXIuYm9yZGVyIDogdGhpcy5vcHRpb25zLmNvbG9yLmJvcmRlcjsKCiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IHNlbGVjdGVkID8gc2VsZWN0aW9uTGluZVdpZHRoIDogYm9yZGVyV2lkdGg7CiAgICAgICAgY3R4LmxpbmVXaWR0aCAqPSB0aGlzLm5ldHdvcmtTY2FsZUludjsKICAgICAgICBjdHgubGluZVdpZHRoID0gTWF0aC5taW4odGhpcy53aWR0aCwgY3R4LmxpbmVXaWR0aCk7CgogICAgICAgIGN0eC5maWxsU3R5bGUgPSBzZWxlY3RlZCA/IHRoaXMub3B0aW9ucy5jb2xvci5oaWdobGlnaHQuYmFja2dyb3VuZCA6IGhvdmVyID8gdGhpcy5vcHRpb25zLmNvbG9yLmhvdmVyLmJhY2tncm91bmQgOiB0aGlzLm9wdGlvbnMuY29sb3IuYmFja2dyb3VuZDsKICAgICAgICBjdHguY2lyY2xlKHgsIHksIHNpemUpOwoKICAgICAgICAvLyBkcmF3IHNoYWRvdyBpZiBlbmFibGVkCiAgICAgICAgdGhpcy5lbmFibGVTaGFkb3coY3R4KTsKICAgICAgICBjdHguZmlsbCgpOwoKICAgICAgICAvLyBkaXNhYmxlIHNoYWRvd3MgZm9yIG90aGVyIGVsZW1lbnRzLgogICAgICAgIHRoaXMuZGlzYWJsZVNoYWRvdyhjdHgpOwoKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2RyYXdJbWFnZUF0UG9zaXRpb24nLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2RyYXdJbWFnZUF0UG9zaXRpb24oY3R4KSB7CiAgICAgICAgaWYgKHRoaXMuaW1hZ2VPYmoud2lkdGggIT0gMCkgewogICAgICAgICAgLy8gZHJhdyB0aGUgaW1hZ2UKICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgLy8gZHJhdyBzaGFkb3cgaWYgZW5hYmxlZAogICAgICAgICAgdGhpcy5lbmFibGVTaGFkb3coY3R4KTsKICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy5pbWFnZU9iaiwgdGhpcy5sZWZ0LCB0aGlzLnRvcCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpOwoKICAgICAgICAgIC8vIGRpc2FibGUgc2hhZG93cyBmb3Igb3RoZXIgZWxlbWVudHMuCiAgICAgICAgICB0aGlzLmRpc2FibGVTaGFkb3coY3R4KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2RyYXdJbWFnZUxhYmVsJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kcmF3SW1hZ2VMYWJlbChjdHgsIHgsIHksIHNlbGVjdGVkKSB7CiAgICAgICAgdmFyIHlMYWJlbDsKICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCiAgICAgICAgaWYgKHRoaXMuaGVpZ2h0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIG9mZnNldCA9IHRoaXMuaGVpZ2h0ICogMC41OwogICAgICAgICAgdmFyIGxhYmVsRGltZW5zaW9ucyA9IHRoaXMubGFiZWxNb2R1bGUuZ2V0VGV4dFNpemUoY3R4KTsKICAgICAgICAgIGlmIChsYWJlbERpbWVuc2lvbnMubGluZUNvdW50ID49IDEpIHsKICAgICAgICAgICAgb2Zmc2V0ICs9IGxhYmVsRGltZW5zaW9ucy5oZWlnaHQgLyAyOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgeUxhYmVsID0geSArIG9mZnNldDsKCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5sYWJlbCkgewogICAgICAgICAgdGhpcy5sYWJlbE9mZnNldCA9IG9mZnNldDsKICAgICAgICB9CiAgICAgICAgdGhpcy5sYWJlbE1vZHVsZS5kcmF3KGN0eCwgeCwgeUxhYmVsLCBzZWxlY3RlZCwgJ2hhbmdpbmcnKTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBDaXJjbGVJbWFnZUJhc2U7CiAgfSkoX3V0aWxOb2RlQmFzZTJbJ2RlZmF1bHQnXSk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IENpcmNsZUltYWdlQmFzZTsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDY4ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIHZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyBfeCA9IHBhcmVudDsgX3gyID0gcHJvcGVydHk7IF94MyA9IHJlY2VpdmVyOyBfYWdhaW4gPSB0cnVlOyBjb250aW51ZSBfZnVuY3Rpb247IH0gfSBlbHNlIGlmICgndmFsdWUnIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCiAgdmFyIF91dGlsQ2lyY2xlSW1hZ2VCYXNlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Nyk7CgogIHZhciBfdXRpbENpcmNsZUltYWdlQmFzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsQ2lyY2xlSW1hZ2VCYXNlKTsKCiAgdmFyIENpcmN1bGFySW1hZ2UgPSAoZnVuY3Rpb24gKF9DaXJjbGVJbWFnZUJhc2UpIHsKICAgIGZ1bmN0aW9uIENpcmN1bGFySW1hZ2Uob3B0aW9ucywgYm9keSwgbGFiZWxNb2R1bGUsIGltYWdlT2JqKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDaXJjdWxhckltYWdlKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKENpcmN1bGFySW1hZ2UucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7CiAgICAgIHRoaXMuaW1hZ2VPYmogPSBpbWFnZU9iajsKICAgICAgdGhpcy5fc3dhcFRvSW1hZ2VSZXNpemVXaGVuSW1hZ2VMb2FkZWQgPSB0cnVlOwogICAgfQoKICAgIF9pbmhlcml0cyhDaXJjdWxhckltYWdlLCBfQ2lyY2xlSW1hZ2VCYXNlKTsKCiAgICBfY3JlYXRlQ2xhc3MoQ2lyY3VsYXJJbWFnZSwgW3sKICAgICAga2V5OiAncmVzaXplJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2l6ZSgpIHsKICAgICAgICBpZiAodGhpcy5pbWFnZU9iai5zcmMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLmltYWdlT2JqLndpZHRoID09PSB1bmRlZmluZWQgfHwgdGhpcy5pbWFnZU9iai5oZWlnaHQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKCF0aGlzLndpZHRoKSB7CiAgICAgICAgICAgIHZhciBkaWFtZXRlciA9IHRoaXMub3B0aW9ucy5zaXplICogMjsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IGRpYW1ldGVyOwogICAgICAgICAgICB0aGlzLmhlaWdodCA9IGRpYW1ldGVyOwogICAgICAgICAgICB0aGlzLl9zd2FwVG9JbWFnZVJlc2l6ZVdoZW5JbWFnZUxvYWRlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMucmFkaXVzID0gMC41ICogdGhpcy53aWR0aDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHRoaXMuX3N3YXBUb0ltYWdlUmVzaXplV2hlbkltYWdlTG9hZGVkKSB7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gdW5kZWZpbmVkOwogICAgICAgICAgICB0aGlzLl9zd2FwVG9JbWFnZVJlc2l6ZVdoZW5JbWFnZUxvYWRlZCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5fcmVzaXplSW1hZ2UoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZHJhdycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KGN0eCwgeCwgeSwgc2VsZWN0ZWQsIGhvdmVyKSB7CiAgICAgICAgdGhpcy5yZXNpemUoKTsKCiAgICAgICAgdGhpcy5sZWZ0ID0geCAtIHRoaXMud2lkdGggLyAyOwogICAgICAgIHRoaXMudG9wID0geSAtIHRoaXMuaGVpZ2h0IC8gMjsKCiAgICAgICAgdmFyIHNpemUgPSBNYXRoLm1pbigwLjUgKiB0aGlzLmhlaWdodCwgMC41ICogdGhpcy53aWR0aCk7CgogICAgICAgIHRoaXMuX2RyYXdSYXdDaXJjbGUoY3R4LCB4LCB5LCBzZWxlY3RlZCwgaG92ZXIsIHNpemUpOwoKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGN0eC5jaXJjbGUoeCwgeSwgc2l6ZSk7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIGN0eC5jbGlwKCk7CgogICAgICAgIHRoaXMuX2RyYXdJbWFnZUF0UG9zaXRpb24oY3R4KTsKCiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgdGhpcy5fZHJhd0ltYWdlTGFiZWwoY3R4LCB4LCB5LCBzZWxlY3RlZCk7CgogICAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdCb3goeCwgeSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAndXBkYXRlQm91bmRpbmdCb3gnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlQm91bmRpbmdCb3goeCwgeSkgewogICAgICAgIHRoaXMuYm91bmRpbmdCb3gudG9wID0geSAtIHRoaXMub3B0aW9ucy5zaXplOwogICAgICAgIHRoaXMuYm91bmRpbmdCb3gubGVmdCA9IHggLSB0aGlzLm9wdGlvbnMuc2l6ZTsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnJpZ2h0ID0geCArIHRoaXMub3B0aW9ucy5zaXplOwogICAgICAgIHRoaXMuYm91bmRpbmdCb3guYm90dG9tID0geSArIHRoaXMub3B0aW9ucy5zaXplOwogICAgICAgIHRoaXMuYm91bmRpbmdCb3gubGVmdCA9IE1hdGgubWluKHRoaXMuYm91bmRpbmdCb3gubGVmdCwgdGhpcy5sYWJlbE1vZHVsZS5zaXplLmxlZnQpOwogICAgICAgIHRoaXMuYm91bmRpbmdCb3gucmlnaHQgPSBNYXRoLm1heCh0aGlzLmJvdW5kaW5nQm94LnJpZ2h0LCB0aGlzLmxhYmVsTW9kdWxlLnNpemUubGVmdCArIHRoaXMubGFiZWxNb2R1bGUuc2l6ZS53aWR0aCk7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5ib3R0b20gPSBNYXRoLm1heCh0aGlzLmJvdW5kaW5nQm94LmJvdHRvbSwgdGhpcy5ib3VuZGluZ0JveC5ib3R0b20gKyB0aGlzLmxhYmVsT2Zmc2V0KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdkaXN0YW5jZVRvQm9yZGVyJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3RhbmNlVG9Cb3JkZXIoY3R4LCBhbmdsZSkgewogICAgICAgIHRoaXMucmVzaXplKGN0eCk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3RhbmNlVG9Cb3JkZXIoYW5nbGUpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIENpcmN1bGFySW1hZ2U7CiAgfSkoX3V0aWxDaXJjbGVJbWFnZUJhc2UyWydkZWZhdWx0J10pOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBDaXJjdWxhckltYWdlOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogNjkgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKICB2YXIgX3V0aWxOb2RlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjUpOwoKICB2YXIgX3V0aWxOb2RlQmFzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsTm9kZUJhc2UpOwoKICB2YXIgRGF0YWJhc2UgPSAoZnVuY3Rpb24gKF9Ob2RlQmFzZSkgewogICAgZnVuY3Rpb24gRGF0YWJhc2Uob3B0aW9ucywgYm9keSwgbGFiZWxNb2R1bGUpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIERhdGFiYXNlKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKERhdGFiYXNlLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgb3B0aW9ucywgYm9keSwgbGFiZWxNb2R1bGUpOwogICAgfQoKICAgIF9pbmhlcml0cyhEYXRhYmFzZSwgX05vZGVCYXNlKTsKCiAgICBfY3JlYXRlQ2xhc3MoRGF0YWJhc2UsIFt7CiAgICAgIGtleTogJ3Jlc2l6ZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXNpemUoY3R4LCBzZWxlY3RlZCkgewogICAgICAgIGlmICh0aGlzLndpZHRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBtYXJnaW4gPSA1OwogICAgICAgICAgdmFyIHRleHRTaXplID0gdGhpcy5sYWJlbE1vZHVsZS5nZXRUZXh0U2l6ZShjdHgsIHNlbGVjdGVkKTsKICAgICAgICAgIHZhciBzaXplID0gdGV4dFNpemUud2lkdGggKyAyICogbWFyZ2luOwogICAgICAgICAgdGhpcy53aWR0aCA9IHNpemU7CiAgICAgICAgICB0aGlzLmhlaWdodCA9IHNpemU7CiAgICAgICAgICB0aGlzLnJhZGl1cyA9IDAuNSAqIHRoaXMud2lkdGg7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RyYXcnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZHJhdyhjdHgsIHgsIHksIHNlbGVjdGVkLCBob3ZlcikgewogICAgICAgIHRoaXMucmVzaXplKGN0eCwgc2VsZWN0ZWQpOwogICAgICAgIHRoaXMubGVmdCA9IHggLSB0aGlzLndpZHRoIC8gMjsKICAgICAgICB0aGlzLnRvcCA9IHkgLSB0aGlzLmhlaWdodCAvIDI7CgogICAgICAgIHZhciBib3JkZXJXaWR0aCA9IHRoaXMub3B0aW9ucy5ib3JkZXJXaWR0aDsKICAgICAgICB2YXIgc2VsZWN0aW9uTGluZVdpZHRoID0gdGhpcy5vcHRpb25zLmJvcmRlcldpZHRoU2VsZWN0ZWQgfHwgMiAqIHRoaXMub3B0aW9ucy5ib3JkZXJXaWR0aDsKCiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gc2VsZWN0ZWQgPyB0aGlzLm9wdGlvbnMuY29sb3IuaGlnaGxpZ2h0LmJvcmRlciA6IGhvdmVyID8gdGhpcy5vcHRpb25zLmNvbG9yLmhvdmVyLmJvcmRlciA6IHRoaXMub3B0aW9ucy5jb2xvci5ib3JkZXI7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IHRoaXMuc2VsZWN0ZWQgPyBzZWxlY3Rpb25MaW5lV2lkdGggOiBib3JkZXJXaWR0aDsKICAgICAgICBjdHgubGluZVdpZHRoICo9IHRoaXMubmV0d29ya1NjYWxlSW52OwogICAgICAgIGN0eC5saW5lV2lkdGggPSBNYXRoLm1pbih0aGlzLndpZHRoLCBjdHgubGluZVdpZHRoKTsKCiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHNlbGVjdGVkID8gdGhpcy5vcHRpb25zLmNvbG9yLmhpZ2hsaWdodC5iYWNrZ3JvdW5kIDogaG92ZXIgPyB0aGlzLm9wdGlvbnMuY29sb3IuaG92ZXIuYmFja2dyb3VuZCA6IHRoaXMub3B0aW9ucy5jb2xvci5iYWNrZ3JvdW5kOwogICAgICAgIGN0eC5kYXRhYmFzZSh4IC0gdGhpcy53aWR0aCAvIDIsIHkgLSB0aGlzLmhlaWdodCAqIDAuNSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpOwoKICAgICAgICAvLyBkcmF3IHNoYWRvdyBpZiBlbmFibGVkCiAgICAgICAgdGhpcy5lbmFibGVTaGFkb3coY3R4KTsKICAgICAgICBjdHguZmlsbCgpOwoKICAgICAgICAvLyBkaXNhYmxlIHNoYWRvd3MgZm9yIG90aGVyIGVsZW1lbnRzLgogICAgICAgIHRoaXMuZGlzYWJsZVNoYWRvdyhjdHgpOwoKICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdCb3goeCwgeSk7CgogICAgICAgIHRoaXMubGFiZWxNb2R1bGUuZHJhdyhjdHgsIHgsIHksIHNlbGVjdGVkKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICd1cGRhdGVCb3VuZGluZ0JveCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVCb3VuZGluZ0JveCh4LCB5KSB7CiAgICAgICAgdGhpcy5sZWZ0ID0geCAtIHRoaXMud2lkdGggKiAwLjU7CiAgICAgICAgdGhpcy50b3AgPSB5IC0gdGhpcy5oZWlnaHQgKiAwLjU7CgogICAgICAgIHRoaXMuYm91bmRpbmdCb3gubGVmdCA9IHRoaXMubGVmdDsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnRvcCA9IHRoaXMudG9wOwogICAgICAgIHRoaXMuYm91bmRpbmdCb3guYm90dG9tID0gdGhpcy50b3AgKyB0aGlzLmhlaWdodDsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnJpZ2h0ID0gdGhpcy5sZWZ0ICsgdGhpcy53aWR0aDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdkaXN0YW5jZVRvQm9yZGVyJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3RhbmNlVG9Cb3JkZXIoY3R4LCBhbmdsZSkgewogICAgICAgIHRoaXMucmVzaXplKGN0eCk7CiAgICAgICAgdmFyIGEgPSB0aGlzLndpZHRoIC8gMjsKICAgICAgICB2YXIgYiA9IHRoaXMuaGVpZ2h0IC8gMjsKICAgICAgICB2YXIgdyA9IE1hdGguc2luKGFuZ2xlKSAqIGE7CiAgICAgICAgdmFyIGggPSBNYXRoLmNvcyhhbmdsZSkgKiBiOwogICAgICAgIHJldHVybiBhICogYiAvIE1hdGguc3FydCh3ICogdyArIGggKiBoKTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBEYXRhYmFzZTsKICB9KShfdXRpbE5vZGVCYXNlMlsnZGVmYXVsdCddKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gRGF0YWJhc2U7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiA3MCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICB2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChfeCwgX3gyLCBfeDMpIHsgdmFyIF9hZ2FpbiA9IHRydWU7IF9mdW5jdGlvbjogd2hpbGUgKF9hZ2FpbikgeyB2YXIgb2JqZWN0ID0gX3gsIHByb3BlcnR5ID0gX3gyLCByZWNlaXZlciA9IF94MzsgZGVzYyA9IHBhcmVudCA9IGdldHRlciA9IHVuZGVmaW5lZDsgX2FnYWluID0gZmFsc2U7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9CgogIHZhciBfdXRpbFNoYXBlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNzEpOwoKICB2YXIgX3V0aWxTaGFwZUJhc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbFNoYXBlQmFzZSk7CgogIHZhciBEaWFtb25kID0gKGZ1bmN0aW9uIChfU2hhcGVCYXNlKSB7CiAgICBmdW5jdGlvbiBEaWFtb25kKG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEaWFtb25kKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKERpYW1vbmQucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7CiAgICB9CgogICAgX2luaGVyaXRzKERpYW1vbmQsIF9TaGFwZUJhc2UpOwoKICAgIF9jcmVhdGVDbGFzcyhEaWFtb25kLCBbewogICAgICBrZXk6ICdyZXNpemUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVzaXplKGN0eCkgewogICAgICAgIHRoaXMuX3Jlc2l6ZVNoYXBlKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZHJhdycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KGN0eCwgeCwgeSwgc2VsZWN0ZWQsIGhvdmVyKSB7CiAgICAgICAgdGhpcy5fZHJhd1NoYXBlKGN0eCwgJ2RpYW1vbmQnLCA0LCB4LCB5LCBzZWxlY3RlZCwgaG92ZXIpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2Rpc3RhbmNlVG9Cb3JkZXInLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzdGFuY2VUb0JvcmRlcihjdHgsIGFuZ2xlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3RhbmNlVG9Cb3JkZXIoYW5nbGUpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIERpYW1vbmQ7CiAgfSkoX3V0aWxTaGFwZUJhc2UyWydkZWZhdWx0J10pOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBEaWFtb25kOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogNzEgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKICB2YXIgX3V0aWxOb2RlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjUpOwoKICB2YXIgX3V0aWxOb2RlQmFzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsTm9kZUJhc2UpOwoKICB2YXIgU2hhcGVCYXNlID0gKGZ1bmN0aW9uIChfTm9kZUJhc2UpIHsKICAgIGZ1bmN0aW9uIFNoYXBlQmFzZShvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2hhcGVCYXNlKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKFNoYXBlQmFzZS5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKTsKICAgIH0KCiAgICBfaW5oZXJpdHMoU2hhcGVCYXNlLCBfTm9kZUJhc2UpOwoKICAgIF9jcmVhdGVDbGFzcyhTaGFwZUJhc2UsIFt7CiAgICAgIGtleTogJ19yZXNpemVTaGFwZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVzaXplU2hhcGUoKSB7CiAgICAgICAgaWYgKHRoaXMud2lkdGggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdmFyIHNpemUgPSAyICogdGhpcy5vcHRpb25zLnNpemU7CiAgICAgICAgICB0aGlzLndpZHRoID0gc2l6ZTsKICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gc2l6ZTsKICAgICAgICAgIHRoaXMucmFkaXVzID0gMC41ICogdGhpcy53aWR0aDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2RyYXdTaGFwZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZHJhd1NoYXBlKGN0eCwgc2hhcGUsIHNpemVNdWx0aXBsaWVyLCB4LCB5LCBzZWxlY3RlZCwgaG92ZXIpIHsKICAgICAgICB0aGlzLl9yZXNpemVTaGFwZSgpOwoKICAgICAgICB0aGlzLmxlZnQgPSB4IC0gdGhpcy53aWR0aCAvIDI7CiAgICAgICAgdGhpcy50b3AgPSB5IC0gdGhpcy5oZWlnaHQgLyAyOwoKICAgICAgICB2YXIgYm9yZGVyV2lkdGggPSB0aGlzLm9wdGlvbnMuYm9yZGVyV2lkdGg7CiAgICAgICAgdmFyIHNlbGVjdGlvbkxpbmVXaWR0aCA9IHRoaXMub3B0aW9ucy5ib3JkZXJXaWR0aFNlbGVjdGVkIHx8IDIgKiB0aGlzLm9wdGlvbnMuYm9yZGVyV2lkdGg7CgogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHNlbGVjdGVkID8gdGhpcy5vcHRpb25zLmNvbG9yLmhpZ2hsaWdodC5ib3JkZXIgOiBob3ZlciA/IHRoaXMub3B0aW9ucy5jb2xvci5ob3Zlci5ib3JkZXIgOiB0aGlzLm9wdGlvbnMuY29sb3IuYm9yZGVyOwogICAgICAgIGN0eC5saW5lV2lkdGggPSBzZWxlY3RlZCA/IHNlbGVjdGlvbkxpbmVXaWR0aCA6IGJvcmRlcldpZHRoOwogICAgICAgIGN0eC5saW5lV2lkdGggLz0gdGhpcy5ib2R5LnZpZXcuc2NhbGU7CiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IE1hdGgubWluKHRoaXMud2lkdGgsIGN0eC5saW5lV2lkdGgpOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSBzZWxlY3RlZCA/IHRoaXMub3B0aW9ucy5jb2xvci5oaWdobGlnaHQuYmFja2dyb3VuZCA6IGhvdmVyID8gdGhpcy5vcHRpb25zLmNvbG9yLmhvdmVyLmJhY2tncm91bmQgOiB0aGlzLm9wdGlvbnMuY29sb3IuYmFja2dyb3VuZDsKICAgICAgICBjdHhbc2hhcGVdKHgsIHksIHRoaXMub3B0aW9ucy5zaXplKTsKCiAgICAgICAgLy8gZHJhdyBzaGFkb3cgaWYgZW5hYmxlZAogICAgICAgIHRoaXMuZW5hYmxlU2hhZG93KGN0eCk7CiAgICAgICAgY3R4LmZpbGwoKTsKCiAgICAgICAgLy8gZGlzYWJsZSBzaGFkb3dzIGZvciBvdGhlciBlbGVtZW50cy4KICAgICAgICB0aGlzLmRpc2FibGVTaGFkb3coY3R4KTsKCiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxhYmVsICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciB5TGFiZWwgPSB5ICsgMC41ICogdGhpcy5oZWlnaHQgKyAzOyAvLyB0aGUgKyAzIGlzIHRvIG9mZnNldCBpdCBhIGJpdCBiZWxvdyB0aGUgbm9kZS4KICAgICAgICAgIHRoaXMubGFiZWxNb2R1bGUuZHJhdyhjdHgsIHgsIHlMYWJlbCwgc2VsZWN0ZWQsICdoYW5naW5nJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nQm94KHgsIHkpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3VwZGF0ZUJvdW5kaW5nQm94JywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZUJvdW5kaW5nQm94KHgsIHkpIHsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnRvcCA9IHkgLSB0aGlzLm9wdGlvbnMuc2l6ZTsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmxlZnQgPSB4IC0gdGhpcy5vcHRpb25zLnNpemU7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5yaWdodCA9IHggKyB0aGlzLm9wdGlvbnMuc2l6ZTsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmJvdHRvbSA9IHkgKyB0aGlzLm9wdGlvbnMuc2l6ZTsKCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5sYWJlbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmxlZnQgPSBNYXRoLm1pbih0aGlzLmJvdW5kaW5nQm94LmxlZnQsIHRoaXMubGFiZWxNb2R1bGUuc2l6ZS5sZWZ0KTsKICAgICAgICAgIHRoaXMuYm91bmRpbmdCb3gucmlnaHQgPSBNYXRoLm1heCh0aGlzLmJvdW5kaW5nQm94LnJpZ2h0LCB0aGlzLmxhYmVsTW9kdWxlLnNpemUubGVmdCArIHRoaXMubGFiZWxNb2R1bGUuc2l6ZS53aWR0aCk7CiAgICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmJvdHRvbSA9IE1hdGgubWF4KHRoaXMuYm91bmRpbmdCb3guYm90dG9tLCB0aGlzLmJvdW5kaW5nQm94LmJvdHRvbSArIHRoaXMubGFiZWxNb2R1bGUuc2l6ZS5oZWlnaHQgKyAzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gU2hhcGVCYXNlOwogIH0pKF91dGlsTm9kZUJhc2UyWydkZWZhdWx0J10pOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBTaGFwZUJhc2U7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiA3MiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICB2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChfeCwgX3gyLCBfeDMpIHsgdmFyIF9hZ2FpbiA9IHRydWU7IF9mdW5jdGlvbjogd2hpbGUgKF9hZ2FpbikgeyB2YXIgb2JqZWN0ID0gX3gsIHByb3BlcnR5ID0gX3gyLCByZWNlaXZlciA9IF94MzsgZGVzYyA9IHBhcmVudCA9IGdldHRlciA9IHVuZGVmaW5lZDsgX2FnYWluID0gZmFsc2U7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9CgogIHZhciBfdXRpbFNoYXBlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNzEpOwoKICB2YXIgX3V0aWxTaGFwZUJhc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbFNoYXBlQmFzZSk7CgogIHZhciBEb3QgPSAoZnVuY3Rpb24gKF9TaGFwZUJhc2UpIHsKICAgIGZ1bmN0aW9uIERvdChvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRG90KTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKERvdC5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKTsKICAgIH0KCiAgICBfaW5oZXJpdHMoRG90LCBfU2hhcGVCYXNlKTsKCiAgICBfY3JlYXRlQ2xhc3MoRG90LCBbewogICAgICBrZXk6ICdyZXNpemUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVzaXplKGN0eCkgewogICAgICAgIHRoaXMuX3Jlc2l6ZVNoYXBlKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZHJhdycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KGN0eCwgeCwgeSwgc2VsZWN0ZWQsIGhvdmVyKSB7CiAgICAgICAgdGhpcy5fZHJhd1NoYXBlKGN0eCwgJ2NpcmNsZScsIDIsIHgsIHksIHNlbGVjdGVkLCBob3Zlcik7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZGlzdGFuY2VUb0JvcmRlcicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkaXN0YW5jZVRvQm9yZGVyKGN0eCwgYW5nbGUpIHsKICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLnNpemUgKyB0aGlzLm9wdGlvbnMuYm9yZGVyV2lkdGg7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gRG90OwogIH0pKF91dGlsU2hhcGVCYXNlMlsnZGVmYXVsdCddKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gRG90OwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogNzMgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKICB2YXIgX3V0aWxOb2RlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjUpOwoKICB2YXIgX3V0aWxOb2RlQmFzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsTm9kZUJhc2UpOwoKICB2YXIgRWxsaXBzZSA9IChmdW5jdGlvbiAoX05vZGVCYXNlKSB7CiAgICBmdW5jdGlvbiBFbGxpcHNlKG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFbGxpcHNlKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKEVsbGlwc2UucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7CiAgICB9CgogICAgX2luaGVyaXRzKEVsbGlwc2UsIF9Ob2RlQmFzZSk7CgogICAgX2NyZWF0ZUNsYXNzKEVsbGlwc2UsIFt7CiAgICAgIGtleTogJ3Jlc2l6ZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXNpemUoY3R4LCBzZWxlY3RlZCkgewogICAgICAgIGlmICh0aGlzLndpZHRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciB0ZXh0U2l6ZSA9IHRoaXMubGFiZWxNb2R1bGUuZ2V0VGV4dFNpemUoY3R4LCBzZWxlY3RlZCk7CgogICAgICAgICAgdGhpcy53aWR0aCA9IHRleHRTaXplLndpZHRoICogMS41OwogICAgICAgICAgdGhpcy5oZWlnaHQgPSB0ZXh0U2l6ZS5oZWlnaHQgKiAyOwogICAgICAgICAgaWYgKHRoaXMud2lkdGggPCB0aGlzLmhlaWdodCkgewogICAgICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5oZWlnaHQ7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnJhZGl1cyA9IDAuNSAqIHRoaXMud2lkdGg7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RyYXcnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZHJhdyhjdHgsIHgsIHksIHNlbGVjdGVkLCBob3ZlcikgewogICAgICAgIHRoaXMucmVzaXplKGN0eCwgc2VsZWN0ZWQpOwogICAgICAgIHRoaXMubGVmdCA9IHggLSB0aGlzLndpZHRoICogMC41OwogICAgICAgIHRoaXMudG9wID0geSAtIHRoaXMuaGVpZ2h0ICogMC41OwoKICAgICAgICB2YXIgYm9yZGVyV2lkdGggPSB0aGlzLm9wdGlvbnMuYm9yZGVyV2lkdGg7CiAgICAgICAgdmFyIHNlbGVjdGlvbkxpbmVXaWR0aCA9IHRoaXMub3B0aW9ucy5ib3JkZXJXaWR0aFNlbGVjdGVkIHx8IDIgKiB0aGlzLm9wdGlvbnMuYm9yZGVyV2lkdGg7CgogICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHNlbGVjdGVkID8gdGhpcy5vcHRpb25zLmNvbG9yLmhpZ2hsaWdodC5ib3JkZXIgOiBob3ZlciA/IHRoaXMub3B0aW9ucy5jb2xvci5ob3Zlci5ib3JkZXIgOiB0aGlzLm9wdGlvbnMuY29sb3IuYm9yZGVyOwoKICAgICAgICBjdHgubGluZVdpZHRoID0gc2VsZWN0ZWQgPyBzZWxlY3Rpb25MaW5lV2lkdGggOiBib3JkZXJXaWR0aDsKICAgICAgICBjdHgubGluZVdpZHRoIC89IHRoaXMuYm9keS52aWV3LnNjYWxlOwogICAgICAgIGN0eC5saW5lV2lkdGggPSBNYXRoLm1pbih0aGlzLndpZHRoLCBjdHgubGluZVdpZHRoKTsKCiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHNlbGVjdGVkID8gdGhpcy5vcHRpb25zLmNvbG9yLmhpZ2hsaWdodC5iYWNrZ3JvdW5kIDogaG92ZXIgPyB0aGlzLm9wdGlvbnMuY29sb3IuaG92ZXIuYmFja2dyb3VuZCA6IHRoaXMub3B0aW9ucy5jb2xvci5iYWNrZ3JvdW5kOwogICAgICAgIGN0eC5lbGxpcHNlKHRoaXMubGVmdCwgdGhpcy50b3AsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsKCiAgICAgICAgLy8gZHJhdyBzaGFkb3cgaWYgZW5hYmxlZAogICAgICAgIHRoaXMuZW5hYmxlU2hhZG93KGN0eCk7CiAgICAgICAgY3R4LmZpbGwoKTsKCiAgICAgICAgLy8gZGlzYWJsZSBzaGFkb3dzIGZvciBvdGhlciBlbGVtZW50cy4KICAgICAgICB0aGlzLmRpc2FibGVTaGFkb3coY3R4KTsKCiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nQm94KHgsIHkpOwogICAgICAgIHRoaXMubGFiZWxNb2R1bGUuZHJhdyhjdHgsIHgsIHksIHNlbGVjdGVkKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICd1cGRhdGVCb3VuZGluZ0JveCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVCb3VuZGluZ0JveCh4LCB5KSB7CiAgICAgICAgdGhpcy5sZWZ0ID0geCAtIHRoaXMud2lkdGggKiAwLjU7CiAgICAgICAgdGhpcy50b3AgPSB5IC0gdGhpcy5oZWlnaHQgKiAwLjU7CgogICAgICAgIHRoaXMuYm91bmRpbmdCb3gubGVmdCA9IHRoaXMubGVmdDsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnRvcCA9IHRoaXMudG9wOwogICAgICAgIHRoaXMuYm91bmRpbmdCb3guYm90dG9tID0gdGhpcy50b3AgKyB0aGlzLmhlaWdodDsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LnJpZ2h0ID0gdGhpcy5sZWZ0ICsgdGhpcy53aWR0aDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdkaXN0YW5jZVRvQm9yZGVyJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3RhbmNlVG9Cb3JkZXIoY3R4LCBhbmdsZSkgewogICAgICAgIHRoaXMucmVzaXplKGN0eCk7CiAgICAgICAgdmFyIGEgPSB0aGlzLndpZHRoICogMC41OwogICAgICAgIHZhciBiID0gdGhpcy5oZWlnaHQgKiAwLjU7CiAgICAgICAgdmFyIHcgPSBNYXRoLnNpbihhbmdsZSkgKiBhOwogICAgICAgIHZhciBoID0gTWF0aC5jb3MoYW5nbGUpICogYjsKICAgICAgICByZXR1cm4gYSAqIGIgLyBNYXRoLnNxcnQodyAqIHcgKyBoICogaCk7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gRWxsaXBzZTsKICB9KShfdXRpbE5vZGVCYXNlMlsnZGVmYXVsdCddKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gRWxsaXBzZTsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDc0ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIHZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyBfeCA9IHBhcmVudDsgX3gyID0gcHJvcGVydHk7IF94MyA9IHJlY2VpdmVyOyBfYWdhaW4gPSB0cnVlOyBjb250aW51ZSBfZnVuY3Rpb247IH0gfSBlbHNlIGlmICgndmFsdWUnIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCiAgdmFyIF91dGlsTm9kZUJhc2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY1KTsKCiAgdmFyIF91dGlsTm9kZUJhc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbE5vZGVCYXNlKTsKCiAgdmFyIEljb24gPSAoZnVuY3Rpb24gKF9Ob2RlQmFzZSkgewogICAgZnVuY3Rpb24gSWNvbihvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSWNvbik7CgogICAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihJY29uLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgb3B0aW9ucywgYm9keSwgbGFiZWxNb2R1bGUpOwogICAgfQoKICAgIF9pbmhlcml0cyhJY29uLCBfTm9kZUJhc2UpOwoKICAgIF9jcmVhdGVDbGFzcyhJY29uLCBbewogICAgICBrZXk6ICdyZXNpemUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVzaXplKGN0eCkgewogICAgICAgIGlmICh0aGlzLndpZHRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBtYXJnaW4gPSA1OwogICAgICAgICAgdmFyIGljb25TaXplID0gewogICAgICAgICAgICB3aWR0aDogTnVtYmVyKHRoaXMub3B0aW9ucy5pY29uLnNpemUpLAogICAgICAgICAgICBoZWlnaHQ6IE51bWJlcih0aGlzLm9wdGlvbnMuaWNvbi5zaXplKQogICAgICAgICAgfTsKICAgICAgICAgIHRoaXMud2lkdGggPSBpY29uU2l6ZS53aWR0aCArIDIgKiBtYXJnaW47CiAgICAgICAgICB0aGlzLmhlaWdodCA9IGljb25TaXplLmhlaWdodCArIDIgKiBtYXJnaW47CiAgICAgICAgICB0aGlzLnJhZGl1cyA9IDAuNSAqIHRoaXMud2lkdGg7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RyYXcnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZHJhdyhjdHgsIHgsIHksIHNlbGVjdGVkLCBob3ZlcikgewogICAgICAgIHRoaXMucmVzaXplKGN0eCk7CiAgICAgICAgdGhpcy5vcHRpb25zLmljb24uc2l6ZSA9IHRoaXMub3B0aW9ucy5pY29uLnNpemUgfHwgNTA7CgogICAgICAgIHRoaXMubGVmdCA9IHggLSB0aGlzLndpZHRoICogMC41OwogICAgICAgIHRoaXMudG9wID0geSAtIHRoaXMuaGVpZ2h0ICogMC41OwogICAgICAgIHRoaXMuX2ljb24oY3R4LCB4LCB5LCBzZWxlY3RlZCk7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMubGFiZWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdmFyIGljb25UZXh0U3BhY2luZyA9IDU7CiAgICAgICAgICB0aGlzLmxhYmVsTW9kdWxlLmRyYXcoY3R4LCB4LCB5ICsgdGhpcy5oZWlnaHQgKiAwLjUgKyBpY29uVGV4dFNwYWNpbmcsIHNlbGVjdGVkKTsKICAgICAgICB9CgogICAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdCb3goeCwgeSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAndXBkYXRlQm91bmRpbmdCb3gnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlQm91bmRpbmdCb3goeCwgeSkgewogICAgICAgIHRoaXMuYm91bmRpbmdCb3gudG9wID0geSAtIHRoaXMub3B0aW9ucy5pY29uLnNpemUgKiAwLjU7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5sZWZ0ID0geCAtIHRoaXMub3B0aW9ucy5pY29uLnNpemUgKiAwLjU7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5yaWdodCA9IHggKyB0aGlzLm9wdGlvbnMuaWNvbi5zaXplICogMC41OwogICAgICAgIHRoaXMuYm91bmRpbmdCb3guYm90dG9tID0geSArIHRoaXMub3B0aW9ucy5pY29uLnNpemUgKiAwLjU7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMubGFiZWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdmFyIGljb25UZXh0U3BhY2luZyA9IDU7CiAgICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmxlZnQgPSBNYXRoLm1pbih0aGlzLmJvdW5kaW5nQm94LmxlZnQsIHRoaXMubGFiZWxNb2R1bGUuc2l6ZS5sZWZ0KTsKICAgICAgICAgIHRoaXMuYm91bmRpbmdCb3gucmlnaHQgPSBNYXRoLm1heCh0aGlzLmJvdW5kaW5nQm94LnJpZ2h0LCB0aGlzLmxhYmVsTW9kdWxlLnNpemUubGVmdCArIHRoaXMubGFiZWxNb2R1bGUuc2l6ZS53aWR0aCk7CiAgICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmJvdHRvbSA9IE1hdGgubWF4KHRoaXMuYm91bmRpbmdCb3guYm90dG9tLCB0aGlzLmJvdW5kaW5nQm94LmJvdHRvbSArIHRoaXMubGFiZWxNb2R1bGUuc2l6ZS5oZWlnaHQgKyBpY29uVGV4dFNwYWNpbmcpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfaWNvbicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfaWNvbihjdHgsIHgsIHksIHNlbGVjdGVkKSB7CiAgICAgICAgdmFyIGljb25TaXplID0gTnVtYmVyKHRoaXMub3B0aW9ucy5pY29uLnNpemUpOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmljb24uY29kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBjdHguZm9udCA9IChzZWxlY3RlZCA/ICdib2xkICcgOiAnJykgKyBpY29uU2l6ZSArICdweCAnICsgdGhpcy5vcHRpb25zLmljb24uZmFjZTsKCiAgICAgICAgICAvLyBkcmF3IGljb24KICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLm9wdGlvbnMuaWNvbi5jb2xvciB8fCAnYmxhY2snOwogICAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOwoKICAgICAgICAgIC8vIGRyYXcgc2hhZG93IGlmIGVuYWJsZWQKICAgICAgICAgIHRoaXMuZW5hYmxlU2hhZG93KGN0eCk7CiAgICAgICAgICBjdHguZmlsbFRleHQodGhpcy5vcHRpb25zLmljb24uY29kZSwgeCwgeSk7CgogICAgICAgICAgLy8gZGlzYWJsZSBzaGFkb3dzIGZvciBvdGhlciBlbGVtZW50cy4KICAgICAgICAgIHRoaXMuZGlzYWJsZVNoYWRvdyhjdHgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdXaGVuIHVzaW5nIHRoZSBpY29uIHNoYXBlLCB5b3UgbmVlZCB0byBkZWZpbmUgdGhlIGNvZGUgaW4gdGhlIGljb24gb3B0aW9ucyBvYmplY3QuIFRoaXMgY2FuIGJlIGRvbmUgcGVyIG5vZGUgb3IgZ2xvYmFsbHkuJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2Rpc3RhbmNlVG9Cb3JkZXInLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzdGFuY2VUb0JvcmRlcihjdHgsIGFuZ2xlKSB7CiAgICAgICAgdGhpcy5yZXNpemUoY3R4KTsKICAgICAgICB0aGlzLl9kaXN0YW5jZVRvQm9yZGVyKGFuZ2xlKTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBJY29uOwogIH0pKF91dGlsTm9kZUJhc2UyWydkZWZhdWx0J10pOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBJY29uOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogNzUgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKICB2YXIgX3V0aWxDaXJjbGVJbWFnZUJhc2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY3KTsKCiAgdmFyIF91dGlsQ2lyY2xlSW1hZ2VCYXNlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3V0aWxDaXJjbGVJbWFnZUJhc2UpOwoKICB2YXIgSW1hZ2UgPSAoZnVuY3Rpb24gKF9DaXJjbGVJbWFnZUJhc2UpIHsKICAgIGZ1bmN0aW9uIEltYWdlKG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlLCBpbWFnZU9iaikgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSW1hZ2UpOwoKICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoSW1hZ2UucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7CiAgICAgIHRoaXMuaW1hZ2VPYmogPSBpbWFnZU9iajsKICAgIH0KCiAgICBfaW5oZXJpdHMoSW1hZ2UsIF9DaXJjbGVJbWFnZUJhc2UpOwoKICAgIF9jcmVhdGVDbGFzcyhJbWFnZSwgW3sKICAgICAga2V5OiAncmVzaXplJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2l6ZSgpIHsKICAgICAgICB0aGlzLl9yZXNpemVJbWFnZSgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RyYXcnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZHJhdyhjdHgsIHgsIHksIHNlbGVjdGVkLCBob3ZlcikgewogICAgICAgIHRoaXMucmVzaXplKCk7CiAgICAgICAgdGhpcy5sZWZ0ID0geCAtIHRoaXMud2lkdGggLyAyOwogICAgICAgIHRoaXMudG9wID0geSAtIHRoaXMuaGVpZ2h0IC8gMjsKCiAgICAgICAgdGhpcy5fZHJhd0ltYWdlQXRQb3NpdGlvbihjdHgpOwoKICAgICAgICB0aGlzLl9kcmF3SW1hZ2VMYWJlbChjdHgsIHgsIHksIHNlbGVjdGVkIHx8IGhvdmVyKTsKCiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ0JveCh4LCB5KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICd1cGRhdGVCb3VuZGluZ0JveCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVCb3VuZGluZ0JveCh4LCB5KSB7CiAgICAgICAgdGhpcy5sZWZ0ID0geCAtIHRoaXMud2lkdGggLyAyOwogICAgICAgIHRoaXMudG9wID0geSAtIHRoaXMuaGVpZ2h0IC8gMjsKCiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC50b3AgPSB0aGlzLnRvcDsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmxlZnQgPSB0aGlzLmxlZnQ7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5yaWdodCA9IHRoaXMubGVmdCArIHRoaXMud2lkdGg7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5ib3R0b20gPSB0aGlzLnRvcCArIHRoaXMuaGVpZ2h0OwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxhYmVsICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuYm91bmRpbmdCb3gubGVmdCA9IE1hdGgubWluKHRoaXMuYm91bmRpbmdCb3gubGVmdCwgdGhpcy5sYWJlbE1vZHVsZS5zaXplLmxlZnQpOwogICAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5yaWdodCA9IE1hdGgubWF4KHRoaXMuYm91bmRpbmdCb3gucmlnaHQsIHRoaXMubGFiZWxNb2R1bGUuc2l6ZS5sZWZ0ICsgdGhpcy5sYWJlbE1vZHVsZS5zaXplLndpZHRoKTsKICAgICAgICAgIHRoaXMuYm91bmRpbmdCb3guYm90dG9tID0gTWF0aC5tYXgodGhpcy5ib3VuZGluZ0JveC5ib3R0b20sIHRoaXMuYm91bmRpbmdCb3guYm90dG9tICsgdGhpcy5sYWJlbE9mZnNldCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2Rpc3RhbmNlVG9Cb3JkZXInLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzdGFuY2VUb0JvcmRlcihjdHgsIGFuZ2xlKSB7CiAgICAgICAgdGhpcy5yZXNpemUoY3R4KTsKICAgICAgICB2YXIgYSA9IHRoaXMud2lkdGggLyAyOwogICAgICAgIHZhciBiID0gdGhpcy5oZWlnaHQgLyAyOwogICAgICAgIHZhciB3ID0gTWF0aC5zaW4oYW5nbGUpICogYTsKICAgICAgICB2YXIgaCA9IE1hdGguY29zKGFuZ2xlKSAqIGI7CiAgICAgICAgcmV0dXJuIGEgKiBiIC8gTWF0aC5zcXJ0KHcgKiB3ICsgaCAqIGgpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIEltYWdlOwogIH0pKF91dGlsQ2lyY2xlSW1hZ2VCYXNlMlsnZGVmYXVsdCddKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gSW1hZ2U7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiA3NiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICB2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChfeCwgX3gyLCBfeDMpIHsgdmFyIF9hZ2FpbiA9IHRydWU7IF9mdW5jdGlvbjogd2hpbGUgKF9hZ2FpbikgeyB2YXIgb2JqZWN0ID0gX3gsIHByb3BlcnR5ID0gX3gyLCByZWNlaXZlciA9IF94MzsgZGVzYyA9IHBhcmVudCA9IGdldHRlciA9IHVuZGVmaW5lZDsgX2FnYWluID0gZmFsc2U7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9CgogIHZhciBfdXRpbFNoYXBlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNzEpOwoKICB2YXIgX3V0aWxTaGFwZUJhc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbFNoYXBlQmFzZSk7CgogIHZhciBTcXVhcmUgPSAoZnVuY3Rpb24gKF9TaGFwZUJhc2UpIHsKICAgIGZ1bmN0aW9uIFNxdWFyZShvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3F1YXJlKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKFNxdWFyZS5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKTsKICAgIH0KCiAgICBfaW5oZXJpdHMoU3F1YXJlLCBfU2hhcGVCYXNlKTsKCiAgICBfY3JlYXRlQ2xhc3MoU3F1YXJlLCBbewogICAgICBrZXk6ICdyZXNpemUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVzaXplKCkgewogICAgICAgIHRoaXMuX3Jlc2l6ZVNoYXBlKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZHJhdycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KGN0eCwgeCwgeSwgc2VsZWN0ZWQsIGhvdmVyKSB7CiAgICAgICAgdGhpcy5fZHJhd1NoYXBlKGN0eCwgJ3NxdWFyZScsIDIsIHgsIHksIHNlbGVjdGVkLCBob3Zlcik7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZGlzdGFuY2VUb0JvcmRlcicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkaXN0YW5jZVRvQm9yZGVyKGN0eCwgYW5nbGUpIHsKICAgICAgICB0aGlzLnJlc2l6ZShjdHgpOwogICAgICAgIHJldHVybiB0aGlzLl9kaXN0YW5jZVRvQm9yZGVyKGFuZ2xlKTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBTcXVhcmU7CiAgfSkoX3V0aWxTaGFwZUJhc2UyWydkZWZhdWx0J10pOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBTcXVhcmU7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiA3NyAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICB2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChfeCwgX3gyLCBfeDMpIHsgdmFyIF9hZ2FpbiA9IHRydWU7IF9mdW5jdGlvbjogd2hpbGUgKF9hZ2FpbikgeyB2YXIgb2JqZWN0ID0gX3gsIHByb3BlcnR5ID0gX3gyLCByZWNlaXZlciA9IF94MzsgZGVzYyA9IHBhcmVudCA9IGdldHRlciA9IHVuZGVmaW5lZDsgX2FnYWluID0gZmFsc2U7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9CgogIHZhciBfdXRpbFNoYXBlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNzEpOwoKICB2YXIgX3V0aWxTaGFwZUJhc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbFNoYXBlQmFzZSk7CgogIHZhciBTdGFyID0gKGZ1bmN0aW9uIChfU2hhcGVCYXNlKSB7CiAgICBmdW5jdGlvbiBTdGFyKG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTdGFyKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKFN0YXIucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7CiAgICB9CgogICAgX2luaGVyaXRzKFN0YXIsIF9TaGFwZUJhc2UpOwoKICAgIF9jcmVhdGVDbGFzcyhTdGFyLCBbewogICAgICBrZXk6ICdyZXNpemUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVzaXplKGN0eCkgewogICAgICAgIHRoaXMuX3Jlc2l6ZVNoYXBlKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZHJhdycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KGN0eCwgeCwgeSwgc2VsZWN0ZWQsIGhvdmVyKSB7CiAgICAgICAgdGhpcy5fZHJhd1NoYXBlKGN0eCwgJ3N0YXInLCA0LCB4LCB5LCBzZWxlY3RlZCwgaG92ZXIpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2Rpc3RhbmNlVG9Cb3JkZXInLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzdGFuY2VUb0JvcmRlcihjdHgsIGFuZ2xlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3RhbmNlVG9Cb3JkZXIoYW5nbGUpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFN0YXI7CiAgfSkoX3V0aWxTaGFwZUJhc2UyWydkZWZhdWx0J10pOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBTdGFyOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogNzggKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKICB2YXIgX3V0aWxOb2RlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjUpOwoKICB2YXIgX3V0aWxOb2RlQmFzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsTm9kZUJhc2UpOwoKICB2YXIgVGV4dCA9IChmdW5jdGlvbiAoX05vZGVCYXNlKSB7CiAgICBmdW5jdGlvbiBUZXh0KG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBUZXh0KTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKFRleHQucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7CiAgICB9CgogICAgX2luaGVyaXRzKFRleHQsIF9Ob2RlQmFzZSk7CgogICAgX2NyZWF0ZUNsYXNzKFRleHQsIFt7CiAgICAgIGtleTogJ3Jlc2l6ZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXNpemUoY3R4LCBzZWxlY3RlZCkgewogICAgICAgIGlmICh0aGlzLndpZHRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBtYXJnaW4gPSA1OwogICAgICAgICAgdmFyIHRleHRTaXplID0gdGhpcy5sYWJlbE1vZHVsZS5nZXRUZXh0U2l6ZShjdHgsIHNlbGVjdGVkKTsKICAgICAgICAgIHRoaXMud2lkdGggPSB0ZXh0U2l6ZS53aWR0aCArIDIgKiBtYXJnaW47CiAgICAgICAgICB0aGlzLmhlaWdodCA9IHRleHRTaXplLmhlaWdodCArIDIgKiBtYXJnaW47CiAgICAgICAgICB0aGlzLnJhZGl1cyA9IDAuNSAqIHRoaXMud2lkdGg7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RyYXcnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZHJhdyhjdHgsIHgsIHksIHNlbGVjdGVkLCBob3ZlcikgewogICAgICAgIHRoaXMucmVzaXplKGN0eCwgc2VsZWN0ZWQgfHwgaG92ZXIpOwogICAgICAgIHRoaXMubGVmdCA9IHggLSB0aGlzLndpZHRoIC8gMjsKICAgICAgICB0aGlzLnRvcCA9IHkgLSB0aGlzLmhlaWdodCAvIDI7CgogICAgICAgIC8vIGRyYXcgc2hhZG93IGlmIGVuYWJsZWQKICAgICAgICB0aGlzLmVuYWJsZVNoYWRvdyhjdHgpOwogICAgICAgIHRoaXMubGFiZWxNb2R1bGUuZHJhdyhjdHgsIHgsIHksIHNlbGVjdGVkIHx8IGhvdmVyKTsKCiAgICAgICAgLy8gZGlzYWJsZSBzaGFkb3dzIGZvciBvdGhlciBlbGVtZW50cy4KICAgICAgICB0aGlzLmRpc2FibGVTaGFkb3coY3R4KTsKCiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ0JveCh4LCB5KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICd1cGRhdGVCb3VuZGluZ0JveCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVCb3VuZGluZ0JveCh4LCB5KSB7CiAgICAgICAgdGhpcy5sZWZ0ID0geCAtIHRoaXMud2lkdGggLyAyOwogICAgICAgIHRoaXMudG9wID0geSAtIHRoaXMuaGVpZ2h0IC8gMjsKCiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC50b3AgPSB0aGlzLnRvcDsKICAgICAgICB0aGlzLmJvdW5kaW5nQm94LmxlZnQgPSB0aGlzLmxlZnQ7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5yaWdodCA9IHRoaXMubGVmdCArIHRoaXMud2lkdGg7CiAgICAgICAgdGhpcy5ib3VuZGluZ0JveC5ib3R0b20gPSB0aGlzLnRvcCArIHRoaXMuaGVpZ2h0OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2Rpc3RhbmNlVG9Cb3JkZXInLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzdGFuY2VUb0JvcmRlcihjdHgsIGFuZ2xlKSB7CiAgICAgICAgdGhpcy5yZXNpemUoY3R4KTsKICAgICAgICByZXR1cm4gdGhpcy5fZGlzdGFuY2VUb0JvcmRlcihhbmdsZSk7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gVGV4dDsKICB9KShfdXRpbE5vZGVCYXNlMlsnZGVmYXVsdCddKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gVGV4dDsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDc5ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIHZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyBfeCA9IHBhcmVudDsgX3gyID0gcHJvcGVydHk7IF94MyA9IHJlY2VpdmVyOyBfYWdhaW4gPSB0cnVlOyBjb250aW51ZSBfZnVuY3Rpb247IH0gfSBlbHNlIGlmICgndmFsdWUnIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCiAgdmFyIF91dGlsU2hhcGVCYXNlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MSk7CgogIHZhciBfdXRpbFNoYXBlQmFzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsU2hhcGVCYXNlKTsKCiAgdmFyIFRyaWFuZ2xlID0gKGZ1bmN0aW9uIChfU2hhcGVCYXNlKSB7CiAgICBmdW5jdGlvbiBUcmlhbmdsZShvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVHJpYW5nbGUpOwoKICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoVHJpYW5nbGUucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7CiAgICB9CgogICAgX2luaGVyaXRzKFRyaWFuZ2xlLCBfU2hhcGVCYXNlKTsKCiAgICBfY3JlYXRlQ2xhc3MoVHJpYW5nbGUsIFt7CiAgICAgIGtleTogJ3Jlc2l6ZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiByZXNpemUoY3R4KSB7CiAgICAgICAgdGhpcy5fcmVzaXplU2hhcGUoKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdkcmF3JywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRyYXcoY3R4LCB4LCB5LCBzZWxlY3RlZCwgaG92ZXIpIHsKICAgICAgICB0aGlzLl9kcmF3U2hhcGUoY3R4LCAndHJpYW5nbGUnLCAzLCB4LCB5LCBzZWxlY3RlZCwgaG92ZXIpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2Rpc3RhbmNlVG9Cb3JkZXInLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzdGFuY2VUb0JvcmRlcihjdHgsIGFuZ2xlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3RhbmNlVG9Cb3JkZXIoYW5nbGUpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFRyaWFuZ2xlOwogIH0pKF91dGlsU2hhcGVCYXNlMlsnZGVmYXVsdCddKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gVHJpYW5nbGU7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiA4MCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICB2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChfeCwgX3gyLCBfeDMpIHsgdmFyIF9hZ2FpbiA9IHRydWU7IF9mdW5jdGlvbjogd2hpbGUgKF9hZ2FpbikgeyB2YXIgb2JqZWN0ID0gX3gsIHByb3BlcnR5ID0gX3gyLCByZWNlaXZlciA9IF94MzsgZGVzYyA9IHBhcmVudCA9IGdldHRlciA9IHVuZGVmaW5lZDsgX2FnYWluID0gZmFsc2U7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoJ3ZhbHVlJyBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAnICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9CgogIHZhciBfdXRpbFNoYXBlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oNzEpOwoKICB2YXIgX3V0aWxTaGFwZUJhc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbFNoYXBlQmFzZSk7CgogIHZhciBUcmlhbmdsZURvd24gPSAoZnVuY3Rpb24gKF9TaGFwZUJhc2UpIHsKICAgIGZ1bmN0aW9uIFRyaWFuZ2xlRG93bihvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVHJpYW5nbGVEb3duKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKFRyaWFuZ2xlRG93bi5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKTsKICAgIH0KCiAgICBfaW5oZXJpdHMoVHJpYW5nbGVEb3duLCBfU2hhcGVCYXNlKTsKCiAgICBfY3JlYXRlQ2xhc3MoVHJpYW5nbGVEb3duLCBbewogICAgICBrZXk6ICdyZXNpemUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVzaXplKGN0eCkgewogICAgICAgIHRoaXMuX3Jlc2l6ZVNoYXBlKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZHJhdycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KGN0eCwgeCwgeSwgc2VsZWN0ZWQsIGhvdmVyKSB7CiAgICAgICAgdGhpcy5fZHJhd1NoYXBlKGN0eCwgJ3RyaWFuZ2xlRG93bicsIDMsIHgsIHksIHNlbGVjdGVkLCBob3Zlcik7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZGlzdGFuY2VUb0JvcmRlcicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkaXN0YW5jZVRvQm9yZGVyKGN0eCwgYW5nbGUpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZGlzdGFuY2VUb0JvcmRlcihhbmdsZSk7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gVHJpYW5nbGVEb3duOwogIH0pKF91dGlsU2hhcGVCYXNlMlsnZGVmYXVsdCddKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gVHJpYW5nbGVEb3duOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogODEgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgdmFyIF9jb21wb25lbnRzRWRnZSA9IF9fd2VicGFja19yZXF1aXJlX18oODIpOwoKICB2YXIgX2NvbXBvbmVudHNFZGdlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbXBvbmVudHNFZGdlKTsKCiAgdmFyIF9jb21wb25lbnRzU2hhcmVkTGFiZWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYzKTsKCiAgdmFyIF9jb21wb25lbnRzU2hhcmVkTGFiZWwyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY29tcG9uZW50c1NoYXJlZExhYmVsKTsKCiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwogIHZhciBEYXRhU2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4KTsKICB2YXIgRGF0YVZpZXcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwKTsKCiAgdmFyIEVkZ2VzSGFuZGxlciA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBFZGdlc0hhbmRsZXIoYm9keSwgaW1hZ2VzLCBncm91cHMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFZGdlc0hhbmRsZXIpOwoKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5pbWFnZXMgPSBpbWFnZXM7CiAgICAgIHRoaXMuZ3JvdXBzID0gZ3JvdXBzOwoKICAgICAgLy8gY3JlYXRlIHRoZSBlZGdlIEFQSSBpbiB0aGUgYm9keSBjb250YWluZXIKICAgICAgdGhpcy5ib2R5LmZ1bmN0aW9ucy5jcmVhdGVFZGdlID0gdGhpcy5jcmVhdGUuYmluZCh0aGlzKTsKCiAgICAgIHRoaXMuZWRnZXNMaXN0ZW5lcnMgPSB7CiAgICAgICAgYWRkOiBmdW5jdGlvbiBhZGQoZXZlbnQsIHBhcmFtcykgewogICAgICAgICAgX3RoaXMuYWRkKHBhcmFtcy5pdGVtcyk7CiAgICAgICAgfSwKICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShldmVudCwgcGFyYW1zKSB7CiAgICAgICAgICBfdGhpcy51cGRhdGUocGFyYW1zLml0ZW1zKTsKICAgICAgICB9LAogICAgICAgIHJlbW92ZTogZnVuY3Rpb24gcmVtb3ZlKGV2ZW50LCBwYXJhbXMpIHsKICAgICAgICAgIF90aGlzLnJlbW92ZShwYXJhbXMuaXRlbXMpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHRoaXMub3B0aW9ucyA9IHt9OwogICAgICB0aGlzLmRlZmF1bHRPcHRpb25zID0gewogICAgICAgIGFycm93czogewogICAgICAgICAgdG86IHsgZW5hYmxlZDogZmFsc2UsIHNjYWxlRmFjdG9yOiAxIH0sIC8vIGJvb2xlYW4gLyB7YXJyb3dTY2FsZUZhY3RvcjoxfSAvIHtlbmFibGVkOiBmYWxzZSwgYXJyb3dTY2FsZUZhY3RvcjoxfQogICAgICAgICAgbWlkZGxlOiB7IGVuYWJsZWQ6IGZhbHNlLCBzY2FsZUZhY3RvcjogMSB9LAogICAgICAgICAgZnJvbTogeyBlbmFibGVkOiBmYWxzZSwgc2NhbGVGYWN0b3I6IDEgfQogICAgICAgIH0sCiAgICAgICAgY29sb3I6IHsKICAgICAgICAgIGNvbG9yOiAnIzg0ODQ4NCcsCiAgICAgICAgICBoaWdobGlnaHQ6ICcjODQ4NDg0JywKICAgICAgICAgIGhvdmVyOiAnIzg0ODQ4NCcsCiAgICAgICAgICBpbmhlcml0OiAnZnJvbScsCiAgICAgICAgICBvcGFjaXR5OiAxCiAgICAgICAgfSwKICAgICAgICBkYXNoZXM6IGZhbHNlLAogICAgICAgIGZvbnQ6IHsKICAgICAgICAgIGNvbG9yOiAnIzM0MzQzNCcsCiAgICAgICAgICBzaXplOiAxNCwgLy8gcHgKICAgICAgICAgIGZhY2U6ICdhcmlhbCcsCiAgICAgICAgICBiYWNrZ3JvdW5kOiAnbm9uZScsCiAgICAgICAgICBzdHJva2VXaWR0aDogMiwgLy8gcHgKICAgICAgICAgIHN0cm9rZUNvbG9yOiAnI2ZmZmZmZicsCiAgICAgICAgICBhbGlnbjogJ2hvcml6b250YWwnCiAgICAgICAgfSwKICAgICAgICBoaWRkZW46IGZhbHNlLAogICAgICAgIGhvdmVyV2lkdGg6IDEuNSwKICAgICAgICBsYWJlbDogdW5kZWZpbmVkLAogICAgICAgIGxlbmd0aDogdW5kZWZpbmVkLAogICAgICAgIHBoeXNpY3M6IHRydWUsCiAgICAgICAgc2NhbGluZzogewogICAgICAgICAgbWluOiAxLAogICAgICAgICAgbWF4OiAxNSwKICAgICAgICAgIGxhYmVsOiB7CiAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsCiAgICAgICAgICAgIG1pbjogMTQsCiAgICAgICAgICAgIG1heDogMzAsCiAgICAgICAgICAgIG1heFZpc2libGU6IDMwLAogICAgICAgICAgICBkcmF3VGhyZXNob2xkOiA1CiAgICAgICAgICB9LAogICAgICAgICAgY3VzdG9tU2NhbGluZ0Z1bmN0aW9uOiBmdW5jdGlvbiBjdXN0b21TY2FsaW5nRnVuY3Rpb24obWluLCBtYXgsIHRvdGFsLCB2YWx1ZSkgewogICAgICAgICAgICBpZiAobWF4ID09PSBtaW4pIHsKICAgICAgICAgICAgICByZXR1cm4gMC41OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBzY2FsZSA9IDEgLyAobWF4IC0gbWluKTsKICAgICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgoMCwgKHZhbHVlIC0gbWluKSAqIHNjYWxlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2VsZWN0aW9uV2lkdGg6IDEuNSwKICAgICAgICBzZWxmUmVmZXJlbmNlU2l6ZTogMjAsCiAgICAgICAgc2hhZG93OiB7CiAgICAgICAgICBlbmFibGVkOiBmYWxzZSwKICAgICAgICAgIHNpemU6IDEwLAogICAgICAgICAgeDogNSwKICAgICAgICAgIHk6IDUKICAgICAgICB9LAogICAgICAgIHNtb290aDogewogICAgICAgICAgZW5hYmxlZDogdHJ1ZSwKICAgICAgICAgIHR5cGU6ICdkeW5hbWljJywKICAgICAgICAgIHJvdW5kbmVzczogMC41CiAgICAgICAgfSwKICAgICAgICB0aXRsZTogdW5kZWZpbmVkLAogICAgICAgIHdpZHRoOiAxLAogICAgICAgIHZhbHVlOiB1bmRlZmluZWQKICAgICAgfTsKCiAgICAgIHV0aWwuZXh0ZW5kKHRoaXMub3B0aW9ucywgdGhpcy5kZWZhdWx0T3B0aW9ucyk7CgogICAgICB0aGlzLmJpbmRFdmVudExpc3RlbmVycygpOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhFZGdlc0hhbmRsZXIsIFt7CiAgICAgIGtleTogJ2JpbmRFdmVudExpc3RlbmVycycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBiaW5kRXZlbnRMaXN0ZW5lcnMoKSB7CiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgIC8vIHRoaXMgYWxsb3dzIGV4dGVybmFsIG1vZHVsZXMgdG8gZm9yY2UgYWxsIGR5bmFtaWMgY3VydmVzIHRvIHR1cm4gc3RhdGljLgogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdfZm9yY2VEaXNhYmxlRHluYW1pY0N1cnZlcycsIGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgICBpZiAodHlwZSA9PT0gJ2R5bmFtaWMnKSB7CiAgICAgICAgICAgIHR5cGUgPSAnY29udGludW91cyc7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZW1pdENoYW5nZSA9IGZhbHNlOwogICAgICAgICAgZm9yICh2YXIgZWRnZUlkIGluIF90aGlzMi5ib2R5LmVkZ2VzKSB7CiAgICAgICAgICAgIGlmIChfdGhpczIuYm9keS5lZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgICAgICAgdmFyIGVkZ2UgPSBfdGhpczIuYm9keS5lZGdlc1tlZGdlSWRdOwogICAgICAgICAgICAgIHZhciBlZGdlRGF0YSA9IF90aGlzMi5ib2R5LmRhdGEuZWRnZXMuX2RhdGFbZWRnZUlkXTsKCiAgICAgICAgICAgICAgLy8gb25seSBmb3JjaWxieSByZW1vdmUgdGhlIHNtb290aCBjdXJ2ZSBpZiB0aGUgZGF0YSBoYXMgYmVlbiBzZXQgb2YgdGhlIGVkZ2UgaGFzIHRoZSBzbW9vdGggY3VydmVzIGRlZmluZWQuCiAgICAgICAgICAgICAgLy8gdGhpcyBpcyBiZWNhdXNlIGEgY2hhbmdlIGluIHRoZSBnbG9iYWwgd291bGQgbm90IGFmZmVjdCB0aGVzZSBjdXJ2ZXMuCiAgICAgICAgICAgICAgaWYgKGVkZ2VEYXRhICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZhciBlZGdlT3B0aW9ucyA9IGVkZ2VEYXRhLnNtb290aDsKICAgICAgICAgICAgICAgIGlmIChlZGdlT3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIGlmIChlZGdlT3B0aW9ucy5lbmFibGVkID09PSB0cnVlICYmIGVkZ2VPcHRpb25zLnR5cGUgPT09ICdkeW5hbWljJykgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgIGVkZ2Uuc2V0T3B0aW9ucyh7IHNtb290aDogZmFsc2UgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGVkZ2Uuc2V0T3B0aW9ucyh7IHNtb290aDogeyB0eXBlOiB0eXBlIH0gfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVtaXRDaGFuZ2UgPSB0cnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZW1pdENoYW5nZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBfdGhpczIuYm9keS5lbWl0dGVyLmVtaXQoJ19kYXRhQ2hhbmdlZCcpOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyB0aGlzIGlzIGNhbGxlZCB3aGVuIG9wdGlvbnMgb2YgRVhJU1RJTkcgbm9kZXMgb3IgZWRnZXMgaGF2ZSBjaGFuZ2VkLgogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdfZGF0YVVwZGF0ZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIucmVjb25uZWN0RWRnZXMoKTsKICAgICAgICAgIF90aGlzMi5tYXJrQWxsRWRnZXNBc0RpcnR5KCk7CiAgICAgICAgfSk7CgogICAgICAgIC8vIHJlZnJlc2ggdGhlIGVkZ2VzLiBVc2VkIHdoZW4gcmV2ZXJ0aW5nIGZyb20gaGllcmFyY2hpY2FsIGxheW91dAogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdyZWZyZXNoRWRnZXMnLCB0aGlzLnJlZnJlc2guYmluZCh0aGlzKSk7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ3JlZnJlc2gnLCB0aGlzLnJlZnJlc2guYmluZCh0aGlzKSk7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ2Rlc3Ryb3knLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBkZWxldGUgX3RoaXMyLmJvZHkuZnVuY3Rpb25zLmNyZWF0ZUVkZ2U7CiAgICAgICAgICBkZWxldGUgX3RoaXMyLmVkZ2VzTGlzdGVuZXJzLmFkZDsKICAgICAgICAgIGRlbGV0ZSBfdGhpczIuZWRnZXNMaXN0ZW5lcnMudXBkYXRlOwogICAgICAgICAgZGVsZXRlIF90aGlzMi5lZGdlc0xpc3RlbmVycy5yZW1vdmU7CiAgICAgICAgICBkZWxldGUgX3RoaXMyLmVkZ2VzTGlzdGVuZXJzOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3NldE9wdGlvbnMnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgaWYgKG9wdGlvbnMgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgLy8gdXNlIHRoZSBwYXJzZXIgZnJvbSB0aGUgRWRnZSBjbGFzcyB0byBmaWxsIGluIGFsbCBzaG9ydGhhbmQgbm90YXRpb25zCiAgICAgICAgICBfY29tcG9uZW50c0VkZ2UyWydkZWZhdWx0J10ucGFyc2VPcHRpb25zKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CgogICAgICAgICAgLy8gaGFubGRlIG11bHRpcGxlIGlucHV0IGNhc2VzIGZvciBjb2xvcgogICAgICAgICAgaWYgKG9wdGlvbnMuY29sb3IgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aGlzLm1hcmtBbGxFZGdlc0FzRGlydHkoKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyB1cGRhdGUgc21vb3RoIHNldHRpbmdzIGluIGFsbCBlZGdlcwogICAgICAgICAgdmFyIGRhdGFDaGFuZ2VkID0gZmFsc2U7CiAgICAgICAgICBpZiAob3B0aW9ucy5zbW9vdGggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBmb3IgKHZhciBlZGdlSWQgaW4gdGhpcy5ib2R5LmVkZ2VzKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYm9keS5lZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgICAgICAgICBkYXRhQ2hhbmdlZCA9IHRoaXMuYm9keS5lZGdlc1tlZGdlSWRdLnVwZGF0ZUVkZ2VUeXBlKCkgfHwgZGF0YUNoYW5nZWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gdXBkYXRlIGZvbnRzIGluIGFsbCBlZGdlcwogICAgICAgICAgaWYgKG9wdGlvbnMuZm9udCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIC8vIHVzZSB0aGUgcGFyc2VyIGZyb20gdGhlIExhYmVsIGNsYXNzIHRvIGZpbGwgaW4gYWxsIHNob3J0aGFuZCBub3RhdGlvbnMKICAgICAgICAgICAgX2NvbXBvbmVudHNTaGFyZWRMYWJlbDJbJ2RlZmF1bHQnXS5wYXJzZU9wdGlvbnModGhpcy5vcHRpb25zLmZvbnQsIG9wdGlvbnMpOwogICAgICAgICAgICBmb3IgKHZhciBlZGdlSWQgaW4gdGhpcy5ib2R5LmVkZ2VzKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYm9keS5lZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJvZHkuZWRnZXNbZWRnZUlkXS51cGRhdGVMYWJlbE1vZHVsZSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgc3RhdGUgb2YgdGhlIHZhcmlhYmxlcyBpZiBuZWVkZWQKICAgICAgICAgIGlmIChvcHRpb25zLmhpZGRlbiAhPT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMucGh5c2ljcyAhPT0gdW5kZWZpbmVkIHx8IGRhdGFDaGFuZ2VkID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19kYXRhQ2hhbmdlZCcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzZXREYXRhJywKCiAgICAgIC8qKgogICAgICAgKiBMb2FkIGVkZ2VzIGJ5IHJlYWRpbmcgdGhlIGRhdGEgdGFibGUKICAgICAgICogQHBhcmFtIHtBcnJheSB8IERhdGFTZXQgfCBEYXRhVmlld30gZWRnZXMgICAgVGhlIGRhdGEgY29udGFpbmluZyB0aGUgZWRnZXMuCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RGF0YShlZGdlcykgewogICAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgICB2YXIgZG9Ob3RFbWl0ID0gYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1sxXTsKCiAgICAgICAgdmFyIG9sZEVkZ2VzRGF0YSA9IHRoaXMuYm9keS5kYXRhLmVkZ2VzOwoKICAgICAgICBpZiAoZWRnZXMgaW5zdGFuY2VvZiBEYXRhU2V0IHx8IGVkZ2VzIGluc3RhbmNlb2YgRGF0YVZpZXcpIHsKICAgICAgICAgIHRoaXMuYm9keS5kYXRhLmVkZ2VzID0gZWRnZXM7CiAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGVkZ2VzKSkgewogICAgICAgICAgdGhpcy5ib2R5LmRhdGEuZWRnZXMgPSBuZXcgRGF0YVNldCgpOwogICAgICAgICAgdGhpcy5ib2R5LmRhdGEuZWRnZXMuYWRkKGVkZ2VzKTsKICAgICAgICB9IGVsc2UgaWYgKCFlZGdlcykgewogICAgICAgICAgdGhpcy5ib2R5LmRhdGEuZWRnZXMgPSBuZXcgRGF0YVNldCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheSBvciBEYXRhU2V0IGV4cGVjdGVkJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBUT0RPOiBpcyB0aGlzIG51bGwgb3IgdW5kZWZpbmVkIG9yIGZhbHNlPwogICAgICAgIGlmIChvbGRFZGdlc0RhdGEpIHsKICAgICAgICAgIC8vIHVuc3Vic2NyaWJlIGZyb20gb2xkIGRhdGFzZXQKICAgICAgICAgIHV0aWwuZm9yRWFjaCh0aGlzLmVkZ2VzTGlzdGVuZXJzLCBmdW5jdGlvbiAoY2FsbGJhY2ssIGV2ZW50KSB7CiAgICAgICAgICAgIG9sZEVkZ2VzRGF0YS5vZmYoZXZlbnQsIGNhbGxiYWNrKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZlIGRyYXduIGVkZ2VzCiAgICAgICAgdGhpcy5ib2R5LmVkZ2VzID0ge307CgogICAgICAgIC8vIFRPRE86IGlzIHRoaXMgbnVsbCBvciB1bmRlZmluZWQgb3IgZmFsc2U/CiAgICAgICAgaWYgKHRoaXMuYm9keS5kYXRhLmVkZ2VzKSB7CiAgICAgICAgICAvLyBzdWJzY3JpYmUgdG8gbmV3IGRhdGFzZXQKICAgICAgICAgIHV0aWwuZm9yRWFjaCh0aGlzLmVkZ2VzTGlzdGVuZXJzLCBmdW5jdGlvbiAoY2FsbGJhY2ssIGV2ZW50KSB7CiAgICAgICAgICAgIF90aGlzMy5ib2R5LmRhdGEuZWRnZXMub24oZXZlbnQsIGNhbGxiYWNrKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIGRyYXcgYWxsIG5ldyBub2RlcwogICAgICAgICAgdmFyIGlkcyA9IHRoaXMuYm9keS5kYXRhLmVkZ2VzLmdldElkcygpOwogICAgICAgICAgdGhpcy5hZGQoaWRzLCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIGlmIChkb05vdEVtaXQgPT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfZGF0YUNoYW5nZWQnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnYWRkJywKCiAgICAgIC8qKgogICAgICAgKiBBZGQgZWRnZXMKICAgICAgICogQHBhcmFtIHtOdW1iZXJbXSB8IFN0cmluZ1tdfSBpZHMKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBhZGQoaWRzKSB7CiAgICAgICAgdmFyIGRvTm90RW1pdCA9IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbMV07CgogICAgICAgIHZhciBlZGdlcyA9IHRoaXMuYm9keS5lZGdlczsKICAgICAgICB2YXIgZWRnZXNEYXRhID0gdGhpcy5ib2R5LmRhdGEuZWRnZXM7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgaWQgPSBpZHNbaV07CgogICAgICAgICAgdmFyIG9sZEVkZ2UgPSBlZGdlc1tpZF07CiAgICAgICAgICBpZiAob2xkRWRnZSkgewogICAgICAgICAgICBvbGRFZGdlLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGF0YSA9IGVkZ2VzRGF0YS5nZXQoaWQsIHsgJ3Nob3dJbnRlcm5hbElkcyc6IHRydWUgfSk7CiAgICAgICAgICBlZGdlc1tpZF0gPSB0aGlzLmNyZWF0ZShkYXRhKTsKICAgICAgICB9CgogICAgICAgIGlmIChkb05vdEVtaXQgPT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfZGF0YUNoYW5nZWQnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAndXBkYXRlJywKCiAgICAgIC8qKgogICAgICAgKiBVcGRhdGUgZXhpc3RpbmcgZWRnZXMsIG9yIGNyZWF0ZSB0aGVtIHdoZW4gbm90IHlldCBleGlzdGluZwogICAgICAgKiBAcGFyYW0ge051bWJlcltdIHwgU3RyaW5nW119IGlkcwogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZShpZHMpIHsKICAgICAgICB2YXIgZWRnZXMgPSB0aGlzLmJvZHkuZWRnZXM7CiAgICAgICAgdmFyIGVkZ2VzRGF0YSA9IHRoaXMuYm9keS5kYXRhLmVkZ2VzOwogICAgICAgIHZhciBkYXRhQ2hhbmdlZCA9IGZhbHNlOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgaWQgPSBpZHNbaV07CiAgICAgICAgICB2YXIgZGF0YSA9IGVkZ2VzRGF0YS5nZXQoaWQpOwogICAgICAgICAgdmFyIGVkZ2UgPSBlZGdlc1tpZF07CiAgICAgICAgICBpZiAoZWRnZSA9PT0gbnVsbCkgewogICAgICAgICAgICAvLyB1cGRhdGUgZWRnZQogICAgICAgICAgICBlZGdlLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgZGF0YUNoYW5nZWQgPSBlZGdlLnNldE9wdGlvbnMoZGF0YSkgfHwgZGF0YUNoYW5nZWQ7IC8vIGlmIGEgc3VwcG9ydCBub2RlIGlzIGFkZGVkLCBkYXRhIGNhbiBiZSBjaGFuZ2VkLgogICAgICAgICAgICBlZGdlLmNvbm5lY3QoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGNyZWF0ZSBlZGdlCiAgICAgICAgICAgIHRoaXMuYm9keS5lZGdlc1tpZF0gPSB0aGlzLmNyZWF0ZShkYXRhKTsKICAgICAgICAgICAgZGF0YUNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGRhdGFDaGFuZ2VkID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfZGF0YUNoYW5nZWQnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX2RhdGFVcGRhdGVkJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3JlbW92ZScsCgogICAgICAvKioKICAgICAgICogUmVtb3ZlIGV4aXN0aW5nIGVkZ2VzLiBOb24gZXhpc3RpbmcgaWRzIHdpbGwgYmUgaWdub3JlZAogICAgICAgKiBAcGFyYW0ge051bWJlcltdIHwgU3RyaW5nW119IGlkcwogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZShpZHMpIHsKICAgICAgICB2YXIgZWRnZXMgPSB0aGlzLmJvZHkuZWRnZXM7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBpZCA9IGlkc1tpXTsKICAgICAgICAgIHZhciBlZGdlID0gZWRnZXNbaWRdOwogICAgICAgICAgaWYgKGVkZ2UgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAoZWRnZS52aWEgIT0gbnVsbCkgewogICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmJvZHkuc3VwcG9ydE5vZGVzW2VkZ2UudmlhLmlkXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlZGdlLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgZGVsZXRlIGVkZ2VzW2lkXTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19kYXRhQ2hhbmdlZCcpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3JlZnJlc2gnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gcmVmcmVzaCgpIHsKICAgICAgICB2YXIgZWRnZXMgPSB0aGlzLmJvZHkuZWRnZXM7CiAgICAgICAgZm9yICh2YXIgZWRnZUlkIGluIGVkZ2VzKSB7CiAgICAgICAgICB2YXIgZWRnZSA9IHVuZGVmaW5lZDsKICAgICAgICAgIGlmIChlZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgICAgIGVkZ2UgPSBlZGdlc1tlZGdlSWRdOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLmJvZHkuZGF0YS5lZGdlcy5fZGF0YVtlZGdlSWRdOwogICAgICAgICAgaWYgKGVkZ2UgIT09IHVuZGVmaW5lZCAmJiBkYXRhICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgZWRnZS5zZXRPcHRpb25zKGRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdjcmVhdGUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKHByb3BlcnRpZXMpIHsKICAgICAgICByZXR1cm4gbmV3IF9jb21wb25lbnRzRWRnZTJbJ2RlZmF1bHQnXShwcm9wZXJ0aWVzLCB0aGlzLmJvZHksIHRoaXMub3B0aW9ucyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnbWFya0FsbEVkZ2VzQXNEaXJ0eScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBtYXJrQWxsRWRnZXNBc0RpcnR5KCkgewogICAgICAgIGZvciAodmFyIGVkZ2VJZCBpbiB0aGlzLmJvZHkuZWRnZXMpIHsKICAgICAgICAgIHRoaXMuYm9keS5lZGdlc1tlZGdlSWRdLmVkZ2VUeXBlLmNvbG9yRGlydHkgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdyZWNvbm5lY3RFZGdlcycsCgogICAgICAvKioKICAgICAgICogUmVjb25uZWN0IGFsbCBlZGdlcwogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlY29ubmVjdEVkZ2VzKCkgewogICAgICAgIHZhciBpZDsKICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLmJvZHkubm9kZXM7CiAgICAgICAgdmFyIGVkZ2VzID0gdGhpcy5ib2R5LmVkZ2VzOwoKICAgICAgICBmb3IgKGlkIGluIG5vZGVzKSB7CiAgICAgICAgICBpZiAobm9kZXMuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgICAgICAgIG5vZGVzW2lkXS5lZGdlcyA9IFtdOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm9yIChpZCBpbiBlZGdlcykgewogICAgICAgICAgaWYgKGVkZ2VzLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgICAgICB2YXIgZWRnZSA9IGVkZ2VzW2lkXTsKICAgICAgICAgICAgZWRnZS5mcm9tID0gbnVsbDsKICAgICAgICAgICAgZWRnZS50byA9IG51bGw7CiAgICAgICAgICAgIGVkZ2UuY29ubmVjdCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdnZXRDb25uZWN0ZWROb2RlcycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb25uZWN0ZWROb2RlcyhlZGdlSWQpIHsKICAgICAgICB2YXIgbm9kZUxpc3QgPSBbXTsKICAgICAgICBpZiAodGhpcy5ib2R5LmVkZ2VzW2VkZ2VJZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdmFyIGVkZ2UgPSB0aGlzLmJvZHkuZWRnZXNbZWRnZUlkXTsKICAgICAgICAgIGlmIChlZGdlLmZyb21JZCkgewogICAgICAgICAgICBub2RlTGlzdC5wdXNoKGVkZ2UuZnJvbUlkKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChlZGdlLnRvSWQpIHsKICAgICAgICAgICAgbm9kZUxpc3QucHVzaChlZGdlLnRvSWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbm9kZUxpc3Q7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gRWRnZXNIYW5kbGVyOwogIH0pKCk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IEVkZ2VzSGFuZGxlcjsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDgyICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIHZhciBfc2hhcmVkTGFiZWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYzKTsKCiAgdmFyIF9zaGFyZWRMYWJlbDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zaGFyZWRMYWJlbCk7CgogIHZhciBfZWRnZXNCZXppZXJFZGdlRHluYW1pYyA9IF9fd2VicGFja19yZXF1aXJlX18oODMpOwoKICB2YXIgX2VkZ2VzQmV6aWVyRWRnZUR5bmFtaWMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZWRnZXNCZXppZXJFZGdlRHluYW1pYyk7CgogIHZhciBfZWRnZXNCZXppZXJFZGdlU3RhdGljID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4Nik7CgogIHZhciBfZWRnZXNCZXppZXJFZGdlU3RhdGljMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2VkZ2VzQmV6aWVyRWRnZVN0YXRpYyk7CgogIHZhciBfZWRnZXNTdHJhaWdodEVkZ2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg3KTsKCiAgdmFyIF9lZGdlc1N0cmFpZ2h0RWRnZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9lZGdlc1N0cmFpZ2h0RWRnZSk7CgogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgLyoqCiAgICogQGNsYXNzIEVkZ2UKICAgKgogICAqIEEgZWRnZSBjb25uZWN0cyB0d28gbm9kZXMKICAgKiBAcGFyYW0ge09iamVjdH0gcHJvcGVydGllcyAgICAgT2JqZWN0IHdpdGggb3B0aW9ucy4gTXVzdCBjb250YWluCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF0IGxlYXN0IG9wdGlvbnMgZnJvbSBhbmQgdG8uCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF2YWlsYWJsZSBvcHRpb25zOiBmcm9tIChudW1iZXIpLAogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byAobnVtYmVyKSwgbGFiZWwgKHN0cmluZywgY29sb3IgKHN0cmluZyksCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoIChudW1iZXIpLCBzdHlsZSAoc3RyaW5nKSwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoIChudW1iZXIpLCB0aXRsZSAoc3RyaW5nKQogICAqIEBwYXJhbSB7TmV0d29ya30gbmV0d29yayAgICAgICBBIE5ldHdvcmsgb2JqZWN0LCB1c2VkIHRvIGZpbmQgYW5kIGVkZ2UgdG8KICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXMuCiAgICogQHBhcmFtIHtPYmplY3R9IGNvbnN0YW50cyAgICAgIEFuIG9iamVjdCB3aXRoIGRlZmF1bHQgdmFsdWVzIGZvcgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGFtcGxlIGZvciB0aGUgY29sb3IKICAgKi8KCiAgdmFyIEVkZ2UgPSAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gRWRnZShvcHRpb25zLCBib2R5LCBnbG9iYWxPcHRpb25zKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFZGdlKTsKCiAgICAgIGlmIChib2R5ID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aHJvdyAnTm8gYm9keSBwcm92aWRlZCc7CiAgICAgIH0KICAgICAgdGhpcy5vcHRpb25zID0gdXRpbC5icmlkZ2VPYmplY3QoZ2xvYmFsT3B0aW9ucyk7CiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CgogICAgICAvLyBpbml0aWFsaXplIHZhcmlhYmxlcwogICAgICB0aGlzLmlkID0gdW5kZWZpbmVkOwogICAgICB0aGlzLmZyb21JZCA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy50b0lkID0gdW5kZWZpbmVkOwogICAgICB0aGlzLnNlbGVjdGVkID0gZmFsc2U7CiAgICAgIHRoaXMuaG92ZXIgPSBmYWxzZTsKICAgICAgdGhpcy5sYWJlbERpcnR5ID0gdHJ1ZTsKICAgICAgdGhpcy5jb2xvckRpcnR5ID0gdHJ1ZTsKCiAgICAgIHRoaXMuYmFzZVdpZHRoID0gdGhpcy5vcHRpb25zLndpZHRoOwogICAgICB0aGlzLmJhc2VGb250U2l6ZSA9IHRoaXMub3B0aW9ucy5mb250LnNpemU7CgogICAgICB0aGlzLmZyb20gPSB1bmRlZmluZWQ7IC8vIGEgbm9kZQogICAgICB0aGlzLnRvID0gdW5kZWZpbmVkOyAvLyBhIG5vZGUKCiAgICAgIHRoaXMuZWRnZVR5cGUgPSB1bmRlZmluZWQ7CgogICAgICB0aGlzLmNvbm5lY3RlZCA9IGZhbHNlOwoKICAgICAgdGhpcy5sYWJlbE1vZHVsZSA9IG5ldyBfc2hhcmVkTGFiZWwyWydkZWZhdWx0J10odGhpcy5ib2R5LCB0aGlzLm9wdGlvbnMpOwoKICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhFZGdlLCBbewogICAgICBrZXk6ICdzZXRPcHRpb25zJywKCiAgICAgIC8qKgogICAgICAgKiBTZXQgb3Igb3ZlcndyaXRlIG9wdGlvbnMgZm9yIHRoZSBlZGdlCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICBhbiBvYmplY3Qgd2l0aCBvcHRpb25zCiAgICAgICAqIEBwYXJhbSBkb05vdEVtaXQKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICBpZiAoIW9wdGlvbnMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5jb2xvckRpcnR5ID0gdHJ1ZTsKCiAgICAgICAgRWRnZS5wYXJzZU9wdGlvbnModGhpcy5vcHRpb25zLCBvcHRpb25zLCB0cnVlKTsKCiAgICAgICAgaWYgKG9wdGlvbnMuaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5pZCA9IG9wdGlvbnMuaWQ7CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLmZyb20gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5mcm9tSWQgPSBvcHRpb25zLmZyb207CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLnRvICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMudG9JZCA9IG9wdGlvbnMudG87CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLnRpdGxlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMudGl0bGUgPSBvcHRpb25zLnRpdGxlOwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBvcHRpb25zLnZhbHVlID0gcGFyc2VGbG9hdChvcHRpb25zLnZhbHVlKTsKICAgICAgICB9CgogICAgICAgIC8vIHVwZGF0ZSBsYWJlbCBNb2R1bGUKICAgICAgICB0aGlzLnVwZGF0ZUxhYmVsTW9kdWxlKCk7CgogICAgICAgIHZhciBkYXRhQ2hhbmdlZCA9IHRoaXMudXBkYXRlRWRnZVR5cGUoKTsKCiAgICAgICAgLy8gaWYgYW55dGhpbmcgaGFzIGJlZW4gdXBkYXRlcywgcmVzZXQgdGhlIHNlbGVjdGlvbiB3aWR0aCBhbmQgdGhlIGhvdmVyIHdpZHRoCiAgICAgICAgdGhpcy5fc2V0SW50ZXJhY3Rpb25XaWR0aHMoKTsKCiAgICAgICAgLy8gQSBub2RlIGlzIGNvbm5lY3RlZCB3aGVuIGl0IGhhcyBhIGZyb20gYW5kIHRvIG5vZGUgdGhhdCBib3RoIGV4aXN0IGluIHRoZSBuZXR3b3JrLmJvZHkubm9kZXMuCiAgICAgICAgdGhpcy5jb25uZWN0KCk7CgogICAgICAgIGlmIChvcHRpb25zLmhpZGRlbiAhPT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMucGh5c2ljcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBkYXRhQ2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZGF0YUNoYW5nZWQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAndXBkYXRlTGFiZWxNb2R1bGUnLAoKICAgICAgLyoqCiAgICAgICAqIHVwZGF0ZSB0aGUgb3B0aW9ucyBpbiB0aGUgbGFiZWwgbW9kdWxlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlTGFiZWxNb2R1bGUoKSB7CiAgICAgICAgdGhpcy5sYWJlbE1vZHVsZS5zZXRPcHRpb25zKHRoaXMub3B0aW9ucywgdHJ1ZSk7CiAgICAgICAgaWYgKHRoaXMubGFiZWxNb2R1bGUuYmFzZVNpemUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5iYXNlRm9udFNpemUgPSB0aGlzLmxhYmVsTW9kdWxlLmJhc2VTaXplOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICd1cGRhdGVFZGdlVHlwZScsCgogICAgICAvKioKICAgICAgICogdXBkYXRlIHRoZSBlZGdlIHR5cGUsIHNldCB0aGUgb3B0aW9ucwogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVFZGdlVHlwZSgpIHsKICAgICAgICB2YXIgZGF0YUNoYW5nZWQgPSBmYWxzZTsKICAgICAgICB2YXIgY2hhbmdlSW5UeXBlID0gdHJ1ZTsKICAgICAgICBpZiAodGhpcy5lZGdlVHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAodGhpcy5lZGdlVHlwZSBpbnN0YW5jZW9mIF9lZGdlc0JlemllckVkZ2VEeW5hbWljMlsnZGVmYXVsdCddICYmIHRoaXMub3B0aW9ucy5zbW9vdGguZW5hYmxlZCA9PT0gdHJ1ZSAmJiB0aGlzLm9wdGlvbnMuc21vb3RoLnR5cGUgPT09ICdkeW5hbWljJykgewogICAgICAgICAgICBjaGFuZ2VJblR5cGUgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmVkZ2VUeXBlIGluc3RhbmNlb2YgX2VkZ2VzQmV6aWVyRWRnZVN0YXRpYzJbJ2RlZmF1bHQnXSAmJiB0aGlzLm9wdGlvbnMuc21vb3RoLmVuYWJsZWQgPT09IHRydWUgJiYgdGhpcy5vcHRpb25zLnNtb290aC50eXBlICE9PSAnZHluYW1pYycpIHsKICAgICAgICAgICAgY2hhbmdlSW5UeXBlID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5lZGdlVHlwZSBpbnN0YW5jZW9mIF9lZGdlc1N0cmFpZ2h0RWRnZTJbJ2RlZmF1bHQnXSAmJiB0aGlzLm9wdGlvbnMuc21vb3RoLmVuYWJsZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIGNoYW5nZUluVHlwZSA9IGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChjaGFuZ2VJblR5cGUgPT09IHRydWUpIHsKICAgICAgICAgICAgZGF0YUNoYW5nZWQgPSB0aGlzLmVkZ2VUeXBlLmNsZWFudXAoKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChjaGFuZ2VJblR5cGUgPT09IHRydWUpIHsKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc21vb3RoLmVuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zbW9vdGgudHlwZSA9PT0gJ2R5bmFtaWMnKSB7CiAgICAgICAgICAgICAgZGF0YUNoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMuZWRnZVR5cGUgPSBuZXcgX2VkZ2VzQmV6aWVyRWRnZUR5bmFtaWMyWydkZWZhdWx0J10odGhpcy5vcHRpb25zLCB0aGlzLmJvZHksIHRoaXMubGFiZWxNb2R1bGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuZWRnZVR5cGUgPSBuZXcgX2VkZ2VzQmV6aWVyRWRnZVN0YXRpYzJbJ2RlZmF1bHQnXSh0aGlzLm9wdGlvbnMsIHRoaXMuYm9keSwgdGhpcy5sYWJlbE1vZHVsZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZWRnZVR5cGUgPSBuZXcgX2VkZ2VzU3RyYWlnaHRFZGdlMlsnZGVmYXVsdCddKHRoaXMub3B0aW9ucywgdGhpcy5ib2R5LCB0aGlzLmxhYmVsTW9kdWxlKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gaWYgbm90aGluZyBjaGFuZ2VzLCB3ZSBqdXN0IHNldCB0aGUgb3B0aW9ucy4KICAgICAgICAgIHRoaXMuZWRnZVR5cGUuc2V0T3B0aW9ucyh0aGlzLm9wdGlvbnMpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRhdGFDaGFuZ2VkOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3RvZ2dsZVBoeXNpY3MnLAoKICAgICAgLyoqCiAgICAgICAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSBwaHlzaWNzLgogICAgICAgKiBAcGFyYW0gc3RhdHVzCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gdG9nZ2xlUGh5c2ljcyhzdGF0dXMpIHsKICAgICAgICB0aGlzLm9wdGlvbnMucGh5c2ljcyA9IHN0YXR1czsKICAgICAgICB0aGlzLmVkZ2VUeXBlLnRvZ2dsZVBoeXNpY3Moc3RhdHVzKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdjb25uZWN0JywKCiAgICAgIC8qKgogICAgICAgKiBDb25uZWN0IGFuIGVkZ2UgdG8gaXRzIG5vZGVzCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gY29ubmVjdCgpIHsKICAgICAgICB0aGlzLmRpc2Nvbm5lY3QoKTsKCiAgICAgICAgdGhpcy5mcm9tID0gdGhpcy5ib2R5Lm5vZGVzW3RoaXMuZnJvbUlkXSB8fCB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy50byA9IHRoaXMuYm9keS5ub2Rlc1t0aGlzLnRvSWRdIHx8IHVuZGVmaW5lZDsKICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IHRoaXMuZnJvbSAhPT0gdW5kZWZpbmVkICYmIHRoaXMudG8gIT09IHVuZGVmaW5lZDsKCiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmZyb20uYXR0YWNoRWRnZSh0aGlzKTsKICAgICAgICAgIHRoaXMudG8uYXR0YWNoRWRnZSh0aGlzKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHRoaXMuZnJvbSkgewogICAgICAgICAgICB0aGlzLmZyb20uZGV0YWNoRWRnZSh0aGlzKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLnRvKSB7CiAgICAgICAgICAgIHRoaXMudG8uZGV0YWNoRWRnZSh0aGlzKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuZWRnZVR5cGUuY29ubmVjdCgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2Rpc2Nvbm5lY3QnLAoKICAgICAgLyoqCiAgICAgICAqIERpc2Nvbm5lY3QgYW4gZWRnZSBmcm9tIGl0cyBub2RlcwogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2Nvbm5lY3QoKSB7CiAgICAgICAgaWYgKHRoaXMuZnJvbSkgewogICAgICAgICAgdGhpcy5mcm9tLmRldGFjaEVkZ2UodGhpcyk7CiAgICAgICAgICB0aGlzLmZyb20gPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnRvKSB7CiAgICAgICAgICB0aGlzLnRvLmRldGFjaEVkZ2UodGhpcyk7CiAgICAgICAgICB0aGlzLnRvID0gdW5kZWZpbmVkOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSBmYWxzZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdnZXRUaXRsZScsCgogICAgICAvKioKICAgICAgICogZ2V0IHRoZSB0aXRsZSBvZiB0aGlzIGVkZ2UuCiAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gdGl0bGUgICAgVGhlIHRpdGxlIG9mIHRoZSBlZGdlLCBvciB1bmRlZmluZWQgd2hlbiBubyB0aXRsZQogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhcyBiZWVuIHNldC4KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRUaXRsZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy50aXRsZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdpc1NlbGVjdGVkJywKCiAgICAgIC8qKgogICAgICAgKiBjaGVjayBpZiB0aGlzIG5vZGUgaXMgc2VsZWN0ZQogICAgICAgKiBAcmV0dXJuIHtib29sZWFufSBzZWxlY3RlZCAgIFRydWUgaWYgbm9kZSBpcyBzZWxlY3RlZCwgZWxzZSBmYWxzZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzU2VsZWN0ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZ2V0VmFsdWUnLAoKICAgICAgLyoqCiAgICAgICAqIFJldHJpZXZlIHRoZSB2YWx1ZSBvZiB0aGUgZWRnZS4gQ2FuIGJlIHVuZGVmaW5lZAogICAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IHZhbHVlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy52YWx1ZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzZXRWYWx1ZVJhbmdlJywKCiAgICAgIC8qKgogICAgICAgKiBBZGp1c3QgdGhlIHZhbHVlIHJhbmdlIG9mIHRoZSBlZGdlLiBUaGUgZWRnZSB3aWxsIGFkanVzdCBpdCdzIHdpZHRoCiAgICAgICAqIGJhc2VkIG9uIGl0cyB2YWx1ZS4KICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IG1pbgogICAgICAgKiBAcGFyYW0ge051bWJlcn0gbWF4CiAgICAgICAqIEBwYXJhbSB0b3RhbAogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlUmFuZ2UobWluLCBtYXgsIHRvdGFsKSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy52YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgc2NhbGUgPSB0aGlzLm9wdGlvbnMuc2NhbGluZy5jdXN0b21TY2FsaW5nRnVuY3Rpb24obWluLCBtYXgsIHRvdGFsLCB0aGlzLm9wdGlvbnMudmFsdWUpOwogICAgICAgICAgdmFyIHdpZHRoRGlmZiA9IHRoaXMub3B0aW9ucy5zY2FsaW5nLm1heCAtIHRoaXMub3B0aW9ucy5zY2FsaW5nLm1pbjsKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2NhbGluZy5sYWJlbC5lbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgIHZhciBmb250RGlmZiA9IHRoaXMub3B0aW9ucy5zY2FsaW5nLmxhYmVsLm1heCAtIHRoaXMub3B0aW9ucy5zY2FsaW5nLmxhYmVsLm1pbjsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLmZvbnQuc2l6ZSA9IHRoaXMub3B0aW9ucy5zY2FsaW5nLmxhYmVsLm1pbiArIHNjYWxlICogZm9udERpZmY7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm9wdGlvbnMud2lkdGggPSB0aGlzLm9wdGlvbnMuc2NhbGluZy5taW4gKyBzY2FsZSAqIHdpZHRoRGlmZjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5vcHRpb25zLndpZHRoID0gdGhpcy5iYXNlV2lkdGg7CiAgICAgICAgICB0aGlzLm9wdGlvbnMuZm9udC5zaXplID0gdGhpcy5iYXNlRm9udFNpemU7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9zZXRJbnRlcmFjdGlvbldpZHRocygpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19zZXRJbnRlcmFjdGlvbldpZHRocycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0SW50ZXJhY3Rpb25XaWR0aHMoKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMuaG92ZXJXaWR0aCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdGhpcy5lZGdlVHlwZS5ob3ZlcldpZHRoID0gdGhpcy5vcHRpb25zLmhvdmVyV2lkdGgodGhpcy5vcHRpb25zLndpZHRoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5lZGdlVHlwZS5ob3ZlcldpZHRoID0gdGhpcy5vcHRpb25zLmhvdmVyV2lkdGggKyB0aGlzLm9wdGlvbnMud2lkdGg7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5zZWxlY3Rpb25XaWR0aCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdGhpcy5lZGdlVHlwZS5zZWxlY3Rpb25XaWR0aCA9IHRoaXMub3B0aW9ucy5zZWxlY3Rpb25XaWR0aCh0aGlzLm9wdGlvbnMud2lkdGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmVkZ2VUeXBlLnNlbGVjdGlvbldpZHRoID0gdGhpcy5vcHRpb25zLnNlbGVjdGlvbldpZHRoICsgdGhpcy5vcHRpb25zLndpZHRoOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdkcmF3JywKCiAgICAgIC8qKgogICAgICAgKiBSZWRyYXcgYSBlZGdlCiAgICAgICAqIERyYXcgdGhpcyBlZGdlIGluIHRoZSBnaXZlbiBjYW52YXMKICAgICAgICogVGhlIDJkIGNvbnRleHQgb2YgYSBIVE1MIGNhbnZhcyBjYW4gYmUgcmV0cmlldmVkIGJ5IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gICBjdHgKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KGN0eCkgewogICAgICAgIHZhciB2aWEgPSB0aGlzLmVkZ2VUeXBlLmRyYXdMaW5lKGN0eCwgdGhpcy5zZWxlY3RlZCwgdGhpcy5ob3Zlcik7CiAgICAgICAgdGhpcy5kcmF3QXJyb3dzKGN0eCwgdmlhKTsKICAgICAgICB0aGlzLmRyYXdMYWJlbChjdHgsIHZpYSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZHJhd0Fycm93cycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3QXJyb3dzKGN0eCwgdmlhTm9kZSkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXJyb3dzLmZyb20uZW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy5lZGdlVHlwZS5kcmF3QXJyb3dIZWFkKGN0eCwgJ2Zyb20nLCB2aWFOb2RlLCB0aGlzLnNlbGVjdGVkLCB0aGlzLmhvdmVyKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hcnJvd3MubWlkZGxlLmVuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuZWRnZVR5cGUuZHJhd0Fycm93SGVhZChjdHgsICdtaWRkbGUnLCB2aWFOb2RlLCB0aGlzLnNlbGVjdGVkLCB0aGlzLmhvdmVyKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hcnJvd3MudG8uZW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy5lZGdlVHlwZS5kcmF3QXJyb3dIZWFkKGN0eCwgJ3RvJywgdmlhTm9kZSwgdGhpcy5zZWxlY3RlZCwgdGhpcy5ob3Zlcik7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RyYXdMYWJlbCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3TGFiZWwoY3R4LCB2aWFOb2RlKSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5sYWJlbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvLyBzZXQgc3R5bGUKICAgICAgICAgIHZhciBub2RlMSA9IHRoaXMuZnJvbTsKICAgICAgICAgIHZhciBub2RlMiA9IHRoaXMudG87CiAgICAgICAgICB2YXIgc2VsZWN0ZWQgPSB0aGlzLmZyb20uc2VsZWN0ZWQgfHwgdGhpcy50by5zZWxlY3RlZCB8fCB0aGlzLnNlbGVjdGVkOwogICAgICAgICAgaWYgKG5vZGUxLmlkICE9IG5vZGUyLmlkKSB7CiAgICAgICAgICAgIHRoaXMubGFiZWxNb2R1bGUucG9pbnRUb1NlbGYgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIHBvaW50ID0gdGhpcy5lZGdlVHlwZS5nZXRQb2ludCgwLjUsIHZpYU5vZGUpOwogICAgICAgICAgICBjdHguc2F2ZSgpOwoKICAgICAgICAgICAgLy8gaWYgdGhlIGxhYmVsIGhhcyB0byBiZSByb3RhdGVkOgogICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmZvbnQuYWxpZ24gIT09ICdob3Jpem9udGFsJykgewogICAgICAgICAgICAgIHRoaXMubGFiZWxNb2R1bGUuY2FsY3VsYXRlTGFiZWxTaXplKGN0eCwgc2VsZWN0ZWQsIHBvaW50LngsIHBvaW50LnkpOwogICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUocG9pbnQueCwgdGhpcy5sYWJlbE1vZHVsZS5zaXplLnlMaW5lKTsKICAgICAgICAgICAgICB0aGlzLl9yb3RhdGVGb3JMYWJlbEFsaWdubWVudChjdHgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBkcmF3IHRoZSBsYWJlbAogICAgICAgICAgICB0aGlzLmxhYmVsTW9kdWxlLmRyYXcoY3R4LCBwb2ludC54LCBwb2ludC55LCBzZWxlY3RlZCk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBJZ25vcmUgdGhlIG9yaWVudGF0aW9ucy4KICAgICAgICAgICAgdGhpcy5sYWJlbE1vZHVsZS5wb2ludFRvU2VsZiA9IHRydWU7CiAgICAgICAgICAgIHZhciB4LCB5OwogICAgICAgICAgICB2YXIgcmFkaXVzID0gdGhpcy5vcHRpb25zLnNlbGZSZWZlcmVuY2VTaXplOwogICAgICAgICAgICBpZiAobm9kZTEuc2hhcGUud2lkdGggPiBub2RlMS5zaGFwZS5oZWlnaHQpIHsKICAgICAgICAgICAgICB4ID0gbm9kZTEueCArIG5vZGUxLnNoYXBlLndpZHRoICogMC41OwogICAgICAgICAgICAgIHkgPSBub2RlMS55IC0gcmFkaXVzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHggPSBub2RlMS54ICsgcmFkaXVzOwogICAgICAgICAgICAgIHkgPSBub2RlMS55IC0gbm9kZTEuc2hhcGUuaGVpZ2h0ICogMC41OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBvaW50ID0gdGhpcy5fcG9pbnRPbkNpcmNsZSh4LCB5LCByYWRpdXMsIDAuMTI1KTsKICAgICAgICAgICAgdGhpcy5sYWJlbE1vZHVsZS5kcmF3KGN0eCwgcG9pbnQueCwgcG9pbnQueSwgc2VsZWN0ZWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdpc092ZXJsYXBwaW5nV2l0aCcsCgogICAgICAvKioKICAgICAgICogQ2hlY2sgaWYgdGhpcyBvYmplY3QgaXMgb3ZlcmxhcHBpbmcgd2l0aCB0aGUgcHJvdmlkZWQgb2JqZWN0CiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmogICBhbiBvYmplY3Qgd2l0aCBwYXJhbWV0ZXJzIGxlZnQsIHRvcAogICAgICAgKiBAcmV0dXJuIHtib29sZWFufSAgICAgVHJ1ZSBpZiBsb2NhdGlvbiBpcyBsb2NhdGVkIG9uIHRoZSBlZGdlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gaXNPdmVybGFwcGluZ1dpdGgob2JqKSB7CiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkKSB7CiAgICAgICAgICB2YXIgZGlzdE1heCA9IDEwOwogICAgICAgICAgdmFyIHhGcm9tID0gdGhpcy5mcm9tLng7CiAgICAgICAgICB2YXIgeUZyb20gPSB0aGlzLmZyb20ueTsKICAgICAgICAgIHZhciB4VG8gPSB0aGlzLnRvLng7CiAgICAgICAgICB2YXIgeVRvID0gdGhpcy50by55OwogICAgICAgICAgdmFyIHhPYmogPSBvYmoubGVmdDsKICAgICAgICAgIHZhciB5T2JqID0gb2JqLnRvcDsKCiAgICAgICAgICB2YXIgZGlzdCA9IHRoaXMuZWRnZVR5cGUuZ2V0RGlzdGFuY2VUb0VkZ2UoeEZyb20sIHlGcm9tLCB4VG8sIHlUbywgeE9iaiwgeU9iaik7CgogICAgICAgICAgcmV0dXJuIGRpc3QgPCBkaXN0TWF4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19yb3RhdGVGb3JMYWJlbEFsaWdubWVudCcsCgogICAgICAvKioKICAgICAgICogUm90YXRlcyB0aGUgY2FudmFzIHNvIHRoZSB0ZXh0IGlzIG1vc3QgcmVhZGFibGUKICAgICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yb3RhdGVGb3JMYWJlbEFsaWdubWVudChjdHgpIHsKICAgICAgICB2YXIgZHkgPSB0aGlzLmZyb20ueSAtIHRoaXMudG8ueTsKICAgICAgICB2YXIgZHggPSB0aGlzLmZyb20ueCAtIHRoaXMudG8ueDsKICAgICAgICB2YXIgYW5nbGVJbkRlZ3JlZXMgPSBNYXRoLmF0YW4yKGR5LCBkeCk7CgogICAgICAgIC8vIHJvdGF0ZSBzbyBsYWJlbCBpdCBpcyByZWFkYWJsZQogICAgICAgIGlmIChhbmdsZUluRGVncmVlcyA8IC0xICYmIGR4IDwgMCB8fCBhbmdsZUluRGVncmVlcyA+IDAgJiYgZHggPCAwKSB7CiAgICAgICAgICBhbmdsZUluRGVncmVlcyA9IGFuZ2xlSW5EZWdyZWVzICsgTWF0aC5QSTsKICAgICAgICB9CgogICAgICAgIGN0eC5yb3RhdGUoYW5nbGVJbkRlZ3JlZXMpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19wb2ludE9uQ2lyY2xlJywKCiAgICAgIC8qKgogICAgICAgKiBHZXQgYSBwb2ludCBvbiBhIGNpcmNsZQogICAgICAgKiBAcGFyYW0ge051bWJlcn0geAogICAgICAgKiBAcGFyYW0ge051bWJlcn0geQogICAgICAgKiBAcGFyYW0ge051bWJlcn0gcmFkaXVzCiAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBwZXJjZW50YWdlLiBWYWx1ZSBiZXR3ZWVuIDAgKGxpbmUgc3RhcnQpIGFuZCAxIChsaW5lIGVuZCkKICAgICAgICogQHJldHVybiB7T2JqZWN0fSBwb2ludAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wb2ludE9uQ2lyY2xlKHgsIHksIHJhZGl1cywgcGVyY2VudGFnZSkgewogICAgICAgIHZhciBhbmdsZSA9IHBlcmNlbnRhZ2UgKiAyICogTWF0aC5QSTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgeDogeCArIHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlKSwKICAgICAgICAgIHk6IHkgLSByYWRpdXMgKiBNYXRoLnNpbihhbmdsZSkKICAgICAgICB9OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3NlbGVjdCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3QoKSB7CiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHRydWU7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAndW5zZWxlY3QnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gdW5zZWxlY3QoKSB7CiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlOwogICAgICB9CiAgICB9XSwgW3sKICAgICAga2V5OiAncGFyc2VPcHRpb25zJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBhcnNlT3B0aW9ucyhwYXJlbnRPcHRpb25zLCBuZXdPcHRpb25zKSB7CiAgICAgICAgdmFyIGFsbG93RGVsZXRpb24gPSBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzJdOwoKICAgICAgICB2YXIgZmllbGRzID0gWydpZCcsICdmcm9tJywgJ2hpZGRlbicsICdob3ZlcldpZHRoJywgJ2xhYmVsJywgJ2xlbmd0aCcsICdsaW5lJywgJ29wYWNpdHknLCAncGh5c2ljcycsICdzZWxlY3Rpb25XaWR0aCcsICdzZWxmUmVmZXJlbmNlU2l6ZScsICd0bycsICd0aXRsZScsICd2YWx1ZScsICd3aWR0aCddOwoKICAgICAgICAvLyBvbmx5IGRlZXAgZXh0ZW5kIHRoZSBpdGVtcyBpbiB0aGUgZmllbGQgYXJyYXkuIFRoZXNlIGRvIG5vdCBoYXZlIHNob3J0aGFuZC4KICAgICAgICB1dGlsLnNlbGVjdGl2ZURlZXBFeHRlbmQoZmllbGRzLCBwYXJlbnRPcHRpb25zLCBuZXdPcHRpb25zLCBhbGxvd0RlbGV0aW9uKTsKCiAgICAgICAgdXRpbC5tZXJnZU9wdGlvbnMocGFyZW50T3B0aW9ucywgbmV3T3B0aW9ucywgJ3Ntb290aCcpOwogICAgICAgIHV0aWwubWVyZ2VPcHRpb25zKHBhcmVudE9wdGlvbnMsIG5ld09wdGlvbnMsICdzaGFkb3cnKTsKCiAgICAgICAgaWYgKG5ld09wdGlvbnMuZGFzaGVzICE9PSB1bmRlZmluZWQgJiYgbmV3T3B0aW9ucy5kYXNoZXMgIT09IG51bGwpIHsKICAgICAgICAgIHBhcmVudE9wdGlvbnMuZGFzaGVzID0gbmV3T3B0aW9ucy5kYXNoZXM7CiAgICAgICAgfSBlbHNlIGlmIChhbGxvd0RlbGV0aW9uID09PSB0cnVlICYmIG5ld09wdGlvbnMuZGFzaGVzID09PSBudWxsKSB7CiAgICAgICAgICBwYXJlbnRPcHRpb25zLmRhc2hlcyA9IHVuZGVmaW5lZDsKICAgICAgICAgIGRlbGV0ZSBwYXJlbnRPcHRpb25zLmRhc2hlczsKICAgICAgICB9CgogICAgICAgIC8vIHNldCB0aGUgc2NhbGluZyBuZXdPcHRpb25zCiAgICAgICAgaWYgKG5ld09wdGlvbnMuc2NhbGluZyAhPT0gdW5kZWZpbmVkICYmIG5ld09wdGlvbnMuc2NhbGluZyAhPT0gbnVsbCkgewogICAgICAgICAgaWYgKG5ld09wdGlvbnMuc2NhbGluZy5taW4gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBwYXJlbnRPcHRpb25zLnNjYWxpbmcubWluID0gbmV3T3B0aW9ucy5zY2FsaW5nLm1pbjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChuZXdPcHRpb25zLnNjYWxpbmcubWF4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcGFyZW50T3B0aW9ucy5zY2FsaW5nLm1heCA9IG5ld09wdGlvbnMuc2NhbGluZy5tYXg7CiAgICAgICAgICB9CiAgICAgICAgICB1dGlsLm1lcmdlT3B0aW9ucyhwYXJlbnRPcHRpb25zLnNjYWxpbmcsIG5ld09wdGlvbnMuc2NhbGluZywgJ2xhYmVsJyk7CiAgICAgICAgfSBlbHNlIGlmIChhbGxvd0RlbGV0aW9uID09PSB0cnVlICYmIG5ld09wdGlvbnMuc2NhbGluZyA9PT0gbnVsbCkgewogICAgICAgICAgcGFyZW50T3B0aW9ucy5zY2FsaW5nID0gdW5kZWZpbmVkOwogICAgICAgICAgZGVsZXRlIHBhcmVudE9wdGlvbnMuc2NhbGluZzsKICAgICAgICB9CgogICAgICAgIC8vIGhhbmxkZSBtdWx0aXBsZSBpbnB1dCBjYXNlcyBmb3IgYXJyb3dzCiAgICAgICAgaWYgKG5ld09wdGlvbnMuYXJyb3dzICE9PSB1bmRlZmluZWQgJiYgbmV3T3B0aW9ucy5hcnJvd3MgIT09IG51bGwpIHsKICAgICAgICAgIGlmICh0eXBlb2YgbmV3T3B0aW9ucy5hcnJvd3MgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIHZhciBhcnJvd3MgPSBuZXdPcHRpb25zLmFycm93cy50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBpZiAoYXJyb3dzLmluZGV4T2YoJ3RvJykgIT0gLTEpIHsKICAgICAgICAgICAgICBwYXJlbnRPcHRpb25zLmFycm93cy50by5lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJyb3dzLmluZGV4T2YoJ21pZGRsZScpICE9IC0xKSB7CiAgICAgICAgICAgICAgcGFyZW50T3B0aW9ucy5hcnJvd3MubWlkZGxlLmVuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhcnJvd3MuaW5kZXhPZignZnJvbScpICE9IC0xKSB7CiAgICAgICAgICAgICAgcGFyZW50T3B0aW9ucy5hcnJvd3MuZnJvbS5lbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbmV3T3B0aW9ucy5hcnJvd3MgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIHV0aWwubWVyZ2VPcHRpb25zKHBhcmVudE9wdGlvbnMuYXJyb3dzLCBuZXdPcHRpb25zLmFycm93cywgJ3RvJyk7CiAgICAgICAgICAgIHV0aWwubWVyZ2VPcHRpb25zKHBhcmVudE9wdGlvbnMuYXJyb3dzLCBuZXdPcHRpb25zLmFycm93cywgJ21pZGRsZScpOwogICAgICAgICAgICB1dGlsLm1lcmdlT3B0aW9ucyhwYXJlbnRPcHRpb25zLmFycm93cywgbmV3T3B0aW9ucy5hcnJvd3MsICdmcm9tJyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBhcnJvdyBuZXdPcHRpb25zIGNhbiBvbmx5IGJlIGFuIG9iamVjdCBvciBhIHN0cmluZy4gUmVmZXIgdG8gdGhlIGRvY3VtZW50YXRpb24uIFlvdSB1c2VkOicgKyBKU09OLnN0cmluZ2lmeShuZXdPcHRpb25zLmFycm93cykpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoYWxsb3dEZWxldGlvbiA9PT0gdHJ1ZSAmJiBuZXdPcHRpb25zLmFycm93cyA9PT0gbnVsbCkgewogICAgICAgICAgcGFyZW50T3B0aW9ucy5hcnJvd3MgPSB1bmRlZmluZWQ7CiAgICAgICAgICBkZWxldGUgcGFyZW50T3B0aW9ucy5hcnJvd3M7CiAgICAgICAgfQoKICAgICAgICAvLyBoYW5sZGUgbXVsdGlwbGUgaW5wdXQgY2FzZXMgZm9yIGNvbG9yCiAgICAgICAgaWYgKG5ld09wdGlvbnMuY29sb3IgIT09IHVuZGVmaW5lZCAmJiBuZXdPcHRpb25zLmNvbG9yICE9PSBudWxsKSB7CiAgICAgICAgICBpZiAodXRpbC5pc1N0cmluZyhuZXdPcHRpb25zLmNvbG9yKSkgewogICAgICAgICAgICBwYXJlbnRPcHRpb25zLmNvbG9yLmNvbG9yID0gbmV3T3B0aW9ucy5jb2xvcjsKICAgICAgICAgICAgcGFyZW50T3B0aW9ucy5jb2xvci5oaWdobGlnaHQgPSBuZXdPcHRpb25zLmNvbG9yOwogICAgICAgICAgICBwYXJlbnRPcHRpb25zLmNvbG9yLmhvdmVyID0gbmV3T3B0aW9ucy5jb2xvcjsKICAgICAgICAgICAgcGFyZW50T3B0aW9ucy5jb2xvci5pbmhlcml0ID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgY29sb3JzRGVmaW5lZCA9IGZhbHNlOwogICAgICAgICAgICBpZiAobmV3T3B0aW9ucy5jb2xvci5jb2xvciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgcGFyZW50T3B0aW9ucy5jb2xvci5jb2xvciA9IG5ld09wdGlvbnMuY29sb3IuY29sb3I7Y29sb3JzRGVmaW5lZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG5ld09wdGlvbnMuY29sb3IuaGlnaGxpZ2h0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBwYXJlbnRPcHRpb25zLmNvbG9yLmhpZ2hsaWdodCA9IG5ld09wdGlvbnMuY29sb3IuaGlnaGxpZ2h0O2NvbG9yc0RlZmluZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXdPcHRpb25zLmNvbG9yLmhvdmVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBwYXJlbnRPcHRpb25zLmNvbG9yLmhvdmVyID0gbmV3T3B0aW9ucy5jb2xvci5ob3Zlcjtjb2xvcnNEZWZpbmVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmV3T3B0aW9ucy5jb2xvci5pbmhlcml0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBwYXJlbnRPcHRpb25zLmNvbG9yLmluaGVyaXQgPSBuZXdPcHRpb25zLmNvbG9yLmluaGVyaXQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG5ld09wdGlvbnMuY29sb3Iub3BhY2l0eSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgcGFyZW50T3B0aW9ucy5jb2xvci5vcGFjaXR5ID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgbmV3T3B0aW9ucy5jb2xvci5vcGFjaXR5KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChuZXdPcHRpb25zLmNvbG9yLmluaGVyaXQgPT09IHVuZGVmaW5lZCAmJiBjb2xvcnNEZWZpbmVkID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgcGFyZW50T3B0aW9ucy5jb2xvci5pbmhlcml0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGFsbG93RGVsZXRpb24gPT09IHRydWUgJiYgbmV3T3B0aW9ucy5jb2xvciA9PT0gbnVsbCkgewogICAgICAgICAgcGFyZW50T3B0aW9ucy5jb2xvciA9IHVuZGVmaW5lZDsKICAgICAgICAgIGRlbGV0ZSBwYXJlbnRPcHRpb25zLmNvbG9yOwogICAgICAgIH0KCiAgICAgICAgLy8gaGFuZGxlIHRoZSBmb250IHNldHRpbmdzCiAgICAgICAgaWYgKG5ld09wdGlvbnMuZm9udCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBfc2hhcmVkTGFiZWwyWydkZWZhdWx0J10ucGFyc2VPcHRpb25zKHBhcmVudE9wdGlvbnMuZm9udCwgbmV3T3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIEVkZ2U7CiAgfSkoKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gRWRnZTsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDgzICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIHZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyBfeCA9IHBhcmVudDsgX3gyID0gcHJvcGVydHk7IF94MyA9IHJlY2VpdmVyOyBfYWdhaW4gPSB0cnVlOyBjb250aW51ZSBfZnVuY3Rpb247IH0gfSBlbHNlIGlmICgndmFsdWUnIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCiAgdmFyIF91dGlsQmV6aWVyRWRnZUJhc2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg0KTsKCiAgdmFyIF91dGlsQmV6aWVyRWRnZUJhc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbEJlemllckVkZ2VCYXNlKTsKCiAgdmFyIEJlemllckVkZ2VEeW5hbWljID0gKGZ1bmN0aW9uIChfQmV6aWVyRWRnZUJhc2UpIHsKICAgIGZ1bmN0aW9uIEJlemllckVkZ2VEeW5hbWljKG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCZXppZXJFZGdlRHluYW1pYyk7CgogICAgICAvL3RoaXMudmlhID0gdW5kZWZpbmVkOyAvLyBIZXJlIGZvciBjb21wbGV0ZW5lc3MgYnV0IG5vdCBhbGxvd2VkIHRvIGRlZmluZWQgYmVmb3JlIHN1cGVyKCkgaXMgaW52b2tlZC4KICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoQmV6aWVyRWRnZUR5bmFtaWMucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7IC8vIC0tPiB0aGlzIGNhbGxzIHRoZSBzZXRPcHRpb25zIGJlbG93CiAgICB9CgogICAgX2luaGVyaXRzKEJlemllckVkZ2VEeW5hbWljLCBfQmV6aWVyRWRnZUJhc2UpOwoKICAgIF9jcmVhdGVDbGFzcyhCZXppZXJFZGdlRHluYW1pYywgW3sKICAgICAga2V5OiAnc2V0T3B0aW9ucycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgIHRoaXMuaWQgPSB0aGlzLm9wdGlvbnMuaWQ7CiAgICAgICAgdGhpcy5zZXR1cFN1cHBvcnROb2RlKCk7CiAgICAgICAgdGhpcy5jb25uZWN0KCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnY29ubmVjdCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb25uZWN0KCkgewogICAgICAgIHRoaXMuZnJvbSA9IHRoaXMuYm9keS5ub2Rlc1t0aGlzLm9wdGlvbnMuZnJvbV07CiAgICAgICAgdGhpcy50byA9IHRoaXMuYm9keS5ub2Rlc1t0aGlzLm9wdGlvbnMudG9dOwogICAgICAgIGlmICh0aGlzLmZyb20gPT09IHVuZGVmaW5lZCB8fCB0aGlzLnRvID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMudmlhLnNldE9wdGlvbnMoeyBwaHlzaWNzOiBmYWxzZSB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gZml4IHdlaXJkIGJlaGF2aW91ciB3aGVyZSBhIHNlbGZyZWZlcmVuY2luZyBub2RlIGhhcyBwaHlzaWNzIGVuYWJsZWQKICAgICAgICAgIGlmICh0aGlzLmZyb20uaWQgPT09IHRoaXMudG8uaWQpIHsKICAgICAgICAgICAgdGhpcy52aWEuc2V0T3B0aW9ucyh7IHBoeXNpY3M6IGZhbHNlIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy52aWEuc2V0T3B0aW9ucyh7IHBoeXNpY3M6IHRydWUgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2NsZWFudXAnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYW51cCgpIHsKICAgICAgICBpZiAodGhpcy52aWEgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZGVsZXRlIHRoaXMuYm9keS5ub2Rlc1t0aGlzLnZpYS5pZF07CiAgICAgICAgICB0aGlzLnZpYSA9IHVuZGVmaW5lZDsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAndG9nZ2xlUGh5c2ljcycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB0b2dnbGVQaHlzaWNzKHN0YXR1cykgewogICAgICAgIHRoaXMudmlhLnNldE9wdGlvbnMoeyBwaHlzaWNzOiBzdGF0dXMgfSk7CiAgICAgICAgdGhpcy5wb3NpdGlvbkJlemllck5vZGUoKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzZXR1cFN1cHBvcnROb2RlJywKCiAgICAgIC8qKgogICAgICAgKiBCZXppZXIgY3VydmVzIHJlcXVpcmUgYW4gYW5jaG9yIHBvaW50IHRvIGNhbGN1bGF0ZSB0aGUgc21vb3RoIGZsb3cuIFRoZXNlIHBvaW50cyBhcmUgbm9kZXMuIFRoZXNlIG5vZGVzIGFyZSBpbnZpc2libGUgYnV0CiAgICAgICAqIGFyZSB1c2VkIGZvciB0aGUgZm9yY2UgY2FsY3VsYXRpb24uCiAgICAgICAqCiAgICAgICAqIFRoZSBjaGFuZ2VkIGRhdGEgaXMgbm90IGNhbGxlZCwgaWYgbmVlZGVkLCBpdCBpcyByZXR1cm5lZCBieSB0aGUgbWFpbiBlZGdlIGNvbnN0cnVjdG9yLgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldHVwU3VwcG9ydE5vZGUoKSB7CiAgICAgICAgaWYgKHRoaXMudmlhID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBub2RlSWQgPSAnZWRnZUlkOicgKyB0aGlzLmlkOwogICAgICAgICAgdmFyIG5vZGUgPSB0aGlzLmJvZHkuZnVuY3Rpb25zLmNyZWF0ZU5vZGUoewogICAgICAgICAgICBpZDogbm9kZUlkLAogICAgICAgICAgICBzaGFwZTogJ2NpcmNsZScsCiAgICAgICAgICAgIHBoeXNpY3M6IHRydWUsCiAgICAgICAgICAgIGhpZGRlbjogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXSA9IG5vZGU7CiAgICAgICAgICB0aGlzLnZpYSA9IG5vZGU7CiAgICAgICAgICB0aGlzLnZpYS5wYXJlbnRFZGdlSWQgPSB0aGlzLmlkOwogICAgICAgICAgdGhpcy5wb3NpdGlvbkJlemllck5vZGUoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAncG9zaXRpb25CZXppZXJOb2RlJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBvc2l0aW9uQmV6aWVyTm9kZSgpIHsKICAgICAgICBpZiAodGhpcy52aWEgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmZyb20gIT09IHVuZGVmaW5lZCAmJiB0aGlzLnRvICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMudmlhLnggPSAwLjUgKiAodGhpcy5mcm9tLnggKyB0aGlzLnRvLngpOwogICAgICAgICAgdGhpcy52aWEueSA9IDAuNSAqICh0aGlzLmZyb20ueSArIHRoaXMudG8ueSk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnZpYSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnZpYS54ID0gMDsKICAgICAgICAgIHRoaXMudmlhLnkgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfbGluZScsCgogICAgICAvKioKICAgICAgICogRHJhdyBhIGxpbmUgYmV0d2VlbiB0d28gbm9kZXMKICAgICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9saW5lKGN0eCkgewogICAgICAgIC8vIGRyYXcgYSBzdHJhaWdodCBsaW5lCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5tb3ZlVG8odGhpcy5mcm9tLngsIHRoaXMuZnJvbS55KTsKICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyh0aGlzLnZpYS54LCB0aGlzLnZpYS55LCB0aGlzLnRvLngsIHRoaXMudG8ueSk7CiAgICAgICAgLy8gZHJhdyBzaGFkb3cgaWYgZW5hYmxlZAogICAgICAgIHRoaXMuZW5hYmxlU2hhZG93KGN0eCk7CiAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgIHRoaXMuZGlzYWJsZVNoYWRvdyhjdHgpOwogICAgICAgIHJldHVybiB0aGlzLnZpYTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdnZXRQb2ludCcsCgogICAgICAvKioKICAgICAgICogQ29tYmluZWQgZnVuY3Rpb24gb2YgcG9pbnRPbkxpbmUgYW5kIHBvaW50T25CZXppZXIuIFRoaXMgZ2l2ZXMgdGhlIGNvb3JkaW5hdGVzIG9mIGEgcG9pbnQgb24gdGhlIGxpbmUgYXQgYSBjZXJ0YWluIHBlcmNlbnRhZ2Ugb2YgdGhlIHdheQogICAgICAgKiBAcGFyYW0gcGVyY2VudGFnZQogICAgICAgKiBAcGFyYW0gdmlhCiAgICAgICAqIEByZXR1cm5zIHt7eDogbnVtYmVyLCB5OiBudW1iZXJ9fQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBvaW50KHBlcmNlbnRhZ2UpIHsKICAgICAgICB2YXIgdCA9IHBlcmNlbnRhZ2U7CiAgICAgICAgdmFyIHggPSBNYXRoLnBvdygxIC0gdCwgMikgKiB0aGlzLmZyb20ueCArIDIgKiB0ICogKDEgLSB0KSAqIHRoaXMudmlhLnggKyBNYXRoLnBvdyh0LCAyKSAqIHRoaXMudG8ueDsKICAgICAgICB2YXIgeSA9IE1hdGgucG93KDEgLSB0LCAyKSAqIHRoaXMuZnJvbS55ICsgMiAqIHQgKiAoMSAtIHQpICogdGhpcy52aWEueSArIE1hdGgucG93KHQsIDIpICogdGhpcy50by55OwoKICAgICAgICByZXR1cm4geyB4OiB4LCB5OiB5IH07CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2ZpbmRCb3JkZXJQb3NpdGlvbicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZEJvcmRlclBvc2l0aW9uKG5lYXJOb2RlLCBjdHgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fZmluZEJvcmRlclBvc2l0aW9uQmV6aWVyKG5lYXJOb2RlLCBjdHgsIHRoaXMudmlhKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZ2V0RGlzdGFuY2VUb0VkZ2UnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2dldERpc3RhbmNlVG9FZGdlKHgxLCB5MSwgeDIsIHkyLCB4MywgeTMpIHsKICAgICAgICAvLyB4Myx5MyBpcyB0aGUgcG9pbnQKICAgICAgICByZXR1cm4gdGhpcy5fZ2V0RGlzdGFuY2VUb0JlemllckVkZ2UoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MywgdGhpcy52aWEpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIEJlemllckVkZ2VEeW5hbWljOwogIH0pKF91dGlsQmV6aWVyRWRnZUJhc2UyWydkZWZhdWx0J10pOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBCZXppZXJFZGdlRHluYW1pYzsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDg0ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIHZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94MiwgX3gzLCBfeDQpIHsgdmFyIF9hZ2FpbiA9IHRydWU7IF9mdW5jdGlvbjogd2hpbGUgKF9hZ2FpbikgeyB2YXIgb2JqZWN0ID0gX3gyLCBwcm9wZXJ0eSA9IF94MywgcmVjZWl2ZXIgPSBfeDQ7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94MiA9IHBhcmVudDsgX3gzID0gcHJvcGVydHk7IF94NCA9IHJlY2VpdmVyOyBfYWdhaW4gPSB0cnVlOyBjb250aW51ZSBfZnVuY3Rpb247IH0gfSBlbHNlIGlmICgndmFsdWUnIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCiAgdmFyIF9FZGdlQmFzZTIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1KTsKCiAgdmFyIF9FZGdlQmFzZTMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9FZGdlQmFzZTIpOwoKICB2YXIgQmV6aWVyRWRnZUJhc2UgPSAoZnVuY3Rpb24gKF9FZGdlQmFzZSkgewogICAgZnVuY3Rpb24gQmV6aWVyRWRnZUJhc2Uob3B0aW9ucywgYm9keSwgbGFiZWxNb2R1bGUpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEJlemllckVkZ2VCYXNlKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKEJlemllckVkZ2VCYXNlLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcywgb3B0aW9ucywgYm9keSwgbGFiZWxNb2R1bGUpOwogICAgfQoKICAgIF9pbmhlcml0cyhCZXppZXJFZGdlQmFzZSwgX0VkZ2VCYXNlKTsKCiAgICBfY3JlYXRlQ2xhc3MoQmV6aWVyRWRnZUJhc2UsIFt7CiAgICAgIGtleTogJ19maW5kQm9yZGVyUG9zaXRpb25CZXppZXInLAoKICAgICAgLyoqCiAgICAgICAqIFRoaXMgZnVuY3Rpb24gdXNlcyBiaW5hcnkgc2VhcmNoIHRvIGxvb2sgZm9yIHRoZSBwb2ludCB3aGVyZSB0aGUgYmV6aWVyIGN1cnZlIGNyb3NzZXMgdGhlIGJvcmRlciBvZiB0aGUgbm9kZS4KICAgICAgICoKICAgICAgICogQHBhcmFtIG5lYXJOb2RlCiAgICAgICAqIEBwYXJhbSBjdHgKICAgICAgICogQHBhcmFtIHZpYU5vZGUKICAgICAgICogQHBhcmFtIG5lYXJOb2RlCiAgICAgICAqIEBwYXJhbSBjdHgKICAgICAgICogQHBhcmFtIHZpYU5vZGUKICAgICAgICogQHBhcmFtIG5lYXJOb2RlCiAgICAgICAqIEBwYXJhbSBjdHgKICAgICAgICogQHBhcmFtIHZpYU5vZGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZEJvcmRlclBvc2l0aW9uQmV6aWVyKG5lYXJOb2RlLCBjdHgpIHsKICAgICAgICB2YXIgdmlhTm9kZSA9IGFyZ3VtZW50c1syXSA9PT0gdW5kZWZpbmVkID8gdGhpcy5fZ2V0VmlhQ29vcmRpbmF0ZXMoKSA6IGFyZ3VtZW50c1syXTsKCiAgICAgICAgdmFyIG1heEl0ZXJhdGlvbnMgPSAxMDsKICAgICAgICB2YXIgaXRlcmF0aW9uID0gMDsKICAgICAgICB2YXIgbG93ID0gMDsKICAgICAgICB2YXIgaGlnaCA9IDE7CiAgICAgICAgdmFyIHBvcywgYW5nbGUsIGRpc3RhbmNlVG9Cb3JkZXIsIGRpc3RhbmNlVG9Qb2ludCwgZGlmZmVyZW5jZTsKICAgICAgICB2YXIgdGhyZXNob2xkID0gMC4yOwogICAgICAgIHZhciBub2RlID0gdGhpcy50bzsKICAgICAgICB2YXIgZnJvbSA9IGZhbHNlOwogICAgICAgIGlmIChuZWFyTm9kZS5pZCA9PT0gdGhpcy5mcm9tLmlkKSB7CiAgICAgICAgICBub2RlID0gdGhpcy5mcm9tOwogICAgICAgICAgZnJvbSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICB3aGlsZSAobG93IDw9IGhpZ2ggJiYgaXRlcmF0aW9uIDwgbWF4SXRlcmF0aW9ucykgewogICAgICAgICAgdmFyIG1pZGRsZSA9IChsb3cgKyBoaWdoKSAqIDAuNTsKCiAgICAgICAgICBwb3MgPSB0aGlzLmdldFBvaW50KG1pZGRsZSwgdmlhTm9kZSk7CiAgICAgICAgICBhbmdsZSA9IE1hdGguYXRhbjIobm9kZS55IC0gcG9zLnksIG5vZGUueCAtIHBvcy54KTsKICAgICAgICAgIGRpc3RhbmNlVG9Cb3JkZXIgPSBub2RlLmRpc3RhbmNlVG9Cb3JkZXIoY3R4LCBhbmdsZSk7CiAgICAgICAgICBkaXN0YW5jZVRvUG9pbnQgPSBNYXRoLnNxcnQoTWF0aC5wb3cocG9zLnggLSBub2RlLngsIDIpICsgTWF0aC5wb3cocG9zLnkgLSBub2RlLnksIDIpKTsKICAgICAgICAgIGRpZmZlcmVuY2UgPSBkaXN0YW5jZVRvQm9yZGVyIC0gZGlzdGFuY2VUb1BvaW50OwogICAgICAgICAgaWYgKE1hdGguYWJzKGRpZmZlcmVuY2UpIDwgdGhyZXNob2xkKSB7CiAgICAgICAgICAgIGJyZWFrOyAvLyBmb3VuZAogICAgICAgICAgfSBlbHNlIGlmIChkaWZmZXJlbmNlIDwgMCkgewogICAgICAgICAgICAvLyBkaXN0YW5jZSB0byBub2RlcyBpcyBsYXJnZXIgdGhhbiBkaXN0YW5jZSB0byBib3JkZXIgLS0+IHQgbmVlZHMgdG8gYmUgYmlnZ2VyIGlmIHdlJ3JlIGxvb2tpbmcgYXQgdGhlIHRvIG5vZGUuCiAgICAgICAgICAgIGlmIChmcm9tID09PSBmYWxzZSkgewogICAgICAgICAgICAgIGxvdyA9IG1pZGRsZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBoaWdoID0gbWlkZGxlOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoZnJvbSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICBoaWdoID0gbWlkZGxlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGxvdyA9IG1pZGRsZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGl0ZXJhdGlvbisrOwogICAgICAgIH0KICAgICAgICBwb3MudCA9IG1pZGRsZTsKCiAgICAgICAgcmV0dXJuIHBvczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZ2V0RGlzdGFuY2VUb0JlemllckVkZ2UnLAoKICAgICAgLyoqCiAgICAgICAqIENhbGN1bGF0ZSB0aGUgZGlzdGFuY2UgYmV0d2VlbiBhIHBvaW50ICh4Myx5MykgYW5kIGEgbGluZSBzZWdtZW50IGZyb20KICAgICAgICogKHgxLHkxKSB0byAoeDIseTIpLgogICAgICAgKiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzg0OTIxMS9zaG9ydGVzdC1kaXN0YW5jYWUtYmV0d2Vlbi1hLXBvaW50LWFuZC1hLWxpbmUtc2VnbWVudAogICAgICAgKiBAcGFyYW0ge251bWJlcn0geDEKICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHkxCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB4MgogICAgICAgKiBAcGFyYW0ge251bWJlcn0geTIKICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHgzCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB5MwogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXREaXN0YW5jZVRvQmV6aWVyRWRnZSh4MSwgeTEsIHgyLCB5MiwgeDMsIHkzLCB2aWEpIHsKICAgICAgICAvLyB4Myx5MyBpcyB0aGUgcG9pbnQKICAgICAgICB2YXIgeFZpYSA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgeVZpYSA9IHVuZGVmaW5lZDsKICAgICAgICB4VmlhID0gdmlhLng7CiAgICAgICAgeVZpYSA9IHZpYS55OwogICAgICAgIHZhciBtaW5EaXN0YW5jZSA9IDEwMDAwMDAwMDA7CiAgICAgICAgdmFyIGRpc3RhbmNlID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBpID0gdW5kZWZpbmVkLAogICAgICAgICAgICB0ID0gdW5kZWZpbmVkLAogICAgICAgICAgICB4ID0gdW5kZWZpbmVkLAogICAgICAgICAgICB5ID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBsYXN0WCA9IHgxOwogICAgICAgIHZhciBsYXN0WSA9IHkxOwogICAgICAgIGZvciAoaSA9IDE7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICB0ID0gMC4xICogaTsKICAgICAgICAgIHggPSBNYXRoLnBvdygxIC0gdCwgMikgKiB4MSArIDIgKiB0ICogKDEgLSB0KSAqIHhWaWEgKyBNYXRoLnBvdyh0LCAyKSAqIHgyOwogICAgICAgICAgeSA9IE1hdGgucG93KDEgLSB0LCAyKSAqIHkxICsgMiAqIHQgKiAoMSAtIHQpICogeVZpYSArIE1hdGgucG93KHQsIDIpICogeTI7CiAgICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAgZGlzdGFuY2UgPSB0aGlzLl9nZXREaXN0YW5jZVRvTGluZShsYXN0WCwgbGFzdFksIHgsIHksIHgzLCB5Myk7CiAgICAgICAgICAgIG1pbkRpc3RhbmNlID0gZGlzdGFuY2UgPCBtaW5EaXN0YW5jZSA/IGRpc3RhbmNlIDogbWluRGlzdGFuY2U7CiAgICAgICAgICB9CiAgICAgICAgICBsYXN0WCA9IHg7CiAgICAgICAgICBsYXN0WSA9IHk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWluRGlzdGFuY2U7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gQmV6aWVyRWRnZUJhc2U7CiAgfSkoX0VkZ2VCYXNlM1snZGVmYXVsdCddKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gQmV6aWVyRWRnZUJhc2U7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiA4NSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyByZXR1cm4gYXJyOyB9IGVsc2UgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoYXJyKSkgeyB2YXIgX2FyciA9IFtdOyB2YXIgX24gPSB0cnVlOyB2YXIgX2QgPSBmYWxzZTsgdmFyIF9lID0gdW5kZWZpbmVkOyB0cnkgeyBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7IF9hcnIucHVzaChfcy52YWx1ZSk7IGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazsgfSB9IGNhdGNoIChlcnIpIHsgX2QgPSB0cnVlOyBfZSA9IGVycjsgfSBmaW5hbGx5IHsgdHJ5IHsgaWYgKCFfbiAmJiBfaVsncmV0dXJuJ10pIF9pWydyZXR1cm4nXSgpOyB9IGZpbmFsbHkgeyBpZiAoX2QpIHRocm93IF9lOyB9IH0gcmV0dXJuIF9hcnI7IH0gZWxzZSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UnKTsgfSB9CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogIHZhciBFZGdlQmFzZSA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBFZGdlQmFzZShvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRWRnZUJhc2UpOwoKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5sYWJlbE1vZHVsZSA9IGxhYmVsTW9kdWxlOwogICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICAgIHRoaXMuY29sb3JEaXJ0eSA9IHRydWU7CiAgICAgIHRoaXMuY29sb3IgPSB7fTsKICAgICAgdGhpcy5zZWxlY3Rpb25XaWR0aCA9IDI7CiAgICAgIHRoaXMuaG92ZXJXaWR0aCA9IDEuNTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoRWRnZUJhc2UsIFt7CiAgICAgIGtleTogJ2Nvbm5lY3QnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gY29ubmVjdCgpIHt9CiAgICB9LCB7CiAgICAgIGtleTogJ2NsZWFudXAnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gY2xlYW51cCgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc2V0T3B0aW9ucycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICAgIHRoaXMuZnJvbSA9IHRoaXMuYm9keS5ub2Rlc1t0aGlzLm9wdGlvbnMuZnJvbV07CiAgICAgICAgdGhpcy50byA9IHRoaXMuYm9keS5ub2Rlc1t0aGlzLm9wdGlvbnMudG9dOwogICAgICAgIHRoaXMuaWQgPSB0aGlzLm9wdGlvbnMuaWQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAndG9nZ2xlUGh5c2ljcycsCgogICAgICAvKioKICAgICAgICogb3ZlcmxvYWRhYmxlIGlmIHRoZSBzaGFwZSBoYXMgdG8gdG9nZ2xlIHRoZSB2aWEgbm9kZSB0byBkaXNhYmxlZAogICAgICAgKiBAcGFyYW0gc3RhdHVzCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gdG9nZ2xlUGh5c2ljcyhzdGF0dXMpIHt9CiAgICB9LCB7CiAgICAgIGtleTogJ2RyYXdMaW5lJywKCiAgICAgIC8qKgogICAgICAgKiBSZWRyYXcgYSBlZGdlIGFzIGEgbGluZQogICAgICAgKiBEcmF3IHRoaXMgZWRnZSBpbiB0aGUgZ2l2ZW4gY2FudmFzCiAgICAgICAqIFRoZSAyZCBjb250ZXh0IG9mIGEgSFRNTCBjYW52YXMgY2FuIGJlIHJldHJpZXZlZCBieSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9ICAgY3R4CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZHJhd0xpbmUoY3R4LCBzZWxlY3RlZCwgaG92ZXIpIHsKICAgICAgICAvLyBzZXQgc3R5bGUKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmdldENvbG9yKGN0eCwgc2VsZWN0ZWQsIGhvdmVyKTsKICAgICAgICBjdHgubGluZVdpZHRoID0gdGhpcy5nZXRMaW5lV2lkdGgoc2VsZWN0ZWQsIGhvdmVyKTsKICAgICAgICB2YXIgdmlhID0gdW5kZWZpbmVkOwogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGFzaGVzICE9PSBmYWxzZSkgewogICAgICAgICAgdmlhID0gdGhpcy5fZHJhd0Rhc2hlZExpbmUoY3R4KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmlhID0gdGhpcy5fZHJhd0xpbmUoY3R4KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZpYTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZHJhd0xpbmUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2RyYXdMaW5lKGN0eCkgewogICAgICAgIHZhciB2aWEgPSB1bmRlZmluZWQ7CiAgICAgICAgaWYgKHRoaXMuZnJvbSAhPSB0aGlzLnRvKSB7CiAgICAgICAgICAvLyBkcmF3IGxpbmUKICAgICAgICAgIHZpYSA9IHRoaXMuX2xpbmUoY3R4KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIF9nZXRDaXJjbGVEYXRhMiA9IHRoaXMuX2dldENpcmNsZURhdGEoY3R4KTsKCiAgICAgICAgICB2YXIgX2dldENpcmNsZURhdGEyMiA9IF9zbGljZWRUb0FycmF5KF9nZXRDaXJjbGVEYXRhMiwgMyk7CgogICAgICAgICAgdmFyIHggPSBfZ2V0Q2lyY2xlRGF0YTIyWzBdOwogICAgICAgICAgdmFyIHkgPSBfZ2V0Q2lyY2xlRGF0YTIyWzFdOwogICAgICAgICAgdmFyIHJhZGl1cyA9IF9nZXRDaXJjbGVEYXRhMjJbMl07CgogICAgICAgICAgdGhpcy5fY2lyY2xlKGN0eCwgeCwgeSwgcmFkaXVzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZpYTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZHJhd0Rhc2hlZExpbmUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2RyYXdEYXNoZWRMaW5lKGN0eCkgewogICAgICAgIHZhciB2aWEgPSB1bmRlZmluZWQ7CiAgICAgICAgY3R4LmxpbmVDYXAgPSAncm91bmQnOwogICAgICAgIHZhciBwYXR0ZXJuID0gWzUsIDVdOwogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMub3B0aW9ucy5kYXNoZXMpID09PSB0cnVlKSB7CiAgICAgICAgICBwYXR0ZXJuID0gdGhpcy5vcHRpb25zLmRhc2hlczsKICAgICAgICB9CgogICAgICAgIC8vIG9ubHkgZmlyZWZveCBhbmQgY2hyb21lIHN1cHBvcnQgdGhpcyBtZXRob2QsIGVsc2Ugd2UgdXNlIHRoZSBsZWdhY3kgb25lLgogICAgICAgIGlmIChjdHguc2V0TGluZURhc2ggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgY3R4LnNhdmUoKTsKCiAgICAgICAgICAvLyBzZXQgZGFzaCBzZXR0aW5ncyBmb3IgY2hyb21lIG9yIGZpcmVmb3gKICAgICAgICAgIGN0eC5zZXRMaW5lRGFzaChwYXR0ZXJuKTsKICAgICAgICAgIGN0eC5saW5lRGFzaE9mZnNldCA9IDA7CgogICAgICAgICAgLy8gZHJhdyB0aGUgbGluZQogICAgICAgICAgaWYgKHRoaXMuZnJvbSAhPSB0aGlzLnRvKSB7CiAgICAgICAgICAgIC8vIGRyYXcgbGluZQogICAgICAgICAgICB2aWEgPSB0aGlzLl9saW5lKGN0eCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgX2dldENpcmNsZURhdGEzID0gdGhpcy5fZ2V0Q2lyY2xlRGF0YShjdHgpOwoKICAgICAgICAgICAgdmFyIF9nZXRDaXJjbGVEYXRhMzIgPSBfc2xpY2VkVG9BcnJheShfZ2V0Q2lyY2xlRGF0YTMsIDMpOwoKICAgICAgICAgICAgdmFyIHggPSBfZ2V0Q2lyY2xlRGF0YTMyWzBdOwogICAgICAgICAgICB2YXIgeSA9IF9nZXRDaXJjbGVEYXRhMzJbMV07CiAgICAgICAgICAgIHZhciByYWRpdXMgPSBfZ2V0Q2lyY2xlRGF0YTMyWzJdOwoKICAgICAgICAgICAgdGhpcy5fY2lyY2xlKGN0eCwgeCwgeSwgcmFkaXVzKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyByZXN0b3JlIHRoZSBkYXNoIHNldHRpbmdzLgogICAgICAgICAgY3R4LnNldExpbmVEYXNoKFswXSk7CiAgICAgICAgICBjdHgubGluZURhc2hPZmZzZXQgPSAwOwogICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gdW5zdXBwb3J0aW5nIHNtb290aCBsaW5lcwoKICAgICAgICAgIGlmICh0aGlzLmZyb20gIT0gdGhpcy50bykgewogICAgICAgICAgICAvLyBkcmF3IGxpbmUKICAgICAgICAgICAgY3R4LmRhc2hlZExpbmUodGhpcy5mcm9tLngsIHRoaXMuZnJvbS55LCB0aGlzLnRvLngsIHRoaXMudG8ueSwgcGF0dGVybik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgX2dldENpcmNsZURhdGE0ID0gdGhpcy5fZ2V0Q2lyY2xlRGF0YShjdHgpOwoKICAgICAgICAgICAgdmFyIF9nZXRDaXJjbGVEYXRhNDIgPSBfc2xpY2VkVG9BcnJheShfZ2V0Q2lyY2xlRGF0YTQsIDMpOwoKICAgICAgICAgICAgdmFyIHggPSBfZ2V0Q2lyY2xlRGF0YTQyWzBdOwogICAgICAgICAgICB2YXIgeSA9IF9nZXRDaXJjbGVEYXRhNDJbMV07CiAgICAgICAgICAgIHZhciByYWRpdXMgPSBfZ2V0Q2lyY2xlRGF0YTQyWzJdOwoKICAgICAgICAgICAgdGhpcy5fY2lyY2xlKGN0eCwgeCwgeSwgcmFkaXVzKTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGRyYXcgc2hhZG93IGlmIGVuYWJsZWQKICAgICAgICAgIHRoaXMuZW5hYmxlU2hhZG93KGN0eCk7CgogICAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICAgIC8vIGRpc2FibGUgc2hhZG93cyBmb3Igb3RoZXIgZWxlbWVudHMuCiAgICAgICAgICB0aGlzLmRpc2FibGVTaGFkb3coY3R4KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZpYTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdmaW5kQm9yZGVyUG9zaXRpb24nLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZmluZEJvcmRlclBvc2l0aW9uKG5lYXJOb2RlLCBjdHgsIG9wdGlvbnMpIHsKICAgICAgICBpZiAodGhpcy5mcm9tICE9IHRoaXMudG8pIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9maW5kQm9yZGVyUG9zaXRpb24obmVhck5vZGUsIGN0eCwgb3B0aW9ucyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9maW5kQm9yZGVyUG9zaXRpb25DaXJjbGUobmVhck5vZGUsIGN0eCwgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2ZpbmRCb3JkZXJQb3NpdGlvbnMnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZmluZEJvcmRlclBvc2l0aW9ucyhjdHgpIHsKICAgICAgICB2YXIgZnJvbSA9IHt9OwogICAgICAgIHZhciB0byA9IHt9OwogICAgICAgIGlmICh0aGlzLmZyb20gIT0gdGhpcy50bykgewogICAgICAgICAgZnJvbSA9IHRoaXMuX2ZpbmRCb3JkZXJQb3NpdGlvbih0aGlzLmZyb20sIGN0eCk7CiAgICAgICAgICB0byA9IHRoaXMuX2ZpbmRCb3JkZXJQb3NpdGlvbih0aGlzLnRvLCBjdHgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgX2dldENpcmNsZURhdGE1ID0gdGhpcy5fZ2V0Q2lyY2xlRGF0YShjdHgpOwoKICAgICAgICAgIHZhciBfZ2V0Q2lyY2xlRGF0YTUyID0gX3NsaWNlZFRvQXJyYXkoX2dldENpcmNsZURhdGE1LCAzKTsKCiAgICAgICAgICB2YXIgeCA9IF9nZXRDaXJjbGVEYXRhNTJbMF07CiAgICAgICAgICB2YXIgeSA9IF9nZXRDaXJjbGVEYXRhNTJbMV07CiAgICAgICAgICB2YXIgcmFkaXVzID0gX2dldENpcmNsZURhdGE1MlsyXTsKCiAgICAgICAgICBmcm9tID0gdGhpcy5fZmluZEJvcmRlclBvc2l0aW9uQ2lyY2xlKHRoaXMuZnJvbSwgY3R4LCB7IHg6IHgsIHk6IHksIGxvdzogMC4yNSwgaGlnaDogMC42LCBkaXJlY3Rpb246IC0xIH0pOwogICAgICAgICAgdG8gPSB0aGlzLl9maW5kQm9yZGVyUG9zaXRpb25DaXJjbGUodGhpcy5mcm9tLCBjdHgsIHsgeDogeCwgeTogeSwgbG93OiAwLjYsIGhpZ2g6IDAuOCwgZGlyZWN0aW9uOiAxIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4geyBmcm9tOiBmcm9tLCB0bzogdG8gfTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZ2V0Q2lyY2xlRGF0YScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0Q2lyY2xlRGF0YShjdHgpIHsKICAgICAgICB2YXIgeCA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgeSA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgbm9kZSA9IHRoaXMuZnJvbTsKICAgICAgICB2YXIgcmFkaXVzID0gdGhpcy5vcHRpb25zLnNlbGZSZWZlcmVuY2VTaXplOwoKICAgICAgICBpZiAoY3R4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGlmIChub2RlLnNoYXBlLndpZHRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgbm9kZS5zaGFwZS5yZXNpemUoY3R4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGdldCBjaXJjbGUgY29vcmRpbmF0ZXMKICAgICAgICBpZiAobm9kZS5zaGFwZS53aWR0aCA+IG5vZGUuc2hhcGUuaGVpZ2h0KSB7CiAgICAgICAgICB4ID0gbm9kZS54ICsgbm9kZS5zaGFwZS53aWR0aCAqIDAuNTsKICAgICAgICAgIHkgPSBub2RlLnkgLSByYWRpdXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHggPSBub2RlLnggKyByYWRpdXM7CiAgICAgICAgICB5ID0gbm9kZS55IC0gbm9kZS5zaGFwZS5oZWlnaHQgKiAwLjU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBbeCwgeSwgcmFkaXVzXTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfcG9pbnRPbkNpcmNsZScsCgogICAgICAvKioKICAgICAgICogR2V0IGEgcG9pbnQgb24gYSBjaXJjbGUKICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHgKICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHkKICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHJhZGl1cwogICAgICAgKiBAcGFyYW0ge051bWJlcn0gcGVyY2VudGFnZS4gVmFsdWUgYmV0d2VlbiAwIChsaW5lIHN0YXJ0KSBhbmQgMSAobGluZSBlbmQpCiAgICAgICAqIEByZXR1cm4ge09iamVjdH0gcG9pbnQKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcG9pbnRPbkNpcmNsZSh4LCB5LCByYWRpdXMsIHBlcmNlbnRhZ2UpIHsKICAgICAgICB2YXIgYW5nbGUgPSBwZXJjZW50YWdlICogMiAqIE1hdGguUEk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHg6IHggKyByYWRpdXMgKiBNYXRoLmNvcyhhbmdsZSksCiAgICAgICAgICB5OiB5IC0gcmFkaXVzICogTWF0aC5zaW4oYW5nbGUpCiAgICAgICAgfTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZmluZEJvcmRlclBvc2l0aW9uQ2lyY2xlJywKCiAgICAgIC8qKgogICAgICAgKiBUaGlzIGZ1bmN0aW9uIHVzZXMgYmluYXJ5IHNlYXJjaCB0byBsb29rIGZvciB0aGUgcG9pbnQgd2hlcmUgdGhlIGNpcmNsZSBjcm9zc2VzIHRoZSBib3JkZXIgb2YgdGhlIG5vZGUuCiAgICAgICAqIEBwYXJhbSBub2RlCiAgICAgICAqIEBwYXJhbSBjdHgKICAgICAgICogQHBhcmFtIG9wdGlvbnMKICAgICAgICogQHJldHVybnMgeyp9CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRCb3JkZXJQb3NpdGlvbkNpcmNsZShub2RlLCBjdHgsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgeCA9IG9wdGlvbnMueDsKICAgICAgICB2YXIgeSA9IG9wdGlvbnMueTsKICAgICAgICB2YXIgbG93ID0gb3B0aW9ucy5sb3c7CiAgICAgICAgdmFyIGhpZ2ggPSBvcHRpb25zLmhpZ2g7CiAgICAgICAgdmFyIGRpcmVjdGlvbiA9IG9wdGlvbnMuZGlyZWN0aW9uOwoKICAgICAgICB2YXIgbWF4SXRlcmF0aW9ucyA9IDEwOwogICAgICAgIHZhciBpdGVyYXRpb24gPSAwOwogICAgICAgIHZhciByYWRpdXMgPSB0aGlzLm9wdGlvbnMuc2VsZlJlZmVyZW5jZVNpemU7CiAgICAgICAgdmFyIHBvcyA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgYW5nbGUgPSB1bmRlZmluZWQsCiAgICAgICAgICAgIGRpc3RhbmNlVG9Cb3JkZXIgPSB1bmRlZmluZWQsCiAgICAgICAgICAgIGRpc3RhbmNlVG9Qb2ludCA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgZGlmZmVyZW5jZSA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgdGhyZXNob2xkID0gMC4wNTsKICAgICAgICB2YXIgbWlkZGxlID0gKGxvdyArIGhpZ2gpICogMC41OwoKICAgICAgICB3aGlsZSAobG93IDw9IGhpZ2ggJiYgaXRlcmF0aW9uIDwgbWF4SXRlcmF0aW9ucykgewogICAgICAgICAgbWlkZGxlID0gKGxvdyArIGhpZ2gpICogMC41OwoKICAgICAgICAgIHBvcyA9IHRoaXMuX3BvaW50T25DaXJjbGUoeCwgeSwgcmFkaXVzLCBtaWRkbGUpOwogICAgICAgICAgYW5nbGUgPSBNYXRoLmF0YW4yKG5vZGUueSAtIHBvcy55LCBub2RlLnggLSBwb3MueCk7CiAgICAgICAgICBkaXN0YW5jZVRvQm9yZGVyID0gbm9kZS5kaXN0YW5jZVRvQm9yZGVyKGN0eCwgYW5nbGUpOwogICAgICAgICAgZGlzdGFuY2VUb1BvaW50ID0gTWF0aC5zcXJ0KE1hdGgucG93KHBvcy54IC0gbm9kZS54LCAyKSArIE1hdGgucG93KHBvcy55IC0gbm9kZS55LCAyKSk7CiAgICAgICAgICBkaWZmZXJlbmNlID0gZGlzdGFuY2VUb0JvcmRlciAtIGRpc3RhbmNlVG9Qb2ludDsKICAgICAgICAgIGlmIChNYXRoLmFicyhkaWZmZXJlbmNlKSA8IHRocmVzaG9sZCkgewogICAgICAgICAgICBicmVhazsgLy8gZm91bmQKICAgICAgICAgIH0gZWxzZSBpZiAoZGlmZmVyZW5jZSA+IDApIHsKICAgICAgICAgICAgLy8gZGlzdGFuY2UgdG8gbm9kZXMgaXMgbGFyZ2VyIHRoYW4gZGlzdGFuY2UgdG8gYm9yZGVyIC0tPiB0IG5lZWRzIHRvIGJlIGJpZ2dlciBpZiB3ZSdyZSBsb29raW5nIGF0IHRoZSB0byBub2RlLgogICAgICAgICAgICBpZiAoZGlyZWN0aW9uID4gMCkgewogICAgICAgICAgICAgIGxvdyA9IG1pZGRsZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBoaWdoID0gbWlkZGxlOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoZGlyZWN0aW9uID4gMCkgewogICAgICAgICAgICAgIGhpZ2ggPSBtaWRkbGU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbG93ID0gbWlkZGxlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpdGVyYXRpb24rKzsKICAgICAgICB9CiAgICAgICAgcG9zLnQgPSBtaWRkbGU7CgogICAgICAgIHJldHVybiBwb3M7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZ2V0TGluZVdpZHRoJywKCiAgICAgIC8qKgogICAgICAgKiBHZXQgdGhlIGxpbmUgd2lkdGggb2YgdGhlIGVkZ2UuIERlcGVuZHMgb24gd2lkdGggYW5kIHdoZXRoZXIgb25lIG9mIHRoZQogICAgICAgKiBjb25uZWN0ZWQgbm9kZXMgaXMgc2VsZWN0ZWQuCiAgICAgICAqIEByZXR1cm4ge051bWJlcn0gd2lkdGgKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMaW5lV2lkdGgoc2VsZWN0ZWQsIGhvdmVyKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkID09PSB0cnVlKSB7CiAgICAgICAgICByZXR1cm4gTWF0aC5tYXgodGhpcy5zZWxlY3Rpb25XaWR0aCwgMC4zIC8gdGhpcy5ib2R5LnZpZXcuc2NhbGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoaG92ZXIgPT09IHRydWUpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KHRoaXMuaG92ZXJXaWR0aCwgMC4zIC8gdGhpcy5ib2R5LnZpZXcuc2NhbGUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KHRoaXMub3B0aW9ucy53aWR0aCwgMC4zIC8gdGhpcy5ib2R5LnZpZXcuc2NhbGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdnZXRDb2xvcicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb2xvcihjdHgsIHNlbGVjdGVkLCBob3ZlcikgewogICAgICAgIHZhciBjb2xvck9wdGlvbnMgPSB0aGlzLm9wdGlvbnMuY29sb3I7CiAgICAgICAgaWYgKGNvbG9yT3B0aW9ucy5pbmhlcml0ICE9PSBmYWxzZSkgewogICAgICAgICAgLy8gd2hlbiB0aGlzIGlzIGEgbG9vcCBlZGdlLCBqdXN0IHVzZSB0aGUgJ2Zyb20nIG1ldGhvZAogICAgICAgICAgaWYgKGNvbG9yT3B0aW9ucy5pbmhlcml0ID09PSAnYm90aCcgJiYgdGhpcy5mcm9tLmlkICE9PSB0aGlzLnRvLmlkKSB7CiAgICAgICAgICAgIHZhciBncmQgPSBjdHguY3JlYXRlTGluZWFyR3JhZGllbnQodGhpcy5mcm9tLngsIHRoaXMuZnJvbS55LCB0aGlzLnRvLngsIHRoaXMudG8ueSk7CiAgICAgICAgICAgIHZhciBmcm9tQ29sb3IgPSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICB0b0NvbG9yID0gdW5kZWZpbmVkOwogICAgICAgICAgICBmcm9tQ29sb3IgPSB0aGlzLmZyb20ub3B0aW9ucy5jb2xvci5oaWdobGlnaHQuYm9yZGVyOwogICAgICAgICAgICB0b0NvbG9yID0gdGhpcy50by5vcHRpb25zLmNvbG9yLmhpZ2hsaWdodC5ib3JkZXI7CgogICAgICAgICAgICBpZiAodGhpcy5mcm9tLnNlbGVjdGVkID09PSBmYWxzZSAmJiB0aGlzLnRvLnNlbGVjdGVkID09PSBmYWxzZSkgewogICAgICAgICAgICAgIGZyb21Db2xvciA9IHV0aWwub3ZlcnJpZGVPcGFjaXR5KHRoaXMuZnJvbS5vcHRpb25zLmNvbG9yLmJvcmRlciwgdGhpcy5vcHRpb25zLmNvbG9yLm9wYWNpdHkpOwogICAgICAgICAgICAgIHRvQ29sb3IgPSB1dGlsLm92ZXJyaWRlT3BhY2l0eSh0aGlzLnRvLm9wdGlvbnMuY29sb3IuYm9yZGVyLCB0aGlzLm9wdGlvbnMuY29sb3Iub3BhY2l0eSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5mcm9tLnNlbGVjdGVkID09PSB0cnVlICYmIHRoaXMudG8uc2VsZWN0ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdG9Db2xvciA9IHRoaXMudG8ub3B0aW9ucy5jb2xvci5ib3JkZXI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5mcm9tLnNlbGVjdGVkID09PSBmYWxzZSAmJiB0aGlzLnRvLnNlbGVjdGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgZnJvbUNvbG9yID0gdGhpcy5mcm9tLm9wdGlvbnMuY29sb3IuYm9yZGVyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdyZC5hZGRDb2xvclN0b3AoMCwgZnJvbUNvbG9yKTsKICAgICAgICAgICAgZ3JkLmFkZENvbG9yU3RvcCgxLCB0b0NvbG9yKTsKCiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tIHRoaXMgcmV0dXJucyAtLS0tLS0tLS0tLS0tLS0tLS0tLSAvLwogICAgICAgICAgICByZXR1cm4gZ3JkOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmNvbG9yRGlydHkgPT09IHRydWUpIHsKICAgICAgICAgICAgaWYgKGNvbG9yT3B0aW9ucy5pbmhlcml0ID09PSAndG8nKSB7CiAgICAgICAgICAgICAgdGhpcy5jb2xvci5oaWdobGlnaHQgPSB0aGlzLnRvLm9wdGlvbnMuY29sb3IuaGlnaGxpZ2h0LmJvcmRlcjsKICAgICAgICAgICAgICB0aGlzLmNvbG9yLmhvdmVyID0gdGhpcy50by5vcHRpb25zLmNvbG9yLmhvdmVyLmJvcmRlcjsKICAgICAgICAgICAgICB0aGlzLmNvbG9yLmNvbG9yID0gdXRpbC5vdmVycmlkZU9wYWNpdHkodGhpcy50by5vcHRpb25zLmNvbG9yLmJvcmRlciwgY29sb3JPcHRpb25zLm9wYWNpdHkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vICh0aGlzLm9wdGlvbnMuY29sb3IuaW5oZXJpdC5zb3VyY2UgPT09ICJmcm9tIikgewogICAgICAgICAgICAgIHRoaXMuY29sb3IuaGlnaGxpZ2h0ID0gdGhpcy5mcm9tLm9wdGlvbnMuY29sb3IuaGlnaGxpZ2h0LmJvcmRlcjsKICAgICAgICAgICAgICB0aGlzLmNvbG9yLmhvdmVyID0gdGhpcy5mcm9tLm9wdGlvbnMuY29sb3IuaG92ZXIuYm9yZGVyOwogICAgICAgICAgICAgIHRoaXMuY29sb3IuY29sb3IgPSB1dGlsLm92ZXJyaWRlT3BhY2l0eSh0aGlzLmZyb20ub3B0aW9ucy5jb2xvci5ib3JkZXIsIGNvbG9yT3B0aW9ucy5vcGFjaXR5KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodGhpcy5jb2xvckRpcnR5ID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmNvbG9yLmhpZ2hsaWdodCA9IGNvbG9yT3B0aW9ucy5oaWdobGlnaHQ7CiAgICAgICAgICB0aGlzLmNvbG9yLmhvdmVyID0gY29sb3JPcHRpb25zLmhvdmVyOwogICAgICAgICAgdGhpcy5jb2xvci5jb2xvciA9IHV0aWwub3ZlcnJpZGVPcGFjaXR5KGNvbG9yT3B0aW9ucy5jb2xvciwgY29sb3JPcHRpb25zLm9wYWNpdHkpOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYgY29sb3IgaW5oZXJpdCBpcyBvbiBhbmQgZ3JhZGllbnRzIGFyZSB1c2VkLCB0aGUgZnVuY3Rpb24gaGFzIGFscmVhZHkgcmV0dXJuZWQgYnkgbm93LgogICAgICAgIHRoaXMuY29sb3JEaXJ0eSA9IGZhbHNlOwoKICAgICAgICBpZiAoc2VsZWN0ZWQgPT09IHRydWUpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNvbG9yLmhpZ2hsaWdodDsKICAgICAgICB9IGVsc2UgaWYgKGhvdmVyID09PSB0cnVlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb2xvci5ob3ZlcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHRoaXMuY29sb3IuY29sb3I7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jaXJjbGUnLAoKICAgICAgLyoqCiAgICAgICAqIERyYXcgYSBsaW5lIGZyb20gYSBub2RlIHRvIGl0c2VsZiwgYSBjaXJjbGUKICAgICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eAogICAgICAgKiBAcGFyYW0ge051bWJlcn0geAogICAgICAgKiBAcGFyYW0ge051bWJlcn0geQogICAgICAgKiBAcGFyYW0ge051bWJlcn0gcmFkaXVzCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NpcmNsZShjdHgsIHgsIHksIHJhZGl1cykgewogICAgICAgIC8vIGRyYXcgc2hhZG93IGlmIGVuYWJsZWQKICAgICAgICB0aGlzLmVuYWJsZVNoYWRvdyhjdHgpOwoKICAgICAgICAvLyBkcmF3IGEgY2lyY2xlCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5hcmMoeCwgeSwgcmFkaXVzLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpOwogICAgICAgIGN0eC5zdHJva2UoKTsKCiAgICAgICAgLy8gZGlzYWJsZSBzaGFkb3dzIGZvciBvdGhlciBlbGVtZW50cy4KICAgICAgICB0aGlzLmRpc2FibGVTaGFkb3coY3R4KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdnZXREaXN0YW5jZVRvRWRnZScsCgogICAgICAvKioKICAgICAgICogQ2FsY3VsYXRlIHRoZSBkaXN0YW5jZSBiZXR3ZWVuIGEgcG9pbnQgKHgzLHkzKSBhbmQgYSBsaW5lIHNlZ21lbnQgZnJvbQogICAgICAgKiAoeDEseTEpIHRvICh4Mix5MikuCiAgICAgICAqIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODQ5MjExL3Nob3J0ZXN0LWRpc3RhbmNhZS1iZXR3ZWVuLWEtcG9pbnQtYW5kLWEtbGluZS1zZWdtZW50CiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB4MQogICAgICAgKiBAcGFyYW0ge251bWJlcn0geTEKICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHgyCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB5MgogICAgICAgKiBAcGFyYW0ge251bWJlcn0geDMKICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHkzCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGlzdGFuY2VUb0VkZ2UoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MywgdmlhKSB7CiAgICAgICAgLy8geDMseTMgaXMgdGhlIHBvaW50CiAgICAgICAgdmFyIHJldHVyblZhbHVlID0gMDsKICAgICAgICBpZiAodGhpcy5mcm9tICE9IHRoaXMudG8pIHsKICAgICAgICAgIHJldHVyblZhbHVlID0gdGhpcy5fZ2V0RGlzdGFuY2VUb0VkZ2UoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MywgdmlhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIF9nZXRDaXJjbGVEYXRhNiA9IHRoaXMuX2dldENpcmNsZURhdGEoKTsKCiAgICAgICAgICB2YXIgX2dldENpcmNsZURhdGE2MiA9IF9zbGljZWRUb0FycmF5KF9nZXRDaXJjbGVEYXRhNiwgMyk7CgogICAgICAgICAgdmFyIHggPSBfZ2V0Q2lyY2xlRGF0YTYyWzBdOwogICAgICAgICAgdmFyIHkgPSBfZ2V0Q2lyY2xlRGF0YTYyWzFdOwogICAgICAgICAgdmFyIHJhZGl1cyA9IF9nZXRDaXJjbGVEYXRhNjJbMl07CgogICAgICAgICAgdmFyIGR4ID0geCAtIHgzOwogICAgICAgICAgdmFyIGR5ID0geSAtIHkzOwogICAgICAgICAgcmV0dXJuVmFsdWUgPSBNYXRoLmFicyhNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpIC0gcmFkaXVzKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmxhYmVsTW9kdWxlLnNpemUubGVmdCA8IHgzICYmIHRoaXMubGFiZWxNb2R1bGUuc2l6ZS5sZWZ0ICsgdGhpcy5sYWJlbE1vZHVsZS5zaXplLndpZHRoID4geDMgJiYgdGhpcy5sYWJlbE1vZHVsZS5zaXplLnRvcCA8IHkzICYmIHRoaXMubGFiZWxNb2R1bGUuc2l6ZS50b3AgKyB0aGlzLmxhYmVsTW9kdWxlLnNpemUuaGVpZ2h0ID4geTMpIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gcmV0dXJuVmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19nZXREaXN0YW5jZVRvTGluZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0RGlzdGFuY2VUb0xpbmUoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykgewogICAgICAgIHZhciBweCA9IHgyIC0geDE7CiAgICAgICAgdmFyIHB5ID0geTIgLSB5MTsKICAgICAgICB2YXIgc29tZXRoaW5nID0gcHggKiBweCArIHB5ICogcHk7CiAgICAgICAgdmFyIHUgPSAoKHgzIC0geDEpICogcHggKyAoeTMgLSB5MSkgKiBweSkgLyBzb21ldGhpbmc7CgogICAgICAgIGlmICh1ID4gMSkgewogICAgICAgICAgdSA9IDE7CiAgICAgICAgfSBlbHNlIGlmICh1IDwgMCkgewogICAgICAgICAgdSA9IDA7CiAgICAgICAgfQoKICAgICAgICB2YXIgeCA9IHgxICsgdSAqIHB4OwogICAgICAgIHZhciB5ID0geTEgKyB1ICogcHk7CiAgICAgICAgdmFyIGR4ID0geCAtIHgzOwogICAgICAgIHZhciBkeSA9IHkgLSB5MzsKCiAgICAgICAgLy8jIE5vdGU6IElmIHRoZSBhY3R1YWwgZGlzdGFuY2UgZG9lcyBub3QgbWF0dGVyLAogICAgICAgIC8vIyBpZiB5b3Ugb25seSB3YW50IHRvIGNvbXBhcmUgd2hhdCB0aGlzIGZ1bmN0aW9uCiAgICAgICAgLy8jIHJldHVybnMgdG8gb3RoZXIgcmVzdWx0cyBvZiB0aGlzIGZ1bmN0aW9uLCB5b3UKICAgICAgICAvLyMgY2FuIGp1c3QgcmV0dXJuIHRoZSBzcXVhcmVkIGRpc3RhbmNlIGluc3RlYWQKICAgICAgICAvLyMgKGkuZS4gcmVtb3ZlIHRoZSBzcXJ0KSB0byBnYWluIGEgbGl0dGxlIHBlcmZvcm1hbmNlCgogICAgICAgIHJldHVybiBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RyYXdBcnJvd0hlYWQnLAoKICAgICAgLyoqCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSBjdHgKICAgICAgICogQHBhcmFtIHBvc2l0aW9uCiAgICAgICAqIEBwYXJhbSB2aWFOb2RlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZHJhd0Fycm93SGVhZChjdHgsIHBvc2l0aW9uLCB2aWFOb2RlLCBzZWxlY3RlZCwgaG92ZXIpIHsKICAgICAgICAvLyBzZXQgc3R5bGUKICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmdldENvbG9yKGN0eCwgc2VsZWN0ZWQsIGhvdmVyKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gY3R4LnN0cm9rZVN0eWxlOwogICAgICAgIGN0eC5saW5lV2lkdGggPSB0aGlzLmdldExpbmVXaWR0aChzZWxlY3RlZCwgaG92ZXIpOwoKICAgICAgICAvLyBzZXQgbGV0cwogICAgICAgIHZhciBhbmdsZSA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgbGVuZ3RoID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBhcnJvd1BvcyA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgbm9kZTEgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIG5vZGUyID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBndWlkZU9mZnNldCA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgc2NhbGVGYWN0b3IgPSB1bmRlZmluZWQ7CgogICAgICAgIGlmIChwb3NpdGlvbiA9PT0gJ2Zyb20nKSB7CiAgICAgICAgICBub2RlMSA9IHRoaXMuZnJvbTsKICAgICAgICAgIG5vZGUyID0gdGhpcy50bzsKICAgICAgICAgIGd1aWRlT2Zmc2V0ID0gMC4xOwogICAgICAgICAgc2NhbGVGYWN0b3IgPSB0aGlzLm9wdGlvbnMuYXJyb3dzLmZyb20uc2NhbGVGYWN0b3I7CiAgICAgICAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PT0gJ3RvJykgewogICAgICAgICAgbm9kZTEgPSB0aGlzLnRvOwogICAgICAgICAgbm9kZTIgPSB0aGlzLmZyb207CiAgICAgICAgICBndWlkZU9mZnNldCA9IC0wLjE7CiAgICAgICAgICBzY2FsZUZhY3RvciA9IHRoaXMub3B0aW9ucy5hcnJvd3MudG8uc2NhbGVGYWN0b3I7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5vZGUxID0gdGhpcy50bzsKICAgICAgICAgIG5vZGUyID0gdGhpcy5mcm9tOwogICAgICAgICAgc2NhbGVGYWN0b3IgPSB0aGlzLm9wdGlvbnMuYXJyb3dzLm1pZGRsZS5zY2FsZUZhY3RvcjsKICAgICAgICB9CgogICAgICAgIC8vIGlmIG5vdCBjb25uZWN0ZWQgdG8gaXRzZWxmCiAgICAgICAgaWYgKG5vZGUxICE9IG5vZGUyKSB7CiAgICAgICAgICBpZiAocG9zaXRpb24gIT09ICdtaWRkbGUnKSB7CiAgICAgICAgICAgIC8vIGRyYXcgYXJyb3cgaGVhZAogICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNtb290aC5lbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgYXJyb3dQb3MgPSB0aGlzLmZpbmRCb3JkZXJQb3NpdGlvbihub2RlMSwgY3R4LCB7IHZpYTogdmlhTm9kZSB9KTsKICAgICAgICAgICAgICB2YXIgZ3VpZGVQb3MgPSB0aGlzLmdldFBvaW50KE1hdGgubWF4KDAsIE1hdGgubWluKDEsIGFycm93UG9zLnQgKyBndWlkZU9mZnNldCkpLCB2aWFOb2RlKTsKICAgICAgICAgICAgICBhbmdsZSA9IE1hdGguYXRhbjIoYXJyb3dQb3MueSAtIGd1aWRlUG9zLnksIGFycm93UG9zLnggLSBndWlkZVBvcy54KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBhbmdsZSA9IE1hdGguYXRhbjIobm9kZTEueSAtIG5vZGUyLnksIG5vZGUxLnggLSBub2RlMi54KTsKICAgICAgICAgICAgICBhcnJvd1BvcyA9IHRoaXMuZmluZEJvcmRlclBvc2l0aW9uKG5vZGUxLCBjdHgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbmdsZSA9IE1hdGguYXRhbjIobm9kZTEueSAtIG5vZGUyLnksIG5vZGUxLnggLSBub2RlMi54KTsKICAgICAgICAgICAgYXJyb3dQb3MgPSB0aGlzLmdldFBvaW50KDAuNiwgdmlhTm9kZSk7IC8vIHRoaXMgaXMgMC42IHRvIGFjY291bnQgZm9yIHRoZSBzaXplIG9mIHRoZSBhcnJvdy4KICAgICAgICAgIH0KICAgICAgICAgIC8vIGRyYXcgYXJyb3cgYXQgdGhlIGVuZCBvZiB0aGUgbGluZQogICAgICAgICAgbGVuZ3RoID0gKDEwICsgNSAqIHRoaXMub3B0aW9ucy53aWR0aCkgKiBzY2FsZUZhY3RvcjsKICAgICAgICAgIGN0eC5hcnJvdyhhcnJvd1Bvcy54LCBhcnJvd1Bvcy55LCBhbmdsZSwgbGVuZ3RoKTsKCiAgICAgICAgICAvLyBkcmF3IHNoYWRvdyBpZiBlbmFibGVkCiAgICAgICAgICB0aGlzLmVuYWJsZVNoYWRvdyhjdHgpOwogICAgICAgICAgY3R4LmZpbGwoKTsKCiAgICAgICAgICAvLyBkaXNhYmxlIHNoYWRvd3MgZm9yIG90aGVyIGVsZW1lbnRzLgogICAgICAgICAgdGhpcy5kaXNhYmxlU2hhZG93KGN0eCk7CiAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGRyYXcgY2lyY2xlCiAgICAgICAgICB2YXIgX2FuZ2xlID0gdW5kZWZpbmVkLAogICAgICAgICAgICAgIHBvaW50ID0gdW5kZWZpbmVkOwoKICAgICAgICAgIHZhciBfZ2V0Q2lyY2xlRGF0YTcgPSB0aGlzLl9nZXRDaXJjbGVEYXRhKGN0eCk7CgogICAgICAgICAgdmFyIF9nZXRDaXJjbGVEYXRhNzIgPSBfc2xpY2VkVG9BcnJheShfZ2V0Q2lyY2xlRGF0YTcsIDMpOwoKICAgICAgICAgIHZhciB4ID0gX2dldENpcmNsZURhdGE3MlswXTsKICAgICAgICAgIHZhciB5ID0gX2dldENpcmNsZURhdGE3MlsxXTsKICAgICAgICAgIHZhciByYWRpdXMgPSBfZ2V0Q2lyY2xlRGF0YTcyWzJdOwoKICAgICAgICAgIGlmIChwb3NpdGlvbiA9PT0gJ2Zyb20nKSB7CiAgICAgICAgICAgIHBvaW50ID0gdGhpcy5maW5kQm9yZGVyUG9zaXRpb24odGhpcy5mcm9tLCBjdHgsIHsgeDogeCwgeTogeSwgbG93OiAwLjI1LCBoaWdoOiAwLjYsIGRpcmVjdGlvbjogLTEgfSk7CiAgICAgICAgICAgIF9hbmdsZSA9IHBvaW50LnQgKiAtMiAqIE1hdGguUEkgKyAxLjUgKiBNYXRoLlBJICsgMC4xICogTWF0aC5QSTsKICAgICAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPT09ICd0bycpIHsKICAgICAgICAgICAgcG9pbnQgPSB0aGlzLmZpbmRCb3JkZXJQb3NpdGlvbih0aGlzLmZyb20sIGN0eCwgeyB4OiB4LCB5OiB5LCBsb3c6IDAuNiwgaGlnaDogMSwgZGlyZWN0aW9uOiAxIH0pOwogICAgICAgICAgICBfYW5nbGUgPSBwb2ludC50ICogLTIgKiBNYXRoLlBJICsgMS41ICogTWF0aC5QSSAtIDEuMSAqIE1hdGguUEk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwb2ludCA9IHRoaXMuX3BvaW50T25DaXJjbGUoeCwgeSwgcmFkaXVzLCAwLjE3NSk7CiAgICAgICAgICAgIF9hbmdsZSA9IDMuOTI2OTkwODE2OTg3MjQxNDsgLy8gPT09IDAuMTc1ICogLTIgKiBNYXRoLlBJICsgMS41ICogTWF0aC5QSSArIDAuMSAqIE1hdGguUEk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gZHJhdyB0aGUgYXJyb3doZWFkCiAgICAgICAgICB2YXIgX2xlbmd0aCA9ICgxMCArIDUgKiB0aGlzLm9wdGlvbnMud2lkdGgpICogc2NhbGVGYWN0b3I7CiAgICAgICAgICBjdHguYXJyb3cocG9pbnQueCwgcG9pbnQueSwgX2FuZ2xlLCBfbGVuZ3RoKTsKCiAgICAgICAgICAvLyBkcmF3IHNoYWRvdyBpZiBlbmFibGVkCiAgICAgICAgICB0aGlzLmVuYWJsZVNoYWRvdyhjdHgpOwogICAgICAgICAgY3R4LmZpbGwoKTsKCiAgICAgICAgICAvLyBkaXNhYmxlIHNoYWRvd3MgZm9yIG90aGVyIGVsZW1lbnRzLgogICAgICAgICAgdGhpcy5kaXNhYmxlU2hhZG93KGN0eCk7CiAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2VuYWJsZVNoYWRvdycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGVTaGFkb3coY3R4KSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zaGFkb3cuZW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgY3R4LnNoYWRvd0NvbG9yID0gJ3JnYmEoMCwwLDAsMC41KSc7CiAgICAgICAgICBjdHguc2hhZG93Qmx1ciA9IHRoaXMub3B0aW9ucy5zaGFkb3cuc2l6ZTsKICAgICAgICAgIGN0eC5zaGFkb3dPZmZzZXRYID0gdGhpcy5vcHRpb25zLnNoYWRvdy54OwogICAgICAgICAgY3R4LnNoYWRvd09mZnNldFkgPSB0aGlzLm9wdGlvbnMuc2hhZG93Lnk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2Rpc2FibGVTaGFkb3cnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzYWJsZVNoYWRvdyhjdHgpIHsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNoYWRvdy5lbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgICBjdHguc2hhZG93Q29sb3IgPSAncmdiYSgwLDAsMCwwKSc7CiAgICAgICAgICBjdHguc2hhZG93Qmx1ciA9IDA7CiAgICAgICAgICBjdHguc2hhZG93T2Zmc2V0WCA9IDA7CiAgICAgICAgICBjdHguc2hhZG93T2Zmc2V0WSA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIEVkZ2VCYXNlOwogIH0pKCk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IEVkZ2VCYXNlOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogODYgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3g0LCBfeDUsIF94NikgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeDQsIHByb3BlcnR5ID0gX3g1LCByZWNlaXZlciA9IF94NjsgZGVzYyA9IHBhcmVudCA9IGdldHRlciA9IHVuZGVmaW5lZDsgX2FnYWluID0gZmFsc2U7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3g0ID0gcGFyZW50OyBfeDUgPSBwcm9wZXJ0eTsgX3g2ID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKICB2YXIgX3V0aWxCZXppZXJFZGdlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oODQpOwoKICB2YXIgX3V0aWxCZXppZXJFZGdlQmFzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsQmV6aWVyRWRnZUJhc2UpOwoKICB2YXIgQmV6aWVyRWRnZVN0YXRpYyA9IChmdW5jdGlvbiAoX0JlemllckVkZ2VCYXNlKSB7CiAgICBmdW5jdGlvbiBCZXppZXJFZGdlU3RhdGljKG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCZXppZXJFZGdlU3RhdGljKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKEJlemllckVkZ2VTdGF0aWMucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSk7CiAgICB9CgogICAgX2luaGVyaXRzKEJlemllckVkZ2VTdGF0aWMsIF9CZXppZXJFZGdlQmFzZSk7CgogICAgX2NyZWF0ZUNsYXNzKEJlemllckVkZ2VTdGF0aWMsIFt7CiAgICAgIGtleTogJ19saW5lJywKCiAgICAgIC8qKgogICAgICAgKiBEcmF3IGEgbGluZSBiZXR3ZWVuIHR3byBub2RlcwogICAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2xpbmUoY3R4KSB7CiAgICAgICAgLy8gZHJhdyBhIHN0cmFpZ2h0IGxpbmUKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyh0aGlzLmZyb20ueCwgdGhpcy5mcm9tLnkpOwogICAgICAgIHZhciB2aWEgPSB0aGlzLl9nZXRWaWFDb29yZGluYXRlcygpOwogICAgICAgIHZhciByZXR1cm5WYWx1ZSA9IHZpYTsKCiAgICAgICAgLy8gZmFsbGJhY2sgdG8gbm9ybWFsIHN0cmFpZ2h0IGVkZ2VzCiAgICAgICAgaWYgKHZpYS54ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGN0eC5saW5lVG8odGhpcy50by54LCB0aGlzLnRvLnkpOwogICAgICAgICAgcmV0dXJuVmFsdWUgPSB1bmRlZmluZWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHZpYS54LCB2aWEueSwgdGhpcy50by54LCB0aGlzLnRvLnkpOwogICAgICAgIH0KICAgICAgICAvLyBkcmF3IHNoYWRvdyBpZiBlbmFibGVkCiAgICAgICAgdGhpcy5lbmFibGVTaGFkb3coY3R4KTsKICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgdGhpcy5kaXNhYmxlU2hhZG93KGN0eCk7CiAgICAgICAgcmV0dXJuIHJldHVyblZhbHVlOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19nZXRWaWFDb29yZGluYXRlcycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0VmlhQ29vcmRpbmF0ZXMoKSB7CiAgICAgICAgdmFyIHhWaWEgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIHlWaWEgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIGZhY3RvciA9IHRoaXMub3B0aW9ucy5zbW9vdGgucm91bmRuZXNzOwogICAgICAgIHZhciB0eXBlID0gdGhpcy5vcHRpb25zLnNtb290aC50eXBlOwogICAgICAgIHZhciBkeCA9IE1hdGguYWJzKHRoaXMuZnJvbS54IC0gdGhpcy50by54KTsKICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyh0aGlzLmZyb20ueSAtIHRoaXMudG8ueSk7CiAgICAgICAgaWYgKHR5cGUgPT09ICdkaXNjcmV0ZScgfHwgdHlwZSA9PT0gJ2RpYWdvbmFsQ3Jvc3MnKSB7CiAgICAgICAgICBpZiAoTWF0aC5hYnModGhpcy5mcm9tLnggLSB0aGlzLnRvLngpIDwgTWF0aC5hYnModGhpcy5mcm9tLnkgLSB0aGlzLnRvLnkpKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmZyb20ueSA+IHRoaXMudG8ueSkgewogICAgICAgICAgICAgIGlmICh0aGlzLmZyb20ueCA8IHRoaXMudG8ueCkgewogICAgICAgICAgICAgICAgeFZpYSA9IHRoaXMuZnJvbS54ICsgZmFjdG9yICogZHk7CiAgICAgICAgICAgICAgICB5VmlhID0gdGhpcy5mcm9tLnkgLSBmYWN0b3IgKiBkeTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZnJvbS54ID4gdGhpcy50by54KSB7CiAgICAgICAgICAgICAgICB4VmlhID0gdGhpcy5mcm9tLnggLSBmYWN0b3IgKiBkeTsKICAgICAgICAgICAgICAgIHlWaWEgPSB0aGlzLmZyb20ueSAtIGZhY3RvciAqIGR5OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZyb20ueSA8IHRoaXMudG8ueSkgewogICAgICAgICAgICAgIGlmICh0aGlzLmZyb20ueCA8IHRoaXMudG8ueCkgewogICAgICAgICAgICAgICAgeFZpYSA9IHRoaXMuZnJvbS54ICsgZmFjdG9yICogZHk7CiAgICAgICAgICAgICAgICB5VmlhID0gdGhpcy5mcm9tLnkgKyBmYWN0b3IgKiBkeTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZnJvbS54ID4gdGhpcy50by54KSB7CiAgICAgICAgICAgICAgICB4VmlhID0gdGhpcy5mcm9tLnggLSBmYWN0b3IgKiBkeTsKICAgICAgICAgICAgICAgIHlWaWEgPSB0aGlzLmZyb20ueSArIGZhY3RvciAqIGR5OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2Rpc2NyZXRlJykgewogICAgICAgICAgICAgIHhWaWEgPSBkeCA8IGZhY3RvciAqIGR5ID8gdGhpcy5mcm9tLnggOiB4VmlhOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKE1hdGguYWJzKHRoaXMuZnJvbS54IC0gdGhpcy50by54KSA+IE1hdGguYWJzKHRoaXMuZnJvbS55IC0gdGhpcy50by55KSkgewogICAgICAgICAgICBpZiAodGhpcy5mcm9tLnkgPiB0aGlzLnRvLnkpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5mcm9tLnggPCB0aGlzLnRvLngpIHsKICAgICAgICAgICAgICAgIHhWaWEgPSB0aGlzLmZyb20ueCArIGZhY3RvciAqIGR4OwogICAgICAgICAgICAgICAgeVZpYSA9IHRoaXMuZnJvbS55IC0gZmFjdG9yICogZHg7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZyb20ueCA+IHRoaXMudG8ueCkgewogICAgICAgICAgICAgICAgeFZpYSA9IHRoaXMuZnJvbS54IC0gZmFjdG9yICogZHg7CiAgICAgICAgICAgICAgICB5VmlhID0gdGhpcy5mcm9tLnkgLSBmYWN0b3IgKiBkeDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5mcm9tLnkgPCB0aGlzLnRvLnkpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5mcm9tLnggPCB0aGlzLnRvLngpIHsKICAgICAgICAgICAgICAgIHhWaWEgPSB0aGlzLmZyb20ueCArIGZhY3RvciAqIGR4OwogICAgICAgICAgICAgICAgeVZpYSA9IHRoaXMuZnJvbS55ICsgZmFjdG9yICogZHg7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZyb20ueCA+IHRoaXMudG8ueCkgewogICAgICAgICAgICAgICAgeFZpYSA9IHRoaXMuZnJvbS54IC0gZmFjdG9yICogZHg7CiAgICAgICAgICAgICAgICB5VmlhID0gdGhpcy5mcm9tLnkgKyBmYWN0b3IgKiBkeDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdkaXNjcmV0ZScpIHsKICAgICAgICAgICAgICB5VmlhID0gZHkgPCBmYWN0b3IgKiBkeCA/IHRoaXMuZnJvbS55IDogeVZpYTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3N0cmFpZ2h0Q3Jvc3MnKSB7CiAgICAgICAgICBpZiAoTWF0aC5hYnModGhpcy5mcm9tLnggLSB0aGlzLnRvLngpIDwgTWF0aC5hYnModGhpcy5mcm9tLnkgLSB0aGlzLnRvLnkpKSB7CiAgICAgICAgICAgIC8vIHVwIC0gZG93bgogICAgICAgICAgICB4VmlhID0gdGhpcy5mcm9tLng7CiAgICAgICAgICAgIGlmICh0aGlzLmZyb20ueSA8IHRoaXMudG8ueSkgewogICAgICAgICAgICAgIHlWaWEgPSB0aGlzLnRvLnkgLSAoMSAtIGZhY3RvcikgKiBkeTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB5VmlhID0gdGhpcy50by55ICsgKDEgLSBmYWN0b3IpICogZHk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoTWF0aC5hYnModGhpcy5mcm9tLnggLSB0aGlzLnRvLngpID4gTWF0aC5hYnModGhpcy5mcm9tLnkgLSB0aGlzLnRvLnkpKSB7CiAgICAgICAgICAgIC8vIGxlZnQgLSByaWdodAogICAgICAgICAgICBpZiAodGhpcy5mcm9tLnggPCB0aGlzLnRvLngpIHsKICAgICAgICAgICAgICB4VmlhID0gdGhpcy50by54IC0gKDEgLSBmYWN0b3IpICogZHg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgeFZpYSA9IHRoaXMudG8ueCArICgxIC0gZmFjdG9yKSAqIGR4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHlWaWEgPSB0aGlzLmZyb20ueTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdob3Jpem9udGFsJykgewogICAgICAgICAgaWYgKHRoaXMuZnJvbS54IDwgdGhpcy50by54KSB7CiAgICAgICAgICAgIHhWaWEgPSB0aGlzLnRvLnggLSAoMSAtIGZhY3RvcikgKiBkeDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHhWaWEgPSB0aGlzLnRvLnggKyAoMSAtIGZhY3RvcikgKiBkeDsKICAgICAgICAgIH0KICAgICAgICAgIHlWaWEgPSB0aGlzLmZyb20ueTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICd2ZXJ0aWNhbCcpIHsKICAgICAgICAgIHhWaWEgPSB0aGlzLmZyb20ueDsKICAgICAgICAgIGlmICh0aGlzLmZyb20ueSA8IHRoaXMudG8ueSkgewogICAgICAgICAgICB5VmlhID0gdGhpcy50by55IC0gKDEgLSBmYWN0b3IpICogZHk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB5VmlhID0gdGhpcy50by55ICsgKDEgLSBmYWN0b3IpICogZHk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnY3VydmVkQ1cnKSB7CiAgICAgICAgICBkeCA9IHRoaXMudG8ueCAtIHRoaXMuZnJvbS54OwogICAgICAgICAgZHkgPSB0aGlzLmZyb20ueSAtIHRoaXMudG8ueTsKICAgICAgICAgIHZhciByYWRpdXMgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgICAgICAgdmFyIHBpID0gTWF0aC5QSTsKCiAgICAgICAgICB2YXIgb3JpZ2luYWxBbmdsZSA9IE1hdGguYXRhbjIoZHksIGR4KTsKICAgICAgICAgIHZhciBteUFuZ2xlID0gKG9yaWdpbmFsQW5nbGUgKyAoZmFjdG9yICogMC41ICsgMC41KSAqIHBpKSAlICgyICogcGkpOwoKICAgICAgICAgIHhWaWEgPSB0aGlzLmZyb20ueCArIChmYWN0b3IgKiAwLjUgKyAwLjUpICogcmFkaXVzICogTWF0aC5zaW4obXlBbmdsZSk7CiAgICAgICAgICB5VmlhID0gdGhpcy5mcm9tLnkgKyAoZmFjdG9yICogMC41ICsgMC41KSAqIHJhZGl1cyAqIE1hdGguY29zKG15QW5nbGUpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2N1cnZlZENDVycpIHsKICAgICAgICAgIGR4ID0gdGhpcy50by54IC0gdGhpcy5mcm9tLng7CiAgICAgICAgICBkeSA9IHRoaXMuZnJvbS55IC0gdGhpcy50by55OwogICAgICAgICAgdmFyIHJhZGl1cyA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CiAgICAgICAgICB2YXIgcGkgPSBNYXRoLlBJOwoKICAgICAgICAgIHZhciBvcmlnaW5hbEFuZ2xlID0gTWF0aC5hdGFuMihkeSwgZHgpOwogICAgICAgICAgdmFyIG15QW5nbGUgPSAob3JpZ2luYWxBbmdsZSArICgtZmFjdG9yICogMC41ICsgMC41KSAqIHBpKSAlICgyICogcGkpOwoKICAgICAgICAgIHhWaWEgPSB0aGlzLmZyb20ueCArIChmYWN0b3IgKiAwLjUgKyAwLjUpICogcmFkaXVzICogTWF0aC5zaW4obXlBbmdsZSk7CiAgICAgICAgICB5VmlhID0gdGhpcy5mcm9tLnkgKyAoZmFjdG9yICogMC41ICsgMC41KSAqIHJhZGl1cyAqIE1hdGguY29zKG15QW5nbGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBjb250aW51b3VzCiAgICAgICAgICBpZiAoTWF0aC5hYnModGhpcy5mcm9tLnggLSB0aGlzLnRvLngpIDwgTWF0aC5hYnModGhpcy5mcm9tLnkgLSB0aGlzLnRvLnkpKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmZyb20ueSA+IHRoaXMudG8ueSkgewogICAgICAgICAgICAgIGlmICh0aGlzLmZyb20ueCA8IHRoaXMudG8ueCkgewogICAgICAgICAgICAgICAgeFZpYSA9IHRoaXMuZnJvbS54ICsgZmFjdG9yICogZHk7CiAgICAgICAgICAgICAgICB5VmlhID0gdGhpcy5mcm9tLnkgLSBmYWN0b3IgKiBkeTsKICAgICAgICAgICAgICAgIHhWaWEgPSB0aGlzLnRvLnggPCB4VmlhID8gdGhpcy50by54IDogeFZpYTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZnJvbS54ID4gdGhpcy50by54KSB7CiAgICAgICAgICAgICAgICB4VmlhID0gdGhpcy5mcm9tLnggLSBmYWN0b3IgKiBkeTsKICAgICAgICAgICAgICAgIHlWaWEgPSB0aGlzLmZyb20ueSAtIGZhY3RvciAqIGR5OwogICAgICAgICAgICAgICAgeFZpYSA9IHRoaXMudG8ueCA+IHhWaWEgPyB0aGlzLnRvLnggOiB4VmlhOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZyb20ueSA8IHRoaXMudG8ueSkgewogICAgICAgICAgICAgIGlmICh0aGlzLmZyb20ueCA8IHRoaXMudG8ueCkgewogICAgICAgICAgICAgICAgeFZpYSA9IHRoaXMuZnJvbS54ICsgZmFjdG9yICogZHk7CiAgICAgICAgICAgICAgICB5VmlhID0gdGhpcy5mcm9tLnkgKyBmYWN0b3IgKiBkeTsKICAgICAgICAgICAgICAgIHhWaWEgPSB0aGlzLnRvLnggPCB4VmlhID8gdGhpcy50by54IDogeFZpYTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZnJvbS54ID4gdGhpcy50by54KSB7CiAgICAgICAgICAgICAgICB4VmlhID0gdGhpcy5mcm9tLnggLSBmYWN0b3IgKiBkeTsKICAgICAgICAgICAgICAgIHlWaWEgPSB0aGlzLmZyb20ueSArIGZhY3RvciAqIGR5OwogICAgICAgICAgICAgICAgeFZpYSA9IHRoaXMudG8ueCA+IHhWaWEgPyB0aGlzLnRvLnggOiB4VmlhOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmIChNYXRoLmFicyh0aGlzLmZyb20ueCAtIHRoaXMudG8ueCkgPiBNYXRoLmFicyh0aGlzLmZyb20ueSAtIHRoaXMudG8ueSkpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZnJvbS55ID4gdGhpcy50by55KSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuZnJvbS54IDwgdGhpcy50by54KSB7CiAgICAgICAgICAgICAgICB4VmlhID0gdGhpcy5mcm9tLnggKyBmYWN0b3IgKiBkeDsKICAgICAgICAgICAgICAgIHlWaWEgPSB0aGlzLmZyb20ueSAtIGZhY3RvciAqIGR4OwogICAgICAgICAgICAgICAgeVZpYSA9IHRoaXMudG8ueSA+IHlWaWEgPyB0aGlzLnRvLnkgOiB5VmlhOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5mcm9tLnggPiB0aGlzLnRvLngpIHsKICAgICAgICAgICAgICAgIHhWaWEgPSB0aGlzLmZyb20ueCAtIGZhY3RvciAqIGR4OwogICAgICAgICAgICAgICAgeVZpYSA9IHRoaXMuZnJvbS55IC0gZmFjdG9yICogZHg7CiAgICAgICAgICAgICAgICB5VmlhID0gdGhpcy50by55ID4geVZpYSA/IHRoaXMudG8ueSA6IHlWaWE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZnJvbS55IDwgdGhpcy50by55KSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuZnJvbS54IDwgdGhpcy50by54KSB7CiAgICAgICAgICAgICAgICB4VmlhID0gdGhpcy5mcm9tLnggKyBmYWN0b3IgKiBkeDsKICAgICAgICAgICAgICAgIHlWaWEgPSB0aGlzLmZyb20ueSArIGZhY3RvciAqIGR4OwogICAgICAgICAgICAgICAgeVZpYSA9IHRoaXMudG8ueSA8IHlWaWEgPyB0aGlzLnRvLnkgOiB5VmlhOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5mcm9tLnggPiB0aGlzLnRvLngpIHsKICAgICAgICAgICAgICAgIHhWaWEgPSB0aGlzLmZyb20ueCAtIGZhY3RvciAqIGR4OwogICAgICAgICAgICAgICAgeVZpYSA9IHRoaXMuZnJvbS55ICsgZmFjdG9yICogZHg7CiAgICAgICAgICAgICAgICB5VmlhID0gdGhpcy50by55IDwgeVZpYSA/IHRoaXMudG8ueSA6IHlWaWE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB7IHg6IHhWaWEsIHk6IHlWaWEgfTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZmluZEJvcmRlclBvc2l0aW9uJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9maW5kQm9yZGVyUG9zaXRpb24obmVhck5vZGUsIGN0eCkgewogICAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyB7fSA6IGFyZ3VtZW50c1syXTsKCiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbmRCb3JkZXJQb3NpdGlvbkJlemllcihuZWFyTm9kZSwgY3R4LCBvcHRpb25zLnZpYSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2dldERpc3RhbmNlVG9FZGdlJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXREaXN0YW5jZVRvRWRnZSh4MSwgeTEsIHgyLCB5MiwgeDMsIHkzKSB7CiAgICAgICAgdmFyIHZpYSA9IGFyZ3VtZW50c1s2XSA9PT0gdW5kZWZpbmVkID8gdGhpcy5fZ2V0VmlhQ29vcmRpbmF0ZXMoKSA6IGFyZ3VtZW50c1s2XTsKICAgICAgICAvLyB4Myx5MyBpcyB0aGUgcG9pbnQKICAgICAgICByZXR1cm4gdGhpcy5fZ2V0RGlzdGFuY2VUb0JlemllckVkZ2UoeDEsIHkxLCB4MiwgeTIsIHgzLCB5MywgdmlhKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdnZXRQb2ludCcsCgogICAgICAvKioKICAgICAgICogQ29tYmluZWQgZnVuY3Rpb24gb2YgcG9pbnRPbkxpbmUgYW5kIHBvaW50T25CZXppZXIuIFRoaXMgZ2l2ZXMgdGhlIGNvb3JkaW5hdGVzIG9mIGEgcG9pbnQgb24gdGhlIGxpbmUgYXQgYSBjZXJ0YWluIHBlcmNlbnRhZ2Ugb2YgdGhlIHdheQogICAgICAgKiBAcGFyYW0gcGVyY2VudGFnZQogICAgICAgKiBAcGFyYW0gdmlhCiAgICAgICAqIEByZXR1cm5zIHt7eDogbnVtYmVyLCB5OiBudW1iZXJ9fQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBvaW50KHBlcmNlbnRhZ2UpIHsKICAgICAgICB2YXIgdmlhID0gYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB0aGlzLl9nZXRWaWFDb29yZGluYXRlcygpIDogYXJndW1lbnRzWzFdOwoKICAgICAgICB2YXIgdCA9IHBlcmNlbnRhZ2U7CiAgICAgICAgdmFyIHggPSBNYXRoLnBvdygxIC0gdCwgMikgKiB0aGlzLmZyb20ueCArIDIgKiB0ICogKDEgLSB0KSAqIHZpYS54ICsgTWF0aC5wb3codCwgMikgKiB0aGlzLnRvLng7CiAgICAgICAgdmFyIHkgPSBNYXRoLnBvdygxIC0gdCwgMikgKiB0aGlzLmZyb20ueSArIDIgKiB0ICogKDEgLSB0KSAqIHZpYS55ICsgTWF0aC5wb3codCwgMikgKiB0aGlzLnRvLnk7CgogICAgICAgIHJldHVybiB7IHg6IHgsIHk6IHkgfTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBCZXppZXJFZGdlU3RhdGljOwogIH0pKF91dGlsQmV6aWVyRWRnZUJhc2UyWydkZWZhdWx0J10pOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBCZXppZXJFZGdlU3RhdGljOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogODcgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgdmFyIF9nZXQgPSBmdW5jdGlvbiBnZXQoX3gsIF94MiwgX3gzKSB7IHZhciBfYWdhaW4gPSB0cnVlOyBfZnVuY3Rpb246IHdoaWxlIChfYWdhaW4pIHsgdmFyIG9iamVjdCA9IF94LCBwcm9wZXJ0eSA9IF94MiwgcmVjZWl2ZXIgPSBfeDM7IGRlc2MgPSBwYXJlbnQgPSBnZXR0ZXIgPSB1bmRlZmluZWQ7IF9hZ2FpbiA9IGZhbHNlOyB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBwcm9wZXJ0eSk7IGlmIChkZXNjID09PSB1bmRlZmluZWQpIHsgdmFyIHBhcmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmplY3QpOyBpZiAocGFyZW50ID09PSBudWxsKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gZWxzZSB7IF94ID0gcGFyZW50OyBfeDIgPSBwcm9wZXJ0eTsgX3gzID0gcmVjZWl2ZXI7IF9hZ2FpbiA9IHRydWU7IGNvbnRpbnVlIF9mdW5jdGlvbjsgfSB9IGVsc2UgaWYgKCd2YWx1ZScgaW4gZGVzYykgeyByZXR1cm4gZGVzYy52YWx1ZTsgfSBlbHNlIHsgdmFyIGdldHRlciA9IGRlc2MuZ2V0OyBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSByZXR1cm4gZ2V0dGVyLmNhbGwocmVjZWl2ZXIpOyB9IH0gfTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gJ2Z1bmN0aW9uJyAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ1N1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgJyArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgc3ViQ2xhc3MuX19wcm90b19fID0gc3VwZXJDbGFzczsgfQoKICB2YXIgX3V0aWxFZGdlQmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oODUpOwoKICB2YXIgX3V0aWxFZGdlQmFzZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF91dGlsRWRnZUJhc2UpOwoKICB2YXIgU3RyYWlnaHRFZGdlID0gKGZ1bmN0aW9uIChfRWRnZUJhc2UpIHsKICAgIGZ1bmN0aW9uIFN0cmFpZ2h0RWRnZShvcHRpb25zLCBib2R5LCBsYWJlbE1vZHVsZSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3RyYWlnaHRFZGdlKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKFN0cmFpZ2h0RWRnZS5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIG9wdGlvbnMsIGJvZHksIGxhYmVsTW9kdWxlKTsKICAgIH0KCiAgICBfaW5oZXJpdHMoU3RyYWlnaHRFZGdlLCBfRWRnZUJhc2UpOwoKICAgIF9jcmVhdGVDbGFzcyhTdHJhaWdodEVkZ2UsIFt7CiAgICAgIGtleTogJ19saW5lJywKCiAgICAgIC8qKgogICAgICAgKiBEcmF3IGEgbGluZSBiZXR3ZWVuIHR3byBub2RlcwogICAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2xpbmUoY3R4KSB7CiAgICAgICAgLy8gZHJhdyBhIHN0cmFpZ2h0IGxpbmUKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyh0aGlzLmZyb20ueCwgdGhpcy5mcm9tLnkpOwogICAgICAgIGN0eC5saW5lVG8odGhpcy50by54LCB0aGlzLnRvLnkpOwogICAgICAgIC8vIGRyYXcgc2hhZG93IGlmIGVuYWJsZWQKICAgICAgICB0aGlzLmVuYWJsZVNoYWRvdyhjdHgpOwogICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICB0aGlzLmRpc2FibGVTaGFkb3coY3R4KTsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2dldFBvaW50JywKCiAgICAgIC8qKgogICAgICAgKiBDb21iaW5lZCBmdW5jdGlvbiBvZiBwb2ludE9uTGluZSBhbmQgcG9pbnRPbkJlemllci4gVGhpcyBnaXZlcyB0aGUgY29vcmRpbmF0ZXMgb2YgYSBwb2ludCBvbiB0aGUgbGluZSBhdCBhIGNlcnRhaW4gcGVyY2VudGFnZSBvZiB0aGUgd2F5CiAgICAgICAqIEBwYXJhbSBwZXJjZW50YWdlCiAgICAgICAqIEBwYXJhbSB2aWEKICAgICAgICogQHJldHVybnMge3t4OiBudW1iZXIsIHk6IG51bWJlcn19CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UG9pbnQocGVyY2VudGFnZSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB4OiAoMSAtIHBlcmNlbnRhZ2UpICogdGhpcy5mcm9tLnggKyBwZXJjZW50YWdlICogdGhpcy50by54LAogICAgICAgICAgeTogKDEgLSBwZXJjZW50YWdlKSAqIHRoaXMuZnJvbS55ICsgcGVyY2VudGFnZSAqIHRoaXMudG8ueQogICAgICAgIH07CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2ZpbmRCb3JkZXJQb3NpdGlvbicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluZEJvcmRlclBvc2l0aW9uKG5lYXJOb2RlLCBjdHgpIHsKICAgICAgICB2YXIgbm9kZTEgPSB0aGlzLnRvOwogICAgICAgIHZhciBub2RlMiA9IHRoaXMuZnJvbTsKICAgICAgICBpZiAobmVhck5vZGUuaWQgPT09IHRoaXMuZnJvbS5pZCkgewogICAgICAgICAgbm9kZTEgPSB0aGlzLmZyb207CiAgICAgICAgICBub2RlMiA9IHRoaXMudG87CiAgICAgICAgfQoKICAgICAgICB2YXIgYW5nbGUgPSBNYXRoLmF0YW4yKG5vZGUxLnkgLSBub2RlMi55LCBub2RlMS54IC0gbm9kZTIueCk7CiAgICAgICAgdmFyIGR4ID0gbm9kZTEueCAtIG5vZGUyLng7CiAgICAgICAgdmFyIGR5ID0gbm9kZTEueSAtIG5vZGUyLnk7CiAgICAgICAgdmFyIGVkZ2VTZWdtZW50TGVuZ3RoID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgICAgICB2YXIgdG9Cb3JkZXJEaXN0ID0gbmVhck5vZGUuZGlzdGFuY2VUb0JvcmRlcihjdHgsIGFuZ2xlKTsKICAgICAgICB2YXIgdG9Cb3JkZXJQb2ludCA9IChlZGdlU2VnbWVudExlbmd0aCAtIHRvQm9yZGVyRGlzdCkgLyBlZGdlU2VnbWVudExlbmd0aDsKCiAgICAgICAgdmFyIGJvcmRlclBvcyA9IHt9OwogICAgICAgIGJvcmRlclBvcy54ID0gKDEgLSB0b0JvcmRlclBvaW50KSAqIG5vZGUyLnggKyB0b0JvcmRlclBvaW50ICogbm9kZTEueDsKICAgICAgICBib3JkZXJQb3MueSA9ICgxIC0gdG9Cb3JkZXJQb2ludCkgKiBub2RlMi55ICsgdG9Cb3JkZXJQb2ludCAqIG5vZGUxLnk7CgogICAgICAgIHJldHVybiBib3JkZXJQb3M7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2dldERpc3RhbmNlVG9FZGdlJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXREaXN0YW5jZVRvRWRnZSh4MSwgeTEsIHgyLCB5MiwgeDMsIHkzKSB7CiAgICAgICAgLy8geDMseTMgaXMgdGhlIHBvaW50CiAgICAgICAgcmV0dXJuIHRoaXMuX2dldERpc3RhbmNlVG9MaW5lKHgxLCB5MSwgeDIsIHkyLCB4MywgeTMpOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFN0cmFpZ2h0RWRnZTsKICB9KShfdXRpbEVkZ2VCYXNlMlsnZGVmYXVsdCddKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gU3RyYWlnaHRFZGdlOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogODggKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgdmFyIF9jb21wb25lbnRzUGh5c2ljc0Jhcm5lc0h1dFNvbHZlciA9IF9fd2VicGFja19yZXF1aXJlX18oODkpOwoKICB2YXIgX2NvbXBvbmVudHNQaHlzaWNzQmFybmVzSHV0U29sdmVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbXBvbmVudHNQaHlzaWNzQmFybmVzSHV0U29sdmVyKTsKCiAgdmFyIF9jb21wb25lbnRzUGh5c2ljc1JlcHVsc2lvblNvbHZlciA9IF9fd2VicGFja19yZXF1aXJlX18oOTApOwoKICB2YXIgX2NvbXBvbmVudHNQaHlzaWNzUmVwdWxzaW9uU29sdmVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbXBvbmVudHNQaHlzaWNzUmVwdWxzaW9uU29sdmVyKTsKCiAgdmFyIF9jb21wb25lbnRzUGh5c2ljc0hpZXJhcmNoaWNhbFJlcHVsc2lvblNvbHZlciA9IF9fd2VicGFja19yZXF1aXJlX18oOTEpOwoKICB2YXIgX2NvbXBvbmVudHNQaHlzaWNzSGllcmFyY2hpY2FsUmVwdWxzaW9uU29sdmVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbXBvbmVudHNQaHlzaWNzSGllcmFyY2hpY2FsUmVwdWxzaW9uU29sdmVyKTsKCiAgdmFyIF9jb21wb25lbnRzUGh5c2ljc1NwcmluZ1NvbHZlciA9IF9fd2VicGFja19yZXF1aXJlX18oOTIpOwoKICB2YXIgX2NvbXBvbmVudHNQaHlzaWNzU3ByaW5nU29sdmVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbXBvbmVudHNQaHlzaWNzU3ByaW5nU29sdmVyKTsKCiAgdmFyIF9jb21wb25lbnRzUGh5c2ljc0hpZXJhcmNoaWNhbFNwcmluZ1NvbHZlciA9IF9fd2VicGFja19yZXF1aXJlX18oOTMpOwoKICB2YXIgX2NvbXBvbmVudHNQaHlzaWNzSGllcmFyY2hpY2FsU3ByaW5nU29sdmVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbXBvbmVudHNQaHlzaWNzSGllcmFyY2hpY2FsU3ByaW5nU29sdmVyKTsKCiAgdmFyIF9jb21wb25lbnRzUGh5c2ljc0NlbnRyYWxHcmF2aXR5U29sdmVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NCk7CgogIHZhciBfY29tcG9uZW50c1BoeXNpY3NDZW50cmFsR3Jhdml0eVNvbHZlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb21wb25lbnRzUGh5c2ljc0NlbnRyYWxHcmF2aXR5U29sdmVyKTsKCiAgdmFyIF9jb21wb25lbnRzUGh5c2ljc0ZBMkJhc2VkUmVwdWxzaW9uU29sdmVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NSk7CgogIHZhciBfY29tcG9uZW50c1BoeXNpY3NGQTJCYXNlZFJlcHVsc2lvblNvbHZlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb21wb25lbnRzUGh5c2ljc0ZBMkJhc2VkUmVwdWxzaW9uU29sdmVyKTsKCiAgdmFyIF9jb21wb25lbnRzUGh5c2ljc0ZBMkJhc2VkQ2VudHJhbEdyYXZpdHlTb2x2ZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk2KTsKCiAgdmFyIF9jb21wb25lbnRzUGh5c2ljc0ZBMkJhc2VkQ2VudHJhbEdyYXZpdHlTb2x2ZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY29tcG9uZW50c1BoeXNpY3NGQTJCYXNlZENlbnRyYWxHcmF2aXR5U29sdmVyKTsKCiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICB2YXIgUGh5c2ljc0VuZ2luZSA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBQaHlzaWNzRW5naW5lKGJvZHkpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBoeXNpY3NFbmdpbmUpOwoKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5waHlzaWNzQm9keSA9IHsgcGh5c2ljc05vZGVJbmRpY2VzOiBbXSwgcGh5c2ljc0VkZ2VJbmRpY2VzOiBbXSwgZm9yY2VzOiB7fSwgdmVsb2NpdGllczoge30gfTsKCiAgICAgIHRoaXMucGh5c2ljc0VuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnNpbXVsYXRpb25JbnRlcnZhbCA9IDEwMDAgLyA2MDsKICAgICAgdGhpcy5yZXF1aXJlc1RpbWVvdXQgPSB0cnVlOwogICAgICB0aGlzLnByZXZpb3VzU3RhdGVzID0ge307CiAgICAgIHRoaXMuZnJlZXplQ2FjaGUgPSB7fTsKICAgICAgdGhpcy5yZW5kZXJUaW1lciA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy5pbml0aWFsU3RhYmlsaXphdGlvbkVtaXR0ZWQgPSBmYWxzZTsKCiAgICAgIHRoaXMuc3RhYmlsaXplZCA9IGZhbHNlOwogICAgICB0aGlzLnN0YXJ0ZWRTdGFiaWxpemF0aW9uID0gZmFsc2U7CiAgICAgIHRoaXMuc3RhYmlsaXphdGlvbkl0ZXJhdGlvbnMgPSAwOwogICAgICB0aGlzLnJlYWR5ID0gZmFsc2U7IC8vIHdpbGwgYmUgc2V0IHRvIHRydWUgaWYgdGhlIHN0YWJpbGl6ZQoKICAgICAgLy8gZGVmYXVsdCBvcHRpb25zCiAgICAgIHRoaXMub3B0aW9ucyA9IHt9OwogICAgICB0aGlzLmRlZmF1bHRPcHRpb25zID0gewogICAgICAgIGVuYWJsZWQ6IHRydWUsCiAgICAgICAgYmFybmVzSHV0OiB7CiAgICAgICAgICB0aGV0YTogMC41LAogICAgICAgICAgZ3Jhdml0YXRpb25hbENvbnN0YW50OiAtMjAwMCwKICAgICAgICAgIGNlbnRyYWxHcmF2aXR5OiAwLjMsCiAgICAgICAgICBzcHJpbmdMZW5ndGg6IDk1LAogICAgICAgICAgc3ByaW5nQ29uc3RhbnQ6IDAuMDQsCiAgICAgICAgICBkYW1waW5nOiAwLjA5LAogICAgICAgICAgYXZvaWRPdmVybGFwOiAwCiAgICAgICAgfSwKICAgICAgICBmb3JjZUF0bGFzMkJhc2VkOiB7CiAgICAgICAgICB0aGV0YTogMC41LAogICAgICAgICAgZ3Jhdml0YXRpb25hbENvbnN0YW50OiAtNTAsCiAgICAgICAgICBjZW50cmFsR3Jhdml0eTogMC4wMSwKICAgICAgICAgIHNwcmluZ0NvbnN0YW50OiAwLjA4LAogICAgICAgICAgc3ByaW5nTGVuZ3RoOiAxMDAsCiAgICAgICAgICBkYW1waW5nOiAwLjQsCiAgICAgICAgICBhdm9pZE92ZXJsYXA6IDAKICAgICAgICB9LAogICAgICAgIHJlcHVsc2lvbjogewogICAgICAgICAgY2VudHJhbEdyYXZpdHk6IDAuMiwKICAgICAgICAgIHNwcmluZ0xlbmd0aDogMjAwLAogICAgICAgICAgc3ByaW5nQ29uc3RhbnQ6IDAuMDUsCiAgICAgICAgICBub2RlRGlzdGFuY2U6IDEwMCwKICAgICAgICAgIGRhbXBpbmc6IDAuMDksCiAgICAgICAgICBhdm9pZE92ZXJsYXA6IDAKICAgICAgICB9LAogICAgICAgIGhpZXJhcmNoaWNhbFJlcHVsc2lvbjogewogICAgICAgICAgY2VudHJhbEdyYXZpdHk6IDAsCiAgICAgICAgICBzcHJpbmdMZW5ndGg6IDEwMCwKICAgICAgICAgIHNwcmluZ0NvbnN0YW50OiAwLjAxLAogICAgICAgICAgbm9kZURpc3RhbmNlOiAxMjAsCiAgICAgICAgICBkYW1waW5nOiAwLjA5CiAgICAgICAgfSwKICAgICAgICBtYXhWZWxvY2l0eTogNTAsCiAgICAgICAgbWluVmVsb2NpdHk6IDAuMSwgLy8gcHgvcwogICAgICAgIHNvbHZlcjogJ2Jhcm5lc0h1dCcsCiAgICAgICAgc3RhYmlsaXphdGlvbjogewogICAgICAgICAgZW5hYmxlZDogdHJ1ZSwKICAgICAgICAgIGl0ZXJhdGlvbnM6IDEwMDAsIC8vIG1heGltdW0gbnVtYmVyIG9mIGl0ZXJhdGlvbiB0byBzdGFiaWxpemUKICAgICAgICAgIHVwZGF0ZUludGVydmFsOiA1MCwKICAgICAgICAgIG9ubHlEeW5hbWljRWRnZXM6IGZhbHNlLAogICAgICAgICAgZml0OiB0cnVlCiAgICAgICAgfSwKICAgICAgICB0aW1lc3RlcDogMC41CiAgICAgIH07CiAgICAgIHV0aWwuZXh0ZW5kKHRoaXMub3B0aW9ucywgdGhpcy5kZWZhdWx0T3B0aW9ucyk7CgogICAgICB0aGlzLmJpbmRFdmVudExpc3RlbmVycygpOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhQaHlzaWNzRW5naW5lLCBbewogICAgICBrZXk6ICdiaW5kRXZlbnRMaXN0ZW5lcnMnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gYmluZEV2ZW50TGlzdGVuZXJzKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdpbml0UGh5c2ljcycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLmluaXRQaHlzaWNzKCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ3Jlc2V0UGh5c2ljcycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLnN0b3BTaW11bGF0aW9uKCk7X3RoaXMucmVhZHkgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignZGlzYWJsZVBoeXNpY3MnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpcy5waHlzaWNzRW5hYmxlZCA9IGZhbHNlO190aGlzLnN0b3BTaW11bGF0aW9uKCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ3Jlc3RvcmVQaHlzaWNzJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMuc2V0T3B0aW9ucyhfdGhpcy5vcHRpb25zKTsKICAgICAgICAgIGlmIChfdGhpcy5yZWFkeSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBfdGhpcy5zdGFydFNpbXVsYXRpb24oKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignc3RhcnRTaW11bGF0aW9uJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKF90aGlzLnJlYWR5ID09PSB0cnVlKSB7CiAgICAgICAgICAgIF90aGlzLnN0YXJ0U2ltdWxhdGlvbigpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdzdG9wU2ltdWxhdGlvbicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLnN0b3BTaW11bGF0aW9uKCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ2Rlc3Ryb3knLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpcy5zdG9wU2ltdWxhdGlvbihmYWxzZSk7CiAgICAgICAgICBfdGhpcy5ib2R5LmVtaXR0ZXIub2ZmKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc2V0T3B0aW9ucycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICBpZiAob3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5waHlzaWNzRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnN0b3BTaW11bGF0aW9uKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBoeXNpY3NFbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgdXRpbC5zZWxlY3RpdmVOb3REZWVwRXh0ZW5kKFsnc3RhYmlsaXphdGlvbiddLCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgICAgICAgICB1dGlsLm1lcmdlT3B0aW9ucyh0aGlzLm9wdGlvbnMsIG9wdGlvbnMsICdzdGFiaWxpemF0aW9uJyk7CgogICAgICAgICAgICBpZiAob3B0aW9ucy5lbmFibGVkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZW5hYmxlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICB0aGlzLnBoeXNpY3NFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy5zdG9wU2ltdWxhdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuaW5pdCgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2luaXQnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB2YXIgb3B0aW9uczsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNvbHZlciA9PT0gJ2ZvcmNlQXRsYXMyQmFzZWQnKSB7CiAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLmZvcmNlQXRsYXMyQmFzZWQ7CiAgICAgICAgICB0aGlzLm5vZGVzU29sdmVyID0gbmV3IF9jb21wb25lbnRzUGh5c2ljc0ZBMkJhc2VkUmVwdWxzaW9uU29sdmVyMlsnZGVmYXVsdCddKHRoaXMuYm9keSwgdGhpcy5waHlzaWNzQm9keSwgb3B0aW9ucyk7CiAgICAgICAgICB0aGlzLmVkZ2VzU29sdmVyID0gbmV3IF9jb21wb25lbnRzUGh5c2ljc1NwcmluZ1NvbHZlcjJbJ2RlZmF1bHQnXSh0aGlzLmJvZHksIHRoaXMucGh5c2ljc0JvZHksIG9wdGlvbnMpOwogICAgICAgICAgdGhpcy5ncmF2aXR5U29sdmVyID0gbmV3IF9jb21wb25lbnRzUGh5c2ljc0ZBMkJhc2VkQ2VudHJhbEdyYXZpdHlTb2x2ZXIyWydkZWZhdWx0J10odGhpcy5ib2R5LCB0aGlzLnBoeXNpY3NCb2R5LCBvcHRpb25zKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5zb2x2ZXIgPT09ICdyZXB1bHNpb24nKSB7CiAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLnJlcHVsc2lvbjsKICAgICAgICAgIHRoaXMubm9kZXNTb2x2ZXIgPSBuZXcgX2NvbXBvbmVudHNQaHlzaWNzUmVwdWxzaW9uU29sdmVyMlsnZGVmYXVsdCddKHRoaXMuYm9keSwgdGhpcy5waHlzaWNzQm9keSwgb3B0aW9ucyk7CiAgICAgICAgICB0aGlzLmVkZ2VzU29sdmVyID0gbmV3IF9jb21wb25lbnRzUGh5c2ljc1NwcmluZ1NvbHZlcjJbJ2RlZmF1bHQnXSh0aGlzLmJvZHksIHRoaXMucGh5c2ljc0JvZHksIG9wdGlvbnMpOwogICAgICAgICAgdGhpcy5ncmF2aXR5U29sdmVyID0gbmV3IF9jb21wb25lbnRzUGh5c2ljc0NlbnRyYWxHcmF2aXR5U29sdmVyMlsnZGVmYXVsdCddKHRoaXMuYm9keSwgdGhpcy5waHlzaWNzQm9keSwgb3B0aW9ucyk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuc29sdmVyID09PSAnaGllcmFyY2hpY2FsUmVwdWxzaW9uJykgewogICAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWxSZXB1bHNpb247CiAgICAgICAgICB0aGlzLm5vZGVzU29sdmVyID0gbmV3IF9jb21wb25lbnRzUGh5c2ljc0hpZXJhcmNoaWNhbFJlcHVsc2lvblNvbHZlcjJbJ2RlZmF1bHQnXSh0aGlzLmJvZHksIHRoaXMucGh5c2ljc0JvZHksIG9wdGlvbnMpOwogICAgICAgICAgdGhpcy5lZGdlc1NvbHZlciA9IG5ldyBfY29tcG9uZW50c1BoeXNpY3NIaWVyYXJjaGljYWxTcHJpbmdTb2x2ZXIyWydkZWZhdWx0J10odGhpcy5ib2R5LCB0aGlzLnBoeXNpY3NCb2R5LCBvcHRpb25zKTsKICAgICAgICAgIHRoaXMuZ3Jhdml0eVNvbHZlciA9IG5ldyBfY29tcG9uZW50c1BoeXNpY3NDZW50cmFsR3Jhdml0eVNvbHZlcjJbJ2RlZmF1bHQnXSh0aGlzLmJvZHksIHRoaXMucGh5c2ljc0JvZHksIG9wdGlvbnMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBiYXJuZXNIdXQKICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMuYmFybmVzSHV0OwogICAgICAgICAgdGhpcy5ub2Rlc1NvbHZlciA9IG5ldyBfY29tcG9uZW50c1BoeXNpY3NCYXJuZXNIdXRTb2x2ZXIyWydkZWZhdWx0J10odGhpcy5ib2R5LCB0aGlzLnBoeXNpY3NCb2R5LCBvcHRpb25zKTsKICAgICAgICAgIHRoaXMuZWRnZXNTb2x2ZXIgPSBuZXcgX2NvbXBvbmVudHNQaHlzaWNzU3ByaW5nU29sdmVyMlsnZGVmYXVsdCddKHRoaXMuYm9keSwgdGhpcy5waHlzaWNzQm9keSwgb3B0aW9ucyk7CiAgICAgICAgICB0aGlzLmdyYXZpdHlTb2x2ZXIgPSBuZXcgX2NvbXBvbmVudHNQaHlzaWNzQ2VudHJhbEdyYXZpdHlTb2x2ZXIyWydkZWZhdWx0J10odGhpcy5ib2R5LCB0aGlzLnBoeXNpY3NCb2R5LCBvcHRpb25zKTsKICAgICAgICB9CgogICAgICAgIHRoaXMubW9kZWxPcHRpb25zID0gb3B0aW9uczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdpbml0UGh5c2ljcycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0UGh5c2ljcygpIHsKICAgICAgICBpZiAodGhpcy5waHlzaWNzRW5hYmxlZCA9PT0gdHJ1ZSAmJiB0aGlzLm9wdGlvbnMuZW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdGFiaWxpemF0aW9uLmVuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy5zdGFiaWxpemUoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc3RhYmlsaXplZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnJlYWR5ID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnZml0Jywge30sIHRydWUpOwogICAgICAgICAgICB0aGlzLnN0YXJ0U2ltdWxhdGlvbigpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnJlYWR5ID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ2ZpdCcpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzdGFydFNpbXVsYXRpb24nLAoKICAgICAgLyoqCiAgICAgICAqIFN0YXJ0IHRoZSBzaW11bGF0aW9uCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc3RhcnRTaW11bGF0aW9uKCkgewogICAgICAgIGlmICh0aGlzLnBoeXNpY3NFbmFibGVkID09PSB0cnVlICYmIHRoaXMub3B0aW9ucy5lbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLnN0YWJpbGl6ZWQgPSBmYWxzZTsKCiAgICAgICAgICAvLyB0aGlzIHNldHMgdGhlIHdpZHRoIG9mIGFsbCBub2RlcyBpbml0aWFsbHkgd2hpY2ggY291bGQgYmUgcmVxdWlyZWQgZm9yIHRoZSBhdm9pZE92ZXJsYXAKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19yZXNpemVOb2RlcycpOwogICAgICAgICAgaWYgKHRoaXMudmlld0Z1bmN0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy52aWV3RnVuY3Rpb24gPSB0aGlzLnNpbXVsYXRpb25TdGVwLmJpbmQodGhpcyk7CiAgICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdpbml0UmVkcmF3JywgdGhpcy52aWV3RnVuY3Rpb24pOwogICAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfc3RhcnRSZW5kZXJpbmcnKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3JlZHJhdycpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzdG9wU2ltdWxhdGlvbicsCgogICAgICAvKioKICAgICAgICogU3RvcCB0aGUgc2ltdWxhdGlvbiwgZm9yY2Ugc3RhYmlsaXphdGlvbi4KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzdG9wU2ltdWxhdGlvbigpIHsKICAgICAgICB2YXIgZW1pdCA9IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGFyZ3VtZW50c1swXTsKCiAgICAgICAgdGhpcy5zdGFiaWxpemVkID0gdHJ1ZTsKICAgICAgICBpZiAoZW1pdCA9PT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy5fZW1pdFN0YWJpbGl6ZWQoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMudmlld0Z1bmN0aW9uICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9mZignaW5pdFJlZHJhdycsIHRoaXMudmlld0Z1bmN0aW9uKTsKICAgICAgICAgIHRoaXMudmlld0Z1bmN0aW9uID0gdW5kZWZpbmVkOwogICAgICAgICAgaWYgKGVtaXQgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3N0b3BSZW5kZXJpbmcnKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc2ltdWxhdGlvblN0ZXAnLAoKICAgICAgLyoqCiAgICAgICAqIFRoZSB2aWV3RnVuY3Rpb24gaW5zZXJ0cyB0aGlzIHN0ZXAgaW50byBlYWNoIHJlbmRlcmxvb3AuIEl0IGNhbGxzIHRoZSBwaHlzaWNzIHRpY2sgYW5kIGhhbmRsZXMgdGhlIGNsZWFudXAgYXQgc3RhYmlsaXplZC4KICAgICAgICoKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzaW11bGF0aW9uU3RlcCgpIHsKICAgICAgICAvLyBjaGVjayBpZiB0aGUgcGh5c2ljcyBoYXZlIHNldHRsZWQKICAgICAgICB2YXIgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTsKICAgICAgICB0aGlzLnBoeXNpY3NUaWNrKCk7CiAgICAgICAgdmFyIHBoeXNpY3NUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTsKCiAgICAgICAgLy8gcnVuIGRvdWJsZSBzcGVlZCBpZiBpdCBpcyBhIGxpdHRsZSBncmFwaAogICAgICAgIGlmICgocGh5c2ljc1RpbWUgPCAwLjQgKiB0aGlzLnNpbXVsYXRpb25JbnRlcnZhbCB8fCB0aGlzLnJ1bkRvdWJsZVNwZWVkID09PSB0cnVlKSAmJiB0aGlzLnN0YWJpbGl6ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLnBoeXNpY3NUaWNrKCk7CgogICAgICAgICAgLy8gdGhpcyBtYWtlcyBzdXJlIHRoZXJlIGlzIG5vIGppdHRlci4gVGhlIGRlY2lzaW9uIGlzIHRha2VuIG9uY2UgdG8gcnVuIGl0IGF0IGRvdWJsZSBzcGVlZC4KICAgICAgICAgIHRoaXMucnVuRG91YmxlU3BlZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuc3RhYmlsaXplZCA9PT0gdHJ1ZSkgewogICAgICAgICAgaWYgKHRoaXMuc3RhYmlsaXphdGlvbkl0ZXJhdGlvbnMgPiAxKSB7CiAgICAgICAgICAgIC8vIHRyaWdnZXIgdGhlICdzdGFiaWxpemVkJyBldmVudC4KICAgICAgICAgICAgLy8gVGhlIGV2ZW50IGlzIHRyaWdnZXJlZCBvbiB0aGUgbmV4dCB0aWNrLCB0byBwcmV2ZW50IHRoZSBjYXNlIHRoYXQKICAgICAgICAgICAgLy8gaXQgaXMgZmlyZWQgd2hpbGUgaW5pdGlhbGl6aW5nIHRoZSBOZXR3b3JrLCBpbiB3aGljaCBjYXNlIHlvdSB3b3VsZCBub3QKICAgICAgICAgICAgLy8gYmUgYWJsZSB0byBjYXRjaCBpdAogICAgICAgICAgICB0aGlzLnN0YXJ0ZWRTdGFiaWxpemF0aW9uID0gZmFsc2U7CiAgICAgICAgICAgIC8vdGhpcy5fZW1pdFN0YWJpbGl6ZWQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc3RvcFNpbXVsYXRpb24oKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2VtaXRTdGFiaWxpemVkJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9lbWl0U3RhYmlsaXplZCgpIHsKICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgaWYgKHRoaXMuc3RhYmlsaXphdGlvbkl0ZXJhdGlvbnMgPiAxIHx8IHRoaXMuaW5pdGlhbFN0YWJpbGl6YXRpb25FbWl0dGVkID09PSBmYWxzZSkgewogICAgICAgICAgdGhpcy5pbml0aWFsU3RhYmlsaXphdGlvbkVtaXR0ZWQgPSB0cnVlOwogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMi5ib2R5LmVtaXR0ZXIuZW1pdCgnc3RhYmlsaXplZCcsIHsgaXRlcmF0aW9uczogX3RoaXMyLnN0YWJpbGl6YXRpb25JdGVyYXRpb25zIH0pOwogICAgICAgICAgICBfdGhpczIuc3RhYmlsaXphdGlvbkl0ZXJhdGlvbnMgPSAwOwogICAgICAgICAgfSwgMCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3BoeXNpY3NUaWNrJywKCiAgICAgIC8qKgogICAgICAgKiBBIHNpbmdsZSBzaW11bGF0aW9uIHN0ZXAgKG9yICd0aWNrJykgaW4gdGhlIHBoeXNpY3Mgc2ltdWxhdGlvbgogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBoeXNpY3NUaWNrKCkgewogICAgICAgIGlmICh0aGlzLnN0YWJpbGl6ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLmNhbGN1bGF0ZUZvcmNlcygpOwogICAgICAgICAgdGhpcy5zdGFiaWxpemVkID0gdGhpcy5tb3ZlTm9kZXMoKTsKCiAgICAgICAgICAvLyBkZXRlcm1pbmUgaWYgdGhlIG5ldHdvcmsgaGFzIHN0YWJpbHppZWQKICAgICAgICAgIGlmICh0aGlzLnN0YWJpbGl6ZWQgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy5yZXZlcnQoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHRoaXMgaXMgaGVyZSB0byBlbnN1cmUgdGhhdCB0aGVyZSBpcyBubyBzdGFydCBldmVudCB3aGVuIHRoZSBuZXR3b3JrIGlzIGFscmVhZHkgc3RhYmxlLgogICAgICAgICAgICBpZiAodGhpcy5zdGFydGVkU3RhYmlsaXphdGlvbiA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdzdGFydFN0YWJpbGl6aW5nJyk7CiAgICAgICAgICAgICAgdGhpcy5zdGFydGVkU3RhYmlsaXphdGlvbiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnN0YWJpbGl6YXRpb25JdGVyYXRpb25zKys7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3VwZGF0ZVBoeXNpY3NEYXRhJywKCiAgICAgIC8qKgogICAgICAgKiBOb2RlcyBhbmQgZWRnZXMgY2FuIGhhdmUgdGhlIHBoeXNpY3MgdG9nZ2xlcyBvbiBvciBvZmYuIEEgY29sbGVjdGlvbiBvZiBpbmRpY2VzIGlzIGNyZWF0ZWQgaGVyZSBzbyB3ZSBjYW4gc2tpcCB0aGUgY2hlY2sgYWxsIHRoZSB0aW1lLgogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVBoeXNpY3NEYXRhKCkgewogICAgICAgIHRoaXMucGh5c2ljc0JvZHkuZm9yY2VzID0ge307CiAgICAgICAgdGhpcy5waHlzaWNzQm9keS5waHlzaWNzTm9kZUluZGljZXMgPSBbXTsKICAgICAgICB0aGlzLnBoeXNpY3NCb2R5LnBoeXNpY3NFZGdlSW5kaWNlcyA9IFtdOwogICAgICAgIHZhciBub2RlcyA9IHRoaXMuYm9keS5ub2RlczsKICAgICAgICB2YXIgZWRnZXMgPSB0aGlzLmJvZHkuZWRnZXM7CgogICAgICAgIC8vIGdldCBub2RlIGluZGljZXMgZm9yIHBoeXNpY3MKICAgICAgICBmb3IgKHZhciBub2RlSWQgaW4gbm9kZXMpIHsKICAgICAgICAgIGlmIChub2Rlcy5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgIGlmIChub2Rlc1tub2RlSWRdLm9wdGlvbnMucGh5c2ljcyA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIHRoaXMucGh5c2ljc0JvZHkucGh5c2ljc05vZGVJbmRpY2VzLnB1c2gobm9kZUlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gZ2V0IGVkZ2UgaW5kaWNlcyBmb3IgcGh5c2ljcwogICAgICAgIGZvciAodmFyIGVkZ2VJZCBpbiBlZGdlcykgewogICAgICAgICAgaWYgKGVkZ2VzLmhhc093blByb3BlcnR5KGVkZ2VJZCkpIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW2VkZ2VJZF0ub3B0aW9ucy5waHlzaWNzID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgdGhpcy5waHlzaWNzQm9keS5waHlzaWNzRWRnZUluZGljZXMucHVzaChlZGdlSWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBnZXQgdGhlIHZlbG9jaXR5IGFuZCB0aGUgZm9yY2VzIHZlY3RvcgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5waHlzaWNzQm9keS5waHlzaWNzTm9kZUluZGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBub2RlSWQgPSB0aGlzLnBoeXNpY3NCb2R5LnBoeXNpY3NOb2RlSW5kaWNlc1tpXTsKICAgICAgICAgIHRoaXMucGh5c2ljc0JvZHkuZm9yY2VzW25vZGVJZF0gPSB7IHg6IDAsIHk6IDAgfTsKCiAgICAgICAgICAvLyBmb3JjZXMgY2FuIGJlIHJlc2V0IGJlY2F1c2UgdGhleSBhcmUgcmVjYWxjdWxhdGVkLiBWZWxvY2l0aWVzIGhhdmUgdG8gcGVyc2lzdC4KICAgICAgICAgIGlmICh0aGlzLnBoeXNpY3NCb2R5LnZlbG9jaXRpZXNbbm9kZUlkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMucGh5c2ljc0JvZHkudmVsb2NpdGllc1tub2RlSWRdID0geyB4OiAwLCB5OiAwIH07CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjbGVhbiBkZWxldGVkIG5vZGVzIGZyb20gdGhlIHZlbG9jaXR5IHZlY3RvcgogICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiB0aGlzLnBoeXNpY3NCb2R5LnZlbG9jaXRpZXMpIHsKICAgICAgICAgIGlmIChub2Rlc1tub2RlSWRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgZGVsZXRlIHRoaXMucGh5c2ljc0JvZHkudmVsb2NpdGllc1tub2RlSWRdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdyZXZlcnQnLAoKICAgICAgLyoqCiAgICAgICAqIFJldmVydCB0aGUgc2ltdWxhdGlvbiBvbmUgc3RlcC4gVGhpcyBpcyBkb25lIHNvIGFmdGVyIHN0YWJpbGl6YXRpb24sIGV2ZXJ5IG5ldyBzdGFydCBvZiB0aGUgc2ltdWxhdGlvbiB3aWxsIGFsc28gc2F5IHN0YWJpbGl6ZWQuCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gcmV2ZXJ0KCkgewogICAgICAgIHZhciBub2RlSWRzID0gT2JqZWN0LmtleXModGhpcy5wcmV2aW91c1N0YXRlcyk7CiAgICAgICAgdmFyIG5vZGVzID0gdGhpcy5ib2R5Lm5vZGVzOwogICAgICAgIHZhciB2ZWxvY2l0aWVzID0gdGhpcy5waHlzaWNzQm9keS52ZWxvY2l0aWVzOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBub2RlSWQgPSBub2RlSWRzW2ldOwogICAgICAgICAgaWYgKG5vZGVzW25vZGVJZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAobm9kZXNbbm9kZUlkXS5vcHRpb25zLnBoeXNpY3MgPT09IHRydWUpIHsKICAgICAgICAgICAgICB2ZWxvY2l0aWVzW25vZGVJZF0ueCA9IHRoaXMucHJldmlvdXNTdGF0ZXNbbm9kZUlkXS52eDsKICAgICAgICAgICAgICB2ZWxvY2l0aWVzW25vZGVJZF0ueSA9IHRoaXMucHJldmlvdXNTdGF0ZXNbbm9kZUlkXS52eTsKICAgICAgICAgICAgICBub2Rlc1tub2RlSWRdLnggPSB0aGlzLnByZXZpb3VzU3RhdGVzW25vZGVJZF0ueDsKICAgICAgICAgICAgICBub2Rlc1tub2RlSWRdLnkgPSB0aGlzLnByZXZpb3VzU3RhdGVzW25vZGVJZF0ueTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGVsZXRlIHRoaXMucHJldmlvdXNTdGF0ZXNbbm9kZUlkXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnbW92ZU5vZGVzJywKCiAgICAgIC8qKgogICAgICAgKiBtb3ZlIHRoZSBub2RlcyBvbmUgdGltZXN0YXAgYW5kIGNoZWNrIGlmIHRoZXkgYXJlIHN0YWJpbGl6ZWQKICAgICAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gbW92ZU5vZGVzKCkgewogICAgICAgIHZhciBub2Rlc1ByZXNlbnQgPSBmYWxzZTsKICAgICAgICB2YXIgbm9kZUluZGljZXMgPSB0aGlzLnBoeXNpY3NCb2R5LnBoeXNpY3NOb2RlSW5kaWNlczsKICAgICAgICB2YXIgbWF4VmVsb2NpdHkgPSB0aGlzLm9wdGlvbnMubWF4VmVsb2NpdHkgPyB0aGlzLm9wdGlvbnMubWF4VmVsb2NpdHkgOiAxMDAwMDAwMDAwOwogICAgICAgIHZhciBzdGFiaWxpemVkID0gdHJ1ZTsKICAgICAgICB2YXIgdm1pbkNvcnJlY3RlZCA9IHRoaXMub3B0aW9ucy5taW5WZWxvY2l0eSAvIE1hdGgubWF4KHRoaXMuYm9keS52aWV3LnNjYWxlLCAwLjA1KTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlSW5kaWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIG5vZGVJZCA9IG5vZGVJbmRpY2VzW2ldOwogICAgICAgICAgdmFyIG5vZGVWZWxvY2l0eSA9IHRoaXMuX3BlcmZvcm1TdGVwKG5vZGVJZCwgbWF4VmVsb2NpdHkpOwogICAgICAgICAgLy8gc3RhYmlsaXplZCBpcyB0cnVlIGlmIHN0YWJpbGl6ZWQgaXMgdHJ1ZSBhbmQgdmVsb2NpdHkgaXMgc21hbGxlciB0aGFuIHZtaW4gLS0+IGFsbCBub2RlcyBtdXN0IGJlIHN0YWJpbGl6ZWQKICAgICAgICAgIHN0YWJpbGl6ZWQgPSBub2RlVmVsb2NpdHkgPCB2bWluQ29ycmVjdGVkICYmIHN0YWJpbGl6ZWQgPT09IHRydWU7CiAgICAgICAgICBub2Rlc1ByZXNlbnQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKG5vZGVzUHJlc2VudCA9PT0gdHJ1ZSkgewogICAgICAgICAgaWYgKHZtaW5Db3JyZWN0ZWQgPiAwLjUgKiB0aGlzLm9wdGlvbnMubWF4VmVsb2NpdHkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHN0YWJpbGl6ZWQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19wZXJmb3JtU3RlcCcsCgogICAgICAvKioKICAgICAgICogUGVyZm9ybSB0aGUgYWN0dWFsIHN0ZXAKICAgICAgICoKICAgICAgICogQHBhcmFtIG5vZGVJZAogICAgICAgKiBAcGFyYW0gbWF4VmVsb2NpdHkKICAgICAgICogQHJldHVybnMge251bWJlcn0KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcGVyZm9ybVN0ZXAobm9kZUlkLCBtYXhWZWxvY2l0eSkgewogICAgICAgIHZhciBub2RlID0gdGhpcy5ib2R5Lm5vZGVzW25vZGVJZF07CiAgICAgICAgdmFyIHRpbWVzdGVwID0gdGhpcy5vcHRpb25zLnRpbWVzdGVwOwogICAgICAgIHZhciBmb3JjZXMgPSB0aGlzLnBoeXNpY3NCb2R5LmZvcmNlczsKICAgICAgICB2YXIgdmVsb2NpdGllcyA9IHRoaXMucGh5c2ljc0JvZHkudmVsb2NpdGllczsKCiAgICAgICAgLy8gc3RvcmUgdGhlIHN0YXRlIHNvIHdlIGNhbiByZXZlcnQKICAgICAgICB0aGlzLnByZXZpb3VzU3RhdGVzW25vZGVJZF0gPSB7IHg6IG5vZGUueCwgeTogbm9kZS55LCB2eDogdmVsb2NpdGllc1tub2RlSWRdLngsIHZ5OiB2ZWxvY2l0aWVzW25vZGVJZF0ueSB9OwoKICAgICAgICBpZiAobm9kZS5vcHRpb25zLmZpeGVkLnggPT09IGZhbHNlKSB7CiAgICAgICAgICB2YXIgZHggPSB0aGlzLm1vZGVsT3B0aW9ucy5kYW1waW5nICogdmVsb2NpdGllc1tub2RlSWRdLng7IC8vIGRhbXBpbmcgZm9yY2UKICAgICAgICAgIHZhciBheCA9IChmb3JjZXNbbm9kZUlkXS54IC0gZHgpIC8gbm9kZS5vcHRpb25zLm1hc3M7IC8vIGFjY2VsZXJhdGlvbgogICAgICAgICAgdmVsb2NpdGllc1tub2RlSWRdLnggKz0gYXggKiB0aW1lc3RlcDsgLy8gdmVsb2NpdHkKICAgICAgICAgIHZlbG9jaXRpZXNbbm9kZUlkXS54ID0gTWF0aC5hYnModmVsb2NpdGllc1tub2RlSWRdLngpID4gbWF4VmVsb2NpdHkgPyB2ZWxvY2l0aWVzW25vZGVJZF0ueCA+IDAgPyBtYXhWZWxvY2l0eSA6IC1tYXhWZWxvY2l0eSA6IHZlbG9jaXRpZXNbbm9kZUlkXS54OwogICAgICAgICAgbm9kZS54ICs9IHZlbG9jaXRpZXNbbm9kZUlkXS54ICogdGltZXN0ZXA7IC8vIHBvc2l0aW9uCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZvcmNlc1tub2RlSWRdLnggPSAwOwogICAgICAgICAgdmVsb2NpdGllc1tub2RlSWRdLnggPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKG5vZGUub3B0aW9ucy5maXhlZC55ID09PSBmYWxzZSkgewogICAgICAgICAgdmFyIGR5ID0gdGhpcy5tb2RlbE9wdGlvbnMuZGFtcGluZyAqIHZlbG9jaXRpZXNbbm9kZUlkXS55OyAvLyBkYW1waW5nIGZvcmNlCiAgICAgICAgICB2YXIgYXkgPSAoZm9yY2VzW25vZGVJZF0ueSAtIGR5KSAvIG5vZGUub3B0aW9ucy5tYXNzOyAvLyBhY2NlbGVyYXRpb24KICAgICAgICAgIHZlbG9jaXRpZXNbbm9kZUlkXS55ICs9IGF5ICogdGltZXN0ZXA7IC8vIHZlbG9jaXR5CiAgICAgICAgICB2ZWxvY2l0aWVzW25vZGVJZF0ueSA9IE1hdGguYWJzKHZlbG9jaXRpZXNbbm9kZUlkXS55KSA+IG1heFZlbG9jaXR5ID8gdmVsb2NpdGllc1tub2RlSWRdLnkgPiAwID8gbWF4VmVsb2NpdHkgOiAtbWF4VmVsb2NpdHkgOiB2ZWxvY2l0aWVzW25vZGVJZF0ueTsKICAgICAgICAgIG5vZGUueSArPSB2ZWxvY2l0aWVzW25vZGVJZF0ueSAqIHRpbWVzdGVwOyAvLyBwb3NpdGlvbgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3JjZXNbbm9kZUlkXS55ID0gMDsKICAgICAgICAgIHZlbG9jaXRpZXNbbm9kZUlkXS55ID0gMDsKICAgICAgICB9CgogICAgICAgIHZhciB0b3RhbFZlbG9jaXR5ID0gTWF0aC5zcXJ0KE1hdGgucG93KHZlbG9jaXRpZXNbbm9kZUlkXS54LCAyKSArIE1hdGgucG93KHZlbG9jaXRpZXNbbm9kZUlkXS55LCAyKSk7CiAgICAgICAgcmV0dXJuIHRvdGFsVmVsb2NpdHk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnY2FsY3VsYXRlRm9yY2VzJywKCiAgICAgIC8qKgogICAgICAgKiBjYWxjdWxhdGUgdGhlIGZvcmNlcyBmb3Igb25lIHBoeXNpY3MgaXRlcmF0aW9uLgogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNhbGN1bGF0ZUZvcmNlcygpIHsKICAgICAgICB0aGlzLmdyYXZpdHlTb2x2ZXIuc29sdmUoKTsKICAgICAgICB0aGlzLm5vZGVzU29sdmVyLnNvbHZlKCk7CiAgICAgICAgdGhpcy5lZGdlc1NvbHZlci5zb2x2ZSgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19mcmVlemVOb2RlcycsCgogICAgICAvKioKICAgICAgICogV2hlbiBpbml0aWFsaXppbmcgYW5kIHN0YWJpbGl6aW5nLCB3ZSBjYW4gZnJlZXplIG5vZGVzIHdpdGggYSBwcmVkZWZpbmVkIHBvc2l0aW9uLiBUaGlzIGdyZWF0bHkgc3BlZWRzIHVwIHN0YWJpbGl6YXRpb24KICAgICAgICogYmVjYXVzZSBvbmx5IHRoZSBzdXBwb3J0bm9kZXMgZm9yIHRoZSBzbW9vdGhDdXJ2ZXMgaGF2ZSB0byBzZXR0bGUuCiAgICAgICAqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2ZyZWV6ZU5vZGVzKCkgewogICAgICAgIHZhciBub2RlcyA9IHRoaXMuYm9keS5ub2RlczsKICAgICAgICBmb3IgKHZhciBpZCBpbiBub2RlcykgewogICAgICAgICAgaWYgKG5vZGVzLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICAgICAgICBpZiAobm9kZXNbaWRdLnggJiYgbm9kZXNbaWRdLnkpIHsKICAgICAgICAgICAgICB0aGlzLmZyZWV6ZUNhY2hlW2lkXSA9IHsgeDogbm9kZXNbaWRdLm9wdGlvbnMuZml4ZWQueCwgeTogbm9kZXNbaWRdLm9wdGlvbnMuZml4ZWQueSB9OwogICAgICAgICAgICAgIG5vZGVzW2lkXS5vcHRpb25zLmZpeGVkLnggPSB0cnVlOwogICAgICAgICAgICAgIG5vZGVzW2lkXS5vcHRpb25zLmZpeGVkLnkgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19yZXN0b3JlRnJvemVuTm9kZXMnLAoKICAgICAgLyoqCiAgICAgICAqIFVuZnJlZXplcyB0aGUgbm9kZXMgdGhhdCBoYXZlIGJlZW4gZnJvemVuIGJ5IF9mcmVlemVEZWZpbmVkTm9kZXMuCiAgICAgICAqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3Jlc3RvcmVGcm96ZW5Ob2RlcygpIHsKICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLmJvZHkubm9kZXM7CiAgICAgICAgZm9yICh2YXIgaWQgaW4gbm9kZXMpIHsKICAgICAgICAgIGlmIChub2Rlcy5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZnJlZXplQ2FjaGVbaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBub2Rlc1tpZF0ub3B0aW9ucy5maXhlZC54ID0gdGhpcy5mcmVlemVDYWNoZVtpZF0ueDsKICAgICAgICAgICAgICBub2Rlc1tpZF0ub3B0aW9ucy5maXhlZC55ID0gdGhpcy5mcmVlemVDYWNoZVtpZF0ueTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLmZyZWV6ZUNhY2hlID0ge307CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc3RhYmlsaXplJywKCiAgICAgIC8qKgogICAgICAgKiBGaW5kIGEgc3RhYmxlIHBvc2l0aW9uIGZvciBhbGwgbm9kZXMKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzdGFiaWxpemUoKSB7CiAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICAgIHZhciBpdGVyYXRpb25zID0gYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyB0aGlzLm9wdGlvbnMuc3RhYmlsaXphdGlvbi5pdGVyYXRpb25zIDogYXJndW1lbnRzWzBdOwoKICAgICAgICBpZiAodHlwZW9mIGl0ZXJhdGlvbnMgIT09ICdudW1iZXInKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnVGhlIHN0YWJpbGl6ZSBtZXRob2QgbmVlZHMgYSBudW1lcmljIGFtb3VudCBvZiBpdGVyYXRpb25zLiBTd2l0Y2hpbmcgdG8gZGVmYXVsdDogJywgdGhpcy5vcHRpb25zLnN0YWJpbGl6YXRpb24uaXRlcmF0aW9ucyk7CiAgICAgICAgICBpdGVyYXRpb25zID0gdGhpcy5vcHRpb25zLnN0YWJpbGl6YXRpb24uaXRlcmF0aW9uczsKICAgICAgICB9CgogICAgICAgIC8vIHRoaXMgc2V0cyB0aGUgd2lkdGggb2YgYWxsIG5vZGVzIGluaXRpYWxseSB3aGljaCBjb3VsZCBiZSByZXF1aXJlZCBmb3IgdGhlIGF2b2lkT3ZlcmxhcAogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19yZXNpemVOb2RlcycpOwoKICAgICAgICAvLyBzdG9wIHRoZSByZW5kZXIgbG9vcAogICAgICAgIHRoaXMuc3RvcFNpbXVsYXRpb24oKTsKCiAgICAgICAgLy8gc2V0IHN0YWJpbHplIHRvIGZhbHNlCiAgICAgICAgdGhpcy5zdGFiaWxpemVkID0gZmFsc2U7CgogICAgICAgIC8vIGJsb2NrIHJlZHJhdyByZXF1ZXN0cwogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19ibG9ja1JlZHJhd1JlcXVlc3RzJyk7CiAgICAgICAgdGhpcy50YXJnZXRJdGVyYXRpb25zID0gaXRlcmF0aW9uczsKCiAgICAgICAgLy8gc3RhcnQgdGhlIHN0YWJpbGl6YXRpb24KICAgICAgICBpZiAodGhpcy5vcHRpb25zLnN0YWJpbGl6YXRpb24ub25seUR5bmFtaWNFZGdlcyA9PT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy5fZnJlZXplTm9kZXMoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zdGFiaWxpemF0aW9uSXRlcmF0aW9ucyA9IDA7CgogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzMy5fc3RhYmlsaXphdGlvbkJhdGNoKCk7CiAgICAgICAgfSwgMCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3N0YWJpbGl6YXRpb25CYXRjaCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc3RhYmlsaXphdGlvbkJhdGNoKCkgewogICAgICAgIHZhciBjb3VudCA9IDA7CiAgICAgICAgd2hpbGUgKHRoaXMuc3RhYmlsaXplZCA9PT0gZmFsc2UgJiYgY291bnQgPCB0aGlzLm9wdGlvbnMuc3RhYmlsaXphdGlvbi51cGRhdGVJbnRlcnZhbCAmJiB0aGlzLnN0YWJpbGl6YXRpb25JdGVyYXRpb25zIDwgdGhpcy50YXJnZXRJdGVyYXRpb25zKSB7CiAgICAgICAgICB0aGlzLnBoeXNpY3NUaWNrKCk7CiAgICAgICAgICB0aGlzLnN0YWJpbGl6YXRpb25JdGVyYXRpb25zKys7CiAgICAgICAgICBjb3VudCsrOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuc3RhYmlsaXplZCA9PT0gZmFsc2UgJiYgdGhpcy5zdGFiaWxpemF0aW9uSXRlcmF0aW9ucyA8IHRoaXMudGFyZ2V0SXRlcmF0aW9ucykgewogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnc3RhYmlsaXphdGlvblByb2dyZXNzJywgeyBpdGVyYXRpb25zOiB0aGlzLnN0YWJpbGl6YXRpb25JdGVyYXRpb25zLCB0b3RhbDogdGhpcy50YXJnZXRJdGVyYXRpb25zIH0pOwogICAgICAgICAgc2V0VGltZW91dCh0aGlzLl9zdGFiaWxpemF0aW9uQmF0Y2guYmluZCh0aGlzKSwgMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX2ZpbmFsaXplU3RhYmlsaXphdGlvbigpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZmluYWxpemVTdGFiaWxpemF0aW9uJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9maW5hbGl6ZVN0YWJpbGl6YXRpb24oKSB7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX2FsbG93UmVkcmF3UmVxdWVzdHMnKTsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLnN0YWJpbGl6YXRpb24uZml0ID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdmaXQnKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc3RhYmlsaXphdGlvbi5vbmx5RHluYW1pY0VkZ2VzID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLl9yZXN0b3JlRnJvemVuTm9kZXMoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ3N0YWJpbGl6YXRpb25JdGVyYXRpb25zRG9uZScpOwogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19yZXF1ZXN0UmVkcmF3Jyk7CgogICAgICAgIGlmICh0aGlzLnN0YWJpbGl6ZWQgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuX2VtaXRTdGFiaWxpemVkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc3RhcnRTaW11bGF0aW9uKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnJlYWR5ID0gdHJ1ZTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBQaHlzaWNzRW5naW5lOwogIH0pKCk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IFBoeXNpY3NFbmdpbmU7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiA4OSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgInVzZSBzdHJpY3QiOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCiAgdmFyIEJhcm5lc0h1dFNvbHZlciA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBCYXJuZXNIdXRTb2x2ZXIoYm9keSwgcGh5c2ljc0JvZHksIG9wdGlvbnMpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEJhcm5lc0h1dFNvbHZlcik7CgogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLnBoeXNpY3NCb2R5ID0gcGh5c2ljc0JvZHk7CiAgICAgIHRoaXMuYmFybmVzSHV0VHJlZTsKICAgICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpOwogICAgICB0aGlzLnJhbmRvbVNlZWQgPSA1OwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhCYXJuZXNIdXRTb2x2ZXIsIFt7CiAgICAgIGtleTogInNldE9wdGlvbnMiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgICAgICB0aGlzLnRoZXRhSW52ZXJzZWQgPSAxIC8gdGhpcy5vcHRpb25zLnRoZXRhOwogICAgICAgIHRoaXMub3ZlcmxhcEF2b2lkYW5jZUZhY3RvciA9IDEgLSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCB0aGlzLm9wdGlvbnMuYXZvaWRPdmVybGFwKSk7IC8vIGlmIDEgdGhlbiBtaW4gZGlzdGFuY2UgPSAwLjUsIGlmIDAuNSB0aGVuIG1pbiBkaXN0YW5jZSA9IDAuNSArIDAuNSpub2RlLnNoYXBlLnJhZGl1cwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInNlZWRlZFJhbmRvbSIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZWVkZWRSYW5kb20oKSB7CiAgICAgICAgdmFyIHggPSBNYXRoLnNpbih0aGlzLnJhbmRvbVNlZWQrKykgKiAxMDAwMDsKICAgICAgICByZXR1cm4geCAtIE1hdGguZmxvb3IoeCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic29sdmUiLAoKICAgICAgLyoqCiAgICAgICAqIFRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyB0aGUgZm9yY2VzIHRoZSBub2RlcyBhcHBseSBvbiBlYWNob3RoZXIgYmFzZWQgb24gYSBncmF2aXRhdGlvbmFsIG1vZGVsLgogICAgICAgKiBUaGUgQmFybmVzIEh1dCBtZXRob2QgaXMgdXNlZCB0byBzcGVlZCB1cCB0aGlzIE4tYm9keSBzaW11bGF0aW9uLgogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNvbHZlKCkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZ3Jhdml0YXRpb25hbENvbnN0YW50ICE9PSAwICYmIHRoaXMucGh5c2ljc0JvZHkucGh5c2ljc05vZGVJbmRpY2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHZhciBub2RlID0gdW5kZWZpbmVkOwogICAgICAgICAgdmFyIG5vZGVzID0gdGhpcy5ib2R5Lm5vZGVzOwogICAgICAgICAgdmFyIG5vZGVJbmRpY2VzID0gdGhpcy5waHlzaWNzQm9keS5waHlzaWNzTm9kZUluZGljZXM7CiAgICAgICAgICB2YXIgbm9kZUNvdW50ID0gbm9kZUluZGljZXMubGVuZ3RoOwoKICAgICAgICAgIC8vIGNyZWF0ZSB0aGUgdHJlZQogICAgICAgICAgdmFyIGJhcm5lc0h1dFRyZWUgPSB0aGlzLl9mb3JtQmFybmVzSHV0VHJlZShub2Rlcywgbm9kZUluZGljZXMpOwoKICAgICAgICAgIC8vIGZvciBkZWJ1Z2dpbmcKICAgICAgICAgIHRoaXMuYmFybmVzSHV0VHJlZSA9IGJhcm5lc0h1dFRyZWU7CgogICAgICAgICAgLy8gcGxhY2UgdGhlIG5vZGVzIG9uZSBieSBvbmUgcmVjdXJzaXZlbHkKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZUNvdW50OyBpKyspIHsKICAgICAgICAgICAgbm9kZSA9IG5vZGVzW25vZGVJbmRpY2VzW2ldXTsKICAgICAgICAgICAgaWYgKG5vZGUub3B0aW9ucy5tYXNzID4gMCkgewogICAgICAgICAgICAgIC8vIHN0YXJ0aW5nIHdpdGggcm9vdCBpcyBpcnJlbGV2YW50LCBpdCBuZXZlciBwYXNzZXMgdGhlIEJhcm5lc0h1dFNvbHZlciBjb25kaXRpb24KICAgICAgICAgICAgICB0aGlzLl9nZXRGb3JjZUNvbnRyaWJ1dGlvbihiYXJuZXNIdXRUcmVlLnJvb3QuY2hpbGRyZW4uTlcsIG5vZGUpOwogICAgICAgICAgICAgIHRoaXMuX2dldEZvcmNlQ29udHJpYnV0aW9uKGJhcm5lc0h1dFRyZWUucm9vdC5jaGlsZHJlbi5ORSwgbm9kZSk7CiAgICAgICAgICAgICAgdGhpcy5fZ2V0Rm9yY2VDb250cmlidXRpb24oYmFybmVzSHV0VHJlZS5yb290LmNoaWxkcmVuLlNXLCBub2RlKTsKICAgICAgICAgICAgICB0aGlzLl9nZXRGb3JjZUNvbnRyaWJ1dGlvbihiYXJuZXNIdXRUcmVlLnJvb3QuY2hpbGRyZW4uU0UsIG5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9nZXRGb3JjZUNvbnRyaWJ1dGlvbiIsCgogICAgICAvKioKICAgICAgICogVGhpcyBmdW5jdGlvbiB0cmF2ZXJzZXMgdGhlIGJhcm5lc0h1dFRyZWUuIEl0IGNoZWNrcyB3aGVuIGl0IGNhbiBhcHByb3hpbWF0ZSBkaXN0YW50IG5vZGVzIHdpdGggdGhlaXIgY2VudGVyIG9mIG1hc3MuCiAgICAgICAqIElmIGEgcmVnaW9uIGNvbnRhaW5zIGEgc2luZ2xlIG5vZGUsIHdlIGNoZWNrIGlmIGl0IGlzIG5vdCBpdHNlbGYsIHRoZW4gd2UgYXBwbHkgdGhlIGZvcmNlLgogICAgICAgKgogICAgICAgKiBAcGFyYW0gcGFyZW50QnJhbmNoCiAgICAgICAqIEBwYXJhbSBub2RlCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2dldEZvcmNlQ29udHJpYnV0aW9uKHBhcmVudEJyYW5jaCwgbm9kZSkgewogICAgICAgIC8vIHdlIGdldCBubyBmb3JjZSBjb250cmlidXRpb24gZnJvbSBhbiBlbXB0eSByZWdpb24KICAgICAgICBpZiAocGFyZW50QnJhbmNoLmNoaWxkcmVuQ291bnQgPiAwKSB7CiAgICAgICAgICB2YXIgZHggPSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgZHkgPSB1bmRlZmluZWQsCiAgICAgICAgICAgICAgZGlzdGFuY2UgPSB1bmRlZmluZWQ7CgogICAgICAgICAgLy8gZ2V0IHRoZSBkaXN0YW5jZSBmcm9tIHRoZSBjZW50ZXIgb2YgbWFzcyB0byB0aGUgbm9kZS4KICAgICAgICAgIGR4ID0gcGFyZW50QnJhbmNoLmNlbnRlck9mTWFzcy54IC0gbm9kZS54OwogICAgICAgICAgZHkgPSBwYXJlbnRCcmFuY2guY2VudGVyT2ZNYXNzLnkgLSBub2RlLnk7CiAgICAgICAgICBkaXN0YW5jZSA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CgogICAgICAgICAgLy8gQmFybmVzSHV0U29sdmVyIGNvbmRpdGlvbgogICAgICAgICAgLy8gb3JpZ2luYWwgY29uZGl0aW9uIDogcy9kIDwgdGhldGEgPSBwYXNzZWQgID09PSAgZC9zID4gMS90aGV0YSA9IHBhc3NlZAogICAgICAgICAgLy8gY2FsY1NpemUgPSAxL3MgLS0+IGQgKiAxL3MgPiAxL3RoZXRhID0gcGFzc2VkCiAgICAgICAgICBpZiAoZGlzdGFuY2UgKiBwYXJlbnRCcmFuY2guY2FsY1NpemUgPiB0aGlzLnRoZXRhSW52ZXJzZWQpIHsKICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlRm9yY2VzKGRpc3RhbmNlLCBkeCwgZHksIG5vZGUsIHBhcmVudEJyYW5jaCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBEaWQgbm90IHBhc3MgdGhlIGNvbmRpdGlvbiwgZ28gaW50byBjaGlsZHJlbiBpZiBhdmFpbGFibGUKICAgICAgICAgICAgaWYgKHBhcmVudEJyYW5jaC5jaGlsZHJlbkNvdW50ID09PSA0KSB7CiAgICAgICAgICAgICAgdGhpcy5fZ2V0Rm9yY2VDb250cmlidXRpb24ocGFyZW50QnJhbmNoLmNoaWxkcmVuLk5XLCBub2RlKTsKICAgICAgICAgICAgICB0aGlzLl9nZXRGb3JjZUNvbnRyaWJ1dGlvbihwYXJlbnRCcmFuY2guY2hpbGRyZW4uTkUsIG5vZGUpOwogICAgICAgICAgICAgIHRoaXMuX2dldEZvcmNlQ29udHJpYnV0aW9uKHBhcmVudEJyYW5jaC5jaGlsZHJlbi5TVywgbm9kZSk7CiAgICAgICAgICAgICAgdGhpcy5fZ2V0Rm9yY2VDb250cmlidXRpb24ocGFyZW50QnJhbmNoLmNoaWxkcmVuLlNFLCBub2RlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBwYXJlbnRCcmFuY2ggbXVzdCBoYXZlIG9ubHkgb25lIG5vZGUsIGlmIGl0IHdhcyBlbXB0eSB3ZSB3b3VsZG50IGJlIGhlcmUKICAgICAgICAgICAgICBpZiAocGFyZW50QnJhbmNoLmNoaWxkcmVuLmRhdGEuaWQgIT0gbm9kZS5pZCkgewogICAgICAgICAgICAgICAgLy8gaWYgaXQgaXMgbm90IHNlbGYKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZUZvcmNlcyhkaXN0YW5jZSwgZHgsIGR5LCBub2RlLCBwYXJlbnRCcmFuY2gpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfY2FsY3VsYXRlRm9yY2VzIiwKCiAgICAgIC8qKgogICAgICAgKiBDYWxjdWxhdGUgdGhlIGZvcmNlcyBiYXNlZCBvbiB0aGUgZGlzdGFuY2UuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSBkaXN0YW5jZQogICAgICAgKiBAcGFyYW0gZHgKICAgICAgICogQHBhcmFtIGR5CiAgICAgICAqIEBwYXJhbSBub2RlCiAgICAgICAqIEBwYXJhbSBwYXJlbnRCcmFuY2gKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY2FsY3VsYXRlRm9yY2VzKGRpc3RhbmNlLCBkeCwgZHksIG5vZGUsIHBhcmVudEJyYW5jaCkgewogICAgICAgIGlmIChkaXN0YW5jZSA9PT0gMCkgewogICAgICAgICAgZGlzdGFuY2UgPSAwLjE7CiAgICAgICAgICBkeCA9IGRpc3RhbmNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMub3ZlcmxhcEF2b2lkYW5jZUZhY3RvciA8IDEpIHsKICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5tYXgoMC4xICsgdGhpcy5vdmVybGFwQXZvaWRhbmNlRmFjdG9yICogbm9kZS5zaGFwZS5yYWRpdXMsIGRpc3RhbmNlIC0gbm9kZS5zaGFwZS5yYWRpdXMpOwogICAgICAgIH0KCiAgICAgICAgLy8gdGhlIGRpdmlkaW5nIGJ5IHRoZSBkaXN0YW5jZSBjdWJlZCBpbnN0ZWFkIG9mIHNxdWFyZWQgYWxsb3dzIHVzIHRvIGdldCB0aGUgZnggYW5kIGZ5IGNvbXBvbmVudHMgd2l0aG91dCBzaW5lcyBhbmQgY29zaW5lcwogICAgICAgIC8vIGl0IGlzIHNob3J0aGFuZCBmb3IgZ3Jhdml0eWZvcmNlIHdpdGggZGlzdGFuY2Ugc3F1YXJlZCBhbmQgZnggPSBkeC9kaXN0YW5jZSAqIGdyYXZpdHlGb3JjZQogICAgICAgIHZhciBncmF2aXR5Rm9yY2UgPSB0aGlzLm9wdGlvbnMuZ3Jhdml0YXRpb25hbENvbnN0YW50ICogcGFyZW50QnJhbmNoLm1hc3MgKiBub2RlLm9wdGlvbnMubWFzcyAvIE1hdGgucG93KGRpc3RhbmNlLCAzKTsKICAgICAgICB2YXIgZnggPSBkeCAqIGdyYXZpdHlGb3JjZTsKICAgICAgICB2YXIgZnkgPSBkeSAqIGdyYXZpdHlGb3JjZTsKCiAgICAgICAgdGhpcy5waHlzaWNzQm9keS5mb3JjZXNbbm9kZS5pZF0ueCArPSBmeDsKICAgICAgICB0aGlzLnBoeXNpY3NCb2R5LmZvcmNlc1tub2RlLmlkXS55ICs9IGZ5OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9mb3JtQmFybmVzSHV0VHJlZSIsCgogICAgICAvKioKICAgICAgICogVGhpcyBmdW5jdGlvbiBjb25zdHJ1Y3RzIHRoZSBiYXJuZXNIdXQgdHJlZSByZWN1cnNpdmVseS4gSXQgY3JlYXRlcyB0aGUgcm9vdCwgc3BsaXRzIGl0IGFuZCBzdGFydHMgcGxhY2luZyB0aGUgbm9kZXMuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSBub2RlcwogICAgICAgKiBAcGFyYW0gbm9kZUluZGljZXMKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZm9ybUJhcm5lc0h1dFRyZWUobm9kZXMsIG5vZGVJbmRpY2VzKSB7CiAgICAgICAgdmFyIG5vZGUgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIG5vZGVDb3VudCA9IG5vZGVJbmRpY2VzLmxlbmd0aDsKCiAgICAgICAgdmFyIG1pblggPSBub2Rlc1tub2RlSW5kaWNlc1swXV0ueDsKICAgICAgICB2YXIgbWluWSA9IG5vZGVzW25vZGVJbmRpY2VzWzBdXS55OwogICAgICAgIHZhciBtYXhYID0gbm9kZXNbbm9kZUluZGljZXNbMF1dLng7CiAgICAgICAgdmFyIG1heFkgPSBub2Rlc1tub2RlSW5kaWNlc1swXV0ueTsKCiAgICAgICAgLy8gZ2V0IHRoZSByYW5nZSBvZiB0aGUgbm9kZXMKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG5vZGVDb3VudDsgaSsrKSB7CiAgICAgICAgICB2YXIgeCA9IG5vZGVzW25vZGVJbmRpY2VzW2ldXS54OwogICAgICAgICAgdmFyIHkgPSBub2Rlc1tub2RlSW5kaWNlc1tpXV0ueTsKICAgICAgICAgIGlmIChub2Rlc1tub2RlSW5kaWNlc1tpXV0ub3B0aW9ucy5tYXNzID4gMCkgewogICAgICAgICAgICBpZiAoeCA8IG1pblgpIHsKICAgICAgICAgICAgICBtaW5YID0geDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoeCA+IG1heFgpIHsKICAgICAgICAgICAgICBtYXhYID0geDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoeSA8IG1pblkpIHsKICAgICAgICAgICAgICBtaW5ZID0geTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoeSA+IG1heFkpIHsKICAgICAgICAgICAgICBtYXhZID0geTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBtYWtlIHRoZSByYW5nZSBhIHNxdWFyZQogICAgICAgIHZhciBzaXplRGlmZiA9IE1hdGguYWJzKG1heFggLSBtaW5YKSAtIE1hdGguYWJzKG1heFkgLSBtaW5ZKTsgLy8gZGlmZmVyZW5jZSBiZXR3ZWVuIFggYW5kIFkKICAgICAgICBpZiAoc2l6ZURpZmYgPiAwKSB7CiAgICAgICAgICBtaW5ZIC09IDAuNSAqIHNpemVEaWZmOwogICAgICAgICAgbWF4WSArPSAwLjUgKiBzaXplRGlmZjsKICAgICAgICB9IC8vIHhTaXplID4geVNpemUKICAgICAgICBlbHNlIHsKICAgICAgICAgIG1pblggKz0gMC41ICogc2l6ZURpZmY7CiAgICAgICAgICBtYXhYIC09IDAuNSAqIHNpemVEaWZmOwogICAgICAgIH0gLy8geFNpemUgPCB5U2l6ZQoKICAgICAgICB2YXIgbWluaW11bVRyZWVTaXplID0gMC4wMDAwMTsKICAgICAgICB2YXIgcm9vdFNpemUgPSBNYXRoLm1heChtaW5pbXVtVHJlZVNpemUsIE1hdGguYWJzKG1heFggLSBtaW5YKSk7CiAgICAgICAgdmFyIGhhbGZSb290U2l6ZSA9IDAuNSAqIHJvb3RTaXplOwogICAgICAgIHZhciBjZW50ZXJYID0gMC41ICogKG1pblggKyBtYXhYKSwKICAgICAgICAgICAgY2VudGVyWSA9IDAuNSAqIChtaW5ZICsgbWF4WSk7CgogICAgICAgIC8vIGNvbnN0cnVjdCB0aGUgYmFybmVzSHV0VHJlZQogICAgICAgIHZhciBiYXJuZXNIdXRUcmVlID0gewogICAgICAgICAgcm9vdDogewogICAgICAgICAgICBjZW50ZXJPZk1hc3M6IHsgeDogMCwgeTogMCB9LAogICAgICAgICAgICBtYXNzOiAwLAogICAgICAgICAgICByYW5nZTogewogICAgICAgICAgICAgIG1pblg6IGNlbnRlclggLSBoYWxmUm9vdFNpemUsIG1heFg6IGNlbnRlclggKyBoYWxmUm9vdFNpemUsCiAgICAgICAgICAgICAgbWluWTogY2VudGVyWSAtIGhhbGZSb290U2l6ZSwgbWF4WTogY2VudGVyWSArIGhhbGZSb290U2l6ZQogICAgICAgICAgICB9LAogICAgICAgICAgICBzaXplOiByb290U2l6ZSwKICAgICAgICAgICAgY2FsY1NpemU6IDEgLyByb290U2l6ZSwKICAgICAgICAgICAgY2hpbGRyZW46IHsgZGF0YTogbnVsbCB9LAogICAgICAgICAgICBtYXhXaWR0aDogMCwKICAgICAgICAgICAgbGV2ZWw6IDAsCiAgICAgICAgICAgIGNoaWxkcmVuQ291bnQ6IDQKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHRoaXMuX3NwbGl0QnJhbmNoKGJhcm5lc0h1dFRyZWUucm9vdCk7CgogICAgICAgIC8vIHBsYWNlIHRoZSBub2RlcyBvbmUgYnkgb25lIHJlY3Vyc2l2ZWx5CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlQ291bnQ7IGkrKykgewogICAgICAgICAgbm9kZSA9IG5vZGVzW25vZGVJbmRpY2VzW2ldXTsKICAgICAgICAgIGlmIChub2RlLm9wdGlvbnMubWFzcyA+IDApIHsKICAgICAgICAgICAgdGhpcy5fcGxhY2VJblRyZWUoYmFybmVzSHV0VHJlZS5yb290LCBub2RlKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG1ha2UgZ2xvYmFsCiAgICAgICAgcmV0dXJuIGJhcm5lc0h1dFRyZWU7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX3VwZGF0ZUJyYW5jaE1hc3MiLAoKICAgICAgLyoqCiAgICAgICAqIHRoaXMgdXBkYXRlcyB0aGUgbWFzcyBvZiBhIGJyYW5jaC4gdGhpcyBpcyBpbmNyZWFzZWQgYnkgYWRkaW5nIGEgbm9kZS4KICAgICAgICoKICAgICAgICogQHBhcmFtIHBhcmVudEJyYW5jaAogICAgICAgKiBAcGFyYW0gbm9kZQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF91cGRhdGVCcmFuY2hNYXNzKHBhcmVudEJyYW5jaCwgbm9kZSkgewogICAgICAgIHZhciB0b3RhbE1hc3MgPSBwYXJlbnRCcmFuY2gubWFzcyArIG5vZGUub3B0aW9ucy5tYXNzOwogICAgICAgIHZhciB0b3RhbE1hc3NJbnYgPSAxIC8gdG90YWxNYXNzOwoKICAgICAgICBwYXJlbnRCcmFuY2guY2VudGVyT2ZNYXNzLnggPSBwYXJlbnRCcmFuY2guY2VudGVyT2ZNYXNzLnggKiBwYXJlbnRCcmFuY2gubWFzcyArIG5vZGUueCAqIG5vZGUub3B0aW9ucy5tYXNzOwogICAgICAgIHBhcmVudEJyYW5jaC5jZW50ZXJPZk1hc3MueCAqPSB0b3RhbE1hc3NJbnY7CgogICAgICAgIHBhcmVudEJyYW5jaC5jZW50ZXJPZk1hc3MueSA9IHBhcmVudEJyYW5jaC5jZW50ZXJPZk1hc3MueSAqIHBhcmVudEJyYW5jaC5tYXNzICsgbm9kZS55ICogbm9kZS5vcHRpb25zLm1hc3M7CiAgICAgICAgcGFyZW50QnJhbmNoLmNlbnRlck9mTWFzcy55ICo9IHRvdGFsTWFzc0ludjsKCiAgICAgICAgcGFyZW50QnJhbmNoLm1hc3MgPSB0b3RhbE1hc3M7CiAgICAgICAgdmFyIGJpZ2dlc3RTaXplID0gTWF0aC5tYXgoTWF0aC5tYXgobm9kZS5oZWlnaHQsIG5vZGUucmFkaXVzKSwgbm9kZS53aWR0aCk7CiAgICAgICAgcGFyZW50QnJhbmNoLm1heFdpZHRoID0gcGFyZW50QnJhbmNoLm1heFdpZHRoIDwgYmlnZ2VzdFNpemUgPyBiaWdnZXN0U2l6ZSA6IHBhcmVudEJyYW5jaC5tYXhXaWR0aDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfcGxhY2VJblRyZWUiLAoKICAgICAgLyoqCiAgICAgICAqIGRldGVybWluZSBpbiB3aGljaCBicmFuY2ggdGhlIG5vZGUgd2lsbCBiZSBwbGFjZWQuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSBwYXJlbnRCcmFuY2gKICAgICAgICogQHBhcmFtIG5vZGUKICAgICAgICogQHBhcmFtIHNraXBNYXNzVXBkYXRlCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3BsYWNlSW5UcmVlKHBhcmVudEJyYW5jaCwgbm9kZSwgc2tpcE1hc3NVcGRhdGUpIHsKICAgICAgICBpZiAoc2tpcE1hc3NVcGRhdGUgIT0gdHJ1ZSB8fCBza2lwTWFzc1VwZGF0ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvLyB1cGRhdGUgdGhlIG1hc3Mgb2YgdGhlIGJyYW5jaC4KICAgICAgICAgIHRoaXMuX3VwZGF0ZUJyYW5jaE1hc3MocGFyZW50QnJhbmNoLCBub2RlKTsKICAgICAgICB9CgogICAgICAgIGlmIChwYXJlbnRCcmFuY2guY2hpbGRyZW4uTlcucmFuZ2UubWF4WCA+IG5vZGUueCkgewogICAgICAgICAgLy8gaW4gTlcgb3IgU1cKICAgICAgICAgIGlmIChwYXJlbnRCcmFuY2guY2hpbGRyZW4uTlcucmFuZ2UubWF4WSA+IG5vZGUueSkgewogICAgICAgICAgICAvLyBpbiBOVwogICAgICAgICAgICB0aGlzLl9wbGFjZUluUmVnaW9uKHBhcmVudEJyYW5jaCwgbm9kZSwgIk5XIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBpbiBTVwogICAgICAgICAgICB0aGlzLl9wbGFjZUluUmVnaW9uKHBhcmVudEJyYW5jaCwgbm9kZSwgIlNXIik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGluIE5FIG9yIFNFCiAgICAgICAgICBpZiAocGFyZW50QnJhbmNoLmNoaWxkcmVuLk5XLnJhbmdlLm1heFkgPiBub2RlLnkpIHsKICAgICAgICAgICAgLy8gaW4gTkUKICAgICAgICAgICAgdGhpcy5fcGxhY2VJblJlZ2lvbihwYXJlbnRCcmFuY2gsIG5vZGUsICJORSIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gaW4gU0UKICAgICAgICAgICAgdGhpcy5fcGxhY2VJblJlZ2lvbihwYXJlbnRCcmFuY2gsIG5vZGUsICJTRSIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfcGxhY2VJblJlZ2lvbiIsCgogICAgICAvKioKICAgICAgICogYWN0dWFsbHkgcGxhY2UgdGhlIG5vZGUgaW4gYSByZWdpb24gKG9yIGJyYW5jaCkKICAgICAgICoKICAgICAgICogQHBhcmFtIHBhcmVudEJyYW5jaAogICAgICAgKiBAcGFyYW0gbm9kZQogICAgICAgKiBAcGFyYW0gcmVnaW9uCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3BsYWNlSW5SZWdpb24ocGFyZW50QnJhbmNoLCBub2RlLCByZWdpb24pIHsKICAgICAgICBzd2l0Y2ggKHBhcmVudEJyYW5jaC5jaGlsZHJlbltyZWdpb25dLmNoaWxkcmVuQ291bnQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgLy8gcGxhY2Ugbm9kZSBoZXJlCiAgICAgICAgICAgIHBhcmVudEJyYW5jaC5jaGlsZHJlbltyZWdpb25dLmNoaWxkcmVuLmRhdGEgPSBub2RlOwogICAgICAgICAgICBwYXJlbnRCcmFuY2guY2hpbGRyZW5bcmVnaW9uXS5jaGlsZHJlbkNvdW50ID0gMTsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlQnJhbmNoTWFzcyhwYXJlbnRCcmFuY2guY2hpbGRyZW5bcmVnaW9uXSwgbm9kZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAvLyBjb252ZXJ0IGludG8gY2hpbGRyZW4KICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIHR3byBub2RlcyBleGFjdGx5IG92ZXJsYXBwaW5nIChvbiBpbml0LCBvbiBvcGVuaW5nIG9mIGNsdXN0ZXIgZXRjLikKICAgICAgICAgICAgLy8gd2UgbW92ZSBvbmUgbm9kZSBhIHBpeGVsIGFuZCB3ZSBkbyBub3QgcHV0IGl0IGluIHRoZSB0cmVlLgogICAgICAgICAgICBpZiAocGFyZW50QnJhbmNoLmNoaWxkcmVuW3JlZ2lvbl0uY2hpbGRyZW4uZGF0YS54ID09PSBub2RlLnggJiYgcGFyZW50QnJhbmNoLmNoaWxkcmVuW3JlZ2lvbl0uY2hpbGRyZW4uZGF0YS55ID09PSBub2RlLnkpIHsKICAgICAgICAgICAgICBub2RlLnggKz0gdGhpcy5zZWVkZWRSYW5kb20oKTsKICAgICAgICAgICAgICBub2RlLnkgKz0gdGhpcy5zZWVkZWRSYW5kb20oKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLl9zcGxpdEJyYW5jaChwYXJlbnRCcmFuY2guY2hpbGRyZW5bcmVnaW9uXSk7CiAgICAgICAgICAgICAgdGhpcy5fcGxhY2VJblRyZWUocGFyZW50QnJhbmNoLmNoaWxkcmVuW3JlZ2lvbl0sIG5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAvLyBwbGFjZSBpbiBicmFuY2gKICAgICAgICAgICAgdGhpcy5fcGxhY2VJblRyZWUocGFyZW50QnJhbmNoLmNoaWxkcmVuW3JlZ2lvbl0sIG5vZGUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX3NwbGl0QnJhbmNoIiwKCiAgICAgIC8qKgogICAgICAgKiB0aGlzIGZ1bmN0aW9uIHNwbGl0cyBhIGJyYW5jaCBpbnRvIDQgc3ViIGJyYW5jaGVzLiBJZiB0aGUgYnJhbmNoIGNvbnRhaW5lZCBhIG5vZGUsIHdlIHBsYWNlIGl0IGluIHRoZSBzdWJicmFuY2gKICAgICAgICogYWZ0ZXIgdGhlIHNwbGl0IGlzIGNvbXBsZXRlLgogICAgICAgKgogICAgICAgKiBAcGFyYW0gcGFyZW50QnJhbmNoCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3NwbGl0QnJhbmNoKHBhcmVudEJyYW5jaCkgewogICAgICAgIC8vIGlmIHRoZSBicmFuY2ggaXMgc2hhZGVkIHdpdGggYSBub2RlLCByZXBsYWNlIHRoZSBub2RlIGluIHRoZSBuZXcgc3Vic2V0LgogICAgICAgIHZhciBjb250YWluZWROb2RlID0gbnVsbDsKICAgICAgICBpZiAocGFyZW50QnJhbmNoLmNoaWxkcmVuQ291bnQgPT09IDEpIHsKICAgICAgICAgIGNvbnRhaW5lZE5vZGUgPSBwYXJlbnRCcmFuY2guY2hpbGRyZW4uZGF0YTsKICAgICAgICAgIHBhcmVudEJyYW5jaC5tYXNzID0gMDsKICAgICAgICAgIHBhcmVudEJyYW5jaC5jZW50ZXJPZk1hc3MueCA9IDA7CiAgICAgICAgICBwYXJlbnRCcmFuY2guY2VudGVyT2ZNYXNzLnkgPSAwOwogICAgICAgIH0KICAgICAgICBwYXJlbnRCcmFuY2guY2hpbGRyZW5Db3VudCA9IDQ7CiAgICAgICAgcGFyZW50QnJhbmNoLmNoaWxkcmVuLmRhdGEgPSBudWxsOwogICAgICAgIHRoaXMuX2luc2VydFJlZ2lvbihwYXJlbnRCcmFuY2gsICJOVyIpOwogICAgICAgIHRoaXMuX2luc2VydFJlZ2lvbihwYXJlbnRCcmFuY2gsICJORSIpOwogICAgICAgIHRoaXMuX2luc2VydFJlZ2lvbihwYXJlbnRCcmFuY2gsICJTVyIpOwogICAgICAgIHRoaXMuX2luc2VydFJlZ2lvbihwYXJlbnRCcmFuY2gsICJTRSIpOwoKICAgICAgICBpZiAoY29udGFpbmVkTm9kZSAhPSBudWxsKSB7CiAgICAgICAgICB0aGlzLl9wbGFjZUluVHJlZShwYXJlbnRCcmFuY2gsIGNvbnRhaW5lZE5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfaW5zZXJ0UmVnaW9uIiwKCiAgICAgIC8qKgogICAgICAgKiBUaGlzIGZ1bmN0aW9uIHN1YmRpdmlkZXMgdGhlIHJlZ2lvbiBpbnRvIGZvdXIgbmV3IHNlZ21lbnRzLgogICAgICAgKiBTcGVjaWZpY2FsbHksIHRoaXMgaW5zZXJ0cyBhIHNpbmdsZSBuZXcgc2VnbWVudC4KICAgICAgICogSXQgZmlsbHMgdGhlIGNoaWxkcmVuIHNlY3Rpb24gb2YgdGhlIHBhcmVudEJyYW5jaAogICAgICAgKgogICAgICAgKiBAcGFyYW0gcGFyZW50QnJhbmNoCiAgICAgICAqIEBwYXJhbSByZWdpb24KICAgICAgICogQHBhcmFtIHBhcmVudFJhbmdlCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2luc2VydFJlZ2lvbihwYXJlbnRCcmFuY2gsIHJlZ2lvbikgewogICAgICAgIHZhciBtaW5YID0gdW5kZWZpbmVkLAogICAgICAgICAgICBtYXhYID0gdW5kZWZpbmVkLAogICAgICAgICAgICBtaW5ZID0gdW5kZWZpbmVkLAogICAgICAgICAgICBtYXhZID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBjaGlsZFNpemUgPSAwLjUgKiBwYXJlbnRCcmFuY2guc2l6ZTsKICAgICAgICBzd2l0Y2ggKHJlZ2lvbikgewogICAgICAgICAgY2FzZSAiTlciOgogICAgICAgICAgICBtaW5YID0gcGFyZW50QnJhbmNoLnJhbmdlLm1pblg7CiAgICAgICAgICAgIG1heFggPSBwYXJlbnRCcmFuY2gucmFuZ2UubWluWCArIGNoaWxkU2l6ZTsKICAgICAgICAgICAgbWluWSA9IHBhcmVudEJyYW5jaC5yYW5nZS5taW5ZOwogICAgICAgICAgICBtYXhZID0gcGFyZW50QnJhbmNoLnJhbmdlLm1pblkgKyBjaGlsZFNpemU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiTkUiOgogICAgICAgICAgICBtaW5YID0gcGFyZW50QnJhbmNoLnJhbmdlLm1pblggKyBjaGlsZFNpemU7CiAgICAgICAgICAgIG1heFggPSBwYXJlbnRCcmFuY2gucmFuZ2UubWF4WDsKICAgICAgICAgICAgbWluWSA9IHBhcmVudEJyYW5jaC5yYW5nZS5taW5ZOwogICAgICAgICAgICBtYXhZID0gcGFyZW50QnJhbmNoLnJhbmdlLm1pblkgKyBjaGlsZFNpemU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiU1ciOgogICAgICAgICAgICBtaW5YID0gcGFyZW50QnJhbmNoLnJhbmdlLm1pblg7CiAgICAgICAgICAgIG1heFggPSBwYXJlbnRCcmFuY2gucmFuZ2UubWluWCArIGNoaWxkU2l6ZTsKICAgICAgICAgICAgbWluWSA9IHBhcmVudEJyYW5jaC5yYW5nZS5taW5ZICsgY2hpbGRTaXplOwogICAgICAgICAgICBtYXhZID0gcGFyZW50QnJhbmNoLnJhbmdlLm1heFk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiU0UiOgogICAgICAgICAgICBtaW5YID0gcGFyZW50QnJhbmNoLnJhbmdlLm1pblggKyBjaGlsZFNpemU7CiAgICAgICAgICAgIG1heFggPSBwYXJlbnRCcmFuY2gucmFuZ2UubWF4WDsKICAgICAgICAgICAgbWluWSA9IHBhcmVudEJyYW5jaC5yYW5nZS5taW5ZICsgY2hpbGRTaXplOwogICAgICAgICAgICBtYXhZID0gcGFyZW50QnJhbmNoLnJhbmdlLm1heFk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgcGFyZW50QnJhbmNoLmNoaWxkcmVuW3JlZ2lvbl0gPSB7CiAgICAgICAgICBjZW50ZXJPZk1hc3M6IHsgeDogMCwgeTogMCB9LAogICAgICAgICAgbWFzczogMCwKICAgICAgICAgIHJhbmdlOiB7IG1pblg6IG1pblgsIG1heFg6IG1heFgsIG1pblk6IG1pblksIG1heFk6IG1heFkgfSwKICAgICAgICAgIHNpemU6IDAuNSAqIHBhcmVudEJyYW5jaC5zaXplLAogICAgICAgICAgY2FsY1NpemU6IDIgKiBwYXJlbnRCcmFuY2guY2FsY1NpemUsCiAgICAgICAgICBjaGlsZHJlbjogeyBkYXRhOiBudWxsIH0sCiAgICAgICAgICBtYXhXaWR0aDogMCwKICAgICAgICAgIGxldmVsOiBwYXJlbnRCcmFuY2gubGV2ZWwgKyAxLAogICAgICAgICAgY2hpbGRyZW5Db3VudDogMAogICAgICAgIH07CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX2RlYnVnIiwKCiAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICBERUJVR0dJTkcgQkVMT1cgIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS8vCgogICAgICAvKioKICAgICAgICogVGhpcyBmdW5jdGlvbiBpcyBmb3IgZGVidWdnaW5nIHB1cnBvc2VkLCBpdCBkcmF3cyB0aGUgdHJlZS4KICAgICAgICoKICAgICAgICogQHBhcmFtIGN0eAogICAgICAgKiBAcGFyYW0gY29sb3IKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZGVidWcoY3R4LCBjb2xvcikgewogICAgICAgIGlmICh0aGlzLmJhcm5lc0h1dFRyZWUgIT09IHVuZGVmaW5lZCkgewoKICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAxOwoKICAgICAgICAgIHRoaXMuX2RyYXdCcmFuY2godGhpcy5iYXJuZXNIdXRUcmVlLnJvb3QsIGN0eCwgY29sb3IpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfZHJhd0JyYW5jaCIsCgogICAgICAvKioKICAgICAgICogVGhpcyBmdW5jdGlvbiBpcyBmb3IgZGVidWdnaW5nIHB1cnBvc2VzLiBJdCBkcmF3cyB0aGUgYnJhbmNoZXMgcmVjdXJzaXZlbHkuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSBicmFuY2gKICAgICAgICogQHBhcmFtIGN0eAogICAgICAgKiBAcGFyYW0gY29sb3IKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZHJhd0JyYW5jaChicmFuY2gsIGN0eCwgY29sb3IpIHsKICAgICAgICBpZiAoY29sb3IgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgY29sb3IgPSAiI0ZGMDAwMCI7CiAgICAgICAgfQoKICAgICAgICBpZiAoYnJhbmNoLmNoaWxkcmVuQ291bnQgPT09IDQpIHsKICAgICAgICAgIHRoaXMuX2RyYXdCcmFuY2goYnJhbmNoLmNoaWxkcmVuLk5XLCBjdHgpOwogICAgICAgICAgdGhpcy5fZHJhd0JyYW5jaChicmFuY2guY2hpbGRyZW4uTkUsIGN0eCk7CiAgICAgICAgICB0aGlzLl9kcmF3QnJhbmNoKGJyYW5jaC5jaGlsZHJlbi5TRSwgY3R4KTsKICAgICAgICAgIHRoaXMuX2RyYXdCcmFuY2goYnJhbmNoLmNoaWxkcmVuLlNXLCBjdHgpOwogICAgICAgIH0KICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyhicmFuY2gucmFuZ2UubWluWCwgYnJhbmNoLnJhbmdlLm1pblkpOwogICAgICAgIGN0eC5saW5lVG8oYnJhbmNoLnJhbmdlLm1heFgsIGJyYW5jaC5yYW5nZS5taW5ZKTsKICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHgubW92ZVRvKGJyYW5jaC5yYW5nZS5tYXhYLCBicmFuY2gucmFuZ2UubWluWSk7CiAgICAgICAgY3R4LmxpbmVUbyhicmFuY2gucmFuZ2UubWF4WCwgYnJhbmNoLnJhbmdlLm1heFkpOwogICAgICAgIGN0eC5zdHJva2UoKTsKCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGN0eC5tb3ZlVG8oYnJhbmNoLnJhbmdlLm1heFgsIGJyYW5jaC5yYW5nZS5tYXhZKTsKICAgICAgICBjdHgubGluZVRvKGJyYW5jaC5yYW5nZS5taW5YLCBicmFuY2gucmFuZ2UubWF4WSk7CiAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4Lm1vdmVUbyhicmFuY2gucmFuZ2UubWluWCwgYnJhbmNoLnJhbmdlLm1heFkpOwogICAgICAgIGN0eC5saW5lVG8oYnJhbmNoLnJhbmdlLm1pblgsIGJyYW5jaC5yYW5nZS5taW5ZKTsKICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgIC8qCiAgICAgICAgIGlmIChicmFuY2gubWFzcyA+IDApIHsKICAgICAgICAgY3R4LmNpcmNsZShicmFuY2guY2VudGVyT2ZNYXNzLngsIGJyYW5jaC5jZW50ZXJPZk1hc3MueSwgMypicmFuY2gubWFzcyk7CiAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgfQogICAgICAgICAqLwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIEJhcm5lc0h1dFNvbHZlcjsKICB9KSgpOwoKICBleHBvcnRzWyJkZWZhdWx0Il0gPSBCYXJuZXNIdXRTb2x2ZXI7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CgovKioqLyB9LAovKiA5MCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgInVzZSBzdHJpY3QiOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCiAgdmFyIFJlcHVsc2lvblNvbHZlciA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBSZXB1bHNpb25Tb2x2ZXIoYm9keSwgcGh5c2ljc0JvZHksIG9wdGlvbnMpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJlcHVsc2lvblNvbHZlcik7CgogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLnBoeXNpY3NCb2R5ID0gcGh5c2ljc0JvZHk7CiAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoUmVwdWxzaW9uU29sdmVyLCBbewogICAgICBrZXk6ICJzZXRPcHRpb25zIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykgewogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic29sdmUiLAoKICAgICAgLyoqCiAgICAgICAqIENhbGN1bGF0ZSB0aGUgZm9yY2VzIHRoZSBub2RlcyBhcHBseSBvbiBlYWNoIG90aGVyIGJhc2VkIG9uIGEgcmVwdWxzaW9uIGZpZWxkLgogICAgICAgKiBUaGlzIGZpZWxkIGlzIGxpbmVhcmx5IGFwcHJveGltYXRlZC4KICAgICAgICoKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzb2x2ZSgpIHsKICAgICAgICB2YXIgZHgsIGR5LCBkaXN0YW5jZSwgZngsIGZ5LCByZXB1bHNpbmdGb3JjZSwgbm9kZTEsIG5vZGUyOwoKICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLmJvZHkubm9kZXM7CiAgICAgICAgdmFyIG5vZGVJbmRpY2VzID0gdGhpcy5waHlzaWNzQm9keS5waHlzaWNzTm9kZUluZGljZXM7CiAgICAgICAgdmFyIGZvcmNlcyA9IHRoaXMucGh5c2ljc0JvZHkuZm9yY2VzOwoKICAgICAgICAvLyByZXB1bHNpbmcgZm9yY2VzIGJldHdlZW4gbm9kZXMKICAgICAgICB2YXIgbm9kZURpc3RhbmNlID0gdGhpcy5vcHRpb25zLm5vZGVEaXN0YW5jZTsKCiAgICAgICAgLy8gYXBwcm94aW1hdGlvbiBjb25zdGFudHMKICAgICAgICB2YXIgYSA9IC0yIC8gMyAvIG5vZGVEaXN0YW5jZTsKICAgICAgICB2YXIgYiA9IDQgLyAzOwoKICAgICAgICAvLyB3ZSBsb29wIGZyb20gaSBvdmVyIGFsbCBidXQgdGhlIGxhc3QgZW50cmVlIGluIHRoZSBhcnJheQogICAgICAgIC8vIGogbG9vcHMgZnJvbSBpKzEgdG8gdGhlIGxhc3QuIFRoaXMgd2F5IHdlIGRvIG5vdCBkb3VibGUgY291bnQgYW55IG9mIHRoZSBpbmRpY2VzLCBub3IgaSA9PT0gagogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZUluZGljZXMubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICBub2RlMSA9IG5vZGVzW25vZGVJbmRpY2VzW2ldXTsKICAgICAgICAgIGZvciAodmFyIGogPSBpICsgMTsgaiA8IG5vZGVJbmRpY2VzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIG5vZGUyID0gbm9kZXNbbm9kZUluZGljZXNbal1dOwoKICAgICAgICAgICAgZHggPSBub2RlMi54IC0gbm9kZTEueDsKICAgICAgICAgICAgZHkgPSBub2RlMi55IC0gbm9kZTEueTsKICAgICAgICAgICAgZGlzdGFuY2UgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwoKICAgICAgICAgICAgLy8gc2FtZSBjb25kaXRpb24gYXMgQmFybmVzSHV0U29sdmVyLCBtYWtpbmcgc3VyZSBub2RlcyBhcmUgbmV2ZXIgMTAwJSBvdmVybGFwcGluZy4KICAgICAgICAgICAgaWYgKGRpc3RhbmNlID09PSAwKSB7CiAgICAgICAgICAgICAgZGlzdGFuY2UgPSAwLjEgKiBNYXRoLnJhbmRvbSgpOwogICAgICAgICAgICAgIGR4ID0gZGlzdGFuY2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChkaXN0YW5jZSA8IDIgKiBub2RlRGlzdGFuY2UpIHsKICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UgPCAwLjUgKiBub2RlRGlzdGFuY2UpIHsKICAgICAgICAgICAgICAgIHJlcHVsc2luZ0ZvcmNlID0gMTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVwdWxzaW5nRm9yY2UgPSBhICogZGlzdGFuY2UgKyBiOyAvLyBsaW5lYXIgYXBwcm94IG9mICAxIC8gKDEgKyBNYXRoLmV4cCgoZGlzdGFuY2UgLyBub2RlRGlzdGFuY2UgLSAxKSAqIHN0ZWVwbmVzcykpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJlcHVsc2luZ0ZvcmNlID0gcmVwdWxzaW5nRm9yY2UgLyBkaXN0YW5jZTsKCiAgICAgICAgICAgICAgZnggPSBkeCAqIHJlcHVsc2luZ0ZvcmNlOwogICAgICAgICAgICAgIGZ5ID0gZHkgKiByZXB1bHNpbmdGb3JjZTsKCiAgICAgICAgICAgICAgZm9yY2VzW25vZGUxLmlkXS54IC09IGZ4OwogICAgICAgICAgICAgIGZvcmNlc1tub2RlMS5pZF0ueSAtPSBmeTsKICAgICAgICAgICAgICBmb3JjZXNbbm9kZTIuaWRdLnggKz0gZng7CiAgICAgICAgICAgICAgZm9yY2VzW25vZGUyLmlkXS55ICs9IGZ5OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFJlcHVsc2lvblNvbHZlcjsKICB9KSgpOwoKICBleHBvcnRzWyJkZWZhdWx0Il0gPSBSZXB1bHNpb25Tb2x2ZXI7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CgovKioqLyB9LAovKiA5MSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgInVzZSBzdHJpY3QiOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCiAgdmFyIEhpZXJhcmNoaWNhbFJlcHVsc2lvblNvbHZlciA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBIaWVyYXJjaGljYWxSZXB1bHNpb25Tb2x2ZXIoYm9keSwgcGh5c2ljc0JvZHksIG9wdGlvbnMpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEhpZXJhcmNoaWNhbFJlcHVsc2lvblNvbHZlcik7CgogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLnBoeXNpY3NCb2R5ID0gcGh5c2ljc0JvZHk7CiAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoSGllcmFyY2hpY2FsUmVwdWxzaW9uU29sdmVyLCBbewogICAgICBrZXk6ICJzZXRPcHRpb25zIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykgewogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic29sdmUiLAoKICAgICAgLyoqCiAgICAgICAqIENhbGN1bGF0ZSB0aGUgZm9yY2VzIHRoZSBub2RlcyBhcHBseSBvbiBlYWNoIG90aGVyIGJhc2VkIG9uIGEgcmVwdWxzaW9uIGZpZWxkLgogICAgICAgKiBUaGlzIGZpZWxkIGlzIGxpbmVhcmx5IGFwcHJveGltYXRlZC4KICAgICAgICoKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzb2x2ZSgpIHsKICAgICAgICB2YXIgZHgsIGR5LCBkaXN0YW5jZSwgZngsIGZ5LCByZXB1bHNpbmdGb3JjZSwgbm9kZTEsIG5vZGUyLCBpLCBqOwoKICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLmJvZHkubm9kZXM7CiAgICAgICAgdmFyIG5vZGVJbmRpY2VzID0gdGhpcy5waHlzaWNzQm9keS5waHlzaWNzTm9kZUluZGljZXM7CiAgICAgICAgdmFyIGZvcmNlcyA9IHRoaXMucGh5c2ljc0JvZHkuZm9yY2VzOwoKICAgICAgICAvLyByZXB1bHNpbmcgZm9yY2VzIGJldHdlZW4gbm9kZXMKICAgICAgICB2YXIgbm9kZURpc3RhbmNlID0gdGhpcy5vcHRpb25zLm5vZGVEaXN0YW5jZTsKCiAgICAgICAgLy8gd2UgbG9vcCBmcm9tIGkgb3ZlciBhbGwgYnV0IHRoZSBsYXN0IGVudHJlZSBpbiB0aGUgYXJyYXkKICAgICAgICAvLyBqIGxvb3BzIGZyb20gaSsxIHRvIHRoZSBsYXN0LiBUaGlzIHdheSB3ZSBkbyBub3QgZG91YmxlIGNvdW50IGFueSBvZiB0aGUgaW5kaWNlcywgbm9yIGkgPT09IGoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbm9kZUluZGljZXMubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICBub2RlMSA9IG5vZGVzW25vZGVJbmRpY2VzW2ldXTsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgbm9kZUluZGljZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgbm9kZTIgPSBub2Rlc1tub2RlSW5kaWNlc1tqXV07CgogICAgICAgICAgICAvLyBub2RlcyBvbmx5IGFmZmVjdCBub2RlcyBvbiB0aGVpciBsZXZlbAogICAgICAgICAgICBpZiAobm9kZTEubGV2ZWwgPT09IG5vZGUyLmxldmVsKSB7CiAgICAgICAgICAgICAgZHggPSBub2RlMi54IC0gbm9kZTEueDsKICAgICAgICAgICAgICBkeSA9IG5vZGUyLnkgLSBub2RlMS55OwogICAgICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKCiAgICAgICAgICAgICAgdmFyIHN0ZWVwbmVzcyA9IDAuMDU7CiAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlIDwgbm9kZURpc3RhbmNlKSB7CiAgICAgICAgICAgICAgICByZXB1bHNpbmdGb3JjZSA9IC1NYXRoLnBvdyhzdGVlcG5lc3MgKiBkaXN0YW5jZSwgMikgKyBNYXRoLnBvdyhzdGVlcG5lc3MgKiBub2RlRGlzdGFuY2UsIDIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXB1bHNpbmdGb3JjZSA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vIG5vcm1hbGl6ZSBmb3JjZSB3aXRoCiAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlID09PSAwKSB7CiAgICAgICAgICAgICAgICBkaXN0YW5jZSA9IDAuMDE7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlcHVsc2luZ0ZvcmNlID0gcmVwdWxzaW5nRm9yY2UgLyBkaXN0YW5jZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZnggPSBkeCAqIHJlcHVsc2luZ0ZvcmNlOwogICAgICAgICAgICAgIGZ5ID0gZHkgKiByZXB1bHNpbmdGb3JjZTsKCiAgICAgICAgICAgICAgZm9yY2VzW25vZGUxLmlkXS54IC09IGZ4OwogICAgICAgICAgICAgIGZvcmNlc1tub2RlMS5pZF0ueSAtPSBmeTsKICAgICAgICAgICAgICBmb3JjZXNbbm9kZTIuaWRdLnggKz0gZng7CiAgICAgICAgICAgICAgZm9yY2VzW25vZGUyLmlkXS55ICs9IGZ5OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIEhpZXJhcmNoaWNhbFJlcHVsc2lvblNvbHZlcjsKICB9KSgpOwoKICBleHBvcnRzWyJkZWZhdWx0Il0gPSBIaWVyYXJjaGljYWxSZXB1bHNpb25Tb2x2ZXI7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CgovKioqLyB9LAovKiA5MiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgInVzZSBzdHJpY3QiOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCiAgdmFyIFNwcmluZ1NvbHZlciA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBTcHJpbmdTb2x2ZXIoYm9keSwgcGh5c2ljc0JvZHksIG9wdGlvbnMpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFNwcmluZ1NvbHZlcik7CgogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLnBoeXNpY3NCb2R5ID0gcGh5c2ljc0JvZHk7CiAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoU3ByaW5nU29sdmVyLCBbewogICAgICBrZXk6ICJzZXRPcHRpb25zIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykgewogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic29sdmUiLAoKICAgICAgLyoqCiAgICAgICAqIFRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyB0aGUgc3ByaW5nZm9yY2VzIG9uIHRoZSBub2RlcywgYWNjb3VudGluZyBmb3IgdGhlIHN1cHBvcnQgbm9kZXMuCiAgICAgICAqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc29sdmUoKSB7CiAgICAgICAgdmFyIGVkZ2VMZW5ndGggPSB1bmRlZmluZWQsCiAgICAgICAgICAgIGVkZ2UgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIGVkZ2VJbmRpY2VzID0gdGhpcy5waHlzaWNzQm9keS5waHlzaWNzRWRnZUluZGljZXM7CiAgICAgICAgdmFyIGVkZ2VzID0gdGhpcy5ib2R5LmVkZ2VzOwogICAgICAgIHZhciBub2RlMSA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgbm9kZTIgPSB1bmRlZmluZWQsCiAgICAgICAgICAgIG5vZGUzID0gdW5kZWZpbmVkOwoKICAgICAgICAvLyBmb3JjZXMgY2F1c2VkIGJ5IHRoZSBlZGdlcywgbW9kZWxsZWQgYXMgc3ByaW5ncwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWRnZUluZGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGVkZ2UgPSBlZGdlc1tlZGdlSW5kaWNlc1tpXV07CiAgICAgICAgICBpZiAoZWRnZS5jb25uZWN0ZWQgPT09IHRydWUgJiYgZWRnZS50b0lkICE9PSBlZGdlLmZyb21JZCkgewogICAgICAgICAgICAvLyBvbmx5IGNhbGN1bGF0ZSBmb3JjZXMgaWYgbm9kZXMgYXJlIGluIHRoZSBzYW1lIHNlY3RvcgogICAgICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzW2VkZ2UudG9JZF0gIT09IHVuZGVmaW5lZCAmJiB0aGlzLmJvZHkubm9kZXNbZWRnZS5mcm9tSWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBpZiAoZWRnZS5lZGdlVHlwZS52aWEgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZWRnZUxlbmd0aCA9IGVkZ2Uub3B0aW9ucy5sZW5ndGggPT09IHVuZGVmaW5lZCA/IHRoaXMub3B0aW9ucy5zcHJpbmdMZW5ndGggOiBlZGdlLm9wdGlvbnMubGVuZ3RoOwogICAgICAgICAgICAgICAgbm9kZTEgPSBlZGdlLnRvOwogICAgICAgICAgICAgICAgbm9kZTIgPSBlZGdlLmVkZ2VUeXBlLnZpYTsKICAgICAgICAgICAgICAgIG5vZGUzID0gZWRnZS5mcm9tOwoKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZVNwcmluZ0ZvcmNlKG5vZGUxLCBub2RlMiwgMC41ICogZWRnZUxlbmd0aCk7CiAgICAgICAgICAgICAgICB0aGlzLl9jYWxjdWxhdGVTcHJpbmdGb3JjZShub2RlMiwgbm9kZTMsIDAuNSAqIGVkZ2VMZW5ndGgpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB0aGUgKiAxLjUgaXMgaGVyZSBzbyB0aGUgZWRnZSBsb29rcyBhcyBsYXJnZSBhcyBhIHNtb290aCBlZGdlLiBJdCBkb2VzIG5vdCBpbml0aWFsbHkgYmVjYXVzZSB0aGUgc21vb3RoIGVkZ2VzIHVzZQogICAgICAgICAgICAgICAgLy8gdGhlIHN1cHBvcnQgbm9kZXMgd2hpY2ggZXhlcnQgYSByZXB1bHNpdmUgZm9yY2Ugb24gdGhlIHRvIGFuZCBmcm9tIG5vZGVzLCBtYWtpbmcgdGhlIGVkZ2UgYXBwZWFyIGxhcmdlci4KICAgICAgICAgICAgICAgIGVkZ2VMZW5ndGggPSBlZGdlLm9wdGlvbnMubGVuZ3RoID09PSB1bmRlZmluZWQgPyB0aGlzLm9wdGlvbnMuc3ByaW5nTGVuZ3RoICogMS41IDogZWRnZS5vcHRpb25zLmxlbmd0aDsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGN1bGF0ZVNwcmluZ0ZvcmNlKGVkZ2UuZnJvbSwgZWRnZS50bywgZWRnZUxlbmd0aCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9jYWxjdWxhdGVTcHJpbmdGb3JjZSIsCgogICAgICAvKioKICAgICAgICogVGhpcyBpcyB0aGUgY29kZSBhY3R1YWxseSBwZXJmb3JtaW5nIHRoZSBjYWxjdWxhdGlvbiBmb3IgdGhlIGZ1bmN0aW9uIGFib3ZlLgogICAgICAgKgogICAgICAgKiBAcGFyYW0gbm9kZTEKICAgICAgICogQHBhcmFtIG5vZGUyCiAgICAgICAqIEBwYXJhbSBlZGdlTGVuZ3RoCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NhbGN1bGF0ZVNwcmluZ0ZvcmNlKG5vZGUxLCBub2RlMiwgZWRnZUxlbmd0aCkgewogICAgICAgIHZhciBkeCA9IG5vZGUxLnggLSBub2RlMi54OwogICAgICAgIHZhciBkeSA9IG5vZGUxLnkgLSBub2RlMi55OwogICAgICAgIHZhciBkaXN0YW5jZSA9IE1hdGgubWF4KE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSksIDAuMDEpOwoKICAgICAgICAvLyB0aGUgMS9kaXN0YW5jZSBpcyBzbyB0aGUgZnggYW5kIGZ5IGNhbiBiZSBjYWxjdWxhdGVkIHdpdGhvdXQgc2luZSBvciBjb3NpbmUuCiAgICAgICAgdmFyIHNwcmluZ0ZvcmNlID0gdGhpcy5vcHRpb25zLnNwcmluZ0NvbnN0YW50ICogKGVkZ2VMZW5ndGggLSBkaXN0YW5jZSkgLyBkaXN0YW5jZTsKCiAgICAgICAgdmFyIGZ4ID0gZHggKiBzcHJpbmdGb3JjZTsKICAgICAgICB2YXIgZnkgPSBkeSAqIHNwcmluZ0ZvcmNlOwoKICAgICAgICAvLyBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgb25lIG5vZGUgaXMgbm90IHBhcnQgb2YgdGhlIHBoeXNjaXMKICAgICAgICBpZiAodGhpcy5waHlzaWNzQm9keS5mb3JjZXNbbm9kZTEuaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMucGh5c2ljc0JvZHkuZm9yY2VzW25vZGUxLmlkXS54ICs9IGZ4OwogICAgICAgICAgdGhpcy5waHlzaWNzQm9keS5mb3JjZXNbbm9kZTEuaWRdLnkgKz0gZnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5waHlzaWNzQm9keS5mb3JjZXNbbm9kZTIuaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMucGh5c2ljc0JvZHkuZm9yY2VzW25vZGUyLmlkXS54IC09IGZ4OwogICAgICAgICAgdGhpcy5waHlzaWNzQm9keS5mb3JjZXNbbm9kZTIuaWRdLnkgLT0gZnk7CiAgICAgICAgfQogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIFNwcmluZ1NvbHZlcjsKICB9KSgpOwoKICBleHBvcnRzWyJkZWZhdWx0Il0gPSBTcHJpbmdTb2x2ZXI7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CgovKioqLyB9LAovKiA5MyAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgInVzZSBzdHJpY3QiOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCiAgdmFyIEhpZXJhcmNoaWNhbFNwcmluZ1NvbHZlciA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBIaWVyYXJjaGljYWxTcHJpbmdTb2x2ZXIoYm9keSwgcGh5c2ljc0JvZHksIG9wdGlvbnMpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEhpZXJhcmNoaWNhbFNwcmluZ1NvbHZlcik7CgogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLnBoeXNpY3NCb2R5ID0gcGh5c2ljc0JvZHk7CiAgICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoSGllcmFyY2hpY2FsU3ByaW5nU29sdmVyLCBbewogICAgICBrZXk6ICJzZXRPcHRpb25zIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykgewogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic29sdmUiLAoKICAgICAgLyoqCiAgICAgICAqIFRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyB0aGUgc3ByaW5nZm9yY2VzIG9uIHRoZSBub2RlcywgYWNjb3VudGluZyBmb3IgdGhlIHN1cHBvcnQgbm9kZXMuCiAgICAgICAqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc29sdmUoKSB7CiAgICAgICAgdmFyIGVkZ2VMZW5ndGgsIGVkZ2U7CiAgICAgICAgdmFyIGR4LCBkeSwgZngsIGZ5LCBzcHJpbmdGb3JjZSwgZGlzdGFuY2U7CiAgICAgICAgdmFyIGVkZ2VzID0gdGhpcy5ib2R5LmVkZ2VzOwogICAgICAgIHZhciBmYWN0b3IgPSAwLjU7CgogICAgICAgIHZhciBlZGdlSW5kaWNlcyA9IHRoaXMucGh5c2ljc0JvZHkucGh5c2ljc0VkZ2VJbmRpY2VzOwogICAgICAgIHZhciBub2RlSW5kaWNlcyA9IHRoaXMucGh5c2ljc0JvZHkucGh5c2ljc05vZGVJbmRpY2VzOwogICAgICAgIHZhciBmb3JjZXMgPSB0aGlzLnBoeXNpY3NCb2R5LmZvcmNlczsKCiAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgc3ByaW5nIGZvcmNlIGNvdW50ZXJzCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlSW5kaWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIG5vZGVJZCA9IG5vZGVJbmRpY2VzW2ldOwogICAgICAgICAgZm9yY2VzW25vZGVJZF0uc3ByaW5nRnggPSAwOwogICAgICAgICAgZm9yY2VzW25vZGVJZF0uc3ByaW5nRnkgPSAwOwogICAgICAgIH0KCiAgICAgICAgLy8gZm9yY2VzIGNhdXNlZCBieSB0aGUgZWRnZXMsIG1vZGVsbGVkIGFzIHNwcmluZ3MKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVkZ2VJbmRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBlZGdlID0gZWRnZXNbZWRnZUluZGljZXNbaV1dOwogICAgICAgICAgaWYgKGVkZ2UuY29ubmVjdGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgIGVkZ2VMZW5ndGggPSBlZGdlLm9wdGlvbnMubGVuZ3RoID09PSB1bmRlZmluZWQgPyB0aGlzLm9wdGlvbnMuc3ByaW5nTGVuZ3RoIDogZWRnZS5vcHRpb25zLmxlbmd0aDsKCiAgICAgICAgICAgIGR4ID0gZWRnZS5mcm9tLnggLSBlZGdlLnRvLng7CiAgICAgICAgICAgIGR5ID0gZWRnZS5mcm9tLnkgLSBlZGdlLnRvLnk7CiAgICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgICAgICAgICAgZGlzdGFuY2UgPSBkaXN0YW5jZSA9PT0gMCA/IDAuMDEgOiBkaXN0YW5jZTsKCiAgICAgICAgICAgIC8vIHRoZSAxL2Rpc3RhbmNlIGlzIHNvIHRoZSBmeCBhbmQgZnkgY2FuIGJlIGNhbGN1bGF0ZWQgd2l0aG91dCBzaW5lIG9yIGNvc2luZS4KICAgICAgICAgICAgc3ByaW5nRm9yY2UgPSB0aGlzLm9wdGlvbnMuc3ByaW5nQ29uc3RhbnQgKiAoZWRnZUxlbmd0aCAtIGRpc3RhbmNlKSAvIGRpc3RhbmNlOwoKICAgICAgICAgICAgZnggPSBkeCAqIHNwcmluZ0ZvcmNlOwogICAgICAgICAgICBmeSA9IGR5ICogc3ByaW5nRm9yY2U7CgogICAgICAgICAgICBpZiAoZWRnZS50by5sZXZlbCAhPSBlZGdlLmZyb20ubGV2ZWwpIHsKICAgICAgICAgICAgICBpZiAoZm9yY2VzW2VkZ2UudG9JZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZm9yY2VzW2VkZ2UudG9JZF0uc3ByaW5nRnggLT0gZng7CiAgICAgICAgICAgICAgICBmb3JjZXNbZWRnZS50b0lkXS5zcHJpbmdGeSAtPSBmeTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGZvcmNlc1tlZGdlLmZyb21JZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZm9yY2VzW2VkZ2UuZnJvbUlkXS5zcHJpbmdGeCArPSBmeDsKICAgICAgICAgICAgICAgIGZvcmNlc1tlZGdlLmZyb21JZF0uc3ByaW5nRnkgKz0gZnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChmb3JjZXNbZWRnZS50b0lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBmb3JjZXNbZWRnZS50b0lkXS54IC09IGZhY3RvciAqIGZ4OwogICAgICAgICAgICAgICAgZm9yY2VzW2VkZ2UudG9JZF0ueSAtPSBmYWN0b3IgKiBmeTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGZvcmNlc1tlZGdlLmZyb21JZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgZm9yY2VzW2VkZ2UuZnJvbUlkXS54ICs9IGZhY3RvciAqIGZ4OwogICAgICAgICAgICAgICAgZm9yY2VzW2VkZ2UuZnJvbUlkXS55ICs9IGZhY3RvciAqIGZ5OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm9ybWFsaXplIHNwcmluZyBmb3JjZXMKICAgICAgICB2YXIgc3ByaW5nRm9yY2UgPSAxOwogICAgICAgIHZhciBzcHJpbmdGeCwgc3ByaW5nRnk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlSW5kaWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIG5vZGVJZCA9IG5vZGVJbmRpY2VzW2ldOwogICAgICAgICAgc3ByaW5nRnggPSBNYXRoLm1pbihzcHJpbmdGb3JjZSwgTWF0aC5tYXgoLXNwcmluZ0ZvcmNlLCBmb3JjZXNbbm9kZUlkXS5zcHJpbmdGeCkpOwogICAgICAgICAgc3ByaW5nRnkgPSBNYXRoLm1pbihzcHJpbmdGb3JjZSwgTWF0aC5tYXgoLXNwcmluZ0ZvcmNlLCBmb3JjZXNbbm9kZUlkXS5zcHJpbmdGeSkpOwoKICAgICAgICAgIGZvcmNlc1tub2RlSWRdLnggKz0gc3ByaW5nRng7CiAgICAgICAgICBmb3JjZXNbbm9kZUlkXS55ICs9IHNwcmluZ0Z5OwogICAgICAgIH0KCiAgICAgICAgLy8gcmV0YWluIGVuZXJneSBiYWxhbmNlCiAgICAgICAgdmFyIHRvdGFsRnggPSAwOwogICAgICAgIHZhciB0b3RhbEZ5ID0gMDsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVJbmRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgbm9kZUlkID0gbm9kZUluZGljZXNbaV07CiAgICAgICAgICB0b3RhbEZ4ICs9IGZvcmNlc1tub2RlSWRdLng7CiAgICAgICAgICB0b3RhbEZ5ICs9IGZvcmNlc1tub2RlSWRdLnk7CiAgICAgICAgfQogICAgICAgIHZhciBjb3JyZWN0aW9uRnggPSB0b3RhbEZ4IC8gbm9kZUluZGljZXMubGVuZ3RoOwogICAgICAgIHZhciBjb3JyZWN0aW9uRnkgPSB0b3RhbEZ5IC8gbm9kZUluZGljZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVJbmRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgbm9kZUlkID0gbm9kZUluZGljZXNbaV07CiAgICAgICAgICBmb3JjZXNbbm9kZUlkXS54IC09IGNvcnJlY3Rpb25GeDsKICAgICAgICAgIGZvcmNlc1tub2RlSWRdLnkgLT0gY29ycmVjdGlvbkZ5OwogICAgICAgIH0KICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBIaWVyYXJjaGljYWxTcHJpbmdTb2x2ZXI7CiAgfSkoKTsKCiAgZXhwb3J0c1siZGVmYXVsdCJdID0gSGllcmFyY2hpY2FsU3ByaW5nU29sdmVyOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1siZGVmYXVsdCJdOwoKLyoqKi8gfSwKLyogOTQgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgogICJ1c2Ugc3RyaWN0IjsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgogIHZhciBDZW50cmFsR3Jhdml0eVNvbHZlciA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBDZW50cmFsR3Jhdml0eVNvbHZlcihib2R5LCBwaHlzaWNzQm9keSwgb3B0aW9ucykgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2VudHJhbEdyYXZpdHlTb2x2ZXIpOwoKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5waHlzaWNzQm9keSA9IHBoeXNpY3NCb2R5OwogICAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKENlbnRyYWxHcmF2aXR5U29sdmVyLCBbewogICAgICBrZXk6ICJzZXRPcHRpb25zIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykgewogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic29sdmUiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gc29sdmUoKSB7CiAgICAgICAgdmFyIGR4ID0gdW5kZWZpbmVkLAogICAgICAgICAgICBkeSA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgZGlzdGFuY2UgPSB1bmRlZmluZWQsCiAgICAgICAgICAgIG5vZGUgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIG5vZGVzID0gdGhpcy5ib2R5Lm5vZGVzOwogICAgICAgIHZhciBub2RlSW5kaWNlcyA9IHRoaXMucGh5c2ljc0JvZHkucGh5c2ljc05vZGVJbmRpY2VzOwogICAgICAgIHZhciBmb3JjZXMgPSB0aGlzLnBoeXNpY3NCb2R5LmZvcmNlczsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlSW5kaWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIG5vZGVJZCA9IG5vZGVJbmRpY2VzW2ldOwogICAgICAgICAgbm9kZSA9IG5vZGVzW25vZGVJZF07CiAgICAgICAgICBkeCA9IC1ub2RlLng7CiAgICAgICAgICBkeSA9IC1ub2RlLnk7CiAgICAgICAgICBkaXN0YW5jZSA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CgogICAgICAgICAgdGhpcy5fY2FsY3VsYXRlRm9yY2VzKGRpc3RhbmNlLCBkeCwgZHksIGZvcmNlcywgbm9kZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9jYWxjdWxhdGVGb3JjZXMiLAoKICAgICAgLyoqCiAgICAgICAqIENhbGN1bGF0ZSB0aGUgZm9yY2VzIGJhc2VkIG9uIHRoZSBkaXN0YW5jZS4KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY2FsY3VsYXRlRm9yY2VzKGRpc3RhbmNlLCBkeCwgZHksIGZvcmNlcywgbm9kZSkgewogICAgICAgIHZhciBncmF2aXR5Rm9yY2UgPSBkaXN0YW5jZSA9PT0gMCA/IDAgOiB0aGlzLm9wdGlvbnMuY2VudHJhbEdyYXZpdHkgLyBkaXN0YW5jZTsKICAgICAgICBmb3JjZXNbbm9kZS5pZF0ueCA9IGR4ICogZ3Jhdml0eUZvcmNlOwogICAgICAgIGZvcmNlc1tub2RlLmlkXS55ID0gZHkgKiBncmF2aXR5Rm9yY2U7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gQ2VudHJhbEdyYXZpdHlTb2x2ZXI7CiAgfSkoKTsKCiAgZXhwb3J0c1siZGVmYXVsdCJdID0gQ2VudHJhbEdyYXZpdHlTb2x2ZXI7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CgovKioqLyB9LAovKiA5NSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgInVzZSBzdHJpY3QiOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICB2YXIgX2dldCA9IGZ1bmN0aW9uIGdldChfeCwgX3gyLCBfeDMpIHsgdmFyIF9hZ2FpbiA9IHRydWU7IF9mdW5jdGlvbjogd2hpbGUgKF9hZ2FpbikgeyB2YXIgb2JqZWN0ID0gX3gsIHByb3BlcnR5ID0gX3gyLCByZWNlaXZlciA9IF94MzsgZGVzYyA9IHBhcmVudCA9IGdldHRlciA9IHVuZGVmaW5lZDsgX2FnYWluID0gZmFsc2U7IHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHByb3BlcnR5KTsgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgeyB2YXIgcGFyZW50ID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iamVjdCk7IGlmIChwYXJlbnQgPT09IG51bGwpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfSBlbHNlIHsgX3ggPSBwYXJlbnQ7IF94MiA9IHByb3BlcnR5OyBfeDMgPSByZWNlaXZlcjsgX2FnYWluID0gdHJ1ZTsgY29udGludWUgX2Z1bmN0aW9uOyB9IH0gZWxzZSBpZiAoInZhbHVlIiBpbiBkZXNjKSB7IHJldHVybiBkZXNjLnZhbHVlOyB9IGVsc2UgeyB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7IGlmIChnZXR0ZXIgPT09IHVuZGVmaW5lZCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IHJldHVybiBnZXR0ZXIuY2FsbChyZWNlaXZlcik7IH0gfSB9OwoKICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAiZGVmYXVsdCI6IG9iaiB9OyB9CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKICBmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiICsgdHlwZW9mIHN1cGVyQ2xhc3MpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9CgogIHZhciBfQmFybmVzSHV0U29sdmVyMiA9IF9fd2VicGFja19yZXF1aXJlX18oODkpOwoKICB2YXIgX0Jhcm5lc0h1dFNvbHZlcjMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9CYXJuZXNIdXRTb2x2ZXIyKTsKCiAgdmFyIEZvcmNlQXRsYXMyQmFzZWRSZXB1bHNpb25Tb2x2ZXIgPSAoZnVuY3Rpb24gKF9CYXJuZXNIdXRTb2x2ZXIpIHsKICAgIGZ1bmN0aW9uIEZvcmNlQXRsYXMyQmFzZWRSZXB1bHNpb25Tb2x2ZXIoYm9keSwgcGh5c2ljc0JvZHksIG9wdGlvbnMpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEZvcmNlQXRsYXMyQmFzZWRSZXB1bHNpb25Tb2x2ZXIpOwoKICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoRm9yY2VBdGxhczJCYXNlZFJlcHVsc2lvblNvbHZlci5wcm90b3R5cGUpLCAiY29uc3RydWN0b3IiLCB0aGlzKS5jYWxsKHRoaXMsIGJvZHksIHBoeXNpY3NCb2R5LCBvcHRpb25zKTsKICAgIH0KCiAgICBfaW5oZXJpdHMoRm9yY2VBdGxhczJCYXNlZFJlcHVsc2lvblNvbHZlciwgX0Jhcm5lc0h1dFNvbHZlcik7CgogICAgX2NyZWF0ZUNsYXNzKEZvcmNlQXRsYXMyQmFzZWRSZXB1bHNpb25Tb2x2ZXIsIFt7CiAgICAgIGtleTogIl9jYWxjdWxhdGVGb3JjZXMiLAoKICAgICAgLyoqCiAgICAgICAqIENhbGN1bGF0ZSB0aGUgZm9yY2VzIGJhc2VkIG9uIHRoZSBkaXN0YW5jZS4KICAgICAgICoKICAgICAgICogQHBhcmFtIGRpc3RhbmNlCiAgICAgICAqIEBwYXJhbSBkeAogICAgICAgKiBAcGFyYW0gZHkKICAgICAgICogQHBhcmFtIG5vZGUKICAgICAgICogQHBhcmFtIHBhcmVudEJyYW5jaAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jYWxjdWxhdGVGb3JjZXMoZGlzdGFuY2UsIGR4LCBkeSwgbm9kZSwgcGFyZW50QnJhbmNoKSB7CiAgICAgICAgaWYgKGRpc3RhbmNlID09PSAwKSB7CiAgICAgICAgICBkaXN0YW5jZSA9IDAuMSAqIE1hdGgucmFuZG9tKCk7CiAgICAgICAgICBkeCA9IGRpc3RhbmNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMub3ZlcmxhcEF2b2lkYW5jZUZhY3RvciA8IDEpIHsKICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5tYXgoMC4xICsgdGhpcy5vdmVybGFwQXZvaWRhbmNlRmFjdG9yICogbm9kZS5zaGFwZS5yYWRpdXMsIGRpc3RhbmNlIC0gbm9kZS5zaGFwZS5yYWRpdXMpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRlZ3JlZSA9IG5vZGUuZWRnZXMubGVuZ3RoICsgMTsKICAgICAgICAvLyB0aGUgZGl2aWRpbmcgYnkgdGhlIGRpc3RhbmNlIGN1YmVkIGluc3RlYWQgb2Ygc3F1YXJlZCBhbGxvd3MgdXMgdG8gZ2V0IHRoZSBmeCBhbmQgZnkgY29tcG9uZW50cyB3aXRob3V0IHNpbmVzIGFuZCBjb3NpbmVzCiAgICAgICAgLy8gaXQgaXMgc2hvcnRoYW5kIGZvciBncmF2aXR5Zm9yY2Ugd2l0aCBkaXN0YW5jZSBzcXVhcmVkIGFuZCBmeCA9IGR4L2Rpc3RhbmNlICogZ3Jhdml0eUZvcmNlCiAgICAgICAgdmFyIGdyYXZpdHlGb3JjZSA9IHRoaXMub3B0aW9ucy5ncmF2aXRhdGlvbmFsQ29uc3RhbnQgKiBwYXJlbnRCcmFuY2gubWFzcyAqIG5vZGUub3B0aW9ucy5tYXNzICogZGVncmVlIC8gTWF0aC5wb3coZGlzdGFuY2UsIDIpOwogICAgICAgIHZhciBmeCA9IGR4ICogZ3Jhdml0eUZvcmNlOwogICAgICAgIHZhciBmeSA9IGR5ICogZ3Jhdml0eUZvcmNlOwoKICAgICAgICB0aGlzLnBoeXNpY3NCb2R5LmZvcmNlc1tub2RlLmlkXS54ICs9IGZ4OwogICAgICAgIHRoaXMucGh5c2ljc0JvZHkuZm9yY2VzW25vZGUuaWRdLnkgKz0gZnk7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gRm9yY2VBdGxhczJCYXNlZFJlcHVsc2lvblNvbHZlcjsKICB9KShfQmFybmVzSHV0U29sdmVyM1siZGVmYXVsdCJdKTsKCiAgZXhwb3J0c1siZGVmYXVsdCJdID0gRm9yY2VBdGxhczJCYXNlZFJlcHVsc2lvblNvbHZlcjsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsKCi8qKiovIH0sCi8qIDk2ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAidXNlIHN0cmljdCI7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIHZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyBfeCA9IHBhcmVudDsgX3gyID0gcHJvcGVydHk7IF94MyA9IHJlY2VpdmVyOyBfYWdhaW4gPSB0cnVlOyBjb250aW51ZSBfZnVuY3Rpb247IH0gfSBlbHNlIGlmICgidmFsdWUiIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICJkZWZhdWx0Ijogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgogIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCiAgdmFyIF9DZW50cmFsR3Jhdml0eVNvbHZlcjIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk0KTsKCiAgdmFyIF9DZW50cmFsR3Jhdml0eVNvbHZlcjMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9DZW50cmFsR3Jhdml0eVNvbHZlcjIpOwoKICB2YXIgRm9yY2VBdGxhczJCYXNlZENlbnRyYWxHcmF2aXR5U29sdmVyID0gKGZ1bmN0aW9uIChfQ2VudHJhbEdyYXZpdHlTb2x2ZXIpIHsKICAgIGZ1bmN0aW9uIEZvcmNlQXRsYXMyQmFzZWRDZW50cmFsR3Jhdml0eVNvbHZlcihib2R5LCBwaHlzaWNzQm9keSwgb3B0aW9ucykgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRm9yY2VBdGxhczJCYXNlZENlbnRyYWxHcmF2aXR5U29sdmVyKTsKCiAgICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKEZvcmNlQXRsYXMyQmFzZWRDZW50cmFsR3Jhdml0eVNvbHZlci5wcm90b3R5cGUpLCAiY29uc3RydWN0b3IiLCB0aGlzKS5jYWxsKHRoaXMsIGJvZHksIHBoeXNpY3NCb2R5LCBvcHRpb25zKTsKICAgIH0KCiAgICBfaW5oZXJpdHMoRm9yY2VBdGxhczJCYXNlZENlbnRyYWxHcmF2aXR5U29sdmVyLCBfQ2VudHJhbEdyYXZpdHlTb2x2ZXIpOwoKICAgIF9jcmVhdGVDbGFzcyhGb3JjZUF0bGFzMkJhc2VkQ2VudHJhbEdyYXZpdHlTb2x2ZXIsIFt7CiAgICAgIGtleTogIl9jYWxjdWxhdGVGb3JjZXMiLAoKICAgICAgLyoqCiAgICAgICAqIENhbGN1bGF0ZSB0aGUgZm9yY2VzIGJhc2VkIG9uIHRoZSBkaXN0YW5jZS4KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY2FsY3VsYXRlRm9yY2VzKGRpc3RhbmNlLCBkeCwgZHksIGZvcmNlcywgbm9kZSkgewogICAgICAgIGlmIChkaXN0YW5jZSA+IDApIHsKICAgICAgICAgIHZhciBkZWdyZWUgPSBub2RlLmVkZ2VzLmxlbmd0aCArIDE7CiAgICAgICAgICB2YXIgZ3Jhdml0eUZvcmNlID0gdGhpcy5vcHRpb25zLmNlbnRyYWxHcmF2aXR5ICogZGVncmVlICogbm9kZS5vcHRpb25zLm1hc3M7CiAgICAgICAgICBmb3JjZXNbbm9kZS5pZF0ueCA9IGR4ICogZ3Jhdml0eUZvcmNlOwogICAgICAgICAgZm9yY2VzW25vZGUuaWRdLnkgPSBkeSAqIGdyYXZpdHlGb3JjZTsKICAgICAgICB9CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gRm9yY2VBdGxhczJCYXNlZENlbnRyYWxHcmF2aXR5U29sdmVyOwogIH0pKF9DZW50cmFsR3Jhdml0eVNvbHZlcjNbImRlZmF1bHQiXSk7CgogIGV4cG9ydHNbImRlZmF1bHQiXSA9IEZvcmNlQXRsYXMyQmFzZWRDZW50cmFsR3Jhdml0eVNvbHZlcjsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsKCi8qKiovIH0sCi8qIDk3ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIHZhciBfY29tcG9uZW50c05vZGVzQ2x1c3RlciA9IF9fd2VicGFja19yZXF1aXJlX18oOTgpOwoKICB2YXIgX2NvbXBvbmVudHNOb2Rlc0NsdXN0ZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY29tcG9uZW50c05vZGVzQ2x1c3Rlcik7CgogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgdmFyIENsdXN0ZXJFbmdpbmUgPSAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQ2x1c3RlckVuZ2luZShib2R5KSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2x1c3RlckVuZ2luZSk7CgogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLmNsdXN0ZXJlZE5vZGVzID0ge307CgogICAgICB0aGlzLm9wdGlvbnMgPSB7fTsKICAgICAgdGhpcy5kZWZhdWx0T3B0aW9ucyA9IHt9OwogICAgICB1dGlsLmV4dGVuZCh0aGlzLm9wdGlvbnMsIHRoaXMuZGVmYXVsdE9wdGlvbnMpOwoKICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ19yZXNldERhdGEnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuY2x1c3RlcmVkTm9kZXMgPSB7fTsKICAgICAgfSk7CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKENsdXN0ZXJFbmdpbmUsIFt7CiAgICAgIGtleTogJ3NldE9wdGlvbnMnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgaWYgKG9wdGlvbnMgIT09IHVuZGVmaW5lZCkge30KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdjbHVzdGVyQnlIdWJzaXplJywKCiAgICAgIC8qKgogICAgICAqCiAgICAgICogQHBhcmFtIGh1YnNpemUKICAgICAgKiBAcGFyYW0gb3B0aW9ucwogICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gY2x1c3RlckJ5SHVic2l6ZShodWJzaXplLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKGh1YnNpemUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaHVic2l6ZSA9IHRoaXMuX2dldEh1YlNpemUoKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBodWJzaXplID09PSAnb2JqZWN0JykgewogICAgICAgICAgb3B0aW9ucyA9IHRoaXMuX2NoZWNrT3B0aW9ucyhodWJzaXplKTsKICAgICAgICAgIGh1YnNpemUgPSB0aGlzLl9nZXRIdWJTaXplKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbm9kZXNUb0NsdXN0ZXIgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuYm9keS5ub2RlSW5kaWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIG5vZGUgPSB0aGlzLmJvZHkubm9kZXNbdGhpcy5ib2R5Lm5vZGVJbmRpY2VzW2ldXTsKICAgICAgICAgIGlmIChub2RlLmVkZ2VzLmxlbmd0aCA+PSBodWJzaXplKSB7CiAgICAgICAgICAgIG5vZGVzVG9DbHVzdGVyLnB1c2gobm9kZS5pZCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzVG9DbHVzdGVyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB0aGlzLmNsdXN0ZXJCeUNvbm5lY3Rpb24obm9kZXNUb0NsdXN0ZXJbaV0sIG9wdGlvbnMsIGZhbHNlKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX2RhdGFDaGFuZ2VkJyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnY2x1c3RlcicsCgogICAgICAvKioKICAgICAgKiBsb29wIG92ZXIgYWxsIG5vZGVzLCBjaGVjayBpZiB0aGV5IGFkaGVyZSB0byB0aGUgY29uZGl0aW9uIGFuZCBjbHVzdGVyIGlmIG5lZWRlZC4KICAgICAgKiBAcGFyYW0gb3B0aW9ucwogICAgICAqIEBwYXJhbSByZWZyZXNoRGF0YQogICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gY2x1c3RlcigpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8ge30gOiBhcmd1bWVudHNbMF07CiAgICAgICAgdmFyIHJlZnJlc2hEYXRhID0gYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB0cnVlIDogYXJndW1lbnRzWzFdOwoKICAgICAgICBpZiAob3B0aW9ucy5qb2luQ29uZGl0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGNhbGwgY2x1c3RlckJ5Tm9kZURhdGEgd2l0aG91dCBhIGpvaW5Db25kaXRpb24gZnVuY3Rpb24gaW4gdGhlIG9wdGlvbnMuJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayBpZiB0aGUgb3B0aW9ucyBvYmplY3QgaXMgZmluZSwgYXBwZW5kIGlmIG5lZWRlZAogICAgICAgIG9wdGlvbnMgPSB0aGlzLl9jaGVja09wdGlvbnMob3B0aW9ucyk7CgogICAgICAgIHZhciBjaGlsZE5vZGVzT2JqID0ge307CiAgICAgICAgdmFyIGNoaWxkRWRnZXNPYmogPSB7fTsKCiAgICAgICAgLy8gY29sbGVjdCB0aGUgbm9kZXMgdGhhdCB3aWxsIGJlIGluIHRoZSBjbHVzdGVyCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJvZHkubm9kZUluZGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBub2RlSWQgPSB0aGlzLmJvZHkubm9kZUluZGljZXNbaV07CiAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdOwogICAgICAgICAgdmFyIGNsb25lZE9wdGlvbnMgPSB0aGlzLl9jbG9uZU9wdGlvbnMobm9kZSk7CiAgICAgICAgICBpZiAob3B0aW9ucy5qb2luQ29uZGl0aW9uKGNsb25lZE9wdGlvbnMpID09PSB0cnVlKSB7CiAgICAgICAgICAgIGNoaWxkTm9kZXNPYmpbbm9kZUlkXSA9IHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdOwoKICAgICAgICAgICAgLy8gY29sbGVjdCB0aGUgbm9kZXMgdGhhdCB3aWxsIGJlIGluIHRoZSBjbHVzdGVyCiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBub2RlLmVkZ2VzLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgIHZhciBlZGdlID0gbm9kZS5lZGdlc1tfaV07CiAgICAgICAgICAgICAgY2hpbGRFZGdlc09ialtlZGdlLmlkXSA9IGVkZ2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuX2NsdXN0ZXIoY2hpbGROb2Rlc09iaiwgY2hpbGRFZGdlc09iaiwgb3B0aW9ucywgcmVmcmVzaERhdGEpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2NsdXN0ZXJPdXRsaWVycycsCgogICAgICAvKioKICAgICAgKiBDbHVzdGVyIGFsbCBub2RlcyBpbiB0aGUgbmV0d29yayB0aGF0IGhhdmUgb25seSAxIGVkZ2UKICAgICAgKiBAcGFyYW0gb3B0aW9ucwogICAgICAqIEBwYXJhbSByZWZyZXNoRGF0YQogICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gY2x1c3Rlck91dGxpZXJzKG9wdGlvbnMpIHsKICAgICAgICB2YXIgcmVmcmVzaERhdGEgPSBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IHRydWUgOiBhcmd1bWVudHNbMV07CgogICAgICAgIG9wdGlvbnMgPSB0aGlzLl9jaGVja09wdGlvbnMob3B0aW9ucyk7CiAgICAgICAgdmFyIGNsdXN0ZXJzID0gW107CgogICAgICAgIC8vIGNvbGxlY3QgdGhlIG5vZGVzIHRoYXQgd2lsbCBiZSBpbiB0aGUgY2x1c3RlcgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ib2R5Lm5vZGVJbmRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgY2hpbGROb2Rlc09iaiA9IHt9OwogICAgICAgICAgdmFyIGNoaWxkRWRnZXNPYmogPSB7fTsKICAgICAgICAgIHZhciBub2RlSWQgPSB0aGlzLmJvZHkubm9kZUluZGljZXNbaV07CiAgICAgICAgICB2YXIgdmlzaWJsZUVkZ2VzID0gMDsKICAgICAgICAgIHZhciBlZGdlID0gdW5kZWZpbmVkOwogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXS5lZGdlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzW25vZGVJZF0uZWRnZXNbal0ub3B0aW9ucy5oaWRkZW4gPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgdmlzaWJsZUVkZ2VzKys7CiAgICAgICAgICAgICAgZWRnZSA9IHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdLmVkZ2VzW2pdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHZpc2libGVFZGdlcyA9PT0gMSkgewogICAgICAgICAgICAvLyB0aGlzIGlzIGFuIG91dGxpZXIKICAgICAgICAgICAgdmFyIGNoaWxkTm9kZUlkID0gdGhpcy5fZ2V0Q29ubmVjdGVkSWQoZWRnZSwgbm9kZUlkKTsKICAgICAgICAgICAgaWYgKGNoaWxkTm9kZUlkICE9PSBub2RlSWQpIHsKICAgICAgICAgICAgICBpZiAob3B0aW9ucy5qb2luQ29uZGl0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jaGVja0lmVXNlZChjbHVzdGVycywgbm9kZUlkLCBlZGdlLmlkKSA9PT0gZmFsc2UgJiYgdGhpcy5fY2hlY2tJZlVzZWQoY2x1c3RlcnMsIGNoaWxkTm9kZUlkLCBlZGdlLmlkKSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgY2hpbGRFZGdlc09ialtlZGdlLmlkXSA9IGVkZ2U7CiAgICAgICAgICAgICAgICAgIGNoaWxkTm9kZXNPYmpbbm9kZUlkXSA9IHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdOwogICAgICAgICAgICAgICAgICBjaGlsZE5vZGVzT2JqW2NoaWxkTm9kZUlkXSA9IHRoaXMuYm9keS5ub2Rlc1tjaGlsZE5vZGVJZF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBjbG9uZWRPcHRpb25zID0gdGhpcy5fY2xvbmVPcHRpb25zKHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdKTsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmpvaW5Db25kaXRpb24oY2xvbmVkT3B0aW9ucykgPT09IHRydWUgJiYgdGhpcy5fY2hlY2tJZlVzZWQoY2x1c3RlcnMsIG5vZGVJZCwgZWRnZS5pZCkgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgIGNoaWxkRWRnZXNPYmpbZWRnZS5pZF0gPSBlZGdlOwogICAgICAgICAgICAgICAgICBjaGlsZE5vZGVzT2JqW25vZGVJZF0gPSB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNsb25lZE9wdGlvbnMgPSB0aGlzLl9jbG9uZU9wdGlvbnModGhpcy5ib2R5Lm5vZGVzW2NoaWxkTm9kZUlkXSk7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5qb2luQ29uZGl0aW9uKGNsb25lZE9wdGlvbnMpID09PSB0cnVlICYmIHRoaXMuX2NoZWNrSWZVc2VkKGNsdXN0ZXJzLCBub2RlSWQsIGVkZ2UuaWQpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICBjaGlsZEVkZ2VzT2JqW2VkZ2UuaWRdID0gZWRnZTsKICAgICAgICAgICAgICAgICAgY2hpbGROb2Rlc09ialtjaGlsZE5vZGVJZF0gPSB0aGlzLmJvZHkubm9kZXNbY2hpbGROb2RlSWRdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGNoaWxkTm9kZXNPYmopLmxlbmd0aCA+IDAgJiYgT2JqZWN0LmtleXMoY2hpbGRFZGdlc09iaikubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgY2x1c3RlcnMucHVzaCh7IG5vZGVzOiBjaGlsZE5vZGVzT2JqLCBlZGdlczogY2hpbGRFZGdlc09iaiB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2x1c3RlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHRoaXMuX2NsdXN0ZXIoY2x1c3RlcnNbaV0ubm9kZXMsIGNsdXN0ZXJzW2ldLmVkZ2VzLCBvcHRpb25zLCBmYWxzZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocmVmcmVzaERhdGEgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19kYXRhQ2hhbmdlZCcpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfY2hlY2tJZlVzZWQnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NoZWNrSWZVc2VkKGNsdXN0ZXJzLCBub2RlSWQsIGVkZ2VJZCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2x1c3RlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBjbHVzdGVyID0gY2x1c3RlcnNbaV07CiAgICAgICAgICBpZiAoY2x1c3Rlci5ub2Rlc1tub2RlSWRdICE9PSB1bmRlZmluZWQgfHwgY2x1c3Rlci5lZGdlc1tlZGdlSWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdjbHVzdGVyQnlDb25uZWN0aW9uJywKCiAgICAgIC8qKgogICAgICAqIHN1Y2sgYWxsIGNvbm5lY3RlZCBub2RlcyBvZiBhIG5vZGUgaW50byB0aGUgbm9kZS4KICAgICAgKiBAcGFyYW0gbm9kZUlkCiAgICAgICogQHBhcmFtIG9wdGlvbnMKICAgICAgKiBAcGFyYW0gcmVmcmVzaERhdGEKICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNsdXN0ZXJCeUNvbm5lY3Rpb24obm9kZUlkLCBvcHRpb25zKSB7CiAgICAgICAgdmFyIHJlZnJlc2hEYXRhID0gYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyB0cnVlIDogYXJndW1lbnRzWzJdOwoKICAgICAgICAvLyBraWxsIGNvbmRpdGlvbnMKICAgICAgICBpZiAobm9kZUlkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gbm9kZUlkIHN1cHBsaWVkIHRvIGNsdXN0ZXJCeUNvbm5lY3Rpb24hJyk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXNbbm9kZUlkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBub2RlSWQgZ2l2ZW4gdG8gY2x1c3RlckJ5Q29ubmVjdGlvbiBkb2VzIG5vdCBleGlzdCEnKTsKICAgICAgICB9CgogICAgICAgIHZhciBub2RlID0gdGhpcy5ib2R5Lm5vZGVzW25vZGVJZF07CiAgICAgICAgb3B0aW9ucyA9IHRoaXMuX2NoZWNrT3B0aW9ucyhvcHRpb25zLCBub2RlKTsKICAgICAgICBpZiAob3B0aW9ucy5jbHVzdGVyTm9kZVByb3BlcnRpZXMueCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBvcHRpb25zLmNsdXN0ZXJOb2RlUHJvcGVydGllcy54ID0gbm9kZS54OwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy5jbHVzdGVyTm9kZVByb3BlcnRpZXMueSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBvcHRpb25zLmNsdXN0ZXJOb2RlUHJvcGVydGllcy55ID0gbm9kZS55OwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy5jbHVzdGVyTm9kZVByb3BlcnRpZXMuZml4ZWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgb3B0aW9ucy5jbHVzdGVyTm9kZVByb3BlcnRpZXMuZml4ZWQgPSB7fTsKICAgICAgICAgIG9wdGlvbnMuY2x1c3Rlck5vZGVQcm9wZXJ0aWVzLmZpeGVkLnggPSBub2RlLm9wdGlvbnMuZml4ZWQueDsKICAgICAgICAgIG9wdGlvbnMuY2x1c3Rlck5vZGVQcm9wZXJ0aWVzLmZpeGVkLnkgPSBub2RlLm9wdGlvbnMuZml4ZWQueTsKICAgICAgICB9CgogICAgICAgIHZhciBjaGlsZE5vZGVzT2JqID0ge307CiAgICAgICAgdmFyIGNoaWxkRWRnZXNPYmogPSB7fTsKICAgICAgICB2YXIgcGFyZW50Tm9kZUlkID0gbm9kZS5pZDsKICAgICAgICB2YXIgcGFyZW50Q2xvbmVkT3B0aW9ucyA9IHRoaXMuX2Nsb25lT3B0aW9ucyhub2RlKTsKICAgICAgICBjaGlsZE5vZGVzT2JqW3BhcmVudE5vZGVJZF0gPSBub2RlOwoKICAgICAgICAvLyBjb2xsZWN0IHRoZSBub2RlcyB0aGF0IHdpbGwgYmUgaW4gdGhlIGNsdXN0ZXIKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuZWRnZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBlZGdlID0gbm9kZS5lZGdlc1tpXTsKICAgICAgICAgIHZhciBjaGlsZE5vZGVJZCA9IHRoaXMuX2dldENvbm5lY3RlZElkKGVkZ2UsIHBhcmVudE5vZGVJZCk7CgogICAgICAgICAgaWYgKGNoaWxkTm9kZUlkICE9PSBwYXJlbnROb2RlSWQpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuam9pbkNvbmRpdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgY2hpbGRFZGdlc09ialtlZGdlLmlkXSA9IGVkZ2U7CiAgICAgICAgICAgICAgY2hpbGROb2Rlc09ialtjaGlsZE5vZGVJZF0gPSB0aGlzLmJvZHkubm9kZXNbY2hpbGROb2RlSWRdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIGNsb25lIHRoZSBvcHRpb25zIGFuZCBpbnNlcnQgc29tZSBhZGRpdGlvbmFsIHBhcmFtZXRlcnMgdGhhdCBjb3VsZCBiZSBpbnRlcmVzdGluZy4KICAgICAgICAgICAgICB2YXIgY2hpbGRDbG9uZWRPcHRpb25zID0gdGhpcy5fY2xvbmVPcHRpb25zKHRoaXMuYm9keS5ub2Rlc1tjaGlsZE5vZGVJZF0pOwogICAgICAgICAgICAgIGlmIChvcHRpb25zLmpvaW5Db25kaXRpb24ocGFyZW50Q2xvbmVkT3B0aW9ucywgY2hpbGRDbG9uZWRPcHRpb25zKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgY2hpbGRFZGdlc09ialtlZGdlLmlkXSA9IGVkZ2U7CiAgICAgICAgICAgICAgICBjaGlsZE5vZGVzT2JqW2NoaWxkTm9kZUlkXSA9IHRoaXMuYm9keS5ub2Rlc1tjaGlsZE5vZGVJZF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGlsZEVkZ2VzT2JqW2VkZ2UuaWRdID0gZWRnZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuX2NsdXN0ZXIoY2hpbGROb2Rlc09iaiwgY2hpbGRFZGdlc09iaiwgb3B0aW9ucywgcmVmcmVzaERhdGEpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jbG9uZU9wdGlvbnMnLAoKICAgICAgLyoqCiAgICAgICogVGhpcyByZXR1cm5zIGEgY2xvbmUgb2YgdGhlIG9wdGlvbnMgb3Igb3B0aW9ucyBvZiB0aGUgZWRnZSBvciBub2RlIHRvIGJlIHVzZWQgZm9yIGNvbnN0cnVjdGlvbiBvZiBuZXcgZWRnZXMgb3IgY2hlY2sgZnVuY3Rpb25zIGZvciBuZXcgbm9kZXMuCiAgICAgICogQHBhcmFtIG9iaklkCiAgICAgICogQHBhcmFtIHR5cGUKICAgICAgKiBAcmV0dXJucyB7e319CiAgICAgICogQHByaXZhdGUKICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jbG9uZU9wdGlvbnMoaXRlbSwgdHlwZSkgewogICAgICAgIHZhciBjbG9uZWRPcHRpb25zID0ge307CiAgICAgICAgaWYgKHR5cGUgPT09IHVuZGVmaW5lZCB8fCB0eXBlID09PSAnbm9kZScpIHsKICAgICAgICAgIHV0aWwuZGVlcEV4dGVuZChjbG9uZWRPcHRpb25zLCBpdGVtLm9wdGlvbnMsIHRydWUpOwogICAgICAgICAgY2xvbmVkT3B0aW9ucy54ID0gaXRlbS54OwogICAgICAgICAgY2xvbmVkT3B0aW9ucy55ID0gaXRlbS55OwogICAgICAgICAgY2xvbmVkT3B0aW9ucy5hbW91bnRPZkNvbm5lY3Rpb25zID0gaXRlbS5lZGdlcy5sZW5ndGg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHV0aWwuZGVlcEV4dGVuZChjbG9uZWRPcHRpb25zLCBpdGVtLm9wdGlvbnMsIHRydWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2xvbmVkT3B0aW9uczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfY3JlYXRlQ2x1c3RlckVkZ2VzJywKCiAgICAgIC8qKgogICAgICAqIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyB0aGUgZWRnZXMgdGhhdCB3aWxsIGJlIGF0dGFjaGVkIHRvIHRoZSBjbHVzdGVyLgogICAgICAqCiAgICAgICogQHBhcmFtIGNoaWxkTm9kZXNPYmoKICAgICAgKiBAcGFyYW0gY2hpbGRFZGdlc09iagogICAgICAqIEBwYXJhbSBuZXdFZGdlcwogICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICogQHByaXZhdGUKICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVDbHVzdGVyRWRnZXMoY2hpbGROb2Rlc09iaiwgY2hpbGRFZGdlc09iaiwgbmV3RWRnZXMsIGNsdXN0ZXJOb2RlUHJvcGVydGllcywgY2x1c3RlckVkZ2VQcm9wZXJ0aWVzKSB7CiAgICAgICAgdmFyIGVkZ2UgPSB1bmRlZmluZWQsCiAgICAgICAgICAgIGNoaWxkTm9kZUlkID0gdW5kZWZpbmVkLAogICAgICAgICAgICBjaGlsZE5vZGUgPSB1bmRlZmluZWQsCiAgICAgICAgICAgIHRvSWQgPSB1bmRlZmluZWQsCiAgICAgICAgICAgIGZyb21JZCA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgb3RoZXJOb2RlSWQgPSB1bmRlZmluZWQ7CgogICAgICAgIHZhciBjaGlsZEtleXMgPSBPYmplY3Qua2V5cyhjaGlsZE5vZGVzT2JqKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkS2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgY2hpbGROb2RlSWQgPSBjaGlsZEtleXNbaV07CiAgICAgICAgICBjaGlsZE5vZGUgPSBjaGlsZE5vZGVzT2JqW2NoaWxkTm9kZUlkXTsKCiAgICAgICAgICAvLyBjb25zdHJ1Y3QgbmV3IGVkZ2VzIGZyb20gdGhlIGNsdXN0ZXIgdG8gb3RoZXJzCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNoaWxkTm9kZS5lZGdlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICBlZGdlID0gY2hpbGROb2RlLmVkZ2VzW2pdOwogICAgICAgICAgICBjaGlsZEVkZ2VzT2JqW2VkZ2UuaWRdID0gZWRnZTsKCiAgICAgICAgICAgIC8vIGNoaWxkTm9kZUlkIHBvc2l0aW9uIHdpbGwgYmUgcmVwbGFjZWQgYnkgdGhlIGNsdXN0ZXIuCiAgICAgICAgICAgIGlmIChlZGdlLnRvSWQgPT0gY2hpbGROb2RlSWQpIHsKICAgICAgICAgICAgICAvLyB0aGlzIGlzIGEgZG91YmxlIGVxdWFscyBiZWNhdXNlIGludHMgYW5kIHN0cmluZ3MgY2FuIGJlIGludGVyY2hhbmdlZCBoZXJlLgogICAgICAgICAgICAgIHRvSWQgPSBjbHVzdGVyTm9kZVByb3BlcnRpZXMuaWQ7CiAgICAgICAgICAgICAgZnJvbUlkID0gZWRnZS5mcm9tSWQ7CiAgICAgICAgICAgICAgb3RoZXJOb2RlSWQgPSBmcm9tSWQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdG9JZCA9IGVkZ2UudG9JZDsKICAgICAgICAgICAgICBmcm9tSWQgPSBjbHVzdGVyTm9kZVByb3BlcnRpZXMuaWQ7CiAgICAgICAgICAgICAgb3RoZXJOb2RlSWQgPSB0b0lkOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB0aGUgbm9kZSBjb25uZWN0ZWQgdG8gdGhlIGNsdXN0ZXIgaXMgYWxzbyBpbiB0aGUgY2x1c3RlciB3ZSBkbyBub3QgbmVlZCBhIG5ldyBlZGdlLgogICAgICAgICAgICBpZiAoY2hpbGROb2Rlc09ialtvdGhlck5vZGVJZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHZhciBjbG9uZWRPcHRpb25zID0gdGhpcy5fY2xvbmVPcHRpb25zKGVkZ2UsICdlZGdlJyk7CiAgICAgICAgICAgICAgdXRpbC5kZWVwRXh0ZW5kKGNsb25lZE9wdGlvbnMsIGNsdXN0ZXJFZGdlUHJvcGVydGllcyk7CiAgICAgICAgICAgICAgY2xvbmVkT3B0aW9ucy5mcm9tID0gZnJvbUlkOwogICAgICAgICAgICAgIGNsb25lZE9wdGlvbnMudG8gPSB0b0lkOwogICAgICAgICAgICAgIGNsb25lZE9wdGlvbnMuaWQgPSAnY2x1c3RlckVkZ2U6JyArIHV0aWwucmFuZG9tVVVJRCgpOwogICAgICAgICAgICAgIG5ld0VkZ2VzLnB1c2godGhpcy5ib2R5LmZ1bmN0aW9ucy5jcmVhdGVFZGdlKGNsb25lZE9wdGlvbnMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfY2hlY2tPcHRpb25zJywKCiAgICAgIC8qKgogICAgICAqIFRoaXMgZnVuY3Rpb24gY2hlY2tzIHRoZSBvcHRpb25zIHRoYXQgY2FuIGJlIHN1cHBsaWVkIHRvIHRoZSBkaWZmZXJlbnQgY2x1c3RlciBmdW5jdGlvbnMKICAgICAgKiBmb3IgY2VydGFpbiBmaWVsZHMgYW5kIGluc2VydHMgZGVmYXVsdHMgaWYgbmVlZGVkCiAgICAgICogQHBhcmFtIG9wdGlvbnMKICAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAgKiBAcHJpdmF0ZQogICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NoZWNrT3B0aW9ucygpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8ge30gOiBhcmd1bWVudHNbMF07CgogICAgICAgIGlmIChvcHRpb25zLmNsdXN0ZXJFZGdlUHJvcGVydGllcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBvcHRpb25zLmNsdXN0ZXJFZGdlUHJvcGVydGllcyA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy5jbHVzdGVyTm9kZVByb3BlcnRpZXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgb3B0aW9ucy5jbHVzdGVyTm9kZVByb3BlcnRpZXMgPSB7fTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBvcHRpb25zOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jbHVzdGVyJywKCiAgICAgIC8qKgogICAgICAqCiAgICAgICogQHBhcmFtIHtPYmplY3R9ICAgIGNoaWxkTm9kZXNPYmogICAgICAgICB8IG9iamVjdCB3aXRoIG5vZGUgb2JqZWN0cywgaWQgYXMga2V5cywgc2FtZSBhcyBjaGlsZE5vZGVzIGV4Y2VwdCBpdCBhbHNvIGNvbnRhaW5zIGEgc291cmNlIG5vZGUKICAgICAgKiBAcGFyYW0ge09iamVjdH0gICAgY2hpbGRFZGdlc09iaiAgICAgICAgIHwgb2JqZWN0IHdpdGggZWRnZSBvYmplY3RzLCBpZCBhcyBrZXlzCiAgICAgICogQHBhcmFtIHtBcnJheX0gICAgIG9wdGlvbnMgICAgICAgICAgICAgICB8IG9iamVjdCB3aXRoIHtjbHVzdGVyTm9kZVByb3BlcnRpZXMsIGNsdXN0ZXJFZGdlUHJvcGVydGllcywgcHJvY2Vzc1Byb3BlcnRpZXN9CiAgICAgICogQHBhcmFtIHtCb29sZWFufSAgIHJlZnJlc2hEYXRhIHwgd2hlbiB0cnVlLCBkbyBub3Qgd3JhcCB1cAogICAgICAqIEBwcml2YXRlCiAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY2x1c3RlcihjaGlsZE5vZGVzT2JqLCBjaGlsZEVkZ2VzT2JqLCBvcHRpb25zKSB7CiAgICAgICAgdmFyIHJlZnJlc2hEYXRhID0gYXJndW1lbnRzWzNdID09PSB1bmRlZmluZWQgPyB0cnVlIDogYXJndW1lbnRzWzNdOwoKICAgICAgICAvLyBraWxsIGNvbmRpdGlvbjogbm8gY2hpbGRyZW4gc28gY2FudCBjbHVzdGVyCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKGNoaWxkTm9kZXNPYmopLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNsdXN0ZXJOb2RlUHJvcGVydGllcyA9IHV0aWwuZGVlcEV4dGVuZCh7fSwgb3B0aW9ucy5jbHVzdGVyTm9kZVByb3BlcnRpZXMpOwoKICAgICAgICAvLyBjb25zdHJ1Y3QgdGhlIGNsdXN0ZXJOb2RlUHJvcGVydGllcwogICAgICAgIGlmIChvcHRpb25zLnByb2Nlc3NQcm9wZXJ0aWVzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8vIGdldCB0aGUgY2hpbGROb2RlIG9wdGlvbnMKICAgICAgICAgIHZhciBjaGlsZE5vZGVzT3B0aW9ucyA9IFtdOwogICAgICAgICAgZm9yICh2YXIgbm9kZUlkIGluIGNoaWxkTm9kZXNPYmopIHsKICAgICAgICAgICAgdmFyIGNsb25lZE9wdGlvbnMgPSB0aGlzLl9jbG9uZU9wdGlvbnMoY2hpbGROb2Rlc09ialtub2RlSWRdKTsKICAgICAgICAgICAgY2hpbGROb2Rlc09wdGlvbnMucHVzaChjbG9uZWRPcHRpb25zKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBnZXQgY2x1c3RlcnByb3BlcnRpZXMgYmFzZWQgb24gY2hpbGROb2RlcwogICAgICAgICAgdmFyIGNoaWxkRWRnZXNPcHRpb25zID0gW107CiAgICAgICAgICBmb3IgKHZhciBlZGdlSWQgaW4gY2hpbGRFZGdlc09iaikgewogICAgICAgICAgICB2YXIgY2xvbmVkT3B0aW9ucyA9IHRoaXMuX2Nsb25lT3B0aW9ucyhjaGlsZEVkZ2VzT2JqW2VkZ2VJZF0sICdlZGdlJyk7CiAgICAgICAgICAgIGNoaWxkRWRnZXNPcHRpb25zLnB1c2goY2xvbmVkT3B0aW9ucyk7CiAgICAgICAgICB9CgogICAgICAgICAgY2x1c3Rlck5vZGVQcm9wZXJ0aWVzID0gb3B0aW9ucy5wcm9jZXNzUHJvcGVydGllcyhjbHVzdGVyTm9kZVByb3BlcnRpZXMsIGNoaWxkTm9kZXNPcHRpb25zLCBjaGlsZEVkZ2VzT3B0aW9ucyk7CiAgICAgICAgICBpZiAoIWNsdXN0ZXJOb2RlUHJvcGVydGllcykgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBwcm9jZXNzUHJvcGVydGllcyBmdW5jdGlvbiBkb2VzIG5vdCByZXR1cm4gcHJvcGVydGllcyEnKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIGlmIHdlIGhhdmUgYW4gdW5pcXVlIGlkOwogICAgICAgIGlmIChjbHVzdGVyTm9kZVByb3BlcnRpZXMuaWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgY2x1c3Rlck5vZGVQcm9wZXJ0aWVzLmlkID0gJ2NsdXN0ZXI6JyArIHV0aWwucmFuZG9tVVVJRCgpOwogICAgICAgIH0KICAgICAgICB2YXIgY2x1c3RlcklkID0gY2x1c3Rlck5vZGVQcm9wZXJ0aWVzLmlkOwoKICAgICAgICBpZiAoY2x1c3Rlck5vZGVQcm9wZXJ0aWVzLmxhYmVsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNsdXN0ZXJOb2RlUHJvcGVydGllcy5sYWJlbCA9ICdjbHVzdGVyJzsKICAgICAgICB9CgogICAgICAgIC8vIGdpdmUgdGhlIGNsdXN0ZXJOb2RlIGEgcG9zdGlvbiBpZiBpdCBkb2VzIG5vdCBoYXZlIG9uZS4KICAgICAgICB2YXIgcG9zID0gdW5kZWZpbmVkOwogICAgICAgIGlmIChjbHVzdGVyTm9kZVByb3BlcnRpZXMueCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBwb3MgPSB0aGlzLl9nZXRDbHVzdGVyUG9zaXRpb24oY2hpbGROb2Rlc09iaik7CiAgICAgICAgICBjbHVzdGVyTm9kZVByb3BlcnRpZXMueCA9IHBvcy54OwogICAgICAgIH0KICAgICAgICBpZiAoY2x1c3Rlck5vZGVQcm9wZXJ0aWVzLnkgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKHBvcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHBvcyA9IHRoaXMuX2dldENsdXN0ZXJQb3NpdGlvbihjaGlsZE5vZGVzT2JqKTsKICAgICAgICAgIH0KICAgICAgICAgIGNsdXN0ZXJOb2RlUHJvcGVydGllcy55ID0gcG9zLnk7CiAgICAgICAgfQoKICAgICAgICAvLyBmb3JjZSB0aGUgSUQgdG8gcmVtYWluIHRoZSBzYW1lCiAgICAgICAgY2x1c3Rlck5vZGVQcm9wZXJ0aWVzLmlkID0gY2x1c3RlcklkOwoKICAgICAgICAvLyBjcmVhdGUgdGhlIGNsdXN0ZXJOb2RlCiAgICAgICAgdmFyIGNsdXN0ZXJOb2RlID0gdGhpcy5ib2R5LmZ1bmN0aW9ucy5jcmVhdGVOb2RlKGNsdXN0ZXJOb2RlUHJvcGVydGllcywgX2NvbXBvbmVudHNOb2Rlc0NsdXN0ZXIyWydkZWZhdWx0J10pOwogICAgICAgIGNsdXN0ZXJOb2RlLmlzQ2x1c3RlciA9IHRydWU7CiAgICAgICAgY2x1c3Rlck5vZGUuY29udGFpbmVkTm9kZXMgPSBjaGlsZE5vZGVzT2JqOwogICAgICAgIGNsdXN0ZXJOb2RlLmNvbnRhaW5lZEVkZ2VzID0gY2hpbGRFZGdlc09iajsKICAgICAgICAvLyBjYWNoZSBhIGNvcHkgZnJvbSB0aGUgY2x1c3RlciBlZGdlIHByb3BlcnRpZXMgaWYgd2UgaGF2ZSB0byByZWNvbm5lY3Qgb3RoZXJzIGxhdGVyIG9uCiAgICAgICAgY2x1c3Rlck5vZGUuY2x1c3RlckVkZ2VQcm9wZXJ0aWVzID0gb3B0aW9ucy5jbHVzdGVyRWRnZVByb3BlcnRpZXM7CgogICAgICAgIC8vIGZpbmFsbHkgcHV0IHRoZSBjbHVzdGVyIG5vZGUgaW50byBnbG9iYWwKICAgICAgICB0aGlzLmJvZHkubm9kZXNbY2x1c3Rlck5vZGVQcm9wZXJ0aWVzLmlkXSA9IGNsdXN0ZXJOb2RlOwoKICAgICAgICAvLyBjcmVhdGUgdGhlIG5ldyBlZGdlcyB0aGF0IHdpbGwgY29ubmVjdCB0byB0aGUgY2x1c3RlcgogICAgICAgIHZhciBuZXdFZGdlcyA9IFtdOwogICAgICAgIHRoaXMuX2NyZWF0ZUNsdXN0ZXJFZGdlcyhjaGlsZE5vZGVzT2JqLCBjaGlsZEVkZ2VzT2JqLCBuZXdFZGdlcywgY2x1c3Rlck5vZGVQcm9wZXJ0aWVzLCBvcHRpb25zLmNsdXN0ZXJFZGdlUHJvcGVydGllcyk7CgogICAgICAgIC8vIGRpc2FibGUgdGhlIGNoaWxkRWRnZXMKICAgICAgICBmb3IgKHZhciBlZGdlSWQgaW4gY2hpbGRFZGdlc09iaikgewogICAgICAgICAgaWYgKGNoaWxkRWRnZXNPYmouaGFzT3duUHJvcGVydHkoZWRnZUlkKSkgewogICAgICAgICAgICBpZiAodGhpcy5ib2R5LmVkZ2VzW2VkZ2VJZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHZhciBlZGdlID0gdGhpcy5ib2R5LmVkZ2VzW2VkZ2VJZF07CiAgICAgICAgICAgICAgZWRnZS50b2dnbGVQaHlzaWNzKGZhbHNlKTsKICAgICAgICAgICAgICBlZGdlLm9wdGlvbnMuaGlkZGVuID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gZGlzYWJsZSB0aGUgY2hpbGROb2RlcwogICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiBjaGlsZE5vZGVzT2JqKSB7CiAgICAgICAgICBpZiAoY2hpbGROb2Rlc09iai5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgIHRoaXMuY2x1c3RlcmVkTm9kZXNbbm9kZUlkXSA9IHsgY2x1c3RlcklkOiBjbHVzdGVyTm9kZVByb3BlcnRpZXMuaWQsIG5vZGU6IHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdIH07CiAgICAgICAgICAgIHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdLnRvZ2dsZVBoeXNpY3MoZmFsc2UpOwogICAgICAgICAgICB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXS5vcHRpb25zLmhpZGRlbiA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBwdXNoIG5ldyBlZGdlcyB0byBnbG9iYWwKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5ld0VkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB0aGlzLmJvZHkuZWRnZXNbbmV3RWRnZXNbaV0uaWRdID0gbmV3RWRnZXNbaV07CiAgICAgICAgICB0aGlzLmJvZHkuZWRnZXNbbmV3RWRnZXNbaV0uaWRdLmNvbm5lY3QoKTsKICAgICAgICB9CgogICAgICAgIC8vIHNldCBJRCB0byB1bmRlZmluZWQgc28gbm8gZHVwbGljYXRlcyBhcmlzZQogICAgICAgIGNsdXN0ZXJOb2RlUHJvcGVydGllcy5pZCA9IHVuZGVmaW5lZDsKCiAgICAgICAgLy8gd3JhcCB1cAogICAgICAgIGlmIChyZWZyZXNoRGF0YSA9PT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX2RhdGFDaGFuZ2VkJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2lzQ2x1c3RlcicsCgogICAgICAvKioKICAgICAgKiBDaGVjayBpZiBhIG5vZGUgaXMgYSBjbHVzdGVyLgogICAgICAqIEBwYXJhbSBub2RlSWQKICAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGlzQ2x1c3Rlcihub2RlSWQpIHsKICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzW25vZGVJZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdLmlzQ2x1c3RlciA9PT0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coJ05vZGUgZG9lcyBub3QgZXhpc3QuJyk7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19nZXRDbHVzdGVyUG9zaXRpb24nLAoKICAgICAgLyoqCiAgICAgICogZ2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgY2x1c3RlciBub2RlIGJhc2VkIG9uIHdoYXQncyBpbnNpZGUKICAgICAgKiBAcGFyYW0ge29iamVjdH0gY2hpbGROb2Rlc09iaiAgICB8IG9iamVjdCB3aXRoIG5vZGUgb2JqZWN0cywgaWQgYXMga2V5cwogICAgICAqIEByZXR1cm5zIHt7eDogbnVtYmVyLCB5OiBudW1iZXJ9fQogICAgICAqIEBwcml2YXRlCiAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0Q2x1c3RlclBvc2l0aW9uKGNoaWxkTm9kZXNPYmopIHsKICAgICAgICB2YXIgY2hpbGRLZXlzID0gT2JqZWN0LmtleXMoY2hpbGROb2Rlc09iaik7CiAgICAgICAgdmFyIG1pblggPSBjaGlsZE5vZGVzT2JqW2NoaWxkS2V5c1swXV0ueDsKICAgICAgICB2YXIgbWF4WCA9IGNoaWxkTm9kZXNPYmpbY2hpbGRLZXlzWzBdXS54OwogICAgICAgIHZhciBtaW5ZID0gY2hpbGROb2Rlc09ialtjaGlsZEtleXNbMF1dLnk7CiAgICAgICAgdmFyIG1heFkgPSBjaGlsZE5vZGVzT2JqW2NoaWxkS2V5c1swXV0ueTsKICAgICAgICB2YXIgbm9kZSA9IHVuZGVmaW5lZDsKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGNoaWxkS2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgbm9kZSA9IGNoaWxkTm9kZXNPYmpbY2hpbGRLZXlzW2ldXTsKICAgICAgICAgIG1pblggPSBub2RlLnggPCBtaW5YID8gbm9kZS54IDogbWluWDsKICAgICAgICAgIG1heFggPSBub2RlLnggPiBtYXhYID8gbm9kZS54IDogbWF4WDsKICAgICAgICAgIG1pblkgPSBub2RlLnkgPCBtaW5ZID8gbm9kZS55IDogbWluWTsKICAgICAgICAgIG1heFkgPSBub2RlLnkgPiBtYXhZID8gbm9kZS55IDogbWF4WTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHg6IDAuNSAqIChtaW5YICsgbWF4WCksIHk6IDAuNSAqIChtaW5ZICsgbWF4WSkgfTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdvcGVuQ2x1c3RlcicsCgogICAgICAvKioKICAgICAgKiBPcGVuIGEgY2x1c3RlciBieSBjYWxsaW5nIHRoaXMgZnVuY3Rpb24uCiAgICAgICogQHBhcmFtIHtTdHJpbmd9ICBjbHVzdGVyTm9kZUlkIHwgdGhlIElEIG9mIHRoZSBjbHVzdGVyIG5vZGUKICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHJlZnJlc2hEYXRhIHwgd3JhcCB1cCBhZnRlcndhcmRzIGlmIG5vdCB0cnVlCiAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBvcGVuQ2x1c3RlcihjbHVzdGVyTm9kZUlkLCBvcHRpb25zKSB7CiAgICAgICAgdmFyIHJlZnJlc2hEYXRhID0gYXJndW1lbnRzWzJdID09PSB1bmRlZmluZWQgPyB0cnVlIDogYXJndW1lbnRzWzJdOwoKICAgICAgICAvLyBraWxsIGNvbmRpdGlvbnMKICAgICAgICBpZiAoY2x1c3Rlck5vZGVJZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGNsdXN0ZXJOb2RlSWQgc3VwcGxpZWQgdG8gb3BlbkNsdXN0ZXIuJyk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXNbY2x1c3Rlck5vZGVJZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY2x1c3Rlck5vZGVJZCBzdXBwbGllZCB0byBvcGVuQ2x1c3RlciBkb2VzIG5vdCBleGlzdC4nKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuYm9keS5ub2Rlc1tjbHVzdGVyTm9kZUlkXS5jb250YWluZWROb2RlcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnVGhlIG5vZGU6JyArIGNsdXN0ZXJOb2RlSWQgKyAnIGlzIG5vdCBhIGNsdXN0ZXIuJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciBjbHVzdGVyTm9kZSA9IHRoaXMuYm9keS5ub2Rlc1tjbHVzdGVyTm9kZUlkXTsKICAgICAgICB2YXIgY29udGFpbmVkTm9kZXMgPSBjbHVzdGVyTm9kZS5jb250YWluZWROb2RlczsKICAgICAgICB2YXIgY29udGFpbmVkRWRnZXMgPSBjbHVzdGVyTm9kZS5jb250YWluZWRFZGdlczsKCiAgICAgICAgLy8gYWxsb3cgdGhlIHVzZXIgdG8gcG9zaXRpb24gdGhlIG5vZGVzIGFmdGVyIHJlbGVhc2UuCiAgICAgICAgaWYgKG9wdGlvbnMgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLnJlbGVhc2VGdW5jdGlvbiAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBvcHRpb25zLnJlbGVhc2VGdW5jdGlvbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdmFyIHBvc2l0aW9ucyA9IHt9OwogICAgICAgICAgdmFyIGNsdXN0ZXJQb3NpdGlvbiA9IHsgeDogY2x1c3Rlck5vZGUueCwgeTogY2x1c3Rlck5vZGUueSB9OwogICAgICAgICAgZm9yICh2YXIgbm9kZUlkIGluIGNvbnRhaW5lZE5vZGVzKSB7CiAgICAgICAgICAgIGlmIChjb250YWluZWROb2Rlcy5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lZE5vZGUgPSB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXTsKICAgICAgICAgICAgICBwb3NpdGlvbnNbbm9kZUlkXSA9IHsgeDogY29udGFpbmVkTm9kZS54LCB5OiBjb250YWluZWROb2RlLnkgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdmFyIG5ld1Bvc2l0aW9ucyA9IG9wdGlvbnMucmVsZWFzZUZ1bmN0aW9uKGNsdXN0ZXJQb3NpdGlvbiwgcG9zaXRpb25zKTsKCiAgICAgICAgICBmb3IgKHZhciBub2RlSWQgaW4gY29udGFpbmVkTm9kZXMpIHsKICAgICAgICAgICAgaWYgKGNvbnRhaW5lZE5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgICB2YXIgY29udGFpbmVkTm9kZSA9IHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdOwogICAgICAgICAgICAgIGlmIChuZXdQb3NpdGlvbnNbbm9kZUlkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb250YWluZWROb2RlLnggPSBuZXdQb3NpdGlvbnNbbm9kZUlkXS54IHx8IGNsdXN0ZXJOb2RlLng7CiAgICAgICAgICAgICAgICBjb250YWluZWROb2RlLnkgPSBuZXdQb3NpdGlvbnNbbm9kZUlkXS55IHx8IGNsdXN0ZXJOb2RlLnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGNvcHkgdGhlIHBvc2l0aW9uIGZyb20gdGhlIGNsdXN0ZXIKICAgICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiBjb250YWluZWROb2RlcykgewogICAgICAgICAgICBpZiAoY29udGFpbmVkTm9kZXMuaGFzT3duUHJvcGVydHkobm9kZUlkKSkgewogICAgICAgICAgICAgIHZhciBjb250YWluZWROb2RlID0gdGhpcy5ib2R5Lm5vZGVzW25vZGVJZF07CiAgICAgICAgICAgICAgY29udGFpbmVkTm9kZSA9IGNvbnRhaW5lZE5vZGVzW25vZGVJZF07CiAgICAgICAgICAgICAgLy8gaW5oZXJpdCBwb3NpdGlvbgogICAgICAgICAgICAgIGNvbnRhaW5lZE5vZGUueCA9IGNsdXN0ZXJOb2RlLng7CiAgICAgICAgICAgICAgY29udGFpbmVkTm9kZS55ID0gY2x1c3Rlck5vZGUueTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVsZWFzZSBub2RlcwogICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiBjb250YWluZWROb2RlcykgewogICAgICAgICAgaWYgKGNvbnRhaW5lZE5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgdmFyIGNvbnRhaW5lZE5vZGUgPSB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXTsKCiAgICAgICAgICAgIC8vIGluaGVyaXQgc3BlZWQKICAgICAgICAgICAgY29udGFpbmVkTm9kZS52eCA9IGNsdXN0ZXJOb2RlLnZ4OwogICAgICAgICAgICBjb250YWluZWROb2RlLnZ5ID0gY2x1c3Rlck5vZGUudnk7CgogICAgICAgICAgICBjb250YWluZWROb2RlLm9wdGlvbnMuaGlkZGVuID0gZmFsc2U7CiAgICAgICAgICAgIGNvbnRhaW5lZE5vZGUudG9nZ2xlUGh5c2ljcyh0cnVlKTsKCiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNsdXN0ZXJlZE5vZGVzW25vZGVJZF07CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyByZWxlYXNlIGVkZ2VzCiAgICAgICAgZm9yICh2YXIgZWRnZUlkIGluIGNvbnRhaW5lZEVkZ2VzKSB7CiAgICAgICAgICBpZiAoY29udGFpbmVkRWRnZXMuaGFzT3duUHJvcGVydHkoZWRnZUlkKSkgewogICAgICAgICAgICB2YXIgZWRnZSA9IGNvbnRhaW5lZEVkZ2VzW2VkZ2VJZF07CiAgICAgICAgICAgIC8vIGlmIHRoaXMgZWRnZSB3YXMgYSB0ZW1wb3JhcnkgZWRnZSBhbmQgaXQncyBjb25uZWN0ZWQgbm9kZXMgZG8gbm90IGV4aXN0IGFueW1vcmUsIHdlIHJlbW92ZSBpdCBmcm9tIHRoZSBkYXRhCiAgICAgICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXNbZWRnZS5mcm9tSWRdID09PSB1bmRlZmluZWQgfHwgdGhpcy5ib2R5Lm5vZGVzW2VkZ2UudG9JZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIGVkZ2UuZWRnZVR5cGUuY2xlYW51cCgpOwogICAgICAgICAgICAgIC8vIHRoaXMgcmVtb3ZlcyB0aGUgZWRnZSBmcm9tIG5vZGUuZWRnZXMsIHdoaWNoIGlzIHdoeSBlZGdlSWRzIGlzIGZvcm1lZAogICAgICAgICAgICAgIGVkZ2UuZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmJvZHkuZWRnZXNbZWRnZUlkXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBvbmUgb2YgdGhlIG5vZGVzIGNvbm5lY3RlZCB0byB0aGlzIGVkZ2UgaXMgaW4gYSBjbHVzdGVyLiBXZSBnaXZlIHRoZSBlZGdlIHRvIHRoYXQgY2x1c3RlciBzbyBpdCB3aWxsIGJlIHJlbGVhc2VkIHdoZW4gdGhhdCBjbHVzdGVyIGlzIG9wZW5lZC4KICAgICAgICAgICAgICBpZiAodGhpcy5jbHVzdGVyZWROb2Rlc1tlZGdlLmZyb21JZF0gIT09IHVuZGVmaW5lZCB8fCB0aGlzLmNsdXN0ZXJlZE5vZGVzW2VkZ2UudG9JZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdmFyIGZyb21JZCA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICB0b0lkID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgdmFyIGNsdXN0ZXJlZE5vZGUgPSB0aGlzLmNsdXN0ZXJlZE5vZGVzW2VkZ2UuZnJvbUlkXSB8fCB0aGlzLmNsdXN0ZXJlZE5vZGVzW2VkZ2UudG9JZF07CiAgICAgICAgICAgICAgICB2YXIgY2x1c3RlcklkID0gY2x1c3RlcmVkTm9kZS5jbHVzdGVySWQ7CiAgICAgICAgICAgICAgICB2YXIgX2NsdXN0ZXJOb2RlID0gdGhpcy5ib2R5Lm5vZGVzW2NsdXN0ZXJJZF07CiAgICAgICAgICAgICAgICBfY2x1c3Rlck5vZGUuY29udGFpbmVkRWRnZXNbZWRnZUlkXSA9IGVkZ2U7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuY2x1c3RlcmVkTm9kZXNbZWRnZS5mcm9tSWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgZnJvbUlkID0gY2x1c3RlcklkOwogICAgICAgICAgICAgICAgICB0b0lkID0gZWRnZS50b0lkOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgZnJvbUlkID0gZWRnZS5mcm9tSWQ7CiAgICAgICAgICAgICAgICAgIHRvSWQgPSBjbHVzdGVySWQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gaWYgYm90aCBmcm9tIGFuZCB0byBub2RlcyBhcmUgdmlzaWJsZSwgd2UgY3JlYXRlIGEgbmV3IHRlbXBvcmFyeSBlZGdlCiAgICAgICAgICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzW2Zyb21JZF0ub3B0aW9ucy5oaWRkZW4gIT09IHRydWUgJiYgdGhpcy5ib2R5Lm5vZGVzW3RvSWRdLm9wdGlvbnMuaGlkZGVuICE9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIHZhciBjbG9uZWRPcHRpb25zID0gdGhpcy5fY2xvbmVPcHRpb25zKGVkZ2UsICdlZGdlJyk7CiAgICAgICAgICAgICAgICAgIHZhciBpZCA9ICdjbHVzdGVyRWRnZTonICsgdXRpbC5yYW5kb21VVUlEKCk7CiAgICAgICAgICAgICAgICAgIHV0aWwuZGVlcEV4dGVuZChjbG9uZWRPcHRpb25zLCBfY2x1c3Rlck5vZGUuY2x1c3RlckVkZ2VQcm9wZXJ0aWVzKTsKICAgICAgICAgICAgICAgICAgdXRpbC5kZWVwRXh0ZW5kKGNsb25lZE9wdGlvbnMsIHsgZnJvbTogZnJvbUlkLCB0bzogdG9JZCwgaGlkZGVuOiBmYWxzZSwgcGh5c2ljczogdHJ1ZSwgaWQ6IGlkIH0pOwogICAgICAgICAgICAgICAgICB2YXIgbmV3RWRnZSA9IHRoaXMuYm9keS5mdW5jdGlvbnMuY3JlYXRlRWRnZShjbG9uZWRPcHRpb25zKTsKCiAgICAgICAgICAgICAgICAgIHRoaXMuYm9keS5lZGdlc1tpZF0gPSBuZXdFZGdlOwogICAgICAgICAgICAgICAgICB0aGlzLmJvZHkuZWRnZXNbaWRdLmNvbm5lY3QoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWRnZS5vcHRpb25zLmhpZGRlbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgZWRnZS50b2dnbGVQaHlzaWNzKHRydWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZlIGFsbCB0ZW1wb3JhcnkgZWRnZXMKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNsdXN0ZXJOb2RlLmVkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgZWRnZUlkID0gY2x1c3Rlck5vZGUuZWRnZXNbaV0uaWQ7CiAgICAgICAgICB0aGlzLmJvZHkuZWRnZXNbZWRnZUlkXS5lZGdlVHlwZS5jbGVhbnVwKCk7CiAgICAgICAgICAvLyB0aGlzIHJlbW92ZXMgdGhlIGVkZ2UgZnJvbSBub2RlLmVkZ2VzLCB3aGljaCBpcyB3aHkgZWRnZUlkcyBpcyBmb3JtZWQKICAgICAgICAgIHRoaXMuYm9keS5lZGdlc1tlZGdlSWRdLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgIGRlbGV0ZSB0aGlzLmJvZHkuZWRnZXNbZWRnZUlkXTsKICAgICAgICB9CgogICAgICAgIC8vIHJlbW92ZSBjbHVzdGVyTm9kZQogICAgICAgIGRlbGV0ZSB0aGlzLmJvZHkubm9kZXNbY2x1c3Rlck5vZGVJZF07CgogICAgICAgIGlmIChyZWZyZXNoRGF0YSA9PT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX2RhdGFDaGFuZ2VkJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2dldE5vZGVzSW5DbHVzdGVyJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldE5vZGVzSW5DbHVzdGVyKGNsdXN0ZXJJZCkgewogICAgICAgIHZhciBub2Rlc0FycmF5ID0gW107CiAgICAgICAgaWYgKHRoaXMuaXNDbHVzdGVyKGNsdXN0ZXJJZCkgPT09IHRydWUpIHsKICAgICAgICAgIHZhciBjb250YWluZWROb2RlcyA9IHRoaXMuYm9keS5ub2Rlc1tjbHVzdGVySWRdLmNvbnRhaW5lZE5vZGVzOwogICAgICAgICAgZm9yICh2YXIgbm9kZUlkIGluIGNvbnRhaW5lZE5vZGVzKSB7CiAgICAgICAgICAgIGlmIChjb250YWluZWROb2Rlcy5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgICAgbm9kZXNBcnJheS5wdXNoKG5vZGVJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBub2Rlc0FycmF5OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2ZpbmROb2RlJywKCiAgICAgIC8qKgogICAgICAqIEdldCB0aGUgc3RhY2sgY2x1c3RlcklkJ3MgdGhhdCBhIGNlcnRhaW4gbm9kZSByZXNpZGVzIGluLiBjbHVzdGVyIEEgLT4gY2x1c3RlciBCIC0+IGNsdXN0ZXIgQyAtPiBub2RlCiAgICAgICogQHBhcmFtIG5vZGVJZAogICAgICAqIEByZXR1cm5zIHtBcnJheX0KICAgICAgKiBAcHJpdmF0ZQogICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZmluZE5vZGUobm9kZUlkKSB7CiAgICAgICAgdmFyIHN0YWNrID0gW107CiAgICAgICAgdmFyIG1heCA9IDEwMDsKICAgICAgICB2YXIgY291bnRlciA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmNsdXN0ZXJlZE5vZGVzW25vZGVJZF0gIT09IHVuZGVmaW5lZCAmJiBjb3VudGVyIDwgbWF4KSB7CiAgICAgICAgICBzdGFjay5wdXNoKHRoaXMuY2x1c3RlcmVkTm9kZXNbbm9kZUlkXS5ub2RlKTsKICAgICAgICAgIG5vZGVJZCA9IHRoaXMuY2x1c3RlcmVkTm9kZXNbbm9kZUlkXS5jbHVzdGVySWQ7CiAgICAgICAgICBjb3VudGVyKys7CiAgICAgICAgfQogICAgICAgIHN0YWNrLnB1c2godGhpcy5ib2R5Lm5vZGVzW25vZGVJZF0pOwogICAgICAgIHJldHVybiBzdGFjazsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZ2V0Q29ubmVjdGVkSWQnLAoKICAgICAgLyoqCiAgICAgICogR2V0IHRoZSBJZCB0aGUgbm9kZSBpcyBjb25uZWN0ZWQgdG8KICAgICAgKiBAcGFyYW0gZWRnZQogICAgICAqIEBwYXJhbSBub2RlSWQKICAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAgKiBAcHJpdmF0ZQogICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2dldENvbm5lY3RlZElkKGVkZ2UsIG5vZGVJZCkgewogICAgICAgIGlmIChlZGdlLnRvSWQgIT0gbm9kZUlkKSB7CiAgICAgICAgICByZXR1cm4gZWRnZS50b0lkOwogICAgICAgIH0gZWxzZSBpZiAoZWRnZS5mcm9tSWQgIT0gbm9kZUlkKSB7CiAgICAgICAgICByZXR1cm4gZWRnZS5mcm9tSWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBlZGdlLmZyb21JZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2dldEh1YlNpemUnLAoKICAgICAgLyoqCiAgICAgICogV2UgZGV0ZXJtaW5lIGhvdyBtYW55IGNvbm5lY3Rpb25zIGRlbm90ZSBhbiBpbXBvcnRhbnQgaHViLgogICAgICAqIFdlIHRha2UgdGhlIG1lYW4gKyAyKnN0ZCBhcyB0aGUgaW1wb3J0YW50IGh1YiBzaXplLiAoQXNzdW1pbmcgYSBub3JtYWwgZGlzdHJpYnV0aW9uIG9mIGRhdGEsIH4yLjIlKQogICAgICAqCiAgICAgICogQHByaXZhdGUKICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRIdWJTaXplKCkgewogICAgICAgIHZhciBhdmVyYWdlID0gMDsKICAgICAgICB2YXIgYXZlcmFnZVNxdWFyZWQgPSAwOwogICAgICAgIHZhciBodWJDb3VudGVyID0gMDsKICAgICAgICB2YXIgbGFyZ2VzdEh1YiA9IDA7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ib2R5Lm5vZGVJbmRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuYm9keS5ub2Rlc1t0aGlzLmJvZHkubm9kZUluZGljZXNbaV1dOwogICAgICAgICAgaWYgKG5vZGUuZWRnZXMubGVuZ3RoID4gbGFyZ2VzdEh1YikgewogICAgICAgICAgICBsYXJnZXN0SHViID0gbm9kZS5lZGdlcy5sZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgICBhdmVyYWdlICs9IG5vZGUuZWRnZXMubGVuZ3RoOwogICAgICAgICAgYXZlcmFnZVNxdWFyZWQgKz0gTWF0aC5wb3cobm9kZS5lZGdlcy5sZW5ndGgsIDIpOwogICAgICAgICAgaHViQ291bnRlciArPSAxOwogICAgICAgIH0KICAgICAgICBhdmVyYWdlID0gYXZlcmFnZSAvIGh1YkNvdW50ZXI7CiAgICAgICAgYXZlcmFnZVNxdWFyZWQgPSBhdmVyYWdlU3F1YXJlZCAvIGh1YkNvdW50ZXI7CgogICAgICAgIHZhciBsZXRpYW5jZSA9IGF2ZXJhZ2VTcXVhcmVkIC0gTWF0aC5wb3coYXZlcmFnZSwgMik7CiAgICAgICAgdmFyIHN0YW5kYXJkRGV2aWF0aW9uID0gTWF0aC5zcXJ0KGxldGlhbmNlKTsKCiAgICAgICAgdmFyIGh1YlRocmVzaG9sZCA9IE1hdGguZmxvb3IoYXZlcmFnZSArIDIgKiBzdGFuZGFyZERldmlhdGlvbik7CgogICAgICAgIC8vIGFsd2F5cyBoYXZlIGF0IGxlYXN0IG9uZSB0byBjbHVzdGVyCiAgICAgICAgaWYgKGh1YlRocmVzaG9sZCA+IGxhcmdlc3RIdWIpIHsKICAgICAgICAgIGh1YlRocmVzaG9sZCA9IGxhcmdlc3RIdWI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaHViVGhyZXNob2xkOwogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIENsdXN0ZXJFbmdpbmU7CiAgfSkoKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gQ2x1c3RlckVuZ2luZTsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDk4ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfZ2V0ID0gZnVuY3Rpb24gZ2V0KF94LCBfeDIsIF94MykgeyB2YXIgX2FnYWluID0gdHJ1ZTsgX2Z1bmN0aW9uOiB3aGlsZSAoX2FnYWluKSB7IHZhciBvYmplY3QgPSBfeCwgcHJvcGVydHkgPSBfeDIsIHJlY2VpdmVyID0gX3gzOyBkZXNjID0gcGFyZW50ID0gZ2V0dGVyID0gdW5kZWZpbmVkOyBfYWdhaW4gPSBmYWxzZTsgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgcHJvcGVydHkpOyBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7IHZhciBwYXJlbnQgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsgaWYgKHBhcmVudCA9PT0gbnVsbCkgeyByZXR1cm4gdW5kZWZpbmVkOyB9IGVsc2UgeyBfeCA9IHBhcmVudDsgX3gyID0gcHJvcGVydHk7IF94MyA9IHJlY2VpdmVyOyBfYWdhaW4gPSB0cnVlOyBjb250aW51ZSBfZnVuY3Rpb247IH0gfSBlbHNlIGlmICgndmFsdWUnIGluIGRlc2MpIHsgcmV0dXJuIGRlc2MudmFsdWU7IH0gZWxzZSB7IHZhciBnZXR0ZXIgPSBkZXNjLmdldDsgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7IHJldHVybiB1bmRlZmluZWQ7IH0gcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsgfSB9IH07CgogIGZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7ICdkZWZhdWx0Jzogb2JqIH07IH0KCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIGZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICdmdW5jdGlvbicgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICcgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH0KCiAgdmFyIF9Ob2RlMiA9IF9fd2VicGFja19yZXF1aXJlX18oNjIpOwoKICB2YXIgX05vZGUzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfTm9kZTIpOwoKICAvKioKICAgKgogICAqLwoKICB2YXIgQ2x1c3RlciA9IChmdW5jdGlvbiAoX05vZGUpIHsKICAgIGZ1bmN0aW9uIENsdXN0ZXIob3B0aW9ucywgYm9keSwgaW1hZ2VsaXN0LCBncm91cGxpc3QsIGdsb2JhbE9wdGlvbnMpIHsKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENsdXN0ZXIpOwoKICAgICAgX2dldChPYmplY3QuZ2V0UHJvdG90eXBlT2YoQ2x1c3Rlci5wcm90b3R5cGUpLCAnY29uc3RydWN0b3InLCB0aGlzKS5jYWxsKHRoaXMsIG9wdGlvbnMsIGJvZHksIGltYWdlbGlzdCwgZ3JvdXBsaXN0LCBnbG9iYWxPcHRpb25zKTsKCiAgICAgIHRoaXMuaXNDbHVzdGVyID0gdHJ1ZTsKICAgICAgdGhpcy5jb250YWluZWROb2RlcyA9IHt9OwogICAgICB0aGlzLmNvbnRhaW5lZEVkZ2VzID0ge307CiAgICB9CgogICAgX2luaGVyaXRzKENsdXN0ZXIsIF9Ob2RlKTsKCiAgICByZXR1cm4gQ2x1c3RlcjsKICB9KShfTm9kZTNbJ2RlZmF1bHQnXSk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IENsdXN0ZXI7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiA5OSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgd2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lOwogIH0KCiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICB2YXIgQ2FudmFzUmVuZGVyZXIgPSAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQ2FudmFzUmVuZGVyZXIoYm9keSwgY2FudmFzKSB7CiAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDYW52YXNSZW5kZXJlcik7CgogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLmNhbnZhcyA9IGNhbnZhczsKCiAgICAgIHRoaXMucmVkcmF3UmVxdWVzdGVkID0gZmFsc2U7CiAgICAgIHRoaXMucmVuZGVyVGltZXIgPSB1bmRlZmluZWQ7CiAgICAgIHRoaXMucmVxdWlyZXNUaW1lb3V0ID0gdHJ1ZTsKICAgICAgdGhpcy5yZW5kZXJpbmdBY3RpdmUgPSBmYWxzZTsKICAgICAgdGhpcy5yZW5kZXJSZXF1ZXN0cyA9IDA7CiAgICAgIHRoaXMucGl4ZWxSYXRpbyA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy5hbGxvd1JlZHJhd1JlcXVlc3RzID0gdHJ1ZTsKCiAgICAgIHRoaXMuZHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5vcHRpb25zID0ge307CiAgICAgIHRoaXMuZGVmYXVsdE9wdGlvbnMgPSB7CiAgICAgICAgaGlkZUVkZ2VzT25EcmFnOiBmYWxzZSwKICAgICAgICBoaWRlTm9kZXNPbkRyYWc6IGZhbHNlCiAgICAgIH07CiAgICAgIHV0aWwuZXh0ZW5kKHRoaXMub3B0aW9ucywgdGhpcy5kZWZhdWx0T3B0aW9ucyk7CgogICAgICB0aGlzLl9kZXRlcm1pbmVCcm93c2VyTWV0aG9kKCk7CiAgICAgIHRoaXMuYmluZEV2ZW50TGlzdGVuZXJzKCk7CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKENhbnZhc1JlbmRlcmVyLCBbewogICAgICBrZXk6ICdiaW5kRXZlbnRMaXN0ZW5lcnMnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gYmluZEV2ZW50TGlzdGVuZXJzKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdkcmFnU3RhcnQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpcy5kcmFnZ2luZyA9IHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ2RyYWdFbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMuZHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignX3Jlc2l6ZU5vZGVzJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzLl9yZXNpemVOb2RlcygpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdfcmVkcmF3JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKF90aGlzLnJlbmRlcmluZ0FjdGl2ZSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgX3RoaXMuX3JlZHJhdygpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdfYmxvY2tSZWRyYXdSZXF1ZXN0cycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLmFsbG93UmVkcmF3UmVxdWVzdHMgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignX2FsbG93UmVkcmF3UmVxdWVzdHMnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpcy5hbGxvd1JlZHJhd1JlcXVlc3RzID0gdHJ1ZTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignX3JlcXVlc3RSZWRyYXcnLCB0aGlzLl9yZXF1ZXN0UmVkcmF3LmJpbmQodGhpcykpOwogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdfc3RhcnRSZW5kZXJpbmcnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpcy5yZW5kZXJSZXF1ZXN0cyArPSAxOwogICAgICAgICAgX3RoaXMucmVuZGVyaW5nQWN0aXZlID0gdHJ1ZTsKICAgICAgICAgIF90aGlzLl9zdGFydFJlbmRlcmluZygpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdfc3RvcFJlbmRlcmluZycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLnJlbmRlclJlcXVlc3RzIC09IDE7CiAgICAgICAgICBfdGhpcy5yZW5kZXJpbmdBY3RpdmUgPSBfdGhpcy5yZW5kZXJSZXF1ZXN0cyA+IDA7CiAgICAgICAgICBfdGhpcy5yZW5kZXJUaW1lciA9IHVuZGVmaW5lZDsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignZGVzdHJveScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLnJlbmRlclJlcXVlc3RzID0gMDsKICAgICAgICAgIF90aGlzLnJlbmRlcmluZ0FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgaWYgKF90aGlzLnJlcXVpcmVzVGltZW91dCA9PT0gdHJ1ZSkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQoX3RoaXMucmVuZGVyVGltZXIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoX3RoaXMucmVuZGVyVGltZXIpOwogICAgICAgICAgfQogICAgICAgICAgX3RoaXMuYm9keS5lbWl0dGVyLm9mZigpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3NldE9wdGlvbnMnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgaWYgKG9wdGlvbnMgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdmFyIGZpZWxkcyA9IFsnaGlkZUVkZ2VzT25EcmFnJywgJ2hpZGVOb2Rlc09uRHJhZyddOwogICAgICAgICAgdXRpbC5zZWxlY3RpdmVEZWVwRXh0ZW5kKGZpZWxkcywgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3N0YXJ0UmVuZGVyaW5nJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zdGFydFJlbmRlcmluZygpIHsKICAgICAgICBpZiAodGhpcy5yZW5kZXJpbmdBY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgIGlmICh0aGlzLnJlbmRlclRpbWVyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYgKHRoaXMucmVxdWlyZXNUaW1lb3V0ID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgdGhpcy5yZW5kZXJUaW1lciA9IHdpbmRvdy5zZXRUaW1lb3V0KHRoaXMuX3JlbmRlclN0ZXAuYmluZCh0aGlzKSwgdGhpcy5zaW11bGF0aW9uSW50ZXJ2YWwpOyAvLyB3YWl0IHRoaXMucmVuZGVyVGltZVN0ZXAgbWlsbGlzZWNvbmRzIGFuZCBwZXJmb3JtIHRoZSBhbmltYXRpb24gc3RlcCBmdW5jdGlvbgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMucmVuZGVyVGltZXIgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuX3JlbmRlclN0ZXAuYmluZCh0aGlzKSk7IC8vIHdhaXQgdGhpcy5yZW5kZXJUaW1lU3RlcCBtaWxsaXNlY29uZHMgYW5kIHBlcmZvcm0gdGhlIGFuaW1hdGlvbiBzdGVwIGZ1bmN0aW9uCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3JlbmRlclN0ZXAnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlclN0ZXAoKSB7CiAgICAgICAgaWYgKHRoaXMucmVuZGVyaW5nQWN0aXZlID09PSB0cnVlKSB7CiAgICAgICAgICAvLyByZXNldCB0aGUgcmVuZGVyVGltZXIgc28gYSBuZXcgc2NoZWR1bGVkIGFuaW1hdGlvbiBzdGVwIGNhbiBiZSBzZXQKICAgICAgICAgIHRoaXMucmVuZGVyVGltZXIgPSB1bmRlZmluZWQ7CgogICAgICAgICAgaWYgKHRoaXMucmVxdWlyZXNUaW1lb3V0ID09PSB0cnVlKSB7CiAgICAgICAgICAgIC8vIHRoaXMgc2NoZWR1bGVzIGEgbmV3IHNpbXVsYXRpb24gc3RlcAogICAgICAgICAgICB0aGlzLl9zdGFydFJlbmRlcmluZygpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX3JlZHJhdygpOwoKICAgICAgICAgIGlmICh0aGlzLnJlcXVpcmVzVGltZW91dCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgLy8gdGhpcyBzY2hlZHVsZXMgYSBuZXcgc2ltdWxhdGlvbiBzdGVwCiAgICAgICAgICAgIHRoaXMuX3N0YXJ0UmVuZGVyaW5nKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3JlZHJhdycsCgogICAgICAvKioKICAgICAgICogUmVkcmF3IHRoZSBuZXR3b3JrIHdpdGggdGhlIGN1cnJlbnQgZGF0YQogICAgICAgKiBjaGFydCB3aWxsIGJlIHJlc2l6ZWQgdG9vLgogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlZHJhdygpIHsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdzZXRTaXplJyk7CiAgICAgICAgdGhpcy5fcmVkcmF3KCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3JlcXVlc3RSZWRyYXcnLAoKICAgICAgLyoqCiAgICAgICAqIFJlZHJhdyB0aGUgbmV0d29yayB3aXRoIHRoZSBjdXJyZW50IGRhdGEKICAgICAgICogQHBhcmFtIGhpZGRlbiB8IHVzZWQgdG8gZ2V0IHRoZSBmaXJzdCBlc3RpbWF0ZSBvZiB0aGUgbm9kZSBzaXplcy4gb25seSB0aGUgbm9kZXMgYXJlIGRyYXduIGFmdGVyIHdoaWNoIHRoZXkgYXJlIHF1aWNrbHkgZHJhd24gb3Zlci4KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVxdWVzdFJlZHJhdygpIHsKICAgICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgICAgaWYgKHRoaXMucmVkcmF3UmVxdWVzdGVkICE9PSB0cnVlICYmIHRoaXMucmVuZGVyaW5nQWN0aXZlID09PSBmYWxzZSAmJiB0aGlzLmFsbG93UmVkcmF3UmVxdWVzdHMgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMucmVkcmF3UmVxdWVzdGVkID0gdHJ1ZTsKICAgICAgICAgIGlmICh0aGlzLnJlcXVpcmVzVGltZW91dCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLl9yZWRyYXcoZmFsc2UpOwogICAgICAgICAgICB9LCAwKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIF90aGlzMi5fcmVkcmF3KGZhbHNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19yZWRyYXcnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX3JlZHJhdygpIHsKICAgICAgICB2YXIgaGlkZGVuID0gYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IGFyZ3VtZW50c1swXTsKCiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnaW5pdFJlZHJhdycpOwoKICAgICAgICB0aGlzLnJlZHJhd1JlcXVlc3RlZCA9IGZhbHNlOwogICAgICAgIHZhciBjdHggPSB0aGlzLmNhbnZhcy5mcmFtZS5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKCiAgICAgICAgLy8gd2hlbiB0aGUgY29udGFpbmVyIGRpdiB3YXMgaGlkZGVuLCB0aGlzIGZpeGVzIGl0IGJhY2sgdXAhCiAgICAgICAgaWYgKHRoaXMuY2FudmFzLmZyYW1lLmNhbnZhcy53aWR0aCA9PT0gMCB8fCB0aGlzLmNhbnZhcy5mcmFtZS5jYW52YXMuaGVpZ2h0ID09PSAwKSB7CiAgICAgICAgICB0aGlzLmNhbnZhcy5zZXRTaXplKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5waXhlbFJhdGlvID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMucGl4ZWxSYXRpbyA9ICh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxKSAvIChjdHgud2Via2l0QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHgubW96QmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHgubXNCYWNraW5nU3RvcmVQaXhlbFJhdGlvIHx8IGN0eC5vQmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHguYmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCAxKTsKICAgICAgICB9CgogICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0odGhpcy5waXhlbFJhdGlvLCAwLCAwLCB0aGlzLnBpeGVsUmF0aW8sIDAsIDApOwoKICAgICAgICAvLyBjbGVhciB0aGUgY2FudmFzCiAgICAgICAgdmFyIHcgPSB0aGlzLmNhbnZhcy5mcmFtZS5jYW52YXMuY2xpZW50V2lkdGg7CiAgICAgICAgdmFyIGggPSB0aGlzLmNhbnZhcy5mcmFtZS5jYW52YXMuY2xpZW50SGVpZ2h0OwogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgdywgaCk7CgogICAgICAgIC8vIHNldCBzY2FsaW5nIGFuZCB0cmFuc2xhdGlvbgogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4LnRyYW5zbGF0ZSh0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbi54LCB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbi55KTsKICAgICAgICBjdHguc2NhbGUodGhpcy5ib2R5LnZpZXcuc2NhbGUsIHRoaXMuYm9keS52aWV3LnNjYWxlKTsKCiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ2JlZm9yZURyYXdpbmcnLCBjdHgpOwogICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKCiAgICAgICAgaWYgKGhpZGRlbiA9PT0gZmFsc2UpIHsKICAgICAgICAgIGlmICh0aGlzLmRyYWdnaW5nID09PSBmYWxzZSB8fCB0aGlzLmRyYWdnaW5nID09PSB0cnVlICYmIHRoaXMub3B0aW9ucy5oaWRlRWRnZXNPbkRyYWcgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHRoaXMuX2RyYXdFZGdlcyhjdHgpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZHJhZ2dpbmcgPT09IGZhbHNlIHx8IHRoaXMuZHJhZ2dpbmcgPT09IHRydWUgJiYgdGhpcy5vcHRpb25zLmhpZGVOb2Rlc09uRHJhZyA9PT0gZmFsc2UpIHsKICAgICAgICAgIHRoaXMuX2RyYXdOb2RlcyhjdHgsIGhpZGRlbik7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5jb250cm9sTm9kZXNBY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuX2RyYXdDb250cm9sTm9kZXMoY3R4KTsKICAgICAgICB9CgogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAvL3RoaXMucGh5c2ljcy5ub2Rlc1NvbHZlci5fZGVidWcoY3R4LCIjRjAwRjBGIik7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnYWZ0ZXJEcmF3aW5nJywgY3R4KTsKICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgLy8gcmVzdG9yZSBvcmlnaW5hbCBzY2FsaW5nIGFuZCB0cmFuc2xhdGlvbgogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIGlmIChoaWRkZW4gPT09IHRydWUpIHsKICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgdywgaCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19yZXNpemVOb2RlcycsCgogICAgICAvKioKICAgICAgICogUmVkcmF3IGFsbCBub2RlcwogICAgICAgKiBUaGUgMmQgY29udGV4dCBvZiBhIEhUTUwgY2FudmFzIGNhbiBiZSByZXRyaWV2ZWQgYnkgY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSAgIGN0eAogICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFthbHdheXNTaG93XQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZXNpemVOb2RlcygpIHsKICAgICAgICB2YXIgY3R4ID0gdGhpcy5jYW52YXMuZnJhbWUuY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgaWYgKHRoaXMucGl4ZWxSYXRpbyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLnBpeGVsUmF0aW8gPSAod2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMSkgLyAoY3R4LndlYmtpdEJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgY3R4Lm1vekJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgY3R4Lm1zQmFja2luZ1N0b3JlUGl4ZWxSYXRpbyB8fCBjdHgub0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgY3R4LmJhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgMSk7CiAgICAgICAgfQogICAgICAgIGN0eC5zZXRUcmFuc2Zvcm0odGhpcy5waXhlbFJhdGlvLCAwLCAwLCB0aGlzLnBpeGVsUmF0aW8sIDAsIDApOwogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4LnRyYW5zbGF0ZSh0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbi54LCB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbi55KTsKICAgICAgICBjdHguc2NhbGUodGhpcy5ib2R5LnZpZXcuc2NhbGUsIHRoaXMuYm9keS52aWV3LnNjYWxlKTsKCiAgICAgICAgdmFyIG5vZGVzID0gdGhpcy5ib2R5Lm5vZGVzOwogICAgICAgIHZhciBub2RlID0gdW5kZWZpbmVkOwoKICAgICAgICAvLyByZXNpemUgYWxsIG5vZGVzCiAgICAgICAgZm9yICh2YXIgbm9kZUlkIGluIG5vZGVzKSB7CiAgICAgICAgICBpZiAobm9kZXMuaGFzT3duUHJvcGVydHkobm9kZUlkKSkgewogICAgICAgICAgICBub2RlID0gbm9kZXNbbm9kZUlkXTsKICAgICAgICAgICAgbm9kZS5yZXNpemUoY3R4KTsKICAgICAgICAgICAgbm9kZS51cGRhdGVCb3VuZGluZ0JveChjdHgpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVzdG9yZSBvcmlnaW5hbCBzY2FsaW5nIGFuZCB0cmFuc2xhdGlvbgogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2RyYXdOb2RlcycsCgogICAgICAvKioKICAgICAgICogUmVkcmF3IGFsbCBub2RlcwogICAgICAgKiBUaGUgMmQgY29udGV4dCBvZiBhIEhUTUwgY2FudmFzIGNhbiBiZSByZXRyaWV2ZWQgYnkgY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSAgIGN0eAogICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFthbHdheXNTaG93XQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kcmF3Tm9kZXMoY3R4KSB7CiAgICAgICAgdmFyIGFsd2F5c1Nob3cgPSBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzFdOwoKICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLmJvZHkubm9kZXM7CiAgICAgICAgdmFyIG5vZGVJbmRpY2VzID0gdGhpcy5ib2R5Lm5vZGVJbmRpY2VzOwogICAgICAgIHZhciBub2RlID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBzZWxlY3RlZCA9IFtdOwogICAgICAgIHZhciBtYXJnaW4gPSAyMDsKICAgICAgICB2YXIgdG9wTGVmdCA9IHRoaXMuY2FudmFzLkRPTXRvQ2FudmFzKHsgeDogLW1hcmdpbiwgeTogLW1hcmdpbiB9KTsKICAgICAgICB2YXIgYm90dG9tUmlnaHQgPSB0aGlzLmNhbnZhcy5ET010b0NhbnZhcyh7CiAgICAgICAgICB4OiB0aGlzLmNhbnZhcy5mcmFtZS5jYW52YXMuY2xpZW50V2lkdGggKyBtYXJnaW4sCiAgICAgICAgICB5OiB0aGlzLmNhbnZhcy5mcmFtZS5jYW52YXMuY2xpZW50SGVpZ2h0ICsgbWFyZ2luCiAgICAgICAgfSk7CiAgICAgICAgdmFyIHZpZXdhYmxlQXJlYSA9IHsgdG9wOiB0b3BMZWZ0LnksIGxlZnQ6IHRvcExlZnQueCwgYm90dG9tOiBib3R0b21SaWdodC55LCByaWdodDogYm90dG9tUmlnaHQueCB9OwoKICAgICAgICAvLyBkcmF3IHVuc2VsZWN0ZWQgbm9kZXM7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlSW5kaWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgbm9kZSA9IG5vZGVzW25vZGVJbmRpY2VzW2ldXTsKICAgICAgICAgIC8vIHNldCBzZWxlY3RlZCBub2RlcyBhc2lkZQogICAgICAgICAgaWYgKG5vZGUuaXNTZWxlY3RlZCgpKSB7CiAgICAgICAgICAgIHNlbGVjdGVkLnB1c2gobm9kZUluZGljZXNbaV0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGFsd2F5c1Nob3cgPT09IHRydWUpIHsKICAgICAgICAgICAgICBub2RlLmRyYXcoY3R4KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLmlzQm91bmRpbmdCb3hPdmVybGFwcGluZ1dpdGgodmlld2FibGVBcmVhKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIG5vZGUuZHJhdyhjdHgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG5vZGUudXBkYXRlQm91bmRpbmdCb3goY3R4KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gZHJhdyB0aGUgc2VsZWN0ZWQgbm9kZXMgb24gdG9wCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxlY3RlZC5sZW5ndGg7IGkrKykgewogICAgICAgICAgbm9kZSA9IG5vZGVzW3NlbGVjdGVkW2ldXTsKICAgICAgICAgIG5vZGUuZHJhdyhjdHgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZHJhd0VkZ2VzJywKCiAgICAgIC8qKgogICAgICAgKiBSZWRyYXcgYWxsIGVkZ2VzCiAgICAgICAqIFRoZSAyZCBjb250ZXh0IG9mIGEgSFRNTCBjYW52YXMgY2FuIGJlIHJldHJpZXZlZCBieSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9ICAgY3R4CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2RyYXdFZGdlcyhjdHgpIHsKICAgICAgICB2YXIgZWRnZXMgPSB0aGlzLmJvZHkuZWRnZXM7CiAgICAgICAgdmFyIGVkZ2VJbmRpY2VzID0gdGhpcy5ib2R5LmVkZ2VJbmRpY2VzOwogICAgICAgIHZhciBlZGdlID0gdW5kZWZpbmVkOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVkZ2VJbmRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBlZGdlID0gZWRnZXNbZWRnZUluZGljZXNbaV1dOwogICAgICAgICAgaWYgKGVkZ2UuY29ubmVjdGVkID09PSB0cnVlKSB7CiAgICAgICAgICAgIGVkZ2UuZHJhdyhjdHgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZHJhd0NvbnRyb2xOb2RlcycsCgogICAgICAvKioKICAgICAgICogUmVkcmF3IGFsbCBlZGdlcwogICAgICAgKiBUaGUgMmQgY29udGV4dCBvZiBhIEhUTUwgY2FudmFzIGNhbiBiZSByZXRyaWV2ZWQgYnkgY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSAgIGN0eAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kcmF3Q29udHJvbE5vZGVzKGN0eCkgewogICAgICAgIHZhciBlZGdlcyA9IHRoaXMuYm9keS5lZGdlczsKICAgICAgICB2YXIgZWRnZUluZGljZXMgPSB0aGlzLmJvZHkuZWRnZUluZGljZXM7CiAgICAgICAgdmFyIGVkZ2UgPSB1bmRlZmluZWQ7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWRnZUluZGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGVkZ2UgPSBlZGdlc1tlZGdlSW5kaWNlc1tpXV07CiAgICAgICAgICBlZGdlLl9kcmF3Q29udHJvbE5vZGVzKGN0eCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19kZXRlcm1pbmVCcm93c2VyTWV0aG9kJywKCiAgICAgIC8qKgogICAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIGJyb3dzZXIgcmVxdWlyZXMgYSBzZXRUaW1lb3V0IG9yIGEgcmVxdWVzdEFuaW1hdGlvbkZyYW1lLiBUaGlzIHdhcyByZXF1aXJlZCBiZWNhdXNlCiAgICAgICAqIHNvbWUgaW1wbGVtZW50YXRpb25zIChzYWZhcmkgYW5kIElFOSkgZGlkIG5vdCBzdXBwb3J0IHJlcXVlc3RBbmltYXRpb25GcmFtZQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kZXRlcm1pbmVCcm93c2VyTWV0aG9kKCkgewogICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgdmFyIGJyb3dzZXJUeXBlID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgdGhpcy5yZXF1aXJlc1RpbWVvdXQgPSBmYWxzZTsKICAgICAgICAgIGlmIChicm93c2VyVHlwZS5pbmRleE9mKCdtc2llIDkuMCcpICE9IC0xKSB7CiAgICAgICAgICAgIC8vIElFIDkKICAgICAgICAgICAgdGhpcy5yZXF1aXJlc1RpbWVvdXQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChicm93c2VyVHlwZS5pbmRleE9mKCdzYWZhcmknKSAhPSAtMSkgewogICAgICAgICAgICAvLyBzYWZhcmkKICAgICAgICAgICAgaWYgKGJyb3dzZXJUeXBlLmluZGV4T2YoJ2Nocm9tZScpIDw9IC0xKSB7CiAgICAgICAgICAgICAgdGhpcy5yZXF1aXJlc1RpbWVvdXQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMucmVxdWlyZXNUaW1lb3V0ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gQ2FudmFzUmVuZGVyZXI7CiAgfSkoKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gQ2FudmFzUmVuZGVyZXI7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiAxMDAgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIHZhciBIYW1tZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKTsKICB2YXIgaGFtbWVyVXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMjgpOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogIC8qKgogICAqIENyZWF0ZSB0aGUgbWFpbiBmcmFtZSBmb3IgdGhlIE5ldHdvcmsuCiAgICogVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCBvbmNlIHdoZW4gYSBOZXR3b3JrIG9iamVjdCBpcyBjcmVhdGVkLiBUaGUgZnJhbWUKICAgKiBjb250YWlucyBhIGNhbnZhcywgYW5kIHRoaXMgY2FudmFzIGNvbnRhaW5zIGFsbCBvYmplY3RzIGxpa2UgdGhlIGF4aXMgYW5kCiAgICogbm9kZXMuCiAgICogQHByaXZhdGUKICAgKi8KCiAgdmFyIENhbnZhcyA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBDYW52YXMoYm9keSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQ2FudmFzKTsKCiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMucGl4ZWxSYXRpbyA9IDE7CiAgICAgIHRoaXMucmVzaXplVGltZXIgPSB1bmRlZmluZWQ7CiAgICAgIHRoaXMucmVzaXplRnVuY3Rpb24gPSB0aGlzLl9vblJlc2l6ZS5iaW5kKHRoaXMpOwoKICAgICAgdGhpcy5vcHRpb25zID0ge307CiAgICAgIHRoaXMuZGVmYXVsdE9wdGlvbnMgPSB7CiAgICAgICAgYXV0b1Jlc2l6ZTogdHJ1ZSwKICAgICAgICBoZWlnaHQ6ICcxMDAlJywKICAgICAgICB3aWR0aDogJzEwMCUnCiAgICAgIH07CiAgICAgIHV0aWwuZXh0ZW5kKHRoaXMub3B0aW9ucywgdGhpcy5kZWZhdWx0T3B0aW9ucyk7CgogICAgICB0aGlzLmJpbmRFdmVudExpc3RlbmVycygpOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhDYW52YXMsIFt7CiAgICAgIGtleTogJ2JpbmRFdmVudExpc3RlbmVycycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBiaW5kRXZlbnRMaXN0ZW5lcnMoKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgLy8gYmluZCB0aGUgZXZlbnRzCiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub25jZSgncmVzaXplJywgZnVuY3Rpb24gKG9iaikgewogICAgICAgICAgaWYgKG9iai53aWR0aCAhPT0gMCkgewogICAgICAgICAgICBfdGhpcy5ib2R5LnZpZXcudHJhbnNsYXRpb24ueCA9IG9iai53aWR0aCAqIDAuNTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvYmouaGVpZ2h0ICE9PSAwKSB7CiAgICAgICAgICAgIF90aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbi55ID0gb2JqLmhlaWdodCAqIDAuNTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignc2V0U2l6ZScsIHRoaXMuc2V0U2l6ZS5iaW5kKHRoaXMpKTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignZGVzdHJveScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLmhhbW1lckZyYW1lLmRlc3Ryb3koKTsKICAgICAgICAgIF90aGlzLmhhbW1lci5kZXN0cm95KCk7CiAgICAgICAgICBfdGhpcy5fY2xlYW5VcCgpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3NldE9wdGlvbnMnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zKSB7CiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgIGlmIChvcHRpb25zICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBmaWVsZHMgPSBbJ3dpZHRoJywgJ2hlaWdodCcsICdhdXRvUmVzaXplJ107CiAgICAgICAgICB1dGlsLnNlbGVjdGl2ZURlZXBFeHRlbmQoZmllbGRzLCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdXRvUmVzaXplID09PSB0cnVlKSB7CiAgICAgICAgICAvLyBhdXRvbWF0aWNhbGx5IGFkYXB0IHRvIGEgY2hhbmdpbmcgc2l6ZSBvZiB0aGUgYnJvd3Nlci4KICAgICAgICAgIHRoaXMuX2NsZWFuVXAoKTsKICAgICAgICAgIHRoaXMucmVzaXplVGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjaGFuZ2VkID0gX3RoaXMyLnNldFNpemUoKTsKICAgICAgICAgICAgaWYgKGNoYW5nZWQgPT09IHRydWUpIHsKICAgICAgICAgICAgICBfdGhpczIuYm9keS5lbWl0dGVyLmVtaXQoJ19yZXF1ZXN0UmVkcmF3Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgdGhpcy5yZXNpemVGdW5jdGlvbiA9IHRoaXMuX29uUmVzaXplLmJpbmQodGhpcyk7CiAgICAgICAgICB1dGlsLmFkZEV2ZW50TGlzdGVuZXIod2luZG93LCAncmVzaXplJywgdGhpcy5yZXNpemVGdW5jdGlvbik7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jbGVhblVwJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jbGVhblVwKCkgewogICAgICAgIC8vIGF1dG9tYXRpY2FsbHkgYWRhcHQgdG8gYSBjaGFuZ2luZyBzaXplIG9mIHRoZSBicm93c2VyLgogICAgICAgIGlmICh0aGlzLnJlc2l6ZVRpbWVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5yZXNpemVUaW1lcik7CiAgICAgICAgfQogICAgICAgIHV0aWwucmVtb3ZlRXZlbnRMaXN0ZW5lcih3aW5kb3csICdyZXNpemUnLCB0aGlzLnJlc2l6ZUZ1bmN0aW9uKTsKICAgICAgICB0aGlzLnJlc2l6ZUZ1bmN0aW9uID0gdW5kZWZpbmVkOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19vblJlc2l6ZScsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfb25SZXNpemUoKSB7CiAgICAgICAgdGhpcy5zZXRTaXplKCk7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3JlZHJhdycpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19wcmVwYXJlVmFsdWUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX3ByZXBhcmVWYWx1ZSh2YWx1ZSkgewogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7CiAgICAgICAgICByZXR1cm4gdmFsdWUgKyAncHgnOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgewogICAgICAgICAgaWYgKHZhbHVlLmluZGV4T2YoJyUnKSAhPT0gLTEgfHwgdmFsdWUuaW5kZXhPZigncHgnKSAhPT0gLTEpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5pbmRleE9mKCclJykgPT09IC0xKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSArICdweCc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGQgbm90IHVzZSB0aGUgdmFsdWUgc3VwcGxpZSBmb3Igd2lkdGggb3IgaGVpZ2h0OicgKyB2YWx1ZSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2NyZWF0ZScsCgogICAgICAvKioKICAgICAgICogQ3JlYXRlIHRoZSBIVE1MCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZSgpIHsKICAgICAgICAvLyByZW1vdmUgYWxsIGVsZW1lbnRzIGZyb20gdGhlIGNvbnRhaW5lciBlbGVtZW50LgogICAgICAgIHdoaWxlICh0aGlzLmJvZHkuY29udGFpbmVyLmhhc0NoaWxkTm9kZXMoKSkgewogICAgICAgICAgdGhpcy5ib2R5LmNvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzLmJvZHkuY29udGFpbmVyLmZpcnN0Q2hpbGQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5mcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHRoaXMuZnJhbWUuY2xhc3NOYW1lID0gJ3Zpcy1uZXR3b3JrJzsKICAgICAgICB0aGlzLmZyYW1lLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsKICAgICAgICB0aGlzLmZyYW1lLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7CiAgICAgICAgdGhpcy5mcmFtZS50YWJJbmRleCA9IDkwMDsgLy8gdGFiIGluZGV4IGlzIHJlcXVpcmVkIGZvciBrZXljaGFybSB0byBiaW5kIGtleXN0cm9rZXMgdG8gdGhlIGRpdiBpbnN0ZWFkIG9mIHRoZSB3aW5kb3cKCiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgIHRoaXMuZnJhbWUuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgdGhpcy5mcmFtZS5jYW52YXMuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnOwogICAgICAgIHRoaXMuZnJhbWUuYXBwZW5kQ2hpbGQodGhpcy5mcmFtZS5jYW52YXMpOwoKICAgICAgICBpZiAoIXRoaXMuZnJhbWUuY2FudmFzLmdldENvbnRleHQpIHsKICAgICAgICAgIHZhciBub0NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0RJVicpOwogICAgICAgICAgbm9DYW52YXMuc3R5bGUuY29sb3IgPSAncmVkJzsKICAgICAgICAgIG5vQ2FudmFzLnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7CiAgICAgICAgICBub0NhbnZhcy5zdHlsZS5wYWRkaW5nID0gJzEwcHgnOwogICAgICAgICAgbm9DYW52YXMuaW5uZXJIVE1MID0gJ0Vycm9yOiB5b3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBIVE1MIGNhbnZhcyc7CiAgICAgICAgICB0aGlzLmZyYW1lLmNhbnZhcy5hcHBlbmRDaGlsZChub0NhbnZhcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBjdHggPSB0aGlzLmZyYW1lLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgdGhpcy5waXhlbFJhdGlvID0gKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDEpIC8gKGN0eC53ZWJraXRCYWNraW5nU3RvcmVQaXhlbFJhdGlvIHx8IGN0eC5tb3pCYWNraW5nU3RvcmVQaXhlbFJhdGlvIHx8IGN0eC5tc0JhY2tpbmdTdG9yZVBpeGVsUmF0aW8gfHwgY3R4Lm9CYWNraW5nU3RvcmVQaXhlbFJhdGlvIHx8IGN0eC5iYWNraW5nU3RvcmVQaXhlbFJhdGlvIHx8IDEpOwoKICAgICAgICAgIHRoaXMuZnJhbWUuY2FudmFzLmdldENvbnRleHQoJzJkJykuc2V0VHJhbnNmb3JtKHRoaXMucGl4ZWxSYXRpbywgMCwgMCwgdGhpcy5waXhlbFJhdGlvLCAwLCAwKTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCB0aGUgZnJhbWUgdG8gdGhlIGNvbnRhaW5lciBlbGVtZW50CiAgICAgICAgdGhpcy5ib2R5LmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmZyYW1lKTsKCiAgICAgICAgdGhpcy5ib2R5LnZpZXcuc2NhbGUgPSAxOwogICAgICAgIHRoaXMuYm9keS52aWV3LnRyYW5zbGF0aW9uID0geyB4OiAwLjUgKiB0aGlzLmZyYW1lLmNhbnZhcy5jbGllbnRXaWR0aCwgeTogMC41ICogdGhpcy5mcmFtZS5jYW52YXMuY2xpZW50SGVpZ2h0IH07CgogICAgICAgIHRoaXMuX2JpbmRIYW1tZXIoKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfYmluZEhhbW1lcicsCgogICAgICAvKioKICAgICAgICogVGhpcyBmdW5jdGlvbiBiaW5kcyBoYW1tZXIsIGl0IGNhbiBiZSByZXBlYXRlZCBvdmVyIGFuZCBvdmVyIGR1ZSB0byB0aGUgdW5pcXVlbmVzcyBjaGVjay4KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfYmluZEhhbW1lcigpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgaWYgKHRoaXMuaGFtbWVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuaGFtbWVyLmRlc3Ryb3koKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5kcmFnID0ge307CiAgICAgICAgdGhpcy5waW5jaCA9IHt9OwoKICAgICAgICAvLyBpbml0IGhhbW1lcgogICAgICAgIHRoaXMuaGFtbWVyID0gbmV3IEhhbW1lcih0aGlzLmZyYW1lLmNhbnZhcyk7CiAgICAgICAgdGhpcy5oYW1tZXIuZ2V0KCdwaW5jaCcpLnNldCh7IGVuYWJsZTogdHJ1ZSB9KTsKICAgICAgICAvLyBlbmFibGUgdG8gZ2V0IGJldHRlciByZXNwb25zZSwgdG9kbzogdGVzdCBvbiBtb2JpbGUuCiAgICAgICAgLy90aGlzLmhhbW1lci5nZXQoJ3BhbicpLnNldCh7dGhyZXNob2xkOjJ9KTsKCiAgICAgICAgaGFtbWVyVXRpbC5vblRvdWNoKHRoaXMuaGFtbWVyLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIF90aGlzMy5ib2R5LmV2ZW50TGlzdGVuZXJzLm9uVG91Y2goZXZlbnQpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuaGFtbWVyLm9uKCd0YXAnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIF90aGlzMy5ib2R5LmV2ZW50TGlzdGVuZXJzLm9uVGFwKGV2ZW50KTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmhhbW1lci5vbignZG91YmxldGFwJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBfdGhpczMuYm9keS5ldmVudExpc3RlbmVycy5vbkRvdWJsZVRhcChldmVudCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5oYW1tZXIub24oJ3ByZXNzJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBfdGhpczMuYm9keS5ldmVudExpc3RlbmVycy5vbkhvbGQoZXZlbnQpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuaGFtbWVyLm9uKCdwYW5zdGFydCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgX3RoaXMzLmJvZHkuZXZlbnRMaXN0ZW5lcnMub25EcmFnU3RhcnQoZXZlbnQpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuaGFtbWVyLm9uKCdwYW5tb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBfdGhpczMuYm9keS5ldmVudExpc3RlbmVycy5vbkRyYWcoZXZlbnQpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuaGFtbWVyLm9uKCdwYW5lbmQnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIF90aGlzMy5ib2R5LmV2ZW50TGlzdGVuZXJzLm9uRHJhZ0VuZChldmVudCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5oYW1tZXIub24oJ3BpbmNoJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBfdGhpczMuYm9keS5ldmVudExpc3RlbmVycy5vblBpbmNoKGV2ZW50KTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gVE9ETzogbmVhdGx5IGNsZWFudXAgdGhlc2UgaGFuZGxlcnMgd2hlbiByZS1jcmVhdGluZyB0aGUgQ2FudmFzLCBJRiB0aGVzZSBhcmUgZG9uZSB3aXRoIGhhbW1lciwgZXZlbnQuc3RvcFByb3BhZ2F0aW9uIHdpbGwgbm90IHdvcms/CiAgICAgICAgdGhpcy5mcmFtZS5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V3aGVlbCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgX3RoaXMzLmJvZHkuZXZlbnRMaXN0ZW5lcnMub25Nb3VzZVdoZWVsKGV2ZW50KTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmZyYW1lLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdET01Nb3VzZVNjcm9sbCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgX3RoaXMzLmJvZHkuZXZlbnRMaXN0ZW5lcnMub25Nb3VzZVdoZWVsKGV2ZW50KTsKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5mcmFtZS5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICBfdGhpczMuYm9keS5ldmVudExpc3RlbmVycy5vbk1vdXNlTW92ZShldmVudCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5mcmFtZS5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgIF90aGlzMy5ib2R5LmV2ZW50TGlzdGVuZXJzLm9uQ29udGV4dChldmVudCk7CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuaGFtbWVyRnJhbWUgPSBuZXcgSGFtbWVyKHRoaXMuZnJhbWUpOwogICAgICAgIGhhbW1lclV0aWwub25SZWxlYXNlKHRoaXMuaGFtbWVyRnJhbWUsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgX3RoaXMzLmJvZHkuZXZlbnRMaXN0ZW5lcnMub25SZWxlYXNlKGV2ZW50KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzZXRTaXplJywKCiAgICAgIC8qKgogICAgICAgKiBTZXQgYSBuZXcgc2l6ZSBmb3IgdGhlIG5ldHdvcmsKICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHdpZHRoICAgV2lkdGggaW4gcGl4ZWxzIG9yIHBlcmNlbnRhZ2UgKGZvciBleGFtcGxlICc4MDBweCcKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgb3IgJzUwJScpCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBoZWlnaHQgIEhlaWdodCBpbiBwaXhlbHMgb3IgcGVyY2VudGFnZSAgKGZvciBleGFtcGxlICc0MDBweCcKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgb3IgJzMwJScpCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0U2l6ZSgpIHsKICAgICAgICB2YXIgd2lkdGggPSBhcmd1bWVudHNbMF0gPT09IHVuZGVmaW5lZCA/IHRoaXMub3B0aW9ucy53aWR0aCA6IGFyZ3VtZW50c1swXTsKICAgICAgICB2YXIgaGVpZ2h0ID0gYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB0aGlzLm9wdGlvbnMuaGVpZ2h0IDogYXJndW1lbnRzWzFdOwoKICAgICAgICB3aWR0aCA9IHRoaXMuX3ByZXBhcmVWYWx1ZSh3aWR0aCk7CiAgICAgICAgaGVpZ2h0ID0gdGhpcy5fcHJlcGFyZVZhbHVlKGhlaWdodCk7CgogICAgICAgIHZhciBlbWl0RXZlbnQgPSBmYWxzZTsKICAgICAgICB2YXIgb2xkV2lkdGggPSB0aGlzLmZyYW1lLmNhbnZhcy53aWR0aDsKICAgICAgICB2YXIgb2xkSGVpZ2h0ID0gdGhpcy5mcmFtZS5jYW52YXMuaGVpZ2h0OwoKICAgICAgICBpZiAod2lkdGggIT0gdGhpcy5vcHRpb25zLndpZHRoIHx8IGhlaWdodCAhPSB0aGlzLm9wdGlvbnMuaGVpZ2h0IHx8IHRoaXMuZnJhbWUuc3R5bGUud2lkdGggIT0gd2lkdGggfHwgdGhpcy5mcmFtZS5zdHlsZS5oZWlnaHQgIT0gaGVpZ2h0KSB7CiAgICAgICAgICB0aGlzLmZyYW1lLnN0eWxlLndpZHRoID0gd2lkdGg7CiAgICAgICAgICB0aGlzLmZyYW1lLnN0eWxlLmhlaWdodCA9IGhlaWdodDsKCiAgICAgICAgICB0aGlzLmZyYW1lLmNhbnZhcy5zdHlsZS53aWR0aCA9ICcxMDAlJzsKICAgICAgICAgIHRoaXMuZnJhbWUuY2FudmFzLnN0eWxlLmhlaWdodCA9ICcxMDAlJzsKCiAgICAgICAgICB0aGlzLmZyYW1lLmNhbnZhcy53aWR0aCA9IE1hdGgucm91bmQodGhpcy5mcmFtZS5jYW52YXMuY2xpZW50V2lkdGggKiB0aGlzLnBpeGVsUmF0aW8pOwogICAgICAgICAgdGhpcy5mcmFtZS5jYW52YXMuaGVpZ2h0ID0gTWF0aC5yb3VuZCh0aGlzLmZyYW1lLmNhbnZhcy5jbGllbnRIZWlnaHQgKiB0aGlzLnBpeGVsUmF0aW8pOwoKICAgICAgICAgIHRoaXMub3B0aW9ucy53aWR0aCA9IHdpZHRoOwogICAgICAgICAgdGhpcy5vcHRpb25zLmhlaWdodCA9IGhlaWdodDsKCiAgICAgICAgICBlbWl0RXZlbnQgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyB0aGlzIHdvdWxkIGFkYXB0IHRoZSB3aWR0aCBvZiB0aGUgY2FudmFzIHRvIHRoZSB3aWR0aCBmcm9tIDEwMCUgaWYgYW5kIG9ubHkgaWYKICAgICAgICAgIC8vIHRoZXJlIGlzIGEgY2hhbmdlLgoKICAgICAgICAgIGlmICh0aGlzLmZyYW1lLmNhbnZhcy53aWR0aCAhPSBNYXRoLnJvdW5kKHRoaXMuZnJhbWUuY2FudmFzLmNsaWVudFdpZHRoICogdGhpcy5waXhlbFJhdGlvKSkgewogICAgICAgICAgICB0aGlzLmZyYW1lLmNhbnZhcy53aWR0aCA9IE1hdGgucm91bmQodGhpcy5mcmFtZS5jYW52YXMuY2xpZW50V2lkdGggKiB0aGlzLnBpeGVsUmF0aW8pOwogICAgICAgICAgICBlbWl0RXZlbnQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuZnJhbWUuY2FudmFzLmhlaWdodCAhPSBNYXRoLnJvdW5kKHRoaXMuZnJhbWUuY2FudmFzLmNsaWVudEhlaWdodCAqIHRoaXMucGl4ZWxSYXRpbykpIHsKICAgICAgICAgICAgdGhpcy5mcmFtZS5jYW52YXMuaGVpZ2h0ID0gTWF0aC5yb3VuZCh0aGlzLmZyYW1lLmNhbnZhcy5jbGllbnRIZWlnaHQgKiB0aGlzLnBpeGVsUmF0aW8pOwogICAgICAgICAgICBlbWl0RXZlbnQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVtaXRFdmVudCA9PT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgncmVzaXplJywgewogICAgICAgICAgICB3aWR0aDogTWF0aC5yb3VuZCh0aGlzLmZyYW1lLmNhbnZhcy53aWR0aCAvIHRoaXMucGl4ZWxSYXRpbyksCiAgICAgICAgICAgIGhlaWdodDogTWF0aC5yb3VuZCh0aGlzLmZyYW1lLmNhbnZhcy5oZWlnaHQgLyB0aGlzLnBpeGVsUmF0aW8pLAogICAgICAgICAgICBvbGRXaWR0aDogTWF0aC5yb3VuZChvbGRXaWR0aCAvIHRoaXMucGl4ZWxSYXRpbyksCiAgICAgICAgICAgIG9sZEhlaWdodDogTWF0aC5yb3VuZChvbGRIZWlnaHQgLyB0aGlzLnBpeGVsUmF0aW8pCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBlbWl0RXZlbnQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX1hjb252ZXJ0RE9NdG9DYW52YXMnLAoKICAgICAgLyoqCiAgICAgICAqIENvbnZlcnQgdGhlIFggY29vcmRpbmF0ZSBpbiBET00tc3BhY2UgKGNvb3JkaW5hdGUgcG9pbnQgaW4gYnJvd3NlciByZWxhdGl2ZSB0byB0aGUgY29udGFpbmVyIGRpdikgdG8KICAgICAgICogdGhlIFggY29vcmRpbmF0ZSBpbiBjYW52YXMtc3BhY2UgKHRoZSBzaW11bGF0aW9uIHNhbmRib3gsIHdoaWNoIHRoZSBjYW1lcmEgbG9va3MgdXBvbikKICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHgKICAgICAgICogQHJldHVybnMge251bWJlcn0KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfWGNvbnZlcnRET010b0NhbnZhcyh4KSB7CiAgICAgICAgcmV0dXJuICh4IC0gdGhpcy5ib2R5LnZpZXcudHJhbnNsYXRpb24ueCkgLyB0aGlzLmJvZHkudmlldy5zY2FsZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfWGNvbnZlcnRDYW52YXNUb0RPTScsCgogICAgICAvKioKICAgICAgICogQ29udmVydCB0aGUgWCBjb29yZGluYXRlIGluIGNhbnZhcy1zcGFjZSAodGhlIHNpbXVsYXRpb24gc2FuZGJveCwgd2hpY2ggdGhlIGNhbWVyYSBsb29rcyB1cG9uKSB0bwogICAgICAgKiB0aGUgWCBjb29yZGluYXRlIGluIERPTS1zcGFjZSAoY29vcmRpbmF0ZSBwb2ludCBpbiBicm93c2VyIHJlbGF0aXZlIHRvIHRoZSBjb250YWluZXIgZGl2KQogICAgICAgKiBAcGFyYW0ge251bWJlcn0geAogICAgICAgKiBAcmV0dXJucyB7bnVtYmVyfQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9YY29udmVydENhbnZhc1RvRE9NKHgpIHsKICAgICAgICByZXR1cm4geCAqIHRoaXMuYm9keS52aWV3LnNjYWxlICsgdGhpcy5ib2R5LnZpZXcudHJhbnNsYXRpb24ueDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfWWNvbnZlcnRET010b0NhbnZhcycsCgogICAgICAvKioKICAgICAgICogQ29udmVydCB0aGUgWSBjb29yZGluYXRlIGluIERPTS1zcGFjZSAoY29vcmRpbmF0ZSBwb2ludCBpbiBicm93c2VyIHJlbGF0aXZlIHRvIHRoZSBjb250YWluZXIgZGl2KSB0bwogICAgICAgKiB0aGUgWSBjb29yZGluYXRlIGluIGNhbnZhcy1zcGFjZSAodGhlIHNpbXVsYXRpb24gc2FuZGJveCwgd2hpY2ggdGhlIGNhbWVyYSBsb29rcyB1cG9uKQogICAgICAgKiBAcGFyYW0ge251bWJlcn0geQogICAgICAgKiBAcmV0dXJucyB7bnVtYmVyfQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9ZY29udmVydERPTXRvQ2FudmFzKHkpIHsKICAgICAgICByZXR1cm4gKHkgLSB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbi55KSAvIHRoaXMuYm9keS52aWV3LnNjYWxlOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19ZY29udmVydENhbnZhc1RvRE9NJywKCiAgICAgIC8qKgogICAgICAgKiBDb252ZXJ0IHRoZSBZIGNvb3JkaW5hdGUgaW4gY2FudmFzLXNwYWNlICh0aGUgc2ltdWxhdGlvbiBzYW5kYm94LCB3aGljaCB0aGUgY2FtZXJhIGxvb2tzIHVwb24pIHRvCiAgICAgICAqIHRoZSBZIGNvb3JkaW5hdGUgaW4gRE9NLXNwYWNlIChjb29yZGluYXRlIHBvaW50IGluIGJyb3dzZXIgcmVsYXRpdmUgdG8gdGhlIGNvbnRhaW5lciBkaXYpCiAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB5CiAgICAgICAqIEByZXR1cm5zIHtudW1iZXJ9CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX1ljb252ZXJ0Q2FudmFzVG9ET00oeSkgewogICAgICAgIHJldHVybiB5ICogdGhpcy5ib2R5LnZpZXcuc2NhbGUgKyB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbi55OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2NhbnZhc1RvRE9NJywKCiAgICAgIC8qKgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge29iamVjdH0gcG9zICAgPSB7eDogbnVtYmVyLCB5OiBudW1iZXJ9CiAgICAgICAqIEByZXR1cm5zIHt7eDogbnVtYmVyLCB5OiBudW1iZXJ9fQogICAgICAgKiBAY29uc3RydWN0b3IKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBjYW52YXNUb0RPTShwb3MpIHsKICAgICAgICByZXR1cm4geyB4OiB0aGlzLl9YY29udmVydENhbnZhc1RvRE9NKHBvcy54KSwgeTogdGhpcy5fWWNvbnZlcnRDYW52YXNUb0RPTShwb3MueSkgfTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdET010b0NhbnZhcycsCgogICAgICAvKioKICAgICAgICoKICAgICAgICogQHBhcmFtIHtvYmplY3R9IHBvcyAgID0ge3g6IG51bWJlciwgeTogbnVtYmVyfQogICAgICAgKiBAcmV0dXJucyB7e3g6IG51bWJlciwgeTogbnVtYmVyfX0KICAgICAgICogQGNvbnN0cnVjdG9yCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gRE9NdG9DYW52YXMocG9zKSB7CiAgICAgICAgcmV0dXJuIHsgeDogdGhpcy5fWGNvbnZlcnRET010b0NhbnZhcyhwb3MueCksIHk6IHRoaXMuX1ljb252ZXJ0RE9NdG9DYW52YXMocG9zLnkpIH07CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gQ2FudmFzOwogIH0pKCk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IENhbnZhczsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDEwMSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgInVzZSBzdHJpY3QiOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwoKICB2YXIgVmlldyA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBWaWV3KGJvZHksIGNhbnZhcykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFZpZXcpOwoKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5jYW52YXMgPSBjYW52YXM7CgogICAgICB0aGlzLmFuaW1hdGlvblNwZWVkID0gMSAvIHRoaXMucmVuZGVyUmVmcmVzaFJhdGU7CiAgICAgIHRoaXMuYW5pbWF0aW9uRWFzaW5nRnVuY3Rpb24gPSAiZWFzZUluT3V0UXVpbnQiOwogICAgICB0aGlzLmVhc2luZ1RpbWUgPSAwOwogICAgICB0aGlzLnNvdXJjZVNjYWxlID0gMDsKICAgICAgdGhpcy50YXJnZXRTY2FsZSA9IDA7CiAgICAgIHRoaXMuc291cmNlVHJhbnNsYXRpb24gPSAwOwogICAgICB0aGlzLnRhcmdldFRyYW5zbGF0aW9uID0gMDsKICAgICAgdGhpcy5sb2NrZWRPbk5vZGVJZCA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy5sb2NrZWRPbk5vZGVPZmZzZXQgPSB1bmRlZmluZWQ7CiAgICAgIHRoaXMudG91Y2hUaW1lID0gMDsKCiAgICAgIHRoaXMudmlld0Z1bmN0aW9uID0gdW5kZWZpbmVkOwoKICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oImZpdCIsIHRoaXMuZml0LmJpbmQodGhpcykpOwogICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbigiYW5pbWF0aW9uRmluaXNoZWQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuYm9keS5lbWl0dGVyLmVtaXQoIl9zdG9wUmVuZGVyaW5nIik7CiAgICAgIH0pOwogICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbigidW5sb2NrTm9kZSIsIHRoaXMucmVsZWFzZU5vZGUuYmluZCh0aGlzKSk7CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKFZpZXcsIFt7CiAgICAgIGtleTogInNldE9wdGlvbnMiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T3B0aW9ucygpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8ge30gOiBhcmd1bWVudHNbMF07CgogICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX2dldFJhbmdlIiwKCiAgICAgIC8qKgogICAgICAgKiBGaW5kIHRoZSBjZW50ZXIgcG9zaXRpb24gb2YgdGhlIG5ldHdvcmsKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0UmFuZ2UoKSB7CiAgICAgICAgdmFyIHNwZWNpZmljTm9kZXMgPSBhcmd1bWVudHNbMF0gPT09IHVuZGVmaW5lZCA/IFtdIDogYXJndW1lbnRzWzBdOwoKICAgICAgICB2YXIgbWluWSA9IDEwMDAwMDAwMDAsCiAgICAgICAgICAgIG1heFkgPSAtMTAwMDAwMDAwMCwKICAgICAgICAgICAgbWluWCA9IDEwMDAwMDAwMDAsCiAgICAgICAgICAgIG1heFggPSAtMTAwMDAwMDAwMCwKICAgICAgICAgICAgbm9kZTsKICAgICAgICBpZiAoc3BlY2lmaWNOb2Rlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNwZWNpZmljTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbm9kZSA9IHRoaXMuYm9keS5ub2Rlc1tzcGVjaWZpY05vZGVzW2ldXTsKICAgICAgICAgICAgaWYgKG1pblggPiBub2RlLnNoYXBlLmJvdW5kaW5nQm94LmxlZnQpIHsKICAgICAgICAgICAgICBtaW5YID0gbm9kZS5zaGFwZS5ib3VuZGluZ0JveC5sZWZ0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtYXhYIDwgbm9kZS5zaGFwZS5ib3VuZGluZ0JveC5yaWdodCkgewogICAgICAgICAgICAgIG1heFggPSBub2RlLnNoYXBlLmJvdW5kaW5nQm94LnJpZ2h0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtaW5ZID4gbm9kZS5zaGFwZS5ib3VuZGluZ0JveC50b3ApIHsKICAgICAgICAgICAgICBtaW5ZID0gbm9kZS5zaGFwZS5ib3VuZGluZ0JveC50b3A7CiAgICAgICAgICAgIH0gLy8gdG9wIGlzIG5lZ2F0aXZlLCBib3R0b20gaXMgcG9zaXRpdmUKICAgICAgICAgICAgaWYgKG1heFkgPCBub2RlLnNoYXBlLmJvdW5kaW5nQm94LmJvdHRvbSkgewogICAgICAgICAgICAgIG1heFkgPSBub2RlLnNoYXBlLmJvdW5kaW5nQm94LmJvdHRvbTsKICAgICAgICAgICAgfSAvLyB0b3AgaXMgbmVnYXRpdmUsIGJvdHRvbSBpcyBwb3NpdGl2ZQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3IgKHZhciBub2RlSWQgaW4gdGhpcy5ib2R5Lm5vZGVzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXMuaGFzT3duUHJvcGVydHkobm9kZUlkKSkgewogICAgICAgICAgICAgIG5vZGUgPSB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXTsKICAgICAgICAgICAgICBpZiAobWluWCA+IG5vZGUuc2hhcGUuYm91bmRpbmdCb3gubGVmdCkgewogICAgICAgICAgICAgICAgbWluWCA9IG5vZGUuc2hhcGUuYm91bmRpbmdCb3gubGVmdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKG1heFggPCBub2RlLnNoYXBlLmJvdW5kaW5nQm94LnJpZ2h0KSB7CiAgICAgICAgICAgICAgICBtYXhYID0gbm9kZS5zaGFwZS5ib3VuZGluZ0JveC5yaWdodDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKG1pblkgPiBub2RlLnNoYXBlLmJvdW5kaW5nQm94LnRvcCkgewogICAgICAgICAgICAgICAgbWluWSA9IG5vZGUuc2hhcGUuYm91bmRpbmdCb3gudG9wOwogICAgICAgICAgICAgIH0gLy8gdG9wIGlzIG5lZ2F0aXZlLCBib3R0b20gaXMgcG9zaXRpdmUKICAgICAgICAgICAgICBpZiAobWF4WSA8IG5vZGUuc2hhcGUuYm91bmRpbmdCb3guYm90dG9tKSB7CiAgICAgICAgICAgICAgICBtYXhZID0gbm9kZS5zaGFwZS5ib3VuZGluZ0JveC5ib3R0b207CiAgICAgICAgICAgICAgfSAvLyB0b3AgaXMgbmVnYXRpdmUsIGJvdHRvbSBpcyBwb3NpdGl2ZQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobWluWCA9PT0gMTAwMDAwMDAwMCAmJiBtYXhYID09PSAtMTAwMDAwMDAwMCAmJiBtaW5ZID09PSAxMDAwMDAwMDAwICYmIG1heFkgPT09IC0xMDAwMDAwMDAwKSB7CiAgICAgICAgICBtaW5ZID0gMCwgbWF4WSA9IDAsIG1pblggPSAwLCBtYXhYID0gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsgbWluWDogbWluWCwgbWF4WDogbWF4WCwgbWluWTogbWluWSwgbWF4WTogbWF4WSB9OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9maW5kQ2VudGVyIiwKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge29iamVjdH0gcmFuZ2UgPSB7bWluWDogbWluWCwgbWF4WDogbWF4WCwgbWluWTogbWluWSwgbWF4WTogbWF4WX07CiAgICAgICAqIEByZXR1cm5zIHt7eDogbnVtYmVyLCB5OiBudW1iZXJ9fQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9maW5kQ2VudGVyKHJhbmdlKSB7CiAgICAgICAgcmV0dXJuIHsgeDogMC41ICogKHJhbmdlLm1heFggKyByYW5nZS5taW5YKSwKICAgICAgICAgIHk6IDAuNSAqIChyYW5nZS5tYXhZICsgcmFuZ2UubWluWSkgfTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJmaXQiLAoKICAgICAgLyoqCiAgICAgICAqIFRoaXMgZnVuY3Rpb24gem9vbXMgb3V0IHRvIGZpdCBhbGwgZGF0YSBvbiBzY3JlZW4gYmFzZWQgb24gYW1vdW50IG9mIG5vZGVzCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBPcHRpb25zCiAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2luaXRpYWxab29tXSAgfCB6b29tIGJhc2VkIG9uIGZpdHRlZCBmb3JtdWxhIG9yIHJhbmdlLCB0cnVlID0gZml0dGVkLCBkZWZhdWx0ID0gZmFsc2U7CiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZml0KCkgewogICAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyB7IG5vZGVzOiBbXSB9IDogYXJndW1lbnRzWzBdOwogICAgICAgIHZhciBpbml0aWFsWm9vbSA9IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBhcmd1bWVudHNbMV07CgogICAgICAgIHZhciByYW5nZTsKICAgICAgICB2YXIgem9vbUxldmVsOwoKICAgICAgICBpZiAoaW5pdGlhbFpvb20gPT09IHRydWUpIHsKICAgICAgICAgIC8vIGNoZWNrIGlmIG1vcmUgdGhhbiBoYWxmIG9mIHRoZSBub2RlcyBoYXZlIGEgcHJlZGVmaW5lZCBwb3NpdGlvbi4gSWYgc28sIHdlIHVzZSB0aGUgcmFuZ2UsIG5vdCB0aGUgYXBwcm94aW1hdGlvbi4KICAgICAgICAgIHZhciBwb3NpdGlvbkRlZmluZWQgPSAwOwogICAgICAgICAgZm9yICh2YXIgbm9kZUlkIGluIHRoaXMuYm9keS5ub2RlcykgewogICAgICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdOwogICAgICAgICAgICAgIGlmIChub2RlLnByZWRlZmluZWRQb3NpdGlvbiA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgcG9zaXRpb25EZWZpbmVkICs9IDE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocG9zaXRpb25EZWZpbmVkID4gMC41ICogdGhpcy5ib2R5Lm5vZGVJbmRpY2VzLmxlbmd0aCkgewogICAgICAgICAgICB0aGlzLmZpdChvcHRpb25zLCBmYWxzZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICByYW5nZSA9IHRoaXMuX2dldFJhbmdlKG9wdGlvbnMubm9kZXMpOwoKICAgICAgICAgIHZhciBudW1iZXJPZk5vZGVzID0gdGhpcy5ib2R5Lm5vZGVJbmRpY2VzLmxlbmd0aDsKICAgICAgICAgIHpvb21MZXZlbCA9IDEyLjY2MiAvIChudW1iZXJPZk5vZGVzICsgNy40MTQ3KSArIDAuMDk2NDgyMjsgLy8gdGhpcyBpcyBvYnRhaW5lZCBmcm9tIGZpdHRpbmcgYSBkYXRhc2V0IGZyb20gNSBwb2ludHMgd2l0aCBzY2FsZSBsZXZlbHMgdGhhdCBsb29rZWQgZ29vZC4KCiAgICAgICAgICAvLyBjb3JyZWN0IGZvciBsYXJnZXIgY2FudmFzc2VzLgogICAgICAgICAgdmFyIGZhY3RvciA9IE1hdGgubWluKHRoaXMuY2FudmFzLmZyYW1lLmNhbnZhcy5jbGllbnRXaWR0aCAvIDYwMCwgdGhpcy5jYW52YXMuZnJhbWUuY2FudmFzLmNsaWVudEhlaWdodCAvIDYwMCk7CiAgICAgICAgICB6b29tTGV2ZWwgKj0gZmFjdG9yOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCJfcmVzaXplTm9kZXMiKTsKICAgICAgICAgIHJhbmdlID0gdGhpcy5fZ2V0UmFuZ2Uob3B0aW9ucy5ub2Rlcyk7CiAgICAgICAgICB2YXIgeERpc3RhbmNlID0gTWF0aC5hYnMocmFuZ2UubWF4WCAtIHJhbmdlLm1pblgpICogMS4xOwogICAgICAgICAgdmFyIHlEaXN0YW5jZSA9IE1hdGguYWJzKHJhbmdlLm1heFkgLSByYW5nZS5taW5ZKSAqIDEuMTsKCiAgICAgICAgICB2YXIgeFpvb21MZXZlbCA9IHRoaXMuY2FudmFzLmZyYW1lLmNhbnZhcy5jbGllbnRXaWR0aCAvIHhEaXN0YW5jZTsKICAgICAgICAgIHZhciB5Wm9vbUxldmVsID0gdGhpcy5jYW52YXMuZnJhbWUuY2FudmFzLmNsaWVudEhlaWdodCAvIHlEaXN0YW5jZTsKCiAgICAgICAgICB6b29tTGV2ZWwgPSB4Wm9vbUxldmVsIDw9IHlab29tTGV2ZWwgPyB4Wm9vbUxldmVsIDogeVpvb21MZXZlbDsKICAgICAgICB9CgogICAgICAgIGlmICh6b29tTGV2ZWwgPiAxKSB7CiAgICAgICAgICB6b29tTGV2ZWwgPSAxOwogICAgICAgIH0gZWxzZSBpZiAoem9vbUxldmVsID09PSAwKSB7CiAgICAgICAgICB6b29tTGV2ZWwgPSAxOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNlbnRlciA9IHRoaXMuX2ZpbmRDZW50ZXIocmFuZ2UpOwogICAgICAgIHZhciBhbmltYXRpb25PcHRpb25zID0geyBwb3NpdGlvbjogY2VudGVyLCBzY2FsZTogem9vbUxldmVsLCBhbmltYXRpb246IG9wdGlvbnMuYW5pbWF0aW9uIH07CiAgICAgICAgdGhpcy5tb3ZlVG8oYW5pbWF0aW9uT3B0aW9ucyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZm9jdXMiLAoKICAgICAgLy8gYW5pbWF0aW9uCgogICAgICAvKioKICAgICAgICogQ2VudGVyIGEgbm9kZSBpbiB2aWV3LgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge051bWJlcn0gbm9kZUlkCiAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9uc10KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBmb2N1cyhub2RlSWQpIHsKICAgICAgICB2YXIgb3B0aW9ucyA9IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8ge30gOiBhcmd1bWVudHNbMV07CgogICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXNbbm9kZUlkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgbm9kZVBvc2l0aW9uID0geyB4OiB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXS54LCB5OiB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXS55IH07CiAgICAgICAgICBvcHRpb25zLnBvc2l0aW9uID0gbm9kZVBvc2l0aW9uOwogICAgICAgICAgb3B0aW9ucy5sb2NrZWRPbk5vZGUgPSBub2RlSWQ7CgogICAgICAgICAgdGhpcy5tb3ZlVG8ob3B0aW9ucyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJOb2RlOiAiICsgbm9kZUlkICsgIiBjYW5ub3QgYmUgZm91bmQuIik7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIm1vdmVUbyIsCgogICAgICAvKioKICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgIHwgIG9wdGlvbnMub2Zmc2V0ICAgPSB7eDpOdW1iZXIsIHk6TnVtYmVyfSAgIC8vIG9mZnNldCBmcm9tIHRoZSBjZW50ZXIgaW4gRE9NIHBpeGVscwogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgb3B0aW9ucy5zY2FsZSAgICA9IE51bWJlciAgICAgICAgICAgICAgICAgLy8gc2NhbGUgdG8gbW92ZSB0bwogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgb3B0aW9ucy5wb3NpdGlvbiA9IHt4Ok51bWJlciwgeTpOdW1iZXJ9ICAgLy8gcG9zaXRpb24gdG8gbW92ZSB0bwogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgb3B0aW9ucy5hbmltYXRpb24gPSB7ZHVyYXRpb246TnVtYmVyLCBlYXNpbmdGdW5jdGlvbjpTdHJpbmd9IHx8IEJvb2xlYW4gICAvLyBwb3NpdGlvbiB0byBtb3ZlIHRvCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gbW92ZVRvKG9wdGlvbnMpIHsKICAgICAgICBpZiAob3B0aW9ucyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLm9mZnNldCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBvcHRpb25zLm9mZnNldCA9IHsgeDogMCwgeTogMCB9OwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy5vZmZzZXQueCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBvcHRpb25zLm9mZnNldC54ID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMub2Zmc2V0LnkgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgb3B0aW9ucy5vZmZzZXQueSA9IDA7CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLnNjYWxlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIG9wdGlvbnMuc2NhbGUgPSB0aGlzLmJvZHkudmlldy5zY2FsZTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgb3B0aW9ucy5wb3NpdGlvbiA9IHRoaXMuZ2V0Vmlld1Bvc2l0aW9uKCk7CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLmFuaW1hdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBvcHRpb25zLmFuaW1hdGlvbiA9IHsgZHVyYXRpb246IDAgfTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMuYW5pbWF0aW9uID09PSBmYWxzZSkgewogICAgICAgICAgb3B0aW9ucy5hbmltYXRpb24gPSB7IGR1cmF0aW9uOiAwIH07CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLmFuaW1hdGlvbiA9PT0gdHJ1ZSkgewogICAgICAgICAgb3B0aW9ucy5hbmltYXRpb24gPSB7fTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMuYW5pbWF0aW9uLmR1cmF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIG9wdGlvbnMuYW5pbWF0aW9uLmR1cmF0aW9uID0gMTAwMDsKICAgICAgICB9IC8vIGRlZmF1bHQgZHVyYXRpb24KICAgICAgICBpZiAob3B0aW9ucy5hbmltYXRpb24uZWFzaW5nRnVuY3Rpb24gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgb3B0aW9ucy5hbmltYXRpb24uZWFzaW5nRnVuY3Rpb24gPSAiZWFzZUluT3V0UXVhZCI7CiAgICAgICAgfSAvLyBkZWZhdWx0IGVhc2luZyBmdW5jdGlvbgoKICAgICAgICB0aGlzLmFuaW1hdGVWaWV3KG9wdGlvbnMpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImFuaW1hdGVWaWV3IiwKCiAgICAgIC8qKgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgfCAgb3B0aW9ucy5vZmZzZXQgICA9IHt4Ok51bWJlciwgeTpOdW1iZXJ9ICAgLy8gb2Zmc2V0IGZyb20gdGhlIGNlbnRlciBpbiBET00gcGl4ZWxzCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICB8ICBvcHRpb25zLnRpbWUgICAgID0gTnVtYmVyICAgICAgICAgICAgICAgICAvLyBhbmltYXRpb24gdGltZSBpbiBtaWxsaXNlY29uZHMKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIHwgIG9wdGlvbnMuc2NhbGUgICAgPSBOdW1iZXIgICAgICAgICAgICAgICAgIC8vIHNjYWxlIHRvIGFuaW1hdGUgdG8KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIHwgIG9wdGlvbnMucG9zaXRpb24gPSB7eDpOdW1iZXIsIHk6TnVtYmVyfSAgIC8vIHBvc2l0aW9uIHRvIGFuaW1hdGUgdG8KICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgIHwgIG9wdGlvbnMuZWFzaW5nRnVuY3Rpb24gPSBTdHJpbmcgICAgICAgICAgIC8vIGxpbmVhciwgZWFzZUluUXVhZCwgZWFzZU91dFF1YWQsIGVhc2VJbk91dFF1YWQsCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlYXNlSW5DdWJpYywgZWFzZU91dEN1YmljLCBlYXNlSW5PdXRDdWJpYywKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVhc2VJblF1YXJ0LCBlYXNlT3V0UXVhcnQsIGVhc2VJbk91dFF1YXJ0LAogICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWFzZUluUXVpbnQsIGVhc2VPdXRRdWludCwgZWFzZUluT3V0UXVpbnQKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBhbmltYXRlVmlldyhvcHRpb25zKSB7CiAgICAgICAgaWYgKG9wdGlvbnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLmFuaW1hdGlvbkVhc2luZ0Z1bmN0aW9uID0gb3B0aW9ucy5hbmltYXRpb24uZWFzaW5nRnVuY3Rpb247CiAgICAgICAgLy8gcmVsZWFzZSBpZiBzb21ldGhpbmcgZm9jdXNzZWQgb24gdGhlIG5vZGUKICAgICAgICB0aGlzLnJlbGVhc2VOb2RlKCk7CiAgICAgICAgaWYgKG9wdGlvbnMubG9ja2VkID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmxvY2tlZE9uTm9kZUlkID0gb3B0aW9ucy5sb2NrZWRPbk5vZGU7CiAgICAgICAgICB0aGlzLmxvY2tlZE9uTm9kZU9mZnNldCA9IG9wdGlvbnMub2Zmc2V0OwogICAgICAgIH0KCiAgICAgICAgLy8gZm9yY2VmdWxseSBjb21wbGV0ZSB0aGUgb2xkIGFuaW1hdGlvbiBpZiBpdCB3YXMgc3RpbGwgcnVubmluZwogICAgICAgIGlmICh0aGlzLmVhc2luZ1RpbWUgIT0gMCkgewogICAgICAgICAgdGhpcy5fdHJhbnNpdGlvblJlZHJhdyh0cnVlKTsgLy8gYnkgc2V0dGluZyBlYXNpbmd0aW1lIHRvIDEsIHdlIGZpbmlzaCB0aGUgYW5pbWF0aW9uLgogICAgICAgIH0KCiAgICAgICAgdGhpcy5zb3VyY2VTY2FsZSA9IHRoaXMuYm9keS52aWV3LnNjYWxlOwogICAgICAgIHRoaXMuc291cmNlVHJhbnNsYXRpb24gPSB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbjsKICAgICAgICB0aGlzLnRhcmdldFNjYWxlID0gb3B0aW9ucy5zY2FsZTsKCiAgICAgICAgLy8gc2V0IHRoZSBzY2FsZSBzbyB0aGUgdmlld0NlbnRlciBpcyBiYXNlZCBvbiB0aGUgY29ycmVjdCB6b29tIGxldmVsLiBUaGlzIGlzIG92ZXJyaWRkZW4gaW4gdGhlIHRyYW5zaXRpb25SZWRyYXcKICAgICAgICAvLyBidXQgYXQgbGVhc3QgdGhlbiB3ZSdsbCBoYXZlIHRoZSB0YXJnZXQgdHJhbnNpdGlvbgogICAgICAgIHRoaXMuYm9keS52aWV3LnNjYWxlID0gdGhpcy50YXJnZXRTY2FsZTsKICAgICAgICB2YXIgdmlld0NlbnRlciA9IHRoaXMuY2FudmFzLkRPTXRvQ2FudmFzKHsgeDogMC41ICogdGhpcy5jYW52YXMuZnJhbWUuY2FudmFzLmNsaWVudFdpZHRoLCB5OiAwLjUgKiB0aGlzLmNhbnZhcy5mcmFtZS5jYW52YXMuY2xpZW50SGVpZ2h0IH0pOwoKICAgICAgICB2YXIgZGlzdGFuY2VGcm9tQ2VudGVyID0geyAvLyBvZmZzZXQgZnJvbSB2aWV3LCBkaXN0YW5jZSB2aWV3IGhhcyB0byBjaGFuZ2UgYnkgdGhlc2UgeCBhbmQgeSB0byBjZW50ZXIgdGhlIG5vZGUKICAgICAgICAgIHg6IHZpZXdDZW50ZXIueCAtIG9wdGlvbnMucG9zaXRpb24ueCwKICAgICAgICAgIHk6IHZpZXdDZW50ZXIueSAtIG9wdGlvbnMucG9zaXRpb24ueQogICAgICAgIH07CiAgICAgICAgdGhpcy50YXJnZXRUcmFuc2xhdGlvbiA9IHsKICAgICAgICAgIHg6IHRoaXMuc291cmNlVHJhbnNsYXRpb24ueCArIGRpc3RhbmNlRnJvbUNlbnRlci54ICogdGhpcy50YXJnZXRTY2FsZSArIG9wdGlvbnMub2Zmc2V0LngsCiAgICAgICAgICB5OiB0aGlzLnNvdXJjZVRyYW5zbGF0aW9uLnkgKyBkaXN0YW5jZUZyb21DZW50ZXIueSAqIHRoaXMudGFyZ2V0U2NhbGUgKyBvcHRpb25zLm9mZnNldC55CiAgICAgICAgfTsKCiAgICAgICAgLy8gaWYgdGhlIHRpbWUgaXMgc2V0IHRvIDAsIGRvbid0IGRvIGFuIGFuaW1hdGlvbgogICAgICAgIGlmIChvcHRpb25zLmFuaW1hdGlvbi5kdXJhdGlvbiA9PT0gMCkgewogICAgICAgICAgaWYgKHRoaXMubG9ja2VkT25Ob2RlSWQgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMudmlld0Z1bmN0aW9uID0gdGhpcy5fbG9ja2VkUmVkcmF3LmJpbmQodGhpcyk7CiAgICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCJpbml0UmVkcmF3IiwgdGhpcy52aWV3RnVuY3Rpb24pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5ib2R5LnZpZXcuc2NhbGUgPSB0aGlzLnRhcmdldFNjYWxlOwogICAgICAgICAgICB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbiA9IHRoaXMudGFyZ2V0VHJhbnNsYXRpb247CiAgICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoIl9yZXF1ZXN0UmVkcmF3Iik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYW5pbWF0aW9uU3BlZWQgPSAxIC8gKDYwICogb3B0aW9ucy5hbmltYXRpb24uZHVyYXRpb24gKiAwLjAwMSkgfHwgMSAvIDYwOyAvLyA2MCBmb3IgNjAgc2Vjb25kcywgMC4wMDEgZm9yIG1pbGxpJ3MKICAgICAgICAgIHRoaXMuYW5pbWF0aW9uRWFzaW5nRnVuY3Rpb24gPSBvcHRpb25zLmFuaW1hdGlvbi5lYXNpbmdGdW5jdGlvbjsKCiAgICAgICAgICB0aGlzLnZpZXdGdW5jdGlvbiA9IHRoaXMuX3RyYW5zaXRpb25SZWRyYXcuYmluZCh0aGlzKTsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCJpbml0UmVkcmF3IiwgdGhpcy52aWV3RnVuY3Rpb24pOwogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgiX3N0YXJ0UmVuZGVyaW5nIik7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9sb2NrZWRSZWRyYXciLAoKICAgICAgLyoqCiAgICAgICAqIHVzZWQgdG8gYW5pbWF0ZSBzbW9vdGhseSBieSBoaWphY2tpbmcgdGhlIHJlZHJhdyBmdW5jdGlvbi4KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfbG9ja2VkUmVkcmF3KCkgewogICAgICAgIHZhciBub2RlUG9zaXRpb24gPSB7IHg6IHRoaXMuYm9keS5ub2Rlc1t0aGlzLmxvY2tlZE9uTm9kZUlkXS54LCB5OiB0aGlzLmJvZHkubm9kZXNbdGhpcy5sb2NrZWRPbk5vZGVJZF0ueSB9OwogICAgICAgIHZhciB2aWV3Q2VudGVyID0gdGhpcy5ET010b0NhbnZhcyh7IHg6IDAuNSAqIHRoaXMuZnJhbWUuY2FudmFzLmNsaWVudFdpZHRoLCB5OiAwLjUgKiB0aGlzLmZyYW1lLmNhbnZhcy5jbGllbnRIZWlnaHQgfSk7CiAgICAgICAgdmFyIGRpc3RhbmNlRnJvbUNlbnRlciA9IHsgLy8gb2Zmc2V0IGZyb20gdmlldywgZGlzdGFuY2UgdmlldyBoYXMgdG8gY2hhbmdlIGJ5IHRoZXNlIHggYW5kIHkgdG8gY2VudGVyIHRoZSBub2RlCiAgICAgICAgICB4OiB2aWV3Q2VudGVyLnggLSBub2RlUG9zaXRpb24ueCwKICAgICAgICAgIHk6IHZpZXdDZW50ZXIueSAtIG5vZGVQb3NpdGlvbi55CiAgICAgICAgfTsKICAgICAgICB2YXIgc291cmNlVHJhbnNsYXRpb24gPSB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbjsKICAgICAgICB2YXIgdGFyZ2V0VHJhbnNsYXRpb24gPSB7CiAgICAgICAgICB4OiBzb3VyY2VUcmFuc2xhdGlvbi54ICsgZGlzdGFuY2VGcm9tQ2VudGVyLnggKiB0aGlzLmJvZHkudmlldy5zY2FsZSArIHRoaXMubG9ja2VkT25Ob2RlT2Zmc2V0LngsCiAgICAgICAgICB5OiBzb3VyY2VUcmFuc2xhdGlvbi55ICsgZGlzdGFuY2VGcm9tQ2VudGVyLnkgKiB0aGlzLmJvZHkudmlldy5zY2FsZSArIHRoaXMubG9ja2VkT25Ob2RlT2Zmc2V0LnkKICAgICAgICB9OwoKICAgICAgICB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbiA9IHRhcmdldFRyYW5zbGF0aW9uOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInJlbGVhc2VOb2RlIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHJlbGVhc2VOb2RlKCkgewogICAgICAgIGlmICh0aGlzLmxvY2tlZE9uTm9kZUlkICE9PSB1bmRlZmluZWQgJiYgdGhpcy52aWV3RnVuY3Rpb24gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub2ZmKCJpbml0UmVkcmF3IiwgdGhpcy52aWV3RnVuY3Rpb24pOwogICAgICAgICAgdGhpcy5sb2NrZWRPbk5vZGVJZCA9IHVuZGVmaW5lZDsKICAgICAgICAgIHRoaXMubG9ja2VkT25Ob2RlT2Zmc2V0ID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfdHJhbnNpdGlvblJlZHJhdyIsCgogICAgICAvKioKICAgICAgICoKICAgICAgICogQHBhcmFtIGVhc2luZ1RpbWUKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfdHJhbnNpdGlvblJlZHJhdygpIHsKICAgICAgICB2YXIgZmluaXNoZWQgPSBhcmd1bWVudHNbMF0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzBdOwoKICAgICAgICB0aGlzLmVhc2luZ1RpbWUgKz0gdGhpcy5hbmltYXRpb25TcGVlZDsKICAgICAgICB0aGlzLmVhc2luZ1RpbWUgPSBmaW5pc2hlZCA9PT0gdHJ1ZSA/IDEgOiB0aGlzLmVhc2luZ1RpbWU7CgogICAgICAgIHZhciBwcm9ncmVzcyA9IHV0aWwuZWFzaW5nRnVuY3Rpb25zW3RoaXMuYW5pbWF0aW9uRWFzaW5nRnVuY3Rpb25dKHRoaXMuZWFzaW5nVGltZSk7CgogICAgICAgIHRoaXMuYm9keS52aWV3LnNjYWxlID0gdGhpcy5zb3VyY2VTY2FsZSArICh0aGlzLnRhcmdldFNjYWxlIC0gdGhpcy5zb3VyY2VTY2FsZSkgKiBwcm9ncmVzczsKICAgICAgICB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbiA9IHsKICAgICAgICAgIHg6IHRoaXMuc291cmNlVHJhbnNsYXRpb24ueCArICh0aGlzLnRhcmdldFRyYW5zbGF0aW9uLnggLSB0aGlzLnNvdXJjZVRyYW5zbGF0aW9uLngpICogcHJvZ3Jlc3MsCiAgICAgICAgICB5OiB0aGlzLnNvdXJjZVRyYW5zbGF0aW9uLnkgKyAodGhpcy50YXJnZXRUcmFuc2xhdGlvbi55IC0gdGhpcy5zb3VyY2VUcmFuc2xhdGlvbi55KSAqIHByb2dyZXNzCiAgICAgICAgfTsKCiAgICAgICAgLy8gY2xlYW51cAogICAgICAgIGlmICh0aGlzLmVhc2luZ1RpbWUgPj0gMSkgewogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub2ZmKCJpbml0UmVkcmF3IiwgdGhpcy52aWV3RnVuY3Rpb24pOwogICAgICAgICAgdGhpcy5lYXNpbmdUaW1lID0gMDsKICAgICAgICAgIGlmICh0aGlzLmxvY2tlZE9uTm9kZUlkICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0aGlzLnZpZXdGdW5jdGlvbiA9IHRoaXMuX2xvY2tlZFJlZHJhdy5iaW5kKHRoaXMpOwogICAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbigiaW5pdFJlZHJhdyIsIHRoaXMudmlld0Z1bmN0aW9uKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoImFuaW1hdGlvbkZpbmlzaGVkIik7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImdldFNjYWxlIiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNjYWxlKCkgewogICAgICAgIHJldHVybiB0aGlzLmJvZHkudmlldy5zY2FsZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJnZXRWaWV3UG9zaXRpb24iLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Vmlld1Bvc2l0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmNhbnZhcy5ET010b0NhbnZhcyh7IHg6IDAuNSAqIHRoaXMuY2FudmFzLmZyYW1lLmNhbnZhcy5jbGllbnRXaWR0aCwgeTogMC41ICogdGhpcy5jYW52YXMuZnJhbWUuY2FudmFzLmNsaWVudEhlaWdodCB9KTsKICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBWaWV3OwogIH0pKCk7CgogIGV4cG9ydHNbImRlZmF1bHQiXSA9IFZpZXc7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CgovKioqLyB9LAovKiAxMDIgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfQoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgdmFyIF9jb21wb25lbnRzTmF2aWdhdGlvbkhhbmRsZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEwMyk7CgogIHZhciBfY29tcG9uZW50c05hdmlnYXRpb25IYW5kbGVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2NvbXBvbmVudHNOYXZpZ2F0aW9uSGFuZGxlcik7CgogIHZhciBfY29tcG9uZW50c1BvcHVwID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMDQpOwoKICB2YXIgX2NvbXBvbmVudHNQb3B1cDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jb21wb25lbnRzUG9wdXApOwoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogIHZhciBJbnRlcmFjdGlvbkhhbmRsZXIgPSAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gSW50ZXJhY3Rpb25IYW5kbGVyKGJvZHksIGNhbnZhcywgc2VsZWN0aW9uSGFuZGxlcikgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSW50ZXJhY3Rpb25IYW5kbGVyKTsKCiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuY2FudmFzID0gY2FudmFzOwogICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIgPSBzZWxlY3Rpb25IYW5kbGVyOwogICAgICB0aGlzLm5hdmlnYXRpb25IYW5kbGVyID0gbmV3IF9jb21wb25lbnRzTmF2aWdhdGlvbkhhbmRsZXIyWydkZWZhdWx0J10oYm9keSwgY2FudmFzKTsKCiAgICAgIC8vIGJpbmQgdGhlIGV2ZW50cyBmcm9tIGhhbW1lciB0byBmdW5jdGlvbnMgaW4gdGhpcyBvYmplY3QKICAgICAgdGhpcy5ib2R5LmV2ZW50TGlzdGVuZXJzLm9uVGFwID0gdGhpcy5vblRhcC5iaW5kKHRoaXMpOwogICAgICB0aGlzLmJvZHkuZXZlbnRMaXN0ZW5lcnMub25Ub3VjaCA9IHRoaXMub25Ub3VjaC5iaW5kKHRoaXMpOwogICAgICB0aGlzLmJvZHkuZXZlbnRMaXN0ZW5lcnMub25Eb3VibGVUYXAgPSB0aGlzLm9uRG91YmxlVGFwLmJpbmQodGhpcyk7CiAgICAgIHRoaXMuYm9keS5ldmVudExpc3RlbmVycy5vbkhvbGQgPSB0aGlzLm9uSG9sZC5iaW5kKHRoaXMpOwogICAgICB0aGlzLmJvZHkuZXZlbnRMaXN0ZW5lcnMub25EcmFnU3RhcnQgPSB0aGlzLm9uRHJhZ1N0YXJ0LmJpbmQodGhpcyk7CiAgICAgIHRoaXMuYm9keS5ldmVudExpc3RlbmVycy5vbkRyYWcgPSB0aGlzLm9uRHJhZy5iaW5kKHRoaXMpOwogICAgICB0aGlzLmJvZHkuZXZlbnRMaXN0ZW5lcnMub25EcmFnRW5kID0gdGhpcy5vbkRyYWdFbmQuYmluZCh0aGlzKTsKICAgICAgdGhpcy5ib2R5LmV2ZW50TGlzdGVuZXJzLm9uTW91c2VXaGVlbCA9IHRoaXMub25Nb3VzZVdoZWVsLmJpbmQodGhpcyk7CiAgICAgIHRoaXMuYm9keS5ldmVudExpc3RlbmVycy5vblBpbmNoID0gdGhpcy5vblBpbmNoLmJpbmQodGhpcyk7CiAgICAgIHRoaXMuYm9keS5ldmVudExpc3RlbmVycy5vbk1vdXNlTW92ZSA9IHRoaXMub25Nb3VzZU1vdmUuYmluZCh0aGlzKTsKICAgICAgdGhpcy5ib2R5LmV2ZW50TGlzdGVuZXJzLm9uUmVsZWFzZSA9IHRoaXMub25SZWxlYXNlLmJpbmQodGhpcyk7CiAgICAgIHRoaXMuYm9keS5ldmVudExpc3RlbmVycy5vbkNvbnRleHQgPSB0aGlzLm9uQ29udGV4dC5iaW5kKHRoaXMpOwoKICAgICAgdGhpcy50b3VjaFRpbWUgPSAwOwogICAgICB0aGlzLmRyYWcgPSB7fTsKICAgICAgdGhpcy5waW5jaCA9IHt9OwogICAgICB0aGlzLnBvcHVwID0gdW5kZWZpbmVkOwogICAgICB0aGlzLnBvcHVwT2JqID0gdW5kZWZpbmVkOwogICAgICB0aGlzLnBvcHVwVGltZXIgPSB1bmRlZmluZWQ7CgogICAgICB0aGlzLmJvZHkuZnVuY3Rpb25zLmdldFBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIuYmluZCh0aGlzKTsKCiAgICAgIHRoaXMub3B0aW9ucyA9IHt9OwogICAgICB0aGlzLmRlZmF1bHRPcHRpb25zID0gewogICAgICAgIGRyYWdOb2RlczogdHJ1ZSwKICAgICAgICBkcmFnVmlldzogdHJ1ZSwKICAgICAgICBob3ZlcjogZmFsc2UsCiAgICAgICAga2V5Ym9hcmQ6IHsKICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLAogICAgICAgICAgc3BlZWQ6IHsgeDogMTAsIHk6IDEwLCB6b29tOiAwLjAyIH0sCiAgICAgICAgICBiaW5kVG9XaW5kb3c6IHRydWUKICAgICAgICB9LAogICAgICAgIG5hdmlnYXRpb25CdXR0b25zOiBmYWxzZSwKICAgICAgICB0b29sdGlwRGVsYXk6IDMwMCwKICAgICAgICB6b29tVmlldzogdHJ1ZQogICAgICB9OwogICAgICB1dGlsLmV4dGVuZCh0aGlzLm9wdGlvbnMsIHRoaXMuZGVmYXVsdE9wdGlvbnMpOwoKICAgICAgdGhpcy5iaW5kRXZlbnRMaXN0ZW5lcnMoKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoSW50ZXJhY3Rpb25IYW5kbGVyLCBbewogICAgICBrZXk6ICdiaW5kRXZlbnRMaXN0ZW5lcnMnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gYmluZEV2ZW50TGlzdGVuZXJzKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9uKCdkZXN0cm95JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgY2xlYXJUaW1lb3V0KF90aGlzLnBvcHVwVGltZXIpOwogICAgICAgICAgZGVsZXRlIF90aGlzLmJvZHkuZnVuY3Rpb25zLmdldFBvaW50ZXI7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc2V0T3B0aW9ucycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICBpZiAob3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvLyBleHRlbmQgYWxsIGJ1dCB0aGUgdmFsdWVzIGluIGZpZWxkcwogICAgICAgICAgdmFyIGZpZWxkcyA9IFsnaGlkZUVkZ2VzT25EcmFnJywgJ2hpZGVOb2Rlc09uRHJhZycsICdrZXlib2FyZCcsICdtdWx0aXNlbGVjdCcsICdzZWxlY3RhYmxlJywgJ3NlbGVjdENvbm5lY3RlZEVkZ2VzJ107CiAgICAgICAgICB1dGlsLnNlbGVjdGl2ZU5vdERlZXBFeHRlbmQoZmllbGRzLCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwoKICAgICAgICAgIC8vIG1lcmdlIHRoZSBrZXlib2FyZCBvcHRpb25zIGluLgogICAgICAgICAgdXRpbC5tZXJnZU9wdGlvbnModGhpcy5vcHRpb25zLCBvcHRpb25zLCAna2V5Ym9hcmQnKTsKCiAgICAgICAgICBpZiAob3B0aW9ucy50b29sdGlwKSB7CiAgICAgICAgICAgIHV0aWwuZXh0ZW5kKHRoaXMub3B0aW9ucy50b29sdGlwLCBvcHRpb25zLnRvb2x0aXApOwogICAgICAgICAgICBpZiAob3B0aW9ucy50b29sdGlwLmNvbG9yKSB7CiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnRvb2x0aXAuY29sb3IgPSB1dGlsLnBhcnNlQ29sb3Iob3B0aW9ucy50b29sdGlwLmNvbG9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uSGFuZGxlci5zZXRPcHRpb25zKHRoaXMub3B0aW9ucyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZ2V0UG9pbnRlcicsCgogICAgICAvKioKICAgICAgICogR2V0IHRoZSBwb2ludGVyIGxvY2F0aW9uIGZyb20gYSB0b3VjaCBsb2NhdGlvbgogICAgICAgKiBAcGFyYW0ge3t4OiBOdW1iZXIsIHk6IE51bWJlcn19IHRvdWNoCiAgICAgICAqIEByZXR1cm4ge3t4OiBOdW1iZXIsIHk6IE51bWJlcn19IHBvaW50ZXIKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQb2ludGVyKHRvdWNoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHg6IHRvdWNoLnggLSB1dGlsLmdldEFic29sdXRlTGVmdCh0aGlzLmNhbnZhcy5mcmFtZS5jYW52YXMpLAogICAgICAgICAgeTogdG91Y2gueSAtIHV0aWwuZ2V0QWJzb2x1dGVUb3AodGhpcy5jYW52YXMuZnJhbWUuY2FudmFzKQogICAgICAgIH07CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnb25Ub3VjaCcsCgogICAgICAvKioKICAgICAgICogT24gc3RhcnQgb2YgYSB0b3VjaCBnZXN0dXJlLCBzdG9yZSB0aGUgcG9pbnRlcgogICAgICAgKiBAcGFyYW0gZXZlbnQKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBvblRvdWNoKGV2ZW50KSB7CiAgICAgICAgaWYgKG5ldyBEYXRlKCkudmFsdWVPZigpIC0gdGhpcy50b3VjaFRpbWUgPiA1MCkgewogICAgICAgICAgdGhpcy5kcmFnLnBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZXZlbnQuY2VudGVyKTsKICAgICAgICAgIHRoaXMuZHJhZy5waW5jaGVkID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnBpbmNoLnNjYWxlID0gdGhpcy5ib2R5LnZpZXcuc2NhbGU7CiAgICAgICAgICAvLyB0byBhdm9pZCBkb3VibGUgZmlyZWluZyBvZiB0aGlzIGV2ZW50IGJlY2F1c2Ugd2UgaGF2ZSB0d28gaGFtbWVyIGluc3RhbmNlcy4gKG9uIGNhbnZhcyBhbmQgb24gZnJhbWUpCiAgICAgICAgICB0aGlzLnRvdWNoVGltZSA9IG5ldyBEYXRlKCkudmFsdWVPZigpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdvblRhcCcsCgogICAgICAvKioKICAgICAgICogaGFuZGxlIHRhcC9jbGljayBldmVudDogc2VsZWN0L3Vuc2VsZWN0IGEgbm9kZQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uVGFwKGV2ZW50KSB7CiAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZXZlbnQuY2VudGVyKTsKICAgICAgICB2YXIgbXVsdGlzZWxlY3QgPSB0aGlzLnNlbGVjdGlvbkhhbmRsZXIub3B0aW9ucy5tdWx0aXNlbGVjdCAmJiAoZXZlbnQuY2hhbmdlZFBvaW50ZXJzWzBdLmN0cmxLZXkgfHwgZXZlbnQuY2hhbmdlZFBvaW50ZXJzWzBdLm1ldGFLZXkpOwoKICAgICAgICB0aGlzLmNoZWNrU2VsZWN0aW9uQ2hhbmdlcyhwb2ludGVyLCBldmVudCwgbXVsdGlzZWxlY3QpOwogICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2VuZXJhdGVDbGlja0V2ZW50KCdjbGljaycsIGV2ZW50LCBwb2ludGVyKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdvbkRvdWJsZVRhcCcsCgogICAgICAvKioKICAgICAgICogaGFuZGxlIGRvdWJsZXRhcCBldmVudAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uRG91YmxlVGFwKGV2ZW50KSB7CiAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZXZlbnQuY2VudGVyKTsKICAgICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dlbmVyYXRlQ2xpY2tFdmVudCgnZG91YmxlQ2xpY2snLCBldmVudCwgcG9pbnRlcik7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnb25Ib2xkJywKCiAgICAgIC8qKgogICAgICAgKiBoYW5kbGUgbG9uZyB0YXAgZXZlbnQ6IG11bHRpIHNlbGVjdCBub2RlcwogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uSG9sZChldmVudCkgewogICAgICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGV2ZW50LmNlbnRlcik7CiAgICAgICAgdmFyIG11bHRpc2VsZWN0ID0gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLm9wdGlvbnMubXVsdGlzZWxlY3Q7CgogICAgICAgIHRoaXMuY2hlY2tTZWxlY3Rpb25DaGFuZ2VzKHBvaW50ZXIsIGV2ZW50LCBtdWx0aXNlbGVjdCk7CgogICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2VuZXJhdGVDbGlja0V2ZW50KCdjbGljaycsIGV2ZW50LCBwb2ludGVyKTsKICAgICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dlbmVyYXRlQ2xpY2tFdmVudCgnaG9sZCcsIGV2ZW50LCBwb2ludGVyKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdvblJlbGVhc2UnLAoKICAgICAgLyoqCiAgICAgICAqIGhhbmRsZSB0aGUgcmVsZWFzZSBvZiB0aGUgc2NyZWVuCiAgICAgICAqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gb25SZWxlYXNlKGV2ZW50KSB7CiAgICAgICAgaWYgKG5ldyBEYXRlKCkudmFsdWVPZigpIC0gdGhpcy50b3VjaFRpbWUgPiAxMCkgewogICAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZXZlbnQuY2VudGVyKTsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2VuZXJhdGVDbGlja0V2ZW50KCdyZWxlYXNlJywgZXZlbnQsIHBvaW50ZXIpOwogICAgICAgICAgLy8gdG8gYXZvaWQgZG91YmxlIGZpcmVpbmcgb2YgdGhpcyBldmVudCBiZWNhdXNlIHdlIGhhdmUgdHdvIGhhbW1lciBpbnN0YW5jZXMuIChvbiBjYW52YXMgYW5kIG9uIGZyYW1lKQogICAgICAgICAgdGhpcy50b3VjaFRpbWUgPSBuZXcgRGF0ZSgpLnZhbHVlT2YoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnb25Db250ZXh0JywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uQ29udGV4dChldmVudCkgewogICAgICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKHsgeDogZXZlbnQuY2xpZW50WCwgeTogZXZlbnQuY2xpZW50WSB9KTsKICAgICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dlbmVyYXRlQ2xpY2tFdmVudCgnb25jb250ZXh0JywgZXZlbnQsIHBvaW50ZXIpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2NoZWNrU2VsZWN0aW9uQ2hhbmdlcycsCgogICAgICAvKioKICAgICAgICoKICAgICAgICogQHBhcmFtIHBvaW50ZXIKICAgICAgICogQHBhcmFtIGFkZAogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrU2VsZWN0aW9uQ2hhbmdlcyhwb2ludGVyLCBldmVudCkgewogICAgICAgIHZhciBhZGQgPSBhcmd1bWVudHNbMl0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzJdOwoKICAgICAgICB2YXIgcHJldmlvdXNseVNlbGVjdGVkRWRnZUNvdW50ID0gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLl9nZXRTZWxlY3RlZEVkZ2VDb3VudCgpOwogICAgICAgIHZhciBwcmV2aW91c2x5U2VsZWN0ZWROb2RlQ291bnQgPSB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dldFNlbGVjdGVkTm9kZUNvdW50KCk7CiAgICAgICAgdmFyIHByZXZpb3VzU2VsZWN0aW9uID0gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLmdldFNlbGVjdGlvbigpOwogICAgICAgIHZhciBzZWxlY3RlZCA9IHVuZGVmaW5lZDsKICAgICAgICBpZiAoYWRkID09PSB0cnVlKSB7CiAgICAgICAgICBzZWxlY3RlZCA9IHRoaXMuc2VsZWN0aW9uSGFuZGxlci5zZWxlY3RBZGRpdGlvbmFsT25Qb2ludChwb2ludGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuc2VsZWN0T25Qb2ludChwb2ludGVyKTsKICAgICAgICB9CiAgICAgICAgdmFyIHNlbGVjdGVkRWRnZXNDb3VudCA9IHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2V0U2VsZWN0ZWRFZGdlQ291bnQoKTsKICAgICAgICB2YXIgc2VsZWN0ZWROb2Rlc0NvdW50ID0gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLl9nZXRTZWxlY3RlZE5vZGVDb3VudCgpOwogICAgICAgIHZhciBjdXJyZW50U2VsZWN0aW9uID0gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLmdldFNlbGVjdGlvbigpOwoKICAgICAgICB2YXIgX2RldGVybWluZUlmRGlmZmVyZW50MiA9IHRoaXMuX2RldGVybWluZUlmRGlmZmVyZW50KHByZXZpb3VzU2VsZWN0aW9uLCBjdXJyZW50U2VsZWN0aW9uKTsKCiAgICAgICAgdmFyIG5vZGVzQ2hhbmdlcyA9IF9kZXRlcm1pbmVJZkRpZmZlcmVudDIubm9kZXNDaGFuZ2VzOwogICAgICAgIHZhciBlZGdlc0NoYW5nZXMgPSBfZGV0ZXJtaW5lSWZEaWZmZXJlbnQyLmVkZ2VzQ2hhbmdlczsKCiAgICAgICAgaWYgKHNlbGVjdGVkTm9kZXNDb3VudCAtIHByZXZpb3VzbHlTZWxlY3RlZE5vZGVDb3VudCA+IDApIHsKICAgICAgICAgIC8vIG5vZGUgd2FzIHNlbGVjdGVkCiAgICAgICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dlbmVyYXRlQ2xpY2tFdmVudCgnc2VsZWN0Tm9kZScsIGV2ZW50LCBwb2ludGVyKTsKICAgICAgICAgIHNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdGVkTm9kZXNDb3VudCAtIHByZXZpb3VzbHlTZWxlY3RlZE5vZGVDb3VudCA8IDApIHsKICAgICAgICAgIC8vIG5vZGUgd2FzIGRlc2VsZWN0ZWQKICAgICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2VuZXJhdGVDbGlja0V2ZW50KCdkZXNlbGVjdE5vZGUnLCBldmVudCwgcG9pbnRlciwgcHJldmlvdXNTZWxlY3Rpb24pOwogICAgICAgICAgc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWROb2Rlc0NvdW50ID09PSBwcmV2aW91c2x5U2VsZWN0ZWROb2RlQ291bnQgJiYgbm9kZXNDaGFuZ2VzID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dlbmVyYXRlQ2xpY2tFdmVudCgnZGVzZWxlY3ROb2RlJywgZXZlbnQsIHBvaW50ZXIsIHByZXZpb3VzU2VsZWN0aW9uKTsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2VuZXJhdGVDbGlja0V2ZW50KCdzZWxlY3ROb2RlJywgZXZlbnQsIHBvaW50ZXIpOwogICAgICAgICAgc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGVjdGVkRWRnZXNDb3VudCAtIHByZXZpb3VzbHlTZWxlY3RlZEVkZ2VDb3VudCA+IDApIHsKICAgICAgICAgIC8vIGVkZ2Ugd2FzIHNlbGVjdGVkCiAgICAgICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dlbmVyYXRlQ2xpY2tFdmVudCgnc2VsZWN0RWRnZScsIGV2ZW50LCBwb2ludGVyKTsKICAgICAgICAgIHNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdGVkRWRnZXNDb3VudCAtIHByZXZpb3VzbHlTZWxlY3RlZEVkZ2VDb3VudCA8IDApIHsKICAgICAgICAgIC8vIGVkZ2Ugd2FzIGRlc2VsZWN0ZWQKICAgICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2VuZXJhdGVDbGlja0V2ZW50KCdkZXNlbGVjdEVkZ2UnLCBldmVudCwgcG9pbnRlciwgcHJldmlvdXNTZWxlY3Rpb24pOwogICAgICAgICAgc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRFZGdlc0NvdW50ID09PSBwcmV2aW91c2x5U2VsZWN0ZWRFZGdlQ291bnQgJiYgZWRnZXNDaGFuZ2VzID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dlbmVyYXRlQ2xpY2tFdmVudCgnZGVzZWxlY3RFZGdlJywgZXZlbnQsIHBvaW50ZXIsIHByZXZpb3VzU2VsZWN0aW9uKTsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2VuZXJhdGVDbGlja0V2ZW50KCdzZWxlY3RFZGdlJywgZXZlbnQsIHBvaW50ZXIpOwogICAgICAgICAgc2VsZWN0ZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGVjdGVkID09PSB0cnVlKSB7CiAgICAgICAgICAvLyBzZWxlY3Qgb3IgdW5zZWxlY3QKICAgICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2VuZXJhdGVDbGlja0V2ZW50KCdzZWxlY3QnLCBldmVudCwgcG9pbnRlcik7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19kZXRlcm1pbmVJZkRpZmZlcmVudCcsCgogICAgICAvKioKICAgICAgICogVGhpcyBmdW5jdGlvbiBjaGVja3MgaWYgdGhlIG5vZGVzIGFuZCBlZGdlcyBwcmV2aW91c2x5IHNlbGVjdGVkIGhhdmUgY2hhbmdlZC4KICAgICAgICogQHBhcmFtIHByZXZpb3VzU2VsZWN0aW9uCiAgICAgICAqIEBwYXJhbSBjdXJyZW50U2VsZWN0aW9uCiAgICAgICAqIEByZXR1cm5zIHt7bm9kZXNDaGFuZ2VzOiBib29sZWFuLCBlZGdlc0NoYW5nZXM6IGJvb2xlYW59fQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kZXRlcm1pbmVJZkRpZmZlcmVudChwcmV2aW91c1NlbGVjdGlvbiwgY3VycmVudFNlbGVjdGlvbikgewogICAgICAgIHZhciBub2Rlc0NoYW5nZXMgPSBmYWxzZTsKICAgICAgICB2YXIgZWRnZXNDaGFuZ2VzID0gZmFsc2U7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJldmlvdXNTZWxlY3Rpb24ubm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChjdXJyZW50U2VsZWN0aW9uLm5vZGVzLmluZGV4T2YocHJldmlvdXNTZWxlY3Rpb24ubm9kZXNbaV0pID09PSAtMSkgewogICAgICAgICAgICBub2Rlc0NoYW5nZXMgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1cnJlbnRTZWxlY3Rpb24ubm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChwcmV2aW91c1NlbGVjdGlvbi5ub2Rlcy5pbmRleE9mKHByZXZpb3VzU2VsZWN0aW9uLm5vZGVzW2ldKSA9PT0gLTEpIHsKICAgICAgICAgICAgbm9kZXNDaGFuZ2VzID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcmV2aW91c1NlbGVjdGlvbi5lZGdlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKGN1cnJlbnRTZWxlY3Rpb24uZWRnZXMuaW5kZXhPZihwcmV2aW91c1NlbGVjdGlvbi5lZGdlc1tpXSkgPT09IC0xKSB7CiAgICAgICAgICAgIGVkZ2VzQ2hhbmdlcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3VycmVudFNlbGVjdGlvbi5lZGdlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKHByZXZpb3VzU2VsZWN0aW9uLmVkZ2VzLmluZGV4T2YocHJldmlvdXNTZWxlY3Rpb24uZWRnZXNbaV0pID09PSAtMSkgewogICAgICAgICAgICBlZGdlc0NoYW5nZXMgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgbm9kZXNDaGFuZ2VzOiBub2Rlc0NoYW5nZXMsIGVkZ2VzQ2hhbmdlczogZWRnZXNDaGFuZ2VzIH07CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnb25EcmFnU3RhcnQnLAoKICAgICAgLyoqCiAgICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGJ5IG9uRHJhZ1N0YXJ0LgogICAgICAgKiBJdCBpcyBzZXBhcmF0ZWQgb3V0IGJlY2F1c2Ugd2UgY2FuIHRoZW4gb3ZlcmxvYWQgaXQgZm9yIHRoZSBkYXRhbWFuaXB1bGF0aW9uIHN5c3RlbS4KICAgICAgICoKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbkRyYWdTdGFydChldmVudCkgewogICAgICAgIC8vaW4gY2FzZSB0aGUgdG91Y2ggZXZlbnQgd2FzIHRyaWdnZXJlZCBvbiBhbiBleHRlcm5hbCBkaXYsIGRvIHRoZSBpbml0aWFsIHRvdWNoIG5vdy4KICAgICAgICBpZiAodGhpcy5kcmFnLnBvaW50ZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5vblRvdWNoKGV2ZW50KTsKICAgICAgICB9CgogICAgICAgIC8vIG5vdGU6IGRyYWcucG9pbnRlciBpcyBzZXQgaW4gb25Ub3VjaCB0byBnZXQgdGhlIGluaXRpYWwgdG91Y2ggbG9jYXRpb24KICAgICAgICB2YXIgbm9kZSA9IHRoaXMuc2VsZWN0aW9uSGFuZGxlci5nZXROb2RlQXQodGhpcy5kcmFnLnBvaW50ZXIpOwoKICAgICAgICB0aGlzLmRyYWcuZHJhZ2dpbmcgPSB0cnVlOwogICAgICAgIHRoaXMuZHJhZy5zZWxlY3Rpb24gPSBbXTsKICAgICAgICB0aGlzLmRyYWcudHJhbnNsYXRpb24gPSB1dGlsLmV4dGVuZCh7fSwgdGhpcy5ib2R5LnZpZXcudHJhbnNsYXRpb24pOyAvLyBjb3B5IHRoZSBvYmplY3QKICAgICAgICB0aGlzLmRyYWcubm9kZUlkID0gdW5kZWZpbmVkOwoKICAgICAgICBpZiAobm9kZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMub3B0aW9ucy5kcmFnTm9kZXMgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuZHJhZy5ub2RlSWQgPSBub2RlLmlkOwogICAgICAgICAgLy8gc2VsZWN0IHRoZSBjbGlja2VkIG5vZGUgaWYgbm90IHlldCBzZWxlY3RlZAogICAgICAgICAgaWYgKG5vZGUuaXNTZWxlY3RlZCgpID09PSBmYWxzZSkgewogICAgICAgICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIudW5zZWxlY3RBbGwoKTsKICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25IYW5kbGVyLnNlbGVjdE9iamVjdChub2RlKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBhZnRlciBzZWxlY3QgdG8gY29udGFpbiB0aGUgbm9kZQogICAgICAgICAgdGhpcy5zZWxlY3Rpb25IYW5kbGVyLl9nZW5lcmF0ZUNsaWNrRXZlbnQoJ2RyYWdTdGFydCcsIGV2ZW50LCB0aGlzLmRyYWcucG9pbnRlcik7CgogICAgICAgICAgdmFyIHNlbGVjdGlvbiA9IHRoaXMuc2VsZWN0aW9uSGFuZGxlci5zZWxlY3Rpb25PYmoubm9kZXM7CiAgICAgICAgICAvLyBjcmVhdGUgYW4gYXJyYXkgd2l0aCB0aGUgc2VsZWN0ZWQgbm9kZXMgYW5kIHRoZWlyIG9yaWdpbmFsIGxvY2F0aW9uIGFuZCBzdGF0dXMKICAgICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiBzZWxlY3Rpb24pIHsKICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgICAgdmFyIG9iamVjdCA9IHNlbGVjdGlvbltub2RlSWRdOwogICAgICAgICAgICAgIHZhciBzID0gewogICAgICAgICAgICAgICAgaWQ6IG9iamVjdC5pZCwKICAgICAgICAgICAgICAgIG5vZGU6IG9iamVjdCwKCiAgICAgICAgICAgICAgICAvLyBzdG9yZSBvcmlnaW5hbCB4LCB5LCB4Rml4ZWQgYW5kIHlGaXhlZCwgbWFrZSB0aGUgbm9kZSB0ZW1wb3JhcmlseSBGaXhlZAogICAgICAgICAgICAgICAgeDogb2JqZWN0LngsCiAgICAgICAgICAgICAgICB5OiBvYmplY3QueSwKICAgICAgICAgICAgICAgIHhGaXhlZDogb2JqZWN0Lm9wdGlvbnMuZml4ZWQueCwKICAgICAgICAgICAgICAgIHlGaXhlZDogb2JqZWN0Lm9wdGlvbnMuZml4ZWQueQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIG9iamVjdC5vcHRpb25zLmZpeGVkLnggPSB0cnVlOwogICAgICAgICAgICAgIG9iamVjdC5vcHRpb25zLmZpeGVkLnkgPSB0cnVlOwoKICAgICAgICAgICAgICB0aGlzLmRyYWcuc2VsZWN0aW9uLnB1c2gocyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gZmFsbGJhY2sgaWYgbm8gbm9kZSBpcyBzZWxlY3RlZCBhbmQgdGh1cyB0aGUgdmlldyBpcyBkcmFnZ2VkLgogICAgICAgICAgdGhpcy5zZWxlY3Rpb25IYW5kbGVyLl9nZW5lcmF0ZUNsaWNrRXZlbnQoJ2RyYWdTdGFydCcsIGV2ZW50LCB0aGlzLmRyYWcucG9pbnRlciwgdW5kZWZpbmVkLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnb25EcmFnJywKCiAgICAgIC8qKgogICAgICAgKiBoYW5kbGUgZHJhZyBldmVudAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uRHJhZyhldmVudCkgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICBpZiAodGhpcy5kcmFnLnBpbmNoZWQgPT09IHRydWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIHJlbW92ZSB0aGUgZm9jdXMgb24gbm9kZSBpZiBpdCBpcyBmb2N1c3NlZCBvbiBieSB0aGUgZm9jdXNPbk5vZGUKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCd1bmxvY2tOb2RlJyk7CgogICAgICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGV2ZW50LmNlbnRlcik7CgogICAgICAgIHZhciBzZWxlY3Rpb24gPSB0aGlzLmRyYWcuc2VsZWN0aW9uOwogICAgICAgIGlmIChzZWxlY3Rpb24gJiYgc2VsZWN0aW9uLmxlbmd0aCAmJiB0aGlzLm9wdGlvbnMuZHJhZ05vZGVzID09PSB0cnVlKSB7CiAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczIuc2VsZWN0aW9uSGFuZGxlci5fZ2VuZXJhdGVDbGlja0V2ZW50KCdkcmFnZ2luZycsIGV2ZW50LCBwb2ludGVyKTsKCiAgICAgICAgICAgIC8vIGNhbGN1bGF0ZSBkZWx0YSdzIGFuZCBuZXcgbG9jYXRpb24KICAgICAgICAgICAgdmFyIGRlbHRhWCA9IHBvaW50ZXIueCAtIF90aGlzMi5kcmFnLnBvaW50ZXIueDsKICAgICAgICAgICAgdmFyIGRlbHRhWSA9IHBvaW50ZXIueSAtIF90aGlzMi5kcmFnLnBvaW50ZXIueTsKCiAgICAgICAgICAgIC8vIHVwZGF0ZSBwb3NpdGlvbiBvZiBhbGwgc2VsZWN0ZWQgbm9kZXMKICAgICAgICAgICAgc2VsZWN0aW9uLmZvckVhY2goZnVuY3Rpb24gKHNlbGVjdGlvbikgewogICAgICAgICAgICAgIHZhciBub2RlID0gc2VsZWN0aW9uLm5vZGU7CiAgICAgICAgICAgICAgLy8gb25seSBtb3ZlIHRoZSBub2RlIGlmIGl0IHdhcyBub3QgZml4ZWQgaW5pdGlhbGx5CiAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi54Rml4ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBub2RlLnggPSBfdGhpczIuY2FudmFzLl9YY29udmVydERPTXRvQ2FudmFzKF90aGlzMi5jYW52YXMuX1hjb252ZXJ0Q2FudmFzVG9ET00oc2VsZWN0aW9uLngpICsgZGVsdGFYKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy8gb25seSBtb3ZlIHRoZSBub2RlIGlmIGl0IHdhcyBub3QgZml4ZWQgaW5pdGlhbGx5CiAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi55Rml4ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBub2RlLnkgPSBfdGhpczIuY2FudmFzLl9ZY29udmVydERPTXRvQ2FudmFzKF90aGlzMi5jYW52YXMuX1ljb252ZXJ0Q2FudmFzVG9ET00oc2VsZWN0aW9uLnkpICsgZGVsdGFZKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gc3RhcnQgdGhlIHNpbXVsYXRpb24gb2YgdGhlIHBoeXNpY3MKICAgICAgICAgICAgX3RoaXMyLmJvZHkuZW1pdHRlci5lbWl0KCdzdGFydFNpbXVsYXRpb24nKTsKICAgICAgICAgIH0pKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIG1vdmUgdGhlIG5ldHdvcmsKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZHJhZ1ZpZXcgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25IYW5kbGVyLl9nZW5lcmF0ZUNsaWNrRXZlbnQoJ2RyYWdnaW5nJywgZXZlbnQsIHBvaW50ZXIsIHVuZGVmaW5lZCwgdHJ1ZSk7CgogICAgICAgICAgICAvLyBpZiB0aGUgZHJhZyB3YXMgbm90IHN0YXJ0ZWQgcHJvcGVybHkgYmVjYXVzZSB0aGUgY2xpY2sgc3RhcnRlZCBvdXRzaWRlIHRoZSBuZXR3b3JrIGRpdiwgc3RhcnQgaXQgbm93LgogICAgICAgICAgICBpZiAodGhpcy5kcmFnLnBvaW50ZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRoaXMuX2hhbmRsZURyYWdTdGFydChldmVudCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBkaWZmWCA9IHBvaW50ZXIueCAtIHRoaXMuZHJhZy5wb2ludGVyLng7CiAgICAgICAgICAgIHZhciBkaWZmWSA9IHBvaW50ZXIueSAtIHRoaXMuZHJhZy5wb2ludGVyLnk7CgogICAgICAgICAgICB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbiA9IHsgeDogdGhpcy5kcmFnLnRyYW5zbGF0aW9uLnggKyBkaWZmWCwgeTogdGhpcy5kcmFnLnRyYW5zbGF0aW9uLnkgKyBkaWZmWSB9OwogICAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfcmVkcmF3Jyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ29uRHJhZ0VuZCcsCgogICAgICAvKioKICAgICAgICogaGFuZGxlIGRyYWcgc3RhcnQgZXZlbnQKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbkRyYWdFbmQoZXZlbnQpIHsKICAgICAgICB0aGlzLmRyYWcuZHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgICB2YXIgc2VsZWN0aW9uID0gdGhpcy5kcmFnLnNlbGVjdGlvbjsKICAgICAgICBpZiAoc2VsZWN0aW9uICYmIHNlbGVjdGlvbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2VuZXJhdGVDbGlja0V2ZW50KCdkcmFnRW5kJywgZXZlbnQsIHRoaXMuZ2V0UG9pbnRlcihldmVudC5jZW50ZXIpKTsKICAgICAgICAgIHNlbGVjdGlvbi5mb3JFYWNoKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgICAgIC8vIHJlc3RvcmUgb3JpZ2luYWwgeEZpeGVkIGFuZCB5Rml4ZWQKICAgICAgICAgICAgcy5ub2RlLm9wdGlvbnMuZml4ZWQueCA9IHMueEZpeGVkOwogICAgICAgICAgICBzLm5vZGUub3B0aW9ucy5maXhlZC55ID0gcy55Rml4ZWQ7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ3N0YXJ0U2ltdWxhdGlvbicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dlbmVyYXRlQ2xpY2tFdmVudCgnZHJhZ0VuZCcsIGV2ZW50LCB0aGlzLmdldFBvaW50ZXIoZXZlbnQuY2VudGVyKSwgdW5kZWZpbmVkLCB0cnVlKTsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19yZXF1ZXN0UmVkcmF3Jyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ29uUGluY2gnLAoKICAgICAgLyoqCiAgICAgICAqIEhhbmRsZSBwaW5jaCBldmVudAogICAgICAgKiBAcGFyYW0gZXZlbnQKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBvblBpbmNoKGV2ZW50KSB7CiAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZXZlbnQuY2VudGVyKTsKCiAgICAgICAgdGhpcy5kcmFnLnBpbmNoZWQgPSB0cnVlOwogICAgICAgIGlmICh0aGlzLnBpbmNoWydzY2FsZSddID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMucGluY2guc2NhbGUgPSAxOwogICAgICAgIH0KCiAgICAgICAgLy8gVE9ETzogZW5hYmxlZCBtb3Zpbmcgd2hpbGUgcGluY2hpbmc/CiAgICAgICAgdmFyIHNjYWxlID0gdGhpcy5waW5jaC5zY2FsZSAqIGV2ZW50LnNjYWxlOwogICAgICAgIHRoaXMuem9vbShzY2FsZSwgcG9pbnRlcik7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnem9vbScsCgogICAgICAvKioKICAgICAgICogWm9vbSB0aGUgbmV0d29yayBpbiBvciBvdXQKICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHNjYWxlIGEgbnVtYmVyIGFyb3VuZCAxLCBhbmQgYmV0d2VlbiAwLjAxIGFuZCAxMAogICAgICAgKiBAcGFyYW0ge3t4OiBOdW1iZXIsIHk6IE51bWJlcn19IHBvaW50ZXIgICAgUG9zaXRpb24gb24gc2NyZWVuCiAgICAgICAqIEByZXR1cm4ge051bWJlcn0gYXBwbGllZFNjYWxlICAgIHNjYWxlIGlzIGxpbWl0ZWQgd2l0aGluIHRoZSBib3VuZGFyaWVzCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gem9vbShzY2FsZSwgcG9pbnRlcikgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuem9vbVZpZXcgPT09IHRydWUpIHsKICAgICAgICAgIHZhciBzY2FsZU9sZCA9IHRoaXMuYm9keS52aWV3LnNjYWxlOwogICAgICAgICAgaWYgKHNjYWxlIDwgMC4wMDAwMSkgewogICAgICAgICAgICBzY2FsZSA9IDAuMDAwMDE7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc2NhbGUgPiAxMCkgewogICAgICAgICAgICBzY2FsZSA9IDEwOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwcmVTY2FsZURyYWdQb2ludGVyID0gdW5kZWZpbmVkOwogICAgICAgICAgaWYgKHRoaXMuZHJhZyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmRyYWcuZHJhZ2dpbmcgPT09IHRydWUpIHsKICAgICAgICAgICAgICBwcmVTY2FsZURyYWdQb2ludGVyID0gdGhpcy5jYW52YXMuRE9NdG9DYW52YXModGhpcy5kcmFnLnBvaW50ZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyArIHRoaXMuY2FudmFzLmZyYW1lLmNhbnZhcy5jbGllbnRIZWlnaHQgLyAyCiAgICAgICAgICB2YXIgdHJhbnNsYXRpb24gPSB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbjsKCiAgICAgICAgICB2YXIgc2NhbGVGcmFjID0gc2NhbGUgLyBzY2FsZU9sZDsKICAgICAgICAgIHZhciB0eCA9ICgxIC0gc2NhbGVGcmFjKSAqIHBvaW50ZXIueCArIHRyYW5zbGF0aW9uLnggKiBzY2FsZUZyYWM7CiAgICAgICAgICB2YXIgdHkgPSAoMSAtIHNjYWxlRnJhYykgKiBwb2ludGVyLnkgKyB0cmFuc2xhdGlvbi55ICogc2NhbGVGcmFjOwoKICAgICAgICAgIHRoaXMuYm9keS52aWV3LnNjYWxlID0gc2NhbGU7CiAgICAgICAgICB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbiA9IHsgeDogdHgsIHk6IHR5IH07CgogICAgICAgICAgaWYgKHByZVNjYWxlRHJhZ1BvaW50ZXIgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZhciBwb3N0U2NhbGVEcmFnUG9pbnRlciA9IHRoaXMuY2FudmFzLmNhbnZhc1RvRE9NKHByZVNjYWxlRHJhZ1BvaW50ZXIpOwogICAgICAgICAgICB0aGlzLmRyYWcucG9pbnRlci54ID0gcG9zdFNjYWxlRHJhZ1BvaW50ZXIueDsKICAgICAgICAgICAgdGhpcy5kcmFnLnBvaW50ZXIueSA9IHBvc3RTY2FsZURyYWdQb2ludGVyLnk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3JlcXVlc3RSZWRyYXcnKTsKCiAgICAgICAgICBpZiAoc2NhbGVPbGQgPCBzY2FsZSkgewogICAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCd6b29tJywgeyBkaXJlY3Rpb246ICcrJywgc2NhbGU6IHRoaXMuYm9keS52aWV3LnNjYWxlIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnem9vbScsIHsgZGlyZWN0aW9uOiAnLScsIHNjYWxlOiB0aGlzLmJvZHkudmlldy5zY2FsZSB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnb25Nb3VzZVdoZWVsJywKCiAgICAgIC8qKgogICAgICAgKiBFdmVudCBoYW5kbGVyIGZvciBtb3VzZSB3aGVlbCBldmVudCwgdXNlZCB0byB6b29tIHRoZSB0aW1lbGluZQogICAgICAgKiBTZWUgaHR0cDovL2Fkb21hcy5vcmcvamF2YXNjcmlwdC1tb3VzZS13aGVlbC8KICAgICAgICogICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9FaWdodE1lZGlhL2hhbW1lci5qcy9pc3N1ZXMvMjU2CiAgICAgICAqIEBwYXJhbSB7TW91c2VFdmVudH0gIGV2ZW50CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb3VzZVdoZWVsKGV2ZW50KSB7CiAgICAgICAgLy8gcmV0cmlldmUgZGVsdGEKICAgICAgICB2YXIgZGVsdGEgPSAwOwogICAgICAgIGlmIChldmVudC53aGVlbERlbHRhKSB7CiAgICAgICAgICAvKiBJRS9PcGVyYS4gKi8KICAgICAgICAgIGRlbHRhID0gZXZlbnQud2hlZWxEZWx0YSAvIDEyMDsKICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmRldGFpbCkgewogICAgICAgICAgLyogTW96aWxsYSBjYXNlLiAqLwogICAgICAgICAgLy8gSW4gTW96aWxsYSwgc2lnbiBvZiBkZWx0YSBpcyBkaWZmZXJlbnQgdGhhbiBpbiBJRS4KICAgICAgICAgIC8vIEFsc28sIGRlbHRhIGlzIG11bHRpcGxlIG9mIDMuCiAgICAgICAgICBkZWx0YSA9IC1ldmVudC5kZXRhaWwgLyAzOwogICAgICAgIH0KCiAgICAgICAgLy8gSWYgZGVsdGEgaXMgbm9uemVybywgaGFuZGxlIGl0LgogICAgICAgIC8vIEJhc2ljYWxseSwgZGVsdGEgaXMgbm93IHBvc2l0aXZlIGlmIHdoZWVsIHdhcyBzY3JvbGxlZCB1cCwKICAgICAgICAvLyBhbmQgbmVnYXRpdmUsIGlmIHdoZWVsIHdhcyBzY3JvbGxlZCBkb3duLgogICAgICAgIGlmIChkZWx0YSAhPT0gMCkgewoKICAgICAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgbmV3IHNjYWxlCiAgICAgICAgICB2YXIgc2NhbGUgPSB0aGlzLmJvZHkudmlldy5zY2FsZTsKICAgICAgICAgIHZhciB6b29tID0gZGVsdGEgLyAxMDsKICAgICAgICAgIGlmIChkZWx0YSA8IDApIHsKICAgICAgICAgICAgem9vbSA9IHpvb20gLyAoMSAtIHpvb20pOwogICAgICAgICAgfQogICAgICAgICAgc2NhbGUgKj0gMSArIHpvb207CgogICAgICAgICAgLy8gY2FsY3VsYXRlIHRoZSBwb2ludGVyIGxvY2F0aW9uCiAgICAgICAgICB2YXIgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcih7IHg6IGV2ZW50LmNsaWVudFgsIHk6IGV2ZW50LmNsaWVudFkgfSk7CgogICAgICAgICAgLy8gYXBwbHkgdGhlIG5ldyBzY2FsZQogICAgICAgICAgdGhpcy56b29tKHNjYWxlLCBwb2ludGVyKTsKICAgICAgICB9CgogICAgICAgIC8vIFByZXZlbnQgZGVmYXVsdCBhY3Rpb25zIGNhdXNlZCBieSBtb3VzZSB3aGVlbC4KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ29uTW91c2VNb3ZlJywKCiAgICAgIC8qKgogICAgICAgKiBNb3VzZSBtb3ZlIGhhbmRsZXIgZm9yIGNoZWNraW5nIHdoZXRoZXIgdGhlIHRpdGxlIG1vdmVzIG92ZXIgYSBub2RlIHdpdGggYSB0aXRsZS4KICAgICAgICogQHBhcmFtICB7RXZlbnR9IGV2ZW50CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gb25Nb3VzZU1vdmUoZXZlbnQpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoeyB4OiBldmVudC5jbGllbnRYLCB5OiBldmVudC5jbGllbnRZIH0pOwogICAgICAgIHZhciBwb3B1cFZpc2libGUgPSBmYWxzZTsKCiAgICAgICAgLy8gY2hlY2sgaWYgdGhlIHByZXZpb3VzbHkgc2VsZWN0ZWQgbm9kZSBpcyBzdGlsbCBzZWxlY3RlZAogICAgICAgIGlmICh0aGlzLnBvcHVwICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGlmICh0aGlzLnBvcHVwLmhpZGRlbiA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhpcy5fY2hlY2tIaWRlUG9wdXAocG9pbnRlcik7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gaWYgdGhlIHBvcHVwIHdhcyBub3QgaGlkZGVuIGFib3ZlCiAgICAgICAgICBpZiAodGhpcy5wb3B1cC5oaWRkZW4gPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHBvcHVwVmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgIHRoaXMucG9wdXAuc2V0UG9zaXRpb24ocG9pbnRlci54ICsgMywgcG9pbnRlci55IC0gNSk7CiAgICAgICAgICAgIHRoaXMucG9wdXAuc2hvdygpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gaWYgd2UgYmluZCB0aGUga2V5Ym9hcmQgdG8gdGhlIGRpdiwgd2UgaGF2ZSB0byBoaWdobGlnaHQgaXQgdG8gdXNlIGl0LiBUaGlzIGhpZ2hsaWdodHMgaXQgb24gbW91c2Ugb3Zlci4KICAgICAgICBpZiAodGhpcy5vcHRpb25zLmtleWJvYXJkLmJpbmRUb1dpbmRvdyA9PT0gZmFsc2UgJiYgdGhpcy5vcHRpb25zLmtleWJvYXJkLmVuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuY2FudmFzLmZyYW1lLmZvY3VzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBzdGFydCBhIHRpbWVvdXQgdGhhdCB3aWxsIGNoZWNrIGlmIHRoZSBtb3VzZSBpcyBwb3NpdGlvbmVkIGFib3ZlIGFuIGVsZW1lbnQKICAgICAgICBpZiAocG9wdXBWaXNpYmxlID09PSBmYWxzZSkgewogICAgICAgICAgaWYgKHRoaXMucG9wdXBUaW1lciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wb3B1cFRpbWVyKTsgLy8gc3RvcCBhbnkgcnVubmluZyBjYWxjdWxhdGlvblRpbWVyCiAgICAgICAgICAgIHRoaXMucG9wdXBUaW1lciA9IHVuZGVmaW5lZDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghdGhpcy5kcmFnLmRyYWdnaW5nKSB7CiAgICAgICAgICAgIHRoaXMucG9wdXBUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczMuX2NoZWNrU2hvd1BvcHVwKHBvaW50ZXIpOwogICAgICAgICAgICB9LCB0aGlzLm9wdGlvbnMudG9vbHRpcERlbGF5KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICogQWRkaW5nIGhvdmVyIGhpZ2hsaWdodHMKICAgICAgICAqLwogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaG92ZXIgPT09IHRydWUpIHsKICAgICAgICAgIC8vIGFkZGluZyBob3ZlciBoaWdobGlnaHRzCiAgICAgICAgICB2YXIgb2JqID0gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLmdldE5vZGVBdChwb2ludGVyKTsKICAgICAgICAgIGlmIChvYmogPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBvYmogPSB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuZ2V0RWRnZUF0KHBvaW50ZXIpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zZWxlY3Rpb25IYW5kbGVyLmhvdmVyT2JqZWN0KG9iaik7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jaGVja1Nob3dQb3B1cCcsCgogICAgICAvKioKICAgICAgICogQ2hlY2sgaWYgdGhlcmUgaXMgYW4gZWxlbWVudCBvbiB0aGUgZ2l2ZW4gcG9zaXRpb24gaW4gdGhlIG5ldHdvcmsKICAgICAgICogKGEgbm9kZSBvciBlZGdlKS4gSWYgc28sIGFuZCBpZiB0aGlzIGVsZW1lbnQgaGFzIGEgdGl0bGUsCiAgICAgICAqIHNob3cgYSBwb3B1cCB3aW5kb3cgd2l0aCBpdHMgdGl0bGUuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7e3g6TnVtYmVyLCB5Ok51bWJlcn19IHBvaW50ZXIKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY2hlY2tTaG93UG9wdXAocG9pbnRlcikgewogICAgICAgIHZhciB4ID0gdGhpcy5jYW52YXMuX1hjb252ZXJ0RE9NdG9DYW52YXMocG9pbnRlci54KTsKICAgICAgICB2YXIgeSA9IHRoaXMuY2FudmFzLl9ZY29udmVydERPTXRvQ2FudmFzKHBvaW50ZXIueSk7CiAgICAgICAgdmFyIHBvaW50ZXJPYmogPSB7CiAgICAgICAgICBsZWZ0OiB4LAogICAgICAgICAgdG9wOiB5LAogICAgICAgICAgcmlnaHQ6IHgsCiAgICAgICAgICBib3R0b206IHkKICAgICAgICB9OwoKICAgICAgICB2YXIgcHJldmlvdXNQb3B1cE9iaklkID0gdGhpcy5wb3B1cE9iaiA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogdGhpcy5wb3B1cE9iai5pZDsKICAgICAgICB2YXIgbm9kZVVuZGVyQ3Vyc29yID0gZmFsc2U7CiAgICAgICAgdmFyIHBvcHVwVHlwZSA9ICdub2RlJzsKCiAgICAgICAgLy8gY2hlY2sgaWYgYSBub2RlIGlzIHVuZGVyIHRoZSBjdXJzb3IuCiAgICAgICAgaWYgKHRoaXMucG9wdXBPYmogPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgLy8gc2VhcmNoIHRoZSBub2RlcyBmb3Igb3ZlcmxhcCwgc2VsZWN0IHRoZSB0b3Agb25lIGluIGNhc2Ugb2YgbXVsdGlwbGUgbm9kZXMKICAgICAgICAgIHZhciBub2RlSW5kaWNlcyA9IHRoaXMuYm9keS5ub2RlSW5kaWNlczsKICAgICAgICAgIHZhciBub2RlcyA9IHRoaXMuYm9keS5ub2RlczsKICAgICAgICAgIHZhciBub2RlID0gdW5kZWZpbmVkOwogICAgICAgICAgdmFyIG92ZXJsYXBwaW5nTm9kZXMgPSBbXTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZUluZGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbm9kZSA9IG5vZGVzW25vZGVJbmRpY2VzW2ldXTsKICAgICAgICAgICAgaWYgKG5vZGUuaXNPdmVybGFwcGluZ1dpdGgocG9pbnRlck9iaikgPT09IHRydWUpIHsKICAgICAgICAgICAgICBpZiAobm9kZS5nZXRUaXRsZSgpICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIG92ZXJsYXBwaW5nTm9kZXMucHVzaChub2RlSW5kaWNlc1tpXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG92ZXJsYXBwaW5nTm9kZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgb3ZlcmxhcHBpbmcgbm9kZXMsIHNlbGVjdCB0aGUgbGFzdCBvbmUsIHRoaXMgaXMgdGhlIG9uZSB3aGljaCBpcyBkcmF3biBvbiB0b3Agb2YgdGhlIG90aGVycwogICAgICAgICAgICB0aGlzLnBvcHVwT2JqID0gbm9kZXNbb3ZlcmxhcHBpbmdOb2Rlc1tvdmVybGFwcGluZ05vZGVzLmxlbmd0aCAtIDFdXTsKICAgICAgICAgICAgLy8gaWYgeW91IGhvdmVyIG92ZXIgYSBub2RlLCB0aGUgdGl0bGUgb2YgdGhlIGVkZ2UgaXMgbm90IHN1cHBvc2VkIHRvIGJlIHNob3duLgogICAgICAgICAgICBub2RlVW5kZXJDdXJzb3IgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMucG9wdXBPYmogPT09IHVuZGVmaW5lZCAmJiBub2RlVW5kZXJDdXJzb3IgPT09IGZhbHNlKSB7CiAgICAgICAgICAvLyBzZWFyY2ggdGhlIGVkZ2VzIGZvciBvdmVybGFwCiAgICAgICAgICB2YXIgZWRnZUluZGljZXMgPSB0aGlzLmJvZHkuZWRnZUluZGljZXM7CiAgICAgICAgICB2YXIgZWRnZXMgPSB0aGlzLmJvZHkuZWRnZXM7CiAgICAgICAgICB2YXIgZWRnZSA9IHVuZGVmaW5lZDsKICAgICAgICAgIHZhciBvdmVybGFwcGluZ0VkZ2VzID0gW107CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVkZ2VJbmRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGVkZ2UgPSBlZGdlc1tlZGdlSW5kaWNlc1tpXV07CiAgICAgICAgICAgIGlmIChlZGdlLmlzT3ZlcmxhcHBpbmdXaXRoKHBvaW50ZXJPYmopID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgaWYgKGVkZ2UuY29ubmVjdGVkID09PSB0cnVlICYmIGVkZ2UuZ2V0VGl0bGUoKSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBvdmVybGFwcGluZ0VkZ2VzLnB1c2goZWRnZUluZGljZXNbaV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChvdmVybGFwcGluZ0VkZ2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhpcy5wb3B1cE9iaiA9IGVkZ2VzW292ZXJsYXBwaW5nRWRnZXNbb3ZlcmxhcHBpbmdFZGdlcy5sZW5ndGggLSAxXV07CiAgICAgICAgICAgIHBvcHVwVHlwZSA9ICdlZGdlJzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLnBvcHVwT2JqICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8vIHNob3cgcG9wdXAgbWVzc2FnZSB3aW5kb3cKICAgICAgICAgIGlmICh0aGlzLnBvcHVwT2JqLmlkICE9PSBwcmV2aW91c1BvcHVwT2JqSWQpIHsKICAgICAgICAgICAgaWYgKHRoaXMucG9wdXAgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRoaXMucG9wdXAgPSBuZXcgX2NvbXBvbmVudHNQb3B1cDJbJ2RlZmF1bHQnXSh0aGlzLmNhbnZhcy5mcmFtZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucG9wdXAucG9wdXBUYXJnZXRUeXBlID0gcG9wdXBUeXBlOwogICAgICAgICAgICB0aGlzLnBvcHVwLnBvcHVwVGFyZ2V0SWQgPSB0aGlzLnBvcHVwT2JqLmlkOwoKICAgICAgICAgICAgLy8gYWRqdXN0IGEgc21hbGwgb2Zmc2V0IHN1Y2ggdGhhdCB0aGUgbW91c2UgY3Vyc29yIGlzIGxvY2F0ZWQgaW4gdGhlCiAgICAgICAgICAgIC8vIGJvdHRvbSBsZWZ0IGxvY2F0aW9uIG9mIHRoZSBwb3B1cCwgYW5kIHlvdSBjYW4gZWFzaWx5IG1vdmUgb3ZlciB0aGUKICAgICAgICAgICAgLy8gcG9wdXAgYXJlYQogICAgICAgICAgICB0aGlzLnBvcHVwLnNldFBvc2l0aW9uKHBvaW50ZXIueCArIDMsIHBvaW50ZXIueSAtIDUpOwogICAgICAgICAgICB0aGlzLnBvcHVwLnNldFRleHQodGhpcy5wb3B1cE9iai5nZXRUaXRsZSgpKTsKICAgICAgICAgICAgdGhpcy5wb3B1cC5zaG93KCk7CiAgICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ3Nob3dQb3B1cCcsIHRoaXMucG9wdXBPYmouaWQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5wb3B1cCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMucG9wdXAuaGlkZSgpOwogICAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdoaWRlUG9wdXAnKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2NoZWNrSGlkZVBvcHVwJywKCiAgICAgIC8qKgogICAgICAgKiBDaGVjayBpZiB0aGUgcG9wdXAgbXVzdCBiZSBoaWRkZW4sIHdoaWNoIGlzIHRoZSBjYXNlIHdoZW4gdGhlIG1vdXNlIGlzIG5vCiAgICAgICAqIGxvbmdlciBob3ZlcmluZyBvbiB0aGUgb2JqZWN0CiAgICAgICAqIEBwYXJhbSB7e3g6TnVtYmVyLCB5Ok51bWJlcn19IHBvaW50ZXIKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY2hlY2tIaWRlUG9wdXAocG9pbnRlcikgewogICAgICAgIHZhciBwb2ludGVyT2JqID0gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLl9wb2ludGVyVG9Qb3NpdGlvbk9iamVjdChwb2ludGVyKTsKCiAgICAgICAgdmFyIHN0aWxsT25PYmogPSBmYWxzZTsKICAgICAgICBpZiAodGhpcy5wb3B1cC5wb3B1cFRhcmdldFR5cGUgPT09ICdub2RlJykgewogICAgICAgICAgaWYgKHRoaXMuYm9keS5ub2Rlc1t0aGlzLnBvcHVwLnBvcHVwVGFyZ2V0SWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgc3RpbGxPbk9iaiA9IHRoaXMuYm9keS5ub2Rlc1t0aGlzLnBvcHVwLnBvcHVwVGFyZ2V0SWRdLmlzT3ZlcmxhcHBpbmdXaXRoKHBvaW50ZXJPYmopOwoKICAgICAgICAgICAgLy8gaWYgdGhlIG1vdXNlIGlzIHN0aWxsIG9uZSB0aGUgbm9kZSwgd2UgaGF2ZSB0byBjaGVjayBpZiBpdCBpcyBub3QgYWxzbyBvbiBvbmUgdGhhdCBpcyBkcmF3biBvbiB0b3Agb2YgaXQuCiAgICAgICAgICAgIC8vIHdlIGluaXRpYWxseSBvbmx5IGNoZWNrIHN0aWxsT25PYmogYmVjYXVzZSB0aGlzIGlzIG11Y2ggZmFzdGVyLgogICAgICAgICAgICBpZiAoc3RpbGxPbk9iaiA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIHZhciBvdmVyTm9kZSA9IHRoaXMuc2VsZWN0aW9uSGFuZGxlci5nZXROb2RlQXQocG9pbnRlcik7CiAgICAgICAgICAgICAgc3RpbGxPbk9iaiA9IG92ZXJOb2RlLmlkID09PSB0aGlzLnBvcHVwLnBvcHVwVGFyZ2V0SWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uSGFuZGxlci5nZXROb2RlQXQocG9pbnRlcikgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAodGhpcy5ib2R5LmVkZ2VzW3RoaXMucG9wdXAucG9wdXBUYXJnZXRJZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHN0aWxsT25PYmogPSB0aGlzLmJvZHkuZWRnZXNbdGhpcy5wb3B1cC5wb3B1cFRhcmdldElkXS5pc092ZXJsYXBwaW5nV2l0aChwb2ludGVyT2JqKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHN0aWxsT25PYmogPT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLnBvcHVwT2JqID0gdW5kZWZpbmVkOwogICAgICAgICAgdGhpcy5wb3B1cC5oaWRlKCk7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdoaWRlUG9wdXAnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gSW50ZXJhY3Rpb25IYW5kbGVyOwogIH0pKCk7CgogIGV4cG9ydHNbJ2RlZmF1bHQnXSA9IEludGVyYWN0aW9uSGFuZGxlcjsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDEwMyAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgdmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwogIHZhciBIYW1tZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIzKTsKICB2YXIgaGFtbWVyVXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMjgpOwogIHZhciBrZXljaGFybSA9IF9fd2VicGFja19yZXF1aXJlX18oNDMpOwoKICB2YXIgTmF2aWdhdGlvbkhhbmRsZXIgPSAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gTmF2aWdhdGlvbkhhbmRsZXIoYm9keSwgY2FudmFzKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTmF2aWdhdGlvbkhhbmRsZXIpOwoKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5jYW52YXMgPSBjYW52YXM7CgogICAgICB0aGlzLmljb25zQ3JlYXRlZCA9IGZhbHNlOwogICAgICB0aGlzLm5hdmlnYXRpb25IYW1tZXJzID0gW107CiAgICAgIHRoaXMuYm91bmRGdW5jdGlvbnMgPSB7fTsKICAgICAgdGhpcy50b3VjaFRpbWUgPSAwOwogICAgICB0aGlzLmFjdGl2YXRlZCA9IGZhbHNlOwoKICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ3JlbGVhc2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuX3N0b3BNb3ZlbWVudCgpOwogICAgICB9KTsKICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ2FjdGl2YXRlJywgZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzLmFjdGl2YXRlZCA9IHRydWU7X3RoaXMuY29uZmlndXJlS2V5Ym9hcmRCaW5kaW5ncygpOwogICAgICB9KTsKICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ2RlYWN0aXZhdGUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuYWN0aXZhdGVkID0gZmFsc2U7X3RoaXMuY29uZmlndXJlS2V5Ym9hcmRCaW5kaW5ncygpOwogICAgICB9KTsKICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ2Rlc3Ryb3knLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKF90aGlzLmtleWNoYXJtICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIF90aGlzLmtleWNoYXJtLmRlc3Ryb3koKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdGhpcy5vcHRpb25zID0ge307CiAgICB9CgogICAgX2NyZWF0ZUNsYXNzKE5hdmlnYXRpb25IYW5kbGVyLCBbewogICAgICBrZXk6ICdzZXRPcHRpb25zJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykgewogICAgICAgIGlmIChvcHRpb25zICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgICAgICB0aGlzLmNyZWF0ZSgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdjcmVhdGUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKCkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMubmF2aWdhdGlvbkJ1dHRvbnMgPT09IHRydWUpIHsKICAgICAgICAgIGlmICh0aGlzLmljb25zQ3JlYXRlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhpcy5sb2FkTmF2aWdhdGlvbkVsZW1lbnRzKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmljb25zQ3JlYXRlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgdGhpcy5jbGVhbk5hdmlnYXRpb24oKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY29uZmlndXJlS2V5Ym9hcmRCaW5kaW5ncygpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2NsZWFuTmF2aWdhdGlvbicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhbk5hdmlnYXRpb24oKSB7CiAgICAgICAgLy8gY2xlYW4gaGFtbWVyIGJpbmRpbmdzCiAgICAgICAgaWYgKHRoaXMubmF2aWdhdGlvbkhhbW1lcnMubGVuZ3RoICE9IDApIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5uYXZpZ2F0aW9uSGFtbWVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0aGlzLm5hdmlnYXRpb25IYW1tZXJzW2ldLmRlc3Ryb3koKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMubmF2aWdhdGlvbkhhbW1lcnMgPSBbXTsKICAgICAgICB9CgogICAgICAgIC8vIGNsZWFuIHVwIHByZXZpb3VzIG5hdmlnYXRpb24gaXRlbXMKICAgICAgICBpZiAodGhpcy5uYXZpZ2F0aW9uRE9NICYmIHRoaXMubmF2aWdhdGlvbkRPTVsnd3JhcHBlciddICYmIHRoaXMubmF2aWdhdGlvbkRPTVsnd3JhcHBlciddLnBhcmVudE5vZGUpIHsKICAgICAgICAgIHRoaXMubmF2aWdhdGlvbkRPTVsnd3JhcHBlciddLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5uYXZpZ2F0aW9uRE9NWyd3cmFwcGVyJ10pOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5pY29uc0NyZWF0ZWQgPSBmYWxzZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdsb2FkTmF2aWdhdGlvbkVsZW1lbnRzJywKCiAgICAgIC8qKgogICAgICAgKiBDcmVhdGlvbiBvZiB0aGUgbmF2aWdhdGlvbiBjb250cm9scyBub2Rlcy4gVGhleSBhcmUgZHJhd24gb3ZlciB0aGUgcmVzdCBvZiB0aGUgbm9kZXMgYW5kIGFyZSBub3QgYWZmZWN0ZWQgYnkgc2NhbGUgYW5kIHRyYW5zbGF0aW9uCiAgICAgICAqIHRoZXkgaGF2ZSBhIHRyaWdnZXJGdW5jdGlvbiB3aGljaCBpcyBjYWxsZWQgb24gY2xpY2suIElmIHRoZSBwb3NpdGlvbiBvZiB0aGUgbmF2aWdhdGlvbiBjb250cm9scyBpcyBkZXBlbmRlbnQKICAgICAgICogb24gdGhpcy5mcmFtZS5jYW52YXMuY2xpZW50V2lkdGggb3IgdGhpcy5mcmFtZS5jYW52YXMuY2xpZW50SGVpZ2h0LCB3ZSBmbGFnIGhvcml6b250YWxBbGlnbkxlZnQgYW5kIHZlcnRpY2FsQWxpZ25Ub3AgZmFsc2UuCiAgICAgICAqIFRoaXMgbWVhbnMgdGhhdCB0aGUgbG9jYXRpb24gd2lsbCBiZSBjb3JyZWN0ZWQgYnkgdGhlIF9yZWxvY2F0ZU5hdmlnYXRpb24gZnVuY3Rpb24gb24gYSBzaXplIGNoYW5nZSBvZiB0aGUgY2FudmFzLgogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWROYXZpZ2F0aW9uRWxlbWVudHMoKSB7CiAgICAgICAgdGhpcy5jbGVhbk5hdmlnYXRpb24oKTsKCiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uRE9NID0ge307CiAgICAgICAgdmFyIG5hdmlnYXRpb25EaXZzID0gWyd1cCcsICdkb3duJywgJ2xlZnQnLCAncmlnaHQnLCAnem9vbUluJywgJ3pvb21PdXQnLCAnem9vbUV4dGVuZHMnXTsKICAgICAgICB2YXIgbmF2aWdhdGlvbkRpdkFjdGlvbnMgPSBbJ19tb3ZlVXAnLCAnX21vdmVEb3duJywgJ19tb3ZlTGVmdCcsICdfbW92ZVJpZ2h0JywgJ196b29tSW4nLCAnX3pvb21PdXQnLCAnX2ZpdCddOwoKICAgICAgICB0aGlzLm5hdmlnYXRpb25ET01bJ3dyYXBwZXInXSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHRoaXMubmF2aWdhdGlvbkRPTVsnd3JhcHBlciddLmNsYXNzTmFtZSA9ICd2aXMtbmF2aWdhdGlvbic7CiAgICAgICAgdGhpcy5jYW52YXMuZnJhbWUuYXBwZW5kQ2hpbGQodGhpcy5uYXZpZ2F0aW9uRE9NWyd3cmFwcGVyJ10pOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5hdmlnYXRpb25EaXZzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB0aGlzLm5hdmlnYXRpb25ET01bbmF2aWdhdGlvbkRpdnNbaV1dID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICB0aGlzLm5hdmlnYXRpb25ET01bbmF2aWdhdGlvbkRpdnNbaV1dLmNsYXNzTmFtZSA9ICd2aXMtYnV0dG9uIHZpcy0nICsgbmF2aWdhdGlvbkRpdnNbaV07CiAgICAgICAgICB0aGlzLm5hdmlnYXRpb25ET01bJ3dyYXBwZXInXS5hcHBlbmRDaGlsZCh0aGlzLm5hdmlnYXRpb25ET01bbmF2aWdhdGlvbkRpdnNbaV1dKTsKCiAgICAgICAgICB2YXIgaGFtbWVyID0gbmV3IEhhbW1lcih0aGlzLm5hdmlnYXRpb25ET01bbmF2aWdhdGlvbkRpdnNbaV1dKTsKICAgICAgICAgIGlmIChuYXZpZ2F0aW9uRGl2QWN0aW9uc1tpXSA9PT0gJ19maXQnKSB7CiAgICAgICAgICAgIGhhbW1lclV0aWwub25Ub3VjaChoYW1tZXIsIHRoaXMuX2ZpdC5iaW5kKHRoaXMpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhhbW1lclV0aWwub25Ub3VjaChoYW1tZXIsIHRoaXMuYmluZFRvUmVkcmF3LmJpbmQodGhpcywgbmF2aWdhdGlvbkRpdkFjdGlvbnNbaV0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLm5hdmlnYXRpb25IYW1tZXJzLnB1c2goaGFtbWVyKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuaWNvbnNDcmVhdGVkID0gdHJ1ZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdiaW5kVG9SZWRyYXcnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gYmluZFRvUmVkcmF3KGFjdGlvbikgewogICAgICAgIGlmICh0aGlzLmJvdW5kRnVuY3Rpb25zW2FjdGlvbl0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5ib3VuZEZ1bmN0aW9uc1thY3Rpb25dID0gdGhpc1thY3Rpb25dLmJpbmQodGhpcyk7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignaW5pdFJlZHJhdycsIHRoaXMuYm91bmRGdW5jdGlvbnNbYWN0aW9uXSk7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfc3RhcnRSZW5kZXJpbmcnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAndW5iaW5kRnJvbVJlZHJhdycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiB1bmJpbmRGcm9tUmVkcmF3KGFjdGlvbikgewogICAgICAgIGlmICh0aGlzLmJvdW5kRnVuY3Rpb25zW2FjdGlvbl0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub2ZmKCdpbml0UmVkcmF3JywgdGhpcy5ib3VuZEZ1bmN0aW9uc1thY3Rpb25dKTsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19zdG9wUmVuZGVyaW5nJyk7CiAgICAgICAgICBkZWxldGUgdGhpcy5ib3VuZEZ1bmN0aW9uc1thY3Rpb25dOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZml0JywKCiAgICAgIC8qKgogICAgICAgKiB0aGlzIHN0b3BzIGFsbCBtb3ZlbWVudCBpbmR1Y2VkIGJ5IHRoZSBuYXZpZ2F0aW9uIGJ1dHRvbnMKICAgICAgICoKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZml0KCkgewogICAgICAgIGlmIChuZXcgRGF0ZSgpLnZhbHVlT2YoKSAtIHRoaXMudG91Y2hUaW1lID4gNzAwKSB7CiAgICAgICAgICAvLyBUT0RPOiBmaXggdWdseSBoYWNrIHRvIGF2b2lkIGhhbW1lcidzIGRvdWJsZSBmaXJlaW5nIG9mIGV2ZW50IChiZWNhdXNlIHdlIHVzZSByZWxlYXNlPykKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ2ZpdCcsIHsgZHVyYXRpb246IDcwMCB9KTsKICAgICAgICAgIHRoaXMudG91Y2hUaW1lID0gbmV3IERhdGUoKS52YWx1ZU9mKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19zdG9wTW92ZW1lbnQnLAoKICAgICAgLyoqCiAgICAgICAqIHRoaXMgc3RvcHMgYWxsIG1vdmVtZW50IGluZHVjZWQgYnkgdGhlIG5hdmlnYXRpb24gYnV0dG9ucwogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zdG9wTW92ZW1lbnQoKSB7CiAgICAgICAgZm9yICh2YXIgYm91bmRBY3Rpb24gaW4gdGhpcy5ib3VuZEZ1bmN0aW9ucykgewogICAgICAgICAgaWYgKHRoaXMuYm91bmRGdW5jdGlvbnMuaGFzT3duUHJvcGVydHkoYm91bmRBY3Rpb24pKSB7CiAgICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLm9mZignaW5pdFJlZHJhdycsIHRoaXMuYm91bmRGdW5jdGlvbnNbYm91bmRBY3Rpb25dKTsKICAgICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3N0b3BSZW5kZXJpbmcnKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5ib3VuZEZ1bmN0aW9ucyA9IHt9OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19tb3ZlVXAnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX21vdmVVcCgpIHsKICAgICAgICB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbi55ICs9IHRoaXMub3B0aW9ucy5rZXlib2FyZC5zcGVlZC55OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19tb3ZlRG93bicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfbW92ZURvd24oKSB7CiAgICAgICAgdGhpcy5ib2R5LnZpZXcudHJhbnNsYXRpb24ueSAtPSB0aGlzLm9wdGlvbnMua2V5Ym9hcmQuc3BlZWQueTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfbW92ZUxlZnQnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX21vdmVMZWZ0KCkgewogICAgICAgIHRoaXMuYm9keS52aWV3LnRyYW5zbGF0aW9uLnggKz0gdGhpcy5vcHRpb25zLmtleWJvYXJkLnNwZWVkLng7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX21vdmVSaWdodCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfbW92ZVJpZ2h0KCkgewogICAgICAgIHRoaXMuYm9keS52aWV3LnRyYW5zbGF0aW9uLnggLT0gdGhpcy5vcHRpb25zLmtleWJvYXJkLnNwZWVkLng7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3pvb21JbicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfem9vbUluKCkgewogICAgICAgIHRoaXMuYm9keS52aWV3LnNjYWxlICo9IDEgKyB0aGlzLm9wdGlvbnMua2V5Ym9hcmQuc3BlZWQuem9vbTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfem9vbU91dCcsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfem9vbU91dCgpIHsKICAgICAgICB0aGlzLmJvZHkudmlldy5zY2FsZSAvPSAxICsgdGhpcy5vcHRpb25zLmtleWJvYXJkLnNwZWVkLnpvb207CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnY29uZmlndXJlS2V5Ym9hcmRCaW5kaW5ncycsCgogICAgICAvKioKICAgICAgICogYmluZCBhbGwga2V5cyB1c2luZyBrZXljaGFybS4KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb25maWd1cmVLZXlib2FyZEJpbmRpbmdzKCkgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICBpZiAodGhpcy5rZXljaGFybSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLmtleWNoYXJtLmRlc3Ryb3koKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMua2V5Ym9hcmQuZW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5rZXlib2FyZC5iaW5kVG9XaW5kb3cgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy5rZXljaGFybSA9IGtleWNoYXJtKHsgY29udGFpbmVyOiB3aW5kb3csIHByZXZlbnREZWZhdWx0OiB0cnVlIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5rZXljaGFybSA9IGtleWNoYXJtKHsgY29udGFpbmVyOiB0aGlzLmNhbnZhcy5mcmFtZSwgcHJldmVudERlZmF1bHQ6IHRydWUgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5rZXljaGFybS5yZXNldCgpOwoKICAgICAgICAgIGlmICh0aGlzLmFjdGl2YXRlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aGlzLmtleWNoYXJtLmJpbmQoJ3VwJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIF90aGlzMi5iaW5kVG9SZWRyYXcoJ19tb3ZlVXAnKTsKICAgICAgICAgICAgfSwgJ2tleWRvd24nKTsKICAgICAgICAgICAgdGhpcy5rZXljaGFybS5iaW5kKCdkb3duJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIF90aGlzMi5iaW5kVG9SZWRyYXcoJ19tb3ZlRG93bicpOwogICAgICAgICAgICB9LCAna2V5ZG93bicpOwogICAgICAgICAgICB0aGlzLmtleWNoYXJtLmJpbmQoJ2xlZnQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLmJpbmRUb1JlZHJhdygnX21vdmVMZWZ0Jyk7CiAgICAgICAgICAgIH0sICdrZXlkb3duJyk7CiAgICAgICAgICAgIHRoaXMua2V5Y2hhcm0uYmluZCgncmlnaHQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLmJpbmRUb1JlZHJhdygnX21vdmVSaWdodCcpOwogICAgICAgICAgICB9LCAna2V5ZG93bicpOwogICAgICAgICAgICB0aGlzLmtleWNoYXJtLmJpbmQoJz0nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLmJpbmRUb1JlZHJhdygnX3pvb21JbicpOwogICAgICAgICAgICB9LCAna2V5ZG93bicpOwogICAgICAgICAgICB0aGlzLmtleWNoYXJtLmJpbmQoJ251bSsnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLmJpbmRUb1JlZHJhdygnX3pvb21JbicpOwogICAgICAgICAgICB9LCAna2V5ZG93bicpOwogICAgICAgICAgICB0aGlzLmtleWNoYXJtLmJpbmQoJ251bS0nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLmJpbmRUb1JlZHJhdygnX3pvb21PdXQnKTsKICAgICAgICAgICAgfSwgJ2tleWRvd24nKTsKICAgICAgICAgICAgdGhpcy5rZXljaGFybS5iaW5kKCctJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIF90aGlzMi5iaW5kVG9SZWRyYXcoJ196b29tT3V0Jyk7CiAgICAgICAgICAgIH0sICdrZXlkb3duJyk7CiAgICAgICAgICAgIHRoaXMua2V5Y2hhcm0uYmluZCgnWycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpczIuYmluZFRvUmVkcmF3KCdfem9vbU91dCcpOwogICAgICAgICAgICB9LCAna2V5ZG93bicpOwogICAgICAgICAgICB0aGlzLmtleWNoYXJtLmJpbmQoJ10nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLmJpbmRUb1JlZHJhdygnX3pvb21JbicpOwogICAgICAgICAgICB9LCAna2V5ZG93bicpOwogICAgICAgICAgICB0aGlzLmtleWNoYXJtLmJpbmQoJ3BhZ2V1cCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpczIuYmluZFRvUmVkcmF3KCdfem9vbUluJyk7CiAgICAgICAgICAgIH0sICdrZXlkb3duJyk7CiAgICAgICAgICAgIHRoaXMua2V5Y2hhcm0uYmluZCgncGFnZWRvd24nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLmJpbmRUb1JlZHJhdygnX3pvb21PdXQnKTsKICAgICAgICAgICAgfSwgJ2tleWRvd24nKTsKCiAgICAgICAgICAgIHRoaXMua2V5Y2hhcm0uYmluZCgndXAnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLnVuYmluZEZyb21SZWRyYXcoJ19tb3ZlVXAnKTsKICAgICAgICAgICAgfSwgJ2tleXVwJyk7CiAgICAgICAgICAgIHRoaXMua2V5Y2hhcm0uYmluZCgnZG93bicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpczIudW5iaW5kRnJvbVJlZHJhdygnX21vdmVEb3duJyk7CiAgICAgICAgICAgIH0sICdrZXl1cCcpOwogICAgICAgICAgICB0aGlzLmtleWNoYXJtLmJpbmQoJ2xlZnQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLnVuYmluZEZyb21SZWRyYXcoJ19tb3ZlTGVmdCcpOwogICAgICAgICAgICB9LCAna2V5dXAnKTsKICAgICAgICAgICAgdGhpcy5rZXljaGFybS5iaW5kKCdyaWdodCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpczIudW5iaW5kRnJvbVJlZHJhdygnX21vdmVSaWdodCcpOwogICAgICAgICAgICB9LCAna2V5dXAnKTsKICAgICAgICAgICAgdGhpcy5rZXljaGFybS5iaW5kKCc9JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIF90aGlzMi51bmJpbmRGcm9tUmVkcmF3KCdfem9vbUluJyk7CiAgICAgICAgICAgIH0sICdrZXl1cCcpOwogICAgICAgICAgICB0aGlzLmtleWNoYXJtLmJpbmQoJ251bSsnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLnVuYmluZEZyb21SZWRyYXcoJ196b29tSW4nKTsKICAgICAgICAgICAgfSwgJ2tleXVwJyk7CiAgICAgICAgICAgIHRoaXMua2V5Y2hhcm0uYmluZCgnbnVtLScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpczIudW5iaW5kRnJvbVJlZHJhdygnX3pvb21PdXQnKTsKICAgICAgICAgICAgfSwgJ2tleXVwJyk7CiAgICAgICAgICAgIHRoaXMua2V5Y2hhcm0uYmluZCgnLScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpczIudW5iaW5kRnJvbVJlZHJhdygnX3pvb21PdXQnKTsKICAgICAgICAgICAgfSwgJ2tleXVwJyk7CiAgICAgICAgICAgIHRoaXMua2V5Y2hhcm0uYmluZCgnWycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpczIudW5iaW5kRnJvbVJlZHJhdygnX3pvb21PdXQnKTsKICAgICAgICAgICAgfSwgJ2tleXVwJyk7CiAgICAgICAgICAgIHRoaXMua2V5Y2hhcm0uYmluZCgnXScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBfdGhpczIudW5iaW5kRnJvbVJlZHJhdygnX3pvb21JbicpOwogICAgICAgICAgICB9LCAna2V5dXAnKTsKICAgICAgICAgICAgdGhpcy5rZXljaGFybS5iaW5kKCdwYWdldXAnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLnVuYmluZEZyb21SZWRyYXcoJ196b29tSW4nKTsKICAgICAgICAgICAgfSwgJ2tleXVwJyk7CiAgICAgICAgICAgIHRoaXMua2V5Y2hhcm0uYmluZCgncGFnZWRvd24nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgX3RoaXMyLnVuYmluZEZyb21SZWRyYXcoJ196b29tT3V0Jyk7CiAgICAgICAgICAgIH0sICdrZXl1cCcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBOYXZpZ2F0aW9uSGFuZGxlcjsKICB9KSgpOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBOYXZpZ2F0aW9uSGFuZGxlcjsKICBtb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCi8qKiovIH0sCi8qIDEwNCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgLyoqCiAgICogUG9wdXAgaXMgYSBjbGFzcyB0byBjcmVhdGUgYSBwb3B1cCB3aW5kb3cgd2l0aCBzb21lIHRleHQKICAgKiBAcGFyYW0ge0VsZW1lbnR9ICBjb250YWluZXIgICAgIFRoZSBjb250YWluZXIgb2JqZWN0LgogICAqIEBwYXJhbSB7TnVtYmVyfSBbeF0KICAgKiBAcGFyYW0ge051bWJlcn0gW3ldCiAgICogQHBhcmFtIHtTdHJpbmd9IFt0ZXh0XQogICAqIEBwYXJhbSB7T2JqZWN0fSBbc3R5bGVdICAgICBBbiBvYmplY3QgY29udGFpbmluZyBib3JkZXJDb2xvciwKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yLCBldGMuCiAgICovCiAgJ3VzZSBzdHJpY3QnOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgICB2YWx1ZTogdHJ1ZQogIH0pOwoKICB2YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpOwoKICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbicpOyB9IH0KCiAgdmFyIFBvcHVwID0gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIFBvcHVwKGNvbnRhaW5lcikgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUG9wdXApOwoKICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7CgogICAgICB0aGlzLnggPSAwOwogICAgICB0aGlzLnkgPSAwOwogICAgICB0aGlzLnBhZGRpbmcgPSA1OwogICAgICB0aGlzLmhpZGRlbiA9IGZhbHNlOwoKICAgICAgLy8gY3JlYXRlIHRoZSBmcmFtZQogICAgICB0aGlzLmZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHRoaXMuZnJhbWUuY2xhc3NOYW1lID0gJ3Zpcy1uZXR3b3JrLXRvb2x0aXAnOwogICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmZyYW1lKTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoUG9wdXAsIFt7CiAgICAgIGtleTogJ3NldFBvc2l0aW9uJywKCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0ge251bWJlcn0geCAgIEhvcml6b250YWwgcG9zaXRpb24gb2YgdGhlIHBvcHVwIHdpbmRvdwogICAgICAgKiBAcGFyYW0ge251bWJlcn0geSAgIFZlcnRpY2FsIHBvc2l0aW9uIG9mIHRoZSBwb3B1cCB3aW5kb3cKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRQb3NpdGlvbih4LCB5KSB7CiAgICAgICAgdGhpcy54ID0gcGFyc2VJbnQoeCk7CiAgICAgICAgdGhpcy55ID0gcGFyc2VJbnQoeSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc2V0VGV4dCcsCgogICAgICAvKioKICAgICAgICogU2V0IHRoZSBjb250ZW50IGZvciB0aGUgcG9wdXAgd2luZG93LiBUaGlzIGNhbiBiZSBIVE1MIGNvZGUgb3IgdGV4dC4KICAgICAgICogQHBhcmFtIHtzdHJpbmcgfCBFbGVtZW50fSBjb250ZW50CiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VGV4dChjb250ZW50KSB7CiAgICAgICAgaWYgKGNvbnRlbnQgaW5zdGFuY2VvZiBFbGVtZW50KSB7CiAgICAgICAgICB0aGlzLmZyYW1lLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgdGhpcy5mcmFtZS5hcHBlbmRDaGlsZChjb250ZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5mcmFtZS5pbm5lckhUTUwgPSBjb250ZW50OyAvLyBzdHJpbmcgY29udGFpbmluZyB0ZXh0IG9yIEhUTUwKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc2hvdycsCgogICAgICAvKioKICAgICAgICogU2hvdyB0aGUgcG9wdXAgd2luZG93CiAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2RvU2hvd10gICAgU2hvdyBvciBoaWRlIHRoZSB3aW5kb3cKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzaG93KGRvU2hvdykgewogICAgICAgIGlmIChkb1Nob3cgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgZG9TaG93ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChkb1Nob3cgPT09IHRydWUpIHsKICAgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmZyYW1lLmNsaWVudEhlaWdodDsKICAgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZnJhbWUuY2xpZW50V2lkdGg7CiAgICAgICAgICB2YXIgbWF4SGVpZ2h0ID0gdGhpcy5mcmFtZS5wYXJlbnROb2RlLmNsaWVudEhlaWdodDsKICAgICAgICAgIHZhciBtYXhXaWR0aCA9IHRoaXMuZnJhbWUucGFyZW50Tm9kZS5jbGllbnRXaWR0aDsKCiAgICAgICAgICB2YXIgdG9wID0gdGhpcy55IC0gaGVpZ2h0OwogICAgICAgICAgaWYgKHRvcCArIGhlaWdodCArIHRoaXMucGFkZGluZyA+IG1heEhlaWdodCkgewogICAgICAgICAgICB0b3AgPSBtYXhIZWlnaHQgLSBoZWlnaHQgLSB0aGlzLnBhZGRpbmc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodG9wIDwgdGhpcy5wYWRkaW5nKSB7CiAgICAgICAgICAgIHRvcCA9IHRoaXMucGFkZGluZzsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbGVmdCA9IHRoaXMueDsKICAgICAgICAgIGlmIChsZWZ0ICsgd2lkdGggKyB0aGlzLnBhZGRpbmcgPiBtYXhXaWR0aCkgewogICAgICAgICAgICBsZWZ0ID0gbWF4V2lkdGggLSB3aWR0aCAtIHRoaXMucGFkZGluZzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChsZWZ0IDwgdGhpcy5wYWRkaW5nKSB7CiAgICAgICAgICAgIGxlZnQgPSB0aGlzLnBhZGRpbmc7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5mcmFtZS5zdHlsZS5sZWZ0ID0gbGVmdCArICdweCc7CiAgICAgICAgICB0aGlzLmZyYW1lLnN0eWxlLnRvcCA9IHRvcCArICdweCc7CiAgICAgICAgICB0aGlzLmZyYW1lLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7CiAgICAgICAgICB0aGlzLmhpZGRlbiA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnaGlkZScsCgogICAgICAvKioKICAgICAgICogSGlkZSB0aGUgcG9wdXAgd2luZG93CiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gaGlkZSgpIHsKICAgICAgICB0aGlzLmhpZGRlbiA9IHRydWU7CiAgICAgICAgdGhpcy5mcmFtZS5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7CiAgICAgIH0KICAgIH1dKTsKCiAgICByZXR1cm4gUG9wdXA7CiAgfSkoKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gUG9wdXA7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiAxMDUgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICJ1c2Ugc3RyaWN0IjsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgogIHZhciBOb2RlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Mik7CiAgdmFyIEVkZ2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgyKTsKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CgogIHZhciBTZWxlY3Rpb25IYW5kbGVyID0gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIFNlbGVjdGlvbkhhbmRsZXIoYm9keSwgY2FudmFzKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2VsZWN0aW9uSGFuZGxlcik7CgogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLmNhbnZhcyA9IGNhbnZhczsKICAgICAgdGhpcy5zZWxlY3Rpb25PYmogPSB7IG5vZGVzOiBbXSwgZWRnZXM6IFtdIH07CiAgICAgIHRoaXMuaG92ZXJPYmogPSB7IG5vZGVzOiB7fSwgZWRnZXM6IHt9IH07CgogICAgICB0aGlzLm9wdGlvbnMgPSB7fTsKICAgICAgdGhpcy5kZWZhdWx0T3B0aW9ucyA9IHsKICAgICAgICBtdWx0aXNlbGVjdDogZmFsc2UsCiAgICAgICAgc2VsZWN0YWJsZTogdHJ1ZSwKICAgICAgICBzZWxlY3RDb25uZWN0ZWRFZGdlczogdHJ1ZSwKICAgICAgICBob3ZlckNvbm5lY3RlZEVkZ2VzOiB0cnVlCiAgICAgIH07CiAgICAgIHV0aWwuZXh0ZW5kKHRoaXMub3B0aW9ucywgdGhpcy5kZWZhdWx0T3B0aW9ucyk7CgogICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbigiX2RhdGFDaGFuZ2VkIiwgZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzLnVwZGF0ZVNlbGVjdGlvbigpOwogICAgICB9KTsKICAgIH0KCiAgICBfY3JlYXRlQ2xhc3MoU2VsZWN0aW9uSGFuZGxlciwgW3sKICAgICAga2V5OiAic2V0T3B0aW9ucyIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdGlvbnMpIHsKICAgICAgICBpZiAob3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgZmllbGRzID0gWyJtdWx0aXNlbGVjdCIsICJob3ZlckNvbm5lY3RlZEVkZ2VzIiwgInNlbGVjdGFibGUiLCAic2VsZWN0Q29ubmVjdGVkRWRnZXMiXTsKICAgICAgICAgIHV0aWwuc2VsZWN0aXZlRGVlcEV4dGVuZChmaWVsZHMsIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInNlbGVjdE9uUG9pbnQiLAoKICAgICAgLyoqCiAgICAgICAqIGhhbmRsZXMgdGhlIHNlbGVjdGlvbiBwYXJ0IG9mIHRoZSB0YXA7CiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwb2ludGVyCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc2VsZWN0T25Qb2ludChwb2ludGVyKSB7CiAgICAgICAgdmFyIHNlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zZWxlY3RhYmxlID09PSB0cnVlKSB7CiAgICAgICAgICB2YXIgb2JqID0gdGhpcy5nZXROb2RlQXQocG9pbnRlcikgfHwgdGhpcy5nZXRFZGdlQXQocG9pbnRlcik7CgogICAgICAgICAgLy8gdW5zZWxlY3QgYWZ0ZXIgZ2V0dGluZyB0aGUgb2JqZWN0cyBpbiBvcmRlciB0byByZXN0b3JlIHdpZHRoIGFuZCBoZWlnaHQuCiAgICAgICAgICB0aGlzLnVuc2VsZWN0QWxsKCk7CgogICAgICAgICAgaWYgKG9iaiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHNlbGVjdGVkID0gdGhpcy5zZWxlY3RPYmplY3Qob2JqKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoIl9yZXF1ZXN0UmVkcmF3Iik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxlY3RlZDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJzZWxlY3RBZGRpdGlvbmFsT25Qb2ludCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3RBZGRpdGlvbmFsT25Qb2ludChwb2ludGVyKSB7CiAgICAgICAgdmFyIHNlbGVjdGlvbkNoYW5nZWQgPSBmYWxzZTsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNlbGVjdGFibGUgPT09IHRydWUpIHsKICAgICAgICAgIHZhciBvYmogPSB0aGlzLmdldE5vZGVBdChwb2ludGVyKSB8fCB0aGlzLmdldEVkZ2VBdChwb2ludGVyKTsKCiAgICAgICAgICBpZiAob2JqICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgc2VsZWN0aW9uQ2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIGlmIChvYmouaXNTZWxlY3RlZCgpID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgdGhpcy5kZXNlbGVjdE9iamVjdChvYmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuc2VsZWN0T2JqZWN0KG9iaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoIl9yZXF1ZXN0UmVkcmF3Iik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZWxlY3Rpb25DaGFuZ2VkOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9nZW5lcmF0ZUNsaWNrRXZlbnQiLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2dlbmVyYXRlQ2xpY2tFdmVudChldmVudFR5cGUsIGV2ZW50LCBwb2ludGVyLCBvbGRTZWxlY3Rpb24pIHsKICAgICAgICB2YXIgZW1wdHlTZWxlY3Rpb24gPSBhcmd1bWVudHNbNF0gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogYXJndW1lbnRzWzRdOwoKICAgICAgICB2YXIgcHJvcGVydGllcyA9IHVuZGVmaW5lZDsKICAgICAgICBpZiAoZW1wdHlTZWxlY3Rpb24gPT09IHRydWUpIHsKICAgICAgICAgIHByb3BlcnRpZXMgPSB7IG5vZGVzOiBbXSwgZWRnZXM6IFtdIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByb3BlcnRpZXMgPSB0aGlzLmdldFNlbGVjdGlvbigpOwogICAgICAgIH0KICAgICAgICBwcm9wZXJ0aWVzWyJwb2ludGVyIl0gPSB7CiAgICAgICAgICBET006IHsgeDogcG9pbnRlci54LCB5OiBwb2ludGVyLnkgfSwKICAgICAgICAgIGNhbnZhczogdGhpcy5jYW52YXMuRE9NdG9DYW52YXMocG9pbnRlcikKICAgICAgICB9OwogICAgICAgIHByb3BlcnRpZXNbImV2ZW50Il0gPSBldmVudDsKCiAgICAgICAgaWYgKG9sZFNlbGVjdGlvbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBwcm9wZXJ0aWVzWyJwcmV2aW91c1NlbGVjdGlvbiJdID0gb2xkU2VsZWN0aW9uOwogICAgICAgIH0KICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KGV2ZW50VHlwZSwgcHJvcGVydGllcyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAic2VsZWN0T2JqZWN0IiwKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNlbGVjdE9iamVjdChvYmopIHsKICAgICAgICB2YXIgaGlnaGxpZ2h0RWRnZXMgPSBhcmd1bWVudHNbMV0gPT09IHVuZGVmaW5lZCA/IHRoaXMub3B0aW9ucy5zZWxlY3RDb25uZWN0ZWRFZGdlcyA6IGFyZ3VtZW50c1sxXTsKCiAgICAgICAgaWYgKG9iaiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgTm9kZSkgewogICAgICAgICAgICBpZiAoaGlnaGxpZ2h0RWRnZXMgPT09IHRydWUpIHsKICAgICAgICAgICAgICB0aGlzLl9zZWxlY3RDb25uZWN0ZWRFZGdlcyhvYmopOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBvYmouc2VsZWN0KCk7CiAgICAgICAgICB0aGlzLl9hZGRUb1NlbGVjdGlvbihvYmopOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJkZXNlbGVjdE9iamVjdCIsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBkZXNlbGVjdE9iamVjdChvYmopIHsKICAgICAgICBpZiAob2JqLmlzU2VsZWN0ZWQoKSA9PT0gdHJ1ZSkgewogICAgICAgICAgb2JqLnNlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgICB0aGlzLl9yZW1vdmVGcm9tU2VsZWN0aW9uKG9iaik7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9nZXRBbGxOb2Rlc092ZXJsYXBwaW5nV2l0aCIsCgogICAgICAvKioKICAgICAgICogcmV0cmlldmUgYWxsIG5vZGVzIG92ZXJsYXBwaW5nIHdpdGggZ2l2ZW4gb2JqZWN0CiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgIEFuIG9iamVjdCB3aXRoIHBhcmFtZXRlcnMgbGVmdCwgdG9wLCByaWdodCwgYm90dG9tCiAgICAgICAqIEByZXR1cm4ge051bWJlcltdfSAgIEFuIGFycmF5IHdpdGggaWQncyBvZiB0aGUgb3ZlcmxhcHBpbmcgbm9kZXMKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0QWxsTm9kZXNPdmVybGFwcGluZ1dpdGgob2JqZWN0KSB7CiAgICAgICAgdmFyIG92ZXJsYXBwaW5nTm9kZXMgPSBbXTsKICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLmJvZHkubm9kZXM7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJvZHkubm9kZUluZGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBub2RlSWQgPSB0aGlzLmJvZHkubm9kZUluZGljZXNbaV07CiAgICAgICAgICBpZiAobm9kZXNbbm9kZUlkXS5pc092ZXJsYXBwaW5nV2l0aChvYmplY3QpKSB7CiAgICAgICAgICAgIG92ZXJsYXBwaW5nTm9kZXMucHVzaChub2RlSWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gb3ZlcmxhcHBpbmdOb2RlczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfcG9pbnRlclRvUG9zaXRpb25PYmplY3QiLAoKICAgICAgLyoqCiAgICAgICAqIFJldHVybiBhIHBvc2l0aW9uIG9iamVjdCBpbiBjYW52YXNzcGFjZSBmcm9tIGEgc2luZ2xlIHBvaW50IGluIHNjcmVlbnNwYWNlCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSBwb2ludGVyCiAgICAgICAqIEByZXR1cm5zIHt7bGVmdDogbnVtYmVyLCB0b3A6IG51bWJlciwgcmlnaHQ6IG51bWJlciwgYm90dG9tOiBudW1iZXJ9fQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wb2ludGVyVG9Qb3NpdGlvbk9iamVjdChwb2ludGVyKSB7CiAgICAgICAgdmFyIGNhbnZhc1BvcyA9IHRoaXMuY2FudmFzLkRPTXRvQ2FudmFzKHBvaW50ZXIpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsZWZ0OiBjYW52YXNQb3MueCAtIDEsCiAgICAgICAgICB0b3A6IGNhbnZhc1Bvcy55ICsgMSwKICAgICAgICAgIHJpZ2h0OiBjYW52YXNQb3MueCArIDEsCiAgICAgICAgICBib3R0b206IGNhbnZhc1Bvcy55IC0gMQogICAgICAgIH07CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0Tm9kZUF0IiwKCiAgICAgIC8qKgogICAgICAgKiBHZXQgdGhlIHRvcCBub2RlIGF0IHRoZSBhIHNwZWNpZmljIHBvaW50IChsaWtlIGEgY2xpY2spCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7e3g6IE51bWJlciwgeTogTnVtYmVyfX0gcG9pbnRlcgogICAgICAgKiBAcmV0dXJuIHtOb2RlIHwgdW5kZWZpbmVkfSBub2RlCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Tm9kZUF0KHBvaW50ZXIpIHsKICAgICAgICB2YXIgcmV0dXJuTm9kZSA9IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGFyZ3VtZW50c1sxXTsKCiAgICAgICAgLy8gd2UgZmlyc3QgY2hlY2sgaWYgdGhpcyBpcyBhbiBuYXZpZ2F0aW9uIGNvbnRyb2xzIGVsZW1lbnQKICAgICAgICB2YXIgcG9zaXRpb25PYmplY3QgPSB0aGlzLl9wb2ludGVyVG9Qb3NpdGlvbk9iamVjdChwb2ludGVyKTsKICAgICAgICB2YXIgb3ZlcmxhcHBpbmdOb2RlcyA9IHRoaXMuX2dldEFsbE5vZGVzT3ZlcmxhcHBpbmdXaXRoKHBvc2l0aW9uT2JqZWN0KTsKICAgICAgICAvLyBpZiB0aGVyZSBhcmUgb3ZlcmxhcHBpbmcgbm9kZXMsIHNlbGVjdCB0aGUgbGFzdCBvbmUsIHRoaXMgaXMgdGhlCiAgICAgICAgLy8gb25lIHdoaWNoIGlzIGRyYXduIG9uIHRvcCBvZiB0aGUgb3RoZXJzCiAgICAgICAgaWYgKG92ZXJsYXBwaW5nTm9kZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgaWYgKHJldHVybk5vZGUgPT09IHRydWUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYm9keS5ub2Rlc1tvdmVybGFwcGluZ05vZGVzW292ZXJsYXBwaW5nTm9kZXMubGVuZ3RoIC0gMV1dOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG92ZXJsYXBwaW5nTm9kZXNbb3ZlcmxhcHBpbmdOb2Rlcy5sZW5ndGggLSAxXTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX2dldEVkZ2VzT3ZlcmxhcHBpbmdXaXRoIiwKCiAgICAgIC8qKgogICAgICAgKiByZXRyaWV2ZSBhbGwgZWRnZXMgb3ZlcmxhcHBpbmcgd2l0aCBnaXZlbiBvYmplY3QsIHNlbGVjdG9yIGlzIGFyb3VuZCBjZW50ZXIKICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCAgQW4gb2JqZWN0IHdpdGggcGFyYW1ldGVycyBsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20KICAgICAgICogQHJldHVybiB7TnVtYmVyW119ICAgQW4gYXJyYXkgd2l0aCBpZCdzIG9mIHRoZSBvdmVybGFwcGluZyBub2RlcwogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRFZGdlc092ZXJsYXBwaW5nV2l0aChvYmplY3QsIG92ZXJsYXBwaW5nRWRnZXMpIHsKICAgICAgICB2YXIgZWRnZXMgPSB0aGlzLmJvZHkuZWRnZXM7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmJvZHkuZWRnZUluZGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBlZGdlSWQgPSB0aGlzLmJvZHkuZWRnZUluZGljZXNbaV07CiAgICAgICAgICBpZiAoZWRnZXNbZWRnZUlkXS5pc092ZXJsYXBwaW5nV2l0aChvYmplY3QpKSB7CiAgICAgICAgICAgIG92ZXJsYXBwaW5nRWRnZXMucHVzaChlZGdlSWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfZ2V0QWxsRWRnZXNPdmVybGFwcGluZ1dpdGgiLAoKICAgICAgLyoqCiAgICAgICAqIHJldHJpZXZlIGFsbCBub2RlcyBvdmVybGFwcGluZyB3aXRoIGdpdmVuIG9iamVjdAogICAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0ICBBbiBvYmplY3Qgd2l0aCBwYXJhbWV0ZXJzIGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbQogICAgICAgKiBAcmV0dXJuIHtOdW1iZXJbXX0gICBBbiBhcnJheSB3aXRoIGlkJ3Mgb2YgdGhlIG92ZXJsYXBwaW5nIG5vZGVzCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2dldEFsbEVkZ2VzT3ZlcmxhcHBpbmdXaXRoKG9iamVjdCkgewogICAgICAgIHZhciBvdmVybGFwcGluZ0VkZ2VzID0gW107CiAgICAgICAgdGhpcy5fZ2V0RWRnZXNPdmVybGFwcGluZ1dpdGgob2JqZWN0LCBvdmVybGFwcGluZ0VkZ2VzKTsKICAgICAgICByZXR1cm4gb3ZlcmxhcHBpbmdFZGdlczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJnZXRFZGdlQXQiLAoKICAgICAgLyoqCiAgICAgICAqIFBsYWNlIGhvbGRlci4gVG8gaW1wbGVtZW50IGNoYW5nZSB0aGUgZ2V0Tm9kZUF0IHRvIGEgX2dldE9iamVjdEF0LiBIYXZlIHRoZSBfZ2V0T2JqZWN0QXQgY2FsbAogICAgICAgKiBnZXROb2RlQXQgYW5kIF9nZXRFZGdlc0F0LCB0aGVuIHByaW9ydGl6ZSB0aGUgc2VsZWN0aW9uIHRvIHVzZXIgcHJlZmVyZW5jZXMuCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSBwb2ludGVyCiAgICAgICAqIEByZXR1cm5zIHt1bmRlZmluZWR9CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RWRnZUF0KHBvaW50ZXIpIHsKICAgICAgICB2YXIgcmV0dXJuRWRnZSA9IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IGFyZ3VtZW50c1sxXTsKCiAgICAgICAgdmFyIHBvc2l0aW9uT2JqZWN0ID0gdGhpcy5fcG9pbnRlclRvUG9zaXRpb25PYmplY3QocG9pbnRlcik7CiAgICAgICAgdmFyIG92ZXJsYXBwaW5nRWRnZXMgPSB0aGlzLl9nZXRBbGxFZGdlc092ZXJsYXBwaW5nV2l0aChwb3NpdGlvbk9iamVjdCk7CgogICAgICAgIGlmIChvdmVybGFwcGluZ0VkZ2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGlmIChyZXR1cm5FZGdlID09PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJvZHkuZWRnZXNbb3ZlcmxhcHBpbmdFZGdlc1tvdmVybGFwcGluZ0VkZ2VzLmxlbmd0aCAtIDFdXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBvdmVybGFwcGluZ0VkZ2VzW292ZXJsYXBwaW5nRWRnZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9hZGRUb1NlbGVjdGlvbiIsCgogICAgICAvKioKICAgICAgICogQWRkIG9iamVjdCB0byB0aGUgc2VsZWN0aW9uIGFycmF5LgogICAgICAgKgogICAgICAgKiBAcGFyYW0gb2JqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZFRvU2VsZWN0aW9uKG9iaikgewogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBOb2RlKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGlvbk9iai5ub2Rlc1tvYmouaWRdID0gb2JqOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGlvbk9iai5lZGdlc1tvYmouaWRdID0gb2JqOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfYWRkVG9Ib3ZlciIsCgogICAgICAvKioKICAgICAgICogQWRkIG9iamVjdCB0byB0aGUgc2VsZWN0aW9uIGFycmF5LgogICAgICAgKgogICAgICAgKiBAcGFyYW0gb2JqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZFRvSG92ZXIob2JqKSB7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIE5vZGUpIHsKICAgICAgICAgIHRoaXMuaG92ZXJPYmoubm9kZXNbb2JqLmlkXSA9IG9iajsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5ob3Zlck9iai5lZGdlc1tvYmouaWRdID0gb2JqOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfcmVtb3ZlRnJvbVNlbGVjdGlvbiIsCgogICAgICAvKioKICAgICAgICogUmVtb3ZlIGEgc2luZ2xlIG9wdGlvbiBmcm9tIHNlbGVjdGlvbi4KICAgICAgICoKICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9iagogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW1vdmVGcm9tU2VsZWN0aW9uKG9iaikgewogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBOb2RlKSB7CiAgICAgICAgICBkZWxldGUgdGhpcy5zZWxlY3Rpb25PYmoubm9kZXNbb2JqLmlkXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlIHRoaXMuc2VsZWN0aW9uT2JqLmVkZ2VzW29iai5pZF07CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInVuc2VsZWN0QWxsIiwKCiAgICAgIC8qKgogICAgICAgKiBVbnNlbGVjdCBhbGwuIFRoZSBzZWxlY3Rpb25PYmogaXMgdXNlZnVsIGZvciB0aGlzLgogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHVuc2VsZWN0QWxsKCkgewogICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiB0aGlzLnNlbGVjdGlvbk9iai5ub2RlcykgewogICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uT2JqLm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25PYmoubm9kZXNbbm9kZUlkXS51bnNlbGVjdCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBlZGdlSWQgaW4gdGhpcy5zZWxlY3Rpb25PYmouZWRnZXMpIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk9iai5lZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uT2JqLmVkZ2VzW2VkZ2VJZF0udW5zZWxlY3QoKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuc2VsZWN0aW9uT2JqID0geyBub2Rlczoge30sIGVkZ2VzOiB7fSB9OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9nZXRTZWxlY3RlZE5vZGVDb3VudCIsCgogICAgICAvKioKICAgICAgICogcmV0dXJuIHRoZSBudW1iZXIgb2Ygc2VsZWN0ZWQgbm9kZXMKICAgICAgICoKICAgICAgICogQHJldHVybnMge251bWJlcn0KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0U2VsZWN0ZWROb2RlQ291bnQoKSB7CiAgICAgICAgdmFyIGNvdW50ID0gMDsKICAgICAgICBmb3IgKHZhciBub2RlSWQgaW4gdGhpcy5zZWxlY3Rpb25PYmoubm9kZXMpIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk9iai5ub2Rlcy5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb3VudDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfZ2V0U2VsZWN0ZWROb2RlIiwKCiAgICAgIC8qKgogICAgICAgKiByZXR1cm4gdGhlIHNlbGVjdGVkIG5vZGUKICAgICAgICoKICAgICAgICogQHJldHVybnMge251bWJlcn0KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0U2VsZWN0ZWROb2RlKCkgewogICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiB0aGlzLnNlbGVjdGlvbk9iai5ub2RlcykgewogICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uT2JqLm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uT2JqLm5vZGVzW25vZGVJZF07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX2dldFNlbGVjdGVkRWRnZSIsCgogICAgICAvKioKICAgICAgICogcmV0dXJuIHRoZSBzZWxlY3RlZCBlZGdlCiAgICAgICAqCiAgICAgICAqIEByZXR1cm5zIHtudW1iZXJ9CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2dldFNlbGVjdGVkRWRnZSgpIHsKICAgICAgICBmb3IgKHZhciBlZGdlSWQgaW4gdGhpcy5zZWxlY3Rpb25PYmouZWRnZXMpIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk9iai5lZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbk9iai5lZGdlc1tlZGdlSWRdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9nZXRTZWxlY3RlZEVkZ2VDb3VudCIsCgogICAgICAvKioKICAgICAgICogcmV0dXJuIHRoZSBudW1iZXIgb2Ygc2VsZWN0ZWQgZWRnZXMKICAgICAgICoKICAgICAgICogQHJldHVybnMge251bWJlcn0KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0U2VsZWN0ZWRFZGdlQ291bnQoKSB7CiAgICAgICAgdmFyIGNvdW50ID0gMDsKICAgICAgICBmb3IgKHZhciBlZGdlSWQgaW4gdGhpcy5zZWxlY3Rpb25PYmouZWRnZXMpIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk9iai5lZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgICAgIGNvdW50ICs9IDE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb3VudDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJfZ2V0U2VsZWN0ZWRPYmplY3RDb3VudCIsCgogICAgICAvKioKICAgICAgICogcmV0dXJuIHRoZSBudW1iZXIgb2Ygc2VsZWN0ZWQgb2JqZWN0cy4KICAgICAgICoKICAgICAgICogQHJldHVybnMge251bWJlcn0KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0U2VsZWN0ZWRPYmplY3RDb3VudCgpIHsKICAgICAgICB2YXIgY291bnQgPSAwOwogICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiB0aGlzLnNlbGVjdGlvbk9iai5ub2RlcykgewogICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uT2JqLm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgY291bnQgKz0gMTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgZWRnZUlkIGluIHRoaXMuc2VsZWN0aW9uT2JqLmVkZ2VzKSB7CiAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25PYmouZWRnZXMuaGFzT3duUHJvcGVydHkoZWRnZUlkKSkgewogICAgICAgICAgICBjb3VudCArPSAxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gY291bnQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX3NlbGVjdGlvbklzRW1wdHkiLAoKICAgICAgLyoqCiAgICAgICAqIENoZWNrIGlmIGFueXRoaW5nIGlzIHNlbGVjdGVkCiAgICAgICAqCiAgICAgICAqIEByZXR1cm5zIHtib29sZWFufQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zZWxlY3Rpb25Jc0VtcHR5KCkgewogICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiB0aGlzLnNlbGVjdGlvbk9iai5ub2RlcykgewogICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uT2JqLm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBlZGdlSWQgaW4gdGhpcy5zZWxlY3Rpb25PYmouZWRnZXMpIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk9iai5lZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX2NsdXN0ZXJJblNlbGVjdGlvbiIsCgogICAgICAvKioKICAgICAgICogY2hlY2sgaWYgb25lIG9mIHRoZSBzZWxlY3RlZCBub2RlcyBpcyBhIGNsdXN0ZXIuCiAgICAgICAqCiAgICAgICAqIEByZXR1cm5zIHtib29sZWFufQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jbHVzdGVySW5TZWxlY3Rpb24oKSB7CiAgICAgICAgZm9yICh2YXIgbm9kZUlkIGluIHRoaXMuc2VsZWN0aW9uT2JqLm5vZGVzKSB7CiAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25PYmoubm9kZXMuaGFzT3duUHJvcGVydHkobm9kZUlkKSkgewogICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25PYmoubm9kZXNbbm9kZUlkXS5jbHVzdGVyU2l6ZSA+IDEpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX3NlbGVjdENvbm5lY3RlZEVkZ2VzIiwKCiAgICAgIC8qKgogICAgICAgKiBzZWxlY3QgdGhlIGVkZ2VzIGNvbm5lY3RlZCB0byB0aGUgbm9kZSB0aGF0IGlzIGJlaW5nIHNlbGVjdGVkCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zZWxlY3RDb25uZWN0ZWRFZGdlcyhub2RlKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmVkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgZWRnZSA9IG5vZGUuZWRnZXNbaV07CiAgICAgICAgICBlZGdlLnNlbGVjdCgpOwogICAgICAgICAgdGhpcy5fYWRkVG9TZWxlY3Rpb24oZWRnZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogIl9ob3ZlckNvbm5lY3RlZEVkZ2VzIiwKCiAgICAgIC8qKgogICAgICAgKiBzZWxlY3QgdGhlIGVkZ2VzIGNvbm5lY3RlZCB0byB0aGUgbm9kZSB0aGF0IGlzIGJlaW5nIHNlbGVjdGVkCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9ob3ZlckNvbm5lY3RlZEVkZ2VzKG5vZGUpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuZWRnZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBlZGdlID0gbm9kZS5lZGdlc1tpXTsKICAgICAgICAgIGVkZ2UuaG92ZXIgPSB0cnVlOwogICAgICAgICAgdGhpcy5fYWRkVG9Ib3ZlcihlZGdlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiX3Vuc2VsZWN0Q29ubmVjdGVkRWRnZXMiLAoKICAgICAgLyoqCiAgICAgICAqIHVuc2VsZWN0IHRoZSBlZGdlcyBjb25uZWN0ZWQgdG8gdGhlIG5vZGUgdGhhdCBpcyBiZWluZyBzZWxlY3RlZAogICAgICAgKgogICAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGUKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfdW5zZWxlY3RDb25uZWN0ZWRFZGdlcyhub2RlKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmVkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgZWRnZSA9IG5vZGUuZWRnZXNbaV07CiAgICAgICAgICBlZGdlLnVuc2VsZWN0KCk7CiAgICAgICAgICB0aGlzLl9yZW1vdmVGcm9tU2VsZWN0aW9uKGVkZ2UpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJibHVyT2JqZWN0IiwKCiAgICAgIC8qKgogICAgICAgKiBUaGlzIGlzIGNhbGxlZCB3aGVuIHNvbWVvbmUgY2xpY2tzIG9uIGEgbm9kZS4gZWl0aGVyIHNlbGVjdCBvciBkZXNlbGVjdCBpdC4KICAgICAgICogSWYgdGhlcmUgaXMgYW4gZXhpc3Rpbmcgc2VsZWN0aW9uIGFuZCB3ZSBkb24ndCB3YW50IHRvIGFwcGVuZCB0byBpdCwgY2xlYXIgdGhlIGV4aXN0aW5nIHNlbGVjdGlvbgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge05vZGUgfHwgRWRnZX0gb2JqZWN0CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gYmx1ck9iamVjdChvYmplY3QpIHsKICAgICAgICBpZiAob2JqZWN0LmhvdmVyID09PSB0cnVlKSB7CiAgICAgICAgICBvYmplY3QuaG92ZXIgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoImJsdXJOb2RlIiwgeyBub2RlOiBvYmplY3QuaWQgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImhvdmVyT2JqZWN0IiwKCiAgICAgIC8qKgogICAgICAgKiBUaGlzIGlzIGNhbGxlZCB3aGVuIHNvbWVvbmUgY2xpY2tzIG9uIGEgbm9kZS4gZWl0aGVyIHNlbGVjdCBvciBkZXNlbGVjdCBpdC4KICAgICAgICogSWYgdGhlcmUgaXMgYW4gZXhpc3Rpbmcgc2VsZWN0aW9uIGFuZCB3ZSBkb24ndCB3YW50IHRvIGFwcGVuZCB0byBpdCwgY2xlYXIgdGhlIGV4aXN0aW5nIHNlbGVjdGlvbgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge05vZGUgfHwgRWRnZX0gb2JqZWN0CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gaG92ZXJPYmplY3Qob2JqZWN0KSB7CiAgICAgICAgdmFyIGhvdmVyQ2hhbmdlZCA9IGZhbHNlOwogICAgICAgIC8vIHJlbW92ZSBhbGwgbm9kZSBob3ZlciBoaWdobGlnaHRzCiAgICAgICAgZm9yICh2YXIgbm9kZUlkIGluIHRoaXMuaG92ZXJPYmoubm9kZXMpIHsKICAgICAgICAgIGlmICh0aGlzLmhvdmVyT2JqLm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgaWYgKG9iamVjdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdGhpcy5ibHVyT2JqZWN0KHRoaXMuaG92ZXJPYmoubm9kZXNbbm9kZUlkXSk7CiAgICAgICAgICAgICAgaG92ZXJDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChvYmplY3QgaW5zdGFuY2VvZiBOb2RlICYmIG9iamVjdC5pZCAhPSBub2RlSWQgfHwgb2JqZWN0IGluc3RhbmNlb2YgRWRnZSB8fCBvYmplY3QgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIHRoaXMuYmx1ck9iamVjdCh0aGlzLmhvdmVyT2JqLm5vZGVzW25vZGVJZF0pOwogICAgICAgICAgICAgIGhvdmVyQ2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuaG92ZXJPYmoubm9kZXNbbm9kZUlkXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZpbmcgYWxsIGVkZ2UgaG92ZXIgaGlnaGxpZ2h0cwogICAgICAgIGZvciAodmFyIGVkZ2VJZCBpbiB0aGlzLmhvdmVyT2JqLmVkZ2VzKSB7CiAgICAgICAgICBpZiAodGhpcy5ob3Zlck9iai5lZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgICAgIHRoaXMuaG92ZXJPYmouZWRnZXNbZWRnZUlkXS5ob3ZlciA9IGZhbHNlOwogICAgICAgICAgICBkZWxldGUgdGhpcy5ob3Zlck9iai5lZGdlc1tlZGdlSWRdOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAob2JqZWN0LmhvdmVyID09PSBmYWxzZSkgewogICAgICAgICAgICBvYmplY3QuaG92ZXIgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9hZGRUb0hvdmVyKG9iamVjdCk7CiAgICAgICAgICAgIGhvdmVyQ2hhbmdlZCA9IHRydWU7CiAgICAgICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBOb2RlKSB7CiAgICAgICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgiaG92ZXJOb2RlIiwgeyBub2RlOiBvYmplY3QuaWQgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBOb2RlICYmIHRoaXMub3B0aW9ucy5ob3ZlckNvbm5lY3RlZEVkZ2VzID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuX2hvdmVyQ29ubmVjdGVkRWRnZXMob2JqZWN0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChob3ZlckNoYW5nZWQgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoIl9yZXF1ZXN0UmVkcmF3Iik7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImdldFNlbGVjdGlvbiIsCgogICAgICAvKioKICAgICAgICoKICAgICAgICogcmV0cmlldmUgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBvYmplY3RzCiAgICAgICAqIEByZXR1cm4ge3tub2RlczogQXJyYXkuPFN0cmluZz4sIGVkZ2VzOiBBcnJheS48U3RyaW5nPn19IHNlbGVjdGlvbgogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNlbGVjdGlvbigpIHsKICAgICAgICB2YXIgbm9kZUlkcyA9IHRoaXMuZ2V0U2VsZWN0ZWROb2RlcygpOwogICAgICAgIHZhciBlZGdlSWRzID0gdGhpcy5nZXRTZWxlY3RlZEVkZ2VzKCk7CiAgICAgICAgcmV0dXJuIHsgbm9kZXM6IG5vZGVJZHMsIGVkZ2VzOiBlZGdlSWRzIH07CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAiZ2V0U2VsZWN0ZWROb2RlcyIsCgogICAgICAvKioKICAgICAgICoKICAgICAgICogcmV0cmlldmUgdGhlIGN1cnJlbnRseSBzZWxlY3RlZCBub2RlcwogICAgICAgKiBAcmV0dXJuIHtTdHJpbmdbXX0gc2VsZWN0aW9uICAgIEFuIGFycmF5IHdpdGggdGhlIGlkcyBvZiB0aGUKICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkIG5vZGVzLgogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNlbGVjdGVkTm9kZXMoKSB7CiAgICAgICAgdmFyIGlkQXJyYXkgPSBbXTsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLnNlbGVjdGFibGUgPT09IHRydWUpIHsKICAgICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiB0aGlzLnNlbGVjdGlvbk9iai5ub2RlcykgewogICAgICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25PYmoubm9kZXMuaGFzT3duUHJvcGVydHkobm9kZUlkKSkgewogICAgICAgICAgICAgIGlkQXJyYXkucHVzaChub2RlSWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBpZEFycmF5OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogImdldFNlbGVjdGVkRWRnZXMiLAoKICAgICAgLyoqCiAgICAgICAqCiAgICAgICAqIHJldHJpZXZlIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgZWRnZXMKICAgICAgICogQHJldHVybiB7QXJyYXl9IHNlbGVjdGlvbiAgICBBbiBhcnJheSB3aXRoIHRoZSBpZHMgb2YgdGhlCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCBub2Rlcy4KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTZWxlY3RlZEVkZ2VzKCkgewogICAgICAgIHZhciBpZEFycmF5ID0gW107CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zZWxlY3RhYmxlID09PSB0cnVlKSB7CiAgICAgICAgICBmb3IgKHZhciBlZGdlSWQgaW4gdGhpcy5zZWxlY3Rpb25PYmouZWRnZXMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uT2JqLmVkZ2VzLmhhc093blByb3BlcnR5KGVkZ2VJZCkpIHsKICAgICAgICAgICAgICBpZEFycmF5LnB1c2goZWRnZUlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gaWRBcnJheTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICJzZWxlY3ROb2RlcyIsCgogICAgICAvKioKICAgICAgICogc2VsZWN0IHplcm8gb3IgbW9yZSBub2RlcyB3aXRoIHRoZSBvcHRpb24gdG8gaGlnaGxpZ2h0IGVkZ2VzCiAgICAgICAqIEBwYXJhbSB7TnVtYmVyW10gfCBTdHJpbmdbXX0gc2VsZWN0aW9uICAgICBBbiBhcnJheSB3aXRoIHRoZSBpZHMgb2YgdGhlCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCBub2Rlcy4KICAgICAgICogQHBhcmFtIHtib29sZWFufSBbaGlnaGxpZ2h0RWRnZXNdCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc2VsZWN0Tm9kZXMoc2VsZWN0aW9uKSB7CiAgICAgICAgdmFyIGhpZ2hsaWdodEVkZ2VzID0gYXJndW1lbnRzWzFdID09PSB1bmRlZmluZWQgPyB0cnVlIDogYXJndW1lbnRzWzFdOwoKICAgICAgICB2YXIgaSA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgaWQgPSB1bmRlZmluZWQ7CgogICAgICAgIGlmICghc2VsZWN0aW9uIHx8IHNlbGVjdGlvbi5sZW5ndGggPT09IHVuZGVmaW5lZCkgdGhyb3cgIlNlbGVjdGlvbiBtdXN0IGJlIGFuIGFycmF5IHdpdGggaWRzIjsKCiAgICAgICAgLy8gZmlyc3QgdW5zZWxlY3QgYW55IHNlbGVjdGVkIG5vZGUKICAgICAgICB0aGlzLnVuc2VsZWN0QWxsKCk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBzZWxlY3Rpb24ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlkID0gc2VsZWN0aW9uW2ldOwoKICAgICAgICAgIHZhciBub2RlID0gdGhpcy5ib2R5Lm5vZGVzW2lkXTsKICAgICAgICAgIGlmICghbm9kZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTm9kZSB3aXRoIGlkIFwiIiArIGlkICsgIlwiIG5vdCBmb3VuZCIpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zZWxlY3RPYmplY3Qobm9kZSwgaGlnaGxpZ2h0RWRnZXMpOwogICAgICAgIH0KICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCJfcmVxdWVzdFJlZHJhdyIpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogInNlbGVjdEVkZ2VzIiwKCiAgICAgIC8qKgogICAgICAgKiBzZWxlY3QgemVybyBvciBtb3JlIGVkZ2VzCiAgICAgICAqIEBwYXJhbSB7TnVtYmVyW10gfCBTdHJpbmdbXX0gc2VsZWN0aW9uICAgICBBbiBhcnJheSB3aXRoIHRoZSBpZHMgb2YgdGhlCiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCBub2Rlcy4KICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZWxlY3RFZGdlcyhzZWxlY3Rpb24pIHsKICAgICAgICB2YXIgaSA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgaWQgPSB1bmRlZmluZWQ7CgogICAgICAgIGlmICghc2VsZWN0aW9uIHx8IHNlbGVjdGlvbi5sZW5ndGggPT09IHVuZGVmaW5lZCkgdGhyb3cgIlNlbGVjdGlvbiBtdXN0IGJlIGFuIGFycmF5IHdpdGggaWRzIjsKCiAgICAgICAgLy8gZmlyc3QgdW5zZWxlY3QgYW55IHNlbGVjdGVkIG9iamVjdHMKICAgICAgICB0aGlzLnVuc2VsZWN0QWxsKCk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBzZWxlY3Rpb24ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlkID0gc2VsZWN0aW9uW2ldOwoKICAgICAgICAgIHZhciBlZGdlID0gdGhpcy5ib2R5LmVkZ2VzW2lkXTsKICAgICAgICAgIGlmICghZWRnZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiRWRnZSB3aXRoIGlkIFwiIiArIGlkICsgIlwiIG5vdCBmb3VuZCIpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zZWxlY3RPYmplY3QoZWRnZSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoIl9yZXF1ZXN0UmVkcmF3Iik7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAidXBkYXRlU2VsZWN0aW9uIiwKCiAgICAgIC8qKgogICAgICAgKiBWYWxpZGF0ZSB0aGUgc2VsZWN0aW9uOiByZW1vdmUgaWRzIG9mIG5vZGVzIHdoaWNoIG5vIGxvbmdlciBleGlzdAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZVNlbGVjdGlvbigpIHsKICAgICAgICBmb3IgKHZhciBub2RlSWQgaW4gdGhpcy5zZWxlY3Rpb25PYmoubm9kZXMpIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk9iai5ub2Rlcy5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5ib2R5Lm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgICBkZWxldGUgdGhpcy5zZWxlY3Rpb25PYmoubm9kZXNbbm9kZUlkXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBlZGdlSWQgaW4gdGhpcy5zZWxlY3Rpb25PYmouZWRnZXMpIHsKICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk9iai5lZGdlcy5oYXNPd25Qcm9wZXJ0eShlZGdlSWQpKSB7CiAgICAgICAgICAgIGlmICghdGhpcy5ib2R5LmVkZ2VzLmhhc093blByb3BlcnR5KGVkZ2VJZCkpIHsKICAgICAgICAgICAgICBkZWxldGUgdGhpcy5zZWxlY3Rpb25PYmouZWRnZXNbZWRnZUlkXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBTZWxlY3Rpb25IYW5kbGVyOwogIH0pKCk7CgogIGV4cG9ydHNbImRlZmF1bHQiXSA9IFNlbGVjdGlvbkhhbmRsZXI7CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CgovKioqLyB9LAovKiAxMDYgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CgogICd1c2Ugc3RyaWN0JzsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogICAgdmFsdWU6IHRydWUKICB9KTsKCiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9CgogIHZhciB1dGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCiAgdmFyIExheW91dEVuZ2luZSA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBMYXlvdXRFbmdpbmUoYm9keSkgewogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTGF5b3V0RW5naW5lKTsKCiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CgogICAgICB0aGlzLmluaXRpYWxSYW5kb21TZWVkID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMTAwMDAwMCk7CiAgICAgIHRoaXMucmFuZG9tU2VlZCA9IHRoaXMuaW5pdGlhbFJhbmRvbVNlZWQ7CiAgICAgIHRoaXMub3B0aW9ucyA9IHt9OwogICAgICB0aGlzLm9wdGlvbnNCYWNrdXAgPSB7fTsKCiAgICAgIHRoaXMuZGVmYXVsdE9wdGlvbnMgPSB7CiAgICAgICAgcmFuZG9tU2VlZDogdW5kZWZpbmVkLAogICAgICAgIGhpZXJhcmNoaWNhbDogewogICAgICAgICAgZW5hYmxlZDogZmFsc2UsCiAgICAgICAgICBsZXZlbFNlcGFyYXRpb246IDE1MCwKICAgICAgICAgIGRpcmVjdGlvbjogJ1VEJywgLy8gVUQsIERVLCBMUiwgUkwKICAgICAgICAgIHNvcnRNZXRob2Q6ICdodWJzaXplJyAvLyBodWJzaXplLCBkaXJlY3RlZAogICAgICAgIH0KICAgICAgfTsKICAgICAgdXRpbC5leHRlbmQodGhpcy5vcHRpb25zLCB0aGlzLmRlZmF1bHRPcHRpb25zKTsKCiAgICAgIHRoaXMuaGllcmFyY2hpY2FsTGV2ZWxzID0ge307CgogICAgICB0aGlzLmJpbmRFdmVudExpc3RlbmVycygpOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhMYXlvdXRFbmdpbmUsIFt7CiAgICAgIGtleTogJ2JpbmRFdmVudExpc3RlbmVycycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBiaW5kRXZlbnRMaXN0ZW5lcnMoKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ19kYXRhQ2hhbmdlZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLnNldHVwSGllcmFyY2hpY2FsTGF5b3V0KCk7CiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ19yZXNldEhpZXJhcmNoaWNhbExheW91dCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzLnNldHVwSGllcmFyY2hpY2FsTGF5b3V0KCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc2V0T3B0aW9ucycsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRPcHRpb25zKG9wdGlvbnMsIGFsbE9wdGlvbnMpIHsKICAgICAgICBpZiAob3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgcHJldkhpZXJhcmNoaWNhbFN0YXRlID0gdGhpcy5vcHRpb25zLmhpZXJhcmNoaWNhbC5lbmFibGVkOwoKICAgICAgICAgIHV0aWwubWVyZ2VPcHRpb25zKHRoaXMub3B0aW9ucywgb3B0aW9ucywgJ2hpZXJhcmNoaWNhbCcpOwogICAgICAgICAgaWYgKG9wdGlvbnMucmFuZG9tU2VlZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMuaW5pdGlhbFJhbmRvbVNlZWQgPSBvcHRpb25zLnJhbmRvbVNlZWQ7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwuZW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGxldmVsIHNlcGVyYXRpb24gaXMgdGhlIHJpZ2h0IHdheSB1cAogICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhpZXJhcmNoaWNhbC5kaXJlY3Rpb24gPT09ICdSTCcgfHwgdGhpcy5vcHRpb25zLmhpZXJhcmNoaWNhbC5kaXJlY3Rpb24gPT09ICdEVScpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhpZXJhcmNoaWNhbC5sZXZlbFNlcGFyYXRpb24gPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuaGllcmFyY2hpY2FsLmxldmVsU2VwYXJhdGlvbiAqPSAtMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwubGV2ZWxTZXBhcmF0aW9uIDwgMCkgewogICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmhpZXJhcmNoaWNhbC5sZXZlbFNlcGFyYXRpb24gKj0gLTE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfcmVzZXRIaWVyYXJjaGljYWxMYXlvdXQnKTsKICAgICAgICAgICAgLy8gYmVjYXVzZSB0aGUgaGllcmFyY2hpY2FsIHN5c3RlbSBuZWVkcyBpdCdzIG93biBwaHlzaWNzIGFuZCBzbW9vdGggY3VydmUgc2V0dGluZ3MsIHdlIGFkYXB0IHRoZSBvdGhlciBvcHRpb25zIGlmIG5lZWRlZC4KICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRhcHRBbGxPcHRpb25zKGFsbE9wdGlvbnMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHByZXZIaWVyYXJjaGljYWxTdGF0ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIC8vIHJlZnJlc2ggdGhlIG92ZXJyaWRkZW4gb3B0aW9ucyBmb3Igbm9kZXMgYW5kIGVkZ2VzLgogICAgICAgICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ3JlZnJlc2gnKTsKICAgICAgICAgICAgICByZXR1cm4gdXRpbC5kZWVwRXh0ZW5kKGFsbE9wdGlvbnMsIHRoaXMub3B0aW9uc0JhY2t1cCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFsbE9wdGlvbnM7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnYWRhcHRBbGxPcHRpb25zJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFkYXB0QWxsT3B0aW9ucyhhbGxPcHRpb25zKSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwuZW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgLy8gc2V0IHRoZSBwaHlzaWNzCiAgICAgICAgICBpZiAoYWxsT3B0aW9ucy5waHlzaWNzID09PSB1bmRlZmluZWQgfHwgYWxsT3B0aW9ucy5waHlzaWNzID09PSB0cnVlKSB7CiAgICAgICAgICAgIGFsbE9wdGlvbnMucGh5c2ljcyA9IHsgc29sdmVyOiAnaGllcmFyY2hpY2FsUmVwdWxzaW9uJyB9OwogICAgICAgICAgICB0aGlzLm9wdGlvbnNCYWNrdXAucGh5c2ljcyA9IHsgc29sdmVyOiAnYmFybmVzSHV0JyB9OwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYWxsT3B0aW9ucy5waHlzaWNzID09PSAnb2JqZWN0JykgewogICAgICAgICAgICB0aGlzLm9wdGlvbnNCYWNrdXAucGh5c2ljcyA9IHsgc29sdmVyOiAnYmFybmVzSHV0JyB9OwogICAgICAgICAgICBpZiAoYWxsT3B0aW9ucy5waHlzaWNzLnNvbHZlciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zQmFja3VwLnBoeXNpY3MgPSB7IHNvbHZlcjogYWxsT3B0aW9ucy5waHlzaWNzLnNvbHZlciB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFsbE9wdGlvbnMucGh5c2ljc1snc29sdmVyJ10gPSAnaGllcmFyY2hpY2FsUmVwdWxzaW9uJzsKICAgICAgICAgIH0gZWxzZSBpZiAoYWxsT3B0aW9ucy5waHlzaWNzICE9PSBmYWxzZSkgewogICAgICAgICAgICB0aGlzLm9wdGlvbnNCYWNrdXAucGh5c2ljcyA9IHsgc29sdmVyOiAnYmFybmVzSHV0JyB9OwogICAgICAgICAgICBhbGxPcHRpb25zLnBoeXNpY3NbJ3NvbHZlciddID0gJ2hpZXJhcmNoaWNhbFJlcHVsc2lvbic7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gZ2V0IHRoZSB0eXBlIG9mIHN0YXRpYyBzbW9vdGggY3VydmUgaW4gY2FzZSBpdCBpcyByZXF1aXJlZAogICAgICAgICAgdmFyIHR5cGUgPSAnaG9yaXpvbnRhbCc7CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhpZXJhcmNoaWNhbC5kaXJlY3Rpb24gPT09ICdSTCcgfHwgdGhpcy5vcHRpb25zLmhpZXJhcmNoaWNhbC5kaXJlY3Rpb24gPT09ICdMUicpIHsKICAgICAgICAgICAgdHlwZSA9ICd2ZXJ0aWNhbCc7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gZGlzYWJsZSBzbW9vdGggY3VydmVzIGlmIG5vdGhpbmcgaXMgZGVmaW5lZC4gSWYgc21vb3RoIGN1cnZlcyBoYXZlIGJlZW4gdHVybmVkIG9uLCB0dXJuIHRoZW0gaW50byBzdGF0aWMgc21vb3RoIGN1cnZlcy4KICAgICAgICAgIGlmIChhbGxPcHRpb25zLmVkZ2VzID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5vcHRpb25zQmFja3VwLmVkZ2VzID0geyBzbW9vdGg6IHsgZW5hYmxlZDogdHJ1ZSwgdHlwZTogJ2R5bmFtaWMnIH0gfTsKICAgICAgICAgICAgYWxsT3B0aW9ucy5lZGdlcyA9IHsgc21vb3RoOiBmYWxzZSB9OwogICAgICAgICAgfSBlbHNlIGlmIChhbGxPcHRpb25zLmVkZ2VzLnNtb290aCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMub3B0aW9uc0JhY2t1cC5lZGdlcyA9IHsgc21vb3RoOiB7IGVuYWJsZWQ6IHRydWUsIHR5cGU6ICdkeW5hbWljJyB9IH07CiAgICAgICAgICAgIGFsbE9wdGlvbnMuZWRnZXMuc21vb3RoID0gZmFsc2U7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodHlwZW9mIGFsbE9wdGlvbnMuZWRnZXMuc21vb3RoID09PSAnYm9vbGVhbicpIHsKICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNCYWNrdXAuZWRnZXMgPSB7IHNtb290aDogYWxsT3B0aW9ucy5lZGdlcy5zbW9vdGggfTsKICAgICAgICAgICAgICBhbGxPcHRpb25zLmVkZ2VzLnNtb290aCA9IHsgZW5hYmxlZDogYWxsT3B0aW9ucy5lZGdlcy5zbW9vdGgsIHR5cGU6IHR5cGUgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBhbGxvdyBjdXN0b20gdHlwZXMgZXhjZXB0IGZvciBkeW5hbWljCiAgICAgICAgICAgICAgaWYgKGFsbE9wdGlvbnMuZWRnZXMuc21vb3RoLnR5cGUgIT09IHVuZGVmaW5lZCAmJiBhbGxPcHRpb25zLmVkZ2VzLnNtb290aC50eXBlICE9PSAnZHluYW1pYycpIHsKICAgICAgICAgICAgICAgIHR5cGUgPSBhbGxPcHRpb25zLmVkZ2VzLnNtb290aC50eXBlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhpcy5vcHRpb25zQmFja3VwLmVkZ2VzID0gewogICAgICAgICAgICAgICAgc21vb3RoOiBhbGxPcHRpb25zLmVkZ2VzLnNtb290aC5lbmFibGVkID09PSB1bmRlZmluZWQgPyB0cnVlIDogYWxsT3B0aW9ucy5lZGdlcy5zbW9vdGguZW5hYmxlZCwKICAgICAgICAgICAgICAgIHR5cGU6IGFsbE9wdGlvbnMuZWRnZXMuc21vb3RoLnR5cGUgPT09IHVuZGVmaW5lZCA/ICdkeW5hbWljJyA6IGFsbE9wdGlvbnMuZWRnZXMuc21vb3RoLnR5cGUsCiAgICAgICAgICAgICAgICByb3VuZG5lc3M6IGFsbE9wdGlvbnMuZWRnZXMuc21vb3RoLnJvdW5kbmVzcyA9PT0gdW5kZWZpbmVkID8gMC41IDogYWxsT3B0aW9ucy5lZGdlcy5zbW9vdGgucm91bmRuZXNzCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBhbGxPcHRpb25zLmVkZ2VzLnNtb290aCA9IHsKICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGFsbE9wdGlvbnMuZWRnZXMuc21vb3RoLmVuYWJsZWQgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBhbGxPcHRpb25zLmVkZ2VzLnNtb290aC5lbmFibGVkLAogICAgICAgICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgICAgICAgIHJvdW5kbmVzczogYWxsT3B0aW9ucy5lZGdlcy5zbW9vdGgucm91bmRuZXNzID09PSB1bmRlZmluZWQgPyAwLjUgOiBhbGxPcHRpb25zLmVkZ2VzLnNtb290aC5yb3VuZG5lc3MKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gZm9yY2UgYWxsIGVkZ2VzIGludG8gc3RhdGljIHNtb290aCBjdXJ2ZXMuIE9ubHkgYXBwbGllcyB0byBlZGdlcyB0aGF0IGRvIG5vdCB1c2UgdGhlIGdsb2JhbCBvcHRpb25zIGZvciBzbW9vdGguCiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfZm9yY2VEaXNhYmxlRHluYW1pY0N1cnZlcycsIHR5cGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYWxsT3B0aW9uczsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzZWVkZWRSYW5kb20nLAogICAgICB2YWx1ZTogZnVuY3Rpb24gc2VlZGVkUmFuZG9tKCkgewogICAgICAgIHZhciB4ID0gTWF0aC5zaW4odGhpcy5yYW5kb21TZWVkKyspICogMTAwMDA7CiAgICAgICAgcmV0dXJuIHggLSBNYXRoLmZsb29yKHgpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ3Bvc2l0aW9uSW5pdGlhbGx5JywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIHBvc2l0aW9uSW5pdGlhbGx5KG5vZGVzQXJyYXkpIHsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhpZXJhcmNoaWNhbC5lbmFibGVkICE9PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLnJhbmRvbVNlZWQgPSB0aGlzLmluaXRpYWxSYW5kb21TZWVkOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2Rlc0FycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBub2RlID0gbm9kZXNBcnJheVtpXTsKICAgICAgICAgICAgaWYgKCFub2RlLmlzRml4ZWQoKSAmJiAobm9kZS54ID09PSB1bmRlZmluZWQgfHwgbm9kZS55ID09PSB1bmRlZmluZWQpKSB7CiAgICAgICAgICAgICAgdmFyIHJhZGl1cyA9IDEwICogMC4xICogbm9kZXNBcnJheS5sZW5ndGggKyAxMDsKICAgICAgICAgICAgICB2YXIgYW5nbGUgPSAyICogTWF0aC5QSSAqIHRoaXMuc2VlZGVkUmFuZG9tKCk7CiAgICAgICAgICAgICAgaWYgKG5vZGUub3B0aW9ucy5maXhlZC54ID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgbm9kZS54ID0gcmFkaXVzICogTWF0aC5jb3MoYW5nbGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAobm9kZS5vcHRpb25zLmZpeGVkLnggPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBub2RlLnkgPSByYWRpdXMgKiBNYXRoLnNpbihhbmdsZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2dldFNlZWQnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U2VlZCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5pbml0aWFsUmFuZG9tU2VlZDsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdzZXR1cEhpZXJhcmNoaWNhbExheW91dCcsCgogICAgICAvKioKICAgICAgICogVGhpcyBpcyB0aGUgbWFpbiBmdW5jdGlvbiB0byBsYXlvdXQgdGhlIG5vZGVzIGluIGEgaGllcmFyY2hpY2FsIHdheS4KICAgICAgICogSXQgY2hlY2tzIGlmIHRoZSBub2RlIGRldGFpbHMgYXJlIHN1cHBsaWVkIGNvcnJlY3RseQogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHNldHVwSGllcmFyY2hpY2FsTGF5b3V0KCkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGllcmFyY2hpY2FsLmVuYWJsZWQgPT09IHRydWUgJiYgdGhpcy5ib2R5Lm5vZGVJbmRpY2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIC8vIGdldCB0aGUgc2l6ZSBvZiB0aGUgbGFyZ2VzdCBodWJzIGFuZCBjaGVjayBpZiB0aGUgdXNlciBoYXMgZGVmaW5lZCBhIGxldmVsIGZvciBhIG5vZGUuCiAgICAgICAgICB2YXIgbm9kZSA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgICBub2RlSWQgPSB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgZGVmaW5lZExldmVsID0gZmFsc2U7CiAgICAgICAgICB2YXIgdW5kZWZpbmVkTGV2ZWwgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuaGllcmFyY2hpY2FsTGV2ZWxzID0ge307CiAgICAgICAgICB0aGlzLm5vZGVTcGFjaW5nID0gMTAwOwoKICAgICAgICAgIGZvciAobm9kZUlkIGluIHRoaXMuYm9keS5ub2RlcykgewogICAgICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgICBub2RlID0gdGhpcy5ib2R5Lm5vZGVzW25vZGVJZF07CiAgICAgICAgICAgICAgaWYgKG5vZGUub3B0aW9ucy5sZXZlbCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBkZWZpbmVkTGV2ZWwgPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5oaWVyYXJjaGljYWxMZXZlbHNbbm9kZUlkXSA9IG5vZGUub3B0aW9ucy5sZXZlbDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdW5kZWZpbmVkTGV2ZWwgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIGlmIHRoZSB1c2VyIGRlZmluZWQgc29tZSBsZXZlbHMgYnV0IG5vdCBhbGwsIGFsZXJ0IGFuZCBydW4gd2l0aG91dCBoaWVyYXJjaGljYWwgbGF5b3V0CiAgICAgICAgICBpZiAodW5kZWZpbmVkTGV2ZWwgPT09IHRydWUgJiYgZGVmaW5lZExldmVsID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVG8gdXNlIHRoZSBoaWVyYXJjaGljYWwgbGF5b3V0LCBub2RlcyByZXF1aXJlIGVpdGhlciBubyBwcmVkZWZpbmVkIGxldmVscyBvciBsZXZlbHMgaGF2ZSB0byBiZSBkZWZpbmVkIGZvciBhbGwgbm9kZXMuJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIHNldHVwIHRoZSBzeXN0ZW0gdG8gdXNlIGhpZXJhcmNoaWNhbCBtZXRob2QuCiAgICAgICAgICAgIC8vdGhpcy5fY2hhbmdlQ29uc3RhbnRzKCk7CgogICAgICAgICAgICAvLyBkZWZpbmUgbGV2ZWxzIGlmIHVuZGVmaW5lZCBieSB0aGUgdXNlcnMuIEJhc2VkIG9uIGh1YnNpemUKICAgICAgICAgICAgaWYgKHVuZGVmaW5lZExldmVsID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwuc29ydE1ldGhvZCA9PT0gJ2h1YnNpemUnKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9kZXRlcm1pbmVMZXZlbHNCeUh1YnNpemUoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwuc29ydE1ldGhvZCA9PT0gJ2RpcmVjdGVkJyB8fCAnZGlyZWN0aW9uJykgewogICAgICAgICAgICAgICAgdGhpcy5fZGV0ZXJtaW5lTGV2ZWxzRGlyZWN0ZWQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNoZWNrIHRoZSBkaXN0cmlidXRpb24gb2YgdGhlIG5vZGVzIHBlciBsZXZlbC4KICAgICAgICAgICAgdmFyIGRpc3RyaWJ1dGlvbiA9IHRoaXMuX2dldERpc3RyaWJ1dGlvbigpOwoKICAgICAgICAgICAgLy8gcGxhY2UgdGhlIG5vZGVzIG9uIHRoZSBjYW52YXMuCiAgICAgICAgICAgIHRoaXMuX3BsYWNlTm9kZXNCeUhpZXJhcmNoeShkaXN0cmlidXRpb24pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfcGxhY2VOb2Rlc0J5SGllcmFyY2h5JywKCiAgICAgIC8qKgogICAgICAgKiBUaGlzIGZ1bmN0aW9uIHBsYWNlcyB0aGUgbm9kZXMgb24gdGhlIGNhbnZhcyBiYXNlZCBvbiB0aGUgaGllcmFyY2hpYWwgZGlzdHJpYnV0aW9uLgogICAgICAgKgogICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGlzdHJpYnV0aW9uIHwgb2J0YWluZWQgYnkgdGhlIGZ1bmN0aW9uIHRoaXMuX2dldERpc3RyaWJ1dGlvbigpCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3BsYWNlTm9kZXNCeUhpZXJhcmNoeShkaXN0cmlidXRpb24pIHsKICAgICAgICB2YXIgbm9kZUlkID0gdW5kZWZpbmVkLAogICAgICAgICAgICBub2RlID0gdW5kZWZpbmVkOwogICAgICAgIHRoaXMucG9zaXRpb25lZE5vZGVzID0ge307CiAgICAgICAgLy8gc3RhcnQgcGxhY2luZyBhbGwgdGhlIGxldmVsIDAgbm9kZXMgZmlyc3QuIFRoZW4gcmVjdXJzaXZlbHkgcG9zaXRpb24gdGhlaXIgYnJhbmNoZXMuCiAgICAgICAgZm9yICh2YXIgbGV2ZWwgaW4gZGlzdHJpYnV0aW9uKSB7CiAgICAgICAgICBpZiAoZGlzdHJpYnV0aW9uLmhhc093blByb3BlcnR5KGxldmVsKSkgewogICAgICAgICAgICBmb3IgKG5vZGVJZCBpbiBkaXN0cmlidXRpb25bbGV2ZWxdLm5vZGVzKSB7CiAgICAgICAgICAgICAgaWYgKGRpc3RyaWJ1dGlvbltsZXZlbF0ubm9kZXMuaGFzT3duUHJvcGVydHkobm9kZUlkKSkgewoKICAgICAgICAgICAgICAgIG5vZGUgPSBkaXN0cmlidXRpb25bbGV2ZWxdLm5vZGVzW25vZGVJZF07CgogICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwuZGlyZWN0aW9uID09PSAnVUQnIHx8IHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwuZGlyZWN0aW9uID09PSAnRFUnKSB7CiAgICAgICAgICAgICAgICAgIGlmIChub2RlLnggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIG5vZGUueCA9IGRpc3RyaWJ1dGlvbltsZXZlbF0uZGlzdGFuY2U7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZGlzdHJpYnV0aW9uW2xldmVsXS5kaXN0YW5jZSA9IG5vZGUueCArIHRoaXMubm9kZVNwYWNpbmc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBpZiAobm9kZS55ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBub2RlLnkgPSBkaXN0cmlidXRpb25bbGV2ZWxdLmRpc3RhbmNlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGRpc3RyaWJ1dGlvbltsZXZlbF0uZGlzdGFuY2UgPSBub2RlLnkgKyB0aGlzLm5vZGVTcGFjaW5nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb25lZE5vZGVzW25vZGVJZF0gPSB0cnVlOwogICAgICAgICAgICAgICAgdGhpcy5fcGxhY2VCcmFuY2hOb2Rlcyhub2RlLmVkZ2VzLCBub2RlLmlkLCBkaXN0cmlidXRpb24sIGxldmVsKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2dldERpc3RyaWJ1dGlvbicsCgogICAgICAvKioKICAgICAgICogVGhpcyBmdW5jdGlvbiBnZXQgdGhlIGRpc3RyaWJ1dGlvbiBvZiBsZXZlbHMgYmFzZWQgb24gaHVic2l6ZQogICAgICAgKgogICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXREaXN0cmlidXRpb24oKSB7CiAgICAgICAgdmFyIGRpc3RyaWJ1dGlvbiA9IHt9OwogICAgICAgIHZhciBub2RlSWQgPSB1bmRlZmluZWQsCiAgICAgICAgICAgIG5vZGUgPSB1bmRlZmluZWQ7CgogICAgICAgIC8vIHdlIGZpeCBZIGJlY2F1c2UgdGhlIGhpZXJhcmNoeSBpcyB2ZXJ0aWNhbCwgd2UgZml4IFggc28gd2UgZG8gbm90IGdpdmUgYSBub2RlIGFuIHggcG9zaXRpb24gZm9yIGEgc2Vjb25kIHRpbWUuCiAgICAgICAgLy8gdGhlIGZpeCBvZiBYIGlzIHJlbW92ZWQgYWZ0ZXIgdGhlIHggdmFsdWUgaGFzIGJlZW4gc2V0LgogICAgICAgIGZvciAobm9kZUlkIGluIHRoaXMuYm9keS5ub2RlcykgewogICAgICAgICAgaWYgKHRoaXMuYm9keS5ub2Rlcy5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgIG5vZGUgPSB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXTsKICAgICAgICAgICAgdmFyIGxldmVsID0gdGhpcy5oaWVyYXJjaGljYWxMZXZlbHNbbm9kZUlkXSA9PT0gdW5kZWZpbmVkID8gMCA6IHRoaXMuaGllcmFyY2hpY2FsTGV2ZWxzW25vZGVJZF07CiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGllcmFyY2hpY2FsLmRpcmVjdGlvbiA9PT0gJ1VEJyB8fCB0aGlzLm9wdGlvbnMuaGllcmFyY2hpY2FsLmRpcmVjdGlvbiA9PT0gJ0RVJykgewogICAgICAgICAgICAgIG5vZGUueSA9IHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwubGV2ZWxTZXBhcmF0aW9uICogbGV2ZWw7CiAgICAgICAgICAgICAgbm9kZS5vcHRpb25zLmZpeGVkLnkgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG5vZGUueCA9IHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwubGV2ZWxTZXBhcmF0aW9uICogbGV2ZWw7CiAgICAgICAgICAgICAgbm9kZS5vcHRpb25zLmZpeGVkLnggPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkaXN0cmlidXRpb25bbGV2ZWxdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBkaXN0cmlidXRpb25bbGV2ZWxdID0geyBhbW91bnQ6IDAsIG5vZGVzOiB7fSwgZGlzdGFuY2U6IDAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkaXN0cmlidXRpb25bbGV2ZWxdLmFtb3VudCArPSAxOwogICAgICAgICAgICBkaXN0cmlidXRpb25bbGV2ZWxdLm5vZGVzW25vZGVJZF0gPSBub2RlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGlzdHJpYnV0aW9uOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19nZXRIdWJTaXplJywKCiAgICAgIC8qKgogICAgICAgKiBHZXQgdGhlIGh1YnNpemUgZnJvbSBhbGwgcmVtYWluaW5nIHVubGV2ZWxsZWQgbm9kZXMuCiAgICAgICAqCiAgICAgICAqIEByZXR1cm5zIHtudW1iZXJ9CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2dldEh1YlNpemUoKSB7CiAgICAgICAgdmFyIGh1YlNpemUgPSAwOwogICAgICAgIGZvciAodmFyIG5vZGVJZCBpbiB0aGlzLmJvZHkubm9kZXMpIHsKICAgICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXMuaGFzT3duUHJvcGVydHkobm9kZUlkKSkgewogICAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuYm9keS5ub2Rlc1tub2RlSWRdOwogICAgICAgICAgICBpZiAodGhpcy5oaWVyYXJjaGljYWxMZXZlbHNbbm9kZUlkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgaHViU2l6ZSA9IG5vZGUuZWRnZXMubGVuZ3RoIDwgaHViU2l6ZSA/IGh1YlNpemUgOiBub2RlLmVkZ2VzLmxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gaHViU2l6ZTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZGV0ZXJtaW5lTGV2ZWxzQnlIdWJzaXplJywKCiAgICAgIC8qKgogICAgICAgKiB0aGlzIGZ1bmN0aW9uIGFsbG9jYXRlcyBub2RlcyBpbiBsZXZlbHMgYmFzZWQgb24gdGhlIHJlY3Vyc2l2ZSBicmFuY2hpbmcgZnJvbSB0aGUgbGFyZ2VzdCBodWJzLgogICAgICAgKgogICAgICAgKiBAcGFyYW0gaHVic2l6ZQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kZXRlcm1pbmVMZXZlbHNCeUh1YnNpemUoKSB7CiAgICAgICAgdmFyIG5vZGVJZCA9IHVuZGVmaW5lZCwKICAgICAgICAgICAgbm9kZSA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgaHViU2l6ZSA9IDE7CgogICAgICAgIHdoaWxlIChodWJTaXplID4gMCkgewogICAgICAgICAgLy8gZGV0ZXJtaW5lIGh1YnMKICAgICAgICAgIGh1YlNpemUgPSB0aGlzLl9nZXRIdWJTaXplKCk7CiAgICAgICAgICBpZiAoaHViU2l6ZSA9PT0gMCkgYnJlYWs7CgogICAgICAgICAgZm9yIChub2RlSWQgaW4gdGhpcy5ib2R5Lm5vZGVzKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXMuaGFzT3duUHJvcGVydHkobm9kZUlkKSkgewogICAgICAgICAgICAgIG5vZGUgPSB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXTsKICAgICAgICAgICAgICBpZiAobm9kZS5lZGdlcy5sZW5ndGggPT09IGh1YlNpemUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3NldExldmVsQnlIdWJzaXplKDAsIG5vZGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfc2V0TGV2ZWxCeUh1YnNpemUnLAoKICAgICAgLyoqCiAgICAgICAqIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHJlY3Vyc2l2ZWx5IHRvIGVudW1lcmF0ZSB0aGUgYmFybmNoZXMgb2YgdGhlIGxhcmdlc3QgaHVicyBhbmQgZ2l2ZSBlYWNoIG5vZGUgYSBsZXZlbC4KICAgICAgICoKICAgICAgICogQHBhcmFtIGxldmVsCiAgICAgICAqIEBwYXJhbSBlZGdlcwogICAgICAgKiBAcGFyYW0gcGFyZW50SWQKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0TGV2ZWxCeUh1YnNpemUobGV2ZWwsIG5vZGUpIHsKICAgICAgICBpZiAodGhpcy5oaWVyYXJjaGljYWxMZXZlbHNbbm9kZS5pZF0gIT09IHVuZGVmaW5lZCkgcmV0dXJuOwoKICAgICAgICB2YXIgY2hpbGROb2RlID0gdW5kZWZpbmVkOwogICAgICAgIHRoaXMuaGllcmFyY2hpY2FsTGV2ZWxzW25vZGUuaWRdID0gbGV2ZWw7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmVkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAobm9kZS5lZGdlc1tpXS50b0lkID09PSBub2RlLmlkKSB7CiAgICAgICAgICAgIGNoaWxkTm9kZSA9IG5vZGUuZWRnZXNbaV0uZnJvbTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNoaWxkTm9kZSA9IG5vZGUuZWRnZXNbaV0udG87CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9zZXRMZXZlbEJ5SHVic2l6ZShsZXZlbCArIDEsIGNoaWxkTm9kZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19kZXRlcm1pbmVMZXZlbHNEaXJlY3RlZCcsCgogICAgICAvKioKICAgICAgICogdGhpcyBmdW5jdGlvbiBhbGxvY2F0ZXMgbm9kZXMgaW4gbGV2ZWxzIGJhc2VkIG9uIHRoZSBkaXJlY3Rpb24gb2YgdGhlIGVkZ2VzCiAgICAgICAqCiAgICAgICAqIEBwYXJhbSBodWJzaXplCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2RldGVybWluZUxldmVsc0RpcmVjdGVkKCkgewogICAgICAgIHZhciBub2RlSWQgPSB1bmRlZmluZWQsCiAgICAgICAgICAgIG5vZGUgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIG1pbkxldmVsID0gMTAwMDA7CgogICAgICAgIC8vIHNldCBmaXJzdCBub2RlIHRvIHNvdXJjZQogICAgICAgIGZvciAobm9kZUlkIGluIHRoaXMuYm9keS5ub2RlcykgewogICAgICAgICAgaWYgKHRoaXMuYm9keS5ub2Rlcy5oYXNPd25Qcm9wZXJ0eShub2RlSWQpKSB7CiAgICAgICAgICAgIG5vZGUgPSB0aGlzLmJvZHkubm9kZXNbbm9kZUlkXTsKICAgICAgICAgICAgdGhpcy5fc2V0TGV2ZWxEaXJlY3RlZChtaW5MZXZlbCwgbm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBnZXQgdGhlIG1pbmltdW0gbGV2ZWwKICAgICAgICBmb3IgKG5vZGVJZCBpbiB0aGlzLmJvZHkubm9kZXMpIHsKICAgICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXMuaGFzT3duUHJvcGVydHkobm9kZUlkKSkgewogICAgICAgICAgICBtaW5MZXZlbCA9IHRoaXMuaGllcmFyY2hpY2FsTGV2ZWxzW25vZGVJZF0gPCBtaW5MZXZlbCA/IHRoaXMuaGllcmFyY2hpY2FsTGV2ZWxzW25vZGVJZF0gOiBtaW5MZXZlbDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHN1YnRyYWN0IHRoZSBtaW5pbXVtIGZyb20gdGhlIHNldCBzbyB3ZSBoYXZlIGEgcmFuZ2Ugc3RhcnRpbmcgZnJvbSAwCiAgICAgICAgZm9yIChub2RlSWQgaW4gdGhpcy5ib2R5Lm5vZGVzKSB7CiAgICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzLmhhc093blByb3BlcnR5KG5vZGVJZCkpIHsKICAgICAgICAgICAgdGhpcy5oaWVyYXJjaGljYWxMZXZlbHNbbm9kZUlkXSAtPSBtaW5MZXZlbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3NldExldmVsRGlyZWN0ZWQnLAoKICAgICAgLyoqCiAgICAgICAqIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHJlY3Vyc2l2ZWx5IHRvIGVudW1lcmF0ZSB0aGUgYnJhbmNoZWQgb2YgdGhlIGZpcnN0IG5vZGUgYW5kIGdpdmUgZWFjaCBub2RlIGEgbGV2ZWwgYmFzZWQgb24gZWRnZSBkaXJlY3Rpb24KICAgICAgICoKICAgICAgICogQHBhcmFtIGxldmVsCiAgICAgICAqIEBwYXJhbSBlZGdlcwogICAgICAgKiBAcGFyYW0gcGFyZW50SWQKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0TGV2ZWxEaXJlY3RlZChsZXZlbCwgbm9kZSkgewogICAgICAgIGlmICh0aGlzLmhpZXJhcmNoaWNhbExldmVsc1tub2RlLmlkXSAhPT0gdW5kZWZpbmVkKSByZXR1cm47CgogICAgICAgIHZhciBjaGlsZE5vZGUgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5oaWVyYXJjaGljYWxMZXZlbHNbbm9kZS5pZF0gPSBsZXZlbDsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmVkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAobm9kZS5lZGdlc1tpXS50b0lkID09PSBub2RlLmlkKSB7CiAgICAgICAgICAgIGNoaWxkTm9kZSA9IG5vZGUuZWRnZXNbaV0uZnJvbTsKICAgICAgICAgICAgdGhpcy5fc2V0TGV2ZWxEaXJlY3RlZChsZXZlbCAtIDEsIGNoaWxkTm9kZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGlsZE5vZGUgPSBub2RlLmVkZ2VzW2ldLnRvOwogICAgICAgICAgICB0aGlzLl9zZXRMZXZlbERpcmVjdGVkKGxldmVsICsgMSwgY2hpbGROb2RlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3BsYWNlQnJhbmNoTm9kZXMnLAoKICAgICAgLyoqCiAgICAgICAqIFRoaXMgaXMgYSByZWN1cnNpdmVseSBjYWxsZWQgZnVuY3Rpb24gdG8gZW51bWVyYXRlIHRoZSBicmFuY2hlcyBmcm9tIHRoZSBsYXJnZXN0IGh1YnMgYW5kIHBsYWNlIHRoZSBub2RlcwogICAgICAgKiBvbiBhIFggcG9zaXRpb24gdGhhdCBlbnN1cmVzIHRoZXJlIHdpbGwgYmUgbm8gb3ZlcmxhcC4KICAgICAgICoKICAgICAgICogQHBhcmFtIGVkZ2VzCiAgICAgICAqIEBwYXJhbSBwYXJlbnRJZAogICAgICAgKiBAcGFyYW0gZGlzdHJpYnV0aW9uCiAgICAgICAqIEBwYXJhbSBwYXJlbnRMZXZlbAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9wbGFjZUJyYW5jaE5vZGVzKGVkZ2VzLCBwYXJlbnRJZCwgZGlzdHJpYnV0aW9uLCBwYXJlbnRMZXZlbCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWRnZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBjaGlsZE5vZGUgPSB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgcGFyZW50Tm9kZSA9IHVuZGVmaW5lZDsKICAgICAgICAgIGlmIChlZGdlc1tpXS50b0lkID09PSBwYXJlbnRJZCkgewogICAgICAgICAgICBjaGlsZE5vZGUgPSBlZGdlc1tpXS5mcm9tOwogICAgICAgICAgICBwYXJlbnROb2RlID0gZWRnZXNbaV0udG87CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGlsZE5vZGUgPSBlZGdlc1tpXS50bzsKICAgICAgICAgICAgcGFyZW50Tm9kZSA9IGVkZ2VzW2ldLmZyb207CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgY2hpbGROb2RlTGV2ZWwgPSB0aGlzLmhpZXJhcmNoaWNhbExldmVsc1tjaGlsZE5vZGUuaWRdOwoKICAgICAgICAgIGlmICh0aGlzLnBvc2l0aW9uZWROb2Rlc1tjaGlsZE5vZGUuaWRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgLy8gaWYgYSBub2RlIGlzIGNvbm5lY2V0ZWQgdG8gYW5vdGhlciBub2RlIG9uIHRoZSBzYW1lIGxldmVsIChvciBoaWdoZXIgKG1lYW5zIGxvd2VyIGxldmVsKSkhLCB0aGlzIGlzIG5vdCBoYW5kbGVkIGhlcmUuCiAgICAgICAgICAgIGlmIChjaGlsZE5vZGVMZXZlbCA+IHBhcmVudExldmVsKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwuZGlyZWN0aW9uID09PSAnVUQnIHx8IHRoaXMub3B0aW9ucy5oaWVyYXJjaGljYWwuZGlyZWN0aW9uID09PSAnRFUnKSB7CiAgICAgICAgICAgICAgICBpZiAoY2hpbGROb2RlLnggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICBjaGlsZE5vZGUueCA9IE1hdGgubWF4KGRpc3RyaWJ1dGlvbltjaGlsZE5vZGVMZXZlbF0uZGlzdGFuY2UsIHBhcmVudE5vZGUueCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkaXN0cmlidXRpb25bY2hpbGROb2RlTGV2ZWxdLmRpc3RhbmNlID0gY2hpbGROb2RlLnggKyB0aGlzLm5vZGVTcGFjaW5nOwogICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbmVkTm9kZXNbY2hpbGROb2RlLmlkXSA9IHRydWU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChjaGlsZE5vZGUueSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIGNoaWxkTm9kZS55ID0gTWF0aC5tYXgoZGlzdHJpYnV0aW9uW2NoaWxkTm9kZUxldmVsXS5kaXN0YW5jZSwgcGFyZW50Tm9kZS55KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRpc3RyaWJ1dGlvbltjaGlsZE5vZGVMZXZlbF0uZGlzdGFuY2UgPSBjaGlsZE5vZGUueSArIHRoaXMubm9kZVNwYWNpbmc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMucG9zaXRpb25lZE5vZGVzW2NoaWxkTm9kZS5pZF0gPSB0cnVlOwoKICAgICAgICAgICAgICBpZiAoY2hpbGROb2RlLmVkZ2VzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3BsYWNlQnJhbmNoTm9kZXMoY2hpbGROb2RlLmVkZ2VzLCBjaGlsZE5vZGUuaWQsIGRpc3RyaWJ1dGlvbiwgY2hpbGROb2RlTGV2ZWwpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfV0pOwoKICAgIHJldHVybiBMYXlvdXRFbmdpbmU7CiAgfSkoKTsKCiAgZXhwb3J0c1snZGVmYXVsdCddID0gTGF5b3V0RW5naW5lOwogIG1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKLyoqKi8gfSwKLyogMTA3ICovCi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoKICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CgogIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7CgogIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfQoKICB2YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oMSk7CiAgdmFyIEhhbW1lciA9IF9fd2VicGFja19yZXF1aXJlX18oMjMpOwogIHZhciBoYW1tZXJVdGlsID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOCk7CgogIC8qKgogICAqIGNsZWFycyB0aGUgdG9vbGJhciBkaXYgZWxlbWVudCBvZiBjaGlsZHJlbgogICAqCiAgICogQHByaXZhdGUKICAgKi8KCiAgdmFyIE1hbmlwdWxhdGlvblN5c3RlbSA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBNYW5pcHVsYXRpb25TeXN0ZW0oYm9keSwgY2FudmFzLCBzZWxlY3Rpb25IYW5kbGVyKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWFuaXB1bGF0aW9uU3lzdGVtKTsKCiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuY2FudmFzID0gY2FudmFzOwogICAgICB0aGlzLnNlbGVjdGlvbkhhbmRsZXIgPSBzZWxlY3Rpb25IYW5kbGVyOwoKICAgICAgdGhpcy5lZGl0TW9kZSA9IGZhbHNlOwogICAgICB0aGlzLm1hbmlwdWxhdGlvbkRpdiA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy5lZGl0TW9kZURpdiA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy5jbG9zZURpdiA9IHVuZGVmaW5lZDsKCiAgICAgIHRoaXMubWFuaXB1bGF0aW9uSGFtbWVycyA9IFtdOwogICAgICB0aGlzLnRlbXBvcmFyeVVJRnVuY3Rpb25zID0ge307CiAgICAgIHRoaXMudGVtcG9yYXJ5RXZlbnRGdW5jdGlvbnMgPSBbXTsKCiAgICAgIHRoaXMudG91Y2hUaW1lID0gMDsKICAgICAgdGhpcy50ZW1wb3JhcnlJZHMgPSB7IG5vZGVzOiBbXSwgZWRnZXM6IFtdIH07CiAgICAgIHRoaXMuZ3VpRW5hYmxlZCA9IGZhbHNlOwogICAgICB0aGlzLmluTW9kZSA9IGZhbHNlOwogICAgICB0aGlzLnNlbGVjdGVkQ29udHJvbE5vZGUgPSB1bmRlZmluZWQ7CgogICAgICB0aGlzLm9wdGlvbnMgPSB7fTsKICAgICAgdGhpcy5kZWZhdWx0T3B0aW9ucyA9IHsKICAgICAgICBlbmFibGVkOiBmYWxzZSwKICAgICAgICBpbml0aWFsbHlBY3RpdmU6IGZhbHNlLAogICAgICAgIGFkZE5vZGU6IHRydWUsCiAgICAgICAgYWRkRWRnZTogdHJ1ZSwKICAgICAgICBlZGl0Tm9kZTogdW5kZWZpbmVkLAogICAgICAgIGVkaXRFZGdlOiB0cnVlLAogICAgICAgIGRlbGV0ZU5vZGU6IHRydWUsCiAgICAgICAgZGVsZXRlRWRnZTogdHJ1ZSwKICAgICAgICBjb250cm9sTm9kZVN0eWxlOiB7CiAgICAgICAgICBzaGFwZTogJ2RvdCcsCiAgICAgICAgICBzaXplOiA2LAogICAgICAgICAgY29sb3I6IHsgYmFja2dyb3VuZDogJyNmZjAwMDAnLCBib3JkZXI6ICcjM2MzYzNjJywgaGlnaGxpZ2h0OiB7IGJhY2tncm91bmQ6ICcjMDdmOTY4JywgYm9yZGVyOiAnIzNjM2MzYycgfSB9LAogICAgICAgICAgYm9yZGVyV2lkdGg6IDIsCiAgICAgICAgICBib3JkZXJXaWR0aFNlbGVjdGVkOiAyCiAgICAgICAgfQogICAgICB9OwogICAgICB1dGlsLmV4dGVuZCh0aGlzLm9wdGlvbnMsIHRoaXMuZGVmYXVsdE9wdGlvbnMpOwoKICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ2Rlc3Ryb3knLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMuX2NsZWFuKCk7CiAgICAgIH0pOwogICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbignX2RhdGFDaGFuZ2VkJywgdGhpcy5fcmVzdG9yZS5iaW5kKHRoaXMpKTsKICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIub24oJ19yZXNldERhdGEnLCB0aGlzLl9yZXN0b3JlLmJpbmQodGhpcykpOwogICAgfQoKICAgIF9jcmVhdGVDbGFzcyhNYW5pcHVsYXRpb25TeXN0ZW0sIFt7CiAgICAgIGtleTogJ19yZXN0b3JlJywKCiAgICAgIC8qKgogICAgICAgKiBJZiBzb21ldGhpbmcgY2hhbmdlcyBpbiB0aGUgZGF0YSBkdXJpbmcgZWRpdGluZywgc3dpdGNoIGJhY2sgdG8gdGhlIGluaXRpYWwgZGF0YW1hbmlwdWxhdGlvbiBzdGF0ZSBhbmQgY2xvc2UgYWxsIGVkaXQgbW9kZXMuCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3Jlc3RvcmUoKSB7CiAgICAgICAgaWYgKHRoaXMuaW5Nb2RlICE9PSBmYWxzZSkgewogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbml0aWFsbHlBY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy5lbmFibGVFZGl0TW9kZSgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5kaXNhYmxlRWRpdE1vZGUoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc2V0T3B0aW9ucycsCgogICAgICAvKioKICAgICAgICogU2V0IHRoZSBPcHRpb25zCiAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zLCBhbGxPcHRpb25zLCBnbG9iYWxPcHRpb25zKSB7CiAgICAgICAgaWYgKGFsbE9wdGlvbnMgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaWYgKGFsbE9wdGlvbnMubG9jYWxlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLmxvY2FsZSA9IGFsbE9wdGlvbnMubG9jYWxlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLmxvY2FsZSA9IGdsb2JhbE9wdGlvbnMubG9jYWxlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGFsbE9wdGlvbnMubG9jYWxlcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5sb2NhbGVzID0gYWxsT3B0aW9ucy5sb2NhbGVzOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLmxvY2FsZXMgPSBnbG9iYWxPcHRpb25zLmxvY2FsZXM7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdib29sZWFuJykgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMuZW5hYmxlZCA9IG9wdGlvbnM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMuZW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgIHV0aWwuZGVlcEV4dGVuZCh0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pbml0aWFsbHlBY3RpdmUgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy5lZGl0TW9kZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl9zZXR1cCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICd0b2dnbGVFZGl0TW9kZScsCgogICAgICAvKioKICAgICAgICogRW5hYmxlIG9yIGRpc2FibGUgZWRpdC1tb2RlLiBEcmF3cyB0aGUgRE9NIHJlcXVpcmVkIGFuZCBjbGVhbnMgdXAgYWZ0ZXIgaXRzZWxmLgogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIHRvZ2dsZUVkaXRNb2RlKCkgewogICAgICAgIGlmICh0aGlzLmVkaXRNb2RlID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmRpc2FibGVFZGl0TW9kZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmVuYWJsZUVkaXRNb2RlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2VuYWJsZUVkaXRNb2RlJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVuYWJsZUVkaXRNb2RlKCkgewogICAgICAgIHRoaXMuZWRpdE1vZGUgPSB0cnVlOwoKICAgICAgICB0aGlzLl9jbGVhbigpOwogICAgICAgIGlmICh0aGlzLmd1aUVuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRGl2LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgdGhpcy5jbG9zZURpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgIHRoaXMuZWRpdE1vZGVEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgIHRoaXMuc2hvd01hbmlwdWxhdG9yVG9vbGJhcigpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdkaXNhYmxlRWRpdE1vZGUnLAogICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzYWJsZUVkaXRNb2RlKCkgewogICAgICAgIHRoaXMuZWRpdE1vZGUgPSBmYWxzZTsKCiAgICAgICAgdGhpcy5fY2xlYW4oKTsKICAgICAgICBpZiAodGhpcy5ndWlFbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkRpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgdGhpcy5jbG9zZURpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgdGhpcy5lZGl0TW9kZURpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgIHRoaXMuX2NyZWF0ZUVkaXRCdXR0b24oKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnc2hvd01hbmlwdWxhdG9yVG9vbGJhcicsCgogICAgICAvKioKICAgICAgICogQ3JlYXRlcyB0aGUgbWFpbiB0b29sYmFyLiBSZW1vdmVzIGZ1bmN0aW9ucyBib3VuZCB0byB0aGUgc2VsZWN0IGV2ZW50LiBCaW5kcyBhbGwgdGhlIGJ1dHRvbnMgb2YgdGhlIHRvb2xiYXIuCiAgICAgICAqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gc2hvd01hbmlwdWxhdG9yVG9vbGJhcigpIHsKICAgICAgICAvLyByZXN0b3JlIHRoZSBzdGF0ZSBvZiBhbnkgYm91bmQgZnVuY3Rpb25zIG9yIGV2ZW50cywgcmVtb3ZlIGNvbnRyb2wgbm9kZXMsIHJlc3RvcmUgcGh5c2ljcwogICAgICAgIHRoaXMuX2NsZWFuKCk7CgogICAgICAgIC8vIHJlc2V0IGdsb2JhbCBsZXRpYWJsZXMKICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkRPTSA9IHt9OwoKICAgICAgICAvLyBpZiB0aGUgZ3VpIGlzIGVuYWJsZWQsIGRyYXcgYWxsIGVsZW1lbnRzLgogICAgICAgIGlmICh0aGlzLmd1aUVuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgIC8vIGEgX3Jlc3RvcmUgd2lsbCBoaWRlIHRoZXNlIG1lbnVzCiAgICAgICAgICB0aGlzLmVkaXRNb2RlID0gdHJ1ZTsKICAgICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRGl2LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgdGhpcy5jbG9zZURpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCiAgICAgICAgICB2YXIgc2VsZWN0ZWROb2RlQ291bnQgPSB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dldFNlbGVjdGVkTm9kZUNvdW50KCk7CiAgICAgICAgICB2YXIgc2VsZWN0ZWRFZGdlQ291bnQgPSB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dldFNlbGVjdGVkRWRnZUNvdW50KCk7CiAgICAgICAgICB2YXIgc2VsZWN0ZWRUb3RhbENvdW50ID0gc2VsZWN0ZWROb2RlQ291bnQgKyBzZWxlY3RlZEVkZ2VDb3VudDsKICAgICAgICAgIHZhciBsb2NhbGUgPSB0aGlzLm9wdGlvbnMubG9jYWxlc1t0aGlzLm9wdGlvbnMubG9jYWxlXTsKICAgICAgICAgIHZhciBuZWVkU2VwZXJhdG9yID0gZmFsc2U7CgogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hZGROb2RlICE9PSBmYWxzZSkgewogICAgICAgICAgICB0aGlzLl9jcmVhdGVBZGROb2RlQnV0dG9uKGxvY2FsZSk7CiAgICAgICAgICAgIG5lZWRTZXBlcmF0b3IgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hZGRFZGdlICE9PSBmYWxzZSkgewogICAgICAgICAgICBpZiAobmVlZFNlcGVyYXRvciA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVNlcGVyYXRvcigxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBuZWVkU2VwZXJhdG9yID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9jcmVhdGVBZGRFZGdlQnV0dG9uKGxvY2FsZSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHNlbGVjdGVkTm9kZUNvdW50ID09PSAxICYmIHR5cGVvZiB0aGlzLm9wdGlvbnMuZWRpdE5vZGUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgaWYgKG5lZWRTZXBlcmF0b3IgPT09IHRydWUpIHsKICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVTZXBlcmF0b3IoMik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbmVlZFNlcGVyYXRvciA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fY3JlYXRlRWRpdE5vZGVCdXR0b24obG9jYWxlKTsKICAgICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRFZGdlQ291bnQgPT09IDEgJiYgc2VsZWN0ZWROb2RlQ291bnQgPT09IDAgJiYgdGhpcy5vcHRpb25zLmVkaXRFZGdlICE9PSBmYWxzZSkgewogICAgICAgICAgICBpZiAobmVlZFNlcGVyYXRvciA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVNlcGVyYXRvcigzKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBuZWVkU2VwZXJhdG9yID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9jcmVhdGVFZGl0RWRnZUJ1dHRvbihsb2NhbGUpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIHJlbW92ZSBidXR0b25zCiAgICAgICAgICBpZiAoc2VsZWN0ZWRUb3RhbENvdW50ICE9PSAwKSB7CiAgICAgICAgICAgIGlmIChzZWxlY3RlZE5vZGVDb3VudCA9PT0gMSAmJiB0aGlzLm9wdGlvbnMuZGVsZXRlTm9kZSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICBpZiAobmVlZFNlcGVyYXRvciA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlU2VwZXJhdG9yKDQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVEZWxldGVCdXR0b24obG9jYWxlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RlZE5vZGVDb3VudCA9PT0gMCAmJiB0aGlzLm9wdGlvbnMuZGVsZXRlRWRnZSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgICBpZiAobmVlZFNlcGVyYXRvciA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlU2VwZXJhdG9yKDQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVEZWxldGVCdXR0b24obG9jYWxlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIGJpbmQgdGhlIGNsb3NlIGJ1dHRvbgogICAgICAgICAgdGhpcy5fYmluZEhhbW1lclRvRGl2KHRoaXMuY2xvc2VEaXYsIHRoaXMudG9nZ2xlRWRpdE1vZGUuYmluZCh0aGlzKSk7CgogICAgICAgICAgLy8gcmVmcmVzaCB0aGlzIGJhciBiYXNlZCBvbiB3aGF0IGhhcyBiZWVuIHNlbGVjdGVkCiAgICAgICAgICB0aGlzLl90ZW1wb3JhcnlCaW5kRXZlbnQoJ3NlbGVjdCcsIHRoaXMuc2hvd01hbmlwdWxhdG9yVG9vbGJhci5iaW5kKHRoaXMpKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlZHJhdyB0byBzaG93IGFueSBwb3NzaWJsZSBjaGFuZ2VzCiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3JlZHJhdycpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2FkZE5vZGVNb2RlJywKCiAgICAgIC8qKgogICAgICAgKiBDcmVhdGUgdGhlIHRvb2xiYXIgZm9yIGFkZGluZyBOb2RlcwogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGFkZE5vZGVNb2RlKCkgewogICAgICAgIC8vIHdoZW4gdXNpbmcgdGhlIGd1aSwgZW5hYmxlIGVkaXQgbW9kZSBpZiBpdCB3YXNudCBhbHJlYWR5LgogICAgICAgIGlmICh0aGlzLmVkaXRNb2RlICE9PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmVuYWJsZUVkaXRNb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyByZXN0b3JlIHRoZSBzdGF0ZSBvZiBhbnkgYm91bmQgZnVuY3Rpb25zIG9yIGV2ZW50cywgcmVtb3ZlIGNvbnRyb2wgbm9kZXMsIHJlc3RvcmUgcGh5c2ljcwogICAgICAgIHRoaXMuX2NsZWFuKCk7CgogICAgICAgIHRoaXMuaW5Nb2RlID0gJ2FkZE5vZGUnOwogICAgICAgIGlmICh0aGlzLmd1aUVuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgIHZhciBsb2NhbGUgPSB0aGlzLm9wdGlvbnMubG9jYWxlc1t0aGlzLm9wdGlvbnMubG9jYWxlXTsKICAgICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRE9NID0ge307CiAgICAgICAgICB0aGlzLl9jcmVhdGVCYWNrQnV0dG9uKGxvY2FsZSk7CiAgICAgICAgICB0aGlzLl9jcmVhdGVTZXBlcmF0b3IoKTsKICAgICAgICAgIHRoaXMuX2NyZWF0ZURlc2NyaXB0aW9uKGxvY2FsZVsnYWRkRGVzY3JpcHRpb24nXSB8fCB0aGlzLm9wdGlvbnMubG9jYWxlc1snZW4nXVsnYWRkRGVzY3JpcHRpb24nXSk7CgogICAgICAgICAgLy8gYmluZCB0aGUgY2xvc2UgYnV0dG9uCiAgICAgICAgICB0aGlzLl9iaW5kSGFtbWVyVG9EaXYodGhpcy5jbG9zZURpdiwgdGhpcy50b2dnbGVFZGl0TW9kZS5iaW5kKHRoaXMpKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX3RlbXBvcmFyeUJpbmRFdmVudCgnY2xpY2snLCB0aGlzLl9wZXJmb3JtQWRkTm9kZS5iaW5kKHRoaXMpKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdlZGl0Tm9kZScsCgogICAgICAvKioKICAgICAgICogY2FsbCB0aGUgYm91bmQgZnVuY3Rpb24gdG8gaGFuZGxlIHRoZSBlZGl0aW5nIG9mIHRoZSBub2RlLiBUaGUgbm9kZSBoYXMgdG8gYmUgc2VsZWN0ZWQuCiAgICAgICAqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZWRpdE5vZGUoKSB7CiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgIC8vIHdoZW4gdXNpbmcgdGhlIGd1aSwgZW5hYmxlIGVkaXQgbW9kZSBpZiBpdCB3YXNudCBhbHJlYWR5LgogICAgICAgIGlmICh0aGlzLmVkaXRNb2RlICE9PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmVuYWJsZUVkaXRNb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyByZXN0b3JlIHRoZSBzdGF0ZSBvZiBhbnkgYm91bmQgZnVuY3Rpb25zIG9yIGV2ZW50cywgcmVtb3ZlIGNvbnRyb2wgbm9kZXMsIHJlc3RvcmUgcGh5c2ljcwogICAgICAgIHRoaXMuX2NsZWFuKCk7CiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dldFNlbGVjdGVkTm9kZSgpOwogICAgICAgIGlmIChub2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuaW5Nb2RlID0gJ2VkaXROb2RlJzsKICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLmVkaXROb2RlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGlmIChub2RlLmlzQ2x1c3RlciAhPT0gdHJ1ZSkgewogICAgICAgICAgICAgIHZhciBkYXRhID0gdXRpbC5kZWVwRXh0ZW5kKHt9LCBub2RlLm9wdGlvbnMsIHRydWUpOwogICAgICAgICAgICAgIGRhdGEueCA9IG5vZGUueDsKICAgICAgICAgICAgICBkYXRhLnkgPSBub2RlLnk7CgogICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZWRpdE5vZGUubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuZWRpdE5vZGUoZGF0YSwgZnVuY3Rpb24gKGZpbmFsaXplZERhdGEpIHsKICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsaXplZERhdGEgIT09IG51bGwgJiYgZmluYWxpemVkRGF0YSAhPT0gdW5kZWZpbmVkICYmIF90aGlzMi5pbk1vZGUgPT09ICdlZGl0Tm9kZScpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiBmb3Igd2hhdGV2ZXIgcmVhc29uIHRoZSBtb2RlIGhhcyBjaGFuZ2VzIChkdWUgdG8gZGF0YXNldCBjaGFuZ2UpIGRpc3JlZ2FyZCB0aGUgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczIuYm9keS5kYXRhLm5vZGVzLmdldERhdGFTZXQoKS51cGRhdGUoZmluYWxpemVkRGF0YSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgX3RoaXMyLnNob3dNYW5pcHVsYXRvclRvb2xiYXIoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBmdW5jdGlvbiBmb3IgZWRpdCBkb2VzIG5vdCBzdXBwb3J0IHR3byBhcmd1bWVudHMgKGRhdGEsIGNhbGxiYWNrKScpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBhbGVydCh0aGlzLm9wdGlvbnMubG9jYWxlc1t0aGlzLm9wdGlvbnMubG9jYWxlXVsnZWRpdENsdXN0ZXJFcnJvciddIHx8IHRoaXMub3B0aW9ucy5sb2NhbGVzWydlbiddWydlZGl0Q2x1c3RlckVycm9yJ10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGZ1bmN0aW9uIGhhcyBiZWVuIGNvbmZpZ3VyZWQgdG8gaGFuZGxlIHRoZSBlZGl0aW5nIG9mIG5vZGVzLicpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNob3dNYW5pcHVsYXRvclRvb2xiYXIoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnYWRkRWRnZU1vZGUnLAoKICAgICAgLyoqCiAgICAgICAqIGNyZWF0ZSB0aGUgdG9vbGJhciB0byBjb25uZWN0IG5vZGVzCiAgICAgICAqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRWRnZU1vZGUoKSB7CiAgICAgICAgLy8gd2hlbiB1c2luZyB0aGUgZ3VpLCBlbmFibGUgZWRpdCBtb2RlIGlmIGl0IHdhc250IGFscmVhZHkuCiAgICAgICAgaWYgKHRoaXMuZWRpdE1vZGUgIT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuZW5hYmxlRWRpdE1vZGUoKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlc3RvcmUgdGhlIHN0YXRlIG9mIGFueSBib3VuZCBmdW5jdGlvbnMgb3IgZXZlbnRzLCByZW1vdmUgY29udHJvbCBub2RlcywgcmVzdG9yZSBwaHlzaWNzCiAgICAgICAgdGhpcy5fY2xlYW4oKTsKCiAgICAgICAgdGhpcy5pbk1vZGUgPSAnYWRkRWRnZSc7CiAgICAgICAgaWYgKHRoaXMuZ3VpRW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgdmFyIGxvY2FsZSA9IHRoaXMub3B0aW9ucy5sb2NhbGVzW3RoaXMub3B0aW9ucy5sb2NhbGVdOwogICAgICAgICAgdGhpcy5tYW5pcHVsYXRpb25ET00gPSB7fTsKICAgICAgICAgIHRoaXMuX2NyZWF0ZUJhY2tCdXR0b24obG9jYWxlKTsKICAgICAgICAgIHRoaXMuX2NyZWF0ZVNlcGVyYXRvcigpOwogICAgICAgICAgdGhpcy5fY3JlYXRlRGVzY3JpcHRpb24obG9jYWxlWydlZGdlRGVzY3JpcHRpb24nXSB8fCB0aGlzLm9wdGlvbnMubG9jYWxlc1snZW4nXVsnZWRnZURlc2NyaXB0aW9uJ10pOwoKICAgICAgICAgIC8vIGJpbmQgdGhlIGNsb3NlIGJ1dHRvbgogICAgICAgICAgdGhpcy5fYmluZEhhbW1lclRvRGl2KHRoaXMuY2xvc2VEaXYsIHRoaXMudG9nZ2xlRWRpdE1vZGUuYmluZCh0aGlzKSk7CiAgICAgICAgfQoKICAgICAgICAvLyB0ZW1wb3JhcmlseSBvdmVybG9hZCBmdW5jdGlvbnMKICAgICAgICB0aGlzLl90ZW1wb3JhcnlCaW5kVUkoJ29uVG91Y2gnLCB0aGlzLl9oYW5kbGVDb25uZWN0LmJpbmQodGhpcykpOwogICAgICAgIHRoaXMuX3RlbXBvcmFyeUJpbmRVSSgnb25EcmFnRW5kJywgdGhpcy5fZmluaXNoQ29ubmVjdC5iaW5kKHRoaXMpKTsKICAgICAgICB0aGlzLl90ZW1wb3JhcnlCaW5kVUkoJ29uRHJhZycsIHRoaXMuX2RyYWdDb250cm9sTm9kZS5iaW5kKHRoaXMpKTsKICAgICAgICB0aGlzLl90ZW1wb3JhcnlCaW5kVUkoJ29uUmVsZWFzZScsIHRoaXMuX2ZpbmlzaENvbm5lY3QuYmluZCh0aGlzKSk7CgogICAgICAgIHRoaXMuX3RlbXBvcmFyeUJpbmRVSSgnb25EcmFnU3RhcnQnLCBmdW5jdGlvbiAoKSB7fSk7CiAgICAgICAgdGhpcy5fdGVtcG9yYXJ5QmluZFVJKCdvbkhvbGQnLCBmdW5jdGlvbiAoKSB7fSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnZWRpdEVkZ2VNb2RlJywKCiAgICAgIC8qKgogICAgICAgKiBjcmVhdGUgdGhlIHRvb2xiYXIgdG8gZWRpdCBlZGdlcwogICAgICAgKgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIGVkaXRFZGdlTW9kZSgpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgLy8gd2hlbiB1c2luZyB0aGUgZ3VpLCBlbmFibGUgZWRpdCBtb2RlIGlmIGl0IHdhc250IGFscmVhZHkuCiAgICAgICAgaWYgKHRoaXMuZWRpdE1vZGUgIT09IHRydWUpIHsKICAgICAgICAgIHRoaXMuZW5hYmxlRWRpdE1vZGUoKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlc3RvcmUgdGhlIHN0YXRlIG9mIGFueSBib3VuZCBmdW5jdGlvbnMgb3IgZXZlbnRzLCByZW1vdmUgY29udHJvbCBub2RlcywgcmVzdG9yZSBwaHlzaWNzCiAgICAgICAgdGhpcy5fY2xlYW4oKTsKCiAgICAgICAgdGhpcy5pbk1vZGUgPSAnZWRpdEVkZ2UnOwogICAgICAgIGlmICh0aGlzLmd1aUVuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgIHZhciBsb2NhbGUgPSB0aGlzLm9wdGlvbnMubG9jYWxlc1t0aGlzLm9wdGlvbnMubG9jYWxlXTsKICAgICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRE9NID0ge307CiAgICAgICAgICB0aGlzLl9jcmVhdGVCYWNrQnV0dG9uKGxvY2FsZSk7CiAgICAgICAgICB0aGlzLl9jcmVhdGVTZXBlcmF0b3IoKTsKICAgICAgICAgIHRoaXMuX2NyZWF0ZURlc2NyaXB0aW9uKGxvY2FsZVsnZWRpdEVkZ2VEZXNjcmlwdGlvbiddIHx8IHRoaXMub3B0aW9ucy5sb2NhbGVzWydlbiddWydlZGl0RWRnZURlc2NyaXB0aW9uJ10pOwoKICAgICAgICAgIC8vIGJpbmQgdGhlIGNsb3NlIGJ1dHRvbgogICAgICAgICAgdGhpcy5fYmluZEhhbW1lclRvRGl2KHRoaXMuY2xvc2VEaXYsIHRoaXMudG9nZ2xlRWRpdE1vZGUuYmluZCh0aGlzKSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmVkZ2VCZWluZ0VkaXRlZElkID0gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLmdldFNlbGVjdGVkRWRnZXMoKVswXTsKICAgICAgICBpZiAodGhpcy5lZGdlQmVpbmdFZGl0ZWRJZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgZWRnZSA9IF90aGlzMy5ib2R5LmVkZ2VzW190aGlzMy5lZGdlQmVpbmdFZGl0ZWRJZF07CgogICAgICAgICAgICAvLyBjcmVhdGUgY29udHJvbCBub2RlcwogICAgICAgICAgICB2YXIgY29udHJvbE5vZGVGcm9tID0gX3RoaXMzLl9nZXROZXdUYXJnZXROb2RlKGVkZ2UuZnJvbS54LCBlZGdlLmZyb20ueSk7CiAgICAgICAgICAgIHZhciBjb250cm9sTm9kZVRvID0gX3RoaXMzLl9nZXROZXdUYXJnZXROb2RlKGVkZ2UudG8ueCwgZWRnZS50by55KTsKCiAgICAgICAgICAgIF90aGlzMy50ZW1wb3JhcnlJZHMubm9kZXMucHVzaChjb250cm9sTm9kZUZyb20uaWQpOwogICAgICAgICAgICBfdGhpczMudGVtcG9yYXJ5SWRzLm5vZGVzLnB1c2goY29udHJvbE5vZGVUby5pZCk7CgogICAgICAgICAgICBfdGhpczMuYm9keS5ub2Rlc1tjb250cm9sTm9kZUZyb20uaWRdID0gY29udHJvbE5vZGVGcm9tOwogICAgICAgICAgICBfdGhpczMuYm9keS5ub2RlSW5kaWNlcy5wdXNoKGNvbnRyb2xOb2RlRnJvbS5pZCk7CiAgICAgICAgICAgIF90aGlzMy5ib2R5Lm5vZGVzW2NvbnRyb2xOb2RlVG8uaWRdID0gY29udHJvbE5vZGVUbzsKICAgICAgICAgICAgX3RoaXMzLmJvZHkubm9kZUluZGljZXMucHVzaChjb250cm9sTm9kZVRvLmlkKTsKCiAgICAgICAgICAgIC8vIHRlbXBvcmFyaWx5IG92ZXJsb2FkIFVJIGZ1bmN0aW9ucywgY2xlYW5lZCB1cCBhdXRvbWF0aWNhbGx5IGJlY2F1c2Ugb2YgX3RlbXBvcmFyeUJpbmRVSQogICAgICAgICAgICBfdGhpczMuX3RlbXBvcmFyeUJpbmRVSSgnb25Ub3VjaCcsIF90aGlzMy5fY29udHJvbE5vZGVUb3VjaC5iaW5kKF90aGlzMykpOyAvLyB1c2VkIHRvIGdldCB0aGUgcG9zaXRpb24KICAgICAgICAgICAgX3RoaXMzLl90ZW1wb3JhcnlCaW5kVUkoJ29uVGFwJywgZnVuY3Rpb24gKCkge30pOyAvLyBkaXNhYmxlZAogICAgICAgICAgICBfdGhpczMuX3RlbXBvcmFyeUJpbmRVSSgnb25Ib2xkJywgZnVuY3Rpb24gKCkge30pOyAvLyBkaXNhYmxlZAogICAgICAgICAgICBfdGhpczMuX3RlbXBvcmFyeUJpbmRVSSgnb25EcmFnU3RhcnQnLCBfdGhpczMuX2NvbnRyb2xOb2RlRHJhZ1N0YXJ0LmJpbmQoX3RoaXMzKSk7IC8vIHVzZWQgdG8gc2VsZWN0IGNvbnRyb2wgbm9kZQogICAgICAgICAgICBfdGhpczMuX3RlbXBvcmFyeUJpbmRVSSgnb25EcmFnJywgX3RoaXMzLl9jb250cm9sTm9kZURyYWcuYmluZChfdGhpczMpKTsgLy8gdXNlZCB0byBkcmFnIGNvbnRyb2wgbm9kZQogICAgICAgICAgICBfdGhpczMuX3RlbXBvcmFyeUJpbmRVSSgnb25EcmFnRW5kJywgX3RoaXMzLl9jb250cm9sTm9kZURyYWdFbmQuYmluZChfdGhpczMpKTsgLy8gdXNlZCB0byBjb25uZWN0IG9yIHJldmVydCBjb250cm9sIG5vZGVzCiAgICAgICAgICAgIF90aGlzMy5fdGVtcG9yYXJ5QmluZFVJKCdvbk1vdXNlTW92ZScsIGZ1bmN0aW9uICgpIHt9KTsgLy8gZGlzYWJsZWQKCiAgICAgICAgICAgIC8vIGNyZWF0ZSBmdW5jdGlvbiB0byBwb3NpdGlvbiBjb250cm9sIG5vZGVzIGNvcnJlY3RseSBvbiBtb3ZlbWVudAogICAgICAgICAgICAvLyBhdXRvbWF0aWNhbGx5IGNsZWFuZWQgdXAgYmVjYXVzZSB3ZSB1c2UgdGhlIHRlbXBvcmFyeSBiaW5kCiAgICAgICAgICAgIF90aGlzMy5fdGVtcG9yYXJ5QmluZEV2ZW50KCdiZWZvcmVEcmF3aW5nJywgZnVuY3Rpb24gKGN0eCkgewogICAgICAgICAgICAgIHZhciBwb3NpdGlvbnMgPSBlZGdlLmVkZ2VUeXBlLmZpbmRCb3JkZXJQb3NpdGlvbnMoY3R4KTsKICAgICAgICAgICAgICBpZiAoY29udHJvbE5vZGVGcm9tLnNlbGVjdGVkID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgY29udHJvbE5vZGVGcm9tLnggPSBwb3NpdGlvbnMuZnJvbS54OwogICAgICAgICAgICAgICAgY29udHJvbE5vZGVGcm9tLnkgPSBwb3NpdGlvbnMuZnJvbS55OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoY29udHJvbE5vZGVUby5zZWxlY3RlZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIGNvbnRyb2xOb2RlVG8ueCA9IHBvc2l0aW9ucy50by54OwogICAgICAgICAgICAgICAgY29udHJvbE5vZGVUby55ID0gcG9zaXRpb25zLnRvLnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF90aGlzMy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3JlZHJhdycpOwogICAgICAgICAgfSkoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5zaG93TWFuaXB1bGF0b3JUb29sYmFyKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ2RlbGV0ZVNlbGVjdGVkJywKCiAgICAgIC8qKgogICAgICAgKiBkZWxldGUgZXZlcnl0aGluZyBpbiB0aGUgc2VsZWN0aW9uCiAgICAgICAqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gZGVsZXRlU2VsZWN0ZWQoKSB7CiAgICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICAgIC8vIHdoZW4gdXNpbmcgdGhlIGd1aSwgZW5hYmxlIGVkaXQgbW9kZSBpZiBpdCB3YXNudCBhbHJlYWR5LgogICAgICAgIGlmICh0aGlzLmVkaXRNb2RlICE9PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmVuYWJsZUVkaXRNb2RlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyByZXN0b3JlIHRoZSBzdGF0ZSBvZiBhbnkgYm91bmQgZnVuY3Rpb25zIG9yIGV2ZW50cywgcmVtb3ZlIGNvbnRyb2wgbm9kZXMsIHJlc3RvcmUgcGh5c2ljcwogICAgICAgIHRoaXMuX2NsZWFuKCk7CgogICAgICAgIHRoaXMuaW5Nb2RlID0gJ2RlbGV0ZSc7CiAgICAgICAgdmFyIHNlbGVjdGVkTm9kZXMgPSB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuZ2V0U2VsZWN0ZWROb2RlcygpOwogICAgICAgIHZhciBzZWxlY3RlZEVkZ2VzID0gdGhpcy5zZWxlY3Rpb25IYW5kbGVyLmdldFNlbGVjdGVkRWRnZXMoKTsKICAgICAgICB2YXIgZGVsZXRlRnVuY3Rpb24gPSB1bmRlZmluZWQ7CiAgICAgICAgaWYgKHNlbGVjdGVkTm9kZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxlY3RlZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmJvZHkubm9kZXNbc2VsZWN0ZWROb2Rlc1tpXV0uaXNDbHVzdGVyID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgYWxlcnQodGhpcy5vcHRpb25zLmxvY2FsZXNbdGhpcy5vcHRpb25zLmxvY2FsZV1bJ2RlbGV0ZUNsdXN0ZXJFcnJvciddIHx8IHRoaXMub3B0aW9ucy5sb2NhbGVzWydlbiddWydkZWxldGVDbHVzdGVyRXJyb3InXSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMuZGVsZXRlTm9kZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBkZWxldGVGdW5jdGlvbiA9IHRoaXMub3B0aW9ucy5kZWxldGVOb2RlOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRFZGdlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBpZiAodHlwZW9mIHRoaXMub3B0aW9ucy5kZWxldGVFZGdlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGRlbGV0ZUZ1bmN0aW9uID0gdGhpcy5vcHRpb25zLmRlbGV0ZUVkZ2U7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIGRlbGV0ZUZ1bmN0aW9uID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IHsgbm9kZXM6IHNlbGVjdGVkTm9kZXMsIGVkZ2VzOiBzZWxlY3RlZEVkZ2VzIH07CiAgICAgICAgICBpZiAoZGVsZXRlRnVuY3Rpb24ubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgIGRlbGV0ZUZ1bmN0aW9uKGRhdGEsIGZ1bmN0aW9uIChmaW5hbGl6ZWREYXRhKSB7CiAgICAgICAgICAgICAgaWYgKGZpbmFsaXplZERhdGEgIT09IG51bGwgJiYgZmluYWxpemVkRGF0YSAhPT0gdW5kZWZpbmVkICYmIF90aGlzNC5pbk1vZGUgPT09ICdkZWxldGUnKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBmb3Igd2hhdGV2ZXIgcmVhc29uIHRoZSBtb2RlIGhhcyBjaGFuZ2VzIChkdWUgdG8gZGF0YXNldCBjaGFuZ2UpIGRpc3JlZ2FyZCB0aGUgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIF90aGlzNC5ib2R5LmRhdGEuZWRnZXMuZ2V0RGF0YVNldCgpLnJlbW92ZShmaW5hbGl6ZWREYXRhLmVkZ2VzKTsKICAgICAgICAgICAgICAgIF90aGlzNC5ib2R5LmRhdGEubm9kZXMuZ2V0RGF0YVNldCgpLnJlbW92ZShmaW5hbGl6ZWREYXRhLm5vZGVzKTsKICAgICAgICAgICAgICAgIF90aGlzNC5ib2R5LmVtaXR0ZXIuZW1pdCgnc3RhcnRTaW11bGF0aW9uJyk7CiAgICAgICAgICAgICAgICBfdGhpczQuc2hvd01hbmlwdWxhdG9yVG9vbGJhcigpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBmdW5jdGlvbiBmb3IgZGVsZXRlIGRvZXMgbm90IHN1cHBvcnQgdHdvIGFyZ3VtZW50cyAoZGF0YSwgY2FsbGJhY2spJyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYm9keS5kYXRhLmVkZ2VzLmdldERhdGFTZXQoKS5yZW1vdmUoc2VsZWN0ZWRFZGdlcyk7CiAgICAgICAgICB0aGlzLmJvZHkuZGF0YS5ub2Rlcy5nZXREYXRhU2V0KCkucmVtb3ZlKHNlbGVjdGVkTm9kZXMpOwogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnc3RhcnRTaW11bGF0aW9uJyk7CiAgICAgICAgICB0aGlzLnNob3dNYW5pcHVsYXRvclRvb2xiYXIoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3NldHVwJywKCiAgICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBQUklWQVRFICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8vCgogICAgICAvKioKICAgICAgICogZHJhdyBvciByZW1vdmUgdGhlIERPTQogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zZXR1cCgpIHsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmVuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICAgIC8vIEVuYWJsZSB0aGUgR1VJCiAgICAgICAgICB0aGlzLmd1aUVuYWJsZWQgPSB0cnVlOwoKICAgICAgICAgIHRoaXMuX2NyZWF0ZVdyYXBwZXJzKCk7CiAgICAgICAgICBpZiAodGhpcy5lZGl0TW9kZSA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhpcy5fY3JlYXRlRWRpdEJ1dHRvbigpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5zaG93TWFuaXB1bGF0b3JUb29sYmFyKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX3JlbW92ZU1hbmlwdWxhdGlvbkRPTSgpOwoKICAgICAgICAgIC8vIGRpc2FibGUgdGhlIGd1aQogICAgICAgICAgdGhpcy5ndWlFbmFibGVkID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jcmVhdGVXcmFwcGVycycsCgogICAgICAvKioKICAgICAgICogY3JlYXRlIHRoZSBkaXYgb3ZlcmxheXMgdGhhdCBjb250YWluIHRoZSBET00KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlV3JhcHBlcnMoKSB7CiAgICAgICAgLy8gbG9hZCB0aGUgbWFuaXB1bGF0b3IgSFRNTCBlbGVtZW50cy4gQWxsIHN0eWxpbmcgZG9uZSBpbiBjc3MuCiAgICAgICAgaWYgKHRoaXMubWFuaXB1bGF0aW9uRGl2ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkRpdi5jbGFzc05hbWUgPSAndmlzLW1hbmlwdWxhdGlvbic7CiAgICAgICAgICBpZiAodGhpcy5lZGl0TW9kZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkRpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRGl2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmNhbnZhcy5mcmFtZS5hcHBlbmRDaGlsZCh0aGlzLm1hbmlwdWxhdGlvbkRpdik7CiAgICAgICAgfQoKICAgICAgICAvLyBjb250YWluZXIgZm9yIHRoZSBlZGl0IGJ1dHRvbi4KICAgICAgICBpZiAodGhpcy5lZGl0TW9kZURpdiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLmVkaXRNb2RlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICB0aGlzLmVkaXRNb2RlRGl2LmNsYXNzTmFtZSA9ICd2aXMtZWRpdC1tb2RlJzsKICAgICAgICAgIGlmICh0aGlzLmVkaXRNb2RlID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuZWRpdE1vZGVEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZWRpdE1vZGVEaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmNhbnZhcy5mcmFtZS5hcHBlbmRDaGlsZCh0aGlzLmVkaXRNb2RlRGl2KTsKICAgICAgICB9CgogICAgICAgIC8vIGNvbnRhaW5lciBmb3IgdGhlIGNsb3NlIGRpdiBidXR0b24KICAgICAgICBpZiAodGhpcy5jbG9zZURpdiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB0aGlzLmNsb3NlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICB0aGlzLmNsb3NlRGl2LmNsYXNzTmFtZSA9ICd2aXMtY2xvc2UnOwogICAgICAgICAgdGhpcy5jbG9zZURpdi5zdHlsZS5kaXNwbGF5ID0gdGhpcy5tYW5pcHVsYXRpb25EaXYuc3R5bGUuZGlzcGxheTsKICAgICAgICAgIHRoaXMuY2FudmFzLmZyYW1lLmFwcGVuZENoaWxkKHRoaXMuY2xvc2VEaXYpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZ2V0TmV3VGFyZ2V0Tm9kZScsCgogICAgICAvKioKICAgICAgICogZ2VuZXJhdGUgYSBuZXcgdGFyZ2V0IG5vZGUuIFVzZWQgZm9yIGNyZWF0aW5nIG5ldyBlZGdlcyBhbmQgZWRpdGluZyBlZGdlcwogICAgICAgKiBAcGFyYW0geAogICAgICAgKiBAcGFyYW0geQogICAgICAgKiBAcmV0dXJucyB7Kn0KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0TmV3VGFyZ2V0Tm9kZSh4LCB5KSB7CiAgICAgICAgdmFyIGNvbnRyb2xOb2RlU3R5bGUgPSB1dGlsLmRlZXBFeHRlbmQoe30sIHRoaXMub3B0aW9ucy5jb250cm9sTm9kZVN0eWxlKTsKCiAgICAgICAgY29udHJvbE5vZGVTdHlsZS5pZCA9ICd0YXJnZXROb2RlJyArIHV0aWwucmFuZG9tVVVJRCgpOwogICAgICAgIGNvbnRyb2xOb2RlU3R5bGUuaGlkZGVuID0gZmFsc2U7CiAgICAgICAgY29udHJvbE5vZGVTdHlsZS5waHlzaWNzID0gZmFsc2U7CiAgICAgICAgY29udHJvbE5vZGVTdHlsZS54ID0geDsKICAgICAgICBjb250cm9sTm9kZVN0eWxlLnkgPSB5OwoKICAgICAgICByZXR1cm4gdGhpcy5ib2R5LmZ1bmN0aW9ucy5jcmVhdGVOb2RlKGNvbnRyb2xOb2RlU3R5bGUpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jcmVhdGVFZGl0QnV0dG9uJywKCiAgICAgIC8qKgogICAgICAgKiBDcmVhdGUgdGhlIGVkaXQgYnV0dG9uCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUVkaXRCdXR0b24oKSB7CiAgICAgICAgLy8gcmVzdG9yZSBldmVyeXRoaW5nIHRvIGl0J3Mgb3JpZ2luYWwgc3RhdGUgKGlmIGFwcGxpY2FibGUpCiAgICAgICAgdGhpcy5fY2xlYW4oKTsKCiAgICAgICAgLy8gcmVzZXQgdGhlIG1hbmlwdWxhdGlvbkRPTQogICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRE9NID0ge307CgogICAgICAgIC8vIGVtcHR5IHRoZSBlZGl0TW9kZURpdgogICAgICAgIHV0aWwucmVjdXJzaXZlRE9NRGVsZXRlKHRoaXMuZWRpdE1vZGVEaXYpOwoKICAgICAgICAvLyBjcmVhdGUgdGhlIGNvbnRlbnRzIGZvciB0aGUgZWRpdE1vZGUgYnV0dG9uCiAgICAgICAgdmFyIGxvY2FsZSA9IHRoaXMub3B0aW9ucy5sb2NhbGVzW3RoaXMub3B0aW9ucy5sb2NhbGVdOwogICAgICAgIHZhciBidXR0b24gPSB0aGlzLl9jcmVhdGVCdXR0b24oJ2VkaXRNb2RlJywgJ3Zpcy1idXR0b24gdmlzLWVkaXQgdmlzLWVkaXQtbW9kZScsIGxvY2FsZVsnZWRpdCddIHx8IHRoaXMub3B0aW9ucy5sb2NhbGVzWydlbiddWydlZGl0J10pOwogICAgICAgIHRoaXMuZWRpdE1vZGVEaXYuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKCiAgICAgICAgLy8gYmluZCBhIGhhbW1lciBsaXN0ZW5lciB0byB0aGUgYnV0dG9uLCBjYWxsaW5nIHRoZSBmdW5jdGlvbiB0b2dnbGVFZGl0TW9kZS4KICAgICAgICB0aGlzLl9iaW5kSGFtbWVyVG9EaXYoYnV0dG9uLCB0aGlzLnRvZ2dsZUVkaXRNb2RlLmJpbmQodGhpcykpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jbGVhbicsCgogICAgICAvKioKICAgICAgICogdGhpcyBmdW5jdGlvbiBjbGVhbnMgdXAgYWZ0ZXIgZXZlcnl0aGluZyB0aGlzIG1vZHVsZSBkb2VzLiBUZW1wb3JhcnkgZWxlbWVudHMsIGZ1bmN0aW9ucyBhbmQgZXZlbnRzIGFyZSByZW1vdmVkLCBwaHlzaWNzIHJlc3RvcmVkLCBoYW1tZXJzIHJlbW92ZWQuCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NsZWFuKCkgewogICAgICAgIC8vIG5vdCBpbiBtb2RlCiAgICAgICAgdGhpcy5pbk1vZGUgPSBmYWxzZTsKCiAgICAgICAgLy8gX2NsZWFuIHRoZSBkaXZzCiAgICAgICAgaWYgKHRoaXMuZ3VpRW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgdXRpbC5yZWN1cnNpdmVET01EZWxldGUodGhpcy5lZGl0TW9kZURpdik7CiAgICAgICAgICB1dGlsLnJlY3Vyc2l2ZURPTURlbGV0ZSh0aGlzLm1hbmlwdWxhdGlvbkRpdik7CgogICAgICAgICAgLy8gcmVtb3ZlcyBhbGwgdGhlIGJpbmRpbmdzIGFuZCBvdmVybG9hZHMKICAgICAgICAgIHRoaXMuX2NsZWFuTWFuaXB1bGF0b3JIYW1tZXJzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyByZW1vdmUgdGVtcG9yYXJ5IG5vZGVzIGFuZCBlZGdlcwogICAgICAgIHRoaXMuX2NsZWFudXBUZW1wb3JhcnlOb2Rlc0FuZEVkZ2VzKCk7CgogICAgICAgIC8vIHJlc3RvcmUgb3ZlcmxvYWRlZCBVSSBmdW5jdGlvbnMKICAgICAgICB0aGlzLl91bmJpbmRUZW1wb3JhcnlVSXMoKTsKCiAgICAgICAgLy8gcmVtb3ZlIHRoZSB0ZW1wb3JhcnlFdmVudEZ1bmN0aW9ucwogICAgICAgIHRoaXMuX3VuYmluZFRlbXBvcmFyeUV2ZW50cygpOwoKICAgICAgICAvLyByZXN0b3JlIHRoZSBwaHlzaWNzIGlmIHJlcXVpcmVkCiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgncmVzdG9yZVBoeXNpY3MnKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfY2xlYW5NYW5pcHVsYXRvckhhbW1lcnMnLAoKICAgICAgLyoqCiAgICAgICAqIEVhY2ggZG9tIGVsZW1lbnQgaGFzIGl0J3Mgb3duIGhhbW1lci4gVGhleSBhcmUgc3RvcmVkIGluIHRoaXMubWFuaXB1bGF0aW9uSGFtbWVycy4gVGhpcyBjbGVhbnMgdGhlbSB1cC4KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY2xlYW5NYW5pcHVsYXRvckhhbW1lcnMoKSB7CiAgICAgICAgLy8gX2NsZWFuIGhhbW1lciBiaW5kaW5ncwogICAgICAgIGlmICh0aGlzLm1hbmlwdWxhdGlvbkhhbW1lcnMubGVuZ3RoICE9IDApIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tYW5pcHVsYXRpb25IYW1tZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMubWFuaXB1bGF0aW9uSGFtbWVyc1tpXS5kZXN0cm95KCk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkhhbW1lcnMgPSBbXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3JlbW92ZU1hbmlwdWxhdGlvbkRPTScsCgogICAgICAvKioKICAgICAgICogUmVtb3ZlIGFsbCBET00gZWxlbWVudHMgY3JlYXRlZCBieSB0aGlzIG1vZHVsZS4KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVtb3ZlTWFuaXB1bGF0aW9uRE9NKCkgewogICAgICAgIC8vIHJlbW92ZXMgYWxsIHRoZSBiaW5kaW5ncyBhbmQgb3ZlcmxvYWRzCiAgICAgICAgdGhpcy5fY2xlYW4oKTsKCiAgICAgICAgLy8gZW1wdHkgdGhlIG1hbmlwdWxhdGlvbiBkaXZzCiAgICAgICAgdXRpbC5yZWN1cnNpdmVET01EZWxldGUodGhpcy5tYW5pcHVsYXRpb25EaXYpOwogICAgICAgIHV0aWwucmVjdXJzaXZlRE9NRGVsZXRlKHRoaXMuZWRpdE1vZGVEaXYpOwogICAgICAgIHV0aWwucmVjdXJzaXZlRE9NRGVsZXRlKHRoaXMuY2xvc2VEaXYpOwoKICAgICAgICAvLyByZW1vdmUgdGhlIG1hbmlwdWxhdGlvbiBkaXZzCiAgICAgICAgaWYgKHRoaXMubWFuaXB1bGF0aW9uRGl2KSB7CiAgICAgICAgICB0aGlzLmNhbnZhcy5mcmFtZS5yZW1vdmVDaGlsZCh0aGlzLm1hbmlwdWxhdGlvbkRpdik7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLmVkaXRNb2RlRGl2KSB7CiAgICAgICAgICB0aGlzLmNhbnZhcy5mcmFtZS5yZW1vdmVDaGlsZCh0aGlzLmVkaXRNb2RlRGl2KTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuY2xvc2VEaXYpIHsKICAgICAgICAgIHRoaXMuY2FudmFzLmZyYW1lLnJlbW92ZUNoaWxkKHRoaXMubWFuaXB1bGF0aW9uRGl2KTsKICAgICAgICB9CgogICAgICAgIC8vIHNldCB0aGUgcmVmZXJlbmNlcyB0byB1bmRlZmluZWQKICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkRpdiA9IHVuZGVmaW5lZDsKICAgICAgICB0aGlzLmVkaXRNb2RlRGl2ID0gdW5kZWZpbmVkOwogICAgICAgIHRoaXMuY2xvc2VEaXYgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2NyZWF0ZVNlcGVyYXRvcicsCgogICAgICAvKioKICAgICAgICogY3JlYXRlIGEgc2VwZXJhdG9yIGxpbmUuIHRoZSBpbmRleCBpcyB0byBkaWZmZXJlbnRpYXRlIGluIHRoZSBtYW5pcHVsYXRpb24gZG9tCiAgICAgICAqIEBwYXJhbSBpbmRleAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVTZXBlcmF0b3IoKSB7CiAgICAgICAgdmFyIGluZGV4ID0gYXJndW1lbnRzWzBdID09PSB1bmRlZmluZWQgPyAxIDogYXJndW1lbnRzWzBdOwoKICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkRPTVsnc2VwZXJhdG9yTGluZURpdicgKyBpbmRleF0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkRPTVsnc2VwZXJhdG9yTGluZURpdicgKyBpbmRleF0uY2xhc3NOYW1lID0gJ3Zpcy1zZXBhcmF0b3ItbGluZSc7CiAgICAgICAgdGhpcy5tYW5pcHVsYXRpb25EaXYuYXBwZW5kQ2hpbGQodGhpcy5tYW5pcHVsYXRpb25ET01bJ3NlcGVyYXRvckxpbmVEaXYnICsgaW5kZXhdKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfY3JlYXRlQWRkTm9kZUJ1dHRvbicsCgogICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tICAgIERPTSBmdW5jdGlvbnMgZm9yIGJ1dHRvbnMgICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vLwoKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVBZGROb2RlQnV0dG9uKGxvY2FsZSkgewogICAgICAgIHZhciBidXR0b24gPSB0aGlzLl9jcmVhdGVCdXR0b24oJ2FkZE5vZGUnLCAndmlzLWJ1dHRvbiB2aXMtYWRkJywgbG9jYWxlWydhZGROb2RlJ10gfHwgdGhpcy5vcHRpb25zLmxvY2FsZXNbJ2VuJ11bJ2FkZE5vZGUnXSk7CiAgICAgICAgdGhpcy5tYW5pcHVsYXRpb25EaXYuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKICAgICAgICB0aGlzLl9iaW5kSGFtbWVyVG9EaXYoYnV0dG9uLCB0aGlzLmFkZE5vZGVNb2RlLmJpbmQodGhpcykpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jcmVhdGVBZGRFZGdlQnV0dG9uJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVBZGRFZGdlQnV0dG9uKGxvY2FsZSkgewogICAgICAgIHZhciBidXR0b24gPSB0aGlzLl9jcmVhdGVCdXR0b24oJ2FkZEVkZ2UnLCAndmlzLWJ1dHRvbiB2aXMtY29ubmVjdCcsIGxvY2FsZVsnYWRkRWRnZSddIHx8IHRoaXMub3B0aW9ucy5sb2NhbGVzWydlbiddWydhZGRFZGdlJ10pOwogICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRGl2LmFwcGVuZENoaWxkKGJ1dHRvbik7CiAgICAgICAgdGhpcy5fYmluZEhhbW1lclRvRGl2KGJ1dHRvbiwgdGhpcy5hZGRFZGdlTW9kZS5iaW5kKHRoaXMpKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfY3JlYXRlRWRpdE5vZGVCdXR0b24nLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUVkaXROb2RlQnV0dG9uKGxvY2FsZSkgewogICAgICAgIHZhciBidXR0b24gPSB0aGlzLl9jcmVhdGVCdXR0b24oJ2VkaXROb2RlJywgJ3Zpcy1idXR0b24gdmlzLWVkaXQnLCBsb2NhbGVbJ2VkaXROb2RlJ10gfHwgdGhpcy5vcHRpb25zLmxvY2FsZXNbJ2VuJ11bJ2VkaXROb2RlJ10pOwogICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRGl2LmFwcGVuZENoaWxkKGJ1dHRvbik7CiAgICAgICAgdGhpcy5fYmluZEhhbW1lclRvRGl2KGJ1dHRvbiwgdGhpcy5lZGl0Tm9kZS5iaW5kKHRoaXMpKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfY3JlYXRlRWRpdEVkZ2VCdXR0b24nLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUVkaXRFZGdlQnV0dG9uKGxvY2FsZSkgewogICAgICAgIHZhciBidXR0b24gPSB0aGlzLl9jcmVhdGVCdXR0b24oJ2VkaXRFZGdlJywgJ3Zpcy1idXR0b24gdmlzLWVkaXQnLCBsb2NhbGVbJ2VkaXRFZGdlJ10gfHwgdGhpcy5vcHRpb25zLmxvY2FsZXNbJ2VuJ11bJ2VkaXRFZGdlJ10pOwogICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRGl2LmFwcGVuZENoaWxkKGJ1dHRvbik7CiAgICAgICAgdGhpcy5fYmluZEhhbW1lclRvRGl2KGJ1dHRvbiwgdGhpcy5lZGl0RWRnZU1vZGUuYmluZCh0aGlzKSk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2NyZWF0ZURlbGV0ZUJ1dHRvbicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlRGVsZXRlQnV0dG9uKGxvY2FsZSkgewogICAgICAgIHZhciBidXR0b24gPSB0aGlzLl9jcmVhdGVCdXR0b24oJ2RlbGV0ZScsICd2aXMtYnV0dG9uIHZpcy1kZWxldGUnLCBsb2NhbGVbJ2RlbCddIHx8IHRoaXMub3B0aW9ucy5sb2NhbGVzWydlbiddWydkZWwnXSk7CiAgICAgICAgdGhpcy5tYW5pcHVsYXRpb25EaXYuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKICAgICAgICB0aGlzLl9iaW5kSGFtbWVyVG9EaXYoYnV0dG9uLCB0aGlzLmRlbGV0ZVNlbGVjdGVkLmJpbmQodGhpcykpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jcmVhdGVCYWNrQnV0dG9uJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVCYWNrQnV0dG9uKGxvY2FsZSkgewogICAgICAgIHZhciBidXR0b24gPSB0aGlzLl9jcmVhdGVCdXR0b24oJ2JhY2snLCAndmlzLWJ1dHRvbiB2aXMtYmFjaycsIGxvY2FsZVsnYmFjayddIHx8IHRoaXMub3B0aW9ucy5sb2NhbGVzWydlbiddWydiYWNrJ10pOwogICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRGl2LmFwcGVuZENoaWxkKGJ1dHRvbik7CiAgICAgICAgdGhpcy5fYmluZEhhbW1lclRvRGl2KGJ1dHRvbiwgdGhpcy5zaG93TWFuaXB1bGF0b3JUb29sYmFyLmJpbmQodGhpcykpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jcmVhdGVCdXR0b24nLAogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NyZWF0ZUJ1dHRvbihpZCwgY2xhc3NOYW1lLCBsYWJlbCkgewogICAgICAgIHZhciBsYWJlbENsYXNzTmFtZSA9IGFyZ3VtZW50c1szXSA9PT0gdW5kZWZpbmVkID8gJ3Zpcy1sYWJlbCcgOiBhcmd1bWVudHNbM107CgogICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRE9NW2lkICsgJ0RpdiddID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdGhpcy5tYW5pcHVsYXRpb25ET01baWQgKyAnRGl2J10uY2xhc3NOYW1lID0gY2xhc3NOYW1lOwogICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRE9NW2lkICsgJ0xhYmVsJ10gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkRPTVtpZCArICdMYWJlbCddLmNsYXNzTmFtZSA9IGxhYmVsQ2xhc3NOYW1lOwogICAgICAgIHRoaXMubWFuaXB1bGF0aW9uRE9NW2lkICsgJ0xhYmVsJ10uaW5uZXJIVE1MID0gbGFiZWw7CiAgICAgICAgdGhpcy5tYW5pcHVsYXRpb25ET01baWQgKyAnRGl2J10uYXBwZW5kQ2hpbGQodGhpcy5tYW5pcHVsYXRpb25ET01baWQgKyAnTGFiZWwnXSk7CiAgICAgICAgcmV0dXJuIHRoaXMubWFuaXB1bGF0aW9uRE9NW2lkICsgJ0RpdiddOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jcmVhdGVEZXNjcmlwdGlvbicsCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlRGVzY3JpcHRpb24obGFiZWwpIHsKICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkRpdi5hcHBlbmRDaGlsZCh0aGlzLl9jcmVhdGVCdXR0b24oJ2Rlc2NyaXB0aW9uJywgJ3Zpcy1idXR0b24gdmlzLW5vbmUnLCBsYWJlbCkpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ190ZW1wb3JhcnlCaW5kRXZlbnQnLAoKICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gRW5kIG9mIERPTSBmdW5jdGlvbnMgZm9yIGJ1dHRvbnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy8KCiAgICAgIC8qKgogICAgICAgKiB0aGlzIGJpbmRzIGFuIGV2ZW50IHVudGlsIGNsZWFudXAgYnkgdGhlIGNsZWFuIGZ1bmN0aW9ucy4KICAgICAgICogQHBhcmFtIGV2ZW50CiAgICAgICAqIEBwYXJhbSBuZXdGdW5jdGlvbgogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF90ZW1wb3JhcnlCaW5kRXZlbnQoZXZlbnQsIG5ld0Z1bmN0aW9uKSB7CiAgICAgICAgdGhpcy50ZW1wb3JhcnlFdmVudEZ1bmN0aW9ucy5wdXNoKHsgZXZlbnQ6IGV2ZW50LCBib3VuZEZ1bmN0aW9uOiBuZXdGdW5jdGlvbiB9KTsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vbihldmVudCwgbmV3RnVuY3Rpb24pOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ190ZW1wb3JhcnlCaW5kVUknLAoKICAgICAgLyoqCiAgICAgICAqIHRoaXMgb3ZlcnJpZGVzIGFuIFVJIGZ1bmN0aW9uIHVudGlsIGNsZWFudXAgYnkgdGhlIGNsZWFuIGZ1bmN0aW9uCiAgICAgICAqIEBwYXJhbSBVSWZ1bmN0aW9uTmFtZQogICAgICAgKiBAcGFyYW0gbmV3RnVuY3Rpb24KICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfdGVtcG9yYXJ5QmluZFVJKFVJZnVuY3Rpb25OYW1lLCBuZXdGdW5jdGlvbikgewogICAgICAgIGlmICh0aGlzLmJvZHkuZXZlbnRMaXN0ZW5lcnNbVUlmdW5jdGlvbk5hbWVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMudGVtcG9yYXJ5VUlGdW5jdGlvbnNbVUlmdW5jdGlvbk5hbWVdID0gdGhpcy5ib2R5LmV2ZW50TGlzdGVuZXJzW1VJZnVuY3Rpb25OYW1lXTsKICAgICAgICAgIHRoaXMuYm9keS5ldmVudExpc3RlbmVyc1tVSWZ1bmN0aW9uTmFtZV0gPSBuZXdGdW5jdGlvbjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIFVJIGZ1bmN0aW9uIGRvZXMgbm90IGV4aXN0LiBUeXBvPyBZb3UgdHJpZWQ6ICcgKyBVSWZ1bmN0aW9uTmFtZSArICcgcG9zc2libGUgYXJlOiAnICsgSlNPTi5zdHJpbmdpZnkoT2JqZWN0LmtleXModGhpcy5ib2R5LmV2ZW50TGlzdGVuZXJzKSkpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfdW5iaW5kVGVtcG9yYXJ5VUlzJywKCiAgICAgIC8qKgogICAgICAgKiBSZXN0b3JlIHRoZSBvdmVycmlkZGVuIFVJIGZ1bmN0aW9ucyB0byB0aGVpciBvcmlnaW5hbCBzdGF0ZS4KICAgICAgICoKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfdW5iaW5kVGVtcG9yYXJ5VUlzKCkgewogICAgICAgIGZvciAodmFyIGZ1bmN0aW9uTmFtZSBpbiB0aGlzLnRlbXBvcmFyeVVJRnVuY3Rpb25zKSB7CiAgICAgICAgICBpZiAodGhpcy50ZW1wb3JhcnlVSUZ1bmN0aW9ucy5oYXNPd25Qcm9wZXJ0eShmdW5jdGlvbk5hbWUpKSB7CiAgICAgICAgICAgIHRoaXMuYm9keS5ldmVudExpc3RlbmVyc1tmdW5jdGlvbk5hbWVdID0gdGhpcy50ZW1wb3JhcnlVSUZ1bmN0aW9uc1tmdW5jdGlvbk5hbWVdOwogICAgICAgICAgICBkZWxldGUgdGhpcy50ZW1wb3JhcnlVSUZ1bmN0aW9uc1tmdW5jdGlvbk5hbWVdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLnRlbXBvcmFyeVVJRnVuY3Rpb25zID0ge307CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3VuYmluZFRlbXBvcmFyeUV2ZW50cycsCgogICAgICAvKioKICAgICAgICogVW5iaW5kIHRoZSBldmVudHMgY3JlYXRlZCBieSBfdGVtcG9yYXJ5QmluZEV2ZW50CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3VuYmluZFRlbXBvcmFyeUV2ZW50cygpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudGVtcG9yYXJ5RXZlbnRGdW5jdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBldmVudE5hbWUgPSB0aGlzLnRlbXBvcmFyeUV2ZW50RnVuY3Rpb25zW2ldLmV2ZW50OwogICAgICAgICAgdmFyIGJvdW5kRnVuY3Rpb24gPSB0aGlzLnRlbXBvcmFyeUV2ZW50RnVuY3Rpb25zW2ldLmJvdW5kRnVuY3Rpb247CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5vZmYoZXZlbnROYW1lLCBib3VuZEZ1bmN0aW9uKTsKICAgICAgICB9CiAgICAgICAgdGhpcy50ZW1wb3JhcnlFdmVudEZ1bmN0aW9ucyA9IFtdOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19iaW5kSGFtbWVyVG9EaXYnLAoKICAgICAgLyoqCiAgICAgICAqIEJpbmQgYW4gaGFtbWVyIGluc3RhbmNlIHRvIGEgRE9NIGVsZW1lbnQuCiAgICAgICAqIEBwYXJhbSBkb21FbGVtZW50CiAgICAgICAqIEBwYXJhbSBmdW5jdAogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9iaW5kSGFtbWVyVG9EaXYoZG9tRWxlbWVudCwgYm91bmRGdW5jdGlvbikgewogICAgICAgIHZhciBoYW1tZXIgPSBuZXcgSGFtbWVyKGRvbUVsZW1lbnQsIHt9KTsKICAgICAgICBoYW1tZXJVdGlsLm9uVG91Y2goaGFtbWVyLCBib3VuZEZ1bmN0aW9uKTsKICAgICAgICB0aGlzLm1hbmlwdWxhdGlvbkhhbW1lcnMucHVzaChoYW1tZXIpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jbGVhbnVwVGVtcG9yYXJ5Tm9kZXNBbmRFZGdlcycsCgogICAgICAvKioKICAgICAgICogTmVhdGx5IGNsZWFuIHVwIHRlbXBvcmFyeSBlZGdlcyBhbmQgbm9kZXMKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY2xlYW51cFRlbXBvcmFyeU5vZGVzQW5kRWRnZXMoKSB7CiAgICAgICAgLy8gX2NsZWFuIHRlbXBvcmFyeSBlZGdlcwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50ZW1wb3JhcnlJZHMuZWRnZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHRoaXMuYm9keS5lZGdlc1t0aGlzLnRlbXBvcmFyeUlkcy5lZGdlc1tpXV0uZGlzY29ubmVjdCgpOwogICAgICAgICAgZGVsZXRlIHRoaXMuYm9keS5lZGdlc1t0aGlzLnRlbXBvcmFyeUlkcy5lZGdlc1tpXV07CiAgICAgICAgICB2YXIgaW5kZXhUZW1wRWRnZSA9IHRoaXMuYm9keS5lZGdlSW5kaWNlcy5pbmRleE9mKHRoaXMudGVtcG9yYXJ5SWRzLmVkZ2VzW2ldKTsKICAgICAgICAgIGlmIChpbmRleFRlbXBFZGdlICE9PSAtMSkgewogICAgICAgICAgICB0aGlzLmJvZHkuZWRnZUluZGljZXMuc3BsaWNlKGluZGV4VGVtcEVkZ2UsIDEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gX2NsZWFuIHRlbXBvcmFyeSBub2RlcwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50ZW1wb3JhcnlJZHMubm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGRlbGV0ZSB0aGlzLmJvZHkubm9kZXNbdGhpcy50ZW1wb3JhcnlJZHMubm9kZXNbaV1dOwogICAgICAgICAgdmFyIGluZGV4VGVtcE5vZGUgPSB0aGlzLmJvZHkubm9kZUluZGljZXMuaW5kZXhPZih0aGlzLnRlbXBvcmFyeUlkcy5ub2Rlc1tpXSk7CiAgICAgICAgICBpZiAoaW5kZXhUZW1wTm9kZSAhPT0gLTEpIHsKICAgICAgICAgICAgdGhpcy5ib2R5Lm5vZGVJbmRpY2VzLnNwbGljZShpbmRleFRlbXBOb2RlLCAxKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMudGVtcG9yYXJ5SWRzID0geyBub2RlczogW10sIGVkZ2VzOiBbXSB9OwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jb250cm9sTm9kZVRvdWNoJywKCiAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBFRElUIEVER0UgRlVOQ1RJT05TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy8KCiAgICAgIC8qKgogICAgICAgKiB0aGUgdG91Y2ggaXMgdXNlZCB0byBnZXQgdGhlIHBvc2l0aW9uIG9mIHRoZSBpbml0aWFsIGNsaWNrCiAgICAgICAqIEBwYXJhbSBldmVudAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jb250cm9sTm9kZVRvdWNoKGV2ZW50KSB7CiAgICAgICAgdGhpcy5zZWxlY3Rpb25IYW5kbGVyLnVuc2VsZWN0QWxsKCk7CiAgICAgICAgdGhpcy5sYXN0VG91Y2ggPSB0aGlzLmJvZHkuZnVuY3Rpb25zLmdldFBvaW50ZXIoZXZlbnQuY2VudGVyKTsKICAgICAgICB0aGlzLmxhc3RUb3VjaC50cmFuc2xhdGlvbiA9IHV0aWwuZXh0ZW5kKHt9LCB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbik7IC8vIGNvcHkgdGhlIG9iamVjdAogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jb250cm9sTm9kZURyYWdTdGFydCcsCgogICAgICAvKioKICAgICAgICogdGhlIGRyYWcgc3RhcnQgaXMgdXNlZCB0byBtYXJrIG9uZSBvZiB0aGUgY29udHJvbCBub2RlcyBhcyBzZWxlY3RlZC4KICAgICAgICogQHBhcmFtIGV2ZW50CiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX2NvbnRyb2xOb2RlRHJhZ1N0YXJ0KGV2ZW50KSB7CiAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmxhc3RUb3VjaDsKICAgICAgICB2YXIgcG9pbnRlck9iaiA9IHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fcG9pbnRlclRvUG9zaXRpb25PYmplY3QocG9pbnRlcik7CiAgICAgICAgdmFyIGZyb20gPSB0aGlzLmJvZHkubm9kZXNbdGhpcy50ZW1wb3JhcnlJZHMubm9kZXNbMF1dOwogICAgICAgIHZhciB0byA9IHRoaXMuYm9keS5ub2Rlc1t0aGlzLnRlbXBvcmFyeUlkcy5ub2Rlc1sxXV07CiAgICAgICAgdmFyIGVkZ2UgPSB0aGlzLmJvZHkuZWRnZXNbdGhpcy5lZGdlQmVpbmdFZGl0ZWRJZF07CiAgICAgICAgdGhpcy5zZWxlY3RlZENvbnRyb2xOb2RlID0gdW5kZWZpbmVkOwoKICAgICAgICB2YXIgZnJvbVNlbGVjdCA9IGZyb20uaXNPdmVybGFwcGluZ1dpdGgocG9pbnRlck9iaik7CiAgICAgICAgdmFyIHRvU2VsZWN0ID0gdG8uaXNPdmVybGFwcGluZ1dpdGgocG9pbnRlck9iaik7CgogICAgICAgIGlmIChmcm9tU2VsZWN0ID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkQ29udHJvbE5vZGUgPSBmcm9tOwogICAgICAgICAgZWRnZS5lZGdlVHlwZS5mcm9tID0gZnJvbTsKICAgICAgICB9IGVsc2UgaWYgKHRvU2VsZWN0ID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkQ29udHJvbE5vZGUgPSB0bzsKICAgICAgICAgIGVkZ2UuZWRnZVR5cGUudG8gPSB0bzsKICAgICAgICB9CgogICAgICAgIHRoaXMuYm9keS5lbWl0dGVyLmVtaXQoJ19yZWRyYXcnKTsKICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfY29udHJvbE5vZGVEcmFnJywKCiAgICAgIC8qKgogICAgICAgKiBkcmFnZ2luZyB0aGUgY29udHJvbCBub2RlcyBvciB0aGUgY2FudmFzCiAgICAgICAqIEBwYXJhbSBldmVudAogICAgICAgKiBAcHJpdmF0ZQogICAgICAgKi8KICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9jb250cm9sTm9kZURyYWcoZXZlbnQpIHsKICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdkaXNhYmxlUGh5c2ljcycpOwogICAgICAgIHZhciBwb2ludGVyID0gdGhpcy5ib2R5LmZ1bmN0aW9ucy5nZXRQb2ludGVyKGV2ZW50LmNlbnRlcik7CiAgICAgICAgdmFyIHBvcyA9IHRoaXMuY2FudmFzLkRPTXRvQ2FudmFzKHBvaW50ZXIpOwoKICAgICAgICBpZiAodGhpcy5zZWxlY3RlZENvbnRyb2xOb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDb250cm9sTm9kZS54ID0gcG9zLng7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkQ29udHJvbE5vZGUueSA9IHBvcy55OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBpZiB0aGUgZHJhZyB3YXMgbm90IHN0YXJ0ZWQgcHJvcGVybHkgYmVjYXVzZSB0aGUgY2xpY2sgc3RhcnRlZCBvdXRzaWRlIHRoZSBuZXR3b3JrIGRpdiwgc3RhcnQgaXQgbm93LgogICAgICAgICAgdmFyIGRpZmZYID0gcG9pbnRlci54IC0gdGhpcy5sYXN0VG91Y2gueDsKICAgICAgICAgIHZhciBkaWZmWSA9IHBvaW50ZXIueSAtIHRoaXMubGFzdFRvdWNoLnk7CiAgICAgICAgICB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbiA9IHsgeDogdGhpcy5sYXN0VG91Y2gudHJhbnNsYXRpb24ueCArIGRpZmZYLCB5OiB0aGlzLmxhc3RUb3VjaC50cmFuc2xhdGlvbi55ICsgZGlmZlkgfTsKICAgICAgICB9CiAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3JlZHJhdycpOwogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19jb250cm9sTm9kZURyYWdFbmQnLAoKICAgICAgLyoqCiAgICAgICAqIGNvbm5lY3Rpbmcgb3IgcmVzdG9yaW5nIHRoZSBjb250cm9sIG5vZGVzLgogICAgICAgKiBAcGFyYW0gZXZlbnQKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfY29udHJvbE5vZGVEcmFnRW5kKGV2ZW50KSB7CiAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmJvZHkuZnVuY3Rpb25zLmdldFBvaW50ZXIoZXZlbnQuY2VudGVyKTsKICAgICAgICB2YXIgcG9pbnRlck9iaiA9IHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fcG9pbnRlclRvUG9zaXRpb25PYmplY3QocG9pbnRlcik7CiAgICAgICAgdmFyIGVkZ2UgPSB0aGlzLmJvZHkuZWRnZXNbdGhpcy5lZGdlQmVpbmdFZGl0ZWRJZF07CgogICAgICAgIHZhciBvdmVybGFwcGluZ05vZGVJZHMgPSB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX2dldEFsbE5vZGVzT3ZlcmxhcHBpbmdXaXRoKHBvaW50ZXJPYmopOwogICAgICAgIHZhciBub2RlID0gdW5kZWZpbmVkOwogICAgICAgIGZvciAodmFyIGkgPSBvdmVybGFwcGluZ05vZGVJZHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgIGlmIChvdmVybGFwcGluZ05vZGVJZHNbaV0gIT09IHRoaXMuc2VsZWN0ZWRDb250cm9sTm9kZS5pZCkgewogICAgICAgICAgICBub2RlID0gdGhpcy5ib2R5Lm5vZGVzW292ZXJsYXBwaW5nTm9kZUlkc1tpXV07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcGVyZm9ybSB0aGUgY29ubmVjdGlvbgogICAgICAgIGlmIChub2RlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zZWxlY3RlZENvbnRyb2xOb2RlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGlmIChub2RlLmlzQ2x1c3RlciA9PT0gdHJ1ZSkgewogICAgICAgICAgICBhbGVydCh0aGlzLm9wdGlvbnMubG9jYWxlc1t0aGlzLm9wdGlvbnMubG9jYWxlXVsnY3JlYXRlRWRnZUVycm9yJ10gfHwgdGhpcy5vcHRpb25zLmxvY2FsZXNbJ2VuJ11bJ2NyZWF0ZUVkZ2VFcnJvciddKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBmcm9tID0gdGhpcy5ib2R5Lm5vZGVzW3RoaXMudGVtcG9yYXJ5SWRzLm5vZGVzWzBdXTsKICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRDb250cm9sTm9kZS5pZCA9PT0gZnJvbS5pZCkgewogICAgICAgICAgICAgIHRoaXMuX3BlcmZvcm1FZGl0RWRnZShub2RlLmlkLCBlZGdlLnRvLmlkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLl9wZXJmb3JtRWRpdEVkZ2UoZWRnZS5mcm9tLmlkLCBub2RlLmlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlZGdlLnVwZGF0ZUVkZ2VUeXBlKCk7CiAgICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdyZXN0b3JlUGh5c2ljcycpOwogICAgICAgIH0KICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfcmVkcmF3Jyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX2hhbmRsZUNvbm5lY3QnLAoKICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIEVORCBPRiBFRElUIEVER0UgRlVOQ1RJT05TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy8KCiAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gQUREIEVER0UgRlVOQ1RJT05TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy8KICAgICAgLyoqCiAgICAgICAqIHRoZSBmdW5jdGlvbiBib3VuZCB0byB0aGUgc2VsZWN0aW9uIGV2ZW50LiBJdCBjaGVja3MgaWYgeW91IHdhbnQgdG8gY29ubmVjdCBhIGNsdXN0ZXIgYW5kIGNoYW5nZXMgdGhlIGRlc2NyaXB0aW9uCiAgICAgICAqIHRvIHdhbGsgdGhlIHVzZXIgdGhyb3VnaCB0aGUgcHJvY2Vzcy4KICAgICAgICoKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFuZGxlQ29ubmVjdChldmVudCkgewogICAgICAgIC8vIGNoZWNrIHRvIGF2b2lkIGRvdWJsZSBmaXJlaW5nIG9mIHRoaXMgZnVuY3Rpb24uCiAgICAgICAgaWYgKG5ldyBEYXRlKCkudmFsdWVPZigpIC0gdGhpcy50b3VjaFRpbWUgPiAxMDApIHsKICAgICAgICAgIHRoaXMubGFzdFRvdWNoID0gdGhpcy5ib2R5LmZ1bmN0aW9ucy5nZXRQb2ludGVyKGV2ZW50LmNlbnRlcik7CiAgICAgICAgICB0aGlzLmxhc3RUb3VjaC50cmFuc2xhdGlvbiA9IHV0aWwuZXh0ZW5kKHt9LCB0aGlzLmJvZHkudmlldy50cmFuc2xhdGlvbik7IC8vIGNvcHkgdGhlIG9iamVjdAoKICAgICAgICAgIHZhciBwb2ludGVyID0gdGhpcy5sYXN0VG91Y2g7CiAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMuc2VsZWN0aW9uSGFuZGxlci5nZXROb2RlQXQocG9pbnRlcik7CgogICAgICAgICAgaWYgKG5vZGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAobm9kZS5pc0NsdXN0ZXIgPT09IHRydWUpIHsKICAgICAgICAgICAgICBhbGVydCh0aGlzLm9wdGlvbnMubG9jYWxlc1t0aGlzLm9wdGlvbnMubG9jYWxlXVsnY3JlYXRlRWRnZUVycm9yJ10gfHwgdGhpcy5vcHRpb25zLmxvY2FsZXNbJ2VuJ11bJ2NyZWF0ZUVkZ2VFcnJvciddKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBjcmVhdGUgYSBub2RlIHRoZSB0ZW1wb3JhcnkgbGluZSBjYW4gbG9vayBhdAogICAgICAgICAgICAgIHZhciB0YXJnZXROb2RlID0gdGhpcy5fZ2V0TmV3VGFyZ2V0Tm9kZShub2RlLngsIG5vZGUueSk7CiAgICAgICAgICAgICAgdGhpcy5ib2R5Lm5vZGVzW3RhcmdldE5vZGUuaWRdID0gdGFyZ2V0Tm9kZTsKICAgICAgICAgICAgICB0aGlzLmJvZHkubm9kZUluZGljZXMucHVzaCh0YXJnZXROb2RlLmlkKTsKCiAgICAgICAgICAgICAgLy8gY3JlYXRlIGEgdGVtcG9yYXJ5IGVkZ2UKICAgICAgICAgICAgICB2YXIgY29ubmVjdGlvbkVkZ2UgPSB0aGlzLmJvZHkuZnVuY3Rpb25zLmNyZWF0ZUVkZ2UoewogICAgICAgICAgICAgICAgaWQ6ICdjb25uZWN0aW9uRWRnZScgKyB1dGlsLnJhbmRvbVVVSUQoKSwKICAgICAgICAgICAgICAgIGZyb206IG5vZGUuaWQsCiAgICAgICAgICAgICAgICB0bzogdGFyZ2V0Tm9kZS5pZCwKICAgICAgICAgICAgICAgIHBoeXNpY3M6IGZhbHNlLAogICAgICAgICAgICAgICAgc21vb3RoOiB7CiAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICdjb250aW51b3VzJywKICAgICAgICAgICAgICAgICAgcm91bmRuZXNzOiAwLjUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLmJvZHkuZWRnZXNbY29ubmVjdGlvbkVkZ2UuaWRdID0gY29ubmVjdGlvbkVkZ2U7CiAgICAgICAgICAgICAgdGhpcy5ib2R5LmVkZ2VJbmRpY2VzLnB1c2goY29ubmVjdGlvbkVkZ2UuaWQpOwoKICAgICAgICAgICAgICB0aGlzLnRlbXBvcmFyeUlkcy5ub2Rlcy5wdXNoKHRhcmdldE5vZGUuaWQpOwogICAgICAgICAgICAgIHRoaXMudGVtcG9yYXJ5SWRzLmVkZ2VzLnB1c2goY29ubmVjdGlvbkVkZ2UuaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnRvdWNoVGltZSA9IG5ldyBEYXRlKCkudmFsdWVPZigpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZHJhZ0NvbnRyb2xOb2RlJywKICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9kcmFnQ29udHJvbE5vZGUoZXZlbnQpIHsKICAgICAgICB2YXIgcG9pbnRlciA9IHRoaXMuYm9keS5mdW5jdGlvbnMuZ2V0UG9pbnRlcihldmVudC5jZW50ZXIpOwogICAgICAgIGlmICh0aGlzLnRlbXBvcmFyeUlkcy5ub2Rlc1swXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgdGFyZ2V0Tm9kZSA9IHRoaXMuYm9keS5ub2Rlc1t0aGlzLnRlbXBvcmFyeUlkcy5ub2Rlc1swXV07IC8vIHRoZXJlIGlzIG9ubHkgb25lIHRlbXAgbm9kZSBpbiB0aGUgYWRkIGVkZ2UgbW9kZS4KICAgICAgICAgIHRhcmdldE5vZGUueCA9IHRoaXMuY2FudmFzLl9YY29udmVydERPTXRvQ2FudmFzKHBvaW50ZXIueCk7CiAgICAgICAgICB0YXJnZXROb2RlLnkgPSB0aGlzLmNhbnZhcy5fWWNvbnZlcnRET010b0NhbnZhcyhwb2ludGVyLnkpOwogICAgICAgICAgdGhpcy5ib2R5LmVtaXR0ZXIuZW1pdCgnX3JlZHJhdycpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgZGlmZlggPSBwb2ludGVyLnggLSB0aGlzLmxhc3RUb3VjaC54OwogICAgICAgICAgdmFyIGRpZmZZID0gcG9pbnRlci55IC0gdGhpcy5sYXN0VG91Y2gueTsKICAgICAgICAgIHRoaXMuYm9keS52aWV3LnRyYW5zbGF0aW9uID0geyB4OiB0aGlzLmxhc3RUb3VjaC50cmFuc2xhdGlvbi54ICsgZGlmZlgsIHk6IHRoaXMubGFzdFRvdWNoLnRyYW5zbGF0aW9uLnkgKyBkaWZmWSB9OwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICBrZXk6ICdfZmluaXNoQ29ubmVjdCcsCgogICAgICAvKioKICAgICAgICogQ29ubmVjdCB0aGUgbmV3IGVkZ2UgdG8gdGhlIHRhcmdldCBpZiBvbmUgZXhpc3RzLCBvdGhlcndpc2UgcmVtb3ZlIHRlbXAgbGluZQogICAgICAgKiBAcGFyYW0gZXZlbnQKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZmluaXNoQ29ubmVjdChldmVudCkgewogICAgICAgIHZhciBwb2ludGVyID0gdGhpcy5ib2R5LmZ1bmN0aW9ucy5nZXRQb2ludGVyKGV2ZW50LmNlbnRlcik7CiAgICAgICAgdmFyIHBvaW50ZXJPYmogPSB0aGlzLnNlbGVjdGlvbkhhbmRsZXIuX3BvaW50ZXJUb1Bvc2l0aW9uT2JqZWN0KHBvaW50ZXIpOwoKICAgICAgICAvLyByZW1lbWJlciB0aGUgZWRnZSBpZAogICAgICAgIHZhciBjb25uZWN0RnJvbUlkID0gdW5kZWZpbmVkOwogICAgICAgIGlmICh0aGlzLnRlbXBvcmFyeUlkcy5lZGdlc1swXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBjb25uZWN0RnJvbUlkID0gdGhpcy5ib2R5LmVkZ2VzW3RoaXMudGVtcG9yYXJ5SWRzLmVkZ2VzWzBdXS5mcm9tSWQ7CiAgICAgICAgfQoKICAgICAgICAvLyBnZXQgdGhlIG92ZXJsYXBwaW5nIG5vZGUgYnV0IE5PVCB0aGUgdGVtcG9yYXJ5IG5vZGU7CiAgICAgICAgdmFyIG92ZXJsYXBwaW5nTm9kZUlkcyA9IHRoaXMuc2VsZWN0aW9uSGFuZGxlci5fZ2V0QWxsTm9kZXNPdmVybGFwcGluZ1dpdGgocG9pbnRlck9iaik7CiAgICAgICAgdmFyIG5vZGUgPSB1bmRlZmluZWQ7CiAgICAgICAgZm9yICh2YXIgaSA9IG92ZXJsYXBwaW5nTm9kZUlkcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgLy8gaWYgdGhlIG5vZGUgaWQgaXMgTk9UIGEgdGVtcG9yYXJ5IG5vZGUsIGFjY2VwdCB0aGUgbm9kZS4KICAgICAgICAgIGlmICh0aGlzLnRlbXBvcmFyeUlkcy5ub2Rlcy5pbmRleE9mKG92ZXJsYXBwaW5nTm9kZUlkc1tpXSkgPT09IC0xKSB7CiAgICAgICAgICAgIG5vZGUgPSB0aGlzLmJvZHkubm9kZXNbb3ZlcmxhcHBpbmdOb2RlSWRzW2ldXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjbGVhbiB0ZW1wb3Jhcnkgbm9kZXMgYW5kIGVkZ2VzLgogICAgICAgIHRoaXMuX2NsZWFudXBUZW1wb3JhcnlOb2Rlc0FuZEVkZ2VzKCk7CgogICAgICAgIC8vIHBlcmZvcm0gdGhlIGNvbm5lY3Rpb24KICAgICAgICBpZiAobm9kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAobm9kZS5pc0NsdXN0ZXIgPT09IHRydWUpIHsKICAgICAgICAgICAgYWxlcnQodGhpcy5vcHRpb25zLmxvY2FsZXNbdGhpcy5vcHRpb25zLmxvY2FsZV1bJ2NyZWF0ZUVkZ2VFcnJvciddIHx8IHRoaXMub3B0aW9ucy5sb2NhbGVzWydlbiddWydjcmVhdGVFZGdlRXJyb3InXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodGhpcy5ib2R5Lm5vZGVzW2Nvbm5lY3RGcm9tSWRdICE9PSB1bmRlZmluZWQgJiYgdGhpcy5ib2R5Lm5vZGVzW25vZGUuaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICB0aGlzLl9wZXJmb3JtQWRkRWRnZShjb25uZWN0RnJvbUlkLCBub2RlLmlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLmJvZHkuZW1pdHRlci5lbWl0KCdfcmVkcmF3Jyk7CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3BlcmZvcm1BZGROb2RlJywKCiAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBFTkQgT0YgQUREIEVER0UgRlVOQ1RJT05TIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vLwoKICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFBlcmZvcm1pbmcgYWxsIHRoZSBhY3R1YWwgZGF0YSBtYW5pcHVsYXRpb24gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy8KCiAgICAgIC8qKgogICAgICAgKiBBZGRzIGEgbm9kZSBvbiB0aGUgc3BlY2lmaWVkIGxvY2F0aW9uCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3BlcmZvcm1BZGROb2RlKGNsaWNrRGF0YSkgewogICAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgICB2YXIgZGVmYXVsdERhdGEgPSB7CiAgICAgICAgICBpZDogdXRpbC5yYW5kb21VVUlEKCksCiAgICAgICAgICB4OiBjbGlja0RhdGEucG9pbnRlci5jYW52YXMueCwKICAgICAgICAgIHk6IGNsaWNrRGF0YS5wb2ludGVyLmNhbnZhcy55LAogICAgICAgICAgbGFiZWw6ICduZXcnCiAgICAgICAgfTsKCiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMuYWRkTm9kZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hZGROb2RlLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMuYWRkTm9kZShkZWZhdWx0RGF0YSwgZnVuY3Rpb24gKGZpbmFsaXplZERhdGEpIHsKICAgICAgICAgICAgICBpZiAoZmluYWxpemVkRGF0YSAhPT0gbnVsbCAmJiBmaW5hbGl6ZWREYXRhICE9PSB1bmRlZmluZWQgJiYgX3RoaXM1LmluTW9kZSA9PT0gJ2FkZE5vZGUnKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBmb3Igd2hhdGV2ZXIgcmVhc29uIHRoZSBtb2RlIGhhcyBjaGFuZ2VzIChkdWUgdG8gZGF0YXNldCBjaGFuZ2UpIGRpc3JlZ2FyZCB0aGUgY2FsbGJhY2sKICAgICAgICAgICAgICAgIF90aGlzNS5ib2R5LmRhdGEubm9kZXMuZ2V0RGF0YVNldCgpLmFkZChmaW5hbGl6ZWREYXRhKTsKICAgICAgICAgICAgICAgIF90aGlzNS5zaG93TWFuaXB1bGF0b3JUb29sYmFyKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGZ1bmN0aW9uIGZvciBhZGQgZG9lcyBub3Qgc3VwcG9ydCB0d28gYXJndW1lbnRzIChkYXRhLGNhbGxiYWNrKScpOwogICAgICAgICAgICB0aGlzLnNob3dNYW5pcHVsYXRvclRvb2xiYXIoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5ib2R5LmRhdGEubm9kZXMuZ2V0RGF0YVNldCgpLmFkZChkZWZhdWx0RGF0YSk7CiAgICAgICAgICB0aGlzLnNob3dNYW5pcHVsYXRvclRvb2xiYXIoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAga2V5OiAnX3BlcmZvcm1BZGRFZGdlJywKCiAgICAgIC8qKgogICAgICAgKiBjb25uZWN0IHR3byBub2RlcyB3aXRoIGEgbmV3IGVkZ2UuCiAgICAgICAqCiAgICAgICAqIEBwcml2YXRlCiAgICAgICAqLwogICAgICB2YWx1ZTogZnVuY3Rpb24gX3BlcmZvcm1BZGRFZGdlKHNvdXJjZU5vZGVJZCwgdGFyZ2V0Tm9kZUlkKSB7CiAgICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICAgIHZhciBkZWZhdWx0RGF0YSA9IHsgZnJvbTogc291cmNlTm9kZUlkLCB0bzogdGFyZ2V0Tm9kZUlkIH07CiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm9wdGlvbnMuYWRkRWRnZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hZGRFZGdlLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMuYWRkRWRnZShkZWZhdWx0RGF0YSwgZnVuY3Rpb24gKGZpbmFsaXplZERhdGEpIHsKICAgICAgICAgICAgICBpZiAoZmluYWxpemVkRGF0YSAhPT0gbnVsbCAmJiBmaW5hbGl6ZWREYXRhICE9PSB1bmRlZmluZWQgJiYgX3RoaXM2LmluTW9kZSA9PT0gJ2FkZEVkZ2UnKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBmb3Igd2hhdGV2ZXIgcmVhc29uIHRoZSBtb2RlIGhhcyBjaGFuZ2VzIChkdWUgdG8gZGF0YXNldCBjaGFuZ2UpIGRpc3JlZ2FyZCB0aGUgY2FsbGJhY2sKICAgICAgICAgICAgICAgIF90aGlzNi5ib2R5LmRhdGEuZWRnZXMuYWRkKGZpbmFsaXplZERhdGEpOwogICAgICAgICAgICAgICAgX3RoaXM2LnNlbGVjdGlvbkhhbmRsZXIudW5zZWxlY3RBbGwoKTsKICAgICAgICAgICAgICAgIF90aGlzNi5zaG93TWFuaXB1bGF0b3JUb29sYmFyKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGZ1bmN0aW9uIGZvciBjb25uZWN0IGRvZXMgbm90IHN1cHBvcnQgdHdvIGFyZ3VtZW50cyAoZGF0YSxjYWxsYmFjayknKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5ib2R5LmRhdGEuZWRnZXMuYWRkKGRlZmF1bHREYXRhKTsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci51bnNlbGVjdEFsbCgpOwogICAgICAgICAgdGhpcy5zaG93TWFuaXB1bGF0b3JUb29sYmFyKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCB7CiAgICAgIGtleTogJ19wZXJmb3JtRWRpdEVkZ2UnLAoKICAgICAgLyoqCiAgICAgICAqIGNvbm5lY3QgdHdvIG5vZGVzIHdpdGggYSBuZXcgZWRnZS4KICAgICAgICoKICAgICAgICogQHByaXZhdGUKICAgICAgICovCiAgICAgIHZhbHVlOiBmdW5jdGlvbiBfcGVyZm9ybUVkaXRFZGdlKHNvdXJjZU5vZGVJZCwgdGFyZ2V0Tm9kZUlkKSB7CiAgICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICAgIHZhciBkZWZhdWx0RGF0YSA9IHsgaWQ6IHRoaXMuZWRnZUJlaW5nRWRpdGVkSWQsIGZyb206IHNvdXJjZU5vZGVJZCwgdG86IHRhcmdldE5vZGVJZCB9OwogICAgICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLmVkaXRFZGdlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmVkaXRFZGdlLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMuZWRpdEVkZ2UoZGVmYXVsdERhdGEsIGZ1bmN0aW9uIChmaW5hbGl6ZWREYXRhKSB7CiAgICAgICAgICAgICAgaWYgKGZpbmFsaXplZERhdGEgPT09IG51bGwgfHwgZmluYWxpemVkRGF0YSA9PT0gdW5kZWZpbmVkIHx8IF90aGlzNy5pbk1vZGUgIT09ICdlZGl0RWRnZScpIHsKICAgICAgICAgICAgICAgIC8vIGlmIGZvciB3aGF0ZXZlciByZWFzb24gdGhlIG1vZGUgaGFzIGNoYW5nZXMgKGR1ZSB0byBkYXRhc2V0IGNoYW5nZSkgZGlzcmVnYXJkIHRoZSBjYWxsYmFjaykgewogICAgICAgICAgICAgICAgX3RoaXM3LmJvZHkuZWRnZXNbZGVmYXVsdERhdGEuaWRdLnVwZGF0ZUVkZ2VUeXBlKCk7CiAgICAgICAgICAgICAgICBfdGhpczcuYm9keS5lbWl0dGVyLmVtaXQoJ19yZWRyYXcnKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXM3LmJvZHkuZGF0YS5lZGdlcy51cGRhdGUoZmluYWxpemVkRGF0YSk7CiAgICAgICAgICAgICAgICBfdGhpczcuc2VsZWN0aW9uSGFuZGxlci51bnNlbGVjdEFsbCgpOwogICAgICAgICAgICAgICAgX3RoaXM3LnNob3dNYW5pcHVsYXRvclRvb2xiYXIoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgZnVuY3Rpb24gZm9yIGVkaXQgZG9lcyBub3Qgc3VwcG9ydCB0d28gYXJndW1lbnRzIChkYXRhLCBjYWxsYmFjayknKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5ib2R5LmRhdGEuZWRnZXMudXBkYXRlKGRlZmF1bHREYXRhKTsKICAgICAgICAgIHRoaXMuc2VsZWN0aW9uSGFuZGxlci51bnNlbGVjdEFsbCgpOwogICAgICAgICAgdGhpcy5zaG93TWFuaXB1bGF0b3JUb29sYmFyKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9XSk7CgogICAgcmV0dXJuIE1hbmlwdWxhdGlvblN5c3RlbTsKICB9KSgpOwoKICBleHBvcnRzWydkZWZhdWx0J10gPSBNYW5pcHVsYXRpb25TeXN0ZW07CiAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107CgovKioqLyB9LAovKiAxMDggKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgogIC8qKgogICAqIFRoaXMgb2JqZWN0IGNvbnRhaW5zIGFsbCBwb3NzaWJsZSBvcHRpb25zLiBJdCB3aWxsIGNoZWNrIGlmIHRoZSB0eXBlcyBhcmUgY29ycmVjdCwgaWYgcmVxdWlyZWQgaWYgdGhlIG9wdGlvbiBpcyBvbmUKICAgKiBvZiB0aGUgYWxsb3dlZCB2YWx1ZXMuCiAgICoKICAgKiBfX2FueV9fIG1lYW5zIHRoYXQgdGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5IGRvZXMgbm90IG1hdHRlci4KICAgKiBfX3R5cGVfXyBpcyBhIHJlcXVpcmVkIGZpZWxkIGZvciBhbGwgb2JqZWN0cyBhbmQgY29udGFpbnMgdGhlIGFsbG93ZWQgdHlwZXMgb2YgYWxsIG9iamVjdHMKICAgKi8KICAndXNlIHN0cmljdCc7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgIHZhbHVlOiB0cnVlCiAgfSk7CiAgdmFyIHN0cmluZyA9ICdzdHJpbmcnOwogIHZhciBib29sZWFuID0gJ2Jvb2xlYW4nOwogIHZhciBudW1iZXIgPSAnbnVtYmVyJzsKICB2YXIgYXJyYXkgPSAnYXJyYXknOwogIHZhciBvYmplY3QgPSAnb2JqZWN0JzsgLy8gc2hvdWxkIG9ubHkgYmUgaW4gYSBfX3R5cGVfXyBwcm9wZXJ0eQogIHZhciBkb20gPSAnZG9tJzsKICB2YXIgYW55ID0gJ2FueSc7CgogIHZhciBhbGxPcHRpb25zID0gewogICAgY29uZmlndXJlOiB7CiAgICAgIGVuYWJsZWQ6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBmaWx0ZXI6IHsgYm9vbGVhbjogYm9vbGVhbiwgc3RyaW5nOiBzdHJpbmcsIGFycmF5OiBhcnJheSwgJ2Z1bmN0aW9uJzogJ2Z1bmN0aW9uJyB9LAogICAgICBjb250YWluZXI6IHsgZG9tOiBkb20gfSwKICAgICAgc2hvd0J1dHRvbjogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0LCBib29sZWFuOiBib29sZWFuLCBzdHJpbmc6IHN0cmluZywgYXJyYXk6IGFycmF5LCAnZnVuY3Rpb24nOiAnZnVuY3Rpb24nIH0KICAgIH0sCiAgICBlZGdlczogewogICAgICBhcnJvd3M6IHsKICAgICAgICB0bzogeyBlbmFibGVkOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwgc2NhbGVGYWN0b3I6IHsgbnVtYmVyOiBudW1iZXIgfSwgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QsIGJvb2xlYW46IGJvb2xlYW4gfSB9LAogICAgICAgIG1pZGRsZTogeyBlbmFibGVkOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwgc2NhbGVGYWN0b3I6IHsgbnVtYmVyOiBudW1iZXIgfSwgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QsIGJvb2xlYW46IGJvb2xlYW4gfSB9LAogICAgICAgIGZyb206IHsgZW5hYmxlZDogeyBib29sZWFuOiBib29sZWFuIH0sIHNjYWxlRmFjdG9yOiB7IG51bWJlcjogbnVtYmVyIH0sIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0LCBib29sZWFuOiBib29sZWFuIH0gfSwKICAgICAgICBfX3R5cGVfXzogeyBzdHJpbmc6IFsnZnJvbScsICd0bycsICdtaWRkbGUnXSwgb2JqZWN0OiBvYmplY3QgfQogICAgICB9LAogICAgICBjb2xvcjogewogICAgICAgIGNvbG9yOiB7IHN0cmluZzogc3RyaW5nIH0sCiAgICAgICAgaGlnaGxpZ2h0OiB7IHN0cmluZzogc3RyaW5nIH0sCiAgICAgICAgaG92ZXI6IHsgc3RyaW5nOiBzdHJpbmcgfSwKICAgICAgICBpbmhlcml0OiB7IHN0cmluZzogWydmcm9tJywgJ3RvJywgJ2JvdGgnXSwgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICAgIG9wYWNpdHk6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCwgc3RyaW5nOiBzdHJpbmcgfQogICAgICB9LAogICAgICBkYXNoZXM6IHsgYm9vbGVhbjogYm9vbGVhbiwgYXJyYXk6IGFycmF5IH0sCiAgICAgIGZvbnQ6IHsKICAgICAgICBjb2xvcjogeyBzdHJpbmc6IHN0cmluZyB9LAogICAgICAgIHNpemU6IHsgbnVtYmVyOiBudW1iZXIgfSwgLy8gcHgKICAgICAgICBmYWNlOiB7IHN0cmluZzogc3RyaW5nIH0sCiAgICAgICAgYmFja2dyb3VuZDogeyBzdHJpbmc6IHN0cmluZyB9LAogICAgICAgIHN0cm9rZVdpZHRoOiB7IG51bWJlcjogbnVtYmVyIH0sIC8vIHB4CiAgICAgICAgc3Ryb2tlQ29sb3I6IHsgc3RyaW5nOiBzdHJpbmcgfSwKICAgICAgICBhbGlnbjogeyBzdHJpbmc6IFsnaG9yaXpvbnRhbCcsICd0b3AnLCAnbWlkZGxlJywgJ2JvdHRvbSddIH0sCiAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QsIHN0cmluZzogc3RyaW5nIH0KICAgICAgfSwKICAgICAgaGlkZGVuOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgaG92ZXJXaWR0aDogeyAnZnVuY3Rpb24nOiAnZnVuY3Rpb24nLCBudW1iZXI6IG51bWJlciB9LAogICAgICBsYWJlbDogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIGxlbmd0aDogeyBudW1iZXI6IG51bWJlciwgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIHBoeXNpY3M6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBzY2FsaW5nOiB7CiAgICAgICAgbWluOiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgbWF4OiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgbGFiZWw6IHsKICAgICAgICAgIGVuYWJsZWQ6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICAgICAgbWluOiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgICBtYXg6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICAgIG1heFZpc2libGU6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICAgIGRyYXdUaHJlc2hvbGQ6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0LCBib29sZWFuOiBib29sZWFuIH0KICAgICAgICB9LAogICAgICAgIGN1c3RvbVNjYWxpbmdGdW5jdGlvbjogeyAnZnVuY3Rpb24nOiAnZnVuY3Rpb24nIH0sCiAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgICB9LAogICAgICBzZWxlY3Rpb25XaWR0aDogeyAnZnVuY3Rpb24nOiAnZnVuY3Rpb24nLCBudW1iZXI6IG51bWJlciB9LAogICAgICBzZWxmUmVmZXJlbmNlU2l6ZTogeyBudW1iZXI6IG51bWJlciB9LAogICAgICBzaGFkb3c6IHsKICAgICAgICBlbmFibGVkOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgICBzaXplOiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgeDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIHk6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCwgYm9vbGVhbjogYm9vbGVhbiB9CiAgICAgIH0sCiAgICAgIHNtb290aDogewogICAgICAgIGVuYWJsZWQ6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICAgIHR5cGU6IHsgc3RyaW5nOiBbJ2R5bmFtaWMnLCAnY29udGludW91cycsICdkaXNjcmV0ZScsICdkaWFnb25hbENyb3NzJywgJ3N0cmFpZ2h0Q3Jvc3MnLCAnaG9yaXpvbnRhbCcsICd2ZXJ0aWNhbCcsICdjdXJ2ZWRDVycsICdjdXJ2ZWRDQ1cnXSB9LAogICAgICAgIHJvdW5kbmVzczogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0LCBib29sZWFuOiBib29sZWFuIH0KICAgICAgfSwKICAgICAgdGl0bGU6IHsgc3RyaW5nOiBzdHJpbmcsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICB3aWR0aDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICB2YWx1ZTogeyBudW1iZXI6IG51bWJlciwgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICAgIH0sCiAgICBncm91cHM6IHsKICAgICAgdXNlRGVmYXVsdEdyb3VwczogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgIF9fYW55X186ICdnZXQgZnJvbSBub2Rlcywgd2lsbCBiZSBvdmVyd3JpdHRlbiBiZWxvdycsCiAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICAgIH0sCiAgICBpbnRlcmFjdGlvbjogewogICAgICBkcmFnTm9kZXM6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBkcmFnVmlldzogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgIGhpZGVFZGdlc09uRHJhZzogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgIGhpZGVOb2Rlc09uRHJhZzogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgIGhvdmVyOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAga2V5Ym9hcmQ6IHsKICAgICAgICBlbmFibGVkOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgICBzcGVlZDogeyB4OiB7IG51bWJlcjogbnVtYmVyIH0sIHk6IHsgbnVtYmVyOiBudW1iZXIgfSwgem9vbTogeyBudW1iZXI6IG51bWJlciB9LCBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9IH0sCiAgICAgICAgYmluZFRvV2luZG93OiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCwgYm9vbGVhbjogYm9vbGVhbiB9CiAgICAgIH0sCiAgICAgIG11bHRpc2VsZWN0OiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgbmF2aWdhdGlvbkJ1dHRvbnM6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBzZWxlY3RhYmxlOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgc2VsZWN0Q29ubmVjdGVkRWRnZXM6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBob3ZlckNvbm5lY3RlZEVkZ2VzOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgdG9vbHRpcERlbGF5OiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgIHpvb21WaWV3OiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgfSwKICAgIGxheW91dDogewogICAgICByYW5kb21TZWVkOiB7ICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJywgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgaGllcmFyY2hpY2FsOiB7CiAgICAgICAgZW5hYmxlZDogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgICAgbGV2ZWxTZXBhcmF0aW9uOiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgZGlyZWN0aW9uOiB7IHN0cmluZzogWydVRCcsICdEVScsICdMUicsICdSTCddIH0sIC8vIFVELCBEVSwgTFIsIFJMCiAgICAgICAgc29ydE1ldGhvZDogeyBzdHJpbmc6IFsnaHVic2l6ZScsICdkaXJlY3RlZCddIH0sIC8vIGh1YnNpemUsIGRpcmVjdGVkCiAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QsIGJvb2xlYW46IGJvb2xlYW4gfQogICAgICB9LAogICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9CiAgICB9LAogICAgbWFuaXB1bGF0aW9uOiB7CiAgICAgIGVuYWJsZWQ6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBpbml0aWFsbHlBY3RpdmU6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICBhZGROb2RlOiB7IGJvb2xlYW46IGJvb2xlYW4sICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfSwKICAgICAgYWRkRWRnZTogeyBib29sZWFuOiBib29sZWFuLCAnZnVuY3Rpb24nOiAnZnVuY3Rpb24nIH0sCiAgICAgIGVkaXROb2RlOiB7ICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfSwKICAgICAgZWRpdEVkZ2U6IHsgYm9vbGVhbjogYm9vbGVhbiwgJ2Z1bmN0aW9uJzogJ2Z1bmN0aW9uJyB9LAogICAgICBkZWxldGVOb2RlOiB7IGJvb2xlYW46IGJvb2xlYW4sICdmdW5jdGlvbic6ICdmdW5jdGlvbicgfSwKICAgICAgZGVsZXRlRWRnZTogeyBib29sZWFuOiBib29sZWFuLCAnZnVuY3Rpb24nOiAnZnVuY3Rpb24nIH0sCiAgICAgIGNvbnRyb2xOb2RlU3R5bGU6ICdnZXQgZnJvbSBub2Rlcywgd2lsbCBiZSBvdmVyd3JpdHRlbiBiZWxvdycsCiAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0LCBib29sZWFuOiBib29sZWFuIH0KICAgIH0sCiAgICBub2RlczogewogICAgICBib3JkZXJXaWR0aDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICBib3JkZXJXaWR0aFNlbGVjdGVkOiB7IG51bWJlcjogbnVtYmVyLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgYnJva2VuSW1hZ2U6IHsgc3RyaW5nOiBzdHJpbmcsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICBjb2xvcjogewogICAgICAgIGJvcmRlcjogeyBzdHJpbmc6IHN0cmluZyB9LAogICAgICAgIGJhY2tncm91bmQ6IHsgc3RyaW5nOiBzdHJpbmcgfSwKICAgICAgICBoaWdobGlnaHQ6IHsKICAgICAgICAgIGJvcmRlcjogeyBzdHJpbmc6IHN0cmluZyB9LAogICAgICAgICAgYmFja2dyb3VuZDogeyBzdHJpbmc6IHN0cmluZyB9LAogICAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QsIHN0cmluZzogc3RyaW5nIH0KICAgICAgICB9LAogICAgICAgIGhvdmVyOiB7CiAgICAgICAgICBib3JkZXI6IHsgc3RyaW5nOiBzdHJpbmcgfSwKICAgICAgICAgIGJhY2tncm91bmQ6IHsgc3RyaW5nOiBzdHJpbmcgfSwKICAgICAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0LCBzdHJpbmc6IHN0cmluZyB9CiAgICAgICAgfSwKICAgICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCwgc3RyaW5nOiBzdHJpbmcgfQogICAgICB9LAogICAgICBmaXhlZDogewogICAgICAgIHg6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICAgIHk6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0LCBib29sZWFuOiBib29sZWFuIH0KICAgICAgfSwKICAgICAgZm9udDogewogICAgICAgIGNvbG9yOiB7IHN0cmluZzogc3RyaW5nIH0sCiAgICAgICAgc2l6ZTogeyBudW1iZXI6IG51bWJlciB9LCAvLyBweAogICAgICAgIGZhY2U6IHsgc3RyaW5nOiBzdHJpbmcgfSwKICAgICAgICBiYWNrZ3JvdW5kOiB7IHN0cmluZzogc3RyaW5nIH0sCiAgICAgICAgc3Ryb2tlV2lkdGg6IHsgbnVtYmVyOiBudW1iZXIgfSwgLy8gcHgKICAgICAgICBzdHJva2VDb2xvcjogeyBzdHJpbmc6IHN0cmluZyB9LAogICAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0LCBzdHJpbmc6IHN0cmluZyB9CiAgICAgIH0sCiAgICAgIGdyb3VwOiB7IHN0cmluZzogc3RyaW5nLCBudW1iZXI6IG51bWJlciwgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIGhpZGRlbjogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgIGljb246IHsKICAgICAgICBmYWNlOiB7IHN0cmluZzogc3RyaW5nIH0sCiAgICAgICAgY29kZTogeyBzdHJpbmc6IHN0cmluZyB9LCAvLydcdWYwMDcnLAogICAgICAgIHNpemU6IHsgbnVtYmVyOiBudW1iZXIgfSwgLy81MCwKICAgICAgICBjb2xvcjogeyBzdHJpbmc6IHN0cmluZyB9LAogICAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICAgICAgfSwKICAgICAgaWQ6IHsgc3RyaW5nOiBzdHJpbmcsIG51bWJlcjogbnVtYmVyIH0sCiAgICAgIGltYWdlOiB7IHN0cmluZzogc3RyaW5nLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwgLy8gLS0+IFVSTAogICAgICBsYWJlbDogeyBzdHJpbmc6IHN0cmluZywgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIGxldmVsOiB7IG51bWJlcjogbnVtYmVyLCAndW5kZWZpbmVkJzogJ3VuZGVmaW5lZCcgfSwKICAgICAgbWFzczogeyBudW1iZXI6IG51bWJlciB9LAogICAgICBwaHlzaWNzOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgc2NhbGluZzogewogICAgICAgIG1pbjogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIG1heDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIGxhYmVsOiB7CiAgICAgICAgICBlbmFibGVkOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgICAgIG1pbjogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgICAgbWF4OiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgICBtYXhWaXNpYmxlOiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgICBkcmF3VGhyZXNob2xkOiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCwgYm9vbGVhbjogYm9vbGVhbiB9CiAgICAgICAgfSwKICAgICAgICBjdXN0b21TY2FsaW5nRnVuY3Rpb246IHsgJ2Z1bmN0aW9uJzogJ2Z1bmN0aW9uJyB9LAogICAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICAgICAgfSwKICAgICAgc2hhZG93OiB7CiAgICAgICAgZW5hYmxlZDogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgICAgc2l6ZTogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIHg6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICB5OiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QsIGJvb2xlYW46IGJvb2xlYW4gfQogICAgICB9LAogICAgICBzaGFwZTogeyBzdHJpbmc6IFsnZWxsaXBzZScsICdjaXJjbGUnLCAnZGF0YWJhc2UnLCAnYm94JywgJ3RleHQnLCAnaW1hZ2UnLCAnY2lyY3VsYXJJbWFnZScsICdkaWFtb25kJywgJ2RvdCcsICdzdGFyJywgJ3RyaWFuZ2xlJywgJ3RyaWFuZ2xlRG93bicsICdzcXVhcmUnLCAnaWNvbiddIH0sCiAgICAgIHNpemU6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgdGl0bGU6IHsgc3RyaW5nOiBzdHJpbmcsICd1bmRlZmluZWQnOiAndW5kZWZpbmVkJyB9LAogICAgICB2YWx1ZTogeyBudW1iZXI6IG51bWJlciwgJ3VuZGVmaW5lZCc6ICd1bmRlZmluZWQnIH0sCiAgICAgIHg6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgeTogeyBudW1iZXI6IG51bWJlciB9LAogICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9CiAgICB9LAogICAgcGh5c2ljczogewogICAgICBlbmFibGVkOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgYmFybmVzSHV0OiB7CiAgICAgICAgZ3Jhdml0YXRpb25hbENvbnN0YW50OiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgY2VudHJhbEdyYXZpdHk6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBzcHJpbmdMZW5ndGg6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBzcHJpbmdDb25zdGFudDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIGRhbXBpbmc6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBhdm9pZE92ZXJsYXA6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9CiAgICAgIH0sCiAgICAgIGZvcmNlQXRsYXMyQmFzZWQ6IHsKICAgICAgICBncmF2aXRhdGlvbmFsQ29uc3RhbnQ6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBjZW50cmFsR3Jhdml0eTogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIHNwcmluZ0xlbmd0aDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIHNwcmluZ0NvbnN0YW50OiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgZGFtcGluZzogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIGF2b2lkT3ZlcmxhcDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICAgICAgfSwKICAgICAgcmVwdWxzaW9uOiB7CiAgICAgICAgY2VudHJhbEdyYXZpdHk6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBzcHJpbmdMZW5ndGg6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBzcHJpbmdDb25zdGFudDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIG5vZGVEaXN0YW5jZTogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIGRhbXBpbmc6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCB9CiAgICAgIH0sCiAgICAgIGhpZXJhcmNoaWNhbFJlcHVsc2lvbjogewogICAgICAgIGNlbnRyYWxHcmF2aXR5OiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgc3ByaW5nTGVuZ3RoOiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgc3ByaW5nQ29uc3RhbnQ6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBub2RlRGlzdGFuY2U6IHsgbnVtYmVyOiBudW1iZXIgfSwKICAgICAgICBkYW1waW5nOiB7IG51bWJlcjogbnVtYmVyIH0sCiAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgICB9LAogICAgICBtYXhWZWxvY2l0eTogeyBudW1iZXI6IG51bWJlciB9LAogICAgICBtaW5WZWxvY2l0eTogeyBudW1iZXI6IG51bWJlciB9LCAvLyBweC9zCiAgICAgIHNvbHZlcjogeyBzdHJpbmc6IFsnYmFybmVzSHV0JywgJ3JlcHVsc2lvbicsICdoaWVyYXJjaGljYWxSZXB1bHNpb24nLCAnZm9yY2VBdGxhczJCYXNlZCddIH0sCiAgICAgIHN0YWJpbGl6YXRpb246IHsKICAgICAgICBlbmFibGVkOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgICAgICBpdGVyYXRpb25zOiB7IG51bWJlcjogbnVtYmVyIH0sIC8vIG1heGltdW0gbnVtYmVyIG9mIGl0ZXJhdGlvbiB0byBzdGFiaWxpemUKICAgICAgICB1cGRhdGVJbnRlcnZhbDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICAgIG9ubHlEeW5hbWljRWRnZXM6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgICAgIGZpdDogeyBib29sZWFuOiBib29sZWFuIH0sCiAgICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QsIGJvb2xlYW46IGJvb2xlYW4gfQogICAgICB9LAogICAgICB0aW1lc3RlcDogeyBudW1iZXI6IG51bWJlciB9LAogICAgICBfX3R5cGVfXzogeyBvYmplY3Q6IG9iamVjdCwgYm9vbGVhbjogYm9vbGVhbiB9CiAgICB9LAoKICAgIC8vZ2xvYmFscyA6CiAgICBhdXRvUmVzaXplOiB7IGJvb2xlYW46IGJvb2xlYW4gfSwKICAgIGNsaWNrVG9Vc2U6IHsgYm9vbGVhbjogYm9vbGVhbiB9LAogICAgbG9jYWxlOiB7IHN0cmluZzogc3RyaW5nIH0sCiAgICBsb2NhbGVzOiB7CiAgICAgIF9fYW55X186IHsgYW55OiBhbnkgfSwKICAgICAgX190eXBlX186IHsgb2JqZWN0OiBvYmplY3QgfQogICAgfSwKICAgIGhlaWdodDogeyBzdHJpbmc6IHN0cmluZyB9LAogICAgd2lkdGg6IHsgc3RyaW5nOiBzdHJpbmcgfSwKICAgIF9fdHlwZV9fOiB7IG9iamVjdDogb2JqZWN0IH0KICB9OwoKICBhbGxPcHRpb25zLmdyb3Vwcy5fX2FueV9fID0gYWxsT3B0aW9ucy5ub2RlczsKICBhbGxPcHRpb25zLm1hbmlwdWxhdGlvbi5jb250cm9sTm9kZVN0eWxlID0gYWxsT3B0aW9ucy5ub2RlczsKCiAgdmFyIGNvbmZpZ3VyZU9wdGlvbnMgPSB7CiAgICBub2RlczogewogICAgICBib3JkZXJXaWR0aDogWzEsIDAsIDEwLCAxXSwKICAgICAgYm9yZGVyV2lkdGhTZWxlY3RlZDogWzIsIDAsIDEwLCAxXSwKICAgICAgY29sb3I6IHsKICAgICAgICBib3JkZXI6IFsnY29sb3InLCAnIzJCN0NFOSddLAogICAgICAgIGJhY2tncm91bmQ6IFsnY29sb3InLCAnIzk3QzJGQyddLAogICAgICAgIGhpZ2hsaWdodDogewogICAgICAgICAgYm9yZGVyOiBbJ2NvbG9yJywgJyMyQjdDRTknXSwKICAgICAgICAgIGJhY2tncm91bmQ6IFsnY29sb3InLCAnI0QyRTVGRiddCiAgICAgICAgfSwKICAgICAgICBob3ZlcjogewogICAgICAgICAgYm9yZGVyOiBbJ2NvbG9yJywgJyMyQjdDRTknXSwKICAgICAgICAgIGJhY2tncm91bmQ6IFsnY29sb3InLCAnI0QyRTVGRiddCiAgICAgICAgfQogICAgICB9LAogICAgICBmaXhlZDogewogICAgICAgIHg6IGZhbHNlLAogICAgICAgIHk6IGZhbHNlCiAgICAgIH0sCiAgICAgIGZvbnQ6IHsKICAgICAgICBjb2xvcjogWydjb2xvcicsICcjMzQzNDM0J10sCiAgICAgICAgc2l6ZTogWzE0LCAwLCAxMDAsIDFdLCAvLyBweAogICAgICAgIGZhY2U6IFsnYXJpYWwnLCAndmVyZGFuYScsICd0YWhvbWEnXSwKICAgICAgICBiYWNrZ3JvdW5kOiBbJ2NvbG9yJywgJ25vbmUnXSwKICAgICAgICBzdHJva2VXaWR0aDogWzAsIDAsIDUwLCAxXSwgLy8gcHgKICAgICAgICBzdHJva2VDb2xvcjogWydjb2xvcicsICcjZmZmZmZmJ10KICAgICAgfSwKICAgICAgLy9ncm91cDogJ3N0cmluZycsCiAgICAgIGhpZGRlbjogZmFsc2UsCiAgICAgIC8vaWNvbjogewogICAgICAvLyAgZmFjZTogJ3N0cmluZycsICAvLydGb250QXdlc29tZScsCiAgICAgIC8vICBjb2RlOiAnc3RyaW5nJywgIC8vJ1x1ZjAwNycsCiAgICAgIC8vICBzaXplOiBbNTAsIDAsIDIwMCwgMV0sICAvLzUwLAogICAgICAvLyAgY29sb3I6IFsnY29sb3InLCcjMkI3Q0U5J10gICAvLycjYWEwMGZmJwogICAgICAvL30sCiAgICAgIC8vaW1hZ2U6ICdzdHJpbmcnLCAvLyAtLT4gVVJMCiAgICAgIHBoeXNpY3M6IHRydWUsCiAgICAgIHNjYWxpbmc6IHsKICAgICAgICBtaW46IFsxMCwgMCwgMjAwLCAxXSwKICAgICAgICBtYXg6IFszMCwgMCwgMjAwLCAxXSwKICAgICAgICBsYWJlbDogewogICAgICAgICAgZW5hYmxlZDogZmFsc2UsCiAgICAgICAgICBtaW46IFsxNCwgMCwgMjAwLCAxXSwKICAgICAgICAgIG1heDogWzMwLCAwLCAyMDAsIDFdLAogICAgICAgICAgbWF4VmlzaWJsZTogWzMwLCAwLCAyMDAsIDFdLAogICAgICAgICAgZHJhd1RocmVzaG9sZDogWzUsIDAsIDIwLCAxXQogICAgICAgIH0KICAgICAgfSwKICAgICAgc2hhZG93OiB7CiAgICAgICAgZW5hYmxlZDogZmFsc2UsCiAgICAgICAgc2l6ZTogWzEwLCAwLCAyMCwgMV0sCiAgICAgICAgeDogWzUsIC0zMCwgMzAsIDFdLAogICAgICAgIHk6IFs1LCAtMzAsIDMwLCAxXQogICAgICB9LAogICAgICBzaGFwZTogWydlbGxpcHNlJywgJ2JveCcsICdjaXJjbGUnLCAnZGF0YWJhc2UnLCAnZGlhbW9uZCcsICdkb3QnLCAnc3F1YXJlJywgJ3N0YXInLCAndGV4dCcsICd0cmlhbmdsZScsICd0cmlhbmdsZURvd24nXSwKICAgICAgc2l6ZTogWzI1LCAwLCAyMDAsIDFdCiAgICB9LAogICAgZWRnZXM6IHsKICAgICAgYXJyb3dzOiB7CiAgICAgICAgdG86IHsgZW5hYmxlZDogZmFsc2UsIHNjYWxlRmFjdG9yOiBbMSwgMCwgMywgMC4wNV0gfSwgLy8gYm9vbGVhbiAvIHthcnJvd1NjYWxlRmFjdG9yOjF9IC8ge2VuYWJsZWQ6IGZhbHNlLCBhcnJvd1NjYWxlRmFjdG9yOjF9CiAgICAgICAgbWlkZGxlOiB7IGVuYWJsZWQ6IGZhbHNlLCBzY2FsZUZhY3RvcjogWzEsIDAsIDMsIDAuMDVdIH0sCiAgICAgICAgZnJvbTogeyBlbmFibGVkOiBmYWxzZSwgc2NhbGVGYWN0b3I6IFsxLCAwLCAzLCAwLjA1XSB9CiAgICAgIH0sCiAgICAgIGNvbG9yOiB7CiAgICAgICAgY29sb3I6IFsnY29sb3InLCAnIzg0ODQ4NCddLAogICAgICAgIGhpZ2hsaWdodDogWydjb2xvcicsICcjODQ4NDg0J10sCiAgICAgICAgaG92ZXI6IFsnY29sb3InLCAnIzg0ODQ4NCddLAogICAgICAgIGluaGVyaXQ6IFsnZnJvbScsICd0bycsICdib3RoJywgdHJ1ZSwgZmFsc2VdLAogICAgICAgIG9wYWNpdHk6IFsxLCAwLCAxLCAwLjA1XQogICAgICB9LAogICAgICBkYXNoZXM6IGZhbHNlLAogICAgICBmb250OiB7CiAgICAgICAgY29sb3I6IFsnY29sb3InLCAnIzM0MzQzNCddLAogICAgICAgIHNpemU6IFsxNCwgMCwgMTAwLCAxXSwgLy8gcHgKICAgICAgICBmYWNlOiBbJ2FyaWFsJywgJ3ZlcmRhbmEnLCAndGFob21hJ10sCiAgICAgICAgYmFja2dyb3VuZDogWydjb2xvcicsICdub25lJ10sCiAgICAgICAgc3Ryb2tlV2lkdGg6IFsyLCAwLCA1MCwgMV0sIC8vIHB4CiAgICAgICAgc3Ryb2tlQ29sb3I6IFsnY29sb3InLCAnI2ZmZmZmZiddLAogICAgICAgIGFsaWduOiBbJ2hvcml6b250YWwnLCAndG9wJywgJ21pZGRsZScsICdib3R0b20nXQogICAgICB9LAogICAgICBoaWRkZW46IGZhbHNlLAogICAgICBob3ZlcldpZHRoOiBbMS41LCAwLCA1LCAwLjFdLAogICAgICBwaHlzaWNzOiB0cnVlLAogICAgICBzY2FsaW5nOiB7CiAgICAgICAgbWluOiBbMSwgMCwgMTAwLCAxXSwKICAgICAgICBtYXg6IFsxNSwgMCwgMTAwLCAxXSwKICAgICAgICBsYWJlbDogewogICAgICAgICAgZW5hYmxlZDogdHJ1ZSwKICAgICAgICAgIG1pbjogWzE0LCAwLCAyMDAsIDFdLAogICAgICAgICAgbWF4OiBbMzAsIDAsIDIwMCwgMV0sCiAgICAgICAgICBtYXhWaXNpYmxlOiBbMzAsIDAsIDIwMCwgMV0sCiAgICAgICAgICBkcmF3VGhyZXNob2xkOiBbNSwgMCwgMjAsIDFdCiAgICAgICAgfQogICAgICB9LAogICAgICBzZWxlY3Rpb25XaWR0aDogWzEuNSwgMCwgNSwgMC4xXSwKICAgICAgc2VsZlJlZmVyZW5jZVNpemU6IFsyMCwgMCwgMjAwLCAxXSwKICAgICAgc2hhZG93OiB7CiAgICAgICAgZW5hYmxlZDogZmFsc2UsCiAgICAgICAgc2l6ZTogWzEwLCAwLCAyMCwgMV0sCiAgICAgICAgeDogWzUsIC0zMCwgMzAsIDFdLAogICAgICAgIHk6IFs1LCAtMzAsIDMwLCAxXQogICAgICB9LAogICAgICBzbW9vdGg6IHsKICAgICAgICBlbmFibGVkOiB0cnVlLAogICAgICAgIHR5cGU6IFsnZHluYW1pYycsICdjb250aW51b3VzJywgJ2Rpc2NyZXRlJywgJ2RpYWdvbmFsQ3Jvc3MnLCAnc3RyYWlnaHRDcm9zcycsICdob3Jpem9udGFsJywgJ3ZlcnRpY2FsJywgJ2N1cnZlZENXJywgJ2N1cnZlZENDVyddLAogICAgICAgIHJvdW5kbmVzczogWzAuNSwgMCwgMSwgMC4wNV0KICAgICAgfSwKICAgICAgd2lkdGg6IFsxLCAwLCAzMCwgMV0KICAgIH0sCiAgICBsYXlvdXQ6IHsKICAgICAgLy9yYW5kb21TZWVkOiBbMCwgMCwgNTAwLCAxXSwKICAgICAgaGllcmFyY2hpY2FsOiB7CiAgICAgICAgZW5hYmxlZDogZmFsc2UsCiAgICAgICAgbGV2ZWxTZXBhcmF0aW9uOiBbMTUwLCAyMCwgNTAwLCA1XSwKICAgICAgICBkaXJlY3Rpb246IFsnVUQnLCAnRFUnLCAnTFInLCAnUkwnXSwgLy8gVUQsIERVLCBMUiwgUkwKICAgICAgICBzb3J0TWV0aG9kOiBbJ2h1YnNpemUnLCAnZGlyZWN0ZWQnXSAvLyBodWJzaXplLCBkaXJlY3RlZAogICAgICB9CiAgICB9LAogICAgaW50ZXJhY3Rpb246IHsKICAgICAgZHJhZ05vZGVzOiB0cnVlLAogICAgICBkcmFnVmlldzogdHJ1ZSwKICAgICAgaGlkZUVkZ2VzT25EcmFnOiBmYWxzZSwKICAgICAgaGlkZU5vZGVzT25EcmFnOiBmYWxzZSwKICAgICAgaG92ZXI6IGZhbHNlLAogICAgICBrZXlib2FyZDogewogICAgICAgIGVuYWJsZWQ6IGZhbHNlLAogICAgICAgIHNwZWVkOiB7IHg6IFsxMCwgMCwgNDAsIDFdLCB5OiBbMTAsIDAsIDQwLCAxXSwgem9vbTogWzAuMDIsIDAsIDAuMSwgMC4wMDVdIH0sCiAgICAgICAgYmluZFRvV2luZG93OiB0cnVlCiAgICAgIH0sCiAgICAgIG11bHRpc2VsZWN0OiBmYWxzZSwKICAgICAgbmF2aWdhdGlvbkJ1dHRvbnM6IGZhbHNlLAogICAgICBzZWxlY3RhYmxlOiB0cnVlLAogICAgICBzZWxlY3RDb25uZWN0ZWRFZGdlczogdHJ1ZSwKICAgICAgaG92ZXJDb25uZWN0ZWRFZGdlczogdHJ1ZSwKICAgICAgdG9vbHRpcERlbGF5OiBbMzAwLCAwLCAxMDAwLCAyNV0sCiAgICAgIHpvb21WaWV3OiB0cnVlCiAgICB9LAogICAgbWFuaXB1bGF0aW9uOiB7CiAgICAgIGVuYWJsZWQ6IGZhbHNlLAogICAgICBpbml0aWFsbHlBY3RpdmU6IGZhbHNlCiAgICB9LAogICAgcGh5c2ljczogewogICAgICBlbmFibGVkOiB0cnVlLAogICAgICBiYXJuZXNIdXQ6IHsKICAgICAgICAvL3RoZXRhOiBbMC41LCAwLjEsIDEsIDAuMDVdLAogICAgICAgIGdyYXZpdGF0aW9uYWxDb25zdGFudDogWy0yMDAwLCAtMzAwMDAsIDAsIDUwXSwKICAgICAgICBjZW50cmFsR3Jhdml0eTogWzAuMywgMCwgMTAsIDAuMDVdLAogICAgICAgIHNwcmluZ0xlbmd0aDogWzk1LCAwLCA1MDAsIDVdLAogICAgICAgIHNwcmluZ0NvbnN0YW50OiBbMC4wNCwgMCwgMS4yLCAwLjAwNV0sCiAgICAgICAgZGFtcGluZzogWzAuMDksIDAsIDEsIDAuMDFdLAogICAgICAgIGF2b2lkT3ZlcmxhcDogWzAsIDAsIDEsIDAuMDFdCiAgICAgIH0sCiAgICAgIGZvcmNlQXRsYXMyQmFzZWQ6IHsKICAgICAgICAvL3RoZXRhOiBbMC41LCAwLjEsIDEsIDAuMDVdLAogICAgICAgIGdyYXZpdGF0aW9uYWxDb25zdGFudDogWy01MCwgLTUwMCwgMCwgMV0sCiAgICAgICAgY2VudHJhbEdyYXZpdHk6IFswLjAxLCAwLCAxLCAwLjAwNV0sCiAgICAgICAgc3ByaW5nTGVuZ3RoOiBbOTUsIDAsIDUwMCwgNV0sCiAgICAgICAgc3ByaW5nQ29uc3RhbnQ6IFswLjA4LCAwLCAxLjIsIDAuMDA1XSwKICAgICAgICBkYW1waW5nOiBbMC40LCAwLCAxLCAwLjAxXSwKICAgICAgICBhdm9pZE92ZXJsYXA6IFswLCAwLCAxLCAwLjAxXQogICAgICB9LAogICAgICByZXB1bHNpb246IHsKICAgICAgICBjZW50cmFsR3Jhdml0eTogWzAuMiwgMCwgMTAsIDAuMDVdLAogICAgICAgIHNwcmluZ0xlbmd0aDogWzIwMCwgMCwgNTAwLCA1XSwKICAgICAgICBzcHJpbmdDb25zdGFudDogWzAuMDUsIDAsIDEuMiwgMC4wMDVdLAogICAgICAgIG5vZGVEaXN0YW5jZTogWzEwMCwgMCwgNTAwLCA1XSwKICAgICAgICBkYW1waW5nOiBbMC4wOSwgMCwgMSwgMC4wMV0KICAgICAgfSwKICAgICAgaGllcmFyY2hpY2FsUmVwdWxzaW9uOiB7CiAgICAgICAgY2VudHJhbEdyYXZpdHk6IFswLjIsIDAsIDEwLCAwLjA1XSwKICAgICAgICBzcHJpbmdMZW5ndGg6IFsxMDAsIDAsIDUwMCwgNV0sCiAgICAgICAgc3ByaW5nQ29uc3RhbnQ6IFswLjAxLCAwLCAxLjIsIDAuMDA1XSwKICAgICAgICBub2RlRGlzdGFuY2U6IFsxMjAsIDAsIDUwMCwgNV0sCiAgICAgICAgZGFtcGluZzogWzAuMDksIDAsIDEsIDAuMDFdCiAgICAgIH0sCiAgICAgIG1heFZlbG9jaXR5OiBbNTAsIDAsIDE1MCwgMV0sCiAgICAgIG1pblZlbG9jaXR5OiBbMC4xLCAwLjAxLCAwLjUsIDAuMDFdLAogICAgICBzb2x2ZXI6IFsnYmFybmVzSHV0JywgJ2ZvcmNlQXRsYXMyQmFzZWQnLCAncmVwdWxzaW9uJywgJ2hpZXJhcmNoaWNhbFJlcHVsc2lvbiddLAogICAgICB0aW1lc3RlcDogWzAuNSwgMC4wMSwgMSwgMC4wMV0KICAgIH0sCiAgICBnbG9iYWw6IHsKICAgICAgbG9jYWxlOiBbJ2VuJywgJ25sJ10KICAgIH0KICB9OwoKICBleHBvcnRzLmFsbE9wdGlvbnMgPSBhbGxPcHRpb25zOwogIGV4cG9ydHMuY29uZmlndXJlT3B0aW9ucyA9IGNvbmZpZ3VyZU9wdGlvbnM7CgovKioqLyB9LAovKiAxMDkgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgogIC8qKgogICAqIENhbnZhcyBzaGFwZXMgdXNlZCBieSBOZXR3b3JrCiAgICovCiAgJ3VzZSBzdHJpY3QnOwoKICBpZiAodHlwZW9mIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCAhPT0gJ3VuZGVmaW5lZCcpIHsKCiAgICAvKioKICAgICAqIERyYXcgYSBjaXJjbGUgc2hhcGUKICAgICAqLwogICAgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELnByb3RvdHlwZS5jaXJjbGUgPSBmdW5jdGlvbiAoeCwgeSwgcikgewogICAgICB0aGlzLmJlZ2luUGF0aCgpOwogICAgICB0aGlzLmFyYyh4LCB5LCByLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpOwogICAgICB0aGlzLmNsb3NlUGF0aCgpOwogICAgfTsKCiAgICAvKioKICAgICAqIERyYXcgYSBzcXVhcmUgc2hhcGUKICAgICAqIEBwYXJhbSB7TnVtYmVyfSB4IGhvcml6b250YWwgY2VudGVyCiAgICAgKiBAcGFyYW0ge051bWJlcn0geSB2ZXJ0aWNhbCBjZW50ZXIKICAgICAqIEBwYXJhbSB7TnVtYmVyfSByICAgc2l6ZSwgd2lkdGggYW5kIGhlaWdodCBvZiB0aGUgc3F1YXJlCiAgICAgKi8KICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5wcm90b3R5cGUuc3F1YXJlID0gZnVuY3Rpb24gKHgsIHksIHIpIHsKICAgICAgdGhpcy5iZWdpblBhdGgoKTsKICAgICAgdGhpcy5yZWN0KHggLSByLCB5IC0gciwgciAqIDIsIHIgKiAyKTsKICAgICAgdGhpcy5jbG9zZVBhdGgoKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBEcmF3IGEgdHJpYW5nbGUgc2hhcGUKICAgICAqIEBwYXJhbSB7TnVtYmVyfSB4IGhvcml6b250YWwgY2VudGVyCiAgICAgKiBAcGFyYW0ge051bWJlcn0geSB2ZXJ0aWNhbCBjZW50ZXIKICAgICAqIEBwYXJhbSB7TnVtYmVyfSByICAgcmFkaXVzLCBoYWxmIHRoZSBsZW5ndGggb2YgdGhlIHNpZGVzIG9mIHRoZSB0cmlhbmdsZQogICAgICovCiAgICBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQucHJvdG90eXBlLnRyaWFuZ2xlID0gZnVuY3Rpb24gKHgsIHksIHIpIHsKICAgICAgLy8gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FcXVpbGF0ZXJhbF90cmlhbmdsZQogICAgICB0aGlzLmJlZ2luUGF0aCgpOwoKICAgICAgLy8gdGhlIGNoYW5nZSBpbiByYWRpdXMgYW5kIHRoZSBvZmZzZXQgaXMgaGVyZSB0byBjZW50ZXIgdGhlIHNoYXBlCiAgICAgIHIgKj0gMS4xNTsKICAgICAgeSArPSAwLjI3NSAqIHI7CgogICAgICB2YXIgcyA9IHIgKiAyOwogICAgICB2YXIgczIgPSBzIC8gMjsKICAgICAgdmFyIGlyID0gTWF0aC5zcXJ0KDMpIC8gNiAqIHM7IC8vIHJhZGl1cyBvZiBpbm5lciBjaXJjbGUKICAgICAgdmFyIGggPSBNYXRoLnNxcnQocyAqIHMgLSBzMiAqIHMyKTsgLy8gaGVpZ2h0CgogICAgICB0aGlzLm1vdmVUbyh4LCB5IC0gKGggLSBpcikpOwogICAgICB0aGlzLmxpbmVUbyh4ICsgczIsIHkgKyBpcik7CiAgICAgIHRoaXMubGluZVRvKHggLSBzMiwgeSArIGlyKTsKICAgICAgdGhpcy5saW5lVG8oeCwgeSAtIChoIC0gaXIpKTsKICAgICAgdGhpcy5jbG9zZVBhdGgoKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBEcmF3IGEgdHJpYW5nbGUgc2hhcGUgaW4gZG93bndhcmQgb3JpZW50YXRpb24KICAgICAqIEBwYXJhbSB7TnVtYmVyfSB4IGhvcml6b250YWwgY2VudGVyCiAgICAgKiBAcGFyYW0ge051bWJlcn0geSB2ZXJ0aWNhbCBjZW50ZXIKICAgICAqIEBwYXJhbSB7TnVtYmVyfSByIHJhZGl1cwogICAgICovCiAgICBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQucHJvdG90eXBlLnRyaWFuZ2xlRG93biA9IGZ1bmN0aW9uICh4LCB5LCByKSB7CiAgICAgIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRXF1aWxhdGVyYWxfdHJpYW5nbGUKICAgICAgdGhpcy5iZWdpblBhdGgoKTsKCiAgICAgIC8vIHRoZSBjaGFuZ2UgaW4gcmFkaXVzIGFuZCB0aGUgb2Zmc2V0IGlzIGhlcmUgdG8gY2VudGVyIHRoZSBzaGFwZQogICAgICByICo9IDEuMTU7CiAgICAgIHkgLT0gMC4yNzUgKiByOwoKICAgICAgdmFyIHMgPSByICogMjsKICAgICAgdmFyIHMyID0gcyAvIDI7CiAgICAgIHZhciBpciA9IE1hdGguc3FydCgzKSAvIDYgKiBzOyAvLyByYWRpdXMgb2YgaW5uZXIgY2lyY2xlCiAgICAgIHZhciBoID0gTWF0aC5zcXJ0KHMgKiBzIC0gczIgKiBzMik7IC8vIGhlaWdodAoKICAgICAgdGhpcy5tb3ZlVG8oeCwgeSArIChoIC0gaXIpKTsKICAgICAgdGhpcy5saW5lVG8oeCArIHMyLCB5IC0gaXIpOwogICAgICB0aGlzLmxpbmVUbyh4IC0gczIsIHkgLSBpcik7CiAgICAgIHRoaXMubGluZVRvKHgsIHkgKyAoaCAtIGlyKSk7CiAgICAgIHRoaXMuY2xvc2VQYXRoKCk7CiAgICB9OwoKICAgIC8qKgogICAgICogRHJhdyBhIHN0YXIgc2hhcGUsIGEgc3RhciB3aXRoIDUgcG9pbnRzCiAgICAgKiBAcGFyYW0ge051bWJlcn0geCBob3Jpem9udGFsIGNlbnRlcgogICAgICogQHBhcmFtIHtOdW1iZXJ9IHkgdmVydGljYWwgY2VudGVyCiAgICAgKiBAcGFyYW0ge051bWJlcn0gciAgIHJhZGl1cywgaGFsZiB0aGUgbGVuZ3RoIG9mIHRoZSBzaWRlcyBvZiB0aGUgdHJpYW5nbGUKICAgICAqLwogICAgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELnByb3RvdHlwZS5zdGFyID0gZnVuY3Rpb24gKHgsIHksIHIpIHsKICAgICAgLy8gaHR0cDovL3d3dy5odG1sNWNhbnZhc3R1dG9yaWFscy5jb20vbGFicy9odG1sNS1jYW52YXMtc3Rhci1zcGlubmVyLwogICAgICB0aGlzLmJlZ2luUGF0aCgpOwoKICAgICAgLy8gdGhlIGNoYW5nZSBpbiByYWRpdXMgYW5kIHRoZSBvZmZzZXQgaXMgaGVyZSB0byBjZW50ZXIgdGhlIHNoYXBlCiAgICAgIHIgKj0gMC44MjsKICAgICAgeSArPSAwLjEgKiByOwoKICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPCAxMDsgbisrKSB7CiAgICAgICAgdmFyIHJhZGl1cyA9IG4gJSAyID09PSAwID8gciAqIDEuMyA6IHIgKiAwLjU7CiAgICAgICAgdGhpcy5saW5lVG8oeCArIHJhZGl1cyAqIE1hdGguc2luKG4gKiAyICogTWF0aC5QSSAvIDEwKSwgeSAtIHJhZGl1cyAqIE1hdGguY29zKG4gKiAyICogTWF0aC5QSSAvIDEwKSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2xvc2VQYXRoKCk7CiAgICB9OwoKICAgIC8qKgogICAgICogRHJhdyBhIERpYW1vbmQgc2hhcGUKICAgICAqIEBwYXJhbSB7TnVtYmVyfSB4IGhvcml6b250YWwgY2VudGVyCiAgICAgKiBAcGFyYW0ge051bWJlcn0geSB2ZXJ0aWNhbCBjZW50ZXIKICAgICAqIEBwYXJhbSB7TnVtYmVyfSByICAgcmFkaXVzLCBoYWxmIHRoZSBsZW5ndGggb2YgdGhlIHNpZGVzIG9mIHRoZSB0cmlhbmdsZQogICAgICovCiAgICBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQucHJvdG90eXBlLmRpYW1vbmQgPSBmdW5jdGlvbiAoeCwgeSwgcikgewogICAgICAvLyBodHRwOi8vd3d3Lmh0bWw1Y2FudmFzdHV0b3JpYWxzLmNvbS9sYWJzL2h0bWw1LWNhbnZhcy1zdGFyLXNwaW5uZXIvCiAgICAgIHRoaXMuYmVnaW5QYXRoKCk7CgogICAgICB0aGlzLmxpbmVUbyh4LCB5ICsgcik7CiAgICAgIHRoaXMubGluZVRvKHggKyByLCB5KTsKICAgICAgdGhpcy5saW5lVG8oeCwgeSAtIHIpOwogICAgICB0aGlzLmxpbmVUbyh4IC0gciwgeSk7CgogICAgICB0aGlzLmNsb3NlUGF0aCgpOwogICAgfTsKCiAgICAvKioKICAgICAqIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTI1NTUxMi9ob3ctdG8tZHJhdy1hLXJvdW5kZWQtcmVjdGFuZ2xlLW9uLWh0bWwtY2FudmFzCiAgICAgKi8KICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5wcm90b3R5cGUucm91bmRSZWN0ID0gZnVuY3Rpb24gKHgsIHksIHcsIGgsIHIpIHsKICAgICAgdmFyIHIyZCA9IE1hdGguUEkgLyAxODA7CiAgICAgIGlmICh3IC0gMiAqIHIgPCAwKSB7CiAgICAgICAgciA9IHcgLyAyOwogICAgICB9IC8vZW5zdXJlIHRoYXQgdGhlIHJhZGl1cyBpc24ndCB0b28gbGFyZ2UgZm9yIHgKICAgICAgaWYgKGggLSAyICogciA8IDApIHsKICAgICAgICByID0gaCAvIDI7CiAgICAgIH0gLy9lbnN1cmUgdGhhdCB0aGUgcmFkaXVzIGlzbid0IHRvbyBsYXJnZSBmb3IgeQogICAgICB0aGlzLmJlZ2luUGF0aCgpOwogICAgICB0aGlzLm1vdmVUbyh4ICsgciwgeSk7CiAgICAgIHRoaXMubGluZVRvKHggKyB3IC0gciwgeSk7CiAgICAgIHRoaXMuYXJjKHggKyB3IC0gciwgeSArIHIsIHIsIHIyZCAqIDI3MCwgcjJkICogMzYwLCBmYWxzZSk7CiAgICAgIHRoaXMubGluZVRvKHggKyB3LCB5ICsgaCAtIHIpOwogICAgICB0aGlzLmFyYyh4ICsgdyAtIHIsIHkgKyBoIC0gciwgciwgMCwgcjJkICogOTAsIGZhbHNlKTsKICAgICAgdGhpcy5saW5lVG8oeCArIHIsIHkgKyBoKTsKICAgICAgdGhpcy5hcmMoeCArIHIsIHkgKyBoIC0gciwgciwgcjJkICogOTAsIHIyZCAqIDE4MCwgZmFsc2UpOwogICAgICB0aGlzLmxpbmVUbyh4LCB5ICsgcik7CiAgICAgIHRoaXMuYXJjKHggKyByLCB5ICsgciwgciwgcjJkICogMTgwLCByMmQgKiAyNzAsIGZhbHNlKTsKICAgICAgdGhpcy5jbG9zZVBhdGgoKTsKICAgIH07CgogICAgLyoqCiAgICAgKiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzIxNzI3OTgvaG93LXRvLWRyYXctYW4tb3ZhbC1pbi1odG1sNS1jYW52YXMKICAgICAqLwogICAgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELnByb3RvdHlwZS5lbGxpcHNlID0gZnVuY3Rpb24gKHgsIHksIHcsIGgpIHsKICAgICAgdmFyIGthcHBhID0gMC41NTIyODQ4LAogICAgICAgICAgb3ggPSB3IC8gMiAqIGthcHBhLAogICAgICAgICAgLy8gY29udHJvbCBwb2ludCBvZmZzZXQgaG9yaXpvbnRhbAogICAgICBveSA9IGggLyAyICoga2FwcGEsCiAgICAgICAgICAvLyBjb250cm9sIHBvaW50IG9mZnNldCB2ZXJ0aWNhbAogICAgICB4ZSA9IHggKyB3LAogICAgICAgICAgLy8geC1lbmQKICAgICAgeWUgPSB5ICsgaCwKICAgICAgICAgIC8vIHktZW5kCiAgICAgIHhtID0geCArIHcgLyAyLAogICAgICAgICAgLy8geC1taWRkbGUKICAgICAgeW0gPSB5ICsgaCAvIDI7IC8vIHktbWlkZGxlCgogICAgICB0aGlzLmJlZ2luUGF0aCgpOwogICAgICB0aGlzLm1vdmVUbyh4LCB5bSk7CiAgICAgIHRoaXMuYmV6aWVyQ3VydmVUbyh4LCB5bSAtIG95LCB4bSAtIG94LCB5LCB4bSwgeSk7CiAgICAgIHRoaXMuYmV6aWVyQ3VydmVUbyh4bSArIG94LCB5LCB4ZSwgeW0gLSBveSwgeGUsIHltKTsKICAgICAgdGhpcy5iZXppZXJDdXJ2ZVRvKHhlLCB5bSArIG95LCB4bSArIG94LCB5ZSwgeG0sIHllKTsKICAgICAgdGhpcy5iZXppZXJDdXJ2ZVRvKHhtIC0gb3gsIHllLCB4LCB5bSArIG95LCB4LCB5bSk7CiAgICAgIHRoaXMuY2xvc2VQYXRoKCk7CiAgICB9OwoKICAgIC8qKgogICAgICogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yMTcyNzk4L2hvdy10by1kcmF3LWFuLW92YWwtaW4taHRtbDUtY2FudmFzCiAgICAgKi8KICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5wcm90b3R5cGUuZGF0YWJhc2UgPSBmdW5jdGlvbiAoeCwgeSwgdywgaCkgewogICAgICB2YXIgZiA9IDEgLyAzOwogICAgICB2YXIgd0VsbGlwc2UgPSB3OwogICAgICB2YXIgaEVsbGlwc2UgPSBoICogZjsKCiAgICAgIHZhciBrYXBwYSA9IDAuNTUyMjg0OCwKICAgICAgICAgIG94ID0gd0VsbGlwc2UgLyAyICoga2FwcGEsCiAgICAgICAgICAvLyBjb250cm9sIHBvaW50IG9mZnNldCBob3Jpem9udGFsCiAgICAgIG95ID0gaEVsbGlwc2UgLyAyICoga2FwcGEsCiAgICAgICAgICAvLyBjb250cm9sIHBvaW50IG9mZnNldCB2ZXJ0aWNhbAogICAgICB4ZSA9IHggKyB3RWxsaXBzZSwKICAgICAgICAgIC8vIHgtZW5kCiAgICAgIHllID0geSArIGhFbGxpcHNlLAogICAgICAgICAgLy8geS1lbmQKICAgICAgeG0gPSB4ICsgd0VsbGlwc2UgLyAyLAogICAgICAgICAgLy8geC1taWRkbGUKICAgICAgeW0gPSB5ICsgaEVsbGlwc2UgLyAyLAogICAgICAgICAgLy8geS1taWRkbGUKICAgICAgeW1iID0geSArIChoIC0gaEVsbGlwc2UgLyAyKSwKICAgICAgICAgIC8vIHktbWlkbGxlLCBib3R0b20gZWxsaXBzZQogICAgICB5ZWIgPSB5ICsgaDsgLy8geS1lbmQsIGJvdHRvbSBlbGxpcHNlCgogICAgICB0aGlzLmJlZ2luUGF0aCgpOwogICAgICB0aGlzLm1vdmVUbyh4ZSwgeW0pOwoKICAgICAgdGhpcy5iZXppZXJDdXJ2ZVRvKHhlLCB5bSArIG95LCB4bSArIG94LCB5ZSwgeG0sIHllKTsKICAgICAgdGhpcy5iZXppZXJDdXJ2ZVRvKHhtIC0gb3gsIHllLCB4LCB5bSArIG95LCB4LCB5bSk7CgogICAgICB0aGlzLmJlemllckN1cnZlVG8oeCwgeW0gLSBveSwgeG0gLSBveCwgeSwgeG0sIHkpOwogICAgICB0aGlzLmJlemllckN1cnZlVG8oeG0gKyBveCwgeSwgeGUsIHltIC0gb3ksIHhlLCB5bSk7CgogICAgICB0aGlzLmxpbmVUbyh4ZSwgeW1iKTsKCiAgICAgIHRoaXMuYmV6aWVyQ3VydmVUbyh4ZSwgeW1iICsgb3ksIHhtICsgb3gsIHllYiwgeG0sIHllYik7CiAgICAgIHRoaXMuYmV6aWVyQ3VydmVUbyh4bSAtIG94LCB5ZWIsIHgsIHltYiArIG95LCB4LCB5bWIpOwoKICAgICAgdGhpcy5saW5lVG8oeCwgeW0pOwogICAgfTsKCiAgICAvKioKICAgICAqIERyYXcgYW4gYXJyb3cgcG9pbnQgKG5vIGxpbmUpCiAgICAgKi8KICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5wcm90b3R5cGUuYXJyb3cgPSBmdW5jdGlvbiAoeCwgeSwgYW5nbGUsIGxlbmd0aCkgewogICAgICAvLyB0YWlsCiAgICAgIHZhciB4dCA9IHggLSBsZW5ndGggKiBNYXRoLmNvcyhhbmdsZSk7CiAgICAgIHZhciB5dCA9IHkgLSBsZW5ndGggKiBNYXRoLnNpbihhbmdsZSk7CgogICAgICAvLyBpbm5lciB0YWlsCiAgICAgIHZhciB4aSA9IHggLSBsZW5ndGggKiAwLjkgKiBNYXRoLmNvcyhhbmdsZSk7CiAgICAgIHZhciB5aSA9IHkgLSBsZW5ndGggKiAwLjkgKiBNYXRoLnNpbihhbmdsZSk7CgogICAgICAvLyBsZWZ0CiAgICAgIHZhciB4bCA9IHh0ICsgbGVuZ3RoIC8gMyAqIE1hdGguY29zKGFuZ2xlICsgMC41ICogTWF0aC5QSSk7CiAgICAgIHZhciB5bCA9IHl0ICsgbGVuZ3RoIC8gMyAqIE1hdGguc2luKGFuZ2xlICsgMC41ICogTWF0aC5QSSk7CgogICAgICAvLyByaWdodAogICAgICB2YXIgeHIgPSB4dCArIGxlbmd0aCAvIDMgKiBNYXRoLmNvcyhhbmdsZSAtIDAuNSAqIE1hdGguUEkpOwogICAgICB2YXIgeXIgPSB5dCArIGxlbmd0aCAvIDMgKiBNYXRoLnNpbihhbmdsZSAtIDAuNSAqIE1hdGguUEkpOwoKICAgICAgdGhpcy5iZWdpblBhdGgoKTsKICAgICAgdGhpcy5tb3ZlVG8oeCwgeSk7CiAgICAgIHRoaXMubGluZVRvKHhsLCB5bCk7CiAgICAgIHRoaXMubGluZVRvKHhpLCB5aSk7CiAgICAgIHRoaXMubGluZVRvKHhyLCB5cik7CiAgICAgIHRoaXMuY2xvc2VQYXRoKCk7CiAgICB9OwoKICAgIC8qKgogICAgICogU2V0cyB1cCB0aGUgZGFzaGVkTGluZSBmdW5jdGlvbmFsaXR5IGZvciBkcmF3aW5nCiAgICAgKiBPcmlnaW5hbCBjb2RlIGNhbWUgZnJvbSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzQ1NzY3MjQvZG90dGVkLXN0cm9rZS1pbi1jYW52YXMKICAgICAqIEBhdXRob3IgRGF2aWQgSm9yZGFuCiAgICAgKiBAZGF0ZSAyMDEyLTA4LTA4CiAgICAgKi8KICAgIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5wcm90b3R5cGUuZGFzaGVkTGluZSA9IGZ1bmN0aW9uICh4LCB5LCB4MiwgeTIsIHBhdHRlcm4pIHsKICAgICAgdGhpcy5iZWdpblBhdGgoKTsKICAgICAgdGhpcy5tb3ZlVG8oeCwgeSk7CgogICAgICB2YXIgcGF0dGVybkxlbmd0aCA9IHBhdHRlcm4ubGVuZ3RoOwogICAgICB2YXIgZHggPSB4MiAtIHg7CiAgICAgIHZhciBkeSA9IHkyIC0geTsKICAgICAgdmFyIHNsb3BlID0gZHkgLyBkeDsKICAgICAgdmFyIGRpc3RSZW1haW5pbmcgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgICB2YXIgcGF0dGVybkluZGV4ID0gMDsKICAgICAgdmFyIGRyYXcgPSB0cnVlOwogICAgICB2YXIgeFN0ZXAgPSAwOwogICAgICB2YXIgZGFzaExlbmd0aCA9IHBhdHRlcm5bMF07CgogICAgICB3aGlsZSAoZGlzdFJlbWFpbmluZyA+PSAwLjEpIHsKICAgICAgICBkYXNoTGVuZ3RoID0gcGF0dGVybltwYXR0ZXJuSW5kZXgrKyAlIHBhdHRlcm5MZW5ndGhdOwogICAgICAgIGlmIChkYXNoTGVuZ3RoID4gZGlzdFJlbWFpbmluZykgewogICAgICAgICAgZGFzaExlbmd0aCA9IGRpc3RSZW1haW5pbmc7CiAgICAgICAgfQoKICAgICAgICB4U3RlcCA9IE1hdGguc3FydChkYXNoTGVuZ3RoICogZGFzaExlbmd0aCAvICgxICsgc2xvcGUgKiBzbG9wZSkpOwogICAgICAgIHhTdGVwID0gZHggPCAwID8gLXhTdGVwIDogeFN0ZXA7CiAgICAgICAgeCArPSB4U3RlcDsKICAgICAgICB5ICs9IHNsb3BlICogeFN0ZXA7CgogICAgICAgIGlmIChkcmF3ID09PSB0cnVlKSB7CiAgICAgICAgICB0aGlzLmxpbmVUbyh4LCB5KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5tb3ZlVG8oeCwgeSk7CiAgICAgICAgfQoKICAgICAgICBkaXN0UmVtYWluaW5nIC09IGRhc2hMZW5ndGg7CiAgICAgICAgZHJhdyA9ICFkcmF3OwogICAgICB9CiAgICB9OwogIH0KCi8qKiovIH0sCi8qIDExMCAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgLyoqCiAgICogUGFyc2UgYSB0ZXh0IHNvdXJjZSBjb250YWluaW5nIGRhdGEgaW4gRE9UIGxhbmd1YWdlIGludG8gYSBKU09OIG9iamVjdC4KICAgKiBUaGUgb2JqZWN0IGNvbnRhaW5zIHR3byBsaXN0czogb25lIHdpdGggbm9kZXMgYW5kIG9uZSB3aXRoIGVkZ2VzLgogICAqCiAgICogRE9UIGxhbmd1YWdlIHJlZmVyZW5jZTogaHR0cDovL3d3dy5ncmFwaHZpei5vcmcvZG9jL2luZm8vbGFuZy5odG1sCiAgICoKICAgKiBET1QgbGFuZ3VhZ2UgYXR0cmlidXRlczogaHR0cDovL2dyYXBodml6Lm9yZy9jb250ZW50L2F0dHJzCiAgICoKICAgKiBAcGFyYW0ge1N0cmluZ30gZGF0YSAgICAgVGV4dCBjb250YWluaW5nIGEgZ3JhcGggaW4gRE9ULW5vdGF0aW9uCiAgICogQHJldHVybiB7T2JqZWN0fSBncmFwaCAgIEFuIG9iamVjdCBjb250YWluaW5nIHR3byBwYXJhbWV0ZXJzOgogICAqICAgICAgICAgICAgICAgICAgICAgICAgICB7T2JqZWN0W119IG5vZGVzCiAgICogICAgICAgICAgICAgICAgICAgICAgICAgIHtPYmplY3RbXX0gZWRnZXMKICAgKi8KICAndXNlIHN0cmljdCc7CgogIGZ1bmN0aW9uIHBhcnNlRE9UKGRhdGEpIHsKICAgIGRvdCA9IGRhdGE7CiAgICByZXR1cm4gcGFyc2VHcmFwaCgpOwogIH0KCiAgLy8gbWFwcGluZyBvZiBhdHRyaWJ1dGVzIGZyb20gRE9UICh0aGUga2V5cykgdG8gdmlzLmpzICh0aGUgdmFsdWVzKQogIHZhciBOT0RFX0FUVFJfTUFQUElORyA9IHsKICAgICdmb250c2l6ZSc6ICdmb250LnNpemUnLAogICAgJ2ZvbnRjb2xvcic6ICdmb250LmNvbG9yJywKICAgICdsYWJlbGZvbnRjb2xvcic6ICdmb250LmNvbG9yJywKICAgICdmb250bmFtZSc6ICdmb250LmZhY2UnLAogICAgJ2NvbG9yJzogWydjb2xvci5ib3JkZXInLCAnY29sb3IuYmFja2dyb3VuZCddLAogICAgJ2ZpbGxjb2xvcic6ICdjb2xvci5iYWNrZ3JvdW5kJywKICAgICd0b29sdGlwJzogJ3RpdGxlJywKICAgICdsYWJlbHRvb2x0aXAnOiAndGl0bGUnCiAgfTsKICB2YXIgRURHRV9BVFRSX01BUFBJTkcgPSBPYmplY3QuY3JlYXRlKE5PREVfQVRUUl9NQVBQSU5HKTsKICBFREdFX0FUVFJfTUFQUElORy5jb2xvciA9ICdjb2xvci5jb2xvcic7CgogIC8vIHRva2VuIHR5cGVzIGVudW1lcmF0aW9uCiAgdmFyIFRPS0VOVFlQRSA9IHsKICAgIE5VTEw6IDAsCiAgICBERUxJTUlURVI6IDEsCiAgICBJREVOVElGSUVSOiAyLAogICAgVU5LTk9XTjogMwogIH07CgogIC8vIG1hcCB3aXRoIGFsbCBkZWxpbWl0ZXJzCiAgdmFyIERFTElNSVRFUlMgPSB7CiAgICAneyc6IHRydWUsCiAgICAnfSc6IHRydWUsCiAgICAnWyc6IHRydWUsCiAgICAnXSc6IHRydWUsCiAgICAnOyc6IHRydWUsCiAgICAnPSc6IHRydWUsCiAgICAnLCc6IHRydWUsCgogICAgJy0+JzogdHJ1ZSwKICAgICctLSc6IHRydWUKICB9OwoKICB2YXIgZG90ID0gJyc7IC8vIGN1cnJlbnQgZG90IGZpbGUKICB2YXIgaW5kZXggPSAwOyAvLyBjdXJyZW50IGluZGV4IGluIGRvdCBmaWxlCiAgdmFyIGMgPSAnJzsgLy8gY3VycmVudCB0b2tlbiBjaGFyYWN0ZXIgaW4gZXhwcgogIHZhciB0b2tlbiA9ICcnOyAvLyBjdXJyZW50IHRva2VuCiAgdmFyIHRva2VuVHlwZSA9IFRPS0VOVFlQRS5OVUxMOyAvLyB0eXBlIG9mIHRoZSB0b2tlbgoKICAvKioKICAgKiBHZXQgdGhlIGZpcnN0IGNoYXJhY3RlciBmcm9tIHRoZSBkb3QgZmlsZS4KICAgKiBUaGUgY2hhcmFjdGVyIGlzIHN0b3JlZCBpbnRvIHRoZSBjaGFyIGMuIElmIHRoZSBlbmQgb2YgdGhlIGRvdCBmaWxlIGlzCiAgICogcmVhY2hlZCwgdGhlIGZ1bmN0aW9uIHB1dHMgYW4gZW1wdHkgc3RyaW5nIGluIGMuCiAgICovCiAgZnVuY3Rpb24gZmlyc3QoKSB7CiAgICBpbmRleCA9IDA7CiAgICBjID0gZG90LmNoYXJBdCgwKTsKICB9CgogIC8qKgogICAqIEdldCB0aGUgbmV4dCBjaGFyYWN0ZXIgZnJvbSB0aGUgZG90IGZpbGUuCiAgICogVGhlIGNoYXJhY3RlciBpcyBzdG9yZWQgaW50byB0aGUgY2hhciBjLiBJZiB0aGUgZW5kIG9mIHRoZSBkb3QgZmlsZSBpcwogICAqIHJlYWNoZWQsIHRoZSBmdW5jdGlvbiBwdXRzIGFuIGVtcHR5IHN0cmluZyBpbiBjLgogICAqLwogIGZ1bmN0aW9uIG5leHQoKSB7CiAgICBpbmRleCsrOwogICAgYyA9IGRvdC5jaGFyQXQoaW5kZXgpOwogIH0KCiAgLyoqCiAgICogUHJldmlldyB0aGUgbmV4dCBjaGFyYWN0ZXIgZnJvbSB0aGUgZG90IGZpbGUuCiAgICogQHJldHVybiB7U3RyaW5nfSBjTmV4dAogICAqLwogIGZ1bmN0aW9uIG5leHRQcmV2aWV3KCkgewogICAgcmV0dXJuIGRvdC5jaGFyQXQoaW5kZXggKyAxKTsKICB9CgogIC8qKgogICAqIFRlc3Qgd2hldGhlciBnaXZlbiBjaGFyYWN0ZXIgaXMgYWxwaGFiZXRpYyBvciBudW1lcmljCiAgICogQHBhcmFtIHtTdHJpbmd9IGMKICAgKiBAcmV0dXJuIHtCb29sZWFufSBpc0FscGhhTnVtZXJpYwogICAqLwogIHZhciByZWdleEFscGhhTnVtZXJpYyA9IC9bYS16QS1aXzAtOS46I10vOwogIGZ1bmN0aW9uIGlzQWxwaGFOdW1lcmljKGMpIHsKICAgIHJldHVybiByZWdleEFscGhhTnVtZXJpYy50ZXN0KGMpOwogIH0KCiAgLyoqCiAgICogTWVyZ2UgYWxsIG9wdGlvbnMgb2Ygb2JqZWN0IGIgaW50byBvYmplY3QgYgogICAqIEBwYXJhbSB7T2JqZWN0fSBhCiAgICogQHBhcmFtIHtPYmplY3R9IGIKICAgKiBAcmV0dXJuIHtPYmplY3R9IGEKICAgKi8KICBmdW5jdGlvbiBtZXJnZShhLCBiKSB7CiAgICBpZiAoIWEpIHsKICAgICAgYSA9IHt9OwogICAgfQoKICAgIGlmIChiKSB7CiAgICAgIGZvciAodmFyIG5hbWUgaW4gYikgewogICAgICAgIGlmIChiLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgICBhW25hbWVdID0gYltuYW1lXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBhOwogIH0KCiAgLyoqCiAgICogU2V0IGEgdmFsdWUgaW4gYW4gb2JqZWN0LCB3aGVyZSB0aGUgcHJvdmlkZWQgcGFyYW1ldGVyIG5hbWUgY2FuIGJlIGEKICAgKiBwYXRoIHdpdGggbmVzdGVkIHBhcmFtZXRlcnMuIEZvciBleGFtcGxlOgogICAqCiAgICogICAgIHZhciBvYmogPSB7YTogMn07CiAgICogICAgIHNldFZhbHVlKG9iaiwgJ2IuYycsIDMpOyAgICAgLy8gb2JqID0ge2E6IDIsIGI6IHtjOiAzfX0KICAgKgogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmoKICAgKiBAcGFyYW0ge1N0cmluZ30gcGF0aCAgQSBwYXJhbWV0ZXIgbmFtZSBvciBkb3Qtc2VwYXJhdGVkIHBhcmFtZXRlciBwYXRoLAogICAqICAgICAgICAgICAgICAgICAgICAgIGxpa2UgImNvbG9yLmhpZ2hsaWdodC5ib3JkZXIiLgogICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgKi8KICBmdW5jdGlvbiBzZXRWYWx1ZShvYmosIHBhdGgsIHZhbHVlKSB7CiAgICB2YXIga2V5cyA9IHBhdGguc3BsaXQoJy4nKTsKICAgIHZhciBvID0gb2JqOwogICAgd2hpbGUgKGtleXMubGVuZ3RoKSB7CiAgICAgIHZhciBrZXkgPSBrZXlzLnNoaWZ0KCk7CiAgICAgIGlmIChrZXlzLmxlbmd0aCkgewogICAgICAgIC8vIHRoaXMgaXNuJ3QgdGhlIGVuZCBwb2ludAogICAgICAgIGlmICghb1trZXldKSB7CiAgICAgICAgICBvW2tleV0gPSB7fTsKICAgICAgICB9CiAgICAgICAgbyA9IG9ba2V5XTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB0aGlzIGlzIHRoZSBlbmQgcG9pbnQKICAgICAgICBvW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogQWRkIGEgbm9kZSB0byBhIGdyYXBoIG9iamVjdC4gSWYgdGhlcmUgaXMgYWxyZWFkeSBhIG5vZGUgd2l0aAogICAqIHRoZSBzYW1lIGlkLCB0aGVpciBhdHRyaWJ1dGVzIHdpbGwgYmUgbWVyZ2VkLgogICAqIEBwYXJhbSB7T2JqZWN0fSBncmFwaAogICAqIEBwYXJhbSB7T2JqZWN0fSBub2RlCiAgICovCiAgZnVuY3Rpb24gYWRkTm9kZShncmFwaCwgbm9kZSkgewogICAgdmFyIGksIGxlbjsKICAgIHZhciBjdXJyZW50ID0gbnVsbDsKCiAgICAvLyBmaW5kIHJvb3QgZ3JhcGggKGluIGNhc2Ugb2Ygc3ViZ3JhcGgpCiAgICB2YXIgZ3JhcGhzID0gW2dyYXBoXTsgLy8gbGlzdCB3aXRoIGFsbCBncmFwaHMgZnJvbSBjdXJyZW50IGdyYXBoIHRvIHJvb3QgZ3JhcGgKICAgIHZhciByb290ID0gZ3JhcGg7CiAgICB3aGlsZSAocm9vdC5wYXJlbnQpIHsKICAgICAgZ3JhcGhzLnB1c2gocm9vdC5wYXJlbnQpOwogICAgICByb290ID0gcm9vdC5wYXJlbnQ7CiAgICB9CgogICAgLy8gZmluZCBleGlzdGluZyBub2RlIChhdCByb290IGxldmVsKSBieSBpdHMgaWQKICAgIGlmIChyb290Lm5vZGVzKSB7CiAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHJvb3Qubm9kZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICBpZiAobm9kZS5pZCA9PT0gcm9vdC5ub2Rlc1tpXS5pZCkgewogICAgICAgICAgY3VycmVudCA9IHJvb3Qubm9kZXNbaV07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAoIWN1cnJlbnQpIHsKICAgICAgLy8gdGhpcyBpcyBhIG5ldyBub2RlCiAgICAgIGN1cnJlbnQgPSB7CiAgICAgICAgaWQ6IG5vZGUuaWQKICAgICAgfTsKICAgICAgaWYgKGdyYXBoLm5vZGUpIHsKICAgICAgICAvLyBjbG9uZSBkZWZhdWx0IGF0dHJpYnV0ZXMKICAgICAgICBjdXJyZW50LmF0dHIgPSBtZXJnZShjdXJyZW50LmF0dHIsIGdyYXBoLm5vZGUpOwogICAgICB9CiAgICB9CgogICAgLy8gYWRkIG5vZGUgdG8gdGhpcyAoc3ViKWdyYXBoIGFuZCBhbGwgaXRzIHBhcmVudCBncmFwaHMKICAgIGZvciAoaSA9IGdyYXBocy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICB2YXIgZyA9IGdyYXBoc1tpXTsKCiAgICAgIGlmICghZy5ub2RlcykgewogICAgICAgIGcubm9kZXMgPSBbXTsKICAgICAgfQogICAgICBpZiAoZy5ub2Rlcy5pbmRleE9mKGN1cnJlbnQpID09PSAtMSkgewogICAgICAgIGcubm9kZXMucHVzaChjdXJyZW50KTsKICAgICAgfQogICAgfQoKICAgIC8vIG1lcmdlIGF0dHJpYnV0ZXMKICAgIGlmIChub2RlLmF0dHIpIHsKICAgICAgY3VycmVudC5hdHRyID0gbWVyZ2UoY3VycmVudC5hdHRyLCBub2RlLmF0dHIpOwogICAgfQogIH0KCiAgLyoqCiAgICogQWRkIGFuIGVkZ2UgdG8gYSBncmFwaCBvYmplY3QKICAgKiBAcGFyYW0ge09iamVjdH0gZ3JhcGgKICAgKiBAcGFyYW0ge09iamVjdH0gZWRnZQogICAqLwogIGZ1bmN0aW9uIGFkZEVkZ2UoZ3JhcGgsIGVkZ2UpIHsKICAgIGlmICghZ3JhcGguZWRnZXMpIHsKICAgICAgZ3JhcGguZWRnZXMgPSBbXTsKICAgIH0KICAgIGdyYXBoLmVkZ2VzLnB1c2goZWRnZSk7CiAgICBpZiAoZ3JhcGguZWRnZSkgewogICAgICB2YXIgYXR0ciA9IG1lcmdlKHt9LCBncmFwaC5lZGdlKTsgLy8gY2xvbmUgZGVmYXVsdCBhdHRyaWJ1dGVzCiAgICAgIGVkZ2UuYXR0ciA9IG1lcmdlKGF0dHIsIGVkZ2UuYXR0cik7IC8vIG1lcmdlIGF0dHJpYnV0ZXMKICAgIH0KICB9CgogIC8qKgogICAqIENyZWF0ZSBhbiBlZGdlIHRvIGEgZ3JhcGggb2JqZWN0CiAgICogQHBhcmFtIHtPYmplY3R9IGdyYXBoCiAgICogQHBhcmFtIHtTdHJpbmcgfCBOdW1iZXIgfCBPYmplY3R9IGZyb20KICAgKiBAcGFyYW0ge1N0cmluZyB8IE51bWJlciB8IE9iamVjdH0gdG8KICAgKiBAcGFyYW0ge1N0cmluZ30gdHlwZQogICAqIEBwYXJhbSB7T2JqZWN0IHwgbnVsbH0gYXR0cgogICAqIEByZXR1cm4ge09iamVjdH0gZWRnZQogICAqLwogIGZ1bmN0aW9uIGNyZWF0ZUVkZ2UoZ3JhcGgsIGZyb20sIHRvLCB0eXBlLCBhdHRyKSB7CiAgICB2YXIgZWRnZSA9IHsKICAgICAgZnJvbTogZnJvbSwKICAgICAgdG86IHRvLAogICAgICB0eXBlOiB0eXBlCiAgICB9OwoKICAgIGlmIChncmFwaC5lZGdlKSB7CiAgICAgIGVkZ2UuYXR0ciA9IG1lcmdlKHt9LCBncmFwaC5lZGdlKTsgLy8gY2xvbmUgZGVmYXVsdCBhdHRyaWJ1dGVzCiAgICB9CiAgICBlZGdlLmF0dHIgPSBtZXJnZShlZGdlLmF0dHIgfHwge30sIGF0dHIpOyAvLyBtZXJnZSBhdHRyaWJ1dGVzCgogICAgcmV0dXJuIGVkZ2U7CiAgfQoKICAvKioKICAgKiBHZXQgbmV4dCB0b2tlbiBpbiB0aGUgY3VycmVudCBkb3QgZmlsZS4KICAgKiBUaGUgdG9rZW4gYW5kIHRva2VuIHR5cGUgYXJlIGF2YWlsYWJsZSBhcyB0b2tlbiBhbmQgdG9rZW5UeXBlCiAgICovCiAgZnVuY3Rpb24gZ2V0VG9rZW4oKSB7CiAgICB0b2tlblR5cGUgPSBUT0tFTlRZUEUuTlVMTDsKICAgIHRva2VuID0gJyc7CgogICAgLy8gc2tpcCBvdmVyIHdoaXRlc3BhY2VzCiAgICB3aGlsZSAoYyA9PT0gJyAnIHx8IGMgPT09ICdcdCcgfHwgYyA9PT0gJ1xuJyB8fCBjID09PSAnXHInKSB7CiAgICAgIC8vIHNwYWNlLCB0YWIsIGVudGVyCiAgICAgIG5leHQoKTsKICAgIH0KCiAgICBkbyB7CiAgICAgIHZhciBpc0NvbW1lbnQgPSBmYWxzZTsKCiAgICAgIC8vIHNraXAgY29tbWVudAogICAgICBpZiAoYyA9PT0gJyMnKSB7CiAgICAgICAgLy8gZmluZCB0aGUgcHJldmlvdXMgbm9uLXNwYWNlIGNoYXJhY3RlcgogICAgICAgIHZhciBpID0gaW5kZXggLSAxOwogICAgICAgIHdoaWxlIChkb3QuY2hhckF0KGkpID09PSAnICcgfHwgZG90LmNoYXJBdChpKSA9PT0gJ1x0JykgewogICAgICAgICAgaS0tOwogICAgICAgIH0KICAgICAgICBpZiAoZG90LmNoYXJBdChpKSA9PT0gJ1xuJyB8fCBkb3QuY2hhckF0KGkpID09PSAnJykgewogICAgICAgICAgLy8gdGhlICMgaXMgYXQgdGhlIHN0YXJ0IG9mIGEgbGluZSwgdGhpcyBpcyBpbmRlZWQgYSBsaW5lIGNvbW1lbnQKICAgICAgICAgIHdoaWxlIChjICE9ICcnICYmIGMgIT0gJ1xuJykgewogICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICB9CiAgICAgICAgICBpc0NvbW1lbnQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoYyA9PT0gJy8nICYmIG5leHRQcmV2aWV3KCkgPT09ICcvJykgewogICAgICAgIC8vIHNraXAgbGluZSBjb21tZW50CiAgICAgICAgd2hpbGUgKGMgIT0gJycgJiYgYyAhPSAnXG4nKSB7CiAgICAgICAgICBuZXh0KCk7CiAgICAgICAgfQogICAgICAgIGlzQ29tbWVudCA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKGMgPT09ICcvJyAmJiBuZXh0UHJldmlldygpID09PSAnKicpIHsKICAgICAgICAvLyBza2lwIGJsb2NrIGNvbW1lbnQKICAgICAgICB3aGlsZSAoYyAhPSAnJykgewogICAgICAgICAgaWYgKGMgPT09ICcqJyAmJiBuZXh0UHJldmlldygpID09PSAnLycpIHsKICAgICAgICAgICAgLy8gZW5kIG9mIGJsb2NrIGNvbW1lbnQgZm91bmQuIHNraXAgdGhlc2UgbGFzdCB0d28gY2hhcmFjdGVycwogICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlzQ29tbWVudCA9IHRydWU7CiAgICAgIH0KCiAgICAgIC8vIHNraXAgb3ZlciB3aGl0ZXNwYWNlcwogICAgICB3aGlsZSAoYyA9PT0gJyAnIHx8IGMgPT09ICdcdCcgfHwgYyA9PT0gJ1xuJyB8fCBjID09PSAnXHInKSB7CiAgICAgICAgLy8gc3BhY2UsIHRhYiwgZW50ZXIKICAgICAgICBuZXh0KCk7CiAgICAgIH0KICAgIH0gd2hpbGUgKGlzQ29tbWVudCk7CgogICAgLy8gY2hlY2sgZm9yIGVuZCBvZiBkb3QgZmlsZQogICAgaWYgKGMgPT09ICcnKSB7CiAgICAgIC8vIHRva2VuIGlzIHN0aWxsIGVtcHR5CiAgICAgIHRva2VuVHlwZSA9IFRPS0VOVFlQRS5ERUxJTUlURVI7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBjaGVjayBmb3IgZGVsaW1pdGVycyBjb25zaXN0aW5nIG9mIDIgY2hhcmFjdGVycwogICAgdmFyIGMyID0gYyArIG5leHRQcmV2aWV3KCk7CiAgICBpZiAoREVMSU1JVEVSU1tjMl0pIHsKICAgICAgdG9rZW5UeXBlID0gVE9LRU5UWVBFLkRFTElNSVRFUjsKICAgICAgdG9rZW4gPSBjMjsKICAgICAgbmV4dCgpOwogICAgICBuZXh0KCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBjaGVjayBmb3IgZGVsaW1pdGVycyBjb25zaXN0aW5nIG9mIDEgY2hhcmFjdGVyCiAgICBpZiAoREVMSU1JVEVSU1tjXSkgewogICAgICB0b2tlblR5cGUgPSBUT0tFTlRZUEUuREVMSU1JVEVSOwogICAgICB0b2tlbiA9IGM7CiAgICAgIG5leHQoKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIGNoZWNrIGZvciBhbiBpZGVudGlmaWVyIChudW1iZXIgb3Igc3RyaW5nKQogICAgLy8gVE9ETzogbW9yZSBwcmVjaXNlIHBhcnNpbmcgb2YgbnVtYmVycy9zdHJpbmdzIChhbmQgdGhlIHBvcnQgc2VwYXJhdG9yICc6JykKICAgIGlmIChpc0FscGhhTnVtZXJpYyhjKSB8fCBjID09PSAnLScpIHsKICAgICAgdG9rZW4gKz0gYzsKICAgICAgbmV4dCgpOwoKICAgICAgd2hpbGUgKGlzQWxwaGFOdW1lcmljKGMpKSB7CiAgICAgICAgdG9rZW4gKz0gYzsKICAgICAgICBuZXh0KCk7CiAgICAgIH0KICAgICAgaWYgKHRva2VuID09PSAnZmFsc2UnKSB7CiAgICAgICAgdG9rZW4gPSBmYWxzZTsgLy8gY29udmVydCB0byBib29sZWFuCiAgICAgIH0gZWxzZSBpZiAodG9rZW4gPT09ICd0cnVlJykgewogICAgICAgIHRva2VuID0gdHJ1ZTsgLy8gY29udmVydCB0byBib29sZWFuCiAgICAgIH0gZWxzZSBpZiAoIWlzTmFOKE51bWJlcih0b2tlbikpKSB7CiAgICAgICAgdG9rZW4gPSBOdW1iZXIodG9rZW4pOyAvLyBjb252ZXJ0IHRvIG51bWJlcgogICAgICB9CiAgICAgIHRva2VuVHlwZSA9IFRPS0VOVFlQRS5JREVOVElGSUVSOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gY2hlY2sgZm9yIGEgc3RyaW5nIGVuY2xvc2VkIGJ5IGRvdWJsZSBxdW90ZXMKICAgIGlmIChjID09PSAnIicpIHsKICAgICAgbmV4dCgpOwogICAgICB3aGlsZSAoYyAhPSAnJyAmJiAoYyAhPSAnIicgfHwgYyA9PT0gJyInICYmIG5leHRQcmV2aWV3KCkgPT09ICciJykpIHsKICAgICAgICB0b2tlbiArPSBjOwogICAgICAgIGlmIChjID09PSAnIicpIHsKICAgICAgICAgIC8vIHNraXAgdGhlIGVzY2FwZSBjaGFyYWN0ZXIKICAgICAgICAgIG5leHQoKTsKICAgICAgICB9CiAgICAgICAgbmV4dCgpOwogICAgICB9CiAgICAgIGlmIChjICE9ICciJykgewogICAgICAgIHRocm93IG5ld1N5bnRheEVycm9yKCdFbmQgb2Ygc3RyaW5nICIgZXhwZWN0ZWQnKTsKICAgICAgfQogICAgICBuZXh0KCk7CiAgICAgIHRva2VuVHlwZSA9IFRPS0VOVFlQRS5JREVOVElGSUVSOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gc29tZXRoaW5nIHVua25vd24gaXMgZm91bmQsIHdyb25nIGNoYXJhY3RlcnMsIGEgc3ludGF4IGVycm9yCiAgICB0b2tlblR5cGUgPSBUT0tFTlRZUEUuVU5LTk9XTjsKICAgIHdoaWxlIChjICE9ICcnKSB7CiAgICAgIHRva2VuICs9IGM7CiAgICAgIG5leHQoKTsKICAgIH0KICAgIHRocm93IG5ldyBTeW50YXhFcnJvcignU3ludGF4IGVycm9yIGluIHBhcnQgIicgKyBjaG9wKHRva2VuLCAzMCkgKyAnIicpOwogIH0KCiAgLyoqCiAgICogUGFyc2UgYSBncmFwaC4KICAgKiBAcmV0dXJucyB7T2JqZWN0fSBncmFwaAogICAqLwogIGZ1bmN0aW9uIHBhcnNlR3JhcGgoKSB7CiAgICB2YXIgZ3JhcGggPSB7fTsKCiAgICBmaXJzdCgpOwogICAgZ2V0VG9rZW4oKTsKCiAgICAvLyBvcHRpb25hbCBzdHJpY3Qga2V5d29yZAogICAgaWYgKHRva2VuID09PSAnc3RyaWN0JykgewogICAgICBncmFwaC5zdHJpY3QgPSB0cnVlOwogICAgICBnZXRUb2tlbigpOwogICAgfQoKICAgIC8vIGdyYXBoIG9yIGRpZ3JhcGgga2V5d29yZAogICAgaWYgKHRva2VuID09PSAnZ3JhcGgnIHx8IHRva2VuID09PSAnZGlncmFwaCcpIHsKICAgICAgZ3JhcGgudHlwZSA9IHRva2VuOwogICAgICBnZXRUb2tlbigpOwogICAgfQoKICAgIC8vIG9wdGlvbmFsIGdyYXBoIGlkCiAgICBpZiAodG9rZW5UeXBlID09PSBUT0tFTlRZUEUuSURFTlRJRklFUikgewogICAgICBncmFwaC5pZCA9IHRva2VuOwogICAgICBnZXRUb2tlbigpOwogICAgfQoKICAgIC8vIG9wZW4gYW5nbGUgYnJhY2tldAogICAgaWYgKHRva2VuICE9ICd7JykgewogICAgICB0aHJvdyBuZXdTeW50YXhFcnJvcignQW5nbGUgYnJhY2tldCB7IGV4cGVjdGVkJyk7CiAgICB9CiAgICBnZXRUb2tlbigpOwoKICAgIC8vIHN0YXRlbWVudHMKICAgIHBhcnNlU3RhdGVtZW50cyhncmFwaCk7CgogICAgLy8gY2xvc2UgYW5nbGUgYnJhY2tldAogICAgaWYgKHRva2VuICE9ICd9JykgewogICAgICB0aHJvdyBuZXdTeW50YXhFcnJvcignQW5nbGUgYnJhY2tldCB9IGV4cGVjdGVkJyk7CiAgICB9CiAgICBnZXRUb2tlbigpOwoKICAgIC8vIGVuZCBvZiBmaWxlCiAgICBpZiAodG9rZW4gIT09ICcnKSB7CiAgICAgIHRocm93IG5ld1N5bnRheEVycm9yKCdFbmQgb2YgZmlsZSBleHBlY3RlZCcpOwogICAgfQogICAgZ2V0VG9rZW4oKTsKCiAgICAvLyByZW1vdmUgdGVtcG9yYXJ5IGRlZmF1bHQgb3B0aW9ucwogICAgZGVsZXRlIGdyYXBoLm5vZGU7CiAgICBkZWxldGUgZ3JhcGguZWRnZTsKICAgIGRlbGV0ZSBncmFwaC5ncmFwaDsKCiAgICByZXR1cm4gZ3JhcGg7CiAgfQoKICAvKioKICAgKiBQYXJzZSBhIGxpc3Qgd2l0aCBzdGF0ZW1lbnRzLgogICAqIEBwYXJhbSB7T2JqZWN0fSBncmFwaAogICAqLwogIGZ1bmN0aW9uIHBhcnNlU3RhdGVtZW50cyhncmFwaCkgewogICAgd2hpbGUgKHRva2VuICE9PSAnJyAmJiB0b2tlbiAhPSAnfScpIHsKICAgICAgcGFyc2VTdGF0ZW1lbnQoZ3JhcGgpOwogICAgICBpZiAodG9rZW4gPT09ICc7JykgewogICAgICAgIGdldFRva2VuKCk7CiAgICAgIH0KICAgIH0KICB9CgogIC8qKgogICAqIFBhcnNlIGEgc2luZ2xlIHN0YXRlbWVudC4gQ2FuIGJlIGEgYW4gYXR0cmlidXRlIHN0YXRlbWVudCwgbm9kZQogICAqIHN0YXRlbWVudCwgYSBzZXJpZXMgb2Ygbm9kZSBzdGF0ZW1lbnRzIGFuZCBlZGdlIHN0YXRlbWVudHMsIG9yIGEKICAgKiBwYXJhbWV0ZXIuCiAgICogQHBhcmFtIHtPYmplY3R9IGdyYXBoCiAgICovCiAgZnVuY3Rpb24gcGFyc2VTdGF0ZW1lbnQoZ3JhcGgpIHsKICAgIC8vIHBhcnNlIHN1YmdyYXBoCiAgICB2YXIgc3ViZ3JhcGggPSBwYXJzZVN1YmdyYXBoKGdyYXBoKTsKICAgIGlmIChzdWJncmFwaCkgewogICAgICAvLyBlZGdlIHN0YXRlbWVudHMKICAgICAgcGFyc2VFZGdlKGdyYXBoLCBzdWJncmFwaCk7CgogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gcGFyc2UgYW4gYXR0cmlidXRlIHN0YXRlbWVudAogICAgdmFyIGF0dHIgPSBwYXJzZUF0dHJpYnV0ZVN0YXRlbWVudChncmFwaCk7CiAgICBpZiAoYXR0cikgewogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gcGFyc2Ugbm9kZQogICAgaWYgKHRva2VuVHlwZSAhPSBUT0tFTlRZUEUuSURFTlRJRklFUikgewogICAgICB0aHJvdyBuZXdTeW50YXhFcnJvcignSWRlbnRpZmllciBleHBlY3RlZCcpOwogICAgfQogICAgdmFyIGlkID0gdG9rZW47IC8vIGlkIGNhbiBiZSBhIHN0cmluZyBvciBhIG51bWJlcgogICAgZ2V0VG9rZW4oKTsKCiAgICBpZiAodG9rZW4gPT09ICc9JykgewogICAgICAvLyBpZCBzdGF0ZW1lbnQKICAgICAgZ2V0VG9rZW4oKTsKICAgICAgaWYgKHRva2VuVHlwZSAhPSBUT0tFTlRZUEUuSURFTlRJRklFUikgewogICAgICAgIHRocm93IG5ld1N5bnRheEVycm9yKCdJZGVudGlmaWVyIGV4cGVjdGVkJyk7CiAgICAgIH0KICAgICAgZ3JhcGhbaWRdID0gdG9rZW47CiAgICAgIGdldFRva2VuKCk7CiAgICAgIC8vIFRPRE86IGltcGxlbWVudCBjb21tYSBzZXBhcmF0ZWQgbGlzdCB3aXRoICJhX2xpc3Q6IElEPUlEIFsnLCddIFthX2xpc3RdICIKICAgIH0gZWxzZSB7CiAgICAgIHBhcnNlTm9kZVN0YXRlbWVudChncmFwaCwgaWQpOwogICAgfQogIH0KCiAgLyoqCiAgICogUGFyc2UgYSBzdWJncmFwaAogICAqIEBwYXJhbSB7T2JqZWN0fSBncmFwaCAgICBwYXJlbnQgZ3JhcGggb2JqZWN0CiAgICogQHJldHVybiB7T2JqZWN0IHwgbnVsbH0gc3ViZ3JhcGgKICAgKi8KICBmdW5jdGlvbiBwYXJzZVN1YmdyYXBoKGdyYXBoKSB7CiAgICB2YXIgc3ViZ3JhcGggPSBudWxsOwoKICAgIC8vIG9wdGlvbmFsIHN1YmdyYXBoIGtleXdvcmQKICAgIGlmICh0b2tlbiA9PT0gJ3N1YmdyYXBoJykgewogICAgICBzdWJncmFwaCA9IHt9OwogICAgICBzdWJncmFwaC50eXBlID0gJ3N1YmdyYXBoJzsKICAgICAgZ2V0VG9rZW4oKTsKCiAgICAgIC8vIG9wdGlvbmFsIGdyYXBoIGlkCiAgICAgIGlmICh0b2tlblR5cGUgPT09IFRPS0VOVFlQRS5JREVOVElGSUVSKSB7CiAgICAgICAgc3ViZ3JhcGguaWQgPSB0b2tlbjsKICAgICAgICBnZXRUb2tlbigpOwogICAgICB9CiAgICB9CgogICAgLy8gb3BlbiBhbmdsZSBicmFja2V0CiAgICBpZiAodG9rZW4gPT09ICd7JykgewogICAgICBnZXRUb2tlbigpOwoKICAgICAgaWYgKCFzdWJncmFwaCkgewogICAgICAgIHN1YmdyYXBoID0ge307CiAgICAgIH0KICAgICAgc3ViZ3JhcGgucGFyZW50ID0gZ3JhcGg7CiAgICAgIHN1YmdyYXBoLm5vZGUgPSBncmFwaC5ub2RlOwogICAgICBzdWJncmFwaC5lZGdlID0gZ3JhcGguZWRnZTsKICAgICAgc3ViZ3JhcGguZ3JhcGggPSBncmFwaC5ncmFwaDsKCiAgICAgIC8vIHN0YXRlbWVudHMKICAgICAgcGFyc2VTdGF0ZW1lbnRzKHN1YmdyYXBoKTsKCiAgICAgIC8vIGNsb3NlIGFuZ2xlIGJyYWNrZXQKICAgICAgaWYgKHRva2VuICE9ICd9JykgewogICAgICAgIHRocm93IG5ld1N5bnRheEVycm9yKCdBbmdsZSBicmFja2V0IH0gZXhwZWN0ZWQnKTsKICAgICAgfQogICAgICBnZXRUb2tlbigpOwoKICAgICAgLy8gcmVtb3ZlIHRlbXBvcmFyeSBkZWZhdWx0IG9wdGlvbnMKICAgICAgZGVsZXRlIHN1YmdyYXBoLm5vZGU7CiAgICAgIGRlbGV0ZSBzdWJncmFwaC5lZGdlOwogICAgICBkZWxldGUgc3ViZ3JhcGguZ3JhcGg7CiAgICAgIGRlbGV0ZSBzdWJncmFwaC5wYXJlbnQ7CgogICAgICAvLyByZWdpc3RlciBhdCB0aGUgcGFyZW50IGdyYXBoCiAgICAgIGlmICghZ3JhcGguc3ViZ3JhcGhzKSB7CiAgICAgICAgZ3JhcGguc3ViZ3JhcGhzID0gW107CiAgICAgIH0KICAgICAgZ3JhcGguc3ViZ3JhcGhzLnB1c2goc3ViZ3JhcGgpOwogICAgfQoKICAgIHJldHVybiBzdWJncmFwaDsKICB9CgogIC8qKgogICAqIHBhcnNlIGFuIGF0dHJpYnV0ZSBzdGF0ZW1lbnQgbGlrZSAibm9kZSBbc2hhcGU9Y2lyY2xlIGZvbnRTaXplPTE2XSIuCiAgICogQXZhaWxhYmxlIGtleXdvcmRzIGFyZSAnbm9kZScsICdlZGdlJywgJ2dyYXBoJy4KICAgKiBUaGUgcHJldmlvdXMgbGlzdCB3aXRoIGRlZmF1bHQgYXR0cmlidXRlcyB3aWxsIGJlIHJlcGxhY2VkCiAgICogQHBhcmFtIHtPYmplY3R9IGdyYXBoCiAgICogQHJldHVybnMge1N0cmluZyB8IG51bGx9IGtleXdvcmQgUmV0dXJucyB0aGUgbmFtZSBvZiB0aGUgcGFyc2VkIGF0dHJpYnV0ZQogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChub2RlLCBlZGdlLCBncmFwaCksIG9yIG51bGwgaWYgbm90aGluZwogICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzIHBhcnNlZC4KICAgKi8KICBmdW5jdGlvbiBwYXJzZUF0dHJpYnV0ZVN0YXRlbWVudChncmFwaCkgewogICAgLy8gYXR0cmlidXRlIHN0YXRlbWVudHMKICAgIGlmICh0b2tlbiA9PT0gJ25vZGUnKSB7CiAgICAgIGdldFRva2VuKCk7CgogICAgICAvLyBub2RlIGF0dHJpYnV0ZXMKICAgICAgZ3JhcGgubm9kZSA9IHBhcnNlQXR0cmlidXRlTGlzdCgpOwogICAgICByZXR1cm4gJ25vZGUnOwogICAgfSBlbHNlIGlmICh0b2tlbiA9PT0gJ2VkZ2UnKSB7CiAgICAgIGdldFRva2VuKCk7CgogICAgICAvLyBlZGdlIGF0dHJpYnV0ZXMKICAgICAgZ3JhcGguZWRnZSA9IHBhcnNlQXR0cmlidXRlTGlzdCgpOwogICAgICByZXR1cm4gJ2VkZ2UnOwogICAgfSBlbHNlIGlmICh0b2tlbiA9PT0gJ2dyYXBoJykgewogICAgICBnZXRUb2tlbigpOwoKICAgICAgLy8gZ3JhcGggYXR0cmlidXRlcwogICAgICBncmFwaC5ncmFwaCA9IHBhcnNlQXR0cmlidXRlTGlzdCgpOwogICAgICByZXR1cm4gJ2dyYXBoJzsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9CgogIC8qKgogICAqIHBhcnNlIGEgbm9kZSBzdGF0ZW1lbnQKICAgKiBAcGFyYW0ge09iamVjdH0gZ3JhcGgKICAgKiBAcGFyYW0ge1N0cmluZyB8IE51bWJlcn0gaWQKICAgKi8KICBmdW5jdGlvbiBwYXJzZU5vZGVTdGF0ZW1lbnQoZ3JhcGgsIGlkKSB7CiAgICAvLyBub2RlIHN0YXRlbWVudAogICAgdmFyIG5vZGUgPSB7CiAgICAgIGlkOiBpZAogICAgfTsKICAgIHZhciBhdHRyID0gcGFyc2VBdHRyaWJ1dGVMaXN0KCk7CiAgICBpZiAoYXR0cikgewogICAgICBub2RlLmF0dHIgPSBhdHRyOwogICAgfQogICAgYWRkTm9kZShncmFwaCwgbm9kZSk7CgogICAgLy8gZWRnZSBzdGF0ZW1lbnRzCiAgICBwYXJzZUVkZ2UoZ3JhcGgsIGlkKTsKICB9CgogIC8qKgogICAqIFBhcnNlIGFuIGVkZ2Ugb3IgYSBzZXJpZXMgb2YgZWRnZXMKICAgKiBAcGFyYW0ge09iamVjdH0gZ3JhcGgKICAgKiBAcGFyYW0ge1N0cmluZyB8IE51bWJlcn0gZnJvbSAgICAgICAgSWQgb2YgdGhlIGZyb20gbm9kZQogICAqLwogIGZ1bmN0aW9uIHBhcnNlRWRnZShncmFwaCwgZnJvbSkgewogICAgd2hpbGUgKHRva2VuID09PSAnLT4nIHx8IHRva2VuID09PSAnLS0nKSB7CiAgICAgIHZhciB0bzsKICAgICAgdmFyIHR5cGUgPSB0b2tlbjsKICAgICAgZ2V0VG9rZW4oKTsKCiAgICAgIHZhciBzdWJncmFwaCA9IHBhcnNlU3ViZ3JhcGgoZ3JhcGgpOwogICAgICBpZiAoc3ViZ3JhcGgpIHsKICAgICAgICB0byA9IHN1YmdyYXBoOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh0b2tlblR5cGUgIT0gVE9LRU5UWVBFLklERU5USUZJRVIpIHsKICAgICAgICAgIHRocm93IG5ld1N5bnRheEVycm9yKCdJZGVudGlmaWVyIG9yIHN1YmdyYXBoIGV4cGVjdGVkJyk7CiAgICAgICAgfQogICAgICAgIHRvID0gdG9rZW47CiAgICAgICAgYWRkTm9kZShncmFwaCwgewogICAgICAgICAgaWQ6IHRvCiAgICAgICAgfSk7CiAgICAgICAgZ2V0VG9rZW4oKTsKICAgICAgfQoKICAgICAgLy8gcGFyc2UgZWRnZSBhdHRyaWJ1dGVzCiAgICAgIHZhciBhdHRyID0gcGFyc2VBdHRyaWJ1dGVMaXN0KCk7CgogICAgICAvLyBjcmVhdGUgZWRnZQogICAgICB2YXIgZWRnZSA9IGNyZWF0ZUVkZ2UoZ3JhcGgsIGZyb20sIHRvLCB0eXBlLCBhdHRyKTsKICAgICAgYWRkRWRnZShncmFwaCwgZWRnZSk7CgogICAgICBmcm9tID0gdG87CiAgICB9CiAgfQoKICAvKioKICAgKiBQYXJzZSBhIHNldCB3aXRoIGF0dHJpYnV0ZXMsCiAgICogZm9yIGV4YW1wbGUgW2xhYmVsPSIxLjAwMCIsIHNoYXBlPXNvbGlkXQogICAqIEByZXR1cm4ge09iamVjdCB8IG51bGx9IGF0dHIKICAgKi8KICBmdW5jdGlvbiBwYXJzZUF0dHJpYnV0ZUxpc3QoKSB7CiAgICB2YXIgYXR0ciA9IG51bGw7CgogICAgd2hpbGUgKHRva2VuID09PSAnWycpIHsKICAgICAgZ2V0VG9rZW4oKTsKICAgICAgYXR0ciA9IHt9OwogICAgICB3aGlsZSAodG9rZW4gIT09ICcnICYmIHRva2VuICE9ICddJykgewogICAgICAgIGlmICh0b2tlblR5cGUgIT0gVE9LRU5UWVBFLklERU5USUZJRVIpIHsKICAgICAgICAgIHRocm93IG5ld1N5bnRheEVycm9yKCdBdHRyaWJ1dGUgbmFtZSBleHBlY3RlZCcpOwogICAgICAgIH0KICAgICAgICB2YXIgbmFtZSA9IHRva2VuOwoKICAgICAgICBnZXRUb2tlbigpOwogICAgICAgIGlmICh0b2tlbiAhPSAnPScpIHsKICAgICAgICAgIHRocm93IG5ld1N5bnRheEVycm9yKCdFcXVhbCBzaWduID0gZXhwZWN0ZWQnKTsKICAgICAgICB9CiAgICAgICAgZ2V0VG9rZW4oKTsKCiAgICAgICAgaWYgKHRva2VuVHlwZSAhPSBUT0tFTlRZUEUuSURFTlRJRklFUikgewogICAgICAgICAgdGhyb3cgbmV3U3ludGF4RXJyb3IoJ0F0dHJpYnV0ZSB2YWx1ZSBleHBlY3RlZCcpOwogICAgICAgIH0KICAgICAgICB2YXIgdmFsdWUgPSB0b2tlbjsKICAgICAgICBzZXRWYWx1ZShhdHRyLCBuYW1lLCB2YWx1ZSk7IC8vIG5hbWUgY2FuIGJlIGEgcGF0aAoKICAgICAgICBnZXRUb2tlbigpOwogICAgICAgIGlmICh0b2tlbiA9PSAnLCcpIHsKICAgICAgICAgIGdldFRva2VuKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodG9rZW4gIT0gJ10nKSB7CiAgICAgICAgdGhyb3cgbmV3U3ludGF4RXJyb3IoJ0JyYWNrZXQgXSBleHBlY3RlZCcpOwogICAgICB9CiAgICAgIGdldFRva2VuKCk7CiAgICB9CgogICAgcmV0dXJuIGF0dHI7CiAgfQoKICAvKioKICAgKiBDcmVhdGUgYSBzeW50YXggZXJyb3Igd2l0aCBleHRyYSBpbmZvcm1hdGlvbiBvbiBjdXJyZW50IHRva2VuIGFuZCBpbmRleC4KICAgKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZQogICAqIEByZXR1cm5zIHtTeW50YXhFcnJvcn0gZXJyCiAgICovCiAgZnVuY3Rpb24gbmV3U3ludGF4RXJyb3IobWVzc2FnZSkgewogICAgcmV0dXJuIG5ldyBTeW50YXhFcnJvcihtZXNzYWdlICsgJywgZ290ICInICsgY2hvcCh0b2tlbiwgMzApICsgJyIgKGNoYXIgJyArIGluZGV4ICsgJyknKTsKICB9CgogIC8qKgogICAqIENob3Agb2ZmIHRleHQgYWZ0ZXIgYSBtYXhpbXVtIGxlbmd0aAogICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0CiAgICogQHBhcmFtIHtOdW1iZXJ9IG1heExlbmd0aAogICAqIEByZXR1cm5zIHtTdHJpbmd9CiAgICovCiAgZnVuY3Rpb24gY2hvcCh0ZXh0LCBtYXhMZW5ndGgpIHsKICAgIHJldHVybiB0ZXh0Lmxlbmd0aCA8PSBtYXhMZW5ndGggPyB0ZXh0IDogdGV4dC5zdWJzdHIoMCwgMjcpICsgJy4uLic7CiAgfQoKICAvKioKICAgKiBFeGVjdXRlIGEgZnVuY3Rpb24gZm4gZm9yIGVhY2ggcGFpciBvZiBlbGVtZW50cyBpbiB0d28gYXJyYXlzCiAgICogQHBhcmFtIHtBcnJheSB8ICp9IGFycmF5MQogICAqIEBwYXJhbSB7QXJyYXkgfCAqfSBhcnJheTIKICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmbgogICAqLwogIGZ1bmN0aW9uIGZvckVhY2gyKGFycmF5MSwgYXJyYXkyLCBmbikgewogICAgaWYgKEFycmF5LmlzQXJyYXkoYXJyYXkxKSkgewogICAgICBhcnJheTEuZm9yRWFjaChmdW5jdGlvbiAoZWxlbTEpIHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhcnJheTIpKSB7CiAgICAgICAgICBhcnJheTIuZm9yRWFjaChmdW5jdGlvbiAoZWxlbTIpIHsKICAgICAgICAgICAgZm4oZWxlbTEsIGVsZW0yKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmbihlbGVtMSwgYXJyYXkyKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJyYXkyKSkgewogICAgICAgIGFycmF5Mi5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtMikgewogICAgICAgICAgZm4oYXJyYXkxLCBlbGVtMik7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm4oYXJyYXkxLCBhcnJheTIpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBTZXQgYSBuZXN0ZWQgcHJvcGVydHkgb24gYW4gb2JqZWN0CiAgICogV2hlbiBuZXN0ZWQgb2JqZWN0cyBhcmUgbWlzc2luZywgdGhleSB3aWxsIGJlIGNyZWF0ZWQuCiAgICogRm9yIGV4YW1wbGUgc2V0UHJvcCh7fSwgJ2ZvbnQuY29sb3InLCAncmVkJykgd2lsbCByZXR1cm4ge2ZvbnQ6IHtjb2xvcjogJ3JlZCd9fQogICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QKICAgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAgIEEgZG90IHNlcGFyYXRlZCBzdHJpbmcgbGlrZSAnZm9udC5jb2xvcicKICAgKiBAcGFyYW0geyp9IHZhbHVlICAgICAgIFZhbHVlIGZvciB0aGUgcHJvcGVydHkKICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgdGhlIG9yaWdpbmFsIG9iamVjdCwgYWxsb3dzIGZvciBjaGFpbmluZy4KICAgKi8KICBmdW5jdGlvbiBzZXRQcm9wKG9iamVjdCwgcGF0aCwgdmFsdWUpIHsKICAgIHZhciBuYW1lcyA9IHBhdGguc3BsaXQoJy4nKTsKICAgIHZhciBwcm9wID0gbmFtZXMucG9wKCk7CgogICAgLy8gdHJhdmVyc2Ugb3ZlciB0aGUgbmVzdGVkIG9iamVjdHMKICAgIHZhciBvYmogPSBvYmplY3Q7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBuYW1lID0gbmFtZXNbaV07CiAgICAgIGlmICghKG5hbWUgaW4gb2JqKSkgewogICAgICAgIG9ialtuYW1lXSA9IHt9OwogICAgICB9CiAgICAgIG9iaiA9IG9ialtuYW1lXTsKICAgIH0KCiAgICAvLyBzZXQgdGhlIHByb3BlcnR5IHZhbHVlCiAgICBvYmpbcHJvcF0gPSB2YWx1ZTsKCiAgICByZXR1cm4gb2JqZWN0OwogIH0KCiAgLyoqCiAgICogQ29udmVydCBhbiBvYmplY3Qgd2l0aCBET1QgYXR0cmlidXRlcyB0byB0aGVpciB2aXMuanMgZXF1aXZhbGVudHMuCiAgICogQHBhcmFtIHtPYmplY3R9IGF0dHIgICAgIE9iamVjdCB3aXRoIERPVCBhdHRyaWJ1dGVzCiAgICogQHBhcmFtIHtPYmplY3R9IG1hcHBpbmcKICAgKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgICAgUmV0dXJucyBhbiBvYmplY3Qgd2l0aCB2aXMuanMgYXR0cmlidXRlcwogICAqLwogIGZ1bmN0aW9uIGNvbnZlcnRBdHRyKGF0dHIsIG1hcHBpbmcpIHsKICAgIHZhciBjb252ZXJ0ZWQgPSB7fTsKCiAgICBmb3IgKHZhciBwcm9wIGluIGF0dHIpIHsKICAgICAgaWYgKGF0dHIuaGFzT3duUHJvcGVydHkocHJvcCkpIHsKICAgICAgICB2YXIgdmlzUHJvcCA9IG1hcHBpbmdbcHJvcF07CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmlzUHJvcCkpIHsKICAgICAgICAgIHZpc1Byb3AuZm9yRWFjaChmdW5jdGlvbiAodmlzUHJvcEkpIHsKICAgICAgICAgICAgc2V0UHJvcChjb252ZXJ0ZWQsIHZpc1Byb3BJLCBhdHRyW3Byb3BdKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZpc1Byb3AgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBzZXRQcm9wKGNvbnZlcnRlZCwgdmlzUHJvcCwgYXR0cltwcm9wXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNldFByb3AoY29udmVydGVkLCBwcm9wLCBhdHRyW3Byb3BdKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gY29udmVydGVkOwogIH0KCiAgLyoqCiAgICogQ29udmVydCBhIHN0cmluZyBjb250YWluaW5nIGEgZ3JhcGggaW4gRE9UIGxhbmd1YWdlIGludG8gYSBtYXAgY29udGFpbmluZwogICAqIHdpdGggbm9kZXMgYW5kIGVkZ2VzIGluIHRoZSBmb3JtYXQgb2YgZ3JhcGguCiAgICogQHBhcmFtIHtTdHJpbmd9IGRhdGEgICAgICAgICBUZXh0IGNvbnRhaW5pbmcgYSBncmFwaCBpbiBET1Qtbm90YXRpb24KICAgKiBAcmV0dXJuIHtPYmplY3R9IGdyYXBoRGF0YQogICAqLwogIGZ1bmN0aW9uIERPVFRvR3JhcGgoZGF0YSkgewogICAgLy8gcGFyc2UgdGhlIERPVCBmaWxlCiAgICB2YXIgZG90RGF0YSA9IHBhcnNlRE9UKGRhdGEpOwogICAgdmFyIGdyYXBoRGF0YSA9IHsKICAgICAgbm9kZXM6IFtdLAogICAgICBlZGdlczogW10sCiAgICAgIG9wdGlvbnM6IHt9CiAgICB9OwoKICAgIC8vIGNvcHkgdGhlIG5vZGVzCiAgICBpZiAoZG90RGF0YS5ub2RlcykgewogICAgICBkb3REYXRhLm5vZGVzLmZvckVhY2goZnVuY3Rpb24gKGRvdE5vZGUpIHsKICAgICAgICB2YXIgZ3JhcGhOb2RlID0gewogICAgICAgICAgaWQ6IGRvdE5vZGUuaWQsCiAgICAgICAgICBsYWJlbDogU3RyaW5nKGRvdE5vZGUubGFiZWwgfHwgZG90Tm9kZS5pZCkKICAgICAgICB9OwogICAgICAgIG1lcmdlKGdyYXBoTm9kZSwgY29udmVydEF0dHIoZG90Tm9kZS5hdHRyLCBOT0RFX0FUVFJfTUFQUElORykpOwogICAgICAgIGlmIChncmFwaE5vZGUuaW1hZ2UpIHsKICAgICAgICAgIGdyYXBoTm9kZS5zaGFwZSA9ICdpbWFnZSc7CiAgICAgICAgfQogICAgICAgIGdyYXBoRGF0YS5ub2Rlcy5wdXNoKGdyYXBoTm9kZSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8vIGNvcHkgdGhlIGVkZ2VzCiAgICBpZiAoZG90RGF0YS5lZGdlcykgewogICAgICAvKioKICAgICAgICogQ29udmVydCBhbiBlZGdlIGluIERPVCBmb3JtYXQgdG8gYW4gZWRnZSB3aXRoIFZpc0dyYXBoIGZvcm1hdAogICAgICAgKiBAcGFyYW0ge09iamVjdH0gZG90RWRnZQogICAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSBncmFwaEVkZ2UKICAgICAgICovCiAgICAgIHZhciBjb252ZXJ0RWRnZSA9IGZ1bmN0aW9uIGNvbnZlcnRFZGdlKGRvdEVkZ2UpIHsKICAgICAgICB2YXIgZ3JhcGhFZGdlID0gewogICAgICAgICAgZnJvbTogZG90RWRnZS5mcm9tLAogICAgICAgICAgdG86IGRvdEVkZ2UudG8KICAgICAgICB9OwogICAgICAgIG1lcmdlKGdyYXBoRWRnZSwgY29udmVydEF0dHIoZG90RWRnZS5hdHRyLCBFREdFX0FUVFJfTUFQUElORykpOwogICAgICAgIGdyYXBoRWRnZS5hcnJvd3MgPSBkb3RFZGdlLnR5cGUgPT09ICctPicgPyAndG8nIDogdW5kZWZpbmVkOwoKICAgICAgICByZXR1cm4gZ3JhcGhFZGdlOwogICAgICB9OwoKICAgICAgZG90RGF0YS5lZGdlcy5mb3JFYWNoKGZ1bmN0aW9uIChkb3RFZGdlKSB7CiAgICAgICAgdmFyIGZyb20sIHRvOwogICAgICAgIGlmIChkb3RFZGdlLmZyb20gaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgICAgIGZyb20gPSBkb3RFZGdlLmZyb20ubm9kZXM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZyb20gPSB7CiAgICAgICAgICAgIGlkOiBkb3RFZGdlLmZyb20KICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICAvLyBUT0RPOiBzdXBwb3J0IG9mIHNvbGlkL2RvdHRlZC9kYXNoZWQgZWRnZXMgKGF0dHIgPSAnc3R5bGUnKQogICAgICAgIC8vIFRPRE86IHN1cHBvcnQgZm9yIGF0dHJpYnV0ZXMgJ2RpcicgYW5kICdhcnJvd2hlYWQnIChlZGdlIGFycm93cykKCiAgICAgICAgaWYgKGRvdEVkZ2UudG8gaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgICAgIHRvID0gZG90RWRnZS50by5ub2RlczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdG8gPSB7CiAgICAgICAgICAgIGlkOiBkb3RFZGdlLnRvCiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgaWYgKGRvdEVkZ2UuZnJvbSBpbnN0YW5jZW9mIE9iamVjdCAmJiBkb3RFZGdlLmZyb20uZWRnZXMpIHsKICAgICAgICAgIGRvdEVkZ2UuZnJvbS5lZGdlcy5mb3JFYWNoKGZ1bmN0aW9uIChzdWJFZGdlKSB7CiAgICAgICAgICAgIHZhciBncmFwaEVkZ2UgPSBjb252ZXJ0RWRnZShzdWJFZGdlKTsKICAgICAgICAgICAgZ3JhcGhEYXRhLmVkZ2VzLnB1c2goZ3JhcGhFZGdlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZm9yRWFjaDIoZnJvbSwgdG8sIGZ1bmN0aW9uIChmcm9tLCB0bykgewogICAgICAgICAgdmFyIHN1YkVkZ2UgPSBjcmVhdGVFZGdlKGdyYXBoRGF0YSwgZnJvbS5pZCwgdG8uaWQsIGRvdEVkZ2UudHlwZSwgZG90RWRnZS5hdHRyKTsKICAgICAgICAgIHZhciBncmFwaEVkZ2UgPSBjb252ZXJ0RWRnZShzdWJFZGdlKTsKICAgICAgICAgIGdyYXBoRGF0YS5lZGdlcy5wdXNoKGdyYXBoRWRnZSk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChkb3RFZGdlLnRvIGluc3RhbmNlb2YgT2JqZWN0ICYmIGRvdEVkZ2UudG8uZWRnZXMpIHsKICAgICAgICAgIGRvdEVkZ2UudG8uZWRnZXMuZm9yRWFjaChmdW5jdGlvbiAoc3ViRWRnZSkgewogICAgICAgICAgICB2YXIgZ3JhcGhFZGdlID0gY29udmVydEVkZ2Uoc3ViRWRnZSk7CiAgICAgICAgICAgIGdyYXBoRGF0YS5lZGdlcy5wdXNoKGdyYXBoRWRnZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIC8vIGNvcHkgdGhlIG9wdGlvbnMKICAgIGlmIChkb3REYXRhLmF0dHIpIHsKICAgICAgZ3JhcGhEYXRhLm9wdGlvbnMgPSBkb3REYXRhLmF0dHI7CiAgICB9CgogICAgcmV0dXJuIGdyYXBoRGF0YTsKICB9CgogIC8vIGV4cG9ydHMKICBleHBvcnRzLnBhcnNlRE9UID0gcGFyc2VET1Q7CiAgZXhwb3J0cy5ET1RUb0dyYXBoID0gRE9UVG9HcmFwaDsKCi8qKiovIH0sCi8qIDExMSAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgJ3VzZSBzdHJpY3QnOwoKICBmdW5jdGlvbiBwYXJzZUdlcGhpKGdlcGhpSlNPTiwgb3B0aW9uc09iaikgewogICAgdmFyIGVkZ2VzID0gW107CiAgICB2YXIgbm9kZXMgPSBbXTsKICAgIHZhciBvcHRpb25zID0gewogICAgICBlZGdlczogewogICAgICAgIGluaGVyaXRDb2xvcjogZmFsc2UKICAgICAgfSwKICAgICAgbm9kZXM6IHsKICAgICAgICBmaXhlZDogZmFsc2UsCiAgICAgICAgcGFyc2VDb2xvcjogZmFsc2UKICAgICAgfQogICAgfTsKCiAgICBpZiAob3B0aW9uc09iaiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmIChvcHRpb25zT2JqLmZpeGVkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBvcHRpb25zLm5vZGVzLmZpeGVkID0gb3B0aW9uc09iai5maXhlZDsKICAgICAgfQogICAgICBpZiAob3B0aW9uc09iai5wYXJzZUNvbG9yICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBvcHRpb25zLm5vZGVzLnBhcnNlQ29sb3IgPSBvcHRpb25zT2JqLnBhcnNlQ29sb3I7CiAgICAgIH0KICAgICAgaWYgKG9wdGlvbnNPYmouaW5oZXJpdENvbG9yICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBvcHRpb25zLmVkZ2VzLmluaGVyaXRDb2xvciA9IG9wdGlvbnNPYmouaW5oZXJpdENvbG9yOwogICAgICB9CiAgICB9CgogICAgdmFyIGdFZGdlcyA9IGdlcGhpSlNPTi5lZGdlczsKICAgIHZhciBnTm9kZXMgPSBnZXBoaUpTT04ubm9kZXM7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdFZGdlcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgZWRnZSA9IHt9OwogICAgICB2YXIgZ0VkZ2UgPSBnRWRnZXNbaV07CiAgICAgIGVkZ2VbJ2lkJ10gPSBnRWRnZS5pZDsKICAgICAgZWRnZVsnZnJvbSddID0gZ0VkZ2Uuc291cmNlOwogICAgICBlZGdlWyd0byddID0gZ0VkZ2UudGFyZ2V0OwogICAgICBlZGdlWydhdHRyaWJ1dGVzJ10gPSBnRWRnZS5hdHRyaWJ1dGVzOwogICAgICAvLyAgICBlZGdlWyd2YWx1ZSddID0gZ0VkZ2UuYXR0cmlidXRlcyAhPT0gdW5kZWZpbmVkID8gZ0VkZ2UuYXR0cmlidXRlcy5XZWlnaHQgOiB1bmRlZmluZWQ7CiAgICAgIC8vICAgIGVkZ2VbJ3dpZHRoJ10gPSBlZGdlWyd2YWx1ZSddICE9PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBlZGdlZ0VkZ2Uuc2l6ZTsKICAgICAgaWYgKGdFZGdlLmNvbG9yICYmIG9wdGlvbnMuaW5oZXJpdENvbG9yID09PSBmYWxzZSkgewogICAgICAgIGVkZ2VbJ2NvbG9yJ10gPSBnRWRnZS5jb2xvcjsKICAgICAgfQogICAgICBlZGdlcy5wdXNoKGVkZ2UpOwogICAgfQoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ05vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBub2RlID0ge307CiAgICAgIHZhciBnTm9kZSA9IGdOb2Rlc1tpXTsKICAgICAgbm9kZVsnaWQnXSA9IGdOb2RlLmlkOwogICAgICBub2RlWydhdHRyaWJ1dGVzJ10gPSBnTm9kZS5hdHRyaWJ1dGVzOwogICAgICBub2RlWyd0aXRsZSddID0gZ05vZGUudGl0bGU7CiAgICAgIG5vZGVbJ3gnXSA9IGdOb2RlLng7CiAgICAgIG5vZGVbJ3knXSA9IGdOb2RlLnk7CiAgICAgIG5vZGVbJ2xhYmVsJ10gPSBnTm9kZS5sYWJlbDsKICAgICAgaWYgKG9wdGlvbnMubm9kZXMucGFyc2VDb2xvciA9PT0gdHJ1ZSkgewogICAgICAgIG5vZGVbJ2NvbG9yJ10gPSBnTm9kZS5jb2xvcjsKICAgICAgfSBlbHNlIHsKICAgICAgICBub2RlWydjb2xvciddID0gZ05vZGUuY29sb3IgIT09IHVuZGVmaW5lZCA/IHsgYmFja2dyb3VuZDogZ05vZGUuY29sb3IsIGJvcmRlcjogZ05vZGUuY29sb3IsIGhpZ2hsaWdodDogeyBiYWNrZ3JvdW5kOiBnTm9kZS5jb2xvciwgYm9yZGVyOiBnTm9kZS5jb2xvciB9LCBob3ZlcjogeyBiYWNrZ3JvdW5kOiBnTm9kZS5jb2xvciwgYm9yZGVyOiBnTm9kZS5jb2xvciB9IH0gOiB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgbm9kZVsnc2l6ZSddID0gZ05vZGUuc2l6ZTsKICAgICAgbm9kZVsnZml4ZWQnXSA9IG9wdGlvbnMubm9kZXMuZml4ZWQgJiYgZ05vZGUueCAhPT0gdW5kZWZpbmVkICYmIGdOb2RlLnkgIT09IHVuZGVmaW5lZDsKICAgICAgbm9kZXMucHVzaChub2RlKTsKICAgIH0KCiAgICByZXR1cm4geyBub2Rlczogbm9kZXMsIGVkZ2VzOiBlZGdlcyB9OwogIH0KCiAgZXhwb3J0cy5wYXJzZUdlcGhpID0gcGFyc2VHZXBoaTsKCi8qKiovIH0sCi8qIDExMiAqLwovKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHsKCiAgLyoqCiAgICogQGNsYXNzIEltYWdlcwogICAqIFRoaXMgY2xhc3MgbG9hZHMgaW1hZ2VzIGFuZCBrZWVwcyB0aGVtIHN0b3JlZC4KICAgKi8KICAidXNlIHN0cmljdCI7CgogIGZ1bmN0aW9uIEltYWdlcyhjYWxsYmFjaykgewogICAgdGhpcy5pbWFnZXMgPSB7fTsKICAgIHRoaXMuaW1hZ2VCcm9rZW4gPSB7fTsKICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICB9CgogIC8qKgogICAqCiAgICogQHBhcmFtIHtzdHJpbmd9IHVybCAgICAgICAgICBVcmwgb2YgdGhlIGltYWdlCiAgICogQHBhcmFtIHtzdHJpbmd9IHVybCAgICAgICAgICBVcmwgb2YgYW4gaW1hZ2UgdG8gdXNlIGlmIHRoZSB1cmwgaW1hZ2UgaXMgbm90IGZvdW5kCiAgICogQHJldHVybiB7SW1hZ2V9IGltZyAgICAgICAgICBUaGUgaW1hZ2Ugb2JqZWN0CiAgICovCiAgSW1hZ2VzLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKHVybCwgYnJva2VuVXJsLCBpZCkgewogICAgdmFyIGltZyA9IHRoaXMuaW1hZ2VzW3VybF07IC8vIG1ha2UgYSBwb2ludGVyCiAgICBpZiAoaW1nID09PSB1bmRlZmluZWQpIHsKICAgICAgLy8gY3JlYXRlIHRoZSBpbWFnZQogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBpbWcgPSBuZXcgSW1hZ2UoKTsKICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBJRTExIGZpeCAtLSB0aGFua3MgZHBvbmNoIQogICAgICAgIGlmICh0aGlzLndpZHRoID09PSAwKSB7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMpOwogICAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMub2Zmc2V0V2lkdGg7CiAgICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzKTsKICAgICAgICB9CgogICAgICAgIGlmIChtZS5jYWxsYmFjaykgewogICAgICAgICAgbWUuaW1hZ2VzW3VybF0gPSBpbWc7CiAgICAgICAgICBtZS5jYWxsYmFjayh0aGlzKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoYnJva2VuVXJsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkNvdWxkIG5vdCBsb2FkIGltYWdlOiIsIHVybCk7CiAgICAgICAgICBkZWxldGUgdGhpcy5zcmM7CiAgICAgICAgICBpZiAobWUuY2FsbGJhY2spIHsKICAgICAgICAgICAgbWUuY2FsbGJhY2sodGhpcyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChtZS5pbWFnZUJyb2tlbltpZF0gJiYgbWUuaW1hZ2VCcm9rZW5baWRdW3VybF0gPT09IHRydWUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiQ291bGQgbm90IGxvYWQgYnJva2VuSW1hZ2U6IiwgYnJva2VuVXJsKTsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuc3JjOwogICAgICAgICAgICBpZiAobWUuY2FsbGJhY2spIHsKICAgICAgICAgICAgICBtZS5jYWxsYmFjayh0aGlzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiQ291bGQgbm90IGxvYWQgaW1hZ2U6IiwgdXJsKTsKICAgICAgICAgICAgdGhpcy5zcmMgPSBicm9rZW5Vcmw7CiAgICAgICAgICAgIGlmIChtZS5pbWFnZUJyb2tlbltpZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIG1lLmltYWdlQnJva2VuW2lkXSA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1lLmltYWdlQnJva2VuW2lkXVt1cmxdID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICBpbWcuc3JjID0gdXJsOwogICAgfQoKICAgIHJldHVybiBpbWc7CiAgfTsKCiAgbW9kdWxlLmV4cG9ydHMgPSBJbWFnZXM7CgovKioqLyB9LAovKiAxMTMgKi8KLyoqKi8gZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7CgogIC8vIEVuZ2xpc2gKICAndXNlIHN0cmljdCc7CgogIGV4cG9ydHNbJ2VuJ10gPSB7CiAgICBlZGl0OiAnRWRpdCcsCiAgICBkZWw6ICdEZWxldGUgc2VsZWN0ZWQnLAogICAgYmFjazogJ0JhY2snLAogICAgYWRkTm9kZTogJ0FkZCBOb2RlJywKICAgIGFkZEVkZ2U6ICdBZGQgRWRnZScsCiAgICBlZGl0Tm9kZTogJ0VkaXQgTm9kZScsCiAgICBlZGl0RWRnZTogJ0VkaXQgRWRnZScsCiAgICBhZGREZXNjcmlwdGlvbjogJ0NsaWNrIGluIGFuIGVtcHR5IHNwYWNlIHRvIHBsYWNlIGEgbmV3IG5vZGUuJywKICAgIGVkZ2VEZXNjcmlwdGlvbjogJ0NsaWNrIG9uIGEgbm9kZSBhbmQgZHJhZyB0aGUgZWRnZSB0byBhbm90aGVyIG5vZGUgdG8gY29ubmVjdCB0aGVtLicsCiAgICBlZGl0RWRnZURlc2NyaXB0aW9uOiAnQ2xpY2sgb24gdGhlIGNvbnRyb2wgcG9pbnRzIGFuZCBkcmFnIHRoZW0gdG8gYSBub2RlIHRvIGNvbm5lY3QgdG8gaXQuJywKICAgIGNyZWF0ZUVkZ2VFcnJvcjogJ0Nhbm5vdCBsaW5rIGVkZ2VzIHRvIGEgY2x1c3Rlci4nLAogICAgZGVsZXRlQ2x1c3RlckVycm9yOiAnQ2x1c3RlcnMgY2Fubm90IGJlIGRlbGV0ZWQuJywKICAgIGVkaXRDbHVzdGVyRXJyb3I6ICdDbHVzdGVycyBjYW5ub3QgYmUgZWRpdGVkLicKICB9OwogIGV4cG9ydHNbJ2VuX0VOJ10gPSBleHBvcnRzWydlbiddOwogIGV4cG9ydHNbJ2VuX1VTJ10gPSBleHBvcnRzWydlbiddOwoKICAvLyBEdXRjaAogIGV4cG9ydHNbJ25sJ10gPSB7CiAgICBlZGl0OiAnV2lqemlnZW4nLAogICAgZGVsOiAnU2VsZWN0aWUgdmVyd2lqZGVyZW4nLAogICAgYmFjazogJ1RlcnVnJywKICAgIGFkZE5vZGU6ICdOb2RlIHRvZXZvZWdlbicsCiAgICBhZGRFZGdlOiAnTGluayB0b2V2b2VnZW4nLAogICAgZWRpdE5vZGU6ICdOb2RlIHdpanppZ2VuJywKICAgIGVkaXRFZGdlOiAnTGluayB3aWp6aWdlbicsCiAgICBhZGREZXNjcmlwdGlvbjogJ0tsaWsgb3AgZWVuIGxlZWcgZ2ViaWVkIG9tIGVlbiBuaWV1d2Ugbm9kZSB0ZSBtYWtlbi4nLAogICAgZWRnZURlc2NyaXB0aW9uOiAnS2xpayBvcCBlZW4gbm9kZSBlbiBzbGVlcCBkZSBsaW5rIG5hYXIgZWVuIGFuZGVyZSBub2RlIG9tIHplIHRlIHZlcmJpbmRlbi4nLAogICAgZWRpdEVkZ2VEZXNjcmlwdGlvbjogJ0tsaWsgb3AgZGUgdmVyYmluZGluZ3NwdW50ZW4gZW4gc2xlZXAgemUgbmFhciBlZW4gbm9kZSBvbSBkYWFybWVlIHRlIHZlcmJpbmRlbi4nLAogICAgY3JlYXRlRWRnZUVycm9yOiAnS2FuIGdlZW4gbGluayBtYWtlbiBuYWFyIGVlbiBjbHVzdGVyLicsCiAgICBkZWxldGVDbHVzdGVyRXJyb3I6ICdDbHVzdGVycyBrdW5uZW4gbmlldCB3b3JkZW4gdmVyd2lqZGVyZC4nLAogICAgZWRpdENsdXN0ZXJFcnJvcjogJ0NsdXN0ZXJzIGt1bm5lbiBuaWV0IHdvcmRlbiBhYW5nZXBhc3QuJwogIH07CiAgZXhwb3J0c1snbmxfTkwnXSA9IGV4cG9ydHNbJ25sJ107CiAgZXhwb3J0c1snbmxfQkUnXSA9IGV4cG9ydHNbJ25sJ107CgovKioqLyB9Ci8qKioqKiovIF0pCn0pOwo7",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 315,
          "bodySize": 1862772
        },
        "cache": {},
        "timings": {
          "send": 44,
          "wait": 0,
          "receive": 257
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8639"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.108-07:00",
        "time": 131,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/spellcheck.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 358,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1553"
            }
          ],
          "content": {
            "size": 4472,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "LyoqDQoqIENhbGxlZCBieSB0aGUgc3BlbGxjaGVjayBsaW5rIG9uIHRoZSBuYXJyYXRpdmVzDQoqIEludm9rZXMgdGhlIE1TV29yZCBzcGVsbCBjaGVjayBkaWFsb2cNCiovDQpmdW5jdGlvbiBjaGVja1RleHRTcGVsbGluZyhmb3JtVGV4dEJveCkgew0KDQoJLy9yZXRyaWV2ZSB0aGUgdGV4dCB0aGV5IGVudGVyZWQNCgl2YXIgaW5pdGlhbFZhbHVlID0gdHJpbShmb3JtVGV4dEJveC52YWx1ZSkNCglpZiAoaW5pdGlhbFZhbHVlICE9ICIiKSB7DQoJCQ0KCQl2YXIgY29ycmVjdGVkVmFsdWUgPSBvcGVuQ2hlY2tTcGVsbGluZyhpbml0aWFsVmFsdWUpOw0KCQlpZiAoY29ycmVjdGVkVmFsdWUgPT0gLTEpIHsNCgkJCS8vdGV4dCB3YXMgYWxyZWFkeSBjb3JyZWN0DQoJCQlhbGVydCgiTm8gc3BlbGxpbmcgZXJyb3JzIGZvdW5kLiIpOw0KCQl9IGVsc2UgaWYgKGNvcnJlY3RlZFZhbHVlID09IC0yKSB7DQoJCQkvL3Byb2JsZW0gY3JlYXRpbmcgdGhlIG9sZSBvYmplY3QNCgkJCWFsZXJ0KCJQbGVhc2UgYmUgc3VyZSB0aGF0IE1pY3Jvc29mdCBPZmZpY2UgaXMgY29ycmVjdGx5IGluc3RhbGxlZCBhbmQgc2NyaXB0aW5nIG9mIEFjdGl2ZVggY29udHJvbHMgaXMgZW5hYmxlZCAoVG9vbHMgLT4gSW50ZXJuZXQgT3B0aW9ucyAtPiBTZWN1cml0eSAtPiBDdXN0b20gTGV2ZWwgLT4gW0VuYWJsZV0gSW5pdGlhbGl6ZSBhbmQgc2NyaXB0IEFjdGl2ZVggY29udHJvbHMgbm90IG1hcmtlZCBhcyBzYWZlKSIpOw0KCQl9IGVsc2Ugew0KCQkJY29ycmVjdGVkVmFsdWUgPSB0cmltKGNvcnJlY3RlZFZhbHVlKTsNCgkJCWlmIChjb3JyZWN0ZWRWYWx1ZSAhPSBpbml0aWFsVmFsdWUpIHsNCgkJCQkvL3NvbWV0aGluZyB3YXMgY2hhbmdlZA0KCQkJCXZhciBtYXggPSBmb3JtVGV4dEJveC5tYXhMZW5ndGg7DQoJCQkJaWYgKG1heCAhPSB1bmRlZmluZWQgJiYgY29ycmVjdGVkVmFsdWUubGVuZ3RoID4gbWF4KSB7DQoJCQkJCWZvcm1UZXh0Qm94LnZhbHVlID0gY29ycmVjdGVkVmFsdWUuc2xpY2UoMCwgbWF4KTsNCgkJCQkJYWxlcnQoIkNvcnJlY3RlZCB0ZXh0IHRydW5jYXRlZCBkdWUgdG8gc2l6ZSBsaW1pdGF0aW9ucyBmb3IgdGhlIGZpZWxkLiIpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCWZvcm1UZXh0Qm94LnZhbHVlID0gY29ycmVjdGVkVmFsdWU7DQoJCQkJCWFsZXJ0KCJTcGVsbGluZyBjb3JyZWN0ZWQuIik7DQoJCQkJfQ0KCQkJCS8vIENRMTk4MjMgLSBEaXJ0eSB0aGUgZm9ybSBpZiB0aGUgZm9ybVRleHRCb3ggd2FzIGNoYW5nZWQuDQoJCQkJLy8gQ1EyNzU1MyAtIEZvciB0aGUgcG9wLXVwIGZvcm0gd2UgbmVlZCB0byBjaGVjayB0aGF0IHRoZSBmb3JtIGlzIG5vdCBudWxsLg0KCQkJCWlmIChjdXJyZW50T21uaUZvcm0gIT0gbnVsbCAmJiB0eXBlb2YoY3VycmVudE9tbmlGb3JtKSAhPSAidW5kZWZpbmVkIiAmJiB0eXBlb2YoY3VycmVudE9tbmlGb3JtLmlzRGlydHkpICE9ICJ1bmRlZmluZWQiKSB7DQoJCQkJCWN1cnJlbnRPbW5pRm9ybS5pc0RpcnR5LnZhbHVlID0gJ3RydWUnOw0KCQkJCX0JDQoJCQl9IGVsc2Ugew0KCQkJCWZvcm1UZXh0Qm94LmZvY3VzKCk7DQoJCQkJLy90aGV5IGRpZG4ndCBtYWtlIGFueSBjaGFuZ2VzLi4NCgkJCQlhbGVydCgiTm8gY2hhbmdlcyBtYWRlLiIpOw0KCQkJfQ0KCQl9DQoJfSBlbHNlIHsNCgkJLy9ubyB0ZXh0IGVudGVyZWQuLg0KCQlhbGVydCgiUGxlYXNlIGVudGVyIHRleHQgdG8gc3BlbGwgY2hlY2suIik7DQoJCWZvcm1UZXh0Qm94LmZvY3VzKCk7DQoJfQ0KfQ0KDQovKiBkbyBzcGVsbGluZyBjaGVjayAqLw0KZnVuY3Rpb24gb3BlbkNoZWNrU3BlbGxpbmcoVGV4dFZhbHVlKSB7DQoJdmFyIHN0clJldHVyblZhbHVlID0gIiI7DQoJdmFyIGFwcFdvcmQ7DQoJdmFyIG9iakRvY29iamVjdDsNCg0KCXRyeSB7DQoJCWFwcFdvcmQgPSBuZXcgQWN0aXZlWE9iamVjdCgiV29yZC5BcHBsaWNhdGlvbiIpOw0KCX0gY2F0Y2goZXJyKSB7DQoJCS8vdW5hYmxlIHRvIGNyZWF0ZSB0aGUgb2JqZWN0LCBub3QgaW5zdGFsbGVkIG9yIHRoZXkgaGF2ZSBhY3RpdmV4IHNjcmlwdGluZyB0dXJuZWQgb2ZmDQoJCXN0clJldHVyblZhbHVlID0gLTI7DQoJCXJldHVybiBzdHJSZXR1cm5WYWx1ZTsNCgl9DQoJaWYgKGFwcFdvcmQuQ2hlY2tTcGVsbGluZyhUZXh0VmFsdWUpKSB7DQoJCS8vbm8gc3BlbGxpbmcgZXJyb3JzIGZvdW5kDQoJCXN0clJldHVyblZhbHVlID0gLTE7DQoJfSBlbHNlIHsNCgkJLy9wb3NpdGlvbiBpdCBvZmYgdGhlIHNjcmVlbiBzbyBpdCBkb2Vzbid0IGZsYXNoIHVwDQoJCWFwcFdvcmQuVG9wID0gLTMwMDA7DQoJCQ0KCQlhcHBXb3JkLldpbmRvd1N0YXRlID0gMjsNCgkJYXBwV29yZC5WaXNpYmxlID0gdHJ1ZTsNCgkJYXBwV29yZC5Eb2N1bWVudHMuQWRkKCk7DQoJCQ0KCQkvL21ha2Ugc3VyZSB0aGUgYXBwIGlzIGluIGZvY3VzDQoJCWFwcFdvcmQuQWN0aXZhdGUoKTsNCgkJDQoJCWFwcFdvcmQuU2VsZWN0aW9uLldob2xlU3RvcnkoKTsNCgkJYXBwV29yZC5TZWxlY3Rpb24uVHlwZVRleHQoVGV4dFZhbHVlKTsNCgkJYXBwV29yZC5BY3RpdmVEb2N1bWVudC5DaGVja1NwZWxsaW5nKCk7DQoJCWFwcFdvcmQuU2VsZWN0aW9uLldob2xlU3RvcnkoKTsNCgkJc3RyUmV0dXJuVmFsdWUgPSBhcHBXb3JkLlNlbGVjdGlvbi5UZXh0Ow0KCQkNCgl9DQoJLy9iZSBzdXJlIHRvIGRlc3Ryb3kgdGhlIHdvcmQgcmVmZXJlbmNlDQoJYXBwV29yZC5RdWl0KGZhbHNlKTsNCglhcHBXb3JkID0gbnVsbDsNCiAgICByZXR1cm4gc3RyUmV0dXJuVmFsdWU7DQp9DQoNCi8qKg0KKiBSZW1vdmVzIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHdoaXRlc3BhY2UgZnJvbSBhIHN0cmluZw0KKi8NCmZ1bmN0aW9uIHRyaW0oc3RyVGV4dCkgew0KCXZhciBuZXdUZXh0ID0gc3RyVGV4dDsNCgl3aGlsZSAoaXNXaGl0ZXNwYWNlKG5ld1RleHQuc3Vic3RyaW5nKDAsMSkpKSB7DQoJCW5ld1RleHQgPSBuZXdUZXh0LnN1YnN0cmluZygxLCBuZXdUZXh0Lmxlbmd0aCk7DQoJfQ0KCXdoaWxlIChpc1doaXRlc3BhY2UobmV3VGV4dC5zdWJzdHJpbmcobmV3VGV4dC5sZW5ndGgtMSxuZXdUZXh0Lmxlbmd0aCkpKSB7DQoJCW5ld1RleHQgPSBuZXdUZXh0LnN1YnN0cmluZygwLCBuZXdUZXh0Lmxlbmd0aC0xKTsNCgl9DQoJcmV0dXJuIG5ld1RleHQ7DQp9DQoNCi8qKg0KKiBSZXR1cm5zIHRydWUgaWYgdGhlIHBhcmFtZXRlciBpcyBhIHdoaXRlc3BhY2UgY2hhcmFjdGVyDQoqLw0KZnVuY3Rpb24gaXNXaGl0ZXNwYWNlKGNoYXIpIHsNCglpZiAoY2hhciA9PSAnICcgfHwgY2hhciA9PSAnXHInIHx8IGNoYXIgPT0gJ1xuJykgew0KCQlyZXR1cm4gdHJ1ZTsNCgl9IGVsc2Ugew0KCQlyZXR1cm4gZmFsc2U7DQoJfQ0KfQ==",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 309,
          "bodySize": 4472
        },
        "cache": {},
        "timings": {
          "send": 21,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8640"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.108-07:00",
        "time": 131,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/dwr/interface/needsGoalsManager.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 365,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "WWW-Authenticate",
              "value": "Negotiate"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1293"
            }
          ],
          "content": {
            "size": 1293,
            "compression": 0,
            "mimeType": "text/html",
            "text": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;} \r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;} \r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} \r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n <div class=\"content-container\"><fieldset>\r\n  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>\r\n  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>\r\n </fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 216,
          "bodySize": 1293
        },
        "cache": {},
        "timings": {
          "send": 21,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8635"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.240-07:00",
        "time": 12,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/dwr/interface/needsGoalsManager.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAABAAAAB7IIogsACwAvAAAADwAPACAAAABET0MxWlRVTTExNjg3ODFET0MxLldBLkxDTA=="
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 467,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html; charset=us-ascii"
            },
            {
              "name": "Server",
              "value": "Microsoft-HTTPAPI/2.0"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM TlRMTVNTUAACAAAACAAIADgAAAAFgomil+S3f2kXB5gAAAAAAAAAAJYAlgBAAAAABgGxHQAAAA9EAE8AQwAxAAIACABEAE8AQwAxAAEAGABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAEABYARABPAEMAMQAuAHcAYQAuAGwAYwBsAAMAMABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAuAEQATwBDADEALgB3AGEALgBsAGMAbAAFAAwAdwBhAC4AbABjAGwABwAIAIkS2cMENNQBAAAAAA=="
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "341"
            }
          ],
          "content": {
            "size": 341,
            "compression": 0,
            "mimeType": "text/html; charset=us-ascii",
            "text": "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\">\r\n<HTML><HEAD><TITLE>Not Authorized</TITLE>\r\n<META HTTP-EQUIV=\"Content-Type\" Content=\"text/html; charset=us-ascii\"></HEAD>\r\n<BODY><h2>Not Authorized</h2>\r\n<hr><p>HTTP Error 401. The requested resource requires user authentication.</p>\r\n</BODY></HTML>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 474,
          "bodySize": 341
        },
        "cache": {},
        "timings": {
          "send": 11,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8635"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.252-07:00",
        "time": 9,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/dwr/interface/needsGoalsManager.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAADAAAAGAAYAJwAAAAYABgAtAAAABYAFgBAAAAAKAAoAFYAAAAeAB4AfgAAAAAAAADMAAAABYKIokQATwBDADEALgBXAEEALgBMAEMATABzAHYAYwB3AGEAdQB0AGUAcwB0AHUAcwBlAHIAMAAxAGQAbwBjADEARABPAEMAMQBaAFQAVQBNADEAMQA2ADgANwA4ADEAxHhUBZK/sKIAAAAAAAAAAAAAAAAAAAAATYQEwKHDhXlwnlsjD7vD3yjFSMF507/q"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 659,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Transfer-Encoding",
              "value": "chunked"
            },
            {
              "name": "Content-Type",
              "value": "text/javascript; charset=utf-8"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            }
          ],
          "content": {
            "size": 800,
            "compression": 0,
            "mimeType": "text/javascript; charset=utf-8",
            "text": "\n// Provide a default path to dwr.engine\nif (dwr == null) var dwr = {};\nif (dwr.engine == null) dwr.engine = {};\nif (DWREngine == null) var DWREngine = dwr.engine;\n\nif (needsGoalsManager == null) var needsGoalsManager = {};\nneedsGoalsManager._path = '/omni/dwr';\nneedsGoalsManager.getDefaultStatusCode = function(p0, p1, callback) {\n  dwr.engine._execute(needsGoalsManager._path, 'needsGoalsManager', 'getDefaultStatusCode', p0, p1, callback);\n}\nneedsGoalsManager.getCaseManagementFlag = function(p0, callback) {\n  dwr.engine._execute(needsGoalsManager._path, 'needsGoalsManager', 'getCaseManagementFlag', p0, callback);\n}\nneedsGoalsManager.getNeedsGoalsFlag = function(p0, p1, callback) {\n  dwr.engine._execute(needsGoalsManager._path, 'needsGoalsManager', 'getNeedsGoalsFlag', p0, p1, callback);\n}\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 317,
          "bodySize": 800
        },
        "cache": {},
        "timings": {
          "send": 8,
          "wait": 0,
          "receive": 5
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8635"
      },
      {
        "pageRef": "page_39",
        "startedDateTime": "2018-08-14T12:26:57.108-07:00",
        "time": 123,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/scripts/advcor/needsGoals.js",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 365,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-javascript"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:34 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"049e97ada8ed31:0\""
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:56 GMT"
            },
            {
              "name": "Content-Length",
              "value": "5508"
            }
          ],
          "content": {
            "size": 19896,
            "compression": 0,
            "mimeType": "application/x-javascript",
            "text": "Ly8gU3VibWl0cyBhIGZvcm0gKHVzaW5nIHRoZSBvcHRpb25hbCBkYXRhIHBhcmFtZXRlcnMpLCBwdXR0aW5nIHRoZSByZXN1bHRzIGludG8gdGhlIHNwZWNpZmllZCBpZC4NCmZ1bmN0aW9uIGNtX25nX3N1Ym1pdChyZWZyZXNoUGxhbiwgcmVmcmVzaEZsYWdzLCBlbGVtLCByZXN1bHRJZCwgZGF0YSwgc2VyaWFsaXplZERhdGEpIHsNCg0KCS8vIGlkZW50aWZ5IHRoZSBmb3JtIGNvbnRhaW5pbmcgdGhpcyBpbnB1dCBlbGVtZW50IA0KCXZhciBmb3JtID0gJChlbGVtKS5jbG9zZXN0KCJmb3JtIik7DQoJdmFyIGlkID0gZm9ybS5hdHRyKCdpZCcpOw0KCXZhciBwYXJhbXMgPSBmb3JtLnNlcmlhbGl6ZSgpOw0KCWlmICgkKGVsZW0pLmlzKCdpbnB1dC5mb3JtLWJ1dHRvbicpKSB7DQoJCXBhcmFtcyA9IHBhcmFtcyArICImIiArIGVsZW0ubmFtZSArICI9IiArIGVsZW0udmFsdWU7DQoJfQ0KCWlmICgkLmlzUGxhaW5PYmplY3QoZGF0YSkpIHsNCgkJcGFyYW1zID0gcGFyYW1zICsgIiYiICsgJC5wYXJhbShkYXRhKTsNCgl9DQoJaWYgKHNlcmlhbGl6ZWREYXRhICE9IHVuZGVmaW5lZCkgew0KCQlwYXJhbXMgPSBwYXJhbXMgKyAiJiIgKyBzZXJpYWxpemVkRGF0YTsNCgl9DQoJDQoJLy8gZGlzYWJsZSBidXR0b25zIHdpdGhpbiB0aGlzIGZvcm0NCglmb3JtLmZpbmQoImlucHV0W3R5cGU9J3N1Ym1pdCddLCBpbnB1dFt0eXBlPSdidXR0b24nXSIpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7DQoJDQoJJC5hamF4KHsNCgkJdHlwZTogIlBPU1QiLA0KCQl1cmw6IGZvcm1bMF0uYWN0aW9uLA0KCQlkYXRhOiBwYXJhbXMsDQoJCWFzeW5jOiB0cnVlLA0KCQlzdWNjZXNzOiBmdW5jdGlvbihodG1sLCB0ZXh0U3RhdHVzLCBqcVhIUikgew0KCQkJJCgiIyIgKyByZXN1bHRJZCkuZW1wdHkoKS5hcHBlbmQoaHRtbCkuZW5hYmxlSXNEaXJ0eUxpc3RlbmVycygpOw0KCQkJDQoJCQkvLyBSZWZyZXNoIHRoZSBDYXNlIE1hbmFnZW1lbnQgZmxhZ3MNCgkJCWlmIChyZWZyZXNoRmxhZ3MpIHsNCgkJCQkkKCcjY21fc2VjdGlvbiAuZmxhZycpLnRyaWdnZXIoJ3JlZnJlc2gnKTsNCgkJCX0NCgkJCQ0KCQkJLy8gUmVmcmVzaCB0aGUgUHJvZ3Jlc3Npb24gUGxhbiB0aW1lIGxpbmUNCgkJCWlmIChyZWZyZXNoUGxhbikgew0KCQkJCWNtX25nX3BwX3JlZnJlc2hUaW1lbGluZSgpOw0KCQkJfQ0KCQl9LA0KCQllcnJvcjogZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7DQoJCQkkKCIjIiArIHJlc3VsdElkKS5lbXB0eSgpLmFwcGVuZChqcVhIUi5yZXNwb25zZVRleHQpOw0KCQl9LA0KCQljb21wbGV0ZTogZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMpIHsJDQoJCX0NCgl9KTsNCgkNCglyZXR1cm4gZmFsc2U7DQp9DQoNCmZ1bmN0aW9uIGNtX25nX2FkX3RvZ2dsZVNlY3Rpb24oY29sbGFwc2libGVJY29uLCB1cmwsIGNhbkVkaXQpIHsNCgl2YXIgaWNvbiA9ICQoY29sbGFwc2libGVJY29uKTsNCgl2YXIgc3Bpbm5lciA9IGljb24ucGFyZW50KCkucHJldigpOw0KCXZhciBuZXh0U2VjdGlvbiA9IGljb24ucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkubmV4dCgpLmNoaWxkcmVuKCJ0ZCIpOw0KCWlmIChpY29uLmhhc0NsYXNzKCdjb2xsYXBzZWQnKSkgew0KCQl2YXIgZG9jTmIgPSBpY29uLmRhdGEoImRvY25iIik7DQoJCXZhciBvZm5udHljZCA9IGljb24uZGF0YSgib2ZubnR5Y2QiKTsNCgkJb3BlbkRpc2NsYWltZXJEaWFsb2coZG9jTmIsIG9mbm50eWNkLCAiT1RIRVIiLCBmdW5jdGlvbigpIHsJCQkNCgkJCWNtX25nX2FkX3RvZ2dsZVNlY3Rpb25fZXhwYW5kKGNvbGxhcHNpYmxlSWNvbiwgdXJsLCBjYW5FZGl0KTsNCgkJfSk7DQoJfQ0KCWVsc2Ugew0KCQlpY29uLnJlbW92ZUNsYXNzKCdleHBhbmRlZCcpOw0KCQlpY29uLmFkZENsYXNzKCdjb2xsYXBzZWQnKTsNCgkJbmV4dFNlY3Rpb24uZW1wdHkoKTsNCgkJc3Bpbm5lci5hZGRDbGFzcygnaW52aXNpYmxlJyk7DQoJCQ0KCQkvLyBJZiBjb2xsYXBzaW5nLCBlbmFibGUgQXNtbnQgRG9tYWluIGZvcm0gZWxlbWVudHMsIG9ubHkgaWYgYWxsIHNlY3Rpb25zIGFyZSBjb2xsYXBzZWQsDQoJCS8vIGFuZCBvbmx5IGlmIHRoZSBjdXJyZW50IHVzZXIgaGFzIHBlcm1pc3Npb24uDQoJCWlmICgkKCIjY21fbmdfYWRfZm9ybSAuY29sbGFwc2libGUtaWNvbi5leHBhbmRlZCIpLnNpemUoKSA9PSAwICYmIGNhbkVkaXQpIHsJDQoJCQkvLyByZWZyZXNoIHRoZSBkb21haW4gc2VjdGlvbiBieSBjbGlja2luZyBDYW5jZWwuDQoJCQkkKCIjY21fbmdfYWRfZm9ybSA+IGZvcm0gaW5wdXRbbmFtZT0nY2FuY2VsJ10iKS5jbGljaygpOw0KCQl9DQoJfQ0KfQ0KDQpmdW5jdGlvbiBjbV9uZ19hZF90b2dnbGVTZWN0aW9uX2V4cGFuZChjb2xsYXBzaWJsZUljb24sIHVybCwgY2FuRWRpdCkgew0KCXZhciBpY29uID0gJChjb2xsYXBzaWJsZUljb24pOw0KCXZhciBzcGlubmVyID0gaWNvbi5wYXJlbnQoKS5wcmV2KCk7DQoJdmFyIG5leHRTZWN0aW9uID0gaWNvbi5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5uZXh0KCkuY2hpbGRyZW4oInRkIik7DQoJDQoJc3Bpbm5lci5yZW1vdmVDbGFzcygnaW52aXNpYmxlJyk7DQoJaWNvbi5yZW1vdmVDbGFzcygnY29sbGFwc2VkJyk7DQoJaWNvbi5hZGRDbGFzcygnZXhwYW5kZWQnKTsNCgkNCgkvLyBJZiBleHBhbmRpbmcsIGRpc2FibGUgYWxsIEFzbW50IERvbWFpbiBmb3JtIGVsZW1lbnRzIChDdXJyZW50IEZvY3VzLCBQcmlvcml0eSwgQmFycmllciwgU2F2ZS9DYW5jZWwsIGV0YykNCgkkKCIuY21fbmdfYWRfZm9ybSwgI2NtX25nX2FkX2Zvcm0gPiBmb3JtIGlucHV0IikucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTsNCgkkKCIuY21fbmdfYWRfYSIpLmFkZENsYXNzKCJkaXNhYmxlZCIpOw0KCQ0KCSQuYWpheCh7DQoJCXR5cGU6ICJHRVQiLA0KCQl1cmw6IHVybCwNCgkJYXN5bmM6IHRydWUsDQoJCXN1Y2Nlc3M6IGZ1bmN0aW9uKGh0bWwsIHRleHRTdGF0dXMsIGpxWEhSKSB7DQoJCQluZXh0U2VjdGlvbi5lbXB0eSgpLmh0bWwoaHRtbCkNCgkJfSwNCgkJZXJyb3I6IGZ1bmN0aW9uKGh0bWwsIHRleHRTdGF0dXMsIGpxWEhSKSB7DQoJCQluZXh0U2VjdGlvbi5lbXB0eSgpLmh0bWwoaHRtbCkNCgkJfSwNCgkJY29tcGxldGU6IGZ1bmN0aW9uKGh0bWwsIHRleHRTdGF0dXMsIGpxWEhSKSB7DQoJCQluZXh0U2VjdGlvbi5vZmYoJ2NsaWNrJyk7DQoJCQluZXh0U2VjdGlvbi5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkgeyBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgc2V0TGFzdEFjY2Vzc2VkKGljb24pOyB9KQ0KCQkJc2V0TGFzdEFjY2Vzc2VkKGljb24pOw0KCQkJc3Bpbm5lci5hZGRDbGFzcygnaW52aXNpYmxlJyk7DQoNCgkJCSQoJ2h0bWwsYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogaWNvbi5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5vZmZzZXQoKS50b3B9KTsNCgkJfQ0KCX0pOw0KfQ0KDQpmdW5jdGlvbiBjbV9uZ19vcGVuUHJpbnRXaW5kb3coZWxlbSkgew0KCXZhciBsb2NhdGlvblggPSAod2luZG93LnNjcmVlbi53aWR0aC8yKSAtICg0MDAgKyAxMCk7DQoJdmFyIGxvY2F0aW9uWSA9ICh3aW5kb3cuc2NyZWVuLmhlaWdodC8yKSAtICgzMDAgKyA1MCk7DQoJdmFyIHByaW50V2luZG93ID0gb3BlblBvcFVwUmV0dXJuV2luZG93KCIiLCJwcmludFdpbmRvdyIsImRpcmVjdG9yaWVzPW5vLGhlaWdodD01MjAsbGVmdD0iICsgbG9jYXRpb25YICsgIixsb2NhdGlvbj1ubyxtZW51YmFyPW5vLHJlc2l6YWJsZT15ZXMsc2NyZWVuWD0iICsgbG9jYXRpb25YICsgIixzY3JlZW5ZPSIgKyBsb2NhdGlvblkgKyAiLHNjcm9sbGJhcnM9eWVzLHN0YXR1cz1ubyx0b29sYmFyPW5vLHRvcD0iICsgbG9jYXRpb25ZICsgIix3aWR0aD0xMDQwIik7DQoJcHJpbnRXaW5kb3cuZm9jdXMoKTsNCgkNCgl2YXIgZm9ybSA9ICQoZWxlbSkuY2xvc2VzdCgiZm9ybSIpWzBdOw0KCWZvcm0udGFyZ2V0ID0gInByaW50V2luZG93IiArIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oInNlc3Npb25Ccm93c2VySWQiKTsNCgl2YXIgcHJpbnQgPSAkKCc8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSInICsgZWxlbS5uYW1lICsgJyIgdmFsdWU9IicgKyBlbGVtLnZhbHVlICsgJyIvPicpOw0KCXByaW50LmFwcGVuZFRvKCQoZm9ybSkpOw0KCWZvcm0uc3VibWl0KCk7DQoJcHJpbnQucmVtb3ZlKCk7DQoJZm9ybS50YXJnZXQgPSAiX3BhcmVudCI7DQoJDQoJcmV0dXJuIGZhbHNlOw0KfQ0KDQp2YXIgY21fbmdfcHBfc3VibWl0dGluZyA9IGZhbHNlOw0KDQovLyBTdWJtaXRzIHRoZSBQcm9ncmVzc2lvbiBQbGFuIEZvcm0uDQpmdW5jdGlvbiBjbV9uZ19wcF9zdWJtaXRGb3JtKCkgew0KCQ0KCWlmICh0aW1lbGluZSAhPSB1bmRlZmluZWQpIHsNCgkJLy8gR2V0IHRoZSBmb3JtIHRvIHN1Ym1pdA0KCQl2YXIgY21Gb3JtID0gJCgiI2NtX25nX3BwX2Zvcm0iKTsNCgkJDQoJCS8vIGRpc2FibGUgYnV0dG9ucyB3aXRoaW4gdGhpcyBmb3JtDQoJCWNtRm9ybS5maW5kKCJpbnB1dFt0eXBlPSdzdWJtaXQnXSIpLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7DQoJDQoJCS8vIFN0b3JlIHRoZSB0aW1lbGluZSBzdGFydCBhbmQgZW5kIGRhdGUvdGltZXMgZm9yIHN1Ym1pc3Npb24gc28gd2UgY29tZSBiYWNrIHRvIHdoZXJlDQoJCS8vIHdlIGxlZnQgb24gdGhlIHRpbWVsaW5lDQoJCXZhciByYW5nZSA9IHRpbWVsaW5lLmdldFdpbmRvdygpOw0KCQl2YXIgc3RhcnREYXRlVGltZVN0cmluZyA9IHJhbmdlLnN0YXJ0Ow0KCQl2YXIgZW5kRGF0ZVRpbWVTdHJpbmcgPSByYW5nZS5lbmQ7DQoJCXZhciB0aW1lbGluZURpdkhlaWdodFN0cmluZyA9ICQoIiN0aW1lbGluZSIpLmhlaWdodCgpOw0KCQkkKCcjY21fbmdfcHBfdGltZWxpbmVTdGFydCcpLnZhbChzdGFydERhdGVUaW1lU3RyaW5nKTsNCgkJJCgnI2NtX25nX3BwX3RpbWVsaW5lRW5kJykudmFsKGVuZERhdGVUaW1lU3RyaW5nKTsNCgkJJCgnI2NtX25nX3BwX3RpbWVsaW5lRGl2SGVpZ2h0JykudmFsKHRpbWVsaW5lRGl2SGVpZ2h0U3RyaW5nKTsNCgkNCgkJLy8gU3VibWl0IHRoZSBmb3JtDQoJCXZhciBjbUZvcm0gPSAkKCIjY21fbmdfcHBfZm9ybSIpOw0KCQkkLnBvc3QoY21Gb3JtWzBdLmFjdGlvbiwgY21Gb3JtLnNlcmlhbGl6ZSgpLCBmdW5jdGlvbihodG1sKSB7DQoJCQkkKCIjY21fbmdfcHBfZnMiKS5lbXB0eSgpLmFwcGVuZChodG1sKTsNCgkJCWNtX25nX3BwX3N1Ym1pdHRpbmcgPSBmYWxzZTsNCgkJfSk7DQoJfQ0KfQ0KDQpmdW5jdGlvbiBjbV9uZ19wcF9yZWZyZXNoVGltZWxpbmUoKSB7DQoJJCgnI2NtX25nX3BwX3BhZ2VNb2RlJykudmFsKCdWaWV3VGltZWxpbmVNb2RlJyk7DQoJY21fbmdfcHBfc3VibWl0Rm9ybSgpOw0KfQ0KDQovLyBTdWJtaXRzIFByb2dyZXNzaW9uIFBsYW4gdG8gdmlldy9lZGl0IGFuIGV4aXN0aW5nIGVudGl0eSAoQ3VzdG9keSwgUHJvZ3JhbSwgb3IgTm90ZSkuDQpmdW5jdGlvbiBjbV9uZ19wcF92aWV3RWRpdEVudGl0eShzdWJtaXRBY3Rpb24sIGVudGl0eVR5cGUsIGVudGl0eUlkLCBwYWdlTW9kZSkgew0KCS8vIE1ha2Ugc3VyZSB3ZSdyZSBpbiBWaWV3VGltZWxpbmVNb2RlIGFuZCB3ZSdyZSBub3QgdGhlbiBqdXN0IHJldHVybg0KCS8vaWYgKCQoJyNjbV9uZ19wcF9wYWdlTW9kZScpLnZhbCgpICE9PSAnVmlld1RpbWVsaW5lTW9kZScpIHsNCgkvLwlyZXR1cm47DQoJLy99DQoJDQoJLy8gc2hvcnQtY2lyY3VpdCB0byBwcmV2ZW50IGRvdWJsZSBjbGlja2luZyBvZiBidXR0b25zIG9yIGxpbmtzDQoJaWYgKGNtX25nX3BwX3N1Ym1pdHRpbmcpIHsNCgkJcmV0dXJuOw0KCX0NCgljbV9uZ19wcF9zdWJtaXR0aW5nID0gdHJ1ZTsNCgkNCgkvLyBTZXQgaGlkZGVuIGZpZWxkcyBmb3IgYWN0aW9uLCBlbnRpdHkgYW5kIHBhZ2UgbW9kZQ0KCSQoJyNjbV9uZ19wcF9zdWJtaXRBY3Rpb24nKS52YWwoc3VibWl0QWN0aW9uKTsNCgkkKCcjY21fbmdfcHBfZW50aXR5VHlwZScpLnZhbChlbnRpdHlUeXBlKTsNCgkkKCcjY21fbmdfcHBfZW50aXR5SWQnKS52YWwoZW50aXR5SWQpOw0KCSQoJyNjbV9uZ19wcF9wYWdlTW9kZScpLnZhbChwYWdlTW9kZSk7DQoJDQoJLy8gU3VibWl0IHRoZSBmb3JtDQoJY21fbmdfcHBfc3VibWl0Rm9ybSgpOw0KCQ0KCS8vIEdvIHRvIHRoZSBkYXRhIGVudHJ5IHNlY3Rpb24NCgkkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7c2Nyb2xsVG9wOiAkKCIjY21fbmdfcHBfZW50aXR5X2ZzIikub2Zmc2V0KCkudG9wfSwgNTAwKTsNCn0NCg0KLy8gU3VibWl0cyBQcm9ncmVzc2lvbiBQbGFuIHRvIGFsbG93IHVzZXIgdG8gYWRkIG5ldyBlbnRpdHkgKEN1c3RvZHksIFByb2dyYW0gb3IgRW50aXR5KQ0KZnVuY3Rpb24gY21fbmdfcHBfYWRkTmV3RW50aXR5KHN1Ym1pdEFjdGlvbiwgZW50aXR5VHlwZSwgcGFnZU1vZGUpIHsNCgkvLyBNYWtlIHN1cmUgd2UncmUgaW4gVmlld1RpbWVsaW5lTW9kZSBhbmQgd2UncmUgbm90IHRoZW4ganVzdCByZXR1cm4NCglpZiAoJCgnI2NtX25nX3BwX3BhZ2VNb2RlJykudmFsKCkgIT09ICdWaWV3VGltZWxpbmVNb2RlJykgew0KCQlyZXR1cm47DQoJfQ0KCQ0KCS8vIFNldCBoaWRkZW4gZmllbGRzIGZvciBhY3Rpb24sIGVudGl0eSBhbmQgcGFnZSBtb2RlDQoJJCgnI2NtX25nX3BwX3N1Ym1pdEFjdGlvbicpLnZhbChzdWJtaXRBY3Rpb24pOw0KCSQoJyNjbV9uZ19wcF9lbnRpdHlUeXBlJykudmFsKGVudGl0eVR5cGUpOw0KCSQoJyNjbV9uZ19wcF9wYWdlTW9kZScpLnZhbChwYWdlTW9kZSk7DQoNCgkvLyBTdWJtaXQgdGhlIGZvcm0NCgljbV9uZ19wcF9zdWJtaXRGb3JtKCk7DQoJDQoJLy8gU2Nyb2xsIGRvd24gdG8gdGhlIGRhdGEgZW50cnkgc2VjdGlvbg0KCSQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtzY3JvbGxUb3A6ICQoIiNjbV9uZ19wcF9lbnRpdHlfZnMiKS5vZmZzZXQoKS50b3B9LCA1MDApOw0KfQ0KDQovLyBBc2tzIHVzZXIgaWYgdGhleSBhcmUgc3VyZSBhbmQgaWYgc28gc3VibWl0cyBmb3JtIHRvIGRlbGV0ZSBlbnRpdHkNCmZ1bmN0aW9uIGNtX25nX3BwX2RlbGV0ZUVudGl0eShzdWJtaXRBY3Rpb24sIGVudGl0eVR5cGUsIGVudGl0eUlkKSB7DQoJLy8gV29yZCBhIGNvbmZpcm1hdGlvbiBxdWVzdGlvbiB0aGF0IGFwcHJvcHJpYXRlIGZvciB0aGUgZW50aXR5DQoJdmFyIGNvbmZpcm1hdGlvblF1ZXN0aW9uID0gIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhpcyAiOw0KCWlmIChlbnRpdHlUeXBlID09PSAnQ3VzdG9keUVudGl0eVR5cGUnKSB7DQoJCWNvbmZpcm1hdGlvblF1ZXN0aW9uID0gY29uZmlybWF0aW9uUXVlc3Rpb24gKyAicGxhbm5lZCBjdXN0b2R5PyI7DQoJfSBlbHNlIGlmIChlbnRpdHlUeXBlID09PSAnUHJvZ3JhbUVudGl0eVR5cGUnKSB7DQoJCWNvbmZpcm1hdGlvblF1ZXN0aW9uID0gY29uZmlybWF0aW9uUXVlc3Rpb24gKyAicGxhbm5lZCBwcm9ncmFtPyI7DQoJfSBlbHNlIGlmIChlbnRpdHlUeXBlID09PSAnTm90ZUVudGl0eVR5cGUnKSB7DQoJCWNvbmZpcm1hdGlvblF1ZXN0aW9uID0gY29uZmlybWF0aW9uUXVlc3Rpb24gKyAicGxhbm5pbmcgbm90ZT8iOw0KCX0NCg0KCS8vIENvbmZpcm0gd2l0aCB1c2VyIGJlZm9yZSBzdWJtaXR0aW5nDQoJaWYgKGNvbmZpcm0oY29uZmlybWF0aW9uUXVlc3Rpb24pKXsNCgkJLy8gU2V0IGhpZGRlbiBmaWVsZHMgZm9yIGFjdGlvbiwgZW50aXR5IGFuZCBwYWdlIG1vZGUNCgkJJCgnI2NtX25nX3BwX3N1Ym1pdEFjdGlvbicpLnZhbChzdWJtaXRBY3Rpb24pOw0KCQkkKCcjY21fbmdfcHBfZW50aXR5VHlwZScpLnZhbChlbnRpdHlUeXBlKTsNCgkJJCgnI2NtX25nX3BwX2VudGl0eUlkJykudmFsKGVudGl0eUlkKTsNCg0KCQkvLyBTdWJtaXQgdGhlIGZvcm0NCgkJY21fbmdfcHBfc3VibWl0Rm9ybSgpOw0KCQkNCgkJLy8gU2Nyb2xsIGJhY2sgdXAgdG8gdGhlIHByb2dyZXNzaW9uIHBsYW4NCgkJJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogJCgiI2NtX25nX3BwX2Zvcm0iKS5vZmZzZXQoKS50b3B9LCAwKTsNCgl9DQp9DQoNCi8vIFN1Ym1pdHMgUHJvZ3Jlc3Npb24gUGxhbiB0byBzYXZlIGFuIGVudGl0eSAoQ3VzdG9keSwgUHJvZ3JhbSBvciBFbnRpdHkpLiBFbnRpdHkgbWF5IGJlIGVpdGhlciBuZXcgb3IgZXhpc3RpbmcuDQpmdW5jdGlvbiBjbV9uZ19wcF9zYXZlQWRkTW9kaWZ5KCkgew0KCS8vIHNob3J0LWNpcmN1aXQgdG8gcHJldmVudCBkb3VibGUgY2xpY2tpbmcgb2YgYnV0dG9ucyBvciBsaW5rcw0KCWlmIChjbV9uZ19wcF9zdWJtaXR0aW5nKSB7DQoJCXJldHVybjsNCgl9DQoJY21fbmdfcHBfc3VibWl0dGluZyA9IHRydWU7DQoJDQoJLy8gU2V0IHRoZSBzdWJtaXQgYWN0aW9uIHRvICJTYXZlRW50aXR5Ig0KCSQoJyNjbV9uZ19wcF9zdWJtaXRBY3Rpb24nKS52YWwoJ1NhdmVFbnRpdHknKTsNCgkNCgkvLyBTdWJtaXQgdGhlIGZvcm0NCgljbV9uZ19wcF9zdWJtaXRGb3JtKCk7DQoJCQ0KCS8vIFNjcm9sbCBiYWNrIHVwIHRvIHRoZSBwcm9ncmVzc2lvbiBwbGFuDQoJaWYgKCQoJyNjbV9uZ19wcF9wYWdlTW9kZScpLnZhbCgpID09PSAnVmlld1RpbWVsaW5lTW9kZScpIHsNCgkJJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogJCgiI2NtX25nX3BwX2Zvcm0iKS5vZmZzZXQoKS50b3B9LCAwKTsNCgl9DQp9DQoNCi8vIFN1Ym1pdHMgUHJvZ3Jlc3Npb24gUGxhbiB0byBjYW5jZWwgYWRkaW5nIG9yIGVkaXRpbmcgYW4gRW50aXR5IGFuZCBjbG9zZSBkYXRhIGVudHJ5IGZvcm0NCmZ1bmN0aW9uIGNtX25nX3BwX2NhbmNlbEFkZE1vZGlmeSgpIHsNCgkvLyBDaGVjayBpZiBhbnl0aGluZyBoYXMgY2hhbmdlZCBhbmQgaWYgc28gY29uZmlybSBjYW5jZWwgd2l0aCB1c2VyDQoJdmFyIGlzRGlydHkgPSBmYWxzZTsNCgkkKCIjY21fbmdfcHBfZm9ybSBpbnB1dFtuYW1lPSdpc0RpcnR5J10sICNjbV9uZ19wcF9mb3JtIGlucHV0W25hbWU9J2lzRGlydHknXSIpLmVhY2goZnVuY3Rpb24oKSB7DQoJCWlmICh0aGlzLnZhbHVlID09PSAndHJ1ZScpIGlzRGlydHkgPSB0cnVlOw0KCX0pOw0KCWlmIChpc0RpcnR5KSB7DQoJCWlmICghY29uZmlybSgiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNhbmNlbCB5b3VyIGNoYW5nZXM/IikpIHsNCgkJCXJldHVybjsNCgkJfQ0KCX0NCgkNCgkvLyBTZXQgaGlkZGVuIGZpZWxkcyBmb3IgYWN0aW9uLCBlbnRpdHkgYW5kIHBhZ2UgbW9kZQ0KCSQoJyNjbV9uZ19wcF9zdWJtaXRBY3Rpb24nKS52YWwoJ1VOS05PV04nKTsNCgkkKCcjY21fbmdfcHBfZW50aXR5VHlwZScpLnZhbCgnVU5LTk9XTicpOw0KCSQoJyNjbV9uZ19wcF9wYWdlTW9kZScpLnZhbCgnVmlld1RpbWVsaW5lTW9kZScpOw0KCQ0KCS8vIFN1Ym1pdCB0aGUgZm9ybSB0byBjYW5jZWwNCgljbV9uZ19wcF9zdWJtaXRGb3JtKCk7DQoJCQ0KCS8vIFNjcm9sbCBiYWNrIHVwIHRvIHRoZSBwcm9ncmVzc2lvbiBwbGFuDQoJJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogJCgiI2NtX25nX3BwX2Zvcm0iKS5vZmZzZXQoKS50b3B9LCAwKTsNCn0NCg0KZnVuY3Rpb24gb3BlblBvcHVwKHVybCwgd2lkdGgsIGhlaWdodCwgY2FsbGJhY2spIHsNCgl2YXIgcmV0VmFsID0gb3Blbk1vZGFsRGlhbG9nKHVybCwgd2lkdGgsIGhlaWdodCk7DQoJaWYgKGNhbGxiYWNrKSBjYWxsYmFjay5jYWxsKCk7DQp9DQoNCi8vIE9iamVjdGl2ZSBGcmVxdWVuY3kgcmFkaW8gZ3JvdXAgb25DaGFuZ2UgZXZlbnQuICANCi8vIElmIHJhZGlvIGdyb3VwIGlzIGRlc2VsZWN0ZWQsIGhpZGUgcmVjdXJyZW5jZSBzZWN0aW9uLg0KLy8gSWYgcmFkaW8gdmFsdWUgPT0gMSwgc2hvdyB3ZWVrIExPVg0KLy8gSWYgcmFkaW8gdmFsdWUgPT0gMiwgc2hvdyBtb250aCBMT1YNCmZ1bmN0aW9uIGNtX25nX3N0cm5vYkZyZXFUeXBOYk9uQ2hhbmdlKGVsZW0pIHsNCgl2YXIgb2ZubnR5Q2QgPSBlbGVtLmlkLnJlcGxhY2UoL2NtX25nXyhcZCspX29iamN0dnMuKi8sICIkMSIpOw0KCXZhciBpbmRleCA9IGVsZW0uaWQucmVwbGFjZSgvLipvYmpjdHZzXyhcZCspX3N0cm5vYi4qLywgIiQxIik7DQoJdmFyIHZhbHVlID0gKGVsZW0udHlwZSA9PSAncmFkaW8nKSA/IGVsZW0udmFsdWUgOiAwOw0KCXZhciBjaGVja2VkID0gKGVsZW0udHlwZSA9PSAncmFkaW8nKSA/IGVsZW0uY2hlY2tlZCA6IGZhbHNlOw0KCWlmIChjaGVja2VkKSB7DQoJCS8vIHRvZ2dsZSBkaXNwbGF5IG9mIHJlY3VycmVuY2UgTE9WIC0gYmFzZWQgb24gcmFkaW8gc2VsZWN0aW9uLCBkaXNwbGF5IHRoZSBhcHByb3ByaWF0ZSBMT1YNCgkJJCgiI2NtX25nXyIrb2ZubnR5Q2QrIl9vYmpjdHZzIHRyLnJvdyIraW5kZXgrIiBzcGFuLnJwbXNjb0NkIikuc2V0RGlzcGxheWVkKHZhbHVlID09IDEpOw0KCQkkKCIjY21fbmdfIitvZm5udHlDZCsiX29iamN0dnMgdHIucm93IitpbmRleCsiIHNwYW4ucnBtc2NkQ2QiKS5zZXREaXNwbGF5ZWQodmFsdWUgPT0gMik7DQoJfQ0KCWVsc2Ugew0KCQkkKCIjY21fbmdfIitvZm5udHlDZCsiX29iamN0dnMgdHIucm93IitpbmRleCsiIGlucHV0W3R5cGU9J3JhZGlvJ10iKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpOw0KCX0NCgkNCgkvLyBjbGVhciBkYXkgTE9WcyBhbmQgY2hlY2tib3hlcw0KCSQoIiNjbV9uZ18iK29mbm50eUNkKyJfb2JqY3R2cyB0ci5yb3ciK2luZGV4KyIgc2VsZWN0IikudmFsKCcnKQ0KCSQoIiNjbV9uZ18iK29mbm50eUNkKyJfb2JqY3R2cyB0ci5yb3ciK2luZGV4KyIgaW5wdXRbdHlwZT0nY2hlY2tib3gnXSIpLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSk7DQoJDQoJLy8gdG9nZ2xlIHZpc2liaWxpdHkgb2YgcmVjdXJyZW5jZSB0YWJsZSAtIGlmIHJhZGlvIGlzIHVuY2hlY2tlZCwgaGlkZSB0aGUgZGF5cyBvZiB0aGUgd2Vla3MNCgkkKCIjY21fbmdfIitvZm5udHlDZCsiX29iamN0dnMgdHIucm93IitpbmRleCsiIHNwYW4uZGF5cyIpLnNldFZpc2libGUoY2hlY2tlZCAmJiAodmFsdWUgPT0gMSB8fCB2YWx1ZSA9PSAyKSk7DQoJJCgiI2NtX25nXyIrb2ZubnR5Q2QrIl9vYmpjdHZzIHRyLnJvdyIraW5kZXgrIiB0YWJsZSIpLnNldFZpc2libGUoY2hlY2tlZCAmJiAodmFsdWUgPT0gMSB8fCB2YWx1ZSA9PSAyKSk7DQp9DQoNCi8qKg0KICogT3BlbnMgdXAgYSBkZXRhaWxzIHJvdyBpbiB0aGUgT2JqZWN0aXZlIENvbnNlcXVlbmNlIFN1bW1hcnkgdGFibGUuDQogKiBAcGFyYW0gbGluayB0aGUgRGV0YWlscyBocmVmIGxpbmsgZm9yIHJlZmVyZW5jZQ0KICogQHBhcmFtIHN0cm5vYklkIHRoZSBwayBvZiB0aGUgVGJTdHJuZ3JOZHNPYmpjdHYgcmVjb3JkLg0KICogQHBhcmFtIGV4cGFuZCBhIGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGUgZGV0YWlscyBzaG91bGQgZXhwYW5kIG9yIGNvbGxhcHNlLg0KICovDQpmdW5jdGlvbiBzYV9vY19vYmpjdHZzRGV0YWlscyhsaW5rLCBzdHJub2JJZCkgew0KCXZhciBzZWxlY3RlZFJvdyA9ICQobGluaykuY2xvc2VzdCgndHInKTsNCgl2YXIgbmV4dFJvdyA9IHNlbGVjdGVkUm93Lm5leHQoKS5maW5kKCd0ZCcpOw0KCW5leHRSb3cuYXR0cignaWQnLCAnc2Ffb2Nfc3Rybm9iSWRfJytzdHJub2JJZCk7DQoJaWYgKGxpbmsuaW5uZXJIVE1MID09PSAnRGV0YWlscycpIHsNCgkJJCgiI3NhX29jX3NlY3Rpb24gYSIpLmFkZENsYXNzKCdkaXNhYmxlZCcpOyAvLyBkaXNhYmxlIGFsbCBocmVmIGluIHRoZSBkaXNwbGF5dGFnIHRhYmxlDQoJCSQobGluaykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7IC8vIGV4Y2VwdCB0aGlzICJIaWRlIiBvbmUNCgkJJCgiI3NhX29jX3NlY3Rpb24gYS5yZWZyZXNoIikucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7IC8vIGV4Y2VwdCB0aGUgcmVmcmVzaCBsaW5rDQoJCSQoIiNzYV9vY19vYmpjdHZzIikubmV4dCgpLmZpbmQoInNlbGVjdCIpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7DQoJCQ0KCQkvLyBlbmFibGUgc3Bpbm5lcg0KCQl2YXIgc3Bpbm5lciA9ICQobGluaykucHJldigpOw0KCQlzcGlubmVyLmFkZENsYXNzKHNlbGVjdGVkUm93LmF0dHIoJ2NsYXNzJykpOyAvLyB0aGVtZSBzcGlubmVyIGZvciBldmVuIG9yIG9kZCByb3cJDQoJCXNwaW5uZXIuYWRkQ2xhc3MoJ3NwaW5uZXItaWNvbicpOw0KCQkNCgkJLy8gbG9hZCBkeW5hbWljIGNvbnRlbnQNCgkJbmV4dFJvdy5sb2FkKCIvb21uaS9hZHZjb3IvbmVlZHMvY25zcWNBcHJ2bC5odG0/c3Rybm9iSWQ9IitzdHJub2JJZCwNCgkJCS8vIG9uIGNvbXBsZXRlIGZ1bmN0aW9uDQoJCQlmdW5jdGlvbiggcmVzcG9uc2UsIHN0YXR1cywgeGhyICkgew0KCQkJCWlmICggc3RhdHVzID09ICJlcnJvciIgKSB7IG5leHRSb3cuaHRtbCggcmVzcG9uc2UgKTsgfQ0KCQkJCXNwaW5uZXIucmVtb3ZlQ2xhc3MoKTsNCgkJCQlsaW5rLmlubmVySFRNTCA9ICdIaWRlJzsNCgkJCX0NCgkJKTsNCgl9DQoJZWxzZSB7DQoJCS8vIFJlZnJlc2ggdGhlIGRpc3BsYXl0YWcgbGlzdA0KCQkkKCIjc2Ffb2Nfc2VjdGlvbiBhLnJlZnJlc2giKS5jbGljaygpOw0KCX0NCn0NCg0KZnVuY3Rpb24gc2Ffb2Nfc3VibWl0KGVsZW0sIHJlc3VsdElkKSB7DQoJdmFyIGZvcm0gPSAkKGVsZW0pLmNsb3Nlc3QoImZvcm0iKTsNCgl2YXIgcGFyYW1zID0gZm9ybS5zZXJpYWxpemUoKTsNCglpZiAoJChlbGVtKS5pcygnaW5wdXQuZm9ybS1idXR0b24nKSkgew0KCQlwYXJhbXMgPSBwYXJhbXMgKyAiJiIgKyBlbGVtLm5hbWUgKyAiPSIgKyBlbGVtLnZhbHVlOw0KCX0NCgkvLyBkaXNhYmxlIGJ1dHRvbnMgd2l0aGluIHRoaXMgZm9ybQ0KCWZvcm0uZmluZCgiaW5wdXRbdHlwZT0nc3VibWl0J10iKS5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpOw0KDQoJJC5hamF4KHsNCgkJdHlwZTogIlBPU1QiLA0KCQl1cmw6IGZvcm1bMF0uYWN0aW9uLA0KCQlkYXRhOiBwYXJhbXMsDQoJCWFzeW5jOiB0cnVlLA0KCQlzdWNjZXNzOiBmdW5jdGlvbihodG1sLCB0ZXh0U3RhdHVzLCBqcVhIUikgew0KCQkJJCgiIyIgKyByZXN1bHRJZCkuZW1wdHkoKS5hcHBlbmQoaHRtbCkuZW5hYmxlSXNEaXJ0eUxpc3RlbmVycygpOw0KCQkJDQoJCQlpZiAoJCgiI3NhX29jX3NlY3Rpb24gLm9tbmlNZXNzYWdlcyIpLnNpemUoKSA+IDEpIHsJCQkJDQoJCQkJJCgiI3NhX29jX3NlY3Rpb24gLm9tbmlNZXNzYWdlcyIpWzBdLmlubmVySFRNTCA9ICQoIiNzYV9vY19zZWN0aW9uIC5vbW5pTWVzc2FnZXMiKVsxXS5pbm5lckhUTUw7DQoJCQl9DQoJCQkNCgkJCS8vIFJlZnJlc2ggdGhlIENhc2UgTWFuYWdlbWVudCBmbGFncw0KCQkJJCgnI2NtX3NlY3Rpb24gLmZsYWcnKS50cmlnZ2VyKCdyZWZyZXNoJyk7DQoJCX0sDQoJCWVycm9yOiBmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHsNCgkJCSQoIiMiICsgcmVzdWx0SWQpLmVtcHR5KCkuYXBwZW5kKGpxWEhSLnJlc3BvbnNlVGV4dCk7DQoJCX0sDQoJCWNvbXBsZXRlOiBmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cykgewkNCgkJfQ0KCX0pOw0KCQ0KCXJldHVybiBmYWxzZTsNCn0NCg0KLyoqDQogKiBXaGVuIGVpdGhlciB0aGUgUG9zaXRpdmUgb3IgTmVnYXRpdmUgT2JqZWN0aXZlIENvbnNlcXVlbmNlIFR5cGUgY2hhbmdlcywgdGhlIENvbnNlcXVlbmNlIFN0YXR1cyBtdXN0IGRlZmF1bHQNCiAqIHBlciB0aGUgZ2l2ZW4gbGV2ZWwgYW5kIHRoZSBSZXF1ZXN0IFN0YXR1cyBtdXN0IHJlc2V0Lg0KICogQHBhcmFtIG9mbm50eUNkIGRvbWFpbiBjb2RlIA0KICogQHBhcmFtIGluZGV4IHJvdyBpbmRleCBvZiB0aGUgb2JqZWN0aXZlDQogKi8NCmZ1bmN0aW9uIGNvbnNlcXVlbmNlT25DaGFuZ2Uob2ZubnR5Q2QsIGluZGV4KSB7DQoJLy8gcmVzZXQgUmVxdWVzdCBTdGF0dXMgdG8gTm9uZQ0KCSQoJyNjbV9uZ18nICsgb2ZubnR5Q2QgKyAnX29iamN0dnNfJyArIGluZGV4ICsgJ19vbmVvcnFDZCcpLnZhbCgnMScpOyANCgkkKCcjY21fbmdfJyArIG9mbm50eUNkICsgJ19vYmpjdHZzXycgKyBpbmRleCArICdfb25lb3JxQ2RMYmwnKS5odG1sKCdOb25lJyk7DQoNCgl2YXIgcG9zU3RybmNuQ2QgPSAkKCcjY21fbmdfJyArIG9mbm50eUNkICsgJ19vYmpjdHZzXycgKyBpbmRleCArICdfc3Rybm9iUHN0dlN0cm5jbkNkJykudmFsKCk7IA0KCXZhciBuZWdTdHJuY25DZCA9ICQoJyNjbV9uZ18nICsgb2ZubnR5Q2QgKyAnX29iamN0dnNfJyArIGluZGV4ICsgJ19zdHJub2JOZ3R2U3RybmNuQ2QnKS52YWwoKTsgDQoJDQoJLy8gZGVmYXVsdCBDb25zZXF1ZW5jZSBTdGF0dXMgdG8gUmV2aWV3ZWQgb3IgUmVxdWVzdGVkIGRlcGVuZGluZyBvbiBsZXZlbA0KCW5lZWRzR29hbHNNYW5hZ2VyLmdldERlZmF1bHRTdGF0dXNDb2RlKHBvc1N0cm5jbkNkLCBuZWdTdHJuY25DZCwgeyANCgkJY2FsbGJhY2s6IGZ1bmN0aW9uKHN0cm5jc0NkKSB7IA0KCQkJJCgnI2NtX25nXycgKyBvZm5udHlDZCArICdfb2JqY3R2c18nICsgaW5kZXggKyAnX3N0cm5vYlBzdHZTdHJuY3NDZCcpLnZhbChzdHJuY3NDZCk7IA0KCQkJJCgnI2NtX25nXycgKyBvZm5udHlDZCArICdfb2JqY3R2c18nICsgaW5kZXggKyAnX3N0cm5vYk5ndHZTdHJuY3NDZCcpLnZhbChzdHJuY3NDZCk7IA0KCQl9LCBhc3luYzp0cnVlIA0KCX0pOw0KfQ0KDQovLyBDUTM5NDE2IC0gYWRkIGEgY29uZmlybSBkaWFsb2cgIkV4aXQgd2l0aG91dCBzYXZpbmc/IiB3aGVuIHByZXNzaW5nIENhbmNlbCB0byBjbGVhciB0aGUgZm9ybSAod2hpY2ggaGFzIG5vdGhpbmcgdG8gZG8gd2l0aCBleGl0aW5nKS4gDQpmdW5jdGlvbiBleGl0V2l0aG91dFNhdmluZygpIHsNCglpZiAoJCgiI2NtX25nX2FkX2Zvcm0iKS5maW5kKCJpbnB1dFtuYW1lPSdpc0RpcnR5J10iKS52YWwoKSA9PT0gInRydWUiICYmIHdpbmRvdy5jb25maXJtKCJFeGl0IHdpdGhvdXQgc2F2aW5nPyIpKSB7DQoJCXJldHVybiB0cnVlOw0KCX0gZWxzZSB7DQoJCXJldHVybiBmYWxzZTsNCgl9DQp9DQo=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 309,
          "bodySize": 19896
        },
        "cache": {},
        "timings": {
          "send": 8,
          "wait": 0,
          "receive": 7
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8638"
      },
      {
        "pageRef": "page_66",
        "startedDateTime": "2018-08-14T12:26:57.629-07:00",
        "time": 3,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/advcor/csPln/offenderCPHeader.htm?persCallback=&persCheckIsDirty=true&inctvCallback=&inctvCheckIsDirty=true&ccOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&waOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&scOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&readOnly=false&isPrint=&nrtvHstryPage=",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [
            {
              "name": "persCallback",
              "value": ""
            },
            {
              "name": "persCheckIsDirty",
              "value": "true"
            },
            {
              "name": "inctvCallback",
              "value": ""
            },
            {
              "name": "inctvCheckIsDirty",
              "value": "true"
            },
            {
              "name": "ccOnClick",
              "value": "%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B"
            },
            {
              "name": "waOnClick",
              "value": "%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B"
            },
            {
              "name": "scOnClick",
              "value": "%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B"
            },
            {
              "name": "readOnly",
              "value": "false"
            },
            {
              "name": "isPrint",
              "value": ""
            },
            {
              "name": "nrtvHstryPage",
              "value": ""
            }
          ],
          "headersSize": 708,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "WWW-Authenticate",
              "value": "Negotiate"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1293"
            }
          ],
          "content": {
            "size": 1293,
            "compression": 0,
            "mimeType": "text/html",
            "text": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;} \r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;} \r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} \r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n <div class=\"content-container\"><fieldset>\r\n  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>\r\n  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>\r\n </fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 216,
          "bodySize": 1293
        },
        "cache": {},
        "timings": {
          "send": 2,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8638"
      },
      {
        "pageRef": "page_66",
        "startedDateTime": "2018-08-14T12:26:57.641-07:00",
        "time": 3,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/advcor/csPln/offenderCPHeader.htm?persCallback=&persCheckIsDirty=true&inctvCallback=&inctvCheckIsDirty=true&ccOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&waOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&scOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&readOnly=false&isPrint=&nrtvHstryPage=",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAABAAAAB7IIogsACwAvAAAADwAPACAAAABET0MxWlRVTTExNjg3ODFET0MxLldBLkxDTA=="
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [
            {
              "name": "persCallback",
              "value": ""
            },
            {
              "name": "persCheckIsDirty",
              "value": "true"
            },
            {
              "name": "inctvCallback",
              "value": ""
            },
            {
              "name": "inctvCheckIsDirty",
              "value": "true"
            },
            {
              "name": "ccOnClick",
              "value": "%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B"
            },
            {
              "name": "waOnClick",
              "value": "%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B"
            },
            {
              "name": "scOnClick",
              "value": "%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B"
            },
            {
              "name": "readOnly",
              "value": "false"
            },
            {
              "name": "isPrint",
              "value": ""
            },
            {
              "name": "nrtvHstryPage",
              "value": ""
            }
          ],
          "headersSize": 810,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html; charset=us-ascii"
            },
            {
              "name": "Server",
              "value": "Microsoft-HTTPAPI/2.0"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM TlRMTVNTUAACAAAACAAIADgAAAAFgomilwrqYJyFxgkAAAAAAAAAAJYAlgBAAAAABgGxHQAAAA9EAE8AQwAxAAIACABEAE8AQwAxAAEAGABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAEABYARABPAEMAMQAuAHcAYQAuAGwAYwBsAAMAMABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAuAEQATwBDADEALgB3AGEALgBsAGMAbAAFAAwAdwBhAC4AbABjAGwABwAIADSVFMQENNQBAAAAAA=="
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            },
            {
              "name": "Content-Length",
              "value": "341"
            }
          ],
          "content": {
            "size": 341,
            "compression": 0,
            "mimeType": "text/html; charset=us-ascii",
            "text": "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\">\r\n<HTML><HEAD><TITLE>Not Authorized</TITLE>\r\n<META HTTP-EQUIV=\"Content-Type\" Content=\"text/html; charset=us-ascii\"></HEAD>\r\n<BODY><h2>Not Authorized</h2>\r\n<hr><p>HTTP Error 401. The requested resource requires user authentication.</p>\r\n</BODY></HTML>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 474,
          "bodySize": 341
        },
        "cache": {},
        "timings": {
          "send": 3,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8638"
      },
      {
        "pageRef": "page_66",
        "startedDateTime": "2018-08-14T12:26:57.650-07:00",
        "time": 72,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/advcor/csPln/offenderCPHeader.htm?persCallback=&persCheckIsDirty=true&inctvCallback=&inctvCheckIsDirty=true&ccOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&waOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&scOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&readOnly=false&isPrint=&nrtvHstryPage=",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAADAAAAGAAYAJwAAAAYABgAtAAAABYAFgBAAAAAKAAoAFYAAAAeAB4AfgAAAAAAAADMAAAABYKIokQATwBDADEALgBXAEEALgBMAEMATABzAHYAYwB3AGEAdQB0AGUAcwB0AHUAcwBlAHIAMAAxAGQAbwBjADEARABPAEMAMQBaAFQAVQBNADEAMQA2ADgANwA4ADEAxHhUBZK/sKIAAAAAAAAAAAAAAAAAAAAAfBw+8hevHgXpBISN6R5gIXk+scVcTWB8"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [
            {
              "name": "persCallback",
              "value": ""
            },
            {
              "name": "persCheckIsDirty",
              "value": "true"
            },
            {
              "name": "inctvCallback",
              "value": ""
            },
            {
              "name": "inctvCheckIsDirty",
              "value": "true"
            },
            {
              "name": "ccOnClick",
              "value": "%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B"
            },
            {
              "name": "waOnClick",
              "value": "%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B"
            },
            {
              "name": "scOnClick",
              "value": "%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B"
            },
            {
              "name": "readOnly",
              "value": "false"
            },
            {
              "name": "isPrint",
              "value": ""
            },
            {
              "name": "nrtvHstryPage",
              "value": ""
            }
          ],
          "headersSize": 1002,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache,no-store"
            },
            {
              "name": "Pragma",
              "value": "no-cache"
            },
            {
              "name": "Transfer-Encoding",
              "value": "chunked"
            },
            {
              "name": "Content-Type",
              "value": "text/html; charset=ISO-8859-1"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Expires",
              "value": "Thu, 01 Jan 1970 00:00:00 GMT"
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            }
          ],
          "content": {
            "size": 15984,
            "compression": 0,
            "mimeType": "text/html; charset=ISO-8859-1",
            "text": "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Offender Header, Inmate: BEGIN -->\r\n\r\n\t<script language=\"javascript\" type=\"text/javascript\">\r\n\t//<![CDATA[\r\n\t\tfunction showPopup(dialogURL, width, height) {\r\n\t\t\tif (width == undefined) width='550';\r\n\t\t\tif (height == undefined) height='600';\r\n\t\t\tvar ret = openPopUpReturnWindow(dialogURL, \"viewWindow\", \"width=\"+width+\"px,height=\"+height+\"px,status=0,resizable=yes,scrollbars=yes\");\r\n\t\t}\r\n\t//]]>\r\n\t</script>\r\n\t\r\n\t\t\r\n\t\r\n\t\r\n\t\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\r\n\t\r\n\t\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- TAG Start -->\r\n\r\n\t<script type=\"text/javascript\">\r\n\t//<![CDATA[\r\n\t\tfunction stopProp(event) {\r\n\t\t\tif (event.stopPropagation) {\t\t\t\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t} else {\r\n\t\t\t\t// IE8 fix\r\n\t\t\t\tevent.returnValue = false;\r\n\t\t\t\tevent.cancelBubble = true;\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t\tfunction toggleExpanderIcon(imgId) {\r\n\t\t\t// swap the plus/minus icon correctly for the section after the section has been toggled (expanded/collapsed)\r\n\t\t\tvar imgObj = document.getElementById(imgId);\r\n\t\t\tif (imgObj != null && imgObj.src != null) {\r\n\t\t\t\tvar imgSrc = imgObj.src;\r\n\t\t\t\tif (imgSrc.indexOf(\"plus\") >= 0 ){\r\n\t\t\t\t\timgSrc = imgSrc.replace(\"plus\",\"minus\");\r\n\t\t\t\t\timgObj.src = imgSrc;\r\n\t\t\t\t}\r\n\t\t\t\telse if (imgSrc.indexOf(\"minus\") >= 0 ){\r\n\t\t\t\t\timgSrc = imgSrc.replace(\"minus\",\"plus\");\r\n\t\t\t\t\timgObj.src = imgSrc;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t//]]>\r\n\t</script>\r\n\r\n\t<div onclick=\"$('#ocph_offenderCPHeader').slideToggle('fast');return toggleExpanderIcon('ocph_offenderCPHeader_ContractCtrl');\">\r\n\t\t<table style=\"width:100%;\" cellpadding=\"0\" cellspacing=\"0\" class=\"main-right-header-overview-expanded\">\r\n\t\t\t<tr>\r\n\t\t\t\t<td style=\"white-space:nowrap;width:70%;\" valign=\"middle\" >\r\n\t\t\t\t\tInmate: TABLER, Patrick Roy (888912)\r\n\t\t\t\t</td>\r\n\t\t\t\t<td style=\"text-align:right;white-space:nowrap;width:15%;padding-right:5px;\" >\r\n\t\t\t\t\tERD: 03/29/2020\r\n\t\t\t\t</td>\r\n\t\t\t\t<td style=\"text-align:right;white-space:nowrap;width:15%;padding-right:5px;\" >\r\n\t\t\t\t\tContact RLC: HD\r\n\t\t\t\t</td>\r\n\t\t\t\t<td style=\"white-space:nowrap;width:24px;\" class=\"cls-expand-collapse-button\" align=\"right\" valign=\"top\">\r\n\t\t\t\t\t<img id=\"ocph_offenderCPHeader_ContractCtrl\" src=\"/OMNIStatic/images/buttons/button-minus.gif\" height=\"15\" alt=\"Collapse or expand this section\" style=\"border:0px;\" />\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr id = \"dontPrintHeader2\">\r\n\t\t\t\t<td style=\"white-space:nowrap;\" valign=\"middle\" >\r\n\t\t\t\t\t&nbsp;\r\n\t\t\t\t</td>\r\n\t\t\t\t<td style=\"text-align:right;white-space:nowrap;padding-right:5px;\" colspan=\"2\" >\r\n\t\t\t\t\t<!-- SecurityConstants.INTERFACES_OFFENDER_PHOTO -->\r\n\t\t\t\t\t<!-- CQ33683 - added a parameter for print screens using the header so it can disable all hyperlinks -->\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<a onclick=\"stopProp(event); showPopup('/omni/advcor/needs/printOptions.htm', 650, 675);\" class=\"cls-link\" style=\"font-size:8pt\">Print Case Plan</a>\r\n\t\t\t\t\t\t\t<span style=\"font-weight:normal;\">|</span>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<a href=\"javascript:openPopUpWindowWithFeatures('/omni/offenderphoto/viewAllOffenderPhotos.htm?overAllStatus=2', 'OffenderPhotoPopup', 'toolbar=0,location=0,directories=0,status=1,menubar=1,scrollbars=1,resizable=yes,width=600,height=400')\" onclick=\"stopProp(event);\" class=\"cls-link\" style=\"font-size:8pt\">\r\n\t\t\t\t\t\t\t\tView All Photos\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t<span style=\"font-weight:normal;\">|</span>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<!-- SecurityConstants.LEGAL_FACE_SHEET -->\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<a href=\"/omni/records/lfs/index.htm?offenderDOCNo=888912\" onclick=\"stopProp(event);return processOmniLinkClick(this);\" class=\"cls-link\" style=\"font-size:8pt\">\r\n\t\t\t\t\t\t\t\tLegal Face Sheet\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t</td>\r\n\t\t\t\t<td style=\"white-space:nowrap;width:24px;\" class=\"cls-expand-collapse-button\" align=\"right\" valign=\"top\" >\r\n\t\t\t\t\t&nbsp;\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t</table>\r\n\t</div>\r\n\r\n<!-- TAG End -->\r\n\r\n\r\n\t<div id=\"ocph_offenderCPHeader\" style=\"width:100%\">\r\n\t\t<div class=\"main-contents\">\r\n\t\t\t<fieldset>\r\n\t\t\t\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"2\">\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td align=\"left\" width=\"124px\" >\r\n\t\t\t\t\t\t\t<img src=\"/omni/ImageProcessServlet?DOCNUM=888912&amp;IMAGEID=&amp;PHOTOSOURCE=&amp;OVERALLSTATUS=2&amp;PRIMARY=Y\" alt=\"photo loading...\" border=\"0\" style=\"width:124px;height:155px\" />  \r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"2\">\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td style=\"height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">DOB:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">12/08/1986</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">Comm Concerns:</span>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">No</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"white-space:normal;height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">SO Risk Category:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\"></span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"white-space:normal;height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">Custody Level:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">Minimum 2 - Camp</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"white-space:normal;height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\r\n<span  class=\"cls-label\" >\r\n\t\r\n\tBody Status:\r\n</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">Active Inmate&nbsp;</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td style=\"height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">Age:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">31</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">Wrap Around:</span>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">No</span>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"white-space:normal;height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">PREA:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">No Risk Identified</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"white-space:normal;height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">Category:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">Regular Inmate</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"white-space:normal;height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">Location:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span id=\"headerLocation\" class=\"cls-value\">\r\n\t\t\t\t\t\t\t\t\t\t\tAHCC-MSU\r\n\t\t\t\t\t\t\t\t\t\t\t&mdash;\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tSIE\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t4D111\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<td style=\"height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">Gender:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">Male   </span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">Safety Concerns:</span>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t<!-- CQ 33828 -->\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"white-space:normal;height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">ESR SO Lvl:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"white-space:normal;height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">Single Cell Required:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tNo\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t&nbsp;\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td style=\"white-space:normal;height:40px;\" valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">CC/CCO:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href='/omni/records/staff/staffModify.htm?staffId=1511687' onclick=\"return checkFormChanged();\" title=\"author_link\">Healey, Merina J</a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t&nbsp;<br />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t<!-- CQ32521 -->\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t \t</td>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">STG Info:</span>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">No</span>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t\t&nbsp;\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td valign=\"top\" >\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-label\">Admission Date:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t05/09/2012\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t<td  valign=\"top\">\r\n\t\t\t\t\t\t\t\t\t \r\n\t\t\t\t\t\t\t\t\t </td>\r\n\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"2\">\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<td width=\"12%\" class=\"cls-label\" valign=\"top\">\r\n\t\t\t\t\t\t\t<fieldset>\r\n\t\t\t\t\t\t\t\t <table cellpadding=\"1\" cellspacing=\"1\" border=\"0\" width=\"100%\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"cls-label\">P</td>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"cls-label\">U</td>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"cls-label\">L</td>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"cls-label\">H</td>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"cls-label\">E</td>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"cls-label\">S</td>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"cls-label\">D</td>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"cls-label\">X</td>\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"cls-label\">T</td>\r\n\t\t\t\t\t\t\t\t\t\t<!-- CQ 35468 -->\r\n\t\t\t\t\t\t\t\t\t\t<td class=\"cls-label\">R</td>\r\n\t\t\t\t\t\t\t\t\t\t<td rowspan=\"2\" style=\"padding-left:2px;\">\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span><a href=\"javascript:void(0);\" class=\"cls-link-help\" onclick=\"showPopup('http://helpsitesdemo/OMNI/Content/Advance Corrections/om3001.htm'); return false;\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"/OMNIStatic/images/icons/question.png\" alt=\"Help\" style=\"border:0px;\" /></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<tr class=\"cls-value\">\r\n\t\t\t\t\t\t\t\t\t\t<td>1</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>1</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>1</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>1</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>1</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>1</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>2</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>1</td>\r\n\t\t\t\t\t\t\t\t\t\t<td>1</td>\r\n\t\t\t\t\t\t\t\t\t\t<!--  CQ 35468 -->\r\n\t\t\t\t\t\t\t\t\t\t<td>0</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</fieldset>\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t<td valign=\"top\">\r\n\t\t\t\t\t\t\t<fieldset>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<h3 class=\"main-right-header\" style=\"margin:0px;\">Supervision:&nbsp;&nbsp;<b>Yes</b></h3>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<table width=\"100%\" cellpadding=\"0\" cellspacing=\"2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"cls-value\">AB-101018943-CCP</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td align=\"right\" width=\"4%\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span><a href=\"javascript:void(0);\" class=\"cls-link-help\" onclick=\"showPopup('http://helpsitesdemo/OMNI/Content/Advance Corrections/om3000.htm'); return false;\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src=\"/OMNIStatic/images/icons/question.png\" alt=\"Help\" style=\"border:0px;\" /></a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t</fieldset>\r\n\t\t\t\t\t\t</td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n \t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div style=\"padding: 2px;\">\r\n\t<fieldset id=\"hdr_persGoalNrtv\">\r\n\t\t<div class=\"main-right-header\">\r\n\t\t\tOffender Personal Goal Narrative:\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a href=\"/omni/advcor/csPln/persGoalNrtvHstry.htm\" class=\"cls-link disabled\" onclick=\"if (hasDisabledClass(this)) return false; return checkFormChanged();\">View All</a>\r\n\r\n\t\t</div>\r\n\t\t<div class=\"main-contents\">\r\n\t\t\t<img src=\"/OMNIStatic/images/icons/wait.gif\" style=\"vertical-align: middle;\" title=\"Loading...\"  height=\"13\" width=\"13\" alt=\"Loading...\"/>\r\n\t\t</div>\r\n\t</fieldset>\r\n\t<script type=\"text/javascript\">\r\n\t//<![CDATA[\r\n\t$(document).ready(function($) {\t\r\n\t\t$('#hdr_persGoalNrtv').on('refresh', function(){\t\r\n\t\t\t$(this).load('/omni/advcor/csPln/persGoalNrtv.htm', {readOnly: 'false', isPrint: '', nrtvHstryPage:'' }, function( response, status, xhr ) {\r\n\t\t\t\t if ( status == \"error\" ) {\r\n\t\t\t\t\t $(this).html( response );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\t$('#hdr_persGoalNrtv').trigger('refresh');\r\n\t\t\r\n\t});\r\n\t\r\n\t// Function called by submit actions within the #hdr_persGoalNrtv block.\r\n\tvar opgn_submitting = false;\r\n\tfunction opgn_Submit(action, prsgoaId, prsgnrId) {\r\n\t\t// short-circuit to prevent double clicking of buttons or links\r\n\t\tif (opgn_submitting) return false;\r\n\t\topgn_submitting = true;\r\n\t\t\r\n\t\t\r\n\t\tif (action !== 'save' && action !== 'cancel' && !checkFormChanged()) {\r\n\t\t\topgn_submitting = false;\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\r\n\t\tif (action === 'delNrtv' && !window.confirm(\"WARNING. This record will be deleted. Do you want to continue?\")) {\r\n\t\t\topgn_submitting = false;\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\t// disable buttons.\r\n\t\t$(\"#hdr_persGoalNrtv form input[type='button']\").attr('disabled', 'disabled');\r\n\t\t\r\n\t\tvar form = $(\"#hdr_persGoalNrtv form\");\r\n\t\t$('#opgn_submitAction').val(action);\r\n\t\tif (action !== 'save') {\r\n\t\t\t$('#opgn_goalId').val(prsgoaId);\r\n\t\t\t$('#opgn_nrtvId').val(prsgnrId);\r\n\t\t}\r\n\t\t$.post(form[0].action, form.serialize(), function(html) {\r\n\t\t\t$(\"#hdr_persGoalNrtv\").empty().append(html);\t\t\t\t\r\n\t\t\t$(\"#hdr_persGoalNrtv form\").enableIsDirtyListeners();\r\n\t\t\t$(\"#opgn_nrtvTx\").focus();\r\n\t\t\t$(\"#hdr_persGoalNrtv\").trigger('callback');\r\n\t\t\topgn_submitting = false;\r\n\t\t});\r\n\t}\r\n\t//]]>\r\n\t</script>\r\n</div>\r\n\r\n \t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div style=\"padding: 2px;\">\r\n\t<fieldset id=\"hdr_inctvNrtv\">\r\n\t\t<div class=\"main-right-header\">\r\n\t\t\tIncentives Narrative:\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a href=\"/omni/advcor/csPln/inctvNrtvHstry.htm\" class=\"cls-link disabled\" onclick=\"if (hasDisabledClass(this)) return false; return checkFormChanged();\">View All</a>\r\n\r\n\t\t</div>\r\n\t\t<div class=\"main-contents\">\r\n\t\t\t<img src=\"/OMNIStatic/images/icons/wait.gif\" style=\"vertical-align: middle;\" title=\"Loading...\"  height=\"13\" width=\"13\" alt=\"Loading...\"/>\r\n\t\t</div>\r\n\t</fieldset>\r\n\t<script type=\"text/javascript\">\r\n\t//<![CDATA[\r\n\t$(document).ready(function($) {\t\r\n\t\t$('#hdr_inctvNrtv').on('refresh', function(){\t\r\n\t\t\t$(this).load('/omni/advcor/csPln/inctvNrtv.htm', {readOnly: 'false', isPrint: '', nrtvHstryPage:''}, function( response, status, xhr ) {\r\n\t\t\t\t if ( status == \"error\" ) {\r\n\t\t\t\t\t $(this).html( response );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\t$('#hdr_inctvNrtv').trigger('refresh');\r\n\t\t\r\n\t});\r\n\t\r\n\t// Function called by submit actions within the #hdr_inctvNrtv block.\r\n\tvar oin_submitting = false;\r\n\tfunction oin_Submit(action, prsincId, prsinrId) {\r\n\t\t// short-circuit to prevent double clicking of buttons or links\r\n\t\tif (oin_submitting) return false;\r\n\t\toin_submitting = true;\r\n\t\t\r\n\t\t\r\n\t\tif (action !== 'save' && action !== 'cancel' && !checkFormChanged()) {\r\n\t\t\toin_submitting = false;\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\r\n\t\tif (action === 'delNrtv' && !window.confirm(\"WARNING. This record will be deleted. Do you want to continue?\")) {\r\n\t\t\toin_submitting = false;\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// disable buttons.\r\n\t\t$(\"#hdr_inctvNrtv form input[type='button']\").attr('disabled', 'disabled');\r\n\t\t\r\n\t\tvar form = $(\"#hdr_inctvNrtv form\");\r\n\t\t$('#oin_submitAction').val(action);\r\n\t\tif (action !== 'save') {\r\n\t\t\t$('#oin_inctvId').val(prsincId);\r\n\t\t\t$('#oin_nrtvId').val(prsinrId);\r\n\t\t}\r\n\t\t$.post(form[0].action, form.serialize(), function(html) {\r\n\t\t\t$(\"#hdr_inctvNrtv\").empty().append(html);\t\t\t\t\r\n\t\t\t$(\"#hdr_inctvNrtv form\").enableIsDirtyListeners();\r\n\t\t\t$(\"#oin_nrtvTx\").focus();\r\n\t\t\t$(\"#hdr_inctvNrtv\").trigger('callback');\r\n\t\t\toin_submitting = false;\r\n\t\t});\r\n\t}\r\n\t//]]>\r\n\t</script>\r\n</div>\r\n\r\n\t\t\t</fieldset>\r\n\t\t</div>\r\n\t</div>\r\n\r\n<!-- Offender Header, Inmate: END -->\r\n\r\n\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 408,
          "bodySize": 15984
        },
        "cache": {},
        "timings": {
          "send": 66,
          "wait": 0,
          "receive": 24
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8638"
      },
      {
        "pageRef": "page_66",
        "startedDateTime": "2018-08-14T12:26:57.723-07:00",
        "time": 22,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/ImageProcessServlet?DOCNUM=888912&IMAGEID=&PHOTOSOURCE=&OVERALLSTATUS=2&PRIMARY=Y",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCPHeader.htm?persCallback=&persCheckIsDirty=true&inctvCallback=&inctvCheckIsDirty=true&ccOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&waOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&scOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&readOnly=false&isPrint=&nrtvHstryPage="
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [
            {
              "name": "DOCNUM",
              "value": "888912"
            },
            {
              "name": "IMAGEID",
              "value": ""
            },
            {
              "name": "PHOTOSOURCE",
              "value": ""
            },
            {
              "name": "OVERALLSTATUS",
              "value": "2"
            },
            {
              "name": "PRIMARY",
              "value": "Y"
            }
          ],
          "headersSize": 756,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "WWW-Authenticate",
              "value": "Negotiate"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1293"
            }
          ],
          "content": {
            "size": 1293,
            "compression": 0,
            "mimeType": "text/html",
            "text": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;} \r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;} \r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} \r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n <div class=\"content-container\"><fieldset>\r\n  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>\r\n  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>\r\n </fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 216,
          "bodySize": 1293
        },
        "cache": {},
        "timings": {
          "send": 3,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8641"
      },
      {
        "pageRef": "page_66",
        "startedDateTime": "2018-08-14T12:26:57.745-07:00",
        "time": 3,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/ImageProcessServlet?DOCNUM=888912&IMAGEID=&PHOTOSOURCE=&OVERALLSTATUS=2&PRIMARY=Y",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCPHeader.htm?persCallback=&persCheckIsDirty=true&inctvCallback=&inctvCheckIsDirty=true&ccOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&waOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&scOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&readOnly=false&isPrint=&nrtvHstryPage="
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAABAAAAB7IIogsACwAvAAAADwAPACAAAABET0MxWlRVTTExNjg3ODFET0MxLldBLkxDTA=="
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [
            {
              "name": "DOCNUM",
              "value": "888912"
            },
            {
              "name": "IMAGEID",
              "value": ""
            },
            {
              "name": "PHOTOSOURCE",
              "value": ""
            },
            {
              "name": "OVERALLSTATUS",
              "value": "2"
            },
            {
              "name": "PRIMARY",
              "value": "Y"
            }
          ],
          "headersSize": 858,
          "bodySize": -1
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html; charset=us-ascii"
            },
            {
              "name": "Server",
              "value": "Microsoft-HTTPAPI/2.0"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM TlRMTVNTUAACAAAACAAIADgAAAAFgomizDCS2phpxdkAAAAAAAAAAJYAlgBAAAAABgGxHQAAAA9EAE8AQwAxAAIACABEAE8AQwAxAAEAGABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAEABYARABPAEMAMQAuAHcAYQAuAGwAYwBsAAMAMABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAuAEQATwBDADEALgB3AGEALgBsAGMAbAAFAAwAdwBhAC4AbABjAGwABwAIAOk+JcQENNQBAAAAAA=="
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            },
            {
              "name": "Content-Length",
              "value": "341"
            }
          ],
          "content": {
            "size": 341,
            "compression": 0,
            "mimeType": "text/html; charset=us-ascii",
            "text": "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\">\r\n<HTML><HEAD><TITLE>Not Authorized</TITLE>\r\n<META HTTP-EQUIV=\"Content-Type\" Content=\"text/html; charset=us-ascii\"></HEAD>\r\n<BODY><h2>Not Authorized</h2>\r\n<hr><p>HTTP Error 401. The requested resource requires user authentication.</p>\r\n</BODY></HTML>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 474,
          "bodySize": 341
        },
        "cache": {},
        "timings": {
          "send": 3,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8641"
      },
      {
        "pageRef": "page_66",
        "startedDateTime": "2018-08-14T12:26:57.748-07:00",
        "time": 172,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/ImageProcessServlet?DOCNUM=888912&IMAGEID=&PHOTOSOURCE=&OVERALLSTATUS=2&PRIMARY=Y",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCPHeader.htm?persCallback=&persCheckIsDirty=true&inctvCallback=&inctvCheckIsDirty=true&ccOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&waOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&scOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&readOnly=false&isPrint=&nrtvHstryPage="
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAADAAAAGAAYAJwAAAAYABgAtAAAABYAFgBAAAAAKAAoAFYAAAAeAB4AfgAAAAAAAADMAAAABYKIokQATwBDADEALgBXAEEALgBMAEMATABzAHYAYwB3AGEAdQB0AGUAcwB0AHUAcwBlAHIAMAAxAGQAbwBjADEARABPAEMAMQBaAFQAVQBNADEAMQA2ADgANwA4ADEAxHhUBZK/sKIAAAAAAAAAAAAAAAAAAAAArv9GqPFZg71gAnyc8lw1ACGkrSanFJr2"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [
            {
              "name": "DOCNUM",
              "value": "888912"
            },
            {
              "name": "IMAGEID",
              "value": ""
            },
            {
              "name": "PHOTOSOURCE",
              "value": ""
            },
            {
              "name": "OVERALLSTATUS",
              "value": "2"
            },
            {
              "name": "PRIMARY",
              "value": "Y"
            }
          ],
          "headersSize": 1050,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "image/jpeg"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Content-Disposition",
              "value": "attachment; filename=\"offender.jpeg\""
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            },
            {
              "name": "Connection",
              "value": "close"
            }
          ],
          "content": {
            "size": 65136,
            "compression": 0,
            "mimeType": "image/jpeg",
            "text": "/9j/4AAQSkZJRgABAgAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCALrAlgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD1nHOQKdyOvQ96QNk8daXOKokQYzjH4UdeOtH3cknijnvQAM2SQTzQe5JwfpS5zwTxTcnHHNADtwpDycelG4MARxS4PegBQe/QetNwSckcUAHjNAxn3oAAeMZoHv2p2QTkUnPUd6AAj8aXHQfpSc7T6d6CMkYFAAWLEY5owMNk9e3rS/TjPWkwFGe1AC7QTx+NGcDHSkHK8ULwuBQAhyBnGD3oXOAw5A/SlJU/L69KOCTQAhHOSead07UHGeOBRgY9aAEPHOOO9L0+ooJIPPbvScZGBmgBuSuSBzT1YDn9aQj3570KMe1ABu3ZAOM0MBg5H60o6kr1pM596AF4xwOaQD5RxxS4x2pBkljQAfN1YfhRk8gHFJu5Iz0o6gYFADsdB6Ubckk0fdBBPWm5yDQAuBk/3qXPykU0qOM8E9qXIoAQsOuOKXOB70Yx1PWj0IoAMggZ4OaQk8hulKMNnjHegDgigAAXH1ozg+wHSkI4FOAyeR0FADd4zkdaMsTkHkc0pPoOaOcZx9aAEOTg5560ZJyPxNBOOSPpQTxzQAc9zkY4NHGME8ZpMM2Mdufwpec80AAxz6UjZP5Up5pMjHPGKQCjpjpxRjBz36Ugz+FLQANjB9utNBPXHGOKXg9/0pd36UwEVvmPvS4AzSDGTngmkJK9DgZ5oAU8dKBnA9TRkHnp70cjnrSGISeMcEUbWJ3H86XHOe+M0nOeBnPemAfe69KMfLwOKMkZycUmVHbr3pAKPmHHahmPFLkkDFIRzQAHnBzzR29aCM4pMHnB6CgQE8c9R0HpSAHqO/8AOgZJw3Wl6Hk844oADhVznnvRyQPcUEZ/nS5BXimAmF/GkOT04AoyR2pQDQAmOmfzpeB3pOCcE0u35unGM0DEHy5GcZ5oozzwKKQEhOec9OtG3H9RRnA5ORSscHBpiEDD5gOpoAz3yP5UuARvx0oLjp0oAOBx60EnPPWjqemKCcjOMmgBMAe1L/Fx2oA5IFGByR1oAB9KDxwDQOTgdKAcA9qAF79eaCuTzSEcADpR2JWmApNJ7daUYCADg0Z45pAC4xnPFHYnuKTksMikJ6YNACk+3FKQDnHbqKbxzjmlGCxIoAVSTntigNkcdqGweD1pCMnmgBfxoPU0Lxj9Pej5c56UAIeuT0oYj6UbcdsUgODg/wD66AFyPSk6jPanY3YA59DQcYJ70AJ075oI4AzThjIwvH1pMZ6UANJ+bBoJwzE81HPKttC0r9Fx/PFc8fEUwjW4MeIj7jnt6UDOmxwaTJHfgVw7+OJWmIWPyl9NwbP/AI7W3aeJ7SSHdM/ln6E9/YUWEbvPHH1pxJHX8axx4gsBu2PwvXhv8K5nVvGNw7bbVfLX1yDnp6r9aY7HeMygkluntUQuYH4DcfQ15dcapc/Z1yfm5yeOefpS6G1pIiSXk2FOeNh9/T8KWgNHqm5ccGl+YnPavL47y4hmDx3GUHbYPSpbrxne6fJG6/OrZ3L8owBj/ZphY9MJ44FNaQKOfxrj9L8bw36qHGxzgEcnJ4/2fepNR124uJ1tbEZbAdzkcDJB6j6UWA6wODS7sAcV5vd+ILq2Vw0nzKSDwOo/CobbxjeQkFn3KRnGAP8A2WkFj0qSVUIydv4ZpySpL905xXmc/iCbVpo4QNmWGRwc9vQetaxafSPsc8b/ALt3QSrgcZ5Pr6dqdhHcED15pAMd+apW+r2c6Jib5iBxtPX8qtrLGRy3XkHFIB5AxkjmjkYbtSZGMjkUvPWgAPPf9KUAY60meM03vz3pAOxjpxnrSEAdKXoeKTOPzoGC7T05oPTFLk545pMc8+tAgIIA9M0cCl788UZ7DvQMQDANKeB6A0dP5Ume2KYCdfoKXqRmlUAZ4puRjg80gFJxxScDnPejGD1570vrQAgOSeaU8HFGQTgcHGTTW4oAUAA/zowOQDyeaM5PPpSYwCM0wBuMcUFunHtRjGMnijg8/hQAvT2pBjJzR2/Gl6YpCEJUAn8KBnGe1KTntR/hQMQ8jOKQHk5pQxBwOeaO5yeaYBgA8DJPfNFJztPGaKAJChOccUpPHTApmMDPQGlLDb/SgQ7GR159KM/MR+VCnsD+NN+6Rjp6+lACoQevSlHIz3PansAMetMKkE96AA4Ulc0gPfOaVyP4eaUnGM9e9ACZGcGg4yBt/Wk28eo9aVRjOBQAfwkdcdqU8+5oBzxtzj3pAOeBz9aAEIKjg9KBgrnoKcWy2D0owBkZ60AISSoP8VHcil7cGjJA4FACKMnJGM0ZPT9aTq2McU7OG6UAHy5pSOuDikAA460hY9aAF5oA9DSY2AAUZJPPT09aAAccUZz34FL05poORQAuB34o6Yqrd3kVjBJcTNhExk4Pc47fWvPrnx1dSM2wYU/w5H/xNA7HpMkixJ5jnCjrXOXfjXTIJGjSXe4/2WH/ALLXB3/iC61AK0kuUGcrtHt7e1ZRZZgSDg07pDSOyufG0s+VdNkR6cg/+y1Vl1d7uyUJDsUZ+bdnv9K4r7QrEqTVqK7kjjVRxnOaTAsXEMtrceXMmJB7j09qbHeFgNg2sv3u+fSq2oXUs8m52+bvwPaoYH2k4NRcaRti5bZz37VmT3AWbjlvSpTMWIB5Pas2VytxmRc57Z9qd7DsjSnvt8SFTtznjrmqKuxmU59eaSRS0SKRhhncM9fSkRtsJV+c9fzovcRtW07FTHjPvWfrErCWFQcj5hn64qO0lJLMOc4xUGps3mKx5b1/KncESQzPEVKnBBB/Cup0XVkjtroE4meN13/7JA4xjHWuJEu6Ljk+lT2e6EE4+82SKL2Bo0NTug8mwHOWyT+fNUWudpCluQMdKhuGMtwQDgD+eaYMswB7Gs3LsI3NNdlYXCHDRfP+WDmtK/1+S9RVd+AoHTqefb3rm/PKQEdDnr+FV45HJadh8obA9z1q0wsbi30kZGXxj5gMdanXW7okASYx0G0f4Vy1xcSSyenfFOtZjv8AlPQ/N/WncD0LTfFV9Z7WdvMToRhRxx7e1d/peqRanZpLEfmKjcvPBwCe3vXhpv2DbAcArtHvWrompXWmSCdR8u7AHHsfT2pp3Ee18DHegnnjtXGWnj2DCpcrh8Duf6LWta+KrG5faDjP+9/hRYLG5wefxpc5waZDNHNGrRncp79KkwOeM0ANP5Uu0DDDoaMr3GOKDg8+g4NACfeyOtOPCjHPb6GgZzwfelP60ANPAHrSH3pTkDBPFAyBgdKBCAnBFKVGMgc+lGB3+tIGBOF6CgYoX9TjFDJkYPY0v1Pak4PFABgKAAee9JjjOaCD2H1pe1ACbfT60deTStjAzx3pvJ7UAL2NJztxTio2+wFNHXAHagBfTntSZ7U4jjA+tNUg59hQICPfNCnHB6etKSRgZ4pMFjjtSGDEduaXK4AB57ikAYMef0pDjHTmgAwAeuR6UUvGBg4PcUUwJORkdqXpnjr70wHA5pSQKBDsc9KQrgdelIM9SKTJY4HFADwQTtA+lNHzGlHGPek5AB9aAFJAwKD09qMHcDScZxnFAx4OQD600EdzmgnAHY0mCAD60CFwAQehNKC2OBQMDjvSAgcZoAUE4BNB4JFKx3cZz703HI56UALnOT1NIQT8vSg5p2MUANABBxyaMHPPApe5ycHtSoMnj8qAGqu0kY/CgrgnjHtQe5zgUAoxIPBFAAVxjPWjqcgc0vO3joO9LxgDrQAY9eazNa1A6bp0s6f6xcbffkA9vetEnrnt0Fed+MNUePVhCx/ddv8AvlT6etAzC1XVbq8iDyScL7D29vaoH1GNbN4mHy8YPPPP0qpcsJIXQHjjisea4Ef7ph8w71N9Bli2UqoLN9eKGkMZcg5c4x7VmSOcgA5PpViKTc2GPHY4oGNmgZcSZ6+1PWZvKHOWHU0QzZBA5z0pSuwgDkN096THce53YyaUHLEhc/jUGcEgjkdeauKNo3AUgHyyqhwGzjvjrVFd/wBo3bvkPbHtTJpC2FBw1SxuN5VuP60rsViX+AHOPQVHcHEyqPmI7dM1HK+F4PPrSsBIwcngdKpATwSGBtuMkds1DfN5pYnrjj8qhSTBY9OmKlkDNkgYHfmhySC5XiyEUHv+lWo2aJXIOAFJPvUAUhSM/hUgJjiOGzkZPHSle4WGI6uHc8HJIFLFMTKCDxjBqvI2ELL1NRw8IzdG5oCxcfMr+WFwpbPXvTJm2/uwOnBqKBtm4k9c0j7uvr0poVhuMY7U7zAnT7xNPCosYZhgk4zQIwoLk8k/pTHYmhXOHY//AFqc91yVQe2aqvJlcA9DikVixAHTpmjYC3bM3mHJx3PtWva3iRkNuxg9cdax1lEa7PxNMMwBOPqKFIR6P4b8XpbXa20xxG5wPxIGeFr0aGVLmFZUOVIBr51hdt2SMd667w14mnsJ0jZ/3GQCMDgZHPTPQVejCx7DkflTS2ehx71n2us2V5HFtl3OwBA2sMn8q0Bk4OOKQgwWxzShQP8APWjuaCfbNIBT9KbjLU4+o600lsZpgLjJ/TFLkD8OKTsMUvAX68fjQIZ1JPWlXnOeKMAZ9cdaN2Fzjp3oAXOOAaQjdijIIBHc0u3vmkAhwOMZo4o6j6UoyQSO3WmMbtGOOuc5p2cH1JH6UmffOaNpJ/pQICuAffim4CgA0oJJx6HmlHXrx/WgBM+hwPSg5xxStnHTnNAGB0pAN2kjk/hRgYB/KncntSZwfemMaPr3op5b3ooAceTg9DSkbevakww6UdBimIUketAbPXkdxSAgH3pevGKADk4I7UEANx0/lSkckY4peOB2pAJuPIxmkHBxS42nAFAUE89KADjHHBpPfNGMCggkg5/DHWgBc4X2oJ59aOBxn8KNoDevpQAvGDjjFAIGOMZozjqOaOdooAM5pNw/CkOD06d6Q/KMUAOODwelAyCOaQEnkHpS9vagBFODyfx9aPbuKMnHoKRmCLuJwtAC5Y84wKy9Y1M6fCgXmR87T9Me3vVu3v4LgtsbO3rwf8K5DxlqdpLZyKkn75cbDtPGSue2OlA0Y+r65f3EW5Z8gdti8dPasC6vDdKfP4f+X5VVnv1uDdeUm2M7NnOfr2qjNKxcu3U1Ldxltph9q8s9+p/Cs28QSFj3XFSF8hXYfNzUblDKM1IWKkAAbbL07GrE3ygDqTUlzGiH5RuHr0pjgyIuOc53UXsMLUlZxkcfX2qe8TyjhGyp74qNwQpIGTTJSXgB/T8aV7gM2t5ZI5qZpSIgAcY9qSKYRoBt5+vWpBGBCrHnOf50x3KYUsy7TkVaULllHDdhSxxIp9h0pXwqBtvXvmkBCyYbBFOmyrHAwBTt3msA/HqafdKApUdB3pqwFLazHavGe1TM2yBgB/nmnwrvyFXlevNNKbk+tDsFiLOShB/hGfrTGBCuScrkkCnqjFi2MhTtqRhi2f3z/KoQFAyFgEAzzUjJsUDoSMmnWtupLSNxjkfWmS5e4A65P9apaiuTIuzGRkMM1Xnf98Aowvfmpp9scIRfvZzVZF8yUk9FH5mqsFrljOVHPbAp+whQTzkVCvykEcYNTOwKA9CaSGhoUnnGMGnKQM4fJ9MVHuyNuevBqYARpjdnjPSmx2IiHLcdxg0gjKttB+pqRNu4b+pPFSFPLJZT3qSR0QSKMs/zccdse9OimdpFCj5SefpVfO5gDyScVIzCIBV79adwsblpfm1lDrJ90YAx/wDWr0zwz4kivbVIpxsdQADyc8Dnge9eKqxaUHHC1Y/tW4iYFGxsPy8DjHTtVqSaCx9Eqd43Z+hpcdzzXk3hnxxcpLHFcfNGMA9B6c8LXqFlex3tussR4cAkc9wD/Wm0SWMDrnt0pRjnFLgdzyKbyTwfwpALjByfTpQDnnt0pfSgg5PFMQmBjJ/OjqfbFIDg8mjaDyfwoGHb8aXll6fjmkAHbilxnk80gEHH1pOemPxpx9/SkGAc5oAMkLjNL2560nOfWl7ZJwaYBgEe9NCnPNAwG5PWlYc5IoEG3BINGMc45pOp4pCDuz7UgFJC9+aTIP55pcZIoxlqAEwx6njNFBI4FFMZJ0PHWlCnB7UnOcdKUKR26UCADB+tAIHyjjNLx06mm/eJ9e5pgJjB4p3AI46UnCsCefalJI79KQAePxo7jjn1pAckDv60884PegBMfhQSvAHOO1Kc4pDjAx3oAQE4pfvZDdKTgg4pRkY569aAEIwcmlUAjOOnejGCRSHrj06UAKec+vpRml3cHNNyQRigAyueRmnZGRznFJkf/XpryBBubj+lAA2VXjmuR8Sa/Hb3gtGP7tP9aPXIBHb+VTal4tRJEisx5h5yc4x09R9a4DW9Se81SW4k+82Mj/gIHp7UXsNF7UdVgaY/YDhD0HPt6j61gSyMUZCOuPxqFo283ONrenWnK2+PLDbjr3qXJlIqx7g+08g1EMY2u3zN7VeZcKVBzu9qosuc5PI6VJSQxyOgPWnhCFx1x1qKZRj5eKez73J/MUrg0WolSYFD2+7UcUYQkY5poPkkODn2q1GoZRKBjHf0pvURQlfy3OD8tWAgktsEc9j+NR3EQdWdT93tS2hY4Qtjd7UmrBYgUF7dtpyeO3vUpLCwjyOTnB/GoI22y+Xj5G61fuoikUSk4UZ5oTKSIyCY+TzUrgvDhzk+tOkiAjJU8DqMVDhtiORkc496VwRJ5eMN0B7+lRspkyD1q7IgeKQg7icYPSiSLZHcZPTb+FMLFBImiaTnK8U1YmZGOeV7VfRkmJGMFqrxMRuC8A4AFADPIZIN7J15zn2pssKtp+7vvx+laUwLWSgJyCB19utVtrG38sjIznH4UrBYzwmIMKOcZP5VXRDuLEcAdK0n2LEwXg/dIqAw+XDnuwyKNhMz5zkDC/rRCgZcHglufcVIykn1z1qwsDKikDOcVYtSJYhuI6Ac0xkLOABxmrOx92Av60hUqRk8Z5FIoYU2R5xxnGfeoXlIG0d6czedKx6BMgfhSJEWbceT/SnsJi28ZOZG54xVx1YxomPlODmnR4jABGfl6Z6UKwLlu4+7U3Cw1oxEgAH61Gy8ZPRhgVK7EOcHJxuPFV45PNlKk4XdmhNEjWCoCO+2qygZO7pmr9yRsCr0FQxRbz0xgZzVJgkSWp+dTGuSCMc123h7X7nTeC3ydxge3t7VycRAXGOnemS3nVVPTg1VxHtml+JbXUNsecSHGevXj29629wKivCvDzzvqCeW/PG3gdcivYdCvmubXypf9dF8h98Ac+nWn0EahO3vxS9RnPvQTk4PWgjjmkAA54xj8aXJ/GkyCMq3H0o7ZoAXnOaTr7UdBmjOeT0pgJwD68Uc8EUpPHsKQEnBoEKfc0mOc+1Lwc54pp5PXt0oGOz2NIOvSjJOMDgcUHOOaAF4xgikx+VJ0PNDD/GgQuQB79aTO7p+NJ1wOvFL05pAIcdKKUDcM0Uxkm44NLyCCfxpvfrRtOOufagQYG8kc5pWwOO/emgdeetLj8T3pgB9M4NOOUyMfjSAt26elG5scHJFIYgbB96UcoD1xQDkAn86UkvxjmgBvuOtLgYx1pRjAPekwNvJoAXdg8UjEjjFL1PHNL938e3pQIYAcbR1pwGAc9aXcRyRSZByTQAh3ZzS9RnFJt4OOPWjHIA6UAQXdyltbvM54TGR9Tiua1LxRC9jLCPkkbGDyehB9Ks+K9TthoFxHHLmVtuBtP8AeX2ryc3WVGWyV9qT0KRJNcSgEy/dHQ8cVnl2dycZHcetXRIckZpyYdQCMt2rNyZRWUsQQeMUvmbW2HjPapJLZlbKHJ/lUflyYAeLB9d3WlzjJpY2kx2zVBwykH0q75jiZSeCO/rUM8LL7jufSi41oRECT7p/+vUBj8pt1TovlnBHNPkViw7YpXDciuUIQ5OSOoxUlpteJo368YFCxeYoGOaVBsnXcPmXOPyqkxW0ImAQkMM5qWyj3PBEqZf5u/XqaZMhYZA6dqlsXCT7T19PwNK9hlOVCtzlfz/CtS6c/aVONu3qOvaq8isTuXjHUValjMkYKD5e9J3AddRkQxsy5D5wc+lV8BovLI5Xvn1q9vLwrnr61XZAp6Z9qVykrixK7oAB1oJCvNjoduKeuIQoLdO+KiBLN8y4DdefSqT0K5StGxhcEHBPtSqio5CcEsuP1p3lMZGX9atrb/JgLglgRz6ZpCaRCrFpxGV47nPfPSrZtz8rbsLnBGKqshWY46gc1bt90sLFhhlyBz1GOtO4cpWkhI8xUX5cljz+tUboBkAC5I75rbKboimM/LnNZ0sPzgE4IHHFJ3FYpxWuGQnoQCalmAj+b0HFW3QKseD8wAodA8fz9SfyoTCxnRRFt0siZ5J69qQILhncnaiKQO/TtV1lK42N8uNhGOopphHl5+6VO5e9NsVjOMRhYDd8rjd07HtUqxFgQvRfnNO8mRpmkcc4IznrVq5Ty7aKKM5DqGIx0YilzDsZUjs0mM+w4q5DBhF3NyRnpTYrcZJYZ28mpWJ8sshxkbQKLiaK0pz5g9itOs4VWN3ZcgKe9I8e2MBuSTk05m222F4Y8Y9sUENDPK3BpDwC2AKkWPAGeFxRbqu352yPp0FKSCGIbCKSBx1qhlW6nH+rj6A8mq49cZPT8KtiPzGIA3A8ntThDtGNmADnrQnrYQ6x3LMjocEEEH8q7zRNeS2vIZHOGCLG5x15Ge1eey3BjDKnUjBP9KggWRnD9FzWlyT6KsdRtr2PfE/fkYPHT296u8Ecccf5NePeHr+GyKyo2ZlAJ4PQYOPzFel6PrEerQBl+VwuD1PYew9afoSavH9KQkAigDjBPfNGWzjHy9RQMXOPxo9j1pOpz+NKdzDHvmgBeBwOab6igE8r2oyR0pAKFApB6Ack4pSRwentQCOo79qAGlSpP5Yo5BHanHOM9BSEng+/WgQDr60HjmkySf60HG3PvTAMgjOOKQ84I6Ue9Lz2HFABwAGPHOM0UcYOelFAx2MnPeilPHA/Ojpx+vpQIOnBo4XOR9aD6UpwcgdaAFB7Dp3pSV4PQ00AEHjilDYU7Wzj2oAQe3elyFOcfjSZwDzmlyCcA/hQA1RwPWnZBGKQAgYo4A+Xn3oAU9Mg5zQS2TxzSDoPQ96UEnIAoGGcE+1JhcbcYpR0yKQjPvmkIX8M1zXjLVhpek8nmT+jL7H1rV1hLn+zpDanEoxjp6j1ryrxJqUmpSJHM/yx52cdM4z0HtQ9BoypJlbDxHOetVWXd1GQf1qaNdm7n72M8VG0RLEg/Ss2y0hy46M2Md8VJHK4AxwR1NNKEoAD/wDWpqhhnByKm4y2j7z5bc1JlwcYyvfmoIyWbJOB61bChchT+NSxooSM4YMR06U9MSqBnB9aveWJeWGfWlktQuSq5/GpuVYzkgKtt/h9KhCZOJDgfyrVVMnDVFNbAD39aq4zOCFQdnSlOWwMZParTL5WFY4Xv70txDglzz70wcSgmSwHT1NIEKnKDGOoq0sIBG7gelPFsoAPbtQ2KxCVy/8AWrUIAX1x2pwt+B/OpIrcgYP3e4oUirBk8enapDFwVJyPWp0gLjaDx61KLcxkg9RSBJma9uVfkfrUqWy8Fhkela6Q+YdnUGpPsOJQN3HY4plsxTb4fcowe1S+RuGF61sCyJJDDNNe1zzjH40XJsYPlMkhLDPOOtPj3LIcx7Fbgc5zWrJYNkY6Hp/nNRNaFMqx5zwaNAsV0KhgvcnFRTQEzgjpn+tXEgKsNwyOgPvVwwbogR1A61WgNGFPbk7cDndyaVo8rtPAA6VuraCWMEnnpmmnTvmKjkYz/nmp0BIw44EIyeT2qtLGXlwBgbsH6V0H2I/NkZC5qsbPDbsY56Umx8plGIrgKMLnIHvUckBLFtvb171sNa5fk5749qQ2ygEKMA9aVwUTCEJ2lenzZNAjK9RwD61ttagL14PFQtaDtTuPlMWSLfIDjABprx5PAyAa1ZLUg49e9RC2KswBwBzmi5PKZckWFBHU8E/0qMnOARwvNak1u0iEg9KrPEkduQB857+2OlVGSIkmRNdBY1VTngcVXJeQt2BpojJcAjgHJq/EI1i6YGaq99iTNKgA8cimAPnIGB9a1soTj8jVadlU9P8A69NEsht7maGQEDp34rt/BmtSLeeXNwCcg+pyvHArhPOyfl4xU8E8kcquDggg1pF9yWkz6FhfzIg4PDc1IGwMCuA8J+KhsjtLluSQFOP90DoK75JA6hs5yM0NCFySBmjocAdaUZzSHOcAe9AgIyeTwKQntng0uMDPekydpxwKQwA4xj2o6HGMdqUHI45wKQZzyvX3oAVWIzxQTnkig8UmO570CAsBxSfy7ilAxn0oOO1MBW+UDDbRjOMZzSZ3Dmk6jFLn5cZ4FACbVHbjNFIDn5SMdwaKBkvpjnNLznB4poz3pcf/AKqBBnJpc89eBQDxyM0YGPm6n9aBg3opx607B603OAMmjOP8KBCdhSjB6jP40FsjpS4wB3zQA3DbRzT93T+dN4HPrSgbeKAE/iznp1pQcDkUxeVJp2VXtQAo5PXpQccEfnSYKrx2qtd3iWlu0rnCjv8AjigZmeI9cXS7UoG/ft93j3GexHQ14vcSSCQMTuPrjGau6neTajK0u/gYzwPb/Cs2GOcOXVsnvwKltFWJkk3YycH0qTzCDxyfSoXimUgHgenFOCHGWOPTioZSHmNzyB196ljJJwV6989KijLFWyfp7Vo29qWwR0rN3uWkLDBxvx0q9FD+FS29oQwU8A96vxwY5IwPWlItR1KBiVj7mo2jJ/i49MVrfZdwJB/HFQmxI5xn0OazK5TOWFc5x+NPa3LHHbvWpBYl0GFx+PWrC2GAM/8A66pPQOU502TsoLNg/SpI7c7unHauk+wbzj86nTTUYD5eR15/+vRzFWOW/s0F8onPc5/+vT0sGXovHpn/AOvXXR6Z8+QMf5+tTLpYYY3dfb/69NsbicrHp2Tz36f5zVmPS0XkDP8An611kenqvPcf59aebInkjAFNE2RzB05M5HH+frT4dLYqQePX/Oa6hLMYJYdPepRaADjoaaQHNpph3f5/xq3BYKYyMZx7/wD163VtRu9Ktx2yKMAcelNIlswBp2Mjb19//r1H/Z4LnPQd/wDJrpHtiy4BxmoZLYL74p2Fc5qSzChl+vPpWdNaEZyM+ldhLbh4SPxrOe1A681LLjqcx9jxgt0PStGztdyEAdO9af2RR04zU8duF29xRcbRk/YyXK55z1/pUiWZHy49q2PIH3gOaTYO45zihjVjHeyAVgV56daz5bNSfp2rp2QAEGq0kSk4I7cfWpZaSOf+xkxnA49KZ9jGwgjGOcZrfNvnjr/So3tj2pXHynOtaYbjuOlRvbAKzema3mty2QRz2qIwFcjHWkKxgeR5g9sU37Cu3kZB/nW4bbB6e9I0SMuBwasho56azCLhDnjP0rNuLTqSeo5rr2tP3ZYdutUZ7cspA470hON0cRPFsyB+dZ0pKEgGuxvLIbSDXOXtlsZuOc5q1boYuFipFcBIyc5PTFNecSD7uOfWqs0TK1MTIX736VoZMnD4f5V7+tBZ2Oc4GelR7mxjdx16UwzNnG/P4U9RF63uWiuEIOMEHH416x4M15Z4FtJz8xIK8eygDgV4+JVBUg7jgZ7Yra0fUPs91FLnGxgfyI9qaYPU97x6H9KUHAPHtWHot59ttI5lfllB249gc5/GthGyOetUSPOCePSjOWAI7UhPvRnPHXvQAo74HINByevWkUcn0zmlBznHOO9ACZ/SkzkncfpSsTxzx1o3c8elAgx6DtSAEA555pRQOvXnPSgYnB470NkLjpzSknpjFJnPHegA/h9xRS9CO9FIQ9Qc9etHTpQDu7Y/GjAz1/CmAYA4NKOaQ5JyTz2oxzgHn6UDFTg5xQAeB27ClxkAjrSfjwKBB7+lJjcMY/WnZ4yeCO1IenT9aBgD13Uc9zmlAwMkU38OfWgQo4yc0uOc4pv3sjHNKCBjBwe/tQBXurgW6hSeW6Vw/iXXhcWjQIu1TjvnuD6Vs+IbgpiQPiJenGeuK82vJGdg2flpXLRnysS7Ac+tSrLheTyKq+ZvXcrZX6UhbDH1NQ2UTs/JIquHBcHHy1Op3oGYZqyluHwAvzeuam7GkPs4g8m4fxda34LfcgycY71DYWhMir0Xnn866K0szkBuM1Mn1NYorRWuCR1xT/KIP3cfjWstpsT5jThBlfl+Yd+2azcmbIz0g2xL2zViO3OMkfSrq24Tr07VOsRPHSkMqpb7M4HHapFtQWGTx/KriwqwUkcmhRuyepPagdhkdugGTUywr0x0/SmIoQLjkDp71YRQRz09KEDVhEh5zUyR/PgDNOXGc/rUi5wO/tWtjNsYI/mxj8aUoOR69alxtGAMGgIAvPNFhXIT0xQpBbIHXvUc0nlrwMe9JaFpJNv50J62L5fduXV65PU1OuAo/WgIF/HtTwBuwTWljB6i7w3H6U2RVIOBzSgqTjpUcrfLxQJIhmjJQ47VU8odxzmrbA7c9fSmjJGCPepZotCsIhkk8UjrxgHNTOcMBnA/nTW6ep9KmxRACV6delNcHGT9ac3J549qQcD+tSUiM5PX0qMqM57jipW65K/Tn9abznr1FItETNxjOcdvemlcnPQkU4rkEjj5qaxP3SOoxSuPcY6+vNQMnzZx2qYnZwB+OaYeTnHbNICB0G3JOfSoCg3A/hirhwRURHOB9aESQMNvTr0xUbx5GGXryDnoandWLDPFKQSOue1VzCaMu4tFYHIyQMk1zmpWWQdp4zyPzrsXjHO7g4rJvoA/GOh/xpKxDR5/eWZBO3kVnvblRkDPrXX3tocsQOBk9frWDcDy3xnJJ4FbKTOdqzMlg2MYxmoxA5OZDjHT3q88oLMGX7vvVdnXIJ+7nr6U02yRpCqoOcnp9KmtnYMDjvUEhXGR0J496miPCgHBBzVLcR6Z4c1tY7KHc21l2oRjORge1d1DciaKKdeQwA/rXk/hCzbUr0xq2Cg3EY7Ar/jXpWmKbeOS3bgo5I+gwM1ZHU2B69eM07qPwpI2G0HP8OaeCCpbFIBpPQjjFNzu6UoJxz36U4cdPTpQAh+UCl6Ee4pOe56mjCr14yeTTADtHfr14oOBjvRgEEDoOhpMgfypABzjpRnpu+lKSB04J4FJuIGDQAu3dxnH+FFHofXrRQA/bgYHAoJBGelIuWzilwcUwAZJHHNKCSSc0iDPPrRnn0IoAR1I5pSM8dDTf4sjrT++DwKAELA5PSnDBJIoI4GOlIMfj2oADkcHv3pc7hx+VN53c08YA5oENHA6Zpkp2oxz+NOyAaytfk8rSJjnnjn/AIEKBnKa6sO9URfMZM5OSOuK4aZ2G7c3THGKnu7+R7wSRnI9fw+lUJ3kkwcYU+9Q2UhjjeSGHHpUkbIONvP1qJUPJ29ffrUy7ee2akrQVX3EN1xWrZ20j4JHB6dKrWyknhc+2a6bTbMyKu4888fnSvYaNGxtWIDH73/666C2gwoPQiq1nb4QJ1NaSr8q7Tism7nQlYTng5yV6UCLjg9PapFG3GRwadnLkZpOzGRhOQPSmrnr6VI5JHFN5C5PejQqIjBSMA5Pam9cc9elJk+lSKMg84xSLCOPJ2gcDrVpS3PqKr79xORgH3qZJATkHINVElliMYPNSAfJxUScn29KnUFvoK0RmyPHAycAUwj5ck1KwC5BFNbIx79aBXI9hx83epI8KeOlNP3Tzx3pwkQDpx9aEO7sWN5xkU0sF5PQVAJQOMfSkDlmwelO4uUn84M3HApvmfLg/jQhXBJ5zULuCc5ouFh7noR/+qmbzknNMeTIxnjFM3kcH0pXGkPxnJxz1zRkYz74pu4gAdutIWJHIpFWEdiDnNR8fepScMM8AnimtxkHjNSUhGwxGDg561Gyk5JPQ04Hn1xTWckEDpSaGiMFlBA6GmgbRuxk5607ZnHb+tI4wPcdqmxRGxHJYcmot2OB06U4qGY+/amcDK989aLsojcFc4+tMD8YYc5qV0I59f5VHs29W4PTiqWorjwSxUdfT6U91IPI57c1EhK8jrmlYtySc5/SpsZsZIVIO84x0HqfSqU6BuentV0nnn7uMVA4JPyjvwaEIwL63G0tt9+vXrXKX8Bdz2Gfy616BPHlSpHU5Nc/qNkSTgcen51pFmUonIPakDG7r7VVktkQZc7sHkdK3bm1JYLjbgfWsqeNA5DdRxn196uL1MmiiNgfhOM8DNSAru+YY545/SkaMBjtOO/SmnKkc5z7VZnqbGm3k1pMrwHaeMjAORx613/hjU5Lm+BmkyzLjbtHAyvcCvMbaYxsGI4zXWeHb149Stzt+VnXv7iqQdD18YCAdj0pcD1yBTIJA8KtnqoP44px4/nQSLwB1yPSjIK5HTvRuAxnvSZH+FAg46e2aOmMcUAEg5NHPHc0DF4zkdcdaXOMepppx+IoweCaAFOMkL+IpBx3604YOSRSZA74z2oAQgZwfriikHB/GigCVqDzg4oyD0pAc8A0xBu5560vzMBRwx60EkD2oAOjYUYpSPz9aBzgA0DnoMUDGg9Rj8acPlPT/wCtTc+lOzjigQg+9QDnoeaMjPIpTjOCKBiZx3yK4TxncTOTDvwi/wAGB32nrXcuVQe1eW+Jb+4nuD5p2o30OeBQNHO3uFbIbI+n0rOD4fGevalml8w7VHy0wKznI4JrNlIk8zcduc+1PiD7iMc09raOIqWbJOeMVctk46VLHYu2cZVgrD5q6rTIyxXjn0/OsGzVV2jHzHNdZpq4QMRj/JqWtDRWNSMFTjpmrA5X6VGvy8Zznp70/cS1QjYfnBHv1oBIXg01TkZ60Odp6UmA7dhajc8DnFKSCKYWyDnqam5aHlcik3E9qbnsO/agYxjGPUUikOUndmp1bcAar7iW5HNSg7GyfzqkNluNgAOOtTqx/A1SDnPPIp+7HIrRMxaJycAAf/rpQ2QQPwNRBxxTWlXjNXcXKSu4ydveo9wfJYcikQgj60hHOentSHsOU7l46Uu4YOD+FR9Bn8qaQeucelK4x3mEZ5/CkZueuKgdipxjmmBiTipZXKWC5XJFRlyT75ppYbeaAQR8o5ouA9eDnrTt/IAqLnGSOM0Ank4p3Ak3YJHekYgcY96jDcnsaazc80h2FbDZ9qaCBx1o3cYA5phYhsE9e9Ax2BnJHv1qNz1HrTiw247+tRHAz/OkwQ0kjvkUzkt6CgkjPPNIcEYzk45pFCueAB0zgmoxuGcnr/KkHB6cZwDSkDJB64p3JYbQCKXJCkAZ5zTQTnrwKcxwPrSER4Dd8HuKQpgc96cAAc4prknoeM0xMgdAQccnNZ95bhkYk4IB4rTPX15xUE6hgwY4wDQZs5G7wM84wMVz13HlmYcDPX1rrtTjjIO3sP8AGuduUUg5PPYVUbp6GL3MKRDk5PFMwcYq/JEQfmGPSquDuPzY59K1TMyNEKn1BH61taVcNBcRODyhBA9wRWWzfKuR7Z9qntATOPTqD+NO7Dc9w0C/N7p8ZkPzBQMY9h7e9a3TBzXKeDZYxaKiddo3Hnrhc11fGeOeKshi/WgMMH0zS5GOtGF29c+9ACDBH40pGD+FJxtxnPNLtBHSgQnUFhQRkAkc4pehxjtS9cc4pDGg8dKXjAx60Hr1oLEdO/60xASR24HNFJk/SikMfn0OQO1KcYGKQe1AJ5wMH60xCkhiDiggcfoaQ8/MB1pcjB7UAIeAe3vSghuTwTSAZHPSg9cg/WgBBxx0xTsZGAKaWzmlGfwNADuOCDzTCWLZFOzk4z0ozwAe9AyG4kVISzHgda8a1+4knvOTufucYzwK9W124aHTZEiOJDjB9ORXkOpvltv93v8AXFJ7FRVzNY7VBP51GZTkhePWmuu5vvdO+KPLI5z1qLjRNGSfmJxitOzjZjubhf51QgQb8AdelbELqFBJ+Wpb6FJGpZxhDgD5j3rrLT0Ax+Nc3p7BCAOrd/zrprWRUXJGM+/Ss3vc1gi+E4I7dqcM7jnpTBJ8+B/+qlxnAP41JrYk3ELj+EdaY245wvTvmlC8A+vWmuw2H2pDW40E5yRjFL/Ec0g+9uYcGmBjyOooKJt2MdxTVOcc5z3ph570qsAuDyP50rgSbvenK+RnPFQF2Jwp/Gk8wscgcjtmmNIuocL83Ge1Sh0A9qpqRyaXdggfrTTsJq5dMi7aiaQlgAeBUSsFHApPMGRxzVXuJKxY/hxu5PtTQ+O/41G3yr1wKavHXtTCxY8w55H40jMCDjkdqhBLAbac+SeTgCpFYSR85Paosjf60jZORihAC2B0oLH7Sev4U5TtGD0pAducDikYkkEL265pMkczjbkD9aYHOAB6801/ukg01SQnvTQ0iRmweenSmO3AwOM5pCC65xnnGaaSMEDsMGmOwhbkEd6Rm+XOOlDMNoBOOMVGxBG3HGetTYaQ7eCOlI7EADtio/XBpAcAg857UgaH7ht96jDZOenOKaWPIC4H1qMtkYzyKaEStyfX0oDEDI5I4xUa5KkntSq2RjP19hTAk3E8gc56U5sFcn71RxhUYkNwR1xS5BfpnIwDQSwH5jHWonJ3Daafnax5zimMRyTx3xQxDHPYjvUEy/IfSrAHIPUdaq3mQC23twc00yJGNfqSp2jp39+awLlMKSDznkVvyvubB4/rWdeJwT27mqRjI5idDlj71RYHJGcDr0rXu1RdwU9TWcdqnBHXjOaqOpBAC/RjkVctZQpGBjA9aqEAMfrUykYUZ5/pVJO4j0jwSyu+d+35ueM5+7XoS4PA+teV+D2UupLYfcFUY7fLXqUGRAnrgZ/KtCWTcY/nSdBxwKdk8HPtSZ55NIQDGM0mTmlzuOc0uD9O9ACA+/PejIBo96Op9MUAJ3OfwoHB6UuB60cY44oACeMAUUuOQc5FFAC5AwG4FAGBg/jQuSufWhSc+1MQE4yR2pSST6DtSBicnvS9sHjFAB/CMc0ZAOMbv0pAvOSOtHJPqKAFJBzQoA5zzQB0NIR0yfpSAUnjg/SgAnpxSZx978qDnBOOlAHP+KJYYbByx5OPX1WvJru6MhYAfWu98YCSZ2LHaqdO/XbXnTlyeeg60pM0WxXZSTx1NSBeMCo2AGABnHerUC5UenpUNDSJoFMny9E71q2uGCsxwDniqI2phRwOwq7FkKM846e9S2WblsA4ATjPQ10tsNyLjgnOK5exZvMwvyj8/WulgHoN2fwzUvyNImgFXa2e/amqwy2TzxkYpAwIB6ikZjzioNUShwOjcd+KThgcnioDKAuNufxp67ipIHPekPlsK+7lc4x0FMUZYZ4x+tPYYPAx70AYXnvQMarZGSMUjs3HP096fhu3Q9aGG0nPOakY3OTyce9NJGen/wBapAgJJxhqbs3Zx3qlqUmPD5GOmKVSGyCM+lJGuByKbkqSF79abQdSdVLAZGM9BRtLEnsKjRmHJ5Pc08nf8wHFGhIMwOMn6UoO4ZPbvTXQkBQuPU5p6qU4xwO9NMTFQ9expGJVRxmn435AHH1pCSF/pQBGQSvXpSZCBecZNIVbHPANO5Jy3FAxSw3Bm57YpCQBwMAnNOXpj3pC2SV9qRI1mDDGecUzAA/z1pSccAYprEbT60IpIDg89KRiCv071HtIGc0w5J55HWhjsPYErkHj6VBI3G3oakIGOuBnIpuABwOc5zQmCZD8wbOeNtG5gOX464xSlWDF2br2xTW6g98dKAaELtu4GOOvtSfw+nNL/EDjtS4HPGOc0IVhAoGWzz6Uqvzx070pZeAD+lMKBieOfWmBI5HHG7v6Yo3behxxyKaiEAfNznpilYc4PFAgJJB9MVCzlcYHTvT2JzyM4GB9KjZwGAxTEP3krzyetVZ2JRucDnNWDkLwMd6qzSBQQRye/pQ0QzGu2Vc/zrIuGDISgyQeTWxfDcpx27/nWFLI0bE++KuK01M3Ezrkndg81nTDk49a0Z3EjFj1zVOd92B2FNOxnaxUJ7EdO9Kp+YECmuu5uOtL9369DVXJN/RCWmU55yMcfSvXdAQ/Y0Z2ydoHT2FeJWEzRToyj0/LIr2Pwrdi406NcYYKP5LVp6EM6MAZ6+2accjI6j1poGFOTkUA4BAPFAhAMH170HJORRknGfwoz6+tACnOcEcUZpCcDr+NGTnrk0AKCWHTimsuR6YOaXqOR3pG7DGOaAAngcZGeaKUqe/3aKAHkjvQD+dJ8oX+lOB79RTELz06UhGB6UhPFC5/GgBdxGMdD3oPDc00uDn9aU4HvQAhGcAU89AF/Gm5PA60E5A5oGJ36UpYKCAcUdFzmop3MULOqbj2GcUCPOfHc8huNm75P4Rgei1w7OCcA8nrW34hab7dIJvlcY3Dg44GOlYRChQ55JqHqaIcsajA7+lSo5T7vK1VQkOvPTNW1AX2qWVcuQyBFAJ5P61diBLgseD2rPjddwOc/hV+3GQMDAFS09wN2yRSRjn/ACa3oc5UHnPasGyc9duD65+tb9qh2YPJPas27M2gXQA6kNyaHYjoOKYDtIJNPUbl4OcdRUtmqIFwGwOCegqyvzKF/SmFRu9Md6kHAC44+vWkVe4/5eMc1HjY+4jBpWYjhqa2cigEh3JyO3ejHGe9Ki5bafzpxT5cA5BpDQ1FwvIxjpTsZGM/SkRcsTjGO1TqoAzj6GmhvQhETsSTTmgbbgdan2E9PvU77pwRwetVZiuQKmG5H3anZwBzUhUKo4wPSkVCH560WYr3Fz8/y8Co2XIqXaOSOBTV44/SnYkrnftKjqahy2RuOBVpwAc+vWmkKcAHk0alELRfew3pk4oRMZwevepdmD97H4U5VC5A6evrSsFxiRlck/nSjGSQaf8Aw8DpSbTt9iaokYcNzjBFMaPdz71MExx2pGjBIIXp70rDTIQi4ORx1+pqN0DEY/EVZK4HFRlMvhRg0mikVjEOg/Co/IZix9AavtFgAHrTCAAcdRSsUmZxRlByMCmMo29OtXXBJ44OagdCG3HtTQyuQAANuO3WkA54+lSsoZlYnGenvQ0eSfXtQBGYwWGfTOaCCDwakIK44pFOc/XrTJZGwbt6YqPcVADHqeOKkdSMkdBzUTZ2g+9IhsZKxDDvz/k0DOw9gx4+tJgk5xx6570EYHzf71MVxG+VcEc4zVSZzyPbrVogkbgcZ7VWuPu5Ip7CMu8OVGfwrGuTliCOK2btSEyDgGsW6Ksh3HBFWjKRlXCklsVTOc7Wq5LKpUpjPOKpsvXj3oIbIWXDNn3phx347VIcYyOuajYkHOOvOaq5DJrfAkU+hr1TwdqEcUCI4wWAA688L7V5dZ4E8ZPPzA49eelei+E41kuw+3aB2znutXElo9GUhk3AcEULycHgU1CpVRn0FP6/L6HimSGR8wJ6Zx70n8PApCCD1pQcDB9aAE3daX0GadyAfzpMg80AMPyk4GfxpRnA46807I78+lIQx6dO9ADh1IopuO340UASZ6DHPekK7vpQOc0qnd7mmIM5OaQgHBJoz83PejB3cnk0AB4wM/dowO1LgqORSMcN70DEIJGcUcDjt6elK2RgdqOcc9BSACQOlVr2UxWjGP73Y/iKsdcY6+tQ3Txx2rSS/dGP50AjxbVoWed5phgnGPfgDtWU5YjBGF7H1roPEF5Jc3zk/IvGE644HeufIVSdg57ColuVrcI02ANnJ9KlypBUjg9qYSAACv1OaVGyc7v0pWKLEeC/Xp2rXtR1z9z0rHgOXz2rVtn3d+KV7DSOjsRuO3H3up/OtuI7ow2enesbT0+bOM/5Nau7aQgPA/SspHRCJaRzjA696mjbJwDkdjVSL7mQM596mRgMY6mpNLEoXdz+VSsyYC561XTcoHb3p6MocgHNK47EuzOeeKR8AdOT0p4OcDGfSlKgjpTQIiDYYD16VIi9Ap5pwUKQAOlINzOfSiwxvmYxn/8AXUyurd+aQxu3B70ioAeRxTsVoydUBI3fhTjgsec0EEDIPSm87cqM+1UiCZTjjrinbflGahVTt3HjNPG4McnIpktEnzHG3p6elQkErjofSnB+Tg8ihuM4NIEQ4+YjNN8vI9c1OyleScCq3mgMefrSGPKAH1zTthHXmmocnIGSe1OVhjOaAYnlksDnC0OCFPHAqVGyMYx7+1BwOKdibkUak4JNT4GMCmb22kEd/wBKRUPODkHn6U0D3CRADn0qPv8Ad+nNOI565waYTznsDSKQMDgk1UkBD56irbNuBxyAOaicHZnoMZFJlxdiMH5ODjnGMVEeWx+NAY5wetMdAWqblJDHOXxihlO0c4qRUwMk8UjdM574pgRkYGc845pAAUOKkfaMFm7elQOwHI5H9KWomMfAHI9qibJXHTuKlyGB4pmF3HJxxxVbkWGbcqSewqAkHODmp5MKp96qM2DkUhCFjuxnpUU2HXHvT2fOT17moy+8Yxj3qrCZQulOOemP1rDvIyEOG/i9K6CdCVPNZF2pC8nnNMyktTn5UYuQDVZ15K98ZrRuVbpVOQvjb1XriqRkynnk5PSlDA5HepWUYyBVZsbsZyOv407EFqAN5inPpXpHguQsQkhyAM59Pu15lEWcgdADXofghHEoUtgkZxjt8tXATZ6WgG0be4pwB7GmLygHoPzpQMHGMelUSOPyjnrScnBH40H/ACaAccZ689KAFwCaQjnOOgo255zRgjrz6UAHBAz+FGTnAOM/ypee9BzgbTj1PqKAAcHHXvRTe5ooAlxweMUDJHI4poJ79uopQQSDnj1pgGM9/wAaAMA89aUHgZ4pA3y5AoEJg9T3pcADA6UHIGKTI2/1oAXPIyaBjOOgpCGyeM++aUdc0DD1yOBVe9dY7KR2G5RjI6Z5FWThfoKzdafGnScemPzFIEeM38xmlaT7xP4elUwwyRjn19Ku30iy3Dny/LBxhc5xwO9Uw2QSPvHvWb3uasAMPknPrSxKGBLHOOgpN5ZAR90daliCsC+7p2x1p9BE0MShtxHHYVpWxUsoWqCnd8vb1rTtEyyhD9ahtItHSWAOOTz/APrq8hLkA96z7VCoHHNaSqzfKybh25xWcnc3joS/xYUYPpmnAY4PHtSDOQW79acoKyYXtUmhMeI+OaWJCH+anKjEYAzjqM1JGh4GeBQxp2Hhf1qVBwB2NNHpjNOI29eCKLWEJ0bjv1p2QCT1pj8qOaZI5KHA/wDr072GlcspJ1GMetJKSqHPaqMeQckYPerikdCelNO42rEq5bljTvl28flUEZ25J/8A1U/fkkk5/CqSIZL5vbPPagNg56E1WefGTjNMa4C4Ycf0oDlZYMuFAFKz8gEfjVIXBDEflS+ftB2Dp1560DsXWYrkt2qF5I1yxGSaqtOXK56U1h84LHntSBRLaSCRuR+NSF+RzVIH5T+tS7twyehBpA1qTmUZ4bJ9MUBiDk8e9VQdlH2jDgbf1ouHKW94Y47UF+oB6e1VGbncRjmmTTnbwM+lO41EtO+7v7VE0hGRnBquJSACByRzR55x/SgrlsTLITyxzj9aHkAOM4BHSq+8Z3YqN3c52nbznpmkFidgpUnPNNCgYJPJGKiLHgnpjk+9J5gzyKTQyRjtPB4+lCvnjPGc1GTlSCcZPX2pqAnO07gOOmKAJXBIJz/+qoTyvXkUrRgnk8gZpCMYwcjqfagQzpyfxFG5SR+lPI5znINQzKeMcigQkg3FucAAk1SdlDYPfvVh3AUjGTVRyMkdOOnpQQRvkPgnI7GmK2GYZpSeuO1J6du9UmDIpQD25rOukG7NacuWbI6YxVSdDnA7jr6GmtSJbHPXRjDFd3z59O1ZcwO/IPaty/VlUq3Qng+p5rGlQKSWPzelUu5jJFeSQkgE9BioHxgsexqUjLcd+cUwq4J96tGZJGQQm04PBrtvBEzRXw3chvlz9StcTHlSNxzgfpXb+C5V8xA5480MB/3zVRIZ6kgBUEntmnHA68ZpiEbBgcEZp6kc9sUxBz68YoxRgYJzk0Y+WgAPsaBnmgD5TnilPIGOaAEOcAr60oBBz0yKQnP4DpSAlec5B7UAHGc59qKU5HI6H+dFADyQeccelHU5xkUDOMZo9jTELwBgdfSmk4PrSnr0zSYPB9KADOCCPz9KduUBe7UgBDDJzn2owD/SgAHL5x/9agkbeetBznAo25PJ4FADWJYYzzWbrgeTT3SPvjPtyK0xgGqWqOYrCZt20Dbk4z3FIZ4lexCO4bK4x059hVYMD8vXPU1cvFLS+YOc96z9wAOBUMskUlzhefWpd+M5HAqILhT6CnAs/UYPpmgpFtTv5xn0rask2kDH41nWcSkjfz7VvadagOCBx3H51m9WVFGvax4UBh8pq4uUfIPAqNMDG3mpSx2EAfQetRY6ETudyht2G+lOVt/bAHaoAVIC4xjv61NDhB6ClYZdAAVW6YqVH6Z+7VYYIDAfQUSOFzuPyjrQOxZZskgUhOAFB69KzpL5ein8aHvYkTO76cGgZcMgAAIwfSot2Gx2HWqZvFkUHd+nSojeqMgnk+1AXsX1bcwweO1ThwUIzgmsVdRCPw3B9v8A61Si9QrkP19qEDka5lwvpTDc4Dd/QVkHUPlwTx/n2qNb3cCQP1qkCZr+epGSc560hkLkL1IrBN7ukODzVpbgOvTrRuWmi4G3OWj704ynb6mqQ4J+fGe2KkdQxz97H4UrAy3v6d/SpUkG0gdutZyMAeGz7YqRHOASeveiwrFxJABnOTUm8sSM1n/aD07DvQLnBwDRYdi+zdD3HBqFyA2T9arG59T34qOaX37Uh2LDzjGAOc/pTM5IP4VUV+T6HmhpQOn0xTGXt+F6e1QmXaxrPa7Ktkn5RxSSXPybhwDxmiwXsaQnC5b1pRPvHAz3xXPT3ZXoc4HpUf8AahUAbs/h/wDWqrEtnTecuMNwetN87BJB49a53+0y3Jb26dP0pzamGK89B+f6UE8xuGXLZzn0FOWXewBGCDWCuplhgHv/AJ7VKLqRgG60g5jfEiqSM0x5cP65GPwrHa8XaNx+ccdKRbkk5zmgEzZMi7Rzx3p5IZMA8kcVjx3mTtLc5zjFXIbjHB9aLA2LLFz9Rg/Ws+ZdjHH0rVMoPbr1NVpgMZ25U+9TYhsz9pK8DrSHIHTpxUzbc8DntTTluS3I9u1UFxgI4LDOePpUUpyx2jjGKeT8xB6etIME+mD1pkszbmMsjA9M9Kw502OwIx6V004+9684PrWHqEeBu7//AK6aRE7WMOVSNxXnJNVeh5q7Kd/UdOKqFfmK+tUrmA9SGAxyO4rqvCLKNQgVx8vnKQM/xZWuWhXLBcdOK6nw5CVv4XB4DLxjvkVpHuJ6HrqOqqOMcdaeHJ6DOagtTmFM9doqxtAwTzTIEyc8DHrRnr9aGx1HFLzj1oATNA5bA+tGRjJpMAj60API4yaQKP0po64z0pd2QQOMd6ADILDmigdBxk0UASZwMDvQcnj86PpxRupiE+6f60Ekdenegdz60oPcCgAJ6Y/GjINLjnI5+lNGep60AAHBJ60eo60uc4yaD60ANB4+lZ+tKj6ZJ5g+UYz/AN9CtEN3NYviRd2msDnHHAGT1FJ6DR5FfytJKT1A/wDrVm78KdzfjitG+XEjDbgDH9KzCSpyRye1ZstXJY/MZhg81ZVA75PWqsRB4AIz61oQDJBB3fSp8ikadlD0+XJ+v1rpbCIbcnn0/WsixQnA/wA966C2TaoAYVMlZGsVoTxkjAA4HvUrKc+tMVtrc4IPvTfN6qAT7VKNR7Hjg4NKC4BH51ESsY3HGR0Gaybq+Y8INv1odwubT32Aqg896oz34JyT19qwZZ2Ug/ePc1RlvXA4BAPQ1O+gnI3pbzCnDcH2qobklzg8VkJcuTUqzEkHIz6mmok8zNB71s4zwKrm/fByeB3rPaUodpJ/AdKge4YAgGmHMar6gznCjr/n0pv21kbluPTFYbXK7xsGPoc0x7jP1+tOwXubsmoM6gg/p/8AWqNNSlXjP06cfpWGsxzxxnuanW4chicnHp3+lOw0bUWosWGW59Mf/WrQt9RG5c/if8iuUDbXXg96uwTgjBoSLTOu+04wc5z3qVblm4WubFwcK2c4q7a320EMCPUHik9Ckzc83P40hkOdwPBqhHdK+DtP51JvAwO3c+tBdy55hyPmx+FBZcgg5Hriqm8HGBx9aMkHPOMHjFK7KLSkkkg8DjNKZQq8HnNVlmwQAD0qvJIdxPPX0oTEWpJRg+pNVzcfNgnpVKads9aqPdEMB0PWjcUmkXpLgZbd2JOagnvCIwc8E4FZstx8x561XluG247dqdmS5Fia9y2xh39arPMxORxVQuzNuIOBx0prSDnn86Zm2W1uJGPJ4HWmm53SYxgdM1QeYjjPekM4AGB83rmixFzUS7EJPOf8atrfs2MHjGfx/KufWVt2SanR3YZAPA9KqwXNxbz5wSPrVqO79Bwawopm8vBBHNOMsin5Vb64pBqbIvCJCc4FXbfVAg68Yx9f0rlmkk3Z7/SnLcOpyWy30HFIq7OxXUsrkcf5+lSQ3SuSR171ysN2eMj6nNW47r5gVx+dTZWEb0jAtvAoOdmcVnR3JIGevWrMU2Rg96dhioQGOOuc07DFs46c4pRgmkOM9eB2oAjlJPbOeMelZF6ANwPHWtgo27Bbr04/SsvUkKZ9O/601psRJHN3YCnIHGcVVHQnNW7xsnA+lUDw3PXFapmD3HxkM/TBHeus8MzGG7jO3OSB19xXJxcsDnHOa6/wsym+hU4PzAgg98rTT1JZ6pbMWtoyeMqOPwqYdMenSo4x+6T1wKePvc+n61RI4f7vP1pQDzz+FIrcHHHODS5HSgBM449TTge3XFJkhuDR6jvQAuDjOOpo/wCA/rSA9Kdnk57jigBmOf1op3fn0opgP64pCOo4ozwKXGQTQIUnGcAU0ZxxjFGPc0p/D8KAEOBjBwKBnHv6UpXnrn2pOMfLmgAx83tQMg+tLwRjOT7dKQH86ADOewrP1gY06Vgm8jGARnuKvkEnsDVTUjmybdxnHH4ikM8X1AOJ23Adv5Csl1ZnJYHjpXQ6nBJubcoX03DBPSsdlUoXDAj0B5qGrGjIlOwHsR2NaNmuGXAPPX/61Zu7c24gnPpWzZLs8snHfp+PWpa0BG/psZMmTn+net2BGVQSFyKzdMAwTwf8mtXcFOOc/pWbOiIpCljz+VRAEPgd+9G7HPNNUkknJwOpNTYskuEHlH5hu9z/ACrnb35WO1hn3P0raupgVG0jjrk1z1zvZwSQfp3pxQuhUExZcHr6GoZIzgfoDVpo16qPzFS+UD94KapaA0ihGig45qXyuARxUphAJIzxUm07MY5pMVii0GeWznsartbFiMA+/FamVPykD61ASFGVbn3PWkhGTJYMMFSBnpzzUDWr7uM4HetssigZwaTy0OVqgsYwt2BAP51KiFODirropPFN2KDkgHFFx2KoU7uccVJGAEbrnsfWnsgI4HPpSqnA9B2FIdgSVlJUn9auRuxOSQWPoapPGQehzUsBKcHdn1NTsVsa0cjKOtW423LyW/GqEXqTkVsW9uHUYBJp7FxYQRtgZ5qx5TkYA6DnirsNoOcLk/SpPIYHkAA1FyzJETLk88etVpztUkDv3rZltmKtgj/Gsy4gIU5471SeoGLcSYyTwT0+lUXcnnrirt4gDHknis5jzxkU27GTXcjkbJ3HpTGyRk5welDA7sdutPwMDPpxQmSyufl67jUZUlsgc9atbeDnFN+XB9elUIrG2LDcccmpEshj5sk/pVmNo/usR681OJIf+eiAAdCR19KdwKyWaZBI4qdbZQPlGBSm5i3DBTjjqKQ3cefvDHsaGwsOEGGPGeMg1IsQwQaal3Ew+8BjjqKlSSNzw3J4zmi4Ef2UkE8fjUD221s4/KtLjG3OeOoppjGFwCT3zRcRnCJh0znNOUsjYzV10HVQOnaq5i3A465qGgTuW7Viwyx6etX1bODjAHpWdAhUYzk46VfgbCgEEnp7UAWl+YZ+YduadtKj8c+9NUnp2p2ST16etMYZOCT1HTFZWpbmRu59/wAa1CSOgyOlUbxcRsT70ITOTuQVJz161TAL5Bq7en94SBwDz+tVc8ZHXFUmc7EQYcJhj712nhS0UXcJGc7lYk9Oq1x8HJyBzXoPg+MuVco2AAOR3+WtYks9AReF+bPA6HinHrn9KEXaF+nbtR0cjt15qjMVSB1zyaccA55OfSm5BXjH3u9HU556YoGOxkjFLgg/j3pBz7UvX14oAO/40uTnnn0xTTzznGDQG2npkGgBTyc8daKCcnpRQA/3pSc5X170YPX+VLgZ4x/jTENIHY80cgUvAxjrQSdvG3NAxOc9aQYzgEY9RRjJz0xS4AXgDnpSEIfl6HigfKcjmlxleelIM5HqaYC5HHFRTxiRCrDIPY1KOuCRVa4uRCmTjd2zSbsVFNuyPOvE1p5c5CBjnrntwOlcbL8shRVGfQCu515zLKz5PuT07VxcygTZOA3tUc1zWUHFWZTjyF3YP0rWsyWZQCfrWaMZ6kAVp6evznrj/wDXUt6CR1+nRbIs5BH/AOur5GTjNZtjIRHgBj/k1phiSflAI6cVi73OiIkqljxwB6Uka+WCXBx3z0qVgG3AZHpTJBuQqG+uT1oZVjLuQQ5wcr35qmY92MrjHtVx8bzn9arbtz8Egf7VOLQrELRgdAPpUTFUwCTz0qSWTb0xWffXqxKPu5HTHXtTbCxK88afeYAfWqTaiQcBWbHdBn+tQRxyXbAuSoHbpWglrBGvz4H0xQ0JtFLz7puVi+uVNKsF2drbT9CDirU2oWsP+rAI/DH86z5fECoNoH+fzqoxFzIlkgnXnuOxzUDG4TIBOfU5qvJroJYKScdz3/WlTWIZB8wwe+cf40WC6Hm4mU8r+YNMN8R95D+XWhbqKYHBXPvimNCXKkMpHpmk0ikWoZ1k/iBP1qYkryoznrWWoaFsgVajuS2AcipGWi3zcnmnhuTzVfcCck0b8HClsHpnrQNG1axh1Hzde2a6axiwM4IPf071y1hMJHGAPb9a7WyTdEOOe9DsikWlUBeOPpSt82SVwPpU6RAkYHHvSMjZJI4PtUmtzOlYhjgcYzWXdtvRieuTW9LB8ucdayL62KZIx06H8aTZV0czd43H6VmSH5snpWje/LI7ZHcFc8Z5rIlkySMimtWYTYFl7c0hfIweMetQedtbOAQPSori5LHKqAcY4FapGZJNchFIBBPaqj3EpAUZ5OcjPWkRDId7k9egqyEQYOFxjvSsxDIopG5Lt+dWY7Qvn5uB83J5qFrlUU7FJAHpVSXU3XhNw9f85q7C5kjTW3TfgsM4zjNH2RGzmRR/wKsWW7u0AmKSqrDhmBGe/HtUaX1wxBy3PuaOUn2hupY/OSsjHA9eDQI50bK5wPrVGK7ulK4ycjoM1ei1AjAmjYDHXH+JqWrDUyRL2SMqJQ2M471oRXaSYAOc8YrOea3mx0/Sq7M0EgeMkjPrUmidzfbphRyf5UBOQOlUra98xACV3HirqEnB9KT0JJEUIuTksW/Sp4j82cn6VX3/ADEYqeEjcDkfSkgRf/hGAemaaDT0YOPlPQc4pCgHPbr/APWpjsPZdir8ytkZ+U5x/wDXqjeJvhfHHBq8o+XBGB1qtdA+U4X0PWncTOIvAwmYHpuNRKFKnr6Ve1CPExyMevv1qkkZZuD3zWq2Od6kluNrZHPOMGu08Nak1rhW/vfpx71zFnabyD71vWMJjbsMdz+FLmsawpp7nplpdpdQK6kehH4VZxn8q5HSL0xXUUeSQxAK546ius3DI681ondGFSHK7Dhg4GAOaUcZ6Hmk4B/DvRn/ACKozFJPGOp/KlyR6U0npjNKOTzSGOHPXH0oJBPPAppA3dfwpcjpgk+/SgBSMDIyeKKRWJz7dhRQBJnB78Uv+RSBhjpzSk4zmmITGCaG5P8AhSgcnOPxpB05zQApOO1IQOxP40uR0JzQfu84zQAgJxx+VHQ5zRjGetAP0oGBZV+Yj86565uVmYgsS3bnitufPkt+mK82vtTlhlLK2PQZPt71hWfQ68LG7bLWsozxMoAOe4H0rjpoXQ7nGT6iujXU/tEQDEbh1/zmqFzGrA56VlGWhpVh3MEqSGJUA+gFaNjkOoB475/Gq0iHnZ1HrVyyiZnx3H/161ZzWszq9OQmMcf/AFutaO1ucYyOuaqWGREMDn6fWrzjcGxke9ZPc6ErixnAy3P86ZOV2nbgGpY49w4z9aoX0csbll3FT06+1JyDUo3DEHgc/SqLMQOTirNxOwPzRnj0Wsy5nDfLkqe/apiBFe3OxMA8n0rIH76TdKTtHrU07b88kn3qEqxYqAQPatEMtNcCJRswPeomae4Iw7Y+ppjQSbR8rH6itKzVMDgflWsHfcykrIz57IJaFjuDD1+tc+YgMhic+9drfRh7Yooyx7fiK4yTeGYEc+45q20jBthBPBCCJIlY9yVB/KoLcI8oJPFE8ZkwFBB9MUW0BU87uOpobRSuW7ePF0EBOG/LpWo8Mka5A4/lVXTbZ5btSMcevToa6GWNBFggVm9TSDZibgxOcfjSMjDlefTFE8ZL/IOf9mo4ZZAw3g49cVHLY3RIGfgjp/tdqnByQ3QdjUkcaTLleh9Kk8ggKMfKKpWJdy1pWfNXGQDng9R1r0GwVjEAM5/n1rgtKQm7XGSOf5GvQ9OG1cY6d/zqJJNmkS9BE4QZPPpUzxkLipIlyO9PkBxwpP4UuUObUpOAI8YyayL+PepyTnr/ADrdZAqZOck9Ky71QUfjGAen41L3Hc4LVU2Owx1zz+dYUwA65z7V0+sRgsSP16d65+SMEnuapES1ZQ3MucLkH2ppj3DcRitEWy+SSeOaoXDMcxxYwOKtSuSiPzFQheCamt4pLiTkYUdsdaqxwOfncdDWtZMAR06VohS20K2pQiC3+RVHrxz0P6ViybWThTnGScV1V9EtxAw77TyPoa5l4jGzLk8HvVPc52nuQz35lt0hYHamB+QxS27RtFgDpz71A8O6QjHBOeKnhi2rgDA9aLom1jR02QSXWw9l4/MVtNaoyHdGDn2rJ0S1P2kzFTgccj3BromcbCMYxzTvoUkc1co0EuAMDPG0UGclQCO3pWjcQea+WHfPFR/ZEJ4A/GsnY6VsVY2YMGBxjnitO3uW2jJNVTblTwD+FSohUdDWbYNGgJCWBHQ1ZjGSGLYHfms0ZUA7mOR2NWoecHc30J4qXKwJGza7Aepx1PvU8uHYbOFHPNZ9vIE43frVhJSWPPene5Wxax8oPXtUE+fLbjse1SBjt4/Cmy5ZCPbnFFrkM5LVVy+7IBzjH51Rtoy0mMHGa1dVixJ0PPT680abZlvnccA/4VotEZW1LdtCsaKe2OtLPe+XhUILeo/z1pt7N5EWxfT/ABrOtyZJfmPX1rGcrs7KUOp1Xh0SzahCxLMQysep4yK9D7D8+etch4PhAnZ9oIEZAyPda7DvyQK6aatE4sQ7zFxnPrj9KQHAwaUkZGM+lAxzxzWhgGTnFKvBOc0YBIzmlyMnGfxoACR1wOn40oIx9aQc88elBB9MCgBylOTyPpRTVA/+tRQIk5ycY5pfrSEZBxil6UwDBoB64/WlpOhGAKAAj2pMHIJPT170pPXHSjJOMjn3pDFHI+tN46ij060dOnSgCves0dlIwIyMdO3IryzVYf3uPmx7/hXqOpDFhLz1x/MV5zqiZckcgf8A1q5q534LS7MCMkOACQPWtQx7o+cHNZwTbLjBxW15WAFHT17VlHU6a5jXCbT8oXJ9utWtPj5yMn1x+NNmhJb0xV/SoMSk4/D862b0OGS1OitV2pgDFWghdMnjPYVHF8qYIBq2gG0+voazZsiuG8gnL/e7E8Vn3d9kHHJ9O1aL2rXHPSn/ANnWyruZR/wID/Co1Hpc5KWaaV+EyD6A1Rls5ZG54P41109vCpxHEB/uqKrvYKBvbOfQf/qqk7A0clPYMh6c/wCfaprexBA3L174reNssjBTtz704WgT5QB7VSdxWMc24TK4z9RQlqqg7etXpomXIKnPsKrdM8kGqUtQcSLynZS23P0FYF/phMoYIRnrx06e1dSJGC4CjPpileSLCFoAW53bkGK0bTVjJ0zgXhaM5KNn2FOjglPyrE5/4Cea65orbKkwRtj1QH86EMYPywRgj/YFJWQvZGdY2xtxjb8x9Rz3qaYO6sDgdKsMxMjMF59hxUDpIwIx/Om5IqMLGdCTA2SgY/7YzTRbNIvOF+nFaCWx/iG73xmneVzgKfY4qHqbXKtvEluCSxwfU9KtsvmL05PQCmpA0i7SnXpkVrWthIdvy9M8sP8A61JtJEu7ZHo1oyzFznA/+vXaaaCRyTj2/Gsu1tRGgXbg/StC3mMPHFQzRbHRW68DJ5qdlAXoc1WtG34wcD3q6/TiriYPcpTLx905z6Vm3ca7G4zkZPFakxK8nP49KzblwEckj7pqJblxTOL1qP7wAA49PrXMkESYIINdTqDeZMwxnk/1rImtwW3YH4CqRUolByGQLnAqqbdS5IArSltuAQCOPSqrowbjjAxTViEUmhIBGTjvzUkICkDOMc5qXyScnJIpnlsHyoB46U7lFkMGAXPH1qldaYZmLR/5/SrCAjOQfbHY1OkcxTKkgfjT5iXA5+TSrjnCtkegP+FWLfSpW2+Z8qjHXIJ/StkLIq9Gz3604byACrZzkcU+ZGbpoILdLeMKuOlSkKcdc0wBu+c5qaGNmbAU/Uijn6FqAxoVPze1Rsi9dhB6ZxWgtthvm5XvTJkjAwPWpepViisPPPWkaMZwBz71M7fMOmQO1OhgaVsjr6Gs2CRDGmeCB+FaEMSMANo6elSw2R5O0dPSrCQMo4UdO4pLYtDBZxlByQc9sUCHypB1I96n2uqgkYNMc7R82c570LQlkjYxwQBjtSqoK8VAr7l6d+lWI+VOMfSqTIaMjU7cMykKDg56fWnW4CxAYA49KvXMatjcOfQd6rhdvGBj3psSWpmamnyBsA/5NULUEyjJUewrYv4825P+cYNY0BCy8+tQ7JnZS+E9E8LOqW7YI3Y6D0wtbD6oizCPHzD1/wD11x2g33l3SR4YKwAz+IruBognVJlIw2GJzzg8+ldUZaHnYiDU9SeJ/MiDkjn0qUGmpCsCiMHIAxk07BGemPWrOYXJB6cUfxfjQp4IyPrSGgYu7r9e1DEjHJoH4de9BGTn0oAXgLuPSik+8MGimBNjnAOM/lSn1pPckAd6Npxtyf60CDoCM9aOOozn3oz2IoXgc5oAUjCnrmmk49TSnryabg857dKBgeGB7elL2zQOuKTkdOfrSEV74BrJw3t/MVw2oxKsfOAf/wBVdxqODZuMkZxyPqK4nUyCORweh79q56256OCWjOcihd5/8fpW+8JxgAEe1Z+nws12oJ+Xvn6Gt9kAGcBfrxWUNjor7mJLa4boeevtVvTtgkYFRk45A+tMnkG0qSc9iv8AWmaQ6mZlJJ3Y/DrVrQ5pI6BDjqKnRsvg8j2qsrbe/wBM05HOCc496hu4IuFysZPA9qQs0yKFwaqF2lfYG+pBrQhURR4GDiovY0tYj8hFBZtvHWoJInlGQAKu7A4O8gD+f1pDLHuOBgChu47GQ+nuMFevqf8A9VVZYbmABiGcH0ya23aRwCiMPXIqvJFdBRuTOe2DTTsCRjfaMMFkiY57lelOZLSRgPlXPToKtzMEx5lsc/7lUZVgODgqe3QU79gcRhtbcsT5rAHp8wzSTWsXIMuf+BCmiKNv+Wo/BhTlijOC0wOOvzCndkkBs4R0Yk98kU1bVCwwDmrQktkAy27HXJBoF5bg8AD06VXQaTZC1iWzhcZ9qQ2Sxgtyc+tPm1AYwpH4f/rqITyznao479aNClAZJCqoNq8H25oisXlchQMVq2elyzt827A6A5/wrbi02CAA85H0z/KnzC02MO00YfedTx7f/WrQFuEUqFwO+BzWiFwOO/ambcnJ6H1qJMIxKmxsn2709IyHGRz2zUoxgkDg+opM4bjr6mmmN3NSykxx09Aa2QN0fA6Vz1s2CSc81v2zZhxnJq4MwqIpXY+U5bGPU1i3pAibnnGePxrXviS5BHf/ABrGvIi8bYOCAe9TPc0itDmZ1JlOR1OaQW6uvI5qeQHee5HrTkQ4zjvRd2KZVazVlAxzVG40/kcEc/57VvxocZI746dqJIFfBI6elCZFjlmtijYwQKVYUD5KgcdhW7PYbzwCeM8f/qqjNZOuODxTTKsVfssRIIKZIzjipRbhRgenaozuVuUbjvilFwwySG/GmPlJDHtXlM/hTQyDkx8Yx92nrejbho88Z4FO82NlO2I5PqvAouLlIfNgByVU+2BQb2NQdqqD7CniDe3+oY/RKni0h5Gz5WM/3l/+tSCxnPfMyEIj7s4wBTUE05+4R9Qa6CLQuhKgHOOB/wDWq4mjKrDOR3yP/wBVJMDm49OlJ3MDnr3/AMK0rezKBfkwfpWyLAIeGB7cmhoWQc4OD29Kl6jSKKwsvX1/Cn7QOCMd6mLKcjkc1HIoZfvY/GgTEKjAJAI7VUniDk9cjmrOWVcAgjHeoCx3HdwT0zTQrFdItp6HFTqRgqOuM0gOc5zx6UxmVckZBq0iWRXRKxFjngVBDIrx81JdyBrUsDyOCD9Ko2z/ACk8YpSQkW7lVeErxyuK55k8udlIPXA/Ot8EOe/tisq+Qx3IJU4PtxnJrOSOmi+hb0+UxyRtnpj+lem6XqBl0+LluFA/Qe9eYWCZYZ5yce3avStMhWHToeCNyK3PrgV0UdjmxlrIv79/bB+lByAcnjGKYCRyMc0vzHNbHACjtnincA55poBBzgkCnZ9h69KADOCMjg9KdkdMH6imseR/KgZB65zQA7APQ/nRSFSBnIz6UUATdRggYpCcYPWl9qQHOOBTEHt2p3Pt7U3HpSg9iKAEH5il45wfwzQOnQfWkI5JoGKOcHpn1oAHWkB/EUvXp+tICpfAvaMoB5x+HIrkNQjEgJA4HQflXcMMpg459a5K+gaNmQjkY/pWNaN1c7sHLVoytNtz5xYj5R6/jVy5YgEHkfyqWyjCRHcOe9V7z5FYc1gtjqlqzJvDiTKcDuDUekti5bHJOPp0NMu3JySf1pdKIE7Ed8fyNVF3ZnNaHRnIC5bI+tKXJTqM+1QMx2f7QpYCGwSTTZmi/bRhcEkH1q0JNo5qlG20f0qXdnOSfoP6Vm1ctFhpcnaBnPpUtvbAjMmeaS3jA2lgPc1OW568dgKmxRYATAUKOevHFOIU9garhinOQfrUyP14/Sr3FYjktYnPzRoc+qiqEmkQPwUH5D/CtbhvrSlBuFCQ1KxgHw/ABxkfTH+FU38OYJCyPj3b/wCtXXeUOpprxKD8wp8ocyOJk8MSb2USt9d3X9KE8MOWI3t+J/8ArV2JjVl3AEH6ULHgFsDPbdQPnOTi8LjJ3sx+h/8ArVrQaNaxHgDn1A/wrVxgEgDFIRzjAH1oFzXI1hSIDYBz6VE4JUljjNSlgMAHjvUchyMn7vpSbBIhBJyDj8Ka5zxnnsBSb8EEGlBXIJxSsWxCCAdq8e4phXtjmpVycjORUvkkYbrmiwhIeOmMd62rRsLjNZUcR6EHHsOav22fcVcLmc0rC3qhskEfTPPesS6BCnGefStqcHLHHbqayp0O1iOecYFEl1HDYwJIm3MSMZJ5IoRCcdfQ46VpvBkfNjkd6rlBHk9umKVwaGIMYzn0wKnWMMcfjTEAPOSPrVhdgTgndQhIj8khiRjp3qF7cFuUzn2q9GcnJHHvUmxWPQY9qTHYxpNKSRs4xkYx2/lSrocXHf1zj/CtzYuOFB49KAh4OAB1qkNMyF0KEYJRfwA6flU0ekQZIMagdsqP8K1sKRnIzjtThtxlscUWC5Rj02JB91fqAP8ACp1t44+CB7VMSGHH5CqrrL5o64z70Ma1Jti9gOPSonG3oRnrUrDAABOT6etRSR7vlJwT71IiA/Mc/wAqjkJwRg9O1PI2HGc9qY7Uyio8asODVN3MZYNyO30q45Jc7cVWmQHOcZx2pNWIZGs25AAO/wCNEgyATkmqauY5Tnpnj2qcyliB39e1FyWN34JAJqKRsgjnJp7EEn+97VERnnIrREEFxGfsjjOcgn6cVnQuEUJkk59eK2DyCuAQRg1hzfu7hgAOHIH50m9So6mhE5HTNQ6ghkWNufvAfN+NOgfdjg59qmuUDomegYHik9jam7O5No8Qe6t4Qqks6jkcdQK9FjjKRJGcYUAflXH+G7MS3wfA+Rdw/AiuyHHcnmt6Ssjixc+aVhcDcBk9KeOO4xTGByCo/A0ck4HHrmtDlH5OCB370mSMdeOKUDFLgn2+lACEbiDxxTiO5H5U3oOOeacGJzu4pgIeSOvTvRSE5496KQE59jSDpnFABPOQcUZ5PpTELj5cZpOcn+dKcdf5Ucn0z+lAw7d6D8x9B70bsdRx7d6Q/dJ5oELwOn6UmMDGc4oHIyO9Jnrjr6mgBeCPWsfVYV8xGwctnORx2rZwMZzVHUkZrYtgEr/iKiaujajLlmjnk4JXoKhuohIMev51M4KuCBjPrUzRBlyMVzJ30PTZyVzCy9gR71Y0qNRHIzLyMY4+tX7q1A47H1qG2URAr0qUrMmo7xLHPljBHPXNSwgKu3ue9RADKjPXPeplGAfUVbRzxHM7Fgw+72qzaAtIT1HbNU3JBUHvngdq0YAEUAA49R1qNja9kXGbhVHGPSlBIOT19KiBOSSOPTvUxPPRfxoBMlC7gM8EVKp5x+lQKxbgnFSqeMnH4daYEoUKc7iT9amA5zVXfknkcdMVIsmP4s/jVITRa60si/Njk/WoVfJxkcUCcE8kmqI1HAD+6fxFMYhQBzn3pkk4xxmmF1IBySR71I0mSgpjnFQsfmByKY8w2nOBnvUBmVh94fgaTLih7MG7AA1BLICuM4qJ5gq4DZ/GqMlyWUZPP1qDVFouFA5BFIJB83IOKrwhpSQenYCrSWwDbTn/ABpoTLUA2xAkc981bUAqMZ47VBuATHf36VJCx5zVJEdLly3RQQGIJq0QqA4xVKNxhckBhUks3OB/9atFoZtNsdO+UIxnis1upAIxmp5JmwefbiqTv1xgf40mrlxViGdiDhcnvz2qjNuIJ7VckPByccc8/pVOZ0KFeenGKzaG2VknO7BJ61aWZcZyM+mapRxlicAmmT74ecMMU7E9TUE3y5zVqKQFBzz7GudjuzkZOc8VpQXAwAW5xxg0jQ2YunJBHtU2FI5OKzY5zgAMPzqwkucAnJz61SdiWiwVAPtntT9q9cZBFRiVenfPQ013Y9D07CmIlAxzjjNIXUE9OBnmofN4wTg5pHbnqOnelcB7NyCMDNROeDg5PWmmTj1xUZbqfUdqgoQkE5Ix7VXlIXJPf1qUnJA5+vao51BAyegosJlRvaq82Qc8Y71YY7R04qB+UPpVNXIZSmQMpcfpTEb5cE/41I5wCKrOwDADd757f/WpWESn7wbIpjHk4+tLjKdQfoabwOCT0qkjNuwvmKFz6daxJ2V7pyOm4nj61dvpjGu1ccjt171nRxl33YbnvTe5pT7mhb4O3HA4znrVx9vyjqKgtIgB82amwDcAAqQO34/zqbm2x1Xh6BVt/PXIJOw5+gNbo5HGPqaoaTEIrCMAcMA549hV7oeM4I6CuqK0PLqO8mx445zz9aOc579aaCRxx+NODZPzfpTIHAlj74pc9uc01RjJBzSgc9+aAF9Qf/10Dnk49KTA5znignjvzQA5gMDB9qKQqMdeaKYE3zDkYxQACTzRkZ2jP40mcnjFACj05oAGe+O9GCRkcHtmjPccfWkAE+o/KlxgYzz70pGF5wTQemSR/WgBueuO1GRjPFGQp4xQMH5cDFAAQc8fpUU6iWNkBODUhYhT+lJtHQA0MFucreBtoZevp6VJa3CPhWx+NWrqELKy4UYxxXOzNJaXHzBgO35VxvRnrw9+GhqXUTMMlc+wFUZbby2zWrbP5qiQ8j0NJdwb1zhc/wCzSvoRfozGQ9B3FTK/Uk/nUbIY2xzketKCN+McVpuYvcnQb3z/ADq+hwME4x2qnAFLHFWEBI579Sal6s0RejYc5GfSpUIKjKgn6VQ84DAOQD6dalEvH3sY680noOxcO1WAGaA+QKr+ZkZyM0zzMHBbH40FJFnJGecUiy8c9/WqrT84JP50PMNvGffNBVi8sx5PrUfnlSWbH4VS89iozx9KjacZGWPPv0p3JsX2uMAnK/XNQm5weWx+NZz3QCkAN+NV3vACVBLH1PIpc2pVjQlu+ACxPrzVZrwIG+b8c1lyXbAHJ5qo91uBG4/nSbuO1jUkvgf4uPrUcbs8gGcg1k+duOO1aWnkSzAE/KPT8aEgbOihQK2QoGO+OtSswVhhhx6movNWNQCc+hFZl1e7QpDnHPemI2RIH4BzipgzKuen171zsGqrkHI9/wDOa0U1FWGSQfYHp+tUhM1EfBJJH9aV51wOWrL+1DOQ361FNeFTy2M+hp3JsaEsrANt6dzVUSepJyfWqL32FwG+ozUR1DIxgDA4wP8A69IroXZ5cBucj9c1nyTZOM85x9Kge+3sRnHrVaS5UZAx65oeqIZp2r/Owz0Oc1JeJ5kXXj2NZMN1t5yefSr63Iki2/mTRuikupkO+yYqOgNWre4O4ZPSql2gWc/MOeeD71GkhRwc8VLQ7nRxzDYGyatxSngg8nmudiuQAfnzznGavQXY3Lyx4/KiLYXNxXJOScfT1qUucDqBjqKzFuwxAzgfrT2usEKWPTjmncTRcZwec/nUUkpbgHp6VXM4YYz+VM8za+eenQ0hoshyR1PvTTKcEg4A9f5VWaQY3Kxz6A0x5MqOe+cVSGW/OBTng1E8oKnJOR0xVUS4PzH8zURl5PJ68DPGKLEtFh23LnPtioHbavb8ajkkPGCRzzTHkzgDHXvQSxkh557jtVdsEEc59fappB3zx7GoM5YjnFK5LHpgD2xSHaeQRj0HWlUHZuGMdDmm9RwAOc9K0TM2Zl7lpwADjoM/WrllBlQCo/L6UrxBuSB97vU8BEbcHnGKztrc1T0sLKUtlJIGPQVDZ7ZJ943fM3f60l+ry7cZxkZ/Wp9MjzcRx4JywHT3FKLd7F3tG53NipWxiwcjyx17cCrKnkccdDUMQ8uBEG4YUcdulSndgD5Rxniuw8t7jj1PFBIwODn3pp45yTx2pwIO05470CHAkfT2pc5ORkGkLDOBjFKDkZGOtAB1yST17UoOOxz2pB36D2p3OOfrQAZyQaKRc5PHGc5ooAnKgMCD+VGAADRjOeooGMDd+QoAAPc0YY4zij3BPPQUDOAD29aADOeO3r3oGM5yfxpduPm5x7UnIGDj8KYCMeeADSt0yMfhRjgCg8fj6UAKRyOhHekzk9x9aDjsetGOnNIDL1GLa4cZ56n8qzLqzS5X5l5+nT6VuXqNJCQB9CPwqixReO9c9SOp6GGn7pXiiEUaovamu/OCCFHc1aKfPu4A9qqXLxxR5fcc9AKixq1czLj/AF+Rz9fpUOMIGBGfekdmYF/mApwHmLjGPSrWquYyVmWLZuCCAAOhFWen3WP4mqETYYLzj0q2GwdoPA75rN3TC9gPB6kn0HapDIqqByWPWoCSpzkZPeo/tGG6A+9BaZcWXauOx7mhZSSchfrVIS9ATwKUzE/dGPrTRaZYzknJI/rSeZuwSSPrVZp8DA5qB7oKuM8e9NIpMuecVBAYfUmqsl3tc5KY9qoyXeeFP61VmlLE4qb6gaFzeDZgfmKoyXIyWzj6VUeRs8kmqzyleM5z60aDuW5Lg4Y56+tVxIc8nJ/Sq8khIHPPt0pyHkE5x7Ur9BNlyPLE9h2x1/GtLTyySZGNvv8AjVOCIlefwq0zeUAV4FVqI1Li9CoFyR6YrGuroKgG4ED1PNRS3b4JYEj9a5nVr2ZsCNiueuCR6UJag3ZHQLOCP3bqfoasRXkgzzgH3rz+PUrqA5Dsc9eTj+ddDp+rLcYWQEH/APX71bjYyjNnWRagSoyRn/PvUcl5u6sfxNZauQQEOR70pfJAc9aRZc89i5O7twM0huccZ5FVlyW68UxyiqWJIOe/SpbFzErTMzZBpnmE/e9e1ZV7q8VqPlIdv9nBx196yW125eQFQoXPv/jQkxXOvjfDdeMdKtC5woArnLDUXnA3AA9/0961lfI3c02UmF3NukG3OajDP1IqMkvPkZxnn86slcrx1pWuJ6jFcp3qxFebTg4+tUZN3I5FMDYwM5NJDRvR3OUB3d/WphKx6sT3HPasJZ2AGMYHUGrCXRIHJ47CqKNjzivOTQblue/HU1mC53AjP61IJGZRhiPxpjsXluPTOaUzcE9+lUw4UdgaUzAgY9eaALBYty23Ht1qNnx04570wygCo2l344xjvQImMm78OKYWywGajDcHHSlzkjpjHNSQ2PYggjn0qNs5HAxjGR/nrTgQDikkbAH1zxRYzbHrgL16HJB71G7j73Y+lOQbweOMZNNkUGPAwKsi+pEJCSc9M8CpYjjJ4yD3qkshWQ5B6/hVoZcAqBjviovc2SLe3zkzgDAzxVzSrf8A0tPUEH9RVWHPAxx0rb0q3Aczc9Nox+Bq4LUmrLlizcB4XJBIoJO4nJ6dKjGR9aev1roPPJFzj8O1OAA6jtmmfdPGTSbjnv170APA5Pp7+lOBCsMZwe4puMkduKcPTgenvQAuQW49fzpx/wB7v0z2pmc46DBpcZPORmgA384/CigqA/4YooAs4IJPY0mB+NL+JNJ3HFADsEHtSH1pAfUil6+mKAAk49vaj6Ggc8Y4HWgYGf6UwFGMkUmDijsCBijOKAEOMZ4+lKfWgrk54o6elIBuM8HFYcrDzOeK3Oi+pNYOqRtBK0mD5Zx/Ss6idjpwsrSsSqSwxmoZYVmxuHA9arx3XfI+hpzXY27cjPfBrA9C1itfxJHCVQAfh9KpxnKn+Qqa7uVctyO2OahjX0OBVRMKq1FCDcTkhvanPOBkAGhuGxjB7mqrlmfqo9yaGjNaj3mIB5zmofN4wM89qZI20kdqjJOB2A71NmNMtFmAzux+NJ5pHJbp71VknJI5AqKSUkgBvzNM0RakmO3hsZ9+lU5Jzgg4x696jMh7k81E7+tTJl7DDKckn8Kb5zHqcUx2UIDzu75qGWQcbQSR1xUphccZCSV3ke+ahdtwHr61ESccEk+9PUFgMGqUbiuKuQcdatwgFvukj6VWC4JB5961rGFXx0B9/wAafLYW5YiBVe+KfKu6PjmrSwgJ0/So5BtGMACmmWYM7NHlcsfqax7mIOcnGPaty/jBAIz/AJxWS8Jz1PHrTSE2kUUsIyMsAMduMGrUdrHESygcdMUKpB5PFSpu56e1U7kMu2sm4bT94d6sN0+YD61TjIDYGM1PJISvBGfc1NwJA+OMis68mldzGCQue2eathxswcZI61WkK85wT2qbgZTWJeQlsc0hsUXpgYq6xPPp61GVPXJwaauIW1VYz1ArRW4IUKG7+vas9Yivzc/j0qwiHaMkdc5p8twbNK3IJJAOD/OrIIAzgZPH+feqtqCMfSrnygZ6mmgTK0iHLfnzVNgQS2eR6VfmOc45qlIOfl69wPWk7DuRrKQ3v71MJssDjHbiqpzu5HSlV+cHp2qbodzRVhjrnnNWIpOOv51mJIQ2MjHtVgSHAAx+FUgci6zknORTN/OMnHWoVfnDHH0qRSDkfrRoO5KWyMj9aYHODx1NGcLj8KbuI60CbJ1f5Dx+FIrn/wCtUQJyPSpAeSeKRDZKp55FKw3DPQdMVEGbHvT0yeGpogmB2JxjJGKjZl8sZPzbsHPpUjAAAD0qnduE2jIyT3pvYUVdk5hVyCAOlSpHt9AKggk+UZPbtU4bccAZqUbbE8X3gPfFdLZL5dsgxycH9BWRp1mWcSSLwORkd+K34+mMAela04tbnLXmnoP+bIPT609SecUzJ6nJA44oB5yDgehrU5iUH35zS85FRjdnnbj2604nAGCaBEu7GOKXdzn379qYjZ96XAz365oGPyM84/D1oDf7xOe9NPP1HpTgO9ADuo3HP40UoPGD696KBE/bvQDn1FBJ6Acd6Cck0DFAHGcUg5FGc5pR0wOKAEzkHHWjOOMNj1pRweMUvA75+tMBCAO55oGMdPxoyC3OBmk6D/CkAoPT1po68c0pPHFA9gKADHf0qGe3S5iMbr19RUwOVGetHX0zQNO2qOUvNLuIJMxglPxyP0rFllmQMWDqeOoIr0NlDqSQPx71UfTrSQAtbxsf9pAf6VlKnfY6YYppannsf2mdxsilfHcKSK1oVcIEdCre4xXWx2FtD9yGNPooFYeppsu5AAOMYwPYUuSyG63tHYz5Rgg5z9KovggHNXnY7VAA4zyaz9u1sZyKTRS2Imb5sk5X0ppJK/4dKcy8Hofp3pEIPHSlcCCVe/P09Krs4BAJJz6dasXLhFzWexJY45A7ik2axu1clDkgZzTN3HP5mgZAxk5qtNKY0JIyfQVkx3GzS/wjknrjtUO5sZB5oCszbutTAL90jGPaqRLlYiUBiuB61IAVQ4HNTJGF6AH+lKkZPv8A0rRE8w2LLgYXBPYitqyjI5xg1Ws7Pe56cd624oY0XHT3ND2HFsaC2QDUE2CMAmrXTjHNU5lOcAf/AFqlI1TM6dDsI4J96zZoSsg5zWzMM9MZqjLHlcDBI/OqJkZwjXIbqPSlVME9cVMqAAn9BQ45JHApk3IcEDHQnqaQucfWnsV+tNK/KBjn3osHMIHydvOcZxSMOvBoUFX3e3ekLfP19+KLBcQDCkYBzSCM4wR3qYAY3YpyjjPHPrRYV0RrGeM9PQ1NsAK4wRjn2p4UNg98446U4IFbbg465ouxMfAGPcgA9qtAZU4bn61DEAM8/hViIAt6Z4oJIjCeTk81XeMrk45znNajqFUHqB3qrKRtPGalodzLZRy3Oc01ehyv6VZZFBz2P86hdefQZqLMLjFkAyCBxUscnPPeoXTHORjNNQsr+oPrT2GmaG7IGMcVIJD6AD9c1TD8Y71KjFh+PeiNi0WAWJ5/SnHkAEmmpweacQN2cn6CncBwzjtj360Kex9aYxPQ4z7U4cqOBTM2yZOv+NTL1DdulVA3z456VLE5LY5PtQrkst8E4PHGc/0qQaUL2LfzkHA/zj3qME7gCB0zW9ZLttF45POPwq1G5lKTjqjEj0W4VsbhgcDk/wCFadnpax4aQ5IPI7fyrQUjPTn3qToelWoJEurJqw6NAq4AGOwFSg89/wAPSogfSpAcJnuePwqzO44OS2BnGeh7+9SYOecDvUQOeeMgY4pwYsvUDHqeaBEhPTOMZ7U8EY/xqJfTP1pykqfUUCJAR2zj2p4btxzURO38fSnrjIPfHWgBwBBJx0pRk85ppfOV5z6ilyRxjt1NAx+7kZBPuBRSA4HXtj2opgW88fyoGKM5yOB6H0pMYOc8CgB2cNjHFGCO/FGQee9AII56e1IBoyM8c+tOwM85B96OPujPPrSc9WB59aAFfAAxnNJ1A7ZpeD680h4OQaAAjPoKD8oBHPrQckZH69KTdgngketADwR0YDmmDpz29KCQSOaUHkkjj2oAQe+KQ4X3NA46nrSt69aABlx1xWDrChJ1Y/xZ/QCt0kkYP6Vka4mY0cds/wBKUtiqbtI5yd+ML+GKqMMDv7mrs8fPy4/wqHZgHOD6elYXOpFHqQDkAdSKYHBcAgAVOyHYQAfrVYr2bqaCiC9UyLgZB9KpwRuTg9DWi2GPPU00KFGQCKlo0jLSxVkHzD+8ewqjKCcc9a02QBi2CSOhAqhMmBnA/Co6gQRYRgPm/HoasDHGQPeo12bec7u2aerqsbEg546jiq9DJ6kwYKcAcGgYJyGYeuDVP7QSD6j1pGugHHzAY7ZqlcEjftZRGOtaDXSuOBx7VzdveRtgFmH1NaEdwvY/L7mizKuaqTK+Dkgnr7VG8g3E8VBGwzljj6dKmKKQAGyfXNFhplWUBff3qk4BzgnI9K0nizwaje1Cbun9aZW5kvGw+6MelRFSPvE1puiq20cj36ioHhBOMj8aajoIzyFU55z+lNDHndkjFW3gGe1MMQ244pBYrM3ynjrTUU8HGfrVxIF28qTx6U4RJxzz9adxWK4XsQcVIq9gOPep9igdumKQAe9IfKMEeDgdetTonTJyfSkVD948+mOuKl4ODkD+dAmgwOTwD6CnoSDnHb8qaSu5TwKa8ihuGx689RQKw95j0ycVXkcBW3Fge2KR54wfvfrVG4vo15dlAzjrS1EiRnLHhht6HnvQQOMkkZz1qj9tic4Q9/bmn+a7HjpRYCy+D2IHbNRn5c4xnqPamh2I559KevzEZA/xoaAWEuZBkAgjr2q4qNjggDNQRKQ/se3pVscYGCSxxgVGxotA3EcEg0h3Ag56mpfLXI4Oeh+tI6gYz2NBLYwklhmpgQFx7Z96iQBn5xjNSdCTjgDAqkZ3HKATk9xxTouJDgj8aRCu3vnrUsKFX3HbzyM1QN6FhV3MvP15roYMi3jwR90fyrDiUedGcpgkZGfet1MBFAA4HTtitYbHPUZIDu6YzTlBzncSR2J4qMHGSBgmnAnGTVmZKTgDnk88dPpTgSeD6ZqIeuRUinn14oAkVhu24OSKcBhuRx70xSC3oQe9KxO4gknPp6UASA/NwRUm4ZGc4xnj1qunIIz0Prz+NSY6A5GaAHluc4J4qRWBUdPwqJeBt6j1NHQ/Lzg9qAJh14x1704NnI4xmmZ/i/SjcAPr1oAk4I5zwO3eimhhkc0UAXgOmcZpaT3HX3pelAARg9qAQT6UAdutHTGMZ/lQAp+bFIp+XBOcd6AMd8UuBg46UAFJ2PqfyoU/Lkj8qCSx44oAM847elAOR0oA59zRkDGKAGlevXmnDI6Y59aQnkCjHBOTQAHgZGPxpMDAGT70pwBk/lScEE0CDOEzwDVLVIhJZycdMcj6irm0Hrkio5kEsTKc4NDGnZnGSH5uv5VCfT16VPINjEHj61A2FGe/vXPY6kyJuhHPtiqsowFVQcjuanLbjlc49uopu4fMrLx6gUr6lXKi54GATUhxnoAvvThtGflAP0pdqtwc/hQykyErnHt6VTmh7Ada1hCAB71C8B4IAx71EjVGERg4I/GmYOCM8d/er00RUk7AfwqAxk9B/hTE4kElv82DgY9O9Z91bThNy4B/GtxUZjyATU4095BhlGB6j/61WgscLPc3tuxHzY9fmqaHxHcQnDhWx7E/1rr7rw6JkOIyW9cf/WrmtQ8KXMILxqTj2Pt7VaZnKDtdFq28TM+N4PuAP5c1qR63yRzkdh/+uuKW1nt5MyRuufVSK1LGYedl8H/JqHuSpSW51Y1nzGIQYI7t3/WpJNSDEjdge5/+vWLaNF9owcEnoDj0qzPGqjk4NIpTuWnvFJJBGKqteHccHhe1LBAGiDc8dc1DcWpCkqT9atIpTV7Cm7ZuScUn2vPQiiOyL43MfrmlbTyMsO3+fSiw/aRAXjdONvt1pTcIV4LBqhjtWLt0x0qeOyycfhSsJzSAXOUAz75oN2GOOBgY+WpDYAKevApkFiMkseM/pTURe2Q4XyqAOeBQ12zDIU4xnpTLmBE7gY5/CpYTG0P8PC9arlRPtCk19JvK88c/SqFxqsqbyD0BHOf8asTSoGl2hSdxHHpWVJBLcsyoh79QaLITnJ7IqT61cMflY7s+p/xpsYvLwgsz4JzjJrTtNAJKvImWz0xx/KugtNGAx8gA+n/1qltIpU5bsx7KwdUG4HPqfwrRW3KAe/rW0bEIgG1QPpUMkJDcBcAelSXZGd5eOOOmaWNf3g49uKmlQ7gBjn0qaGHDAsOnTFTcLDhHjbwAevNSqmOfyIp5jJ57VIMBMZosMg3bWxz65pjtn0PPNLM4Q85we9QoQxJGStTezIY9ThsAHHXNSg569KYqkH2NS7CF/wA5q07kiovPA61Ovoc+majRiOMDp2qVTng07CZcs03TqcZx6+ua2ELbuSABzWZYo2c5AH69qv53HGeR6VrDY5p7k+7Jpw4PJzUPJOOlO5BByaoglyqkYyaerYORnH8qiAPGKevJxmgCYEZGCfWn7sNzz9KhAO7Ofyp2cGmBKMZOMevFPHOMk1Gpz6CnDPfHWi4DzxwDmnJwT6kdvWmE4I4708EbsjHHUUASDtyvHWlBU5BA55phOemOTSgDHWgCUFeBtHX0opu4gDgfWigRoY46ijtilJG3tTfxpjFHbnpSgDPvTTwcYpcEemaQB1ODRkHIGff2pAOQOT70fdH8OTQApGDgcD2oz+tGMHBNGeccfjQArZ7ce4pDjPtSbucHp2oznp0oAQHLAgfhS9R3980HHb9KMnGPXrQIQkk9B70AfLx39aARzjikc/LwKYB93k0DGT7etIcle9NbpkfjSGcjrUbQ3rH+E46fQVnMSy89a3fEUX+rkAPf+lc+z4GcHnrWMlZnTB3QyBcISTTyFOcZxUfzISM5B64oBbcegU+tSabjJBgE5GTSRnnk5HrSyYIAHUUgyhxtHvkUmMsxnPByc9M1N5W5R1NV4iFkLZJ9ParMb5x94fSs2aRZWntVK5A5+lUGtmLYRePYVubQ3GDg9Kigh3Pjbg/SgrmM+GzYE8dO2Oa17e1JyxBx2GKSKBsggH3NaUeF4BGBVX6BuNitxt5Az71FLZwypyqge4HNWASc5JBHTHSonYbQBmmmNLUxrnQLS4GGiGB32jP8qwpvCsaE+XvUj8P6V2pYKCpIyajeMOpOcGh3Zpo9zhjoM0cvmRk5+p/wqrdQXZfD549M813otlJAzwOtRS6NGy88kd+M/wAqq2gezhc4WO+niXyzESB6qafLeySRAKgB9xXTS6CVUERg7vVef5VSbRcEERn6beP5U1ch0I30MaLUDGwRhkev+TTn1Nwhyq/l/wDXq3PpiR9EyT7f/WqrJp/sT9f/ANVO5P1dbkUd+24MygA+g/8Ar1N/aYB+Ve/XH/16Z9jGMkcDtTjbxhRhPwxS5hfVx76izKSo5xjn/wDXVZdQmywK4/A/404oQThePTFMERL/ADDH4UczNFhY9SO5mmuVCggf7pOcU+2WVYigLEYxk5qZLcCT2I4q/DbhR933ORTUh+yhEoQaaGO49SeR/kVpQadFGMhRk+oH+FTxRjdx+lWBgEcGkxO3QdFaxqowq569KtJEFGcACo48Egk9Ks8EfQVNyJEUsRKgg8VUkjBO3860FYE4PQDOPeq8q7ySBilclaGY8K7j/SnohAAwfqan8orJ8wyCKkVF2FTnrxQmhNkeCFA49feopDjgADNSvhWHPtUMpB598c035A2Up8uQOeuOKlhi2AA9xUm0E5Iwf604DJAz09KjlM2xwTIxlRgUn407Cg5Jpp2nI5BqrCGtJtPXFTxvuC5785qg4YyA87c4J7f/AK60YEGYxkdBVxQnsatsdsS7VYsSO1WskdAQ3U+1QxfKqgY4HapNxycd+Oe9anLuSoxPX8akAycknHpmo1GFGSMmlyQcDnimIlB5x2pw+8TkfnUYb25xzSlhngH60wJwcDg89aeGBAOMn0qFT0wCaepABz1zQBLu5yRilyB3JH1qPdnjBPenqOMD1zQBNuwBkfnSjrkY9ajJJwO9PA+Xtn2oAkB607naOKjzxjv0p2SVA9KAHhuOcUUzA7E8UU7Aah69BijH+TS4O7k0bTnGcmgBcjgfrSduPzpP4vp6U7jIH5mkAmQATg0gwR0z9aXIPHPHpSA8Hj/GgBWbPJB5pMHPGPxpSdyg5HsKMdcUAJ1Hb8KX1pBleeKTJzg5FABnoB3pScDgfWlIXdkHgdKQ/eIBoAaAeuOKD1OKUgn7ufpTcbR1JHrQAZwOtNPBO3GB/eoGG5wfpTeckkHJ9KAKOqWxnsHGAW4wT9RXHMCPlwK71xlSG6fpXG39p9nuGjJbA7/gKzmjWm+hnkkZ9aRz8pbPTtSsCTn1qLksMZPsaztY3RIqZbcSAOwNDDPGevfNBbJPpSFuemfpUjEVWB3ZJBq3AxAAyM+9VgT8o5x/KnK5+9096XLcpM04uRt656Y6ipEUK2eQ3bPSoIJlUjkfUVZALEsxG09PWobaZaZOgGQBgDvTtoI4xTBjG4EY9qkyNoAHJpplqwu0knoD+lQvGR3x65qbJ7c01/nyM07jKzHJJYUxpMRluOOgp0rHJ4GPpVOdz5QCk5HUDqaEyi2sqhcfKQakNyFYYwRVAsEAXDZpj3AVAMD61auIvvclvm3Lgds1Qe4D4wSPoarzXO3pwRVGWViuASP900XGrFicqWGCPx7VXkRTwPwNRNIWByTmkMmehHHaquPmQ5oBt7dKrMhDY49qn8xzwcUBNx3ZAx60g5yt5Q3DA5p3kL1PXPSnHJkO0inAHuMnNMXOIECn7ucDPSrCHOBtPI9OKasZ3de2eTUyJg8sPbmkJyQ5BtPT2qUYJ561HypxinA8dPmzSIbHojeZnOB6VbB+Uf0qGMZxnr6VYAx296QNke7a2McnikdSehzzzzUhGSCcDvzQNucZA70miWQlDjsaifgcEZ9qtOCBx+Y6VTk6k/KPp61LRDIG5JLZ/HrTDtPocetLI/PTNMXIJJGPrVEtiOcsAB+VPXKtkDtzmmfxZqQfdJPPHQUIQhIIPrnjNM9+9P4IB7ml24B6D61VwuRqmeCeC3T3rQtIhu5B4HFVEHQnGTWpbL+7GeoHUVcdzKb0LK5HGOSKeq+tMyRg5B49aeGyP51sYkitnI49s0vIIBPNMUHg8HnPFSHGQcjP9KBDwfcfn3pwPUHGMcH3qEj+LPvgVIq5UEkjnOKAJVfZyf09akBXqDknnnpUR2lRn9KcAAPwouBMpwcnH4dKXd83FRoytkelSL13celAEnbr83XilGW5GRzjmmKDkningsOmCCecUASAdckZHNCb8EnuaFI7gdaeO4JyMcY9aAFAB65HHbvRTSxGAR+IooA1snPTOfWkAJ6E5pfvE8ke1IDgUwEPA78/nSjj1o4/+vQBzyTSAUHjOAKQgkDAP4daUDsf1o6N1/HNAhOCRxgd6XJ520dRxjNL0oGNBBJA/WkxuHJwaXA/H2oIoAT7o6A/SkByM8Cn5GMEc0mFx8w/KmA3cc+npjrTdxA9h60EkZJA9vWk5PWgQFsDPf2oLAHJ7UEADjrTGXjg/wD16AAjIJJ/AVzviJfmjdVIBzlsfSuh6Dtx0zWNrakrGpAI5yPyqJ7Fw3OUJYHBwDTUJDdsdjUjgo5zgkf3u9RA4X3PrWTN07Ctk7s9RjpSK28YHBpQfk56/rTSPLbIzg0i0yROR3qRUwRzkHrTVGUyM5FOAKipuUmWETHOB9KtpIWjweo9OlZ4kcHj9avw7eQD19aLlXJlDFuwX+dWM5PPB9KgAI4yePSplOXOfwqGy0xwYJ9PalbCr2yaQDnJ6U6RTt4xn3pFFaYKMnIrPkUxkNitOQDIOBjviq8yBlHFOJRlS3DnJwAT3qoZ9yncGHpx/OtR7XI+6QPUiqktnlSVzj3qyWUZZsHGc+/rVcy7zzlR78Veks+M4ORVY2xPOOB1qlqTqQq+ck8ColYk8nbn14qV4Co68UxoyAOCfWmIA+Cfm5HHWl3k4+bHOTk1EAcN8p474pYwCDnP/wBekwHqw3kg85/Op1YsM4Ax6dTVcIC4bmplHOB160r2E0yQMCO+aeCxFCpx05qaNTt5A69qdylEEDEZb6c1PGgHJ6Y70KmcCp9nTpwOlRcBYxuwQAPrU3CrnJJ6YP8ASmoOBxgetIzqGPtxxQDAqc5JHI4B7U2QfLxjOOveguD37d6jZj607ktimQoACcjb0zVQsCzZHXOBUxbIJxmq753bv0poiTIymTk8YOeKQkdevtQW557/AMqa2SflHeggcMNzjkelGWHYdaAdgxxmm9Wzk+9FgF4xznJPanA9MkHtzTWGRkYoA7nFOwmSoBuwORnv/StKEEKMHHsfSs6HA4IOc1qJgBScH5QK0gZ1NEPHJ5HA9KkCkdTgH86YGwMjrnGKcrAn5yx+lWZD1G3gM3PvTwcdRUTNkgdOeKerYPPNFxEgb/Zx+FOXcaYGyeny07d6Aj60ASDOSOOmR7U8ZCjPP0qJTk5z2xUu5QRgk8UAPQY4HUnOB1qXG0gZ7flUO4b16g8cmpM/MCOfWgB5IA+97YzUinCjr0qAqCf15qRSAOpPamBICAcc808ZHRuPc1Dng9fanrwBnJ70ASg5B3Z46YopCcAEUUAbBK9efqaOh9qAOOcGg/MPftTEHAHNIQM9f/r0hz2waOfakMXdke9GPypQATSE4A5H4daAFwNvp9KC3y5I/SjPpzQehAxxQAg+9jGfpQw75pN2W9D7UZwOcUAJg/xHr6UpYg9PzpeuTz7U0Z470AJg8AnNJjkDOfpSkjdj5qMgP2A9aAGYLewpuNpzkn+lP3epH1FMJGcUANORyQPpWXq+TGny8c8457VpE85OcVQ1Td9nzyQP15FTLYqHxI5W5jO4t8v0qiwcKWXBz0B7VqzoCxx096zpkKyYUNj1NYI6JbjFcgkHB96Gbd8uenpTSDyehoUY4yOfWnYRMjbSSTnPSphluR1PaqofLD5SPwqVHPmcEcVLiNFiL52AI/DFWUJEi46CqZcg7hjP+zViJ1PUncPWlZlo0I8ZGW+vNPQjO7k1TEoII7+1TQkt3A/lUMpMt7xnBpVJKfMRkVApz1GT7VKGGcYOD6UWNExGRtwyOO2KjdM5A/8Ar1fwGHA/GojC2TwMGkXcpsAwx8349KhaEdDx9aviLJGQB9aZ5WcFh+Yp3FYy5Izt6dapvC3GwcHrmt/7Orctj6VG9quegxVxfQNjnprYlSoB+tQtAcYAP5V0LW64ICnPuKqPEuTgCrHa5hNARkYpFgxng8nnIrXa3yfu9fahrZSAAMYHJouLlMtYAc4Vs/TiplhC4Yrz9KvLGqY4zUgjVm4AI9AKQFIJz0ABHpUipjv+NWXiHGFOc46cUnlnuOPSpaGR9B0qWPJwTTkiycHGKkI4woIA46UJMljWOVIGfwqsQScjIGe9WQOG5xgVXYE5GTj+tNk3GkYBORUZJ5+b9ac/C45qIkYOewpoybAOQCMfjUbH5Seh96A6nqT9KikfLYFNksYxIz6+tOTdgH24pMEgnP1pQfk6gdqRIpIGc9eufSkxuXA4pp54B785pynBx+pphcUDAxnt3pUwzd8jtTSMHv0qWPCjOOcdTQJaliMDnjnpVyMYQeo9apxfeBz1q1nAwPxzVQQqhOGHHANPQ7ieBxUKkbePzpQSp5OM1qYkrZJ47Uq8ITnv0pq5OSSPQU9QM8ntTAeh+XqRjn2pwG5g2SR3x0qPPPQ+lPVtpK8AYpCJcZOR0FKpyc4xg9x1qNWI+ntUysSAMCgCQFW5I5FOAznbnHqai6Z6g1Ip44OeOfrQBJ6dM08EcAD61F3BxTx3GD1oAmTAPPpxTlzkniohnHIPpxT1yODkcdaYDs5OOw5opRwuePTFFMDYPHHrSgimYJ/+vTioJHJ/CgQZwvvQB2zg0A89OnrQRjkmgYYbI6e9GAMUbgjDILe/WgNluQMCkAuBjrRx0oJAOQCc9qQHk96AG4OT0+tO+ozQgP1pCcUAAPy98Ui8Egc+maTORnBGPyoGBg56+hoABkc9TTeRwQCPajeR0B/GkfKgDK0ANKruwG4+tBIz06d6aRg85z7dKUghQQVI9O/40AMI4PP51S1MbrNsHGPf3FXWHHU1SvwPsbH0x/MUpbFQfvI55xweM5qhc5ZfSr5JVTg5J/vVWlG5xkAA+nSuZJ3OqSM9z0HHFRuTx2B9KklA3HH60xxkAelWZkgG1xkjinBgqt0zxiq4Zh8xGaVmx2NK40TJKAcHORU8bDO7JyfWsx5xHIO5NW0nyNwA+lGpWxowqeuc+uavxlSuAOD371m29wCoGU96smU7PkI496TQKRdDKh65PtUi4IJ6f0qgjliCTx61a8z5iO3tUWNEzQjIVAAcn3qyF3LjjIrPjlyucAEVPHMAmSx56HNQomiehM8YKnAAPv1qArkkd6mWYO2TjH60xsFsg9fSmkUmRrHgEN19qaY2z8w49qnyM544qPzgxYA/katBcrNGS4GPyqA2oVW75qyz7Wzzk1Gz7hkkjH61YuYrmEDFMaIEMQCSAeB0qwzDGRjnjnrTPmXLDHTpQFyl5eeoxTxHsUnHJ9KnChsk4+gpccHI6DjNSO5VK5PJPT1708L8vQ0NjzASD+AqYbSuDSBsr479KbvwfU06RwpK84qDcFzjpjOaslscz56YBLYI9BUEpKvjtnGVpsj9ecd81A7NjduOMetFjOTJZDkdRwKgZwVwQPqKN+Y+e/XNQuc8AnAGKZkxu75z6UMR1GDTGyOx6dqbgjBqXILkqcknIyex6U1z6lcdOPWmbiATjtjinKoKjPXrzRcQ5R8v9aacj3+lPOVXpx71GxwpIPPYUrjJAxZgOeBUy9P8ahiDDBOCSM8VPk9MUFJE0Y5B/TtVlWB6nnOMdqrwkMcAcgVKCu7gZI5rWGxjUepZLkgAqoAHVRSgg4JI49ajDHbgAHPOAOacAO4IPpVmRL1PsRxjpTgpB6mowQe5HbFSbuO3ApiFU8HJOfenIMt0JFMBAX3apVJyAB2x0pjJE+8eO2OacCV6Edc8U0HP9c0qkBug56ZoAkU55PWnoQD0xUYbn+H0GKeOuG+vFIQ/OfUYPSpVOc81F1PGePWlQYJ680wJwMLnd196er5xkY7c1EOBwQT6dSKdkkAYI96AJMd8/wCfaimjk9Tx70UAbfG3g/nS5PofwpCnzBuhFLnd2yPSmAEdycUvVcHr70jZBAAoPUnuOlACjj/A0nQdPrQw7n7vpQepxwR3pAHPHSjv6UhGeB19aQdB/KgB5+Xjp9OtNPPUUM+BjNMfKtnHXrQAuPrihh0wOnpSEnPApG5Occ0AIeF4PPbNJjnJ5HvStwaReBnrQIRlIz7dKbwBgZ+tBIyeeR3xQ2GHXpQMQ8LhsfhVO+ybdwAO3Ue4q11bPQelVrk7oXXGDxzmk9hx3ObKkLzyf5VXlUq5DEY9qsSBguQMkVXnToeprn2O25QmVeuDg9SOtQtlSQRyatSYJ25yTUDP+8yvFK9jFogJ+bgnB/KjccnJ6+9Oc5HzcGoiD1xigEQXMZYh1PPbmiGZuBzmptmcYGaYjKhJ3dPahOxV9LFyJ2jftV2KQMnUj6GslZA6cr1681Mko3ABseoxVbkJ2ZuQuAhBGc/pUqsQpBPJ71mxTFkBHA7CpwwlUKpye3FDRomaQkKKdxApwmLDHAArO81kO1m+UdOKkjusttzkD2qTRSNiKRcZ7ClWVeAT0rME27+LOe+KVpg6/wC0O9K5dzRD4jKsRuHTbVdSFfIPHvUBn3HJGB6VDLNhgV5z3qkBZnkDEfMR+NRmQ7Ru6jk1Qe7YArj8age4ySM4yMYpk3L8lyoGQec447Un2oeWeuT61kvMMgA9KQSO77Qe1Fh3NMXeCAOKmSfdjr171TtoAxAI5PU1prAsagge30pA2RSjK5BOM84qMSEJkZwD/F1J/wAKJ32PwcjH61TafO72J4p8o0TySrg56kdKqvINuD+lQST7utRSSLt4HPpSsyJOw93y+CeMU1ZCyYJUHdgA+lVy2AQOCRk03cuAen9aq5i2WTxlciqzyhSeSe3FMlZgBgYBqJQ4Jx0/nSuInyzDdlsdMUm4A4JzxnmmZOODg+lOXJyTUNAPJyuV647+tKoY4z1xzTQc4HUdMVIOmBxjjFNNDsSKpYHewwOnNMwDn5SfoKOeGDYIGMYqJ5DvAHc81SLSLcYG3PYCnA85/wD1VGhKpwfwp3YZ+tJoZPBwSfU9qsqoT5gM5OM1WiUN1/Kp1U7gfQYxWsNjCo1ckDbTkZGTT8njPemYLZ74p8Z4Ix+NWZDl4YcE07cCTx3poPUEdOlOGAme5PWgCUDgH5T7d/rTgW6DjHrUa5GN34Gn5Zz9O9FwHoxAYYJPvT8cAscn26CokzuGfXNTEgnb6jpQIcgA54znPNSj5jx196jViuFz0FS8ZB7460ABYggVJGwP51GuNx9SOtO5UjcflzTAftw5bJH0p4yR1P4UmRjpgHoPWnDau3PGelAEiqNuc/rRSADruzz6d6KANog9MZBpQvf9KeB19utNPvTEHPAJpTwSP0ppYdAOB2pMHgUhik5GQM07rnIppyT8xpSQRwPpzTAOSeeTQy/Ljt60hPTjpRgj8OpoEHB5FAOByf0pvuRzSdQTSAXG0cn6U0kqgJH1pWyTnGcdPakwC2cUDEXBGOv9aaMkexpFGXyTx60pJPHrQA3AA5GQajySPlHA/Sn4xg9aRjgf7XpQAzAx61HPzCMj6VLg5wfyqKQZQDotMDmpOmBzmq8hBTgZPpU0xOcg5BqF3DEBj1rludy2KNwu05AzURHXNWZMEnmqxALk9j3pmctxjEIwJXPpz0qIAbSTzUpLE5AwKYcKAScjuKCSJuO3/wBeo9w6DvUsi5XpkelREZXIGBUNAIQAcLx6inbTgc4Peo8Bl5PP86Vicgt2ppgTxzcj2q1FcOcjPWsotn2z2p8Ugxgj6U1ruCNVpSTtA570Y2rvbp2NZqzEIBjd+lP89mU8896dkUpM00uSuM8ipjd7CcVjNMeMHFOWQlfmNGhakaovWK7S3H0pJJxtGOtZLzdeMe1CyszEetJj5i002D8o+lQ+b1z0x1pqYYe571MCnryKEiXIiWN3cbeQea0Ley25lbuMVW+0GNcKOvvSfamByRkYz+FVcLs3oWigjBPBx79KgfUETdtGeeD/AJFYcl40jhVPaonkYofUVJSt1NKa981jzyTmqcrsc49c1VV8AMTznkU1pdzAdAWxTsPmJ/MJ6DGBz9ahMgwQoxk81G0g3bc9G9KQAMxA9eTQQ5Em7JANBlHKlenfNMICnhunHSoy/JANBm2DuC3B59PalTAIB+Udc9aQu3c5wMCnKWK8/wCTS5gJo0O5iD/9enjjjPWmxcflUhP5dM1D1GAGWyD2qRQPxqPAwO4qQgjGfu44pqIx2Dnr7ULADJuJzxSZB4B605VAHocVS0KTHMQoA70inJIPTtTDyeafGDnIGaLldCzEdig5we1TqxGcPy3J4qlI+0qB9TU0LgnB49quDOWa1uWc5GD1709Djgf5FMA4p3B/AZ+ta6kDsn0zUiHj+lR9VHHFOQbSaAJlCklzwcYHv7VIp+XJ4A5qEDCkk9Tmnr0yDQBJnfk4qWM5G0jjFRKQCPT09acWUuMDHPSmBMNuRk8DpTjt9e/SmL0696AMtyfxoAec8Y55qZSWUbuCDUJ469KVF9Omc0AT5Azzkk9aUMMjP/66YCAcHuakU4OaBDzkEEH5c/rRSg5JAOcjmigDdwTz6UHqQf8A9dAPy4FIBnBxQA7ION3UUg689aTjPSgYJye9AC5544xRkD8etG47c4wO9GCMZ70wE4ySBSHuacCCAOuepppOST+lIAHB5HFJyc+npQDjhutJnIz0oAQtuwPypPlIO7j1NKSRgtxSZ4oAQggZIpmVAJJyO9KxwemM03oOR+tACNnPse1I2QTnpQVwOP8A9VN6jrQAhLY4X9ao3d8tuTGeX9KlurlYUxuyx6cVzVxMHkJJyTWc520RUVdj5WJYev8AKoQQ2GHANOdt6Z3cfSmgBDg9qwvY7FsV3HB449aqyIMYA+tXZGyhJ6VWKZ4AoTJkrkPHaoSxVs+lSY46ZNIRkZ6ZpkWI+e9R5YvjFSYw+QeO49aazZOe5piuRFsHrz60H7vTOKewzjHTvSKA2O9AiL0BHPYU0oCcMetPJUvg9qRl3DBqWwIUJQHHFODsHPPynoPSnkDoetVzk9Dlv5U0xkpPfqacGyVVOVqARlWLZ5b2polKkmqbQ7lpxgZz9eKdnPINVEkAG0HHpT1kxls4FLmQ7lrf2NLPLheOpqobgL1br7U1rgjbu60XQXLAc8fSnszAAMeoqn5pP86BLnjpz09adw5idiFzj60m9SQQPmxVdnyCCMgHNDOPl2jsDnPekHMWGlxhT1zmmFwuTn3+hquJMkluuaVn5wR1HFK4h7SBupyfWnK5TBz7CoVBOcHHrTsbsc5xx+FO4iRmyxHduaFU45HGeuaEUjoalEjAYbkdKAG7R90D3p8ahTjvTSDu6cGnFSFqHcZMDkjjpSg4JyKiQg4GM1L5Wcd89vShDHj7uQfwo8wgc8Ug4OzuOaXb82CccbulaWC4sbFjkmpCQR7035SAetAJIyTjtRYtEijAzUiYzjPvUAOKmXoPXOTSKK13cbbpI/YH9alQkYOaytSlK6ki4wSoI+mTV+3KtH8zZI7YoTOab1NKJg2MNhsY6VPwMKTye9ZSZV9x59PYelaEMqumCPxrSE77mTLIAwBSnDDGORTEJPAGKkUAEjGeKu4iRQSo47U7aeOKjUjpnj+tSHkDPFAD0BDcDtSlwGHqeKYOMexqUYI64pjHITnp36VMvoeO+PSoVHPHWpBkA4FAD/brUittG3H41WbgDcMjPrUqlgF2r1PrTAl3EYLDIzj/AOvUmemBnPNR5PTqaXcVGNvU+tAiTJPRcn1zRSBgeCO1FAHRE5AwcUmCDn16UdCTtwT70gGcFjQAZDADFBOzoeRSsTk4Xg+9AByNp/CgBAvIyck9aXAAwBRnJ579aCcHP5UCDDZHOP60jL1GOaA3IJ70mSDxxQMQgHGRz2FByOnekGSMZwfWmkZPpjpQA4Bc4PAoJXOCOnSmkccHPqPSkClw2B06mgAOByec9B60mDyOxpHbjGcAdOKzbi+J+Rfu9zUuSQFi4uliGNvPYZrHv9ZEH+z+vp7VRv8AUBbgqT8/p+XtXCa9qskk23d+GOvT2rLnk2Ukdbd68rufnx+H/wBauSv9WZ5/kPH/ANYe1YMl9K+ST/KoUcM3HelbuWkj1K2LNaKD3/xp7A4wearabKZbKOQrhmzxn3NW5MYy3HtU3R0pkJDEnJyDULkgcj6e1SSkLxnk9KjV2DYzwevFMTYxgTncOaiMY7DDVOqrgHqKjYigzZXcE8kfKajZtzdMDuPSrTNx979KrFWxkHjvSEIDgAGmAHgU4F9xyPoc9aaT0PagLDSoYjA4oxt+UnOKduw209T0odi5OaNQGFCrZWm4VVXBzn+H0qQ8qARkdxTQoYg4xmlsFyEqQhLDBHWmbQV9l6H0qaUBsuBjHbNRtgEJjp/FnrS5gsQtGpAIpHjxuK8D0qw2zcSpyP51CxDKBjjvTRSRGIyfoOtJgr35HSmO7bs9qA+7OR1ptCsSKxGST14NKsZZtw5GKjWQhuOMCp1Py7vzpCFZBt/u4/HNMZVwMHJFSKQ27sNv60wnBA/DNUCQqru56cYppT5qmIGABycc0xiM4U446Ur3GIc545wORUinKehpFPyjHrikGCSCMDPP1osIlXhSR6YNN3gDI57Um3dhQeBQSM7fwxSAUOep9alPzYYdMdKjHQAVKuV+bPT2pXKBeMEDHvUqkHlucDrSAB13E8n2o4AKq2ce1MaQ4HjjpTlPpUatnjrTxHu4xgk/nTHoOU5yT0BpFI3lj06CmiMhjt7HB9qlTCnrnAplIcM4yBxUiANjFMUjJ5xk5qQZI68UAcxrz7NXQHr5YP8A48au6XLuTaeT1Ht0rH8QSgasPmyduBx/tGrWlXBDoAM8AE/lRY5pbtHQnJHIzgUgkKkYXI789Kf5okUZ5wMVFznIGeelGm5GhpwTAgDbjj1qyBmseJijccAnke9aMEwYYxz6VrF3FYsj72PapRkYwc9sVAOSM9u1SqcHJ44/yasRMpIJ7ZGPxpzAsvqRUYZuAT8p708EBsD0/OgB6ElcsM/j0qVSR1/AVADnjoc1ICAuD16U7APyxB7jNSAEADpx0/rUecxj16CnL93HegBwyD1x26VIn3umTjrTASMA88VIH4PcEbce9AEmcr8ydD60UzJGFPHoKKAOix0OcD6daQ8cUo++Gzz2oOAuAKAHHAHX8KZhiTg8HrSYBU45pxJwR+YoAMHJJOPUUiLhgS36U7HJ9aaQAeuB24oACTwMUh5Xbj60pwM5ppJ2570AKT6nikAJxgU35gOT16UpOOd3X2oAa49DlRTJHQK7E8jFRTXKxIWY5Y9qzZbgzbd/vkelTKSQxJ7tpnKjhT2rPu5jFGfWrCEHGOc965PxHqzRfu4zz2/T2rCV2NHPapqpedxHynGffge1c9dXJlkODx2NFzcFsnue1VC/JyapIq48HA5NGemO1Rbjxj/9dIGIxzzVWFc9R0CUyaLBJ3O7J9fmNaeQoJPSsrw0w/siBTzjd/6Ea0ioJ56GsW9TrjqhXU7/AEzUDMCc4+tWgCykHp3HpUDqoPTihaiaISQDx1HWoiOeOhqduVIJ4ppGeB+dMmxCRkEg/wD16gccFj90VORg4bj2pn3DkHHvTuhWIOeTng0YGDubA9cVJJlQeOlMwxQYOB2phYiOVGRxikIHBHbrUrZ44zimY3DNFwaELlWDLx6UgLFvmP6Uw53HNOZssCWx68VLsxWAvtfBPLdOKjfli2MHvQz4OQMikJI5PX0pWsCRGUBwfToaY0ZB3LTwMZwPxofdyVbHvimgIDFzjNJ5AB/2fWrKhshV5PcU3bhgSM0NBcj8gbckcClAVQOaey8k46ikUkZUcccVNwHK20Eg/eG2hfl/nmkTLkheWHWlbcePQ80xDZATznvSjJAX2pGzuz2ApQDjcehppgGRnjtwfegrtAJH3ugoyAMdcmnbWIA7U7lDh8q7s4OMEYp2NyA4yT096iZM8Y6cmpkYKBtPapsh2FVduNwwcflTgSSR29aTPIz1NCphiRxnrRYQ5WAZgecigLxkH2xikVeCc45zT84XOeOpp2GJ90Dnv0qRTx1waaSGAwOKUDB5PHp707FIeo3AnrgU8g4UeoGKhXG/HQ9am/GgdhwI3bT1xSjhsdaaMj+dOyAMke+KBnDeIXP9snjgD/2Y1Pp0uCpJwOP6VB4iIbUiVXb3657mq+nufNXPTP8AhWnQ5urO4t2VkVl5OBmnnGSfWqunOWjGD0H6cVfI757YrO5m9yPjAxzU0TYwQcYquc5IIwakjbay/LuI98UKQWNSBww5PFTjLcAfL65rPjk+fIXkcnnpV9G3R5HWtk7iJVOMAdfSpB97BHXrUaDGSeBj9aVWbcDngHkVSAnG1cY5APFPLK46YHcetRb2Z+vbAHtThwemD0NMQ5cqMK2B16VKpwFPfP51E2B04p6jpnmgCVQCScd804sS459sVGAc9enSnAYwQcE+1AEu3qM+9FIr84PPHWigDoc7iMU88n1PrSZJHXp3oxkDmgQiknIPWgZI/pQOucc96b23AYFAx3Q4A4HWmhg49vSlIHr/APXo7E0AIMDGOB3pCQc55oYYyOppWbC8/nQA0E4Oao3N8qAojZP0qC9vgzFFbA78fSs8lSPXFZTnbRDsLJKdxz+NRFgXwTikZm4AqJCzOCenpWTbYyaZxFEc9+teX+IbgS3jZ6nH8hXouqXHlW4XPPb8xXkOqT7rlh9OPwFOOuhVtLlGaXcxz0pgPYHinRo8jjHWtO2sggJY4rRtIgoR27uCdmT65rsPCnguLWYbq6ubjZFa7MpsJ37tw6hhjGKoW8Qkbag47VtXGh6jpU5tXGxz/B8pxxnrk+tHNpcqMW2a+nRfZrURD5QOg69zV9UGQCcDtxVMnZ8pOcd/SrSZcZzlqxb1O1KyH/M2Mcj0ppOSAO1OcA5wM56VCWLE4H4U0wI3Tb7+9RPggDPWrDMCArDntUUkRVsjtTII29TUe0n6GpGII+U/jSf7vQ0rCIpDgBQeKhY4bg1YwCCpGDUarhjnoOgobsSRYLEUhTI4HFSEHg9KYVJXrg1N2LUjICMPl6dOaCgVuvzDqKkwevUVGoJGc0agRcjOPxqPHPrmpyhJOBx60xx2PU9KNSkRkHkHrSYIXHX196cwOM/5NNbaQM8Z6U9QsAwSeOR1oIyTx0oUZwCMjvSEfKMHr39aLisGecYwCMUGPABxgdM0vlHbuxSZDcUh2G7cNnrmg5PGe9SBeDjoTikUYYr3zQS0JuP4fdo5xwO9DqC3zHoak6gYOQBQFiPj+I/hUyjK00KDkFscZxjrSqdnQY/GqTHYbg7+enenkAtgdKQ4IJzye1KBsHBplDwSq7McZ/WlUkkgjFNUAAk9T+tNABJ7UBYmyAPfPWkxySTz6UnQUE7iMce/vTuCQ4KAuT2605cEjnANAVx1GT60FSDkjmpuMkJVep56Chcjvj+tMUg8Dk5qQH2+btT3KsPBwAp6HnNNduCCeMUElR/tGmOSIzkc4p7BscTr4Yaju6gj+pqvauFkQjpx+damsSKsknmDIMZC+zc4NYcRbAK9jVXujmnpI7PTJzgds/r0raUBhk+nSub0hjsVj7H+VdHG52ght2R6YqWiZLUZjMmemOgp4U5zjvRnLH6UAEDHqaViSVQQN2O/rViOQAhu2eRVQDDAjtUqn5vr3piNMHcoKnAPNOXGBkY7VUilYKFHTPJ/pVsFdowOvUVtGVwJUHYDHOakGVwR1zUSDt0B4p4yCR0AHFUA4qfvd81IuCBk96ZkbcH0zTl4A560gJFGSSB0757U8fX9KapO0jv0oXI4J/SmBKB/tc49KKYMjtxnINFAjpQGxknk9aM4GM0AAEcfjSYBHTigAHzdKU8tjOM0m4BsdKGOOR26mgBB1IIxmlAOetBOFJ9O9UZr7Z8ijJPWldAXS/cmsu+vN2Y4z16n8qqTXsjHB5J78VXU/LwvP1rGU+gJDWyOKblicZwB39amYKcHPJ6io3I6YyKyZREQpGc4NSwZPyjqaiZvmB3Y/ChThTxgevpTA5TxPeFZ3DNwMcY9lrzmRQ8uT0rs/GjsXjGME53f+O1ytvCSQWX9a0TaRTeli1Z24VQ35mrCZnkCqMA/rSmJvJAPP9ea2dNtMEswye3P1rJt7jhG7EWKaxUSxj7v0+n9a27vXbrV9eV7kfvDncOOPl46AelWdKtba/1yHTr07YG3eYeT/CWHTnqBVJIYU1KQxjO7GDzzxVJ+6aWXPoXXGGBIy1SxnCjvUErc4Bz/AFqWNhyuag6CbcSBnn3o2DkZzntQgO05bjtxRtJGOg7mmgsRScyDHSgAc+9BXOARxQCUUjOc1SJYyRcKQDgVA3ysNoz6j0q22JCCRz9elRSoobOPrTuTYgQDAwOT1FNZAw6807yyCStNLHlccGiwrEBJHagANyeCOoqRscjpmo+f4Tz6UgYhBDdcL60pHynHWo8A8N+fpSsrfd7+lMVhrANyD0qJlbaQOtTBSAMmnKpIGeCe1FhEKp0BHJoVAp6fj6VKw255yOxpmw53CgaImyOT2pjHnPVasMvAwcU0gY2noKGURbSBkd6Ro2GM8Z5qYLuyP7ozTFxuAznPUf0qLBYhXG7B65wKk2cH5se2KV/vHsBwPaheDkdapCsMC9+hBpRyf1px6k+1NxjpzkZJoTCwcDleQOTTQ2WJx1FODkdFzz1zStu/vdRnGKqwII9wbj604ck55OcmhTgYPpmgKAdwGPeo2GOMe4AAdaAnlg55wPyoLADg5NKoypLc+1NMBqksCDwOuakVACCTwKUMMADjFLzjJ55ptgKXGOPpmlPUHOOMUwKDLk+lShV5PYL+dJMYxOpOeM1ID7/pTQocgnj0qXlRgdOppjuRnGcdvWoZ8+WSv0qbnJbPQdKpzOOWH40MVzm9Ri8/UYoz1Zgv6mqXkCO4mi/55s36GpNWdnuSu7q3THuajtLaRHJc8FMiqi/dOae5rafJkL+A/lXUWeNgG7qPTv6VytmWRgMcA569a6SyYyBD0HAqXqxPYukc7SOCP1pAMHaB096cybTwOp65o2sW4OOOeKZAbcsNo56H/GnhcZyenNNxtHvQBgddw6kdOaQyaNgw6YqeFwjYJz7VUGMAkVKrYAB6U07CLouNrnt/hUqyozDLe+MVQOGGPXiot5jY98cVamFjZyCML61ImWHHJxWRFcEkEVdS4b0wP5mq50Fi6M4HPPpjtUqYA3d84xVeKXeMZ/D3qQHHUZ9vSrESFtz5zjAwBRTQwJ6/hiigDpzznFNKBc8cjpR8pHXr04oZwmCehoAGIfhTUMs6RKTnJ9Kq3N6kQ2x8sf0rKkumlZgT9eKiU0gLU94ZmO3p6VCcoitn72cfhTEYquRyewqqXDys2eOMHFYuQyZn3Mdh5FIXGACfwpgb5AMZPrQR6Hj0qBjiewGPeomO5cHkfyp5IGD1NIzq2Plye3NFhELuWbn8KllcJCNq9enNQOCpH8WfwqRs/ZWJ6jH86dho868TyB5F2jaxzkdfSsm0XeNjP937oxWn4lAa5XaNqnOB17CqlhAXJDNgdjj61WvKE9zTS3PmRq3GM5rdsoCm35Mde/1qjFHtZeOPWteEYwT0Hes4yTVjopaoqX1gJ7uJd3DZ3HHTgY71DpEMvnu8g24xjoexrW03xD/YfiJZriPzI1+582MfIQegPrVGxufNnbnO/G4fQGtNFEpazLUwI56U+JggO5evQ5ptwuMcZ9RSK3zDaMA/pU30NupbBO7HWpMADB+U/nVdG5HbNWQMYU8HvQDG4zw3OKiZT9/Hy9zUxA3E449aTG4YI4oMyuwHHfP6UOrYIHSnhQwxjA+tMcfJjGMUWAhkTYPaoiofkjH41KRnhf8A9dRYZeetMqwyQEctQUwQQflPWpW3FRkYHrUeDnGKRJGcnJJ+Wmqp4YnJNWCGAAJwKjbI5IoUhDdp2btvH1oICsR1HrS4VpWwMdO9IG5Bzk9jiqvcLDGGOo6U1jhSx49amAyFyelIV6UWAhYEHpz2pFjCPnby3vUp4pCQOB3oKsL5YZT/ADqFBklM5w1WAPlweOKQggZ6D7v4UmhDBEMOTx1/OoGyh6VOSBj0zxUbDDE96kNSMjcMHg0xlx3yKlJAHTJpCMj261aQWIB94elPIB6DpQVAfJOe4FKQ2eeF6imIaAS2SPYHP6UvqPxxUhVmUbu3I+lPRQq9eevSpsAi52gHpindExnvnNKDnJA9qQcHA4zyaeg0KNp5BpVyf5Un8X1/nTgvPvQOyDaF+Zjk9MYpB9446U4cMSeuKeAWBwvQZPNFgsKMHj2pC5RSBTQCRnHejJQ8cZFDERk5P4Zqndsdp2n6/SrTnaxBPJGRVC92+Uct82OmPrzUpiZy+p/67OM/N0/E1fgupbyFDN92KIRJ06DoOPrWfendKATxnGa24ooVsUMb7/3QzwRg4om7QTOWb6kFu2HxuxzjGO1b1kz8DGRjNc5CwMxA9cVt2Z2kYOOxq0EXdG8rHYOflPalIBGQefpUcHK+ox1pWByCo5BoaFYemD/jTgB0Jx6U1HKAn1P609ecnHXv70rAIVz34pcc4xzj9KUMeccnFCkFsn7xGPpQAqsyjB9f0p4wwz+VAAPBPPSkZAD06UCGn5WOeB61KkpGOcrtqGVlCqeh7VH5yht2cNQxmhHIMYzjnOfSrEU3zEYzgZzms2K4Bbg/j71ZWTnH400xM1IpgV5PJP3faiqaqeOcZGaKtTCx0sl+Qxwcev8AnFU57wlDuPJqOSUDr+VU5pOMlcE981LbAZLMSTu601Zuc7sY9qqNIdxBGQe9LGw4APSocQLzuTH05PSq8bt03dPap8gxhCdzD8Kpu+y5YA7umD07VKVwLSkquF6U7H3QDgnPFNjYcg9KkBGTnv3p2GBG0DA4HSmMrA57ipRj61EXGBg80mBEfvDPU9KLn93bEdCev506NsuQDzUWpPiLrj2/KlqNHB+ICGdW6Bc8/lUWmjbcghcKff2NSayu/IK5z2z9KTTP9aGzhh3/ADonL3bGc2b6DDr3HNX4F7/5NVlHyISPXir0K4XPX2rOnqrHVQfukunWCajr9rCIvOb58pu25+Unr+FYOn2L21/iQ/MO/wCBq2txqGmat9rsvvP/ALvZcd/qaq2F95l6BIMOfvfka6Gly6lq/O0bFwuxCMYqqvK8DOatXmWjyvQ1SiPGCvT3rO5dy0h6MRz61YT5zx/+uqoYcEDJqdDnjpmmirk+CQOcmmYDDIpynjJXJPfNOO1sg8j+dNokibhumaY6ANndx34qb/aHHr71E7AgHNIZXKqG2jhRTAdvA71O2CpC/e9ajcYJ5p3C5CzBhz3phXnJqVwM5qMk496CbjMkLj9aRSQcAZFTNhlyetQiNScg9OlOwhucDpn1pFAGSq5b0zQM7cU0sN249aVgJ+2eme9MOSSB2pocuc0hcA89v1qkFg5HbkUbdxOetG4MOOaMFQABhaYwJO3GMYpu4cfN+GKUsenWkAIb2xUjQjAsMimiL86fu5PFNYnk+2KVgGOwDBWHtTgBt4PNNAPYc9acindz+VVcQjYBGRx/WkMasQfQ8e1T8Z5pm7GQvrTCwzGTgnkGgnbyeO1OG7B3fT60oTnmoaHYaqgDOOvNORck5HHajb2/SngEY7d6aQWGkZ+WgIueTzTtoz9TzS4C8bffrTCwnHT9aVSApPYUgILHApc8HuKm4AH444BFNJA6GlOQmdv61ExIXNPUQyds9e3esu9JELN1B4/Q1oO2FPuc1k3rqQ3tn+tKWxEtjDnQyzKijlmAFbbJ9nsEQ8HaAfriqum2wnuvMY8Kcj6girt+/Vc9OOn1qJO/unHN6mRCxNyQemc/rW5at90D2rATIuc+p/rW7ZHCj3ra9kVFnQWrjAxU7DnPvVSzPAxwauOCUxRurjbEDbsHsD096duz0P1qMdh1OMVIhxgH160gFJ5A9qepLYzyBTMHeTuz7YoJwAp69aTQiYYyBjHNDDAOODnimb2fbheBhevanBiue/NLUBsqlkxnkis6QtGSCM9utaec8j61UuIyG35wDTGVklwQSc+1XraQHnHes9gM8nvmrtqDu3f7PFJCNaM5T7vsDmioo1AUFuvUUU+ZAa8h6Lmqzgn5sZNSSMd3Wl2gkDtSbY7GdIoPyjnFQoxzxxViQkhifaq7cMoHeqEy4oBQENx3GOtQTnY4O7hu2KmToD3qG5Az9KAJ423JzyKnXkZFV4SQisOtTKcAVD3GS8YIHT0qHjbntTtxC5B5oYADimkFxsShpcjqOlVtWcxx4Vvm+n0rQTgDHfrWTqfzAg9P/wBVNoEzjtTieSPf1x1P5UabGrHaOSP161Ldgeaq9jnNPsVCiQgcjGP1rKoiauh0Ecf7rcByKngAPIOBRbgG2Ge/+NLAOSKmDsbYdlrSVgufEFpazSbFbfk7SeiE9qxGs7f+2H+zHdFxgcj+H3qtr/yGJ14bnn8qhtJHj1HahwD7e1dDfuamzbUzoLoDYFPOaz4wV+hq/c/eA9etVAAqgioSLZOnPB6inqGQksPpzVeNjuxVlwMigaZPksOuSKfjr6jr71Wi+bJNTL8zYPbpTQ2Kct2wPSo92MrnrUpY7gM8VGWJHNBKIxhuKa4Y9uaeSd5PrUW4hsUCImBLe1QyZXGBx61ZwADUBAYDNNDsRg4wuMYpythQevvRtG4cUzAyo7GmDQELn5V57nNNZVOTtyfTNKwxGn401ume9BJG2R0PWkfkcDb+tSuMOcdulRkAMcUWGRb+SAelSgsFPGD2NBUDBFIeOR60bDYK7ZINKxOODg56YpuATzSjv7cCjcB218Anpnk+9BX5uaTPy0q80EigKGB6nGKY+Ackd/WnDkH2PFN6qSeuaNBgvzqccClUfKRjvSKcDI69Kk6rn2oQDVX8s9aecZAP4VGQCAT2ORTwckUXGkLgD7o57mlC5YHrx0pV5cA+tPwNxXtQhjQoJOR7/Sk28c9M09+CFHTFNyd+O2KLk3GnGD9P0puQFJB7U5id2KYSenbOaLCG7vlz68YqFx2IxzmnvzkGq7qARx1OKlgMlOByax7zMkoUdzgVqTsQWA6YqpYqHv23DO1cj65FFrETehat4vs1ltPU8/jiqFzhtxZuR04rUueR+tZM5JJ+tZRZxbmacfaFbrzgn05rbtAcLzxjIrGkJE49jn9a17L94o3c/wCRWl9jSO5uWnOCOg7+9aecx59BnPpWZDwFUdNorQT7o+laWGxNpI3Zz+FODcbaYxIYAdM07pyKewC7AeCPfrTyAI+DznkVGOOe/WpV6A+p5qQuJg7AR1/mKaOe+OalUZZs9hSkAED2qRDAAed3T2qOdS8Zx2qbGAfrihziEgdMf0pjMxlIYL3Iq/bR7VBB5qlGA0vP97FaiKBGMdqlsRKCR1P0oppA69+tFFkM/9k=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 300,
          "bodySize": 65136
        },
        "cache": {},
        "timings": {
          "send": 164,
          "wait": 0,
          "receive": 6
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8641"
      },
      {
        "pageRef": "page_66",
        "startedDateTime": "2018-08-14T12:26:57.723-07:00",
        "time": 20,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/images/icons/question.png",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCPHeader.htm?persCallback=&persCheckIsDirty=true&inctvCallback=&inctvCheckIsDirty=true&ccOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&waOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&scOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&readOnly=false&isPrint=&nrtvHstryPage="
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 706,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "image/png"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:10 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"02d9b6cda8ed31:0\""
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            },
            {
              "name": "Content-Length",
              "value": "427"
            }
          ],
          "content": {
            "size": 572,
            "compression": 0,
            "mimeType": "image/png",
            "text": "iVBORw0KGgoAAAANSUhEUgAAABEAAAAQCAIAAAB/UwMIAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABS0lEQVR4nJWSQUsCQRTH52vuQQkhNNiDHhYiA4M87MFAFPSwYBEVKiEkVISSKAoqKBhFggh6kKAg+gj+ZOU5jEYEwzI78/7v/d7/jfr+efvvUsb/+7h1Wynk8qlE4jB1lry6zg+GT79qZvNeJuM6TpS4bv9h8THke1e9RHkUd15en00N6W37gAo7YRBHYzb6jebza8RRo1mRIPbUhJBooSCpz7nSeF6aJQJCA8EASCSyLEv6QY9srWEHm2ggrNXLbOgBjQ5MFg4VvYZCe9s9TKYdcnEFlRwCfP94o9Dh1bYGr8KRfb0+6/wiWyx5Kzboqabf8QsVEUYihtbuVJXs/hw/9oJKOiWG6KVAojgYuoZmfHvXM2X2rntCJpkGjuuvBvfo0A/YvB3oqaZPVmoCT0YxUBnXjBJogsDgi3WnyWOjW/NdCxtNGkbLWgLLZYCTlrsFYAAAAABJRU5ErkJggg==",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 246,
          "bodySize": 572
        },
        "cache": {},
        "timings": {
          "send": 2,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8639"
      },
      {
        "pageRef": "page_66",
        "startedDateTime": "2018-08-14T12:26:57.723-07:00",
        "time": 27,
        "request": {
          "method": "GET",
          "url": "http://omniconv/OMNIStatic/images/icons/wait.gif",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCPHeader.htm?persCallback=&persCheckIsDirty=true&inctvCallback=&inctvCheckIsDirty=true&ccOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&waOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&scOnClick=%24('%23sc_section').trigger('header%3Aexpand')%3B+return+false%3B&readOnly=false&isPrint=&nrtvHstryPage="
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [],
          "headersSize": 702,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "image/gif"
            },
            {
              "name": "Last-Modified",
              "value": "Tue, 16 Jan 2018 14:58:12 GMT"
            },
            {
              "name": "Accept-Ranges",
              "value": "bytes"
            },
            {
              "name": "ETag",
              "value": "\"05acc6dda8ed31:0\""
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            },
            {
              "name": "Content-Length",
              "value": "4970"
            }
          ],
          "content": {
            "size": 6628,
            "compression": 0,
            "mimeType": "image/gif",
            "text": "R0lGODlhEAAQAKUAABQSFISCdLy6rNTWvJyejFRWVMzKtKyunOTmzGxubMTCrDQyNIyOfNzexKSmlGRmZNTSvLS2pMTCvCQiJISChLy+vMzOxHx6dDw6PJSWhOTixLy+pNzaxKSilFxeVMzOtLSytOzuzMTGrKyqlGxqXLS2tBwaHISGfNTWxMzKvKyupOzqzHRybDQ2NIyOhNzezNTSxLS2rMTGvCQmJISGhHx+fDw+PJSWjOTizLy+rKSinFxeXMTGtKyqnGxqbO3tzyH/C05FVFNDQVBFMi4wAwEAAAAh+QQICQAAACwAAAAAEAAQAAAGpMCf8CcSAgDCxnAZMG1+rdavAbIshYYJ6efx/FIg3JJh+I1mmkAAEeP8cFbDAnP4ZSBCBOyHKoE0RBc2BFc/ECUpL0sIA4UIK0MFLCcdkFchMDIVJTssDB0hhSswKQolQwhuVwgIQyEGNz4RhTAlMkoDDwkKPzkNISt6Pxx+Yj2NBhQIBjIrJW5wSxw1PT8xAj8yJWJXMQF7KtU4VYXDQjqEb0tBACH5BAgJAAAALAAAAAAQABAAhQQCBHx6bLS2nNTWvMTGrJyajExKRLy+pOTmzKyunGxqZNzexMzOtISGfKSijLy+vCwqLLS2rFRWVISCfNzavMzKtHR2ZOTixNTSvJyanFRSVMTCrOzuzLSytIyOfKSmnMTCtDw6PLy6rAwODHx+fLS2pNTWxMTGvExOTLy+rOzqzLSynGxubNzezMzOxKSmlDQyNLS2tFxaTISChNzaxMzKvHRydOTizNTSxJyenIyOhMTCvO3tzwAAAAAAAAAAAAanQJ6QVxFCIDzOYcj0wDY8g4EnAFiYQkYowFMoeJIRgVnA8BKhi8ezGL14FxcPY9CUeI6BEOPhUTodF0Q6Gm9YGDEnN0wIFFg8CCpDLBMFCZJYHDgnDzE2DZYcjyo4NQ8iQwgLj5FDHBgfMymPOImrNCQzRRUtHBwIODw0MR2LEY4YGaQ4Kh00PDcMTAs5ETwnJzw1HS2PIBnPDyA8LR3Sj6s8MajQTEEAIfkECAkAAAAsAAAAABAAEACFBAIEfHpstLa01Na8nJqMxMasREI85ObErKqUzM60XF5UjIp83N7EvL6sHBocpKacbGpcnJqczMq01NK0hIJ03Nq8TE5M7O7MtLK0lJaE5OLExMKsdHJkDAoMvLqknJ6MxMa87OrMtLKkJCIkbGps1NLEhIaEVFZU1NbEnJqUxMa05ObMrKqczM7EZGZkjIqE3N7MvL68nJ6czMq81NK8hIZ03NrEVFJUlJaM5OLMxMK8DA4MvLqsJCYkbG5s7e3PBqXAn/CXEBoMws1wSbCofgrFj+egLIW00+IXCPxcPcnyMfh5bjkcgdFD/Dac38BFavwQFWzm9+kA7BMEPiJXPzU7Ch5LKwyFExpDJjgsAheFISUgMQIvkw0hhRclMxsCQyGNVysrQxc2AjJiVyUCII0MESk0PyUrFyErJT+vGDlvMMMYmC0hAjY/OUVDObU/MyDWxYUJGMgbMT8wGNJXxj8CPELmQkEAIfkECAkAAAAsAAAAABAAEACFFBIUhIJ0vLqs1Na8nJ6cXFpMzMq0rK6k5ObMbG5kNDIslJKExMKs3N7EpKaUjIqE1NK8JCIkZGZktLakfHpshIKEzM7EPDo0xMa85OLErKqcHBoUvL683NrEpKKMXF5UzM60tLK07O7MxMasfH58hIZ0vL6s1NbEXFpUzMq8tLKc7OrMdHJsNDI0nJqM3N7MpKacjI581NLEJCYkbGpstLa0fH5shIaEPDo85OLMrKqkHBocpKKcxMa07e3PAAAABqRAn9AHEaJQwt5wCZOAfAmWz9SKLYUdmsv3ePgouOdw0vExaAiHB4E7+EYBX4dUUZKFA4/PEdmMfAMaNwJXPjEzCQxLCBmFAwhDBDoCPSKFKzYFCgA8BwIYllcrJR8XG0MrkFc5K0sNKSEnhTI1GA0+OSGxPicIKyIIMnI1ITk+FpAdISsyFis1ZTkWSzm1PikY18WFFiG3HIovIdOFxj41hLhLQQAh+QQICQAAACwAAAAAEAAQAIUEAgR8emy0tqTU1rw8OjycmozExqxUVkzk5sysqpzMzrSEhny8vqzc3sQsKiRMTkSkppTMyrRsalyEgoS8uqTc2rycmpy0spzU0ryMjnzEwqwMCgx8fnxERkTExrzs7syMinzk4sw0MixUUlRsbmx8fnS0trTU1sQ8PjycnozExrRUVlTs6sysrpzMzsSEhoS8vrzc3sxMTkzMyrxsbmS8uqzc2sScnpy0srTU0sTEwrQMDgw0MjTt7c8AAAAAAAAGocCesDcQkkhCxXAp4GB6i0UvIisshbZJolewLkbPoa4xfSFal9CIMc30GhaLciysbFsEUaRnq908Vz0pBCUGSywhgQMIQyYwMwofgSwgEh0ONY85klcsGTQPIkOIgQqJQw0eJjmBIBsHFx8hOCY2PTkIHywIrBA7ABo9Lok2OCw5Liy1PQYBSyEmgDPSOKdLCjgxPQw6PTE4SoGnJjVC1j1BACH5BAgJAAAALAAAAAAQABAAhQQCBHx6bLS2pNTWvERCPJyajMTGrFxeVOTmzKyqlMzOtIyOhLy+vNzexBwaHFRSVKSmlHR2bGRmXNTStISGdLy6pJyanMzKtOTixAwKDNzaxExOTOzuzLSytJSWhMTCrCQiJFxaVGxqbNTSxHx+dLS2tNTWxERGRJyejMTGvFxeXOzqzKyqnMzOxNzezFRWVKSmnGRmZNTSvISGhLy6rJyenMzKvOTizAwODJSWlMTCtCQmJO3tzwAAAAAAAAAAAAahQJ6Q1xDOZkLZcKmzmHiFHE8RYy2FjRqNB7MWRINlC8OT1RA0GkL0mRZ4t05Jw7OReRoBT/DYKBs2JSNXPBAvCxdLKwiEGoxCJQw2LRyEKx4RIQQ0kjKVVysFJAcnQys3hAp3WCmChB4gEhWncnQjCBwrChQ8CTsOBjwtqBodKyNjOCg8F7xDNyUpddIHGW1XCh0uPAw6ewABhHCQWzzBQ0EAIfkECAkAAAAsAAAAABAAEACFHBoUhIZ0vL6k3NrEVFZUpKKMzM60bG5stLKkxMas5ObMNDI0nJqMZGZkrKqc1Na8fH50jI585OLEvLqszMq0JCIkvL68pKac1NK8tLK0xMKs3N7EXF5cpKaUdHZsxMa87O7MPDo8bGpkhIKElJKEHBochIZ8vL6sXFpUpKKUzM7EdHJstLakxMa07OrMNDYsnJ6crK6k1NbEfH58jI6E5OLMzMq8JCYk1NLEtLa03N7MbGps7e3PAAAAAAAAAAAABqFAnpBXE8JgwsFwacjoeDEHDzNjLYW13Ic3mfAuJuVQVRzkXJ+WYmTjPS5ERE6JUwglJ55m18DwdDY5OFc8CDsMBksudlcbjDw5FjYqIIQuKSYHKBOSGJVXLh00KyhDLkVXGBJLGx+ChAUhHhqnGXM8dS4uGBE8LCELiWQ8AxkuEBAKFR08BiRLWVsopSIVCYRNTy8vPAIAAYREQgAAQi1LQQAh+QQICQAAACwAAAAAEAAQAIUEAgR8emy0tqTU1rycmozExqw8PjyMjnzk5szMzrSsqpxcXlSEgny8vqzc3sQsLiycmpzMyrRMTkzU0rSEgoS8uqS0sqRsalzEwqzk4sQMCgx8fnzc2sScnozExrzs7syEhnQ8OjxUVlTU0sR0cnR8enS0trTU1sTExrRMSkSUkoTs6szMzsSsrpy8vrzc3sw0MjScnpzMyrxUUlTU0ryEhoS8uqy0srRsbmzEwrTk4swMDgycnpSEhnzt7c8AAAAGo0Cf0KcTmkxCx3CZuL18OZePA8kthTqTxyfb2iDKIavIMa1GI0SMNhUQLSaOLy3MyHwoxubke8lMI1c+DTUKfEMrCIIOK0MmLjIsH4IrLQQMODaQNJNXKxYENSSIRVcDikMOHoCCCjM9BSs6N3E+IAkrKwMEgzMSbGM+HTsZBwc6Bi0+Ex1LGBoLPhcXPgEhEYIBAG4pKT4FMAeC30IPD0IJS0EAIfkECAkAAAAsAAAAABAAEACFBAIEfHpstLak1Na8xMasnJqUREZE5ObMzM60rKqcXF5UvL6k3N7EjIp8HBocpKaUVFJU1NK0vL683Nq8zMq0nJqcZGZk5OLElJaMDAoMhIZ0vLqs7O7MtLKcxMKsjI58JCIkVFZM1NLEbGpktLa01NbExMa8nJ6MTE5M7OrMzM7EvL6s3N7MjIqEpKac1NK8xMK03NrEzMq8nJ6c5OLMDA4MhIaEtLK0JCYkVFZUbGps7e3PAAAAAAAAAAAAAAAABqfAnXBHE5JIwuJwiLixdjDJ7nJTLZMk006mNZGUQlUxRkqJRKlbbMeAEW+kteggPIh2iFmFwZaR7lcEMxtrQyl0VzQpQyQSMiocVzspGy4YNhuOL5FXKSsJGC1DDAiSMYg7HB0hGQ2SAjoYFBweADUPOx8RKSkDuAQ6FgM7AQQ7DyAXGBgpEAI7EwlLBCAjxAG5EKVXGg4LOwoKOxQoJ5LjQgYGQi9LQQAh+QQICQAAACwAAAAAEAAQAIYUEhSEgnS8uqTU1rycnpxcWkzMyrSsrpxsbmzk5sw0MizEwqzU0rSUkoTc3sSkppxkZmS0tqzMzsR8emwkIiSMiny8vrzMzrS0srQ8OjTExrzk4sSsqpQcGhSEgoS8vqzc2sSkopRcXly0sqTs7szExqzU0sScmoxsalx8fnysqqSEhnS8uqzU1sRcXlTMyrysrqR0cmzs6sw0MjTU0ryUloTc3sy0trR8fmzMzrw8Ojzk4sysqpwcGhykopzExrRsamzt7c8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHtIBBgkE7gjc3goWDgzkYNkELFkEbGBKLiTcaQS+aGjeKghIbQSA3MiYmMhgghDmEGDesJgmCCSZBLTcYhQ4vN7eXuS8OizK0lwkygwAKBTgkl0EyPywqBB0ZLgHQlzIaLDA+gxuulw7HQSQCEBQ10QseDzQkPz0UHEEnAzIyIAdBBjykYLXiQpADGRKEeJAAwQJSERYZyDAhSIUK+YDQiNZgxkMEMYJcgMAjmkhBIkQIGrAoEAAh+QQICQAAACwAAAAAEAAQAIYEAgR8fny8uqTU1rycnoxERkTMyrTk5sxsalyMjnysrpzEwqzc3sQsKiTU0rSEhnRUVlS0tqR0cmS8vrzc2rykppRMTkTMzsScmozEwrzk4sQ8OjwMCgyEgny8vqzMzrTs7sy0srQ0MjTU0sSMiny0trR0cnRUUlS8uqzU1sScnpzMyrzs6sxsbmSUkoS0spzExrTc3swsLizU0ryEhoRcXlS0tqx0dmzc2sSsqpxMTkycmpzExrzk4swMDgyEgoTt7c8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHtIBAgkA9giUlgoWDgxchDEAZE0AaIReLiSU8QCuaPCWKghILQDglLCMzLCE4hJYLABwEQCmKBymzJSEaQAI1Pg+XQCMlK4+DGg7BByyDDQUIDyDBpzwTJTIWLS7MlyAjKxMoxzPBMQeDIB43G7KXHzsoKSAGIhsRQBUULCwM4jMqOx65+MDrxAEFClj8gAGEwahBDk4Aw4ABSI4frC4R0GEAyI8OQAYEsBEMCDkgJiQIyigoEAAh+QQICQAAACwAAAAAEAAQAIUEAgR8fnS8uqTU1rxEQjycnozMyrRcXlyUkoTk5szEwrS0sqTc3sTU0rRsbmRUUlQcGhyEhny8vrycmoy8vqSkppTMzsTEwry0srTk4sR0dmTc2sRMTkzMzrRkZmSUlpTs7szU0sRcWlQkIiSMinwMDgyEgnS8uqzU1sRERkScnpzMyryUloTs6szExqy0tqTc3szU0rxsbmxUVlScmpy8vqysqpzExry0trTk4sx0dmxsamwkJiSMioTt7c8AAAAGpECf0EcB+XA4YW7I1AFePoXEl8FYmEJXSeS7rbqY5dDk8lVKmVgogdv4clcXZFTxkTrCRMiHwmEyRA48CFg+MTgrMExphQktQwQiOixGWC0hNxI4KQcBE5VMlysSJ0MJA40JQyAuEQ82hSgYNwyGHA8CPgsbLS05ZRt+SwUxPjUyCQIvIDR7cEwDOxM+NrA4KrVYNh54H9MbExeFPqg+PRFCikNBADs=",
            "encoding": "base64"
          },
          "redirectURL": "",
          "headersSize": 247,
          "bodySize": 6628
        },
        "cache": {},
        "timings": {
          "send": 8,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8640"
      },
      {
        "pageRef": "page_75",
        "startedDateTime": "2018-08-14T12:26:57.992-07:00",
        "time": 10,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/HttpRequestAjaxServlet",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "29"
            }
          ],
          "queryString": [],
          "headersSize": 423,
          "bodySize": 29
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            },
            {
              "name": "Connection",
              "value": "close"
            }
          ],
          "content": {
            "size": -1,
            "compression": null,
            "mimeType": "",
            "text": null,
            "encoding": null
          },
          "redirectURL": "",
          "headersSize": 215,
          "bodySize": -1
        },
        "cache": {},
        "timings": {
          "send": 3,
          "wait": 0,
          "receive": 6
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8638"
      },
      {
        "pageRef": "page_76",
        "startedDateTime": "2018-08-14T12:26:58.020-07:00",
        "time": 2,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/advcor/csPln/persGoalNrtv.htm",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "38"
            }
          ],
          "queryString": [],
          "headersSize": 430,
          "bodySize": 38
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "WWW-Authenticate",
              "value": "Negotiate"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            },
            {
              "name": "Content-Length",
              "value": "1293"
            }
          ],
          "content": {
            "size": 1293,
            "compression": 0,
            "mimeType": "text/html",
            "text": "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\"/>\r\n<title>401 - Unauthorized: Access is denied due to invalid credentials.</title>\r\n<style type=\"text/css\">\r\n<!--\r\nbody{margin:0;font-size:.7em;font-family:Verdana, Arial, Helvetica, sans-serif;background:#EEEEEE;}\r\nfieldset{padding:0 15px 10px 15px;} \r\nh1{font-size:2.4em;margin:0;color:#FFF;}\r\nh2{font-size:1.7em;margin:0;color:#CC0000;} \r\nh3{font-size:1.2em;margin:10px 0 0 0;color:#000000;} \r\n#header{width:96%;margin:0 0 0 0;padding:6px 2% 6px 2%;font-family:\"trebuchet MS\", Verdana, sans-serif;color:#FFF;\r\nbackground-color:#555555;}\r\n#content{margin:0 0 0 2%;position:relative;}\r\n.content-container{background:#FFF;width:96%;margin-top:8px;padding:10px;position:relative;}\r\n-->\r\n</style>\r\n</head>\r\n<body>\r\n<div id=\"header\"><h1>Server Error</h1></div>\r\n<div id=\"content\">\r\n <div class=\"content-container\"><fieldset>\r\n  <h2>401 - Unauthorized: Access is denied due to invalid credentials.</h2>\r\n  <h3>You do not have permission to view this directory or page using the credentials that you supplied.</h3>\r\n </fieldset></div>\r\n</div>\r\n</body>\r\n</html>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 216,
          "bodySize": 1293
        },
        "cache": {},
        "timings": {
          "send": 3,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8639"
      },
      {
        "pageRef": "page_76",
        "startedDateTime": "2018-08-14T12:26:58.029-07:00",
        "time": 3,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/advcor/csPln/persGoalNrtv.htm",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAABAAAAB7IIogsACwAvAAAADwAPACAAAABET0MxWlRVTTExNjg3ODFET0MxLldBLkxDTA=="
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "38"
            }
          ],
          "queryString": [],
          "headersSize": 532,
          "bodySize": 38
        },
        "response": {
          "status": 401,
          "statusText": "Unauthorized",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Content-Type",
              "value": "text/html; charset=us-ascii"
            },
            {
              "name": "Server",
              "value": "Microsoft-HTTPAPI/2.0"
            },
            {
              "name": "WWW-Authenticate",
              "value": "NTLM TlRMTVNTUAACAAAACAAIADgAAAAFgomi59U1snS7kX0AAAAAAAAAAJYAlgBAAAAABgGxHQAAAA9EAE8AQwAxAAIACABEAE8AQwAxAAEAGABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAEABYARABPAEMAMQAuAHcAYQAuAGwAYwBsAAMAMABEAE8AQwAxAFcAQgBUAFUATQAxADcAMQAuAEQATwBDADEALgB3AGEALgBsAGMAbAAFAAwAdwBhAC4AbABjAGwABwAIAN8XUMQENNQBAAAAAA=="
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            },
            {
              "name": "Content-Length",
              "value": "341"
            }
          ],
          "content": {
            "size": 341,
            "compression": 0,
            "mimeType": "text/html; charset=us-ascii",
            "text": "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\"\"http://www.w3.org/TR/html4/strict.dtd\">\r\n<HTML><HEAD><TITLE>Not Authorized</TITLE>\r\n<META HTTP-EQUIV=\"Content-Type\" Content=\"text/html; charset=us-ascii\"></HEAD>\r\n<BODY><h2>Not Authorized</h2>\r\n<hr><p>HTTP Error 401. The requested resource requires user authentication.</p>\r\n</BODY></HTML>\r\n",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 474,
          "bodySize": 341
        },
        "cache": {},
        "timings": {
          "send": 1,
          "wait": 0,
          "receive": 0
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8639"
      },
      {
        "pageRef": "page_76",
        "startedDateTime": "2018-08-14T12:26:58.039-07:00",
        "time": 26,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/advcor/csPln/persGoalNrtv.htm",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Authorization",
              "value": "NTLM TlRMTVNTUAADAAAAGAAYAJwAAAAYABgAtAAAABYAFgBAAAAAKAAoAFYAAAAeAB4AfgAAAAAAAADMAAAABYKIokQATwBDADEALgBXAEEALgBMAEMATABzAHYAYwB3AGEAdQB0AGUAcwB0AHUAcwBlAHIAMAAxAGQAbwBjADEARABPAEMAMQBaAFQAVQBNADEAMQA2ADgANwA4ADEAx3QcBNwV2TMAAAAAAAAAAAAAAAAAAAAAisdoh7HohxDTIeRmJSFi1mqQWe7zmjPA"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "38"
            }
          ],
          "queryString": [],
          "headersSize": 724,
          "bodySize": 38
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache,no-store"
            },
            {
              "name": "Pragma",
              "value": "no-cache"
            },
            {
              "name": "Transfer-Encoding",
              "value": "chunked"
            },
            {
              "name": "Content-Type",
              "value": "text/html; charset=ISO-8859-1"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Expires",
              "value": "Thu, 01 Jan 1970 00:00:00 GMT"
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            }
          ],
          "content": {
            "size": 2704,
            "compression": 0,
            "mimeType": "text/html; charset=ISO-8859-1",
            "text": "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div class=\"main-right-header\">\r\n\tOffender Personal Goal Narrative:\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a href=\"/omni/advcor/csPln/persGoalNrtvHstry.htm\" class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; return checkFormChanged();\">View All</a>\r\n\r\n</div>\r\n<div class=\"main-contents\">\r\n\t<form id=\"opgn_form\" action=\"/omni/advcor/csPln/persGoalNrtv.htm\" method=\"post\">\r\n\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\t<div id=\"main_error_area\" class=\"main_error_area error\">\r\n\t\t\r\n\t</div>\r\n\r\n\r\n<div id=\"dwr_error_area\" class=\"dwr_error_area error\"></div>\r\n\r\n\r\n\r\n<div id=\"main_msg_area\" class=\"main_msg_area\">\r\n\t\r\n</div>\r\n\r\n\r\n\t\t<input id=\"opgn_isDirty\" name=\"isDirty\" type=\"hidden\" value=\"false\"/>\r\n\t\t<input id=\"opgn_goalId\" name=\"nrtv.tbPrsnGoal.prsgoaId\" type=\"hidden\" value=\"\"/>\r\n\t\t<input id=\"opgn_nrtvId\" name=\"nrtv.prsgnrId\" type=\"hidden\" value=\"\"/>\r\n\t\t<input id=\"opgn_vrsnId\" name=\"nrtv.versionId\" type=\"hidden\" value=\"\"/>\r\n\t\t<input id=\"opgn_submitAction\" type=\"hidden\" name=\"submitAction\" />\r\n\t\t<table class=\"nrtvs\" width=\"100%\">\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\t\t\r\n\t\r\n\t\t\t\r\n\t\t\t<tr>\r\n\t\t\t\t\r\n\t\t\t\t<td width=\"17%\" style=\"padding-right: 3px;\">\r\n\t\t\t\t\t\r\n\t\t\t\t\tDate Created:&nbsp;09/26/2017\r\n\t\t\t\t</td>\r\n\t\t\t\t\r\n\t\t\t\t<td style=\"white-space: normal;\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tI want to get my county of origin changed to go to work release at Brownstone. After ten years of being in prison I think this will help me be successful. I am trying to program, work and be good.\t\t\t\t\t\t\t\t\r\n\t\t\t\t</td>\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t<td width=\"12%\" style=\"text-align: right;\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; return opgn_Submit('editNrtv', '54685', '54753');\">Edit</a>\r\n&nbsp;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; return opgn_Submit('delNrtv', '54685', '54753');\">Delete</a>\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\r\n\t\t\t<tr>\r\n\t\t\t\t<td colspan=\"2\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t<span style=\"float: left;\">\r\n\t\t\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; return opgn_Submit('addGoal');\">Add another Personal Goal Narrative</a>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t<span style=\"float: right; padding-right: 20px;\">Last Updated By: Healey, Merina J</span>\r\n\t\t\t\t\t\r\n\t\t\t\t</td>\r\n\t\t\t\t<td style=\"white-space: nowrap;\">On: 09/26/2017</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr><td colspan=\"3\"><hr /></td></tr>\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\t\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n\r\n\t\t",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 408,
          "bodySize": 2704
        },
        "cache": {},
        "timings": {
          "send": 26,
          "wait": 0,
          "receive": 4
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8639"
      },
      {
        "pageRef": "page_79",
        "startedDateTime": "2018-08-14T12:26:58.087-07:00",
        "time": 18,
        "request": {
          "method": "POST",
          "url": "http://omniconv/omni/advcor/csPln/inctvNrtv.htm",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded"
            },
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            },
            {
              "name": "Content-Length",
              "value": "38"
            }
          ],
          "queryString": [],
          "headersSize": 427,
          "bodySize": 38
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache,no-store"
            },
            {
              "name": "Pragma",
              "value": "no-cache"
            },
            {
              "name": "Transfer-Encoding",
              "value": "chunked"
            },
            {
              "name": "Content-Type",
              "value": "text/html; charset=ISO-8859-1"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Expires",
              "value": "Thu, 01 Jan 1970 00:00:00 GMT"
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            }
          ],
          "content": {
            "size": 2603,
            "compression": 0,
            "mimeType": "text/html; charset=ISO-8859-1",
            "text": "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\t\r\n<div class=\"main-right-header\">\r\n\tIncentives Narrative:\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a href=\"/omni/advcor/csPln/inctvNrtvHstry.htm\" class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; return checkFormChanged();\">View All</a>\r\n\r\n</div>\r\n<div class=\"main-contents\">\r\n\t<form id=\"oin_form\" action=\"/omni/advcor/csPln/inctvNrtv.htm\" method=\"post\">\r\n\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n\t\r\n\r\n\r\n\r\n\r\n\t<div id=\"main_error_area\" class=\"main_error_area error\">\r\n\t\t\r\n\t</div>\r\n\r\n\r\n<div id=\"dwr_error_area\" class=\"dwr_error_area error\"></div>\r\n\r\n\r\n\r\n<div id=\"main_msg_area\" class=\"main_msg_area\">\r\n\t\r\n</div>\r\n\r\n\r\n\t\t<input id=\"oin_isDirty\" name=\"isDirty\" type=\"hidden\" value=\"false\"/>\r\n\t\t<input id=\"oin_inctvId\" name=\"nrtv.tbPrsnInctv.prsincId\" type=\"hidden\" value=\"\"/>\r\n\t\t<input id=\"oin_nrtvId\" name=\"nrtv.prsinrId\" type=\"hidden\" value=\"\"/>\r\n\t\t<input id=\"oin_vrsnId\" name=\"nrtv.versionId\" type=\"hidden\" value=\"\"/>\r\n\t\t<input id=\"oin_submitAction\" type=\"hidden\" name=\"submitAction\" />\r\n\t\t<table class=\"nrtvs\" width=\"100%\">\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\r\n\t\t\t\r\n\t\r\n\t\t\t\r\n\t\t\t<tr>\r\n\t\t\t\t\r\n\t\t\t\t<td width=\"17%\" style=\"padding-right: 3px;\">\r\n\t\t\t\t\t\r\n\t\t\t\t\tDate Created:&nbsp;09/26/2017\r\n\t\t\t\t</td>\r\n\t\t\t\t\r\n\t\t\t\t<td style=\"white-space: normal;\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tLet the Superintendent and work release know that you serious about changing and being a productive member of society.\t\t\t\t\t\t\t\t\r\n\t\t\t\t</td>\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t<td width=\"12%\" style=\"text-align: right;\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; return oin_Submit('editNrtv', '51866', '51908');\">Edit</a>\r\n&nbsp;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; return oin_Submit('delNrtv', '51866', '51908');\">Delete</a>\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t</td>\r\n\t\t\t</tr>\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\r\n\t\t\t<tr>\r\n\t\t\t\t<td colspan=\"2\">\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t<span style=\"float: left;\">\r\n\t\t\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; return oin_Submit('addNrtv');\">Add another Incentives Narrative</a>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t<span style=\"float: right; padding-right: 20px;\">Last Updated By: Healey, Merina J</span>\r\n\t\t\t\t\t\r\n\t\t\t\t</td>\r\n\t\t\t\t<td style=\"white-space: nowrap;\">On: 09/26/2017</td>\r\n\t\t\t</tr>\r\n\t\t\t<tr><td colspan=\"3\"><hr /></td></tr>\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n\t\t</table>\r\n\t</form>\r\n</div>\r\n\r\n\t\t",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 408,
          "bodySize": 2603
        },
        "cache": {},
        "timings": {
          "send": 17,
          "wait": 0,
          "receive": 8
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8639"
      },
      {
        "pageRef": "page_80",
        "startedDateTime": "2018-08-14T12:26:58.130-07:00",
        "time": 46,
        "request": {
          "method": "GET",
          "url": "http://omniconv/omni/advcor/cntc/contacts.htm?bannerView=true&editing=false",
          "httpVersion": "HTTP/1.1",
          "cookies": [
            {
              "name": "JSESSIONID",
              "value": "0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "headers": [
            {
              "name": "Referer",
              "value": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Accept-Language",
              "value": "en-US"
            },
            {
              "name": "Accept",
              "value": "*/*"
            },
            {
              "name": "Connection",
              "value": "Keep-Alive"
            },
            {
              "name": "Host",
              "value": "omniconv"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=0000WmXRq4wqnJtOAR_LH2Xsaux:-1"
            }
          ],
          "queryString": [
            {
              "name": "bannerView",
              "value": "true"
            },
            {
              "name": "editing",
              "value": "false"
            }
          ],
          "headersSize": 385,
          "bodySize": -1
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "cookies": [],
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache,no-store"
            },
            {
              "name": "Pragma",
              "value": "no-cache"
            },
            {
              "name": "Transfer-Encoding",
              "value": "chunked"
            },
            {
              "name": "Content-Type",
              "value": "text/html; charset=ISO-8859-1"
            },
            {
              "name": "Content-Encoding",
              "value": "gzip"
            },
            {
              "name": "Content-Language",
              "value": "en-US"
            },
            {
              "name": "Expires",
              "value": "Thu, 01 Jan 1970 00:00:00 GMT"
            },
            {
              "name": "Vary",
              "value": "Accept-Encoding"
            },
            {
              "name": "Server",
              "value": "Microsoft-IIS/7.5"
            },
            {
              "name": "Server",
              "value": "WebSphere Application Server/7.0"
            },
            {
              "name": "Persistent-Auth",
              "value": "true"
            },
            {
              "name": "X-Powered-By",
              "value": "ASP.NET"
            },
            {
              "name": "Date",
              "value": "Tue, 14 Aug 2018 19:26:57 GMT"
            }
          ],
          "content": {
            "size": 2685,
            "compression": 0,
            "mimeType": "text/html; charset=ISO-8859-1",
            "text": "\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<script type=\"text/javascript\">\r\n//<![CDATA[\r\n\r\nfunction addContactType(type, e) {\r\n\t// don't bubble up to header click event\r\n   \te.stopPropagation();\r\n\r\n\t$(\"#cn_section .collapsible-header\").data('mode','add'+type);\r\n\t\r\n\t$(\"#cn_section .collapsible-header\").trigger('header:expand');\r\n\t\r\n\t$(\"#cn_section .collapsible-header\").data('mode','');\r\n\t\r\n\r\n\t$('#cntcPrdRsltsSpan').trigger('refresh');\r\n\t\r\n\treturn false;\r\n\t\r\n}\r\n\r\nfunction addContactOverride(e) {\r\n\t// don't bubble up to header click event\r\n   \te.stopPropagation();\r\n   \t\r\n   \t \r\n   \t \r\n   \t$(\"#sa_section .collapsible-header\").trigger('header:expand', function(){ \r\n   \t\t$(\"#sa_co_section .collapsible-header\").data('mode','add');\r\n        $(\"#sa_co_section .collapsible-header\").trigger('header:expand'); \r\n        $(\"#sa_co_section .collapsible-header\").data('mode','');\r\n})\r\n\r\n\t\r\n\t\r\n\r\n\t$('#cntcPrdRsltsSpan').trigger('refresh');\r\n\t\r\n\treturn false;\r\n\t\r\n}\r\n\r\n\r\n//]]>\r\n</script>\r\n\r\n<div style=\"float: left; align:left; width: 100%; color: black;\">\r\n\t\r\n\t<table cellspacing=\"0px\" cellpadding=\"0px\" style=\"border-spacing: 0px 0px;\">\r\n\t\t<tr>\r\n\t\t\t\r\n\t\t\t\t<td>\r\n\t\t\t\t\t<table cellspacing=\"0px\" cellpadding=\"0px\" style=\"border-spacing: 0px 0px;\">\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t<div>&nbsp;</div>\r\n\t\t\t\t\t\t\t\t<div style=\"align:center; text-align:center; font-weight: bold;\">\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n<!-- Set default options -->\r\n\r\n\t\r\n\r\n\r\n<a class=\"cls-link\" onclick=\"if (hasDisabledClass(this)) return false; return addContactType(1, event);\">Office</a>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t<table cellspacing=\"0px\" cellpadding=\"0px\" style=\"border-spacing: 0px 0px;\">\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<div style=\"align:center; text-align:center;\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"Office_cntcPrdChk_1\"  checked=\"true\"  disabled=\"disabled\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t\t\t\t<td>\r\n\t\t\t\t\t\t\t\t\t\t\t<div style=\"align:center; text-align:center;\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tSemi-annually\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(Apr-Sep)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t\t\t</table>\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</table>\r\n\t\t\t\t</td>\r\n\t\t\t\t\r\n\t\t\t\r\n\t\t</tr>\r\n\t</table>\r\n</div>\r\n<div>\r\n\r\n\r\n<div style=\" align: right; text-align: right;  color: black;\">\r\n\t<span style=\"font-weight: bold; color: black;\">Start Date:</span> 10/31/2017\r\n\t\r\n\t\r\n\t\r\n\t\r\n</div>\r\n\r\n</div>",
            "encoding": "Raw"
          },
          "redirectURL": "",
          "headersSize": 408,
          "bodySize": 2685
        },
        "cache": {},
        "timings": {
          "send": 45,
          "wait": 0,
          "receive": 4
        },
        "serverIpAddress": "10.37.149.132",
        "connection": "10.39.45.89:8639"
      }
    ],
    "actions": [
      {
        "iterationNum": 1,
        "steps": [
          {
            "stepId": "T5",
            "stepName": "Service: Set User",
            "stepStartTime": "2018-08-14T12:26:56.000-07:00",
            "rawStartTime": 1534274816000,
            "url": null,
            "stepEndTime": "2018-08-14T12:26:56.000-07:00",
            "rawEndTime": 1534274816000
          },
          {
            "stepId": "T6",
            "stepName": "index.jsp",
            "stepStartTime": "2018-08-14T12:26:56.332-07:00",
            "rawStartTime": 1534274816332,
            "url": "http://omniconv/omni/index.jsp",
            "stepEndTime": "2018-08-14T12:26:56.892-07:00",
            "rawEndTime": 1534274816892
          },
          {
            "stepId": "T7",
            "stepName": "HttpRequestAjaxServlet",
            "stepStartTime": "2018-08-14T12:26:56.903-07:00",
            "rawStartTime": 1534274816903,
            "url": "file:",
            "stepEndTime": "2018-08-14T12:26:56.940-07:00",
            "rawEndTime": 1534274816940
          },
          {
            "stepId": "T8",
            "stepName": "docNumberSearch.htm",
            "stepStartTime": "2018-08-14T12:26:56.955-07:00",
            "rawStartTime": 1534274816955,
            "url": "http://omniconv/omni/advcor/csPln/offenderCasePlan.htm",
            "stepEndTime": "2018-08-14T12:26:57.618-07:00",
            "rawEndTime": 1534274817618
          },
          {
            "stepId": "T9",
            "stepName": "offenderCPHeader.htm",
            "stepStartTime": "2018-08-14T12:26:57.629-07:00",
            "rawStartTime": 1534274817629,
            "url": "http://omniconv/omni/advcor/csPln/offenderCPHeader.htm?persCallback=&persCheckIsDirty=true&inctvCallback=&inctvCheckIsDirty=true&ccOnClick=$('#sc_section').trigger('header:expand');+return+false;&waOnClick=$('#sc_section').trigger('header:expand');+return+false;&scOnClick=$('#sc_section').trigger('header:expand');+return+false;&readOnly=false&isPrint=&nrtvHstryPage=",
            "stepEndTime": "2018-08-14T12:26:57.933-07:00",
            "rawEndTime": 1534274817933
          },
          {
            "stepId": "T10",
            "stepName": "Custom Request: needsGoalsManager.getCaseManagementFlag.dwr",
            "stepStartTime": "2018-08-14T12:26:57.000-07:00",
            "rawStartTime": 1534274817000,
            "url": null,
            "stepEndTime": "2018-08-14T12:26:57.000-07:00",
            "rawEndTime": 1534274817000
          },
          {
            "stepId": "T11",
            "stepName": "HttpRequestAjaxServlet_2",
            "stepStartTime": "2018-08-14T12:26:57.992-07:00",
            "rawStartTime": 1534274817992,
            "url": "file:",
            "stepEndTime": "2018-08-14T12:26:58.007-07:00",
            "rawEndTime": 1534274818007
          },
          {
            "stepId": "T12",
            "stepName": "persGoalNrtv.htm",
            "stepStartTime": "2018-08-14T12:26:58.020-07:00",
            "rawStartTime": 1534274818020,
            "url": "http://omniconv/omni/advcor/csPln/persGoalNrtv.htm",
            "stepEndTime": "2018-08-14T12:26:58.076-07:00",
            "rawEndTime": 1534274818076
          },
          {
            "stepId": "T13",
            "stepName": "inctvNrtv.htm",
            "stepStartTime": "2018-08-14T12:26:58.087-07:00",
            "rawStartTime": 1534274818087,
            "url": "http://omniconv/omni/advcor/csPln/inctvNrtv.htm",
            "stepEndTime": "2018-08-14T12:26:58.118-07:00",
            "rawEndTime": 1534274818118
          },
          {
            "stepId": "T14",
            "stepName": "contacts.htm",
            "stepStartTime": "2018-08-14T12:26:58.130-07:00",
            "rawStartTime": 1534274818130,
            "url": "http://omniconv/omni/advcor/cntc/contacts.htm?bannerView=true&editing=false",
            "stepEndTime": "2018-08-14T12:26:58.186-07:00",
            "rawEndTime": 1534274818186
          }
        ],
        "transactions": []
      }
    ]
  }
}